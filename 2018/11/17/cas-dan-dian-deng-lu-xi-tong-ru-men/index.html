<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>CAS单点登陆系统Demo | iMlGw0</title><meta name="description" content="CAS单点登陆系统Demo"><meta name="keywords" content="CAS,SSO"><meta name="author" content="imlgw"><meta name="copyright" content="imlgw"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/jedi-solid.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="CAS单点登陆系统Demo"><meta name="twitter:description" content="CAS单点登陆系统Demo"><meta name="twitter:image" content="http://static.imlgw.top/image/featureimages/10.jpg"><meta property="og:type" content="article"><meta property="og:title" content="CAS单点登陆系统Demo"><meta property="og:url" content="http://imlgw.top/2018/11/17/cas-dan-dian-deng-lu-xi-tong-ru-men/"><meta property="og:site_name" content="iMlGw0"><meta property="og:description" content="CAS单点登陆系统Demo"><meta property="og:image" content="http://static.imlgw.top/image/featureimages/10.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://imlgw.top/2018/11/17/cas-dan-dian-deng-lu-xi-tong-ru-men/"><link rel="prev" title="Spring-Security遇到的小问题" href="http://imlgw.top/2018/11/26/springsecurity-pei-zhi-de-ji-ge-xiao-wen-ti/"><link rel="next" title="一道LeetCode引发的惨案" href="http://imlgw.top/2018/10/31/yi-dao-leetcode-yin-fa-de-can-an/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93be601f1b40364d8cd640d751012180";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"imlgw.top","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">iMlGw0</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/board/"><i class="fa-fw fa fa-link"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> LeetCode</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="http://imlgw.top/2019/02/27/leetcode-lian-biao/"><i class="fa-fw fa fa-tags"></i><span> 链表</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/05/04/leetcode-shu-zu/"><i class="fa-fw fa fa-tags"></i><span> 数组</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/10/01/leetcode-zhan-dui-lie/"><i class="fa-fw fa fa-tags"></i><span> 栈&amp;队列</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/09/15/leetcode-cha-zhao/"><i class="fa-fw fa fa-tags"></i><span> 查找</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/12/06/leetcode-er-fen-cha-zhao/"><i class="fa-fw fa fa-tags"></i><span> 二分查找</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/11/06/leetcode-er-cha-shu/"><i class="fa-fw fa fa-tags"></i><span> 二叉树</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou/"><i class="fa-fw fa fa-tags"></i><span> 滑动窗口</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/"><i class="fa-fw fa fa-tags"></i><span> 动态规划</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/11/29/leetcode-bei-bao-wen-ti/"><i class="fa-fw fa fa-tags"></i><span> 背包问题</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/10/10/leetcode-hui-su/"><i class="fa-fw fa fa-tags"></i><span> 回溯</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-address-book"></i><span> 大佬们</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="http://static.imlgw.top/blog/20191125/NtrimWLEnNSI.png?imageslim" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/board/"><i class="fa-fw fa fa-link"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> LeetCode</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="http://imlgw.top/2019/02/27/leetcode-lian-biao/"><i class="fa-fw fa fa-tags"></i><span> 链表</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/05/04/leetcode-shu-zu/"><i class="fa-fw fa fa-tags"></i><span> 数组</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/10/01/leetcode-zhan-dui-lie/"><i class="fa-fw fa fa-tags"></i><span> 栈&amp;队列</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/09/15/leetcode-cha-zhao/"><i class="fa-fw fa fa-tags"></i><span> 查找</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/12/06/leetcode-er-fen-cha-zhao/"><i class="fa-fw fa fa-tags"></i><span> 二分查找</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/11/06/leetcode-er-cha-shu/"><i class="fa-fw fa fa-tags"></i><span> 二叉树</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou/"><i class="fa-fw fa fa-tags"></i><span> 滑动窗口</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/"><i class="fa-fw fa fa-tags"></i><span> 动态规划</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/11/29/leetcode-bei-bao-wen-ti/"><i class="fa-fw fa fa-tags"></i><span> 背包问题</span></a></li><li><a class="site-page" href="http://imlgw.top/2019/10/10/leetcode-hui-su/"><i class="fa-fw fa fa-tags"></i><span> 回溯</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-address-book"></i><span> 大佬们</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#单点登陆系统-–CAS"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">单点登陆系统 –CAS</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-配置CAS服务端"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">1. 配置CAS服务端</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-普通的web项目集成CAS"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">2. 普通的web项目集成CAS</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-Spring项目集成CAS和Spring-security"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">3. Spring项目集成CAS和Spring-security</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-测试"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">4. 测试</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#单点登陆系统-–CAS"><span class="toc-number">1.</span> <span class="toc-text">单点登陆系统 –CAS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-配置CAS服务端"><span class="toc-number">1.1.</span> <span class="toc-text">1. 配置CAS服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-普通的web项目集成CAS"><span class="toc-number">1.2.</span> <span class="toc-text">2. 普通的web项目集成CAS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Spring项目集成CAS和Spring-security"><span class="toc-number">1.3.</span> <span class="toc-text">3. Spring项目集成CAS和Spring-security</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-测试"><span class="toc-number">1.4.</span> <span class="toc-text">4. 测试</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(http://static.imlgw.top/image/featureimages/10.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">CAS单点登陆系统Demo</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2018-11-17<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2019-12-23</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Web/">Web</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.3k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 9 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h2 id="单点登陆系统-–CAS"><a href="#单点登陆系统-–CAS" class="headerlink" title="单点登陆系统 –CAS"></a>单点登陆系统 –CAS</h2><ul>
<li>关于CAS的介绍网上都有。这里主要记录如何使用，如何配置和集成一些框架。</li>
<li>CAS架构图<br><img alt="OSS" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/CAS.PNG" src="/img/loading.gif" class="lazyload"><br>CAS 的 SSO 实现方式可简化理解为： 1 个 Cookie 和 N 个 Session 。 CAS Server 创建 cookie，在所有应用认证时使用，各应用通过创建各自的 Session 来标识用户是否已登录。<br>用 户在一个应用验证通过后，以后用户在同一浏览器里访问此应用时，客户端应用中的过滤器会在 session 里读取到用户信息，所以就不会去 CAS Server 认证。如果在此浏览器里访问别的 web 应用时，客户端应用中的过滤器在 session 里读取不到用户信息，就会去 CAS Server 的 login 接口认证，但这时CAS Server 会读取到浏览器传来的 cookie （ TGC ），所以 CAS Server 不会要求用户去登录页面登录，只是会根据 service 参数生成一个 Ticket ，然后再和 web 应用做一个验 证 ticket 的交互而已。</li>
</ul>
<h3 id="1-配置CAS服务端"><a href="#1-配置CAS服务端" class="headerlink" title="1. 配置CAS服务端"></a>1. 配置CAS服务端</h3><p>从上面的架构图也可以大概知道CAS运作的方式,首先配置好CAS的Server端，直接将CAS的war包拷到tomcat的webapp目录下然后启动tomcat自动解压就可以了，这里我设置的tomcat的端口是8888，地址栏输入localhost:8888/cas能看到CAS的登陆界面说明部署成功</p>
<ul>
<li><p>去除https<br> CAS默认使用的是HTTPS协议，如果使用HTTPS协议需要SSL安全证书（需向特定的机构申请和购买） 。如果对安全要求不高或是在开发测试阶段，可使用HTTP协议。我们这里讲解通过修改配置，让CAS使用HTTP协议。</p>
<ul>
<li><p>修改cas的WEB-INF/deployerConfigContext.xml找到下面的配置<br><bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler" p:httpclient-ref="httpClient"><br>这里需要增加参数p:requireSecure=”false”，requireSecure属性意思为是否需要安全验证，即HTTPS，false为不采用</bean></p>
<ul>
<li><p>修改cas的/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml<br>找到下面配置<br><bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator" p:cookiesecure="true" p:cookiemaxage="-1" p:cookiename="CASTGC" p:cookiepath="/cas"></bean></p>
</li>
<li><p>参数p:cookieSecure=”true”，同理为HTTPS验证相关，TRUE为采用HTTPS验证，FALSE为不采用https验证。<br>参数p:cookieMaxAge=”-1”，是COOKIE的最大生命周期，-1为无生命周期，即只在当前打开的窗口有效，关闭或重新打开其它窗口，仍会要求验证。可以根据需要修改为大于0的数字，比如3600等，意思是在3600秒内，打开任意窗口，都不需要验证。</p>
<p>我们这里将cookieSecure改为false , cookieMaxAge 改为3600</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>修改cas的WEB-INF/spring-configuration/warnCookieGenerator.xml<br>   <bean id="warnCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator" p:cookiesecure="true" p:cookiemaxage="-1" p:cookiename="CASPRIVACY" p:cookiepath="/cas"><br>我们这里将cookieSecure改为false , cookieMaxAge 改为3600</bean></li>
</ul>
</li>
</ul>
<ul>
<li><p>配置数据源</p>
<ul>
<li><p>cas有默认的密码但是实际中肯定是要从数据库中查的，所以我们需要配置下数据源</p>
</li>
<li><p>修改cas服务端中web-inf下deployerConfigContext.xml ，添加如下配置</p>
   <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><bean id="<span" class="string">"dataSource"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> <br><span class="line"> p:driverClass=<span class="string">"com.mysql.jdbc.Driver"</span></span><br><span class="line"> p:jdbcUrl=<span class="string">"jdbc:mysql://127.0.0.1:3306/pinyougoudb?characterEncoding=utf8"</span></span><br><span class="line"> p:user=<span class="string">"root"</span></span><br><span class="line"> p:password=<span class="string">"123456"</span> /></span><br><span class="line"><bean id="<span" class="string">"passwordEncoder"</bean></span><br><span class="line"><span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.authentication.handler.DefaultPasswordEncoder"</span> </span><br><span class="line"> c:encodingAlgorithm=<span class="string">"MD5"</span></span><br><span class="line"> p:characterEncoding=<span class="string">"UTF-8"</span> /></span><br><span class="line"><bean id="<span" class="string">"dbAuthHandler"</bean></span> <br><span class="line"> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"</span></span><br><span class="line"> p:dataSource-ref=<span class="string">"dataSource"</span></span><br><span class="line"> p:sql=<span class="string">"select password from tb_user where username = ?"</span></span><br><span class="line"> p:passwordEncoder-ref=<span class="string">"passwordEncoder"</span>/></span><br></pre></td></tr></tbody></table></figure></div>
<ul>
<li>然后在配置文件开始部分找到如下配置</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"> <bean id="<span" class="string">"authenticationManager"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.authentication.PolicyBasedAuthenticationManager"</span>><br><span class="line">        <constructor-arg></constructor-arg></span><br><span class="line">            <map>               </map></span><br><span class="line">                <entry key-ref="<span" class="string">"proxyAuthenticationHandler"</entry></span> value-ref=<span class="string">"proxyPrincipalResolver"</span> /><br><span class="line">                <entry key-ref="<span" class="string">"primaryAuthenticationHandler"</entry></span> value-ref=<span class="string">"primaryPrincipalResolver"</span> /><br><span class="line">            </span><br><span class="line">              </span><br><span class="line">        <property name="<span" class="string">"authenticationPolicy"</property></span>><br><span class="line">            <bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"org.jasig.cas.authentication.AnyAuthenticationPolicy"</span> /><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>其中 <entry key-ref="primaryAuthenticationHandler" value-ref="primaryPrincipalResolver">一句是使用固定的用户名和密码，我们在下面可以看到这两个bean ,如果我们使用数据库认证用户名和密码，需要将这句注释掉。<br>添加下面这一句配置</entry></p>
<entry key-ref="dbAuthHandler" value-ref="primaryPrincipalResolver">
- 将三个jar包加入到cas的lib目录下
![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/casjar.PNG)
第一个和第三个大家应该很熟悉了，中间的那个是cas对jdbc的支持包




</entry></li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-普通的web项目集成CAS"><a href="#2-普通的web项目集成CAS" class="headerlink" title="2. 普通的web项目集成CAS"></a>2. 普通的web项目集成CAS</h3><p> 普通的web项目也就是没有使用Spring之类的框架而采用web.xml配置的普通项目</p>
<ul>
<li>2.1 为了方便我这里采用maven配置，先添加相应的依赖</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!-- cas --></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>org.jasig.cas.client</groupid></span><br><span class="line">    <artifactid>cas-client-core</artifactid></span><br><span class="line">    <version>3.3.3</version></span><br><span class="line"></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>javax.servlet</groupid></span><br><span class="line">    <artifactid>servlet-api</artifactid></span><br><span class="line">    <version>2.5</version></span><br><span class="line">    <scope>provided</scope></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>一个是cas客户端的核心包，一个是servlet的包，因为后面会写一些jsp<br>然后添加tomcat插件我设置的端口为9002</p>
<ul>
<li><p>2.2 因为是普通的web项目所以配置的方式主要是通过web.xml来配置，直接上配置</p>
  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><!--?xml version=<span class="string"-->"1.0"</span> encoding=<span class="string">"UTF-8"</span>?><br><span class="line"><web-app xmlns:xsi="<span" class="string">"http://www.w3.org/2001/XMLSchema-instance"</web-app></span><br><span class="line">         xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span><br><span class="line">         version=<span class="string">"2.5"</span>></span><br><span class="line">    <!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置 --></span><br><span class="line">    <listener></listener></span><br><span class="line">        <listener-<span class="class"><span class="keyword">class</span>><span class="title">org</span>.<span class="title">jasig</span>.<span class="title">cas</span>.<span class="title">client</span>.<span class="title">session</span>.<span class="title">SingleSignOutHttpSessionListener</span><!--<span class="title"-->listener</listener-<span></span>-<span class="title">class</span>><br><span class="line"><span class="class">    <!--<span class="title"-->listener</span>></span><br><span class="line"><span class="class">    <!-- 该过滤器用于实现单点登出功能，可选配置。 --></span></span><br><span class="line"><span class="class">    <<span class="title">filter</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">CAS</span> <span class="title">Single</span> <span class="title">Sign</span> <span class="title">Out</span> <span class="title">Filter</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">class</span>><span class="title">org</span>.<span class="title">jasig</span>.<span class="title">cas</span>.<span class="title">client</span>.<span class="title">session</span>.<span class="title">SingleSignOutFilter</span><!--<span class="title"-->filter</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>></span><br><span class="line"><span class="class">    <<span class="title">filter</span>-<span class="title">mapping</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">CAS</span> <span class="title">Single</span> <span class="title">Sign</span> <span class="title">Out</span> <span class="title">Filter</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">url</span>-<span class="title">pattern</span>>/* <!--<span class="title"-->url</span>-<span class="title">pattern</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>-<span class="title">mapping</span>></span><br><span class="line"><span class="class">    <!-- 该过滤器负责用户的认证工作，必须启用它 --></span></span><br><span class="line"><span class="class">    <<span class="title">filter</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">CASFilter</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">class</span>><span class="title">org</span>.<span class="title">jasig</span>.<span class="title">cas</span>.<span class="title">client</span>.<span class="title">authentication</span>.<span class="title">AuthenticationFilter</span><!--<span class="title"-->filter</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">        <<span class="title">init</span>-<span class="title">param</span>></span></span><br><span class="line"><span class="class">            <<span class="title">param</span>-<span class="title">name</span>><span class="title">casServerLoginUrl</span><!--<span class="title"-->param</span>-<span class="title">name</span>></span><br><span class="line">            <param-value>http://localhost:8888/cas/login</param-value></span><br><span class="line">            <!--这里的server是服务端的IP --></span><br><span class="line">        </span><br><span class="line">        <init-param></init-param></span><br><span class="line">            <param-name>serverName</param-name></span><br><span class="line">            <param-value>http:<span class="comment">//localhost:9002</span></param-value></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <filter-mapping></filter-mapping></span><br><span class="line">        <filter-name>CASFilter</filter-name></span><br><span class="line">        <url-pattern><span class="comment">/*</span></url-pattern></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <!-- 该过滤器负责对Ticket的校验工作，必须启用它 --></span></span><br><span class="line"><span class="comment">    <filter></filter></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Validation Filter</filter-name></span></span><br><span class="line"><span class="comment">        <filter-class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class></span></span><br><span class="line"><span class="comment">        <init-param></init-param></span></span><br><span class="line"><span class="comment">            <param-name>casServerUrlPrefix</param-name></span></span><br><span class="line"><span class="comment">            <param-value>http://localhost:8888/cas</param-value></span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        <init-param></init-param></span></span><br><span class="line"><span class="comment">            <param-name>serverName</param-name></span></span><br><span class="line"><span class="comment">            <param-value>http://localhost:9002</param-value></span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <filter-mapping></filter-mapping></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Validation Filter</filter-name></span></span><br><span class="line"><span class="comment">        <url-pattern>/*</url-pattern></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --></span></span><br><span class="line"><span class="comment">    <filter></filter></span></span><br><span class="line"><span class="comment">        <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name></span></span><br><span class="line"><span class="comment">        <filter-class></filter-class></span></span><br><span class="line"><span class="comment">            org.jasig.cas.client.util.*</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <filter-mapping></filter-mapping></span></span><br><span class="line"><span class="comment">        <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name></span></span><br><span class="line"><span class="comment">        <url-pattern>/*</url-pattern></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --></span></span><br><span class="line"><span class="comment">    <filter></filter></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Assertion Thread Local Filter</filter-name></span></span><br><span class="line"><span class="comment">        <filter-class>org.jasig.cas.client.util.AssertionThreadLocalFilter</filter-class></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <filter-mapping></filter-mapping></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Assertion Thread Local Filter</filter-name></span></span><br><span class="line"><span class="comment">        <url-pattern>/*</url-pattern></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li>用户认证过滤器(必选)<strong>AuthenticationFilter</strong>在上面的配置中需要两个参数一个是casServerLoginUrl顾名思义就是CASserver登陆的地址，比如我的是<a href="http://localhost:8888/cas/login" target="_blank" rel="noopener">http://localhost:8888/cas/login</a> ，第二个参数是<strong>serverName</strong> ,因为登陆成功后还是要返回你当前的应用所以需要将你当前的应用的地址传递给CASserver比如我的当前应用 <a href="http://localhost:9002/" target="_blank" rel="noopener">http://localhost:9002/</a></li>
<li>Ticket的校验过滤器(必选)<strong>Cas20ProxyReceivingTicketValidationFilter</strong> 与上面的过滤器类似也需要那两个参数，                              配置了这两个过滤器CAS就能正常运行了</li>
<li>单点登出过滤器 <strong>SingleSignOutFilter</strong>，顾名思义就是用于单点登出  </li>
<li>另外还有两个过滤器都是为了获取登陆名配置的过滤器，配置一个就行。<br>#</li>
</ul>
</li>
<li><p>2.3 编写index.jsp(tomcat默认打开的页面)</p>
  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span></span><br><span class="line">         pageEncoding=<span class="string">"utf-8"</span>%></span><br><span class="line">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <meta http-equiv="<span" class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span>><br><span class="line">    <title>一品优购</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 采用web.xml配置的普通的web模块</span><br><span class="line"><%=request.getRemoteUser()%></span><br><span class="line"> <a href="http://localhost:8888/cas/logout?service=http://www.imlgw.top" target="_blank" rel="noopener">退出登录</a>></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>   如果想让cas退出后跳转到指定的页面而不是CAS默认的页面也需要修改配置<br>   修改cas系统的配置文件cas-servlet.xml<br>   <bean id="logoutAction" class="org.jasig.cas.web.flow.LogoutAction" p:servicesmanager-ref="servicesManager" p:followserviceredirects="${cas.logout.followServiceRedirects:true}"><br>  将cas.logout.followServiceRedirects改为true后，可以在退出时跳转页面到目标页面<br> 然后就可以启动cas和你的应用来测试了。</bean></p>
</li>
<li><p>2.4 服务端界面改造<br> 上面测试成功，但是真实的情况肯定不会用cas默认的那个页面做登陆需要改成你自己的登陆界面，然后你当前应用的登陆页面就没用了。</p>
  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><%@ page pageEncoding=<span class="string">"UTF-8"</span> %></span><br><span class="line"><%@ page contentType=<span class="string">"text/html; charset=UTF-8"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"spring"</span> uri=<span class="string">"http://www.springframework.org/tags"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"form"</span> uri=<span class="string">"http://www.springframework.org/tags/form"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">		<meta charset="<span" class="string">"UTF-8"</span> /><br><span class="line">		<title>Login</title></span><br><span class="line">		<link rel="<span" class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">'bs/css/bootstrap.min.css'</span> /><br><span class="line">		<script type="text/javascript" src="js/jquery.min.js"></script></span><br><span class="line">		<script type="text/javascript" src="bs/js/bootstrap.min.js"></script></span><br><span class="line">		<style></span><br><span class="line">			img {</span><br><span class="line">				height: <span class="number">200</span>px;</span><br><span class="line">				border-radius: <span class="number">200</span>px;</span><br><span class="line">			}</span><br><span class="line">			.panel-title{</span><br><span class="line">				text-align: center;</span><br><span class="line">			}</span><br><span class="line">			.login {</span><br><span class="line">				width: <span class="number">500</span>px;</span><br><span class="line">				height: <span class="number">400</span>px;</span><br><span class="line">				position: absolute;</span><br><span class="line">				top: <span class="number">20</span>%;</span><br><span class="line">				left: <span class="number">50</span>%;</span><br><span class="line">				margin-left: -<span class="number">250</span>px;</span><br><span class="line">			}</span><br><span class="line">			.sub{</span><br><span class="line">				text-align: center;</span><br><span class="line">			}</span><br><span class="line"></span><br><span class="line">		</style></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">		<div <span class="class"><span class="keyword">class</span>=<span class="string">"panel panel-primary login"</span>><br><span class="line">			<div <span class="class"><span class="keyword">class</span>=<span class="string">"panel-heading"</span>><br><span class="line">				<div <span class="class"><span class="keyword">class</span>=<span class="string">"panel-title"</span>><br><span class="line">					<img class="string lazyload" data-src="<span" src="/img/loading.gif">"images/login.jpg"</span> /><br><span class="line">				</span></div></span><br><span class="line">			</span></div></span><br><span class="line">			<div <span class="class"><span class="keyword">class</span>=<span class="string">"panel-body"</span>><br><span class="line">				<!--自定义的登陆界面修改 <span class="number">1</span> --></span><br><span class="line">				<form:form method="<span" class="string">"post"</form:form></span> id=<span class="string">"fm1"</span> commandName=<span class="string">"${commandName}"</span> htmlEscape=<span class="string">"true"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"sui-form"</span>><br><span class="line">				</span><br><span class="line">					<div <span class="class"><span class="keyword">class</span>=<span class="string">"form-group"</span>><br><span class="line">						<div <span class="class"><span class="keyword">class</span>=<span class="string">"input-group"</span>><br><span class="line">							<span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-user"></span></span></span><br><span class="line">							<!--自定义的登陆界面修改 <span class="number">2</span> --></span><br><span class="line">							<form:input <span class="class"><span class="keyword">class</span></form:input></span>=<span class="string">"form-control"</span> aria-describedby=<span class="string">"basic-addon1"</span> placeholder=<span class="string">"Username"</span>  id=<span class="string">"username"</span> size=<span class="string">"25"</span> tabindex=<span class="string">"1"</span> accesskey=<span class="string">"${userNameAccessKey}"</span> path=<span class="string">"username"</span> autocomplete=<span class="string">"off"</span> htmlEscape=<span class="string">"true"</span> /><br><span class="line">						</span></div></span><br><span class="line">					</span></div></span><br><span class="line">					<div <span class="class"><span class="keyword">class</span>=<span class="string">"form-group"</span>><br><span class="line">						<div <span class="class"><span class="keyword">class</span>=<span class="string">"input-group"</span>><br><span class="line">							<span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-lock"></span></span></span><br><span class="line">							<!--自定义的登陆界面修改 <span class="number">3</span> --></span><br><span class="line">							<form:password <span class="class"><span class="keyword">class</span></form:password></span>=<span class="string">"form-control"</span> placeholder=<span class="string">"password"</span> aria-describedby=<span class="string">"basic-addon1"</span> id=<span class="string">"password"</span> size=<span class="string">"25"</span> tabindex=<span class="string">"2"</span> path=<span class="string">"password"</span>  accesskey=<span class="string">"${passwordAccessKey}"</span> htmlEscape=<span class="string">"true"</span> autocomplete=<span class="string">"off"</span> /><br><span class="line">						</span></div></span><br><span class="line">					</span></div></span><br><span class="line">					<div <span class="class"><span class="keyword">class</span>=<span class="string">"form-group sub"</span>><br><span class="line">						<!--自定义的登陆界面修改 <span class="number">4</span> 登陆框 --></span><br><span class="line">						<input type="<span" class="string">"hidden"</span> name=<span class="string">"lt"</span> value=<span class="string">"${loginTicket}"</span> /><br><span class="line">     	 				<input type="<span" class="string">"hidden"</span> name=<span class="string">"execution"</span> value=<span class="string">"${flowExecutionKey}"</span> /><br><span class="line">      					<input type="<span" class="string">"hidden"</span> name=<span class="string">"_eventId"</span> value=<span class="string">"submit"</span> /><br><span class="line">      					<input <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn btn-primary btn-lg"</span> name=<span class="string">"submit"</span> accesskey=<span class="string">"l"</span> value=<span class="string">"登陆"</span> type=<span class="string">"submit"</span> /><br><span class="line">      					<!--自定义的登陆界面修改 <span class="number">4</span> 错误提示框 --></span><br><span class="line">      					<form:errors path="<span" class="string">"*"</form:errors></span> id=<span class="string">"msg"</span> cssClass=<span class="string">"errors"</span> element=<span class="string">"div"</span> htmlEscape=<span class="string">"false"</span> /><br><span class="line">					</span></div></span><br><span class="line">				</span><br><span class="line">			</span></div></span><br><span class="line">		</span></div></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<p>  可以直接将登陆的页面拷过来然后加上指令再根据cas的登陆页面稍加修改就可以了</p>
</li>
</ul>
<hr>
<h3 id="3-Spring项目集成CAS和Spring-security"><a href="#3-Spring项目集成CAS和Spring-security" class="headerlink" title="3. Spring项目集成CAS和Spring-security"></a>3. Spring项目集成CAS和Spring-security</h3><ul>
<li><p>pom依赖</p>
  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><properties></properties></span><br><span class="line">        <spring.version>4.2.0.RELEASE</spring.version></span><br><span class="line">    </span><br><span class="line">    <dependencies></dependencies></span><br><span class="line">        <!-- Spring --></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-context</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-beans</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-webmvc</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-jdbc</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-aspects</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-jms</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-context-support</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <!--spring-security--></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework.security</groupid></span><br><span class="line">            <artifactid>spring-security-web</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework.security</groupid></span><br><span class="line">            <artifactid>spring-security-config</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>javax.servlet</groupid></span><br><span class="line">            <artifactid>javax.servlet-api</artifactid></span><br><span class="line">            <version>3.1.0</version></span><br><span class="line">            <scope>provided</scope></span><br><span class="line">        </span><br><span class="line">        <!--集成包--></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework.security</groupid></span><br><span class="line">            <artifactid>spring-security-cas</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <!--cas--></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.jasig.cas.client</groupid></span><br><span class="line">            <artifactid>cas-client-core</artifactid></span><br><span class="line">            <version>3.3.3</version></span><br><span class="line">            <exclusions></exclusions></span><br><span class="line">                <exclusion></exclusion></span><br><span class="line">                    <groupid>org.slf4j</groupid></span><br><span class="line">                    <artifactid>log4j-over-slf4j</artifactid></span><br><span class="line">                </span><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure></div>
<p>  添加tomcat插件指定端口为9001</p>
</li>
<li><p>web.xml配置</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><!--?xml version=<span class="string"-->"1.0"</span> encoding=<span class="string">"UTF-8"</span>?><br><span class="line"><web-app xmlns:xsi="<span" class="string">"http://www.w3.org/2001/XMLSchema-instance"</web-app></span><br><span class="line">         xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span><br><span class="line">         version=<span class="string">"2.5"</span>></span><br><span class="line"></span><br><span class="line">    <context-param></context-param></span><br><span class="line">        <param-name>contextConfigLocation</param-name></span><br><span class="line">        <param-value>classpath:spring/spring-*.xml</param-value></span><br><span class="line">    </span><br><span class="line">    <listener></listener></span><br><span class="line">        <listener-<span class="class"><span class="keyword">class</span>></listener-<span></span><br><span class="line"><span class="class">            <span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">context</span>.<span class="title">ContextLoaderListener</span></span></span><br><span class="line"><span class="class">        <!--<span class="title"-->listener</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->listener</span>></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <<span class="title">filter</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">springSecurityFilterChain</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">class</span>><span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">filter</span>.<span class="title">DelegatingFilterProxy</span><!--<span class="title"-->filter</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>></span><br><span class="line"><span class="class">    <<span class="title">filter</span>-<span class="title">mapping</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">springSecurityFilterChain</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">url</span>-<span class="title">pattern</span>>/*<!--<span class="title"-->url</span>-<span class="title">pattern</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>-<span class="title">mapping</span>></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><!--<span class="title"-->web</span>-<span class="title">app</span>></span><br></pre></td></tr></tbody></table></figure></div>
<p>主要配置Spring容器和Spring-security的过滤器</p>
</li>
</ul>
<ul>
<li>spring-security.xml配置<br>其实就是把之前配置在web.xml里面的过滤器采用Spring的方式配置出来</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!--?xml version=<span class="string"-->"1.0"</span> encoding=<span class="string">"UTF-8"</span>?><br><span class="line"><beans:beans xmlns="<span" class="string">"http://www.springframework.org/schema/security"</beans:beans></span><br><span class="line">             xmlns:beans=<span class="string">"http://www.springframework.org/schema/beans"</span> xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">             xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">						http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd"</span>></span><br><span class="line"></span><br><span class="line">    <http pattern="/out.html" security="none"></http></span><br><span class="line">    <!--   entry-point-ref  入口点引用 因为登陆交给cas或者其他的登陆系统,就不会在本系统做登陆需要指定登陆点--></span><br><span class="line">    <http use-expressions="<span" class="string">"false"</http></span> entry-point-ref=<span class="string">"casProcessingFilterEntryPoint"</span>><br><span class="line">        <intercept-url pattern="<span" class="string">"/**"</intercept-url></span> access=<span class="string">"ROLE_USER"</span>/><br><span class="line">        <csrf disabled="<span" class="string">"true"</csrf></span>/><br><span class="line">        <!-- custom-filter为过滤器， position 表示将过滤器放在指定的位置上，before表示放在指定位置之前  ，after表示放在指定的位置之后  --></span><br><span class="line">        <custom-filter ref="<span" class="string">"casAuthenticationFilter"</custom-filter></span>  position=<span class="string">"CAS_FILTER"</span> /><br><span class="line">        <custom-filter ref="<span" class="string">"requestSingleLogoutFilter"</custom-filter></span> before=<span class="string">"LOGOUT_FILTER"</span>/><br><span class="line">        <custom-filter ref="<span" class="string">"singleLogoutFilter"</custom-filter></span> before=<span class="string">"CAS_FILTER"</span>/><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <!-- CAS入口点 开始 --></span><br><span class="line">    <beans:bean id="<span" class="string">"casProcessingFilterEntryPoint"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.web.CasAuthenticationEntryPoint"</span>><br><span class="line">        <!-- 单点登录服务器登录URL --></span><br><span class="line">        <beans:property name="<span" class="string">"loginUrl"</beans:property></span> value=<span class="string">"http://localhost:8888/cas/login"</span>/><br><span class="line">        <beans:property name="<span" class="string">"serviceProperties"</beans:property></span> ref=<span class="string">"serviceProperties"</span>/><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <beans:bean id="<span" class="string">"serviceProperties"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.ServiceProperties"</span>><br><span class="line">        <!--service 配置自身工程的根地址+/login/cas   --></span><br><span class="line">        <beans:property name="<span" class="string">"service"</beans:property></span> value=<span class="string">"http://localhost:9001/login/cas"</span>/><br><span class="line">    </span><br><span class="line">    <!-- CAS入口点 结束 --></span><br><span class="line">    <!-- 认证过滤器 开始 --></span><br><span class="line">    <beans:bean id="<span" class="string">"casAuthenticationFilter"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.web.CasAuthenticationFilter"</span>><br><span class="line">        <beans:property name="<span" class="string">"authenticationManager"</beans:property></span> ref=<span class="string">"authenticationManager"</span>/><br><span class="line">    </span><br><span class="line">    <!-- 认证管理器 --></span><br><span class="line">    <authentication-manager alias="<span" class="string">"authenticationManager"</authentication-manager></span>><br><span class="line">        <authentication-provider ref="<span" class="string">"casAuthenticationProvider"</authentication-provider></span>><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <!-- 认证提供者 --></span><br><span class="line">    <beans:bean id="<span" class="string">"casAuthenticationProvider"</beans:bean></span>     <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.authentication.CasAuthenticationProvider"</span>><br><span class="line">        <beans:property name="<span" class="string">"authenticationUserDetailsService"</beans:property></span>><br><span class="line">            <beans:bean <span class="class"><span class="keyword">class</span></beans:bean></span>=<span class="string">"org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper"</span>><br><span class="line">                <beans:constructor-arg ref="<span" class="string">"userDetailsService"</beans:constructor-arg></span> /><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">        <beans:property name="<span" class="string">"serviceProperties"</beans:property></span> ref=<span class="string">"serviceProperties"</span>/><br><span class="line">        <!-- ticketValidator 为票据验证器 --></span><br><span class="line">        <beans:property name="<span" class="string">"ticketValidator"</beans:property></span>><br><span class="line">            <beans:bean <span class="class"><span class="keyword">class</span></beans:bean></span>=<span class="string">"org.jasig.cas.client.validation.Cas20ServiceTicketValidator"</span>><br><span class="line">                <beans:constructor-arg index="<span" class="string">"0"</beans:constructor-arg></span> value=<span class="string">"http://localhost:8888/cas"</span>/><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">        <beans:property name="<span" class="string">"key"</beans:property></span> value=<span class="string">"an_id_for_this_auth_provider_only"</span>/><br><span class="line">    </span><br><span class="line">    <!-- 认证类 --></span><br><span class="line">    <beans:bean id="<span" class="string">"userDetailsService"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"top.imlgw.demo.UserDetailServiceImpl"</span>/><br><span class="line"></span><br><span class="line">    <!-- 认证过滤器 结束 --></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <!-- 单点登出  开始  --></span><br><span class="line">    <beans:bean id="<span" class="string">"singleLogoutFilter"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.client.session.SingleSignOutFilter"</span>/><br><span class="line">    <!--关联两个地址，相当于封装了前面的地址--></span><br><span class="line">    <beans:bean id="<span" class="string">"requestSingleLogoutFilter"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.web.authentication.logout.LogoutFilter"</span>><br><span class="line">        <beans:constructor-arg value="<span" class="string">"http://localhost:8888/cas/logout?service=http://localhost:9001/out.html"</beans:constructor-arg></span>/><br><span class="line">        <beans:constructor-arg></beans:constructor-arg></span><br><span class="line">            <beans:bean <span class="class"><span class="keyword">class</span></beans:bean></span>=<span class="string">"org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler"</span>/><br><span class="line">        </span><br><span class="line">        <beans:property name="<span" class="string">"filterProcessesUrl"</beans:property></span> value=<span class="string">"/logout/cas"</span>/><br><span class="line">    </span><br><span class="line">    <!-- 单点登出  结束 --></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li><p>userDetailsService编写<br>这是一个认证类是属于Spring-security的，如果不使用CAS那么这个类就是用来验证密码是否正确是否放行的。但是整合了CAS后就不用在里面做认证了，只是为了返回后面的角色集合。</p>
  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.demo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDetailServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>{</span><br><span class="line">        System.out.println(<span class="string">"经过认证类"</span>);</span><br><span class="line">        List<grantedauthority> authorities=<span class="keyword">new</span> ArrayList();</grantedauthority></span><br><span class="line">        <span class="comment">//最开始把这里的role写错了，然后cas登陆成功后也一直被403 forbid，因为SpringSecurity认证没通过，一直没放行</span></span><br><span class="line">        authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"ROLE_USER"</span>));</span><br><span class="line">        <span class="comment">//不通过本项目做登陆 所以密码无所谓，在执行这个方法的时候就已经登陆成功了</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(username,<span class="string">""</span>,authorities);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<hr>
<h3 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h3><p>启动搭建好的两个服务器，和casServer，然后测试在一个应用登陆后另一个能否进入index页面 …..</p>
<hr>
<p>SpringBoot集成CAS和Spring-security的后面再补充，因为SpringBoot还不太熟悉。</p>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">imlgw</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://imlgw.top/2018/11/17/cas-dan-dian-deng-lu-xi-tong-ru-men/">http://imlgw.top/2018/11/17/cas-dan-dian-deng-lu-xi-tong-ru-men/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://imlgw.top">iMlGw0</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CAS/">CAS    </a><a class="post-meta__tags" href="/tags/SSO/">SSO    </a></div><div class="post_share"><div class="social-share" data-image="http://static.imlgw.top/image/featureimages/10.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.png" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2018/11/26/springsecurity-pei-zhi-de-ji-ge-xiao-wen-ti/"><img class="prev_cover lazyload" data-src="http://static.imlgw.top/image/featureimages/6.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Spring-Security遇到的小问题</span></div></a></div><div class="next-post pull_right"><a href="/2018/10/31/yi-dao-leetcode-yin-fa-de-can-an/"><img class="next_cover lazyload" data-src="http://static.imlgw.top/image/featureimages/3.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>一道LeetCode引发的惨案</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = true == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'MkcXmeDvktRNBDBrVqb9KYPH-MdYXbMMI',
  appKey:'swDnb5a9u9Ksp2Rwkdm7Qulh',
  placeholder:'留下邮箱才能收到及时收到回复~~',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(http://static.imlgw.top/image/featureimages/10.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2019 By imlgw</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://beian.miit.gov.cn/publish/query/indexFirst.action" target="_blank" rel="noopener"><span>鄂ICP备18011208号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">簡</a></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="undefined" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script src="https://cdn.jsdelivr.net/npm/activate-power-mode/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true; 
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json"},"display":{"superSample":2,"width":160,"height":320,"position":"right","hOffset":0,"vOffset":-70},"mobile":{"show":false,"scale":0.2},"log":false});</script></body></html>