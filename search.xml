<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¸¸ç”¨çš„ä¸€äº›å·¥å…·å’Œç½‘ç«™</title>
      <link href="/2019/12/23/wo-chang-yong-de-yi-xie-gong-ju-he-wang-zhan/"/>
      <url>/2019/12/23/wo-chang-yong-de-yi-xie-gong-ju-he-wang-zhan/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="æ•´ç†ä¸‹æˆ‘å¸¸ç”¨çš„ä¸€äº›å·¥å…·å’Œç½‘ç«™"><a href="#æ•´ç†ä¸‹æˆ‘å¸¸ç”¨çš„ä¸€äº›å·¥å…·å’Œç½‘ç«™" class="headerlink" title="æ•´ç†ä¸‹æˆ‘å¸¸ç”¨çš„ä¸€äº›å·¥å…·å’Œç½‘ç«™"></a>æ•´ç†ä¸‹æˆ‘å¸¸ç”¨çš„ä¸€äº›å·¥å…·å’Œç½‘ç«™</h1><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><h3 id="PDFread"><a href="#PDFread" class="headerlink" title="PDFread"></a>PDFread</h3><p>ä¸€ä¸ªpdfé˜…è¯»å™¨ï¼Œç»¿è‰²è½¯ä»¶ä½“ç§¯å¾ˆå°åªæœ‰10Mï¼Œå¾ˆä¹…ä¹‹å‰åœ¨ä¸€ä¸ªå…¬å…±å·ä¸Šçœ‹è§çš„ï¼Œé“¾æ¥ï¼š<a href="https://pan.baidu.com/s/15MSlABLZkJHChako1GEGdA" target="_blank" rel="noopener">https://pan.baidu.com/s/15MSlABLZkJHChako1GEGdA</a><br>æå–ç ï¼š7a5i </p><h3 id="BandZip"><a href="#BandZip" class="headerlink" title="BandZip"></a>BandZip</h3><p>è§£å‹ç¼©çš„è½¯ä»¶ï¼Œæ¯”æŸ<code>æ•°å­—</code>å‹ç¼©è½¯ä»¶å¥½ç”¨ï¼Œæ¯”<code>7z</code>åŠŸèƒ½å¤šè€Œä¸”å¥½çœ‹(7zä¹Ÿä¸é”™)ï¼ŒæŒºè‰¯å¿ƒçš„ï¼Œè‡³å°‘æ²¡å¹¿å‘Š <a href="https://www.bandisoft.com/bandizip/" target="_blank" rel="noopener">å®˜ç½‘ä¸‹è½½åœ°å€</a>(å¯èƒ½è¢«Q)</p><h3 id="MPic"><a href="#MPic" class="headerlink" title="MPic"></a>MPic</h3><p> å›¾åºŠç¥å™¨ï¼Œè´¼æ–¹ä¾¿ï¼Œä¼šæ£€æµ‹å‰ªåˆ‡æ¿é‡Œçš„å›¾ç‰‡åŒ…æ‹¬QQæˆªå›¾ï¼Œè‡ªåŠ¨ä¸Šä¼ ä¸€é”®è·å–å¤–é“¾è´¼çˆ½ï¼Œä¸è¿‡<code>å¯æƒœ</code>åªèƒ½é…åˆä¸ƒç‰›äº‘ã€‚<a href="http://mpic.lzhaofu.cn/" target="_blank" rel="noopener">å®˜ç½‘åœ°å€</a></p><h3 id="Everything"><a href="#Everything" class="headerlink" title="Everything"></a>Everything</h3><p>æ–‡ä»¶æ£€ç´¢ç¥å™¨ï¼Œé€Ÿåº¦å¾ˆå¿«ä½“ç§¯å¾ˆå°ã€‚<a href="https://www.voidtools.com/zh-cn/" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p><h3 id="FSCaptrue"><a href="#FSCaptrue" class="headerlink" title="FSCaptrue"></a>FSCaptrue</h3><p> æˆªå›¾å·¥å…·ï¼Œæˆªé•¿å±å¾ˆæ–¹ä¾¿ï¼Œä½“ç§¯å¾ˆå°ã€‚<a href="https://www.appcgn.com/faststone-capture.html" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p><h3 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h3><p> ä¹Ÿæ˜¯æˆ‘ç°åœ¨ç¼–è¾‘è¿™ç¯‡æ–‡ç« ç”¨çš„ç¼–è¾‘å™¨ï¼Œæˆ‘ä¹Ÿæ¢äº†å¾ˆå¤šçš„<code>markdown</code>ç¼–è¾‘å™¨ï¼Œæœ€å¼€å§‹çš„<em>Yu writer</em>(ä¸€ç›´æ²¡æ›´æ–°ï¼ŒbugæŒºå¤šï¼Œæ›´æ–°åæ”¶è´¹äº†)ï¼Œç„¶å <em>markeditor</em>(è¿™ä¸ªè¿˜å¯ä»¥ï¼Œä½†æ˜¯åœ¨winä¸Šç•Œé¢æˆ‘æœ‰ç‚¹çœ‹ä¸ä¹ æƒ¯ã€‚ã€‚2.0ä¸æ”¯æŒwin,è€Œä¸”æ—¶ä¸æ—¶å¼¹çª—æˆæƒ)ï¼Œä¸­é—´è¿˜è¯•è¿‡å¾ˆå¤šåƒä»€ä¹ˆå°ä¹¦åŒ ï¼Œmarkpadï¼Œéƒ½æ˜¯è£…å®Œå°±å¸äº†ã€‚ã€‚ã€‚ç°åœ¨æ¢åˆ°Typora(ä¹‹å‰ä¹Ÿè¯•è¿‡)è¶Šç”¨è¶Šå–œæ¬¢ã€‚</p><h3 id="CCleaner"><a href="#CCleaner" class="headerlink" title="CCleaner"></a>CCleaner</h3><p>åƒåœ¾æ¸…ç†è½¯ä»¶ï¼Œæ¸…æ³¨å†Œè¡¨è´¼èˆ’æœæ“ä½œæ¯”è¾ƒç®€å•ï¼Œæ‹’ç»è¾£é¸¡è½¯ä»¶æ®‹ç•™ï¼ˆä¹Ÿæ˜¯ç»¿è½¯ï¼‰ã€‚é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1TrOYF2893FYHKjTlQbFykA" target="_blank" rel="noopener">https://pan.baidu.com/s/1TrOYF2893FYHKjTlQbFykA</a> æå–ç ï¼šql42 </p><h3 id="Dism"><a href="#Dism" class="headerlink" title="Dism++"></a>Dism++</h3><p>è·Ÿä¸Šé¢çš„ä¸€æ ·ä¹Ÿæ˜¯åƒåœ¾æ¸…ç†è½¯ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªä¸èƒ½çæğŸ˜€  <a href="https://www.chuyu.me/zh-Hans/index.html" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p><h3 id="SwitchHosts"><a href="#SwitchHosts" class="headerlink" title="SwitchHosts"></a>SwitchHosts</h3><p>å¿«é€Ÿä¿®æ”¹hostsæ–‡ä»¶ï¼Œæˆ‘ç”¨è¿™ä¸ªä¸»è¦æ˜¯åšå®¢åœ¨æœ¬åœ°è·‘çš„æ—¶å€™ï¼Œå› ä¸ºå›¾ç‰‡åŠ äº†é˜²ç›—é“¾åŠ è½½ä¸å‡ºæ¥ï¼Œç”¨è¿™ä¸ªæ”¹äº†hostsã€‚</p><h3 id="TeamViewer"><a href="#TeamViewer" class="headerlink" title="TeamViewer"></a>TeamViewer</h3><p>è¿œç¨‹å¸®äººè°ƒè¯•ï¼Œæ”¹bugçš„æ—¶å€™ç”¨åˆ°ï¼Œæ¯”QQå¥½ç”¨çš„å¤šï¼ŒQQå¾ˆå¡è€Œä¸”ä¸€äº›å…³é”®æ“ä½œä¸å…è®¸ã€‚</p><h3 id="å¤œç¥æ¨¡æ‹Ÿå™¨"><a href="#å¤œç¥æ¨¡æ‹Ÿå™¨" class="headerlink" title="å¤œç¥æ¨¡æ‹Ÿå™¨"></a>å¤œç¥æ¨¡æ‹Ÿå™¨</h3><p>PCç«¯æ¨¡æ‹Ÿå®‰å“æ‰‹æœºï¼Œå¯ä»¥ç”¨æ¥è°ƒè¯•å®‰å“ã€‚</p><h3 id="DeskGo"><a href="#DeskGo" class="headerlink" title="DeskGo :"></a>DeskGo :</h3><p><a href="https://pc.qq.com/detail/5/detail_23125.html" target="_blank" rel="noopener">è…¾è®¯æ¡Œé¢æ•´ç†</a>ï¼Œtxéš¾å¾—çš„è‰¯å¿ƒè½¯ä»¶ï¼Œæœ¬æ¥æ˜¯QQå®‰å…¨ç®¡å®¶é‡Œé¢é™„å¸¦çš„ï¼Œåæ¥è¢«å•ç‹¬æå–å‡ºæ¥äº†ï¼Œæ²¡å¹¿å‘Šï¼Œæ²¡æ†ç»‘ï¼Œå ç”¨å°ï¼ˆå‡ åMï¼‰ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190414/Ch6k6LNP3CU2.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="æ²¹çŒ´ï¼š"><a href="#æ²¹çŒ´ï¼š" class="headerlink" title="æ²¹çŒ´ï¼š"></a>æ²¹çŒ´ï¼š</h3><p><code>tampermonkey</code>è¿™ä¸ªæ˜¯è¦é…åˆæµè§ˆå™¨æ¥ä½¿ç”¨çš„(è°·æ­Œæˆ–è€…æé€Ÿ360å§)ï¼Œå¦‚æœå¯ä»¥ç§‘å­¦ä¸Šç½‘çš„è¯ç›´æ¥å¼•ç”¨å•†åŸå°±æœå¾—åˆ°</p><p><img alt="mark" data-src="http://static.imlgw.top///20190414/5ioOotVWEqJO.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å®ƒçš„éªšæ“ä½œå¯å¤ªå¤šäº†ï¼š) <a href="https://zhuanlan.zhihu.com/p/32155254" target="_blank" rel="noopener">å³è½¬biä¹</a><img alt="mark" data-src="http://static.imlgw.top///20190414/QIORRorFVAah.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>æ²¡æ³•ç§‘å­¦ä¸Šç½‘å¯ä»¥å»<a href="http://chromecj.com/web-development/2018-07/1468/download.html" target="_blank" rel="noopener">è¿™é‡Œ</a>ä¸‹è½½</p><h3 id="å¤©è‹¥OCR"><a href="#å¤©è‹¥OCR" class="headerlink" title="å¤©è‹¥OCR"></a>å¤©è‹¥OCR</h3><p>ä¹Ÿæ˜¯å¾ˆè‰¯å¿ƒçš„è½¯ä»¶ï¼Œæ²¡å¹¿å‘Šï¼Œç»¿è½¯ï¼Œä½“ç§¯å°ï¼Œ5Mï¼Œè¯†åˆ«å‡†ç¡®åº¦ä¹ŸæŒºå¥½çš„ã€‚</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/198PUMdtLU-huU5U1oN9tMw" target="_blank" rel="noopener">https://pan.baidu.com/s/198PUMdtLU-huU5U1oN9tMw</a><br>æå–ç ï¼švces </p><h3 id="å¾®è½¯è¾“å…¥æ³•"><a href="#å¾®è½¯è¾“å…¥æ³•" class="headerlink" title="å¾®è½¯è¾“å…¥æ³•"></a>å¾®è½¯è¾“å…¥æ³•</h3><p>win10å¹³å°ä¸Šæœ€å¥½çš„è¾“å…¥æ³•æ²¡æœ‰ä¹‹ä¸€ï¼ˆGoogleè¾“å…¥æ³•å¥½åƒä¹Ÿå¯ä»¥ï¼‰ï¼Œåˆ«ç”¨åƒåœ¾sgï¼Œå‰å‡ å¤©<a href="https://answers.microsoft.com/zh-hans/windows/forum/windows_10-update/systemserviceexception%E8%93%9D%E5%B1%8F/e5c0a131-a155-4cc0-a871-b6089d474313?rtAction=1553553854556" target="_blank" rel="noopener">ç¤¾åŒº</a>çœ‹åˆ°æœ‰äººæ›´æ–°win10å› ä¸ºsgå´©æºƒäº†ã€‚æµæ°“è½¯ä»¶è´¼ä»–å¦ˆéš¾å¸è½½ï¼Œç»å†è¿‡çš„äººéƒ½çŸ¥é“ã€‚æƒ³ä¸é€šä¸ºå•¥ä¸ç”¨åŸç”Ÿçš„è¾“å…¥æ³•ï¼Ÿ</p><h3 id="PotPlayer"><a href="#PotPlayer" class="headerlink" title="PotPlayer"></a>PotPlayer</h3><p>æœ€å¥½ç”¨ï¼Œæ— å¹¿å‘Šï¼Œé¡µé¢ç®€æ´ï¼Œå¼ºå¤§çš„è§£ç å™¨ï¼Œèƒ½æ’­æ”¾æ‰€æœ‰è§†é¢‘çš„æ’­æ”¾å™¨ã€‚ï¼ˆå‰èº«æ˜¯KMPlayerï¼‰å ç”¨å°ï¼Œ(å¾®è½¯è‡ªå¸¦çš„é‚£ä¸ªä¸èƒ½å€æ•°æ’­æ”¾ã€‚ã€‚ã€‚ä¸ç„¶æˆ‘ä¹Ÿä¸ä¼šç”¨è¿™ä¸ª)</p><h3 id="MobaXterm"><a href="#MobaXterm" class="headerlink" title="MobaXterm"></a>MobaXterm</h3><p>(19-5-2)ç‚’é¸¡å¥½ç”¨çš„SSHå®¢æˆ·ç«¯ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œç•Œé¢å¥½çœ‹ï¼Œä¹Ÿæ˜¯ä¸ªç»¿è½¯ï¼Œå†ä¹Ÿä¸ç”¨åˆ°å¤„æ‰¾Xshellçš„æ³¨å†Œç äº†ï¼ˆè€Œä¸”æˆ‘ä¹Ÿä¸å–œæ¬¢Xshellï¼Œæˆ‘ä¸€ç›´ç”¨çš„putty+winscpï¼Œç°åœ¨å‘ç°è¿™ä¸ªå¯ä»¥ç›´æ¥ç»“åˆputtyå’ŒsinscpğŸ‘ï¼‰</p><p><img alt="mark" data-src="http://static.imlgw.top///20190502/rKdNPEwUmstf.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="Multrin"><a href="#Multrin" class="headerlink" title="Multrin"></a>Multrin</h3><p>githubä¸Šå¶ç„¶å‘ç°çš„ä¸€ä¸ª <a href="https://github.com/sentialx/multrin" target="_blank" rel="noopener">å°é¡¹ç›®</a> ï¼Œå°†æ‰€æœ‰çš„tabèšåˆåˆ°ä¸€èµ·è®©åæä¾›ä¸€ä¸ªå¿«æ·é”®å¿«é€Ÿåˆ‡æ¢ï¼ŒæŒºä¸é”™çš„ã€‚</p><p>ç›¸æ¯”<strong>alt+tab</strong>ï¼Œè¿™ä¸ªè½¯ä»¶çš„ä¼˜åŠ¿å°±æ˜¯ä¼šè®©æ¡Œé¢æ˜¾å¾—æ›´åŠ æ•´æ´</p><h3 id="UTools"><a href="#UTools" class="headerlink" title="UTools"></a><a href="https://u.tools/" target="_blank" rel="noopener">UTools</a></h3><p>ä¹Ÿæ˜¯æŒºä¸é”™çš„ä¸€æ¬¾å·¥å…·ï¼Œä¸€å¼€å§‹æ„Ÿè§‰å ç”¨æ¯”è¾ƒå¤§ï¼Œåæ¥æƒ³æƒ³å…¶å®æ²¡å•¥å½±å“ï¼Œç„¶åç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰ä¸€ä¸ªå›¾åºŠçš„æ’ä»¶ç›¸å½“æ–¹ä¾¿å•Šï¼</p><h3 id="Navicat"><a href="#Navicat" class="headerlink" title="Navicat"></a>Navicat</h3><p>ä¸ç”¨å¤šè¯´äº†å§</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1L7XgRnLAinUcAqx6oeNt0w" target="_blank" rel="noopener">https://pan.baidu.com/s/1L7XgRnLAinUcAqx6oeNt0w</a><br>æå–ç ï¼š9z54 </p><h2 id="ç½‘ç«™"><a href="#ç½‘ç«™" class="headerlink" title="ç½‘ç«™"></a>ç½‘ç«™</h2><h3 id="æ”¹å›¾å®"><a href="#æ”¹å›¾å®" class="headerlink" title="æ”¹å›¾å®"></a><a href="http://www.gaitubao.com/#" target="_blank" rel="noopener">æ”¹å›¾å®</a></h3><p>æœ€å¼€å§‹æ—¶ä¸ºäº†è£å‰ªå›¾ç‰‡ï¼Œåæ¥å‘ç°è¿˜å¯ä»¥æŒ‰ç…§ æŒ‡å®šå¤§å°å‹ç¼©å›¾ç‰‡ï¼Œä¹Ÿæ˜¯ä¸ªç¥å™¨å•Š~</p><h3 id="CodeToImage"><a href="#CodeToImage" class="headerlink" title="CodeToImage"></a><a href="https://carbon.now.sh" target="_blank" rel="noopener">CodeToImage</a></h3><p>å¯ä»¥æŠŠä»£ç ç¾åŒ–ä¸ºå¥½çœ‹çš„å›¾ç‰‡ç„¶åå¯¼å‡º</p><p><img alt="c" data-src="http://static.imlgw.top///20190407/sAP81lBQEv3Q.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="draw-io"><a href="#draw-io" class="headerlink" title="draw.io"></a><a href="https://www.draw.io/" target="_blank" rel="noopener">draw.io</a></h3><p>åœ¨çº¿ç”»å›¾å·¥å…·ï¼Œè°ç”¨è°çŸ¥é“ï¼Œç°åœ¨æœ‰ç¦»çº¿ç‰ˆæœ¬çš„äº†</p><h3 id="åœ¨çº¿å…è´¹æŠ å›¾"><a href="#åœ¨çº¿å…è´¹æŠ å›¾" class="headerlink" title="åœ¨çº¿å…è´¹æŠ å›¾"></a><a href="https://www.gaoding.com/koutu" target="_blank" rel="noopener">åœ¨çº¿å…è´¹æŠ å›¾</a></h3><p> å¾ˆæ–¹ä¾¿æ“ä½œä¹Ÿå¾ˆç®€å•</p><h3 id="é«˜æ¸…å›¾ç‰‡ç´ æ"><a href="#é«˜æ¸…å›¾ç‰‡ç´ æ" class="headerlink" title="é«˜æ¸…å›¾ç‰‡ç´ æ"></a><a href="https://alpha.wallhaven.cc/" target="_blank" rel="noopener">é«˜æ¸…å›¾ç‰‡ç´ æ</a></h3><p>  å…è´¹ï¼Œé«˜æ¸…ï¼Œç´ æå¤šï¼Œç”¨æ¥åšå£çº¸ä»€ä¹ˆçš„éƒ½æŒºä¸é”™</p><h3 id="unsplash"><a href="#unsplash" class="headerlink" title="unsplash"></a><a href="https://unsplash.com" target="_blank" rel="noopener">unsplash</a></h3><p> ä¹Ÿæ˜¯å›¾ç‰‡ç´ æç«™</p><h3 id="img9æ— é™å›¾åºŠ"><a href="#img9æ— é™å›¾åºŠ" class="headerlink" title="img9æ— é™å›¾åºŠ"></a><a href="https://img9.top" target="_blank" rel="noopener">img9æ— é™å›¾åºŠ</a></h3><p>  æˆ‘ç°åœ¨éƒ½æ˜¯ç”¨çš„ä¸ƒç‰›äº‘ï¼Œç¬¬ä¸‰æ–¹çš„è¿˜æ˜¯ä¸æ”¾å¿ƒï¼ˆç›®å‰è¿˜æ­£å¸¸ï¼Œæˆ‘åšå®¢çš„å‰å‡ ç¯‡éƒ½æ˜¯åœ¨è¿™ä¸ªä¸Šé¢ï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ <code>å¾®åš</code> ä¹Ÿæ˜¯ä¸ªå¥½å›¾åºŠï¼Œ</p><h3 id="SM-MS"><a href="#SM-MS" class="headerlink" title="SM.MS"></a><a href="https://sm.ms" target="_blank" rel="noopener">SM.MS</a></h3><p> ä¹Ÿæ˜¯å›¾åºŠï¼Œæ¯”ä¸Šé¢é‚£ä¸ªæ›´ä¸“ä¸šï¼Œæœ‰api</p><blockquote><p>åç»­å¦‚æœè¿˜æœ‰å¥½çš„å·¥å…·å’Œç½‘ç«™ä¼šç»§ç»­æ·»åŠ è¿›æ¥ ğŸ˜€</p></blockquote></body></html>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­—å…¸æ ‘åˆæ¢</title>
      <link href="/2019/12/17/zi-dian-shu/"/>
      <url>/2019/12/17/zi-dian-shu/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="å­—å…¸æ ‘"><a href="#å­—å…¸æ ‘" class="headerlink" title="å­—å…¸æ ‘"></a>å­—å…¸æ ‘</h2><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ<strong>trie</strong>ï¼Œåˆç§°<strong>å‰ç¼€æ ‘</strong>æˆ–<strong>å­—å…¸æ ‘</strong>ï¼Œå­—å…¸æ ‘è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œæ‰€ä»¥æ•°æ®ç»“æ„æœ¬èº«æ¯”è¾ƒæ¶ˆè€—ç©ºé—´ã€‚ä½†å®ƒåˆ©ç”¨äº†å­—ç¬¦ä¸²çš„<strong>å…±åŒå‰ç¼€ï¼ˆCommon Prefixï¼‰</strong>ä½œä¸ºå­˜å‚¨ä¾æ®ï¼Œä»¥æ­¤æ¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå¹¶åŠ é€Ÿæœç´¢æ—¶é—´ã€‚Trie çš„å­—ç¬¦ä¸²æœç´¢æ—¶é—´å¤æ‚åº¦ä¸º <strong>O(m)</strong>ï¼Œm ä¸ºæœ€é•¿çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå…¶æŸ¥è¯¢æ€§èƒ½ä¸é›†åˆä¸­çš„å­—ç¬¦ä¸²çš„æ•°é‡æ— å…³ã€‚å…¶åœ¨æœç´¢å­—ç¬¦ä¸²æ—¶è¡¨ç°å‡ºçš„é«˜æ•ˆï¼Œä½¿å¾—ç‰¹åˆ«é€‚ç”¨äºæ„å»ºæ–‡æœ¬æœç´¢å’Œè¯é¢‘ç»Ÿè®¡ç­‰åº”ç”¨</p><h3 id="æ€§è´¨"><a href="#æ€§è´¨" class="headerlink" title="æ€§è´¨"></a>æ€§è´¨</h3><p>ä¸äºŒåˆ†æœç´¢æ ‘ä¸åŒï¼Œ<strong>é”®ä¸æ˜¯ç›´æ¥ä¿å­˜åœ¨èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯ç”±èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®å†³å®š</strong>ã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­å­™éƒ½æœ‰ç›¸åŒçš„å‰ç¼€ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè€Œæ ¹èŠ‚ç‚¹å¯¹åº”ç©ºå­—ç¬¦ä¸²ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„å€¼ï¼Œåªæœ‰<strong>å¶å­èŠ‚ç‚¹</strong>å’Œéƒ¨åˆ†å†…éƒ¨èŠ‚ç‚¹æ‰€å¯¹åº”çš„é”®æ‰æœ‰ç›¸å…³çš„å€¼</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="ä½¿ç”¨TreeMapå®ç°"><a href="#ä½¿ç”¨TreeMapå®ç°" class="headerlink" title="ä½¿ç”¨TreeMapå®ç°"></a>ä½¿ç”¨TreeMapå®ç°</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> isWord; <span class="comment">//æ˜¯å¦æ˜¯ä¸€ä¸ªå®Œæ•´å•è¯</span></span><br><span class="line">        <span class="keyword">public</span> TreeMap<character,node> next;</character,node></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">boolean</span> isWord)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.isWord = isWord;</span><br><span class="line">            next = <span class="keyword">new</span> TreeMap<>();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>{</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">false</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span></span>{</span><br><span class="line">        root=<span class="keyword">new</span> Node();</span><br><span class="line">        size=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘Trieä¸­æ·»åŠ word</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLoop</span><span class="params">(String word)</span></span>{</span><br><span class="line">        Node cur=root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<word.length();i++) {< span><br><span class="line">            <span class="keyword">char</span> c=word.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (cur.next.get(c)==<span class="keyword">null</span>) {</span><br><span class="line">                cur.next.put(c,<span class="keyword">new</span> Node());</span><br><span class="line">            }</span><br><span class="line">            cur=cur.next.get(c);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!cur.isWord) {</span><br><span class="line">            size++;</span><br><span class="line">            cur.isWord=<span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€’å½’çš„æ·»åŠ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String word)</span></span>{</span><br><span class="line">        add(root,word,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node cur,String word,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index==word.length()) {</span><br><span class="line">            <span class="keyword">if</span> (!cur.isWord) {</span><br><span class="line">                size++;</span><br><span class="line">                cur.isWord=<span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=word.charAt(index);</span><br><span class="line">        <span class="keyword">if</span> (cur.next.get(c)==<span class="keyword">null</span>) {</span><br><span class="line">            cur.next.put(c,<span class="keyword">new</span> Node());</span><br><span class="line">        }</span><br><span class="line">        add(cur.next.get(c),word,index+<span class="number">1</span>); <span class="comment">//å°¾é€’å½’</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢wordæ˜¯å¦åœ¨Trieä¸­</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(String word)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> contains(root,word,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Node cur,String word,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index==word.length()) {</span><br><span class="line">            <span class="keyword">return</span> cur.isWord;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=word.charAt(index);</span><br><span class="line">        <span class="keyword">return</span> cur.next.containsKey(c) && contains(cur.next.get(c),word,index+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¾ªç¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsLoop</span><span class="params">(String word)</span></span>{</span><br><span class="line">        Node cur=root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<word.length();i++) {< span><br><span class="line">            Character c=word.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (!cur.next.containsKey(c)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;   </span><br><span class="line">            }</span><br><span class="line">            cur=cur.next.get(c);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> cur.isWord;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ˜¯å¦æœ‰æŸä¸ªå‰ç¼€</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPerfix</span><span class="params">(String perfix)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> hasPerfix(root,perfix,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPerfix</span><span class="params">(Node cur,String perfix,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index==perfix.length()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=perfix.charAt(index);</span><br><span class="line">        <span class="keyword">return</span> cur.next.containsKey(c) && hasPerfix(cur.next.get(c),perfix,index+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‡’å¾—å†™å¾ªç¯äº†ã€‚ã€‚ã€‚</span></span><br><span class="line">}</span><br></word.length();i++)></span></word.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>æ•´ä½“ä¸Šæ¥è¯´å…¶å®å¾ˆç®€å•ï¼Œè¿™é‡Œç”¨çš„æ˜¯TreeMapæ¥å­˜å‚¨å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€å±‚èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨Nodeä¸­å¹¶æ²¡æœ‰ç›´æ¥å­˜å‚¨æŸä¸ªå­—ç¬¦ï¼Œè€Œæ˜¯å¯¹åº”äº†TreeMapçš„Keyï¼Œä½†æ˜¯ç”±äºTreeMapåº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œå…¶å®åœ¨æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™å¹¶æ²¡æœ‰ä¼˜åŠ¿ï¼Œæ‰€ä»¥åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨èŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸‹é¢è¿™é“é¢˜</p><h2 id="LeetCodeç»ƒæ‰‹ä¾‹é¢˜"><a href="#LeetCodeç»ƒæ‰‹ä¾‹é¢˜" class="headerlink" title="LeetCodeç»ƒæ‰‹ä¾‹é¢˜"></a>LeetCodeç»ƒæ‰‹ä¾‹é¢˜</h2><h3 id="208-å®ç°-Trie-å‰ç¼€æ ‘"><a href="#208-å®ç°-Trie-å‰ç¼€æ ‘" class="headerlink" title="208. å®ç° Trie (å‰ç¼€æ ‘)"></a><a href="https://leetcode-cn.com/problems/implement-trie-prefix-tree/" target="_blank" rel="noopener">208. å®ç° Trie (å‰ç¼€æ ‘)</a></h3><p>å®ç°ä¸€ä¸ª Trie (å‰ç¼€æ ‘)ï¼ŒåŒ…å« insert, search, å’Œ startsWith è¿™ä¸‰ä¸ªæ“ä½œã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Trie trie = <span class="keyword">new</span> Trie();</span><br><span class="line"></span><br><span class="line">trie.insert(<span class="string">"apple"</span>);</span><br><span class="line">trie.search(<span class="string">"apple"</span>);   <span class="comment">// è¿”å› true</span></span><br><span class="line">trie.search(<span class="string">"app"</span>);     <span class="comment">// è¿”å› false</span></span><br><span class="line">trie.startsWith(<span class="string">"app"</span>); <span class="comment">// è¿”å› true</span></span><br><span class="line">trie.insert(<span class="string">"app"</span>);   </span><br><span class="line">trie.search(<span class="string">"app"</span>);     <span class="comment">// è¿”å› true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>ä½ å¯ä»¥å‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯ç”±å°å†™å­—æ¯ a-z æ„æˆçš„ã€‚</li><li>ä¿è¯æ‰€æœ‰è¾“å…¥å‡ä¸ºéç©ºå­—ç¬¦ä¸²</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> isWord; <span class="comment">//æ˜¯å¦æ˜¯ä¸€ä¸ªå®Œæ•´å•è¯</span></span><br><span class="line">        <span class="keyword">public</span> Node[] next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">boolean</span> isWord)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.isWord = isWord;</span><br><span class="line">            next = <span class="keyword">new</span> Node[<span class="number">26</span>];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>{</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">false</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Initialize your data structure here. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>{</span><br><span class="line">        root=<span class="keyword">new</span> Node();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Inserts a word into the trie. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>{</span><br><span class="line">        insert(root,word,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node cur,String word,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index==word.length()) {</span><br><span class="line">            <span class="keyword">if</span> (!cur.isWord) {</span><br><span class="line">                cur.isWord=<span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=word.charAt(index);</span><br><span class="line">        <span class="keyword">if</span> (cur.next[c-<span class="string">'a'</span>]==<span class="keyword">null</span>) {</span><br><span class="line">            cur.next[c-<span class="string">'a'</span>]=<span class="keyword">new</span> Node();</span><br><span class="line">        }</span><br><span class="line">        insert(cur.next[c-<span class="string">'a'</span>],word,index+<span class="number">1</span>); <span class="comment">//å°¾é€’å½’</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Returns if the word is in the trie. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String word)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> search(root,word,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(Node cur,String word,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index==word.length()) {</span><br><span class="line">            <span class="keyword">return</span> cur.isWord;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=word.charAt(index);</span><br><span class="line">        <span class="keyword">return</span> cur.next[c-<span class="string">'a'</span>]!=<span class="keyword">null</span>&& search(cur.next[c-<span class="string">'a'</span>],word,index+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/** Returns if there is any word in the trie that starts with the given prefix. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> startsWith(root,prefix,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(Node cur,String prefix,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index==prefix.length()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=prefix.charAt(index);</span><br><span class="line">        <span class="keyword">return</span> cur.next[c-<span class="string">'a'</span>]!=<span class="keyword">null</span> && startsWith(cur.next[c-<span class="string">'a'</span>],prefix,index+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your Trie object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * Trie obj = new Trie();</span></span><br><span class="line"><span class="comment"> * obj.insert(word);</span></span><br><span class="line"><span class="comment"> * boolean param_2 = obj.search(word);</span></span><br><span class="line"><span class="comment"> * boolean param_3 = obj.startsWith(prefix);</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œé¢˜ç›®è¯´æ˜äº†æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯å°å†™å­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨å›ºå®šå¤§å°çš„Nodeæ•°ç»„æ¥å®ç°ï¼Œç›¸æ¯”äºä¸Šé¢çš„TreeMapæ—¶é—´ç©ºé—´ä¸Šéƒ½ä¼šæœ‰å¾ˆå¤§çš„æå‡</p><h3 id="211-æ·»åŠ ä¸æœç´¢å•è¯-æ•°æ®ç»“æ„è®¾è®¡"><a href="#211-æ·»åŠ ä¸æœç´¢å•è¯-æ•°æ®ç»“æ„è®¾è®¡" class="headerlink" title="211. æ·»åŠ ä¸æœç´¢å•è¯ - æ•°æ®ç»“æ„è®¾è®¡"></a><a href="https://leetcode-cn.com/problems/add-and-search-word-data-structure-design/" target="_blank" rel="noopener">211. æ·»åŠ ä¸æœç´¢å•è¯ - æ•°æ®ç»“æ„è®¾è®¡</a></h3><p>è®¾è®¡ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œçš„æ•°æ®ç»“æ„ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addWord</span><span class="params">(word)</span></span></span><br><span class="line"><span class="function">bool <span class="title">search</span><span class="params">(word)</span></span></span><br></pre></td></tr></tbody></table></figure></div><p><code>search(word)</code> å¯ä»¥æœç´¢æ–‡å­—æˆ–æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²åªåŒ…å«å­—æ¯ . æˆ– a-z ã€‚ <code>.</code> å¯ä»¥è¡¨ç¤ºä»»ä½•ä¸€ä¸ªå­—æ¯ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">addWord(<span class="string">"bad"</span>)</span><br><span class="line">addWord(<span class="string">"dad"</span>)</span><br><span class="line">addWord(<span class="string">"mad"</span>)</span><br><span class="line">search(<span class="string">"pad"</span>) -> <span class="keyword">false</span></span><br><span class="line">search(<span class="string">"bad"</span>) -> <span class="keyword">true</span></span><br><span class="line">search(<span class="string">".ad"</span>) -> <span class="keyword">true</span></span><br><span class="line">search(<span class="string">"b.."</span>) -> <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><p>ä½ å¯ä»¥å‡è®¾æ‰€æœ‰å•è¯éƒ½æ˜¯ç”±å°å†™å­—æ¯ <code>a-z</code> ç»„æˆçš„ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> isWord; <span class="comment">//æ˜¯å¦æ‰¾åˆ°äº†ä¸€ä¸ªå•è¯</span></span><br><span class="line">    <span class="keyword">public</span> Node[] next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">boolean</span> isWord)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.isWord = isWord;</span><br><span class="line">        next = <span class="keyword">new</span> Node[<span class="number">26</span>];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Initialize your data structure here. */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">WordDictionary</span><span class="params">()</span> </span>{</span><br><span class="line">    root=<span class="keyword">new</span> Node();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Adds a word into the data structure. */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addWord</span><span class="params">(String word)</span> </span>{</span><br><span class="line">    addWord(root,word,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addWord</span><span class="params">(Node cur,String word,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index == word.length()) {</span><br><span class="line">        cur.isWord=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">char</span> c=word.charAt(index);</span><br><span class="line">    <span class="keyword">if</span> (cur.next[c-<span class="string">'a'</span>]==<span class="keyword">null</span>) {</span><br><span class="line">        cur.next[c-<span class="string">'a'</span>]= <span class="keyword">new</span> Node();</span><br><span class="line">    }</span><br><span class="line">    addWord(cur.next[c-<span class="string">'a'</span>],word,index+<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Returns if the word is in the data structure. A word could contain the dot character '.' to represent any one letter. */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String word)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> search(root,word,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(Node cur,String word,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index == word.length()) {</span><br><span class="line">        <span class="keyword">return</span> cur.isWord;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">char</span> c=word.charAt(index);</span><br><span class="line">    <span class="keyword">if</span> (c==<span class="string">'.'</span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<cur.next.length;i++) {< span><br><span class="line">            <span class="keyword">if</span>(cur.next[i]!=<span class="keyword">null</span> && search(cur.next[i],word,index+<span class="number">1</span>)){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cur.next[c-<span class="string">'a'</span>]!=<span class="keyword">null</span> && search(cur.next[c-<span class="string">'a'</span>],word,index+<span class="number">1</span>);</span><br><span class="line">}</span><br></cur.next.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ²¡å•¥å¥½è¯´çš„ï¼Œé‡åˆ°ç‚¹å°±å¾ªç¯åˆ¤æ–­æ¯ä¸ªå­èŠ‚ç‚¹å°±ok</p><h3 id="677-é”®å€¼æ˜ å°„"><a href="#677-é”®å€¼æ˜ å°„" class="headerlink" title="677. é”®å€¼æ˜ å°„"></a><a href="https://leetcode-cn.com/problems/map-sum-pairs/" target="_blank" rel="noopener">677. é”®å€¼æ˜ å°„</a></h3><p>å®ç°ä¸€ä¸ª MapSum ç±»é‡Œçš„ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>insert</code> å’Œ <code>sum</code>ã€‚</p><p>å¯¹äºæ–¹æ³• <code>insert</code>ï¼Œä½ å°†å¾—åˆ°ä¸€å¯¹ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•´æ•°ï¼‰çš„é”®å€¼å¯¹ã€‚å­—ç¬¦ä¸²è¡¨ç¤ºé”®ï¼Œæ•´æ•°è¡¨ç¤ºå€¼ã€‚å¦‚æœé”®å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆåŸæ¥çš„é”®å€¼å¯¹å°†è¢«æ›¿ä»£æˆæ–°çš„é”®å€¼å¯¹ã€‚</p><p>å¯¹äºæ–¹æ³• sumï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºå‰ç¼€çš„å­—ç¬¦ä¸²ï¼Œä½ éœ€è¦è¿”å›æ‰€æœ‰ä»¥è¯¥å‰ç¼€å¼€å¤´çš„é”®çš„å€¼çš„æ€»å’Œã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: insert(<span class="string">"apple"</span>, <span class="number">3</span>), è¾“å‡º: Null</span><br><span class="line">è¾“å…¥: sum(<span class="string">"ap"</span>), è¾“å‡º: <span class="number">3</span></span><br><span class="line">è¾“å…¥: insert(<span class="string">"app"</span>, <span class="number">2</span>), è¾“å‡º: Null</span><br><span class="line">è¾“å…¥: sum(<span class="string">"ap"</span>), è¾“å‡º: <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æœ‰äº†å‰é¢çš„é“ºå«ï¼Œå…¶å®è¿™ä¸ªä¹Ÿå¾ˆç®€å•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MapSum</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> isWord; <span class="comment">//æ˜¯å¦æ‰¾åˆ°äº†ä¸€ä¸ªå•è¯</span></span><br><span class="line">        <span class="keyword">public</span> Node[] next;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">boolean</span> isWord,<span class="keyword">int</span> value)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.isWord = isWord;</span><br><span class="line">            <span class="keyword">this</span>.value=value;</span><br><span class="line">            next = <span class="keyword">new</span> Node[<span class="number">26</span>];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">false</span>,value);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapSum</span><span class="params">()</span> </span>{</span><br><span class="line">        root=<span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String key, <span class="keyword">int</span> val)</span> </span>{</span><br><span class="line">        insert(root,key,val,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//a p p l e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node cur,String key, <span class="keyword">int</span> val,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (index==key.length()) {</span><br><span class="line">            cur.isWord=<span class="keyword">true</span>;</span><br><span class="line">            cur.value=val;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=key.charAt(index);</span><br><span class="line">        <span class="keyword">if</span> (cur.next[c-<span class="string">'a'</span>]==<span class="keyword">null</span>) {</span><br><span class="line">            cur.next[c-<span class="string">'a'</span>]=<span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">        }</span><br><span class="line">        insert(cur.next[c-<span class="string">'a'</span>],key,val,index+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sum</span><span class="params">(String prefix)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> sum(root,prefix,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sum</span><span class="params">(Node cur,String prefix,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (index == prefix.length()) {</span><br><span class="line">            <span class="keyword">return</span> tireSum(cur);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">char</span> c=prefix.charAt(index);</span><br><span class="line">        <span class="keyword">if</span> (cur.next[c-<span class="string">'a'</span>]==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> sum(cur.next[c-<span class="string">'a'</span>],prefix,index+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">tireSum</span><span class="params">(Node cur)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (cur.isWord) {</span><br><span class="line">    sum+=cur.value;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">26</span>;i++) {</span><br><span class="line">    sum+=cur.next[i]!=<span class="keyword">null</span>?tireSum(cur.next[i]):<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·ï¼Œåˆ©ç”¨å‰ç¼€æ ‘ï¼Œä¸è¿‡è¦åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šåšä¸€äº›æ”¹åŠ¨æ·»åŠ ä¸€ä¸ªvalueå­—æ®µç”¨æ¥ä¿å­˜å€¼ï¼Œå…ˆåœ¨æ ‘ä¸­æ‰¾åˆ°è¦æ±‚çš„å‰ç¼€çš„æœ€åä¸€ä¸ªå•è¯æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œç„¶åå°±ç›´æ¥æ±‚è¿™ä¸ªèŠ‚ç‚¹æ‰€æœ‰çš„å­èŠ‚ç‚¹ä¸­isWordçš„å•è¯çš„valueç´¯åŠ å’Œå°±okäº†ï¼Œæˆ‘ä¸Šé¢çš„å®ç°å¹¶ä¸å¥½ï¼Œéƒ½æ˜¯å†™çš„é€’å½’ï¼Œè€Œä¸”æ˜¯å°¾é€’å½’ï¼Œå¾ˆé¸¡è‚‹å…¶å®</p></body></html>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ®µæ ‘åˆæ¢</title>
      <link href="/2019/12/09/xian-duan-shu/"/>
      <url>/2019/12/09/xian-duan-shu/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>çº¿æ®µæ ‘å…¶å®å±äºæ¯”è¾ƒé«˜çº§çš„æ•°æ®ç»“æ„äº†ï¼Œæœ¬äººå¹¶ä¸æ˜¯ç«èµ›é€‰æ‰‹ï¼Œè¿™é‡Œçš„ä»£ç ä¹Ÿæ˜¯å€Ÿé‰´çš„boboè€å¸ˆçš„è§†é¢‘è¯¾æ¥å®ç°çš„ï¼Œé¢è¯•ä»€ä¹ˆçš„ä¸€èˆ¬æ˜¯ä¸ä¼šè€ƒçš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯å‡ºäºå…´è¶£ç»ƒç»ƒæ‰‹</p><h2 id="é—®é¢˜å¼•å…¥"><a href="#é—®é¢˜å¼•å…¥" class="headerlink" title="é—®é¢˜å¼•å…¥"></a>é—®é¢˜å¼•å…¥</h2><p><a href="https://leetcode-cn.com/problems/range-sum-query-mutable/" target="_blank" rel="noopener">307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹</a></p><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„  numsï¼Œæ±‚å‡ºæ•°ç»„ä»ç´¢å¼• i åˆ° j  (i â‰¤ j) èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼ŒåŒ…å« i,  j ä¸¤ç‚¹ã€‚</p><p>update(i, val) å‡½æ•°å¯ä»¥é€šè¿‡å°†ä¸‹æ ‡ä¸º i çš„æ•°å€¼æ›´æ–°ä¸º valï¼Œä»è€Œå¯¹æ•°åˆ—è¿›è¡Œä¿®æ”¹ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Given nums = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">sumRange(<span class="number">0</span>, <span class="number">2</span>) -> <span class="number">9</span></span><br><span class="line">update(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">sumRange(<span class="number">0</span>, <span class="number">2</span>) -> <span class="number">8</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ol><li>æ•°ç»„ä»…å¯ä»¥åœ¨ update å‡½æ•°ä¸‹è¿›è¡Œä¿®æ”¹ã€‚</li><li>ä½ å¯ä»¥å‡è®¾ update å‡½æ•°ä¸ sumRange å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°æ˜¯å‡åŒ€åˆ†å¸ƒçš„ã€‚</li></ol><blockquote><p>è¿™é¢˜å¦‚æœæ•°ç»„ä¸èƒ½ä¿®æ”¹çš„è¯å°±å¥½è¯´äº†ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨æ•°ç»„çš„å‰ç¼€å’Œï¼Œä½†æ˜¯è¿™é‡Œæ•°ç»„æ˜¯ä¼šå˜åŒ–çš„ï¼Œéš¾é“æ²¡æ›´æ–°ä¸€æ¬¡éƒ½è¦é‡æ–°éå†ä¹ˆï¼Ÿé‚£ä¹Ÿå¤ªæ…¢äº†å§ï¼Œæœ‰æ²¡æœ‰ä¸€ç§ç»“æ„èƒ½é«˜æ•ˆçš„æ’å…¥åŒæ—¶ä¹Ÿèƒ½é«˜æ•ˆçš„æŸ¥è¯¢ï¼Ÿ</p></blockquote><h2 id="çº¿æ®µæ ‘"><a href="#çº¿æ®µæ ‘" class="headerlink" title="çº¿æ®µæ ‘"></a>çº¿æ®µæ ‘</h2><p>çº¿æ®µæ ‘ï¼Œå®ƒåœ¨å„ä¸ªèŠ‚ç‚¹ä¿å­˜ä¸€æ¡çº¿æ®µï¼ˆæ•°ç»„ä¸­çš„ä¸€æ®µå­æ•°ç»„ï¼‰ï¼Œä¸»è¦ç”¨äºé«˜æ•ˆè§£å†³è¿ç»­åŒºé—´çš„åŠ¨æ€æŸ¥è¯¢é—®é¢˜ï¼Œç”±äºäºŒå‰ç»“æ„çš„ç‰¹æ€§ï¼ˆå®ƒæ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘ï¼‰ï¼Œå®ƒåŸºæœ¬èƒ½ä¿æŒæ¯ä¸ªæ“ä½œçš„å¤æ‚åº¦ä¸º<code>O(logN)</code></p><p>çº¿æ®µæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªåŒºé—´ï¼Œçˆ¶åŒºé—´ä¸º<code>[a,b]</code> åˆ™å·¦å­åŒºé—´ä¸º<code>[a,(a+b)/2]</code>å³å­åŒºé—´ä¸º<code>[(a+b)/2+1,b]</code> æœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹å°±æ˜¯å¯¹åº”çš„ä¸€ä¸ªä¸ªå…·ä½“çš„å…ƒç´ å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ•°ç»„æ¥å®ç°çº¿æ®µæ ‘</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SegmentTree</span><<span class="title">E</span>></span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> E[] tree;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BiFunction<e,e,e> function;</e,e,e></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SegmentTree</span><span class="params">(E[] arr,BiFunction<e,e,e> function)</e,e,e></span></span>{</span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[arr.length];</span><br><span class="line">        <span class="keyword">this</span>.function=function;</span><br><span class="line">        System.arraycopy(arr,<span class="number">0</span>,data,<span class="number">0</span>,arr.length);</span><br><span class="line">        <span class="comment">//å€¼å¾—æ€è€ƒä¸ºä»€ä¹ˆæ˜¯4n</span></span><br><span class="line">        tree = (E[]) <span class="keyword">new</span> Object[<span class="number">4</span>*arr.length];</span><br><span class="line">        buildSegmentTree(<span class="number">0</span>,<span class="number">0</span>,arr.length-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®ä¼ å…¥çš„BiFuctionæ„å»ºçº¿æ®µæ ‘</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildSegmentTree</span><span class="params">(<span class="keyword">int</span> index,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (left==right) {</span><br><span class="line">            tree[index] =data[right];</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> leftIndex=leftChild(index);</span><br><span class="line">        <span class="keyword">int</span> rightIndex=rightChild(index);</span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        buildSegmentTree(leftIndex,left,mid);</span><br><span class="line">        buildSegmentTree(rightIndex,mid+<span class="number">1</span>,right);</span><br><span class="line">        <span class="comment">//æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¼ å…¥BiFunction</span></span><br><span class="line">        tree[index]=function.apply(tree[leftIndex],tree[rightIndex]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//èŒƒå›´æœç´¢</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">searchRange</span><span class="params">(<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> searchRange(<span class="number">0</span>,<span class="number">0</span>,data.length-<span class="number">1</span>,left,right);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> E <span class="title">searchRange</span><span class="params">(<span class="keyword">int</span> rootIndex,<span class="keyword">int</span> left,<span class="keyword">int</span> right,<span class="keyword">int</span> targetLeft,<span class="keyword">int</span> targetRight)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (targetLeft == left && targetRight == right) {</span><br><span class="line">            <span class="keyword">return</span> tree[rootIndex];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (targetLeft>mid) {</span><br><span class="line">            <span class="keyword">return</span> searchRange(rightChild(rootIndex),mid+<span class="number">1</span>,right,targetLeft,targetRight);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (targetRight<=mid) {</span><br><span class="line">            <span class="keyword">return</span> searchRange(leftChild(rootIndex),left,mid,targetLeft,targetRight);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> function.apply(searchRange(leftChild(rootIndex),left,mid,targetLeft,mid),searchRange(rightChild(rootIndex),mid+<span class="number">1</span>,right,mid+<span class="number">1</span>,targetRight));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> index,E e)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index<<span class="number">0</span> || index>=data.length) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"index illegal"</span>);</span><br><span class="line">        }</span><br><span class="line">        update(<span class="number">0</span>,<span class="number">0</span>,data.length-<span class="number">1</span>,index,e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> rootIndex,<span class="keyword">int</span> left,<span class="keyword">int</span> right,<span class="keyword">int</span> targetIndex,E e)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (left == right) {</span><br><span class="line">            tree[rootIndex]=e;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (targetIndex<=mid) {</span><br><span class="line">            update(leftChild(rootIndex),left,mid,targetIndex,e);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            update(rightChild(rootIndex),mid+<span class="number">1</span>,right,targetIndex,e);</span><br><span class="line">        }</span><br><span class="line">        tree[rootIndex]=function.apply(tree[leftChild(rootIndex)],tree[rightChild(rootIndex)]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> data.length;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index<<span class="number">0</span> || index>=data.length) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"index is illegal!"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> data[index];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å·¦å­©å­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">leftChild</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> index*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å³å­©å­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">rightChild</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> index*<span class="number">2</span>+<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ²¡å•¥å¥½è¯´çš„ï¼Œæ•´ä½“è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä»£ç ä¸­ç”¨åˆ°äº†Java8çš„å‡½æ•°å¼æ¥å£ï¼Œç¡®å®æŒºæ–¹ä¾¿çš„</p><p>å…¶å®æˆ‘è§‰å¾—æœ‰ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„ç‚¹å°±æ˜¯çº¿æ®µæ ‘éœ€è¦å¤šå¤§çš„æ•°ç»„ç©ºé—´ï¼Ÿ</p><p>é¦–å…ˆä¸€é¢—Hå±‚ï¼ˆHä»1å¼€å§‹ï¼‰çš„æ»¡äºŒå‰æ ‘ä¸€å…±æœ‰ <code>2^H-1</code>  ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¿½ç•¥é‚£ä¸€ä¸ªèŠ‚ç‚¹ï¼Œçº¦ä¸º<code>2^H</code>ä¸ªèŠ‚ç‚¹ï¼Œè€Œæœ€åä¸€å±‚ï¼ˆh-1å±‚ï¼‰æœ‰ <code>2^(h-1)</code>ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åä¸€å±‚çš„èŠ‚ç‚¹æ ‘å¤§è‡´ç­‰äºå‰é¢æ‰€æœ‰å±‚èŠ‚ç‚¹çš„å’Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œåœ¨çº¿æ®µæ ‘ä¸­å¦‚æœéœ€è¦è¡¨ç¤ºçš„åŒºé—´å¤§å°ä¸ºnï¼Œå¹¶ä¸”nåˆšå¥½ç­‰äº2çš„kæ¬¡å¹‚çš„è¯ï¼ˆä¹Ÿå°±æ˜¯æ”¾å¥½æ„æˆä¸€é¢—æ»¡äºŒå‰æ ‘ï¼‰ï¼Œé‚£ä¹ˆå°±åªéœ€è¦2nçš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œä½†æ˜¯å¦‚æœæ˜¯<code>n=2^k+c</code> é‚£ä¹ˆå½“å‰å±‚å°±å­˜ä¸ä¸‹è¿™nä¸ªå…ƒç´ ï¼Œéœ€è¦å­˜åˆ°ä¸‹ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯ç©ºé—´è¿˜éœ€è¦*2ï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬å°±éœ€è¦ 4n çš„ç©ºé—´å»å­˜å‚¨è¿™é¢—çº¿æ®µæ ‘ã€‚</p><p>è¿™ä¸ªæ—¶å€™å†å›å¤´å»åšä¸Šé¢çš„é¢˜å°±ä¼šå¾ˆç®€å•äº†ğŸ˜</p><blockquote><p>çº¿æ®µæ ‘å…¶å®è¿˜æœ‰å¾ˆå¤šçš„æ‰©å±•ï¼Œä¸Šé¢çš„æ˜¯æœ€æœ€æœ€åŸºæœ¬çš„æœ€ç®€å•çš„çº¿æ®µæ ‘ç»“æ„ï¼Œæˆ‘è¿˜æ ¹æœ¬å°±æ²¡æ‘¸åˆ°çº¿æ®µæ ‘çš„é—¨ğŸ˜‚ï¼Œåªæ˜¯çŸ¥é“äº†æœ‰è¿™ä¹ˆä¸ªç»“æ„</p><p>ç”±äºæˆ‘å®åœ¨æ˜¯å¤ªèœäº†ï¼Œä¹Ÿæ²¡æœ‰æ—¶é—´å»äº†è§£é‚£äº›ç»“æ„äº†</p><p>å½“ç„¶é¢è¯•çš„æ—¶å€™å¹¶ä¸ä¼šè€ƒçº¿æ®µæ ‘è¿™äº›ç©æ„å„¿ï¼Œæˆ‘ä¹Ÿåªæ˜¯ä¸ºäº†ç»ƒç»ƒæ‰‹ï¼ŒçœŸæ­£çš„ç«èµ›çš„é¢˜ç›®ä¹Ÿä¸ä¼šåƒä¸Šé¢é‚£ä¹ˆç®€å•ï¼Œäº†è§£å³å¯ğŸ˜…</p></blockquote></body></html>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”±äºcmdå¼•å‘çš„è¡€æ¡ˆ</title>
      <link href="/2019/12/08/you-yu-cmd-yin-fa-de-xie-an/"/>
      <url>/2019/12/08/you-yu-cmd-yin-fa-de-xie-an/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç»™æ•™åŠ¡å¤„åšä¸€ä¸ªå·¥ä½œé‡å®¡æ ¸çš„webé¡¹ç›®ï¼Œå‰å‡ å¤©å®Œæˆåéƒ¨ç½²åœ¨æœºæˆ¿ç”µè„‘ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯æµ‹è¯•çš„æ—¶å€™å‡ºç°äº†Bugï¼Œä¼šå­˜åœ¨ä¸€ä¸ªç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œæ•´ä¸ªåº”ç”¨å¡æ­»ï¼Œæ‰€æœ‰äººéƒ½æ— æ³•ç™»é™†ï¼Œå› ä¸ºç™»é™†æ¨¡å—æ˜¯æˆ‘å†™çš„ï¼Œæˆ‘å½“æ—¶å°±æ…Œäº†ï¼ˆå¹¶ä¸ï¼‰ï¼Œç„¶åèµ¶ç´§å»æœºæˆ¿çœ‹çœ‹åˆ°åº•æ˜¯å•¥æƒ…å†µ</p><h2 id="FixBug"><a href="#FixBug" class="headerlink" title="FixBug"></a>FixBug</h2><p>å…¶å®æˆ‘é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æ•°æ®åº“çš„é—®é¢˜ï¼Œä½†æ˜¯çœ‹äº†æˆ‘æ§åˆ¶å°çš„è¾“å‡ºï¼Œå‘ç°ä»£ç å…¶å®æ ¹æœ¬å°±è¿˜æ²¡åˆ°æ•°æ®åº“å±‚ï¼æ‰€ä»¥å…ˆæ’é™¤äº†æ•°æ®åº“çš„é—®é¢˜</p><p>ç„¶åæˆ‘å°±æƒ³åˆ°äº†å¯èƒ½æ˜¯GCçš„é—®é¢˜ï¼Œç„¶åæˆ‘æ‰“å¼€äº† <code>jvisualvm</code>ï¼Œå‡†å¤‡æŸ¥çœ‹å½“å‰çš„å †å ç”¨å’ŒGCæƒ…å†µï¼Œä½†æ˜¯ç”±äºç°åœ¨æ˜¯æ­£å¸¸çš„ï¼Œçœ‹ä¸å‡ºæ¥ä»€ä¹ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤ç°è¿™ä¸ªBugï¼Œç»“æœæˆ‘ä»¬å‡ ä¸ªäººåœ¨å“ªé‡Œæäº†åŠå¤©æ­»æ´»å¤ç°ä¸äº†ğŸ˜‚</p><blockquote><p>åœ¨ç»è¿‡æˆ‘ä»¬å¿«ä¸€ä¸ªå°æ—¶åšæŒä¸æ‡ˆçš„å°è¯•ä¸‹ï¼Œç»ˆäºå¤ç°äº†ï¼</p></blockquote><p>é¡µé¢hangä½ï¼Œæ‰€æœ‰äººéƒ½æ— æ³•ç™»é™†ï¼Œåå°ä¹Ÿå¹¶æ²¡æœ‰ä»»ä½•çš„é”™è¯¯ä¿¡æ¯ï¼Œç„¶åæˆ‘èµ¶ç´§å»çœ‹äº†ä¸‹ <code>jvisualvm</code> å‘ç°å †å¹¶æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼ŒGCä¹Ÿå¹¶æ²¡æœ‰å‘ç”Ÿï¼è€Œä¸”æ›´è¯¡å¼‚çš„æ˜¯å…¶ä»–çš„å·²ç»ç™»é™†çš„äººæ˜¯å¯ä»¥æ­£å¸¸çš„æ“ä½œçš„ï¼åªæ˜¯å¡ä½äº†ç™»é™†çš„äººï¼Œæ‰€ä»¥GCçš„é—®é¢˜ä¹Ÿæ’é™¤äº†</p><p>æ’é™¤ä¸Šé¢ä¸¤ä¸ªåŸå› ï¼Œå‰©ä¸‹çš„å°±åªæœ‰ä¸€ä¸ªåŸå› äº†ï¼Œçº¿ç¨‹æ­»é”ï¼</p><p>åœ¨dumpå‡ºçº¿ç¨‹å¿«ç…§åç»ˆäºå‘ç°äº†é—®é¢˜æ‰€åœ¨</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191208/XKUriuCE9nTb.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å›¾ä¸­çš„è¿™æ¡çº¿ç¨‹å¡åœ¨äº† <code>PrintStream.println()</code> ä¸Šï¼Œè€Œè¿™ä¸ªæ˜¯æˆ‘åœ¨Serviceæ‰“å°çš„logä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆä¼šåœ¨è¿™é‡Œå¡ä½ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸ç§‘å­¦å•Šï¼Œç„¶åæˆ‘çœ‹äº† å…¶ä»– tomcatçš„å·¥ä½œçº¿ç¨‹ï¼Œå‘ç°è¿˜æœ‰å¥½å‡ ä¸ªéƒ½æ˜¯<code>BLOCK</code> çŠ¶æ€ï¼Œéƒ½åœ¨ç­‰ <code>[0x0000004df8afd000]</code>è¿™æŠŠé”ï¼Œè¿™ä¸ªé”è¢«å¦ä¸€ä¸ªtomcatçš„å·¥ä½œçº¿ç¨‹ <code>http-bio-80-exec[2]</code> æ‰€æŒæœ‰ï¼Œè€Œä¸”å®ƒå¹¶ä¸æ˜¯<code>BLOCK</code>çŠ¶æ€ï¼Œè€Œæ˜¯ <code>RUNNABLE</code> çŠ¶æ€ï¼Œè¿™ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œ <code>java.io.FileOutputStream.writeBytes()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å»çœ‹çœ‹<code>println</code>çš„æºç </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Prints a String and then terminate the line.  This method behaves as</span></span><br><span class="line"><span class="comment"> * though it invokes <code>{<span class="doctag">@link</span> #print(String)}</code> and then</span></span><br><span class="line"><span class="comment"> * <code>{<span class="doctag">@link</span> #println()}</code>.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x  The <code>String</code> to be printed.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">println</span><span class="params">(String x)</span> </span>{</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">        print(x);</span><br><span class="line">        newLine();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹å‡ºåœ¨printlnæ–¹æ³•ç¡®å®æ˜¯åŠ äº†é”çš„ï¼Œé”çš„å¯¹è±¡å°±æ˜¯å½“å‰çš„PrintStreamå®ä¾‹å¯¹è±¡ï¼Œè€Œå ç”¨è¿™ä¸ªé”çš„å¯¹è±¡çš„çº¿ç¨‹åˆ™æ­£åœ¨æ‰§è¡Œä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸ªæœ¬åœ°æ–¹æ³•æˆ‘ä»¬çœ‹ä¸åˆ°åº•å±‚çš„ç»†èŠ‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Writes a sub array as a sequence of bytes.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> b the data to be written</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> off the start offset in the data</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> len the number of bytes that are written</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> append {<span class="doctag">@code</span> true} to first advance the position to the</span></span><br><span class="line"><span class="comment"> *     end of file</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@exception</span> IOException If an I/O error has occurred.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">writeBytes</span><span class="params">(<span class="keyword">byte</span> b[], <span class="keyword">int</span> off, <span class="keyword">int</span> len, <span class="keyword">boolean</span> append)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></tbody></table></figure></div><p>æ— å¥ˆï¼Œå€ŸåŠ©æœç´¢å¼•æ“ï¼Œæœç„¶æŸ¥åˆ°äº†åŒæ ·çš„é—®é¢˜ </p><p><a href="https://my.oschina.net/u/1030459/blog/908007" target="_blank" rel="noopener">ä¸€ä¸ªRUNNABLEçŠ¶æ€çš„çº¿ç¨‹hangåœ¨äº†java.io.FileOutputStream.writeBytesæ–¹æ³•ä¸Š</a></p><p>å½“ç„¶åŸé—®é¢˜æ˜¯æ¥è‡ª<a href="https://stackoverflow.com/questions/634102/log4j-is-hanging-my-application-what-am-i-doing-wrong" target="_blank" rel="noopener">StackOverflow</a> </p><p>é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼šåœ¨CMDçª—å£ç‚¹å‡»äº†é»‘æ¡†ä¹‹åï¼Œæ§åˆ¶å°å°±ä¼šè¢«æš‚åœ<img alt="mark" data-src="http://static.imlgw.top/blog/20191208/1em5YGsoGyxT.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¹‹åå‘æ§åˆ¶å°çš„è¾“å…¥å†…å®¹éƒ½ä¼šè¢«é˜»å¡ï¼Œä½†æ˜¯æ­£åœ¨è¾“å‡ºçš„çº¿ç¨‹ä¹Ÿå¹¶ä¸ä¼š<code>BLOCK</code>ï¼ŒçŠ¶æ€ä»ç„¶æ˜¯<code>RUNNABLE</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ‰€æè¿°çš„æƒ…å†µï¼Œå½“ä½ è¿™ä¸ªæ—¶å€™åœ¨CMDçŠ¶æ€ä¸‹æŒ‰ä¸€ä¸‹å›è½¦æˆ–è€…å…¶ä»–çš„é”®é‡Šæ”¾consoleï¼Œé€€å‡ºç¼–è¾‘æ¨¡å¼<img alt="mark" data-src="http://static.imlgw.top/blog/20191208/4RXkNizHfNsP.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™ä¸ªçº¿ç¨‹åˆä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥è°ƒæ•´cmdçš„è®¾ç½®ï¼Œæˆ‘è¿™é‡Œå…¶å®æ— æ‰€è°“ï¼Œå› ä¸ºåé¢å¹¶ä¸ä¼šåœ¨winä¸Šè¿è¡Œ</p><p>è‡³æ­¤é—®é¢˜å°±åŸºæœ¬è§£å†³äº†ï¼ˆå…¶å®éƒ½ä¸ç®—é—®é¢˜ï¼‰ï¼Œæ²¡æƒ³åˆ°è¿˜ä¼šè¢«cmdç»™å‘ä¸€æŠŠï¼Œä¸è¿‡å¢é•¿äº†ä¸€ç‚¹æ’æŸ¥é—®é¢˜çš„èƒ½åŠ›ä¹Ÿè¿˜æ˜¯ä¸é”™çš„ğŸ˜</p></body></html>]]></content>
      
      
      <categories>
          
          <category> è¸©å‘è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeäºŒåˆ†æŸ¥æ‰¾</title>
      <link href="/2019/12/06/leetcode-er-fen-cha-zhao/"/>
      <url>/2019/12/06/leetcode-er-fen-cha-zhao/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><blockquote><p> ä» <a href="http://imlgw.top/2019/05/04/leetcode-shu-zu/">æ•°ç»„ä¸“é¢˜</a> ä¸­æŠ½å–å‡ºæ¥çš„ </p></blockquote><h2 id="704-äºŒåˆ†æŸ¥æ‰¾"><a href="#704-äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="704. äºŒåˆ†æŸ¥æ‰¾"></a><a href="https://leetcode-cn.com/problems/binary-search/" target="_blank" rel="noopener">704. äºŒåˆ†æŸ¥æ‰¾</a></h2><p>ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target  ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [-<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">12</span>], target = <span class="number">9</span></span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br><span class="line">è§£é‡Š: <span class="number">9</span> å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [-<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">12</span>], target = <span class="number">2</span></span><br><span class="line">è¾“å‡º: -<span class="number">1</span></span><br><span class="line">è§£é‡Š: <span class="number">2</span> ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li>ä½ å¯ä»¥å‡è®¾ nums ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯ä¸é‡å¤çš„</li><li>n å°†åœ¨ [1, 10000]ä¹‹é—´</li><li>nums çš„æ¯ä¸ªå…ƒç´ éƒ½å°†åœ¨ [-9999, 9999]ä¹‹é—´</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>æ¯”è¾ƒç»å…¸çš„äºŒåˆ†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=nums.length;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){< span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] > target){</span><br><span class="line">            right=mid;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br></target){<></span></right){<></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>æŒ‰ç…§æ¿å­æ¥çš„äºŒåˆ†ï¼Œæœ€åéœ€è¦åå¤„ç†ä¸€ä¸‹ä¸å­˜åœ¨çš„æƒ…å†µ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ¨¡æ¿äºŒåˆ†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=nums.length;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){ <span class="comment">//æ’é™¤mid</target){></span></right){<></span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            right=mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> left!=nums.length&&nums[left]==target?left:-<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="35-æœç´¢æ’å…¥ä½ç½®"><a href="#35-æœç´¢æ’å…¥ä½ç½®" class="headerlink" title="35. æœç´¢æ’å…¥ä½ç½®"></a><a href="https://leetcode-cn.com/problems/search-insert-position/" target="_blank" rel="noopener">35. æœç´¢æ’å…¥ä½ç½®</a></h2><p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­æ— é‡å¤å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>], <span class="number">5</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>], <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>], <span class="number">7</span></span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>], <span class="number">0</span></span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">int</span> <span class="title">searchInsert</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="keyword">int</span> lo=<span class="number">0</span>,hi=len-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(nums[hi]<target){< span><br><span class="line">        <span class="keyword">return</span> len;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(nums[<span class="number">0</span>]>=target){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){< span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(lo<nums.length&&nums[lo]>target){</nums.length&&nums[lo]></span><br><span class="line">                <span class="keyword">return</span> mid+<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]>target){</span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(hi>=<span class="number">0</span>&&nums[hi]<target){< span><br><span class="line">                <span class="keyword">return</span> hi+<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">            <span class="comment">//ç›¸ç­‰çš„æƒ…å†µï¼Œç›´æ¥è¿”å›è¿™ä¸ªindex</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//åˆ°ä¸äº†è¿™é‡Œ</span></span><br><span class="line">}</span><br></target){<></span></target){<></span></target){<></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®ä¸Šé¢çš„ä»£ç å†™çš„å¹¶ä¸å¥½ï¼Œå†™çš„å¾ˆå¥‡æ€ªã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">searchInsert</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="keyword">int</span> lo=<span class="number">0</span>,hi=len-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(nums[hi]<target){< span><br><span class="line">        <span class="keyword">return</span> len;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(nums[<span class="number">0</span>]>=target){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){< span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]>target){</span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> lo;</span><br><span class="line">    <span class="comment">//return hi+1</span></span><br><span class="line">}</span><br></target){<></span></target){<></span></pre></td></tr></tbody></table></figure></div><p>å¦‚æœç†Ÿæ‚‰äºŒåˆ†çš„è¿‡ç¨‹ï¼Œå…¶å®æœ€åè¿”å›<code>lo</code>æˆ–è€…<code>hi+1</code>å°±å¯ä»¥äº†ã€‚</p><h2 id="153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼"><a href="#153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼" class="headerlink" title="153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼"></a><a href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/" target="_blank" rel="noopener">153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼</a></h2><p>å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚</p><p>( ä¾‹å¦‚ï¼Œæ•°ç»„ <code>[0,1,2,4,5,6,7]</code> å¯èƒ½å˜ä¸º <code>[4,5,6,7,0,1,2]</code> )ã€‚</p><p>è¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æŠŠæœ€å¼€å§‹å†™çš„æ‹‰è·¨è§£æ³•ä¹Ÿæ”¾ä¸Šæ¥å§</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMin</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (nums.length==<span class="number">1</span>||nums[<span class="number">0</span>]<nums[nums.length-<span class="number">1</nums[nums.length-<span></span>]) {<br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">1</span>,right=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid]>nums[mid-<span class="number">1</span>]) {</span><br><span class="line">            <span class="keyword">if</span> (nums[mid]>nums[<span class="number">0</span>]) {</span><br><span class="line">                left=mid;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                right=mid-<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> nums[mid];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[left];</span><br><span class="line">}</span><br></right){<></span></pre></td></tr></tbody></table></figure></div><p>è¯´å®è¯ï¼Œæˆ‘éƒ½ä¸çŸ¥é“å’‹å¯¹çš„ã€‚ã€‚ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>æ¨¡æ¿è§£æ³•ï¼Œè¿˜æ˜¯æ¨¡æ¿å†™èµ·æ¥æ¸…æ™°èˆ’æœ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMin</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid]>nums[right]) { <span class="comment">//æ’é™¤midçš„åˆ†æ”¯</span></span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            right=mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[left];</span><br><span class="line">}</span><br></right){<></span></pre></td></tr></tbody></table></figure></div><p>éœ€è¦æ³¨æ„è¦å’Œå³è¾¹ç•Œæ¯”è¾ƒï¼Œå’Œå·¦è¾¹ç•Œæ¯”è¾ƒä¸ä¸€å®šæ­£ç¡®</p><p>æ¯”å¦‚ <code>1 2 3 4 5</code> å’Œ<code>2 3 4 5 1</code> ä¸¤ä¸ªçš„ä¸­ç‚¹éƒ½å¤§äºå·¦è¾¹ç•Œï¼Œä½†æ˜¯ä½ æ— æ³•ç¡®å®šæ­¤æ—¶åº”è¯¥å¦‚æœç¼©çŸ­åŒºé—´ï¼Œé™¤éåšç‰¹åˆ¤ï¼Œä½†æ˜¯é‚£æ ·å°±éº»çƒ¦äº†</p><h2 id="154-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼-II"><a href="#154-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼-II" class="headerlink" title="154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II"></a><a href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/" target="_blank" rel="noopener">154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II</a></h2><p>å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚</p><p>( ä¾‹å¦‚ï¼Œæ•°ç»„ <code>[0,1,2,4,5,6,7]</code> å¯èƒ½å˜ä¸º <code>[4,5,6,7,0,1,2]</code> )ã€‚</p><p>è¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚</p><p>æ³¨æ„æ•°ç»„ä¸­å¯èƒ½å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>è¿™é“é¢˜æ˜¯ å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ çš„å»¶ä¼¸é¢˜ç›®ã€‚</li><li>å…è®¸é‡å¤ä¼šå½±å“ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å—ï¼Ÿä¼šå¦‚ä½•å½±å“ï¼Œä¸ºä»€ä¹ˆï¼Ÿ  </li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>ç›¸æ¯”ä¸Šä¸€é¢˜æœ‰äº†é‡å¤çš„å…ƒç´ ï¼Œåœ¨è·³è½¬çš„æ—¶å€™éœ€è¦åˆ†æ¸…æ¥šæƒ…å†µï¼Œåœ¨midå’Œä¸­ç‚¹ç›¸ç­‰çš„æ—¶å€™åªæ’é™¤å³è¾¹ç•Œä¸€ä¸ªå…ƒç´ </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMin</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid] > nums[right]){</span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] < nums[right]){</span><br><span class="line">            right=mid;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            right--; <span class="comment">//å’Œå³è¾¹ç•Œç›¸ç­‰,æ— æ³•åˆ¤æ–­,åªç¼©å‡ä¸€æ­¥</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[left];</span><br><span class="line">}</span><br></right){<></span></pre></td></tr></tbody></table></figure></div><h2 id="33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„"><a href="#33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„" class="headerlink" title="33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„"></a><a href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array/" target="_blank" rel="noopener">33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„</a></h2><p>å‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚</p><p>( ä¾‹å¦‚ï¼Œæ•°ç»„ <code>[0,1,2,4,5,6,7]</code> å¯èƒ½å˜ä¸º <code>[4,5,6,7,0,1,2]</code> )ã€‚</p><p>æœç´¢ä¸€ä¸ªç»™å®šçš„ç›®æ ‡å€¼ï¼Œå¦‚æœæ•°ç»„ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ï¼Œåˆ™è¿”å›å®ƒçš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å› <code>-1</code> ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚</p><p>ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ <em>O</em>(log <em>n</em>) çº§åˆ«ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>], target = <span class="number">0</span></span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>], target = <span class="number">3</span></span><br><span class="line">è¾“å‡º: -<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>é¢˜ç›®æ˜ç¡®è¦æ±‚äº†æ—¶é—´å¤æ‚åº¦O(logn)ï¼Œæ‰€ä»¥è‚¯å®šè¿˜æ˜¯è¦äºŒåˆ†ï¼Œå…ˆä¸Šä»£ç å§</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">search2</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> len = nums.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((nums == <span class="keyword">null</span>) || (len <= <span class="number">0</span>)) {</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> lo = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> hi = len - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (lo <= hi) {</span><br><span class="line">            <span class="keyword">int</span> mid = lo + ((hi - lo) / <span class="number">2</span>);</span><br><span class="line">            <span class="comment">// å·¦, å³ æŒ‡çš„æ˜¯æ—‹è½¬ç‚¹å·¦å³</span></span><br><span class="line">            <span class="keyword">if</span> (nums[mid] > target) { <span class="comment">//é¦–å…ˆæ˜¯å¤§äºtargetçš„æƒ…å†µ</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (target < nums[lo]) {</span><br><span class="line">                    <span class="comment">//targetåœ¨å³è¾¹</span></span><br><span class="line">                    <span class="comment">//midæœªçŸ¥è¿˜éœ€è¦åˆ¤æ–­ä¸‹ ç”»ä¸€ä¸ªæŠ˜çº¿å›¾å°±å¾ˆæ¸…æ¥šäº†</span></span><br><span class="line">                    <span class="keyword">if</span> (nums[mid] <= nums[hi]) { <span class="comment">//midä¹Ÿåœ¨å³è¾¹</span></span><br><span class="line">                        hi = mid - <span class="number">1</span>;</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        <span class="comment">//midåœ¨å·¦è¾¹</span></span><br><span class="line">                        lo = mid + <span class="number">1</span>;</span><br><span class="line">                    }</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (target > nums[lo]) {</span><br><span class="line">                    <span class="comment">//è¯´æ˜midåœ¨å·¦è¾¹, targetä¹Ÿåœ¨å·¦è¾¹</span></span><br><span class="line">                    hi = mid - <span class="number">1</span>;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">return</span> lo;</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] < target) { <span class="comment">//å°äºtargetçš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (target < nums[hi]) {</span><br><span class="line">                    <span class="comment">//midåœ¨å³è¾¹ï¼Œtargetåœ¨å³è¾¹</span></span><br><span class="line">                    lo = mid + <span class="number">1</span>;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (target > nums[hi]) {</span><br><span class="line">                    <span class="comment">//targetåœ¨å·¦è¾¹</span></span><br><span class="line">                    <span class="comment">//midæœªçŸ¥è¿˜éœ€è¦åˆ¤æ–­ä¸‹</span></span><br><span class="line">                    <span class="keyword">if</span> (nums[mid] > nums[hi]) { <span class="comment">//midåœ¨å·¦è¾¹</span></span><br><span class="line">                        lo = mid + <span class="number">1</span>;</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        hi = mid - <span class="number">1</span>;</span><br><span class="line">                    }</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">return</span> hi;</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*if(hi>=0&&lo<len&&nums[lo]<nums[hi]){< span></len&&nums[lo]<nums[hi]){<></span><br><span class="line"><span class="comment">                   //åˆ‡æ¢æˆæœ‰åºçš„äºŒåˆ†</span></span><br><span class="line"><span class="comment">                   while(lo<=hi){</span></span><br><span class="line"><span class="comment">                         mid=lo+(hi-lo)/2;</span></span><br><span class="line"><span class="comment">                         if(nums[mid]>target){</span></span><br><span class="line"><span class="comment">                                    hi=mid-1;</span></span><br><span class="line"><span class="comment">                         }else if(nums[mid]<target){< span></target){<></span><br><span class="line"><span class="comment">                                    lo=mid+1;</span></span><br><span class="line"><span class="comment">                       }else return mid;</span></span><br><span class="line"><span class="comment">                   }</span></span><br><span class="line"><span class="comment">            }*/</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br></span></span></pre></td></tr></tbody></table></figure></div><p>1msï¼Œ99% çº¯ifåˆ¤æ–­<strong>target</strong>å’Œ<strong>mid</strong>çš„ä½ç½®ï¼Œç„¶åé€‰æ‹©ç§»åŠ¨<strong>lo</strong>è¿˜æ˜¯<strong>hi</strong>ï¼Œä¸€å¼€å§‹æˆ‘éšä¾¿æ‰¾äº†å‡ ç»„æ•°ç„¶åå°±å¼€å§‹å†™ï¼Œå†™åˆ°åé¢å‘ç°éƒ½æ˜¯bugğŸ˜‚ï¼Œè¿™é‡Œç”»ä¸ªå›¾å¾ˆæ–¹ä¾¿</p><p><img alt="mark" data-src="http://static.imlgw.top///20190507/vQgFb8yle0FH.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>åœ¨é‡Œé¢æ‰¾ç‚¹ä¼šå¾ˆæ¸…æ™°</p><p><strong>è§£æ³•äºŒ</strong></p><p>å½“ç„¶è¿˜æœ‰ä¸€ç§æ›´åŠ ç®€å•ä¹Ÿä¸ç”¨è¿™ä¹ˆå¤æ‚çš„æ–¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> lo=<span class="number">0</span>,hi=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span>  -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> index=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]>=nums[lo]){</span><br><span class="line">            <span class="comment">//å·¦åŠéƒ¨åˆ†æœ‰åº</span></span><br><span class="line">            index=binarySearch(nums,target,lo,mid);</span><br><span class="line">            <span class="comment">//å¯¹å³åŠéƒ¨åˆ†äºŒåˆ†</span></span><br><span class="line">            <span class="keyword">if</span>(index==-<span class="number">1</span>){</span><br><span class="line">                lo=mid+<span class="number">1</span>;</span><br><span class="line">                <span class="comment">//lo-->mid æ²¡æ‰¾åˆ°å°±å¯¹å³åŠéƒ¨åˆ†ç»§ç»­åˆ’åˆ†</span></span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">return</span> index;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]<nums[lo]){< span><br><span class="line">            <span class="comment">//å³åŠéƒ¨åˆ†æœ‰åº</span></span><br><span class="line">            index=binarySearch(nums,target,mid,hi);</span><br><span class="line">            <span class="keyword">if</span>(index==-<span class="number">1</span>){</span><br><span class="line">                hi=mid-<span class="number">1</span>;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">return</span> index;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span>  index;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> target,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]>target){</span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]<target){< span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br></target){<></span></nums[lo]){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªåº”è¯¥æ¯”ä¸Šä¸€ä¸ªæ…¢ä¸€ç‚¹ï¼Œæœ€å¥½æƒ…å†µä¸‹æ˜¯_<strong>O(logN)</strong>_ç›´æ¥å°†<strong>target</strong>åˆ’åˆ†åˆ°æœ‰åºçš„é‚£ä¸€è¾¹ï¼Œå¦‚æœæ²¡åˆ’åˆ†åˆ°æœ‰åºçš„é‚£ä¸€è¾¹å°±ä¼šèŠ±è´¹æ—¶é—´å»äºŒåˆ†å°è¯•åˆ‡å‰²æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯<code>logN+log(N/2)+log(N/4)+...log(N/N)</code> æœ€åæ•´ä½“å¤æ‚åº¦åº”è¯¥æ˜¯<code>O(logN*logN)</code> ï¼Œè™½ç„¶æ¯” <code>logN</code> å¥½å¾ˆå¤šï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç®—æ³•</p><h2 id="34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®"><a href="#34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®" class="headerlink" title="34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®"></a><a href="https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/" target="_blank" rel="noopener">34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</a></h2><p>ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ <code>target</code>ã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p><p>ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ <em>O</em>(log <em>n</em>) çº§åˆ«ã€‚</p><p>å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ï¼Œè¿”å› <code>[-1, -1]</code>ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">5</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">10</span>], target = <span class="number">8</span></span><br><span class="line">è¾“å‡º: [<span class="number">3</span>,<span class="number">4</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">5</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">10</span>], target = <span class="number">6</span></span><br><span class="line">è¾“å‡º: [-<span class="number">1</span>,-<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ—¶é—´å¤æ‚åº¦O(logN)ï¼Œè‚¯å®šè¿˜æ˜¯è¦äºŒåˆ†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸¤æ¬¡äºŒåˆ†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] searchRange(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) {</span><br><span class="line">    <span class="keyword">if</span>(nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{-<span class="number">1</span>,-<span class="number">1</span>};</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{left(nums,target,<span class="number">0</span>,nums.length-<span class="number">1</span>),right(nums,target,<span class="number">0</span>,nums.length-<span class="number">1</span>)};</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//5,7,7,8,8,8,8,10,10</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">left</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> target,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="comment">//System.out.println("lo: "+nums[lo]+"mid: "+nums[mid] +"hi: "+nums[hi]);</span></span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){< span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]>target){</span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(mid><span class="number">0</span>){ <span class="comment">//nums[mid]=target</span></span><br><span class="line">            <span class="keyword">if</span>(nums[mid-<span class="number">1</span>]!=target){</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="comment">//æ§åˆ¶å‘å·¦æ‰¾</span></span><br><span class="line">                hi=mid-<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid; <span class="comment">//0</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">right</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> target,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){< span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]>target){</span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(mid<nums.length-<span class="number">1</nums.length-<span></span>){</target){<></span><br><span class="line">            <span class="keyword">if</span>(nums[mid+<span class="number">1</span>]!=target){</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="comment">//æ§åˆ¶å‘å³æ‰¾</span></span><br><span class="line">                lo=mid+<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid; <span class="comment">//nums.length</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br></target){<></span></pre></td></tr></tbody></table></figure></div><p>1ms ï¼Œ99% æ ¸å¿ƒå°±æ˜¯ä¸¤æ¬¡äºŒåˆ†ï¼Œåˆ†åˆ«å‘å·¦å’Œå‘åäºŒåˆ†æ•´ä¸ªæ•°ç»„ï¼Œ åœ¨ç›¸ç­‰çš„æ—¶å€™å¹¶ä¸è¿”å›ï¼Œå¤šåˆ¤æ–­ä¸€ä¸‹ï¼Œå·¦è¾¹çš„å°±æ§åˆ¶hiå‘å·¦è¾¹ç»§ç»­æ‰¾ï¼Œå³è¾¹å°±æ§åˆ¶loå‘å³è¾¹ç»§ç»­æ‰¾ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªä¸ç­‰äºtargetå°±è¿”å›ï¼Œå’Œä¸Šé¢ä¸€é¢˜ä¸€æ ·éƒ½æ˜¯äºŒåˆ†çš„å˜ç§</p><p><strong>è§£æ³•äºŒ</strong></p><p>ç»Ÿä¸€çš„è§£æ³•ï¼Œä¸Šé¢çš„åšæ³•è™½ç„¶ç›´ç™½ï¼Œä½†æ˜¯æ²¡æœ‰é€šç”¨æ€§ï¼Œè¿™é‡Œå€Ÿé‰´è¯„è®ºåŒºå¤§ä½¬ <a href="https://www.liwei.party/" target="_blank" rel="noopener">liweiwei1419</a>çš„<a href="https://leetcode-cn.com/problems/search-insert-position/solution/te-bie-hao-yong-de-er-fen-cha-fa-fa-mo-ban-python-/" target="_blank" rel="noopener">è®²è§£</a>å†™ä¸€ä¸ªé€šç”¨çš„è§£æ³•ï¼Œä¹‹å‰å†™äºŒåˆ†ä¸€ç›´éƒ½æ˜¯å‡­æ„Ÿè§‰ï¼Œä¸æ³¨æ„ç»†èŠ‚ï¼Œæœ‰é”™è¯¯å°±debugï¼Œä¸œæ”¹ä¸€æ”¹ï¼Œè¥¿æ”¹ä¸€æ”¹ï¼Œç„¶åå°±è¿‡äº†ã€‚ã€‚ã€‚æ¯«æ— ç« æ³•ï¼Œä»¥åè¦ç»Ÿä¸€å†™æ³•äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸¤æ¬¡äºŒåˆ†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] searchRange(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) {</span><br><span class="line">    <span class="keyword">if</span>(nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{-<span class="number">1</span>,-<span class="number">1</span>};</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{left(nums,target,<span class="number">0</span>,nums.length-<span class="number">1</span>),right(nums,target,<span class="number">0</span>,nums.length-<span class="number">1</span>)};</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾å¤§äºç­‰äºtargetçš„ç¬¬ä¸€ä¸ªå…ƒç´ ,å°äºè‚¯å®šä¸ç¬¦åˆ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">left</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> target,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(lo<hi){< span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){ <span class="comment">//æ’é™¤å°äºtargetçš„,å‰©ä¸‹ã€lo,hiã€‘éƒ½æ˜¯å¤§äºç­‰äºçš„</target){></span></hi){<></span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            hi=mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[hi]==target?hi:-<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾å°äºç­‰äºtargetçš„æœ€åä¸€ä¸ªå…ƒç´ ,å¤§äºè‚¯å®šä¸ç¬¦åˆ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">right</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> target,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(lo<hi){< span><br><span class="line">        <span class="comment">//é€‰å–å³ä¸­å€¼</span></span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]>target){ <span class="comment">//æ’é™¤å¤§äºtarget,å‰©ä¸‹[lo,hi]éƒ½æ˜¯å°äºç­‰äºçš„</span></span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//æ ¹æ®è¿™ä¸ªåˆ¤æ–­éœ€è¦é€‰å–å³ä¸­å€¼</span></span><br><span class="line">            lo=mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[hi]==target?hi:-<span class="number">1</span>;</span><br><span class="line">}</span><br></hi){<></span></pre></td></tr></tbody></table></figure></div><h2 id="287-å¯»æ‰¾é‡å¤æ•°"><a href="#287-å¯»æ‰¾é‡å¤æ•°" class="headerlink" title="287. å¯»æ‰¾é‡å¤æ•°"></a><a href="https://leetcode-cn.com/problems/find-the-duplicate-number/" target="_blank" rel="noopener">287. å¯»æ‰¾é‡å¤æ•°</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å« n + 1 ä¸ªæ•´æ•°çš„æ•°ç»„ <code>nums</code>ï¼Œå…¶æ•°å­—éƒ½åœ¨ 1 åˆ° n ä¹‹é—´ï¼ˆåŒ…æ‹¬ 1 å’Œ nï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚å‡è®¾åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•´æ•°ï¼Œæ‰¾å‡ºè¿™ä¸ªé‡å¤çš„æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>ä¸èƒ½æ›´æ”¹åŸæ•°ç»„ï¼ˆå‡è®¾æ•°ç»„æ˜¯åªè¯»çš„ï¼‰ã€‚</li><li>åªèƒ½ä½¿ç”¨é¢å¤–çš„ O(1) çš„ç©ºé—´ã€‚</li><li>æ—¶é—´å¤æ‚åº¦å°äº O(n2) ã€‚</li><li>æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•°å­—ï¼Œä½†å®ƒå¯èƒ½ä¸æ­¢é‡å¤å‡ºç°ä¸€æ¬¡ </li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œé¢˜ç›®è¦æ±‚äº†æ•°ç»„numsæ˜¯åªè¯»çš„ï¼Œä¸”ä¸èƒ½ä½¿ç”¨é¢å¤–çš„ç©ºé—´ï¼Œä¸”æ—¶é—´å¤æ‚åº¦è¿˜è¦å°äºO(N^2)ï¼Œå¦åˆ™çš„è¯å…¶å®å¯ä»¥æ’åºï¼Œæˆ–è€…ä½¿ç”¨Hashè¡¨æ¥åšï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äºŒåˆ†æ¥åš</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">1</span>,right=nums.length-<span class="number">1</span>; <span class="comment">//å·¦å³è¾¹ç•Œ</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œå®é™…ä¸Šæ˜¯å¯¹ã€1,2,3,4,...n-1ã€‘è¿™ä¸ªåŒºé—´è¿›è¡ŒäºŒåˆ†</span></span><br><span class="line">    <span class="comment">//åœ¨è¿‡ç¨‹ä¸­å¯¹midæ£€æµ‹æ¯ä¸ªæ•°åœ¨numsæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="comment">//1 3 4 2 2å®é™…ä¸Šæ˜¯å¯¹ã€1,2,3,4ã€‘åŒºé—´è¿›è¡ŒäºŒåˆ†</span></span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> temp=count(nums,mid);</span><br><span class="line">        <span class="comment">//æ’é™¤ä¸­ä½æ•°,å°äºmidçš„æ•°<=mid,ä¸€å®šä¸æ˜¯,è¯´æ˜é‡å¤å…ƒç´ ä¸€å®šåœ¨å³è¾¹</span></span><br><span class="line">        <span class="keyword">if</span>(temp<=mid){ <span class="comment">//1 2 3 4</span></span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            right=mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//n-1ä¸ªæ•´æ•° , 1~næœ‰nä¸ªæ•°     </span></span><br><span class="line"><span class="comment">//1 2 2 3 4     1~4ä¹‹é—´, 1 2 3 4</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> n)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (nums[i]<=n) {</span><br><span class="line">            res++;          </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums.length;i++)></span></right){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·çš„è§£æ³•è¿˜æ˜¯å¾ˆå·§å¦™çš„ï¼Œå¯¹numsæ•°ç»„çš„<strong>å–å€¼èŒƒå›´</strong>è¿›è¡ŒäºŒåˆ†ï¼ŒäºŒåˆ†çš„æ ¸å¿ƒå°±æ˜¯ï¼Œnumsæ•°ç»„ä¸­ï¼Œå°äºå–å€¼èŒƒå›´ä¸­midçš„å…ƒç´ åº”è¯¥å°äºç­‰äºmid</p><p>ä¸¾ä¸ªä¾‹å­ï¼š<code>[1 3 4 2 2]</code> å–å€¼èŒƒå›´æ˜¯<code>[1 2 3 4]</code> ï¼Œå–ä¸­ç‚¹2ï¼Œæ­£å¸¸æƒ…å†µä¸‹numsä¸­å°äºç­‰äº2çš„å…ƒç´ ï¼Œåº”è¯¥æœ€å¤šæœ‰2ä¸ªï¼Œä¹Ÿå°±æ˜¯<code>[1 2]</code>2ä¸ªï¼Œä½†æ˜¯è¿™é‡Œåœ¨numsä¸­ï¼Œæœ‰3ä¸ª<code>[1 2 2]</code> å¤§äº2äº†ï¼Œè¿™å°±è¯´æ˜ä¸€å®šæœ‰é‡å¤çš„å…ƒç´ ï¼Œè€Œä¸”ä¸€å®šæ˜¯å°äºä¸­ç‚¹2çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨å·¦åŠè¾¹ï¼Œä¸‹ä¸€æ­¥å°±åº”è¯¥èˆå¼ƒå³åŠè¾¹ï¼Œåœ¨<code>[1,2]</code>ä¸­ç»§ç»­æŸ¥æ‰¾ </p><p>è¿™é‡ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„æ¨¡æ¿æ¥å†™ï¼Œå…ˆæ‰¾æ’é™¤midçš„æ¡ä»¶ï¼Œ<strong>åœ¨numsä¸­å°äºmidçš„å…ƒç´ çš„æ•°é‡å°äºç­‰äºmidçš„æ—¶å€™ï¼ŒåŒ…æ‹¬midåœ¨å†…çš„å³è¾¹ç•Œéƒ½ä¼šè¢«æ’é™¤ï¼Œè‚¯å®šéƒ½ä¸æ˜¯é‡å¤çš„å…ƒç´ </strong> ï¼Œç„¶åå°±æŒ‰ç…§æ¨¡æ¿å†™å‡ºäºŒåˆ†å°±è¡Œäº†</p><p><strong>è§£æ³•äºŒ</strong></p><p>å¿«æ…¢æŒ‡é’ˆçš„åšæ³•ï¼ŒæŠ€å·§æ€§å¾ˆå¼ºï¼Œä¸€èˆ¬äººç¬¬ä¸€æ¬¡åšæ˜¯å¾ˆéš¾æƒ³åˆ°è¿™ç§åšæ³•çš„ï¼Œå…¶å®å’Œ <a href="http://imlgw.top/2019/02/27/leetcode-lian-biao-tag/#141-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8">é“¾è¡¨ä¸“é¢˜</a> ä¸­çš„ç¯å½¢é“¾è¡¨æ˜¯ä¸€æ ·çš„åšæ³•ï¼Œç„¶åæŒ‰ç…§é‚£ä¸ªæ€è·¯èµ°å°±è¡Œäº†ï¼Œä¸æ¸…æ¥šåŸç†å¯ä»¥çœ‹çœ‹ä¸Šé¢ç¯å½¢é“¾è¡¨çš„è§£æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> slow=<span class="number">0</span>,fast=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">boolean</span> isMeet=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>){</span><br><span class="line">        fast=isMeet?nums[fast]:nums[nums[fast]];</span><br><span class="line">        slow=nums[slow];</span><br><span class="line">        <span class="keyword">if</span> (fast==slow) {</span><br><span class="line">            <span class="keyword">if</span> (isMeet) {</span><br><span class="line">                <span class="keyword">return</span> slow;</span><br><span class="line">            }</span><br><span class="line">            fast=<span class="number">0</span>;</span><br><span class="line">            isMeet=<span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§è§£æ³•çš„å…³é”®æ˜¯å°†æ•°ç»„å€¼çœ‹ä½œç´¢å¼•ç„¶åå†æ•°ç»„åƒé“¾è¡¨ä¸€æ ·ç§»åŠ¨ï¼Œæ¯”å¦‚ <code>[1,2,3,4,5,6,7,8,9,5]</code>ç”¨å€¼ä½œä¸ºç´¢å¼•è¿æ¥èµ·æ¥å°±æ˜¯<code>1 2 3 4 [5 6 7 8 9] [5 6 7 8 9] ....</code> ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(N)</code> æŠ€å·§æ€§æ¯”è¾ƒå¼ºï¼Œå¦‚æœé¢è¯•ç®¡ä¸è¿½é—®çš„è¯å…¶å®ç­”å‡ºä¸Šé¢çš„äºŒåˆ†å°±okäº†</p><h2 id="852-å±±è„‰æ•°ç»„çš„å³°é¡¶ç´¢å¼•"><a href="#852-å±±è„‰æ•°ç»„çš„å³°é¡¶ç´¢å¼•" class="headerlink" title="852. å±±è„‰æ•°ç»„çš„å³°é¡¶ç´¢å¼•"></a><a href="https://leetcode-cn.com/problems/peak-index-in-a-mountain-array/" target="_blank" rel="noopener">852. å±±è„‰æ•°ç»„çš„å³°é¡¶ç´¢å¼•</a></h2><p>æˆ‘ä»¬æŠŠç¬¦åˆä¸‹åˆ—å±æ€§çš„æ•°ç»„ A ç§°ä½œå±±è„‰ï¼š</p><ul><li>A.length >= 3</li><li>å­˜åœ¨ 0 < i < A.length - 1 ä½¿å¾—A[0] < A[1] < â€¦ A[i-1] < A[i] > A[i+1] > â€¦ > A[A.length - 1]</li></ul><p>ç»™å®šä¸€ä¸ªç¡®å®šä¸ºå±±è„‰çš„æ•°ç»„ï¼Œè¿”å›ä»»ä½•æ»¡è¶³ <code>A[0] < A[1] < ... A[i-1] < A[i] > A[i+1] > ... > A[A.length - 1]</code> çš„ i çš„å€¼ã€‚</p><p> <strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å…¶å®è¿˜æ˜¯ä¸Šé¢çš„æ¨¡æ¿ï¼Œåªä¸è¿‡åšäº†ä¸€ç‚¹ç‚¹æ”¹åŠ¨è€Œå·²ï¼Œå¾ˆå‚»é€¼çš„WAäº†ä¸€å‘ï¼Œæˆ‘ä¹Ÿæ˜¯æœäº†è‡ªå·±äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">peakIndexInMountainArray</span><span class="params">(<span class="keyword">int</span>[] A)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=A.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="comment">//System.out.println(mid);</span></span><br><span class="line">        <span class="keyword">if</span> (mid><span class="number">0</span> && mid<a.length && a[mid]> A[mid-<span class="number">1</span>] && A[mid]<a[mid+<span class="number">1</a[mid+<span></a.length></span>]) {</right){<></span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (mid><span class="number">0</span> && mid<a.length && a[mid]< a[mid-<span class="number">1</a.length></span>] && A[mid]>A[mid+<span class="number">1</span>]){<br><span class="line">            right=mid-<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="1283-ä½¿ç»“æœä¸è¶…è¿‡é˜ˆå€¼çš„æœ€å°é™¤æ•°"><a href="#1283-ä½¿ç»“æœä¸è¶…è¿‡é˜ˆå€¼çš„æœ€å°é™¤æ•°" class="headerlink" title="1283. ä½¿ç»“æœä¸è¶…è¿‡é˜ˆå€¼çš„æœ€å°é™¤æ•°"></a><a href="https://leetcode-cn.com/problems/find-the-smallest-divisor-given-a-threshold/" target="_blank" rel="noopener">1283. ä½¿ç»“æœä¸è¶…è¿‡é˜ˆå€¼çš„æœ€å°é™¤æ•°</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ­£æ•´æ•° <code>threshold</code>  ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªæ­£æ•´æ•°ä½œä¸ºé™¤æ•°ï¼Œç„¶åå°†æ•°ç»„é‡Œæ¯ä¸ªæ•°éƒ½é™¤ä»¥å®ƒï¼Œå¹¶å¯¹é™¤æ³•ç»“æœæ±‚å’Œã€‚</p><p>è¯·ä½ æ‰¾å‡ºèƒ½å¤Ÿä½¿ä¸Šè¿°ç»“æœå°äºç­‰äºé˜ˆå€¼ <code>threshold</code> çš„é™¤æ•°ä¸­ æœ€å° çš„é‚£ä¸ªã€‚</p><p>æ¯ä¸ªæ•°é™¤ä»¥é™¤æ•°åéƒ½å‘ä¸Šå–æ•´ï¼Œæ¯”æ–¹è¯´ 7/3 = 3 ï¼Œ 10/2 = 5 ã€‚</p><p>é¢˜ç›®ä¿è¯ä¸€å®šæœ‰è§£ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">9</span>], threshold = <span class="number">6</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">5</span></span><br><span class="line">è§£é‡Šï¼šå¦‚æœé™¤æ•°ä¸º <span class="number">1</span> ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å’Œä¸º <span class="number">17</span> ï¼ˆ<span class="number">1</span>+<span class="number">2</span>+<span class="number">5</span>+<span class="number">9</span>ï¼‰ã€‚</span><br><span class="line">å¦‚æœé™¤æ•°ä¸º <span class="number">4</span> ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å’Œä¸º <span class="number">7</span> (<span class="number">1</span>+<span class="number">1</span>+<span class="number">2</span>+<span class="number">3</span>) ã€‚å¦‚æœé™¤æ•°ä¸º <span class="number">5</span> ï¼Œå’Œä¸º <span class="number">5</span> (<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">2</span>)ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>], threshold = <span class="number">11</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [<span class="number">19</span>], threshold = <span class="number">5</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= nums.length <= 5 * 10^4</code></li><li><code>1 <= nums[i] <= 10^6</code></li><li><code>nums.length <= threshold <= 10^6</code></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å‘¨èµ›çš„é¢˜ï¼Œå¤ªè ¢äº†ï¼Œæ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">smallestDivisor</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> threshold)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">1</span>,right=<span class="number">1000000</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">            sum+=(nums[i]+mid-<span class="number">1</span>)/mid; <span class="comment">//å‘ä¸Šå–æ•´</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (sum>threshold) {</span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            right=mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">}</span><br></nums.length;i++)></span></right){<></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®åªè¦æ˜ç¡®ä¸€ç‚¹è¿™é¢˜å°±å¾ˆå®¹æ˜“æƒ³åˆ°äºŒåˆ†ï¼Œè§£ç©ºé—´ä¸ºï¼š<code>[1ï¼Œmax(nums[i])]</code> æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªåŒºé—´ä¹‹å†…åšäºŒåˆ†æœç´¢å°±okäº†ï¼Œå†ç„¶åå°±æ˜¯å‘ä¸Šå–æ•´çš„ä¸€ä¸ªå°æŠ€å·§</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> äºŒåˆ† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †å’Œä¼˜å…ˆé˜Ÿåˆ—</title>
      <link href="/2019/12/01/dui-he-you-xian-dui-lie/"/>
      <url>/2019/12/01/dui-he-you-xian-dui-lie/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ï¼Œå †å®é™…ä¸Šæ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼Œå€ŸåŠ©<strong>å®Œå…¨äºŒå‰æ ‘</strong>çˆ¶å­èŠ‚ç‚¹å…³ç³»çš„æ€§è´¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨æ•°ç»„ä¸­å®ç°è¿™ä¸€ç»“æ„ï¼Œè€Œå †ä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å¤§æ ¹å †ï¼Œé¡¾åæ€ä¹‰ä¹Ÿå°±æ˜¯çˆ¶èŠ‚ç‚¹valueå¤§äºå­èŠ‚ç‚¹valueï¼Œå°æ ¹å †åˆ™ç›¸å</p><h3 id="åŠ¨æ€æ•°ç»„"><a href="#åŠ¨æ€æ•°ç»„" class="headerlink" title="åŠ¨æ€æ•°ç»„"></a>åŠ¨æ€æ•°ç»„</h3><p>å€ŸåŠ©è¿™ä¸ªç±»å®ç°å †ç»“æ„ï¼Œç›´æ¥ç”¨<code>ArrayList</code>ä¹Ÿå¯ä»¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Array</span><<span class="title">E</span>> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œä¼ å…¥æ•°ç»„çš„å®¹é‡capacityæ„é€ Array</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">(<span class="keyword">int</span> capacity)</span></span>{</span><br><span class="line">        data = (E[])<span class="keyword">new</span> Object[capacity];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ— å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œé»˜è®¤æ•°ç»„çš„å®¹é‡capacity=10</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ•°ç»„çš„å®¹é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCapacity</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> data.length;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›æ•°ç»„æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨indexç´¢å¼•çš„ä½ç½®æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(index < <span class="number">0</span> || index > size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Add failed. Require index >= 0 and index <= size."</span>);</span><br><span class="line">        <span class="keyword">if</span>(size == data.length)</span><br><span class="line">            resize(<span class="number">2</span> * data.length); <span class="comment">//2å€æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = size - <span class="number">1</span>; i >= index ; i --){</span><br><span class="line">            data[i + <span class="number">1</span>] = data[i];</span><br><span class="line">        }</span><br><span class="line">        data[index] = e;</span><br><span class="line">        size ++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘æ‰€æœ‰å…ƒç´ åæ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span></span>{</span><br><span class="line">        add(size, e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨æ‰€æœ‰å…ƒç´ å‰æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span></span>{</span><br><span class="line">        add(<span class="number">0</span>, e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–indexç´¢å¼•ä½ç½®çš„å…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(index < <span class="number">0</span> || index >= size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Get failed. Index is illegal."</span>);</span><br><span class="line">        <span class="keyword">return</span> data[index];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿®æ”¹indexç´¢å¼•ä½ç½®çš„å…ƒç´ ä¸ºe</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(index < <span class="number">0</span> || index >= size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Set failed. Index is illegal."</span>);</span><br><span class="line">        data[index] = e;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾æ•°ç»„ä¸­æ˜¯å¦æœ‰å…ƒç´ e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span></span>{</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i < size ; i ++){</span><br><span class="line">            <span class="keyword">if</span>(data[i].equals(e))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾æ•°ç»„ä¸­å…ƒç´ eæ‰€åœ¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨å…ƒç´ eï¼Œåˆ™è¿”å›-1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(E e)</span></span>{</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i < size ; i ++){</span><br><span class="line">            <span class="keyword">if</span>(data[i].equals(e))</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ•°ç»„ä¸­åˆ é™¤indexä½ç½®çš„å…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(index < <span class="number">0</span> || index >= size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Remove failed. Index is illegal."</span>);</span><br><span class="line"></span><br><span class="line">        E ret = data[index];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = index + <span class="number">1</span> ; i < size ; i ++)</span><br><span class="line">            data[i - <span class="number">1</span>] = data[i];</span><br><span class="line">        size --;</span><br><span class="line">        data[size] = <span class="keyword">null</span>; <span class="comment">// loitering objects != memory leak</span></span><br><span class="line">        <span class="comment">//æ•°æ®ä¸åˆ°1/4çš„æ—¶å€™ç¼©å‡</span></span><br><span class="line">        <span class="keyword">if</span>(size == data.length / <span class="number">4</span> && data.length / <span class="number">2</span> != <span class="number">0</span>)</span><br><span class="line">            resize(data.length / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ•°ç»„ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> remove(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ•°ç»„ä¸­åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeLast</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> remove(size - <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeElement</span><span class="params">(E e)</span></span>{</span><br><span class="line">        <span class="keyword">int</span> index = find(e);</span><br><span class="line">        <span class="keyword">if</span>(index != -<span class="number">1</span>)</span><br><span class="line">            remove(index);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//äº¤æ¢</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (a<<span class="number">0</span>||a>=size || b<<span class="number">0</span>||b>=size) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"index illegal"</span>);</span><br><span class="line">        }</span><br><span class="line">        E temp=data[a];</span><br><span class="line">        data[a]=data[b];</span><br><span class="line">        data[b]=temp;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        res.append(String.format(<span class="string">"Array: size = %d , capacity = %d\n"</span>, size, data.length));</span><br><span class="line">        res.append(<span class="string">'['</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i < size ; i ++){</span><br><span class="line">            res.append(data[i]);</span><br><span class="line">            <span class="keyword">if</span>(i != size - <span class="number">1</span>)</span><br><span class="line">                res.append(<span class="string">", "</span>);</span><br><span class="line">        }</span><br><span class="line">        res.append(<span class="string">']'</span>);</span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ•°ç»„ç©ºé—´çš„å®¹é‡å˜æˆnewCapacityå¤§å°</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span></span>{</span><br><span class="line">        E[] newData = (E[])<span class="keyword">new</span> Object[newCapacity];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i < size ; i ++)</span><br><span class="line">            newData[i] = data[i];</span><br><span class="line">        data = newData;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="å¤§æ ¹å †"><a href="#å¤§æ ¹å †" class="headerlink" title="å¤§æ ¹å †"></a>å¤§æ ¹å †</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MaxHeap</span><<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span><<span class="title">E</span>>></span>{</span><br><span class="line">    <span class="keyword">private</span> Array<e> data;</e></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">(<span class="keyword">int</span> capacity)</span></span>{</span><br><span class="line">        data=<span class="keyword">new</span> Array<>(capacity);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">()</span></span>{</span><br><span class="line">        data=<span class="keyword">new</span> Array<>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> data.getSize();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> data.isEmpty();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">parent</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index==<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"index 0 don't have parent"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> (index-<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å·¦å­©å­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">leftChild</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> index*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å³å­©å­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">rightChild</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> index*<span class="number">2</span>+<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span></span>{</span><br><span class="line">        data.addLast(e);</span><br><span class="line">        siftUp(data.getSize()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸Šæµ®</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span> cur)</span></span>{</span><br><span class="line">        <span class="keyword">while</span>(cur><span class="number">0</span> && data.get(parent(cur)).compareTo(data.get(cur)) < <span class="number">0</span>){</span><br><span class="line">            data.swap(cur,parent(cur));</span><br><span class="line">            cur=parent(cur);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">findMax</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (data.getSize()==<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"heap is empty !!!"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span>  data.get(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">popMax</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (data.getSize()==<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"heap is empty !!!"</span>);</span><br><span class="line">        }</span><br><span class="line">        E res=findMax();</span><br><span class="line">        data.swap(<span class="number">0</span>,data.getSize()-<span class="number">1</span>);</span><br><span class="line">        data.removeLast();</span><br><span class="line">        siftDown(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span> cur)</span></span>{</span><br><span class="line">        <span class="keyword">while</span>(leftChild(cur)<data.getsize()){ <span class="comment">//æœ‰å·¦å­©å­</data.getsize()){></span><br><span class="line">            <span class="keyword">int</span> large=leftChild(cur);</span><br><span class="line">            <span class="comment">//å¦‚æœä¹Ÿæœ‰å³å­©å­,å°±æ¯”è¾ƒä¸‹ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼å–æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (large+<span class="number">1</span><data.getsize() && data.get(large).compareto(data.get(large+<span class="number">1</data.getsize()></span>))<<span class="number">0</span>) {<br><span class="line">                large=large+<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æ¯”å·¦å³å­©å­éƒ½å¤§å°±ç›´æ¥ç»“æŸäº†</span></span><br><span class="line">            <span class="keyword">if</span> (data.get(large).compareTo(data.get(cur))<=<span class="number">0</span>){</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            data.swap(large,cur);</span><br><span class="line">            cur=large;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®ä¸Šé¢çš„å®ç°è¿˜æ˜¯æœ‰ä¸€äº›ç¼ºé™·çš„ï¼Œåªèƒ½æŒ‰ç…§ç»™å®šçš„é”®çš„é»˜è®¤æ’åºè§„åˆ™è¿›è¡Œæ¯”è¾ƒï¼Œä¸æ–¹ä¾¿å®ç°è‡ªå®šä¹‰çš„æ¯”è¾ƒè§„åˆ™ï¼Œéœ€è¦è¿›è¡Œå°è£…æ‰å¯ä»¥ï¼Œå…³äºè¿™ä¸€ç‚¹å…¶å®å¯ä»¥å€Ÿé‰´Javaä¸­çš„<code>PriorityQueue</code></p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapTest</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span>[] nums=generateRandomArray(<span class="number">50000000</span>,<span class="number">500</span>);</span><br><span class="line">        MaxHeap heap=<span class="keyword">new</span> MaxHeap();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">            heap.add(nums[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">            nums[i]=(<span class="keyword">int</span>)heap.popMax();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">            <span class="keyword">if</span> (nums[i-<span class="number">1</span>]<nums[i]) {< span><br><span class="line">                System.out.println(<span class="string">"fuxk!!!"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"sucess!!!!!"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] generateRandomArray(<span class="keyword">int</span> maxSize, <span class="keyword">int</span> maxValue) {</span><br><span class="line">        <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[(<span class="keyword">int</span>) ((maxSize + <span class="number">1</span>) * Math.random())];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < arr.length; i++) {</span><br><span class="line">            arr[i] = (<span class="keyword">int</span>) ((maxValue + <span class="number">1</span>) * Math.random()) - (<span class="keyword">int</span>) (maxValue * Math.random());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums[i])></span></nums.length;i++)></span></nums.length;i++)></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"><span class="keyword">import</span> sun.misc.SharedSecrets;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An unbounded priority {<span class="doctag">@linkplain</span> Queue queue} based on a priority heap.</span></span><br><span class="line"><span class="comment"> * The elements of the priority queue are ordered according to their</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@linkplain</span> Comparable natural ordering}, or by a {<span class="doctag">@link</span> Comparator}</span></span><br><span class="line"><span class="comment"> * provided at queue construction time, depending on which constructor is</span></span><br><span class="line"><span class="comment"> * used.  A priority queue does not permit {<span class="doctag">@code</span> null} elements.</span></span><br><span class="line"><span class="comment"> * A priority queue relying on natural ordering also does not permit</span></span><br><span class="line"><span class="comment"> * insertion of non-comparable objects (doing so may result in</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> ClassCastException}).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <p>The <em>head</em> of this queue is the <em>least</em> element<br><span class="line"><span class="comment"> * with respect to the specified ordering.  If multiple elements are</span></span><br><span class="line"><span class="comment"> * tied for least value, the head is one of those elements -- ties are</span></span><br><span class="line"><span class="comment"> * broken arbitrarily.  The queue retrieval operations {<span class="doctag">@code</span> poll},</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> remove}, {<span class="doctag">@code</span> peek}, and {<span class="doctag">@code</span> element} access the</span></span><br><span class="line"><span class="comment"> * element at the head of the queue.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span></p><p>A priority queue is unbounded, but has an internal<br><span class="line"><span class="comment"> * <i>capacity</i> governing the size of an array used to store the</span></span><br><span class="line"><span class="comment"> * elements on the queue.  It is always at least as large as the queue</span></span><br><span class="line"><span class="comment"> * size.  As elements are added to a priority queue, its capacity</span></span><br><span class="line"><span class="comment"> * grows automatically.  The details of the growth policy are not</span></span><br><span class="line"><span class="comment"> * specified.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span></p><p>This class and its iterator implement all of the<br><span class="line"><span class="comment"> * <em>optional</em> methods of the {<span class="doctag">@link</span> Collection} and {<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * Iterator} interfaces.  The Iterator provided in method {<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * #iterator()} is <em>not</em> guaranteed to traverse the elements of</span></span><br><span class="line"><span class="comment"> * the priority queue in any particular order. If you need ordered</span></span><br><span class="line"><span class="comment"> * traversal, consider using {<span class="doctag">@code</span> Arrays.sort(pq.toArray())}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span></p><p><strong>Note that this implementation is not synchronized.</strong><br><span class="line"><span class="comment"> * Multiple threads should not access a {<span class="doctag">@code</span> PriorityQueue}</span></span><br><span class="line"><span class="comment"> * instance concurrently if any of the threads modifies the queue.</span></span><br><span class="line"><span class="comment"> * Instead, use the thread-safe {<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * java.util.concurrent.PriorityBlockingQueue} class.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span></p><p>Implementation note: this implementation provides<br><span class="line"><span class="comment"> * O(log(n)) time for the enqueuing and dequeuing methods</span></span><br><span class="line"><span class="comment"> * ({<span class="doctag">@code</span> offer}, {<span class="doctag">@code</span> poll}, {<span class="doctag">@code</span> remove()} and {<span class="doctag">@code</span> add});</span></span><br><span class="line"><span class="comment"> * linear time for the {<span class="doctag">@code</span> remove(Object)} and {<span class="doctag">@code</span> contains(Object)}</span></span><br><span class="line"><span class="comment"> * methods; and constant time for the retrieval methods</span></span><br><span class="line"><span class="comment"> * ({<span class="doctag">@code</span> peek}, {<span class="doctag">@code</span> element}, and {<span class="doctag">@code</span> size}).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span></p><p>This class is a member of the<br><span class="line"><span class="comment"> * <a href="{<span class=" doctag">@docRoot</a></span><a href="{<span class=" doctag">}/../technotes/guides/collections/index.html"></a></span><a href="{<span class=" doctag"><br><span class="line"><span class="comment"> * Java Collections Framework</span></span></a>.<br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Josh Bloch, Doug Lea</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <e> the type of elements held in this collection</e></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span><<span class="title">E</span>> <span class="keyword">extends</span> <span class="title">AbstractQueue</span><<span class="title">E</span>></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">7720805057305804111L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Priority queue represented as a balanced binary heap: the two</span></span><br><span class="line"><span class="comment">     * children of queue[n] are queue[2*n+1] and queue[2*(n+1)].  The</span></span><br><span class="line"><span class="comment">     * priority queue is ordered by comparator, or by the elements'</span></span><br><span class="line"><span class="comment">     * natural ordering, if comparator is null: For each node n in the</span></span><br><span class="line"><span class="comment">     * heap and each descendant d of n, n <= d.  The element with the</span></span><br><span class="line"><span class="comment">     * lowest value is in queue[0], assuming the queue is nonempty.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> Object[] queue; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of elements in the priority queue.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The comparator, or null if priority queue uses elements'</span></span><br><span class="line"><span class="comment">     * natural ordering.</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ²¡æœ‰ä¼ å…¥æ¯”è¾ƒå™¨çš„è¯ï¼ŒæŒ‰ç…§å…ƒç´ çš„è‡ªç„¶æ’åºè¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator<!--? <span class="keyword"-->super</span> E> comparator;<br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of times this priority queue has been</span></span><br><span class="line"><span class="comment">     * <i>structurally modified</i>.  See AbstractList for gory details.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a {<span class="doctag">@code</span> PriorityQueue} with the default initial</span></span><br><span class="line"><span class="comment">     * capacity (11) that orders its elements according to their</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@linkplain</span> Comparable natural ordering}.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(DEFAULT_INITIAL_CAPACITY, <span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(initialCapacity, <span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä¼ å…¥è‡ªå®šä¹‰çš„æ¯”è¾ƒè§„åˆ™</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(Comparator<!--? <span class="keyword"-->super</span> E> comparator)</span> </span>{<br><span class="line">        <span class="keyword">this</span>(DEFAULT_INITIAL_CAPACITY, comparator);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(<span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="function"><span class="params">                         Comparator<!--? <span class="keyword"-->super</span> E> comparator)</span> </span>{<br><span class="line">        <span class="comment">// Note: This restriction of at least one is not actually needed,</span></span><br><span class="line">        <span class="comment">// but continues for 1.5 compatibility</span></span><br><span class="line">        <span class="keyword">if</span> (initialCapacity < <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">this</span>.queue = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">        <span class="keyword">this</span>.comparator = comparator;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a {<span class="doctag">@code</span> PriorityQueue} containing the elements in the</span></span><br><span class="line"><span class="comment">     * specified collection.  If the specified collection is an instance of</span></span><br><span class="line"><span class="comment">     * a {<span class="doctag">@link</span> SortedSet} or is another {<span class="doctag">@code</span> PriorityQueue}, this</span></span><br><span class="line"><span class="comment">     * priority queue will be ordered according to the same ordering.</span></span><br><span class="line"><span class="comment">     * Otherwise, this priority queue will be ordered according to the</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@linkplain</span> Comparable natural ordering} of its elements.</span></span><br><span class="line"><span class="comment">     * ä¼ å…¥ä¸€ä¸ªé›†åˆç±»å‹ï¼Œå¦‚æœæ˜¯SortSetï¼ˆæœ‰åºï¼‰ç±»å‹çš„é›†åˆæˆ–è€…ä¹Ÿæ˜¯PriorityQueueå°±ä¼šæŒ‰ç…§ç›¸åŒçš„è§„åˆ™å»æ¯”è¾ƒã€‚</span></span><br><span class="line"><span class="comment">     * å¦åˆ™å°±ä¼šæŒ‰ç…§å…ƒç´ çš„è‡ªç„¶æ’åºè§„åˆ™å»æ¯”è¾ƒã€‚</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  c the collection whose elements are to be placed</span></span><br><span class="line"><span class="comment">     *         into this priority queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassCastException if elements of the specified collection</span></span><br><span class="line"><span class="comment">     *         cannot be compared to one another according to the priority</span></span><br><span class="line"><span class="comment">     *         queue's ordering</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified collection or any</span></span><br><span class="line"><span class="comment">     *         of its elements are null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(Collection<!--? extends E--> c)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (c <span class="keyword">instanceof</span> SortedSet<!--?-->) {</span><br><span class="line">            SortedSet<!--? extends E--> ss = (SortedSet<!--? extends E-->) c;</span><br><span class="line">            <span class="comment">//æ‹¿åˆ°SortSeté›†åˆä¸­å…ƒç´ çš„æ¯”è¾ƒå™¨ï¼Œç”¨äºååºçš„æ“ä½œ</span></span><br><span class="line">            <span class="keyword">this</span>.comparator = (Comparator<!--? <span class="keyword"-->super</span> E>) ss.comparator();<br><span class="line">            initElementsFromCollection(ss);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (c <span class="keyword">instanceof</span> PriorityQueue<!--?-->) {</span><br><span class="line">            PriorityQueue<!--? extends E--> pq = (PriorityQueue<!--? extends E-->) c;</span><br><span class="line">            <span class="keyword">this</span>.comparator = (Comparator<!--? <span class="keyword"-->super</span> E>) pq.comparator();<br><span class="line">            initFromPriorityQueue(pq);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">this</span>.comparator = <span class="keyword">null</span>;</span><br><span class="line">            initFromCollection(c);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a {<span class="doctag">@code</span> PriorityQueue} containing the elements in the</span></span><br><span class="line"><span class="comment">     * specified priority queue.  This priority queue will be</span></span><br><span class="line"><span class="comment">     * ordered according to the same ordering as the given priority</span></span><br><span class="line"><span class="comment">     * queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  c the priority queue whose elements are to be placed</span></span><br><span class="line"><span class="comment">     *         into this priority queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassCastException if elements of {<span class="doctag">@code</span> c} cannot be</span></span><br><span class="line"><span class="comment">     *         compared to one another according to {<span class="doctag">@code</span> c}'s</span></span><br><span class="line"><span class="comment">     *         ordering</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified priority queue or any</span></span><br><span class="line"><span class="comment">     *         of its elements are null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(PriorityQueue<!--? extends E--> c)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.comparator = (Comparator<!--? <span class="keyword"-->super</span> E>) c.comparator();<br><span class="line">        initFromPriorityQueue(c);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a {<span class="doctag">@code</span> PriorityQueue} containing the elements in the</span></span><br><span class="line"><span class="comment">     * specified sorted set.   This priority queue will be ordered</span></span><br><span class="line"><span class="comment">     * according to the same ordering as the given sorted set.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  c the sorted set whose elements are to be placed</span></span><br><span class="line"><span class="comment">     *         into this priority queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassCastException if elements of the specified sorted</span></span><br><span class="line"><span class="comment">     *         set cannot be compared to one another according to the</span></span><br><span class="line"><span class="comment">     *         sorted set's ordering</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified sorted set or any</span></span><br><span class="line"><span class="comment">     *         of its elements are null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(SortedSet<!--? extends E--> c)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.comparator = (Comparator<!--? <span class="keyword"-->super</span> E>) c.comparator();<br><span class="line">        initElementsFromCollection(c);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initFromPriorityQueue</span><span class="params">(PriorityQueue<!--? extends E--> c)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (c.getClass() == PriorityQueue<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">            <span class="keyword">this</span>.queue = c.toArray();</span><br><span class="line">            <span class="keyword">this</span>.size = c.size();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            initFromCollection(c);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»SortSetæœ‰åºé›†åˆä¸­çš„å…ƒç´ ç›´æ¥å¤åˆ¶åˆ°å½“å‰çš„queueä¸­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initElementsFromCollection</span><span class="params">(Collection<!--? extends E--> c)</span> </span>{</span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        <span class="comment">// If c.toArray incorrectly doesn't return Object[], copy it.</span></span><br><span class="line">        <span class="keyword">if</span> (a.getClass() != Object[]<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">            <span class="title">a</span> </span>= Arrays.copyOf(a, a.length, Object[]<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">int</span> len = a.length;</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">1</span> || <span class="keyword">this</span>.comparator != <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < len; i++)</span><br><span class="line">                <span class="keyword">if</span> (a[i] == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">this</span>.queue = a;</span><br><span class="line">        <span class="keyword">this</span>.size = a.length;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Initializes queue array with elements from the given Collection.</span></span><br><span class="line"><span class="comment">     * ä»æ— åºé›†åˆä¸­æ„å»ºqueue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> c the collection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initFromCollection</span><span class="params">(Collection<!--? extends E--> c)</span> </span>{</span><br><span class="line">        initElementsFromCollection(c);</span><br><span class="line">        <span class="comment">//å¤åˆ¶å®Œæˆä¹‹åè¿›è¡Œè°ƒæ•´</span></span><br><span class="line">        heapify();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The maximum size of array to allocate.</span></span><br><span class="line"><span class="comment">     * Some VMs reserve some header words in an array.</span></span><br><span class="line"><span class="comment">     * Attempts to allocate larger arrays may result in</span></span><br><span class="line"><span class="comment">     * OutOfMemoryError: Requested array size exceeds VM limit</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Increases the capacity of the array.</span></span><br><span class="line"><span class="comment">     * queue æ•°ç»„æ‰©å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> minCapacity the desired minimum capacity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> oldCapacity = queue.length;</span><br><span class="line">        <span class="comment">// Double size if small; else grow by 50%</span></span><br><span class="line">        <span class="keyword">int</span> newCapacity = oldCapacity + ((oldCapacity < <span class="number">64</span>) ?</span><br><span class="line">                                         (oldCapacity + <span class="number">2</span>) :</span><br><span class="line">                                         (oldCapacity >> <span class="number">1</span>));</span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE > <span class="number">0</span>)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        queue = Arrays.copyOf(queue, newCapacity);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (minCapacity < <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">        <span class="keyword">return</span> (minCapacity > MAX_ARRAY_SIZE) ?</span><br><span class="line">            Integer.MAX_VALUE :</span><br><span class="line">            MAX_ARRAY_SIZE;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts the specified element into this priority queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} (as specified by {<span class="doctag">@link</span> Collection#add})</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassCastException if the specified element cannot be</span></span><br><span class="line"><span class="comment">     *         compared with elements currently in this priority queue</span></span><br><span class="line"><span class="comment">     *         according to the priority queue's ordering</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified element is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> offer(e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts the specified element into this priority queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} (as specified by {<span class="doctag">@link</span> Queue#offer})</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassCastException if the specified element cannot be</span></span><br><span class="line"><span class="comment">     *         compared with elements currently in this priority queue</span></span><br><span class="line"><span class="comment">     *         according to the priority queue's ordering</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified element is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">int</span> i = size;</span><br><span class="line">        <span class="keyword">if</span> (i >= queue.length)</span><br><span class="line">            grow(i + <span class="number">1</span>);</span><br><span class="line">        size = i + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">            queue[<span class="number">0</span>] = e;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            siftUp(i, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> (size == <span class="number">0</span>) ? <span class="keyword">null</span> : (E) queue[<span class="number">0</span>];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (o != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; i++)</span><br><span class="line">                <span class="keyword">if</span> (o.equals(queue[i]))</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes a single instance of the specified element from this queue,</span></span><br><span class="line"><span class="comment">     * if it is present.  More formally, removes an element {<span class="doctag">@code</span> e} such</span></span><br><span class="line"><span class="comment">     * that {<span class="doctag">@code</span> o.equals(e)}, if this queue contains one or more such</span></span><br><span class="line"><span class="comment">     * elements.  Returns {<span class="doctag">@code</span> true} if and only if this queue contained</span></span><br><span class="line"><span class="comment">     * the specified element (or equivalently, if this queue changed as a</span></span><br><span class="line"><span class="comment">     * result of the call).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o element to be removed from this queue, if present</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if this queue changed as a result of the call</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> i = indexOf(o);</span><br><span class="line">        <span class="keyword">if</span> (i == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            removeAt(i);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Version of remove using reference equality, not equals.</span></span><br><span class="line"><span class="comment">     * Needed by iterator.remove.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o element to be removed from this queue, if present</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if removed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeEq</span><span class="params">(Object o)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; i++) {</span><br><span class="line">            <span class="keyword">if</span> (o == queue[i]) {</span><br><span class="line">                removeAt(i);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> indexOf(o) != -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object[] toArray() {</span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOf(queue, size);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <t> T[] toArray(T[] a) {</t></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> size = <span class="keyword">this</span>.size;</span><br><span class="line">        <span class="keyword">if</span> (a.length < size)</span><br><span class="line">            <span class="comment">// Make a new array of a's runtime type, but my contents:</span></span><br><span class="line">            <span class="keyword">return</span> (T[]) Arrays.copyOf(queue, size, a.getClass());</span><br><span class="line">        System.arraycopy(queue, <span class="number">0</span>, a, <span class="number">0</span>, size);</span><br><span class="line">        <span class="keyword">if</span> (a.length > size)</span><br><span class="line">            a[size] = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator<e> <span class="title">iterator</span><span class="params">()</span> </e></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Itr();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span><<span class="title">E</span>> </span>{</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Index (into queue array) of element to be returned by</span></span><br><span class="line"><span class="comment">         * subsequent call to next.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> cursor = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Index of element returned by most recent call to next,</span></span><br><span class="line"><span class="comment">         * unless that element came from the forgetMeNot list.</span></span><br><span class="line"><span class="comment">         * Set to -1 if element is deleted by a call to remove.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> lastRet = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> ArrayDeque<e> forgetMeNot = <span class="keyword">null</span>;</e></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Element returned by the most recent call to next iff that</span></span><br><span class="line"><span class="comment">         * element was drawn from the forgetMeNot list.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> E lastRetElt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * The modCount value that the iterator believes that the backing</span></span><br><span class="line"><span class="comment">         * Queue should have.  If this expectation is violated, the iterator</span></span><br><span class="line"><span class="comment">         * has detected concurrent modification.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> expectedModCount = modCount;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> cursor < size ||</span><br><span class="line">                (forgetMeNot != <span class="keyword">null</span> && !forgetMeNot.isEmpty());</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (expectedModCount != modCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">            <span class="keyword">if</span> (cursor < size)</span><br><span class="line">                <span class="keyword">return</span> (E) queue[lastRet = cursor++];</span><br><span class="line">            <span class="keyword">if</span> (forgetMeNot != <span class="keyword">null</span>) {</span><br><span class="line">                lastRet = -<span class="number">1</span>;</span><br><span class="line">                lastRetElt = forgetMeNot.poll();</span><br><span class="line">                <span class="keyword">if</span> (lastRetElt != <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> lastRetElt;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (expectedModCount != modCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">            <span class="keyword">if</span> (lastRet != -<span class="number">1</span>) {</span><br><span class="line">                E moved = PriorityQueue.<span class="keyword">this</span>.removeAt(lastRet);</span><br><span class="line">                lastRet = -<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (moved == <span class="keyword">null</span>)</span><br><span class="line">                    cursor--;</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">if</span> (forgetMeNot == <span class="keyword">null</span>)</span><br><span class="line">                        forgetMeNot = <span class="keyword">new</span> ArrayDeque<>();</span><br><span class="line">                    forgetMeNot.add(moved);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (lastRetElt != <span class="keyword">null</span>) {</span><br><span class="line">                PriorityQueue.<span class="keyword">this</span>.removeEq(lastRetElt);</span><br><span class="line">                lastRetElt = <span class="keyword">null</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">            }</span><br><span class="line">            expectedModCount = modCount;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>{</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; i++)</span><br><span class="line">            queue[i] = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> s = --size;</span><br><span class="line">        modCount++;</span><br><span class="line">        E result = (E) queue[<span class="number">0</span>];</span><br><span class="line">        E x = (E) queue[s];</span><br><span class="line">        queue[s] = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (s != <span class="number">0</span>)</span><br><span class="line">            siftDown(<span class="number">0</span>, x);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the ith element from queue.</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æŸä¸ªä½ç½®çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">     * Normally this method leaves the elements at up to i-1,</span></span><br><span class="line"><span class="comment">     * inclusive, untouched.  Under these circumstances, it returns</span></span><br><span class="line"><span class="comment">     * null.  Occasionally, in order to maintain the heap invariant,</span></span><br><span class="line"><span class="comment">     * it must swap a later element of the list with one earlier than</span></span><br><span class="line"><span class="comment">     * i.  Under these circumstances, this method returns the element</span></span><br><span class="line"><span class="comment">     * that was previously at the end of the list and is now at some</span></span><br><span class="line"><span class="comment">     * position before i. This fact is used by iterator.remove so as to</span></span><br><span class="line"><span class="comment">     * avoid missing traversing elements.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> E <span class="title">removeAt</span><span class="params">(<span class="keyword">int</span> i)</span> </span>{</span><br><span class="line">        <span class="comment">// assert i >= 0 && i < size;</span></span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">int</span> s = --size;</span><br><span class="line">        <span class="keyword">if</span> (s == i) <span class="comment">// removed last element ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">            queue[i] = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            E moved = (E) queue[s]; <span class="comment">//ä¿å­˜é˜Ÿåˆ—å°¾éƒ¨çš„å…ƒç´ </span></span><br><span class="line">            queue[s] = <span class="keyword">null</span>; <span class="comment">//ç½®ä¸ºnull</span></span><br><span class="line">            siftDown(i, moved); <span class="comment">//movedç›´æ¥æ’å…¥åˆ°iä½ç½®ï¼Œç›¸å½“äºç›´æ¥åˆ é™¤äº†iä½ç½®çš„å…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span> (queue[i] == moved) {</span><br><span class="line">                siftUp(i, moved);</span><br><span class="line">                <span class="keyword">if</span> (queue[i] != moved)</span><br><span class="line">                    <span class="keyword">return</span> moved;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts item x at position k, maintaining heap invariant by</span></span><br><span class="line"><span class="comment">     * promoting x up the tree until it is greater than or equal to</span></span><br><span class="line"><span class="comment">     * its parent, or is the root.</span></span><br><span class="line"><span class="comment">     * å°†xæ’å…¥kä½ç½®ï¼Œå¹¶è¿›è¡Œä¸Šæµ®è°ƒæ•´</span></span><br><span class="line"><span class="comment">     * To simplify and speed up coercions and comparisons. the</span></span><br><span class="line"><span class="comment">     * Comparable and Comparator versions are separated into different</span></span><br><span class="line"><span class="comment">     * methods that are otherwise identical. (Similarly for siftDown.)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k the position to fill</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x the item to insert</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (comparator != <span class="keyword">null</span>)</span><br><span class="line">            siftUpUsingComparator(k, x);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            siftUpComparable(k, x);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUpComparable</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">        Comparable<!--? <span class="keyword"-->super</span> E> key = (Comparable<!--? <span class="keyword"-->super E>) x;<br><span class="line">        <span class="keyword">while</span> (k > <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">int</span> parent = (k - <span class="number">1</span>) >>> <span class="number">1</span>;</span><br><span class="line">            Object e = queue[parent];</span><br><span class="line">            <span class="keyword">if</span> (key.compareTo((E) e) >= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            queue[k] = e;</span><br><span class="line">            k = parent;</span><br><span class="line">        }</span><br><span class="line">        queue[k] = key;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUpUsingComparator</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (k > <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">int</span> parent = (k - <span class="number">1</span>) >>> <span class="number">1</span>;</span><br><span class="line">            Object e = queue[parent];</span><br><span class="line">            <span class="keyword">if</span> (comparator.compare(x, (E) e) >= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            queue[k] = e;</span><br><span class="line">            k = parent;</span><br><span class="line">        }</span><br><span class="line">        queue[k] = x;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts item x at position k, maintaining heap invariant by</span></span><br><span class="line"><span class="comment">     * demoting x down the tree repeatedly until it is less than or</span></span><br><span class="line"><span class="comment">     * equal to its children or is a leaf.</span></span><br><span class="line"><span class="comment">     * æ’å…¥å…ƒç´ xåˆ°åˆ°ä½ç½®k,å¹¶è¿›è¡Œä¸‹æ²‰è°ƒæ•´</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k the position to fill</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x the item to insert</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (comparator != <span class="keyword">null</span>)</span><br><span class="line">            siftDownUsingComparator(k, x);  <span class="comment">//å¸¦æ¯”è¾ƒå™¨çš„</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            siftDownComparable(k, x); <span class="comment">//ä¸å¸¦æ¯”è¾ƒå™¨ï¼Œç”¨xçš„compator</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDownComparable</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">        Comparable<!--? <span class="keyword"-->super</span> E> key = (Comparable<!--? <span class="keyword"-->super E>)x;<br><span class="line">        <span class="keyword">int</span> half = size >>> <span class="number">1</span>;        <span class="comment">// loop while a non-leaf</span></span><br><span class="line">        <span class="keyword">while</span> (k < half) {</span><br><span class="line">            <span class="keyword">int</span> child = (k << <span class="number">1</span>) + <span class="number">1</span>; <span class="comment">// assume left child is least</span></span><br><span class="line">            Object c = queue[child];</span><br><span class="line">            <span class="keyword">int</span> right = child + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (right < size &&</span><br><span class="line">                ((Comparable<!--? <span class="keyword"-->super</span> E>) c).compareTo((E) queue[right]) > <span class="number">0</span>)<br><span class="line">                c = queue[child = right];</span><br><span class="line">            <span class="keyword">if</span> (key.compareTo((E) c) <= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            queue[k] = c;</span><br><span class="line">            k = child;</span><br><span class="line">        }</span><br><span class="line">        queue[k] = key;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDownUsingComparator</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> half = size >>> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (k < half) {</span><br><span class="line">            <span class="keyword">int</span> child = (k << <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            Object c = queue[child];</span><br><span class="line">            <span class="keyword">int</span> right = child + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (right < size &&</span><br><span class="line">                comparator.compare((E) c, (E) queue[right]) > <span class="number">0</span>)</span><br><span class="line">                c = queue[child = right];</span><br><span class="line">            <span class="keyword">if</span> (comparator.compare(x, (E) c) <= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            queue[k] = c;</span><br><span class="line">            k = child;</span><br><span class="line">        }</span><br><span class="line">        queue[k] = x;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Establishes the heap invariant (described above) in the entire tree,</span></span><br><span class="line"><span class="comment">     * assuming nothing about the order of the elements prior to the call.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">heapify</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = (size >>> <span class="number">1</span>) - <span class="number">1</span>; i >= <span class="number">0</span>; i--)</span><br><span class="line">            siftDown(i, (E) queue[i]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Comparator<!--? <span class="keyword"-->super</span> E> comparator() {<br><span class="line">        <span class="keyword">return</span> comparator;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Saves this queue to a stream (that is, serializes it).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serialData</span> The length of the array backing the instance is</span></span><br><span class="line"><span class="comment">     *             emitted (int), followed by all of its elements</span></span><br><span class="line"><span class="comment">     *             (each an {<span class="doctag">@code</span> Object}) in the proper order.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s the stream</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> java.io.IOException </span>{</span><br><span class="line">        <span class="comment">// Write out element count, and any hidden stuff</span></span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Write out array length, for compatibility with 1.5 version</span></span><br><span class="line">        s.writeInt(Math.max(<span class="number">2</span>, size + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Write out all elements in the "proper order".</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; i++)</span><br><span class="line">            s.writeObject(queue[i]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reconstitutes the {<span class="doctag">@code</span> PriorityQueue} instance from a stream</span></span><br><span class="line"><span class="comment">     * (that is, deserializes it).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s the stream</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>{</span><br><span class="line">        <span class="comment">// Read in size, and any hidden stuff</span></span><br><span class="line">        s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Read in (and discard) array length</span></span><br><span class="line">        s.readInt();</span><br><span class="line"></span><br><span class="line">        SharedSecrets.getJavaOISAccess().checkArray(s, Object[]<span class="class">.<span class="keyword">class</span>, <span class="title">size</span>)</span>;</span><br><span class="line">        queue = <span class="keyword">new</span> Object[size];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Read in all elements.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; i++)</span><br><span class="line">            queue[i] = s.readObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Elements are guaranteed to be in "proper order", but the</span></span><br><span class="line">        <span class="comment">// spec has never explained what that might be.</span></span><br><span class="line">        heapify();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a <em><a href="Spliterator.html#binding">late-binding</a></em></span></span><br><span class="line"><span class="comment">     * and <em>fail-fast</em> {<span class="doctag">@link</span> Spliterator} over the elements in this</span></span><br><span class="line"><span class="comment">     * queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * </span></span></p><p>The {<span class="doctag">@code</span> Spliterator} reports {<span class="doctag">@link</span> Spliterator#SIZED},<br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> Spliterator#SUBSIZED}, and {<span class="doctag">@link</span> Spliterator#NONNULL}.</span></span><br><span class="line"><span class="comment">     * Overriding implementations should document the reporting of additional</span></span><br><span class="line"><span class="comment">     * characteristic values.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a {<span class="doctag">@code</span> Spliterator} over the elements in this queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Spliterator<e> <span class="title">spliterator</span><span class="params">()</span> </e></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PriorityQueueSpliterator<e>(<span class="keyword">this</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>);</e></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PriorityQueueSpliterator</span><<span class="title">E</span>> <span class="keyword">implements</span> <span class="title">Spliterator</span><<span class="title">E</span>> </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * This is very similar to ArrayList Spliterator, except for</span></span><br><span class="line"><span class="comment">         * extra null checks.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> PriorityQueue<e> pq;</e></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index;            <span class="comment">// current index, modified on advance/split</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> fence;            <span class="comment">// -1 until first use</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> expectedModCount; <span class="comment">// initialized when fence set</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Creates new spliterator covering the given range */</span></span><br><span class="line">        PriorityQueueSpliterator(PriorityQueue<e> pq, <span class="keyword">int</span> origin, <span class="keyword">int</span> fence,</e></span><br><span class="line">                             <span class="keyword">int</span> expectedModCount) {</span><br><span class="line">            <span class="keyword">this</span>.pq = pq;</span><br><span class="line">            <span class="keyword">this</span>.index = origin;</span><br><span class="line">            <span class="keyword">this</span>.fence = fence;</span><br><span class="line">            <span class="keyword">this</span>.expectedModCount = expectedModCount;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getFence</span><span class="params">()</span> </span>{ <span class="comment">// initialize fence to size on first use</span></span><br><span class="line">            <span class="keyword">int</span> hi;</span><br><span class="line">            <span class="keyword">if</span> ((hi = fence) < <span class="number">0</span>) {</span><br><span class="line">                expectedModCount = pq.modCount;</span><br><span class="line">                hi = fence = pq.size;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> hi;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> PriorityQueueSpliterator<e> <span class="title">trySplit</span><span class="params">()</span> </e></span>{</span><br><span class="line">            <span class="keyword">int</span> hi = getFence(), lo = index, mid = (lo + hi) >>> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> (lo >= mid) ? <span class="keyword">null</span> :</span><br><span class="line">                <span class="keyword">new</span> PriorityQueueSpliterator<e>(pq, lo, index = mid,</e></span><br><span class="line">                                                expectedModCount);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">forEachRemaining</span><span class="params">(Consumer<!--? <span class="keyword"-->super</span> E> action)</span> </span>{<br><span class="line">            <span class="keyword">int</span> i, hi, mc; <span class="comment">// hoist accesses and checks from loop</span></span><br><span class="line">            PriorityQueue<e> q; Object[] a;</e></span><br><span class="line">            <span class="keyword">if</span> (action == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">            <span class="keyword">if</span> ((q = pq) != <span class="keyword">null</span> && (a = q.queue) != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">if</span> ((hi = fence) < <span class="number">0</span>) {</span><br><span class="line">                    mc = q.modCount;</span><br><span class="line">                    hi = q.size;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    mc = expectedModCount;</span><br><span class="line">                <span class="keyword">if</span> ((i = index) >= <span class="number">0</span> && (index = hi) <= a.length) {</span><br><span class="line">                    <span class="keyword">for</span> (E e;; ++i) {</span><br><span class="line">                        <span class="keyword">if</span> (i < hi) {</span><br><span class="line">                            <span class="keyword">if</span> ((e = (E) a[i]) == <span class="keyword">null</span>) <span class="comment">// must be CME</span></span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            action.accept(e);</span><br><span class="line">                        }</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (q.modCount != mc)</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAdvance</span><span class="params">(Consumer<!--? <span class="keyword"-->super</span> E> action)</span> </span>{<br><span class="line">            <span class="keyword">if</span> (action == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">            <span class="keyword">int</span> hi = getFence(), lo = index;</span><br><span class="line">            <span class="keyword">if</span> (lo >= <span class="number">0</span> && lo < hi) {</span><br><span class="line">                index = lo + <span class="number">1</span>;</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) E e = (E)pq.queue[lo];</span><br><span class="line">                <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">                action.accept(e);</span><br><span class="line">                <span class="keyword">if</span> (pq.modCount != expectedModCount)</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">estimateSize</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">long</span>) (getFence() - index);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">characteristics</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> Spliterator.SIZED | Spliterator.SUBSIZED | Spliterator.NONNULL;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></p></span></span></pre></td></tr></tbody></table></figure></div><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><p><strong>då‰å †</strong>ï¼šå¤šå‰å †ï¼Œä¸Šé¢æˆ‘ä»¬å®ç°çš„éƒ½æ˜¯äºŒå‰å †ï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶æ‰©å±•ä¸ºå¤šå‰å †ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªå­èŠ‚ç‚¹</p><p><strong>ç´¢å¼•å †</strong>ï¼šæˆ‘ä»¬ä¸Šé¢å®ç°çš„äºŒå‰å †åªèƒ½çœ‹è§å †é¡¶çš„å…ƒç´ ï¼Œçœ‹ä¸åˆ°å †ä¸­çš„å…ƒç´ ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦æ“ä½œå †ä¸­é—´çš„å…ƒç´ ï¼Œç´¢å¼•å †é¡¾åæ€ä¹‰å°±æ˜¯æœ‰ç´¢å¼•å¯ä»¥å¯¹åº”æ¯ä¸ªå…ƒç´ ï¼Œå€Ÿæ­¤å°±å¯ä»¥æ“ä½œå †ä¸­é—´çš„å…ƒç´ </p><p><strong>äºŒé¡¹å †</strong>ï¼Œ<strong>æ–æ³¢æ‹‰å¥‘å †</strong> â€¦.. è¿™äº›ç»“æ„å…¶å®éƒ½æ˜¯æ‰©å±•çš„ï¼Œç®€å•äº†è§£å³å¯</p><h3 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a>æºç åœ°å€</h3><p><a href="https://github.com/imlgw/LeetCode/blob/master/tree/heap/MaxHeap.java" target="_blank" rel="noopener">Github</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> å † </tag>
            
            <tag> ä¼˜å…ˆé˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeèƒŒåŒ…é—®é¢˜</title>
      <link href="/2019/11/29/leetcode-bei-bao-wen-ti/"/>
      <url>/2019/11/29/leetcode-bei-bao-wen-ti/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><blockquote><p>ä»<a href="http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/">åŠ¨æ€è§„åˆ’ä¸“é¢˜</a> ä¸­æŠ½å–å‡ºæ¥çš„</p></blockquote><h2 id="92-èƒŒåŒ…é—®é¢˜ï¼ˆlintCodeï¼‰"><a href="#92-èƒŒåŒ…é—®é¢˜ï¼ˆlintCodeï¼‰" class="headerlink" title="92.èƒŒåŒ…é—®é¢˜ï¼ˆlintCodeï¼‰"></a><a href="https://www.lintcode.com/problem/backpack/description" target="_blank" rel="noopener">92.èƒŒåŒ…é—®é¢˜ï¼ˆlintCodeï¼‰</a></h2><p>åœ¨nä¸ªç‰©å“ä¸­æŒ‘é€‰è‹¥å¹²ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œæœ€å¤šèƒ½è£…å¤šæ»¡ï¼Ÿå‡è®¾èƒŒåŒ…çš„å¤§å°ä¸ºmï¼Œæ¯ä¸ªç‰©å“çš„å¤§å°ä¸ºA[i]</p><ul><li>ä½ ä¸å¯ä»¥å°†ç‰©å“è¿›è¡Œåˆ‡å‰²</li></ul><p><strong>æ ·ä¾‹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">æ ·ä¾‹ <span class="number">1</span>:</span><br><span class="line">è¾“å…¥:  [<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">5</span>], backpack size=<span class="number">10</span></span><br><span class="line">è¾“å‡º:  <span class="number">9</span></span><br><span class="line">æ ·ä¾‹ <span class="number">2</span>:</span><br><span class="line">è¾“å…¥:  [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>], backpack size=<span class="number">12</span></span><br><span class="line">è¾“å‡º:  <span class="number">12</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æŒ‘æˆ˜</strong></p><ul><li><p>O(n x m) time and O(m) memory.</p></li><li><p>O(n x m) memory is also acceptable if you do not know how to optimize memory.</p></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>è®°å¿†åŒ–é€’å½’ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼Œè£…æˆ–è€…ä¸è£…ğŸ¤£ ï¼ˆä¸çŸ¥é“ä¸ºå•¥è¿™ä¹ˆç»å…¸çš„é¢˜ç›®LeetCodeä¸Šå±…ç„¶æ²¡æœ‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç”¨Integer[][],ç©ºé—´ä¼šè¶…ç©ºé—´ã€‚ã€‚ã€‚lintCodeå¥½ä¸¥æ ¼</span></span><br><span class="line"><span class="keyword">int</span> [][] cache=<span class="keyword">null</span>;    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">backPack2</span><span class="params">(<span class="keyword">int</span> m,<span class="keyword">int</span>[] A)</span> </span>{</span><br><span class="line">    cache=<span class="keyword">new</span> <span class="keyword">int</span>[A.length+<span class="number">1</span>][m+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<a.length;i++) {< span><br><span class="line">        Arrays.fill(cache[i],-<span class="number">1</span>);   </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (A==<span class="keyword">null</span> || A.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> putPack(m,A,A.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†A[index,A.len-1]èŒƒå›´å†…çš„å…ƒç´ è£…è¿›å¤§å°ä¸ºmçš„èƒŒåŒ…çš„æœ€å¤§æ”¶ç›Š</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">putPack</span><span class="params">(<span class="keyword">int</span> m,<span class="keyword">int</span>[] A,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">    <span class="comment">//index==0çš„æ—¶å€™ä¸åº”è¯¥è¿”å›=0ä»£è¡¨ç¬¬ä¸€ä¸ª,æ˜¯å¯ä»¥è£…çš„</span></span><br><span class="line">    <span class="comment">//å¯¹äºmä¹Ÿæ˜¯ä¸€æ ·, è¿™ç§è¾¹ç•Œæ€è€ƒä¸€ä¸‹må°±ç­‰äº0ï¼Œæˆ–è€…å°±åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œindexå°±ç­‰äº0è¿™ç§ç‰¹ä¾‹å°±å¯ä»¥</span></span><br><span class="line">    <span class="comment">//åªè¦è¿™ç§ç‰¹ä¾‹æ˜¯æ­£ç¡®çš„é‚£ä¹ˆæ•´ä¸ªé€’å½’å°±æ˜¯æ­£ç¡®çš„,å¹¶ä¸éœ€è¦å»æ€è€ƒæ•´ä¸ªé€’å½’çš„ç»“æŸæ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (index<<span class="number">0</span> || m<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[index][m]!=-<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[index][m];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸è£…indexä½ç½®çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">int</span> res=putPack(m,A,index-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (A[index]<=m) {</span><br><span class="line">        <span class="comment">//è¯´æ˜å¯ä»¥è£…ä¸‹indexä½ç½®çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†indexä½ç½®çš„å…ƒç´ è£…è¿›å»è¯•è¯•çœ‹</span></span><br><span class="line">        <span class="comment">//ç„¶åæ±‚å‡ºå‰©ä¸‹çš„ç©ºé—´è¿˜æœ€å¤šèƒ½è£…å¤šå°‘ï¼Œæœ€åæ±‚æ˜¯è£…indexæ”¶ç›Šå¤§è¿˜æ˜¯ä¸è£…indexæ”¶ç›Šå¤§</span></span><br><span class="line">        res=Math.max(res,A[index]+putPack(m-A[index],A,index-<span class="number">1</span>));</span><br><span class="line">    }</span><br><span class="line">    cache[index][m]=res;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></a.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æš´åŠ›é€’å½’çš„æ—¶é—´å¤æ‚åº¦å°†ä¼šæ˜¯<code>O((2^N)*N)</code></p><p>å…¶å®æ•´ä¸ªé€’å½’çš„æ€è·¯æ˜¯å¾ˆæ¸…æ™°æ˜ç™½çš„ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸º0-1èƒŒåŒ…çš„åŸå› </p><ul><li>ä¸é€‰çš„è¯ï¼ŒèƒŒåŒ…çš„å®¹é‡ä¸å˜ï¼Œæ”¹å˜ä¸ºé—®é¢˜<code>putPack(m,A,index-1)</code></li><li>é€‰çš„è¯ï¼ŒèƒŒåŒ…çš„å®¹é‡å˜å°ï¼Œæ”¹å˜ä¸ºé—®é¢˜<code>putPack(m-A[index],A,index-1)+A[index]</code></li></ul><p>åˆ°åº•é€‰è¿˜æ˜¯ä¸é€‰ï¼Œå–å†³äºä¸¤ç§æ–¹æ¡ˆå“ªä¸€ç§æ›´å¥½ï¼Œæˆ‘ä»¬è¦æ±‚çš„ï¼Œå°±æ˜¯è¿™ä¸ªæœ€å¥½çš„æ–¹æ¡ˆï¼ŒçŸ¥é“äº†è¿™æ ·çš„é€’æ¨å…³ç³»åæˆ‘ä»¬å°±å¯ä»¥å¾ˆå®¹æ˜“çš„å†™å‡ºé€’å½’æ–¹ç¨‹ï¼Œè¿™é‡Œåœ¨é€’å½’çš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½ä¼šäº§ç”Ÿé‡å çš„å­é—®é¢˜ï¼ˆå…¶å®è¿™é‡Œæˆ‘è¿˜çº ç»“äº†å¥½ä¸€ä¼šå„¿ï¼Œæˆ‘ä¸€ç›´æ„Ÿè§‰æ²¡æœ‰é‡å çš„å­é—®é¢˜ï¼Œåæ¥ç”»ä¸€ä¸‹é€’å½’æ ‘å°±æ˜ç™½äº†ï¼Œåªæ˜¯é‡å çš„ä¸æ˜æ˜¾ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼“å­˜æ¯æ¬¡è®¡ç®—çš„ç»“æœæ¥è¿›è¡Œè®°å¿†åŒ–é€’å½’ï¼Œæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯<code>O(2^N)</code>ï¼Œç©ºé—´<code>O(M*N)</code>æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</p><blockquote><p>è¿™é‡Œä¸€å¼€å§‹æˆ‘æ˜¯æƒ³ç”¨<code>Integer[][]</code>çš„æ•°ç»„ï¼Œç„¶åå°±ä¸ç”¨èµ‹åˆå§‹å€¼ï¼Œåˆ¤æ–­ä¸ä¸ºnullå°±è¡Œï¼Œç»“æœç©ºé—´æº¢å‡ºäº†ã€‚ã€‚ã€‚lintCodeå¥½ä¸¥æ ¼ï¼Œæ¢æˆ<code>int[][]</code>ç„¶åèµ‹ä¸ªåˆå§‹å€¼å°±è¿‡äº†</p></blockquote><p><strong>è§£æ³•äºŒ</strong></p><p>åŠ¨æ€è§„åˆ’è§£æ³•ï¼Œåœ¨è®²è§£ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªäºŒç»´è¡¨æ¥åˆ†æä¸‹æ•´ä¸ªé€’æ¨çš„è¿‡ç¨‹</p><p>ç‰©å“åˆ—è¡¨ï¼ˆæ ·ä¾‹1ï¼‰ï¼Œå› ä¸ºè¿™é¢˜ä»·å€¼å°±æ˜¯é‡é‡ï¼Œæ‰€ä»¥wå’Œvæ˜¯ä¸€æ ·çš„</p><table><thead><tr><th>index</th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>w</td><td>3</td><td>4</td><td>8</td><td>5</td></tr><tr><td>v</td><td>3</td><td>4</td><td>8</td><td>5</td></tr></tbody></table><p>DpTableï¼ˆæ ·ä¾‹1ï¼‰</p><table><thead><tr><th align="center">index\m</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr></thead><tbody><tr><td align="center">0</td><td>0</td><td>0</td><td>0</td><td>3</td><td>3</td><td>3</td><td>3</td><td>3</td><td>3</td><td>3</td><td>3</td></tr><tr><td align="center">1</td><td>0</td><td>0</td><td>0</td><td>3</td><td>4</td><td>4</td><td>4</td><td>7</td><td>7</td><td>7</td><td>7</td></tr><tr><td align="center">2</td><td>0</td><td>0</td><td>0</td><td>3</td><td>4</td><td>4</td><td>4</td><td>7</td><td>8</td><td>8</td><td>8</td></tr><tr><td align="center">3</td><td>0</td><td>0</td><td>0</td><td>3</td><td>4</td><td>5</td><td>5</td><td>7</td><td>8</td><td>9</td><td>9</td></tr></tbody></table><p>ä¸€è¡Œä¸€è¡Œçš„çœ‹ï¼Œä»å·¦åˆ°å³ï¼Œ<code>dp[index][m]</code>ä»£è¡¨ <strong>èƒŒåŒ…æ€»å®¹é‡ä¸è¶…è¿‡mçš„æƒ…å†µä¸‹ï¼Œè€ƒè™‘è£…å…¥<code>[0,index]</code>ä¸­çš„å…ƒç´ èƒ½è·å¾—æœ€å¤§æ”¶ç›Š</strong>ï¼Œæ¯”å¦‚<code>dp[1][7]</code>ä»£è¡¨çš„å°±æ˜¯èƒŒåŒ…æ€»å®¹é‡ä¸è¶…è¿‡7çš„æƒ…å†µä¸‹ï¼Œè€ƒè™‘è£…å…¥<code>[0,1]</code> èŒƒå›´å†…çš„å…ƒç´ æ‰€èƒ½è·å¾—çš„æœ€å¤§æ”¶ç›Šï¼Œäººè„‘æ€è€ƒç»“æœè‡ªç„¶æ˜¯7äº†ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†æä¸‹å¦‚æœdpæ¨å‡ºè¿™ä¸ªç»“æœ</p><p>å‰é¢æˆ‘ä»¬å·²ç»åˆ†æè¿‡0-1èƒŒåŒ…çš„é€’å½’è¿‡ç¨‹ï¼Œæ¯ä¸ªå…ƒç´ é¢ä¸´ä¸¤ä¸ªé€‰æ‹©ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·</p><p><code>dp[1][7]</code>å¦‚æœæˆ‘ä»¬é€‰æ‹©ä¸è£…å…¥å½“å‰indexä½ç½®çš„å…ƒç´ çš„è¯ï¼Œé‚£ä¹ˆæœ€å¤§æ”¶ç›Šå°±æ˜¯<code>dp[0][7]=3</code>è¿™ä¸€ç‚¹åº”è¯¥æ²¡å•¥ç–‘é—®</p><p>å¦‚æœæˆ‘ä»¬è€ƒè™‘è£…å…¥å½“å‰indexä½ç½®çš„å…ƒç´ çš„è¯ï¼Œmè‚¯å®šä¼šå‡å°ï¼Œé‚£ä¹ˆæ‰€è·å¾—çš„æœ€å¤§æ”¶ç›Šå°±åº”è¯¥æ˜¯<code>A[index]+dp[0][7-4]=7</code> </p><blockquote><p>æ³¨æ„è¿™é‡Œå½“å‰indexçš„å€¼éƒ½æ˜¯ä¾èµ–äºä¸Šä¸€å±‚<code>index-1</code>çš„è®¡ç®—ç»“æœçš„ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–äºä¸Šä¸€æ¬¡<code>m,[0,index-1]</code>æœ€å¤§å€¼çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„åˆå§‹åŒ–ç¬¬ä¸€å±‚çš„å€¼ï¼‰</p></blockquote><p>æœ€åæˆ‘ä»¬å¾—åˆ°çš„æ ¸å¿ƒçŠ¶æ€æ–¹ç¨‹å°±æ˜¯ä¸‹é¢è¿™æ ·çš„</p><p><code>dp[index][m]=max(dp[index-1][m],A[index]+dp[index-1][j-A[index]])</code></p><p>ç„¶åæˆ‘ä»¬æ ¹æ®è¿™ä¸ªå¾ˆå®¹æ˜“å°±å¯ä»¥å†™å‡ºdpçš„è§£æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//äºŒç»´åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">backPack</span><span class="params">(<span class="keyword">int</span> m,<span class="keyword">int</span>[] A)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (A==<span class="keyword">null</span> || A.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[A.length][m+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<a.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=m;j++) {</span><br><span class="line">            <span class="keyword">if</span> (j==<span class="number">0</span>) {<span class="comment">//åˆå§‹åŒ–ç¬¬ä¸€åˆ—</span></span><br><span class="line">                dp[i][j]=<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span> (i==<span class="number">0</span>) {<span class="comment">//åˆå§‹åŒ–ç¬¬ä¸€è¡Œ</span></span><br><span class="line">                dp[i][j]=j-A[i]>=<span class="number">0</span>?A[i]:<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span> (i><span class="number">0</span>) {</span><br><span class="line">                dp[i][j]=j-A[i]>=<span class="number">0</span>?Math.max(dp[i-<span class="number">1</span>][j],dp[i-<span class="number">1</span>][j-A[i]]+A[i]):dp[i-<span class="number">1</span>][j];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[A.length-<span class="number">1</span>][m];</span><br><span class="line">}</span><br></a.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å½“ç„¶æˆ‘ä»¬è‚¯å®šæ˜¯ä¸æ»¡è¶³äºè¿™ç§äºŒç»´çš„dpçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—ä¼˜åŒ–ä¸‹ç©ºé—´ï¼Œè¿™é‡Œæ¯ä¸€å±‚éƒ½åªä¾èµ–äºä¸Šä¸€å±‚çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä¹ˆå¾ˆå®¹æ˜“å°±å¯ä»¥æ”¹æˆä¸€ç»´çš„ï¼Œå½“ç„¶è¿™é‡Œè¿˜æœ‰ä¸ªå°å‘ï¼Œå¦‚æœç›´æ¥æŒ‰ç…§ä¸Šé¢çš„ä»£ç æ¥æ”¹çš„è¯å°±æ˜¯é”™çš„ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ­£ç¡®çš„æ”¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">backPack4</span><span class="params">(<span class="keyword">int</span> m,<span class="keyword">int</span>[] A)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (A==<span class="keyword">null</span> || A.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[m+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<a.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=m;j>=<span class="number">0</span>;j--) {<span class="comment">//ä»å³å‘å·¦ï¼Œé¿å…è¦†ç›–</span></span><br><span class="line">            <span class="keyword">if</span> (j==<span class="number">0</span>) {<span class="comment">//åˆå§‹åŒ–ç¬¬ä¸€åˆ—</span></span><br><span class="line">                dp[j]=<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span> (i==<span class="number">0</span>) {<span class="comment">//åˆå§‹åŒ–ç¬¬ä¸€è¡Œ</span></span><br><span class="line">                dp[j]= j-A[i]>=<span class="number">0</span>?A[i]:<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[j]=j-A[i]>=<span class="number">0</span>?Math.max(dp[j],dp[j-A[i]]+A[i]):dp[j];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[m];</span><br><span class="line">}</span><br></a.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„å†…å±‚å¾ªç¯ä¸å†æ˜¯ä»å·¦å¾€å³ï¼Œè€Œæ˜¯ä»å³å¾€å·¦ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯é¿å…äº†<code>dp[j-A[i]]</code>å·²ç»è¢«<code>å½“å‰å±‚å‰é¢çš„å…ƒç´ </code>è¦†ç›–çš„å°´å°¬æƒ…å†µï¼Œç»“åˆä¸Šé¢çš„è¡¨æ¨ä¸€ä¸‹å°±çŸ¥é“äº†</p><h2 id="416-åˆ†å‰²ç­‰å’Œå­é›†"><a href="#416-åˆ†å‰²ç­‰å’Œå­é›†" class="headerlink" title="416. åˆ†å‰²ç­‰å’Œå­é›†"></a><a href="https://leetcode-cn.com/problems/partition-equal-subset-sum/" target="_blank" rel="noopener">416. åˆ†å‰²ç­‰å’Œå­é›†</a></h2><p>ç»™å®šä¸€ä¸ªåªåŒ…å«æ­£æ•´æ•°çš„éç©ºæ•°ç»„ã€‚æ˜¯å¦å¯ä»¥å°†è¿™ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ã€‚</p><p><strong>æ³¨æ„:</strong></p><ol><li>æ¯ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ä¸ä¼šè¶…è¿‡ 100</li><li>æ•°ç»„çš„å¤§å°ä¸ä¼šè¶…è¿‡ 200</li></ol><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š: æ•°ç»„å¯ä»¥åˆ†å‰²æˆ [<span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>] å’Œ [<span class="number">11</span>].</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [1, 2, 3, 5]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: false</span><br><span class="line"></span><br><span class="line">è§£é‡Š: æ•°ç»„ä¸èƒ½åˆ†å‰²æˆä¸¤ä¸ªå…ƒç´ å’Œç›¸ç­‰çš„å­é›†.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>ç°åœ¨é€’å½’å†™èµ·æ¥å·²ç»æœ‰ç‚¹æ„Ÿè§‰äº†ï¼Œç±»ä¼¼çš„é¢˜åŸºæœ¬ä¸Šéƒ½èƒ½å†™å‡ºè®°å¿†åŒ–é€’å½’çš„æ–¹æ³•æ¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è®°å¿†åŒ–é€’å½’37ms 44%,å¼€å§‹æ…¢æ˜¯å› ä¸ºstreamçš„åŸå› </span></span><br><span class="line">Boolean[][] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canPartition</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//int sum=Arrays.stream(nums).sum();</span></span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> e:nums) sum+=e; <span class="comment">//æ±‚å’Œ</span></span><br><span class="line">    cache=<span class="keyword">new</span> Boolean[nums.length][sum+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (sum%<span class="number">2</span>!=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> partition(nums,<span class="number">0</span>,<span class="number">0</span>,sum/<span class="number">2</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è¯•æ·»åŠ [0,index]ä½ç½®çš„å…ƒç´ ,çœ‹èƒ½å¦ä½¿å¾—half=sum (è¿™é‡Œå…¶å®åº”è¯¥ç›´æ¥åœ¨sumä¸Šå‡,çœ‹èƒ½ä¸èƒ½å‡ä¸º0)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> index,<span class="keyword">int</span> half,<span class="keyword">int</span> sum)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index==nums.length) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[index][half]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[index][half];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (half==sum) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    cache[index][half]=partition(nums,index+<span class="number">1</span>,half,sum) || </span><br><span class="line">        (half<sum&&partition(nums,index+<span class="number">1</sum&&partition(nums,index+<span></span>,half+nums[index],sum));<br><span class="line">    <span class="keyword">return</span> cache[index][half];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>åŠ¨æ€è§„åˆ’ï¼Œä¾ç„¶æ˜¯å…¸å‹çš„èƒŒåŒ…é—®é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºç”¨numsä¸­çš„å…ƒç´ ï¼Œå¡«æ»¡sum/2å®¹é‡å¤§å°çš„èƒŒåŒ…ï¼Œé€’æ¨å…¬å¼</p><p> <code>dp[i][j] =dp[i-1][j] || dp[i-1][j-nums[i]]</code>  é€‰å½“å‰å…ƒç´ å’Œä¸é€‰å½“å‰å…ƒç´ ï¼Œæœ‰ä¸€ä¸ªèƒ½å¡«æ»¡å°±ok</p><p><code>dp[i][j]</code> å«ä¹‰ä¸ºï¼šè€ƒè™‘<code>[0,i]</code> èŒƒå›´å†…çš„å…ƒç´ ï¼Œèƒ½å¦æ°å¥½è£…æ»¡ <code>j</code>å¤§å°çš„å®¹å™¨</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//äºŒç»´dp</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canPartition</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//int sum=Arrays.stream(nums).sum(); ç”¨streamå¥½æ…¢</span></span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> e:nums) sum+=e; <span class="comment">//æ±‚å’Œ</span></span><br><span class="line">    <span class="keyword">if</span> (sum%<span class="number">2</span>!=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> half=sum/<span class="number">2</span>;</span><br><span class="line">    <span class="comment">//dp[i][j]çš„å«ä¹‰æ˜¯ä»[0,i]ä¸­é€‰å–å…ƒç´ ,èƒ½å¦åˆšå¥½å¡«æ»¡j</span></span><br><span class="line">    <span class="keyword">boolean</span>[][] dp=<span class="keyword">new</span> <span class="keyword">boolean</span>[nums.length][half+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=half;j++) {</span><br><span class="line">        dp[<span class="number">0</span>][j]= nums[<span class="number">0</span>]==j;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=half;j++) {</span><br><span class="line">            dp[i][j]= j>=nums[i]?dp[i-<span class="number">1</span>][j] || dp[i-<span class="number">1</span>][j-nums[i]]:dp[i-<span class="number">1</span>][j];</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å¦‚æœåœ¨æŸä¸ªä½ç½®ï¼ˆæ¯è¡Œæœ€åä¸€ä¸ªï¼‰å·²ç»åˆšå¥½å¡«æ»¡äº†å°±ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (dp[i][half]) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[nums.length-<span class="number">1</span>][half];</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>ç©ºé—´ä¸Šçš„ä¼˜åŒ–</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canPartition</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> e:nums) sum+=e; <span class="comment">//æ±‚å’Œ</span></span><br><span class="line">    <span class="keyword">if</span> (sum%<span class="number">2</span>!=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> half=sum/<span class="number">2</span>;</span><br><span class="line">    <span class="comment">//dp[j]çš„å«ä¹‰æ˜¯ä»[0,i]ä¸­é€‰å–å…ƒç´ ,èƒ½å¦åˆšå¥½å¡«æ»¡j</span></span><br><span class="line">    <span class="keyword">boolean</span>[] dp=<span class="keyword">new</span> <span class="keyword">boolean</span>[half+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=half;j++) {</span><br><span class="line">        dp[j]= nums[<span class="number">0</span>]==j;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=half;j>=nums[i];j--) {</span><br><span class="line">            <span class="comment">//dp[i][j]= j>=nums[i]?dp[i-1][j] || dp[i-1][j-nums[i]]:dp[i-1][j];</span></span><br><span class="line">            dp[j]=dp[j]||dp[j-nums[i]];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (dp[half]) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[half];</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="322-é›¶é’±å…‘æ¢"><a href="#322-é›¶é’±å…‘æ¢" class="headerlink" title="322. é›¶é’±å…‘æ¢"></a><a href="https://leetcode-cn.com/problems/coin-change/" target="_blank" rel="noopener">322. é›¶é’±å…‘æ¢</a></h2><p>ç»™å®šä¸åŒé¢é¢çš„ç¡¬å¸ coins å’Œä¸€ä¸ªæ€»é‡‘é¢ amountã€‚ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„æœ€å°‘çš„ç¡¬å¸ä¸ªæ•°ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› -1ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: coins = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>], amount = <span class="number">11</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span> </span><br><span class="line">è§£é‡Š: <span class="number">11</span> = <span class="number">5</span> + <span class="number">5</span> + <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: coins = [<span class="number">2</span>], amount = <span class="number">3</span></span><br><span class="line">è¾“å‡º: -<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong><br>ä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„</p><p><strong>è§£æ³•ä¸€</strong></p><p>å…¶å®å°±æ˜¯dfsï¼Œæˆ‘æœ€å¼€å§‹å°±æ˜¯å†™çš„dfsåªä¸è¿‡æ—¶é—´å¤æ‚åº¦å¤ªé«˜ï¼Œæ²¡åšè®°å¿†åŒ–ï¼Œè¿™é‡Œå…¶å®ä¸€å¼€å§‹åšäº†è®°å¿†åŒ–ä¹Ÿä¸€ç›´æ²¡è·‘è¿‡ï¼Œä¸€ç›´è¶…æ—¶ï¼Œæœ€åç»™çš„caseæ˜¯6249 å¥½åƒä¹Ÿä¸ç®—å¾ˆå¤§å§ï¼Œç„¶åæˆ‘åæ¥æŠŠ<code>fill</code> å¡«å……æ•°ç»„åˆ äº†ï¼Œç”¨Integerå°±è·‘è¿‡äº†ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è®°å¿†åŒ–é€’å½’AC 50%å·¦å³</span></span><br><span class="line"><span class="keyword">private</span> Integer[] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">coinChange2</span><span class="params">(<span class="keyword">int</span>[] coins,<span class="keyword">int</span> amount)</span></span>{</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[amount+<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//Arrays.fill(cache,-1); è¿™é‡Œfillç›´æ¥tleäº†ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> takeCoins(coins,amount);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">takeCoins</span><span class="params">(<span class="keyword">int</span>[] coins, <span class="keyword">int</span> amount)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (amount==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[amount]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[amount];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//int t1=coins(coins,amount,index+1);</span></span><br><span class="line">    <span class="keyword">int</span> res=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<coins.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (amount<coins[i]) <span class="keyword">continue</coins[i])></span>;</coins.length;i++)></span><br><span class="line">        <span class="keyword">int</span> sub=takeCoins(coins,amount-coins[i]);</span><br><span class="line">        <span class="keyword">if</span> (sub!=-<span class="number">1</span>) {</span><br><span class="line">            res=Math.min(sub+<span class="number">1</span>,res);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cache[amount]= res==Integer.MAX_VALUE?-<span class="number">1</span>:res;</span><br><span class="line">    <span class="keyword">return</span> cache[amount];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>åŠ¨æ€è§„åˆ’ï¼ŒäºŒç»´dpï¼Œæ³¨æ„è¿™é‡Œå…¶å®å’Œå‰é¢çš„èƒŒåŒ…é—®é¢˜å°±æœ‰åŒºåˆ«äº†ï¼Œè¿™é‡Œå®é™…ä¸Šå°±æ˜¯ä¸ª<code>æ— é™èƒŒåŒ…</code>é—®é¢˜ï¼Œå› ä¸ºè¿™é‡Œçš„ç¡¬å¸æ˜¯æ— é™çš„ï¼Œæ¯ä¸ªé¢å€¼çš„ç¡¬å¸éƒ½å¯ä»¥é‡å¤çš„é€‰å–</p><p><strong>DpTable</strong></p><table><thead><tr><th>Coin / Amount</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th></tr></thead><tbody><tr><td>0ï¼ˆ1ï¼‰</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><td>1ï¼ˆ2ï¼‰</td><td>0</td><td>1</td><td>1</td><td>2</td><td>2</td><td><code>3</code></td><td>3</td><td>4</td><td>4</td><td>5</td><td>5</td><td>6</td></tr><tr><td>2ï¼ˆ5ï¼‰</td><td>0</td><td>1</td><td>1</td><td>2</td><td>2</td><td>1</td><td>2</td><td>2</td><td>3</td><td>3</td><td>2</td><td>3</td></tr></tbody></table><p><strong>çŠ¶æ€å®šä¹‰</strong></p><p>è¿™é‡Œ<code>dp[i][j]</code> çš„å«ä¹‰ä¸ºï¼š<strong>è€ƒè™‘<code>[0ï¼Œi]</code> èŒƒå›´å†…çš„å…ƒç´ ï¼Œèƒ½å‡‘æˆ <code>j</code> æ‰€éœ€çš„æœ€å°‘ç¡¬å¸æ•°</strong>ï¼Œå’Œä¹‹å‰çš„01èƒŒåŒ…é—®é¢˜çŠ¶æ€å®šä¹‰æ²¡ä»€ä¹ˆåŒºåˆ«</p><p><strong>çŠ¶æ€æ–¹ç¨‹</strong></p><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹ç¬¬<code>coins[i]</code>ä¸ªç¡¬å¸æœ‰ä¸¤ç§é€‰æ‹© </p><ol><li>ä¸æ‹¿ </li><li>æ‹¿ï¼Œæ‹¿1~kä¸ª(kä¸ºç¡¬å¸ä¸ªæ•°çš„é™åˆ¶ï¼Œè¿™é‡Œæ²¡æœ‰é™åˆ¶ï¼Œæ‰€ä»¥æ˜¯æ— ç©·å¤§)</li></ol><p>è¿›è€Œæˆ‘ä»¬å¯ä»¥çš„åˆ°çŠ¶æ€è½¬ç§»çš„æ–¹ç¨‹ï¼š</p><p><code>f[i][j] = min(f[i-1][j], f[i-1][j-c]+1, f[i-1][j-2*c]+2, ..., f[i-1][j-k*c]+k)</code></p><p>ä½†æ˜¯è¿™ä¸ªæ–¹ç¨‹æœ‰å¾ˆå¤šè®¡ç®—æ˜¯é‡å¤çš„</p><p><code>f[i][j-c]=min(f[i-1][j-c], f[i-1][j-2*c]+1, ..., f[i-1][j-k*c]+k-1)</code></p><p>ä¸¤è€…åˆå¹¶å¾—åˆ°</p><p><code>f[i][j] = min(f[i-1]f[j], f[i][j-c]+1)</code>  æœ‰äº†çŠ¶æ€æ–¹ç¨‹ï¼Œä»£ç å°±å¥½å†™äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">coinChange4</span><span class="params">(<span class="keyword">int</span>[] coins,<span class="keyword">int</span> amount)</span></span>{</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[coins.length][amount+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=amount;j++) {</span><br><span class="line">        dp[<span class="number">0</span>][j]=j%coins[<span class="number">0</span>]==<span class="number">0</span>?j/coins[<span class="number">0</span>]:Integer.MAX_VALUE;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<coins.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=amount;j++) {</span><br><span class="line">            <span class="keyword">if</span> (j<coins[i] || dp[i][j-coins[i]]="=Integer.MAX_VALUE)" {< span><br><span class="line">                <span class="comment">//æ”¾ä¸ä¸‹</span></span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j];</span><br><span class="line">            }<span class="keyword">else</span> {</span><br><span class="line">                dp[i][j]=Math.min(dp[i][j-coins[i]]+<span class="number">1</span>,dp[i-<span class="number">1</span>][j]);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[coins.length-<span class="number">1</span>][amount]!=Integer.MAX_VALUE?dp[coins.length-<span class="number">1</span>][amount]:-<span class="number">1</span>;</span><br><span class="line">}</span><br></coins[i]></span></coins.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>ç©ºé—´ä¼˜åŒ–</strong></p><p>æ„Ÿè§‰ä¸€ç»´çš„è§£é‡Šèµ·æ¥ä¼šæ›´åŠ æ¸…æ™°æ˜“æ‡‚ <code>f(11)=1 + min(f(10),f(9),f(6))</code> è¿™ä¸ªé‡Œé¢å°±å…·æœ‰æœ€ä¼˜å­ç»“æ„ï¼Œè€Œä¸”ä¸€çœ‹å°±æ˜ç™½äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">coinChange</span><span class="params">(<span class="keyword">int</span>[] coins,<span class="keyword">int</span> amount)</span></span>{</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[amount+<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//å¡«å……åˆå§‹å€¼ä¸ºInteger.MAX_VALUE,ä»£è¡¨ä¸å¯è¾¾</span></span><br><span class="line">    Arrays.fill(dp,Integer.MAX_VALUE);</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">0</span>; <span class="comment">//é™¤äº†dp[0]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<coins.length;i++) {< span><br><span class="line">        <span class="comment">//æ³¨æ„è¿™é‡Œä¸èƒ½é€†åºï¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=coins[i];j<=amount;j++) {</span><br><span class="line">            <span class="keyword">if</span> (dp[j-coins[i]]!=Integer.MAX_VALUE) {</span><br><span class="line">                dp[j]=Math.min(dp[j-coins[i]]+<span class="number">1</span>,dp[j]);   </span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[amount]==Integer.MAX_VALUE?-<span class="number">1</span>:dp[amount];</span><br><span class="line">}</span><br></coins.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="518-é›¶é’±å…‘æ¢-II"><a href="#518-é›¶é’±å…‘æ¢-II" class="headerlink" title="518. é›¶é’±å…‘æ¢ II"></a><a href="https://leetcode-cn.com/problems/coin-change-2/" target="_blank" rel="noopener">518. é›¶é’±å…‘æ¢ II</a></h2><p>ç»™å®šä¸åŒé¢é¢çš„ç¡¬å¸å’Œä¸€ä¸ªæ€»é‡‘é¢ã€‚å†™å‡ºå‡½æ•°æ¥è®¡ç®—å¯ä»¥å‡‘æˆæ€»é‡‘é¢çš„ç¡¬å¸ç»„åˆæ•°ã€‚å‡è®¾æ¯ä¸€ç§é¢é¢çš„ç¡¬å¸æœ‰æ— é™ä¸ª</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: amount = <span class="number">5</span>, coins = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>]</span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br><span class="line">è§£é‡Š: æœ‰å››ç§æ–¹å¼å¯ä»¥å‡‘æˆæ€»é‡‘é¢:</span><br><span class="line"><span class="number">5</span>=<span class="number">5</span></span><br><span class="line"><span class="number">5</span>=<span class="number">2</span>+<span class="number">2</span>+<span class="number">1</span></span><br><span class="line"><span class="number">5</span>=<span class="number">2</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span></span><br><span class="line"><span class="number">5</span>=<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: amount = <span class="number">3</span>, coins = [<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br><span class="line">è§£é‡Š: åªç”¨é¢é¢<span class="number">2</span>çš„ç¡¬å¸ä¸èƒ½å‡‘æˆæ€»é‡‘é¢<span class="number">3</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: amount = <span class="number">10</span>, coins = [<span class="number">10</span>] </span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong></p><p>ä½ å¯ä»¥å‡è®¾ï¼š</p><ul><li>0 <= amount (æ€»é‡‘é¢) <= 5000</li><li>1 <= coin (ç¡¬å¸é¢é¢) <= 5000</li><li>ç¡¬å¸ç§ç±»ä¸è¶…è¿‡ 500 ç§</li><li>ç»“æœç¬¦åˆ 32 ä½ç¬¦å·æ•´æ•°</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>æ±‚æ–¹æ¡ˆæ•°ï¼Œä¸è€ƒè™‘é¡ºåº</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> amount, <span class="keyword">int</span>[] coins)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (coins==<span class="keyword">null</span> || coins.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> amount==<span class="number">0</span>?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[coins.length][amount+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<coins.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=amount;j++) {</span><br><span class="line">            <span class="keyword">if</span> (i==<span class="number">0</span>) {</span><br><span class="line">                dp[<span class="number">0</span>][j]=j%coins[i]==<span class="number">0</span>?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span> (j==<span class="number">0</span>) {</span><br><span class="line">                dp[i][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                  dp[i][j]= j>=coins[i]?dp[i-<span class="number">1</span>][j]+dp[i][j-coins[i]]:dp[i-<span class="number">1</span>][j];</span><br><span class="line">                <span class="comment">//dp[i][j]= j>=coins[i]?dp[i-1][j]+dp[i-1][j-coins[i]]:dp[i-1][j];</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[coins.length-<span class="number">1</span>][amount];</span><br><span class="line">}</span><br></coins.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>ç©ºé—´ä¼˜åŒ–</strong></p><p><code>f(5)=f(4)+f(3)+f(0)</code> çªç„¶æ„Ÿè§‰å†™äºŒç»´çš„æœ‰ç‚¹å¤šä½™ã€‚ã€‚ã€‚è¿™ç§å­ç»“æ„è¦æ¸…æ™°çš„å¤š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç›´æ¥ç†è§£ä¸€ç»´dpè¿˜æ˜¯ä¸å¤ªå®¹æ˜“,ä½†æ˜¯çŸ¥é“é€’æ¨å…¬å¼åå…ˆå†™ä¸ªäºŒç»´dpå†æ”¹ä¸ºä¸€ç»´å°±å¾ˆå®¹æ˜“</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> amount, <span class="keyword">int</span>[] coins)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[amount+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//è¿™ç§æ–¹å¼ç›¸å½“äºå¯¹dpTableä»å·¦å‘å³,ä¸€è¡Œè¡Œçš„é€’æ¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<coins.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=amount;j++) {</span><br><span class="line">            <span class="comment">//dp[j]+= dp[j-coins[i]]:0;</span></span><br><span class="line">            dp[j]=j-coins[i]>=<span class="number">0</span>?dp[j]+dp[j-coins[i]]:dp[j];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* äº¤æ¢ä¸€ä¸‹å†…å¤–é¡ºåºå°±å˜æˆäº†å¦ä¸€ä¸ªé—®é¢˜çš„è§£</span></span><br><span class="line"><span class="comment">    for (int j=0;j<=amount;j++) {</span></span><br><span class="line"><span class="comment">        for (int i=0;i<coins.length;i++) {< span></coins.length;i++)></span><br><span class="line"><span class="comment">            dp[j]+= j-coins[i]>=0?dp[j-coins[i]]:0;</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">    }*/</span></span><br><span class="line">    <span class="keyword">return</span> dp[amount];</span><br><span class="line">}</span><br></span></coins.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>è®°å¿†åŒ–é€’å½’ï¼ŒåŸºæœ¬ä¸Šdpèƒ½è¿‡å¾—ï¼Œè®°å¿†åŒ–é€’å½’ä¸€å®šèƒ½è¿‡ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘è§‰å¾—è®°å¿†åŒ–é€’å½’ä¼šå¥½å†™ä¸€äº›</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> amount, <span class="keyword">int</span>[] coins)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (coins==<span class="keyword">null</span> || coins.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> amount==<span class="number">0</span>?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[coins.length][amount+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> takeCoins(amount,coins,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Integer[][] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//[index,coins.length] ä¸­å‡‘æˆamountçš„æ–¹æ¡ˆæ•°ï¼Œè€ƒè™‘é¡ºåº</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">takeCoins</span><span class="params">(<span class="keyword">int</span> amount,<span class="keyword">int</span>[] coins,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (index>=coins.length || amount<<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[index][amount]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[index][amount];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (amount==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cache[index][amount]=takeCoins(amount-coins[index],coins,index)+takeCoins(amount,coins,index+<span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="377-ç»„åˆæ€»å’Œ-â…£"><a href="#377-ç»„åˆæ€»å’Œ-â…£" class="headerlink" title="377. ç»„åˆæ€»å’Œ â…£"></a><a href="https://leetcode-cn.com/problems/combination-sum-iv/" target="_blank" rel="noopener">377. ç»„åˆæ€»å’Œ â…£</a></h2><p>ç»™å®šä¸€ä¸ªç”±æ­£æ•´æ•°ç»„æˆä¸”ä¸å­˜åœ¨é‡å¤æ•°å­—çš„æ•°ç»„ï¼Œæ‰¾å‡ºå’Œä¸ºç»™å®šç›®æ ‡æ­£æ•´æ•°çš„ç»„åˆçš„ä¸ªæ•°ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">target = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">æ‰€æœ‰å¯èƒ½çš„ç»„åˆä¸ºï¼š</span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">è¯·æ³¨æ„ï¼Œé¡ºåºä¸åŒçš„åºåˆ—è¢«è§†ä½œä¸åŒçš„ç»„åˆã€‚</span><br><span class="line"></span><br><span class="line">å› æ­¤è¾“å‡ºä¸º <span class="number">7</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶ï¼š</strong><br>å¦‚æœç»™å®šçš„æ•°ç»„ä¸­å«æœ‰è´Ÿæ•°ä¼šæ€ä¹ˆæ ·ï¼Ÿ<br>é—®é¢˜ä¼šäº§ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Ÿ<br>æˆ‘ä»¬éœ€è¦åœ¨é¢˜ç›®ä¸­æ·»åŠ ä»€ä¹ˆé™åˆ¶æ¥å…è®¸è´Ÿæ•°çš„å‡ºç°ï¼Ÿ</p><p><strong>è§£æ³•ä¸€</strong></p><p>è®°å¿†åŒ–é€’å½’ï¼Œæ²¡å•¥å¥½è¯´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è®°å¿†åŒ–é€’å½’ 1ms 100%</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">combinationSum4</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[target+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> combination(nums,target);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Integer[] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">combination</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> target)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (cache[target]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[target];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (target==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (target-nums[i]>=<span class="number">0</span>) {</span><br><span class="line">            res+=combination(nums,target-nums[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cache[target]=res;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>åŠ¨æ€è§„åˆ’ï¼Œä¹ä¸€çœ‹å¥½åƒå’Œä¸Šé¢ä¸€é¢˜ä¸€æ ·ï¼Œå®é™…ä¸Šå¹¶ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯è€ƒè™‘é¡ºåºçš„ï¼Œæœ€ä¼˜å­ç»“æ„ä¹Ÿæ˜¯</p><p><code>f(5)=f(4)+f(3)+f(0)</code> è¿™æ ·çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸€ç»´dp</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">combinationSum4</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> target)</span></span>{</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[target+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<=target;i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<nums.length;j++) {< span><br><span class="line">            dp[i]+= i>=nums[j]?dp[i-nums[j]]:<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[target];</span><br><span class="line">}</span><br></nums.length;j++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œè¿˜æ˜¯è¦å­˜ä¸ªç–‘å•Šï¼Œæ²¡ææ˜ç™½å•Šï¼Œä¸ºå•¥äº¤æ¢ä¸ªé¡ºåºå°±ä¸ä¸€æ ·äº†å‘¢ï¼Ÿä¸€ä¸ªæ˜¯æŒ‰è¡Œæ‰“è¡¨ï¼Œä¸€ä¸ªæ˜¯æŒ‰åˆ—æ‰“è¡¨ï¼Ÿï¼Ÿï¼Ÿè¿˜æ˜¯é€’å½’å¥½å†™ã€‚ã€‚ã€‚</p><h2 id="494-ç›®æ ‡å’Œ"><a href="#494-ç›®æ ‡å’Œ" class="headerlink" title="494. ç›®æ ‡å’Œ"></a><a href="https://leetcode-cn.com/problems/target-sum/" target="_blank" rel="noopener">494. ç›®æ ‡å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œa1, a2, â€¦, an, å’Œä¸€ä¸ªç›®æ ‡æ•°ï¼ŒSã€‚ç°åœ¨ä½ æœ‰ä¸¤ä¸ªç¬¦å· + å’Œ -ã€‚å¯¹äºæ•°ç»„ä¸­çš„ä»»æ„ä¸€ä¸ªæ•´æ•°ï¼Œä½ éƒ½å¯ä»¥ä» + æˆ– -ä¸­é€‰æ‹©ä¸€ä¸ªç¬¦å·æ·»åŠ åœ¨å‰é¢ã€‚</p><p>è¿”å›å¯ä»¥ä½¿æœ€ç»ˆæ•°ç»„å’Œä¸ºç›®æ ‡æ•° S çš„æ‰€æœ‰æ·»åŠ ç¬¦å·çš„æ–¹æ³•æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], S: <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="number">5</span></span><br><span class="line">è§£é‡Š: </span><br><span class="line"></span><br><span class="line">-<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span> = <span class="number">3</span></span><br><span class="line">+<span class="number">1</span>-<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span> = <span class="number">3</span></span><br><span class="line">+<span class="number">1</span>+<span class="number">1</span>-<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span> = <span class="number">3</span></span><br><span class="line">+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>-<span class="number">1</span>+<span class="number">1</span> = <span class="number">3</span></span><br><span class="line">+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span>-<span class="number">1</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">ä¸€å…±æœ‰<span class="number">5</span>ç§æ–¹æ³•è®©æœ€ç»ˆç›®æ ‡å’Œä¸º<span class="number">3</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong></p><ul><li>æ•°ç»„éç©ºï¼Œä¸”é•¿åº¦ä¸ä¼šè¶…è¿‡20ã€‚</li><li>åˆå§‹çš„æ•°ç»„çš„å’Œä¸ä¼šè¶…è¿‡1000ã€‚</li><li>ä¿è¯è¿”å›çš„æœ€ç»ˆç»“æœèƒ½è¢«32ä½æ•´æ•°å­˜ä¸‹</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>åé¢çš„é¢˜éƒ½ä¼˜å…ˆå†™è®°å¿†åŒ–é€’å½’äº†ï¼ŒåŠ¨æ€è§„åˆ’ç¡®å®æœ‰ç‚¹éš¾é¡¶</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Integer[][] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HashMap<integer,integer> cache=new HashMap<></integer,integer></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findTargetSumWays</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> S)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span> || S><span class="number">1000</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n:nums)sum+=n;</span><br><span class="line">    <span class="keyword">if</span>(S>sum)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç›¸å½“äºå¹³ç§»äº†ä¸€ä¸‹,ä»[-sum,sum] --> [0,2*sum]</span></span><br><span class="line">    cache=<span class="keyword">new</span> Integer[nums.length][<span class="number">2</span>*sum+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> findTarget(nums,S,<span class="number">0</span>,<span class="number">2</span>*sum+<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findTarget</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> S,<span class="keyword">int</span> index,<span class="keyword">int</span> max)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (S==<span class="number">0</span> && index ==nums.length) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (index>=nums.length) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(S <<span class="number">0</span>  && cache[index][S+max]!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> cache[index][S+max];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (S>=<span class="number">0</span> && cache[index][S]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[index][S];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> temp=findTarget(nums,S-nums[index],index+<span class="number">1</span>,max)+findTarget(nums,S+nums[index],index+<span class="number">1</span>,max);</span><br><span class="line">    <span class="keyword">if</span> (S<<span class="number">0</span>) {</span><br><span class="line">        cache[index][S+max]=temp;</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        cache[index][S]=temp;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span>  temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå› ä¸ºé‡Œé¢æ˜¯æœ‰è´Ÿæ•°çš„ï¼Œç›´æ¥è®°å¿†åŒ–æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦è½¬æ¢ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘æ˜¯ç›´æ¥å°†cacheæ•°ç»„æ‰©å¤§ï¼ŒåŒæ—¶ä¿è¯ä¸ä¼šæœ‰è¦†ç›–ï¼Œæ‰€ä»¥ç›´æ¥æ‰©å¤§ä¸º 2sumå°±okï¼Œè¿™æ ·æ•´ä¸ªSçš„èŒƒå›´å°±ä»<code>[-sum,+sum]</code> å˜ä¸º <code>[0,2sum]</code> ä»è€Œå¯ä»¥ç¼“å­˜æ‰€æœ‰çš„é€’å½’ç»“æœï¼Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„ä¸€ä¸ªå­˜æ­£æ•°ï¼Œä¸€ä¸ªå­˜è´Ÿæ•°ï¼Œç„¶ååªéœ€è¦ç¬¦å·å–åå°±okäº†ï¼Œåªä¸è¿‡å ç”¨çš„ç©ºé—´ä¼šå¤§ä¸€ç‚¹</p><h2 id="474-ä¸€å’Œé›¶"><a href="#474-ä¸€å’Œé›¶" class="headerlink" title="474. ä¸€å’Œé›¶"></a><a href="https://leetcode-cn.com/problems/ones-and-zeroes/" target="_blank" rel="noopener">474. ä¸€å’Œé›¶</a></h2><p>åœ¨è®¡ç®—æœºç•Œä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯è¿½æ±‚ç”¨æœ‰é™çš„èµ„æºè·å–æœ€å¤§çš„æ”¶ç›Šã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ åˆ†åˆ«æ”¯é…ç€ m ä¸ª 0 å’Œ n ä¸ª 1ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªä»…åŒ…å« 0 å’Œ 1 å­—ç¬¦ä¸²çš„æ•°ç»„ã€‚</p><p>ä½ çš„ä»»åŠ¡æ˜¯ä½¿ç”¨ç»™å®šçš„ m ä¸ª 0 å’Œ n ä¸ª 1 ï¼Œæ‰¾åˆ°èƒ½æ‹¼å‡ºå­˜åœ¨äºæ•°ç»„ä¸­çš„å­—ç¬¦ä¸²çš„æœ€å¤§æ•°é‡ã€‚æ¯ä¸ª 0 å’Œ 1 è‡³å¤šè¢«ä½¿ç”¨ä¸€æ¬¡ã€‚</p><p><strong>æ³¨æ„:</strong></p><ul><li>ç»™å®š 0 å’Œ 1 çš„æ•°é‡éƒ½ä¸ä¼šè¶…è¿‡ 100ã€‚</li><li>ç»™å®šå­—ç¬¦ä¸²æ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 600ã€‚</li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: Array = {<span class="string">"10"</span>, <span class="string">"0001"</span>, <span class="string">"111001"</span>, <span class="string">"1"</span>, <span class="string">"0"</span>}, m = <span class="number">5</span>, n = <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š: æ€»å…± <span class="number">4</span> ä¸ªå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡ <span class="number">5</span> ä¸ª <span class="number">0</span> å’Œ <span class="number">3</span> ä¸ª <span class="number">1</span> æ‹¼å‡ºï¼Œå³ <span class="string">"10"</span>,<span class="string">"0001"</span>,<span class="string">"1"</span>,<span class="string">"0"</span> ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: Array = {<span class="string">"10"</span>, <span class="string">"0"</span>, <span class="string">"1"</span>}, m = <span class="number">1</span>, n = <span class="number">1</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š: ä½ å¯ä»¥æ‹¼å‡º <span class="string">"10"</span>ï¼Œä½†ä¹‹åå°±æ²¡æœ‰å‰©ä½™æ•°å­—äº†ã€‚æ›´å¥½çš„é€‰æ‹©æ˜¯æ‹¼å‡º <span class="string">"0"</span> å’Œ <span class="string">"1"</span> ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å…¶å®è¿™æ˜¯ä¸€ä¸ªå¤šé‡èƒŒåŒ…é—®é¢˜ï¼Œä¸€ä¸ªç‰©å“æœ‰å¤šä¸ªæƒå€¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Integer [][][] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMaxForm</span><span class="params">(String[] strs, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[m+<span class="number">1</span>][n+<span class="number">1</span>][strs.length];</span><br><span class="line">    <span class="keyword">return</span> findMax(strs,m,n,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//m:0 n:1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findMax</span><span class="params">(String[] strs, <span class="keyword">int</span> m, <span class="keyword">int</span> n,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index>=strs.length) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[m][n][index]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[m][n][index];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] oz=count(strs[index]);</span><br><span class="line">    <span class="keyword">if</span> (oz[<span class="number">1</span>]<=n && oz[<span class="number">0</span>]<=m) {</span><br><span class="line">        <span class="keyword">return</span> cache[m][n][index]=Math.max(<span class="number">1</span>+findMax(strs,m-oz[<span class="number">0</span>],n-oz[<span class="number">1</span>],index+<span class="number">1</span>),findMax(strs,m,n,index+<span class="number">1</span>));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cache[m][n][index]=findMax(strs,m,n,index+<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] count(String str){</span><br><span class="line">    <span class="keyword">int</span> one=<span class="number">0</span>,zero=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] s=str.toCharArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c:s) {</span><br><span class="line">        <span class="keyword">if</span> (c==<span class="string">'1'</span>) {</span><br><span class="line">            one++;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            zero++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{zero,one};</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="139-å•è¯æ‹†åˆ†"><a href="#139-å•è¯æ‹†åˆ†" class="headerlink" title="139. å•è¯æ‹†åˆ†"></a><a href="https://leetcode-cn.com/problems/word-break/" target="_blank" rel="noopener">139. å•è¯æ‹†åˆ†</a></h2><p>ç»™å®šä¸€ä¸ªéç©ºå­—ç¬¦ä¸² s å’Œä¸€ä¸ªåŒ…å«éç©ºå•è¯åˆ—è¡¨çš„å­—å…¸ wordDictï¼Œåˆ¤å®š s æ˜¯å¦å¯ä»¥è¢«ç©ºæ ¼æ‹†åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåœ¨å­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>æ‹†åˆ†æ—¶å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚</li><li>ä½ å¯ä»¥å‡è®¾å­—å…¸ä¸­æ²¡æœ‰é‡å¤çš„å•è¯ã€‚</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"leetcode"</span>, wordDict = [<span class="string">"leet"</span>, <span class="string">"code"</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br><span class="line">è§£é‡Š: è¿”å› <span class="keyword">true</span> å› ä¸º <span class="string">"leetcode"</span> å¯ä»¥è¢«æ‹†åˆ†æˆ <span class="string">"leet code"</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"applepenapple"</span>, wordDict = [<span class="string">"apple"</span>, <span class="string">"pen"</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br><span class="line">è§£é‡Š: è¿”å› <span class="keyword">true</span> å› ä¸º <span class="string">"applepenapple"</span> å¯ä»¥è¢«æ‹†åˆ†æˆ <span class="string">"apple pen apple"</span>ã€‚</span><br><span class="line">     æ³¨æ„ä½ å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"catsandog"</span>, wordDict = [<span class="string">"cats"</span>, <span class="string">"dog"</span>, <span class="string">"sand"</span>, <span class="string">"and"</span>, <span class="string">"cat"</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è®°å¿†åŒ–é€’å½’ï¼Œå€¼å¾—æ³¨æ„çš„ç‚¹å°±æ˜¯é€’å½’çš„ç»ˆæ­¢æ¡ä»¶</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è®°å¿†åŒ–é€’å½’</span></span><br><span class="line">Boolean[] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">wordBreak</span><span class="params">(String s, List<string> wordDict)</string></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span> || s.length()<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    cache=<span class="keyword">new</span> Boolean[s.length()];</span><br><span class="line">    HashSet<string> set=<span class="keyword">new</span> HashSet<>(wordDict);</string></span><br><span class="line">    <span class="keyword">return</span> dfs(s,set,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­ã€index,s.lenã€‘ä¸­çš„å­—ç¬¦æ˜¯å¦èƒ½æ‹†åˆ†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dfs</span><span class="params">(String s, HashSet<string> dict,<span class="keyword">int</span> index)</string></span> </span>{</span><br><span class="line">    <span class="comment">//ç»ˆæ­¢æ¡ä»¶ä¸€å¼€å§‹å†™çš„false....</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œçš„ç»ˆæ­¢æ¡ä»¶è¿˜æ˜¯æœ‰ç‚¹è¿·æƒ‘çš„,è¿™é‡Œindexåªæœ‰åœ¨å­—å…¸ä¸­å­˜åœ¨å½“å‰å…ƒç´ çš„æ—¶å€™æ‰ä¼šå‘åç§»åŠ¨</span></span><br><span class="line">    <span class="comment">//æ‰€ä»¥å½“indexç§»åŠ¨åˆ°s==lengthçš„æ—¶å€™å°±è¯´æ˜å‰é¢çš„å•è¯éƒ½åŒ¹é…ä¸Šäº†</span></span><br><span class="line">    <span class="keyword">if</span> (index==s.length()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[index]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[index];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index+<span class="number">1</span>;i<=s.length();i++) {</span><br><span class="line">        <span class="comment">//System.out.println(s.substring(index,i));</span></span><br><span class="line">        <span class="comment">//è¿™é‡Œä¸‹ä¸€æ¬¡dfsçš„indexä¹Ÿè¦æ³¨æ„</span></span><br><span class="line">        <span class="keyword">if</span> (dict.contains(s.substring(index,i)) && dfs(s,dict,i)){</span><br><span class="line">            <span class="keyword">return</span> cache[index]=<span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cache[index]=<span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>çœ‹äº†å®˜æ–¹çš„è§£æœ‰BFSï¼Œç„¶åä¹Ÿå®ç°äº†ä¸€ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//BFS,éœ€è¦ä¸€ä¸ªvisitä¿è¯ä¸ä¼šé‡å¤è®¿é—®</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">wordBreak</span><span class="params">(String s, List<string> wordDict)</string></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span> || s.length()<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    HashSet<string> dict=<span class="keyword">new</span> HashSet<>(wordDict);</string></span><br><span class="line">    <span class="comment">//queueä¸­å­˜index</span></span><br><span class="line">    LinkedList<integer> queue=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[s.length()];</span><br><span class="line">    queue.add(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> index=queue.poll();</span><br><span class="line">        <span class="keyword">if</span> (!visit[index]) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=index+<span class="number">1</span>;i<=s.length();i++) {</span><br><span class="line">                <span class="keyword">if</span>(dict.contains(s.substring(index,i))){</span><br><span class="line">                    <span class="keyword">if</span> (i==s.length()) {</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    }</span><br><span class="line">                    queue.add(i);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            visit[index]=<span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€å¼€å§‹æ²¡æƒ³åˆ°ç”¨visitæ•°ç»„ï¼Œæ„Ÿè§‰indexæ˜¯é€’å¢çš„å¥½åƒæ²¡ä»€ä¹ˆé‡å¤çš„å…ƒç´ ï¼Œä½†æ˜¯å…¶å®æ˜¯æœ‰çš„ï¼Œä¸ç”¨visitä¼šè¶…æ—¶</p><h2 id="1255-å¾—åˆ†æœ€é«˜çš„å•è¯é›†åˆ"><a href="#1255-å¾—åˆ†æœ€é«˜çš„å•è¯é›†åˆ" class="headerlink" title="1255. å¾—åˆ†æœ€é«˜çš„å•è¯é›†åˆ"></a><a href="https://leetcode-cn.com/problems/maximum-score-words-formed-by-letters/" target="_blank" rel="noopener">1255. å¾—åˆ†æœ€é«˜çš„å•è¯é›†åˆ</a></h2><p>ä½ å°†ä¼šå¾—åˆ°ä¸€ä»½å•è¯è¡¨ wordsï¼Œä¸€ä¸ªå­—æ¯è¡¨ letters ï¼ˆå¯èƒ½ä¼šæœ‰é‡å¤å­—æ¯ï¼‰ï¼Œä»¥åŠæ¯ä¸ªå­—æ¯å¯¹åº”çš„å¾—åˆ†æƒ…å†µè¡¨ scoreã€‚</p><p>è¯·ä½ å¸®å¿™è®¡ç®—ç©å®¶åœ¨å•è¯æ‹¼å†™æ¸¸æˆä¸­æ‰€èƒ½è·å¾—çš„ã€Œæœ€é«˜å¾—åˆ†ã€ï¼šèƒ½å¤Ÿç”± letters é‡Œçš„å­—æ¯æ‹¼å†™å‡ºçš„ ä»»æ„ å±äº words å•è¯å­é›†ä¸­ï¼Œåˆ†æ•°æœ€é«˜çš„å•è¯é›†åˆçš„å¾—åˆ†ã€‚</p><p>å•è¯æ‹¼å†™æ¸¸æˆçš„è§„åˆ™æ¦‚è¿°å¦‚ä¸‹ï¼š</p><ul><li>ç©å®¶éœ€è¦ç”¨å­—æ¯è¡¨ letters é‡Œçš„å­—æ¯æ¥æ‹¼å†™å•è¯è¡¨ words ä¸­çš„å•è¯ã€‚</li><li>å¯ä»¥åªä½¿ç”¨å­—æ¯è¡¨ letters ä¸­çš„éƒ¨åˆ†å­—æ¯ï¼Œä½†æ˜¯æ¯ä¸ªå­—æ¯æœ€å¤šè¢«ä½¿ç”¨ä¸€æ¬¡ã€‚</li><li>å•è¯è¡¨ words ä¸­æ¯ä¸ªå•è¯åªèƒ½è®¡åˆ†ï¼ˆä½¿ç”¨ï¼‰ä¸€æ¬¡ã€‚</li><li>æ ¹æ®å­—æ¯å¾—åˆ†æƒ…å†µè¡¨scoreï¼Œå­—æ¯ â€˜aâ€™, â€˜bâ€™, â€˜câ€™, â€¦ , â€˜zâ€™ å¯¹åº”çš„å¾—åˆ†åˆ†åˆ«ä¸º score[0], score[1], â€¦, score[25]ã€‚</li><li>æœ¬åœºæ¸¸æˆçš„ã€Œå¾—åˆ†ã€æ˜¯æŒ‡ï¼šç©å®¶æ‰€æ‹¼å†™å‡ºçš„å•è¯é›†åˆé‡ŒåŒ…å«çš„æ‰€æœ‰å­—æ¯çš„å¾—åˆ†ä¹‹å’Œ</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šwords = [<span class="string">"dog"</span>,<span class="string">"cat"</span>,<span class="string">"dad"</span>,<span class="string">"good"</span>], letters = [<span class="string">"a"</span>,<span class="string">"a"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"d"</span>,<span class="string">"d"</span>,<span class="string">"g"</span>,<span class="string">"o"</span>,<span class="string">"o"</span>], score = [<span class="number">1</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">23</span></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">å­—æ¯å¾—åˆ†ä¸º  a=<span class="number">1</span>, c=<span class="number">9</span>, d=<span class="number">5</span>, g=<span class="number">3</span>, o=<span class="number">2</span></span><br><span class="line">ä½¿ç”¨ç»™å®šçš„å­—æ¯è¡¨ lettersï¼Œæˆ‘ä»¬å¯ä»¥æ‹¼å†™å•è¯ <span class="string">"dad"</span> (<span class="number">5</span>+<span class="number">1</span>+<span class="number">5</span>)å’Œ <span class="string">"good"</span> (<span class="number">3</span>+<span class="number">2</span>+<span class="number">2</span>+<span class="number">5</span>)ï¼Œå¾—åˆ†ä¸º <span class="number">23</span> ã€‚</span><br><span class="line">è€Œå•è¯ <span class="string">"dad"</span> å’Œ <span class="string">"dog"</span> åªèƒ½å¾—åˆ° <span class="number">21</span> åˆ†ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šwords = [<span class="string">"xxxz"</span>,<span class="string">"ax"</span>,<span class="string">"bx"</span>,<span class="string">"cx"</span>], letters = [<span class="string">"z"</span>,<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"x"</span>,<span class="string">"x"</span>,<span class="string">"x"</span>], score = [<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">10</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">27</span></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">å­—æ¯å¾—åˆ†ä¸º  a=<span class="number">4</span>, b=<span class="number">4</span>, c=<span class="number">4</span>, x=<span class="number">5</span>, z=<span class="number">10</span></span><br><span class="line">ä½¿ç”¨ç»™å®šçš„å­—æ¯è¡¨ lettersï¼Œæˆ‘ä»¬å¯ä»¥ç»„æˆå•è¯ <span class="string">"ax"</span> (<span class="number">4</span>+<span class="number">5</span>)ï¼Œ <span class="string">"bx"</span> (<span class="number">4</span>+<span class="number">5</span>) å’Œ <span class="string">"cx"</span> (<span class="number">4</span>+<span class="number">5</span>) ï¼Œæ€»å¾—åˆ†ä¸º <span class="number">27</span> ã€‚</span><br><span class="line">å•è¯ <span class="string">"xxxz"</span> çš„å¾—åˆ†ä»…ä¸º <span class="number">25</span> ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šwords = [<span class="string">"leetcode"</span>], letters = [<span class="string">"l"</span>,<span class="string">"e"</span>,<span class="string">"t"</span>,<span class="string">"c"</span>,<span class="string">"o"</span>,<span class="string">"d"</span>], score = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">0</span></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">å­—æ¯ <span class="string">"e"</span> åœ¨å­—æ¯è¡¨ letters ä¸­åªå‡ºç°äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥æ— æ³•ç»„æˆå•è¯è¡¨ words ä¸­çš„å•è¯ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= words.length <= 14</code></li><li><code>1 <= words[i].length <= 15</code></li><li><code>1 <= letters.length <= 100</code></li><li><code>letters[i].length == 1</code></li><li><code>score.length == 26</code></li><li><code>0 <= score[i] <= 10</code></li><li><code>words[i] å’Œ letters[i]</code>åªåŒ…å«å°å†™çš„è‹±æ–‡å­—æ¯</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>çœ‹ç€é¢˜ç›®å°±çŸ¥é“è¿™é¢˜ä¸ç®€å•ğŸ˜‚ï¼Œ11.10çš„å‘¨èµ›æœ€åä¸€é¢˜ï¼Œ1msï¼Œç”¨01èƒŒåŒ…çš„æ€è·¯åšçš„ï¼Œå¾ˆå¤šåœ°æ–¹å…¶å®è¿˜æ²¡å¤„ç†å¥½</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxScoreWords</span><span class="params">(String[] words, <span class="keyword">char</span>[] letters, <span class="keyword">int</span>[] score)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] les=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<letters.length;i++) {< span><br><span class="line">        les[letters[i]-<span class="string">'a'</span>]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> maxScoreWords(words,letters,score,<span class="number">0</span>,les);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxScoreWords</span><span class="params">(String[] words, <span class="keyword">char</span>[] letters, <span class="keyword">int</span>[] score,<span class="keyword">int</span> index,<span class="keyword">int</span>[] les)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index==words.length) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=maxScoreWords(words,letters,score,index+<span class="number">1</span>,les);</span><br><span class="line">    String word=words[index];</span><br><span class="line">    <span class="keyword">if</span> (hasWord(les,word)) {</span><br><span class="line">        <span class="keyword">int</span>[] bak=<span class="keyword">new</span> <span class="keyword">int</span>[les.length];</span><br><span class="line">        System.arraycopy(les,<span class="number">0</span>,bak,<span class="number">0</span>,les.length);</span><br><span class="line">        res=Math.max(res,getScore(bak,word,score)+maxScoreWords(words,letters,score,index+<span class="number">1</span>,bak));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasWord</span><span class="params">(<span class="keyword">int</span>[] les,String word)</span></span>{</span><br><span class="line">    <span class="keyword">int</span>[] bak=<span class="keyword">new</span> <span class="keyword">int</span>[les.length];</span><br><span class="line">    System.arraycopy(les,<span class="number">0</span>,bak,<span class="number">0</span>,les.length);</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">char</span> c:word.toCharArray()){</span><br><span class="line">        <span class="keyword">if</span> (bak[c-<span class="string">'a'</span>]!=<span class="number">0</span>) {</span><br><span class="line">            bak[c-<span class="string">'a'</span>]--;</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count==word.length();</span><br><span class="line">}   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">(<span class="keyword">int</span>[] les,String word,<span class="keyword">int</span>[] score)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> sc=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c:word.toCharArray()) {</span><br><span class="line">        les[c-<span class="string">'a'</span>]--;</span><br><span class="line">        sc+=score[c-<span class="string">'a'</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sc;</span><br><span class="line">}</span><br></letters.length;i++)></span></pre></td></tr></tbody></table></figure></div></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> èƒŒåŒ… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mapæ˜ å°„</title>
      <link href="/2019/11/25/map-ying-she/"/>
      <url>/2019/11/25/map-ying-she/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="Mapæ¥å£"><a href="#Mapæ¥å£" class="headerlink" title="Mapæ¥å£"></a>Mapæ¥å£</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Map</span><<span class="title">K</span>,<span class="title">V</span>></span>{</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(K key,V value)</span></span>;</span><br><span class="line">    <span class="function">V <span class="title">remove</span><span class="params">(K key)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(K key)</span></span>;</span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">(K key)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(K key,V newValue)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="LinkedListMap"><a href="#LinkedListMap" class="headerlink" title="LinkedListMap"></a>LinkedListMap</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedListMap</span><<span class="title">K</span>,<span class="title">V</span>> <span class="keyword">implements</span> <span class="title">Map</span><<span class="title">K</span>,<span class="title">V</span>></span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">public</span> K key;</span><br><span class="line">        <span class="keyword">public</span> V value;</span><br><span class="line">        <span class="keyword">public</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(K key,V value,Node next)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.key=key;</span><br><span class="line">            <span class="keyword">this</span>.value=value;</span><br><span class="line">            <span class="keyword">this</span>.next=next;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(K key)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>(key,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>{</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>{</span><br><span class="line">            <span class="keyword">return</span> key.toString()+<span class="string">" : "</span>+value.toString();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node dummyNode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedListMap</span><span class="params">()</span></span>{</span><br><span class="line">        dummyNode=<span class="keyword">new</span> Node();</span><br><span class="line">        size=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size==<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">getNode</span><span class="params">(K key)</span></span>{</span><br><span class="line">        Node cur=dummyNode.next;</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">if</span> (cur.key.equals(key)) {</span><br><span class="line">                <span class="keyword">return</span> cur;</span><br><span class="line">            }</span><br><span class="line">            cur=cur.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(K key)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> getNode(key)==<span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span></span>{</span><br><span class="line">        Node node=getNode(key);</span><br><span class="line">        <span class="keyword">return</span> node==<span class="keyword">null</span>?<span class="keyword">null</span>:node.value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(K key,V value)</span></span>{</span><br><span class="line">        Node node = getNode(key);</span><br><span class="line">        <span class="keyword">if</span>(node==<span class="keyword">null</span>){</span><br><span class="line">            dummyNode.next=<span class="keyword">new</span> Node(key,value,dummyNode.next);</span><br><span class="line">            size++;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            node.value=value;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(K key,V value)</span></span>{</span><br><span class="line">        Node node = getNode(key);</span><br><span class="line">        <span class="keyword">if</span>(contains(key)){</span><br><span class="line">            node.value=value;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(key +<span class="string">" doesn't exist!"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K key)</span></span>{</span><br><span class="line">        Node prev=dummyNode;</span><br><span class="line">        <span class="keyword">while</span>(prev.next!=<span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">if</span> (prev.next.key.equals(key)) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            prev=prev.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (prev.next==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//å…¶å®å¯ä»¥å’Œä¸Šé¢ä¸€æ ·æŠ›ä¸€ä¸ªå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        Node deleNode=prev.next;</span><br><span class="line">        prev.next=deleNode.next;</span><br><span class="line">        deleNode.next=<span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> deleNode.value;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="BSTMap"><a href="#BSTMap" class="headerlink" title="BSTMap"></a>BSTMap</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BSTMap</span><<span class="title">K</span> <span class="keyword">extends</span> <span class="title">Comparable</span>,<span class="title">V</span>> <span class="keyword">implements</span> <span class="title">Map</span><<span class="title">K</span>,<span class="title">V</span>></span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">public</span> K key;</span><br><span class="line">        <span class="keyword">public</span> V value;</span><br><span class="line">        <span class="keyword">public</span> Node left;</span><br><span class="line">        <span class="keyword">public</span> Node right;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(K key,V value)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.key=key;</span><br><span class="line">            <span class="keyword">this</span>.value=value;</span><br><span class="line">            left=<span class="keyword">null</span>;</span><br><span class="line">            right=<span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BSTMap</span><span class="params">()</span></span>{</span><br><span class="line">        root=<span class="keyword">null</span>;</span><br><span class="line">        size=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size==<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(K key,V value)</span></span>{</span><br><span class="line">        root=put(root,key,value);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//addå…ƒç´ åè¿”å›æ–°çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">put</span><span class="params">(Node node,K key,V value)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) {</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Node(key,value);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(key.compareTo(node.key) < <span class="number">0</span>){</span><br><span class="line">            node.left=put(node.left, key,value);</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (key.compareTo(node.key) > <span class="number">0</span>) {</span><br><span class="line">            node.right=put(node.right, key,value);   </span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//ç›¸ç­‰çš„æƒ…å†µ</span></span><br><span class="line">            node.value=value;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">getNode</span><span class="params">(Node node,K key)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (node==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> temp=node.key.compareTo(key);</span><br><span class="line">        <span class="keyword">if</span> (temp==<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (temp><span class="number">0</span>) { <span class="comment">//node.key > key</span></span><br><span class="line">            <span class="keyword">return</span> getNode(node.left,key);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> getNode(node.right,key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(K key)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> getNode(root,key)!=<span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span></span>{</span><br><span class="line">        Node node=getNode(root,key);</span><br><span class="line">        <span class="keyword">return</span> node==<span class="keyword">null</span>?<span class="keyword">null</span>:node.value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(K key,V newValue)</span></span>{</span><br><span class="line">        Node node=getNode(root,key);</span><br><span class="line">        <span class="keyword">if</span> (node!=<span class="keyword">null</span>) {</span><br><span class="line">            node.value=newValue;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(key+ <span class="string">" doesn't exist"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">getMin</span><span class="params">(Node root)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (root.left==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> getMin(root.left);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">deleteMin</span><span class="params">(Node node)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (node.left==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> node.right;</span><br><span class="line">        }</span><br><span class="line">        node.left=deleteMin(node.left);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K key)</span></span>{</span><br><span class="line">        Node node=getNode(root,key);</span><br><span class="line">        <span class="keyword">if</span> (node==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        root=remove(node,key);</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> node.value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">remove</span><span class="params">(Node root,K key)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (key.compareTo(root.key)><span class="number">0</span>) { <span class="comment">//key > root</span></span><br><span class="line">            root.right=remove(root.right,key);</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (key.compareTo(root.key)<<span class="number">0</span>) {</span><br><span class="line">            root.left=remove(root.left,key);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">if</span> (root.left==<span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> root.right;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (root.right==<span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> root.left;</span><br><span class="line">            }</span><br><span class="line">            Node deleNode=root;</span><br><span class="line">            root=getMin(root.right);</span><br><span class="line">            root.right=deleteMin(deleNode.right);</span><br><span class="line">            root.left=deleNode.left;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="MapTest"><a href="#MapTest" class="headerlink" title="MapTest"></a>MapTest</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapTest</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Map<integer,integer> map=<span class="keyword">new</span> BSTMap<>();</integer,integer></span><br><span class="line">        map.put(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">4</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">5</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">6</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">7</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">8</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="number">9</span>,<span class="number">32131</span>);</span><br><span class="line">        map.put(<span class="number">11</span>,<span class="number">2</span>);</span><br><span class="line">        System.out.println(map.contains(<span class="number">13</span>)); <span class="comment">//false</span></span><br><span class="line">        System.out.println(map.getSize()); <span class="comment">//10</span></span><br><span class="line">        System.out.println(map.get(<span class="number">9</span>)); <span class="comment">//32131</span></span><br><span class="line">        map.remove(<span class="number">9</span>);</span><br><span class="line">        System.out.println(map.get(<span class="number">9</span>)); <span class="comment">//null</span></span><br><span class="line">        System.out.println(map.getSize()); <span class="comment">//10</span></span><br><span class="line">        map.set(<span class="number">11</span>,<span class="number">1234567</span>);</span><br><span class="line">        System.out.println(map.get(<span class="number">11</span>)); <span class="comment">//1234567</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a>æºç åœ°å€</h2><p><a href="https://github.com/imlgw/LeetCode/tree/master/tree/map" target="_blank" rel="noopener">Github</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> æ˜ å°„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LRUé˜Ÿåˆ—å®ç°</title>
      <link href="/2019/11/16/lrucache/"/>
      <url>/2019/11/16/lrucache/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="146-LRUç¼“å­˜æœºåˆ¶"><a href="#146-LRUç¼“å­˜æœºåˆ¶" class="headerlink" title="146. LRUç¼“å­˜æœºåˆ¶"></a><a href="https://leetcode-cn.com/problems/lru-cache/" target="_blank" rel="noopener">146. LRUç¼“å­˜æœºåˆ¶</a></h2><p>è¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª  LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ã€‚å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® get å’Œ å†™å…¥æ•°æ® put ã€‚</p><p>è·å–æ•°æ® <code>get(key)</code> - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚<br>å†™å…¥æ•°æ® <code>put(key, value)</code> - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚</p><p><strong>è¿›é˜¶:</strong></p><p>ä½ æ˜¯å¦å¯ä»¥åœ¨ <code>O(1)</code> æ—¶é—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸¤ç§æ“ä½œï¼Ÿ</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">LRUCache cache = <span class="keyword">new</span> LRUCache( <span class="number">2</span> <span class="comment">/* ç¼“å­˜å®¹é‡ */</span> );</span><br><span class="line"></span><br><span class="line">cache.put(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">cache.put(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">cache.get(<span class="number">1</span>);       <span class="comment">// è¿”å›  1</span></span><br><span class="line">cache.put(<span class="number">3</span>, <span class="number">3</span>);    <span class="comment">// è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ</span></span><br><span class="line">cache.get(<span class="number">2</span>);       <span class="comment">// è¿”å› -1 (æœªæ‰¾åˆ°)</span></span><br><span class="line">cache.put(<span class="number">4</span>, <span class="number">4</span>);    <span class="comment">// è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ</span></span><br><span class="line">cache.get(<span class="number">1</span>);       <span class="comment">// è¿”å› -1 (æœªæ‰¾åˆ°)</span></span><br><span class="line">cache.get(<span class="number">3</span>);       <span class="comment">// è¿”å›  3</span></span><br><span class="line">cache.get(<span class="number">4</span>);       <span class="comment">// è¿”å›  4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ”¹äº†å¥½å‡ æ¬¡æ‰æ”¹å¯¹ï¼Œæ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨HashMap+åŒå‘é“¾è¡¨</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">int</span> key;</span><br><span class="line">        <span class="keyword">int</span> value;</span><br><span class="line">        Node pre;</span><br><span class="line">        Node next;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> key,<span class="keyword">int</span> value)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.value=value;</span><br><span class="line">            <span class="keyword">this</span>.key=key;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    HashMap<integer,node> map=<span class="keyword">new</span> HashMap<>();</integer,node></span><br><span class="line"></span><br><span class="line">    Node head=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    Node tail=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> capacity=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LRUCache</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.capacity=capacity;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) {</span><br><span class="line">            Node node=map.get(key);</span><br><span class="line">            <span class="comment">//ç§»åŠ¨åˆ°é“¾è¡¨å¤´</span></span><br><span class="line">            move2Head(node);</span><br><span class="line">            <span class="keyword">return</span> node.value;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">        Node newHead=<span class="keyword">new</span> Node(key,value);</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) {</span><br><span class="line">            Node node=map.get(key);</span><br><span class="line">            node.value=value;</span><br><span class="line">            <span class="comment">//ç§»åŠ¨åˆ°é“¾è¡¨å¤´</span></span><br><span class="line">            move2Head(node);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (map.size()==capacity) {</span><br><span class="line">            map.remove(tail.key);</span><br><span class="line">            removeNode(tail);</span><br><span class="line">        }</span><br><span class="line">        move2Head(newHead);</span><br><span class="line">        map.put(key,newHead);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeNode</span><span class="params">(Node node)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (node.key==tail.key) {</span><br><span class="line">            tail=tail.pre;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (node.pre==<span class="keyword">null</span> || node.next==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        node.pre.next=node.next;</span><br><span class="line">        node.next.pre=node.pre;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move2Head</span><span class="params">(Node newHead)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (map.size()==<span class="number">0</span>) {</span><br><span class="line">            head=tail=newHead;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (newHead.key==head.key) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        removeNode(newHead);</span><br><span class="line">        newHead.next=head;</span><br><span class="line">        newHead.pre=<span class="keyword">null</span>;</span><br><span class="line">        head.pre=newHead;</span><br><span class="line">        head=newHead;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your LRUCache object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * LRUCache obj = new LRUCache(capacity);</span></span><br><span class="line"><span class="comment"> * int param_1 = obj.get(key);</span></span><br><span class="line"><span class="comment"> * obj.put(key,value);</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></tbody></table></figure></div><p>æ—¢ç„¶å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å°±æ¥è€ƒè™‘ä¸‹ä¸ºå•¥è¦è¿™æ ·å®ç°</p><p>å…¶å®æˆ‘ä¸€å¼€å§‹ä¹Ÿä¸çŸ¥é“å’‹å®ç°ï¼ŒæŸ¥äº†ä¸‹æ‰çŸ¥é“ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li><p>é¦–å…ˆæ˜¯é¢˜ç›®è¦æ±‚get/putæ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code> çš„ï¼Œè€Œæˆ‘ä»¬åœ¨get/putçš„æ—¶å€™è‚¯å®šä¼šé¢‘ç¹çš„ç§»åŠ¨å…ƒç´ çš„ä½ç½®ï¼Œé‚£æˆ‘ä»¬è‚¯å®šæ˜¯ä¸èƒ½ç”¨æ•°ç»„ï¼Œé˜Ÿåˆ—ä¹‹ç±»çš„ç»“æ„äº†</p></li><li><p>é‚£æˆ‘ä»¬èƒ½ç”¨å•é“¾è¡¨ä¹ˆï¼Ÿæˆ‘ä»¬å¯ä»¥å°†æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹æ”¾åœ¨å¤´éƒ¨ï¼Œç„¶åæ¯æ¬¡æ»¡çš„æ—¶å€™å‰”é™¤å°¾èŠ‚ç‚¹çš„å…ƒç´ ï¼Œç”±äºæ˜¯é“¾è¡¨ï¼Œç§»åŠ¨èŠ‚ç‚¹çš„ä½ç½®éƒ½æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœè¦getä¸€ä¸ªå…ƒç´ çš„æ—¶å€™å°±éº»çƒ¦äº†ï¼Œéœ€è¦éå†æ•´ä¸ªé“¾è¡¨æ‰èƒ½å–åˆ°å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´å•é“¾è¡¨å®šä½æŸä¸ªå…ƒç´ æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ç”¨HashMapæ¥è¾…åŠ©å•é“¾è¡¨ï¼Œè¿™æ ·æˆ‘ä»¬ä»¥keyä¸ºmapçš„keyï¼ŒNodeèŠ‚ç‚¹ä¸ºmapçš„valueå°±å¯ä»¥è¿…é€Ÿå®šä½åˆ°æŸä¸ªå…ƒç´ </p></li><li><p>å•é“¾è¡¨+HashMapå°±å¯ä»¥äº†ä¹ˆï¼Ÿå…¶å®è¿˜å·®ç‚¹å„¿ï¼Œå¦‚æœç°åœ¨æ»¡äº†ï¼Œéœ€è¦åˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å°†tailçš„å‰ä¸€ä¸ªä½œä¸ºæ–°çš„tailï¼Œä½†æ˜¯ç”±äºæ˜¯å•é“¾è¡¨ï¼Œæ²¡æœ‰å‰ç½®æŒ‡é’ˆï¼Œä¸æ–¹ä¾¿å®šä½å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€åçš„æ–¹æ¡ˆå°±æ˜¯é‡‡ç”¨<strong>åŒå‘é“¾è¡¨+HashMap</strong>æ¥å®ç°LRU</p><p><img alt="img" data-src="https://pic4.zhimg.com/80/v2-09f037608b1b2de70b52d1312ef3b307_hd.jpg" src="/img/loading.gif" class="lazyload"></p></li></ol><p>å…¶å®LRUæ€æƒ³å¹¶ä¸å¤æ‚ï¼ŒæŒ‰ç…§è§„åˆ™æ¥ç§»åŠ¨èŠ‚ç‚¹ï¼Œåˆ é™¤èŠ‚ç‚¹å°±OKï¼Œæ“ä½œç³»ç»Ÿæ•™ç¨‹ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„è¿‡ç¨‹å›¾ï¼Œç†è§£äº†ä¸‹é¢çš„å›¾ä»£ç å°±å¥½å†™äº†</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191116/BISfMVdI96FT.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä½†æ˜¯å¦‚æœå®ç°çš„æ–¹å¼ä¸å¤ªå¥½çš„è¯ï¼Œå°±ä¼šå†™å¾ˆå¤šif-elseåˆ¤æ–­ä¸€äº›è¾¹ç•Œï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢è‡ªå·±çš„å®ç°å°±æ˜¯ã€‚ã€‚ã€‚</p><p>å…¶å®è¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯æˆ‘ä¸Šé¢çš„æ–¹å¼headå’Œtailæ˜¯çœŸå®çš„èŠ‚ç‚¹ï¼Œä¸æ˜¯è™šèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šæœ‰å¾ˆå¤šè¾¹ç•Œçš„é€»è¾‘åˆ¤æ–­ï¼Œé¢è¯•çš„æ—¶å€™ä¸å»ºè®®é‚£æ ·å†™ï¼Œå¾ˆå®¹æ˜“å‡ºé—®é¢˜ï¼ï¼ï¼</p><p><strong>è§£æ³•äºŒ</strong></p><p>é¢è¯•ä¸­æ¯”è¾ƒæ¨èåƒè¿™æ ·å†™</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">int</span> key;</span><br><span class="line">        <span class="keyword">int</span> value;</span><br><span class="line">        Node pre;</span><br><span class="line">        Node next;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> key,<span class="keyword">int</span> value)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.value=value;</span><br><span class="line">            <span class="keyword">this</span>.key=key;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    HashMap<integer,node> map=<span class="keyword">new</span> HashMap<>();</integer,node></span><br><span class="line"></span><br><span class="line">    Node head=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    Node tail=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> capacity=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LRUCache</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.capacity=capacity;</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–å¤´å°¾èŠ‚ç‚¹,æ³¨æ„è¿™ä¸¤ä¸ªèŠ‚ç‚¹åªæ˜¯ä¸ªå“¨å…µèŠ‚ç‚¹,å¹¶ä¸ä¼šå­˜å…¥mapä¸­</span></span><br><span class="line">        head=<span class="keyword">new</span> Node(-<span class="number">1</span>,-<span class="number">1</span>);</span><br><span class="line">        tail=<span class="keyword">new</span> Node(-<span class="number">1</span>,-<span class="number">1</span>);</span><br><span class="line">        head.next=tail;</span><br><span class="line">        tail.pre=head;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) {</span><br><span class="line">            Node node=map.get(key);</span><br><span class="line">            <span class="comment">//ç§»åŠ¨åˆ°é“¾è¡¨å¤´</span></span><br><span class="line">            move2Head(node);</span><br><span class="line">            <span class="keyword">return</span> node.value;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>{</span><br><span class="line">        Node newHead=<span class="keyword">new</span> Node(key,value);</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) {</span><br><span class="line">            Node node=map.get(key);</span><br><span class="line">            <span class="comment">//è®¾ç½®èŠ‚ç‚¹å€¼ä¸ºæ–°value</span></span><br><span class="line">            node.value=value;</span><br><span class="line">            <span class="comment">//ç§»åŠ¨åˆ°é“¾è¡¨å¤´</span></span><br><span class="line">            move2Head(node);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ»¡äº†,å…ˆå‰”é™¤tailå†æ’å…¥</span></span><br><span class="line">        <span class="keyword">if</span> (map.size()==capacity) {</span><br><span class="line">            map.remove(popTail().key);</span><br><span class="line">        }</span><br><span class="line">        addFirst(newHead);</span><br><span class="line">        map.put(key,newHead);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼¹å‡ºtail</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">popTail</span><span class="params">()</span></span>{</span><br><span class="line">        Node newTail=tail.pre;</span><br><span class="line">        removeNode(newTail);</span><br><span class="line">        <span class="keyword">return</span> newTail;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§»é™¤èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeNode</span><span class="params">(Node node)</span></span>{</span><br><span class="line">        node.pre.next=node.next;</span><br><span class="line">        node.next.pre=node.pre;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»å¤´æ·»åŠ </span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(Node node)</span></span>{</span><br><span class="line">        node.next=head.next;</span><br><span class="line">        head.next.pre=node;</span><br><span class="line">        head.next=node;</span><br><span class="line">        node.pre=head;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§»åŠ¨èŠ‚ç‚¹åˆ°head</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">move2Head</span><span class="params">(Node node)</span></span>{</span><br><span class="line">        <span class="comment">//åˆ é™¤åŸé“¾è¡¨ä¸­å¯¹åº”ä½ç½®çš„node</span></span><br><span class="line">        removeNode(node);</span><br><span class="line">        <span class="comment">//ä»å¤´å†æ·»åŠ ä¸€é</span></span><br><span class="line">        addFirst(node);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åƒè¿™æ ·å†™ï¼Œå°±ä¸ç”¨è€ƒè™‘é‚£ä¹ˆå¤šè¾¹ç•Œï¼Œå†™é‚£ä¹ˆå¤šçš„ifå’Œelseï¼Œé¢„å…ˆå¼€è¾Ÿä¸¤ä¸ªèŠ‚ç‚¹çš„ä½œä¸ºå“¨å…µèŠ‚ç‚¹ï¼Œè¿™æ ·ä»£ç å°±æ˜¾å¾—æ¸…æ™°ç®€æ´ï¼Œä¹Ÿä¸å®¹æ˜“å‡ºé—®é¢˜</p><p><a href="https://zhuanlan.zhihu.com/p/34133067" target="_blank" rel="noopener">å‚è€ƒ</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> LRU </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisæ€ç»´å¯¼å›¾</title>
      <link href="/2019/11/16/redis-si-wei-dao-tu/"/>
      <url>/2019/11/16/redis-si-wei-dao-tu/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:2000px; height:5000px;" src="https://www.processon.com/embed/mind/5dda2b45e4b0bbcb8a6ae8bc"></iframe><h2 id="åŸå§‹Xmindæ–‡ä»¶"><a href="#åŸå§‹Xmindæ–‡ä»¶" class="headerlink" title="åŸå§‹Xmindæ–‡ä»¶"></a>åŸå§‹Xmindæ–‡ä»¶</h2><p><a href="http://static.imlgw.top/Redis.xmind" target="_blank" rel="noopener">Redisæ€ç»´å¯¼å›¾</a></p><p><img alt="Redis" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/Redis.png" src="/img/loading.gif" class="lazyload"></p></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒåˆ†æœç´¢æ ‘</title>
      <link href="/2019/11/08/er-fen-sou-suo-shu/"/>
      <url>/2019/11/08/er-fen-sou-suo-shu/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="äºŒåˆ†æœç´¢æ ‘"><a href="#äºŒåˆ†æœç´¢æ ‘" class="headerlink" title="äºŒåˆ†æœç´¢æ ‘"></a>äºŒåˆ†æœç´¢æ ‘</h2><p><strong>äºŒå‰æŸ¥æ‰¾æ ‘</strong>ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼‰ï¼Œä¹Ÿç§°ä¸º<strong>äºŒåˆ†æœç´¢æ ‘</strong>ï¼Œ<strong>äºŒå‰æœç´¢æ ‘</strong>ã€<strong>æœ‰åºäºŒå‰æ ‘</strong>ï¼ˆordered binary treeï¼‰æˆ–<strong>æ’åºäºŒå‰æ ‘</strong>ï¼ˆsorted binary treeï¼‰ä¹Ÿå¯ä»¥ç®€å†™ä¸º <code>BST</code>ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„<a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%A0%91" target="_blank" rel="noopener">äºŒå‰æ ‘</a>ï¼š</p><ol><li>è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›</li><li>è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›</li><li>ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼›</li><li>æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚</li></ol><p>äºŒå‰æŸ¥æ‰¾æ ‘ç›¸æ¯”äºå…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜åŠ¿åœ¨äºæŸ¥æ‰¾ã€æ’å…¥çš„<a href="https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6" target="_blank" rel="noopener">æ—¶é—´å¤æ‚åº¦</a>è¾ƒä½ã€‚ä¸º<code>O(logN)</code>ã€‚äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯åŸºç¡€æ€§æ•°æ®ç»“æ„ï¼Œç”¨äºæ„å»ºæ›´ä¸ºæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå¦‚é›†åˆï¼Œæ˜ å°„ç­‰</p><h2 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h2><p>å…ˆæ­ä¸€ä¸ªåŸºæœ¬çš„æ¶å­å‡ºæ¥ï¼Œåé¢å†æ¥æ…¢æ…¢çš„å®Œå–„åŠŸèƒ½</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BST</span><<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span><<span class="title">E</span>>></span>{</span><br><span class="line">    <span class="comment">//TreeNode</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>{</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node left;</span><br><span class="line">        <span class="keyword">public</span> Node right;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span></span>{</span><br><span class="line">            <span class="keyword">this</span>.e=e;</span><br><span class="line">            left=<span class="keyword">null</span>;</span><br><span class="line">            right=<span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BST</span><span class="params">()</span></span>{</span><br><span class="line">        root=<span class="keyword">null</span>;</span><br><span class="line">        size=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> size==<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span></span>{</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span></span>{</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h2><p>æ·»åŠ å‡½æ•°ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(logN)</code>ï¼Œåªè¦æŠ“ä½äº†å®ƒçš„æ€§è´¨å°±å¾ˆå¥½å†™ï¼Œç”»ä¸ªå›¾æè¿°ä¸‹è¿™ä¸ªè¿‡ç¨‹</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191113/P39b50Ikv4sV.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>â‘  é¦–å…ˆå’ŒrootèŠ‚ç‚¹8æ¯”è¾ƒï¼Œæ¯”8å°ï¼Œæ‰€ä»¥è‚¯å®šå†8çš„å·¦å­æ ‘ä¸­</p><p>â‘¡ å†å’Œrootçš„å·¦å­æ ‘æ ¹èŠ‚ç‚¹5æ¯”è¾ƒï¼Œæ¯”5å¤§ï¼Œæ‰€ä»¥æœ€åè‚¯å®šæ’å…¥5çš„å³å­æ ‘ä¸­</p><p>â‘¢ å†å’Œ5èŠ‚ç‚¹çš„å³å­æ ‘æ ¹èŠ‚ç‚¹6æ¯”è¾ƒï¼Œæ¯”6å¤§ï¼Œæ‰€ä»¥æœ€åæ’å…¥6çš„å³å­æ ‘ä¸­</p><p>â‘£ å³å­æ ‘ä¸ºç©ºï¼Œç›´æ¥æ’å…¥åˆ°6çš„å³è¾¹</p><p>æ ¹æ®ä¸Šé¢çš„æµç¨‹æˆ‘ä»¬å¾ˆå®¹æ˜“å†™å‡ºä»£ç </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLoop</span><span class="params">(E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        size++;</span><br><span class="line">        root=<span class="keyword">new</span> Node(e);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    Node temp=root;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span> (e.compareTo(temp.e)><span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (temp.right==<span class="keyword">null</span>) {</span><br><span class="line">                temp.right=<span class="keyword">new</span> Node(e);</span><br><span class="line">                size++;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            temp=temp.right;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(temp.e)<<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (temp.left==<span class="keyword">null</span>) {</span><br><span class="line">                temp.left=<span class="keyword">new</span> Node(e);</span><br><span class="line">                size++;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            temp=temp.left;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">return</span>; <span class="comment">//ä¸èƒ½æœ‰ç›¸ç­‰å…ƒç´ </span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæ—¢ç„¶æ˜¯æ ‘ç»“æ„ï¼Œç”¨å¾ªç¯ä¼¼ä¹æœ‰çš„æ˜¾å¾—ä¸å¤Ÿä¼˜é›…ğŸ˜‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°è¯•æŠŠè¿™ä¸ªæ”¹æˆé€’å½’</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add2</span><span class="params">(E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="keyword">null</span>){</span><br><span class="line">        root = <span class="keyword">new</span> Node(e);</span><br><span class="line">        size ++;</span><br><span class="line">    }<span class="keyword">else</span> add(root, e);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘ä»¥nodeä¸ºæ ¹çš„äºŒåˆ†æœç´¢æ ‘ä¸­æ’å…¥å…ƒç´ e,ç•¥æ˜¾ç¹ç</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add2</span><span class="params">(Node node, E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(e.equals(node.e)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(e.compareTo(node.e) < <span class="number">0</span> && node.left == <span class="keyword">null</span>){</span><br><span class="line">        node.left = <span class="keyword">new</span> Node(e);</span><br><span class="line">        size ++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(e.compareTo(node.e) > <span class="number">0</span> && node.right == <span class="keyword">null</span>){</span><br><span class="line">        node.right = <span class="keyword">new</span> Node(e);</span><br><span class="line">        size ++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(e.compareTo(node.e) < <span class="number">0</span>)</span><br><span class="line">        add(node.left, e);</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">//e.compareTo(node.e) > 0</span></span><br><span class="line">    add(node.right, e);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªé€’å½’ï¼Ÿï¼Ÿï¼Ÿå’‹æ„Ÿè§‰æ¯”å¾ªç¯è¿˜ç¹çğŸ™„ </p><p>ç¡®å®ï¼Œä¸Šé¢è¿™ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶å¤ªç¹çäº†ï¼Œ<code>compareTo</code>ä¸€å…±æ¯”è¾ƒäº†4æ¬¡ï¼Œæœ‰å¾ˆå¤šé‡å¤ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—æ”¹æ”¹ğŸ˜‹</p><p>æˆ‘ä»¬è®©è¿™ä¸ª<code>add</code>å‡½æ•°æœ‰è¿”å›å€¼ï¼Œè¿”å›æ’å…¥åçš„æ ¹èŠ‚ç‚¹ï¼Œè¿™æ ·æˆ‘ä»¬çš„å‡½æ•° <code>add(Node node,E e)</code> å®šä¹‰å°±å˜æˆäº† <strong>æ’å…¥å…ƒç´ <code>e</code>åˆ° ä»¥ <code>node</code> ä¸ºæ ¹èŠ‚ç‚¹çš„BSTä¸­ï¼Œå¹¶ä¸”è¿”å›æ ¹èŠ‚ç‚¹</strong> ï¼Œæ¸…æ¥šäº†é€’å½’å‡½æ•°çš„å®šä¹‰ï¼Œæˆ‘ä»¬å†æ¥å†™æ–¹æ³•å°±ä¼šå®¹æ˜“å¾ˆå¤š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span></span>{</span><br><span class="line">    root=add(root,e);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ’å…¥å…ƒç´ `e`åˆ° ä»¥ `node` ä¸ºæ ¹èŠ‚ç‚¹çš„BSTä¸­ï¼Œå¹¶ä¸”è¿”å›æ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) {</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(e.compareTo(node.e) < <span class="number">0</span>){</span><br><span class="line">        <span class="comment">//æ’å…¥å·¦å­æ ‘ä¸­ï¼Œå¹¶è¿”å›æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ¥åœ¨node.left</span></span><br><span class="line">        node.left=add(node.left, e);</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) > <span class="number">0</span>) { <span class="comment">//æ³¨æ„ä¸è¦å†™else,å‰é¢æ²¡æœ‰å¯¹ç›¸ç­‰çš„å…ƒç´ åšåˆ¤æ–­</span></span><br><span class="line">        <span class="comment">//æ’å…¥å³å­æ ‘ä¸­ï¼Œå¹¶è¿”å›æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ¥åœ¨node.right</span></span><br><span class="line">        node.right=add(node.right, e);   </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿˜æ˜¯é‚£å¥è¯ï¼Œå†™é€’å½’å‡½æ•°ï¼Œä¸è¦çº ç»“äºå‡½æ•°çš„æ¯ä¸€æ­¥æ˜¯å¦‚ä½•å»è¿›è¡Œï¼Œå¦‚ä½•å»å¾—åˆ°ç»“æœçš„ï¼Œä»å…¨å±€å‡ºå‘ï¼Œåªè¦ææ¸…æ¥šé€’å½’å‡½æ•°çš„å®šä¹‰ï¼ŒæŒ‰ç…§å‡½æ•°çš„å®šä¹‰æ¥å†™ä»£ç ï¼Œæœ€åæ€è€ƒä¸€ä¸‹è¾¹ç•Œï¼Œæœ€åçš„ä»£ç å°±ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼</p><p>è¿™ä¸ªè¾¹ç•Œçš„æ€è€ƒï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ªç»“æŸæ¡ä»¶ï¼Œæˆ‘ä»¬ä¸ç”¨å»è€ƒè™‘ä¸€æ­¥æ­¥ç›´åˆ°é€’å½’ç»ˆç»“æ—¶æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œæˆ‘ä»¬æ€è€ƒä¸€ä¸‹æç«¯çš„è¾¹ç•Œæƒ…å†µï¼ˆå…¶å®è¿™å°±æ˜¯ç»ˆç»“çš„æƒ…å†µï¼‰ï¼Œrootä¸ºnullï¼Œè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼ŒBSTè¿˜æ˜¯ç©ºçš„ï¼Œè¿™ä¸ªæ—¶å€™addå…ƒç´ ï¼Œå…¶å®æƒ³éƒ½ä¸ç”¨æƒ³ï¼Œè‚¯å®šæ˜¯ç›´æ¥æŠŠè¿™ä¸ª eä½œä¸ºæ ¹èŠ‚ç‚¹è¿”å›å°±okäº†ï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶çš„å°±å†™å‡ºäº†ç»ˆæ­¢æ¡ä»¶</p><h2 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h2><p>æŸ¥æ‰¾ç›¸æ¯”äºä¸Šé¢çš„æ·»åŠ ï¼Œä¼šç®€å•å¾ˆå¤šï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å†™å‡ºä»£ç </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æŸ¥è¯¢æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (e==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> contains(e,root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e,Node root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(root.e)==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> e.compareTo(root.e)<<span class="number">0</span>?contains(e,root.left):contains(e,root.right);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæˆ‘ä¸ºäº†ç®€æ´å†™äº†ä¸‰ç›®ï¼Œä¸ç†Ÿæ‚‰çš„å¯ä»¥æ”¹æˆifï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯<code>O(logN)</code> ï¼Œæ¯”çº¿æ€§è¡¨çš„æŸ¥æ‰¾ä¼šå¿«å¾ˆå¤šï¼</p><h2 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h2><p>è€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œè¿™ä¸ªåœ¨æˆ‘ä¹‹å‰çš„ <a href="http://imlgw.top/2019/11/06/leetcode-er-cha-shu-di-gui/">LeetCode-äºŒå‰æ ‘</a> é‡Œé¢ä¹Ÿåšè¿‡äº†ï¼Œè¿™é‡Œå†ç¿»å‡ºæ¥çœ‹çœ‹ï¼Œå…¶å®é‡ç‚¹æ˜¯æƒ³æŠŠååºéå†ç»™ææ¸…æ¥šäº†ï¼Œä¹‹å‰ä¸€ç›´æŒºè¿·ç³Šçš„</p><h3 id="å‰åºéå†"><a href="#å‰åºéå†" class="headerlink" title="å‰åºéå†"></a>å‰åºéå†</h3><h4 id="é€’å½’å†™æ³•"><a href="#é€’å½’å†™æ³•" class="headerlink" title="é€’å½’å†™æ³•"></a>é€’å½’å†™æ³•</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å‰åºéå†,é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preorderTravelRecur</span><span class="params">()</span></span>{</span><br><span class="line">    preorderTravel(root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">preorderTravel</span><span class="params">(Node root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    System.out.print(root.e+<span class="string">" "</span>);</span><br><span class="line">    preorderTravel(root.left);</span><br><span class="line">    preorderTravel(root.right);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="éé€’å½’å†™æ³•"><a href="#éé€’å½’å†™æ³•" class="headerlink" title="éé€’å½’å†™æ³•"></a>éé€’å½’å†™æ³•</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å‰åºéå†,éé€’å½’å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preorderTravelNoRecur</span><span class="params">()</span></span>{</span><br><span class="line">    Stack<node> stack=<span class="keyword">new</span> Stack<>();</node></span><br><span class="line">    Node cur=root;</span><br><span class="line">    <span class="keyword">while</span>( cur!=<span class="keyword">null</span> || !stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">            System.out.print(cur.e+<span class="string">" "</span>);</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        cur=stack.pop();</span><br><span class="line">        cur=cur.right;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯ç»å…¸çš„å‰åºéå†æ–¹å¼ï¼Œæ˜¯æŒ‰ç…§ â€œæ¨¡æ¿â€ æ¥çš„ï¼Œé¦–å…ˆæˆ‘ä»¬è€ƒè™‘æ ˆé‡Œé¢å­˜çš„æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œçš„æ ˆé‡Œé¢å­˜çš„å®é™…ä¸Šæ˜¯ <code>å·¦å­æ ‘çš„å·¦è¾¹</code> çš„é›†åˆï¼Œè¿™é‡Œæˆ‘ä¸çŸ¥é“å’‹æè¿°ï¼Œç”»ä¸ªå›¾å§</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191113/BF0cCcWcy3zP.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å›¾ä¸­ç»¿è‰²éƒ¨åˆ†å°±æ˜¯æˆ‘æ‰€è¯´çš„<strong>å·¦å­æ ‘çš„å·¦è¾¹çš„é›†åˆ</strong>ï¼Œæ•´ä¸ªæ ˆçš„å…¥æ ˆé¡ºåºå°±æ˜¯ä»å·¦å¾€å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä¾æ¬¡çš„å°†è¿™äº›â€œå·¦è¾¹â€ å…¥æ ˆï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰å·¦å­æ ‘ï¼Œä¹Ÿå°±æ˜¯éå†åˆ°å¶å­èŠ‚ç‚¹çš„æ—¶å€™å¼€å§‹å‡ºæ ˆï¼Œç„¶ååˆ‡æ¢æˆ<code>å½“å‰å‡ºæ ˆçš„èŠ‚ç‚¹</code>çš„å³å­æ ‘ï¼Œå°†å³å­æ ‘çš„<code>å·¦å­æ ‘çš„å·¦è¾¹</code>é‡å¤å‰é¢çš„è¿‡ç¨‹ç»§ç»­å…¥æ ˆå‡ºæ ˆï¼Œæˆ‘ä»¬è¦è€ƒè™‘çš„å°±æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è®¿é—®èŠ‚ç‚¹ï¼</p><p>ç»†å¿ƒçš„åŒå­¦è‚¯å®šå·²ç»å‘ç°äº†ï¼Œå…¶å®è¿™é‡Œè¿›æ ˆé¡ºåºå’Œå‡ºæ ˆé¡ºåºï¼Œåˆ†åˆ«å¯¹åº”çš„å°±æ˜¯è¿™é¢—æ ‘å‰åºéå†å’Œä¸­åºéå†ï¼ï¼ï¼æ‰€ä»¥æˆ‘ä»¬å°±åªéœ€è¦åœ¨è¿›æ ˆå’Œå‡ºæ ˆçš„æ—¶å€™ï¼Œè¿›è¡Œè®¿é—®èŠ‚ç‚¹çš„æ“ä½œï¼Œå°±å¯ä»¥å®Œæˆå‰åºå’Œååºéå†</p><h3 id="ä¸­åºéå†"><a href="#ä¸­åºéå†" class="headerlink" title="ä¸­åºéå†"></a>ä¸­åºéå†</h3><h4 id="é€’å½’å†™æ³•-1"><a href="#é€’å½’å†™æ³•-1" class="headerlink" title="é€’å½’å†™æ³•"></a>é€’å½’å†™æ³•</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸­åºéå†,é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inorderTravelRecur</span><span class="params">()</span></span>{</span><br><span class="line">    inorderTravel(root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inorderTravel</span><span class="params">(Node root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    inorderTravel(root.left);</span><br><span class="line">    System.out.print(root.e+<span class="string">" "</span>);</span><br><span class="line">    inorderTravel(root.right);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="éé€’å½’å†™æ³•-1"><a href="#éé€’å½’å†™æ³•-1" class="headerlink" title="éé€’å½’å†™æ³•"></a>éé€’å½’å†™æ³•</h4><p>ç»“åˆä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„å¾—å‡ºéé€’å½’çš„ä¸­åºéå†çš„å†™æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸­åºéå†,éé€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inorderTravelNoRecur</span><span class="params">()</span></span>{</span><br><span class="line">    Stack<node> stack=<span class="keyword">new</span> Stack<>();</node></span><br><span class="line">    Node cur=root;</span><br><span class="line">    <span class="keyword">while</span>( cur!=<span class="keyword">null</span> || !stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        cur=stack.pop();</span><br><span class="line">        System.out.print(cur.e+<span class="string">" "</span>);</span><br><span class="line">        cur=cur.right;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="ååºéå†"><a href="#ååºéå†" class="headerlink" title="ååºéå†"></a>ååºéå†</h3><h4 id="é€’å½’å†™æ³•-2"><a href="#é€’å½’å†™æ³•-2" class="headerlink" title="é€’å½’å†™æ³•"></a>é€’å½’å†™æ³•</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ååºéå†,é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postorderTravelRecur</span><span class="params">()</span></span>{</span><br><span class="line">    postorderTravel(root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postorderTravel</span><span class="params">(Node root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    postorderTravel(root.left);</span><br><span class="line">    postorderTravel(root.right);</span><br><span class="line">    System.out.print(root.e+<span class="string">" "</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="éé€’å½’å†™æ³•-2"><a href="#éé€’å½’å†™æ³•-2" class="headerlink" title="éé€’å½’å†™æ³•"></a>éé€’å½’å†™æ³•</h4><p>è¿™é‡Œçš„éé€’å½’å†™æ³•å°±ä¸ä¸€æ ·äº†ï¼Œæ¯”å‰ä¸¤ç§è¦å¤æ‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ååºéå†,éé€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postorderTravelNoRecur</span><span class="params">()</span></span>{</span><br><span class="line">    Stack<node> stack=<span class="keyword">new</span> Stack<>();</node></span><br><span class="line">    Node cur=root,lastNode=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span> || !stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        cur=stack.peek();<span class="comment">//æŸ¥çœ‹æ ˆé¡¶å…ƒç´ </span></span><br><span class="line">        <span class="comment">//å¦‚æœå³å­æ ‘ä¸ºç©ºæˆ–è€…å³èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡ï¼Œåˆ™å½“å‰èŠ‚ç‚¹å‡ºæ ˆï¼Œå¹¶è®°å½•lastNode</span></span><br><span class="line">        <span class="keyword">if</span> (cur.right==<span class="keyword">null</span> || lastNode==cur.right) { </span><br><span class="line">            System.out.print(cur.e+<span class="string">" "</span>);</span><br><span class="line">            stack.pop();</span><br><span class="line">            lastNode=cur;</span><br><span class="line">            <span class="comment">//ä¸ºäº†ä¸‹ä¸€æ¬¡èƒ½ç›´æ¥æŸ¥çœ‹æ ˆé¡¶å…ƒç´ </span></span><br><span class="line">            <span class="comment">//curçš„ä½¿å‘½å…¶å®å·²ç»ç»“æŸäº†ï¼Œcurå’Œå®ƒçš„å­©å­éƒ½å·²ç»è®¿é—®äº†ï¼Œä¸‹ä¸€æ¬¡ç›´æ¥ä»æ ˆé¡¶å–ï¼Œä¸ç„¶å°±æ­»å¾ªç¯äº†</span></span><br><span class="line">            cur=<span class="keyword">null</span>; </span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            cur=cur.right;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191113/zM80igBy0RDX.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å…¶å®ä¸ç®¡æ˜¯ä»€ä¹ˆéå†ï¼Œå¯¹äºè¿™ä¸ªæ¨¡æ¿æ¥è¯´ï¼Œ<strong>æ ˆçš„è½¨è¿¹éƒ½æ˜¯ä¸€æ ·çš„</strong>ï¼Œåªä¸è¿‡è®¿é—®èŠ‚ç‚¹çš„æ—¶æœºæœ‰æ‰€ä¸åŒï¼Œè“è‰²çº¿æ¡ä»£è¡¨å®¡æŸ¥çš„é¡ºåºï¼Œçº¢è‰²è¾…åŠ©çš„ä»£è¡¨å‡ºæ ˆéƒ¨åˆ†ï¼Œå³è¾¹å¯¹åº”çš„å°±æ˜¯éå†è¿‡ç¨‹ä¸­æ ˆçš„å˜åŒ–ï¼Œå’Œå¯¹åº”ç»“æœçš„å˜åŒ–ï¼Œå¯¹ç…§è¿™ä¸ªå›¾å†åˆ†æä¸‹å°±å¾ˆæ¸…æ¥šäº†ã€‚</p><p>å¦‚æœè§‰å¾—å®åœ¨æ˜¯ä¸å¥½ç†è§£ä¹Ÿå¯ä»¥æ¢ç”¨ä¸‹é¢çš„æ–¹å¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postorderTravelNoRecur2</span><span class="params">()</span> </span>{</span><br><span class="line">    Stack<node> stack=<span class="keyword">new</span> Stack<>();</node></span><br><span class="line">    stack.push(root);</span><br><span class="line">    Node lastNode=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">        <span class="comment">//å–æ ˆé¡¶å…ƒç´ </span></span><br><span class="line">        Node cur=stack.peek();</span><br><span class="line">        <span class="comment">//å·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼Œæˆ–è€…ä¸Šä¸€ä¸ªè®¿é—®çš„èŠ‚ç‚¹æ˜¯å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å°±è¾“å‡ºè¯¥èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> ( (cur.left==<span class="keyword">null</span> && cur.right ==<span class="keyword">null</span>) || </span><br><span class="line">             (lastNode!=<span class="keyword">null</span> &&(cur.left==lastNode || cur.right==lastNode))){</span><br><span class="line">            stack.pop();</span><br><span class="line">            System.out.print(cur.e+<span class="string">" "</span>);</span><br><span class="line">            lastNode=cur;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">if</span> (cur.right!=<span class="keyword">null</span>) {</span><br><span class="line">                stack.push(cur.right);</span><br><span class="line">            } <span class="keyword">if</span> (cur.left!=<span class="keyword">null</span>) {</span><br><span class="line">                stack.push(cur.left);</span><br><span class="line">            }  </span><br><span class="line">        } </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§æ–¹å¼ç›¸æ¯”ä¸Šé¢å°±å¥½ç†è§£å¤šäº†ï¼Œå·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼Œæˆ–è€…ä¸Šä¸€ä¸ªè®¿é—®çš„èŠ‚ç‚¹æ˜¯å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå°±å¯ä»¥è¾“å‡ºè¯¥èŠ‚ç‚¹äº†ï¼Œæ³¨æ„æ·»åŠ çš„æ—¶å€™æ˜¯é€†åºæ·»åŠ çš„ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å…ˆè®¿é—®å·¦èŠ‚ç‚¹ï¼Œå†è®¿é—®å³èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®æ ¹èŠ‚ç‚¹</p><h3 id="å±‚æ¬¡éå†"><a href="#å±‚æ¬¡éå†" class="headerlink" title="å±‚æ¬¡éå†"></a>å±‚æ¬¡éå†</h3><h4 id="é€’å½’å†™æ³•-3"><a href="#é€’å½’å†™æ³•-3" class="headerlink" title="é€’å½’å†™æ³•"></a>é€’å½’å†™æ³•</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> levelOrder(TreeNode root) {</list<integer></span><br><span class="line">    List<list<integer>> res = <span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    helper(res, root, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">helper</span><span class="params">(List<list<integer>> res, TreeNode root, <span class="keyword">int</span> depth)</list<integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//éœ€è¦å¢åŠ ä¸€å±‚</span></span><br><span class="line">    <span class="keyword">if</span> (res.size() == depth) res.add(<span class="keyword">new</span> LinkedList<>());</span><br><span class="line">    res.get(depth).add(root.val);</span><br><span class="line">    helper(res, root.left, depth + <span class="number">1</span>);</span><br><span class="line">    helper(res, root.right, depth + <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="éé€’å½’å†™æ³•-3"><a href="#éé€’å½’å†™æ³•-3" class="headerlink" title="éé€’å½’å†™æ³•"></a>éé€’å½’å†™æ³•</h4><p>ç»å…¸çš„BFS</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å±‚æ¬¡éå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">levelorderTravel</span><span class="params">()</span></span>{</span><br><span class="line">    Queue<node> queue=<span class="keyword">new</span> LinkedList<>();</node></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            Node node=queue.poll();</span><br><span class="line">            System.out.print(node.e+<span class="string">" "</span>);</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å…¶å®å…³äºå‰ä¸­ååºçš„éå†æ–¹å¼ï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œä¸»è¦è®°å½•çš„æ˜¯<code>æ¨¡æ¿</code>çš„æ€è·¯ï¼Œå…¶å®è¿˜æœ‰ä¸€ç§å¾ˆğŸ‚ğŸºçš„åšæ³•ï¼Œæ¨¡æ‹Ÿç³»ç»Ÿæ ˆçš„æ–¹å¼ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„  <a href="http://imlgw.top/2019/11/06/leetcode-er-cha-shu-di-gui/#144-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86">LeetCodeäºŒå‰æ ‘</a> è¿™é‡Œå°±ä¸å¤šè§£é‡Šäº†</p></blockquote><h2 id="å–æ•´"><a href="#å–æ•´" class="headerlink" title="å–æ•´"></a>å–æ•´</h2><h3 id="å‘ä¸‹å–æ•´ï¼ˆfloorï¼‰"><a href="#å‘ä¸‹å–æ•´ï¼ˆfloorï¼‰" class="headerlink" title="å‘ä¸‹å–æ•´ï¼ˆfloorï¼‰"></a>å‘ä¸‹å–æ•´ï¼ˆfloorï¼‰</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">floor</span><span class="params">(E e)</span></span>{</span><br><span class="line">    Node node=floor(root,e);</span><br><span class="line">    <span class="keyword">return</span> node!=<span class="keyword">null</span>?node.e:<span class="keyword">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">floor</span><span class="params">(Node root,E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> temp=e.compareTo(root.e);</span><br><span class="line">    <span class="keyword">if</span> (temp==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (temp<<span class="number">0</span>) { <span class="comment">//root.e > e,æ±‚å°äºeçš„å€¼,ä¸€å®šåœ¨å·¦è¾¹</span></span><br><span class="line">        <span class="keyword">return</span> floor(root.left,e);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//tmep>0 e>root.e</span></span><br><span class="line">    Node node=floor(root.right,e);</span><br><span class="line">    <span class="keyword">return</span> node!=<span class="keyword">null</span>?node:root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="å‘ä¸Šå–æ•´ï¼ˆceilingï¼‰"><a href="#å‘ä¸Šå–æ•´ï¼ˆceilingï¼‰" class="headerlink" title="å‘ä¸Šå–æ•´ï¼ˆceilingï¼‰"></a>å‘ä¸Šå–æ•´ï¼ˆceilingï¼‰</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">ceiling</span><span class="params">(E e)</span></span>{</span><br><span class="line">    Node node=ceiling(root,e);</span><br><span class="line">    <span class="keyword">return</span> node!=<span class="keyword">null</span>?node.e:<span class="keyword">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">ceiling</span><span class="params">(Node root,E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> temp=e.compareTo(root.e);</span><br><span class="line">    <span class="keyword">if</span> (temp==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (temp><span class="number">0</span>) { <span class="comment">//root.e<e,æ±‚çš„æ˜¯æœ€åå¤§äºroot.eçš„å…ƒç´ ,ä¸€å®šåœ¨å³è¾¹< span></e,æ±‚çš„æ˜¯æœ€åå¤§äºroot.eçš„å…ƒç´ ,ä¸€å®šåœ¨å³è¾¹<></span><br><span class="line">        <span class="keyword">return</span> ceiling(root.right,e);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//tmep<0 e<root.e< span></root.e<></span><br><span class="line">    Node node=ceiling(root.left,e);</span><br><span class="line">    <span class="keyword">return</span> node!=<span class="keyword">null</span>?node:root;</span><br><span class="line">}</span><br></span></span></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸¤ä¸ªå‡½æ•°è¿˜æ˜¯æŒºæœ‰ç”¨çš„ï¼Œæ¯”å¦‚è¿™ä¸ªé¢˜ <a href="http://imlgw.top/2019/09/15/leetcode-cha-zhao/#220-%E5%AD%98%E5%9C%A8%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0-III">220-å­˜åœ¨é‡å¤å…ƒç´ -III </a> é€šè¿‡ç‡åªæœ‰25%çš„midé¢˜ã€‚ã€‚ã€‚ã€‚</p><h2 id="è·å–ç¬¬Kå¤§"><a href="#è·å–ç¬¬Kå¤§" class="headerlink" title="è·å–ç¬¬Kå¤§"></a>è·å–ç¬¬Kå¤§</h2><p>è·å–ç¬¬kå¤§ï¼ˆä»0å¼€å§‹ï¼‰çš„å…ƒç´ ï¼Œå¦‚æœå·¦å­æ ‘èŠ‚ç‚¹æ•°å°äº<code>k</code>ï¼Œåˆ™ç¬¬kå¤§çš„å…ƒç´ è‚¯å®šåœ¨å³å­æ ‘ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥æ’é™¤<code>size(left)+1</code> ä¸ªå…ƒç´ ï¼ˆåŠ ä¸Šæ ¹èŠ‚ç‚¹ï¼‰ ã€‚</p><p>ç„¶åç›´æ¥åœ¨ å³å­æ ‘ä¸­ç»§ç»­æœç´¢ <code>getKth(root.right,k-size(left)-1)</code>  ï¼Œåªæœ‰å½“å·¦å­æ ‘åˆšå¥½kä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæ ¹èŠ‚ç‚¹å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„<code>Kth</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getKth</span><span class="params">(<span class="keyword">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (k>=size || k<<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> getKth(root,k).e;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">getKth</span><span class="params">(Node root,<span class="keyword">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> temp = childSize(root.left);</span><br><span class="line">    <span class="keyword">if</span> (temp>k) {</span><br><span class="line">        <span class="keyword">return</span> getKth(root.left,k);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (temp<k) {< span><br><span class="line">        <span class="keyword">return</span> getKth(root.right,k-temp-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></k)></span></pre></td></tr></tbody></table></figure></div><blockquote><p>è¿™é‡Œå…¶å®æˆ‘çš„å®ç°æ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(NlogN)</code>ï¼ï¼ï¼ï¼ä¸»è¦æ˜¯<code>childSize()</code>æ—¶é—´å¤æ‚åº¦æ˜¯O(N)ä¸æ˜¯O(1)ï¼Œåœ¨ã€Šç®—æ³•4ã€‹ä¸­è¿™ä¸ªå®ç°çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)ï¼Œä¹¦ä¸Šåœ¨å®šä¹‰çš„Nodeçš„æ—¶å€™ç»™NodeåŠ äº†ä¸€ä¸ªcountå±æ€§ï¼Œç”¨æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ï¼Œåœ¨æ¯æ¬¡addå’Œdeleteçš„æ—¶å€™åŠ¨æ€çš„ç»´æŠ¤è¿™ä¸ªcountï¼Œè¿™æ ·æœ€åæ±‚å­èŠ‚ç‚¹æ•°çš„æ“ä½œæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)çš„äº†ï¼Œé‚£ä¸ªç‰ˆæœ¬çš„æˆ‘ä¹Ÿå®ç°äº†ä¸€ä¸‹ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åœ¨è¿™ç¯‡æ–‡ç« ä¸­è¿™æ ·å†™ï¼ˆä¸»è¦æ˜¯æ‡’å¾—æ”¹ï¼‰ï¼Œè€Œä¸”è¿™ä¹Ÿä¸æ˜¯é‡ç‚¹ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹ <a href="https://github.com/imlgw/LeetCode/blob/master/tree/BSTWithCount.java" target="_blank" rel="noopener">BSTWithCount</a> ä¸»è¦å°±æ˜¯è¦<strong>æ³¨æ„æ“ä½œcountçš„æ—¶æœº</strong></p></blockquote><h2 id="Rank"><a href="#Rank" class="headerlink" title="Rank()"></a>Rank()</h2><p>å…¶å®æ˜¯ä¸Šé¢çš„é€†è¿‡ç¨‹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ç­‰äºkeyï¼Œé‚£ä¹ˆç›´æ¥è¿”å›å·¦å­æ ‘çš„é”®æ€»æ•°ï¼›å¦‚æœkeyå°äºæ ¹èŠ‚ç‚¹ï¼Œå°±ç»§ç»­å»å·¦å­æ ‘ä¸­é€’å½’æ‰¾ï¼Œå¦‚æœå¤§äºæ ¹èŠ‚ç‚¹ï¼Œè¿”å›<code>size(left)+1</code>åŠ ä¸Šå®ƒåœ¨å³å­æ ‘ä¸­çš„<code>rank()</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRank</span><span class="params">(E e)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> getRank(root,e);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRank</span><span class="params">(Node root,E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(root.e)<<span class="number">0</span>) { <span class="comment">//e<root.e< span></root.e<></span><br><span class="line">        <span class="keyword">return</span> getRank(root.left,e);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(root.e)><span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> getRank(root.right,e)+childSize(root.left)+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> childSize(root.left);</span><br><span class="line">}</span><br></span></pre></td></tr></tbody></table></figure></div><h2 id="Max-amp-Min"><a href="#Max-amp-Min" class="headerlink" title="Max&Min"></a>Max&Min</h2><p>æ²¡å•¥å¥½è¯´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ±‚æœ€å¤§å€¼,é€’å½’æ¯”è¾ƒä¼˜é›…</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getMax</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">return</span> getMax(root).e;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">getMax</span><span class="params">(Node root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root.right==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> getMax(root.right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ±‚æœ€å°å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getMin</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">return</span> getMin(root).e;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">getMin</span><span class="params">(Node root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root.left==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> getMin(root.left);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><p>åˆ é™¤åº”è¯¥æ¥è¯´æ˜¯BSTä¸­é‡Œé¢æ¯”è¾ƒå¤æ‚çš„ä¸€ä¸ªæ“ä½œäº†ï¼Œæˆ‘ä»¬å…ˆä»ç®€å•çš„å¼€å§‹</p><h3 id="åˆ é™¤æœ€å€¼"><a href="#åˆ é™¤æœ€å€¼" class="headerlink" title="åˆ é™¤æœ€å€¼"></a>åˆ é™¤æœ€å€¼</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ é™¤æœ€å°çš„é”®</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteMin</span><span class="params">()</span></span>{</span><br><span class="line">    root=deleteMin(root);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//åˆ é™¤nodeä¸ºå¤´èŠ‚ç‚¹çš„æ ‘ä¸­çš„æœ€å°å€¼ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">deleteMin</span><span class="params">(Node node)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node.left==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> node.right;</span><br><span class="line">    }</span><br><span class="line">    node.left=deleteMin(node.left);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤æœ€å¤§çš„é”®</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteMax</span><span class="params">()</span></span>{</span><br><span class="line">    root=deleteMax(root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">deleteMax</span><span class="params">(Node node)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node.right==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> node.left;</span><br><span class="line">    }</span><br><span class="line">    node.right=deleteMax(node.right);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é€’å½’å‡½æ•°å®šä¹‰ä¸º<strong>åˆ é™¤nodeä¸ºå¤´èŠ‚ç‚¹çš„æ ‘ä¸­çš„æœ€å°å€¼ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹</strong>ï¼Œåˆ é™¤æœ€å°å€¼å®é™…ä¸Šå°±æ˜¯åˆ é™¤äºŒå‰æ ‘æœ€å·¦è¾¹çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬é€’å½’çš„åˆ é™¤node.leftå°±okï¼Œå½“node.leftä¸ºç©ºçš„æ—¶å€™è¿”å›node.rightï¼Œè¿™æ ·å‰é¢èŠ‚ç‚¹çš„leftå°±æ¥åœ¨äº†node.rightä¸Šï¼Œå°±è¾¾åˆ°äº†åˆ é™¤çš„ä½œç”¨</p><h3 id="åˆ é™¤ä»»æ„å€¼"><a href="#åˆ é™¤ä»»æ„å€¼" class="headerlink" title="åˆ é™¤ä»»æ„å€¼"></a>åˆ é™¤ä»»æ„å€¼</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ é™¤ä»»æ„çš„é”®</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(E e)</span></span>{</span><br><span class="line">    root=delete(root,e);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤ä»¥nodeä¸ºé¦–çš„BSTä¸­,å€¼ä¸ºeçš„èŠ‚ç‚¹å¹¶ä¸”è¿”å›æ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">delete</span><span class="params">(Node node,E e)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(node.e)><span class="number">0</span>) { <span class="comment">//e>root.e</span></span><br><span class="line">        node.right=delete(node.right,e);</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e)<<span class="number">0</span>) {</span><br><span class="line">        node.left=delete(node.left,e);</span><br><span class="line">    }<span class="keyword">else</span>{ <span class="comment">//e==root.e</span></span><br><span class="line">        <span class="keyword">if</span> (node.left==<span class="keyword">null</span>) { <span class="comment">//å¦‚æœæ²¡æœ‰å·¦å­æ ‘å°±è¿”å›å³å­æ ‘</span></span><br><span class="line">            <span class="keyword">return</span> node.right;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (node.right==<span class="keyword">null</span>) { <span class="comment">//å¦‚æœæ²¡æœ‰å³å­æ ‘å°±è¿”å›å·¦å­æ ‘</span></span><br><span class="line">            <span class="keyword">return</span> node.left;</span><br><span class="line">        }</span><br><span class="line">        Node delNode=node;</span><br><span class="line">        <span class="comment">//æœ‰å·¦å³å­èŠ‚ç‚¹éƒ½æœ‰</span></span><br><span class="line">        node=getMin(node.right); <span class="comment">//ç”¨å³å­æ ‘çš„æœ€å°å€¼å¡«è¡¥åˆ é™¤çš„å…ƒç´ çš„ç©ºä½</span></span><br><span class="line">        <span class="comment">//åˆ é™¤å¯¹åº”çš„å³å­æ ‘çš„æœ€å°å€¼,ç„¶åè¿æ¥èµ·æ¥</span></span><br><span class="line">        node.right=deleteMin(delNode.right);</span><br><span class="line">        node.left=delNode.left;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæ–‡å­—çš„æè¿°æ¯”è¾ƒæ— åŠ›ï¼Œç”»ä¸ªå›¾å°±æ¸…æ™°æ˜ç™½äº†ï¼Œæ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯åˆ©ç”¨å³å­æ ‘ä¸­çš„æœ€å°å€¼å¡«è¡¥å¾…åˆ é™¤èŠ‚ç‚¹</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191113/yyI0q2yftm0X.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å½“ç„¶è¿™é‡Œå…¶å®ä¹Ÿæ˜¯æœ‰å‘çš„ï¼Œä¸»è¦å°±æ˜¯è¿æœ€åä¸¤å¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ é™¤å¯¹åº”çš„å³å­æ ‘çš„æœ€å°å€¼,ç„¶åè¿æ¥èµ·æ¥</span></span><br><span class="line">node.right=deleteMin(delNode.right);</span><br><span class="line">node.left=delNode.left;</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œçš„ä¸¤å¥è¯æ˜¯ä¸èƒ½äº¤æ¢çš„ï¼Œå¦‚æœæˆ‘ä»¬äº¤æ¢äº†ä¸¤å¥è¯çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸‹ä¸€æ­¥åˆ é™¤æœ€å°å€¼å°±ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯åˆ é™¤å³å­æ ‘ä¸­æœ€å°çš„nodeèŠ‚ç‚¹ï¼Œç»“æœä½ å…ˆæŠŠå¾…åˆ é™¤èŠ‚ç‚¹çš„leftæ¥åˆ°äº†nodeçš„å·¦è¾¹ï¼Œè¿™æ ·çš„è¯nodeå°±ä¸å†æ˜¯delNode.rightä¸­çš„æœ€å°å€¼ï¼Œæœ€åç»“æœå¯èƒ½å°±ä¼šæˆè¿™ä¸ªæ ·å­ï¼Œæˆäº†ä¸€ä¸ªé—­ç¯ï¼ï¼ï¼</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191113/qc5kHljj03uq.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>æ‰€ä»¥æœ€åçš„ç»“æœè‚¯å®šæ˜¯ä¸å¯¹çš„ï¼Œå…¶å®è¿™ä¸€ç‚¹ä¹¦ä¸Šå¹¶æ²¡æœ‰æåˆ°ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨åšè¿™é“é¢˜<a href="https://leetcode-cn.com/problems/delete-node-in-a-bst/" target="_blank" rel="noopener">åˆ é™¤èŠ‚ç‚¹</a> çš„æ—¶å€™å†™åäº†ï¼Œæ‰å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»è¯•è¯•</p><blockquote><p>å…¶å®è¿™æ ·çš„åˆ é™¤æ—¶ä¸€ç§å¾ˆéšæœºçš„åšæ³•ï¼Œè™½ç„¶èƒ½æ­£ç¡®çš„åˆ é™¤å…ƒç´ ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è€ƒè™‘æ ‘çš„å¯¹ç§°æ€§ï¼Œå…³äºæ ‘çš„å¯¹ç§°æ€§ï¼Œæˆ‘ä»¬åé¢å†æ¥ç ”ç©¶</p></blockquote><h2 id="ä»£ç åœ°å€"><a href="#ä»£ç åœ°å€" class="headerlink" title="ä»£ç åœ°å€"></a>ä»£ç åœ°å€</h2><p><a href="https://github.com/imlgw/LeetCode/blob/master/tree/BST.java" target="_blank" rel="noopener">BST.java</a></p><p><a href="https://github.com/imlgw/LeetCode/blob/master/tree/BSTTest.java" target="_blank" rel="noopener">BSTTest.java</a></p><p><a href="https://github.com/imlgw/LeetCode/blob/master/tree/BSTWithCount.java" target="_blank" rel="noopener">BSTWithCount.java</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeäºŒå‰æ ‘</title>
      <link href="/2019/11/06/leetcode-er-cha-shu/"/>
      <url>/2019/11/06/leetcode-er-cha-shu/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="144-äºŒå‰æ ‘çš„å‰åºéå†"><a href="#144-äºŒå‰æ ‘çš„å‰åºéå†" class="headerlink" title="144. äºŒå‰æ ‘çš„å‰åºéå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-preorder-traversal/" target="_blank" rel="noopener">144. äºŒå‰æ ‘çš„å‰åºéå†</a></h2><p>Given a binary tree, return the <em>preorder</em> traversal of its nodesâ€™ values.</p><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: [<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">   <span class="number">1</span></span><br><span class="line">    \</span><br><span class="line">     <span class="number">2</span></span><br><span class="line">    /</span><br><span class="line">   <span class="number">3</span></span><br><span class="line"></span><br><span class="line">Output: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Follow up:</strong> Recursive solution is trivial, could you do it iteratively?</p><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’ï¼Œæ²¡å•¥å¥½è¯´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">preorderTraversal</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    <span class="keyword">if</span>(root!=<span class="keyword">null</span>){</span><br><span class="line">        res.add(root.val);</span><br><span class="line">        preorderTraversal(root.left);</span><br><span class="line">        preorderTraversal(root.right);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>æ•™ç§‘ä¹¦ä¸Šçš„å†™æ³•ï¼Œç»å…¸çš„å‰åºéå†éé€’å½’å®ç°æ–¹å¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">preorderTraversal</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    stack.push(root);</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">        TreeNode top=stack.pop();</span><br><span class="line">        res.add(top.val);</span><br><span class="line">        <span class="comment">//æ³¨æ„é¡ºåº</span></span><br><span class="line">        <span class="keyword">if</span> (top.right!=<span class="keyword">null</span>) {</span><br><span class="line">            stack.push(top.right);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (top.left!=<span class="keyword">null</span>) {</span><br><span class="line">            stack.push(top.left);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰</strong></p><p>éé€’å½’ï¼Œæ¨¡æ‹Ÿé€’å½’æ ˆçš„æ–¹å¼ï¼Œè®°å½•èŠ‚ç‚¹ä»¥åŠæ˜¯å¦éœ€è¦ç»§ç»­å¯»æ‰¾å­èŠ‚ç‚¹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">preorderTraversal</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<command> stack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">    stack.push(<span class="keyword">new</span> Command(<span class="keyword">true</span>,root));</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">        Command command=stack.pop();</span><br><span class="line">        <span class="keyword">if</span> (!command.isGo) {</span><br><span class="line">            res.add(command.node.val);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            TreeNode node=command.node;</span><br><span class="line">            <span class="comment">//é€†åºè¿›æ ˆ</span></span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                stack.push(<span class="keyword">new</span> Command(<span class="keyword">true</span>,node.right));</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                stack.push(<span class="keyword">new</span> Command(<span class="keyword">true</span>,node.left));</span><br><span class="line">            }    </span><br><span class="line">            stack.push(<span class="keyword">new</span> Command(<span class="keyword">false</span>,node));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Command</span></span>{</span><br><span class="line">    <span class="keyword">boolean</span>  isGo; <span class="comment">//æ˜¯å¦ç»§ç»­å¯»æ‰¾å­èŠ‚ç‚¹</span></span><br><span class="line">    TreeNode node; <span class="comment">//å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Command</span><span class="params">(<span class="keyword">boolean</span> isGo,TreeNode node)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.isGo=isGo;</span><br><span class="line">        <span class="keyword">this</span>.node=node;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>boboè€å¸ˆçš„ä¸€ç§æ€è·¯ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“å¦™äº†ğŸ‘ï¼Œä¸€ä¸‹å°±è§£å†³äº†ä¸‰ç§éå†çš„éé€’å½’å®ç°ï¼Œå¦å¤–ä¸¤ç§åªéœ€è¦è°ƒæ•´ä¸€ä¸‹è¿›æ ˆçš„é¡ºåºå°±å¯ä»¥äº†ï¼</p><p><strong>è§£æ³•å››</strong></p><p>æ‰¾åˆ°ä¸€ä¸ªæ¿å­ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³ä¸‰ç§éå†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç»å…¸çš„éé€’å½’å®ç°æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">preorderTraversal4</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    TreeNode cur=root;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span>||!stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span> (cur!=<span class="keyword">null</span>) {</span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ²¡æœ‰å·¦å­æ ‘äº†</span></span><br><span class="line">        cur=stack.pop();</span><br><span class="line">        <span class="comment">//åˆ‡æ¢ä¸ºå³å­æ ‘</span></span><br><span class="line">        cur=cur.right;</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å…³äº <code>while(cur!=null||!stack.isEmpty())</code>ï¼Œå…¶å®æ ˆä¸­å­˜çš„åªæ˜¯æŸä¸€ä¸ªæ ¹èŠ‚ç‚¹çš„æ‰€æœ‰å·¦å­æ ‘ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ ˆä¸ºç©ºä¸ä»£è¡¨å·²ç»éå†å®Œæ‰€æœ‰èŠ‚ç‚¹äº†ï¼Œåªèƒ½ä»£è¡¨å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘éƒ½éå†å®Œäº†ï¼Œè¿˜æœ‰å³å­æ ‘è¿˜æ²¡éå†ï¼Œåªæœ‰å½“å³å­æ ‘ä¹Ÿä¸ºç©ºä¹Ÿå°±æ˜¯<code>cur==null</code> çš„æ—¶å€™æ‰æ˜¯éå†å®Œäº†ï¼Œå…·ä½“çœ‹ä¸€ä¸‹ä¸‹é¢è¿™é¢—æ ‘å°±æ˜ç™½äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">      <span class="number">5</span></span><br><span class="line">     / \</span><br><span class="line">    <span class="number">4</span>    <span class="number">6</span> </span><br><span class="line">  /      \</span><br><span class="line"><span class="number">3</span>       <span class="number">8</span></span><br></pre></td></tr></tbody></table></figure></div></blockquote><h2 id="589-Nå‰æ ‘çš„å‰åºéå†"><a href="#589-Nå‰æ ‘çš„å‰åºéå†" class="headerlink" title="589. Nå‰æ ‘çš„å‰åºéå†"></a><a href="https://leetcode-cn.com/problems/n-ary-tree-preorder-traversal/" target="_blank" rel="noopener">589. Nå‰æ ‘çš„å‰åºéå†</a></h2><p>ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„<em>å‰åºéå†</em>ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª <code>3å‰æ ‘</code> :</p><p><img alt="MWwEt0.png" data-src="https://s2.ax1x.com/2019/11/20/MWwEt0.png" src="/img/loading.gif" class="lazyload"></p><p>è¿”å›å…¶å‰åºéå†: <code>[1,3,5,6,2,4]</code>ã€‚</p><p><strong>è¯´æ˜:</strong> é€’å½’æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿­ä»£æ³•å®Œæˆæ­¤é¢˜å—?</p><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’æ²¡å•¥å¥½è¯´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//é€’å½’çš„æ–¹å¼</span></span><br><span class="line">List<integer> res=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">preorder</span><span class="params">(Node root)</span> </integer></span>{</span><br><span class="line">    dfs(root);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(Node root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    List<node> children=root.children;</node></span><br><span class="line">    res.add(root.val);</span><br><span class="line">    <span class="keyword">for</span> (Node node:children) {</span><br><span class="line">        preorder(node);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>è¿­ä»£çš„æ–¹å¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">preorder</span><span class="params">(Node root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    Stack<node> stack=<span class="keyword">new</span> Stack<>();</node></span><br><span class="line">    stack.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">        Node node=stack.pop();</span><br><span class="line">        res.add(node.val);</span><br><span class="line">        List<node> children=node.children;</node></span><br><span class="line">        <span class="comment">//é€†åºæ·»åŠ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=children.size()-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">            stack.add(children.get(i));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åˆ°è¿™é‡Œæˆ‘æ˜¯çœŸçš„å¯¹éå†çš„é‚£ä¸ªæ¿å­æ— æ„Ÿäº†ï¼Œè¿™é‡Œæˆ‘å¼€å§‹æƒ³ç”¨æ¿å­å†™ï¼Œç»“æœå‘ç°å¹¶ä¸å¥½å†™ï¼Œæ— ä»ä¸‹æ‰‹ï¼ˆå¯èƒ½æ˜¯æˆ‘å¤ªèœï¼‰ï¼Œæ‰€ä»¥é‡‡ç”¨äº†ç»å…¸çš„å‰åºéå†æ–¹å¼ï¼Œæœç„¶ç»å…¸å°±æ˜¯ç»å…¸ï¼Œé€šç”¨æ€§å¾ˆå¼ºï¼Œè€Œä¸”ç›¸å½“å¥½ç†è§£ï¼Œæ‰€ä»¥ä»¥åé‡åˆ°éå†çš„é¢˜ç›®ï¼Œå°½é‡è¿˜æ˜¯è‡ªå·±å†™ï¼Œåˆ«å¥—æ¿å­ï¼ˆå¯¹ååºçš„æ¿å­ä¹Ÿä¸€ç›´ä¸æ˜¯ç‰¹åˆ«ç†è§£ï¼Œæ‰€ä»¥ä¹Ÿä¸€ç›´æ²¡è®°ä½ï¼Œå¥—æ¿å­è¿˜æ˜¯è¦å»ºç«‹åœ¨ç†è§£çš„åŸºç¡€ä¸Šå•Šï¼Œä¸ç„¶æ°¸è¿œä¸ä¼šåšï¼ï¼‰</p><h2 id="94-äºŒå‰æ ‘çš„ä¸­åºéå†"><a href="#94-äºŒå‰æ ‘çš„ä¸­åºéå†" class="headerlink" title="94. äºŒå‰æ ‘çš„ä¸­åºéå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-inorder-traversal/" target="_blank" rel="noopener">94. äºŒå‰æ ‘çš„ä¸­åºéå†</a></h2><p>Given a binary tree, return the <em>inorder</em> traversal of its nodesâ€™ values.</p><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: [<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">   <span class="number">1</span></span><br><span class="line">    \</span><br><span class="line">     <span class="number">2</span></span><br><span class="line">    /</span><br><span class="line">   <span class="number">3</span></span><br><span class="line"></span><br><span class="line">Output: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Follow up:</strong> Recursive solution is trivial, could you do it iteratively?</p><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’çš„æ–¹å¼å’Œæ¨¡æ‹Ÿæ ˆçš„æ–¹å¼å°±ä¸è®°å½•äº†ï¼Œé‡ç‚¹çœ‹ä¸€ä¸‹è¿™ä¸ªæ¿å­</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç»å…¸çš„éé€’å½’å®ç°æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">inorderTraversal3</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    TreeNode cur=root;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span>||!stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span> (cur!=<span class="keyword">null</span>) {</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ²¡æœ‰å·¦å­æ ‘äº†</span></span><br><span class="line">        cur=stack.pop();</span><br><span class="line">        <span class="comment">//å°†å½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°resä¸­</span></span><br><span class="line">        res.add(cur.val);</span><br><span class="line">        <span class="comment">//åˆ‡æ¢ä¸ºå³å­æ ‘</span></span><br><span class="line">        cur=cur.right;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="145-äºŒå‰æ ‘çš„ååºéå†"><a href="#145-äºŒå‰æ ‘çš„ååºéå†" class="headerlink" title="145. äºŒå‰æ ‘çš„ååºéå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-postorder-traversal/" target="_blank" rel="noopener">145. äºŒå‰æ ‘çš„ååºéå†</a></h2><p>Given a binary tree, return the <em>postorder</em> traversal of its nodesâ€™ values.</p><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: [<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">   <span class="number">1</span></span><br><span class="line">    \</span><br><span class="line">     <span class="number">2</span></span><br><span class="line">    /</span><br><span class="line">   <span class="number">3</span></span><br><span class="line"></span><br><span class="line">Output: [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Follow up:</strong> Recursive solution is trivial, could you do it iteratively?</p><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜æ˜¯ä¸ªhardé¢˜ï¼Œæ²¡é‚£ä¹ˆå®¹æ˜“ï¼ˆä¸è¿‡æ ¹æ®boboè€å¸ˆçš„æ–¹å¼æ¥åšç¡®å®ç®€å•ğŸ˜‚ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">postorderTraversal3</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    TreeNode cur=root,lastNode=<span class="keyword">null</span>; <span class="comment">//lastNodeä¸ºä¸Šä¸€æ¬¡è®¿é—®çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span>||!stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span> (cur!=<span class="keyword">null</span>) {</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ²¡æœ‰å·¦å­æ ‘äº†,æŠŠåä¸€ä¸ªå·¦èŠ‚ç‚¹æ‹¿å‡ºæ¥</span></span><br><span class="line">        cur=stack.peek();</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰å³èŠ‚ç‚¹,æˆ–è€…å³èŠ‚ç‚¹è®¿é—®è¿‡äº†</span></span><br><span class="line">        <span class="keyword">if</span> (cur.right==<span class="keyword">null</span>||cur.right==lastNode) {</span><br><span class="line">            <span class="comment">//æ·»åŠ èŠ‚ç‚¹</span></span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            <span class="comment">//è®°å½•å½“å‰èŠ‚ç‚¹ä¸ºlastNode</span></span><br><span class="line">            lastNode=cur;</span><br><span class="line">            <span class="comment">//å°†ä»–popå‡ºå»</span></span><br><span class="line">            stack.pop();</span><br><span class="line">            <span class="comment">//èŠ‚ç‚¹å·²ç»å¼¹å‡º</span></span><br><span class="line">            <span class="comment">//æŒ‡å‘null,ä¸ç„¶å°±æ­»å¾ªç¯äº†</span></span><br><span class="line">            cur=<span class="keyword">null</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//å³èŠ‚ç‚¹ä¸ä¸ºç©º,å¹¶ä¸”æ²¡è®¿é—®è¿‡</span></span><br><span class="line">            <span class="comment">//åˆ‡æ¢ä¸ºå³å­æ ‘,é‡å¤ä¸Šé¢çš„æ­¥éª¤</span></span><br><span class="line">            cur=cur.right;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§é¢˜ä¸€å®šè¦è®°ä½ â€œæ‹›å¼â€ï¼Œä¹±å†™åªä¼šè¶Šå†™è¶Šä¹±</p><p><strong>è§£æ³•äºŒ</strong></p><p>è¿™ç§è§£æ³•ä¼¼ä¹æ›´åŠ å®¹æ˜“ç†è§£ï¼ï¼ï¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">postorderTraversals</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    stack.push(root);</span><br><span class="line">    TreeNode lastNode=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">        TreeNode cur=stack.peek();</span><br><span class="line">        <span class="keyword">if</span> ((cur.left==<span class="keyword">null</span> && cur.right ==<span class="keyword">null</span>) || (lastNode!=<span class="keyword">null</span> &&( cur.left==lastNode || cur.right==lastNode))) {</span><br><span class="line">            stack.pop();</span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            lastNode=cur;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">if</span> (cur.right!=<span class="keyword">null</span>) {</span><br><span class="line">                stack.push(cur.right);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (cur.left!=<span class="keyword">null</span>) {</span><br><span class="line">                stack.push(cur.left);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="590-Nå‰æ ‘çš„ååºéå†"><a href="#590-Nå‰æ ‘çš„ååºéå†" class="headerlink" title="590. Nå‰æ ‘çš„ååºéå†"></a><a href="https://leetcode-cn.com/problems/n-ary-tree-postorder-traversal/" target="_blank" rel="noopener">590. Nå‰æ ‘çš„ååºéå†</a></h2><p>ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„<em>ååºéå†</em>ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª <code>3å‰æ ‘</code> :</p><p><img alt="NTree" data-src="https://i.loli.net/2019/12/01/KAQP9UNfV5bau7J.png" src="/img/loading.gif" class="lazyload"></p><p>è¿”å›å…¶ååºéå†: <code>[5,6,3,2,4,1]</code>.</p><p><strong>è¯´æ˜:</strong> é€’å½’æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿­ä»£æ³•å®Œæˆæ­¤é¢˜å—?</p><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’çš„è§£æ³•ï¼Œæ²¡å•¥å¥½è¯´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List<integer> res=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">postorder</span><span class="params">(Node root)</span> </integer></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    dfs(root);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(Node root)</span> </span>{</span><br><span class="line">    List<node> children=root.children;</node></span><br><span class="line">    <span class="keyword">for</span> (Node node:children) {</span><br><span class="line">        dfs(node);</span><br><span class="line">    }</span><br><span class="line">    res.add(root.val);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>é”äº†ï¼è¿™æ‰æ˜¯æ ‘éå†çš„æ¿å­</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">postorder</span><span class="params">(Node root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    Stack<node> stack=<span class="keyword">new</span> Stack<>();</node></span><br><span class="line">    stack.push(root);</span><br><span class="line">    Node lastNode=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">        Node node=stack.peek();</span><br><span class="line">        List<node> children=node.children;</node></span><br><span class="line">        <span class="keyword">if</span> (children.isEmpty() || (lastNode!=<span class="keyword">null</span> && lastNode == children.get(children.size()-<span class="number">1</span>))) {</span><br><span class="line">            res.add(node.val);</span><br><span class="line">            stack.pop();</span><br><span class="line">            lastNode=node;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=children.size()-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">                stack.push(children.get(i));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜å¼€å§‹å› ä¸ºä¸€ä¸ªç©ºçš„caseæŠŠæˆ‘ææ™•äº†ï¼Œæäº†åŠå¤©æ‰å‘ç°</p><h2 id="102-äºŒå‰æ ‘çš„å±‚æ¬¡éå†"><a href="#102-äºŒå‰æ ‘çš„å±‚æ¬¡éå†" class="headerlink" title="102. äºŒå‰æ ‘çš„å±‚æ¬¡éå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/" target="_blank" rel="noopener">102. äºŒå‰æ ‘çš„å±‚æ¬¡éå†</a></h2><p>Given a binary tree, return the <em>level order</em> traversal of its nodesâ€™ values. (ie, from left to right, level by level).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>return its level order traversal as:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [<span class="number">3</span>],</span><br><span class="line">  [<span class="number">9</span>,<span class="number">20</span>],</span><br><span class="line">  [<span class="number">15</span>,<span class="number">7</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>BFSï¼Œåˆ©ç”¨é˜Ÿåˆ—</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> levelOrder(TreeNode root) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>)<span class="keyword">return</span> res;</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="comment">//countä»£è¡¨çš„å…¶å®å°±æ˜¯æ¯ä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        List<integer> list=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            <span class="comment">//å–å‡ºå½“å‰èŠ‚ç‚¹,å¹¶å°†å…¶å·¦å³å­èŠ‚ç‚¹å…¥é˜Ÿåˆ—</span></span><br><span class="line">            TreeNode node=queue.poll();</span><br><span class="line">            list.add(node.val);</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">        res.add(list);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’DFSï¼Œè¿™ç§å…¶å®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¯ä»¥çœ‹ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> levelOrder(TreeNode root) {</list<integer></span><br><span class="line">    List<list<integer>> res = <span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    helper(res, root, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">helper</span><span class="params">(List<list<integer>> res, TreeNode root, <span class="keyword">int</span> depth)</list<integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//éœ€è¦å¢åŠ ä¸€å±‚</span></span><br><span class="line">    <span class="keyword">if</span> (res.size() == depth) res.add(<span class="keyword">new</span> LinkedList<>());</span><br><span class="line">    res.get(depth).add(root.val);</span><br><span class="line">    helper(res, root.left, depth + <span class="number">1</span>);</span><br><span class="line">    helper(res, root.right, depth + <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="429-Nå‰æ ‘çš„å±‚åºéå†"><a href="#429-Nå‰æ ‘çš„å±‚åºéå†" class="headerlink" title="429. Nå‰æ ‘çš„å±‚åºéå†"></a><a href="https://leetcode-cn.com/problems/n-ary-tree-level-order-traversal/" target="_blank" rel="noopener">429. Nå‰æ ‘çš„å±‚åºéå†</a></h2><p>ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„<em>å±‚åºéå†</em>ã€‚ (å³ä»å·¦åˆ°å³ï¼Œé€å±‚éå†)ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª <code>3å‰æ ‘</code> :</p><p><img alt="NTee" data-src="https://i.loli.net/2019/12/01/He8KVlms1jynbvr.png" src="/img/loading.gif" class="lazyload"></p><p>è¿”å›å…¶å±‚åºéå†:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">     [<span class="number">1</span>],</span><br><span class="line">     [<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>],</span><br><span class="line">     [<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ol><li>æ ‘çš„æ·±åº¦ä¸ä¼šè¶…è¿‡ <code>1000</code>ã€‚</li><li>æ ‘çš„èŠ‚ç‚¹æ€»æ•°ä¸ä¼šè¶…è¿‡ <code>5000</code>ã€‚</li></ol><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> levelOrder(Node root) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> LinkedList<>();</list<integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    Queue<node> queue=<span class="keyword">new</span> LinkedList<>();</node></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        List<integer> temp=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            Node node=queue.poll();</span><br><span class="line">            temp.add(node.val);</span><br><span class="line">            <span class="keyword">for</span> (Node child:node.children) {</span><br><span class="line">                queue.add(child);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!temp.isEmpty()) {</span><br><span class="line">            res.add(temp);   </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="107-äºŒå‰æ ‘çš„å±‚æ¬¡éå†-II"><a href="#107-äºŒå‰æ ‘çš„å±‚æ¬¡éå†-II" class="headerlink" title="107. äºŒå‰æ ‘çš„å±‚æ¬¡éå† II"></a><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal-ii/" target="_blank" rel="noopener">107. äºŒå‰æ ‘çš„å±‚æ¬¡éå† II</a></h2><p>Given a binary tree, return the <em>bottom-up level order</em> traversal of its nodesâ€™ values. (ie, from left to right, level by level from leaf to root).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>return its bottom-up level order traversal as:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [<span class="number">15</span>,<span class="number">7</span>],</span><br><span class="line">  [<span class="number">9</span>,<span class="number">20</span>],</span><br><span class="line">  [<span class="number">3</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> levelOrderBottom(TreeNode root) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    <span class="keyword">if</span>(root==<span class="keyword">null</span>)<span class="keyword">return</span> res;</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        List<integer> list=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            TreeNode top=queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (top.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(top.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (top.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(top.right);</span><br><span class="line">            }</span><br><span class="line">            list.add(top.val);</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ä»å¤´æ·»åŠ </span></span><br><span class="line">        res.add(<span class="number">0</span>,list);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸»è¦æ˜¯å¤ä¹ ä¸‹å±‚æ¬¡éå†ï¼Œç›¸æ¯”ä¸Šé¢å°±å¤šäº† <code>res.add(0,list)</code> ä»å¤´éƒ¨æ·»åŠ </p><h2 id="103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†"><a href="#103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†" class="headerlink" title="103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†"></a><a href="https://leetcode-cn.com/problems/binary-tree-zigzag-level-order-traversal/" target="_blank" rel="noopener">103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†</a></h2><p>Given a binary tree, return the <em>zigzag level order</em> traversal of its nodesâ€™ values. (ie, from left to right, then right to left for the next level and alternate between).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>return its zigzag level order traversal as:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [<span class="number">3</span>],</span><br><span class="line">  [<span class="number">20</span>,<span class="number">9</span>],</span><br><span class="line">  [<span class="number">15</span>,<span class="number">7</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> zigzagLevelOrder(TreeNode root) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    <span class="keyword">if</span>(root==<span class="keyword">null</span>)<span class="keyword">return</span> res;</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">boolean</span> reverse=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        LinkedList<integer> list=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            TreeNode node=queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (reverse) {</span><br><span class="line">                <span class="comment">//ä»å¤´æ·»åŠ ï¼Œç›¸å½“äºé€†åºäº†</span></span><br><span class="line">                list.addFirst(node.val);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                list.add(node.val);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">        reverse=!reverse;</span><br><span class="line">        res.add(list);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å’Œä¸Šé¢ä¸€é¢˜ä¸€æ ·ï¼Œè€æƒ³ç€æ€ä¹ˆå»æŒ‰ç…§é¢˜ç›®çš„è¦æ±‚å»éå†èŠ‚ç‚¹ï¼Œå“ï¼Œå¤ªè ¢äº†ï¼Œçµæ´»ä¸€ç‚¹å•Š</p><h2 id="199-äºŒå‰æ ‘çš„å³è§†å›¾"><a href="#199-äºŒå‰æ ‘çš„å³è§†å›¾" class="headerlink" title="199. äºŒå‰æ ‘çš„å³è§†å›¾"></a><a href="https://leetcode-cn.com/problems/binary-tree-right-side-view/" target="_blank" rel="noopener">199. äºŒå‰æ ‘çš„å³è§†å›¾</a></h2><p>ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="keyword">null</span>,<span class="number">5</span>,<span class="keyword">null</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">è§£é‡Š:</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>            <---</span><br><span class="line"> /   \</span><br><span class="line"><span class="number">2</span>     <span class="number">3</span>         <---</span><br><span class="line"> \     \</span><br><span class="line">  <span class="number">5</span>     <span class="number">4</span>       <---</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸€ä¸Šåˆåšäº†ä¸‰é“ä¸€æ ·çš„é¢˜ï¼Œè¿™é¢˜å¸å–äº†ä¸Šé¢çš„æ•™è®­æ²¡æœ‰å»æƒ³æ€ä¹ˆéå†äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">rightSideView</span><span class="params">(TreeNode root)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span>(root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    LinkedList<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            TreeNode node=queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//å–æ¯ä¸€å±‚æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (count==<span class="number">1</span>) {</span><br><span class="line">                res.add(node.val);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span>  res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åªè®°å½•æ¯ä¸€å±‚æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åå¾—åˆ°çš„å°±æ˜¯å³è§†å›¾</p><h2 id="104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a><a href="https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/" target="_blank" rel="noopener">104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚</p><p>äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚</p><p><strong>è¯´æ˜:</strong> å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br>ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’è§£æ³•ï¼Œå¾ˆç®€æ´</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//maxDepth(root)=1+max(maxDepth(root.left),maxDepth(root.right));</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> maxLeft=maxDepth(root.left);</span><br><span class="line">    <span class="keyword">int</span> maxRight=maxDepth(root.right);</span><br><span class="line">    <span class="keyword">return</span> (maxLeft>maxRight?maxLeft:maxRight)+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>BFSï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">0</span>;<span class="comment">//æ³¨æ„åˆå§‹å€¼</span></span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            TreeNode node=queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">        max++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="559-Nå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#559-Nå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="559. Nå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a><a href="https://leetcode-cn.com/problems/maximum-depth-of-n-ary-tree/" target="_blank" rel="noopener">559. Nå‰æ ‘çš„æœ€å¤§æ·±åº¦</a></h2><p>ç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œæ‰¾åˆ°å…¶æœ€å¤§æ·±åº¦ã€‚</p><p>æœ€å¤§æ·±åº¦æ˜¯æŒ‡ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ€»æ•°ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª <code>3å‰æ ‘</code> :</p><p><img alt="3å‰æ ‘" data-src="https://s2.ax1x.com/2019/11/20/MWwEt0.png" src="/img/loading.gif" class="lazyload"></p><p>æˆ‘ä»¬åº”è¿”å›å…¶æœ€å¤§æ·±åº¦ï¼Œ3ã€‚</p><p><strong>è¯´æ˜:</strong></p><ol><li>æ ‘çš„æ·±åº¦ä¸ä¼šè¶…è¿‡ <code>1000</code>ã€‚</li><li>æ ‘çš„èŠ‚ç‚¹æ€»ä¸ä¼šè¶…è¿‡ <code>5000</code>ã€‚</li></ol><p><strong>è§£æ³•ä¸€</strong></p><p>æ²¡å•¥å¥½è¯´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(Node root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">0</span>;</span><br><span class="line">    List<node> children=root.children;</node></span><br><span class="line">    <span class="keyword">for</span> (Node node:children) {</span><br><span class="line">        max=Math.max(max,maxDepth(node));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"><a href="#111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦" class="headerlink" title="111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"></a><a href="https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/" target="_blank" rel="noopener">111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å°æ·±åº¦ã€‚</p><p>æœ€å°æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚</p><p><strong>è¯´æ˜:</strong> å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p>ç»™å®šäºŒå‰æ ‘ <code>[3,9,20,null,null,15,7]</code>   </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å›å®ƒçš„æœ€å°æ·±åº¦  2.</p><p><strong>è§£æ³•ä¸€</strong></p><p>æœ€å¤§éƒ½æ±‚äº†ï¼Œæœ€å°ä¹Ÿæ¥ä¸€å‘ï¼Œç»å…¸BFSåšæ³•ï¼Œæ±‚æœ€çŸ­è·¯å¾„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDepth</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">int</span> min=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        min++;</span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            TreeNode node=queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (node.left==<span class="keyword">null</span> && node.right==<span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> min;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDepth</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (root.left==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> minDepth(root.right)+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (root.right==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> minDepth(root.left)+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.min(minDepth(root.left),minDepth(root.right))+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¾ˆä¸Šé¢æœ€å¤§çš„ç›¸åï¼Œä½†æ˜¯æœ‰ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ªæ ¹èŠ‚ç‚¹å·¦å³å­æ ‘ï¼Œ<strong>æœ‰ä¸€é¢—ä¸ºç©º</strong>ï¼Œå¦‚æœä¸å¤„ç†ï¼ŒæŒ‰ç…§ä¹‹å‰çš„é€»è¾‘ï¼Œè¿™é¢—ç©ºå­æ ‘ä¸‹ä¸€æ¬¡å°±ä¼šè¿”å›0ï¼Œè‚¯å®šä¼šæ¯”å¦ä¸€é¢—å°æœ€åè¿”å›çš„å°±æ˜¯åˆ°è¿™é¢—å­æ ‘çš„è·¯å¾„ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³è¿™æ ·æ˜¯æ­£ç¡®çš„ä¹ˆï¼Ÿæ˜æ˜¾ä¸æ˜¯ï¼Œæœ€çŸ­è·¯å¾„çš„å°½å¤´ä¸€å®šæ˜¯å¶å­èŠ‚ç‚¹ä¹Ÿå°±æ˜¯å·¦å³å­æ ‘éƒ½ä¸ºç©ºçš„æ—¶å€™ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„</p><h2 id="226-ç¿»è½¬äºŒå‰æ ‘"><a href="#226-ç¿»è½¬äºŒå‰æ ‘" class="headerlink" title="226. ç¿»è½¬äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/invert-binary-tree/" target="_blank" rel="noopener">226. ç¿»è½¬äºŒå‰æ ‘</a></h2><p>ç¿»è½¬ä¸€æ£µäºŒå‰æ ‘ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><p>è¾“å…¥ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">     <span class="number">4</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">2</span>     <span class="number">7</span></span><br><span class="line"> / \   / \</span><br><span class="line"><span class="number">1</span>   <span class="number">3</span> <span class="number">6</span>   <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¾“å‡ºï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">     <span class="number">4</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">7</span>     <span class="number">2</span></span><br><span class="line"> / \   / \</span><br><span class="line"><span class="number">9</span>   <span class="number">6</span> <span class="number">3</span>   <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>å¤‡æ³¨:</strong><br>è¿™ä¸ªé—®é¢˜æ˜¯å—åˆ° Max Howell çš„ åŸé—®é¢˜ å¯å‘çš„ ï¼š</p><blockquote><p>è°·æ­Œï¼šæˆ‘ä»¬90ï¼…çš„å·¥ç¨‹å¸ˆä½¿ç”¨æ‚¨ç¼–å†™çš„è½¯ä»¶(Homebrew)ï¼Œä½†æ˜¯æ‚¨å´æ— æ³•åœ¨é¢è¯•æ—¶åœ¨ç™½æ¿ä¸Šå†™å‡ºç¿»è½¬äºŒå‰æ ‘è¿™é“é¢˜ï¼Œè¿™å¤ªç³Ÿç³•äº†ã€‚</p></blockquote><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">invertTree</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    invertTree(root.left);</span><br><span class="line">    invertTree(root.right);</span><br><span class="line">    <span class="comment">//äº¤æ¢å·¦å³èŠ‚ç‚¹</span></span><br><span class="line">    TreeNode temp=root.left;</span><br><span class="line">    root.left=root.right;</span><br><span class="line">    root.right=temp;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ³¨æ„é€’å½’è°ƒç”¨å’Œäº¤æ¢èŠ‚ç‚¹çš„é¡ºåºï¼Œä¸èƒ½æåäº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">invertTree</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    TreeNode right=root.right;</span><br><span class="line">    root.right=invertTree(root.left);</span><br><span class="line">    root.left=invertTree(right);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ¯”è¾ƒç®€æ´ä¹Ÿæ¯”è¾ƒç¬¦åˆé€’å½’çš„åšæ³•</p><h2 id="100-ç›¸åŒçš„æ ‘"><a href="#100-ç›¸åŒçš„æ ‘" class="headerlink" title="100. ç›¸åŒçš„æ ‘"></a><a href="https://leetcode-cn.com/problems/same-tree/" target="_blank" rel="noopener">100. ç›¸åŒçš„æ ‘</a></h2><p>ç»™å®šä¸¤ä¸ªäºŒå‰æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ£€éªŒå®ƒä»¬æ˜¯å¦ç›¸åŒã€‚</p><p>å¦‚æœä¸¤ä¸ªæ ‘åœ¨ç»“æ„ä¸Šç›¸åŒï¼Œå¹¶ä¸”èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„å€¼ï¼Œåˆ™è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:       <span class="number">1</span>         <span class="number">1</span></span><br><span class="line">          / \       / \</span><br><span class="line">         <span class="number">2</span>   <span class="number">3</span>     <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],   [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:      <span class="number">1</span>          <span class="number">1</span></span><br><span class="line">          /           \</span><br><span class="line">         <span class="number">2</span>             <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">        [<span class="number">1</span>,<span class="number">2</span>],     [<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:       <span class="number">1</span>         <span class="number">1</span></span><br><span class="line">          / \       / \</span><br><span class="line">         <span class="number">2</span>   <span class="number">1</span>     <span class="number">1</span>   <span class="number">2</span></span><br><span class="line">        </span><br><span class="line">        [<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>],   [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSameTree</span><span class="params">(TreeNode p, TreeNode q)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (p==<span class="keyword">null</span> && q==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (p!=<span class="keyword">null</span> && q!=<span class="keyword">null</span> && p.val==q.val) {</span><br><span class="line">        <span class="keyword">return</span> isSameTree(p.right,q.right)&&isSameTree(p.left,q.left);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="222-å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°"><a href="#222-å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°" class="headerlink" title="222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°"></a><a href="https://leetcode-cn.com/problems/count-complete-tree-nodes/" target="_blank" rel="noopener">222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°</a></h2><p>ç»™å‡ºä¸€ä¸ª<strong>å®Œå…¨äºŒå‰æ ‘</strong>ï¼Œæ±‚å‡ºè¯¥æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><p>å®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å¦‚ä¸‹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2h ä¸ªèŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">    <span class="number">1</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"> / \  /</span><br><span class="line"><span class="number">4</span>  <span class="number">5</span> <span class="number">6</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>BFSï¼Œæƒå½“å¤ä¹ äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//BFS</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> nextLevel=queue.size();</span><br><span class="line">        <span class="keyword">while</span>(nextLevel><span class="number">0</span>){</span><br><span class="line">            TreeNode node=queue.poll(); </span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            nextLevel--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’è§£æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æš´åŠ›</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> countNodes(root.left)+countNodes(root.right)+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ›´åŠ ç²¾ç®€ç‚¹å¯ä»¥ç¼©å‡æˆä¸€è¡Œ</p><p><strong>è§£æ³•ä¸‰</strong></p><p>è¿™é¢˜æ˜¯midéš¾åº¦ï¼Œè€Œä¸”é¢˜ç›®ç»™çš„æ¡ä»¶è¿˜æ²¡ç”¨ä¸Šï¼š<strong>è¿™æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒçš„æ€§è´¨æ¥åšï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œ<strong>æ»¡äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°</strong>å¯ä»¥ç›´æ¥æ ¹æ®å…¬å¼ <code>2^H-1</code> è®¡ç®—å¾—æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åˆ¤æ–­å½“å‰çš„å®Œå…¨äºŒå‰æ ‘æ˜¯ä¸æ˜¯<strong>æ»¡äºŒå‰æ ‘</strong>ï¼Œå¦‚æœæ˜¯ç›´æ¥ç®—å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥çœå»ä¸­é—´å¾ˆå¤šèŠ‚ç‚¹çš„éå†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    TreeNode left=root.left;</span><br><span class="line">    TreeNode right=root.right;</span><br><span class="line">    <span class="keyword">int</span> hight=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(left!=<span class="keyword">null</span> && right!=<span class="keyword">null</span>){</span><br><span class="line">        left=left.left;</span><br><span class="line">        right=right.right;</span><br><span class="line">        hight++;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//åŒæ—¶å‘å·¦å‘å³èµ°ï¼Œèµ°åˆ°æœ€åleft==nullå°±è¯´æ˜è¿™é¢—æ ‘æ˜¯æ»¡äºŒå‰æ ‘ï¼Œå¯ä»¥åˆ©ç”¨å…¬å¼ç›´æ¥æ±‚å‡ºèŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">    <span class="comment">//å¦åˆ™å°±å¯¹å…¶å·¦å³å­æ ‘é€’å½’æ±‚è§£</span></span><br><span class="line">    <span class="keyword">return</span> left==<span class="keyword">null</span>?(<span class="number">1</span><<hight)-<span class="number">1</hight)-<span></span>:countNodes(root.left)+countNodes(root.right)+<span class="number">1</span>;<br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸å¾—ä¸è¯´è¿™æ ·çš„æ–¹å¼è¿˜æ˜¯æŒºå·§å¦™çš„ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯<code>O(2logN)</code>? </p><h2 id="110-å¹³è¡¡äºŒå‰æ ‘"><a href="#110-å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="110. å¹³è¡¡äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/balanced-binary-tree/" target="_blank" rel="noopener">110. å¹³è¡¡äºŒå‰æ ‘</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚</p><p>æœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼š</p><blockquote><p> ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1</p></blockquote><p><strong>ç¤ºä¾‹ 1:</strong></p><p>ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å› true ã€‚</p><p><strong>ç¤ºä¾‹ 2:</strong></p><p>ç»™å®šäºŒå‰æ ‘ [1,2,2,3,3,null,null,4,4]</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">      <span class="number">1</span></span><br><span class="line">     / \</span><br><span class="line">    <span class="number">2</span>   <span class="number">2</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">3</span>   <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">4</span>   <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å› false ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>æš´åŠ›æ³•ï¼Œç»“åˆä¸Šé¢çš„[äºŒå‰æ ‘æœ€å¤§æ·±åº¦](#104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦)ï¼Œ<strong>è‡ªé¡¶å‘ä¸‹</strong>ï¼Œæ±‚å·¦å³å­æ ‘çš„é«˜åº¦å·®</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//top 2 bottom</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (Math.abs(hight(root.left)-hight(root.right))><span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> isBalanced(root.left) && isBalanced(root.right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hight</span><span class="params">(TreeNode root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.max(hight(root.right),hight(root.left))+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è‡ªé¡¶å‘ä¸‹ï¼Œå…ˆåˆ¤æ–­æ ¹èŠ‚ç‚¹ï¼Œç„¶ååˆ¤æ–­å·¦å³å­æ ‘ï¼Œå¾ˆæ˜æ˜¾ã€‚åœ¨åˆ¤æ–­å·¦å³å­æ ‘çš„æ—¶å€™ï¼Œä¼šé‡å¤çš„éå†åˆ¤æ–­æ ¹èŠ‚ç‚¹çš„æ—¶å€™å·²ç»éå†è¿‡çš„èŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯<code>O(N^2)</code></p><p><strong>è§£æ³•äºŒ</strong></p><p>è‡ªåº•å‘ä¸Šï¼Œåˆ©ç”¨ä¸€ä¸ªå®ä¾‹å˜é‡ä¿å­˜ç»“æœï¼Œå…¶å®å°±æ˜¯åœ¨ä¸Šé¢çš„æ±‚heighè¿‡ç¨‹ä¸­å°†å·¦å³å­æ ‘çš„é«˜åº¦å…ˆå–å‡ºæ¥ç›´æ¥æ¯”è¾ƒï¼Œå¦‚æœå·®è·å¤§äº1å°±ç›´æ¥è®°å½•ä¸‹ç»“æœfalseï¼Œä½†æ˜¯å…¶å®è¿™é‡Œè¿˜æ˜¯å¯ä»¥ä¼˜åŒ–ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> ans=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//buttom 2 top</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    hight(root);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hight</span><span class="params">(TreeNode root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//é€’å½’åˆ†æ²»ï¼Œè‡ªåº•å‘ä¸Šï¼Œåœ¨æ±‚é«˜åº¦çš„è¿‡ç¨‹ä¸­è®¡ç®—å·¦å³é«˜åº¦å·®</span></span><br><span class="line">    <span class="keyword">int</span> left=hight(root.left);</span><br><span class="line">    <span class="keyword">int</span> right=hight(root.right);</span><br><span class="line">    <span class="keyword">if</span> (Math.abs(left-right)><span class="number">1</span>) {</span><br><span class="line">        ans=<span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.max(left,right)+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è‡ªåº•å‘ä¸Šï¼Œåªéœ€è¦éå†ä¸€éäºŒå‰æ ‘å°±å¯ä»¥å¾—åˆ°ç»“æœï¼Œæ—¶é—´å¤æ‚åº¦<code>O(N)</code> </p><p><strong>è§£æ³•ä¸‰</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> hight(root)!=-<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hight</span><span class="params">(TreeNode root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left=hight(root.left);</span><br><span class="line">    <span class="keyword">if</span> (left==-<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> right=hight(root.right);</span><br><span class="line">    <span class="keyword">if</span> (right==-<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.abs(left-right)><span class="number">1</span>?-<span class="number">1</span>:Math.max(left,right)+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åœ¨ä¸ç¬¦åˆçš„æ—¶å€™ä¸€è·¯<code>return -1</code> èŠ‚çœåé¢çš„è®¡ç®—</p><h2 id="563-äºŒå‰æ ‘çš„å¡åº¦"><a href="#563-äºŒå‰æ ‘çš„å¡åº¦" class="headerlink" title="563. äºŒå‰æ ‘çš„å¡åº¦"></a><a href="https://leetcode-cn.com/problems/binary-tree-tilt/" target="_blank" rel="noopener">563. äºŒå‰æ ‘çš„å¡åº¦</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè®¡ç®—æ•´ä¸ªæ ‘çš„å¡åº¦ã€‚</p><p>ä¸€ä¸ªæ ‘çš„èŠ‚ç‚¹çš„å¡åº¦å®šä¹‰å³ä¸ºï¼Œè¯¥èŠ‚ç‚¹å·¦å­æ ‘çš„ç»“ç‚¹ä¹‹å’Œå’Œå³å­æ ‘ç»“ç‚¹ä¹‹å’Œçš„å·®çš„ç»å¯¹å€¼ã€‚ç©ºç»“ç‚¹çš„çš„å¡åº¦æ˜¯0ã€‚</p><p>æ•´ä¸ªæ ‘çš„å¡åº¦å°±æ˜¯å…¶æ‰€æœ‰èŠ‚ç‚¹çš„å¡åº¦ä¹‹å’Œã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">         <span class="number">1</span></span><br><span class="line">       /   \</span><br><span class="line">      <span class="number">2</span>     <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br><span class="line">è§£é‡Š: </span><br><span class="line">ç»“ç‚¹çš„å¡åº¦ <span class="number">2</span> : <span class="number">0</span></span><br><span class="line">ç»“ç‚¹çš„å¡åº¦ <span class="number">3</span> : <span class="number">0</span></span><br><span class="line">ç»“ç‚¹çš„å¡åº¦ <span class="number">1</span> : |<span class="number">2</span>-<span class="number">3</span>| = <span class="number">1</span></span><br><span class="line">æ ‘çš„å¡åº¦ : <span class="number">0</span> + <span class="number">0</span> + <span class="number">1</span> = <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong></p><ol><li>ä»»ä½•å­æ ‘çš„ç»“ç‚¹çš„å’Œä¸ä¼šè¶…è¿‡32ä½æ•´æ•°çš„èŒƒå›´ã€‚</li><li>å¡åº¦çš„å€¼ä¸ä¼šè¶…è¿‡32ä½æ•´æ•°çš„èŒƒå›´ã€‚. </li></ol><p><strong>è§£æ³•ä¸€</strong></p><p>å¾ˆå¿«å†™å‡ºæ¥çš„è§£æ³•ï¼Œå‘ç°è¿™é¢˜å’Œä¸Šé¢çš„ <strong>å¹³è¡¡äºŒå‰æ ‘</strong> æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//é¦–å…ˆæƒ³åˆ°çš„è§£æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findTilt</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> findTilt(root.left)+findTilt(root.right)+Math.abs(childSum(root.left)-childSum(root.right));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">childSum</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> childSum(root.left)+childSum(root.right)+root.val;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åµŒå¥—é€’å½’ï¼Œç›¸å½“æš´åŠ›</p><p><strong>è§£æ³•äºŒ</strong></p><p>ä¸Šé¢çš„åšæ³•ç¡®å®æœ‰ç‚¹å¯æƒœï¼Œå…¶å®åœ¨è®¡ç®—childSumçš„æ—¶å€™å°±å¯ä»¥å­—èŠ‚æŠŠå¡åº¦ç®—å‡ºæ¥ç„¶åç´¯åŠ å°±æ˜¯æ•´ä½“çš„å¡åº¦</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> tilt=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœå‘ç°ä¸Šé¢çš„åšæ³•å‚»é€¼äº†ã€‚ã€‚ã€‚å…¶å®æˆ‘çŸ¥é“æ˜¯ä¸å¯¹çš„,ä½†æ˜¯ä¸çŸ¥é“å’‹æ”¹,ä¸è¿‡å†™äº†ä¸ªåµŒå¥—é€’å½’ä¹Ÿè¿˜è¡Œhahaha</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findTilt</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    childSum(root);</span><br><span class="line">    <span class="keyword">return</span> tilt;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">childSum</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left=childSum(root.left);</span><br><span class="line">    <span class="keyword">int</span> right=childSum(root.right);</span><br><span class="line">    tilt+=Math.abs(left-right);</span><br><span class="line">    <span class="keyword">return</span> left+right+root.val;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="112-è·¯å¾„æ€»å’Œ"><a href="#112-è·¯å¾„æ€»å’Œ" class="headerlink" title="112. è·¯å¾„æ€»å’Œ"></a><a href="https://leetcode-cn.com/problems/path-sum/" target="_blank" rel="noopener">112. è·¯å¾„æ€»å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œä¸€ä¸ªç›®æ ‡å’Œï¼Œåˆ¤æ–­è¯¥æ ‘ä¸­æ˜¯å¦å­˜åœ¨<strong>æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹</strong>çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å€¼ç›¸åŠ ç­‰äºç›®æ ‡å’Œã€‚</p><p><strong>è¯´æ˜:</strong> å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹:</strong><br>ç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ <code>sum = 22</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">      <span class="number">5</span></span><br><span class="line">     / \</span><br><span class="line">    <span class="number">4</span>   <span class="number">8</span></span><br><span class="line">   /   / \</span><br><span class="line">  <span class="number">11</span>  <span class="number">13</span>  <span class="number">4</span></span><br><span class="line"> /  \      \</span><br><span class="line"><span class="number">7</span>    <span class="number">2</span>      <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å› true, å› ä¸ºå­˜åœ¨ç›®æ ‡å’Œä¸º 22 çš„æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ <code>5->4->11->2</code></p><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’è§£æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPathSum</span><span class="params">(TreeNode root, <span class="keyword">int</span> sum)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//éœ€è¦æ³¨æ„è¿™é‡Œçš„å¶èŠ‚ç‚¹åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (root.left==<span class="keyword">null</span> && root.right==<span class="keyword">null</span>&&root.val==sum) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> hasPathSum(root.left,sum-root.val) || hasPathSum(root.right,sum-root.val);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯è¿™ä¸ªå¶å­èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œä¸€å¼€å§‹æ²¡æ³¨æ„åˆ°ï¼Œç›´æ¥å†™çš„ <code>root.val==sum</code> ï¼Œå…¶å®å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹çš„è¯ï¼Œå…¶å®æ˜¯ä¸æˆç«‹çš„ï¼Œæ¯”å¦‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">1</span></span><br><span class="line"> /</span><br><span class="line"><span class="number">2</span>       sum=<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®è¿™å°±æ˜¯<code>false</code> ï¼Œå› ä¸ºä»–æ²¡æœ‰å³å­æ ‘ï¼Œè€Œé¢˜ç›®è¦æ±‚çš„æ˜¯ä»<strong>æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹</strong></p><h2 id="404-å·¦å¶å­ä¹‹å’Œ"><a href="#404-å·¦å¶å­ä¹‹å’Œ" class="headerlink" title="404. å·¦å¶å­ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/sum-of-left-leaves/" target="_blank" rel="noopener">404. å·¦å¶å­ä¹‹å’Œ</a></h2><p>è®¡ç®—ç»™å®šäºŒå‰æ ‘çš„æ‰€æœ‰å·¦å¶å­ä¹‹å’Œã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>åœ¨è¿™ä¸ªäºŒå‰æ ‘ä¸­ï¼Œæœ‰ä¸¤ä¸ªå·¦å¶å­ï¼Œåˆ†åˆ«æ˜¯ 9 å’Œ 15ï¼Œæ‰€ä»¥è¿”å› 24</p><p><strong>è§£æ³•ä¸€</strong></p><p>è¯´å®è¯ï¼Œè¿™äº›é¢˜ç»™çš„ä¾‹å­éƒ½æŒºè¯¯å¯¼äººçš„ï¼Œä¼šè®©äººä¸è‡ªè§‰åœ°å¿½ç•¥<strong>å¶å­èŠ‚ç‚¹</strong>è¿™ä¸ªæ¡ä»¶ğŸ˜‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span></span>{</span><br><span class="line">    sumOfLeft(root);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sumOfLeft</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æ³¨æ„è¿™é‡Œçš„æ¡ä»¶ï¼ï¼ï¼ï¼</span></span><br><span class="line">    <span class="keyword">if</span> (root.left!=<span class="keyword">null</span> && root.left.left==<span class="keyword">null</span> &&root.left.right==<span class="keyword">null</span>) {</span><br><span class="line">        sum+=root.left.val;</span><br><span class="line">    }</span><br><span class="line">    sumOfLeft(root.left);</span><br><span class="line">    sumOfLeft(root.right);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="257-äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„"><a href="#257-äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„" class="headerlink" title="257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„"></a><a href="https://leetcode-cn.com/problems/binary-tree-paths/" target="_blank" rel="noopener">257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚</p><p><strong>è¯´æ˜:</strong> å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> è¾“å…¥:</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span></span><br><span class="line"> /   \</span><br><span class="line"><span class="number">2</span>     <span class="number">3</span></span><br><span class="line"> \</span><br><span class="line">  <span class="number">5</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: [<span class="string">"1->2->5"</span>, <span class="string">"1->3"</span>]</span><br><span class="line"></span><br><span class="line">è§£é‡Š: æ‰€æœ‰æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸º: <span class="number">1</span>-><span class="number">2</span>-><span class="number">5</span>, <span class="number">1</span>-><span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’DFSçš„è§£æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//DFS</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">binaryTreePaths</span><span class="params">(TreeNode root)</span> </string></span>{</span><br><span class="line">    List<string> res=<span class="keyword">new</span> ArrayList<>();</string></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (root!=<span class="keyword">null</span>&&root.left==<span class="keyword">null</span>&&root.right==<span class="keyword">null</span>) {</span><br><span class="line">        res.add(String.valueOf(root.val));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å·¦å­æ ‘çš„æ‰€æœ‰è·¯å¾„</span></span><br><span class="line">    List<string> lefts=binaryTreePaths(root.left);</string></span><br><span class="line">    <span class="comment">//å³å­æ ‘çš„æ‰€æœ‰è·¯å¾„</span></span><br><span class="line">    List<string> rights=binaryTreePaths(root.right);</string></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åœ¨æ¯æ¡è·¯å¾„å‰é¢åŠ ä¸Šå½“å‰æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<lefts.size();i++) {< span><br><span class="line">        res.add(root.val+<span class="string">"->"</span>+lefts.get(i));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<rights.size();i++) {< span><br><span class="line">        res.add(root.val+<span class="string">"->"</span>+rights.get(i));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></rights.size();i++)></span></lefts.size();i++)></span></pre></td></tr></tbody></table></figure></div><p>æ¯”ä¸Šé¢çš„é€’å½’ç¨å¾®å¤æ‚ç‚¹ï¼Œæ ¸å¿ƒæ€æƒ³è¿˜æ˜¯è¦æŠ“ä½é€’å½’çš„æœ¬è´¨ï¼Œä¸è¦å»çº ç»“é€’å½’æ¯ä¸€æ­¥éƒ½æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Œä»å®è§‚ä¸Šå»å†™ä»£ç ï¼Œè¿˜æ˜¯è¦å¤šç»ƒå•Š</p><p><strong>è§£æ³•äºŒ</strong></p><p>BFSå¹¿æœ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">binaryTreePaths</span><span class="params">(TreeNode root)</span> </string></span>{</span><br><span class="line">    List<string> res=<span class="keyword">new</span> ArrayList<>();</string></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<treenode> node_stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    Stack<string> path_stack=<span class="keyword">new</span> Stack<>();</string></span><br><span class="line">    node_stack.add(root);</span><br><span class="line">    path_stack.add(String.valueOf(root.val));</span><br><span class="line">    String path=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">while</span>(!node_stack.isEmpty()){</span><br><span class="line">        TreeNode node=node_stack.pop();</span><br><span class="line">        path=path_stack.pop();</span><br><span class="line">        <span class="comment">//å¶å­èŠ‚ç‚¹ï¼Œè¿™æ¡è·¯å¾„æœç´¢ç»“æŸï¼Œæ·»åŠ åˆ°resä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (node.left==<span class="keyword">null</span>&&node.right==<span class="keyword">null</span>) {</span><br><span class="line">            res.add(path);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">            node_stack.add(node.left);</span><br><span class="line">            path_stack.add(path+<span class="string">"->"</span>+node.left.val);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">            node_stack.add(node.right);</span><br><span class="line">            path_stack.add(path+<span class="string">"->"</span>+node.right.val);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œå’Œä¼ ç»Ÿçš„BFSä¸å¤ªä¸€æ ·ï¼Œæ˜¯ç”¨çš„æ ˆæ¥éå†çš„</p><h2 id="113-è·¯å¾„æ€»å’Œ-II"><a href="#113-è·¯å¾„æ€»å’Œ-II" class="headerlink" title="113. è·¯å¾„æ€»å’Œ II"></a><a href="https://leetcode-cn.com/problems/path-sum-ii/" target="_blank" rel="noopener">113. è·¯å¾„æ€»å’Œ II</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œä¸€ä¸ªç›®æ ‡å’Œï¼Œæ‰¾åˆ°æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„æ€»å’Œç­‰äºç»™å®šç›®æ ‡å’Œçš„è·¯å¾„ã€‚</p><p><strong>è¯´æ˜:</strong> å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</p><p><strong>ç¤ºä¾‹:</strong><br>ç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ <code>sum = 22</code>ï¼Œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">      <span class="number">5</span></span><br><span class="line">     / \</span><br><span class="line">    <span class="number">4</span>   <span class="number">8</span></span><br><span class="line">   /   / \</span><br><span class="line">  <span class="number">11</span>  <span class="number">13</span>  <span class="number">4</span></span><br><span class="line"> /  \    / \</span><br><span class="line"><span class="number">7</span>    <span class="number">2</span>  <span class="number">5</span>   <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å›:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">   [<span class="number">5</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">2</span>],</span><br><span class="line">   [<span class="number">5</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸Šä¸€é¢˜çš„åšæ³•åŸºæœ¬ä¸€è‡´ï¼Œæœ¬æ¥åº”è¯¥æ˜¯ä¸€ébugfreeçš„ï¼Œç¼–è¯‘é”™è¯¯æ•´äº†åŠå¤©</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> pathSum(TreeNode root, <span class="keyword">int</span> sum) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> LinkedList<>();</list<integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (root!=<span class="keyword">null</span> && root.left==<span class="keyword">null</span> && root.right==<span class="keyword">null</span> && root.val==sum) {</span><br><span class="line">        LinkedList<integer>  lis= <span class="keyword">new</span> LinkedList<>(); </integer></span><br><span class="line">        lis.add(root.val);</span><br><span class="line">        res.add(lis);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å·¦å³å­æ ‘ç¬¦åˆæ¡ä»¶çš„è·¯å¾„</span></span><br><span class="line">    List<list<integer>> lefts=pathSum(root.left,sum-root.val);</list<integer></span><br><span class="line">    List<list<integer>> rights=pathSum(root.right,sum-root.val);</list<integer></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<lefts.size();i++) {< span><br><span class="line">        ((LinkedList<integer>)lefts.get(i)).addFirst(root.val);</integer></span><br><span class="line">        res.add(lefts.get(i));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<rights.size();i++) {< span><br><span class="line">        ((LinkedList<integer>)rights.get(i)).addFirst(root.val);</integer></span><br><span class="line">        res.add(rights.get(i));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></rights.size();i++)></span></lefts.size();i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>åºŸäº†è€å¤§åŠ²ç»ˆäºæŠŠBFSå†™å‡ºæ¥äº†ã€‚ã€‚ã€‚å¯ä»¥çœ‹å‡ºè¿˜æ˜¯å€Ÿé‰´çš„ä¸Šé¢çš„æ€è·¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> pathSum2(TreeNode root,<span class="keyword">int</span> sum) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> LinkedList<>();</list<integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹æ ˆ</span></span><br><span class="line">    Stack<treenode> node_stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    <span class="comment">//è·¯å¾„æ ˆ</span></span><br><span class="line">    Stack<list<integer>> path_stack=<span class="keyword">new</span> Stack<>();</list<integer></span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹sumæ ˆ</span></span><br><span class="line">    Stack<integer> sum_stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    <span class="comment">//ç»™æ¯ä¸ªæ ˆå­˜å…¥åˆå§‹å€¼</span></span><br><span class="line">    node_stack.add(root);</span><br><span class="line">    path_stack.add(<span class="keyword">new</span> LinkedList(){{</span><br><span class="line">        add(root.val);</span><br><span class="line">    }});</span><br><span class="line">    sum_stack.add(root.val);</span><br><span class="line">    <span class="comment">//BFS</span></span><br><span class="line">    <span class="keyword">while</span>(!node_stack.isEmpty()){</span><br><span class="line">        TreeNode node=node_stack.pop();</span><br><span class="line">        List<integer> pathList=path_stack.pop();</integer></span><br><span class="line">        <span class="keyword">int</span> tempS=sum_stack.pop();</span><br><span class="line">        <span class="comment">//ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (node.left==<span class="keyword">null</span> && node.right==<span class="keyword">null</span>&&tempS==sum) {</span><br><span class="line">            res.add(pathList);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//è¿™ä¸‰ä¸ªæ ˆæ˜¯åŒæ­¥çš„,nodeæ ˆå­˜æ”¾å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">//pathæ ˆå­˜æ”¾æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„</span></span><br><span class="line">            <span class="comment">//sumæ ˆå­˜æ”¾çš„æ˜¯pathæ ˆä¸­æ‰€æœ‰èŠ‚ç‚¹çš„valå’Œ</span></span><br><span class="line">            node_stack.add(node.left);</span><br><span class="line">            <span class="comment">//è¿™é‡Œä¸è¦ç›´æ¥æ“ä½œpathList,å¦åˆ™å·¦å³çš„è·¯å¾„ä¼šæ··åœ¨ä¸€èµ·</span></span><br><span class="line">            LinkedList<integer> tlis= <span class="keyword">new</span> LinkedList(pathList);</integer></span><br><span class="line">            tlis.add(node.left.val);</span><br><span class="line">            path_stack.add(tlis);</span><br><span class="line">            <span class="comment">//ç´¯åŠ è·¯å¾„ä¸Šçš„èŠ‚ç‚¹å€¼</span></span><br><span class="line">            sum_stack.add(tempS+node.left.val);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">            node_stack.add(node.right);</span><br><span class="line">            <span class="comment">//åŒä¸Š</span></span><br><span class="line">            LinkedList<integer> tlis= <span class="keyword">new</span> LinkedList(pathList);</integer></span><br><span class="line">            tlis.add(node.right.val);</span><br><span class="line">            path_stack.add(tlis);</span><br><span class="line">            sum_stack.add(tempS+node.right.val);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç”¨åˆ°ä¸‰ä¸ªæ ˆï¼ŒåŒæ­¥ä¿å­˜èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿˜æ˜¯æŒºç®€å•çš„</p><h2 id="129-æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ"><a href="#129-æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ" class="headerlink" title="129. æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/sum-root-to-leaf-numbers/" target="_blank" rel="noopener">129. æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹éƒ½å­˜æ”¾ä¸€ä¸ª <code>0-9</code> çš„æ•°å­—ï¼Œæ¯æ¡ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„éƒ½ä»£è¡¨ä¸€ä¸ªæ•°å­—ã€‚</p><p>ä¾‹å¦‚ï¼Œä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ <code>1->2->3</code> ä»£è¡¨æ•°å­— <code>123</code></p><p>è®¡ç®—ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹ç”Ÿæˆçš„æ‰€æœ‰æ•°å­—ä¹‹å’Œã€‚</p><p><strong>è¯´æ˜:</strong> å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="number">25</span></span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ <span class="number">1</span>-><span class="number">2</span> ä»£è¡¨æ•°å­— <span class="number">12</span>.</span><br><span class="line">ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ <span class="number">1</span>-><span class="number">3</span> ä»£è¡¨æ•°å­— <span class="number">13</span>.</span><br><span class="line">å› æ­¤ï¼Œæ•°å­—æ€»å’Œ = <span class="number">12</span> + <span class="number">13</span> = <span class="number">25</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">4</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">1</span>]</span><br><span class="line">    <span class="number">4</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">9</span>   <span class="number">0</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">5</span>   <span class="number">1</span></span><br><span class="line">è¾“å‡º: <span class="number">1026</span></span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ <span class="number">4</span>-><span class="number">9</span>-><span class="number">5</span> ä»£è¡¨æ•°å­— <span class="number">495</span>.</span><br><span class="line">ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ <span class="number">4</span>-><span class="number">9</span>-><span class="number">1</span> ä»£è¡¨æ•°å­— <span class="number">491</span>.</span><br><span class="line">ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ <span class="number">4</span>-><span class="number">0</span> ä»£è¡¨æ•°å­— <span class="number">40</span>.</span><br><span class="line">å› æ­¤ï¼Œæ•°å­—æ€»å’Œ = <span class="number">495</span> + <span class="number">491</span> + <span class="number">40</span> = <span class="number">1026</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>BFSï¼Œå»¶ç»­ä¸Šé¢çš„åšæ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumNumbers</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span> ) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<treenode> node_stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    Stack<integer> sum_stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    node_stack.add(root);</span><br><span class="line">    sum_stack.add(root.val);</span><br><span class="line">    <span class="keyword">while</span>(!node_stack.isEmpty()){</span><br><span class="line">        TreeNode node=node_stack.pop();</span><br><span class="line">        <span class="keyword">int</span> tempS=sum_stack.pop();</span><br><span class="line">        <span class="keyword">if</span> (node.left==<span class="keyword">null</span> && node.right==<span class="keyword">null</span>) {</span><br><span class="line">            res+=tempS;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">            node_stack.add(node.left);</span><br><span class="line">             <span class="comment">//æ³¨æ„*10,åœ¨ä¸Šä¸€å±‚çš„åŸºç¡€ä¸Š*10</span></span><br><span class="line">            sum_stack.add(tempS*<span class="number">10</span>+node.left.val);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">            node_stack.add(node.right);</span><br><span class="line">            sum_stack.add(tempS*<span class="number">10</span>+node.right.val);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>DFSè§£æ³•ï¼Œä¸€å¼€å§‹æ²¡æƒ³å‡ºæ¥ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//DFS</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumNumbers2</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    sumNumber(<span class="number">0</span>,root);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sumNumber</span><span class="params">(<span class="keyword">int</span> parent,TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> cur=parent*<span class="number">10</span>+root.val;</span><br><span class="line">    <span class="comment">//å¶å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (root!=<span class="keyword">null</span> && root.left==<span class="keyword">null</span>&& root.right==<span class="keyword">null</span>) {</span><br><span class="line">        sum+=cur;</span><br><span class="line">    }</span><br><span class="line">    sumNumber(cur,root.left);</span><br><span class="line">    sumNumber(cur,root.right);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="437-è·¯å¾„æ€»å’Œ-III"><a href="#437-è·¯å¾„æ€»å’Œ-III" class="headerlink" title="437. è·¯å¾„æ€»å’Œ III"></a><a href="https://leetcode-cn.com/problems/path-sum-iii/" target="_blank" rel="noopener">437. è·¯å¾„æ€»å’Œ III</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹éƒ½å­˜æ”¾ç€ä¸€ä¸ªæ•´æ•°å€¼ã€‚</p><p>æ‰¾å‡ºè·¯å¾„å’Œç­‰äºç»™å®šæ•°å€¼çš„è·¯å¾„æ€»æ•°ã€‚</p><p>è·¯å¾„ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚</p><p>äºŒå‰æ ‘ä¸è¶…è¿‡1000ä¸ªèŠ‚ç‚¹ï¼Œä¸”èŠ‚ç‚¹æ•°å€¼èŒƒå›´æ˜¯ [-1000000,1000000] çš„æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">root = [<span class="number">10</span>,<span class="number">5</span>,-<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="keyword">null</span>,<span class="number">11</span>,<span class="number">3</span>,-<span class="number">2</span>,<span class="keyword">null</span>,<span class="number">1</span>], sum = <span class="number">8</span></span><br><span class="line">      <span class="number">10</span></span><br><span class="line">     /  \</span><br><span class="line">    <span class="number">5</span>   -<span class="number">3</span></span><br><span class="line">   / \    \</span><br><span class="line">  <span class="number">3</span>   <span class="number">2</span>   <span class="number">11</span></span><br><span class="line"> / \   \</span><br><span class="line"><span class="number">3</span>  -<span class="number">2</span>   <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å› 3ã€‚å’Œç­‰äº 8 çš„è·¯å¾„æœ‰:</p><ol><li>5 -> 3</li><li>5 -> 2 -> 1</li><li>-3 -> 11</li></ol><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pathSum</span><span class="params">(TreeNode root, <span class="keyword">int</span> sum)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span> ) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=findPath(root,sum);</span><br><span class="line">    res+=pathSum(root.left,sum);</span><br><span class="line">    res+=pathSum(root.right,sum);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findPath</span><span class="params">(TreeNode node,<span class="keyword">int</span> sum)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (node==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (node.val==sum) {</span><br><span class="line">        res++;</span><br><span class="line">    }</span><br><span class="line">    res+=findPath(node.left,sum-node.val);</span><br><span class="line">    res+=findPath(node.right,sum-node.val);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>emmmmï¼Œè¿™é¢˜åˆ†ç±»æ˜¯easyç¡®å®å¤ªè¿·äº†ï¼ŒåµŒå¥—çš„é€’å½’ï¼Œçœ‹äº†è§£æ³•ç¡®å®çœ‹çš„æ‡‚ï¼Œä½†æ˜¯å†™æ˜¯ç»å¯¹å†™ä¸å‡ºæ¥çš„ï¼ˆçœ¼ç›ï¼šæˆ‘æ‡‚äº†ï¼Œè„‘å­ï¼šä½ æ‡‚ä¸ªé”¤å­ï¼‰é™¤éèƒ½è®°ä½</p><h2 id="235-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#235-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-search-tree/" target="_blank" rel="noopener">235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆ<strong>ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆ</strong>ï¼‰</p><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æœç´¢æ ‘:  <code>root = [6,2,8,0,4,7,9,null,null,3,5]</code></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191001/KlQJmqmdWmP3.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: root = [<span class="number">6</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">3</span>,<span class="number">5</span>], p = <span class="number">2</span>, q = <span class="number">8</span></span><br><span class="line">è¾“å‡º: <span class="number">6</span> </span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ <span class="number">2</span> å’ŒèŠ‚ç‚¹ <span class="number">8</span> çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: root = [<span class="number">6</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">3</span>,<span class="number">5</span>], p = <span class="number">2</span>, q = <span class="number">4</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ <span class="number">2</span> å’ŒèŠ‚ç‚¹ <span class="number">4</span> çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ <span class="number">2</span>, å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æœç´¢æ ‘ä¸­ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>çœ‹äº†ä¸€ç‚¹ç‚¹æ€è·¯ï¼Œç„¶åbugfree</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> </span>{</span><br><span class="line">    <span class="comment">//ç‰¹æ®Šæƒ…å†µ,å…¶ä¸­ä¸€ä¸ªå·²ç»æ˜¯å¦ä¸€ä¸ªçš„ç¥–å…ˆäº†</span></span><br><span class="line">    <span class="comment">//if (p==root || q==root) return root;</span></span><br><span class="line">    <span class="comment">//éƒ½å°äºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (p.val<root.val && q.val<root.val) {< span><br><span class="line">        <span class="keyword">return</span> lowestCommonAncestor(root.left,p,q);</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (p.val > root.val && q.val > root.val) {</span><br><span class="line">        <span class="comment">//éƒ½å¤§äºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> lowestCommonAncestor(root.right,p,q);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="comment">//ä¸€å¤§ä¸€å° æˆ–è€…æœ‰ä¸€ä¸ªæ˜¯root</span></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">}</span><br></root.val></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨å¥½BSTçš„æ€§è´¨ï¼Œå·¦å­æ ‘ä¸€å®šå°äºæ ¹èŠ‚ç‚¹ï¼Œå³å­æ ‘ä¸€å®šå¤§äºæ ¹èŠ‚ç‚¹ï¼Œæ±‚å…¬å…±ç¥–å…ˆï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨å·¦å­æ ‘ï¼Œä¸€ä¸ªåœ¨å³å­æ ‘ï¼Œé‚£ä¹ˆæœ€è¿‘çš„å…¬å…±ç¥–å…ˆä¸€å®šæ˜¯rootï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µå°±æ˜¯å½“ä¸¤ä¸ªèŠ‚ç‚¹å·²ç»æœ‰ç¥–å…ˆå…³ç³»çš„æ—¶å€™ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç¥–å…ˆèŠ‚ç‚¹å°±å¯ä»¥äº†</p><blockquote><p>è¿™é‡Œå…¶å®å‰é¢çš„<code>if</code>å¯ä»¥å»æ‰ï¼Œé¢˜ç›®ä¸­è¯´åˆ°äº†æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥èŠ‚ç‚¹å€¼ç›¸ç­‰å°±è¯´æ˜æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±å·²ç»åŒ…å«åœ¨æœ€åä¸€ä¸ªelseçš„æƒ…å†µä¸­äº†</p></blockquote><h2 id="98-éªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#98-éªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="98. éªŒè¯äºŒå‰æœç´¢æ ‘"></a><a href="https://leetcode-cn.com/problems/validate-binary-search-tree/" target="_blank" rel="noopener">98. éªŒè¯äºŒå‰æœç´¢æ ‘</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚</p><p>å‡è®¾ä¸€ä¸ªäºŒå‰æœç´¢æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š</p><ul><li>èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«<strong>å°äº</strong>å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚</li><li>èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«<strong>å¤§äº</strong>å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚</li><li>æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚</li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">    <span class="number">2</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">1</span>   <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">    <span class="number">5</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">1</span>   <span class="number">4</span></span><br><span class="line">     / \</span><br><span class="line">    <span class="number">3</span>   <span class="number">6</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br><span class="line">è§£é‡Š: è¾“å…¥ä¸º: [<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">3</span>,<span class="number">6</span>]ã€‚</span><br><span class="line">     æ ¹èŠ‚ç‚¹çš„å€¼ä¸º <span class="number">5</span> ï¼Œä½†æ˜¯å…¶å³å­èŠ‚ç‚¹å€¼ä¸º <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>é€’å½’è§£æ³•ï¼Œå¾ˆå·§å¦™</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidBST</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> isValidBST(root,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidBST</span><span class="params">(TreeNode node,Integer low,Integer high)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (low!=<span class="keyword">null</span> && low>=node.val || high!=<span class="keyword">null</span> && high<=node.val) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> isValidBST(node.left,low,node.val) && isValidBST(node.right,node.val,high);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€å®šè¦æ³¨æ„BSTçš„æ€§è´¨æ˜¯æ ¹èŠ‚ç‚¹<strong>å¤§äºæ‰€æœ‰</strong> å³å­æ ‘çš„èŠ‚ç‚¹ï¼Œ<strong>å°äºæ‰€æœ‰</strong>å·¦å­æ ‘çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ç®€å•çš„éªŒè¯å½“å‰èŠ‚ç‚¹å’Œå·¦å³èŠ‚ç‚¹çš„å¤§å°å…³ç³»å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨éªŒè¯çš„æ—¶å€™ä¼ å…¥å¯¹åº”çš„<strong>ä¸Šç•Œ</strong>å’Œ<strong>ä¸‹ç•Œ</strong>ï¼ŒèŠ‚ç‚¹å¿…é¡»è¦å¤§äºä¸‹ç•Œï¼Œå°äºä¸Šç•Œï¼Œé‚£ä¹ˆä¸Šç•Œå’Œä¸‹ç•Œä»å“ªé‡Œæ¥ï¼Ÿ<em>å½“å‰èŠ‚ç‚¹å°±æ˜¯å·¦å­æ ‘çš„ä¸Šç•Œï¼Œå³å­æ ‘çš„ä¸‹ç•Œï¼</em>  ç„¶åé€’å½’å·¦å³å­æ ‘å°±okäº†</p><blockquote><p>è¿™é¢˜å…¶å®è¿˜æœ‰ä¸€ä¸ªå‘ï¼Œåªä¸è¿‡æˆ‘è¿™ä¸ªåšæ³•ç›´æ¥è·³è¿‡äº†ï¼Œé¢˜ç›®çš„caseä¸­æœ‰çš„èŠ‚ç‚¹å€¼æ˜¯<code>Integer.MIN_VALUE</code>ï¼Œå’Œ<code>Integer.MAX_VALUE</code>  ï¼Œå¦‚æœä¸Šç•Œä¸‹ç•Œç›´æ¥ç”¨intæ¥ä¼ é€’çš„è¯ï¼Œå¾ˆæœ‰å¯èƒ½é€’å½’åˆå§‹è°ƒç”¨å°±æ˜¯è¿™æ ·çš„</p><p><code>return isValidBST(root,Integer.MIN_VALUE,Integer.MAX_VALUE);</code> è¿™å°±æ­£ä¸­å‡ºé¢˜äººä¸‹æ€€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨ä¸€ä¸ªåŒ…è£…ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦æ£€æµ‹ä¸Šç•Œä¸‹ç•Œæ˜¯ä¸æ˜¯nullå°±å¯ä»¥äº†</p></blockquote><p><strong>è§£æ³•äºŒ</strong></p><p>è¿™ä¸ªå°±åˆ©ç”¨äº†BSTå’Œä¸­åºéå†çš„å…³ç³»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸­åºéå†æ˜¯ <code>å·¦->æ ¹->å³</code>  è¿™ä¸ªé¡ºåºæ”¾åˆ° BSTä¸­æ°å¥½å°±æ˜¯ä¸€ä¸ªå‡åºçš„åºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ€§è´¨æ¥åˆ¤æ–­äºŒå‰æ ‘æ˜¯ä¸æ˜¯BST</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//BSTçš„ä¸­åºéå†ä¸€å®šæ˜¯å‡åºçš„</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidBST</span><span class="params">(TreeNode root)</span></span>{</span><br><span class="line">    LinkedList<integer> order=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    TreeNode cur=root;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span> || !stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">            stack.add(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        cur=stack.pop();</span><br><span class="line">        <span class="comment">//å’Œä¸Šä¸€æ¬¡çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹å€¼æ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">if</span> (!order.isEmpty() && order.getLast()>= cur.val) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        order.add(cur.val);</span><br><span class="line">        cur=cur.right;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œå…¶å®å¯ä»¥ä¸ç”¨listä¿å­˜ç»“æœï¼Œç”¨ä¸€ä¸ªintä¿å­˜ä¸Šä¸€æ¬¡çš„èŠ‚ç‚¹å€¼å°±è¡Œäº†</p><h2 id="108-å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘"><a href="#108-å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘" class="headerlink" title="108. å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘"></a><a href="https://leetcode-cn.com/problems/convert-sorted-array-to-binary-search-tree/" target="_blank" rel="noopener">108. å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘</a></h2><p>å°†ä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æœ‰åºæ•°ç»„ï¼Œè½¬æ¢ä¸ºä¸€æ£µ<strong>é«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘</strong></p><p>æœ¬é¢˜ä¸­ï¼Œä¸€ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æ ‘æ˜¯æŒ‡ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®šæœ‰åºæ•°ç»„: [-<span class="number">10</span>,-<span class="number">3</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>]</span><br><span class="line">ä¸€ä¸ªå¯èƒ½çš„ç­”æ¡ˆæ˜¯ï¼š[<span class="number">0</span>,-<span class="number">3</span>,<span class="number">9</span>,-<span class="number">10</span>,<span class="keyword">null</span>,<span class="number">5</span>]ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸‹é¢è¿™ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼š</span><br><span class="line">      <span class="number">0</span></span><br><span class="line">     / \</span><br><span class="line">   -<span class="number">3</span>   <span class="number">9</span></span><br><span class="line">   /   /</span><br><span class="line"> -<span class="number">10</span>  <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">sortedArrayToBST</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> sortedArrayToBST(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">sortedArrayToBST</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left>right) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> mid=(right-left)/<span class="number">2</span>+left;</span><br><span class="line">    TreeNode node=<span class="keyword">new</span> TreeNode(nums[mid]);</span><br><span class="line">    node.left=sortedArrayToBST(nums,left,mid-<span class="number">1</span>);</span><br><span class="line">    node.right=sortedArrayToBST(nums,mid+<span class="number">1</span>,right);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜æœ€å¼€å§‹ç»ˆæ­¢æ¡ä»¶å†™é”™äº†ï¼Œæ€è·¯æ˜¯å¯¹çš„ï¼Œå¯¹é€’å½’è¿ç”¨çš„è¿˜æ˜¯ä¸å¤Ÿç†Ÿç»ƒï¼Œç»ˆæ­¢æ¡ä»¶å…¶å®åªéœ€è¦æƒ³ä¸€ä¸‹æç«¯æƒ…å†µå°±å¯ä»¥äº†</p><h2 id="230-äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ "><a href="#230-äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ " class="headerlink" title="230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/kth-smallest-element-in-a-bst/" target="_blank" rel="noopener">230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ </a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•° <code>kthSmallest</code> æ¥æŸ¥æ‰¾å…¶ä¸­ç¬¬ k ä¸ªæœ€å°çš„å…ƒç´ </p><p><strong>è¯´æ˜ï¼š</strong><br>ä½ å¯ä»¥å‡è®¾ k æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œ1 â‰¤ k â‰¤ äºŒå‰æœç´¢æ ‘å…ƒç´ ä¸ªæ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: root = [<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">2</span>], k = <span class="number">1</span></span><br><span class="line">   <span class="number">3</span></span><br><span class="line">  / \</span><br><span class="line"> <span class="number">1</span>   <span class="number">4</span></span><br><span class="line">  \</span><br><span class="line">   <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: root = [<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">1</span>], k = <span class="number">3</span></span><br><span class="line">       <span class="number">5</span></span><br><span class="line">      / \</span><br><span class="line">     <span class="number">3</span>   <span class="number">6</span></span><br><span class="line">    / \</span><br><span class="line">   <span class="number">2</span>   <span class="number">4</span></span><br><span class="line">  /</span><br><span class="line"> <span class="number">1</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶ï¼š</strong><br>å¦‚æœäºŒå‰æœç´¢æ ‘ç»å¸¸è¢«ä¿®æ”¹ï¼ˆæ’å…¥/åˆ é™¤æ“ä½œï¼‰å¹¶ä¸”ä½ éœ€è¦é¢‘ç¹åœ°æŸ¥æ‰¾ç¬¬ k å°çš„å€¼ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ– kthSmallest å‡½æ•°ï¼Ÿ</p><p><strong>è§£æ³•ä¸€</strong></p><p>éé€’å½’ä¸­åºéå†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">kthSmallest</span><span class="params">(TreeNode root, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    TreeNode cur=root;</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span> || !stack.isEmpty()){</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">            stack.add(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        cur=stack.pop();</span><br><span class="line">        <span class="keyword">if</span> (count==k-<span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">return</span> cur.val;</span><br><span class="line">        }</span><br><span class="line">        cur=cur.right;</span><br><span class="line">        count++;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æ²¡æ‰¾åˆ°</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿˜æ˜¯åˆ©ç”¨BSTä¸­åºéå†æ˜¯å‡åºçš„æ€§è´¨ï¼Œåœ¨å–åˆ°ç¬¬kä¸ªå…ƒç´ çš„æ—¶å€™å°±ç›´æ¥<code>break</code></p><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’çš„æ–¹å¼ï¼ŒåŠ äº†ä¸¤ä¸ªé¢å¤–çš„å®ä¾‹å˜é‡å…¶å®ä¸å¤ªå¥½</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">kthSmallest</span><span class="params">(TreeNode root, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    kthSmallest(root,k);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">kthSmall</span><span class="params">(TreeNode root, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    kthSmall(root.left,k);</span><br><span class="line">    <span class="keyword">if</span> (count==k-<span class="number">1</span>) {</span><br><span class="line">        res=root.val;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    count++;</span><br><span class="line">    kthSmall(root.right,k);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶</strong></p><p>å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå¤§æ ¹å †ï¼Œå°±å’Œæœ€å°æ ˆä¸€æ ·ï¼Œæ¯æ¬¡å¯¹BSTæ“ä½œçš„æ—¶å€™åŒæ­¥æ“ä½œè¿™ä¸ªå¤§æ ¹å †</p><h2 id="236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/" target="_blank" rel="noopener">236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘:  root = [3,5,1,6,2,0,8,null,null,7,4]</p><p> <img alt="mark" data-src="http://static.imlgw.top/blog/20191003/m0bWNSMUQWy2.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: root = [<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">7</span>,<span class="number">4</span>], p = <span class="number">5</span>, q = <span class="number">1</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ <span class="number">5</span> å’ŒèŠ‚ç‚¹ <span class="number">1</span> çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ <span class="number">3</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: root = [<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">7</span>,<span class="number">4</span>], p = <span class="number">5</span>, q = <span class="number">4</span></span><br><span class="line">è¾“å‡º: <span class="number">5</span></span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ <span class="number">5</span> å’ŒèŠ‚ç‚¹ <span class="number">4</span> çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ <span class="number">5</span>ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span> || p==root ||q==root) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    TreeNode left=lowestCommonAncestor(root.left,p,q);</span><br><span class="line">    TreeNode right=lowestCommonAncestor(root.right,p,q);</span><br><span class="line">    <span class="keyword">if</span> (left!=<span class="keyword">null</span> && right!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (left!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (right!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜ï¼Œè¯´å®è¯ï¼Œæˆ‘æ˜¯æƒ³ä¸å‡ºæ¥</p><p>åœ¨å·¦ã€å³å­æ ‘ä¸­åˆ†åˆ«æŸ¥æ‰¾æ˜¯å¦åŒ…å«pæˆ–qï¼š</p><ul><li>å¦‚æœä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼ˆå·¦å­æ ‘åŒ…å«pï¼Œå³å­æ ‘åŒ…å«q/å·¦å­æ ‘åŒ…å«qï¼Œå³å­æ ‘åŒ…å«pï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„æ ¹èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ</li><li>å¦‚æœå·¦å­æ ‘åŒ…å«på’Œqï¼Œé‚£ä¹ˆåˆ°root->leftä¸­ç»§ç»­æŸ¥æ‰¾ï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆåœ¨å·¦å­æ ‘é‡Œé¢</li><li>å¦‚æœå³å­æ ‘åŒ…å«på’Œqï¼Œé‚£ä¹ˆåˆ°root->rightä¸­ç»§ç»­æŸ¥æ‰¾ï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆåœ¨å³å­æ ‘é‡Œé¢ </li></ul><h2 id="101-å¯¹ç§°äºŒå‰æ ‘"><a href="#101-å¯¹ç§°äºŒå‰æ ‘" class="headerlink" title="101. å¯¹ç§°äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/symmetric-tree/" target="_blank" rel="noopener">101. å¯¹ç§°äºŒå‰æ ‘</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„ã€‚</p><p>ä¾‹å¦‚ï¼ŒäºŒå‰æ ‘ <code>[1,2,2,3,4,4,3]</code> æ˜¯å¯¹ç§°çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="number">1</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">2</span></span><br><span class="line"> / \ / \</span><br><span class="line"><span class="number">3</span>  <span class="number">4</span> <span class="number">4</span>  <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p>ä½†æ˜¯ä¸‹é¢è¿™ä¸ª <code>[1,2,2,null,3,null,3]</code> åˆ™ä¸æ˜¯<strong>é•œåƒå¯¹ç§°</strong>çš„:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">1</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">2</span>   <span class="number">2</span></span><br><span class="line"> \   \</span><br><span class="line"> <span class="number">3</span>    <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><p>å¦‚æœä½ å¯ä»¥è¿ç”¨é€’å½’å’Œè¿­ä»£ä¸¤ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¼šå¾ˆåŠ åˆ†ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>å“ï¼Œæ„Ÿè§‰åˆ·é¢˜è¿˜æ˜¯å¾—åœ¨ç™½å¤©ï¼Œè„‘å­æ¸…é†’ç‚¹ï¼Œä¸‹åˆå°±æ„Ÿè§‰åšé¢˜è€æ˜¯å‡ºé—®é¢˜ï¼Œä¸€å¼€å§‹é¢˜éƒ½æ²¡çœ‹æ¸…å°±å¼€å§‹åš</p><p>å…¶å®ä¸€å¼€å§‹æ˜¯æƒ³BFSå±‚æ¬¡éå†ç„¶ååˆ¤æ–­æ¯ä¸€å±‚æ˜¯ä¸æ˜¯é•œåƒå¯¹ç§°çš„ï¼Œç„¶åå‘ç°æœ‰äº›caseæ˜¯è¿‡ä¸äº†çš„ï¼Œæ¯”å¦‚</p><p><code>[1,3,3,2,null,2]</code> è¿™æ ·çš„case</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="number">1</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">3</span>   <span class="number">3</span></span><br><span class="line"> /   /</span><br><span class="line"><span class="number">2</span>   <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><del>å±‚åºéå†åˆ¤æ–­ä¸å‡ºäº†è¿™æ ·çš„case</del>   ä¸‹é¢è§£æ³•å››æ‰“è„¸</p><p>ç„¶åæ¢ä¸€ç§éå†æ–¹å¼ï¼Œå…¶å®ä¸€å¼€å§‹å°±æƒ³åˆ°äº†å‰åºéå†ï¼Œå¦‚æœæ˜¯é•œåƒå¯¹ç§°çš„è¯ï¼Œå‰åºéå†åˆšå¥½å°±æ˜¯å¯¹ç§°çš„ï¼Œä½†æ˜¯ï¼ï¼ï¼è¿˜æ˜¯æœ‰caseè¿‡ä¸äº†ï¼ï¼ï¼æˆ‘ä»¬å†çœ‹ä¸Šé¢çš„caseï¼Œæˆ‘ä»¬æ”¹ä¸€æ”¹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="number">1</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">2</span></span><br><span class="line"> /   /</span><br><span class="line"><span class="number">2</span>   <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p>ç¬¬<code>192/195ä¸ªcase</code>ï¼Œæˆ‘æƒŠäº†ï¼Œå±…ç„¶è¿˜æœ‰è¿™ç§æ“ä½œï¼ï¼ï¼å®åœ¨æ²¡åŠæ³•ç¿»äº†ä¸‹è§£ç­”ï¼Œå‘ç°æœ‰ä½è€å…„ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œç„¶åä»–å¾ˆå·§å¦™çš„åœ¨æ¯ä¸ªèŠ‚ç‚¹å€¼åé¢åŠ äº†ä¸€ä¸ª<strong>å±‚æ•°</strong>ï¼Œä»–å¥½åƒæ˜¯ç›´æ¥å½“ä½œå­—ç¬¦ä¸²æ·»åŠ çš„ï¼Œæˆ‘æ„Ÿè§‰ä¸å¤ªå¥½ï¼Œæ”¹ç”¨äº†æ•°ç»„ï¼Œæœ€ååˆ¤æ–­çš„æ—¶å€™éœ€è¦ä¿è¯å±‚æ•°å’Œå€¼éƒ½ç›¸åŒæ‰è¡Œï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//[1,2,2,2,null,2] å¿˜äº†è¿˜æœ‰è¿™æ ·çš„caseäº†,å“­äº†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSymmetric</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    List<integer[]> lis=<span class="keyword">new</span> ArrayList<>();</integer[]></span><br><span class="line">    preTravle(root,lis,<span class="number">0</span>); </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>,j=lis.size()-<span class="number">1</span>;i<=j;i++,j--) {</span><br><span class="line">        <span class="keyword">if</span> (lis.get(i)[<span class="number">0</span>]!= lis.get(j)[<span class="number">0</span>] ||  lis.get(j)[<span class="number">1</span>]!= lis.get(i)[<span class="number">1</span>]) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‰åºéå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preTravle</span><span class="params">(TreeNode node,List<integer[]> lis,<span class="keyword">int</span> k)</integer[]></span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node!=<span class="keyword">null</span>) {</span><br><span class="line">        preTravle(node.left,lis,k+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//è¿™é‡Œå…¶å®ç”¨ä¸ªå­—ç¬¦ä¸²å°±å¯ä»¥ï¼Œä½†æ˜¯æ„Ÿè§‰æ‹¼æ¥çš„æ•ˆç‡ä¸é«˜ï¼Œè€Œä¸”ï¼Œæ˜¯ä¸æ˜¯æœ‰å¯èƒ½å‡ºç°é—®é¢˜ï¼Ÿ</span></span><br><span class="line">        <span class="comment">// 11+3 ==1+13 ï¼Ÿï¼Ÿï¼Ÿæ˜¯ä¸æ˜¯æœ‰å¯èƒ½å‡ºç°ç±»ä¼¼è¿™æ ·çš„æƒ…å†µ</span></span><br><span class="line">        Integer[] temp=<span class="keyword">new</span> Integer[<span class="number">2</span>];</span><br><span class="line">        temp[<span class="number">0</span>]=node.val;</span><br><span class="line">        temp[<span class="number">1</span>]=k;</span><br><span class="line">        lis.add(temp);</span><br><span class="line">        preTravle(node.right,lis,k+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’çš„è§£æ³•ï¼Œåº”è¯¥ç®—æ˜¯å®˜è§£äº†ï¼Œä¸€å¼€å§‹ä¹Ÿæ˜¯æƒ³ç”¨é€’å½’å†™çš„ï¼Œæ²¡æŠ“ä½é—®é¢˜çš„æœ¬è´¨ï¼Œå¤ªèœäº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSymmetric</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root ==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è½¬æ¢ä¸ºæ±‚å·¦å³å­æ ‘æ˜¯å¦é•œåƒå¯¹ç§°çš„é—®é¢˜</span></span><br><span class="line">    <span class="keyword">return</span> isSymmetric(root.left,root.right);</span><br><span class="line">    <span class="comment">//return isSymmetric(root,root);</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//dfs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSymmetric</span><span class="params">(TreeNode t1,TreeNode t2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (t1==<span class="keyword">null</span> && t2==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æœ‰ä¸€ä¸ªä¸ºnull</span></span><br><span class="line">    <span class="keyword">if</span> (t1== <span class="keyword">null</span> || t2==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//éƒ½ä¸ä¸ºnull</span></span><br><span class="line">    <span class="keyword">return</span> t1.val==t2.val && isSymmetric(t1.left,t2.right) && isSymmetric(t1.right,t2.left);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€æ£µæ ‘æ˜¯é•œåƒå¯¹ç§°ï¼Œè¯´æ˜å·¦å³å­æ ‘å·¦å³å¯¹ç§°ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å°±å¯ä»¥è½¬æ¢ä¸ºï¼Œåˆ¤æ–­å·¦å³ä¸¤é¢—å­æ ‘æ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„é—®é¢˜</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191107/Ae6daB6SuXdl.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>åˆ¤æ–­ä¸¤é¢—æ ‘æ˜¯å¦æˆé•œåƒå¯¹ç§°çš„è¯ï¼Œå…¶å®å°±å’Œç…§é•œå­ä¸€æ ·çš„ï¼Œå¦‚ä¸Šå›¾ï¼Œåˆ¤æ–­å·¦å­æ ‘å’Œå³å­æ ‘æ˜¯å¦æˆé•œåƒå¯¹ç§°ï¼Œå°±éœ€è¦åˆ¤æ–­<code>t1çš„å·¦å­æ ‘å’Œt2çš„å³å­æ ‘æ˜¯å¦é•œåƒå¯¹ç§°,t1çš„å³å­æ ‘å’Œt2çš„å·¦å­æ ‘æ˜¯å¦é•œåƒå¯¹ç§°</code>ï¼Œæ ¹æ®è¿™ä¸ªå°±å¯ä»¥å†™å‡ºé€’å½’å‡½æ•°ï¼Œè¿˜æ˜¯æŒºå¦™çš„</p><p><strong>è§£æ³•ä¸‰</strong></p><p>ç±»ä¼¼äºå±‚æ¬¡éå†ï¼Œå…¶å®å°±æ˜¯æ ¹æ®ä¸Šé¢çš„é€’å½’æ–¹æ³•æ”¹æ¥çš„ï¼Œæ ¸å¿ƒæ€æƒ³å’Œä¸Šé¢é€’å½’çš„æ˜¯ä¸€æ ·çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//éé€’å½’è§£æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSymmetric</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root ==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    stack.push(root.left);</span><br><span class="line">    stack.push(root.right);</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">        TreeNode t1=stack.pop();</span><br><span class="line">        TreeNode t2=stack.pop();</span><br><span class="line">        <span class="keyword">if</span> (t1==<span class="keyword">null</span> && t2==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (t1==<span class="keyword">null</span>||t2==<span class="keyword">null</span> || t1.val!=t2.val) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/*if (t1.val!=t2.val) {</span></span><br><span class="line"><span class="comment">                return false;</span></span><br><span class="line"><span class="comment">         }*/</span></span><br><span class="line">        stack.push(t1.left);</span><br><span class="line">        stack.push(t2.right);</span><br><span class="line">        stack.push(t1.right);</span><br><span class="line">        stack.push(t2.left);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•å››</strong></p><p>å‰åºéå†ï¼Œå…¶å®æˆ‘ä¸€å¼€å§‹ä¹Ÿæƒ³åˆ°äº†ç”¨å ä½çš„æ–¹å¼ï¼Œä½†æ˜¯å› ä¸ºä¹‹å‰éå†æ–¹å¼ä¸åŒï¼Œå¯¼è‡´æ²¡æƒ³å¥½åœ¨å“ªé‡ŒåŠ </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSymmetric</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root ==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        ArrayList<integer> lis=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            TreeNode node=queue.poll();</span><br><span class="line">            <span class="comment">//lis.add(node.val);</span></span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">                lis.add(node.left.val);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="comment">//-1å ä½</span></span><br><span class="line">                lis.add(-<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">                lis.add(node.right.val);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="comment">//ä¸ºç©ºåŠ -1å ä½</span></span><br><span class="line">                lis.add(-<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å¯¹æ¯ä¸€å±‚ç»å¸¸åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>,j=lis.size()-<span class="number">1</span>;i<=j;i++,j--) {</span><br><span class="line">            <span class="keyword">if</span> (lis.get(i)!=lis.get(j)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·çš„åšæ³•æ˜æ˜¾æ—¶é—´å¤æ‚åº¦ä¼šä¹‹å‰è¦é«˜ï¼Œä¸ä»…éå†äº†æ•´é¢—æ ‘ä¸€éï¼Œè¿˜å¯¹æ¯ä¸€å±‚éå†äº†ä¸€éï¼Œä¸€å…±éå†äº†ä¸¤é</p><h2 id="513-æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼"><a href="#513-æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼" class="headerlink" title="513. æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼"></a><a href="https://leetcode-cn.com/problems/find-bottom-left-tree-value/" target="_blank" rel="noopener">513. æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåœ¨æ ‘çš„æœ€åä¸€è¡Œæ‰¾åˆ°æœ€å·¦è¾¹çš„å€¼ã€‚</p><p>ç¤ºä¾‹ 1:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">    <span class="number">2</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">1</span>   <span class="number">3</span></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p>ç¤ºä¾‹ 2:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">        <span class="number">1</span></span><br><span class="line">       / \</span><br><span class="line">      <span class="number">2</span>   <span class="number">3</span></span><br><span class="line">     /   / \</span><br><span class="line">    <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span></span><br><span class="line">       /</span><br><span class="line">      <span class="number">7</span></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong> æ‚¨å¯ä»¥å‡è®¾æ ‘ï¼ˆå³ç»™å®šçš„æ ¹èŠ‚ç‚¹ï¼‰ä¸ä¸º NULLã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™ç§é¢˜å†™ä¸€ç™¾éäº†ğŸ˜‚ï¼Œç„¶è€Œæˆ‘è¿˜æ˜¯æ²¡æœ‰bugfree</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å…¶å®è¿™ç§å±‚åºéå†çš„æ–¹å¼å¯¹è¿™é¢˜æœ‰ä¸€ç‚¹å°é¢˜å¤§ä½œï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æ¯”è¾ƒä¹ æƒ¯è¿™ç§æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findBottomLeftValue</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">int</span> res=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> count=queue.size();</span><br><span class="line">        <span class="keyword">int</span> temp=count;</span><br><span class="line">        <span class="keyword">while</span>(count><span class="number">0</span>){</span><br><span class="line">            TreeNode node=queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (count==temp) {</span><br><span class="line">                res=node.val;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.left);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(node.right);</span><br><span class="line">            }</span><br><span class="line">            count--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;   </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>æœ€å·¦è¾¹çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œdfsæ·±åº¦ä¼˜å…ˆï¼Œæ·±åº¦æ¯å¢åŠ ä¸€æ¬¡å°±æ›´æ–°ä¸€æ¬¡res</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//DFS</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findBottomLeftValue2</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    dfs(root,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> res=-<span class="number">1</span>,max=Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(TreeNode node,<span class="keyword">int</span> depth)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node==<span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (depth>max) {</span><br><span class="line">        max=depth;</span><br><span class="line">        res=node.val;</span><br><span class="line">    }</span><br><span class="line">    dfs(node.left,depth+<span class="number">1</span>);</span><br><span class="line">    dfs(node.right,depth+<span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="105-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘"><a href="#105-ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘" class="headerlink" title="105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/" target="_blank" rel="noopener">105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘</a></h2><p>æ ¹æ®ä¸€æ£µæ ‘çš„å‰åºéå†ä¸ä¸­åºéå†æ„é€ äºŒå‰æ ‘ã€‚</p><p><strong>æ³¨æ„:</strong><br>ä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å‡º</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">å‰åºéå† preorder = [<span class="number">3</span>,<span class="number">9</span>,<span class="number">20</span>,<span class="number">15</span>,<span class="number">7</span>]</span><br><span class="line">ä¸­åºéå† inorder = [<span class="number">9</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">20</span>,<span class="number">7</span>]</span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] preorder, <span class="keyword">int</span>[] inorder)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (preorder==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> buildTree(preorder,<span class="number">0</span>,preorder.length-<span class="number">1</span>,inorder,<span class="number">0</span>,inorder.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] preorder,<span class="keyword">int</span> preleft,<span class="keyword">int</span> preright,<span class="keyword">int</span>[] inorder,<span class="keyword">int</span> inleft,<span class="keyword">int</span> inright)</span> </span>{</span><br><span class="line">    <span class="comment">//é€’å½’å‡ºå£åªéœ€è¦æƒ³ä¸€ä¸‹è¾¹ç•Œ,æ¯”å¦‚åªè¦ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™,å¾ˆæ˜æ˜¾åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™è¿™å‡ ä¸ªå€¼éƒ½æ˜¯ 0</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯æ­¤æ—¶è‚¯å®šä¸èƒ½è¿”å›null,æ‰€ä»¥è¿™é‡Œé€’å½’å‡ºå£ä¸æ˜¯å¤§äºç­‰äº,è€Œæ˜¯å¤§äº</span></span><br><span class="line">    <span class="keyword">if</span> (preleft>preright || inleft>inright) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    TreeNode root=<span class="keyword">new</span> TreeNode(preorder[preleft]);</span><br><span class="line">    <span class="keyword">int</span> index=inleft;</span><br><span class="line">    <span class="keyword">while</span>(inorder[index] != preorder[preleft]) {</span><br><span class="line">        index++;</span><br><span class="line">    }</span><br><span class="line">    root.left=buildTree(preorder,preleft+<span class="number">1</span>,preleft+index-inleft,inorder,inleft,index-<span class="number">1</span>);</span><br><span class="line">    root.right=buildTree(preorder,preleft+index-inleft+<span class="number">1</span>,preright,inorder,index+<span class="number">1</span>,inright);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨è¿™å‡ ç§éå†çš„æ€§è´¨ï¼Œæ–‡å­—æ€»æ˜¯è‹ç™½çš„ï¼Œçœ‹ä¸ªå›¾å§</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191106/pcmvnEK8Hwg8.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™æ ·ä¸€çœ‹å°±æ¸…æ™°äº†ï¼Œå‰åºéå†å·¦è¾¹ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ <code>1</code> ä¸€å®šæ˜¯æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆç¡®å®šäº†æ ¹èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬å»ä¸­åºéå†ä¸­å»æ‰¾è¿™ä¸ªæ ¹èŠ‚ç‚¹ï¼ˆä¸€å®šæœ‰ï¼‰ï¼Œå¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸­é—´çš„ <code>1</code>ç„¶åå†æ ¹æ®ä¸­åºéå†çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å°±çŸ¥é“ï¼Œä¸­åºéå†ä¸­ï¼Œè¿™ä¸ª<code>1</code> çš„å·¦è¾¹æ˜¯ <code>1</code> çš„å·¦å­æ ‘ï¼Œå³è¾¹æ˜¯<code>1</code> çš„å³å­æ ‘ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±ç¡®å®šäº†æ ¹èŠ‚ç‚¹åŠå…¶å·¦å³å­æ ‘ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™é€’å½’å»å®Œæˆäº†ğŸ˜ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å·¦å³å­æ ‘åˆ†åˆ«é€’å½’è¯¥è¿‡ç¨‹å°±å¯ä»¥å¾—åˆ°ä¸€é¢—å®Œæ•´çš„æ ‘äº†</p><p>å½“ç„¶è¿™é‡Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ä¸‹æ ‡çš„å˜æ¢ï¼Œè¦ååˆ†æ³¨æ„ï¼Œè‡ªå·±å¸¦å…¥å‡ ä¸ªå€¼è¯•è¯•</p><h2 id="106-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘"><a href="#106-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘" class="headerlink" title="106. ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/construct-binary-tree-from-inorder-and-postorder-traversal/" target="_blank" rel="noopener">106. ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘</a></h2><p>æ ¹æ®ä¸€æ£µæ ‘çš„ä¸­åºéå†ä¸ååºéå†æ„é€ äºŒå‰æ ‘ã€‚</p><p><strong>æ³¨æ„:</strong><br>ä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å‡º</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ä¸­åºéå† inorder = [<span class="number">9</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">20</span>,<span class="number">7</span>]</span><br><span class="line">ååºéå† postorder = [<span class="number">9</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">20</span>,<span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="number">3</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">9</span>  <span class="number">20</span></span><br><span class="line">  /  \</span><br><span class="line"> <span class="number">15</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ–¹æ³•åŒä¸Šï¼Œåªä¸è¿‡æ˜¯ä»åå¾€å‰äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] inorder, <span class="keyword">int</span>[] postorder)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (inorder==<span class="keyword">null</span> || inorder.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> buildTree(inorder,<span class="number">0</span>,inorder.length-<span class="number">1</span>,postorder,<span class="number">0</span>,postorder.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] inorder,<span class="keyword">int</span> inL,<span class="keyword">int</span> inR, <span class="keyword">int</span>[] postorder,<span class="keyword">int</span> pL,<span class="keyword">int</span> pR)</span> </span>{</span><br><span class="line">    <span class="comment">//é€’å½’å‡ºå£åªéœ€è¦æƒ³ä¸€ä¸‹è¾¹ç•Œ,æ¯”å¦‚åªè¦ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™,å¾ˆæ˜æ˜¾åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™è¿™å‡ ä¸ªå€¼éƒ½æ˜¯0</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯æ­¤æ—¶è‚¯å®šä¸èƒ½è¿”å›null,æ‰€ä»¥è¿™é‡Œé€’å½’å‡ºå£ä¸æ˜¯å¤§äºç­‰äº,è€Œæ˜¯å¤§äº</span></span><br><span class="line">    <span class="keyword">if</span> (inL>inR || pL>pR) { </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    TreeNode root=<span class="keyword">new</span> TreeNode(postorder[pR]);</span><br><span class="line">    <span class="keyword">int</span> index=inL;</span><br><span class="line">    <span class="keyword">while</span>(inorder[index]!=postorder[pR]){</span><br><span class="line">        index++; <span class="comment">//ä¸€å®šæœ‰,æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒè¶Šç•Œçš„é—®é¢˜</span></span><br><span class="line">    }</span><br><span class="line">    root.left=buildTree(inorder,inL,index-<span class="number">1</span>,postorder,pL,pL+index-inL-<span class="number">1</span>);</span><br><span class="line">    root.right=buildTree(inorder,index+<span class="number">1</span>,inR,postorder,pL+index-inL,pR-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å’Œä¸Šé¢ä¸€æ ·æ²¡å•¥å¥½è¯´çš„</p><p><strong>è§£æ³•äºŒ</strong></p><p>ä¸Šé¢ä¸¤ç§è§£æ³•æäº¤åæ•ˆç‡éƒ½ä¸é«˜ï¼Œè¿™é‡Œå»ä¸­åºéå†ä¸­æ‰¾æ ¹èŠ‚ç‚¹çš„æ“ä½œå…¶å®å¯ä»¥ç”¨Hashè¡¨ä»£æ›¿</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//hashè¡¨ä¼˜åŒ–</span></span><br><span class="line">HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] inorder, <span class="keyword">int</span>[] postorder)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (inorder==<span class="keyword">null</span> || inorder.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<inorder.length;i++) {< span><br><span class="line">        map.put(inorder[i],i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> buildTree(inorder,<span class="number">0</span>,inorder.length-<span class="number">1</span>,postorder,<span class="number">0</span>,postorder.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] inorder,<span class="keyword">int</span> inL,<span class="keyword">int</span> inR, <span class="keyword">int</span>[] postorder,<span class="keyword">int</span> pL,<span class="keyword">int</span> pR)</span> </span>{</span><br><span class="line">    <span class="comment">//é€’å½’å‡ºå£åªéœ€è¦æƒ³ä¸€ä¸‹è¾¹ç•Œ,æ¯”å¦‚åªè¦ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™,å¾ˆæ˜æ˜¾åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™è¿™å‡ ä¸ªå€¼éƒ½æ˜¯ç›¸ç­‰çš„</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯æ­¤æ—¶è‚¯å®šä¸èƒ½è¿”å›null,æ‰€ä»¥è¿™é‡Œé€’å½’å‡ºå£ä¸æ˜¯å¤§äºç­‰äº,è€Œæ˜¯å¤§äº</span></span><br><span class="line">    <span class="keyword">if</span> (inL>inR || pL>pR) { </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    TreeNode root=<span class="keyword">new</span> TreeNode(postorder[pR]);</span><br><span class="line">    <span class="keyword">int</span> index=map.get(postorder[pR]);</span><br><span class="line">    root.left=buildTree(inorder,inL,index-<span class="number">1</span>,postorder,pL,pL+index-inL-<span class="number">1</span>);</span><br><span class="line">    root.right=buildTree(inorder,index+<span class="number">1</span>,inR,postorder,pL+index-inL,pR-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></inorder.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="114-äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨"><a href="#114-äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨" class="headerlink" title="114. äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/flatten-binary-tree-to-linked-list/" target="_blank" rel="noopener">114. äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼ŒåŸåœ°å°†å®ƒå±•å¼€ä¸ºé“¾è¡¨ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šäºŒå‰æ ‘</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">5</span></span><br><span class="line"> / \   \</span><br><span class="line"><span class="number">3</span>   <span class="number">4</span>   <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p>å°†å…¶å±•å¼€ä¸ºï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"> \</span><br><span class="line">  <span class="number">2</span></span><br><span class="line">   \</span><br><span class="line">    <span class="number">3</span></span><br><span class="line">     \</span><br><span class="line">      <span class="number">4</span></span><br><span class="line">       \</span><br><span class="line">        <span class="number">5</span></span><br><span class="line">         \</span><br><span class="line">          <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>é¢˜ç›®æ²¡æŠ„é”™ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼Œç¡®å®é¢˜ç›®æ²¡æœ‰è¯´æ˜æŒ‰ç…§ä»€ä¹ˆæ–¹å¼å±•å¼€ï¼Œä½†æ˜¯çœ‹caseèƒ½çŒœåˆ°æ˜¯å‰åºéå†çš„æ–¹å¼å±•å¼€ï¼ˆé çŒœçš„ï¼Ÿï¼‰</p></blockquote><p><strong>è§£æ³•ä¸€</strong></p><p>å‰åºéå†ï¼Œé€’å½’çš„è§£æ³•ï¼Œç”¨ä¸€ä¸ªå…¨å±€å˜é‡ä¿å­˜é“¾è¡¨çš„ç»“å°¾ï¼Œæ¯æ¬¡å°†èŠ‚ç‚¹æ·»åŠ åˆ°lastçš„åé¢</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">TreeNode last=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flatten</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (last!=<span class="keyword">null</span>) {</span><br><span class="line">        last.left=<span class="keyword">null</span>;</span><br><span class="line">        last.right=root;</span><br><span class="line">    }</span><br><span class="line">    last=root;</span><br><span class="line">    TreeNode right=root.right;<span class="comment">//ä¿å­˜å³å­æ ‘</span></span><br><span class="line">    flatten(root.left);</span><br><span class="line">    flatten(right);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯éœ€è¦ä¿å­˜å³å­æ ‘ï¼Œå› ä¸ºå‰é¢çš„æ“ä½œå°†å·¦å­æ ‘æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹å³å­æ ‘çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´åŸæœ¬çš„å³å­æ ‘ä¸¢å¤±</p><p><strong>è§£æ³•äºŒ</strong></p><p>å˜å½¢çš„ååºéå†ï¼Œé€’å½’è§£æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">TreeNode pre=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flatten</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    flatten(root.right);</span><br><span class="line">    flatten(root.left);</span><br><span class="line">    root.right=pre;</span><br><span class="line">    root.left=<span class="keyword">null</span>;</span><br><span class="line">    pre=root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç›¸æ¯”å‰é¢çš„è§£æ³•ï¼Œä¸ºäº†ä¸ä¸¢å¤±å³å­æ ‘ï¼Œå…ˆéå†å³å­æ ‘ï¼Œå†éå†å·¦å­æ ‘ï¼Œæ•´ä¸ªåºåˆ—å°±æ˜¯<code>6 5 4 3 2 1</code>  æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹çš„rightæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹å°±okäº†</p><p><strong>è§£æ³•ä¸‰</strong></p><p>è¿­ä»£ï¼Œæˆ‘è§‰å¾—è¿™ç§è§£æ³•åº”è¯¥æ¥è¯´æ˜¯æœ€å®¹æ˜“ç†è§£çš„ï¼Œè€Œä¸”æ˜¯å®Œå…¨çš„ <code>in-place</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flatten</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    TreeNode mRight=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(root!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span> (root.left!=<span class="keyword">null</span>) {</span><br><span class="line">            mRight=root.left;</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">while</span>(mRight.right!=<span class="keyword">null</span>){</span><br><span class="line">                mRight=mRight.right;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//å°†æ ¹çš„å³èŠ‚ç‚¹æ¥åœ¨ mRight.right</span></span><br><span class="line">            mRight.right=root.right;</span><br><span class="line">            <span class="comment">//å°†root.leftæ¥åœ¨root.right</span></span><br><span class="line">            root.right=root.left;</span><br><span class="line">            <span class="comment">//å·¦èŠ‚ç‚¹ç½®ä¸ºnull</span></span><br><span class="line">            root.left=<span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//é‡å¤è¯¥è¿‡ç¨‹</span></span><br><span class="line">        root=root.right;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç”»ä¸ªå›¾å°±æ˜¯è¿™æ ·</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191108/BIx12P1AYjeX.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h2 id="116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ"><a href="#116-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ" class="headerlink" title="116. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ"></a><a href="https://leetcode-cn.com/problems/populating-next-right-pointers-in-each-node/" target="_blank" rel="noopener">116. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ</a></h2><p>ç»™å®šä¸€ä¸ª<strong>å®Œç¾äºŒå‰æ ‘</strong>ï¼Œå…¶æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚äºŒå‰æ ‘å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">struct Node {</span><br><span class="line">  <span class="keyword">int</span> val;</span><br><span class="line">  Node *left;</span><br><span class="line">  Node *right;</span><br><span class="line">  Node *next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULL</p><p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULL</p><p><img alt="leet" data-src="https://i.loli.net/2019/11/10/eC4VBqXmwuspZlG.png" src="/img/loading.gif" class="lazyload"></p><p><strong>è§£æ³•ä¸€</strong></p><p>å¼€å§‹æ²¡åšå‡ºæ¥ï¼Œèœï¼ï¼ï¼ç„¶åç‰¹æ„ç•™åˆ°ä»Šå¤©æ€»ç»“ï¼Œåˆåœ¨webä¸Šæäº¤äº†ä¸€é</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">connect</span><span class="params">(Node root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root ==<span class="keyword">null</span> ||root.left==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    root.left.next=root.right;</span><br><span class="line">    <span class="keyword">if</span> (root.next!=<span class="keyword">null</span>) {</span><br><span class="line">        root.right.next=root.next.left;   </span><br><span class="line">    }</span><br><span class="line">    connect(root.left);</span><br><span class="line">    connect(root.right);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>è¿™ä¸ªè§£æ³•æ¢³ç†è¿˜æ˜¯å¾ˆæ¸…å¥‡çš„ï¼Œç±»ä¼¼æ‹‰æ‹‰é“¾çš„è¿‡ç¨‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">connect</span><span class="params">(Node root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root ==<span class="keyword">null</span> ||root.left==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    }</span><br><span class="line">    Node left=root.left;</span><br><span class="line">    Node right=root.right;</span><br><span class="line">    <span class="comment">//æœ‰çš„åƒæ‹‰æ‹‰é“¾çš„è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">while</span>(left!=<span class="keyword">null</span>){</span><br><span class="line">        left.next=right;</span><br><span class="line">        left=left.right;</span><br><span class="line">        right=right.left;</span><br><span class="line">    }</span><br><span class="line">    connect(root.left);</span><br><span class="line">    connect(root.right);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="450-åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹"><a href="#450-åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹" class="headerlink" title="450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/delete-node-in-a-bst/" target="_blank" rel="noopener">450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªå€¼ keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„ key å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›äºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤èŠ‚ç‚¹å¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li><p>é¦–å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼›</p></li><li><p>å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ é™¤å®ƒã€‚</p></li></ol><p><strong>è¯´æ˜ï¼š</strong> è¦æ±‚ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(h)ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">root = [<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">7</span>]</span><br><span class="line">key = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="number">5</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">3</span>   <span class="number">6</span></span><br><span class="line"> / \   \</span><br><span class="line"><span class="number">2</span>   <span class="number">4</span>   <span class="number">7</span></span><br><span class="line"></span><br><span class="line">ç»™å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹å€¼æ˜¯ <span class="number">3</span>ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ° <span class="number">3</span> è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤å®ƒã€‚</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ [<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">7</span>], å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</span><br><span class="line"></span><br><span class="line">    <span class="number">5</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">4</span>   <span class="number">6</span></span><br><span class="line"> /     \</span><br><span class="line"><span class="number">2</span>       <span class="number">7</span></span><br><span class="line"></span><br><span class="line">å¦ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆæ˜¯ [<span class="number">5</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="keyword">null</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">7</span>]ã€‚</span><br><span class="line"></span><br><span class="line">    <span class="number">5</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">6</span></span><br><span class="line">   \   \</span><br><span class="line">    <span class="number">4</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ›´å¤šè§£é‡Šçœ‹å¦ä¸€ç¯‡ <a href="http://imlgw.top/2019/11/08/er-fen-sou-suo-shu/#%E5%88%A0%E9%99%A4%E4%BB%BB%E6%84%8F%E5%80%BC">äºŒå‰æœç´¢æ ‘</a></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">deleteNode</span><span class="params">(TreeNode root, <span class="keyword">int</span> key)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root ==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;           </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (root.val>key) {</span><br><span class="line">        root.left=deleteNode(root.left,key);</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (root.val<key) {< span><br><span class="line">        root.right=deleteNode(root.right,key);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="keyword">if</span> (root.left==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> root.right;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (root.right==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> root.left;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ç”¨å³å­æ ‘çš„æœ€å°å€¼å¡«è¡¥åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">        TreeNode delNode=root;</span><br><span class="line">        root=getMin(root.right);</span><br><span class="line">        <span class="comment">//ä¸‹é¢çš„leftå’Œrightä¸èƒ½äº¤æ¢,è¿˜å¥½åˆšå¼€å§‹å†™é”™äº†ä¸€æ³¢,ä¸ç„¶ä¹Ÿä¸ä¼šå‘ç°,å“ˆå“ˆå•Šå“ˆå“ˆå“ˆ</span></span><br><span class="line">        <span class="comment">//è¿™é‡Œçš„deleteMinæ˜¯ä¸ºäº†åˆ é™¤delNodeçš„æœ€å°å€¼root,å¦‚æœä½ å…ˆæŠŠdelNode.leftè¿æ¥åˆ°äº†root.left</span></span><br><span class="line">        <span class="comment">//é‚£ä¹ˆrootå°±ä¸å†æ˜¯æœ€å°å€¼äº†,å†è¿›è¡ŒdeleteMinå°±ä¼šå¯¼è‡´rootæ— æ³•åˆ é™¤,æœ€åè¿”å›root,å¯¼è‡´root.right=rootå½¢æˆç¯</span></span><br><span class="line">        <span class="comment">//ç»“æœæ— æ³•æ‰“å°</span></span><br><span class="line">        root.right=deleteMin(delNode.right);</span><br><span class="line">        root.left=delNode.left;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">deleteMin</span><span class="params">(TreeNode node)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node.left==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> node.right;</span><br><span class="line">    }</span><br><span class="line">    node.left=deleteMin(node.left);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">getMin</span><span class="params">(TreeNode node)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node.left==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> getMin(node.left);</span><br><span class="line">}</span><br></key)></span></pre></td></tr></tbody></table></figure></div><h2 id="701-äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ"><a href="#701-äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ" class="headerlink" title="701. äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ"></a><a href="https://leetcode-cn.com/problems/insert-into-a-binary-search-tree/" target="_blank" rel="noopener">701. äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ</a></h2><p>ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹å’Œè¦æ’å…¥æ ‘ä¸­çš„å€¼ï¼Œå°†å€¼æ’å…¥äºŒå‰æœç´¢æ ‘ã€‚ è¿”å›æ’å…¥åäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ ä¿è¯åŸå§‹äºŒå‰æœç´¢æ ‘ä¸­ä¸å­˜åœ¨æ–°å€¼ã€‚</p><p>æ³¨æ„ï¼Œå¯èƒ½å­˜åœ¨å¤šç§æœ‰æ•ˆçš„æ’å…¥æ–¹å¼ï¼Œåªè¦æ ‘åœ¨æ’å…¥åä»ä¿æŒä¸ºäºŒå‰æœç´¢æ ‘å³å¯ã€‚ ä½ å¯ä»¥è¿”å›ä»»æ„æœ‰æ•ˆçš„ç»“æœã€‚</p><p>ä¾‹å¦‚, </p><p>ç»™å®šäºŒå‰æœç´¢æ ‘:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="number">4</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">7</span></span><br><span class="line"> / \</span><br><span class="line"><span class="number">1</span>   <span class="number">3</span></span><br><span class="line"></span><br><span class="line">å’Œ æ’å…¥çš„å€¼: <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure></div><p>ä½ å¯ä»¥è¿”å›è¿™ä¸ªäºŒå‰æœç´¢æ ‘:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">     <span class="number">4</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">2</span>     <span class="number">7</span></span><br><span class="line"> / \   /</span><br><span class="line"><span class="number">1</span>   <span class="number">3</span> <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure></div><p>æˆ–è€…è¿™ä¸ªæ ‘ä¹Ÿæ˜¯æœ‰æ•ˆçš„:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">     <span class="number">5</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">2</span>     <span class="number">7</span></span><br><span class="line"> / \   </span><br><span class="line"><span class="number">1</span>   <span class="number">3</span></span><br><span class="line">     \</span><br><span class="line">      <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">insertIntoBST</span><span class="params">(TreeNode root, <span class="keyword">int</span> val)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TreeNode(val);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (root.val>val) {</span><br><span class="line">        root.left=insertIntoBST(root.left,val);   </span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (root.val<val) {< span><br><span class="line">        root.right=insertIntoBST(root.right,val);   </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></val)></span></pre></td></tr></tbody></table></figure></div><p>æ²¡å•¥å¥½è¯´çš„ï¼Œçœ‹ä»£ç å°±æ‡‚äº†</p><h2 id="662-äºŒå‰æ ‘æœ€å¤§å®½åº¦"><a href="#662-äºŒå‰æ ‘æœ€å¤§å®½åº¦" class="headerlink" title="662. äºŒå‰æ ‘æœ€å¤§å®½åº¦"></a><a href="https://leetcode-cn.com/problems/maximum-width-of-binary-tree/" target="_blank" rel="noopener">662. äºŒå‰æ ‘æœ€å¤§å®½åº¦</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è·å–è¿™ä¸ªæ ‘çš„æœ€å¤§å®½åº¦ã€‚æ ‘çš„å®½åº¦æ˜¯æ‰€æœ‰å±‚ä¸­çš„æœ€å¤§å®½åº¦ã€‚<strong>è¿™ä¸ªäºŒå‰æ ‘ä¸æ»¡äºŒå‰æ ‘ï¼ˆfull binary treeï¼‰ç»“æ„ç›¸åŒï¼Œä½†ä¸€äº›èŠ‚ç‚¹ä¸ºç©ºã€‚</strong></p><p>æ¯ä¸€å±‚çš„å®½åº¦è¢«å®šä¹‰ä¸ºä¸¤ä¸ªç«¯ç‚¹ï¼ˆè¯¥å±‚æœ€å·¦å’Œæœ€å³çš„éç©ºèŠ‚ç‚¹ï¼Œä¸¤ç«¯ç‚¹é—´çš„nullèŠ‚ç‚¹ä¹Ÿè®¡å…¥é•¿åº¦ï¼‰ä¹‹é—´çš„é•¿åº¦ã€‚</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line"></span><br><span class="line">           <span class="number">1</span></span><br><span class="line">         /   \</span><br><span class="line">        <span class="number">3</span>     <span class="number">2</span></span><br><span class="line">       / \     \  </span><br><span class="line">      <span class="number">5</span>   <span class="number">3</span>     <span class="number">9</span> </span><br><span class="line"></span><br><span class="line">Output: <span class="number">4</span></span><br><span class="line">Explanation: The maximum width existing in the third level with the length <span class="number">4</span> (<span class="number">5</span>,<span class="number">3</span>,<span class="keyword">null</span>,<span class="number">9</span>).</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line"></span><br><span class="line">          <span class="number">1</span></span><br><span class="line">         /  </span><br><span class="line">        <span class="number">3</span>    </span><br><span class="line">       / \       </span><br><span class="line">      <span class="number">5</span>   <span class="number">3</span>     </span><br><span class="line"></span><br><span class="line">Output: <span class="number">2</span></span><br><span class="line">Explanation: The maximum width existing in the third level with the length <span class="number">2</span> (<span class="number">5</span>,<span class="number">3</span>).</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line"></span><br><span class="line">          <span class="number">1</span></span><br><span class="line">         / \</span><br><span class="line">        <span class="number">3</span>   <span class="number">2</span> </span><br><span class="line">       /        </span><br><span class="line">      <span class="number">5</span>      </span><br><span class="line"></span><br><span class="line">Output: <span class="number">2</span></span><br><span class="line">Explanation: The maximum width existing in the second level with the length <span class="number">2</span> (<span class="number">3</span>,<span class="number">2</span>).</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 4:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line"></span><br><span class="line">          <span class="number">1</span></span><br><span class="line">         / \</span><br><span class="line">        <span class="number">3</span>   <span class="number">2</span></span><br><span class="line">       /     \  </span><br><span class="line">      <span class="number">5</span>       <span class="number">9</span> </span><br><span class="line">     /         \</span><br><span class="line">    <span class="number">6</span>           <span class="number">7</span></span><br><span class="line">Output: <span class="number">8</span></span><br><span class="line">Explanation:The maximum width existing in the fourth level with the length <span class="number">8</span> (<span class="number">6</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="number">7</span>).</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Note:</strong> Answer will in the range of 32-bit signed integer.</p><p><strong>è§£æ³•ä¸€</strong></p><p>ä¸€å¼€å§‹å±…ç„¶æ²¡æƒ³åˆ°ï¼Œå“ğŸ˜è¿˜æ˜¯èœå•Š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">widthOfBinaryTree</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    Queue<treenode> queue=<span class="keyword">new</span> LinkedList<>();</treenode></span><br><span class="line">    LinkedList<integer> idxs=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">1</span>;</span><br><span class="line">    idxs.add(<span class="number">1</span>);</span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        <span class="keyword">int</span> size=queue.size();</span><br><span class="line">        <span class="keyword">while</span>(size><span class="number">0</span>){</span><br><span class="line">            TreeNode top=queue.poll();</span><br><span class="line">            <span class="keyword">int</span> index=idxs.removeFirst();</span><br><span class="line">            <span class="keyword">if</span> (top.left!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(top.left);</span><br><span class="line">                idxs.add(index*<span class="number">2</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (top.right!=<span class="keyword">null</span>) {</span><br><span class="line">                queue.add(top.right);</span><br><span class="line">                idxs.add(index*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            size--;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (idxs.size()!=<span class="number">0</span>) {</span><br><span class="line">            max=Math.max(idxs.getLast()-idxs.getFirst()+<span class="number">1</span>,max);    </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿˜æ˜¯å±‚æ¬¡éå†çš„æ€è·¯ï¼Œä¸è¿‡éœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªç´¢å¼•åˆ—è¡¨ï¼Œç”¨æ¥<strong>è®°å½•æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”åœ¨å®Œå…¨äºŒå‰æ ‘ä¸­çš„ç´¢å¼•</strong>ï¼Œè¿™ä¸ªç´¢å¼•å€¼å®Œå…¨å¯ä»¥æ ¹æ®ä¸Šä¸€å±‚çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•çš„åˆ°ï¼Œæˆ‘ä»¬åˆå§‹åŒ–å®šä¹‰æ ¹èŠ‚ç‚¹çš„indexä¸º1ï¼Œç„¶åè¿›è¡Œå±‚æ¬¡éå†è®°å½•æ¯ä¸€å±‚çš„æ¯ä¸ªèŠ‚ç‚¹çš„indexå°±okï¼Œå½“éå†å®Œä¸€å±‚ä¹‹åç»Ÿè®¡åˆ—è¡¨æœ€å·¦å’Œæœ€å³ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å·®ï¼Œè¿™ä¸ªå€¼å°±æ˜¯å½“å‰å±‚çš„å®½åº¦ï¼Œæœ€åæ±‚ä¸ªæœ€å¤§å€¼å°±okäº†ï¼Œå¾ˆå¯æƒœï¼Œçœ‹äº†ç­”æ¡ˆæ‰çŸ¥é“</p><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’ç‰ˆæœ¬</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">widthOfBinaryTree</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    dfs(root,<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">new</span> LinkedList<>());</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> max=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(TreeNode node,<span class="keyword">int</span> depth,<span class="keyword">int</span> index,List<integer> leftIdxs)</integer></span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (depth>=leftIdxs.size()) {</span><br><span class="line">        leftIdxs.add(index);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è®°å½•å½“å‰èŠ‚ç‚¹å’Œå½“å‰å±‚æœ€å·¦èŠ‚ç‚¹çš„å·®</span></span><br><span class="line">    max=Math.max(index-leftIdxs.get(depth)+<span class="number">1</span>,max);</span><br><span class="line">    dfs(node.left,depth+<span class="number">1</span>,index*<span class="number">2</span>,leftIdxs);</span><br><span class="line">    dfs(node.right,depth+<span class="number">1</span>,index*<span class="number">2</span>+<span class="number">1</span>,leftIdxs);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªç‰ˆæœ¬åœ¨ç©ºé—´å¤æ‚åº¦å¯èƒ½ä¼šä½ä¸€ç‚¹ï¼Œlistä¸­åªå­˜æ¯ä¸ªå±‚æœ€å·¦çš„èŠ‚ç‚¹ï¼Œå½“æ·±åº¦å¤§äºç­‰äºlistçš„é•¿åº¦æ—¶å€™è¯´æ˜å½“å‰èŠ‚ç‚¹ä¸€å®šæ˜¯æ–°ä¸€å±‚çš„æœ€å·¦èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™æ·»åŠ è¿›å»å°±okï¼Œç„¶åæ±‚æ¯ä¸ªèŠ‚ç‚¹å’Œå½“å‰å±‚æœ€å·¦çš„èŠ‚ç‚¹indexå·®å€¼å°±æœ€åæ›´æ–°æœ€å¤§å€¼å°±okï¼Œè¿™ä¸ªè§£æ³•è¿˜æ˜¯æ²¡æœ‰é‚£ä¹ˆè‡ªç„¶ï¼Œè¿˜æ˜¯ä¸Šé¢çš„BFSå¥½ç†è§£ä¸€ç‚¹</p><h2 id="938-äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ"><a href="#938-äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ" class="headerlink" title="938. äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ"></a><a href="https://leetcode-cn.com/problems/range-sum-of-bst/" target="_blank" rel="noopener">938. äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ</a></h2><p>ç»™å®šäºŒå‰æœç´¢æ ‘çš„æ ¹ç»“ç‚¹ rootï¼Œè¿”å› L å’Œ Rï¼ˆå«ï¼‰ä¹‹é—´çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼çš„å’Œã€‚</p><p>äºŒå‰æœç´¢æ ‘ä¿è¯å…·æœ‰å”¯ä¸€çš„å€¼ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [<span class="number">10</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="keyword">null</span>,<span class="number">18</span>], L = <span class="number">7</span>, R = <span class="number">15</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">32</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot = [<span class="number">10</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">18</span>,<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">6</span>], L = <span class="number">6</span>, R = <span class="number">10</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">23</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li>æ ‘ä¸­çš„ç»“ç‚¹æ•°é‡æœ€å¤šä¸º 10000 ä¸ªã€‚</li><li>æœ€ç»ˆçš„ç­”æ¡ˆä¿è¯å°äº 2^31</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>è¿˜è¡Œï¼Œè¿™é¢˜ååº”è¿‡æ¥äº†ï¼Œä¸­åºéå†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rangeSumBST</span><span class="params">(TreeNode root, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>{</span><br><span class="line">    preorder(root,L,R);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preorder</span><span class="params">(TreeNode root, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    rangeSumBST(root.left,L,R);</span><br><span class="line">    <span class="keyword">if</span> (root.val>=L && root.val<=R) {</span><br><span class="line">        sum+=root.val;</span><br><span class="line">    }</span><br><span class="line">    rangeSumBST(root.right,L,R);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="617-åˆå¹¶äºŒå‰æ ‘"><a href="#617-åˆå¹¶äºŒå‰æ ‘" class="headerlink" title="617. åˆå¹¶äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/merge-two-binary-trees/" target="_blank" rel="noopener">617. åˆå¹¶äºŒå‰æ ‘</a></h2><p>ç»™å®šä¸¤ä¸ªäºŒå‰æ ‘ï¼Œæƒ³è±¡å½“ä½ å°†å®ƒä»¬ä¸­çš„ä¸€ä¸ªè¦†ç›–åˆ°å¦ä¸€ä¸ªä¸Šæ—¶ï¼Œä¸¤ä¸ªäºŒå‰æ ‘çš„ä¸€äº›èŠ‚ç‚¹ä¾¿ä¼šé‡å ã€‚</p><p>ä½ éœ€è¦å°†ä»–ä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„äºŒå‰æ ‘ã€‚åˆå¹¶çš„è§„åˆ™æ˜¯å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹é‡å ï¼Œé‚£ä¹ˆå°†ä»–ä»¬çš„å€¼ç›¸åŠ ä½œä¸ºèŠ‚ç‚¹åˆå¹¶åçš„æ–°å€¼ï¼Œå¦åˆ™ä¸ä¸º NULL çš„èŠ‚ç‚¹å°†ç›´æ¥ä½œä¸ºæ–°äºŒå‰æ ‘çš„èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">Tree <span class="number">1</span>                     Tree <span class="number">2</span>                  </span><br><span class="line">          <span class="number">1</span>                         <span class="number">2</span>                             </span><br><span class="line">         / \                       / \                            </span><br><span class="line">        <span class="number">3</span>   <span class="number">2</span>                     <span class="number">1</span>   <span class="number">3</span>                        </span><br><span class="line">       /                           \   \                      </span><br><span class="line">      <span class="number">5</span>                             <span class="number">4</span>   <span class="number">7</span>                  </span><br><span class="line">è¾“å‡º: </span><br><span class="line">åˆå¹¶åçš„æ ‘:</span><br><span class="line">     <span class="number">3</span></span><br><span class="line">    / \</span><br><span class="line">   <span class="number">4</span>   <span class="number">5</span></span><br><span class="line">  / \   \ </span><br><span class="line"> <span class="number">5</span>   <span class="number">4</span>   <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong> åˆå¹¶å¿…é¡»ä»ä¸¤ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">mergeTrees</span><span class="params">(TreeNode t1, TreeNode t2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (t2==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>  t1;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (t1==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> t2;</span><br><span class="line">    }</span><br><span class="line">    t1.val+=t2.val;</span><br><span class="line">    t1.left=mergeTrees(t1.left,t2.left);</span><br><span class="line">    t1.right=mergeTrees(t1.right,t2.right);</span><br><span class="line">    <span class="keyword">return</span> t1;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="543-äºŒå‰æ ‘çš„ç›´å¾„"><a href="#543-äºŒå‰æ ‘çš„ç›´å¾„" class="headerlink" title="543. äºŒå‰æ ‘çš„ç›´å¾„"></a><a href="https://leetcode-cn.com/problems/diameter-of-binary-tree/" target="_blank" rel="noopener">543. äºŒå‰æ ‘çš„ç›´å¾„</a></h2><p>ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œä½ éœ€è¦è®¡ç®—å®ƒçš„ç›´å¾„é•¿åº¦ã€‚ä¸€æ£µäºŒå‰æ ‘çš„ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹è·¯å¾„é•¿åº¦ä¸­çš„æœ€å¤§å€¼ã€‚è¿™æ¡è·¯å¾„å¯èƒ½ç©¿è¿‡æ ¹ç»“ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ :</strong><br>ç»™å®šäºŒå‰æ ‘</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">    <span class="number">1</span></span><br><span class="line">   / \</span><br><span class="line">  <span class="number">2</span>   <span class="number">3</span></span><br><span class="line"> / \     </span><br><span class="line"><span class="number">4</span>   <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å› 3, å®ƒçš„é•¿åº¦æ˜¯è·¯å¾„ [4,2,1,3] æˆ–è€… [5,2,1,3]ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ä¸¤ç»“ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦æ˜¯ä»¥å®ƒä»¬ä¹‹é—´è¾¹çš„æ•°ç›®è¡¨ç¤º</p><p><strong>è§£æ³•ä¸€</strong></p><p>æ ‘çš„é¢˜ç›®åšå¤šäº†ï¼Œå‘ç°å…¶å®ä¹Ÿå°±å‡ ç§é¢˜å‹ï¼Œéƒ½å¾ˆç†Ÿæ‚‰ï¼Œè¿™é¢˜å°±å’Œä¸Šé¢çš„ <a href>äºŒå‰æ ‘çš„å¡åº¦</a> ï¼Œ<a href>å¹³è¡¡äºŒå‰æ ‘</a> å¾ˆç±»ä¼¼ï¼Œè¿™é¢˜éœ€è¦æ³¨æ„<strong>ç›´å¾„ä¸ä¸€å®šè¿‡æ ¹èŠ‚ç‚¹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> max=Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">diameterOfBinaryTree</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    hight(root);</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hight</span><span class="params">(TreeNode node)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (node==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left=hight(node.left);</span><br><span class="line">    <span class="keyword">int</span> right=hight(node.right);</span><br><span class="line">    max=Math.max(left+right,max);</span><br><span class="line">    <span class="keyword">return</span> Math.max(left,right)+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œå…ˆå†™äº†ä¸ªæš´åŠ›çš„åµŒå¥—é€’å½’ğŸ˜‚ï¼Œä»£ç ç¡®å®ç®€ä»‹ï¼Œéš¾é“è¿™å°±æ˜¯æš´åŠ›ç¾å­¦ä¹ˆï¼Œiäº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">diameterOfBinaryTree</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> root==<span class="keyword">null</span>?<span class="number">0</span>:Math.max(hight(root.left)+hight(root.right),Math.max(diameterOfBinaryTree(root.right),diameterOfBinaryTree(root.left)));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hight</span><span class="params">(TreeNode node)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> node==<span class="keyword">null</span>?<span class="number">0</span>:Math.max(hight(node.left),hight(node.right))+<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="530-äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®"><a href="#530-äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®" class="headerlink" title="530. äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®"></a><a href="https://leetcode-cn.com/problems/minimum-absolute-difference-in-bst/" target="_blank" rel="noopener">530. äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®</a></h2><p>ç»™å®šä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹ä¸ºéè´Ÿå€¼çš„äºŒå‰æœç´¢æ ‘ï¼Œæ±‚æ ‘ä¸­ä»»æ„ä¸¤èŠ‚ç‚¹çš„å·®çš„ç»å¯¹å€¼çš„æœ€å°å€¼ã€‚</p><p><strong>ç¤ºä¾‹ :</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span></span><br><span class="line">    \</span><br><span class="line">     <span class="number">3</span></span><br><span class="line">    /</span><br><span class="line">   <span class="number">2</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">æœ€å°ç»å¯¹å·®ä¸º<span class="number">1</span>ï¼Œå…¶ä¸­ <span class="number">2</span> å’Œ <span class="number">1</span> çš„å·®çš„ç»å¯¹å€¼ä¸º <span class="number">1</span>ï¼ˆæˆ–è€… <span class="number">2</span> å’Œ <span class="number">3</span>ï¼‰ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong> æ ‘ä¸­è‡³å°‘æœ‰2ä¸ªèŠ‚ç‚¹ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>å¾ˆå¯æƒœï¼Œè¿™é¢˜è¿˜WAäº†ä¸€æ¬¡ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMinimumDifference</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    Stack<treenode> stack=<span class="keyword">new</span> Stack<>();</treenode></span><br><span class="line">    TreeNode cur=root;</span><br><span class="line">    <span class="keyword">int</span> diff=Integer.MAX_VALUE,last=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty() || cur!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">            stack.push(cur);</span><br><span class="line">            cur=cur.left;</span><br><span class="line">        }</span><br><span class="line">        cur=stack.pop();</span><br><span class="line">        <span class="keyword">if</span> (last!=-<span class="number">1</span>) {</span><br><span class="line">            diff=Math.min(diff,Math.abs(last-cur.val));   </span><br><span class="line">        }</span><br><span class="line">        last=cur.val;</span><br><span class="line">        cur=cur.right;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> diff;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’çš„æ–¹å¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> diff = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> last = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMinimumDifference</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    inorder(root);</span><br><span class="line">    <span class="keyword">return</span> diff;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inorder</span><span class="params">(TreeNode root)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    inorder(root.left);</span><br><span class="line">    diff = last==-<span class="number">1</span>?diff:Math.min(diff,Math.abs(last-root.val));</span><br><span class="line">    last = root.val;</span><br><span class="line">    inorder(root.right);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeå›æº¯&amp;é€’å½’</title>
      <link href="/2019/10/10/leetcode-hui-su/"/>
      <url>/2019/10/10/leetcode-hui-su/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="17-ç”µè¯å·ç çš„å­—æ¯ç»„åˆ"><a href="#17-ç”µè¯å·ç çš„å­—æ¯ç»„åˆ" class="headerlink" title="17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ"></a><a href="https://leetcode-cn.com/problems/letter-combinations-of-a-phone-number/" target="_blank" rel="noopener">17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ</a></h2><p>ç»™å®šä¸€ä¸ªä»…åŒ…å«æ•°å­— <code>2-9</code> çš„å­—ç¬¦ä¸²ï¼Œè¿”å›æ‰€æœ‰å®ƒèƒ½è¡¨ç¤ºçš„å­—æ¯ç»„åˆã€‚</p><p>ç»™å‡ºæ•°å­—åˆ°å­—æ¯çš„æ˜ å°„å¦‚ä¸‹ï¼ˆä¸ç”µè¯æŒ‰é”®ç›¸åŒï¼‰æ³¨æ„ 1 ä¸å¯¹åº”ä»»ä½•å­—æ¯</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191012/Ro4wr1dv5pR7.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"23"</span></span><br><span class="line">è¾“å‡ºï¼š[<span class="string">"ad"</span>, <span class="string">"ae"</span>, <span class="string">"af"</span>, <span class="string">"bd"</span>, <span class="string">"be"</span>, <span class="string">"bf"</span>, <span class="string">"cd"</span>, <span class="string">"ce"</span>, <span class="string">"cf"</span>].</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong><br>å°½ç®¡ä¸Šé¢çš„ç­”æ¡ˆæ˜¯æŒ‰å­—å…¸åºæ’åˆ—çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥ä»»æ„é€‰æ‹©ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String[] letter={<span class="string">" "</span>,<span class="string">""</span>,<span class="string">"abc"</span>,<span class="string">"def"</span>,<span class="string">"ghi"</span>,<span class="string">"jkl"</span>,<span class="string">"mno"</span>,<span class="string">"pqrs"</span>,<span class="string">"tuv"</span>,<span class="string">"wxyz"</span>};</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<string> res=<span class="keyword">new</span> LinkedList<>();</string></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">letterCombinations</span><span class="params">(String digits)</span> </string></span>{</span><br><span class="line">    <span class="comment">//ç©ºå­—ç¬¦ä¸²è¦æ³¨æ„</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">""</span>.equals(digits)) <span class="keyword">return</span> res;</span><br><span class="line">    letterCombinations(digits,<span class="number">0</span>,<span class="string">""</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">letterCombinations</span><span class="params">(String digits,<span class="keyword">int</span> index,String str)</span> </span>{</span><br><span class="line">    <span class="comment">//é€’å½’å‡ºå£,å½“index==digitsçš„é•¿åº¦çš„æ—¶å€™å°±è¯´æ˜èµ°åˆ°å°½å¤´äº†</span></span><br><span class="line">    <span class="comment">//éœ€è¦å›å¤´å°è¯•å…¶ä»–çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> (index==digits.length()) {</span><br><span class="line">        res.add(str);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å½“å‰å­—ç¬¦å¯¹åº”çš„å­—æ¯ç»„åˆ</span></span><br><span class="line">    <span class="keyword">char</span>[] ls=letter[digits.charAt(index)-<span class="number">48</span>].toCharArray();</span><br><span class="line">    <span class="comment">//éå†æ¯ç§å¯èƒ½,å…¶å®å°±æ˜¯DFS</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<ls.length;i++) {< span><br><span class="line">        letterCombinations(digits,index+<span class="number">1</span>,str+ls[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br></ls.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å¯æƒ³è€ŒçŸ¥ï¼Œè¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ç›¸å½“é«˜ï¼Œ<code>3^N * 4^M = O(2^N)</code> Mæ˜¯èƒ½è¡¨ç¤º3ä¸ªå­—ç¬¦çš„æ•°å­—ä¸ªæ•°ï¼ŒNæ˜¯è¡¨ç¤º4ä¸ªå­—ç¬¦çš„æ•°å­—ä¸ªæ•°ï¼ŒæŒ‡æ•°çº§åˆ«çš„ç®—æ³•ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å…¶ä»–åˆ«çš„æ¯”è¾ƒå¥½çš„ç®—æ³•äº†</p><h2 id="93-å¤åŸIPåœ°å€"><a href="#93-å¤åŸIPåœ°å€" class="headerlink" title="93. å¤åŸIPåœ°å€"></a><a href="https://leetcode-cn.com/problems/restore-ip-addresses/" target="_blank" rel="noopener">93. å¤åŸIPåœ°å€</a></h2><p>ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„å­—ç¬¦ä¸²ï¼Œå¤åŸå®ƒå¹¶è¿”å›æ‰€æœ‰å¯èƒ½çš„ IP åœ°å€æ ¼å¼ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"25525511135"</span></span><br><span class="line">è¾“å‡º: [<span class="string">"255.255.11.135"</span>, <span class="string">"255.255.111.35"</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å…¶å®è¿˜æ˜¯æœ‰ä¸€ä¸ªå¤§è‡´çš„æ€è·¯ï¼Œä½†æ˜¯æ²¡å†™å‡ºæ¥ï¼Œå¾ˆå¤šç»†èŠ‚ä¸çŸ¥é“å’‹å¤„ç†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">restoreIpAddresses</span><span class="params">(String s)</span> </string></span>{</span><br><span class="line">    restoreIpAddresses(s,<span class="number">0</span>,<span class="string">""</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">LinkedList<string> res=<span class="keyword">new</span> LinkedList<>();</string></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restoreIpAddresses</span><span class="params">(String s,<span class="keyword">int</span> index,String des,<span class="keyword">int</span> count)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (count><span class="number">4</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//åˆ°å­—ç¬¦ä¸²æœ«å°¾äº†</span></span><br><span class="line">    <span class="keyword">if</span> (index==s.length()) {</span><br><span class="line">        <span class="keyword">if</span> (count==<span class="number">4</span>) {</span><br><span class="line">            res.add(des.substring(<span class="number">0</span>,des.length()-<span class="number">1</span>));    </span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¦‚æœä¸º0å°±ä¸ç”¨åˆ‡åˆ†äº†,è¿™é‡Œå°±ç›¸å½“äºç›´æ¥è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (s.charAt(index)==<span class="string">'0'</span>) {</span><br><span class="line">        restoreIpAddresses(s,index+<span class="number">1</span>,des+<span class="string">"0."</span>,count+<span class="number">1</span>);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="comment">//ä¸ä¸º0å°±éœ€è¦ç»§ç»­åˆ‡åˆ†ä¸º1ï¼Œ2ï¼Œ3</span></span><br><span class="line">        <span class="comment">//åˆ‡åˆ†è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„è¦å°äº255,åŒæ—¶éœ€è¦ä¸€ä¸ªè®¡æ•°å™¨æ¥åˆ¤åº¦æ˜¯å¦ç»ˆæ­¢</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<<span class="number">4</span>;i++) {</span><br><span class="line">            <span class="keyword">if</span> (index+i<=s.length()) {</span><br><span class="line">                String temp=s.substring(index,index+i);</span><br><span class="line">                <span class="keyword">if</span> (Integer.valueOf(temp)<=<span class="number">255</span>){</span><br><span class="line">                    restoreIpAddresses(s,index+i,des+temp+<span class="string">"."</span>,count+<span class="number">1</span>);    </span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="131-åˆ†å‰²å›æ–‡ä¸²"><a href="#131-åˆ†å‰²å›æ–‡ä¸²" class="headerlink" title="131. åˆ†å‰²å›æ–‡ä¸²"></a><a href="https://leetcode-cn.com/problems/palindrome-partitioning/" target="_blank" rel="noopener">131. åˆ†å‰²å›æ–‡ä¸²</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œå°† s åˆ†å‰²æˆä¸€äº›å­ä¸²ï¼Œä½¿æ¯ä¸ªå­ä¸²éƒ½æ˜¯å›æ–‡ä¸²ã€‚</p><p>è¿”å› s æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"aab"</span></span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [<span class="string">"aa"</span>,<span class="string">"b"</span>],</span><br><span class="line">  [<span class="string">"a"</span>,<span class="string">"a"</span>,<span class="string">"b"</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ€»ç®—è‡ªå·±å®Œæ•´åšäº†ä¸€é¢˜å‡ºæ¥äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<string>> partition(String s) {</list<string></span><br><span class="line">    partition(s,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}   </span><br><span class="line"></span><br><span class="line">List<list<string>> res=<span class="keyword">new</span> ArrayList<>();</list<string></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">partition</span><span class="params">(String s,<span class="keyword">int</span> index,List<string> lis)</string></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index==s.length()) {</span><br><span class="line">        <span class="comment">//æ³¨æ„è¿™é‡Œè¦copyä¸€ä¸ªlistä¸èƒ½ç›´æ¥æ·»åŠ lis</span></span><br><span class="line">        <span class="comment">//liså¼•ç”¨çš„å¯¹è±¡åé¢è¿˜ä¼šç»§ç»­å˜åŒ–ï¼Œæœ€åä¼šå˜ä¸ºnull</span></span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index+<span class="number">1</span>;i<=s.length();i++) {</span><br><span class="line">        String temp=s.substring(index,i);</span><br><span class="line">        <span class="comment">//System.out.println(index+"="+i+"="+temp);</span></span><br><span class="line">        <span class="keyword">if</span> (isPalind(temp)) {</span><br><span class="line">            lis.add(temp);</span><br><span class="line">            partition(s,i,lis);</span><br><span class="line">            <span class="comment">//ä¸èƒ½ç›´æ¥remove(temp),ä¸»è¦æ˜¯ä¼šæœ‰é‡å¤çš„å­—ç¬¦,æ‰€ä»¥ä¼šå¯¼è‡´æœ€åçš„é¡ºåºä¸ä¸€è‡´,è€Œä¸”æ•ˆç‡ä¹Ÿå¾ˆä½</span></span><br><span class="line">            <span class="comment">//lis.remove(temp);</span></span><br><span class="line">            lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalind</span><span class="params">(String s)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>,j=s.length()-<span class="number">1</span>;i<=j;i++,j--) {</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i)!=s.charAt(j)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>4msï¼Œ93%ï¼Œå…¶å®å°±æ˜¯æš´åŠ›å›æº¯ï¼Œè¿˜æ˜¯æŒºç®€å•çš„ï¼Œä¸€å¼€å§‹å¿˜äº†<code>remove()</code>ï¼Œç›´æ¥æŠŠæ‰€æœ‰ç»“æœæ‰“å‡ºæ¥äº†ï¼Œ ç„¶åä¸€ç›´åœ¨æƒ³æ€ä¹ˆè°ƒæ•´é€’å½’çš„ç»“æ„ã€‚ã€‚ã€‚DFSåŸºæœ¬çš„å¥—è·¯éƒ½å¿˜äº†ğŸ˜‚</p><h2 id="46-å…¨æ’åˆ—"><a href="#46-å…¨æ’åˆ—" class="headerlink" title="46. å…¨æ’åˆ—"></a><a href="https://leetcode-cn.com/problems/permutations/" target="_blank" rel="noopener">46. å…¨æ’åˆ—</a></h2><p>ç»™å®šä¸€ä¸ª<strong>æ²¡æœ‰é‡å¤</strong>æ•°å­—çš„åºåˆ—ï¼Œè¿”å›å…¶æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>ç»å…¸çš„å…¨æ’åˆ—é—®é¢˜ï¼Œç†Ÿæ‚‰äº†DFSå¥—è·¯ä¹‹åéƒ½æŒºç®€å•çš„ï¼Œæ³¨æ„å›æº¯å°±è¡Œäº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> permute(<span class="keyword">int</span>[] nums) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[nums.length];</span><br><span class="line">    permute(nums,<span class="keyword">new</span> ArrayList(),visit);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">permute</span><span class="params">(<span class="keyword">int</span>[] nums,List<integer> lis,<span class="keyword">boolean</span>[] visit)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (lis.size()==nums.length) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (visit[i]) <span class="keyword">continue</span>;</span><br><span class="line">        lis.add(nums[i]);</span><br><span class="line">        visit[i]=<span class="keyword">true</span>;</span><br><span class="line">        permute(nums,lis,visit);</span><br><span class="line">        <span class="comment">//å›æº¯</span></span><br><span class="line">        visit[i]=<span class="keyword">false</span>;</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="60-ç¬¬kä¸ªæ’åˆ—"><a href="#60-ç¬¬kä¸ªæ’åˆ—" class="headerlink" title="60. ç¬¬kä¸ªæ’åˆ—"></a><a href="https://leetcode-cn.com/problems/permutation-sequence/" target="_blank" rel="noopener">60. ç¬¬kä¸ªæ’åˆ—</a></h2><p>ç»™å‡ºé›†åˆ [1,2,3,â€¦,n]ï¼Œå…¶æ‰€æœ‰å…ƒç´ å…±æœ‰ n! ç§æ’åˆ—ã€‚</p><p>æŒ‰å¤§å°é¡ºåºåˆ—å‡ºæ‰€æœ‰æ’åˆ—æƒ…å†µï¼Œå¹¶ä¸€ä¸€æ ‡è®°ï¼Œå½“ n = 3 æ—¶, æ‰€æœ‰æ’åˆ—å¦‚ä¸‹ï¼š</p><ol><li><code>"123"</code></li><li><code>"132"</code></li><li><code>"213"</code></li><li><code>"231"</code></li><li><code>"312"</code></li><li><code>"321"</code></li></ol><p>ç»™å®š n å’Œ kï¼Œè¿”å›ç¬¬ k ä¸ªæ’åˆ—ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>ç»™å®š n çš„èŒƒå›´æ˜¯ [1, 9]ã€‚</li><li>ç»™å®š k çš„èŒƒå›´æ˜¯[1,  n!]ã€‚</li></ul><p>*<em>ç¤ºä¾‹ 1: *</em></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: n = <span class="number">3</span>, k = <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="string">"213"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: n = <span class="number">4</span>, k = <span class="number">9</span></span><br><span class="line">è¾“å‡º: <span class="string">"2314"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPermutation</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[n+<span class="number">1</span>];</span><br><span class="line">    getPermutation(n,k,<span class="number">0</span>,visit,<span class="keyword">new</span> StringBuilder(<span class="string">""</span>));</span><br><span class="line">    <span class="keyword">return</span> res.get(k-<span class="number">1</span>).toString();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<stringbuilder> res=<span class="keyword">new</span> LinkedList<>();</stringbuilder></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getPermutation</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> k,<span class="keyword">int</span> count,<span class="keyword">boolean</span>[] visit,StringBuilder str)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (count == n) {</span><br><span class="line">        res.add(<span class="keyword">new</span> StringBuilder(str));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (res.size()==k) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=n;i++) {</span><br><span class="line">        <span class="keyword">if</span> (!visit[i]) {</span><br><span class="line">            str.append(i);</span><br><span class="line">            visit[i]=<span class="keyword">true</span>;</span><br><span class="line">            getPermutation(n,k,count+<span class="number">1</span>,visit,str);</span><br><span class="line">            visit[i]=<span class="keyword">false</span>;</span><br><span class="line">            str.delete(str.length()-<span class="number">1</span>,str.length());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¶ç„¶å‘ç°è¿™ä¸€é¢˜å¹¶æ²¡æœ‰è®°å½•ï¼Œä¹‹å‰æ²¡æœ‰è®°å½•çš„åŸå› è‚¯å®šæ˜¯å› ä¸ºæ–¹æ³•å¤ªåƒåœ¾äº†ï¼Œè¿™é¢˜æœ€ä¼˜è§£æ˜¯ <code>åº·æ‰˜å±•å¼€</code>ï¼Œè¯´å®è¯ï¼Œæš‚æ—¶å¹¶ä¸æƒ³å»äº†è§£ğŸ˜‚ï¼Œåé¢æœ‰æ—¶é—´å†è¯´å§</p><h2 id="47-å…¨æ’åˆ—-II"><a href="#47-å…¨æ’åˆ—-II" class="headerlink" title="47. å…¨æ’åˆ— II"></a><a href="https://leetcode-cn.com/problems/permutations-ii/" target="_blank" rel="noopener">47. å…¨æ’åˆ— II</a></h2><p>ç»™å®šä¸€ä¸ªå¯åŒ…å«é‡å¤æ•°å­—çš„åºåˆ—ï¼Œè¿”å›æ‰€æœ‰ä¸é‡å¤çš„å…¨æ’åˆ—ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å¼€å§‹æˆ‘å¾ˆçº ç»“è¿™é¢˜ï¼Œåæ¥æƒ³é€šäº†ï¼Œå…¶å®å°±æ˜¯å»é‡ï¼Œé‡åˆ°å·²ç»å­˜åœ¨äºç»“æœä¸­ç›¸åŒçš„å…ƒç´ å°±ç›´æ¥è·³è¿‡å°±è¡Œäº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> permuteUnique(<span class="keyword">int</span>[] nums) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//Arrays.sort(nums); è§£æ³•äºŒéœ€è¦å…ˆæ’åº</span></span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[nums.length];</span><br><span class="line">    permuteUnique(nums,<span class="keyword">new</span> ArrayList(),visit);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">permuteUnique</span><span class="params">(<span class="keyword">int</span>[] nums,List<integer> lis,<span class="keyword">boolean</span>[] visit)</integer></span></span>{</span><br><span class="line">    HashSet<integer> set=<span class="keyword">new</span> HashSet<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (lis.size()==nums.length) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!visit[i] && !set.contains(nums[i])) {</span><br><span class="line">            lis.add(nums[i]);</span><br><span class="line">            visit[i]=<span class="keyword">true</span>;</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            permuteUnique(nums,lis,visit);</span><br><span class="line">            visit[i]=<span class="keyword">false</span>;</span><br><span class="line">            lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//éœ€è¦æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">permuteUnique2</span><span class="params">(<span class="keyword">int</span>[] nums,List<integer> lis,<span class="keyword">boolean</span>[] visit)</integer></span></span>{</span><br><span class="line">    <span class="keyword">if</span> (lis.size()==nums.length) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//å‰ªæå»é‡ï¼Œå’Œå‰ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒ</span></span><br><span class="line">        <span class="comment">//Bugè­¦å‘Šï¼Œåº”è¯¥å†™!visit[i-1]</span></span><br><span class="line">        <span class="keyword">if</span> (i><span class="number">0</span>&&nums[i]==nums[i-<span class="number">1</span>] && !visit[i-<span class="number">1</span>]) </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (!visit[i]) {</span><br><span class="line">            lis.add(nums[i]);</span><br><span class="line">            visit[i]=<span class="keyword">true</span>;</span><br><span class="line">            permuteUnique2(nums,lis,visit);</span><br><span class="line">            visit[i]=<span class="keyword">false</span>;</span><br><span class="line">            lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…³äºå»é‡çš„æ–¹å¼ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ä»å›æº¯çš„<strong>æ ¹èŠ‚ç‚¹</strong>æ¥è€ƒè™‘ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è€ƒè™‘æœ€é¡¶å±‚çš„ã€<strong>1ï¼Œ1ï¼Œ2</strong>ã€‘çš„éå†æƒ…å†µï¼Œæ¯ä¸€æ¬¡éå†å®é™…ä¸Šéƒ½æ˜¯åœ¨æ‰¾<strong>ä»¥å½“å‰å…ƒç´ å¼€å¤´çš„æ’åˆ—</strong>ï¼Œå½“ç¬¬ä¸€æ¬¡å·²ç»éå†å®Œ1å¼€å¤´çš„æ‰€ä»¥æ’åˆ—åï¼Œåé¢çš„å¾ªç¯å†ç¢°åˆ°1è‡ªç„¶å°±å¯ä»¥ç›´æ¥è·³è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡éå†ä¸­ç”¨HashMapæ¥å»é‡ï¼Œæ¥ä¿è¯ä¸€æ¬¡å¾ªç¯ä¸­ä¸ä¼šæœ‰é‡å¤çš„å…ƒç´ è¢«é€‰å–ï¼Œå…¶å®ä¹Ÿåªæœ‰è¿™é¢˜å¯ä»¥ç”¨HashSetï¼Œå› ä¸ºè¿™é‡Œæ’åˆ—æ˜¯è®²ç©¶é¡ºåºçš„ï¼Œå¾ªåºå®Œå…¨ä¸€æ ·æ‰æ˜¯é‡å¤ï¼Œåé¢çš„é¢˜éƒ½æ˜¯ä¸è®²ç©¶é¡ºåºçš„ï¼Œéƒ½éœ€è¦æ’åºæ‰èƒ½å»é‡ï¼Œå…·ä½“åé¢å†åˆ†æ</p><blockquote><p>æˆ‘é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯Hashè¡¨ï¼Œè¿™é‡Œç¿»äº†ä¸‹è¯„è®ºåŒºå¥½åƒéƒ½æ˜¯ç”¨çš„ç¬¬äºŒç§æ–¹å¼å»é‡çš„ï¼Œéš¾é“ç”¨HashSetä¸å¥½ä¹ˆğŸ˜‚ï¼Œç¬¬äºŒç§å¿…é¡»è¦å…ˆæ’åºï¼Œä¿è¯ç›¸åŒçš„å…ƒç´ éƒ½èšåœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿åˆ¤æ–­ï¼Œè¿™ç§é¢˜åœ¨çº¸ä¸Šç”»ä¸€ç”»é€’å½’æ ‘å…¶å®å°±å¾ˆæ¸…æ¥šäº†</p></blockquote><h3 id="Bugè­¦å‘Š"><a href="#Bugè­¦å‘Š" class="headerlink" title="Bugè­¦å‘Š"></a>Bugè­¦å‘Š</h3><p>è¿™é‡Œ <code>!visit[i-1]</code>å’Œ <code>visit[i-1]</code>å¯¹äºè¿™é¢˜æ¥è¯´å¹¶ä¸å½±å“æ­£ç¡®æ€§ï¼Œä½†æ˜¯ä½ å¦‚æœå°†ç”Ÿæˆçš„è¿‡ç¨‹æ‰“å°å‡ºæ¥å¯¹æ¯”ä¸‹å°±çŸ¥é“ä¸ºå•¥äº†ï¼Œå…·ä½“çš„è¯·çœ‹ä¸‹é¢ <a href>1079. æ´»å­—å°åˆ·</a> çš„è§£é‡Š</p><h2 id="1286-å­—æ¯ç»„åˆè¿­ä»£å™¨"><a href="#1286-å­—æ¯ç»„åˆè¿­ä»£å™¨" class="headerlink" title="1286. å­—æ¯ç»„åˆè¿­ä»£å™¨"></a><a href="https://leetcode-cn.com/problems/iterator-for-combination/" target="_blank" rel="noopener">1286. å­—æ¯ç»„åˆè¿­ä»£å™¨</a></h2><p>è¯·ä½ è®¾è®¡ä¸€ä¸ªè¿­ä»£å™¨ç±»ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¾“å…¥å‚æ•°åŒ…æ‹¬ï¼šä¸€ä¸ª æœ‰åºä¸”å­—ç¬¦å”¯ä¸€ çš„å­—ç¬¦ä¸² charactersï¼ˆè¯¥å­—ç¬¦ä¸²åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ï¼‰å’Œä¸€ä¸ªæ•°å­— combinationLength ã€‚</li><li>å‡½æ•° next() ï¼ŒæŒ‰ å­—å…¸åº è¿”å›é•¿åº¦ä¸º combinationLength çš„ä¸‹ä¸€ä¸ªå­—æ¯ç»„åˆã€‚</li><li>å‡½æ•° hasNext() ï¼Œåªæœ‰å­˜åœ¨é•¿åº¦ä¸º combinationLength çš„ä¸‹ä¸€ä¸ªå­—æ¯ç»„åˆæ—¶ï¼Œæ‰è¿”å› Trueï¼›å¦åˆ™ï¼Œè¿”å› Falseã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">CombinationIterator iterator = <span class="keyword">new</span> CombinationIterator(<span class="string">"abc"</span>, <span class="number">2</span>); <span class="comment">// åˆ›å»ºè¿­ä»£å™¨ iterator</span></span><br><span class="line"></span><br><span class="line">iterator.next(); <span class="comment">// è¿”å› "ab"</span></span><br><span class="line">iterator.hasNext(); <span class="comment">// è¿”å› true</span></span><br><span class="line">iterator.next(); <span class="comment">// è¿”å› "ac"</span></span><br><span class="line">iterator.hasNext(); <span class="comment">// è¿”å› true</span></span><br><span class="line">iterator.next(); <span class="comment">// è¿”å› "bc"</span></span><br><span class="line">iterator.hasNext(); <span class="comment">// è¿”å› false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li>1 <= combinationLength <= characters.length <= 15</li><li>æ¯ç»„æµ‹è¯•æ•°æ®æœ€å¤šåŒ…å« 10^4 æ¬¡å‡½æ•°è°ƒç”¨ã€‚</li><li>é¢˜ç›®ä¿è¯æ¯æ¬¡è°ƒç”¨å‡½æ•° next æ—¶éƒ½å­˜åœ¨ä¸‹ä¸€ä¸ªå­—æ¯ç»„åˆã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å”‰ï¼ŒçœŸçš„èœï¼Œå¥½ä¹…æ²¡å†™å›æº¯äº†ï¼Œåˆçµ¦å¿˜äº†ï¼Œè¿™é¢˜å¼€å§‹è¢«åˆ«äººè¯¯å¯¼äº†ï¼Œä»¥ä¸ºæ˜¯ä¸‹ä¸€ä¸ªæ’åˆ—ï¼Œç„¶åå°±ä¸€ç›´åœ¨æƒ³æ€ä¹ˆå»æ±‚nextï¼Œå…¶å®æ ¹æœ¬å°±ä¸ç”¨è¿™æ ·â€¦</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> LinkedList<string> res=<span class="keyword">new</span> LinkedList<>();</string></span><br><span class="line"></span><br><span class="line"><span class="comment">//abc</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CombinationIterator</span><span class="params">(String characters, <span class="keyword">int</span> combinationLength)</span> </span>{</span><br><span class="line">    dfs(<span class="string">""</span>,combinationLength,<span class="number">0</span>,<span class="number">0</span>,characters);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> res.pollFirst();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(String cur,<span class="keyword">int</span> len,<span class="keyword">int</span> index,<span class="keyword">int</span> count,String source)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (count == len) {</span><br><span class="line">        res.add(cur); <span class="comment">//ç›´æ¥æ ¹æ®curå¾—é•¿åº¦åˆ¤æ–­å°±okäº†</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<source.length();i++) {< span><br><span class="line">        dfs(cur+source.charAt(i),len,i+<span class="number">1</span>,count+<span class="number">1</span>,source);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> !res.isEmpty();</span><br><span class="line">}</span><br></source.length();i++)></span></pre></td></tr></tbody></table></figure></div><blockquote><p>å›å¤´å¼€äº†ä¸‹ä¹‹å‰çš„ä»£ç ï¼Œå‘ç°éƒ½å†™å¾—ä¸å¥½ï¼Œå¾ˆå–œæ¬¢åŠ ä¸ªcountç»Ÿè®¡æ•°é‡ï¼Œå…¶å®ç›´æ¥æ ¹æ®curå¾—é•¿åº¦åˆ¤æ–­å°±å¯ä»¥äº†</p></blockquote><h2 id="77-ç»„åˆ"><a href="#77-ç»„åˆ" class="headerlink" title="77. ç»„åˆ"></a><a href="https://leetcode-cn.com/problems/combinations/" target="_blank" rel="noopener">77. ç»„åˆ</a></h2><p>ç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å› 1 â€¦ n ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: n = <span class="number">4</span>, k = <span class="number">2</span></span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">2</span>,<span class="number">4</span>],</span><br><span class="line">  [<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">4</span>],</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å…¶å®ä¸€å¼€å§‹æ²¡å†™å‡ºå‰ªæçš„ä»£ç ï¼Œçœ‹äº†ä¸€ç‚¹æç¤ºåæ‰å†™å‡ºäº†ä¸‹é¢çš„çš„ç¬¬ä¸€ç§å‰ªæçš„æ–¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> combine(<span class="keyword">int</span> n, <span class="keyword">int</span> k) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (k>n || n<=<span class="number">0</span> ||k<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//boolean[] visit=new boolean[n+1];</span></span><br><span class="line">    combine(n,k,<span class="number">1</span>,<span class="keyword">new</span> ArrayList(),<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}   </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‰ªæä¼˜åŒ–1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">combine</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> k,<span class="keyword">int</span> index,List<integer> lis,<span class="keyword">int</span> count)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (count==k) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//1 2 3 4 | 3</span></span><br><span class="line">    <span class="comment">//index = 3 k=3  n=4 count=0 (3ä¸ºå¤´,æ˜¾ç„¶æ˜¯ä¸è¡Œçš„,è‚¯å®šä¼šå’Œå‰é¢é‡å¤) --> 3<=3</span></span><br><span class="line">    <span class="comment">//index = 3 k=3  n=4 count=1 (3ä¸ºç¬¬äºŒä¸ª,æ˜¯å¯è¡Œçš„) --> 3 <= 2</span></span><br><span class="line">    <span class="keyword">if</span> (n-index+<span class="number">2</span><=k-count) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<=n;i++) {</span><br><span class="line">        lis.add(i);</span><br><span class="line">        combine(n,k,i+<span class="number">1</span>,lis,count+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//å›æº¯çš„å…³é”®</span></span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‰ªæä¼˜åŒ–2</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">combine4</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> k,<span class="keyword">int</span> index,List<integer> lis,<span class="keyword">int</span> count)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (count==k) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¾ªç¯çš„åŒºé—´è‡³å°‘è¦æœ‰k-countä¸ªå…ƒç´  ä¹Ÿå°±æ˜¯[i,N]ä¹‹é—´è‡³å°‘è¦æœ‰k-countä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="comment">//N-i+1>=k-count --> i<=n-(k-count)+1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<=n-(k-count)+<span class="number">1</span>;i++) {</span><br><span class="line">        lis.add(i);</span><br><span class="line">        combine4(n,k,i+<span class="number">1</span>,lis,count+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//å›æº¯çš„å…³é”®</span></span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸¾ä¸ªä¾‹å­<code>1ï¼Œ2ï¼Œ3ï¼Œ4 k=3</code>  å…¶å®åœ¨å¾ªç¯n=3çš„æ—¶å€™å°±å¯ä»¥ç»“æŸäº†ï¼Œå› ä¸ºåé¢å·²ç»æ²¡æœ‰é‚£ä¹ˆå¤šå…ƒç´ å¯ä»¥å’Œ3æ„æˆç»„åˆäº†</p><h2 id="39-ç»„åˆæ€»å’Œ"><a href="#39-ç»„åˆæ€»å’Œ" class="headerlink" title="39. ç»„åˆæ€»å’Œ"></a><a href="https://leetcode-cn.com/problems/combination-sum/" target="_blank" rel="noopener">39. ç»„åˆæ€»å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªæ— é‡å¤å…ƒç´ çš„æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆ ï¼Œ<code>candidates</code> ä¸­çš„æ•°å­—å¯ä»¥æ— é™åˆ¶é‡å¤è¢«é€‰å–</p><p>è¯´æ˜ï¼š</p><ul><li><p>æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬ targetï¼‰éƒ½æ˜¯æ­£æ•´æ•°ã€‚</p></li><li><p>è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ </p></li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: candidates = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>], target = <span class="number">7</span>,</span><br><span class="line">æ‰€æ±‚è§£é›†ä¸º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">7</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: candidates = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>], target = <span class="number">8</span>,</span><br><span class="line">æ‰€æ±‚è§£é›†ä¸º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ²¡æœ‰ä»»ä½•å‰ªæå¤„ç†çš„å›æº¯ï¼Œæ„Ÿè§‰ä¸€å¼€å§‹å°±æƒ³å¥½æ€ä¹ˆå‰ªæè¿˜æ˜¯ä¸å¤ªå®¹æ˜“ï¼Œè¿™é¢˜å…¶å®å’Œä¸Šé¢çš„ç»„åˆå¾ˆç±»ä¼¼ï¼Œå€¼å¾—æ³¨æ„çš„å°±æ˜¯å­é€’å½’è°ƒç”¨çš„æ—¶å€™ä¼ é€’çš„indexå‚æ•°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> combinationSum(<span class="keyword">int</span>[] candidates, <span class="keyword">int</span> target) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (candidates==<span class="keyword">null</span> || candidates.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    combinationSum(candidates,target,<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">combinationSum</span><span class="params">(<span class="keyword">int</span>[] candidates, <span class="keyword">int</span> target,<span class="keyword">int</span> index,<span class="keyword">int</span> sum,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (sum>target) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (target==sum) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è¿™é‡Œä¸€æ¬¡å¾ªç¯å…¶å®å°±ç¡®å®šäº†åŒ…å«içš„æ‰€æœ‰å¯èƒ½è§£ï¼Œæ‰€ä»¥èµ·ç‚¹æ˜¯indexä¸æ˜¯0</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<candidates.length;i++) {< span><br><span class="line">        <span class="comment">//è·³è¿‡æ¯”targetå¤§çš„</span></span><br><span class="line">        <span class="keyword">if</span> (candidates[i]>target) <span class="keyword">continue</span>;</span><br><span class="line">        sum+=candidates[i];</span><br><span class="line">        lis.add(candidates[i]);</span><br><span class="line"><span class="comment">//å…¶å®ä¸»è¦å°±æ˜¯ææ¸…æ¥šæ¯æ¬¡ä»å“ªé‡Œå¼€å§‹,ä»¥åŠæ¯æ¬¡å¾ªç¯çš„ä½œç”¨</span></span><br><span class="line">        <span class="comment">//å¯ä»¥é‡å¤é€‰å–è‡ªå·±ï¼Œæ‰€ä»¥å­é€’å½’ä¹Ÿä»iå¼€å§‹è€Œä¸æ˜¯i+1</span></span><br><span class="line">        combinationSum(candidates,target,i,sum,lis);</span><br><span class="line">        sum-=candidates[i];</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></candidates.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>å‰ªæä¼˜åŒ–ï¼Œä¸»è¦æ˜¯è¦å…ˆæ’ä¸ªåºï¼Œè¿™æ ·å¦‚æœåœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œç´¯åŠ å’Œå·²ç»å¤§äºtargetäº†å°±ç›´æ¥returnï¼Œå¦‚æœä¸æ’åºå°±ä¸èƒ½returnï¼Œå› ä¸ºæ— æ³•ç¡®ä¿åé¢ä¼šä¸ä¼šæ›´å°çš„å…ƒç´ </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> combinationSum(<span class="keyword">int</span>[] candidates, <span class="keyword">int</span> target) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (candidates==<span class="keyword">null</span> || candidates.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æ’åº,æ–¹ä¾¿å‰ªæ</span></span><br><span class="line">    Arrays.sort(candidates);</span><br><span class="line">    combinationSum(candidates,target,<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‰ªæä¼˜åŒ–2</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">combinationSum</span><span class="params">(<span class="keyword">int</span>[] candidates, <span class="keyword">int</span> target,<span class="keyword">int</span> index,<span class="keyword">int</span> sum,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (sum>target) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (target==sum) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<candidates.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (sum+candidates[i]>target) <span class="keyword">return</span>;</span><br><span class="line">        sum+=candidates[i];</span><br><span class="line">        lis.add(candidates[i]);</span><br><span class="line">        <span class="comment">//æ³¨æ„è¿™é‡Œä¼ é€’è¿›å»çš„indexæ˜¯i</span></span><br><span class="line">        combinationSum(candidates,target,i,sum,lis);</span><br><span class="line">        sum-=candidates[i];</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></candidates.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸¤å¤©çŠ¶æ€è¿˜å¯ä»¥å•Šï¼Œå¥½å¤šé¢˜éƒ½å¯ä»¥å®Œå…¨ç‹¬ç«‹çš„å†™å‡ºæ¥äº†ğŸ˜</p><h2 id="40-ç»„åˆæ€»å’Œ-II"><a href="#40-ç»„åˆæ€»å’Œ-II" class="headerlink" title="40. ç»„åˆæ€»å’Œ II"></a><a href="https://leetcode-cn.com/problems/combination-sum-ii/" target="_blank" rel="noopener">40. ç»„åˆæ€»å’Œ II</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚</p><p>candidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬ç›®æ ‡æ•°ï¼‰éƒ½æ˜¯æ­£æ•´æ•°ã€‚</li><li>è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ </li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: candidates = [<span class="number">10</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">5</span>], target = <span class="number">8</span>,</span><br><span class="line">æ‰€æ±‚è§£é›†ä¸º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>, <span class="number">7</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">6</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: candidates = [<span class="number">2</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>], target = <span class="number">5</span>,</span><br><span class="line">æ‰€æ±‚è§£é›†ä¸º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">5</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> combinationSum2(<span class="keyword">int</span>[] candidates, <span class="keyword">int</span> target) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (candidates ==<span class="keyword">null</span> || candidates.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    Arrays.sort(candidates);</span><br><span class="line">    combinationSum2(candidates,target,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">combinationSum2</span><span class="params">(<span class="keyword">int</span>[] candidates, <span class="keyword">int</span> target,<span class="keyword">int</span> index,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    <span class="comment">/*if (target<0) {</span></span><br><span class="line"><span class="comment">            return;</span></span><br><span class="line"><span class="comment">        }*/</span></span><br><span class="line">    <span class="keyword">if</span> (target==<span class="number">0</span>) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<candidates.length;i++) {< span><br><span class="line">        <span class="comment">//æ³¨æ„è¿™é‡Œi>index</span></span><br><span class="line">        <span class="keyword">if</span> (i>index && candidates[i]==candidates[i-<span class="number">1</span>]  ) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">//æ’è¿‡åºçš„,å¯ä»¥ç›´æ¥return</span></span><br><span class="line">        <span class="keyword">if</span> (target-candidates[i]<<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        lis.add(candidates[i]);</span><br><span class="line">        combinationSum2(candidates,target-candidates[i],i+<span class="number">1</span>,lis);</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></candidates.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å›æº¯å…¶å®å€¼å¾—æ³¨æ„çš„å°±é‚£å‡ ä¸ªç‚¹ï¼Œå¾ªç¯çš„èµ·ç‚¹ï¼Œä¸‹æ¬¡é€’å½’çš„èµ·ç‚¹ï¼Œå›æº¯ï¼Œå‡ºå£ï¼Œè¿™å‡ ä¸ªç‚¹éƒ½ææ¸…æ¥šäº†å…¶å®å°±å¾ˆç®€å•äº†ï¼Œå…³é”®çš„åœ°æ–¹å°±æ˜¯å¦‚ä½•å»é‡</p><p>è¿™é¢˜å¦‚æœå‚ç…§ä¸Šé¢[å…¨æ’åˆ—2](## 47. å…¨æ’åˆ— II) çš„ç¬¬ä¸€ç§HashSetçš„å»é‡æ–¹å¼çš„è¯ï¼Œæ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼ŒHashSetçš„å»é‡æ–¹å¼åªèƒ½ä¿è¯<strong>æ¯ä¸€æ¬¡å¾ªç¯ä¸­ä¸ä¼šæœ‰é‡å¤çš„å…ƒç´ è¢«é€‰å–</strong>ï¼Œä½†æ˜¯è¿™é¢˜å³ä½¿å¾ªç¯ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ è¢«é€‰å–ï¼Œç»“æœä»ç„¶ä¼šæœ‰é‡å¤</p><p>æ¯”å¦‚ <code>10,1,2,7,6,1,5</code> éå†1çš„æ—¶å€™ä¼šå¾—åˆ°<code>1 2 5</code>ï¼Œåç»­éå†2çš„æ—¶å€™åˆä¼šå¾—åˆ°ä¸€ä¸ª <code>2 1 5</code> ï¼Œä½†æ˜¯å…¶å®åœ¨ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™å°±<strong>å·²ç»æ‰¾åˆ°äº†æ‰€æœ‰åŒ…å«1çš„è§£ï¼Œåé¢å¾ªç¯ä¸­åŒ…å«1çš„è§£å…¶å®éƒ½é‡å¤äº†</strong>ï¼Œå¦‚æœæˆ‘ä»¬æ’åºåå°±å˜ä¸º <code>1 1 2 5 6 7 10</code> æŠŠç›¸åŒçš„å…ƒç´ èšé›†åˆ°ä¸€èµ·ï¼Œä¸€æ–¹é¢å¯ä»¥å»é‡ï¼Œå¦ä¸€æ–¹é¢è¿˜å¯ä»¥å‰ªæï¼Œåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™å°±å·²ç»æ‰¾åˆ°äº†æ‰€æœ‰çš„ å¸¦æœ‰1çš„è§£ï¼Œåé¢çš„è¿ç€çš„1éƒ½å¯ä»¥è·³è¿‡äº†ï¼Œåç»­å°±ä¸ä¼šå†æœ‰åŒ…å«1çš„è§£äº†ï¼Œå¦‚æœä¸æ’åºï¼Œåé¢ä»ç„¶ä¼šæœ‰åŒ…å«1çš„è§£</p><h2 id="216-ç»„åˆæ€»å’Œ-III"><a href="#216-ç»„åˆæ€»å’Œ-III" class="headerlink" title="216. ç»„åˆæ€»å’Œ III"></a><a href="https://leetcode-cn.com/problems/combination-sum-iii/" target="_blank" rel="noopener">216. ç»„åˆæ€»å’Œ III</a></h2><p>æ‰¾å‡ºæ‰€æœ‰ç›¸åŠ ä¹‹å’Œä¸º n çš„ k ä¸ªæ•°çš„ç»„åˆã€‚ç»„åˆä¸­åªå…è®¸å«æœ‰ 1 - 9 çš„æ­£æ•´æ•°ï¼Œå¹¶ä¸”æ¯ç§ç»„åˆä¸­ä¸å­˜åœ¨é‡å¤çš„æ•°å­—ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>æ‰€æœ‰æ•°å­—éƒ½æ˜¯æ­£æ•´æ•°ã€‚</li><li>è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ </li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: k = <span class="number">3</span>, n = <span class="number">7</span></span><br><span class="line">è¾“å‡º: [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: k = <span class="number">3</span>, n = <span class="number">9</span></span><br><span class="line">è¾“å‡º: [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">6</span>], [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>], [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ„Ÿè§‰æ¯”ä¸Šé¢ä¸¤é¢˜è¿˜ç®€å•ä¸€ç‚¹ï¼Œå¯ä»¥ç›´æ¥å‰ªæ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List<list<integer>> combinationSum3(<span class="keyword">int</span> k, <span class="keyword">int</span> n) {</list<integer></span><br><span class="line">    combinationSum3(k,n,<span class="number">1</span>,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//n=9 1 2 6, 1 3 5, 2 3 4</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">combinationSum3</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> n,<span class="keyword">int</span> index,<span class="keyword">int</span> count,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (count==k && n==<span class="number">0</span>) {</span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<=<span class="number">9</span>;i++) {</span><br><span class="line">        <span class="comment">//æœ‰åºçš„,å¯ä»¥ç›´æ¥return</span></span><br><span class="line">        <span class="keyword">if</span> (n-i<<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        lis.add(i);</span><br><span class="line">        combinationSum3(k,n-i,i+<span class="number">1</span>,count+<span class="number">1</span>,lis);</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="78-å­é›†"><a href="#78-å­é›†" class="headerlink" title="78. å­é›†"></a><a href="https://leetcode-cn.com/problems/subsets/" target="_blank" rel="noopener">78. å­é›†</a></h2><p>ç»™å®šä¸€ç»„<strong>ä¸å«é‡å¤å…ƒç´ </strong>çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚</p><p><strong>è¯´æ˜ï¼š</strong>è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>],</span><br><span class="line">  [<span class="number">2</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">  []</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List<list<integer>> subsets(<span class="keyword">int</span>[] nums) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    subsets(nums,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subsets</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> index,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    <span class="comment">//if (index<=nums.length) {</span></span><br><span class="line">        res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">    <span class="comment">//}</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index; i<nums.length;i++) {< span><br><span class="line">        lis.add(nums[i]);</span><br><span class="line">        subsets(nums,i+<span class="number">1</span>,lis);</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>ç®€å•çš„å›æº¯ï¼Œæ³¨æ„æ”¶é›†ç»“æœçš„æ—¶æœºå°±è¡Œ</p><p><strong>è§£æ³•äºŒ</strong></p><p>BFSï¼Œç±»ä¼¼äºäºŒå‰æ ‘å±‚æ¬¡éå†ï¼Œé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„listï¼Œåé¢æ¯æ¬¡è¿­ä»£éƒ½å°†listä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å–å‡ºæ¥åŠ ä¸Šå½“å‰å…ƒç´ ï¼Œå†é‡æ–°åŠ å…¥åˆ°listä¸­</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> subsets(<span class="keyword">int</span>[] nums) {</list<integer></span><br><span class="line">    List<list<integer>> queue=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> queue;</span><br><span class="line">    }</span><br><span class="line">    queue.add(<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> next=queue.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<next;j++) {< span><br><span class="line">            List<integer> temp=<span class="keyword">new</span> ArrayList(queue.get(j));</integer></span><br><span class="line">            temp.add(nums[i]);</span><br><span class="line">            queue.add(temp);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> queue;</span><br><span class="line">}</span><br></next;j++)></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="90-å­é›†-II"><a href="#90-å­é›†-II" class="headerlink" title="90. å­é›† II"></a><a href="https://leetcode-cn.com/problems/subsets-ii/" target="_blank" rel="noopener">90. å­é›† II</a></h2><p>ç»™å®šä¸€ä¸ª<strong>å¯èƒ½åŒ…å«é‡å¤å…ƒç´ </strong>çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚</p><p><strong>è¯´æ˜ï¼š</strong>è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">2</span>],</span><br><span class="line">  [<span class="number">1</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">2</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">  []</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œ40é¢˜å¾ˆç±»ä¼¼ï¼Œä¸»è¦å°±æ˜¯è¿™ä¸ªå»é‡çš„æ“ä½œï¼Œæ¯”å¦‚é¢˜ç›®ç»™çš„caseï¼Œ<code>[1,2,2]</code> å·²ç»æœ‰åºäº†ï¼Œåœ¨é€‰æ‹©ç¬¬ä¸€ä¸ª2çš„æ—¶å€™å…¶å®å°±å·²ç»å°†æ‰€æœ‰åŒ…å«2çš„å­é›†éƒ½æ±‚å‡ºæ¥äº†ï¼Œåé¢çš„2å°±å¯ä»¥ç›´æ¥è·³è¿‡ï¼Œå½“ç„¶è¿™é‡Œ1ï¼Œ2ï¼Œ2æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œè¯•æƒ³å¦‚æœæ˜¯<code>2,1,2</code> éå†ç¬¬ä¸€ä¸ª2ä¼šå°†æ‰€æœ‰åŒ…å«2çš„å­é›†æ±‚å‡ºæ¥ï¼Œä½†æ˜¯éå†åˆ°1çš„æ—¶å€™ä¼šå°†ç¬¬ä¸‰ä¸ª2åŒ…å«è¿›æ¥ï¼Œä¹Ÿå°±æ˜¯<code>1ï¼Œ2</code> è¿™ä¸ªè§£ï¼Œä½†æ˜¯å‰é¢å·²ç»æ±‚å‡ºäº†<code>[2,1]</code> è¿™å°±é‡å¤äº†ï¼Œæ’åºå°±æ˜¯ä¸ºäº†å°†ç›¸åŒçš„å…ƒç´ èšåˆåˆ°ä¸€èµ·ï¼Œè¿™æ ·é‡åˆ°ç›¸åŒçš„å…ƒç´ å°±è·³è¿‡ï¼Œåé¢çš„å…ƒç´ å°±ä¸ä¼šå†åŒ…å«å·²ç»éå†è¿‡çš„å…ƒç´ äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> subsetsWithDup(<span class="keyword">int</span>[] nums) {</list<integer></span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//éœ€è¦å…ˆæ’åºï¼Œä¾¿äºè·³è¿‡ç›¸åŒçš„å…ƒç´ </span></span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    subsets(nums,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>  List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subsets</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> index,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    res.add(<span class="keyword">new</span> ArrayList(lis));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (i>index && nums[i] == nums[i-<span class="number">1</span>]) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        lis.add(nums[i]);</span><br><span class="line">        subsets(nums,i+<span class="number">1</span>,lis);</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="357-è®¡ç®—å„ä¸ªä½æ•°ä¸åŒçš„æ•°å­—ä¸ªæ•°"><a href="#357-è®¡ç®—å„ä¸ªä½æ•°ä¸åŒçš„æ•°å­—ä¸ªæ•°" class="headerlink" title="357. è®¡ç®—å„ä¸ªä½æ•°ä¸åŒçš„æ•°å­—ä¸ªæ•°"></a><a href="https://leetcode-cn.com/problems/count-numbers-with-unique-digits/" target="_blank" rel="noopener">357. è®¡ç®—å„ä¸ªä½æ•°ä¸åŒçš„æ•°å­—ä¸ªæ•°</a></h2><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° nï¼Œè®¡ç®—å„ä½æ•°å­—éƒ½ä¸åŒçš„æ•°å­— x çš„ä¸ªæ•°ï¼Œå…¶ä¸­ 0 â‰¤ x < 10n ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">91</span> </span><br><span class="line">è§£é‡Š: ç­”æ¡ˆåº”ä¸ºé™¤å» <span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>,<span class="number">88</span>,<span class="number">99</span> å¤–ï¼Œåœ¨ [<span class="number">0</span>,<span class="number">100</span>) åŒºé—´å†…çš„æ‰€æœ‰æ•°å­—ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><blockquote><p>è¿™é‡Œè¦å­˜ä¸ªç–‘é—®ï¼Œè¿™é‡Œçš„å›æº¯è®°å¿†åŒ–åº”è¯¥æ˜¯é”™çš„ï¼Œå¯èƒ½æ˜¯æ•°æ®å¤ªå°‘äº†ï¼Œæ²¡æµ‹è¯•å‡ºæ¥ï¼Œä½†æ˜¯å±…ç„¶çœŸçš„æé«˜äº†æ•ˆç‡ã€‚ã€‚ã€‚ã€‚è¿™å°±å¾ˆè¯¡å¼‚</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™ç§å¯ä»¥åšè®°å¿†åŒ–,0ms</span></span><br><span class="line">Integer[] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNumbersWithUniqueDigits2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">10</span>];</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=<span class="number">9</span>;i++) { <span class="comment">//ä¸è€ƒè™‘0å¼€å¤´çš„</span></span><br><span class="line">        visit[i]=<span class="keyword">true</span>;</span><br><span class="line">        res+=countNumbersWithUniqueDigits2(n,visit,<span class="number">1</span>);</span><br><span class="line">        visit[i]=<span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res+<span class="number">1</span>; <span class="comment">//åŠ çš„æ˜¯0è¿™ç§æƒ…å†µ</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//[index,n](ä½æ•°)åŒºé—´å†…,èƒ½æ„æˆæœ€å¤šçš„ä¸é‡å¤æ•°å­—</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNumbersWithUniqueDigits2</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">boolean</span>[] visit,<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (index==n) { <span class="comment">//æ²¡å¾—é€‰,åªæœ‰ä¸€ç§</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[index]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[index];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<=<span class="number">9</span>;i++) {</span><br><span class="line">        <span class="keyword">if</span> (!visit[i]) {</span><br><span class="line">            visit[i]=<span class="keyword">true</span>;</span><br><span class="line">            count+=countNumbersWithUniqueDigits2(n,visit,index+<span class="number">1</span>);</span><br><span class="line">            visit[i]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cache[index]=count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æˆ‘éƒ½ä¸å¥½æ„æ€æ”¾åˆ°å›æº¯ä¸“é¢˜ä¸­ï¼Œå¼€å§‹å†™äº†ä¸ªè´¼è„‘æ®‹çš„å›æº¯451msï¼Œå®åœ¨ä¸å¥½æ„æ€æ”¾ä¸Šæ¥</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ•°å­¦æ–¹æ³•(åˆä¸­æ•°å­¦)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countNumbersWithUniqueDigits3</span><span class="params">(<span class="keyword">int</span> n)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (n><span class="number">10</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">10</span>,count=<span class="number">9</span>; <span class="comment">//i=1çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<=n;i++) {</span><br><span class="line">        count*=(<span class="number">11</span>-i); <span class="comment">//9*9*8*7*6*5.....</span></span><br><span class="line">        res+=count;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¯´å®è¯ï¼Œè¿™ç§æ–¹æ³•æˆ‘ä¸€å¼€å§‹å†™ç¬¬ä¸€ç§å¾ˆè„‘æ®‹çš„å›æº¯çš„æ—¶å€™æ¨å‡ºæ¥äº†çš„ï¼Œä½†æ˜¯æˆ‘å±…ç„¶æ²¡æ„è¯†åˆ°ã€‚ã€‚ã€‚ã€‚</p><h2 id="89-æ ¼é›·ç¼–ç "><a href="#89-æ ¼é›·ç¼–ç " class="headerlink" title="89. æ ¼é›·ç¼–ç "></a>89. æ ¼é›·ç¼–ç </h2><p>æ ¼é›·ç¼–ç æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—ç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œä¸¤ä¸ªè¿ç»­çš„æ•°å€¼ä»…æœ‰ä¸€ä¸ªä½æ•°çš„å·®å¼‚ã€‚</p><p>ç»™å®šä¸€ä¸ªä»£è¡¨ç¼–ç æ€»ä½æ•°çš„éè´Ÿæ•´æ•° nï¼Œæ‰“å°å…¶æ ¼é›·ç¼–ç åºåˆ—ã€‚æ ¼é›·ç¼–ç åºåˆ—å¿…é¡»ä»¥ 0 å¼€å¤´ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">2</span></span><br><span class="line">è¾“å‡º: [<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">è§£é‡Š:</span><br><span class="line"><span class="number">00</span> - <span class="number">0</span></span><br><span class="line"><span class="number">01</span> - <span class="number">1</span></span><br><span class="line"><span class="number">11</span> - <span class="number">3</span></span><br><span class="line"><span class="number">10</span> - <span class="number">2</span></span><br><span class="line"></span><br><span class="line">å¯¹äºç»™å®šçš„ nï¼Œå…¶æ ¼é›·ç¼–ç åºåˆ—å¹¶ä¸å”¯ä¸€ã€‚</span><br><span class="line">ä¾‹å¦‚ï¼Œ[<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>] ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ ¼é›·ç¼–ç åºåˆ—ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">00</span> - <span class="number">0</span></span><br><span class="line"><span class="number">10</span> - <span class="number">2</span></span><br><span class="line"><span class="number">11</span> - <span class="number">3</span></span><br><span class="line"><span class="number">01</span> - <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">0</span></span><br><span class="line">è¾“å‡º: [<span class="number">0</span>]</span><br><span class="line">è§£é‡Š: æˆ‘ä»¬å®šä¹‰æ ¼é›·ç¼–ç åºåˆ—å¿…é¡»ä»¥ <span class="number">0</span> å¼€å¤´ã€‚</span><br><span class="line">     ç»™å®šç¼–ç æ€»ä½æ•°ä¸º n çš„æ ¼é›·ç¼–ç åºåˆ—ï¼Œå…¶é•¿åº¦ä¸º <span class="number">2</span>nã€‚å½“ n = <span class="number">0</span> æ—¶ï¼Œé•¿åº¦ä¸º <span class="number">20</span> = <span class="number">1</span>ã€‚</span><br><span class="line">     å› æ­¤ï¼Œå½“ n = <span class="number">0</span> æ—¶ï¼Œå…¶æ ¼é›·ç¼–ç åºåˆ—ä¸º [<span class="number">0</span>]ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>åˆä¸€ä¸ªè„‘æ®‹åšæ³•ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">grayCode3</span><span class="params">(<span class="keyword">int</span> n)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    res.add(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> max=(<span class="number">1</span><<n)-<span class="number">1</n)-<span></span>; <span class="comment">//æ³¨æ„ä¼˜å…ˆçº§</span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[max+<span class="number">1</span>];</span><br><span class="line">    grayCode3(max,res,visit);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">grayCode3</span><span class="params">(<span class="keyword">int</span> max,List<integer> lis,<span class="keyword">boolean</span>[] visit)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (lis.size()>max) { <span class="comment">// list.size()==max+1 eg. when max=3 the list.size()=4</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> last=lis.get(lis.size()-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=max;i++) {</span><br><span class="line">        <span class="keyword">if</span> (!visit[i] && Integer.bitCount(i^last)==<span class="number">1</span>) {</span><br><span class="line">            lis.add(i);</span><br><span class="line">            visit[i]=<span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(grayCode3(max,lis,visit)){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">            visit[i]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>æ­£å¸¸çš„å›æº¯ï¼Œæ¯æ¬¡ä¿®æ”¹ä¸€ä½ï¼Œ<strong>ç›´æ¥ç”Ÿæˆä¸‹ä¸€ä¸ªå¯èƒ½çš„æ ¼é›·ç </strong>ï¼Œè€Œä¸æ˜¯å‘ä¸Šé¢ä¸€æ ·ä¸€ä¸ªä¸ªéå†ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å¸¸è§„å›æº¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">grayCode2</span><span class="params">(<span class="keyword">int</span> n)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">1</span><<n];< span><br><span class="line">    res.add(<span class="number">0</span>);</span><br><span class="line">    visit[<span class="number">0</span>]=<span class="keyword">true</span>;</span><br><span class="line">    grayCode2(n,res,visit,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">grayCode2</span><span class="params">(<span class="keyword">int</span> n,List<integer> lis,<span class="keyword">boolean</span>[] visit,<span class="keyword">int</span> last)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (lis.size()>=(<span class="number">1</span><<n)) { <span class="comment">// list.size()==max+1 eg. when max=3 the list.size()=4</n))></span></n];<></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<n;i++) {< span><br><span class="line">        <span class="comment">//ç›´æ¥ç”Ÿæˆä¸‹ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">int</span> next=last^(<span class="number">1</span><<i); <span class="comment">//è¿™ä¸€æ­¥å…¶å®å°±æ˜¯ä»åå¾€å‰,ä¾æ¬¡æ”¹å˜lastä¸€ä½</i);></span></n;i++)></span><br><span class="line">        <span class="keyword">if</span> (!visit[next]) {</span><br><span class="line">            lis.add(next);</span><br><span class="line">            visit[next]=<span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(grayCode2(n,lis,visit,next)){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">            visit[next]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰</strong></p><p>ä¸åœçš„å’Œè‡ªå·±å³ç§»ä¸€ä½çš„å€¼åšå¼‚æˆ–ï¼Œæœ€ç»ˆå°±å¯ä»¥çš„åˆ°å®Œæ•´çš„æ ¼é›·ç ï¼Œè‡³äºåŸç†å¹¶ä¸æƒ³å»ç ”ç©¶ğŸ˜‚ï¼Œå…ˆè®°ä½å†è¯´</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æœ€ä¼˜è§£,è§„å¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">grayCode</span><span class="params">(<span class="keyword">int</span> n)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">1</span><<n;i++) {< span><br><span class="line">        res.add(i^(i>><span class="number">1</span>));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></n;i++)></span></pre></td></tr></tbody></table></figure></div><p>çœ‹äº†è¯„è®ºåŒºå‘ç°è¿˜æœ‰ä¸ªè§„å¾‹ï¼Œæ¯ä¸€å±‚çš„æ ¼é›·ç éƒ½æ˜¯ä¸Šä¸€å±‚å‰é¢åŠ 0 å’Œé€†åºä¸Šä¸€å±‚åœ¨å‰é¢åŠ 1ï¼Œæ„Ÿè§‰å¯èƒ½å’Œä¸Šé¢çš„è§„å¾‹æ˜¯ä¸€æ ·çš„ï¼Œä¸€å›¾ä»¥è”½ä¹‹</p><p><img alt="leetCodeé¢˜è§£" data-src="http://static.imlgw.top/blog/20191219/7rzdkpDvA4IN.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h2 id="526-ä¼˜ç¾çš„æ’åˆ—"><a href="#526-ä¼˜ç¾çš„æ’åˆ—" class="headerlink" title="526. ä¼˜ç¾çš„æ’åˆ—"></a><a href="https://leetcode-cn.com/problems/beautiful-arrangement/" target="_blank" rel="noopener">526. ä¼˜ç¾çš„æ’åˆ—</a></h2><p>å‡è®¾æœ‰ä» 1 åˆ° N çš„ N ä¸ªæ•´æ•°ï¼Œå¦‚æœä»è¿™ N ä¸ªæ•°å­—ä¸­æˆåŠŸæ„é€ å‡ºä¸€ä¸ªæ•°ç»„ï¼Œä½¿å¾—æ•°ç»„çš„ç¬¬ i ä½ (1 <= i <= N) æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸ªæ•°ç»„ä¸ºä¸€ä¸ªä¼˜ç¾çš„æ’åˆ—ã€‚æ¡ä»¶ï¼š</p><ol><li>ç¬¬ i ä½çš„æ•°å­—èƒ½è¢« i æ•´é™¤</li><li>i èƒ½è¢«ç¬¬ i ä½ä¸Šçš„æ•°å­—æ•´é™¤</li></ol><p>ç°åœ¨ç»™å®šä¸€ä¸ªæ•´æ•° Nï¼Œè¯·é—®å¯ä»¥æ„é€ å¤šå°‘ä¸ªä¼˜ç¾çš„æ’åˆ—ï¼Ÿ</p><p><strong>è§£æ³•ä¸€</strong></p><p>å›æº¯æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countArrangement</span><span class="params">(<span class="keyword">int</span> N)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[N+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> countArrangement(N,visit,<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countArrangement</span><span class="params">(<span class="keyword">int</span> N,<span class="keyword">boolean</span>[] visit,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index > N) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=N;i++) {</span><br><span class="line">        <span class="keyword">if</span> (!visit[i] && (index%i==<span class="number">0</span> || i%index==<span class="number">0</span>)) {</span><br><span class="line">            visit[i]=<span class="keyword">true</span>;</span><br><span class="line">            res+=countArrangement(N,visit,index+<span class="number">1</span>);</span><br><span class="line">            visit[i]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®æˆ‘æ˜¯æƒ³æ”¹æˆè®°å¿†åŒ–é€’å½’çš„ï¼Œä¸ç„¶æˆ‘ä¹Ÿä¸ä¼šè¿™æ ·å†™ï¼Œä½†æ˜¯åé¢æ”¹çš„æ—¶å€™å±…ç„¶å‡ºäº†bugï¼Œè¿™ä¹Ÿç®—æ˜¯æ‰“é†’äº†æˆ‘ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºè¿™æ ·çš„å›æº¯éƒ½èƒ½æ”¹æˆè®°å¿†åŒ–é€’å½’ã€‚ã€‚ã€‚è¿™é‡Œå¾ˆæ˜æ˜¾æ— æ³•åšè®°å¿†åŒ–ï¼Œå› ä¸ºä½ æ¯æ¬¡å›æº¯çš„æ—¶å€™indexç›¸åŒï¼Œä½†æ˜¯visitæ•°ç»„çš„çŠ¶æ€æ˜¯ä¸ä¸€æ ·çš„ï¼Œç›´æ¥è®°å¿†åŒ–è‚¯å®šå°±é”™äº†ã€‚ã€‚ã€‚ä½†æ˜¯è¯´åˆ°è¿™é‡Œæˆ‘å‘ç°ä¸Šé¢çš„ <a href="##">357.å„ä¸ªä½æ•°ä¸åŒæ•°å­—ä¸ªæ•°</a> å±…ç„¶è¿™æ ·è¿‡äº†ï¼Œå¹¶ä¸”è¿˜çœŸçš„æé«˜äº†æ•ˆç‡ã€‚ã€‚ã€‚ã€‚</p><h2 id="784-å­—æ¯å¤§å°å†™å…¨æ’åˆ—"><a href="#784-å­—æ¯å¤§å°å†™å…¨æ’åˆ—" class="headerlink" title="784. å­—æ¯å¤§å°å†™å…¨æ’åˆ—"></a><a href="https://leetcode-cn.com/problems/letter-case-permutation/" target="_blank" rel="noopener">784. å­—æ¯å¤§å°å†™å…¨æ’åˆ—</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²Sï¼Œé€šè¿‡å°†å­—ç¬¦ä¸²Sä¸­çš„æ¯ä¸ªå­—æ¯è½¬å˜å¤§å°å†™ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚è¿”å›æ‰€æœ‰å¯èƒ½å¾—åˆ°çš„å­—ç¬¦ä¸²é›†åˆã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: S = <span class="string">"a1b2"</span></span><br><span class="line">è¾“å‡º: [<span class="string">"a1b2"</span>, <span class="string">"a1B2"</span>, <span class="string">"A1b2"</span>, <span class="string">"A1B2"</span>]</span><br><span class="line"></span><br><span class="line">è¾“å…¥: S = <span class="string">"3z4"</span></span><br><span class="line">è¾“å‡º: [<span class="string">"3z4"</span>, <span class="string">"3Z4"</span>]</span><br><span class="line"></span><br><span class="line">è¾“å…¥: S = <span class="string">"12345"</span></span><br><span class="line">è¾“å‡º: [<span class="string">"12345"</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>S çš„é•¿åº¦ä¸è¶…è¿‡12ã€‚</li><li>S ä»…ç”±æ•°å­—å’Œå­—æ¯ç»„æˆã€‚ </li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>ä¸€çœ‹æ˜¯ç®€å•é¢˜ï¼Œå±é¢ å±é¢ å°±å¼€å§‹æï¼Œç»“æœå‘ç°æ²¡æƒ³è±¡ä¸­ç®€å•ï¼ˆä¸»è¦æ˜¯æˆ‘å¤ªèœäº†ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List<string> res=<span class="keyword">new</span> ArrayList<>();</string></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">letterCasePermutation</span><span class="params">(String S)</span> </string></span>{</span><br><span class="line">    letterCasePermutation(S,<span class="number">0</span>,<span class="keyword">new</span> StringBuilder(S));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">letterCasePermutation</span><span class="params">(String S,<span class="keyword">int</span> index,StringBuilder cur)</span> </span>{</span><br><span class="line">    res.add(cur.toString()); <span class="comment">//å˜åŒ–ä¸€æ¬¡å°±æ·»åŠ ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<s.length();i++) {< span><br><span class="line">        <span class="keyword">char</span> c=S.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (c>=<span class="string">'0'</span> && c<=<span class="string">'9'</span>) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        cur.replace(i,i+<span class="number">1</span>,letterCase(c));</span><br><span class="line">        letterCasePermutation(S,i+<span class="number">1</span>,cur);</span><br><span class="line">        cur.replace(i,i+<span class="number">1</span>,letterCase(cur.charAt(i))); <span class="comment">//çŠ¶æ€é‡ç½®</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼šc^(1<<5)å°±å¯ä»¥ä½¿å¤§å†™å˜å°å†™,å°å†™å˜å¤§å†™</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">letterCase</span><span class="params">(<span class="keyword">char</span> c)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (c>=<span class="string">'a'</span> && c<=<span class="string">'z'</span>) { <span class="comment">//65:A 97:a</span></span><br><span class="line">        c-=<span class="number">32</span>;</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span> (c>=<span class="string">'A'</span> && c<=<span class="string">'Z'</span>) {</span><br><span class="line">        c+=<span class="number">32</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> c+<span class="string">""</span>;</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œçš„çŠ¶æ€é‡ç½®å’Œä¹‹å‰çš„ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡æ•´ä½“è¿˜æ˜¯å¾ˆå¥½æƒ³çš„ï¼Œå…¶å®ä¹Ÿå¯ä»¥å®Œå…¨ä¸ç”¨å¾ªç¯çš„å½¢å¼</p><h2 id="1079-æ´»å­—å°åˆ·"><a href="#1079-æ´»å­—å°åˆ·" class="headerlink" title="1079. æ´»å­—å°åˆ·"></a><a href="https://leetcode-cn.com/problems/letter-tile-possibilities/" target="_blank" rel="noopener">1079. æ´»å­—å°åˆ·</a></h2><p>ä½ æœ‰ä¸€å¥—æ´»å­—å­—æ¨¡ tilesï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¨¡ä¸Šéƒ½åˆ»æœ‰ä¸€ä¸ªå­—æ¯ tiles[i]ã€‚è¿”å›ä½ å¯ä»¥å°å‡ºçš„éç©ºå­—æ¯åºåˆ—çš„æ•°ç›®ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"AAB"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">8</span></span><br><span class="line">è§£é‡Šï¼šå¯èƒ½çš„åºåˆ—ä¸º <span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"AA"</span>, <span class="string">"AB"</span>, <span class="string">"BA"</span>, <span class="string">"AAB"</span>, <span class="string">"ABA"</span>, <span class="string">"BAA"</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"AAABBC"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">188</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ol><li><code>1 <= tiles.length <= 7</code></li><li><code>tiles</code> ç”±å¤§å†™è‹±æ–‡å­—æ¯ç»„æˆ</li></ol><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é“é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œæœ‰ç‚¹ç»“åˆå…¨æ’åˆ—å’Œå­é›†çš„æ„æ€ï¼Œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numTilePossibilities</span><span class="params">(String tiles)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[tiles.length()];</span><br><span class="line">    <span class="keyword">char</span>[] cs=tiles.toCharArray();</span><br><span class="line">    Arrays.sort(cs);</span><br><span class="line">    numTilePossibilities(cs,visit);</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> count=-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ’åºå»é‡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">numTilePossibilities</span><span class="params">(<span class="keyword">char</span>[]cs,<span class="keyword">boolean</span>[] visit)</span> </span>{</span><br><span class="line">    count++;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<cs.length;i++) {< span><br><span class="line">        <span class="comment">//æƒ³æ¸…æ¥šè¿™é‡Œä¸ºå•¥å¿…é¡»æ˜¯!visit[i-1]</span></span><br><span class="line">        <span class="keyword">if</span>(i><span class="number">0</span> && cs[i]==cs[i-<span class="number">1</span>] && !visit[i-<span class="number">1</span>]){ </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!visit[i]) {</span><br><span class="line">            visit[i]=<span class="keyword">true</span>;</span><br><span class="line">            numTilePossibilities(cs,visit);</span><br><span class="line">            visit[i]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></cs.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜æ”¶è·æ¯”è¾ƒå¤§ï¼Œå¯¹æ’åˆ—ç»„åˆç±»å‹çš„é¢˜ç›®åˆå¤šäº†ä¸€å±‚ç†è§£ï¼ŒåŒæ—¶ä¹Ÿçº æ­£äº†ä¹‹å‰çš„é”™è¯¯è§‚ç‚¹</p><h3 id="Bugè­¦å‘Šï¼ï¼ï¼"><a href="#Bugè­¦å‘Šï¼ï¼ï¼" class="headerlink" title="Bugè­¦å‘Šï¼ï¼ï¼"></a>Bugè­¦å‘Šï¼ï¼ï¼</h3><p>çœ‹ä¸€ä¸‹æœ€å¼€å§‹å†™çš„é”™è¯¯è§£æ³•ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±åœ¨è¿™ä¸ª<code>!visit[i-1]</code>ä¸Šï¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (i><span class="number">0</span> && cs[i]==cs[i-<span class="number">1</span>] && visit[i-<span class="number">1</span>])</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæˆ‘ä¹‹å‰ä¸€ç›´ç†è§£æˆäº†ä¿ç•™ç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸Šä¸€ä¸ªå…ƒç´ å·²ç»è®¿é—®è¿‡äº†ï¼Œåé¢å°±ç›´æ¥è·³è¿‡ï¼Œåšäº†è¿™ä¸€é¢˜å†™å‡ºé—®é¢˜äº†æ‰çŸ¥é“åŸæ¥è¿™é‡Œå®Œå…¨ç†è§£åäº†ğŸ˜‚ï¼Œå½“æ—¶æ²¡æœ‰ä»”ç»†æƒ³ï¼Œå…¶å®è¿™é‡Œç»†æƒ³ä¸€ä¸‹å°±å¾ˆå®¹æ˜“å‘ç°é—®é¢˜ï¼Œvisitæ•°ç»„å…¶å®ä¿è¯çš„æ˜¯å½“å‰è¿™ä¸€æ¡<strong>è‡ªä¸Šè€Œä¸‹çš„çºµå‘åˆ†æ”¯å†…ä¸ä¼šæœ‰é‡å¤</strong>ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬<strong>è¦ç¡®ä¿çš„å…¶å®æ˜¯æ¨ªå‘çš„ä¸é‡å¤ï¼Œä¹Ÿå°±æ˜¯åŒä¸€å±‚å†…ä¸é‡å¤</strong>ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨<code>visit[i-1]</code> å…¶å®ä»è¯­ä¹‰ä¸Šæ¥è¯´å°±æ˜¯æœ‰é—®é¢˜çš„ï¼Œç”»ä¸ªå›¾æ¥è¯´æ˜ä¸‹ä¸ºå•¥ä¼šæœ‰é—®é¢˜</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191221/Fv53BFPU6n1y.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ç”»ä¸ªé€’å½’æ ‘ï¼Œç„¶åæ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå…¶å®å°±æ˜ç™½äº†ï¼Œä½¿ç”¨<code>visit[i-1]</code>çš„æ–¹å¼ï¼Œç”Ÿæˆçš„ç¬¬ä¸€ä¸ªåˆ†æ”¯å…¶å®å°±ä¸å®Œæ•´äº†ï¼Œåªæœ‰åé¢çš„ç¬¬äºŒä¸ªåˆ†æ”¯æ‰ä¼šæ˜¯å®Œæ•´çš„ï¼Œæ‰€ä»¥<strong>å¯ä»¥ç†è§£ä¸ºä¿ç•™æœ€åä¸€ä¸ªåˆ†æ”¯ï¼Œå°†å‰é¢çš„åˆ†æ”¯å‰ªæ‰</strong>ï¼Œåœ¨å…¨æ’åˆ—ä¸­å› ä¸ºæœ‰é•¿åº¦é™åˆ¶ï¼Œç¬¬ä¸€ä¸ªåˆ†æ”¯å¹¶æ²¡æœ‰è¾¾åˆ°ç»™å®šçš„é•¿åº¦ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šåŠ å…¥ç»“æœé›†ï¼Œå¯¹ç»“æœæ²¡æœ‰å½±å“ï¼Œï¼ˆå…¶å®æ˜¯ä¼šå½±å“æ•ˆç‡çš„ï¼Œä¼šé‡å¤çš„éå†åˆ†æ”¯ï¼Œè¿™ä¸ªæ‰“å°ä¸€ä¸‹ç”Ÿæˆå…¨æ’åˆ—è¿‡ç¨‹çš„ç»“æœé›†å°±èƒ½çœ‹å‡ºæ¥ï¼‰</p><p>ä½†æ˜¯åœ¨è¿™ä¸€é¢˜ï¼Œå¹¶æ²¡æœ‰é•¿åº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥countä¼šå°†ç¬¬ä¸€ä¸ªä¸å®Œæ•´çš„åˆ†æ”¯ä¹Ÿå½“ä½œç»“æœé›†ç®—è¿›å»ï¼Œè€Œåé¢ç¬¬äºŒä¸ªåˆ†æ”¯çš„æ—¶å€™ï¼ˆå®Œæ•´åˆ†æ”¯ï¼‰åˆä¼šè®¡ç®—ä¸€éï¼Œç»“æœå°±é”™äº†</p><p>é‚£ä¸ºä»€ä¹ˆ<code>!visit[i-1]</code> å°±å¯ä»¥å‘¢ï¼Ÿ</p><p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œvisitè™½ç„¶ä¿è¯çš„æ˜¯çºµå‘çš„ä¸é‡å¤ï¼Œä½†æ˜¯æ¯éå†å®Œä¸€ä¸ªåˆ†æ”¯åï¼Œéƒ½ä¼šå›æº¯çŠ¶æ€ï¼Œè€Œæˆ‘ä»¬åˆæ˜¯<strong>æŒ‰ç…§é¡ºåºæ¥éå†å…ƒç´ </strong>çš„ï¼Œæ‰€ä»¥å¦‚æœä¸Šä¸€ä¸ªå…ƒç´ çš„ visit[i]æ˜¯falseï¼Œé‚£å°±è¯´æ˜ä¸Šä¸€ä¸ªå…ƒç´ çš„åˆ†æ”¯å·²ç»éå†å®Œäº†ï¼ä»¥å®ƒå¼€å¤´çš„æ‰€æœ‰æ’åˆ—éƒ½æ‰¾å®Œäº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ç„¶åè·³è¿‡ï¼Œæ‰æ˜¯çœŸæ­£çš„ä¿ç•™äº†ç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼åé¢çš„ç›´æ¥è·³è¿‡ï¼Œå‡å°‘äº†å¤šä½™çš„æ“ä½œï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå‡ºç°bugï¼Œæ‰€ä»¥ä½ æ˜ç™½ä»¥åè¦ç”¨é‚£ä¸ªäº†å§ğŸ˜‰</p><h2 id="1291-é¡ºæ¬¡æ•°"><a href="#1291-é¡ºæ¬¡æ•°" class="headerlink" title="1291. é¡ºæ¬¡æ•°"></a><a href="https://leetcode-cn.com/problems/sequential-digits/" target="_blank" rel="noopener">1291. é¡ºæ¬¡æ•°</a></h2><p>æˆ‘ä»¬å®šä¹‰ã€Œé¡ºæ¬¡æ•°ã€ä¸ºï¼šæ¯ä¸€ä½ä¸Šçš„æ•°å­—éƒ½æ¯”å‰ä¸€ä½ä¸Šçš„æ•°å­—å¤§ 1 çš„æ•´æ•°ã€‚</p><p>è¯·ä½ è¿”å›ç”± [low, high] èŒƒå›´å†…æ‰€æœ‰é¡ºæ¬¡æ•°ç»„æˆçš„ æœ‰åº åˆ—è¡¨ï¼ˆä»å°åˆ°å¤§æ’åºï¼‰ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å‡ºï¼šlow = <span class="number">100</span>, high = <span class="number">300</span></span><br><span class="line">è¾“å‡ºï¼š[<span class="number">123</span>,<span class="number">234</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å‡ºï¼šlow = <span class="number">1000</span>, high = <span class="number">13000</span></span><br><span class="line">è¾“å‡ºï¼š[<span class="number">1234</span>,<span class="number">2345</span>,<span class="number">3456</span>,<span class="number">4567</span>,<span class="number">5678</span>,<span class="number">6789</span>,<span class="number">12345</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li>10 <= low <= high <= 10^9 </li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å›æº¯tagä¸‹çš„ï¼ŒæŸä¸€æ¬¡å‘¨èµ›çš„é¢˜ï¼Œæˆ‘å†™çš„å·²ç»ä¸åƒå›æº¯äº†ï¼Œå°¾é€’å½’ï¼Œæœ‰ç‚¹é¸¡è‚‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">sequentialDigits</span><span class="params">(<span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </integer></span>{</span><br><span class="line">    String slow=String.valueOf(low);</span><br><span class="line">    <span class="keyword">int</span> slen=slow.length();</span><br><span class="line">    <span class="keyword">int</span> first=Integer.valueOf(slow.charAt(<span class="number">0</span>))-<span class="string">'0'</span>-<span class="number">1</span>;</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">int</span> start=first,len=slen;</span><br><span class="line">    <span class="keyword">if</span>(first+len><span class="number">9</span>){</span><br><span class="line">        start=<span class="number">0</span>;</span><br><span class="line">        len++;</span><br><span class="line">    }</span><br><span class="line">    sequentialDigits(low,high,start,len,res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String str=<span class="string">"123456789"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sequentialDigits</span><span class="params">(<span class="keyword">int</span> low,<span class="keyword">int</span> high,<span class="keyword">int</span> start,<span class="keyword">int</span> len,List<integer> list)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(start+len><span class="number">9</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> cur=Integer.valueOf(str.substring(start,start+len));</span><br><span class="line">    <span class="keyword">if</span>(cur>high){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(cur>=low){</span><br><span class="line">        list.add(cur);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(start+len==<span class="number">9</span>){</span><br><span class="line">        sequentialDigits(low,high,<span class="number">0</span>,len+<span class="number">1</span>,list);    </span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        sequentialDigits(low,high,start+<span class="number">1</span>,len,list);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®ç›´æ¥æš´åŠ›æšä¸¾<code>1~9</code>çš„æ‰€æœ‰é¡ºåºç»„åˆç„¶ååˆ¤æ–­åœ¨ä¸åœ¨<code>low~high</code> ä¹‹é—´å°±okäº†ï¼Œæœ€å†æ’ä¸ªåºå°±okï¼Œä¸€å…±ä¹Ÿåªæœ‰36ä¸ªï¼Œä¸ªäººæ„Ÿè§‰æˆ‘ä¸Šé¢çš„è¿˜æ˜¯æ¯”å•çº¯çš„æš´åŠ›ä¼šå¥½ä¸€ç‚¹ï¼Œé¦–å…ˆä¸ç”¨æ’åºï¼Œå…¶æ¬¡ä¹Ÿä¸ä¼šä»å¤´å¼€å§‹éå†ï¼Œä¼šæ ¹æ®lowçš„å€¼æ¥é€‰å–ä»å“ªé‡Œå¼€å§‹æˆªå–ï¼Œä½†æ˜¯è¿™é¢˜æ•°æ®é‡æœ‰é™ï¼Œä½“ç°ä¸å‡ºæ¥å·®å¼‚</p><h2 id="22-æ‹¬å·ç”Ÿæˆ"><a href="#22-æ‹¬å·ç”Ÿæˆ" class="headerlink" title="22. æ‹¬å·ç”Ÿæˆ"></a><a href="https://leetcode-cn.com/problems/generate-parentheses/" target="_blank" rel="noopener">22. æ‹¬å·ç”Ÿæˆ</a></h2><p>ç»™å‡º n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ å†™å‡ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸”æœ‰æ•ˆçš„æ‹¬å·ç»„åˆã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å‡º <code>n = 3</code>ï¼Œç”Ÿæˆç»“æœä¸ºï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">"((()))"</span>,</span><br><span class="line">  <span class="string">"(()())"</span>,</span><br><span class="line">  <span class="string">"(())()"</span>,</span><br><span class="line">  <span class="string">"()(())"</span>,</span><br><span class="line">  <span class="string">"()()()"</span></span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å“ï¼ŒçŸ¥é“æ˜¯å›æº¯è¿˜æ˜¯æ²¡åšå‡ºæ¥ï¼Œè¿˜æ˜¯å¤ªèœäº†å•Š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">generateParenthesis</span><span class="params">(<span class="keyword">int</span> n)</span> </string></span>{</span><br><span class="line">    dfs(n,<span class="string">""</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<string> res=<span class="keyword">new</span> LinkedList<>();</string></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> n,String sb,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left>n <span class="comment">/*|| right>n*/</span> || right>left) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (left==n && right ==n) {</span><br><span class="line">        res.add(sb.toString());   </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    dfs(n,sb+<span class="string">"("</span>,left+<span class="number">1</span>,right);</span><br><span class="line">    dfs(n,sb+<span class="string">")"</span>,left,right+<span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…³é”®è¿˜æ˜¯æ²¡æƒ³æ˜ç™½è¿™é¢˜çš„é€’å½’æ¡ä»¶ï¼Œæˆ‘çŸ¥é“æ˜¯å…ˆç”Ÿæˆ â€œ(â€œ å†ç”Ÿæˆ â€œ)â€ ä½†æ˜¯ç»ˆæ­¢æ¡ä»¶ä¸€ç›´æ²¡æƒ³æ¸…æ¥šï¼Œå…¶å®æˆ‘ä»¬éœ€è¦ç»™å·¦å³æ‹¬å·åŠ ä¸€ä¸ªè®¡æ•°å™¨<code>leftå’Œright</code>ï¼Œç”¨æ¥è®°å½•å·²ç»ç”Ÿæˆçš„å·¦å³æ‹¬å·çš„æ•°é‡ï¼Œç„¶åæˆ‘ä»¬æ€è€ƒç»ˆæ­¢æ¡ä»¶æ˜¯å•¥ï¼Œé¦–å…ˆå¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯å·¦å³æ‹¬å·æ•°é‡ <code>left==right</code> çš„æ—¶å€™ï¼Œè¿™æ˜¯åˆæ³•çš„ç»ˆæ­¢æ¡ä»¶ï¼Œä½†æ˜¯è¿™æ ·å°±å¤Ÿäº†ä¹ˆï¼Ÿå¾ˆæ˜æ˜¾ä¸å¤Ÿï¼Œ<code>()))((</code> ç±»ä¼¼è¿™æ ·çš„å°±å¹¶ä¸æ˜¯åˆæ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¿è¯ç”Ÿæˆæ‹¬å·çš„åˆæ³•æ€§ï¼Œæ‰€ä»¥è¿™ç§æ—¶å€™è‹¥æ˜¯ä¸å¤ªæ¸…æ¥šçš„å°±å¯ä»¥æ¥ç”»ä¸€ç”»é€’å½’æ ‘</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191024/9uvjEQzjtKtf.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å›¾ç”»çš„æ¯”è¾ƒé­”æ€§ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆå®¹æ˜“çœ‹æ‡‚çš„ï¼Œé€šè¿‡è¿™ä¸ªé€’å½’æ ‘æˆ‘è¿˜å‘ç°äº†ä¸Šé¢ä»£ç çš„ä¸€ç‚¹å°é—®é¢˜ï¼Œ<code>right>n</code> æ˜¯ä¸ªå†—ä½™æ¡ä»¶ï¼Œåˆæ³•æ¡ä»¶ <code>right<left<n< code>ï¼Œrightè‚¯å®šä¸ä¼šè¶…è¿‡nï¼Œæ­£å¦‚ä¸Šé¢ä¸‰ä¸ªç”» âŒçš„åœ°æ–¹å°±æ˜¯å¯¹åº”çš„ä¸‰ä¸ªä¸åˆæ³•çš„ç»ˆæ­¢æ¡ä»¶ï¼Œæœ‰äº†è¿™ä¸ªå°±å¯ä»¥å¾ˆå®¹æ˜“çš„å†™å‡ºå›æº¯ä»£ç ï¼Œä¸‹é¢çš„æ˜¯ç”¨çš„<code>StringBuilder</code>çš„ï¼Œéœ€è¦å›æº¯å­—ç¬¦ä¸²ï¼Œæ›´ç¬¦åˆå›æº¯çš„æ€æƒ³ï¼Œä¸Šé¢çš„Stringæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‰‹åŠ¨å›æº¯</left<n<></code></p><code><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">generateParenthesis</span><span class="params">(<span class="keyword">int</span> n)</span> </string></span>{</span><br><span class="line">    dfs(n,<span class="keyword">new</span> StringBuilder(),<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List<string> res=<span class="keyword">new</span> LinkedList<>();</string></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> n,StringBuilder sb,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left>n || right>n || right>left) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (left==n && right ==n) {</span><br><span class="line">        res.add(sb.toString());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    dfs(n,sb.append(<span class="string">"("</span>),left+<span class="number">1</span>,right);</span><br><span class="line">    sb.delete(sb.length()-<span class="number">1</span>,sb.length());</span><br><span class="line">    dfs(n,sb.append(<span class="string">")"</span>),left,right+<span class="number">1</span>);</span><br><span class="line">    sb.delete(sb.length()-<span class="number">1</span>,sb.length());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="306-ç´¯åŠ æ•°"><a href="#306-ç´¯åŠ æ•°" class="headerlink" title="306. ç´¯åŠ æ•°"></a><a href="https://leetcode-cn.com/problems/additive-number/" target="_blank" rel="noopener">306. ç´¯åŠ æ•°</a></h2><p>ç´¯åŠ æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»„æˆå®ƒçš„æ•°å­—å¯ä»¥å½¢æˆç´¯åŠ åºåˆ—ã€‚</p><p>ä¸€ä¸ªæœ‰æ•ˆçš„ç´¯åŠ åºåˆ—å¿…é¡»<strong>è‡³å°‘</strong>åŒ…å« 3 ä¸ªæ•°ã€‚é™¤äº†æœ€å¼€å§‹çš„ä¸¤ä¸ªæ•°ä»¥å¤–ï¼Œå­—ç¬¦ä¸²ä¸­çš„å…¶ä»–æ•°éƒ½ç­‰äºå®ƒä¹‹å‰ä¸¤ä¸ªæ•°ç›¸åŠ çš„å’Œã€‚</p><p>ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­— <code>'0'-'9'</code> çš„å­—ç¬¦ä¸²ï¼Œç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ç»™å®šè¾“å…¥æ˜¯å¦æ˜¯ç´¯åŠ æ•°ã€‚</p><p><strong>è¯´æ˜:</strong> ç´¯åŠ åºåˆ—é‡Œçš„æ•°ä¸ä¼šä»¥ 0 å¼€å¤´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° <code>1, 2, 03</code> æˆ–è€… <code>1, 02, 3</code> çš„æƒ…å†µã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"112358"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span> </span><br><span class="line">è§£é‡Š: ç´¯åŠ åºåˆ—ä¸º: <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span> ã€‚<span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span>, <span class="number">1</span> + <span class="number">2</span> = <span class="number">3</span>, <span class="number">2</span> + <span class="number">3</span> = <span class="number">5</span>, <span class="number">3</span> + <span class="number">5</span> = <span class="number">8</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"199100199"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span> </span><br><span class="line">è§£é‡Š: ç´¯åŠ åºåˆ—ä¸º: <span class="number">1</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">199</span>ã€‚<span class="number">1</span> + <span class="number">99</span> = <span class="number">100</span>, <span class="number">99</span> + <span class="number">100</span> = <span class="number">199</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶:</strong></p><ul><li>ä½ å¦‚ä½•å¤„ç†ä¸€ä¸ªæº¢å‡ºçš„è¿‡å¤§çš„æ•´æ•°è¾“å…¥?</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>åœ¨å›æº¯ä¸“é¢˜é‡Œç¿»åˆ°çš„ï¼Œè¯´å®è¯ï¼Œcaseæœ‰ç‚¹æ¶å¿ƒ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAdditiveNumber</span><span class="params">(String num)</span> </span>{</span><br><span class="line">    LinkedList<string> list=<span class="keyword">new</span> LinkedList<>();</string></span><br><span class="line">    list.add(<span class="string">"-1"</span>);</span><br><span class="line">    list.add(<span class="string">"-1"</span>);</span><br><span class="line">    <span class="keyword">return</span> dfs(num,<span class="number">0</span>,list);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dfs</span><span class="params">(String num,<span class="keyword">int</span> index,List<string> list)</string></span> </span>{</span><br><span class="line">    <span class="comment">//System.out.println(list);</span></span><br><span class="line">    <span class="keyword">if</span> (index==num.length() && list.size()><span class="number">4</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=index+<span class="number">1</span>;i<=num.length();i++){</span><br><span class="line">        <span class="comment">//0å¼€å¤´åº”è¯¥ç›´æ¥break,é™¤éæ˜¯å•ç‹¬çš„0....</span></span><br><span class="line">        <span class="keyword">if</span> (num.charAt(index)==<span class="string">'0'</span> && i>index+<span class="number">1</span>) { <span class="comment">//"101" .....</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å‰ªæ</span></span><br><span class="line">        <span class="keyword">if</span> (i-index>num.length()/<span class="number">2</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        String sub=num.substring(index,i);</span><br><span class="line">        String a=list.get(list.size()-<span class="number">1</span>);</span><br><span class="line">        String b=list.get(list.size()-<span class="number">2</span>);</span><br><span class="line">        list.add(sub);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="string">"-1"</span>.equals(a)||<span class="string">"-1"</span>.equals(b) || addTwoStr(a,b).equals(sub)) && dfs(num,i,list)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤§æ•°ç›¸åŠ </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">addTwoStr</span><span class="params">(String a,String b)</span></span>{</span><br><span class="line">    StringBuilder res=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">int</span> aIdx=a.length()-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> bIdx=b.length()-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> temp=<span class="number">0</span>; <span class="comment">//è¿›ä½</span></span><br><span class="line">    <span class="keyword">while</span>(aIdx>=<span class="number">0</span> || bIdx>=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">int</span> as=aIdx>=<span class="number">0</span>?a.charAt(aIdx)-<span class="number">48</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> bs=bIdx>=<span class="number">0</span>?b.charAt(bIdx)-<span class="number">48</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> sum=as+bs+temp;</span><br><span class="line">        temp=(sum)/<span class="number">10</span>;</span><br><span class="line">        res.append(sum%<span class="number">10</span>);</span><br><span class="line">        aIdx--;bIdx--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (temp==<span class="number">1</span>) {</span><br><span class="line">        res.append(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res.reverse().toString();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å›æº¯ä¸éš¾æƒ³åˆ°ï¼Œè¿™ä¸€ç±»å›æº¯å’‹è¯´å‘¢ï¼Œå±äº â€œä¸€é•œåˆ°åº•â€ çš„é‚£ç§ï¼Œå¯ä»¥çœ‹çœ‹è§£æ•°ç‹¬çš„å“ªä¸ªè§£æ³•ï¼Œä¹Ÿæ˜¯è¿™æ ·çš„ï¼ˆå…¶å®å°±æ˜¯å‚è€ƒçš„é‚£ä¸ªï¼‰å¸¦ä¸€ä¸ªbooleanè¿”å›å€¼ï¼Œèµ°åˆ°ç»“å°¾èµ°ä¸é€šæ‰ä¼šå›æº¯ï¼ŒNçš‡åè¿™ç§å°±ä¸å¤ªä¸€æ ·ï¼Œä¸ç®¡æ˜¯å¦æˆåŠŸéƒ½ä¼šå›æº¯ï¼Œåæ­£ç›®å‰å¤§è‡´çš„æ„Ÿè§‰å°±æ˜¯è¿™æ ·ï¼Œåé¢é‡åˆ°æ›´å¤šé¢˜å‹å†æ¥æ€»ç»“</p><p>ä¸è¿‡æ„Ÿè§‰è¿™é¢˜çš„å…³é”®ä¸æ˜¯å›æº¯ï¼Œè€Œæ˜¯è¾¹ç•Œçš„å¤„ç†ï¼Œé¦–å…ˆæ˜¯æº¢å‡ºçš„é—®é¢˜ï¼Œæˆ‘çœ‹è§æœ‰è¿›é˜¶çš„å°±æ²¡è€ƒè™‘æº¢å‡ºï¼Œç»“æœè¿˜æ˜¯æº¢å‡ºäº†ï¼Œè€Œä¸”æº¢å‡ºäº†ä¸¤æ¬¡ï¼ï¼ï¼æœ€åæ²¡åŠæ³•ï¼Œä¹Ÿä¸æƒ³ç”¨<code>BigInteger</code>å°±è‡ªå·±å†™äº†å¤§æ•°ç›¸åŠ çš„é€»è¾‘</p><p>é™¤äº†æº¢å‡ºçš„é—®é¢˜ï¼Œè¿™é¢˜éœ€è¦æ³¨æ„ <code>0</code> åœ¨è¿™ä¸ª<code>0</code> ä¸Šä¹ŸWAäº†ä¸€å‘ï¼Œå› ä¸ºå›æº¯è¿˜æ˜¯åœ¨åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¦‚æœæœ‰0çš„è¯å°±ä¸èƒ½éšä¾¿çš„åˆ†å‰²äº†ï¼Œå…·ä½“çœ‹ä»£ç å°±æ‡‚äº†</p><h2 id="842-å°†æ•°ç»„æ‹†åˆ†æˆæ–æ³¢é‚£å¥‘åºåˆ—"><a href="#842-å°†æ•°ç»„æ‹†åˆ†æˆæ–æ³¢é‚£å¥‘åºåˆ—" class="headerlink" title="842. å°†æ•°ç»„æ‹†åˆ†æˆæ–æ³¢é‚£å¥‘åºåˆ—"></a><a href="https://leetcode-cn.com/problems/split-array-into-fibonacci-sequence/" target="_blank" rel="noopener">842. å°†æ•°ç»„æ‹†åˆ†æˆæ–æ³¢é‚£å¥‘åºåˆ—</a></h2><p>ç»™å®šä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸² Sï¼Œæ¯”å¦‚ S = â€œ123456579â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒåˆ†æˆæ–æ³¢é‚£å¥‘å¼çš„åºåˆ— [123, 456, 579]ã€‚</p><p>å½¢å¼ä¸Šï¼Œæ–æ³¢é‚£å¥‘å¼åºåˆ—æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°åˆ—è¡¨ Fï¼Œä¸”æ»¡è¶³ï¼š</p><ul><li>0 <= F[i] <= 2^31 - 1ï¼Œï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ•´æ•°éƒ½ç¬¦åˆ 32 ä½æœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼‰ï¼›</li><li>F.length >= 3ï¼›</li><li>å¯¹äºæ‰€æœ‰çš„0 <= i < F.length - 2ï¼Œéƒ½æœ‰ <code>F[i] + F[i+1] = F[i+2]</code> æˆç«‹ã€‚</li></ul><p>å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œå°†å­—ç¬¦ä¸²æ‹†åˆ†æˆå°å—æ—¶ï¼Œæ¯ä¸ªå—çš„æ•°å­—ä¸€å®šä¸è¦ä»¥é›¶å¼€å¤´ï¼Œé™¤éè¿™ä¸ªå—æ˜¯æ•°å­— 0 æœ¬èº«ã€‚</p><p>è¿”å›ä» S æ‹†åˆ†å‡ºæ¥çš„æ‰€æœ‰æ–æ³¢é‚£å¥‘å¼çš„åºåˆ—å—ï¼Œå¦‚æœä¸èƒ½æ‹†åˆ†åˆ™è¿”å› <code>[]</code>ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"123456579"</span></span><br><span class="line">è¾“å‡ºï¼š[<span class="number">123</span>,<span class="number">456</span>,<span class="number">579</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"11235813"</span></span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">13</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: "112358130"</span><br><span class="line">è¾“å‡º: []</span><br><span class="line">è§£é‡Š: è¿™é¡¹ä»»åŠ¡æ— æ³•å®Œæˆã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"0123"</span></span><br><span class="line">è¾“å‡ºï¼š[]</span><br><span class="line">è§£é‡Šï¼šæ¯ä¸ªå—çš„æ•°å­—ä¸èƒ½ä»¥é›¶å¼€å¤´ï¼Œå› æ­¤ <span class="string">"01"</span>ï¼Œ<span class="string">"2"</span>ï¼Œ<span class="string">"3"</span> ä¸æ˜¯æœ‰æ•ˆç­”æ¡ˆã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 5ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"1101111"</span></span><br><span class="line">è¾“å‡º: [<span class="number">110</span>, <span class="number">1</span>, <span class="number">111</span>]</span><br><span class="line">è§£é‡Š: è¾“å‡º [<span class="number">11</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">11</span>] ä¹ŸåŒæ ·è¢«æ¥å—ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= S.length <= 200</code></li><li>å­—ç¬¦ä¸² S ä¸­åªå«æœ‰æ•°å­—ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸Šé¢é‚£é¢˜ä¸€æ ·ï¼Œä½†æ˜¯è¿™é¢˜ä¼šç®€å•ä¸€ç‚¹ï¼Œä¸ç”¨å¤„ç†å¤§æ•°ç›¸åŠ çš„æƒ…å†µï¼ŒåŒæ—¶é™å®šäº†æ•°å­—çš„èŒƒå›´å°±æ˜¯32ä½intï¼Œæ‰€ä»¥åªè¦èŒƒå›´è¶…è¿‡äº†int32å°±ç›´æ¥break</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">splitIntoFibonacci</span><span class="params">(String S)</span> </integer></span>{</span><br><span class="line">    LinkedList<integer> res=<span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">    dfs(S,<span class="number">0</span>,res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dfs</span><span class="params">(String S,<span class="keyword">int</span> index,List<integer> lis)</integer></span></span>{</span><br><span class="line">    <span class="keyword">if</span> (index == S.length()) {</span><br><span class="line">        <span class="keyword">return</span> lis.size()><span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index+<span class="number">1</span>;i<=S.length();i++) {</span><br><span class="line">        String temp=S.substring(index,i);</span><br><span class="line">        <span class="comment">//é•¿åº¦å¤§äº10,æˆ–è€…Longè§£æå‡ºæ¥å¤§äºINT_MAXäº†å°±ç›´æ¥break</span></span><br><span class="line">        <span class="keyword">if</span> (S.charAt(index) == <span class="string">'0'</span> && i>index+<span class="number">1</span> || temp.length()><span class="number">10</span> || Long.valueOf(temp)>Integer.MAX_VALUE) {</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> str=Integer.valueOf(temp);</span><br><span class="line">        <span class="keyword">int</span> one=lis.size()>=<span class="number">2</span> ? lis.get(lis.size()-<span class="number">1</span>):-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> two=lis.size()>=<span class="number">2</span> ? lis.get(lis.size()-<span class="number">2</span>):-<span class="number">1</span>;</span><br><span class="line">        lis.add(str);</span><br><span class="line">        <span class="keyword">if</span> ((one==-<span class="number">1</span> || two==-<span class="number">1</span> || one+two==str) && dfs(S,i,lis)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#10-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a><a href="https://leetcode-cn.com/problems/regular-expression-matching/" target="_blank" rel="noopener">10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> å’Œä¸€ä¸ªå­—ç¬¦è§„å¾‹ <code>p</code>ï¼Œè¯·ä½ æ¥å®ç°ä¸€ä¸ªæ”¯æŒ <code>'.'</code> å’Œ <code>'*'</code> çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">'.'</span> åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</span><br><span class="line"><span class="string">'*'</span> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ </span><br></pre></td></tr></tbody></table></figure></div><p>æ‰€è°“åŒ¹é…ï¼Œæ˜¯è¦æ¶µç›– æ•´ä¸ª å­—ç¬¦ä¸² sçš„ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚</p><p><strong>è¯´æ˜:</strong></p><ul><li>s å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚</li><li>p å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ï¼Œä»¥åŠå­—ç¬¦ . å’Œ *ã€‚</li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s = <span class="string">"aa"</span></span><br><span class="line">p = <span class="string">"a"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br><span class="line">è§£é‡Š: <span class="string">"a"</span> æ— æ³•åŒ¹é… <span class="string">"aa"</span> æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s = <span class="string">"aa"</span></span><br><span class="line">p = <span class="string">"a*"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br><span class="line">è§£é‡Š: å› ä¸º <span class="string">'*'</span> ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ <span class="string">'a'</span>ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² <span class="string">"aa"</span> å¯è¢«è§†ä¸º <span class="string">'a'</span> é‡å¤äº†ä¸€æ¬¡ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s = <span class="string">"ab"</span></span><br><span class="line">p = <span class="string">".*"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br><span class="line">è§£é‡Š: <span class="string">".*"</span> è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ<span class="string">'*'</span>ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ<span class="string">'.'</span>ï¼‰ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s = <span class="string">"aab"</span></span><br><span class="line">p = <span class="string">"c*a*b"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br><span class="line">è§£é‡Š: å› ä¸º <span class="string">'*'</span> è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªï¼Œè¿™é‡Œ <span class="string">'c'</span> ä¸º <span class="number">0</span> ä¸ª, <span class="string">'a'</span> è¢«é‡å¤ä¸€æ¬¡ã€‚å› æ­¤å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² <span class="string">"aab"</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 5:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s = <span class="string">"mississippi"</span></span><br><span class="line">p = <span class="string">"mis*is*p*."</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å›æº¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMatch</span><span class="params">(String s, String p)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> match(s,<span class="number">0</span>,p,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(String s,<span class="keyword">int</span> sIdx, String p,<span class="keyword">int</span> pIdx)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (sIdx>=s.length() && pIdx>=p.length()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (pIdx>=p.length()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è¿™é‡Œçš„åˆ¤æ–­å…¶å®ä¸å¤ªå¯¹,ä¹Ÿä¸èƒ½è¯´ä¸å¯¹,ä¼šç¨å¾®æ…¢ä¸€ç‚¹,å› ä¸ºé¢˜ç›®ä¸­æ˜¯ä¸ä¼šç»™**è¿™æ ·çš„caseçš„</span></span><br><span class="line">    <span class="comment">//å¯ä»¥ç›´æ¥ä¸€æ¬¡è·³ä¸¤æ­¥åˆ¤æ–­æ˜¯ä¸æ˜¯*</span></span><br><span class="line">    <span class="keyword">if</span> (sIdx == s.length()) {</span><br><span class="line">        <span class="comment">//åé¢æ²¡æœ‰*çš„æƒ…å†µ aaa aaaa</span></span><br><span class="line">        <span class="keyword">if</span> (pIdx==p.length()-<span class="number">1</span> && p.charAt(pIdx)!=<span class="string">'*'</span>) { <span class="comment">//pä¹Ÿåˆ°å°½å¤´,å¹¶ä¸”ä¸ä¸º*</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span>(pIdx<p.length()){ <span class="comment">//pæ²¡åˆ°å°½å¤´,æ£€æŸ¥åé¢çš„æ˜¯å¦æœ‰ä¸¤ä¸ªè¿ç»­çš„é*</p.length()){></span><br><span class="line">            <span class="keyword">if</span> (p.charAt(pIdx) != <span class="string">'*'</span> && (pIdx+<span class="number">1</span><p.length() && p.charat(pidx+<span class="number">1</p.length()></span>)!=<span class="string">'*'</span>)) {<br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">            pIdx++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//aaa aaa*c</span></span><br><span class="line">        <span class="keyword">return</span> p.charAt(pIdx-<span class="number">1</span>)==<span class="string">'*'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pIdx+<span class="number">1</span> < p.length() && p.charAt(pIdx+<span class="number">1</span>) ==<span class="string">'*'</span>) { <span class="comment">//pIdxä¸‹ä¸€ä¸ªæ˜¯ *</span></span><br><span class="line">        <span class="comment">//*åŒ¹é…è‡³å°‘ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span> ((s.charAt(sIdx) == p.charAt(pIdx) || p.charAt(pIdx)==<span class="string">'.'</span>) && match(s,sIdx+<span class="number">1</span>,p,pIdx)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//*åŒ¹é…0ä¸ª</span></span><br><span class="line">        <span class="keyword">return</span> match(s,sIdx,p,pIdx+<span class="number">2</span>);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="comment">//pIdxä¸‹ä¸€ä¸ªä¸æ˜¯*</span></span><br><span class="line">        <span class="keyword">if</span> ((p.charAt(pIdx) == s.charAt(sIdx) || p.charAt(pIdx)==<span class="string">'.'</span>) && match(s,sIdx+<span class="number">1</span>,p,pIdx+<span class="number">1</span>)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜è¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œæ¯•ç«Ÿæ˜¯hardé¢˜ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹äº†é¢˜è§£æ‰å†™å‡ºæ¥ï¼Œæ ¸å¿ƒå°±æ˜¯è¦æŠŠé¢˜ç›®æ„æ€ç†è§£å¯¹ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰åšè®°å¿†åŒ–ï¼Œæ‡’å¾—å†™</p><h2 id="äºŒç»´å¹³é¢ä¸Šçš„å›æº¯"><a href="#äºŒç»´å¹³é¢ä¸Šçš„å›æº¯" class="headerlink" title="äºŒç»´å¹³é¢ä¸Šçš„å›æº¯"></a><em><strong>äºŒç»´å¹³é¢ä¸Šçš„å›æº¯</strong></em></h2><h2 id="79-å•è¯æœç´¢"><a href="#79-å•è¯æœç´¢" class="headerlink" title="79. å•è¯æœç´¢"></a><a href="https://leetcode-cn.com/problems/word-search/" target="_blank" rel="noopener">79. å•è¯æœç´¢</a></h2><p>ç»™å®šä¸€ä¸ªäºŒç»´ç½‘æ ¼å’Œä¸€ä¸ªå•è¯ï¼Œæ‰¾å‡ºè¯¥å•è¯æ˜¯å¦å­˜åœ¨äºç½‘æ ¼ä¸­ã€‚</p><p>å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">board =</span><br><span class="line">[</span><br><span class="line">  [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'E'</span>],</span><br><span class="line">  [<span class="string">'S'</span>,<span class="string">'F'</span>,<span class="string">'C'</span>,<span class="string">'S'</span>],</span><br><span class="line">  [<span class="string">'A'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'E'</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ç»™å®š word = <span class="string">"ABCCED"</span>, è¿”å› <span class="keyword">true</span>.</span><br><span class="line">ç»™å®š word = <span class="string">"SEE"</span>, è¿”å› <span class="keyword">true</span>.</span><br><span class="line">ç»™å®š word = <span class="string">"ABCB"</span>, è¿”å› <span class="keyword">false</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å…¶å®å¹¶ä¸éš¾ï¼Œä½†æ˜¯æˆ‘ä¸€å¼€å§‹å°±é’»åˆ°æ­»èƒ¡é‡Œå»äº†ï¼Œæˆ‘ç›´æ¥æ‹¿èµ·æ¥å°±æƒ³çš„æ˜¯æš´åŠ›dfsä»ï¼ˆ0ï¼Œ0ï¼‰å¼€å§‹éå†æ¯ç§æƒ…å†µï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç›¸ç­‰çš„ã€‚ã€‚ã€‚æˆ‘çœŸæ˜¯ä¸ªhapi</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    board =</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">      ['A','B','C','E'],</span></span><br><span class="line"><span class="comment">      ['S','F','C','S'],</span></span><br><span class="line"><span class="comment">      ['A','D','E','E']</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹å‘: å³,ä¸‹,å·¦,ä¸Š</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>},{<span class="number">0</span>,-<span class="number">1</span>},{-<span class="number">1</span>,<span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">exist</span><span class="params">(<span class="keyword">char</span>[][] board, String word)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (board==<span class="keyword">null</span> || word==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">char</span>[] words=word.toCharArray();</span><br><span class="line">    <span class="keyword">boolean</span>[][] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[board.length][board[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<board.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<board[<span class="number">0</board[<span></span>].length;j++) {</board.length;i++)></span><br><span class="line">            <span class="comment">//éå†boardæ¯ä¸ªå…ƒç´ ,ä»¥ä¸ºä¸ªå…ƒç´ ä¸ºèµ·ç‚¹éƒ½è¯•ä¸€ä¸‹</span></span><br><span class="line">            <span class="keyword">if</span>(dfs(board,words,<span class="number">0</span>,i,j,visit)){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dfs</span><span class="params">(<span class="keyword">char</span>[][] board, <span class="keyword">char</span>[] word,<span class="keyword">int</span> index,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">boolean</span>[][] visit)</span> </span>{</span><br><span class="line">    <span class="comment">//éå†åˆ°wordçš„æœ€åä¸€ä¸ªå­—ç¬¦äº†,ç›´æ¥æ¯”è¾ƒå°±å¯ä»¥å¾—å‡ºç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> (index == word.length-<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> word[index] == board[x][y];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     è¿™æ ·å†™å¦‚æœboardåªæœ‰ä¸€ä¸ªå…ƒç´ å°±ä¼šé”™äº†,åé¢çš„isValidä¼šç›´æ¥false,ä½†æ˜¯æœ‰å¯èƒ½wordå°±æ˜¯è¿™ä¸ªboard</span></span><br><span class="line"><span class="comment">     if (index == word.length) {</span></span><br><span class="line"><span class="comment">            return true;</span></span><br><span class="line"><span class="comment">     }*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å½“å…ƒç´ ç›¸ç­‰çš„æ—¶å€™æ‰æœ‰ç»§ç»­çš„å¿…è¦</span></span><br><span class="line">    <span class="keyword">if</span> (board[x][y]==word[index]) {</span><br><span class="line">        visit[x][y]=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<direction.length;i++) {< span><br><span class="line">            <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">            <span class="comment">//ä¿è¯åˆæ³•æ€§</span></span><br><span class="line">            <span class="keyword">if</span> (isValid(board,nx,ny)&&!visit[nx][ny]&&dfs(board,word,index+<span class="number">1</span>,nx,ny,visit)) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        visit[x][y]=<span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(<span class="keyword">char</span>[][] cs,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x>=<span class="number">0</span> && x<cs.length && y>=<span class="number">0</span> && y< cs[<span class="number">0</span>].length;</cs.length></span><br><span class="line">}</span><br></direction.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="200-å²›å±¿æ•°é‡"><a href="#200-å²›å±¿æ•°é‡" class="headerlink" title="200. å²›å±¿æ•°é‡"></a><a href="https://leetcode-cn.com/problems/number-of-islands/" target="_blank" rel="noopener">200. å²›å±¿æ•°é‡</a></h2><p>ç»™å®šä¸€ä¸ªç”± â€˜1â€™ï¼ˆé™†åœ°ï¼‰å’Œ â€˜0â€™ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè®¡ç®—å²›å±¿çš„æ•°é‡ã€‚ä¸€ä¸ªå²›è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”å®ƒæ˜¯é€šè¿‡æ°´å¹³æ–¹å‘æˆ–å‚ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥è€Œæˆçš„ã€‚ä½ å¯ä»¥å‡è®¾ç½‘æ ¼çš„å››ä¸ªè¾¹å‡è¢«æ°´åŒ…å›´</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line"><span class="number">11110</span></span><br><span class="line"><span class="number">11010</span></span><br><span class="line"><span class="number">11000</span></span><br><span class="line"><span class="number">00000</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line"><span class="number">11000</span></span><br><span class="line"><span class="number">11000</span></span><br><span class="line"><span class="number">00100</span></span><br><span class="line"><span class="number">00011</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸Šé¢ä¸€é¢˜ç±»ä¼¼ï¼Œå¾ˆæƒ­æ„§ï¼Œä¸€å¼€å§‹ä¹Ÿæ²¡å†™å‡ºæ¥ï¼Œå†™äº†ä¸ªå¤§æ¦‚ï¼Œç»†èŠ‚æ²¡æœ‰æ‹æ¸…æ¥š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹å‘: å³,ä¸‹,å·¦,ä¸Š</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>},{<span class="number">0</span>,-<span class="number">1</span>},{-<span class="number">1</span>,<span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numIslands</span><span class="params">(<span class="keyword">char</span>[][] grid)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (grid==<span class="keyword">null</span>||grid.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span>[][] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[grid.length][grid[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<grid.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<grid[<span class="number">0</grid[<span></span>].length;j++) {</grid.length;i++)></span><br><span class="line">            <span class="keyword">if</span> (grid[i][j]==<span class="string">'1'</span>&&!visit[i][j]) {</span><br><span class="line">                dfs(grid,i,j,visit);</span><br><span class="line">                res++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">char</span>[][] grid,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">boolean</span>[][] visit)</span> </span>{</span><br><span class="line">    <span class="comment">//å…¶å®æ•´ä¸ªdfsåšçš„å°±æ˜¯å¯¹visit[x][y]æ ‡è®°,æ ‡è®°ä¸ºtrueä»£è¡¨è®¿é—®è¿‡</span></span><br><span class="line">    visit[x][y]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<direction.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (isValid(grid,nx,ny) && !visit[nx][ny] && grid[nx][ny]==<span class="string">'1'</span>) {</span><br><span class="line">            dfs(grid,nx,ny,visit);</span><br><span class="line">            <span class="comment">//æ— éœ€å›æº¯visitçŠ¶æ€</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span>[][] grid,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x>=<span class="number">0</span> && x<grid.length && y>=<span class="number">0</span> && y<grid[<span class="number">0</grid[<span></grid.length></span>].length;</direction.length;i++)></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="130-è¢«å›´ç»•çš„åŒºåŸŸ"><a href="#130-è¢«å›´ç»•çš„åŒºåŸŸ" class="headerlink" title="130. è¢«å›´ç»•çš„åŒºåŸŸ"></a><a href="https://leetcode-cn.com/problems/surrounded-regions/" target="_blank" rel="noopener">130. è¢«å›´ç»•çš„åŒºåŸŸ</a></h2><p>ç»™å®šä¸€ä¸ªäºŒç»´çš„çŸ©é˜µï¼ŒåŒ…å« <code>'X'</code> å’Œ <code>'O'</code>ï¼ˆ<strong>å­—æ¯ O</strong>ï¼‰ã€‚</p><p>æ‰¾åˆ°æ‰€æœ‰è¢« â€˜Xâ€™ å›´ç»•çš„åŒºåŸŸï¼Œå¹¶å°†è¿™äº›åŒºåŸŸé‡Œæ‰€æœ‰çš„ <code>'O'</code> ç”¨ <code>'X'</code> å¡«å……ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">X X X X</span><br><span class="line">X O O X</span><br><span class="line">X X O X</span><br><span class="line">X O X X</span><br></pre></td></tr></tbody></table></figure></div><p>è¿è¡Œä½ çš„å‡½æ•°åï¼ŒçŸ©é˜µå˜ä¸ºï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">X X X X</span><br><span class="line">X X X X</span><br><span class="line">X X X X</span><br><span class="line">X O X X</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£é‡Š:</strong></p><p>è¢«å›´ç»•çš„åŒºé—´ä¸ä¼šå­˜åœ¨äºè¾¹ç•Œä¸Šï¼Œæ¢å¥è¯è¯´ï¼Œä»»ä½•è¾¹ç•Œä¸Šçš„ â€˜Oâ€™ éƒ½ä¸ä¼šè¢«å¡«å……ä¸º â€˜Xâ€™ã€‚ ä»»ä½•ä¸åœ¨è¾¹ç•Œä¸Šï¼Œæˆ–ä¸ä¸è¾¹ç•Œä¸Šçš„ â€˜Oâ€™ ç›¸è¿çš„ â€˜Oâ€™ æœ€ç»ˆéƒ½ä¼šè¢«å¡«å……ä¸º â€˜Xâ€™ã€‚å¦‚æœä¸¤ä¸ªå…ƒç´ åœ¨æ°´å¹³æˆ–å‚ç›´æ–¹å‘ç›¸é‚»ï¼Œåˆ™ç§°å®ƒä»¬æ˜¯â€œç›¸è¿â€çš„</p><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜åœ¨å¾ˆä¹…ä»¥å‰ï¼ˆçœ‹äº†æäº¤è®°å½•æ˜¯ä¸€å¹´å‰çš„ï¼‰å¼€å§‹å­¦dfsçš„æ—¶å€™ï¼Œåœ¨leetcodeæœç´¢åˆ°äº†è¿™ä¸€é¢˜ï¼Œå½“æ—¶ä¹Ÿåšå‡ºæ¥äº†ï¼Œåªä¸è¿‡æ•ˆç‡æ„Ÿäººï¼Œæ”¾ä¸Šæ¥çœ‹çœ‹æ˜¯ä¸ªå•¥ç©æ„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰4ä¸ªæ–¹å‘ï¼ˆé¡ºæ—¶é’ˆ å³...ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[][] direction = { { <span class="number">1</span>, <span class="number">0</span> }, { <span class="number">0</span>, <span class="number">1</span> }, { -<span class="number">1</span>, <span class="number">0</span> }, { <span class="number">0</span>, -<span class="number">1</span> } };</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[][] mark = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(board.length==<span class="number">0</span>) { <span class="keyword">return</span>; }</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¼ è¿›æ¥çš„boardç»™markåˆå§‹åŒ–</span></span><br><span class="line">    mark = <span class="keyword">new</span> <span class="keyword">int</span>[board.length][board[<span class="number">0</span>].length];</span><br><span class="line">    <span class="comment">// éå†è¾¹ç¼˜æ‰¾å‡ºè¾¹ç¼˜çš„ O çš„åæ ‡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < board.length; i++) {</span><br><span class="line">        <span class="keyword">if</span> (board[i][<span class="number">0</span>] == <span class="string">'O'</span>) {</span><br><span class="line">            dfs(<span class="number">0</span>, i, board);</span><br><span class="line">            <span class="comment">//æ‰§è¡Œå®Œä¹‹åå†èµ‹å€¼å½“å‰ä½ç½®çš„O é¿å…åœ¨è¾¹ç¼˜è§’è½çš„é—®é¢˜</span></span><br><span class="line">            mark[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (board[i][board[<span class="number">0</span>].length - <span class="number">1</span>] == <span class="string">'O'</span>) {</span><br><span class="line">            dfs(board[<span class="number">0</span>].length, i, board);</span><br><span class="line">            mark[i][board[<span class="number">0</span>].length - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ä¸Šè¾¹ç¼˜</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < board[<span class="number">0</span>].length; i++) {</span><br><span class="line">        <span class="keyword">if</span> (board[<span class="number">0</span>][i] == <span class="string">'O'</span>) {</span><br><span class="line">            dfs(i, <span class="number">0</span>, board);</span><br><span class="line">            mark[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ä¸‹è¾¹ç¼˜</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < board[<span class="number">0</span>].length; i++) {</span><br><span class="line">        <span class="keyword">if</span> (board[board.length - <span class="number">1</span>][i] == <span class="string">'O'</span>) {</span><br><span class="line">            dfs(i, board.length - <span class="number">1</span>, board);</span><br><span class="line">            mark[board.length - <span class="number">1</span>][i] = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < board.length; i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j < board[<span class="number">0</span>].length; j++) {</span><br><span class="line">            <span class="keyword">if</span> (board[i][j] == <span class="string">'O'</span> && mark[i][j] == <span class="number">0</span>) {</span><br><span class="line">                board[i][j] = <span class="string">'X'</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">char</span>[][] board)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> tx, ty;</span><br><span class="line">    <span class="comment">// é¦–å…ˆåˆ¤æ–­è¾¹ç¼˜ä¸Šæœ‰æ²¡æœ‰ O æœ‰çš„è¯å°†ä¸ä»–è”é€šçš„ O éƒ½åŠ ä¸Šæ ‡è®°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i <= <span class="number">3</span>; i++) {</span><br><span class="line">        <span class="comment">// x=x+direction[i][0]; è¿™æ ·å†™æ¯ä¸ªç‚¹å‘4ä¸ªæ–¹å‘æ‰©å±•å¦‚æœè¿™æ ·å†™ ç‚¹çš„èµ°å‘å°±æœ‰é—®é¢˜äº†</span></span><br><span class="line">        tx = x + direction[i][<span class="number">0</span>];</span><br><span class="line">        ty = y + direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// System.out.println(tx+" "+ty);</span></span><br><span class="line">        <span class="keyword">if</span> (tx < board[<span class="number">0</span>].length && tx >= <span class="number">0</span> && ty < board.length && ty >= <span class="number">0</span> && board[ty][tx] == <span class="string">'O'</span></span><br><span class="line">            && mark[ty][tx] == <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// ä»£è¡¨èµ°è¿‡äº†</span></span><br><span class="line">            mark[ty][tx] = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// è¿™é‡Œæ²¡æœ‰å¤„ç†å¥½ï¼Œæˆ‘çš„dfså‡½æ•°çš„å‚æ•°æ˜¯åæ ‡ä½†æ˜¯å¯¹åº”åˆ°marké‡Œé¢å’Œboardé‡Œé¢å°±ä¸æ˜¯åæ ‡äº†å°±é¢ å€’äº†</span></span><br><span class="line">            <span class="comment">// æ¯”å¦‚æŒ‰ç…§åæ ‡æ¥ 2 , 1 ---->å¯¹åº”åˆ°æ•°ç»„é‡Œé¢å°±æ˜¯ 1 ï¼Œ2</span></span><br><span class="line">            dfs(tx, ty, board);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>21msï¼Œ8% ä¹ä¸€çœ‹å¥½åƒæ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯ä¸ºå•¥è¿™ä¹ˆæ…¢å‘¢ï¼Ÿçœ‹çœ‹ä»Šå¤©ä¸‹åˆé‡æ–°åšçš„è§£</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹å‘: å³,ä¸‹,å·¦,ä¸Š</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>},{<span class="number">0</span>,-<span class="number">1</span>},{-<span class="number">1</span>,<span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (board==<span class="keyword">null</span> || board.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span>[][] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[board.length][board[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">int</span> lx=<span class="number">0</span>,ly=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†4æ¡è¾¹çš„'O',å°†ä¸ç›¸è¿çš„'O'éƒ½æ ‡è®°ä¸ºtrue</span></span><br><span class="line">    <span class="keyword">while</span>(lx<board.length) { < span><br><span class="line">        <span class="keyword">if</span> (board[lx][<span class="number">0</span>]==<span class="string">'O'</span>) { <span class="comment">//å·¦</span></span><br><span class="line">            dfs(board,lx,<span class="number">0</span>,visit);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (board[lx][board[<span class="number">0</span>].length-<span class="number">1</span>] == <span class="string">'O'</span>) { <span class="comment">//å³</span></span><br><span class="line">            dfs(board,lx,board[<span class="number">0</span>].length-<span class="number">1</span>,visit);</span><br><span class="line">        }</span><br><span class="line">        lx++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(ly<board[<span class="number">0</board[<span></span>].length) { </board.length)></span><br><span class="line">        <span class="keyword">if</span> (board[<span class="number">0</span>][ly]==<span class="string">'O'</span>) { <span class="comment">//ä¸Š</span></span><br><span class="line">            dfs(board,<span class="number">0</span>,ly,visit);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (board[board.length-<span class="number">1</span>][ly] == <span class="string">'O'</span>) { <span class="comment">//ä¸‹</span></span><br><span class="line">            dfs(board,board.length-<span class="number">1</span>,ly,visit);   </span><br><span class="line">        }</span><br><span class="line">        ly++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†å°†æ‰€æœ‰visit=falseçš„Oå˜ä¸ºX</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<board.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<board[<span class="number">0</board[<span></span>].length;j++) {</board.length;i++)></span><br><span class="line">            <span class="keyword">if</span> (board[i][j]==<span class="string">'O'</span> && !visit[i][j]) {</span><br><span class="line">                board[i][j]=<span class="string">'X'</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">char</span>[][] board,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">boolean</span>[][] visit)</span> </span>{</span><br><span class="line">    visit[x][y]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<direction.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (isValid(board,nx,ny) && board[nx][ny]==<span class="string">'O'</span> && !visit[nx][ny]) {</span><br><span class="line">            dfs(board,nx,ny,visit);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¯å¦åˆæ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span>[][] grid,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x>=<span class="number">0</span> && x<grid.length && y>=<span class="number">0</span> && y<grid[<span class="number">0</grid[<span></grid.length></span>].length;</direction.length;i++)></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>2msï¼Œæ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯dfsç»™visitæ•°ç»„èµ‹å€¼çš„æ—¶æœºä¸åŒï¼Œä¸€ä¸ªæ˜¯åœ¨å¾ªç¯é‡Œé¢ï¼Œä¸€ä¸ªæ˜¯åœ¨å‡½æ•°å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ç§è§£æ³•å¹¶ä¸ä¼šç«‹å³ç»™è¾¹ç¼˜çš„<code>'O'</code> æ ‡è®°ï¼Œè¿™æ ·å¯¼è‡´çš„é—®é¢˜å°±æ˜¯å®ƒåç»­çš„èŠ‚ç‚¹ä»ç„¶ä¼šæœç´¢åˆ°è¿™ä¸ªè¾¹ç¼˜çš„ <code>'O'</code> è¿™æ ·å°±ä¼šé€ æˆé‡å¤çš„è®¡ç®—ï¼Œæ‰€ä»¥è¯´ï¼Œä¸€å®šè¦æ‹æ¸…æ¥šè¿™ä¸ªè¿‡ç¨‹ï¼Œä¸èƒ½ä¹±å†™</p><h2 id="417-å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜"><a href="#417-å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜" class="headerlink" title="417. å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜"></a><a href="https://leetcode-cn.com/problems/pacific-atlantic-water-flow/" target="_blank" rel="noopener">417. å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜</a></h2><p>ç»™å®šä¸€ä¸ª <code>m x n</code> çš„éè´Ÿæ•´æ•°çŸ©é˜µæ¥è¡¨ç¤ºä¸€ç‰‡å¤§é™†ä¸Šå„ä¸ªå•å…ƒæ ¼çš„é«˜åº¦ã€‚â€œå¤ªå¹³æ´‹â€å¤„äºå¤§é™†çš„å·¦è¾¹ç•Œå’Œä¸Šè¾¹ç•Œï¼Œè€Œâ€œå¤§è¥¿æ´‹â€å¤„äºå¤§é™†çš„å³è¾¹ç•Œå’Œä¸‹è¾¹ç•Œã€‚</p><p>è§„å®šæ°´æµåªèƒ½æŒ‰ç…§ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘æµåŠ¨ï¼Œä¸”åªèƒ½ä»é«˜åˆ°ä½æˆ–è€…åœ¨åŒç­‰é«˜åº¦ä¸ŠæµåŠ¨ã€‚</p><p>è¯·æ‰¾å‡ºé‚£äº›æ°´æµæ—¢å¯ä»¥æµåŠ¨åˆ°â€œå¤ªå¹³æ´‹â€ï¼Œåˆèƒ½æµåŠ¨åˆ°â€œå¤§è¥¿æ´‹â€çš„é™†åœ°å•å…ƒçš„åæ ‡</p><p><strong>æç¤ºï¼š</strong></p><ol><li><p>è¾“å‡ºåæ ‡çš„é¡ºåºä¸é‡è¦</p></li><li><p>m å’Œ n éƒ½å°äº150</p></li></ol><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®šä¸‹é¢çš„ <span class="number">5</span>x5 çŸ©é˜µ:</span><br><span class="line"></span><br><span class="line">  å¤ªå¹³æ´‹ ~   ~   ~   ~   ~ </span><br><span class="line">       ~  <span class="number">1</span>   <span class="number">2</span>   <span class="number">2</span>   <span class="number">3</span>  (<span class="number">5</span>) *</span><br><span class="line">       ~  <span class="number">3</span>   <span class="number">2</span>   <span class="number">3</span>  (<span class="number">4</span>) (<span class="number">4</span>) *</span><br><span class="line">       ~  <span class="number">2</span>   <span class="number">4</span>  (<span class="number">5</span>)  <span class="number">3</span>   <span class="number">1</span>  *</span><br><span class="line">       ~ (<span class="number">6</span>) (<span class="number">7</span>)  <span class="number">1</span>   <span class="number">4</span>   <span class="number">5</span>  *</span><br><span class="line">       ~ (<span class="number">5</span>)  <span class="number">1</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">4</span>  *</span><br><span class="line">          *   *   *   *   * å¤§è¥¿æ´‹</span><br><span class="line"></span><br><span class="line">è¿”å›:</span><br><span class="line"></span><br><span class="line">[[<span class="number">0</span>, <span class="number">4</span>], [<span class="number">1</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">4</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">0</span>], [<span class="number">3</span>, <span class="number">1</span>], [<span class="number">4</span>, <span class="number">0</span>]] (ä¸Šå›¾ä¸­å¸¦æ‹¬å·çš„å•å…ƒ).</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å…¶å®å’Œä¸Šé¢ä¹Ÿæ˜¯å¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡æœ€å¼€å§‹æ²¡æƒ³åˆ°ä¸¤ä¸ªvisitæ•°ç»„æ¥åš</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹å‘é”®</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>},{<span class="number">0</span>,-<span class="number">1</span>},{-<span class="number">1</span>,<span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List<list<integer>> pacificAtlantic(<span class="keyword">int</span>[][] matrix) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    <span class="comment">//leetcodeè€æ˜¯å–œæ¬¢æäº›å¹ºè›¾å­</span></span><br><span class="line">    <span class="keyword">if</span> (matrix==<span class="keyword">null</span> || matrix.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> m=matrix.length;</span><br><span class="line">    <span class="keyword">int</span> n=matrix[<span class="number">0</span>].length;</span><br><span class="line">    <span class="comment">//å¤ªå¹³æ´‹</span></span><br><span class="line">    <span class="keyword">boolean</span>[][] pacific=<span class="keyword">new</span> <span class="keyword">boolean</span>[m][n];</span><br><span class="line">    <span class="comment">//å¤§è¥¿æ´‹</span></span><br><span class="line">    <span class="keyword">boolean</span>[][] atlantic=<span class="keyword">new</span> <span class="keyword">boolean</span>[m][n];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<m;i++) {< span><br><span class="line">        dfs(matrix,i,<span class="number">0</span>,pacific);</span><br><span class="line">        dfs(matrix,i,n-<span class="number">1</span>,atlantic);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<n;i++) {< span><br><span class="line">        dfs(matrix,<span class="number">0</span>,i,pacific);</span><br><span class="line">        dfs(matrix,m-<span class="number">1</span>,i,atlantic);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<m;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<n;j++) {< span><br><span class="line">            <span class="comment">//åŒæ—¶ä¸ºtrueçš„å°±æ˜¯è§£</span></span><br><span class="line">            <span class="keyword">if</span> (pacific[i][j] && atlantic[i][j]) {</span><br><span class="line">                res.add(Arrays.asList(i,j));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span>[][] matrix,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">boolean</span>[][] visit)</span> </span>{</span><br><span class="line">    visit[x][y]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">//å‘4ä¸ªæ–¹å‘floodfill</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<direction.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (isValid(matrix,nx,ny) && matrix[nx][ny]>= matrix[x][y] && !visit[nx][ny]) {</span><br><span class="line">            dfs(matrix,nx,ny,visit);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span>[][] matrix,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x>=<span class="number">0</span> && x<matrix.length && y>=<span class="number">0</span> && y<matrix[<span class="number">0</matrix[<span></matrix.length></span>].length;</direction.length;i++)></span><br><span class="line">}</span><br></n;j++)></span></m;i++)></span></n;i++)></span></m;i++)></span></pre></td></tr></tbody></table></figure></div><p>6msï¼Œ96%ï¼Œè¿˜æ˜¯æ¯”è¾ƒokçš„</p><h2 id="51-Nçš‡å"><a href="#51-Nçš‡å" class="headerlink" title="51. Nçš‡å"></a><a href="https://leetcode-cn.com/problems/n-queens/" target="_blank" rel="noopener">51. Nçš‡å</a></h2><p><em>n</em> çš‡åé—®é¢˜ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† <em>n</em> ä¸ªçš‡åæ”¾ç½®åœ¨ <em>n</em>Ã—<em>n</em> çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191011/ac4lTcAFesSc.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä¸Šå›¾ä¸º 8 çš‡åé—®é¢˜çš„ä¸€ç§è§£æ³•ã€‚</p><p>ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè¿”å›æ‰€æœ‰ä¸åŒçš„ n çš‡åé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>æ¯ä¸€ç§è§£æ³•åŒ…å«ä¸€ä¸ªæ˜ç¡®çš„ n çš‡åé—®é¢˜çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸­ â€˜Qâ€™ å’Œ â€˜ . â€˜ åˆ†åˆ«ä»£è¡¨äº†çš‡åå’Œç©ºä½ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">4</span></span><br><span class="line">è¾“å‡º: [</span><br><span class="line"> [<span class="string">".Q.."</span>,  <span class="comment">// è§£æ³• 1</span></span><br><span class="line">  <span class="string">"...Q"</span>,</span><br><span class="line">  <span class="string">"Q..."</span>,</span><br><span class="line">  <span class="string">"..Q."</span>],</span><br><span class="line"></span><br><span class="line"> [<span class="string">"..Q."</span>,  <span class="comment">// è§£æ³• 2</span></span><br><span class="line">  <span class="string">"Q..."</span>,</span><br><span class="line">  <span class="string">"...Q"</span>,</span><br><span class="line">  <span class="string">".Q.."</span>]</span><br><span class="line">]</span><br><span class="line">è§£é‡Š: <span class="number">4</span> çš‡åé—®é¢˜å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„è§£æ³•</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>Hardé¢˜ï¼ŒNçš‡åé—®é¢˜å¯ä»¥è¯´æ˜¯å¾ˆç»å…¸çš„é—®é¢˜äº†ï¼Œä¹‹å‰æœ‰çœ‹è¿‡ï¼Œä½†æ˜¯éƒ½æ˜¯ä¸€è„¸æ‡µé€¼ï¼Œæ— ä»ä¸‹æ‰‹ï¼Œè¿™ä¸€æ¬¡çœ‹äº†ä¸‹æç¤ºè¿˜æ˜¯è‡ªå·±ç»™åšå‡ºæ¥äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List<list<string>> res=<span class="keyword">new</span> ArrayList<>();</list<string></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[] col;</span><br><span class="line"><span class="comment">//private boolean[] row;</span></span><br><span class="line"><span class="comment">//ä¸¤æ¡å¯¹è§’çº¿</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[] dia1;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[] dia2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List<list<string>> solveNQueens(<span class="keyword">int</span> n) {</list<string></span><br><span class="line">    <span class="keyword">if</span> (n<=<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">    col=<span class="keyword">new</span> <span class="keyword">boolean</span>[n];</span><br><span class="line">    <span class="comment">//row=new boolean[n];</span></span><br><span class="line">    dia1=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>*n-<span class="number">1</span>];</span><br><span class="line">    dia2=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>*n-<span class="number">1</span>];</span><br><span class="line">    dfs(n,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//dfs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> index,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index==n) {</span><br><span class="line">        res.add(generateRes(lis));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æ£€æµ‹ç¬¬indexè¡Œç¬¬iåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<n;i++) {< span><br><span class="line">        <span class="comment">//æ³¨æ„å¯¹è§’çº¿çš„ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">if</span> (!col[i] && !dia1[index-i+n-<span class="number">1</span>] && !dia2[i+index]) {</span><br><span class="line">            col[i]=<span class="keyword">true</span>;</span><br><span class="line">            dia1[index-i+n-<span class="number">1</span>]=<span class="keyword">true</span>;</span><br><span class="line">            dia2[index+i]=<span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">//å°è¯•æ·»åŠ </span></span><br><span class="line">            lis.add(i);</span><br><span class="line">            dfs(n,index+<span class="number">1</span>,lis);</span><br><span class="line">            <span class="comment">//å›æº¯</span></span><br><span class="line">            lis.remove(lis.size()-<span class="number">1</span>);</span><br><span class="line">            col[i]=<span class="keyword">false</span>;</span><br><span class="line">            dia1[index-i+n-<span class="number">1</span>]=<span class="keyword">false</span>;</span><br><span class="line">            dia2[index+i]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®lisç”Ÿæˆè§£</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">generateRes</span><span class="params">(List<integer> lis)</integer></span></string></span>{</span><br><span class="line">    List<string> res=<span class="keyword">new</span> ArrayList<>();</string></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<lis.size();i++) {< span><br><span class="line">        <span class="keyword">int</span> index = lis.get(i);</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<lis.size();j++) {< span><br><span class="line">            <span class="keyword">if</span> (j!=index){</span><br><span class="line">                sb.append(<span class="string">"."</span>);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                sb.append(<span class="string">"Q"</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        res.add(sb.toString());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></lis.size();j++)></span></lis.size();i++)></span></n;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯ï¼šä¸€è¡Œè¡Œéå†ï¼Œç„¶ådfså°è¯•åœ¨æ¯ä¸ªä½ç½®æ”¾ç½®çš‡åï¼Œæˆ‘è§‰å¾—ä¸»è¦çš„éš¾ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­å„ä¸ªåˆ—ï¼Œå¯¹è§’çº¿æ˜¯å¦å·²ç»æœ‰çš‡åï¼Œè¿™ä¸€ç‚¹éœ€è¦ç»†è‡´çš„è§‚å¯Ÿï¼Œæœ‰ä¸€æ¡å¯¹è§’çº¿çš„æ¨ªçºµåæ ‡ä¹‹å’Œä¸ºå¸¸æ•°ï¼Œå¦ä¸€æ¡æ¨ªçºµåæ ‡ä¹‹å·®æ˜¯ä¸ªå¸¸æ•°ï¼Œå€Ÿæ­¤ä¾¿å¯ä»¥å”¯ä¸€ç¡®å®šä¸€æ¡å¯¹è§’çº¿</p><h2 id="52-Nçš‡å-II"><a href="#52-Nçš‡å-II" class="headerlink" title="52. Nçš‡å II"></a><a href="https://leetcode-cn.com/problems/n-queens-ii/" target="_blank" rel="noopener">52. Nçš‡å II</a></h2><p>å’Œä¸Šé¢ä¸€é¢˜ä¸åŒçš„åœ°æ–¹æ˜¯è¿™é¢˜åªéœ€è¦æ±‚è§£çš„ä¸ªæ•°ï¼Œæ„Ÿè§‰è¿™é¢˜æ‰åº”è¯¥æ˜¯<code>â… </code>ï¼Œä¸ç”¨æ±‚æ‰€æœ‰çš„è§£ï¼Œè²Œä¼¼æ›´åŠ ç®€å•äº†ï¼Ÿ</p><p><strong>è§£æ³•ä¸€</strong></p><p>ç›´æ¥å¥—ç”¨ä¸Šé¢çš„ä»£ç ï¼Œæ²¡å•¥å¥½è¯´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">totalNQueens</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (n<=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    col=<span class="keyword">new</span> <span class="keyword">boolean</span>[n];</span><br><span class="line">    <span class="comment">//row=new boolean[n];</span></span><br><span class="line">    dia1=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>*n-<span class="number">1</span>];</span><br><span class="line">    dia2=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>*n-<span class="number">1</span>];</span><br><span class="line">    dfs(n,<span class="number">0</span>,<span class="keyword">new</span> ArrayList());</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[] col;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[] dia1;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[] dia2;</span><br><span class="line"></span><br><span class="line"><span class="comment">//dfs</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> index,List<integer> lis)</integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index==n) {</span><br><span class="line">        res++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æ£€æµ‹ç¬¬indexè¡Œç¬¬iåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<n;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!col[i] && !dia1[index-i+n-<span class="number">1</span>] && !dia2[i+index]) {</span><br><span class="line">            col[i]=<span class="keyword">true</span>;</span><br><span class="line">            dia1[index-i+n-<span class="number">1</span>]=<span class="keyword">true</span>;</span><br><span class="line">            dia2[index+i]=<span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">//ä¸ç”¨æ·»åŠ åˆ°lisä¸­</span></span><br><span class="line">            dfs(n,index+<span class="number">1</span>,lis);</span><br><span class="line">            <span class="comment">//å›æº¯</span></span><br><span class="line">            col[i]=<span class="keyword">false</span>;</span><br><span class="line">            dia1[index-i+n-<span class="number">1</span>]=<span class="keyword">false</span>;</span><br><span class="line">            dia2[index+i]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></n;i++)></span></pre></td></tr></tbody></table></figure></div><p>è™½ç„¶æäº¤äº†ä¹Ÿæ˜¯1msï¼Œä¸»è¦æ˜¯è¿™ä¸¤é¢˜caseéƒ½æ¯”è¾ƒå°‘ï¼Œæœ€å¤§çš„caseå¥½åƒåªåˆ°11ï¼Œæ‰€ä»¥å·®è·ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œæˆ‘è¿™æ ·åšè‚¯å®šä¸æ˜¯è¿™é¢˜çš„æœ€ä¼˜è§£ï¼Œè¿™é¢˜çš„æœ€ä¼˜è§£æ˜¯åˆ©ç”¨<code>ä½å›¾ï¼ˆbitmapï¼‰</code>ä½œä½è¿ç®—ï¼Œåæ­£æˆ‘ä¸å¯èƒ½å†™å‡ºæ¥å°±æ˜¯äº†ğŸ˜‚ <a href="http://www.ic-net.or.jp/home/takaken/e/queen/" target="_blank" rel="noopener">å‚è€ƒ</a></p><h2 id="37-è§£æ•°ç‹¬"><a href="#37-è§£æ•°ç‹¬" class="headerlink" title="37. è§£æ•°ç‹¬"></a><a href="https://leetcode-cn.com/problems/sudoku-solver/" target="_blank" rel="noopener">37. è§£æ•°ç‹¬</a></h2><p>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œé€šè¿‡å·²å¡«å……çš„ç©ºæ ¼æ¥è§£å†³æ•°ç‹¬é—®é¢˜ã€‚</p><p>ä¸€ä¸ªæ•°ç‹¬çš„è§£æ³•éœ€éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š</p><p>æ•°å­— <code>1-9</code> åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚<br>æ•°å­— <code>1-9</code> åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚<br>æ•°å­— 1-9 åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ <code>3x3</code> å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚<br>ç©ºç™½æ ¼ç”¨ <code>'.'</code> è¡¨ç¤ºã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191012/jvSukv6RnXFL.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä¸€ä¸ªæ•°ç‹¬</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191012/XgTokVUgo5Yy.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ç­”æ¡ˆè¢«æ ‡æˆçº¢è‰²ã€‚</p><p><strong>Note:</strong></p><ul><li>ç»™å®šçš„æ•°ç‹¬åºåˆ—åªåŒ…å«æ•°å­— <code>1-9</code> å’Œå­—ç¬¦ <code>'.'</code> </li><li>ä½ å¯ä»¥å‡è®¾ç»™å®šçš„æ•°ç‹¬åªæœ‰å”¯ä¸€è§£ã€‚</li><li>ç»™å®šæ•°ç‹¬æ°¸è¿œæ˜¯ <code>9x9</code> å½¢å¼çš„ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å—¯ï¼Œåˆæ˜¯ä¸€é“hardé¢˜ï¼Œè‡ªå·±æ‘¸äº†åŠå¤©æ²¡åšå‡ºæ¥ï¼Œçœ‹äº†è¯„è®ºåŒºåšå‡ºæ¥çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸‰ä¸ªçº¦æŸè§„åˆ™</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[][] col=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[][] row=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span>[][] block=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">solveSudoku</span><span class="params">(<span class="keyword">char</span>[][] board)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (board==<span class="keyword">null</span> || board.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">9</span>;i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<<span class="number">9</span>;j++) {</span><br><span class="line">            <span class="keyword">if</span> (board[i][j]!=<span class="string">'.'</span>) {</span><br><span class="line">                col[i][board[i][j]-<span class="number">48</span>-<span class="number">1</span>]=<span class="keyword">true</span>;</span><br><span class="line">                row[j][board[i][j]-<span class="number">48</span>-<span class="number">1</span>]=<span class="keyword">true</span>;</span><br><span class="line">                <span class="comment">//å—å·ä¸º i/3*3+j/3</span></span><br><span class="line">                block[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][board[i][j]-<span class="number">48</span>-<span class="number">1</span>]=<span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    dfs(board,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//private  static char[][] res=new char[9][9];</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dfs</span><span class="params">(<span class="keyword">char</span>[][] board,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span> </span>{</span><br><span class="line">    <span class="comment">//ä»,i,jä½ç½®å‘åå¯»æ‰¾'.', i>=9è¯´æ˜å…¨éƒ¨å¡«å……å®Œäº†</span></span><br><span class="line">    <span class="keyword">while</span>(board[i][j]!=<span class="string">'.'</span>) {</span><br><span class="line">        j++;</span><br><span class="line">        <span class="keyword">if</span> (j==<span class="number">9</span>) {</span><br><span class="line">            i++;</span><br><span class="line">            j=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//over</span></span><br><span class="line">        <span class="keyword">if</span> (i==<span class="number">9</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//System.out.println(i+","+j);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> val=<span class="number">0</span>;val<<span class="number">9</span>;val++) {</span><br><span class="line">        <span class="keyword">if</span> (!col[i][val] && !row[j][val] && !block[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][val]) {</span><br><span class="line">            col[i][val]=<span class="keyword">true</span>;</span><br><span class="line">            row[j][val]=<span class="keyword">true</span>;</span><br><span class="line">            block[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][val]=<span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">//å°è¯•å¡«å……ä¸º val+1</span></span><br><span class="line">            board[i][j]=(<span class="keyword">char</span>)(val+<span class="number">1</span>+<span class="number">48</span>);</span><br><span class="line">            <span class="comment">//å°è¯•åé¢çš„'.',è¿™é‡Œä¼ è¿›å»è¿˜æ˜¯i,j</span></span><br><span class="line">            <span class="comment">//å¤§è„‘æ¨¡æ‹Ÿä¸‹å…¶å®è¿™ä¸ªdfsè¿‡ç¨‹ä¹ŸæŒºç®€å•</span></span><br><span class="line">            <span class="keyword">if</span>(dfs(board,i,j)){<span class="comment">//è¿™é‡Œä¼šå°è¯•æ‰€æœ‰è§£ï¼Œå¤±è´¥åå›æº¯</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="comment">//å›æº¯</span></span><br><span class="line">                board[i][j]=<span class="string">'.'</span>;</span><br><span class="line">                col[i][val]=<span class="keyword">false</span>;</span><br><span class="line">                row[j][val]=<span class="keyword">false</span>;</span><br><span class="line">                block[i/<span class="number">3</span>*<span class="number">3</span>+j/<span class="number">3</span>][val]=<span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ¯”ä¸Šé¢çš„Nçš‡åè¦æ›´å¤æ‚ï¼ŒåŒæ ·ä¹Ÿæ˜¯å¸¦æœ‰çº¦æŸçš„dfså›æº¯ï¼Œæˆ‘ä¸€å¼€å§‹å†™çš„æ–¹æ³•ä¸»è¦æ˜¯æ€è·¯éƒ½é”™äº†ï¼Œæˆ‘æƒ³çš„å’Œä¸Šé¢nçš‡åä¸€æ ·ï¼Œä¸€å±‚ä¸€å±‚çš„æœç´¢æœ€ån==9å°±ç»“æŸï¼Œä½†æ˜¯æ²¡è€ƒè™‘åˆ°ä¸€å±‚å…¶å®ä¸åªæœ‰ä¸€ä¸ª<code>ç©ºä½</code>ï¼ŒåŒæ—¶è¿˜è¦æ³¨æ„å›æº¯çš„æ—¶æœºï¼Œå¹¶ä¸æ˜¯dfsä¹‹åå°±å›æº¯ï¼Œç”¨å¤§è„‘æ¨¡æ‹Ÿä¸‹è¿™ä¸ªé€’å½’å…¶å®å°±æ˜ç™½äº†ï¼Œæˆ‘è§‰å¾—æ ¸å¿ƒè¿˜æ˜¯<code>æ‰¾'.'é‚£ä¸€æ­¥</code>ï¼Œè¿™ä¸€æ­¥ç¡®å®æ²¡æƒ³åˆ°</p><blockquote><p>è¿™é¢˜æœ‰ä¸€ä¸ªç®€å•ç‰ˆï¼Œ<a href="https://leetcode-cn.com/problems/valid-sudoku/" target="_blank" rel="noopener">36. æœ‰æ•ˆçš„æ•°ç‹¬</a> æŒºç®€å•çš„ï¼Œæ‡’å¾—åšäº†</p></blockquote><h2 id="529-æ‰«é›·æ¸¸æˆ"><a href="#529-æ‰«é›·æ¸¸æˆ" class="headerlink" title="529. æ‰«é›·æ¸¸æˆ"></a><a href="https://leetcode-cn.com/problems/minesweeper/" target="_blank" rel="noopener">529. æ‰«é›·æ¸¸æˆ</a></h2><p>è®©æˆ‘ä»¬ä¸€èµ·æ¥ç©æ‰«é›·æ¸¸æˆï¼</p><p>ç»™å®šä¸€ä¸ªä»£è¡¨æ¸¸æˆæ¿çš„äºŒç»´å­—ç¬¦çŸ©é˜µã€‚ â€˜Mâ€™ ä»£è¡¨ä¸€ä¸ªæœªæŒ–å‡ºçš„åœ°é›·ï¼Œâ€™Eâ€™ ä»£è¡¨ä¸€ä¸ªæœªæŒ–å‡ºçš„ç©ºæ–¹å—ï¼Œâ€™Bâ€™ ä»£è¡¨æ²¡æœ‰ç›¸é‚»ï¼ˆä¸Šï¼Œä¸‹ï¼Œå·¦ï¼Œå³ï¼Œå’Œæ‰€æœ‰4ä¸ªå¯¹è§’çº¿ï¼‰åœ°é›·çš„å·²æŒ–å‡ºçš„ç©ºç™½æ–¹å—ï¼Œæ•°å­—ï¼ˆâ€™1â€™ åˆ° â€˜8â€™ï¼‰è¡¨ç¤ºæœ‰å¤šå°‘åœ°é›·ä¸è¿™å—å·²æŒ–å‡ºçš„æ–¹å—ç›¸é‚»ï¼Œâ€™Xâ€™ åˆ™è¡¨ç¤ºä¸€ä¸ªå·²æŒ–å‡ºçš„åœ°é›·ã€‚</p><p>ç°åœ¨ç»™å‡ºåœ¨æ‰€æœ‰æœªæŒ–å‡ºçš„æ–¹å—ä¸­ï¼ˆâ€™Mâ€™æˆ–è€…â€™Eâ€™ï¼‰çš„ä¸‹ä¸€ä¸ªç‚¹å‡»ä½ç½®ï¼ˆè¡Œå’Œåˆ—ç´¢å¼•ï¼‰ï¼Œæ ¹æ®ä»¥ä¸‹è§„åˆ™ï¼Œè¿”å›ç›¸åº”ä½ç½®è¢«ç‚¹å‡»åå¯¹åº”çš„é¢æ¿ï¼š</p><ol><li>å¦‚æœä¸€ä¸ªåœ°é›·ï¼ˆâ€™Mâ€™ï¼‰è¢«æŒ–å‡ºï¼Œæ¸¸æˆå°±ç»“æŸäº†- æŠŠå®ƒæ”¹ä¸º â€˜Xâ€™ã€‚</li><li>å¦‚æœä¸€ä¸ªæ²¡æœ‰ç›¸é‚»åœ°é›·çš„ç©ºæ–¹å—ï¼ˆâ€™Eâ€™ï¼‰è¢«æŒ–å‡ºï¼Œä¿®æ”¹å®ƒä¸ºï¼ˆâ€™Bâ€™ï¼‰ï¼Œå¹¶ä¸”æ‰€æœ‰å’Œå…¶ç›¸é‚»çš„æ–¹å—éƒ½åº”è¯¥è¢«é€’å½’åœ°æ­éœ²ã€‚</li><li>å¦‚æœä¸€ä¸ªè‡³å°‘ä¸ä¸€ä¸ªåœ°é›·ç›¸é‚»çš„ç©ºæ–¹å—ï¼ˆâ€™Eâ€™ï¼‰è¢«æŒ–å‡ºï¼Œä¿®æ”¹å®ƒä¸ºæ•°å­—ï¼ˆâ€™1â€™åˆ°â€™8â€™ï¼‰ï¼Œè¡¨ç¤ºç›¸é‚»åœ°é›·çš„æ•°é‡ã€‚</li><li>å¦‚æœåœ¨æ­¤æ¬¡ç‚¹å‡»ä¸­ï¼Œè‹¥æ— æ›´å¤šæ–¹å—å¯è¢«æ­éœ²ï¼Œåˆ™è¿”å›é¢æ¿ã€‚</li></ol><p><strong>ç¤ºä¾‹ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line"></span><br><span class="line">[[<span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>],</span><br><span class="line"> [<span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'M'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>],</span><br><span class="line"> [<span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>],</span><br><span class="line"> [<span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>, <span class="string">'E'</span>]]</span><br><span class="line"></span><br><span class="line">Click : [<span class="number">3</span>,<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">Output: </span><br><span class="line"></span><br><span class="line">[[<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'E'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'M'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Explanation:</strong></p><p><img alt="æ‰«é›·" data-src="https://i.loli.net/2019/11/18/B26DWk8CrhPFtHI.png" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¤ºä¾‹äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line"></span><br><span class="line">[[<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'E'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'M'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>]]</span><br><span class="line"></span><br><span class="line">Click : [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">Output: </span><br><span class="line"></span><br><span class="line">[[<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'E'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'X'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'B'</span>],</span><br><span class="line"> [<span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Explanation:</strong></p><p><img alt="æ‰«é›·" data-src="https://s2.ax1x.com/2019/11/18/MyccWT.png" src="/img/loading.gif" class="lazyload"></p><p><strong>è§£æ³•ä¸€</strong></p><p>æ ‡å‡†çš„DFSï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå‘8ä¸ªæ–¹å‘æ‰©å±•ï¼Œé‡åˆ°å‘¨å›´æœ‰åœ°é›·çš„å°±è®¡æ•°å¹¶ä¸”åœæ­¢ï¼Œä¼šç©æ‰«é›·å°±ä¼šåšğŸ˜‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>},{-<span class="number">1</span>,<span class="number">1</span>},{<span class="number">1</span>,-<span class="number">1</span>},{-<span class="number">1</span>,<span class="number">0</span>},{<span class="number">0</span>,-<span class="number">1</span>},{-<span class="number">1</span>,-<span class="number">1</span>},{<span class="number">1</span>,<span class="number">1</span>}};</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">char</span>[][] updateBoard(<span class="keyword">char</span>[][] board, <span class="keyword">int</span>[] click) {</span><br><span class="line">    <span class="keyword">int</span> x=click[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> y=click[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (board[x][y]==<span class="string">'M'</span>) {</span><br><span class="line">        board[x][y]=<span class="string">'X'</span>;</span><br><span class="line">        <span class="keyword">return</span> board;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span>[][] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[board.length][board[<span class="number">0</span>].length];</span><br><span class="line">    dfs(board,x,y,visit);</span><br><span class="line">    <span class="keyword">return</span> board;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">char</span>[][] board,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">boolean</span>[][] visit)</span></span>{</span><br><span class="line">    visit[x][y]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">int</span> count=getRoundBoom(board,x,y);</span><br><span class="line">    <span class="keyword">if</span>(count!=<span class="number">0</span>){</span><br><span class="line">        board[x][y]=(<span class="keyword">char</span>)(count+<span class="string">'0'</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    board[x][y]=<span class="string">'B'</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">8</span>;i++) {</span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (isValid(board,nx,ny) && !visit[nx][ny] && board[nx][ny]!=<span class="string">'M'</span>) {</span><br><span class="line">            dfs(board,nx,ny,visit);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRoundBoom</span><span class="params">(<span class="keyword">char</span>[][] board,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">8</span>;i++) {</span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (isValid(board,nx,ny) && board[nx][ny]==<span class="string">'M'</span>) {</span><br><span class="line">            count++;</span><br><span class="line">        }   </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span>[][] board,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x>=<span class="number">0</span> && x<board.length && y>=<span class="number">0</span> && y<board[<span class="number">0</board[<span></board.length></span>].length;<br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="695-å²›å±¿çš„æœ€å¤§é¢ç§¯"><a href="#695-å²›å±¿çš„æœ€å¤§é¢ç§¯" class="headerlink" title="695. å²›å±¿çš„æœ€å¤§é¢ç§¯"></a><a href="https://leetcode-cn.com/problems/max-area-of-island/" target="_blank" rel="noopener">695. å²›å±¿çš„æœ€å¤§é¢ç§¯</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å«äº†ä¸€äº› 0 å’Œ 1çš„éç©ºäºŒç»´æ•°ç»„ <code>grid</code> , ä¸€ä¸ª <code>å²›å±¿</code> æ˜¯ç”±å››ä¸ªæ–¹å‘ (æ°´å¹³æˆ–å‚ç›´) çš„ 1 (ä»£è¡¨åœŸåœ°) æ„æˆçš„ç»„åˆã€‚ä½ å¯ä»¥å‡è®¾äºŒç»´çŸ©é˜µçš„å››ä¸ªè¾¹ç¼˜éƒ½è¢«æ°´åŒ…å›´ç€ã€‚</p><p>æ‰¾åˆ°ç»™å®šçš„äºŒç»´æ•°ç»„ä¸­æœ€å¤§çš„å²›å±¿é¢ç§¯ã€‚(å¦‚æœæ²¡æœ‰å²›å±¿ï¼Œåˆ™è¿”å›é¢ç§¯ä¸º0)</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p>å¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçŸ©é˜µåº”è¿”å› 6ã€‚æ³¨æ„ç­”æ¡ˆä¸åº”è¯¥æ˜¯11ï¼Œå› ä¸ºå²›å±¿åªèƒ½åŒ…å«æ°´å¹³æˆ–å‚ç›´çš„å››ä¸ªæ–¹å‘çš„ <code>â€˜1â€™</code>ã€‚</p><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p>å¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçš„çŸ©é˜µ, è¿”å› 0</p><p><strong>æ³¨æ„:</strong> ç»™å®šçš„çŸ©é˜µgrid çš„é•¿åº¦å’Œå®½åº¦éƒ½ä¸è¶…è¿‡ 50ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸Šé¢ <a href="#200-å²›å±¿æ•°é‡">200é¢˜å²›å±¿çš„æ•°é‡</a>å¾ˆç±»ä¼¼ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œè¦è®¡ç®—çš„æ˜¯æœ€å¤§çš„é¢ç§¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">0</span>,-<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>},{-<span class="number">1</span>,<span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxAreaOfIsland</span><span class="params">(<span class="keyword">int</span>[][] grid)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (grid==<span class="keyword">null</span> || grid.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span>[][] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[grid.length][grid[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<grid.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<grid[<span class="number">0</grid[<span></span>].length;j++) {</grid.length;i++)></span><br><span class="line">            <span class="keyword">if</span> (grid[i][j]==<span class="number">1</span> &&!visit[i][j]) {</span><br><span class="line">                <span class="keyword">int</span> t=dfs(grid,i,j,visit);</span><br><span class="line">                max=max>t?max:t;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> max=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span>[][] grid,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">boolean</span>[][] visit)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> temp=<span class="number">1</span>;</span><br><span class="line">    visit[x][y]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<direction.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (isValid(grid,nx,ny) && grid[nx][ny]==<span class="number">1</span> && !visit[nx][ny]) {</span><br><span class="line">            <span class="comment">//å°†4ä¸ªæ–¹å‘çš„ç¬¦åˆæ¡ä»¶çš„æ•°é‡åŠ èµ·æ¥</span></span><br><span class="line">            temp+=dfs(grid,nx,ny,visit);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span>[][] grid,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x>=<span class="number">0</span> && x<grid.length && y>=<span class="number">0</span> && y<grid[<span class="number">0</grid[<span></grid.length></span>].length;</direction.length;i++)></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æœ€å¼€å§‹ç›´æ¥åœ¨dfså‡½æ•°é‡Œé¢ç”¨countè®¡æ•°ï¼Œå±…ç„¶è¿˜è¿‡äº†600å¤šä¸ªcaseâ€¦..æƒŠäº†ï¼Œé‚£ç§åšæ³•å®Œå…¨æ˜¯é”™çš„ï¼Œè¯´å®è¯æœ‰ç‚¹ä¸å¤ªä¹ æƒ¯å†™æœ‰è¿”å›å€¼çš„é€’å½’</p><h2 id="547-æœ‹å‹åœˆ"><a href="#547-æœ‹å‹åœˆ" class="headerlink" title="547. æœ‹å‹åœˆ"></a><a href="https://leetcode-cn.com/problems/friend-circles/" target="_blank" rel="noopener">547. æœ‹å‹åœˆ</a></h2><p>ç­ä¸Šæœ‰ N åå­¦ç”Ÿã€‚å…¶ä¸­æœ‰äº›äººæ˜¯æœ‹å‹ï¼Œæœ‰äº›åˆ™ä¸æ˜¯ã€‚ä»–ä»¬çš„å‹è°Šå…·æœ‰æ˜¯ä¼ é€’æ€§ã€‚å¦‚æœå·²çŸ¥ A æ˜¯ B çš„æœ‹å‹ï¼ŒB æ˜¯ C çš„æœ‹å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¤ä¸º A ä¹Ÿæ˜¯ C çš„æœ‹å‹ã€‚æ‰€è°“çš„æœ‹å‹åœˆï¼Œæ˜¯æŒ‡æ‰€æœ‰æœ‹å‹çš„é›†åˆã€‚</p><p>ç»™å®šä¸€ä¸ª N * N çš„çŸ©é˜µ Mï¼Œè¡¨ç¤ºç­çº§ä¸­å­¦ç”Ÿä¹‹é—´çš„æœ‹å‹å…³ç³»ã€‚å¦‚æœM[i] [j] = 1ï¼Œè¡¨ç¤ºå·²çŸ¥ç¬¬ i ä¸ªå’Œ j ä¸ªå­¦ç”Ÿäº’ä¸ºæœ‹å‹å…³ç³»ï¼Œå¦åˆ™ä¸ºä¸çŸ¥é“ã€‚ä½ å¿…é¡»è¾“å‡ºæ‰€æœ‰å­¦ç”Ÿä¸­çš„å·²çŸ¥çš„æœ‹å‹åœˆæ€»æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">[[<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line">è¾“å‡º: <span class="number">2</span> </span><br><span class="line">è¯´æ˜ï¼šå·²çŸ¥å­¦ç”Ÿ<span class="number">0</span>å’Œå­¦ç”Ÿ<span class="number">1</span>äº’ä¸ºæœ‹å‹ï¼Œä»–ä»¬åœ¨ä¸€ä¸ªæœ‹å‹åœˆã€‚</span><br><span class="line">ç¬¬<span class="number">2</span>ä¸ªå­¦ç”Ÿè‡ªå·±åœ¨ä¸€ä¸ªæœ‹å‹åœˆã€‚æ‰€ä»¥è¿”å›<span class="number">2</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">[[<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>]]</span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br><span class="line">è¯´æ˜ï¼šå·²çŸ¥å­¦ç”Ÿ<span class="number">0</span>å’Œå­¦ç”Ÿ<span class="number">1</span>äº’ä¸ºæœ‹å‹ï¼Œå­¦ç”Ÿ<span class="number">1</span>å’Œå­¦ç”Ÿ<span class="number">2</span>äº’ä¸ºæœ‹å‹ï¼Œæ‰€ä»¥å­¦ç”Ÿ<span class="number">0</span>å’Œå­¦ç”Ÿ<span class="number">2</span>ä¹Ÿæ˜¯æœ‹å‹ï¼Œæ‰€ä»¥ä»–ä»¬ä¸‰ä¸ªåœ¨ä¸€ä¸ªæœ‹å‹åœˆï¼Œè¿”å›<span class="number">1</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>N åœ¨[1,200]çš„èŒƒå›´å†…ã€‚</li><li>å¯¹äºæ‰€æœ‰å­¦ç”Ÿï¼Œæœ‰M[i] [i] = 1ã€‚</li><li>å¦‚æœæœ‰M[i] [j] = 1ï¼Œåˆ™æœ‰M[j] [i] = 1ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findCircleNum</span><span class="params">(<span class="keyword">int</span>[][] M)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (M==<span class="keyword">null</span> || M.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[M.length];</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<m.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!visit[i]) {</span><br><span class="line">            dfs(M,visit,i);</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸€å…±m.lengthä¸ªäºº</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span>[][] M,<span class="keyword">boolean</span>[] visit,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">    <span class="comment">//æ ‡è®°indexå·å­¦ç”Ÿå·²ç»è®¿é—®è¿‡</span></span><br><span class="line">    visit[index]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<m.length;i++) {< span><br><span class="line">        <span class="comment">//indexå’Œiæ˜¯å¥½æœ‹å‹</span></span><br><span class="line">        <span class="keyword">if</span> (M[index][i]==<span class="number">1</span> && !visit[i]) {</span><br><span class="line">            <span class="comment">//é€’å½’æ ‡è®°içš„å¥½æœ‹å‹,å½¢æˆæœ‹å‹åœˆ</span></span><br><span class="line">            dfs(M,visit,i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></m.length;i++)></span></m.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜ä¸çŸ¥é“ä¸ºå•¥ï¼Œä¸€å¼€å§‹é¢˜ç›®æ²¡ææ˜ç™½ã€‚ã€‚ã€‚ã€‚å»çº ç»“é‚£ä¸ªçŸ©é˜µå»äº†ï¼Œæ²¡ç†è§£å¥½é¢˜ç›®çš„æ„æ€ï¼Œå…¶å®è·Ÿé‚£ä¸ªN*Nçš„çŸ©é˜µæ²¡å•¥å…³ç³»ï¼Œä¸»è¦æ˜¯Nä¸ªäººï¼Œå¯¹æ¯ä¸ªäººè¿›è¡Œdfsæ‰¾åˆ°ä¸ä»–ä»¬ç›¸å…³çš„äººï¼Œåšå¥½ç»Ÿè®¡å°±okï¼Œå’Œä¸Šé¢çš„ 200é¢˜ä¹Ÿå¾ˆç±»ä¼¼</p><h2 id="1219-é»„é‡‘çŸ¿å·¥"><a href="#1219-é»„é‡‘çŸ¿å·¥" class="headerlink" title="1219. é»„é‡‘çŸ¿å·¥"></a><a href="https://leetcode-cn.com/problems/path-with-maximum-gold/" target="_blank" rel="noopener">1219. é»„é‡‘çŸ¿å·¥</a></h2><p>ä½ è¦å¼€å‘ä¸€åº§é‡‘çŸ¿ï¼Œåœ°è´¨å‹˜æµ‹å­¦å®¶å·²ç»æ¢æ˜äº†è¿™åº§é‡‘çŸ¿ä¸­çš„èµ„æºåˆ†å¸ƒï¼Œå¹¶ç”¨å¤§å°ä¸º m * n çš„ç½‘æ ¼ grid è¿›è¡Œäº†æ ‡æ³¨ã€‚æ¯ä¸ªå•å…ƒæ ¼ä¸­çš„æ•´æ•°å°±è¡¨ç¤ºè¿™ä¸€å•å…ƒæ ¼ä¸­çš„é»„é‡‘æ•°é‡ï¼›å¦‚æœè¯¥å•å…ƒæ ¼æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°±æ˜¯ 0ã€‚</p><p>ä¸ºäº†ä½¿æ”¶ç›Šæœ€å¤§åŒ–ï¼ŒçŸ¿å·¥éœ€è¦æŒ‰ä»¥ä¸‹è§„åˆ™æ¥å¼€é‡‡é»„é‡‘ï¼š</p><ul><li>æ¯å½“çŸ¿å·¥è¿›å…¥ä¸€ä¸ªå•å…ƒï¼Œå°±ä¼šæ”¶é›†è¯¥å•å…ƒæ ¼ä¸­çš„æ‰€æœ‰é»„é‡‘ã€‚</li><li>çŸ¿å·¥æ¯æ¬¡å¯ä»¥ä»å½“å‰ä½ç½®å‘ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘èµ°ã€‚</li><li>æ¯ä¸ªå•å…ƒæ ¼<strong>åªèƒ½è¢«å¼€é‡‡ï¼ˆè¿›å…¥ï¼‰ä¸€æ¬¡</strong>ã€‚</li><li><strong>ä¸å¾—å¼€é‡‡</strong>ï¼ˆè¿›å…¥ï¼‰é»„é‡‘æ•°ç›®ä¸º 0 çš„å•å…ƒæ ¼ã€‚</li><li>çŸ¿å·¥å¯ä»¥ä»ç½‘æ ¼ä¸­ <strong>ä»»æ„ä¸€ä¸ª</strong> æœ‰é»„é‡‘çš„å•å…ƒæ ¼å‡ºå‘æˆ–è€…æ˜¯åœæ­¢ã€‚  </li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šgrid = [[<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>],[<span class="number">5</span>,<span class="number">8</span>,<span class="number">7</span>],[<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>]]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">24</span></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">[[<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">5</span>,<span class="number">8</span>,<span class="number">7</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>]]</span><br><span class="line">ä¸€ç§æ”¶é›†æœ€å¤šé»„é‡‘çš„è·¯çº¿æ˜¯ï¼š<span class="number">9</span> -> <span class="number">8</span> -> <span class="number">7</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šgrid = [[<span class="number">1</span>,<span class="number">0</span>,<span class="number">7</span>],[<span class="number">2</span>,<span class="number">0</span>,<span class="number">6</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>],[<span class="number">9</span>,<span class="number">0</span>,<span class="number">20</span>]]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">28</span></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">[[<span class="number">1</span>,<span class="number">0</span>,<span class="number">7</span>],</span><br><span class="line"> [<span class="number">2</span>,<span class="number">0</span>,<span class="number">6</span>],</span><br><span class="line"> [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line"> [<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>],</span><br><span class="line"> [<span class="number">9</span>,<span class="number">0</span>,<span class="number">20</span>]]</span><br><span class="line">ä¸€ç§æ”¶é›†æœ€å¤šé»„é‡‘çš„è·¯çº¿æ˜¯ï¼š<span class="number">1</span> -> <span class="number">2</span> -> <span class="number">3</span> -> <span class="number">4</span> -> <span class="number">5</span> -> <span class="number">6</span> -> <span class="number">7</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li>-<code>1 <= grid.length, grid[i].length <= 15</code></li><li><code>0 <= grid[i][j] <= 100</code></li><li>æœ€å¤š 25 ä¸ªå•å…ƒæ ¼ä¸­æœ‰é»„é‡‘ã€‚ </li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¡«è¡¥äº†æˆ‘ä¸€ç‚¹äºŒç»´å¹³é¢å›æº¯çš„ç©ºç¼ºï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼ˆæ”¹äº†å¥½å‡ ä¸ªå°æ—¶è¿˜å¥½æ„æ€è¯´è¿™ç§è¯ğŸ˜‚ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>},{<span class="number">0</span>,-<span class="number">1</span>},{-<span class="number">1</span>,<span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMaximumGold</span><span class="params">(<span class="keyword">int</span>[][] grid)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">boolean</span>[][] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[grid.length][grid[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<grid.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<grid[<span class="number">0</grid[<span></span>].length;j++) {</grid.length;i++)></span><br><span class="line">            <span class="keyword">if</span> (grid[i][j]><span class="number">0</span>) {</span><br><span class="line">                max=Math.max(dfs(grid,i,j,visit),max);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ±‚å‡ºä»x,yå¼€å§‹æ‰€èƒ½è·å¾—çš„æœ€å¤§çš„æ”¶ç›Šï¼Œè®°å¾—å›æº¯çŠ¶æ€ï¼Œåé¢çš„èŠ‚ç‚¹è¿˜éœ€è¦éå†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span>[][] grid,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">boolean</span>[][] visit)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> maxGlod=grid[x][y]; <span class="comment">//ä¸€å¼€å§‹è¿™é‡Œå†™çš„0...æ’äº†åŠå¤©çš„é”™</span></span><br><span class="line">    visit[x][y]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<direction.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (isValid(grid,nx,ny) && !visit[nx][ny] && grid[nx][ny]><span class="number">0</span>) {</span><br><span class="line">            <span class="comment">//æ±‚å‘4ä¸ªæ–¹å‘æ‰©å±•çš„æœ€å¤§å€¼</span></span><br><span class="line">            maxGlod=Math.max(dfs(grid,nx,ny,visit)+grid[x][y],maxGlod);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    visit[x][y]=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">return</span> maxGlod;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span>[][] grid,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x>=<span class="number">0</span> && x<grid.length && y>=<span class="number">0</span> && y<grid[<span class="number">0</grid[<span></grid.length></span>].length;</direction.length;i++)></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ€è·¯å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå¯¹æ¯ä¸ªæœ‰é‡‘çŸ¿çš„ç‚¹è¿›è¡Œdfsè®¡ç®—è·¯å¾„ä¸Šçš„é‡‘çŸ¿å’Œå°±okäº†ï¼Œä½†æ˜¯è¿™é¢˜æœ‰ä¸€ä¸ªå¾ˆå…³é”®çš„æ¡ä»¶ï¼Œä¸èƒ½å›å¤´ï¼Œä¸‹è¿‡çš„é‡‘çŸ¿æ˜¯ä¸èƒ½ç¬¬äºŒæ¬¡å†è¿›å…¥çš„ï¼Œä¸ç„¶è¿™é¢˜å°±å’Œå‰é¢çš„ [695. å²›å±¿æœ€å¤§é¢ç§¯](##695. å²›å±¿çš„æœ€å¤§é¢ç§¯)ä¸€æ ·äº†ï¼Œæ‰€ä»¥å¾ˆæ˜¾ç„¶è¿™é¢˜æ˜¯éœ€è¦çŠ¶æ€çš„å›æº¯çš„ï¼Œè®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œåé¢çš„èŠ‚ç‚¹è¿˜æ˜¯å¯èƒ½éœ€è¦éå†çš„ï¼Œæœ€å¼€å§‹å†™çš„ä¸€ä¸ªbugå°±æ˜¯ä»£ç ä¸­æåˆ°çš„ï¼Œé‚£é‡Œä¸€å¼€å§‹å†™çš„0â€¦ç„¶åæ’é”™æ’äº†å¥½é•¿æ—¶é—´ã€‚ã€‚ã€‚èœå•Š</p></code></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ ˆ&amp;é˜Ÿåˆ—</title>
      <link href="/2019/10/01/leetcode-zhan-dui-lie/"/>
      <url>/2019/10/01/leetcode-zhan-dui-lie/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="20-æœ‰æ•ˆçš„æ‹¬å·"><a href="#20-æœ‰æ•ˆçš„æ‹¬å·" class="headerlink" title="20. æœ‰æ•ˆçš„æ‹¬å·"></a><a href="https://leetcode-cn.com/problems/valid-parentheses/" target="_blank" rel="noopener">20. æœ‰æ•ˆçš„æ‹¬å·</a></h2><p>Given a string containing just the characters <code>'('</code>, <code>')'</code>, <code>'{'</code>, <code>'}'</code>, <code>'['</code> and <code>']'</code>, determine if the input string is valid.</p><p>An input string is valid if:</p><ol><li>Open brackets must be closed by the same type of brackets.</li><li>Open brackets must be closed in the correct order.</li></ol><p>Note that an empty string is also considered valid.</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="string">"()"</span></span><br><span class="line">Output: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="string">"()[]{}"</span></span><br><span class="line">Output: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="string">"(]"</span></span><br><span class="line">Output: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 4:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="string">"([)]"</span></span><br><span class="line">Output: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 5:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="string">"{[]}"</span></span><br><span class="line">Output: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é“é¢˜åªè¦å­¦è¿‡æ•°æ®ç»“æ„çš„è‚¯å®šä¼šåšï¼Œå…¸å‹çš„åˆ©ç”¨æ ˆçš„é¢˜</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid2</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(s.length()<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    Stack<character> stack=<span class="keyword">new</span> Stack();</character></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++){< span><br><span class="line">        <span class="keyword">if</span>(s.charAt(i)==<span class="string">'('</span> || s.charAt(i)==<span class="string">'{'</span> || s.charAt(i)==<span class="string">'['</span>){</span><br><span class="line">            stack.push(s.charAt(i));</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//æ³¨æ„è¿™ç§æƒ…å†µï¼Œä¸€å¼€å§‹å°±æ˜¯])}</span></span><br><span class="line">            <span class="keyword">if</span>(stack.isEmpty()){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">char</span> p=s.charAt(i);</span><br><span class="line">            <span class="keyword">if</span>( (p==<span class="string">')'</span> && stack.pop()!=<span class="string">'('</span>) || (p==<span class="string">']'</span> && stack.pop()!=<span class="string">'['</span>) || (p==<span class="string">'}'</span> && stack.pop()!=<span class="string">'{'</span>)){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">}</span><br></s.length();i++){<></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>å…¶å®å’Œä¸Šé¢çš„è§£æ³•æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯ç”¨çš„stackæ˜¯è‡ªå·±ç”¨æ•°ç»„ç®€å•å°è£…çš„æ ˆ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStack</span><<span class="title">T</span>></span>{</span><br><span class="line"></span><br><span class="line">    T [] objValues=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> top=-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">(<span class="keyword">int</span> size)</span></span>{</span><br><span class="line">        objValues= (T[]) <span class="keyword">new</span> Object[size];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T obj)</span></span>{</span><br><span class="line">        objValues[++top]=obj;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (top<<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"stack is isEmpty"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> objValues[top];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (top<<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"stack is isEmpty"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¦†ç›–</span></span><br><span class="line">        <span class="keyword">return</span> objValues[top--];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> top<<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>3msï¼Œ94%ï¼Œæ¯”ä¹‹å‰å¿«äº†ä¸€ç‚¹ï¼Œå»çœ‹äº†ä¸‹Stackçš„æºç ï¼Œå®ƒçš„popæ˜¯çœŸçš„åˆ é™¤ï¼Œæˆ‘çš„åªæ˜¯ç§»åŠ¨äº†æŒ‡é’ˆï¼Œæ‰€ä»¥æ•ˆç‡ä¼šé«˜å¾ˆå¤š</p><blockquote><p>åé¢çš„é¢˜å¯èƒ½éƒ½ä¼šåˆ©ç”¨è¿™ä¸ªMyStack</p></blockquote><p><strong>è§£æ³•ä¸‰</strong></p><p>ä»Šå¤©çœ‹é¢ç­‹çœ‹åˆ°ä¸€ä¸ªå†™è¿™é“é¢˜ï¼Œè¦æ±‚O(1)çš„ç©ºé—´å¤æ‚åº¦</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(s.length()<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>){</span><br><span class="line">        <span class="keyword">int</span> len=s.length();</span><br><span class="line">        s=s.replace(<span class="string">"{}"</span>,<span class="string">""</span>);</span><br><span class="line">        s=s.replace(<span class="string">"()"</span>,<span class="string">""</span>);</span><br><span class="line">        s=s.replace(<span class="string">"[]"</span>,<span class="string">""</span>);</span><br><span class="line">        <span class="keyword">if</span> (len==s.length()) {</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.equals(s);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>100msï¼Œæ•ˆç‡æ„Ÿäººï¼Œæ„Ÿè§‰åº”è¯¥è¯´çš„æ˜¯è¿™ç§åšæ³•å§ï¼Œå½“ç„¶è¿˜å¯ä»¥å†™æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ï¼Œä½†æ˜¯æˆ‘ä¸å¤ªä¼šå†™ã€‚ã€‚ã€‚</p><h2 id="344-åè½¬å­—ç¬¦ä¸²"><a href="#344-åè½¬å­—ç¬¦ä¸²" class="headerlink" title="344. åè½¬å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/reverse-string/" target="_blank" rel="noopener">344. åè½¬å­—ç¬¦ä¸²</a></h2><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ char[] çš„å½¢å¼ç»™å‡ºã€‚</p><p>ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»<strong>åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯ ASCII ç è¡¨ä¸­çš„å¯æ‰“å°å­—ç¬¦ã€‚</p><p> <strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[<span class="string">"h"</span>,<span class="string">"e"</span>,<span class="string">"l"</span>,<span class="string">"l"</span>,<span class="string">"o"</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="string">"o"</span>,<span class="string">"l"</span>,<span class="string">"l"</span>,<span class="string">"e"</span>,<span class="string">"h"</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[<span class="string">"H"</span>,<span class="string">"a"</span>,<span class="string">"n"</span>,<span class="string">"n"</span>,<span class="string">"a"</span>,<span class="string">"h"</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="string">"h"</span>,<span class="string">"a"</span>,<span class="string">"n"</span>,<span class="string">"n"</span>,<span class="string">"a"</span>,<span class="string">"H"</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å¾ˆä¹…ä¹‹å‰åšçš„äº†ï¼Œæœ¬æ¥æ˜¯æƒ³å•ç‹¬æä¸€ä¸ªé€’å½’ä¸“é¢˜ï¼Œæ„Ÿè§‰æ²¡å•¥å¿…è¦å°±ç›´æ¥åŠ åˆ°ä¸€èµ·äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseString</span><span class="params">(<span class="keyword">char</span>[] s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="keyword">null</span>||s.length<=<span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">    reverseString(s,<span class="number">0</span>,s.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseString</span><span class="params">(<span class="keyword">char</span>[] s,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(l>=r){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">char</span> temp=s[l];</span><br><span class="line">    s[l]=s[r];</span><br><span class="line">    s[r]=temp;</span><br><span class="line">    reverseString(s,++l,--r);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼"><a href="#150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="150. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼"></a><a href="https://leetcode-cn.com/problems/evaluate-reverse-polish-notation/" target="_blank" rel="noopener">150. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼</a></h2><p>æ ¹æ®<a href="https://baike.baidu.com/item/%E9%80%86%E6%B3%A2%E5%85%B0%E5%BC%8F/128437" target="_blank" rel="noopener">é€†æ³¢å…°è¡¨ç¤ºæ³•</a>ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚</p><p>æœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ <code>+, -, *, /</code> ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼</p><p>è¯´æ˜ï¼š</p><ul><li>æ•´æ•°é™¤æ³•åªä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚</li><li>ç»™å®šé€†æ³¢å…°è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨è¾¾å¼æ€»ä¼šå¾—å‡ºæœ‰æ•ˆæ•°å€¼ä¸”ä¸å­˜åœ¨é™¤æ•°ä¸º 0 çš„æƒ…å†µã€‚</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="string">"2"</span>, <span class="string">"1"</span>, <span class="string">"+"</span>, <span class="string">"3"</span>, <span class="string">"*"</span>]</span><br><span class="line">è¾“å‡º: <span class="number">9</span></span><br><span class="line">è§£é‡Š: ((<span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span>) = <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="string">"4"</span>, <span class="string">"13"</span>, <span class="string">"5"</span>, <span class="string">"/"</span>, <span class="string">"+"</span>]</span><br><span class="line">è¾“å‡º: <span class="number">6</span></span><br><span class="line">è§£é‡Š: (<span class="number">4</span> + (<span class="number">13</span> / <span class="number">5</span>)) = <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="string">"10"</span>, <span class="string">"6"</span>, <span class="string">"9"</span>, <span class="string">"3"</span>, <span class="string">"+"</span>, <span class="string">"-11"</span>, <span class="string">"*"</span>, <span class="string">"/"</span>, <span class="string">"*"</span>, <span class="string">"17"</span>, <span class="string">"+"</span>, <span class="string">"5"</span>, <span class="string">"+"</span>]</span><br><span class="line">è¾“å‡º: <span class="number">22</span></span><br><span class="line">è§£é‡Š: </span><br><span class="line">  ((<span class="number">10</span> * (<span class="number">6</span> / ((<span class="number">9</span> + <span class="number">3</span>) * -<span class="number">11</span>))) + <span class="number">17</span>) + <span class="number">5</span></span><br><span class="line">= ((<span class="number">10</span> * (<span class="number">6</span> / (<span class="number">12</span> * -<span class="number">11</span>))) + <span class="number">17</span>) + <span class="number">5</span></span><br><span class="line">= ((<span class="number">10</span> * (<span class="number">6</span> / -<span class="number">132</span>)) + <span class="number">17</span>) + <span class="number">5</span></span><br><span class="line">= ((<span class="number">10</span> * <span class="number">0</span>) + <span class="number">17</span>) + <span class="number">5</span></span><br><span class="line">= (<span class="number">0</span> + <span class="number">17</span>) + <span class="number">5</span></span><br><span class="line">= <span class="number">17</span> + <span class="number">5</span></span><br><span class="line">= <span class="number">22</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">evalRPN</span><span class="params">(String[] tokens)</span> </span>{</span><br><span class="line">    <span class="comment">//ä¸Šé¢è‡ªå·±å°è£…çš„Stack</span></span><br><span class="line">    MyStack<integer> stack=<span class="keyword">new</span> MyStack<>(tokens.length);</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<tokens.length;i++) {< span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"+"</span>.equals(tokens[i])){</span><br><span class="line">            stack.push(stack.pop()+stack.pop());</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"-"</span>.equals(tokens[i])){</span><br><span class="line">            <span class="keyword">int</span> rd1=stack.pop();</span><br><span class="line">            <span class="keyword">int</span> rd2=stack.pop();</span><br><span class="line">            stack.push(rd2-rd1);</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"*"</span>.equals(tokens[i])){</span><br><span class="line">            stack.push(stack.pop()*stack.pop());</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"/"</span>.equals(tokens[i])){</span><br><span class="line">            <span class="keyword">int</span> div1=stack.pop();</span><br><span class="line">            <span class="keyword">int</span> div2=stack.pop();</span><br><span class="line">            stack.push(div2/div1);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            stack.push(Integer.valueOf(tokens[i]));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> stack.peek();</span><br><span class="line">}</span><br></tokens.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>12msï¼Œ90%ï¼Œå…¶å®ä¸€å¼€å§‹çœ‹åˆ°è¿™ä¸ªé¢˜æˆ‘æ˜¯æ‹’ç»çš„ï¼Œæˆ‘ä»¥ä¸ºåˆæ˜¯å•¥æ•°å­¦é¢˜ï¼Œç„¶åä»”ç»†çœ‹äº†ä¸‹å‘ç°æŒºç®€å•çš„ï¼Œæ€è·¯å°±æ˜¯åˆ©ç”¨æ ˆï¼Œæ¯æ¬¡é‡åˆ°ç¬¦å·å°±popä¸¤ä¸ªå‡ºæ¥è¿›è¡Œè¿ç®—ï¼Œç„¶åå†å…¥æ ˆï¼Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯å‡æ³•å’Œé™¤æ³•çš„é¡ºåº</p><h2 id="71-ç®€åŒ–è·¯å¾„"><a href="#71-ç®€åŒ–è·¯å¾„" class="headerlink" title="71. ç®€åŒ–è·¯å¾„"></a><a href="https://leetcode-cn.com/problems/simplify-path/" target="_blank" rel="noopener">71. ç®€åŒ–è·¯å¾„</a></h2><p>ä»¥ Unix é£æ ¼ç»™å‡ºä¸€ä¸ªæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä½ éœ€è¦ç®€åŒ–å®ƒã€‚æˆ–è€…æ¢å¥è¯è¯´ï¼Œå°†å…¶è½¬æ¢ä¸ºè§„èŒƒè·¯å¾„ã€‚</p><p>åœ¨ Unix é£æ ¼çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç‚¹ï¼ˆ.ï¼‰è¡¨ç¤ºå½“å‰ç›®å½•æœ¬èº«ï¼›æ­¤å¤–ï¼Œä¸¤ä¸ªç‚¹ ï¼ˆ..ï¼‰ è¡¨ç¤ºå°†ç›®å½•åˆ‡æ¢åˆ°ä¸Šä¸€çº§ï¼ˆæŒ‡å‘çˆ¶ç›®å½•ï¼‰ï¼›ä¸¤è€…éƒ½å¯ä»¥æ˜¯å¤æ‚ç›¸å¯¹è·¯å¾„çš„ç»„æˆéƒ¨åˆ†ã€‚æ›´å¤šä¿¡æ¯è¯·å‚é˜…ï¼š<a href="https://blog.csdn.net/u011327334/article/details/50355600" target="_blank" rel="noopener">Linux / Unixä¸­çš„ç»å¯¹è·¯å¾„ vs ç›¸å¯¹è·¯å¾„</a></p><p>è¯·æ³¨æ„ï¼Œè¿”å›çš„è§„èŒƒè·¯å¾„å¿…é¡»å§‹ç»ˆä»¥æ–œæ  / å¼€å¤´ï¼Œå¹¶ä¸”ä¸¤ä¸ªç›®å½•åä¹‹é—´å¿…é¡»åªæœ‰ä¸€ä¸ªæ–œæ  <code>/</code>ã€‚æœ€åä¸€ä¸ªç›®å½•åï¼ˆå¦‚æœå­˜åœ¨ï¼‰<strong>ä¸èƒ½</strong>ä»¥ / ç»“å°¾ã€‚æ­¤å¤–ï¼Œè§„èŒƒè·¯å¾„å¿…é¡»æ˜¯è¡¨ç¤ºç»å¯¹è·¯å¾„çš„<strong>æœ€çŸ­</strong>å­—ç¬¦ä¸²</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"/home/"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"/home"</span></span><br><span class="line">è§£é‡Šï¼šæ³¨æ„ï¼Œæœ€åä¸€ä¸ªç›®å½•ååé¢æ²¡æœ‰æ–œæ ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"/../"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"/"</span></span><br><span class="line">è§£é‡Šï¼šä»æ ¹ç›®å½•å‘ä¸Šä¸€çº§æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ ¹æ˜¯ä½ å¯ä»¥åˆ°è¾¾çš„æœ€é«˜çº§ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"/home//foo/"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"/home/foo"</span></span><br><span class="line">è§£é‡Šï¼šåœ¨è§„èŒƒè·¯å¾„ä¸­ï¼Œå¤šä¸ªè¿ç»­æ–œæ éœ€è¦ç”¨ä¸€ä¸ªæ–œæ æ›¿æ¢ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"/a/./b/../../c/"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"/c"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 5ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"/a/../../b/../c//.//"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"/c"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 6ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="string">"/a//b////c/d//././/.."</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"/a/b/c"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">simplifyPath</span><span class="params">(String path)</span> </span>{</span><br><span class="line">    MyStack<string> stack=<span class="keyword">new</span> MyStack<>(path.length());</string></span><br><span class="line">    StringBuilder str=<span class="keyword">new</span> StringBuilder(path);</span><br><span class="line">    <span class="comment">//è¿™é‡Œåˆ’åˆ†å‡ºæ¥æœ‰ä¸€éƒ¨åˆ†æ˜¯ç©ºçš„ ""</span></span><br><span class="line">    String[] s=path.split(<span class="string">"/"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!stack.isEmpty() && s[i].equals(<span class="string">".."</span>)) {</span><br><span class="line">            <span class="comment">//.. å›æº¯</span></span><br><span class="line">            stack.pop();</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="string">"."</span>.equals(s[i]) && !<span class="string">""</span>.equals(s[i]) && !s[i].equals(<span class="string">".."</span>) ) {</span><br><span class="line">            <span class="comment">//æ™®é€šçš„è‹±æ–‡å­—ç¬¦abcd</span></span><br><span class="line">            stack.push(s[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (stack.isEmpty()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"/"</span>;</span><br><span class="line">    }</span><br><span class="line">    StringBuilder res=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<stack.size(); i++) {< span><br><span class="line">        res.append(<span class="string">"/"</span>+stack.get(i));   </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res.toString();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è‡ªå·±å°è£…çš„stack</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStack</span><<span class="title">T</span>></span>{</span><br><span class="line"></span><br><span class="line">    T [] objValues=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> top=-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">(<span class="keyword">int</span> size)</span></span>{</span><br><span class="line">        objValues= (T[]) <span class="keyword">new</span> Object[size];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T obj)</span></span>{</span><br><span class="line">        objValues[++top]=obj;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (top<<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"stack is isEmpty"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> objValues[top];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (top<<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"stack is isEmpty"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¦†ç›–</span></span><br><span class="line">        <span class="keyword">return</span> objValues[top--];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (index>top || index < <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"index is wrong"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> objValues[index];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> top<<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> top+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></stack.size();></span></s.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜æœ¬æ¥æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯æˆ‘é’»åˆ°ç‰›è§’å°–å»äº†ï¼Œä¸€ç›´æƒ³ç€æ€ä¹ˆåœ¨éå†è¿‡ç¨‹ä¸­å¤„ç†ï¼Œå†™äº†ä¸€å †ifelseã€‚ã€‚ã€‚è¿˜æ˜¯å¤ªèœäº†å•Šï¼Œå…¶å®ç›´æ¥æŒ‰ç…§<code>"/"</code> åˆ’åˆ†splitå­—ç¬¦ä¸²ç„¶åå¤„ç†é‚£ä¸ªæ•°ç»„å°±å¯ä»¥äº†</p><h2 id="225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ"><a href="#225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ" class="headerlink" title="225. ç”¨é˜Ÿåˆ—å®ç°æ ˆ"></a><a href="https://leetcode-cn.com/problems/implement-stack-using-queues/" target="_blank" rel="noopener">225. ç”¨é˜Ÿåˆ—å®ç°æ ˆ</a></h2><p>Implement the following operations of a stack using queues.</p><ul><li>push(x) â€“ Push element x onto stack.</li><li>pop() â€“ Removes the element on top of the stack.</li><li>top() â€“ Get the top element.</li><li>empty() â€“ Return whether the stack is empty.</li></ul><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">MyStack stack = <span class="keyword">new</span> MyStack();</span><br><span class="line"></span><br><span class="line">stack.push(<span class="number">1</span>);</span><br><span class="line">stack.push(<span class="number">2</span>);  </span><br><span class="line">stack.top();   <span class="comment">// returns 2</span></span><br><span class="line">stack.pop();   <span class="comment">// returns 2</span></span><br><span class="line">stack.empty(); <span class="comment">// returns false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Notes:</strong></p><ul><li>You must use <em>only</em> standard operations of a queue â€“ which means only <code>push to back</code>, <code>peek/pop from front</code>, <code>size</code>, and <code>is empty</code> operations are valid.</li><li>Depending on your language, queue may not be supported natively. You may simulate a queue by using a list or deque (double-ended queue), as long as you use only standard operations of a queue.</li><li>You may assume that all operations are valid (for example, no pop or top operations will be called on an empty stack).</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å¾ˆç»å…¸çš„é¢˜</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArrayDeque<integer> queue=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Initialize your data structure here. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">()</span> </span>{</span><br><span class="line">        queue=<span class="keyword">new</span> ArrayDeque();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Push element x onto stack. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        queue.add(x);</span><br><span class="line">        <span class="keyword">int</span> size=queue.size();</span><br><span class="line">        <span class="comment">//é™¤äº†æ–°åŠ å…¥çš„å…ƒç´ ï¼Œå…¶ä»–çš„å…ƒç´ éƒ½å‡ºé˜Ÿå†å…¥é˜Ÿï¼Œå°†æ–°åŠ å…¥çš„å…ƒç´ æ¨ç½®é˜Ÿåˆ—å¤´</span></span><br><span class="line">        <span class="keyword">while</span>(size-- ><span class="number">1</span>){</span><br><span class="line">            queue.add(queue.pop());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Removes the element on top of the stack and returns that element. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">       <span class="keyword">return</span>  queue.pop();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Get the top element. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> queue.peek();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Returns whether the stack is empty. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> queue.isEmpty();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¾ˆå·§å¦™çš„åšæ³•ï¼Œå°†å…ƒç´ å‰n-1ä¸ªå‡ºé˜Ÿåå†é‡æ–°å…¥é˜Ÿï¼Œ<code>1 2 --> 2 1</code> ç›´æ¥å°†å †é¡¶æ¨ç½®é˜Ÿåˆ—å¤´ ï¼Œå°†æ¯æ¬¡æ–°åŠ å…¥çš„å…ƒç´ éƒ½æ”¾ç½®é˜Ÿåˆ—å¤´è€Œä¸æ˜¯é˜Ÿå°¾ï¼Œè¿™æ ·å®é™…ä¸Šå°±å®Œæˆäº†é€†åºçš„æ“ä½œ</p><p>è¿™æ ·pushå‹æ ˆæ—¶é—´å¤æ‚åº¦<code>O(N)</code> ï¼Œ<code>pop/peek</code> æ—¶é—´å¤æ‚åº¦<code>O(1)</code></p><p><strong>è§£æ³•äºŒ</strong></p><p>é€‚ç”¨äºpushé¢‘ç¹çš„stack</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStack</span></span>{</span><br><span class="line">   <span class="comment">//å½¢å¼ä¸Šq1æ˜¯è´Ÿè´£è¿›æ ˆ q2è´Ÿè´£å‡ºæ ˆ</span></span><br><span class="line">    <span class="keyword">private</span> LinkedList inQueue=<span class="keyword">new</span> LinkedList(); </span><br><span class="line">    <span class="keyword">private</span> LinkedList outQueue=<span class="keyword">new</span> LinkedList();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span>  <span class="keyword">void</span>  <span class="title">add</span><span class="params">(Object obj)</span></span>{</span><br><span class="line">        inQueue.add(obj);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">pop</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">// q1 ----> q2 ç•™ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">while</span>(inQueue.size()><span class="number">1</span>){</span><br><span class="line">            outQueue.add(inQueue.poll());</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//äº¤æ¢q1,q2çš„å¼•ç”¨</span></span><br><span class="line">        LinkedList temp;</span><br><span class="line">        temp=inQueue;</span><br><span class="line">        inQueue=outQueue;</span><br><span class="line">        outQueue=temp;</span><br><span class="line">        <span class="keyword">return</span> outQueue.poll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">peek</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">//q1 --->q2 ç•™ä¸€ä¸ª,æœ€åä¸€ä¸ªä¸poll,æœ€åpoll</span></span><br><span class="line">        <span class="keyword">while</span>(inQueue.size()><span class="number">1</span>){</span><br><span class="line">            outQueue.add(inQueue.poll());</span><br><span class="line">            <span class="keyword">if</span>(inQueue.size()==<span class="number">1</span>){</span><br><span class="line">                outQueue.add(inQueue.peek());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//äº¤æ¢q1,q2çš„å¼•ç”¨</span></span><br><span class="line">        LinkedList temp;</span><br><span class="line">        temp=inQueue;</span><br><span class="line">        inQueue=outQueue;</span><br><span class="line">        outQueue=temp;</span><br><span class="line">        <span class="keyword">return</span> outQueue.poll();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œpushå‹æ ˆæ—¶é—´å¤æ‚åº¦<code>O(1)</code>ï¼Œpop/pushå‡ºæ ˆæ—¶é—´å¤æ‚åº¦<code>O(N)</code> ï¼Œå‡ºæ ˆçš„æ—¶å€™å°†ä¸€ä¸ªé˜Ÿåˆ—çš„å‰n-1ä¸ªå…ƒç´ å…¨éƒ¨åŠ å…¥åˆ°å¦ä¸€ä¸ªé˜Ÿåˆ—ä¸­ä½œä¸ºç¼“å­˜ï¼Œç„¶åå°†æœ€åä¸€ä¸ªå…ƒç´ å‡ºæ ˆï¼Œæœ€ååˆ«å¿˜äº†äº¤æ¢ä¸¤ä¸ªé˜Ÿåˆ—çš„å¼•ç”¨ï¼Œä¸ç„¶pushçš„æ—¶å€™å°±ä¼šå‡ºé—®é¢˜ï¼Œè¦ä¿è¯<code>inQueue</code> ä¸€ç›´æ˜¯å…¥æ ˆçš„é˜Ÿåˆ—ï¼Œå…¶ä¸­å­˜æ”¾ç€æ‰€æœ‰çš„å…ƒç´ </p><h2 id="232-ç”¨æ ˆå®ç°é˜Ÿåˆ—"><a href="#232-ç”¨æ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="232. ç”¨æ ˆå®ç°é˜Ÿåˆ—"></a><a href="https://leetcode-cn.com/problems/implement-queue-using-stacks/" target="_blank" rel="noopener">232. ç”¨æ ˆå®ç°é˜Ÿåˆ—</a></h2><p>Implement the following operations of a queue using stacks.</p><ul><li>push(x) â€“ Push element x to the back of queue.</li><li>pop() â€“ Removes the element from in front of queue.</li><li>peek() â€“ Get the front element.</li><li>empty() â€“ Return whether the queue is empty.</li></ul><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">MyQueue queue = new MyQueue();</span><br><span class="line"></span><br><span class="line">queue.push(1);</span><br><span class="line">queue.push(2);  </span><br><span class="line">queue.peek();  // returns 1</span><br><span class="line">queue.pop();   // returns 1</span><br><span class="line">queue.empty(); // returns false</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Notes:</strong></p><ul><li>You must use <em>only</em> standard operations of a stack â€“ which means only <code>push to top</code>, <code>peek/pop from top</code>, <code>size</code>, and <code>is empty</code> operations are valid.</li><li>Depending on your language, stack may not be supported natively. You may simulate a stack by using a list or deque (double-ended queue), as long as you use only standard operations of a stack.</li><li>You may assume that all operations are valid (for example, no pop or peek operations will be called on an empty queue).</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span> </span>{</span><br><span class="line"></span><br><span class="line">    Stack<integer> inStack=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    Stack<integer> outStack=<span class="keyword">null</span>;</integer></span><br><span class="line">    <span class="comment">/** Initialize your data structure here. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Stack2Queue232</span><span class="params">()</span> </span>{</span><br><span class="line">        inStack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">        outStack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Push element x to the back of queue. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        inStack.push(x);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Removes the element from in front of queue and returns that element. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        s2s();</span><br><span class="line">        <span class="keyword">return</span> outStack.pop();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Get the front element. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">peek</span><span class="params">()</span> </span>{</span><br><span class="line">        s2s();</span><br><span class="line">        <span class="keyword">return</span> outStack.peek();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Returns whether the queue is empty. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> outStack.isEmpty() && inStack.isEmpty();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">s2s</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span> (outStack.isEmpty()) {</span><br><span class="line">            <span class="keyword">while</span>(!inStack.isEmpty()) {</span><br><span class="line">                outStack.push(inStack.pop());</span><br><span class="line">            }</span><br><span class="line">        }     </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¾ˆä¸Šé¢ä¸€é¢˜æ˜¯å§Šå¦¹é¢˜ï¼Œéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯<code>s2s</code>çš„æ—¶å€™è¦ç¡®ä¿stack2æ ˆæ˜¯ç©ºçš„æ‰èƒ½push</p><h2 id="155-æœ€å°æ ˆ"><a href="#155-æœ€å°æ ˆ" class="headerlink" title="155. æœ€å°æ ˆ"></a><a href="https://leetcode-cn.com/problems/min-stack/" target="_blank" rel="noopener">155. æœ€å°æ ˆ</a></h2><p>è®¾è®¡ä¸€ä¸ªæ”¯æŒ pushï¼Œpopï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚</p><ul><li><p>push(x) â€“ å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚</p></li><li><p>pop() â€“ åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚</p></li><li><p>top() â€“ è·å–æ ˆé¡¶å…ƒç´ ã€‚</p></li><li><p>getMin() â€“ æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚</p></li></ul><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">MinStack minStack = <span class="keyword">new</span> MinStack();</span><br><span class="line">minStack.push(-<span class="number">2</span>);</span><br><span class="line">minStack.push(<span class="number">0</span>);</span><br><span class="line">minStack.push(-<span class="number">3</span>);</span><br><span class="line">minStack.getMin();   --> è¿”å› -<span class="number">3</span>.</span><br><span class="line">minStack.pop();</span><br><span class="line">minStack.top();      --> è¿”å› <span class="number">0</span>.</span><br><span class="line">minStack.getMin();   --> è¿”å› -<span class="number">2</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>åˆ©ç”¨è¾…åŠ©æ ˆï¼ŒåŒæ­¥çš„pushå’Œpop</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="keyword">private</span> Stack<integer> stack=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Stack<integer> helpStack=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinStack</span><span class="params">()</span> </span>{</span><br><span class="line">        stack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">        helpStack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        stack.push(x);</span><br><span class="line">        <span class="keyword">if</span> (helpStack.isEmpty()) {</span><br><span class="line">            helpStack.push(x);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">if</span> (helpStack.peek()>x) {</span><br><span class="line">                helpStack.push(x);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                helpStack.push(helpStack.peek());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        stack.pop();</span><br><span class="line">        helpStack.pop();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> stack.peek();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> helpStack.peek();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šè¿›è¡Œç©ºé—´çš„ä¼˜åŒ–</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="keyword">private</span> Stack<integer> stack=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Stack<integer> helpStack=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinStack</span><span class="params">()</span> </span>{</span><br><span class="line">        stack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">        helpStack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        stack.push(x);</span><br><span class="line">        <span class="keyword">if</span> (helpStack.isEmpty()) {</span><br><span class="line">            helpStack.push(x);</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (x<=helpStack.peek()) {</span><br><span class="line">            <span class="comment">//ç›¸ç­‰çš„ä¹Ÿè¦å…¥æ ˆ,ä¸ç„¶ä¸å¥½æ§åˆ¶åé¢å‡ºæ ˆ</span></span><br><span class="line">            helpStack.push(x);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> top=stack.pop();</span><br><span class="line">        <span class="comment">//å’Œè¾…åŠ©æ ˆæ ˆé¡¶ç›¸åŒå°±å‡ºæ ˆ</span></span><br><span class="line">        <span class="keyword">if</span>(top==helpStack.peek()){</span><br><span class="line">            helpStack.pop();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        if(stack.pop()==helpStack.peek()){</span></span><br><span class="line"><span class="comment">            helpStack.pop();</span></span><br><span class="line"><span class="comment">        }*/</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> stack.peek();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> helpStack.peek();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®è¿™é‡Œæœ‰ä¸€ä¸ªåœ°æ–¹æŠŠæˆ‘å¡äº†ä¸€ä¼šå„¿ï¼Œå°±æ˜¯å‡ºæ ˆçš„æ—¶å€™ï¼Œæˆ‘å¼€å§‹ä¸ºäº†ç®€æ´ifçš„æ¡ä»¶å†™çš„</p><p><code>stack.pop()==helpStack.peek()</code> ç„¶åå¡åœ¨äº†ä¸€ä¸ªcaseä¸Šï¼Œæƒ³äº†åŠå¤©æ‰æ„è¯†åˆ°æ˜¯<code>Integer</code>çš„é—®é¢˜ï¼Œè¿™é‡Œå¼¹å‡ºæ¥çš„æ˜¯ä¸¤ä¸ª<code>Integer</code>å¹¶ä¸ä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œè€Œä¸”å€¼æ˜¯ä¸åœ¨ -128~127ä¹‹é—´çš„ï¼Œæ‰€ä»¥å°±falseäº†</p><p><strong>è§£æ³•ä¸‰</strong></p><p>å¸…åœ°ä¸Šçœ‹è§çš„è§£æ³•ï¼Œåœ¨æ ˆä¸­å­˜ä¸€ä¸ªdiffå·®å€¼ï¼Œä»£è¡¨å½“å‰å…ƒç´ å’Œå…¥æ ˆå‰çš„minçš„å·®å€¼ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä½†æ˜¯è¿™ç§åšæ³•é™åˆ¶æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æ•°æ®çš„å¤§å°ä¼šæœ‰é™åˆ¶ï¼ŒåŒæ—¶è²Œä¼¼ä¹Ÿæ— æ³•åš<code>peek()</code>æ“ä½œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinStack155_2</span></span>{</span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="keyword">private</span> Stack<integer> stack=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> min=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinStack155_2</span><span class="params">()</span> </span>{</span><br><span class="line">        stack=<span class="keyword">new</span> Stack<>();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (stack.isEmpty()) {</span><br><span class="line">            min=x;</span><br><span class="line">            stack.push(<span class="number">0</span>);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">int</span> diff=x-min;</span><br><span class="line">            min=diff><span class="number">0</span>?min:x;</span><br><span class="line">            stack.push(diff);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> diff=stack.pop();</span><br><span class="line">        <span class="comment">//å°äºç­‰äº0è¯´æ˜ minå°±æ˜¯å½“å‰çœŸå®çš„æ ˆé¡¶å…ƒç´ ,ä¹Ÿå°±æ˜¯è¯´ min-minPre=diff</span></span><br><span class="line">        min=diff<=<span class="number">0</span>?min-diff:min;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*public int top() {</span></span><br><span class="line"><span class="comment">        int diff=stack.peek();</span></span><br><span class="line"><span class="comment">        return diff<=0?min:diff-min;</span></span><br><span class="line"><span class="comment">    }*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="279-å®Œå…¨å¹³æ–¹æ•°"><a href="#279-å®Œå…¨å¹³æ–¹æ•°" class="headerlink" title="279. å®Œå…¨å¹³æ–¹æ•°"></a><a href="https://leetcode-cn.com/problems/perfect-squares/" target="_blank" rel="noopener">279. å®Œå…¨å¹³æ–¹æ•°</a></h2><p>ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, â€¦ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: n = <span class="number">12</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span> </span><br><span class="line">è§£é‡Š: <span class="number">12</span> = <span class="number">4</span> + <span class="number">4</span> + <span class="number">4</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: n = <span class="number">13</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line">è§£é‡Š: <span class="number">13</span> = <span class="number">4</span> + <span class="number">9</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜åœ¨ä¸Šä¸€ç¯‡<a href="http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/">dpä¸“é¢˜</a>ä¸­æœ‰è®²è¿‡ï¼Œä¸è¿‡æ˜¯dpçš„è§£æ³•ï¼Œè¿™é‡Œä¸»è¦è®°å½•BFSçš„è§£æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numSquares2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    Queue<pair> queue=<span class="keyword">new</span> LinkedList<>();</pair></span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[n+<span class="number">1</span>];</span><br><span class="line">    queue.add(<span class="keyword">new</span> Pair(n,<span class="number">0</span>));</span><br><span class="line">    visit[n]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        Pair pair=queue.poll();</span><br><span class="line">        <span class="keyword">int</span> num=pair.num;</span><br><span class="line">        <span class="keyword">int</span> step=pair.step;</span><br><span class="line">        <span class="comment">//nums=0è¯´æ˜æ‰¾åˆ°äº†ï¼Œå¹¶ä¸”ä¸€å®šæ˜¯æœ€çŸ­çš„</span></span><br><span class="line">        <span class="keyword">if</span> (num==<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">return</span> step;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i*i<=num;i++) {</span><br><span class="line">            <span class="keyword">int</span> temp=num-i*i;</span><br><span class="line">            <span class="comment">//æ³¨æ„ä¸è¦æ·»åŠ é‡å¤çš„å…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span> (!visit[temp]) {</span><br><span class="line">                queue.add(<span class="keyword">new</span> Pair(temp,step+<span class="number">1</span>));</span><br><span class="line">                visit[temp]=<span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> step;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(<span class="keyword">int</span> num,<span class="keyword">int</span> step)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.num=num;</span><br><span class="line">        <span class="keyword">this</span>.step=step;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>30ms 90%ï¼Œæ¯”dpçš„æ–¹å¼ä¼šå¿«å¾ˆå¤šï¼Œæ€è·¯å°±æ˜¯å°†è¿™ä¸ªé—®é¢˜è½¬æ¢ä¸ºæ±‚å›¾çš„æœ€çŸ­è·¯å¾„çš„é—®é¢˜ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœ€çŸ­çš„ä»nåˆ°0çš„ä»¥å¹³æ–¹æ•°ä¸ºå·®çš„è·¯å¾„</p><h2 id="127-å•è¯æ¥é¾™"><a href="#127-å•è¯æ¥é¾™" class="headerlink" title="127. å•è¯æ¥é¾™"></a><a href="https://leetcode-cn.com/problems/word-ladder/" target="_blank" rel="noopener">127. å•è¯æ¥é¾™</a></h2><p>Given two words (<em>beginWord</em> and <em>endWord</em>), and a dictionaryâ€™s word list, find the length of shortest transformation sequence from <em>beginWord</em> to <em>endWord</em>, such that:</p><ol><li>Only one letter can be changed at a time.</li><li>Each transformed word must exist in the word list. Note that <em>beginWord</em> is <em>not</em> a transformed word.</li></ol><p><strong>Note:</strong></p><ul><li>Return 0 if there is no such transformation sequence.</li><li>All words have the same length.</li><li>All words contain only lowercase alphabetic characters.</li><li>You may assume no duplicates in the word list.</li><li>You may assume <em>beginWord</em> and <em>endWord</em> are non-empty and are not the same.</li></ul><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">beginWord = <span class="string">"hit"</span>,</span><br><span class="line">endWord = <span class="string">"cog"</span>,</span><br><span class="line">wordList = [<span class="string">"hot"</span>,<span class="string">"dot"</span>,<span class="string">"dog"</span>,<span class="string">"lot"</span>,<span class="string">"log"</span>,<span class="string">"cog"</span>]</span><br><span class="line"></span><br><span class="line">Output: <span class="number">5</span></span><br><span class="line"></span><br><span class="line">Explanation: As one shortest transformation is <span class="string">"hit"</span> -> <span class="string">"hot"</span> -> <span class="string">"dot"</span> -> <span class="string">"dog"</span> -> <span class="string">"cog"</span>,</span><br><span class="line"><span class="keyword">return</span> its length <span class="number">5</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">beginWord = <span class="string">"hit"</span></span><br><span class="line">endWord = <span class="string">"cog"</span></span><br><span class="line">wordList = [<span class="string">"hot"</span>,<span class="string">"dot"</span>,<span class="string">"dog"</span>,<span class="string">"lot"</span>,<span class="string">"log"</span>]</span><br><span class="line"></span><br><span class="line">Output: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">Explanation: The endWord <span class="string">"cog"</span> is not in wordList, therefore no possible transformation.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å…¶å®å¾ˆä¹…ä»¥å‰å°±å†™è¿‡äº†ï¼Œå½“æ—¶æ˜¯çœ‹äº†å•Šå“ˆç®—æ³•çš„ä¸€äº›BFSç®—æ³•ç„¶åä»¿ç…§ä¹¦ä¸Šçš„å†™çš„ï¼Œä¹¦ä¸Šæ˜¯Cè¯­è¨€å†™çš„ï¼Œæ‰€ä»¥æœ€åæˆ‘å†™çš„æ—¶å€™ä¹ŸæŒ‰ç…§Cçš„æ ¼å¼å»å†™äº†ğŸ˜…ï¼Œå†™çš„è´¼å•°å—¦ï¼Œç°åœ¨åˆç”¨â€Javaâ€çš„æ–¹å¼åˆé‡æ–°å†™äº†ä¸€é</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] mark;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> min = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">ladderLength</span><span class="params">(String beginWord, String endWord, List<string> wordList)</string></span>     </span>{</span><br><span class="line">    <span class="comment">// ä¸å­˜åœ¨</span></span><br><span class="line">    mark = <span class="keyword">new</span> <span class="keyword">int</span>[wordList.size() + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (!wordList.contains(endWord)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// BFS</span></span><br><span class="line">    <span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–é˜Ÿåˆ—</span></span><br><span class="line">    Que[] que = <span class="keyword">new</span> Que[wordList.size() + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// å¾ªç¯ä¿ƒä½¿è¯è¿°ç¥–</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < que.length; i++) {</span><br><span class="line">        que[i] = <span class="keyword">new</span> Que();</span><br><span class="line">    }</span><br><span class="line">    que[tail].word = beginWord;</span><br><span class="line">    que[tail].step = <span class="number">1</span>;</span><br><span class="line">    tail++;</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (head < tail) {</span><br><span class="line">        <span class="comment">// éå†å­—å…¸</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < wordList.size(); i++) {</span><br><span class="line">            <span class="keyword">if</span> (mark[i] == <span class="number">0</span> && cmp(wordList.get(i), que[head].word)) {</span><br><span class="line">                que[tail].word = wordList.get(i);</span><br><span class="line">                <span class="comment">//è¿™é‡Œæ˜¯ä»headå¼€å§‹çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯headçš„æ­¥æ•°+1</span></span><br><span class="line">                que[tail].step=que[head].step+<span class="number">1</span>;</span><br><span class="line">                <span class="comment">// æ ‡è®°ä¸ºå·²ç»èµ°è¿‡</span></span><br><span class="line">                mark[i] = <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// ç»Ÿè®¡æœ€å°æ­¥æ•°</span></span><br><span class="line">               <span class="keyword">if</span> (que[tail].word.equals(endWord)) {</span><br><span class="line">                <span class="comment">//è·³å‡ºå¾ªç¯</span></span><br><span class="line">                    flag=<span class="number">1</span>;</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                tail++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(flag==<span class="number">1</span>){</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ¯æ¬¡æ£€æŸ¥å®Œä¸€ä¸ªå•è¯å°±å°†å…¶å‡ºé˜Ÿåˆ—</span></span><br><span class="line">        head++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> que[tail].step;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ²¡åƒæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">cmp</span><span class="params">(String s1, String s2)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < s1.length(); i++) {</span><br><span class="line">        <span class="keyword">if</span> (s1.charAt(i) != s2.charAt(i)) {</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count == <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…éƒ¨ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Que</span> </span>{</span><br><span class="line">    String word;</span><br><span class="line">    <span class="keyword">int</span> step;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™å°±æ˜¯å½“æ—¶å†™çš„è§£æ³•ï¼Œæ€è·¯å°±æ˜¯BFSï¼Œåªä¸è¿‡å†™çš„å¤æ‚äº†</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">ladderLength</span><span class="params">(String beginWord, String endWord, List<string> wordList)</string></span>     </span>{</span><br><span class="line">    <span class="comment">//visitæ•°ç»„</span></span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[wordList.size()];</span><br><span class="line">    <span class="keyword">if</span> (!wordList.contains(endWord)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Queue<pair> queue=<span class="keyword">new</span> LinkedList<>();</pair></span><br><span class="line">    queue.add(<span class="keyword">new</span> Pair(beginWord,<span class="number">1</span>));</span><br><span class="line">    <span class="comment">//int flag=0;</span></span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) {</span><br><span class="line">        Pair pair=queue.poll();</span><br><span class="line">        <span class="comment">// ç»Ÿè®¡æœ€å°æ­¥æ•°,æ”¾åœ¨å†…å¾ªç¯ä¸­ä¼šå¿«ä¸€ç‚¹</span></span><br><span class="line">        <span class="comment">/*if (pair.word.equals(endWord)) {</span></span><br><span class="line"><span class="comment">            return pair.step;</span></span><br><span class="line"><span class="comment">        }*/</span></span><br><span class="line">        <span class="comment">// éå†å­—å…¸</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < wordList.size(); i++) {</span><br><span class="line">            <span class="keyword">if</span> (!visit[i] && cmp(wordList.get(i),pair.word)) {</span><br><span class="line">                <span class="keyword">if</span> (wordList.get(i).equals(endWord)) {</span><br><span class="line">                    <span class="comment">//è¿™é‡ŒåŠ 1 æ˜¯å› ä¸ºå–çš„æ˜¯pairçš„step</span></span><br><span class="line">                    <span class="comment">//åˆ°å½“å‰è¿™ä¸ªå•è¯è¿˜è¦å¤šèµ°ä¸€æ­¥</span></span><br><span class="line">                    <span class="keyword">return</span> pair.step+<span class="number">1</span>;</span><br><span class="line">                }</span><br><span class="line">                queue.add(<span class="keyword">new</span> Pair(wordList.get(i),pair.step+<span class="number">1</span>));</span><br><span class="line">                <span class="comment">//æ ‡è®°ä¸ºå·²ç»èµ°è¿‡</span></span><br><span class="line">                visit[i] = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">cmp</span><span class="params">(String s1, String s2)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < s1.length(); i++) {</span><br><span class="line">        <span class="keyword">if</span> (s1.charAt(i) != s2.charAt(i)) {</span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">if</span> (count><span class="number">1</span>) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count == <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//Pair</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pair</span> </span>{</span><br><span class="line">    String word;</span><br><span class="line">    <span class="keyword">int</span> step;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(String word,<span class="keyword">int</span> step)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.word=word;</span><br><span class="line">        <span class="keyword">this</span>.step=step;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>273msï¼Œ47%ä¸­è§„ä¸­çŸ©çš„åšæ³•ï¼Œè¿ç»­å†™äº†å¥½å‡ é¢˜BFSçš„ï¼Œæ€»ç®—æ˜¯å¯¹BFSçš„æ¿å­æœ‰ç‚¹ç†Ÿæ‚‰äº†ï¼Œè¿™é¢˜è¿˜æœ‰ä¸¤ä¸ªå¯ä»¥ä¼˜åŒ–çš„ç‚¹ â‘  <em>åŒç«¯BFS</em> â‘¡ _å¯»æ‰¾ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–¹å¼_ï¼Œåªä¸è¿‡æˆ‘æ²¡å’‹çœ‹æ‡‚ï¼Œç­‰çœ‹æ‡‚äº†å†æ¥è¡¥å……ï¼Œé‚£ç§æ–¹å¼æ—¶é—´å¥½åƒå¯ä»¥ç¼©å‡åˆ° 20mså†…â€¦..</p><blockquote><p>è¿™é¢˜æœ‰ä¸ªå›°éš¾ç‰ˆæœ¬ï¼Œéœ€è¦æ‰“å°å‡ºæ‰€æœ‰çš„æœ€çŸ­åºåˆ—ï¼Œè¿™ä¸ªåœ¨æˆ‘å¾ˆä¹…ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­ä¹Ÿæœ‰è®²ï¼Œä½†æ˜¯è‡³ä»Šæˆ‘ä¹Ÿè¿˜æ²¡æœ‰ACï¼Œä¸€ç›´æ˜¯TLEï¼Œç°åœ¨å›å¤´çœ‹æˆ‘ä¹‹å‰çš„ä»£ç å·²ç»çœ‹ä¸æ‡‚äº†ã€‚ã€‚ã€‚å†™çš„100å¤šè¡Œï¼Œå¾ˆå¤æ‚BFS+DFSçš„åšæ³•ï¼Œå¯èƒ½æ˜¯æ²¡å¤„ç†å¥½æ‰€ä»¥TLEäº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹<a href="http://imlgw.top/2018/10/31/yi-dao-leetcode-yin-fa-de-can-an/#2-%E5%8A%A0%E5%BC%BA%E7%89%88-%E5%8D%95%E8%AF%8D%E6%8E%A5%E9%BE%99-2">é‚£ç¯‡æ–‡ç« </a></p></blockquote><h2 id="779-ç¬¬Kä¸ªè¯­æ³•ç¬¦å·"><a href="#779-ç¬¬Kä¸ªè¯­æ³•ç¬¦å·" class="headerlink" title="779. ç¬¬Kä¸ªè¯­æ³•ç¬¦å·"></a><a href="https://leetcode-cn.com/problems/k-th-symbol-in-grammar/" target="_blank" rel="noopener">779. ç¬¬Kä¸ªè¯­æ³•ç¬¦å·</a></h2><p>On the first row, we write a <code>0</code>. Now in every subsequent row, we look at the previous row and replace each occurrence of <code>0</code> with <code>01</code>, and each occurrence of <code>1</code> with <code>10</code>.</p><p>Given row <code>N</code> and index <code>K</code>, return the <code>K</code>-th indexed symbol in row <code>N</code>. (The values of <code>K</code> are 1-indexed.) (1 indexed).</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Examples:</span><br><span class="line">Input: N = <span class="number">1</span>, K = <span class="number">1</span></span><br><span class="line">Output: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">Input: N = <span class="number">2</span>, K = <span class="number">1</span></span><br><span class="line">Output: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">Input: N = <span class="number">2</span>, K = <span class="number">2</span></span><br><span class="line">Output: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Input: N = <span class="number">4</span>, K = <span class="number">5</span></span><br><span class="line">Output: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Explanation:</span><br><span class="line">row <span class="number">1</span>: <span class="number">0</span></span><br><span class="line">row <span class="number">2</span>: <span class="number">01</span></span><br><span class="line">row <span class="number">3</span>: <span class="number">0110</span></span><br><span class="line">row <span class="number">4</span>: <span class="number">01101001</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Note:</strong></p><ol><li><code>N</code> will be an integer in the range <code>[1, 30]</code>.</li><li><code>K</code> will be an integer in the range <code>[1, 2^(N-1)]</code>.</li></ol><p><strong>è§£æ³•ä¸€</strong></p><p>æ‰¾è§„å¾‹ï¼Œå‰åŠéƒ¨åˆ†å’ŒååŠéƒ¨åˆ†æ˜¯æœ‰ä¸€å®šè§„å¾‹çš„ï¼ŒæŠŠå‰å…­è¡Œéƒ½å†™å‡ºæ¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç¬¬ä¸€è¡Œ: <span class="number">0</span></span><br><span class="line">ç¬¬äºŒè¡Œ: <span class="number">01</span></span><br><span class="line">ç¬¬ä¸‰è¡Œ: <span class="number">01</span>|<span class="number">10</span></span><br><span class="line">ç¬¬å››è¡Œ: <span class="number">01</span> <span class="number">10</span>|<span class="number">10</span> <span class="number">01</span></span><br><span class="line">ç¬¬äº”è¡Œ: <span class="number">01</span> <span class="number">10</span> <span class="number">10</span> <span class="number">01</span>|<span class="number">10</span> <span class="number">01</span> <span class="number">01</span> <span class="number">10</span></span><br><span class="line">ç¬¬å…­è¡Œ: <span class="number">01</span> <span class="number">10</span> <span class="number">10</span> <span class="number">01</span> <span class="number">10</span> <span class="number">01</span> <span class="number">01</span> <span class="number">10</span> | <span class="number">10</span> <span class="number">01</span> <span class="number">01</span> <span class="number">10</span> <span class="number">01</span> <span class="number">10</span> <span class="number">10</span> <span class="number">01</span></span><br></pre></td></tr></tbody></table></figure></div><p>  N%2!=0 å¯¹ç§°, ç¬¬Kä¸ªç­‰äº 2^(N-1)-K+1<br>  N%2==0 äº’è¡¥å¯¹ç§°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">kthGrammar</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> K)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(K==<span class="number">1</span> || N==<span class="number">1</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(K==<span class="number">2</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> len=<span class="number">1</span><<(N-<span class="number">1</span>); <span class="comment">//å½“å‰è¡Œé•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span>(K>len/<span class="number">2</span>){ <span class="comment">//å¤§äº1/2</span></span><br><span class="line">        <span class="comment">//ç»“åˆä¸Šé¢çš„è§„å¾‹ï¼Œæ‰¾å‰åŠéƒ¨åˆ†å’Œè‡ªå·±ç­‰ä»·çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">if</span>(N%<span class="number">2</span>!=<span class="number">0</span>){ </span><br><span class="line">            K=len-K+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">if</span>(K%<span class="number">2</span>==<span class="number">0</span>){</span><br><span class="line">                K=len-K+<span class="number">2</span>;  </span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                K=len-K;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å»ä¸Šä¸€è¡Œç»§ç»­</span></span><br><span class="line">    <span class="keyword">return</span> kthGrammar(N-<span class="number">1</span>,K);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚ç¬¬O(N)ï¼Œæ€è·¯è¿˜ç®—æ¸…æ™°ï¼Œæœ€å¼€å§‹æ²¡æƒ³åˆ°ç”¨<code>ä½è¿ç®—</code>æ¥ç®—é•¿åº¦ï¼Œç”¨çš„<code>pow()</code>æœ€åæ•ˆç‡å·®ä¸å¤šï¼Œå¯èƒ½æ˜¯åº•å±‚åšäº†ä¼˜åŒ–ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>è¿™ç§è§£æ³•å®é™…ä¸Šå°±æ˜¯æŠŠæ•´ä¸ªåºåˆ—çœ‹ä½œä¸€é¢—æ»¡äºŒå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼å’Œçˆ¶èŠ‚ç‚¹å…¶å®æ˜¯æœ‰å¯¹åº”å…³ç³»çš„ï¼Œå¦‚æœKæ˜¯å¶æ•°é‚£ä¹ˆå°±å’Œçˆ¶èŠ‚ç‚¹çš„å€¼ç›¸åï¼Œå¦åˆ™å°±ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€’å½’çš„å»æ‰¾çˆ¶èŠ‚ç‚¹å¯¹åº”çš„indexçš„å€¼ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//01æ’åˆ—</span></span><br><span class="line"><span class="comment">//              0</span></span><br><span class="line"><span class="comment">//          /        \   </span></span><br><span class="line"><span class="comment">//      0                1</span></span><br><span class="line"><span class="comment">//    /   \            /    \</span></span><br><span class="line"><span class="comment">//  0       1        1       0</span></span><br><span class="line"><span class="comment">// / \     /  \     /  \    / \ </span></span><br><span class="line"><span class="comment">//0   1   1    0   1    0  0   1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">kthGrammar</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> K)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (K==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//(K+1)/2æ˜¯å¯¹åº”çˆ¶èŠ‚ç‚¹çš„index</span></span><br><span class="line">    <span class="keyword">int</span> parent=kthGrammar(N-<span class="number">1</span>,(K+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//å–å</span></span><br><span class="line">    <span class="keyword">int</span> f_parent=-(parent-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (K%<span class="number">2</span>==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> f_parent;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> parent;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯<code>O(N)</code> ä½†æ˜¯æ¯”ä¸Šé¢é‚£ç§è¦æ›´æ¸…æ™°æ˜äº†</p><p><strong>è§£æ³•ä¸‰</strong></p><p>è¿™ä¸ªè§£æ³•å…¶å®å’Œä¸Šé¢çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨çˆ¶èŠ‚ç‚¹å’ŒKçš„å¥‡å¶æ¥åˆ¤æ–­ï¼Œå…¶å®ä»”ç»†çœ‹ä¸Šé¢çš„ä»£ç ä½ ä¼šå‘ç°Nå…¶å®å¹¶æ²¡æœ‰å®é™…çš„æ„ä¹‰ï¼Œå…·ä½“Kçš„å€¼åªå’ŒKæœ¬èº«æœ‰å…³ï¼Œä¸‹é¢çš„è§£æ³•å°±æ²¡æœ‰ç”¨åˆ°N.</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kthGrammar3</span><span class="params">(<span class="keyword">int</span> N, <span class="keyword">int</span> K)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span> r=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">while</span>(K><span class="number">1</span>){</span><br><span class="line">        <span class="keyword">if</span> (K%<span class="number">2</span>==<span class="number">0</span>) {</span><br><span class="line">            K=K/<span class="number">2</span>;</span><br><span class="line">            r=!r;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            K=(K+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> r?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜å…¶å®è¿˜æœ‰ä¸€ç§è§£æ³•ï¼Œåˆ©ç”¨äºŒè¿›åˆ¶ï¼Œå¯¹Kåšå¥‡å¶æ£€éªŒï¼Œè²Œä¼¼æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚</p><h2 id="50-Pow-x-n"><a href="#50-Pow-x-n" class="headerlink" title="50. Pow(x, n)"></a><a href="https://leetcode-cn.com/problems/powx-n/" target="_blank" rel="noopener">50. Pow(x, n)</a></h2><p>å®ç° pow(<em>x</em>, <em>n</em>) ï¼Œå³è®¡ç®— x çš„ n æ¬¡å¹‚å‡½æ•°ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é‡Œå°±è¦ä»‹ç»ä¸€ç§å¿«é€Ÿå¹‚ç®—æ³•äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">fastPow</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">int</span> n)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(n<<span class="number">0</span>){</span><br><span class="line">        x=<span class="number">1</span>/x;</span><br><span class="line">        n=-n;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">double</span> res=fastPow(x,n/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(n%<span class="number">2</span>==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> res*res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res*res*x;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ ¸å¿ƒæ€æƒ³å°±æ˜¯ <code>x^n=(x^2/n)^2</code>ï¼Œå¸¸è§„ç´¯ä¹˜çš„æ–¹å¼è®¡ç®—æ—¶é—´å¤æ‚åº¦æ˜¯O(N)å› ä¸ºè¦éå†æ‰€æœ‰çš„å…ƒç´ ï¼Œä½†æ˜¯å…¶å®çŸ¥é“äº†<code>x^n/2</code>ä¹‹å <code>x^n</code>å°±å¯ä»¥ç›´æ¥å¹³æ–¹å¾—åˆ°äº†ä¸ç”¨ç»§ç»­éå†ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦ä¸ºO(logN) </p><p>2019.8.20ï¼Œåˆå†™äº†ä¸€éï¼Œæäº¤ç„¶åæ²¡è¿‡ã€‚çœ‹äº†ä¸‹ç»™çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæœ€åä¸€ä¸ªç»™çš„næ˜¯ <code>-2^31</code> ä¹Ÿå°±æ˜¯intæ•´æ•°çš„æœ€å°å€¼ï¼Œintç±»å‹çš„å–å€¼èŒƒå›´æ˜¯ <code>-2^31 ~ 2^31-1</code> è€Œè¿™ä¸ªè´Ÿå€¼åœ¨è¿™é‡Œå–åä¹‹åä¼šç›´æ¥æº¢å‡ºæœ€åå¾—åˆ°çš„è¿˜æ˜¯ <code>-2^31</code> ï¼Œæ‰€ä»¥è¿™é‡Œè¿™æ ·å†™ ifä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œxå°±åˆä¼šå˜å›æ¥ï¼Œæ‰€ä»¥ç»“æœç›´æ¥å°±æ˜¯<code>Infinity</code>æ— ç©·å¤§äº†ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯ifåªä¼šæ‰§è¡Œä¸€æ¬¡å¯ä»¥å°†å…¶å°è£…ä¸€ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">myPow</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(n<<span class="number">0</span>){</span><br><span class="line">        x=<span class="number">1</span>/x;</span><br><span class="line">        n=-n;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> fastPow(x,n);</span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">fastPow</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">int</span> n)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">double</span>  half=fastPow(x,n/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(n%<span class="number">2</span>==<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> half*half;</span><br><span class="line">    <span class="keyword">return</span> half*half*x;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="5222-åˆ†å‰²å¹³è¡¡å­—ç¬¦ä¸²"><a href="#5222-åˆ†å‰²å¹³è¡¡å­—ç¬¦ä¸²" class="headerlink" title="5222. åˆ†å‰²å¹³è¡¡å­—ç¬¦ä¸²"></a>5222. åˆ†å‰²å¹³è¡¡å­—ç¬¦ä¸²</h2><p>åœ¨ä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ä¸­ï¼Œâ€™Lâ€™ å’Œ â€˜Râ€™ å­—ç¬¦çš„æ•°é‡æ˜¯ç›¸åŒçš„ã€‚</p><p>ç»™å‡ºä¸€ä¸ªå¹³è¡¡å­—ç¬¦ä¸² <code>s</code>ï¼Œè¯·ä½ å°†å®ƒåˆ†å‰²æˆå°½å¯èƒ½å¤šçš„å¹³è¡¡å­—ç¬¦ä¸²ã€‚</p><p>è¿”å›å¯ä»¥é€šè¿‡åˆ†å‰²å¾—åˆ°çš„å¹³è¡¡å­—ç¬¦ä¸²çš„æœ€å¤§æ•°é‡</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = "RLRRLLRLRL"</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼šs å¯ä»¥åˆ†å‰²ä¸º "RL", "RRLL", "RL", "RL", æ¯ä¸ªå­å­—ç¬¦ä¸²ä¸­éƒ½åŒ…å«ç›¸åŒæ•°é‡çš„ 'L' å’Œ 'R'ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = "RLLLLRRRLR"</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šs å¯ä»¥åˆ†å‰²ä¸º "RL", "LLLRRR", "LR", æ¯ä¸ªå­å­—ç¬¦ä¸²ä¸­éƒ½åŒ…å«ç›¸åŒæ•°é‡çš„ 'L' å’Œ 'R'ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = "LLLLRRRR"</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼šs åªèƒ½ä¿æŒåŸæ · "LLLLRRRR".</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= s.length <= 1000</code></li><li><code>s[i] = 'L' æˆ– 'R'</code></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>19.10.13çš„å‘¨èµ›çš„ç¬¬1é¢˜ï¼Œæœç„¶æ¯”èµ›å’Œåˆ·é¢˜è¿˜æ˜¯ä¸ä¸€æ ·ï¼Œå·®ç‚¹æ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">balancedStringSplit</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s.length()%<span class="number">2</span>==<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    Stack<character> stack=<span class="keyword">new</span> Stack<>();</character></span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++){< span><br><span class="line">        <span class="keyword">if</span> (!stack.isEmpty() ){</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(i)==stack.peek()) {</span><br><span class="line">                stack.push(s.charAt(i));    </span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                stack.pop();</span><br><span class="line">                <span class="keyword">if</span> (stack.isEmpty()) {</span><br><span class="line">                    count++;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            stack.push(s.charAt(i));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">}</span><br></s.length();i++){<></span></pre></td></tr></tbody></table></figure></div><h2 id="1249-ç§»é™¤æ— æ•ˆçš„æ‹¬å·"><a href="#1249-ç§»é™¤æ— æ•ˆçš„æ‹¬å·" class="headerlink" title="1249. ç§»é™¤æ— æ•ˆçš„æ‹¬å·"></a><a href="https://leetcode-cn.com/problems/minimum-remove-to-make-valid-parentheses/" target="_blank" rel="noopener">1249. ç§»é™¤æ— æ•ˆçš„æ‹¬å·</a></h2><p>ç»™ä½ ä¸€ä¸ªç”± â€˜(â€˜ã€â€™)â€™ å’Œå°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² sã€‚</p><p>ä½ éœ€è¦ä»å­—ç¬¦ä¸²ä¸­åˆ é™¤æœ€å°‘æ•°ç›®çš„ â€˜(â€˜ æˆ–è€… â€˜)â€™ ï¼ˆå¯ä»¥åˆ é™¤ä»»æ„ä½ç½®çš„æ‹¬å·)ï¼Œä½¿å¾—å‰©ä¸‹çš„ã€Œæ‹¬å·å­—ç¬¦ä¸²ã€æœ‰æ•ˆã€‚</p><p>è¯·è¿”å›ä»»æ„ä¸€ä¸ªåˆæ³•å­—ç¬¦ä¸²ã€‚</p><p>æœ‰æ•ˆã€Œæ‹¬å·å­—ç¬¦ä¸²ã€åº”å½“ç¬¦åˆä»¥ä¸‹ <strong>ä»»æ„ä¸€æ¡</strong> è¦æ±‚ï¼š</p><ul><li>ç©ºå­—ç¬¦ä¸²æˆ–åªåŒ…å«å°å†™å­—æ¯çš„å­—ç¬¦ä¸²</li><li>å¯ä»¥è¢«å†™ä½œ ABï¼ˆA è¿æ¥ Bï¼‰çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ A å’Œ B éƒ½æ˜¯æœ‰æ•ˆã€Œæ‹¬å·å­—ç¬¦ä¸²ã€</li><li>å¯ä»¥è¢«å†™ä½œ (A) çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ A æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ã€Œæ‹¬å·å­—ç¬¦ä¸²ã€</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"lee(t(c)o)de)"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"lee(t(c)o)de"</span></span><br><span class="line">è§£é‡Šï¼š<span class="string">"lee(t(co)de)"</span> , <span class="string">"lee(t(c)ode)"</span> ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œç­”æ¡ˆã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"a)b(c)d"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"ab(c)d"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"))(("</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">""</span></span><br><span class="line">è§£é‡Šï¼šç©ºå­—ç¬¦ä¸²ä¹Ÿæ˜¯æœ‰æ•ˆçš„</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"(a(b(c)d)"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="string">"a(b(c)d)"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= s.length <= 10^5</code></li><li><code>s[i]</code> å¯èƒ½æ˜¯ <code>'('</code>ã€<code>')'</code> æˆ–è‹±æ–‡å°å†™å­—æ¯ </li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>11.3å‘¨èµ›ç¬¬ä¸‰é¢˜ï¼Œè¿™é¢˜å€’æ˜¯æ²¡ä»€ä¹ˆéšœç¢ï¼Œç”¨æ ˆå°±okï¼Œä¸è¿‡æˆ‘è¿™é‡Œå®ç°çš„ä¸å¤ªå¥½ï¼Œreplaceæ—¶é—´å¤æ‚åº¦ç•¥é«˜ï¼Œåº”è¯¥ç”¨ä¸€ä¸ªæ•°ç»„åšmarkæœ€åç”¨StringBuilderåšappendåº”è¯¥æ•ˆç‡ä¼šé«˜å¾ˆå¤š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">minRemoveToMakeValid</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    StringBuilder sb=<span class="keyword">new</span> StringBuilder(s);</span><br><span class="line">    Stack<integer> stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i)>=<span class="string">'a'</span> && s.charAt(i)<=<span class="string">'z'</span>) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i)==<span class="string">')'</span>) {</span><br><span class="line">            <span class="keyword">if</span> (stack.isEmpty()) {</span><br><span class="line">                sb.replace(i,i+<span class="number">1</span>,<span class="string">"*"</span>);    </span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                stack.pop();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i)==<span class="string">'('</span>) {</span><br><span class="line">            stack.push(i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span> (!stack.isEmpty()) {</span><br><span class="line">        <span class="keyword">int</span> temp=stack.pop();</span><br><span class="line">        sb.replace(temp,temp+<span class="number">1</span>,<span class="string">"*"</span>);</span><br><span class="line">    }</span><br><span class="line">    String res=sb.toString().replace(<span class="string">"*"</span>,<span class="string">""</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="856-æ‹¬å·çš„åˆ†æ•°"><a href="#856-æ‹¬å·çš„åˆ†æ•°" class="headerlink" title="856. æ‹¬å·çš„åˆ†æ•°"></a><a href="https://leetcode-cn.com/problems/score-of-parentheses/" target="_blank" rel="noopener">856. æ‹¬å·çš„åˆ†æ•°</a></h2><p>ç»™å®šä¸€ä¸ªå¹³è¡¡æ‹¬å·å­—ç¬¦ä¸² Sï¼ŒæŒ‰ä¸‹è¿°è§„åˆ™è®¡ç®—è¯¥å­—ç¬¦ä¸²çš„åˆ†æ•°ï¼š</p><ul><li>() å¾— 1 åˆ†ã€‚</li><li>AB å¾— A + B åˆ†ï¼Œå…¶ä¸­ A å’Œ B æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ã€‚</li><li>(A) å¾— 2 * A åˆ†ï¼Œå…¶ä¸­ A æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ã€‚</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š <span class="string">"()"</span></span><br><span class="line">è¾“å‡ºï¼š <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š <span class="string">"(())"</span></span><br><span class="line">è¾“å‡ºï¼š <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š <span class="string">"()()"</span></span><br><span class="line">è¾“å‡ºï¼š <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š <span class="string">"(()(()))"</span></span><br><span class="line">è¾“å‡ºï¼š <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ol><li>S æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ï¼Œä¸”åªå«æœ‰ ( å’Œ ) ã€‚</li><li>2 <= S.length <= 50</li></ol><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">scoreOfParentheses</span><span class="params">(String S)</span> </span>{</span><br><span class="line">    Stack<integer> stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++){< span><br><span class="line">        <span class="keyword">if</span>(S.charAt(i)==<span class="string">'('</span>){</span><br><span class="line">            stack.push(-<span class="number">11111</span>);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//é‡åˆ°å³æ‹¬å·,ä¸‹é¢çš„åˆ†æ”¯éƒ½æ˜¯å¤„ç† ")"</span></span><br><span class="line">            <span class="keyword">int</span> top=stack.peek();</span><br><span class="line">            <span class="keyword">if</span>(top == -<span class="number">11111</span>){ <span class="comment">//æ ˆé¡¶æ˜¯å·¦æ‹¬å·ï¼Œå°† ( --> 1</span></span><br><span class="line">                stack.pop();</span><br><span class="line">                stack.push(<span class="number">1</span>);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">int</span> sum=<span class="number">0</span>; <span class="comment">//é‡åˆ°æ•°å€¼äº†</span></span><br><span class="line">                <span class="keyword">while</span>(!stack.isEmpty()){</span><br><span class="line">                    <span class="keyword">int</span> temp=stack.pop();</span><br><span class="line">                    <span class="comment">//å¼¹å‡ºå»,ç›´åˆ°é‡åˆ° "("å°±*2,å…¶å®å°±æ˜¯æŠŠ"(1"-->2</span></span><br><span class="line">                    <span class="keyword">if</span>(temp==-<span class="number">11111</span>){ </span><br><span class="line">                        sum*=<span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                    sum+=temp;</span><br><span class="line">                }</span><br><span class="line">                stack.push(sum);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()) res+=stack.pop();</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></s.length();i++){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™ç§è§£æ³•ä¸€å¼€å§‹ä¹Ÿæ²¡æƒ³å‡ºæ¥ï¼Œå…¶å®è¿™ç§å°±ç±»ä¼¼äºæ¶ˆæ¶ˆä¹æ¸¸æˆä¸€æ ·ï¼Œå°±æŒ‰ç…§é¢˜ç›®çš„é€»è¾‘æ¥å†™ï¼Œä»å·¦å‘å³ï¼Œæ ˆä¸­å­˜æ ‡è¯†å·¦æ‹¬å·çš„æ•°å€¼ï¼Œè¿™é‡Œæˆ‘ç”¨çš„<code>-11111</code> è¡¨ç¤º<code>ï¼ˆ</code> ï¼Œç„¶åå‘å³ç§»åŠ¨ï¼Œä¸€è¾¹ç§»åŠ¨ä¸€è¾¹å°†<code>ï¼ˆï¼‰</code>ç»™æ¶ˆé™¤æ‰ï¼Œå…¶å®ä¸Šé¢çš„é€»è¾‘è‡ªå·±èµ°ä¸€è¾¹å°±é€šäº†</p><p><strong>è§£æ³•äºŒ</strong></p><p>è¿™ä¸ªè§£æ³•å°±å¸¦æœ‰ç‚¹æŠ€å·§æ€§äº†ï¼Œçœ‹æ‡‚ä¸Šé¢çš„æ³¨é‡Šï¼Œä¸‹é¢çš„ä»£ç å°±å¾ˆç®€å•äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// (()(())) = 2*()+2*(())= (())+((()))</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">scoreOfParentheses</span><span class="params">(String S)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> k=<span class="number">0</span>,res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        <span class="keyword">if</span> (S.charAt(i)==<span class="string">'('</span>) {</span><br><span class="line">            k++; <span class="comment">//kç”¨æ¥è®¡ç®—æ‹¬å·çš„æ·±åº¦</span></span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            k--;</span><br><span class="line">            <span class="keyword">if</span> (S.charAt(i-<span class="number">1</span>)==<span class="string">'('</span>) {</span><br><span class="line">                <span class="comment">//"()"é—­åˆçš„æ—¶å€™è®¡ç®—ä¸€æ³¢</span></span><br><span class="line">                res+= <span class="number">1</span><<k;< span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></k;<></span></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -I"><a href="#496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -I" class="headerlink" title="496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I"></a><a href="https://leetcode-cn.com/problems/next-greater-element-i/" target="_blank" rel="noopener">496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I</a></h2><p>ç»™å®šä¸¤ä¸ª<strong>æ²¡æœ‰é‡å¤å…ƒç´ </strong>çš„æ•°ç»„ nums1 å’Œ nums2 ï¼Œå…¶ä¸­nums1 æ˜¯ nums2 çš„å­é›†ã€‚æ‰¾åˆ° nums1 ä¸­æ¯ä¸ªå…ƒç´ åœ¨ nums2 ä¸­çš„ä¸‹ä¸€ä¸ªæ¯”å…¶å¤§çš„å€¼ã€‚</p><p>nums1 ä¸­æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯æŒ‡ x åœ¨ nums2 ä¸­å¯¹åº”ä½ç½®çš„å³è¾¹çš„ç¬¬ä¸€ä¸ªæ¯” x å¤§çš„å…ƒç´ ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå¯¹åº”ä½ç½®è¾“å‡º-1ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums1 = [<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>], nums2 = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>].</span><br><span class="line">è¾“å‡º: [-<span class="number">1</span>,<span class="number">3</span>,-<span class="number">1</span>]</span><br><span class="line">è§£é‡Š:</span><br><span class="line">    å¯¹äºnum1ä¸­çš„æ•°å­—<span class="number">4</span>ï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒä¸ªæ•°ç»„ä¸­æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -<span class="number">1</span>ã€‚</span><br><span class="line">    å¯¹äºnum1ä¸­çš„æ•°å­—<span class="number">1</span>ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ•°å­—<span class="number">1</span>å³è¾¹çš„ä¸‹ä¸€ä¸ªè¾ƒå¤§æ•°å­—æ˜¯ <span class="number">3</span>ã€‚</span><br><span class="line">    å¯¹äºnum1ä¸­çš„æ•°å­—<span class="number">2</span>ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -<span class="number">1</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums1 = [<span class="number">2</span>,<span class="number">4</span>], nums2 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].</span><br><span class="line">è¾“å‡º: [<span class="number">3</span>,-<span class="number">1</span>]</span><br><span class="line">è§£é‡Š:</span><br><span class="line">    å¯¹äºnum1ä¸­çš„æ•°å­—<span class="number">2</span>ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªè¾ƒå¤§æ•°å­—æ˜¯<span class="number">3</span>ã€‚</span><br><span class="line">    å¯¹äºnum1ä¸­çš„æ•°å­—<span class="number">4</span>ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -<span class="number">1</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong></p><ol><li><code>nums1</code>å’Œ<code>nums2</code>ä¸­æ‰€æœ‰å…ƒç´ æ˜¯å”¯ä¸€çš„ã€‚</li><li><code>nums1</code>å’Œ<code>nums2</code> çš„æ•°ç»„å¤§å°éƒ½ä¸è¶…è¿‡1000ã€‚</li></ol><p><strong>è§£æ³•ä¸€</strong></p><p>å•è°ƒæ ˆï¼Œå¾ˆå°±ä¹‹å‰åœ¨é“¾è¡¨ä¸“é¢˜ä¸­åšè¿‡ä¸€æ¬¡ <a href="http://imlgw.top/2019/02/27/leetcode-lian-biao/#1019-%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A4%A7%E8%8A%82%E7%82%B9">é“¾è¡¨çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹</a> ä½†æ˜¯æ²¡æƒ³èµ·æ¥ï¼Œå¯èƒ½å½“æ—¶ä¹Ÿæ²¡ç•™ä¸‹å½±å“</p><p>è¿™é¢˜å…¶å®è¿˜æ¯”åŸå§‹çš„é¢˜åŠ äº†ä¸€ç‚¹éš¾åº¦ï¼ŒåŸå§‹çš„é¢˜å°±æ˜¯ num1==nums2çš„æƒ…å†µï¼Œé‚£æ ·å°±ä¸éœ€è¦HashMapè®°å½•äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] nextGreaterElement(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) {</span><br><span class="line">    HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    Stack<integer> stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums2.length;i++) {< span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() && nums2[stack.peek()]<nums2[i]){< span><br><span class="line">            map.put(nums2[stack.pop()],nums2[i]);</span><br><span class="line">        }</span><br><span class="line">        stack.add(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] res=<span class="keyword">new</span> <span class="keyword">int</span>[nums1.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums1.length;i++) {< span><br><span class="line">        res[i]=map.getOrDefault(nums1[i],-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums1.length;i++)></span></nums2[i]){<></span></nums2.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -II"><a href="#503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -II" class="headerlink" title="503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II"></a><a href="https://leetcode-cn.com/problems/next-greater-element-ii/" target="_blank" rel="noopener">503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II</a></h2><p>ç»™å®šä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¾“å‡ºæ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€‚æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ æ˜¯æŒ‰æ•°ç»„éå†é¡ºåºï¼Œè¿™ä¸ªæ•°å­—ä¹‹åçš„ç¬¬ä¸€ä¸ªæ¯”å®ƒæ›´å¤§çš„æ•°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥å¾ªç¯åœ°æœç´¢å®ƒçš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º -1ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">2</span>,-<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è§£é‡Š: ç¬¬ä¸€ä¸ª <span class="number">1</span> çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°æ˜¯ <span class="number">2</span>ï¼›</span><br><span class="line">æ•°å­— <span class="number">2</span> æ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ï¼› </span><br><span class="line">ç¬¬äºŒä¸ª <span class="number">1</span> çš„ä¸‹ä¸€ä¸ªæœ€å¤§çš„æ•°éœ€è¦å¾ªç¯æœç´¢ï¼Œç»“æœä¹Ÿæ˜¯ <span class="number">2</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong> è¾“å…¥æ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 10000ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] nextGreaterElements(<span class="keyword">int</span>[] nums) {</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{};</span><br><span class="line">    }</span><br><span class="line">    Stack<integer> stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    stack.push(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span>[] res=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    Arrays.fill(res,-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length*<span class="number">2</nums.length*<span></span>;i++) {<br><span class="line">        index=i>=nums.length?i%nums.length:i;</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty()&&nums[stack.peek()]<nums[index]) {< span><br><span class="line">            res[stack.pop()]=nums[index];</span><br><span class="line">        }</span><br><span class="line">        stack.push(index);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums[index])></span></pre></td></tr></tbody></table></figure></div><p>å’Œä¸Šé¢ä¸€æ ·ï¼Œåªä¸è¿‡éœ€è¦å¾ªç¯éå†ä¸€éï¼Œæˆ‘æœ€å¼€å§‹çš„åšæ³•ç›¸å½“æ†¨æ†¨ï¼Œcopyäº†ä¸€ä¸ªä¸¤å€çš„æ•°ç»„ã€‚ã€‚ã€‚è¿˜éœ€è¦æ³¨æ„çš„å°±æ˜¯ <code>-1</code>çš„å¤„ç†</p><h2 id="739-æ¯æ—¥æ¸©åº¦"><a href="#739-æ¯æ—¥æ¸©åº¦" class="headerlink" title="739. æ¯æ—¥æ¸©åº¦"></a><a href="https://leetcode-cn.com/problems/daily-temperatures/" target="_blank" rel="noopener">739. æ¯æ—¥æ¸©åº¦</a></h2><p>æ ¹æ®æ¯æ—¥ æ°”æ¸© åˆ—è¡¨ï¼Œè¯·é‡æ–°ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ï¼Œå¯¹åº”ä½ç½®çš„è¾“å…¥æ˜¯ä½ éœ€è¦å†ç­‰å¾…å¤šä¹…æ¸©åº¦æ‰ä¼šå‡é«˜è¶…è¿‡è¯¥æ—¥çš„å¤©æ•°ã€‚å¦‚æœä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåˆ—è¡¨ temperatures = [73, 74, 75, 71, 69, 72, 76, 73]ï¼Œä½ çš„è¾“å‡ºåº”è¯¥æ˜¯ [1, 1, 4, 2, 1, 1, 0, 0]ã€‚</p><p>æç¤ºï¼šæ°”æ¸© åˆ—è¡¨é•¿åº¦çš„èŒƒå›´æ˜¯ [1, 30000]ã€‚æ¯ä¸ªæ°”æ¸©çš„å€¼çš„å‡ä¸ºåæ°åº¦ï¼Œéƒ½æ˜¯åœ¨ [30, 100] èŒƒå›´å†…çš„æ•´æ•°ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] dailyTemperatures(<span class="keyword">int</span>[] T) {</span><br><span class="line">    <span class="keyword">int</span>[] res=<span class="keyword">new</span> <span class="keyword">int</span>[T.length];</span><br><span class="line">    <span class="keyword">if</span>(T==<span class="keyword">null</span> || T.length<=<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Stack<integer> stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    stack.push(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<t.length;i++) {< span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty()&&T[stack.peek()]<t[i]){< span><br><span class="line">            <span class="keyword">int</span> temp=stack.pop();</span><br><span class="line">            res[temp]=i-temp;</span><br><span class="line">        }</span><br><span class="line">        stack.push(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></t[i]){<></span></t.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å’Œä¸Šé¢ä¸¤é¢˜ä¸€æ ·ï¼Œå•è°ƒæ ˆçš„è§£æ³•ï¼Œä¸è¿‡è¿™é¢˜å¥½åƒå¯ä»¥ä¸ç”¨å•è°ƒæ ˆï¼Œå¯ä»¥ä»åå‘å‰é€’æ¨</p><h2 id="84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢"><a href="#84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢" class="headerlink" title="84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢"></a><a href="https://leetcode-cn.com/problems/largest-rectangle-in-histogram/" target="_blank" rel="noopener">84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢</a></h2><p>ç»™å®š <em>n</em> ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚</p><p>æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚</p><p><img alt="leetCode" data-src="https://i.loli.net/2019/12/12/a7pVfNcYuIKFgwA.png" src="/img/loading.gif" class="lazyload"></p><p>ä»¥ä¸Šæ˜¯æŸ±çŠ¶å›¾çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªæŸ±å­çš„å®½åº¦ä¸º 1ï¼Œç»™å®šçš„é«˜åº¦ä¸º <code>[2,1,5,6,2,3]</code>ã€‚</p><p><img alt="leetCode" data-src="https://i.loli.net/2019/12/12/FAvMk3zWf4RheDi.png" src="/img/loading.gif" class="lazyload"></p><p>å›¾ä¸­é˜´å½±éƒ¨åˆ†ä¸ºæ‰€èƒ½å‹¾å‹’å‡ºçš„æœ€å¤§çŸ©å½¢é¢ç§¯ï¼Œå…¶é¢ç§¯ä¸º <code>10</code> ä¸ªå•ä½ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡º: <span class="number">10</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸Šé¢å‡ é“é¢˜ä¸€æ ·ï¼Œå•è°ƒæ ˆçš„è§£æ³•ï¼Œ20msï¼Œ87%</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">largestRectangleArea</span><span class="params">(<span class="keyword">int</span>[] heights)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (heights==<span class="keyword">null</span> || heights.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    Stack<integer> stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    <span class="keyword">int</span> maxArea= Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<heights.length;i++) {< span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() && heights[i]<=heights[stack.peek()]){</span><br><span class="line">            <span class="comment">//å½“å‰çš„æŸ±å­å°äºæ ˆé¡¶,è¯´æ˜å½“å‰æ ˆé¡¶æœ€å¤šå‘å³æ‰©å±•åˆ° i-1</span></span><br><span class="line">            <span class="keyword">int</span> cur=stack.pop();</span><br><span class="line">            <span class="comment">//ä¸ºç©ºè¯´æ˜å‘å·¦æ— æ³•æ‰©å±•,æ ‡ä¸º-1ä¸å½±å“ç»“æœ</span></span><br><span class="line">            <span class="keyword">int</span> left=stack.isEmpty()?-<span class="number">1</span>:stack.peek();</span><br><span class="line">            <span class="comment">//è¿™é‡Œå…¶å®æ˜¯ (i-1)-(left+1)+1</span></span><br><span class="line">            maxArea=Math.max(maxArea,(i-left-<span class="number">1</span>)*heights[cur]);</span><br><span class="line">        }</span><br><span class="line">        stack.push(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¤„ç†æ ˆä¸­å‰©ä¸‹çš„å…ƒç´ ,æ— æ³•å‘å³æ‰©å±•,åªèƒ½å‘å·¦æ‰©å±•</span></span><br><span class="line">    <span class="comment">//æ‰€ä»¥ä¸ºäº†è®©æ‰€æœ‰çš„å…ƒç´ éƒ½èƒ½å‡ºæ ˆ,æˆ‘ä»¬å¯ä»¥å†æ•°ç»„çš„åé¢æƒ³è±¡æ·»åŠ ä¸€ä¸ª0(ä¹Ÿå¯ä»¥ç›´æ¥åœ¨åŸæ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ª0)</span></span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty()){ </span><br><span class="line">        <span class="keyword">int</span> cur=stack.pop();</span><br><span class="line">        <span class="keyword">int</span> left=stack.isEmpty()?-<span class="number">1</span>:stack.peek();</span><br><span class="line">        <span class="comment">//è¿™ä¸€æ­¥å¾ˆç§€,åœ¨æ•°ç»„åé¢å†æƒ³è±¡ä¸€ä¸ª0å‡ºæ¥</span></span><br><span class="line">        <span class="comment">//è®©æ ˆä¸­å…ƒç´ å‘å³æ‰©å¼ (heights.length-1)-(left+1)+1</span></span><br><span class="line">        maxArea=Math.max(maxArea,(heights.length-left-<span class="number">1</span>)*heights[cur]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> maxArea;</span><br><span class="line">}</span><br></heights.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®å°±æ˜¯åˆ©ç”¨å•è°ƒæ ˆéå†æ¯ä¸€ä¸ªæŸ±å­ï¼Œ<strong>æ‰¾åˆ°æ¯ä¸€ä¸ªæŸ±å­å·¦è¾¹å’Œå³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ </strong>ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥æ ¹æ®è¿™ä¸¤ä¸ªæ•°æ®è®¡ç®—å®Œå…¨åŒ…å«å½“å‰æŸ±å­çš„æœ€å¤§çš„çŸ©å½¢çš„é¢ç§¯ã€‚</p><p>ä¾‹å¦‚: <code>3 4 5 4 3 6</code> </p><p>é¦–å…ˆ<code>3 4 5</code>éƒ½é¡ºåˆ©çš„å­˜å…¥æ ˆä¸­ï¼Œæ­¤æ—¶æ ˆä¸­å…ƒç´ ä¸º<code>ã€0ï¼Œ1ï¼Œ2ã€‘</code> ï¼Œå½“æƒ³å­˜å…¥ä¸‹ä¸€ä¸ªå…ƒç´ <code>i=3,h[i]=4</code>çš„æ—¶å€™ï¼Œå‘ç°4æ¯”å½“å‰æ ˆé¡¶å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è®¡ç®—<strong>æ ˆä¸­æ¯ä¸ªæŸ±å­</strong>å¯ä»¥æ„æˆçš„æœ€å¤§çŸ©å½¢çš„é¢ç§¯</p><ol><li>ç”±äºå½“å‰<strong><code>i</code></strong> ä½ç½®çš„å…ƒç´ æ˜¯æ¯”æ ˆé¡¶å°ï¼Œé‚£ä¹ˆå°±è¯´æ˜ <strong><code>i-1</code></strong> ä½ç½®çš„å…ƒç´ ä¸€å®šæ¯”å½“å‰æ ˆé¡¶å…ƒç´ å¤§ï¼ä¹Ÿå°±æ˜¯å‘å³è¾¹æœ€å¤šæ‰©å±•åˆ°<strong><code>i-1</code></strong>ä½ç½®</li><li>ç”±äºå•è°ƒæ ˆçš„ç»“æ„ï¼Œå½“å‰æ ˆé¡¶çš„ä¸‹ä¸€ä¸ªæ ˆä¸­å…ƒç´ <strong><code>left</code></strong>ï¼Œå…¶å®å°±æ˜¯å½“å‰æ ˆé¡¶çš„å·¦è¾¹æœ€è¿‘çš„æ¯”å®ƒå°çš„å…ƒç´ ï¼Œæ‰€ä»¥<strong><code>left+1</code></strong>ä½ç½®çš„å…ƒç´ ä¸€å®šæ˜¯æ¯”å½“å‰æ ˆé¡¶å…ƒç´ å¤§ï¼ï¼Œæ‰€ä»¥å‘å·¦è¾¹æœ€å¤šæ‰©å±•åˆ° <strong><code>left+1</code></strong> ä½ç½®</li><li>ä¸Šé¢å…¶å®è¿˜åˆ†ææ¼äº†ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯æ ˆé¡¶å’Œ <strong><code>i</code></strong> ä½ç½®å…ƒç´ ç›¸ç­‰çš„æƒ…å†µï¼Œç¬¬ä¸€ç‚¹ä¸­æåˆ°çš„å…¶å®æ˜¯ <strong><code>i</code></strong> ä½ç½®å…ƒç´ å°äºæ ˆé¡¶çš„æƒ…å†µï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå‘å³èƒ½æ‰©å±•åˆ°çš„ä½ç½®è¿˜ä¼šæ˜¯<strong><code>i-1</code></strong>ä¹ˆï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿå…¶å®æ ¹æœ¬å°±ä¸ç”¨å¤„ç†ï¼Œæ—¢ç„¶æ ˆé¡¶èƒ½<strong>å‘å³</strong>æ‰©å±•åˆ° <strong><code>i</code></strong> é‚£ä¹ˆåè¿‡æ¥ï¼Œ<strong><code>i</code></strong> ä¸€æ ·å¯ä»¥<strong>å‘å·¦</strong>æ‰©å±•åˆ° æ ˆé¡¶ä½ç½®ï¼Œè€Œå‘å·¦æ‰©å±•çš„<strong><code>left+1</code></strong>æ˜¯å‡†ç¡®çš„ï¼Œä¸ä¼šæœ‰è¯¯å·®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç­‰å¾… <strong><code>i</code></strong>ä½ç½®çš„å…ƒç´ å¼¹å‡ºï¼Œç„¶åå°±å¯ä»¥é‡æ–°è®¡ç®—å¾—åˆ°æœ€å¤§å€¼ï¼Œå½“ç„¶è¿™é‡Œå…¶å®é‚£ä¸ª <strong><code>heights[i]<=heights[stack.peek()]</code></strong> ä¸­çš„ç­‰å·ä¹Ÿå¯ä»¥å»æ‰ï¼Œè¿™æ ·æ ˆå°±ä¸æ˜¯ä¸¥æ ¼å•è°ƒçš„äº†ï¼Œ<strong><code>left+1</code></strong>ä¹Ÿä¸å†å‡†ç¡®ï¼Œä½†æ˜¯æ­¤æ—¶ <strong><code>i</code></strong> å°±å‡†ç¡®äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç­‰å¾…<strong><code>left+1</code></strong> å¼¹æ ˆä¹‹åå†é‡æ–°è®¡ç®—ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç›¸ç­‰çš„æƒ…å†µæ˜¯ä¸ç”¨åšé¢å¤–çš„å¤„ç†</li></ol><p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œä»£ç å°±å¥½å†™å¤šäº†ï¼Œä¸è¿‡è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å€¼å¾—æ³¨æ„ï¼Œå°±æ˜¯å¤„ç†æ ˆä¸­å‰©ä½™çš„å…ƒç´ ï¼Œå…¶å®æ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯åœ¨æ•°ç»„çš„æœ«å°¾åŠ ä¸€ä¸ª0ï¼Œè¿™æ ·ç¡®ä¿æ ˆä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½å¯ä»¥å‡ºæ ˆï¼Œä¸ç”¨é¢å¤–çš„å¤„ç†ï¼Œjavaä¸­æ²¡æ³•ç›´æ¥å‘æ•°ç»„ä¸­pushå…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æƒ³è±¡æœ«å°¾æœ‰ä¸€ä¸ª0ï¼Œé‚£ä¹ˆæ‰€æœ‰å…ƒç´ å‘å·¦èƒ½æ‰©å±•åˆ°çš„æœ€è¿œä½ç½®å°±æ˜¯ <code>heights.length-1</code></p><p><strong>è§£æ³•äºŒ</strong></p><p>åˆ†æ²»ï¼Œ480msï¼Œ27%</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ†æ²» 480ms</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">largestRectangleArea</span><span class="params">(<span class="keyword">int</span>[] heights)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (heights==<span class="keyword">null</span> || heights.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    largestRectangleArea(heights,<span class="number">0</span>,heights.length-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> maxArea;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxArea=Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">largestRectangleArea</span><span class="params">(<span class="keyword">int</span>[] heights,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left>right) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> minIndex=left;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=left;i<=right;i++) {</span><br><span class="line">        minIndex=heights[i]<heights[minindex]?i:minindex;< span><br><span class="line">    }</span><br><span class="line">    maxArea=Math.max(heights[minIndex]*(right-left+<span class="number">1</span>),maxArea);</span><br><span class="line">    largestRectangleArea(heights,left,minIndex-<span class="number">1</span>);</span><br><span class="line">    largestRectangleArea(heights,minIndex+<span class="number">1</span>,right);</span><br><span class="line">}</span><br></heights[minindex]?i:minindex;<></span></pre></td></tr></tbody></table></figure></div><p>å°†æ•°ç»„åŒºé—´ä»¥<code>minIndex</code>ä¸ºåˆ†ç•Œçº¿ï¼Œåˆ†åˆ«æ±‚å·¦è¾¹å’Œå³è¾¹çš„æœ€å¤§é¢ç§¯ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(NlogN)</code></p><p><strong>è§£æ³•ä¸‰</strong></p><p>ä¼˜åŒ–çš„åˆ†æ²» 1msï¼Œ100%ï¼Œæ²¡æƒ³åˆ°æ¯”å•è°ƒæ ˆè¿˜å¿«ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">largestRectangleArea</span><span class="params">(<span class="keyword">int</span>[] heights)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (heights==<span class="keyword">null</span> || heights.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> largestRectangleArea(heights,<span class="number">0</span>,heights.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">largestRectangleArea</span><span class="params">(<span class="keyword">int</span>[] heights,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (left>right) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> minIndex=left;</span><br><span class="line">    <span class="keyword">boolean</span> up=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">boolean</span> down=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=left+<span class="number">1</span>;i<=right;i++) {</span><br><span class="line">        <span class="keyword">if</span> (heights[i]<heights[i-<span class="number">1</heights[i-<span></span>]) {<br><span class="line">            up=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (heights[i]>heights[i-<span class="number">1</span>]) {</span><br><span class="line">            down=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        minIndex=heights[i]<heights[minindex]?i:minindex;< span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (up) {</span><br><span class="line">        <span class="keyword">int</span> maxArea=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=left;i<=right;i++) {</span><br><span class="line">            maxArea=Math.max(maxArea,(right-i+<span class="number">1</span>)*heights[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> maxArea;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (down) {</span><br><span class="line">        <span class="keyword">int</span> maxArea=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=right;i>=left;i--) {</span><br><span class="line">            maxArea=Math.max(maxArea,(i-left+<span class="number">1</span>)*heights[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> maxArea;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.max(heights[minIndex]*(right-left+<span class="number">1</span>),Math.max(largestRectangleArea(heights,minIndex+<span class="number">1</span>,right),largestRectangleArea(heights,left,minIndex-<span class="number">1</span>)));</span><br><span class="line">}</span><br></heights[minindex]?i:minindex;<></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®ç›¸æ¯”äºä¸Šé¢çš„åˆ†æ²»ï¼Œå°±æ˜¯å¤šäº†ä¸€æ­¥åˆ¤æ–­å½“å‰åŒºé—´æ˜¯å¦æœ‰åºï¼Œå› ä¸ºæœ‰åºçš„è¯å°±å¯ä»¥ç›´æ¥éå†å¾—åˆ°åŒºé—´çš„æœ€å¤§çŸ©å½¢ï¼Œä¸ç”¨å†é€’å½’åšåˆ†æ²»ï¼Œæˆ‘è¿™é‡Œåšäº†ä¸¤ä¸ªæœ‰åºçš„åˆ¤æ–­ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æœ‰çš„å¤šä½™ï¼Œæˆ‘çœ‹çš„è¯„è®ºéƒ½åªæœ‰ä¸€ä¸ª</p><h2 id="85-æœ€å¤§çŸ©å½¢"><a href="#85-æœ€å¤§çŸ©å½¢" class="headerlink" title="85. æœ€å¤§çŸ©å½¢"></a><a href="https://leetcode-cn.com/problems/maximal-rectangle/" target="_blank" rel="noopener">85. æœ€å¤§çŸ©å½¢</a></h2><p>ç»™å®šä¸€ä¸ªä»…åŒ…å« 0 å’Œ 1 çš„äºŒç»´äºŒè¿›åˆ¶çŸ©é˜µï¼Œæ‰¾å‡ºåªåŒ…å« 1 çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  [<span class="string">"1"</span>,<span class="string">"0"</span>,<span class="string">"1"</span>,<span class="string">"0"</span>,<span class="string">"0"</span>],</span><br><span class="line">  [<span class="string">"1"</span>,<span class="string">"0"</span>,<span class="string">"1"</span>,<span class="string">"1"</span>,<span class="string">"1"</span>],</span><br><span class="line">  [<span class="string">"1"</span>,<span class="string">"1"</span>,<span class="string">"1"</span>,<span class="string">"1"</span>,<span class="string">"1"</span>],</span><br><span class="line">  [<span class="string">"1"</span>,<span class="string">"0"</span>,<span class="string">"0"</span>,<span class="string">"1"</span>,<span class="string">"0"</span>]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>ç‰¹æ„åœ¨åšäº†ä¸Šé¢ä¸€é¢˜åæ²¡æœ‰é©¬ä¸Šåšè¿™ä¸€é¢˜ï¼Œä¸‹é¢çš„æ˜¯ç¬¬äºŒå¤©ä¸‹åˆåšçš„ï¼Œè¿˜è¡Œï¼Œæ²¡å¿˜è®°ğŸ˜‚ï¼Œå°±æ˜¯å†™çš„æœ‰ç‚¹éš¾çœ‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ²¡å†™å¥½,å†™çš„éº»çƒ¦äº†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maximalRectangleSilly</span><span class="params">(<span class="keyword">char</span>[][] matrix)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (matrix==<span class="keyword">null</span> || matrix.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–heightæ•°ç»„,åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ (é»˜è®¤0)è®©æ‰€æœ‰å…ƒç´ å¯ä»¥å‡ºæ ˆ</span></span><br><span class="line">    <span class="keyword">int</span>[][] height=<span class="keyword">new</span> <span class="keyword">int</span>[matrix.length][matrix[<span class="number">0</span>].length+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<matrix[<span class="number">0</matrix[<span></span>].length;i++) {<br><span class="line">        height[<span class="number">0</span>][i]=matrix[<span class="number">0</span>][i]-<span class="number">48</span>; <span class="comment">//åˆå§‹åŒ–ç¬¬ä¸€å±‚</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> max=maxArea(height[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">//è®°å½•æ¯ä¸€å±‚çš„height</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<matrix.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<matrix[<span class="number">0</matrix[<span></span>].length;j++) {</matrix.length;i++)></span><br><span class="line">            <span class="keyword">if</span> (matrix[i][j]==<span class="string">'1'</span> && matrix[i-<span class="number">1</span>][j] ==<span class="string">'1'</span>) {</span><br><span class="line">                height[i][j]=height[i-<span class="number">1</span>][j]+<span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                height[i][j]=matrix[i][j]-<span class="number">48</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        max=Math.max(max,maxArea(height[i]));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(<span class="keyword">int</span>[] height)</span></span>{</span><br><span class="line">    Stack<integer> stack=<span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<height.length;i++) {< span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() && height[stack.peek()]>=height[i]){</span><br><span class="line">            <span class="keyword">int</span> cur=stack.pop();</span><br><span class="line">            <span class="keyword">int</span> left=stack.isEmpty()?-<span class="number">1</span>:stack.peek();</span><br><span class="line">            <span class="comment">// (i-1)-(left+1)+1</span></span><br><span class="line">            max=Math.max(max,(i-left-<span class="number">1</span>)*height[cur]);</span><br><span class="line">        }</span><br><span class="line">        stack.push(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></height.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®è®¡ç®—heightæœ‰ä¸€ç‚¹åŠ¨æ€è§„åˆ’çš„æ„æ€ï¼Œæˆ‘ä¸Šé¢ç›¸å½“äºå†™äº†ä¸ªäºŒç»´çš„åŠ¨æ€è§„åˆ’</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maximalRectangle</span><span class="params">(<span class="keyword">char</span>[][] matrix)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (matrix==<span class="keyword">null</span> || matrix.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–heightæ•°ç»„,åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ (é»˜è®¤0)è®©æ‰€æœ‰å…ƒç´ å¯ä»¥å‡ºæ ˆ</span></span><br><span class="line">    <span class="keyword">int</span>[] height=<span class="keyword">new</span> <span class="keyword">int</span>[matrix[<span class="number">0</span>].length+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//è®°å½•æ¯ä¸€å±‚çš„height</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<matrix.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<matrix[<span class="number">0</matrix[<span></span>].length;j++) {</matrix.length;i++)></span><br><span class="line">            height[j]=matrix[i][j]==<span class="string">'1'</span>?height[j]+<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        max=Math.max(max,maxArea(height));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><code>maxArea</code>å¯ä»¥ç›´æ¥é‡‡ç”¨ä¸Šé¢84é¢˜çš„åˆ†æ²»</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥AQSæºç è§£æï¼ˆä¸€ï¼‰</title>
      <link href="/2019/09/24/abstractqueuedsynchronizer/"/>
      <url>/2019/09/24/abstractqueuedsynchronizer/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="AbstractQueuedSynchronized"><a href="#AbstractQueuedSynchronized" class="headerlink" title="AbstractQueuedSynchronized"></a>AbstractQueuedSynchronized</h2><p><code>AbstractQueuedSynchronized</code> ç®€ç§°AQSï¼Œè¿™ä¸ªç±»æ˜¯æ•´ä¸ªå¹¶å‘åŒ…çš„åŸºç¡€å·¥å…·ç±»ï¼Œ ReentrantLockã€CountDownLatchã€Semaphoreã€FutureTask ç­‰å¹¶å‘å·¥å…·ç±»åº•å±‚éƒ½æ˜¯é€šè¿‡å®ƒæ¥å®ç°çš„</p><p>AQSå®šä¹‰äº†ä¸¤ç§èµ„æºå…±äº«çš„æ–¹å¼ï¼š</p><ul><li>Exclusiveï¼šç‹¬å å¼ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–èµ„æºå¹¶æ‰§è¡Œï¼Œæ¯”å¦‚ReentrantLockã€‚</li><li>Shareï¼šå…±äº«å¼ï¼Œå¤šä¸ªçº¿ç¨‹è·å–èµ„æºï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œæ¯”å¦‚CountDownLatchï¼ŒReentrantReadWriteLockçš„ReadLockç­‰</li></ul><h3 id="AQSç»“æ„"><a href="#AQSç»“æ„" class="headerlink" title="AQSç»“æ„"></a>AQSç»“æ„</h3><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><p>ä¸»è¦çš„å°±æ˜¯è¿™ä¸‰ä¸ªvolatileä¿®é¥°çš„Nodeå¯¹è±¡ï¼Œè¿˜æœ‰ä¸€äº›å¯¹åº”çš„åç§»é‡(ç”¨äºCASçš„)</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Head of the wait queue, lazily initialized.  Except for</span></span><br><span class="line"><span class="comment"> * initialization, it is modified only via method setHead.  Note:</span></span><br><span class="line"><span class="comment"> * If head exists, its waitStatus is guaranteed not to be</span></span><br><span class="line"><span class="comment"> * CANCELLED.</span></span><br><span class="line"><span class="comment"> * å¤´èŠ‚ç‚¹ï¼Œå¯ä»¥ç†è§£ä¸ºå½“å‰æŒæœ‰é”çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * åœ¨åˆ†æçš„è¿‡ç¨‹ä¸­ä¸è¦å°†å®ƒç®—ä½œé˜Ÿåˆ—çš„ä¸€éƒ¨åˆ†ï¼å®ƒåªæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node head;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Tail of the wait queue, lazily initialized.  Modified only via</span></span><br><span class="line"><span class="comment"> * method enq to add new wait node.</span></span><br><span class="line"><span class="comment"> * å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node tail;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The synchronization state.</span></span><br><span class="line"><span class="comment"> * åŒæ­¥çŠ¶æ€ï¼Œ0ä»£è¡¨æ²¡æœ‰è¢«å ç”¨ï¼Œ1ä»£è¡¨è¢«ä¸€ä¸ªçº¿ç¨‹å ç”¨ï¼Œ>1 ä»£è¡¨è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡å ç”¨ï¼ˆå¯é‡å…¥ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;</span><br></pre></td></tr></tbody></table></figure></div><h4 id="NodeèŠ‚ç‚¹"><a href="#NodeèŠ‚ç‚¹" class="headerlink" title="NodeèŠ‚ç‚¹"></a>NodeèŠ‚ç‚¹</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>{</span><br><span class="line">    <span class="comment">/** Marker to indicate a node is waiting in shared mode */</span></span><br><span class="line">    <span class="comment">//å…±äº«æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Node SHARED = <span class="keyword">new</span> Node();</span><br><span class="line">    <span class="comment">/** Marker to indicate a node is waiting in exclusive mode */</span></span><br><span class="line">    <span class="comment">//ç‹¬å æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Node EXCLUSIVE = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** waitStatus value to indicate thread has cancelled */</span></span><br><span class="line">    <span class="comment">//å–æ¶ˆæŠ¢é”</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED =  <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** waitStatus value to indicate successor's thread needs unparking */</span></span><br><span class="line">    <span class="comment">//ä»£è¡¨å½“å‰èŠ‚ç‚¹çš„åç»­èŠ‚ç‚¹éœ€è¦è¢«unparkingï¼Œä¹Ÿå°±æ˜¯è¯´åç»§èŠ‚ç‚¹çŠ¶æ€æ˜¯parking</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIGNAL    = -<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** waitStatus value to indicate thread is waiting on condition */</span></span><br><span class="line">    <span class="comment">//åœ¨conditionä¸Šç­‰å¾…</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONDITION = -<span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * waitStatus value to indicate the next acquireShared should</span></span><br><span class="line"><span class="comment">     * unconditionally propagate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROPAGATE = -<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸Šé¢çš„é‚£äº›çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> waitStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‰é©±èŠ‚ç‚¹    </span></span><br><span class="line">    <span class="keyword">volatile</span> Node prev;</span><br><span class="line">    <span class="comment">//åç»§èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">volatile</span> Node next;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The thread that enqueued this node.  Initialized on</span></span><br><span class="line"><span class="comment">     * construction and nulled out after use.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">volatile</span> Thread thread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Link to next node waiting on condition, or the special</span></span><br><span class="line"><span class="comment">     * value SHARED.  Because condition queues are accessed only</span></span><br><span class="line"><span class="comment">     * when holding in exclusive mode, we just need a simple</span></span><br><span class="line"><span class="comment">     * linked queue to hold nodes while they are waiting on</span></span><br><span class="line"><span class="comment">     * conditions. They are then transferred to the queue to</span></span><br><span class="line"><span class="comment">     * re-acquire. And because conditions can only be exclusive,</span></span><br><span class="line"><span class="comment">     * we save a field by using special value to indicate shared</span></span><br><span class="line"><span class="comment">     * mode.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Node nextWaiter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if node is waiting in shared mode.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isShared</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> nextWaiter == SHARED;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> Node <span class="title">predecessor</span><span class="params">()</span> <span class="keyword">throws</span> NullPointerException </span>{</span><br><span class="line">        Node p = prev;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Node() {    <span class="comment">// Used to establish initial head or SHARED marker</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Node(Thread thread, Node mode) {     <span class="comment">// Used by addWaiter</span></span><br><span class="line">        <span class="keyword">this</span>.nextWaiter = mode;</span><br><span class="line">        <span class="keyword">this</span>.thread = thread;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Node(Thread thread, <span class="keyword">int</span> waitStatus) { <span class="comment">// Used by Condition</span></span><br><span class="line">        <span class="keyword">this</span>.waitStatus = waitStatus;</span><br><span class="line">        <span class="keyword">this</span>.thread = thread;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="ReentrantLockåˆ†æ"><a href="#ReentrantLockåˆ†æ" class="headerlink" title="ReentrantLockåˆ†æ"></a>ReentrantLockåˆ†æ</h2><p>æˆ‘ä»¬çŸ¥é“ReentrantLockå†…éƒ¨æœ‰ä¸¤ä¸ªé”ï¼Œä¸€ä¸ªæ˜¯å…¬å¹³é”(FairSync)ğŸ”’ï¼Œä¸€ä¸ªæ˜¯éå…¬å¹³é”(NonFairSync)ğŸ”’ï¼Œè¿™ä¸¤ä¸ªé”éƒ½æ˜¯ç‹¬å é”ï¼Œä¸¤è€…å®ç°çš„å·®å¼‚å…¶å®å¹¶ä¸å¤§ï¼Œæˆ‘ä»¬å…ˆä»<code>å…¬å¹³é”</code>å¼€å§‹è¯´èµ·ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">3000897897090466540L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">        acquire(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Fair version of tryAcquire.  Don't grant access unless</span></span><br><span class="line"><span class="comment">     * recursive call or no waiters or is first.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">        <span class="keyword">int</span> c = getState();</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (!hasQueuedPredecessors() &&</span><br><span class="line">                compareAndSetState(<span class="number">0</span>, acquires)) {</span><br><span class="line">                setExclusiveOwnerThread(current);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) {</span><br><span class="line">            <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">            <span class="keyword">if</span> (nextc < <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">            setState(nextc);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock()"></a>Lock()</h3><p>ğŸ”” <strong>è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ¨¡æ‹ŸçœŸå®çš„æƒ…å†µï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹<code>Thread0</code> å’Œ<code>Thread1</code> è¿‡æ¥æ‰§è¡Œäº†<code>Lock()</code> æ–¹æ³•ï¼Œä¸”<code>Thread0</code> æ¯”<code>Thread1</code> è¦å…ˆæ‰§è¡Œã€‚</strong></p><p><code>Lock()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†çˆ¶ç±»çš„<code>acquire(1)</code></p><h4 id="acquire"><a href="#acquire" class="headerlink" title="acquire()"></a>acquire()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg) && acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é¦–å…ˆå°è¯•tryAcquire(1)ï¼Œè¿™ä¸ªtryLock()åœ¨AQSä¸­æ²¡æœ‰å…·ä½“å®ç°æ˜¯äº¤ç»™å­ç±»å»å®ç°çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¼šè°ƒç”¨FairSyncçš„ï¼ŒtryAquire(1)</p><h4 id="tryAquire"><a href="#tryAquire" class="headerlink" title="tryAquire()"></a>tryAquire()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>{</span><br><span class="line">    <span class="comment">//è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">    <span class="comment">//è·å–åŒæ­¥çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) { <span class="comment">//0ä»£è¡¨è¿˜æ²¡æœ‰çº¿ç¨‹å ç”¨</span></span><br><span class="line">        <span class="comment">//åˆ¤æ–­æœ‰æ²¡æœ‰å‰é©±èŠ‚ç‚¹ï¼ˆé™¤headèŠ‚ç‚¹å¤–ï¼‰ï¼Œæ²¡æœ‰åˆ™è¿›è¡ŒCASè®¾ç½®åŒæ­¥çŠ¶æ€è·å–é”</span></span><br><span class="line">        <span class="keyword">if</span> (!hasQueuedPredecessors() && compareAndSetState(<span class="number">0</span>, acquires)) { </span><br><span class="line">            <span class="comment">//è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºç‹¬å çº¿ç¨‹</span></span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//åˆ°è¿™é‡Œå°±è¯´æ˜å·²ç»æœ‰çº¿ç¨‹å ç”¨äº†ï¼Œæ‰€ä»¥ä¸‹é¢æ˜¯ä¸ºäº†é‡å…¥</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) {</span><br><span class="line">        <span class="comment">//è¿™é‡Œä¸ç”¨æ‹…å¿ƒå¹¶å‘çš„é—®é¢˜ï¼Œå› ä¸ºæ˜¯ç‹¬å é”ï¼ŒåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šåˆ°è¾¾è¿™é‡Œ</span></span><br><span class="line">        <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">        <span class="keyword">if</span> (nextc < <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">        setState(nextc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="hasQueuedPredecessors"><a href="#hasQueuedPredecessors" class="headerlink" title="hasQueuedPredecessors()"></a>hasQueuedPredecessors()</h4><p>å…¬å¹³é”å’Œéå…¬å¹³é”çš„tryAcquireæ–¹æ³•åŒºåˆ«å°±åœ¨è¿™é‡Œï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰å‰é©±èŠ‚ç‚¹(ä¸åŒ…å«å¤´èŠ‚ç‚¹headï¼Œä¹Ÿå°±æ˜¯)å­˜åœ¨ï¼Œæœ‰çš„è¯ä¸ºäº†ä¿è¯å…¬å¹³æ€§å°±æ˜¯éœ€è¦ç­‰å¾…ï¼Œè¿”å›trueã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">hasQueuedPredecessors</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// The correctness of this depends on head being initialized</span></span><br><span class="line">    <span class="comment">// before tail and on head.next being accurate if the current</span></span><br><span class="line">    <span class="comment">// thread is first in queue.</span></span><br><span class="line">    Node t = tail; <span class="comment">// Read fields in reverse initialization order</span></span><br><span class="line">    Node h = head;</span><br><span class="line">    Node s;</span><br><span class="line">    <span class="comment">// å¤´ä¸ç­‰äºå°¾ï¼Œå¹¶ä¸”é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ‰€æŒæœ‰çº¿ç¨‹éå½“å‰çº¿ç¨‹è¿”å›true</span></span><br><span class="line">    <span class="keyword">return</span> h != t &&</span><br><span class="line">        ((s = h.next) == <span class="keyword">null</span> || s.thread != Thread.currentThread());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ’¡ åˆ°è¿™é‡Œæˆ‘ä»¬åˆ†æä¸‹<code>Thread0</code> å’Œ<code>Thread1</code> çš„æ‰§è¡Œæƒ…å†µ</p><p>ğŸ”¸ é¦–å…ˆ<code>Thread0</code>å…ˆæ‰§è¡Œäº†<code>tryAcquire(1)</code>  æ²¡æœ‰ä»»ä½•é˜»ç¢ï¼Œæ‰§è¡ŒæˆåŠŸç›´æ¥retrurn</p><p>ğŸ”¸ <code>Thread1</code> æ­¤æ—¶æœ‰å¤šç§æƒ…å†µï¼š</p><ul><li><p>è¿˜æ²¡æœ‰è·å–state ï¼Œ<code>Thread0</code>æ‰§è¡Œå®Œåè·å–State==1 ï¼Œç”±äºæ˜¯ç‹¬å é”ç›´æ¥return false ï¼Œè·å–é”å¤±è´¥ã€‚</p></li><li><p>å·²ç»<code>getState()==0</code>äº†ï¼Œæ‰§è¡Œ<code>hasQueuedPredecessors</code> æ–¹æ³•ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶headå’Œtailéƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œéƒ½è¿˜æ˜¯nullï¼ˆå®˜æ–¹çš„æ³¨é‡Šä¸­ä¹Ÿæåˆ°headå’Œtailæ˜¯ lazily initialized ï¼‰æ‰€ä»¥è¿™é‡Œä¼šç›´æ¥ return falseï¼Œç„¶åç»§ç»­æ‰§è¡ŒCASï¼Œç”±äºå‰é¢<code>Thread0</code> å·²ç»å°†stateè®¾ç½®ä¸ºäº† 1 ï¼Œæ‰€ä»¥è¿™é‡ŒCASè‚¯å®šå¤±è´¥äº†ï¼Œæœ€ç»ˆ<code>Thread1</code>çš„tryAcquireå¤±è´¥è¿”å›falseã€‚</p></li></ul><p>ğŸ”¸ æ—¢ç„¶<code>tryAcquire()</code> å¤±è´¥äº†ï¼Œé‚£<code>Thread1</code> å°±ä¼šè½¬å¤´ç»§ç»­æ‰§è¡Œåé¢çš„æ–¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg) && acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é¦–å…ˆæ‰§è¡Œçš„å°±æ˜¯<code>AddWaiter()</code> </p><h4 id="addWaiter"><a href="#addWaiter" class="headerlink" title="addWaiter()"></a>addWaiter()</h4><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å°†Threadå’ŒmodeåŒ…è£…æˆNodeç„¶åæ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨ç„¶åè¿”å›è¿™ä¸ªNode</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>{</span><br><span class="line">    <span class="comment">//å°†å½“å‰çº¿ç¨‹å’Œæ¨¡å¼å°è£…è¿›Node</span></span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">    <span class="comment">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class="line">    Node pred = tail;</span><br><span class="line">    <span class="comment">//å¦‚æœå°¾èŠ‚ç‚¹ä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">//å°†nodeè¿æ¥åœ¨å½“å‰tailåé¢</span></span><br><span class="line">        node.prev = pred;</span><br><span class="line">        <span class="comment">//casè®¾ç½®å½“å‰tailä¸ºnode</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetTail(pred, node)) {</span><br><span class="line">            pred.next = node;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å…¶å®å‰é¢çœ‹ä¼¼ä¼šæœ‰å¹¶å‘çš„é—®é¢˜å…¶å®å¹¶æ²¡æœ‰</span></span><br><span class="line">    <span class="comment">// ä¸Šé¢æŠ¢é”å¤±è´¥çš„çº¿ç¨‹ä¼šç›´æ¥è¿›å…¥enqæ–¹æ³•è‡ªæ—‹é‡æ–°è®¾ç½®ï¼Œç›´åˆ°æˆåŠŸ</span></span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ’¡ æ ¹æ®å‰é¢åˆ†æheadå’Œtailéƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–éƒ½è¿˜æ˜¯nullï¼Œæ‰€ä»¥è¿™é‡Œä¼šç›´æ¥è¿›å…¥ <code>enq()</code>æ–¹æ³•</p><h4 id="enq"><a href="#enq" class="headerlink" title="enq()"></a>enq()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        Node t = tail;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) { <span class="comment">// Must initialize</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">                tail = head;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            node.prev = t;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(t, node)) {</span><br><span class="line">                t.next = node;</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œå› ä¸ºheadå’Œtailéƒ½è¿˜æ˜¯ç©ºçš„æ‰€ä»¥è¿™é‡Œè¿›å…¥ç¬¬ä¸€ä¸ªå¾ªç¯ï¼ŒCASè®¾ç½®ä¸€ä¸ªç©ºçš„Node()ä¸ºå¤´èŠ‚ç‚¹headï¼Œç„¶åå°†tailä¹ŸæŒ‡å‘è¿™ä¸ªheadï¼Œåˆ°è¿™é‡Œheadå’Œtailæ‰ç®—æ˜¯åˆå§‹åŒ–å®Œæˆäº†(lazily initialized )ã€‚</p><p>ğŸ”¸ å¾ªç¯ï¼Œè¿›å…¥elseï¼Œè¿™é‡Œå°±å°†å½“å‰nodeè¿æ¥åˆ°tailåé¢å¹¶ä¸”åˆ©ç”¨CASè‡ªæ—‹è®¾ç½®tailä¸ºå½“å‰nodeä¹Ÿå°±æ˜¯åŒ…å«<code>Thread1</code> çš„nodeï¼Œç„¶åreturn å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹(è¿™é‡Œè¿”å›å€¼å¹¶æ²¡æœ‰ç”¨åˆ°)ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg) && acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸‹ä¸€æ­¥å°±æ˜¯æ‰§è¡Œ<code>acquireQueued()</code></p><p>â“ <strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨æ„é€ å™¨é‡Œé¢å°±åˆå§‹åŒ–å¤´èŠ‚ç‚¹headï¼Ÿè€Œè¦é‡‡ç”¨æ‡’åŠ è½½çš„æ–¹å¼ï¼Ÿ</strong></p><blockquote><p>CLH queues need a dummy header node to get started. Butwe donâ€™t create them on <strong>construction</strong>, because it would be wasted  effort if there is <strong>never contention</strong>. Instead, the nodeis constructed and head and tail pointers are set up <strong>on first contention</strong>.</p></blockquote><p>ä»¥ä¸Šæ‘˜è‡ª<strong>Doug Lea</strong> å¤§å¸ˆçš„æ³¨é‡Šè§£é‡Šï¼Œæ ¹æ®æˆ‘ä»¬çš„ä¸Šé¢çš„åˆ†æï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹<code>Thread0</code> è¿‡æ¥çš„æ—¶å€™å¹¶æ²¡æœ‰å»åˆå§‹åŒ–headï¼Œåé¢çš„çº¿ç¨‹<code>Thread1</code>è¿‡æ¥çš„æ—¶å€™ æœ‰äº†ç«äº‰æ‰åˆå§‹åŒ–äº†è¿™ä¸ªå¤´èŠ‚ç‚¹headï¼Œå¦‚æœç›´æ¥åˆå§‹åŒ–è¿™ä¸ªheadï¼Œç„¶ååˆæ²¡æœ‰é”ç«äº‰ï¼Œè¿™ä¸ªheadèŠ‚ç‚¹å°±è¢«æµªè´¹äº†ã€‚ å¤§å¸ˆå°±æ˜¯å¤§å¸ˆï¼Œå¤ªå¼ºäº† ğŸ˜®</p><h4 id="acquireQueued"><a href="#acquireQueued" class="headerlink" title="acquireQueued()"></a>acquireQueued()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="comment">//è·å–å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="comment">//å¦‚æœå‰ç½®èŠ‚ç‚¹æ˜¯headå°±å°è¯•å»è·å–é”</span></span><br><span class="line">            <span class="keyword">if</span> (p == head && tryAcquire(arg)) {</span><br><span class="line">                <span class="comment">//è®¾ç½®å¤´èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹</span></span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span> interrupted;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) && parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="comment">//å‘ç”Ÿå¼‚å¸¸å–æ¶ˆæŠ¢é”</span></span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ’¡ å› ä¸ºå‰ç½®èŠ‚ç‚¹æ˜¯headï¼Œæ‰€ä»¥è¿™é‡Œä½œä¸ºé˜Ÿåˆ—ç¬¬ä¸€ä¸ªå¯ä»¥å»å°è¯•è·å–é”ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä¸ªæ­»å¾ªç¯ï¼Œä¼šä¸€ç›´å°è¯•è·å–é”ï¼Œå…¶å®ç±»ä¼¼ä¸CASçš„è‡ªæ—‹ï¼Œä½†æ˜¯ç›¸æ¯”CASè‡ªæ—‹åˆæœ‰å¾ˆå¤§ä¸åŒï¼Œå®ƒå¹¶ä¸ä¼šä¸€ç›´è‡ªæ—‹ï¼Œè¯¦ç»†å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><p>ğŸ”¸ å‰é¢ä¼ é€’è¿‡æ¥çš„nodeå‰ç»§èŠ‚ç‚¹æ­£å¥½å°±æ˜¯headï¼Œæ‰€ä»¥æ‰§è¡ŒtryAcquire() ä½†æ˜¯ç”±äº<code>Thread0</code> è¿˜æ²¡æœ‰é‡Šæ”¾é”æ‰€ä»¥è¿™é‡Œä»ç„¶å¤±è´¥ã€‚</p><p>ğŸ”¸ è¿›å…¥ç¬¬äºŒä¸ªif æ‰§è¡Œ <code>shouldParkAfterFailedAcquire(p,node)</code></p><h4 id="shouldParkAfterFailedAcquire"><a href="#shouldParkAfterFailedAcquire" class="headerlink" title="shouldParkAfterFailedAcquire()"></a>shouldParkAfterFailedAcquire()</h4><p>çœ‹åå­—å°±çŸ¥é“æ˜¯å¹²å•¥çš„äº†ï¼Œè·å–å¤±è´¥æ˜¯å¦Parkï¼Ÿ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">shouldParkAfterFailedAcquire</span><span class="params">(Node pred, Node node)</span> </span>{</span><br><span class="line">    <span class="comment">//å‰ç½®èŠ‚ç‚¹çš„çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">int</span> ws = pred.waitStatus;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (ws == Node.SIGNAL)</span><br><span class="line">        <span class="comment">//å‰ç½®èŠ‚ç‚¹çŠ¶æ€ä¸º-1ï¼Œä»£è¡¨å½“å‰èŠ‚ç‚¹çš„åç»­èŠ‚ç‚¹éœ€è¦è¢«æŒ‚èµ·</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * This node has already set status asking a release</span></span><br><span class="line"><span class="comment">         * to signal it, so it can safely park.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (ws > <span class="number">0</span>) {</span><br><span class="line">        <span class="comment">// å‰é©±èŠ‚ç‚¹ waitStatuså¤§äº0ï¼Œè¯´æ˜å‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿã€‚</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œéœ€è¦çŸ¥é“è¿™ç‚¹ï¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—æ’é˜Ÿçš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œè€Œå”¤é†’çš„æ“ä½œæ˜¯ç”±å‰é©±èŠ‚ç‚¹å®Œæˆçš„ã€‚</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥ä¸‹é¢è¿™å—ä»£ç è¯´çš„æ˜¯å°†å½“å‰èŠ‚ç‚¹çš„prevæŒ‡å‘waitStatus<=0çš„èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">        <span class="comment">// ç®€å•è¯´ï¼Œå°±æ˜¯ä¸ºäº†æ‰¾ä¸ªæ­£å¸¸çš„å‰é©±èŠ‚ç‚¹ï¼Œå› ä¸ºä½ è¿˜å¾—ä¾èµ–å®ƒæ¥å”¤é†’å‘¢ï¼Œå¦‚æœå‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿï¼Œå°±æ— æ³•å”¤é†’ä½ äº†</span></span><br><span class="line">        <span class="comment">// åŒæ—¶è¿™ä¸ªæ“ä½œä¹Ÿä¼šå°†é‚£äº› ws>0 çš„èŠ‚ç‚¹ç§»é™¤æ‰</span></span><br><span class="line">        <span class="keyword">do</span> {</span><br><span class="line">            node.prev = pred = pred.prev;</span><br><span class="line">        } <span class="keyword">while</span> (pred.waitStatus > <span class="number">0</span>);</span><br><span class="line">        pred.next = node;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * waitStatus must be 0 or PROPAGATE.  Indicate that we</span></span><br><span class="line"><span class="comment">         * need a signal, but don't park yet.  Caller will need to</span></span><br><span class="line"><span class="comment">         * retry to make sure it cannot acquire before parking.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//è®¾ç½®å‰é©±èŠ‚ç‚¹çŠ¶æ€ä¸º -1</span></span><br><span class="line">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ³¨æ„è¿™ä¸ªé‡Œé¢å›å‰”é™¤ä¸æ­£å¸¸çš„èŠ‚ç‚¹ï¼Œä¸ºä¸‹é¢çš„å”¤é†’æ“ä½œè€ƒè™‘</p><p>ğŸ’¡ åˆ†æ<code>Thread1</code>ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å½“å‰é˜Ÿåˆ—çš„çŠ¶æ€</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190809/jOs2WA3R7lGR.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ğŸ”¸ å› ä¸ºå‰é¢çš„æ“ä½œå¹¶æ²¡æœ‰å¯¹stateè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œä¼šç›´æ¥è¿›å…¥æœ€åçš„elseï¼Œè®¾ç½®å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ä¸º <code>SIGNAL</code></p><p>ç„¶årenturn  falseå›åˆ°acquireQueuedçš„å†…å¾ªç¯</p><p>ğŸ”¸ å†æ¬¡å°è¯•è·å–é”ï¼Œ<code>Thread0</code> ä»ç„¶æ²¡æœ‰é‡Šæ”¾é”ï¼Œå¤±è´¥ï¼Œå†æ¬¡è¿›å…¥shouldParkAfterFailedAcquireï¼Œè¿™ä¸€æ¬¡ç”±äºå·²ç»å°†å‰ç»§èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®ä¸º<code>SIGNAL</code> æ‰€ä»¥ç›´æ¥return trueï¼Œè¿›å…¥åé¢çš„ <code>parkAndCheckInterrupt()</code> æ–¹æ³•</p><p><strong>æ­¤æ—¶çŠ¶æ€å˜ä¸º</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190809/pQ5NOkN5mQTY.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h4 id="parkAndCheckInterrupt"><a href="#parkAndCheckInterrupt" class="headerlink" title="parkAndCheckInterrupt()"></a>parkAndCheckInterrupt()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>{</span><br><span class="line">    LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åˆ°è¿™é‡Œæˆ‘ä»¬çš„çº¿ç¨‹<code>Thread1</code>å°±ä¼šè¢«é˜»å¡ä½ï¼Œä¹Ÿä¸ä¼šç»§ç»­è‡ªæ—‹è·å–é”äº†ã€‚</p><blockquote><p>LockSupport.park()å®é™…ä¸Šè°ƒç”¨çš„æ˜¯Unsafeæä¾›çš„æŒ‡ä»¤å±äº<code>çº¿ç¨‹é˜»å¡åŸè¯­</code>ï¼Œå¯ä»¥ç†è§£ä¸ºäºŒå…ƒä¿¡å·é‡ï¼ˆåªæœ‰ä¸€ä¸ªpermitï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šå“åº”Interrupt  <a href="https://segmentfault.com/a/1190000008420938" target="_blank" rel="noopener">å‚è€ƒ</a></p></blockquote><p>ğŸ”” <strong>å‡è®¾æ­¤æ—¶åˆæœ‰ä¸€ä¸ªçº¿ç¨‹<code>Thread2</code>è¿‡æ¥äº†ï¼Œå¹¶ä¸”<code>Thread0</code> ä¾ç„¶æ²¡æœ‰é‡Šæ”¾é”</strong></p><p>ğŸ”¸ tryAcquireå¤±è´¥</p><p>ğŸ”¸addWaiter()ï¼Œ å°†<code>Thread2</code>å’Œæ¨¡å¼åŒ…è£…æˆNodeæ·»åŠ åˆ°é˜Ÿå°¾ï¼ˆè¿™ä¸ªæ—¶å€™å°±ä¸ä¼šè¿›å…¥enqäº†ï¼Œå› ä¸ºtailæ­¤æ—¶ä¸º<code>Thread1</code>å·²ç»ä¸ä¸ºç©ºäº†ï¼‰ç„¶åè¿”å›åŒ…å«<code>Thread2</code>çš„èŠ‚ç‚¹ï¼Œé˜Ÿåˆ—çŠ¶æ€å˜ä¸ºï¼š</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190809/yniIvx1sgpXa.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ğŸ”¸acquireQueued()ï¼Œæ ¹æ®ä¸Šé¢çš„çŠ¶æ€å›¾ï¼Œè¿™é‡Œå‰ç½®èŠ‚ç‚¹å¹¶ä¸æ˜¯headï¼Œç›´æ¥è¿›å…¥shouldParkAfterFailedAcquire()</p><p>ğŸ”¸shouldParkAfterFailedAcquire()ï¼Œæ˜æ˜¾å‰é©±èŠ‚ç‚¹çŠ¶æ€å¹¶ä¸æ˜¯<code>SIGNAL</code> è€Œæ˜¯0ï¼Œæ‰€ä»¥ç›´æ¥åˆ©ç”¨CASè®¾ç½®å‰é©±èŠ‚ç‚¹ä¸º<code>SIGNAL</code>  çŠ¶æ€å˜ä¸ºï¼š</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190809/R7GmOQ4V8ESm.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å›åˆ° <code>acquireQueued()</code> ç»§ç»­è‡ªæ—‹</p><p>ğŸ”¸ å‰ç½®èŠ‚ç‚¹ä¸æ˜¯headï¼Œè°ƒç”¨shouldParkAfterFailedAcquire(NodeT1ï¼Œmode)ï¼ŒæˆåŠŸï¼Œè°ƒç”¨parkAndCheckInterrupté˜»å¡ï¼Œè‡³æ­¤ï¼Œ<code>Thread1</code>ï¼Œ<code>Thread2</code> éƒ½åœ¨è¿™é‡Œparkä½äº†ã€‚</p><h3 id="unLock"><a href="#unLock" class="headerlink" title="unLock()"></a>unLock()</h3><p>ğŸ”” ç»§ç»­ä¸Šé¢çš„æ¨¡æ‹Ÿï¼Œæ­¤æ—¶<code>Thread0</code>é‡Šæ”¾é” ï¼Œè°ƒç”¨<code>unlock()</code> æ–¹æ³•ï¼Œunlock()ä¼šè°ƒç”¨AQSä¸­çš„<code>release(1)</code>æ–¹æ³•</p><h4 id="release"><a href="#release" class="headerlink" title="release()"></a>release()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) {</span><br><span class="line">        <span class="comment">//è·å–å¤´èŠ‚ç‚¹</span></span><br><span class="line">        Node h = head;</span><br><span class="line">        <span class="comment">//å¤´èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å¤´èŠ‚ç‚¹çš„waitStatusä¸æ˜¯0</span></span><br><span class="line">        <span class="keyword">if</span> (h != <span class="keyword">null</span> && h.waitStatus != <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//unparkåç»§èŠ‚ç‚¹</span></span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é¦–å…ˆæ‰§è¡Œ<code>tryRelease(1)</code> ï¼Œå’Œ<code>tryAcquire()</code> ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•æœ€åæ˜¯äº¤ç»™å­ç±»å»å®ç°çš„</p><h4 id="tryRelease"><a href="#tryRelease" class="headerlink" title="tryRelease()"></a>tryRelease()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>{</span><br><span class="line">    <span class="comment">//åŒæ­¥çŠ¶æ€å‡1</span></span><br><span class="line">    <span class="keyword">int</span> c = getState() - releases;</span><br><span class="line">    <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">        <span class="comment">//è§£é”çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œè§£é“ƒè¿˜é¡»ç³»é“ƒäºº</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">    <span class="comment">//å’Œä¸Šé¢ä¸€æ ·è¿™é‡Œä¸ç”¨æ‹…å¿ƒå¹¶å‘çš„é—®é¢˜ï¼Œå› ä¸ºæ˜¯ç‹¬å é”ï¼ŒåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šåˆ°è¾¾è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">boolean</span> free = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//ä¸ä¸º0åˆ™ä»£è¡¨è¢«é‡å…¥äº†ï¼Œéœ€è¦å¤šæ¬¡releaseç›´åˆ°0æ‰ä¼šé‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">        free = <span class="keyword">true</span>;</span><br><span class="line">        setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line">    setState(c);</span><br><span class="line">    <span class="keyword">return</span> free;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>tryRelease()æˆåŠŸç»§ç»­æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œçœ‹ä¸€ä¸‹å½“å‰AQSé˜Ÿåˆ—çš„çŠ¶æ€</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190809/R7GmOQ4V8ESm.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ğŸ”¸ å¤´èŠ‚ç‚¹head ! =null å¹¶ä¸”head.waitStateä¸æ˜¯0ï¼Œæ‰§è¡ŒunparkSuccessor().</p><h4 id="unparkSuccessor"><a href="#unparkSuccessor" class="headerlink" title="unparkSuccessor()"></a>unparkSuccessor()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unparkSuccessor</span><span class="params">(Node node)</span> </span>{</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * If status is negative (i.e., possibly needing signal) try</span></span><br><span class="line"><span class="comment">     * to clear in anticipation of signalling.  It is OK if this</span></span><br><span class="line"><span class="comment">     * fails or if status is changed by waiting thread.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> ws = node.waitStatus;</span><br><span class="line">    <span class="keyword">if</span> (ws < <span class="number">0</span>)</span><br><span class="line">        <span class="comment">//å¦‚æœå½“å‰èŠ‚ç‚¹çš„wså°äº0å°±è®¾ç½®ä¸º0ï¼Œå…è®¸å¤±è´¥</span></span><br><span class="line">        <span class="comment">//å…¶å®æ˜¯ç‹¬å é”çš„è¯è¿™é‡Œè‚¯å®šä¸ä¼šå¤±è´¥ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="comment">//releaseæ‰§è¡Œå®Œä¹‹åï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¢«ç§»é™¤æ‰ã€‚ç„¶åè¢«GC</span></span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Thread to unpark is held in successor, which is normally</span></span><br><span class="line"><span class="comment">     * just the next node.  But if cancelled or apparently null,</span></span><br><span class="line"><span class="comment">     * traverse backwards from tail to find the actual</span></span><br><span class="line"><span class="comment">     * non-cancelled successor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//è·å–åç»§èŠ‚ç‚¹</span></span><br><span class="line">    Node s = node.next;</span><br><span class="line">    <span class="comment">//åç»§èŠ‚ç‚¹ä¸ºç©ºï¼Œæˆ–è€…å·²ç»æ’¤é”€äº†ï¼Œå–æ¶ˆæŠ¢é”ï¼ˆ1>0ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.waitStatus > <span class="number">0</span>) {</span><br><span class="line">        s = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//ä»åå¾€å‰éå†æ‰¾åˆ°æ­£æ•°ç¬¬ä¸€ä¸ªwaitStatus<0çš„</span></span><br><span class="line">        <span class="keyword">for</span> (Node t = tail; t != <span class="keyword">null</span> && t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus <= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">//ç„¶åé‡Šæ”¾å®ƒ</span></span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ <code>Thread1</code> è¢«<code>unpark()</code> ç»§ç»­æ‰§è¡Œã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>{</span><br><span class="line">    LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿”å›<code>Thread1</code>çš„ ä¸­æ–­æ ‡å¿—ä½ï¼Œå¹¶å¤åŸä¸ºfalseï¼Œç»“æŸ<code>parkAndCheckInterrupt()</code>æ–¹æ³•ï¼Œå†æ¬¡å›åˆ°<code>acquireQueued()</code> çš„å¾ªç¯ä¸­æ‰§è¡Œç¬¬ä¸€ä¸ªif</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (;;) {</span><br><span class="line">    <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">    <span class="keyword">if</span> (p == head && tryAcquire(arg)) {</span><br><span class="line">        setHead(node);</span><br><span class="line">        p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">        failed = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> interrupted; <span class="comment">//è¿”å›ä¸­æ–­çŠ¶æ€</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) && parkAndCheckInterrupt())</span><br><span class="line">        interrupted = <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ ç”±äº<code>Thread0</code> å·²ç»é‡Šæ”¾é”ï¼ŒåŒæ­¥çŠ¶æ€å·²ç»å˜ä¸º0ï¼Œ<code>Thread1</code> å¯ä»¥ç›´æ¥<code>tryAcquire</code>è·å–åˆ°é”ï¼Œç„¶åè®¾ç½®å¤´èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹ï¼Œå°†ä¹‹å‰çš„headèŠ‚ç‚¹<strong>ç§»é™¤</strong>ï¼Œè¿”å›ä¸­æ–­çŠ¶æ€ï¼Œç”±äºä¹‹å‰parkæœŸé—´æ²¡æœ‰è¢«ä¸­æ–­ç›´æ¥<code>return false</code>ï¼ŒacquireæˆåŠŸï¼ï¼ï¼ <code>Thread1</code> è·å¾—é”ï¼ï¼ï¼</p><p>â“ <strong>ä¸ºä»€ä¹ˆè¦ä»åå¾€å‰éå†ï¼Ÿ</strong></p><blockquote><p>è¿™é‡Œçœ‹äº†ä¸€äº›åšå®¢ä»‹ç»ï¼Œå¤§æ¦‚æœ‰ä¸¤ä¸ªè¯´æ³•ï¼Œä¸€ä¸ªæ˜¯åœ¨<code>enq()</code> æ–¹æ³•é‡Œé¢ï¼Œå…ˆè®¾ç½®çš„<code>node.prev = pred;</code>å†æ‰§è¡Œçš„CASæœ€åæ‰§è¡Œçš„<code>t.next = node;</code> CASæˆåŠŸånextä¹Ÿè®¸è¿˜æ²¡æœ‰è®¾ç½®æˆåŠŸï¼Œä»å‰å¾€åéå†æœ‰å¯èƒ½æ‰¾ä¸åˆ°è¿™ä¸ªåˆšåŠ å…¥çš„èŠ‚ç‚¹ï¼›å…¶æ¬¡ï¼Œåœ¨<code>cancelAcquire(node);</code> çš„æœ€åä¸€æ­¥æœ‰ä¸€ä¸ª<code>node.next=node</code>çš„æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ä»å‰å¾€åéå†ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚</p></blockquote><p>â“ <strong>ä»åå¾€å‰éå†æ‰¾åˆ°æœ€å‰é¢ç¬¬ä¸€ä¸ªwaitStatus<0çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ“ä½œå¦‚æœè¿”å›çš„æ˜¯ä¸ªä¸­é—´èŠ‚ç‚¹æ€ä¹ˆåŠï¼Ÿ</strong></p><blockquote><p>ä¸è¦æ€•ï¼Œæˆ‘ä»¬ç»§ç»­æ‰§è¡Œï¼Œé¦–å…ˆå®ƒæ˜¯ä¸ªä¸­é—´èŠ‚ç‚¹è€Œä¸”æ˜¯å…¬å¹³é”ï¼Œå®ƒæœ‰å‰é©±èŠ‚ç‚¹ï¼Œunparkåè‚¯å®šè·å–ä¸åˆ°é”(å…¬å¹³é”éœ€è¦æ£€æµ‹æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹)ï¼Œç„¶åæ‰§è¡Œ<code>shouldParkAfterFailedAcquire()</code>ï¼Œè¿˜è®°å¾—è¿™ä¸ªæ–¹æ³•é‡Œé¢çš„ä¸€ä¸ªæ“ä½œä¹ˆï¼Ÿï¼Ÿå¦‚æœå‰é©±èŠ‚ç‚¹çŠ¶æ€>0ï¼Œä»–å°±ä¼šæ¸…é™¤è¿™äº›ä¸æ­£å¸¸çš„èŠ‚ç‚¹ï¼Œè¿”å›falseï¼Œä¸parkè‡ªæ—‹ï¼Œä¸‹ä¸€æ¬¡å¾ªç¯è¿™ä¸ªèŠ‚ç‚¹åœ¨è·å–é”å°±å¯ä»¥è·å–åˆ°äº†ï¼Œå¦™å“‰ï¼ï¼ï¼</p></blockquote><p>æ³¨æ„<strong>setHead</strong>æ˜¯è¿™æ ·çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setHead</span><span class="params">(Node node)</span> </span>{</span><br><span class="line">    head = node;</span><br><span class="line">    node.thread = <span class="keyword">null</span>; <span class="comment">//è®¾ç½®çº¿ç¨‹ä¸ºnull</span></span><br><span class="line">    node.prev = <span class="keyword">null</span>; <span class="comment">//è®¾ç½®å‰é©±ä¸ºç©º</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ­¤æ—¶é˜Ÿåˆ—çŠ¶æ€å˜ä¸ºï¼š</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190809/wFDlbQTu417I.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å†å¾€åå°±æ˜¯é‡å¤å‰é¢çš„è¿‡ç¨‹å•¦ã€‚</p><h3 id="éå…¬å¹³é”å…¬å¹³é”åŒºåˆ«"><a href="#éå…¬å¹³é”å…¬å¹³é”åŒºåˆ«" class="headerlink" title="éå…¬å¹³é”å…¬å¹³é”åŒºåˆ«"></a>éå…¬å¹³é”å…¬å¹³é”åŒºåˆ«</h3><p>ä¸Šé¢æ˜¯ä»‹ç»çš„å…¬å¹³é”ï¼Œæ‰€è°“çš„å…¬å¹³å°±æ˜¯å…ˆæ¥ååˆ°FIFOã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹éå…¬å¹³é”çš„lockå’ŒnonfairTryAcquire()çš„å®ç°ï¼Œè¿™ä¸¤ä¸ªé”çš„åŒºåˆ«å…¶å®å°±æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h4 id="lock"><a href="#lock" class="headerlink" title="lock()"></a>lock()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">        setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        acquire(<span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°éå…¬å¹³é”<code>lock()</code>çš„æ—¶å€™ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€å…ˆCASè¯•ä¸€ä¸‹èƒ½ä¸èƒ½è·å–åˆ°é”ï¼Œè·å–åˆ°å°±ç›´æ¥è¿”å›</p><h4 id="nonfairTryAcquire"><a href="#nonfairTryAcquire" class="headerlink" title="nonfairTryAcquire()"></a>nonfairTryAcquire()</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) {</span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) {</span><br><span class="line">        <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">        <span class="keyword">if</span> (nextc < <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">        setState(nextc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯¹æ¯”å…¬å¹³é”çš„å®ç°ï¼Œä¼šå‘ç°å°‘äº†<code>hasQueuedPredecessors()</code> è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœå‰é¢<code>lock()</code> çš„æ—¶å€™æ²¡æœ‰CASæˆåŠŸï¼Œåˆ°è¿™é‡Œåå¦‚æœä¹‹å‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œå®ƒåˆä¼šå†æ¬¡å°è¯•CASè·å–é”ï¼Œè¿™é‡Œå…¶å®å°±ä½“ç°äº†éå…¬å¹³é”çš„ç‰¹ç‚¹ï¼Œ<strong>å…ˆç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¸€å®šèƒ½å…ˆè·å–åˆ°é”ï¼Œä¸­é—´å…è®¸æœ‰äºº<code>"æ’é˜Ÿ"</code></strong>ï¼Œå¦‚æœè¿™ä¸€æ¬¡è¿˜æ˜¯å¤±è´¥äº†ï¼Œå°±ä¼šå’Œå…¬å¹³é”ä¸€æ ·è€è€å®å®å»ç­‰å¾…é˜Ÿåˆ—ä¸­æ’é˜Ÿ</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œéå…¬å¹³é”çš„æ€§èƒ½ä¼šæ¯”å…¬å¹³é”å¥½ï¼Œè€Œéå…¬å¹³é”å¯èƒ½ä¼šå¯¼è‡´æ’åœ¨åé¢çš„çº¿ç¨‹é¥¥é¥¿</p><h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190810/6FEWGydOmVzm.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><strong>ã€ŠJavaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€‹</strong></p><p><a href="https://javadoop.com/2017/06/16/AbstractQueuedSynchronizer/" target="_blank" rel="noopener">ä¸€è¡Œä¸€è¡Œæºç åˆ†ææ¸…æ¥šAbstractQueuedSynchronizer</a></p><p><a href="https://blog.csdn.net/pfnie/article/details/53191892" target="_blank" rel="noopener">AbstractQueuedSynchronizeræºç å‰–æï¼ˆå…­ï¼‰- æ·±åˆ»è§£æä¸æ¨¡æ‹Ÿçº¿ç¨‹ç«äº‰èµ„æº</a></p><p><a href="https://segmentfault.com/a/1190000008420938" target="_blank" rel="noopener">[æµ…è°ˆJavaå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆå…«ï¼‰â€”â€” LockSupportåŸç†å‰–æ]</a></p><p><a href="https://brightloong.github.io/2018/06/21/Java%E5%90%8C%E6%AD%A5%E5%99%A8%E2%80%94%E2%80%94AQS%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">JavaåŒæ­¥å™¨â€”â€”AQSå­¦ä¹ </a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæŸ¥æ‰¾</title>
      <link href="/2019/09/15/leetcode-cha-zhao/"/>
      <url>/2019/09/15/leetcode-cha-zhao/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†"><a href="#349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†" class="headerlink" title="349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†"></a><a href="https://leetcode-cn.com/problems/intersection-of-two-arrays/" target="_blank" rel="noopener">349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†</a></h2><p>ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>], nums2 = [<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums1 = [<span class="number">4</span>,<span class="number">9</span>,<span class="number">5</span>], nums2 = [<span class="number">9</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">9</span>,<span class="number">4</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>è¾“å‡ºç»“æœä¸­çš„æ¯ä¸ªå…ƒç´ ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚</li><li>æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] intersection(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) {</span><br><span class="line">    Set<integer> s1=<span class="keyword">new</span> HashSet<>();</integer></span><br><span class="line">    ArrayList<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> a:nums1 ) {</span><br><span class="line">        s1.add(a);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums2.length;i++) {< span><br><span class="line">        <span class="keyword">if</span>(s1.contains(nums2[i])){</span><br><span class="line">            res.add(nums2[i]);</span><br><span class="line">            s1.remove(nums2[i]);<span class="comment">//åˆ«å¿˜äº†removeæ‰</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> [] res2=<span class="keyword">new</span> <span class="keyword">int</span>[res.size()];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<res.size();i++) {< span><br><span class="line">        res2[i]=res.get(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res2;</span><br><span class="line">}</span><br></res.size();i++)></span></nums2.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ²¡å•¥å¥½è¯´çš„ï¼Œè¿™ç§é¢˜ç¡®å®ä¸éš¾ï¼Œä»”ç»†æƒ³æƒ³å°±å¯ä»¥</p><h2 id="350-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†-II"><a href="#350-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†-II" class="headerlink" title="350. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›† II"></a><a href="https://leetcode-cn.com/problems/intersection-of-two-arrays-ii/" target="_blank" rel="noopener">350. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›† II</a></h2><p>ç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>], nums2 = [<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">2</span>,<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums1 = [<span class="number">4</span>,<span class="number">9</span>,<span class="number">5</span>], nums2 = [<span class="number">9</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">4</span>,<span class="number">9</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>è¾“å‡ºç»“æœä¸­æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œåº”ä¸å…ƒç´ åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°ä¸€è‡´ã€‚</li><li>æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚</li></ul><p><strong>è¿›é˜¶:</strong></p><ul><li>å¦‚æœç»™å®šçš„æ•°ç»„å·²ç»æ’å¥½åºå‘¢ï¼Ÿä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ</li><li>å¦‚æœ nums1 çš„å¤§å°æ¯” nums2 å°å¾ˆå¤šï¼Œå“ªç§æ–¹æ³•æ›´ä¼˜ï¼Ÿ</li><li>å¦‚æœ nums2 çš„å…ƒç´ å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç£ç›˜å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä¸€æ¬¡åŠ è½½æ‰€æœ‰çš„å…ƒç´ åˆ°å†…å­˜ä¸­ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿ</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å’Œä¸Šé¢çš„åŒºåˆ«å°±æ˜¯éœ€è¦è¾“å‡ºæ‰€æœ‰çš„äº¤é›†ï¼Œé‡å¤çš„ä¹Ÿç®—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨mapçš„ç»“æ„è®°å½•å­—ç¬¦å‡ºç°çš„æ¬¡æ•°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] intersect(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span>[] nums2) {</span><br><span class="line">    HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums1.length;i++) {< span><br><span class="line">        map.put(nums1[i],map.getOrDefault(nums1[i],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    ArrayList<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums2.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(nums2[i])) {</span><br><span class="line">            <span class="keyword">if</span> (map.get(nums2[i])!=<span class="number">0</span>) {</span><br><span class="line">                <span class="comment">//æœ‰äº¤é›†</span></span><br><span class="line">                res.add(nums2[i]); <span class="comment">//æ·»åŠ åˆ°ç»“æœä¸­</span></span><br><span class="line">                map.put(nums2[i],map.get(nums2[i])-<span class="number">1</span>); <span class="comment">//mapæ˜ å°„å‡ä¸€</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> []res2=<span class="keyword">new</span> <span class="keyword">int</span>[res.size()];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<res2.length;i++) {< span><br><span class="line">        res2[i]=res.get(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res2;</span><br><span class="line">}</span><br></res2.length;i++)></span></nums2.length;i++)></span></nums1.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ€è·¯ä¹Ÿå¾ˆç›´ç™½ï¼Œå’Œä¸Šä¸€é¢˜çš„åšæ³•ç±»ä¼¼</p><p><strong>è¿›é˜¶</strong></p><p><strong>Q1:</strong> æ’å¥½åºçš„è¯å°±å¯ä»¥ç›´æ¥åˆ©ç”¨åŒæŒ‡é’ˆï¼Œä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªæ•°ç»„çš„å¤´ï¼Œç›¸ç­‰å°±åŠ å…¥listï¼Œä¸ç›¸ç­‰å°±ç§»åŠ¨å°çš„å“ªä¸€ä¸ªï¼Œç›´åˆ°æœ‰ä¸€ä¸ªæŒ‡é’ˆèµ°åˆ°æœ«å°¾</p><p><strong>Q2:</strong> è¿™ä¸ªå°±å¾ˆæ˜æ˜¾äº†ï¼Œè‚¯å®šå…ˆæŠŠå°çš„å“ªä¸€ä¸ªç”¨mapæ˜ å°„èµ·æ¥ï¼Œè¿™æ ·mapæŸ¥æ‰¾çš„æ•ˆç‡ä¼šæ›´é«˜ ï¼Ÿ</p><p><strong>Q3:</strong> è¿™ä¸ªå‚è€ƒè‹±æ–‡ç‰ˆçš„ <a href="https://leetcode.com/problems/intersection-of-two-arrays-ii/discuss/82243/Solution-to-3rd-follow-up-question" target="_blank" rel="noopener">è®¨è®ºåŒº</a> </p><h2 id="242-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"><a href="#242-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯" class="headerlink" title="242. æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"></a><a href="https://leetcode-cn.com/problems/valid-anagram/" target="_blank" rel="noopener">242. æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯</a></h2><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"anagram"</span>, t = <span class="string">"nagaram"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"rat"</span>, t = <span class="string">"car"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>ä½ å¯ä»¥å‡è®¾å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ã€‚</li></ul><p><strong>è¿›é˜¶:</strong></p><ul><li>å¦‚æœè¾“å…¥å­—ç¬¦ä¸²åŒ…å« unicode å­—ç¬¦æ€ä¹ˆåŠï¼Ÿä½ èƒ½å¦è°ƒæ•´ä½ çš„è§£æ³•æ¥åº”å¯¹è¿™ç§æƒ…å†µï¼Ÿ</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAnagram</span><span class="params">(String s, String t)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s.length()!=t.length())<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        freq[s.charAt(i)]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>,match=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> a:freq) {</span><br><span class="line">        <span class="keyword">if</span>(a!=<span class="number">0</span>){</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<t.length();i++) {< span><br><span class="line">        <span class="keyword">if</span>(freq[t.charAt(i)]><span class="number">0</span>){</span><br><span class="line">            freq[t.charAt(i)]--;</span><br><span class="line">            <span class="keyword">if</span>(freq[t.charAt(i)]==<span class="number">0</span>){</span><br><span class="line">                match++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> match==count;</span><br><span class="line">}</span><br></t.length();i++)></span></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œå…¶å®ç©ºé—´è¿˜å¯ä»¥ä¼˜åŒ–ï¼Œé¢˜ç›®è¯´äº†å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—ç¬¦æ‰€ä»¥åªéœ€è¦26ä¸ªintå°±è¡Œäº†ï¼Œå¯ä»¥åœ¨freqæ“ä½œçš„æ—¶å€™ <code>-'A'</code> ä¼˜åŒ–ç©ºé—´</p><p><strong>è¿›é˜¶</strong></p><p>å­—ç¬¦åŒ…å«<code>unicode</code> çš„è¯å¦‚æœå†ä½¿ç”¨intæ•°ç»„å°±ä¸åˆé€‚äº†ï¼Œè¿™ä¸ªèŒƒå›´ä¼šå˜å¾—å¾ˆå¤§ï¼Œæ›´åŠ é€šç”¨çš„æ–¹å¼æ˜¯é‡‡ç”¨<code>HashMap</code></p><h2 id="202-å¿«ä¹æ•°"><a href="#202-å¿«ä¹æ•°" class="headerlink" title="202. å¿«ä¹æ•°"></a><a href="https://leetcode-cn.com/problems/happy-number/" target="_blank" rel="noopener">202. å¿«ä¹æ•°</a></h2><p>ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯â€œå¿«ä¹æ•°â€ã€‚</p><p>ä¸€ä¸ªâ€œå¿«ä¹æ•°â€å®šä¹‰ä¸ºï¼šå¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œï¼Œç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯æ— é™å¾ªç¯ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚å¦‚æœå¯ä»¥å˜ä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚</p><p><strong>ç¤ºä¾‹:</strong> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">19</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br><span class="line">è§£é‡Š: </span><br><span class="line"><span class="number">12</span> + <span class="number">92</span> = <span class="number">82</span></span><br><span class="line"><span class="number">82</span> + <span class="number">22</span> = <span class="number">68</span></span><br><span class="line"><span class="number">62</span> + <span class="number">82</span> = <span class="number">100</span></span><br><span class="line"><span class="number">12</span> + <span class="number">02</span> + <span class="number">02</span> = <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isHappy</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">char</span>[] nums=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> sum=n;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>) {</span><br><span class="line">        nums=String.valueOf(sum).toCharArray();</span><br><span class="line">        sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">            sum+=(nums[i]-<span class="number">48</span>)*(nums[i]-<span class="number">48</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (sum==<span class="number">4</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (sum==<span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ‰¾åˆ°äº†è§„å¾‹ï¼Œæ‰€æœ‰ä¸å¿«ä¹çš„æ•°(ğŸ˜…ï¼Œéƒ½ä¼šè¿›å…¥4 â†’ 16 â†’ 37 â†’ 58 â†’ 89 â†’ 145 â†’ 42 â†’ 20 â†’ 4 çš„å¾ªç¯ï¼Œå¯ä»¥ç›´æ¥åœ¨sumå’Œè¿™äº›å€¼ç›¸ç­‰çš„æ—¶å€™å°±returnæˆ‘æ‡’å¾—å†™é‚£ä¹ˆå¤šï¼Œæ¯”è¾ƒå–å·§ä½†æ˜¯æ•ˆç‡è¿˜æ˜¯æŒºé«˜çš„</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isHappy</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">char</span>[] nums=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> sum=n;</span><br><span class="line">    HashSet<integer> set=<span class="keyword">new</span> HashSet<>();</integer></span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>) {</span><br><span class="line">        nums=String.valueOf(sum).toCharArray();</span><br><span class="line">        sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">            sum+=(nums[i]-<span class="number">48</span>)*(nums[i]-<span class="number">48</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (sum==<span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (set.contain(sum)){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            set.add(sum);    </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™ç§åšæ³•å°±æ¯”è¾ƒå¸¸è§„ï¼Œä¹Ÿæ˜¯ç¬¦åˆè¿™ç¯‡ä¸»é¢˜<strong>æŸ¥æ‰¾</strong>çš„è§£æ³•ï¼Œä»£ç æ¯”è¾ƒç®€å•å°±ä¸å•°å—¦äº†</p><h2 id="290-å•è¯è§„å¾‹"><a href="#290-å•è¯è§„å¾‹" class="headerlink" title="290. å•è¯è§„å¾‹"></a><a href="https://leetcode-cn.com/problems/word-pattern/" target="_blank" rel="noopener">290. å•è¯è§„å¾‹</a></h2><p>ç»™å®šä¸€ç§è§„å¾‹ pattern å’Œä¸€ä¸ªå­—ç¬¦ä¸² str ï¼Œåˆ¤æ–­ str æ˜¯å¦éµå¾ªç›¸åŒçš„è§„å¾‹ã€‚</p><p>è¿™é‡Œçš„ <strong>éµå¾ª</strong> æŒ‡å®Œå…¨åŒ¹é…ï¼Œä¾‹å¦‚ï¼Œ pattern é‡Œçš„æ¯ä¸ªå­—æ¯å’Œå­—ç¬¦ä¸² str ä¸­çš„æ¯ä¸ªéç©ºå•è¯ä¹‹é—´å­˜åœ¨ç€åŒå‘è¿æ¥çš„å¯¹åº”è§„å¾‹ã€‚</p><p><strong>ç¤ºä¾‹1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: pattern = <span class="string">"abba"</span>, str = <span class="string">"dog cat cat dog"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:pattern = <span class="string">"abba"</span>, str = <span class="string">"dog cat cat fish"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: pattern = <span class="string">"aaaa"</span>, str = <span class="string">"dog cat cat dog"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: pattern = <span class="string">"abba"</span>, str = <span class="string">"dog dog dog dog"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong><br>ä½ å¯ä»¥å‡è®¾ <code>pattern</code> åªåŒ…å«å°å†™å­—æ¯ï¼Œ <code>str</code> åŒ…å«äº†ç”±å•ä¸ªç©ºæ ¼åˆ†éš”çš„å°å†™å­—æ¯</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">wordPattern</span><span class="params">(String pattern, String str)</span> </span>{</span><br><span class="line">    HashMap<character,string> map=<span class="keyword">new</span> LinkedHashMap<>();</character,string></span><br><span class="line">    String[] strs=str.split(<span class="string">" "</span>);</span><br><span class="line">    <span class="keyword">char</span>[] p=pattern.toCharArray();</span><br><span class="line">    <span class="keyword">if</span> (strs.length!=p.length) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<p.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(p[i])) {</span><br><span class="line">            <span class="keyword">if</span> (!map.get(p[i]).equals(strs[i])) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//è¿™é‡Œç›´æ¥å’Œå‰ä¸€ä¸ªæ¯”è¾ƒçš„ï¼Œæ­£ç¡®åšæ³•æ˜¯ç”¨map.containsValueåˆ¤æ–­æ˜¯å¦å·²ç»æ·»åŠ </span></span><br><span class="line">            <span class="comment">/*if (strs[i].equals(strs[i-1])) {</span></span><br><span class="line"><span class="comment">                return false;</span></span><br><span class="line"><span class="comment">            }*/</span></span><br><span class="line">            <span class="keyword">if</span> (map.containsValue(strs[i])) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;           </span><br><span class="line">            }</span><br><span class="line">            map.put(p[i],strs[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></p.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å¾ˆç®€å•çš„é¢˜ï¼Œéœ€è¦å¯¹ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå€ŸåŠ©Hashè¡¨ç›´æ¥å°†ä¸¤ä¸ªStringè¿›è¡Œä¸€å¯¹ä¸€çš„æ˜ å°„ï¼Œæ—¢ç„¶è¦åŒ¹é…é‚£ä¹ˆ<code>åŒä¸€ä¸ªkeyå­—ç¬¦å¯¹åº”çš„valueå­—ç¬¦è‚¯å®šæ˜¯ä¸€æ ·çš„</code>ï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯åœ¨é‡åˆ°ä¸€ä¸ªæ–°çš„keyå­—ç¬¦çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­å¯¹åº”ä½ç½®çš„valueå­—ç¬¦å‡ºç°è¿‡æ²¡æœ‰ï¼Œå‡ºç°è¿‡å°±ç›´æ¥return falseï¼Œè¿™ä¸€ç‚¹ç¬¬ä¸€éçš„æ—¶å€™æ²¡è€ƒè™‘åˆ°ï¼Œ<code>ä¸åŒçš„keyå­—ç¬¦å¯¹åº”çš„valueå­—ç¬¦è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„</code></p><blockquote><p>å› ä¸ºç¬¬ä¸€æ¬¡æ²¡è€ƒè™‘åˆ°ç¬¬äºŒç§æƒ…å†µï¼Œæäº¤åç«Ÿç„¶è·‘è¿‡äº†<code>31/33</code> ä¸ªcaseï¼Œç„¶åå°±æ„Ÿè§‰è¿™é¢˜caseå¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œç„¶åè‡ªå·±å†™äº†ä¸ªé”™çš„ç®—æ³•å±…ç„¶ä¹Ÿè·‘è¿‡äº†ï¼Œå…·ä½“çš„ä»£ç åœ¨ä¸Šé¢çš„æ³¨é‡Šä¸­ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»è¯•è¯•ï¼Œæˆ‘å·²ç»æäº¤caseäº†ä½†æ˜¯è¿˜æ²¡å›åº”æˆ‘</p></blockquote><h2 id="205-åŒæ„å­—ç¬¦ä¸²"><a href="#205-åŒæ„å­—ç¬¦ä¸²" class="headerlink" title="205. åŒæ„å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/isomorphic-strings/" target="_blank" rel="noopener">205. åŒæ„å­—ç¬¦ä¸²</a></h2><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦æ˜¯åŒæ„çš„ã€‚</p><p>å¦‚æœ s ä¸­çš„å­—ç¬¦å¯ä»¥è¢«æ›¿æ¢å¾—åˆ° t ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯åŒæ„çš„ã€‚</p><p>æ‰€æœ‰å‡ºç°çš„å­—ç¬¦éƒ½å¿…é¡»ç”¨å¦ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ï¼ŒåŒæ—¶ä¿ç•™å­—ç¬¦çš„é¡ºåºã€‚ä¸¤ä¸ªå­—ç¬¦ä¸èƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œä½†å­—ç¬¦å¯ä»¥æ˜ å°„è‡ªå·±æœ¬èº«ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"egg"</span>, t = <span class="string">"add"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"foo"</span>, t = <span class="string">"bar"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="string">"paper"</span>, t = <span class="string">"title"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>ä½ å¯ä»¥å‡è®¾ s å’Œ t å…·æœ‰ç›¸åŒçš„é•¿åº¦ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å’Œä¸Šé¢ä¸€æ¨¡ä¸€æ ·ï¼ŒHashè¡¨çš„è§£æ³•å°±ä¸å†™äº†ï¼Œè¿™é¢˜éƒ½æ˜¯å•ä¸ªçš„å­—ç¬¦ï¼Œå¯ä»¥ä¸ç”¨Hashè¡¨ï¼Œå¯ä»¥ç”¨æ•°ç»„ä¼˜åŒ–</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isIsomorphic2</span><span class="params">(String s, String t)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s.length()!=t.length()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] key=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span>[] value=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        <span class="keyword">int</span> cs=s.charAt(i);</span><br><span class="line">        <span class="keyword">int</span> ct=t.charAt(i);</span><br><span class="line">        <span class="keyword">if</span>(key[cs]!=<span class="number">0</span>){ <span class="comment">//cså‡ºç°è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (key[cs]!=ct) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{<span class="comment">//csæ²¡å‡ºç°è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (value[ct]!=<span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">            key[cs]=ct;</span><br><span class="line">            value[ct]=cs;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>ğŸ’¬ åŒæ ·çš„ï¼Œè¿™é¢˜å’Œä¸Šé¢çš„290ä¸€æ ·ï¼Œcaseä¹Ÿæœ‰é—®é¢˜ï¼Œç›´æ¥å’Œå‰ä¸€ä¸ªå­—ç¬¦æ¯”è¾ƒå°±å¯ä»¥è¿‡</p><h2 id="454-å››æ•°ç›¸åŠ -II"><a href="#454-å››æ•°ç›¸åŠ -II" class="headerlink" title="454. å››æ•°ç›¸åŠ  II"></a><a href="https://leetcode-cn.com/problems/4sum-ii/" target="_blank" rel="noopener">454. å››æ•°ç›¸åŠ  II</a></h2><p>ç»™å®šå››ä¸ªåŒ…å«æ•´æ•°çš„æ•°ç»„åˆ—è¡¨ A , B , C , D ,è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç»„ (i, j, k, l) ï¼Œä½¿å¾— A[i] + B[j] + C[k] + D[l] = 0ã€‚</p><p>ä¸ºäº†ä½¿é—®é¢˜ç®€å•åŒ–ï¼Œæ‰€æœ‰çš„ A, B, C, D å…·æœ‰ç›¸åŒçš„é•¿åº¦ Nï¼Œä¸” <code>0 â‰¤ N â‰¤ 500</code> ã€‚æ‰€æœ‰æ•´æ•°çš„èŒƒå›´åœ¨ -2^28 åˆ° 2^28 - 1 ä¹‹é—´ï¼Œæœ€ç»ˆç»“æœä¸ä¼šè¶…è¿‡ 2^31 - 1 ã€‚</p><p><strong>ä¾‹å¦‚:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">A = [ <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">B = [-<span class="number">2</span>,-<span class="number">1</span>]</span><br><span class="line">C = [-<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">D = [ <span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä¸¤ä¸ªå…ƒç»„å¦‚ä¸‹:</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>) -> A[<span class="number">0</span>] + B[<span class="number">0</span>] + C[<span class="number">0</span>] + D[<span class="number">1</span>] = <span class="number">1</span> + (-<span class="number">2</span>) + (-<span class="number">1</span>) + <span class="number">2</span> = <span class="number">0</span></span><br><span class="line"><span class="number">2</span>. (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>) -> A[<span class="number">1</span>] + B[<span class="number">1</span>] + C[<span class="number">0</span>] + D[<span class="number">0</span>] = <span class="number">2</span> + (-<span class="number">1</span>) + (-<span class="number">1</span>) + <span class="number">0</span> = <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å…¶å®çœ‹æ•°æ®è§„æ¨¡å°±çŸ¥é“åº”è¯¥å†™ä¸€ä¸ªä»€ä¹ˆæ ·å¤æ‚åº¦çš„ç®—æ³•äº†<code>0~500</code>ï¼Œæš´åŠ›çš„è¯ä¼šå¾ˆææ€–<code>O(N^4)</code>ï¼Œè¿™é‡Œå¯ä»¥è€ƒè™‘å°†å…¶ä¸­ä¸€ä¸ªæ”¾åˆ°hashè¡¨ä¸­ï¼Œç„¶åéå†å…¶ä»–çš„3ä¸ªï¼Œæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº†<code>O(N^3)</code>ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦è¿˜æ˜¯å¾ˆææ€–ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘å°†ä¸¤ä¸ªæ•°ç»„çš„å’Œæ”¾åˆ°hashè¡¨ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°<code>O(N^2)</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">fourSumCount</span><span class="params">(<span class="keyword">int</span>[] A, <span class="keyword">int</span>[] B, <span class="keyword">int</span>[] C, <span class="keyword">int</span>[] D)</span> </span>{</span><br><span class="line">    HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<c.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<d.length;j++) {< span><br><span class="line">            <span class="keyword">int</span> key=C[i]+D[j];</span><br><span class="line">            map.put(key,map.getOrDefault(key,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<a.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<b.length;j++) {< span><br><span class="line">            <span class="keyword">int</span> key=A[i]+B[j];</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(-key)){</span><br><span class="line">                res+=map.get(-key);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></b.length;j++)></span></a.length;i++)></span></d.length;j++)></span></c.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="451-æ ¹æ®å­—ç¬¦å‡ºç°é¢‘ç‡æ’åº"><a href="#451-æ ¹æ®å­—ç¬¦å‡ºç°é¢‘ç‡æ’åº" class="headerlink" title="451. æ ¹æ®å­—ç¬¦å‡ºç°é¢‘ç‡æ’åº"></a><a href="https://leetcode-cn.com/problems/sort-characters-by-frequency/" target="_blank" rel="noopener">451. æ ¹æ®å­—ç¬¦å‡ºç°é¢‘ç‡æ’åº</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·å°†å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦æŒ‰ç…§å‡ºç°çš„é¢‘ç‡é™åºæ’åˆ—ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line"><span class="string">"tree"</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="string">"eert"</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line"><span class="string">'e'</span>å‡ºç°ä¸¤æ¬¡ï¼Œ<span class="string">'r'</span>å’Œ<span class="string">'t'</span>éƒ½åªå‡ºç°ä¸€æ¬¡ã€‚</span><br><span class="line">å› æ­¤<span class="string">'e'</span>å¿…é¡»å‡ºç°åœ¨<span class="string">'r'</span>å’Œ<span class="string">'t'</span>ä¹‹å‰ã€‚æ­¤å¤–ï¼Œ<span class="string">"eetr"</span>ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç­”æ¡ˆã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line"><span class="string">"cccaaa"</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="string">"cccaaa"</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line"><span class="string">'c'</span>å’Œ<span class="string">'a'</span>éƒ½å‡ºç°ä¸‰æ¬¡ã€‚æ­¤å¤–ï¼Œ<span class="string">"aaaccc"</span>ä¹Ÿæ˜¯æœ‰æ•ˆçš„ç­”æ¡ˆã€‚</span><br><span class="line">æ³¨æ„<span class="string">"cacaca"</span>æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºç›¸åŒçš„å­—æ¯å¿…é¡»æ”¾åœ¨ä¸€èµ·ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line"><span class="string">"Aabb"</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="string">"bbAa"</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">æ­¤å¤–ï¼Œ<span class="string">"bbaA"</span>ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç­”æ¡ˆï¼Œä½†<span class="string">"Aabb"</span>æ˜¯ä¸æ­£ç¡®çš„ã€‚</span><br><span class="line">æ³¨æ„<span class="string">'A'</span>å’Œ<span class="string">'a'</span>è¢«è®¤ä¸ºæ˜¯ä¸¤ç§ä¸åŒçš„å­—ç¬¦ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">frequencySort</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span> || s.length()<<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    }</span><br><span class="line">    HashMap<character,integer> map=<span class="keyword">new</span> HashMap<>();</character,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        map.put(s.charAt(i),map.getOrDefault(s.charAt(i),<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    ArrayList<hashmap.entry> list=<span class="keyword">new</span> ArrayList<>();</hashmap.entry></span><br><span class="line">    <span class="keyword">for</span>(HashMap.Entry entry:map.entrySet()){</span><br><span class="line">        list.add(entry);</span><br><span class="line">    }</span><br><span class="line">    list.sort((e1,e2)->(Integer)e2.getValue()-(Integer)e1.getValue());</span><br><span class="line">    StringBuilder res=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < list.size(); i++) {</span><br><span class="line">        Integer value = (Integer)list.get(i).getValue();</span><br><span class="line">        <span class="keyword">while</span> (value><span class="number">0</span>){</span><br><span class="line">            res.append(list.get(i).getKey());</span><br><span class="line">            value--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res.toString();</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜å…¶å®ä¹Ÿæ˜¯TopKé—®é¢˜ï¼Œç›´æ¥çš„æƒ³æ³•å°±æ˜¯ç”¨hashMapç»Ÿè®¡å„ä¸ªå­—ç¬¦å‡ºç°çš„ä¸ªæ•°ï¼Œç„¶åæ’åºå†æ‹¼æ¥ä¸ºç»“æœï¼Œå…¶å®è¿™é¢˜ä¸€å¼€å§‹æ˜¯TLEäº†çš„ï¼Œä¸€å¼€å§‹æ²¡æ³¨æ„ç›´æ¥ç”¨çš„Stringæ‹¼æ¥çš„ï¼Œæ•ˆç‡å¾ˆä½ï¼Œæ”¹ç”¨StringBuilderåå°±è¿‡äº†ï¼Œè™½ç„¶æ•ˆç‡è¿˜æ˜¯å¾ˆä½ 138msï¼Œå«åº•</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> String <span class="title">frequencySort2</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span> || s.length()<<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        freq[s.charAt(i)]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] freq_bak=freq.clone();</span><br><span class="line">    Arrays.sort(freq);</span><br><span class="line">    StringBuilder res=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="comment">//ä»å¤§åˆ°å°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">255</span>; i>=<span class="number">0</span> && freq[i]!=<span class="number">0</span>; i--) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<<span class="number">255</span>;j++) {</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°åŸæ•°ç»„ä¸­å¯¹åº”çš„å­—ç¬¦</span></span><br><span class="line">            <span class="comment">//åªè¦å‡ºç°æ¬¡æ•°ä¸€æ ·çš„å°±è¡Œäº†</span></span><br><span class="line">            <span class="keyword">if</span>(freq_bak[j]==freq[i]){</span><br><span class="line">                <span class="comment">//æ ¹æ®freq_bak[j]æ„é€ ç»“æœ</span></span><br><span class="line">                <span class="keyword">while</span>(freq_bak[j]><span class="number">0</span>){</span><br><span class="line">                    res.append((<span class="keyword">char</span>)j);</span><br><span class="line">                    freq_bak[j]--;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res.toString();</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>15msï¼Œ90% å…¶å®æ€è·¯å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç»Ÿè®¡æ•°é‡åè¿›è¡Œæ’åºï¼Œç„¶åé‡å»ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”¨æ•°ç»„çš„æ–¹å¼æ˜æ˜¾ä¼šæ¯”HashMapæ•ˆç‡ä¼šæ›´é«˜çš„å¤šï¼Œåé¢çš„ä¸¤å±‚å¾ªç¯éƒ½æ˜¯åœ¨å¸¸æ•°æ—¶é—´å†…ï¼Œä¸»è¦æ˜¯é‡å»ºå­—ç¬¦ä¸²å’Œæ’åºæ¶ˆè€—æ—¶é—´ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯<code>O(NlogN)</code></p><p><strong>è§£æ³•ä¸‰</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> String <span class="title">frequencySort3</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span> || s.length()<<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    }</span><br><span class="line">    ArrayList<character> [] bucket=<span class="keyword">new</span> ArrayList[s.length()+<span class="number">1</span>];</character></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        freq[s.charAt(i)]++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        <span class="keyword">if</span> (bucket[freq[s.charAt(i)]]==<span class="keyword">null</span>) {</span><br><span class="line">            bucket[freq[s.charAt(i)]]=<span class="keyword">new</span> ArrayList<>();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ¯ä¸ªå…ƒç´ åªè¿›å…¥ä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">if</span> (!bucket[freq[s.charAt(i)]].contains(s.charAt(i))) {</span><br><span class="line">            bucket[freq[s.charAt(i)]].add(s.charAt(i));</span><br><span class="line">        }</span><br><span class="line">    } </span><br><span class="line">    <span class="comment">//printArray(bucket);</span></span><br><span class="line">    StringBuilder res=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=bucket.length-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="comment">//è¿‡æ»¤0</span></span><br><span class="line">        <span class="keyword">if</span> (bucket[i]==<span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å‡ºç°iæ¬¡çš„å­—ç¬¦list</span></span><br><span class="line">        ArrayList<character> temp=bucket[i];</character></span><br><span class="line">        <span class="comment">//éå†å‡ºç°æ¬¡æ•°ç›¸åŒçš„list()</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<temp.size();j++) { < span><br><span class="line">            <span class="comment">//éå†å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> count=<span class="number">0</span>;count<i;count++) {< span><br><span class="line">                res.append(temp.get(j));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res.toString();</span><br><span class="line">}</span><br></i;count++)></span></temp.size();j++)></span></s.length();i++)></span></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>50msï¼Œ50% è¿™ä¸ªæ˜¯æ ¹æ® <a href="http://imlgw.top/2019/05/04/leetcode-shu-zu-tag/#347-%E5%89%8D-K-%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0">å‰kä¸ªé«˜é¢‘å…ƒç´ </a> ä¸­æ¡¶æ’åºçš„è§£æ³•æ¥çš„ï¼Œå½“ç„¶è¿™é‡Œå¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œåªæ˜¯ä¸€ç§æ€è·¯ï¼Œå…¶å®å†™èµ·æ¥è¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œæ—¶é—´å¤æ‚åº¦ç•¥é«˜ï¼Œä¸»è¦æ˜¯åœ¨æ¡¶æ’åºçš„æ—¶å€™æ·»åŠ å…ƒç´ åšä¸åˆ°O(N)éœ€è¦åˆ¤æ–­å…ƒç´ æ˜¯å¦æ·»åŠ ï¼Œä¸€ä¸ªå…ƒç´ åªèƒ½åœ¨listä¸­æ·»åŠ ä¸€æ¬¡ï¼Œå¦åˆ™åé¢é‡å»ºå­—ç¬¦ä¸²çš„æ—¶å€™å°±ä¼šæœ‰é—®é¢˜</p><h2 id="49-å­—æ¯å¼‚ä½è¯åˆ†ç»„"><a href="#49-å­—æ¯å¼‚ä½è¯åˆ†ç»„" class="headerlink" title="49. å­—æ¯å¼‚ä½è¯åˆ†ç»„"></a><a href="https://leetcode-cn.com/problems/group-anagrams/" target="_blank" rel="noopener">49. å­—æ¯å¼‚ä½è¯åˆ†ç»„</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå°†å­—æ¯å¼‚ä½è¯ç»„åˆåœ¨ä¸€èµ·ã€‚å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="string">"eat"</span>, <span class="string">"tea"</span>, <span class="string">"tan"</span>, <span class="string">"ate"</span>, <span class="string">"nat"</span>, <span class="string">"bat"</span>],</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [<span class="string">"ate"</span>,<span class="string">"eat"</span>,<span class="string">"tea"</span>],</span><br><span class="line">  [<span class="string">"nat"</span>,<span class="string">"tan"</span>],</span><br><span class="line">  [<span class="string">"bat"</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>æ‰€æœ‰è¾“å…¥å‡ä¸ºå°å†™å­—æ¯</li><li>ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåº</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>ç®—æ˜¯æš´åŠ›æ³•äº†ï¼Œå€ŸåŠ©ä¸Šé¢çš„åŒæ„é¢˜æ€è·¯æ¥éå†åˆ¤æ–­</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<string>> groupAnagrams(String[] strs) {</list<string></span><br><span class="line">    ArrayList<list<string>> res=<span class="keyword">new</span> ArrayList<>();</list<string></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<strs.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"7"</span>==strs[i]) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        ArrayList<string> group=<span class="keyword">new</span> ArrayList<string>();</string></string></span><br><span class="line">        group.add(strs[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j<strs.length;j++) {< span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"7"</span>==strs[j]) {</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span>(isAnagram(strs[i],strs[j])){</span><br><span class="line">                group.add(strs[j]);</span><br><span class="line">                <span class="comment">//æœ‰åˆ†ç»„äº†</span></span><br><span class="line">                strs[j]=<span class="string">"7"</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        res.add(group);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAnagram</span><span class="params">(String str1,String str2)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(str1.length()!=str2.length()){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<str1.length();i++) {< span><br><span class="line">        freq[str1.charAt(i)-<span class="string">'a'</span>]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<str2.length();i++) {< span><br><span class="line">        freq[str2.charAt(i)-<span class="string">'a'</span>]--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<freq.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (freq[i]!=<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></freq.length;i++)></span></str2.length();i++)></span></str1.length();i++)></span></strs.length;j++)></span></strs.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ª<code>7</code> å…¶å®æ²¡ä»€ä¹ˆå«ä¹‰å°±æ˜¯ä¸ºäº†è¡¨ç¤ºè¿™ä¸ªå­—ç¬¦å·²ç»æœ‰åˆ†ç»„äº†ï¼Œè¿™é‡Œä¸€å¼€å§‹æˆ‘æ˜¯ç”¨çš„equalsæ¥æ¯”è¾ƒçš„è¿™ä¸ª7ç»“æœè¶…æ—¶äº†ï¼Œç„¶åæ¢æˆäº†==å‹‰å¼ºè·‘è¿‡äº†ï¼Œå¯èƒ½æ˜¯ä¸ªä¾‹ï¼Œå› ä¸ºæˆ‘åæ¥ç”¨booleanæ•°ç»„ä¹Ÿæ²¡è·‘è¿‡ã€‚ã€‚ã€‚</p><blockquote><p>è¿™é‡Œç”¨==å¯ä»¥æ¯”è¾ƒçš„åŸå› å¯èƒ½æ˜¯strså’Œå­—é¢é‡ â€œ7â€éƒ½åœ¨å­—ç¬¦å¸¸é‡æ± ä¸­ï¼Œä½†æ˜¯è¿™é‡Œå¹¶ä¸å»ºè®®è¿™æ ·æ¯”è¾ƒï¼Œè¿™é‡Œå¯ä»¥è¯´æ˜¯ä¸ªåä¾‹äº†ï¼Œæ¯”è¾ƒå­—ç¬¦ä¸²è¯·ç”¨<code>equals</code> ï¼ï¼ï¼</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<string>> groupAnagrams(String[] strs) {</list<string></span><br><span class="line">    ArrayList<list<string>> res=<span class="keyword">new</span> ArrayList<>();</list<string></span><br><span class="line">    <span class="keyword">boolean</span>[] flag=<span class="keyword">new</span> <span class="keyword">boolean</span>[strs.length()];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<strs.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (flag[i]) <span class="keyword">continue</span>;</span><br><span class="line">        ArrayList<string> group=<span class="keyword">new</span> ArrayList<string>();</string></string></span><br><span class="line">        group.add(strs[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j<strs.length;j++) {< span><br><span class="line">            <span class="keyword">if</span>(flag[j])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(isAnagram(strs[i],strs[j])){</span><br><span class="line">                group.add(strs[j]);</span><br><span class="line">                flag[j]=<span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        res.add(group);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></strs.length;j++)></span></strs.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>åˆ©ç”¨æ’åºç»“æœæ¥ä½œä¸ºkeyï¼Œå°†æ’åºç»“æœç›¸åŒçš„stræ˜ å°„åˆ°ä¸€èµ·</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ’åºè§£æ³•</span></span><br><span class="line"><span class="keyword">public</span> List<list<string>> groupAnagrams(String[] strs) {</list<string></span><br><span class="line">    HashMap<string,list<string>> map=<span class="keyword">new</span> HashMap<>();</string,list<string></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<strs.length;i++) {< span><br><span class="line">        <span class="keyword">char</span>[] strs_i=strs[i].toCharArray();</span><br><span class="line">        <span class="comment">//æ’åºï¼Œå°†ç»“æœä½œä¸ºkey</span></span><br><span class="line">        Arrays.sort(strs_i);</span><br><span class="line">        String key=String.valueOf(strs_i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(key)){</span><br><span class="line">            <span class="comment">//å­˜åœ¨åŒæ„çš„keyï¼Œç›´æ¥æ·»åŠ è¿›å»</span></span><br><span class="line">            map.get(key).add(strs[i]);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ªï¼Œç„¶åå°†è‡ªå·±æ·»åŠ è¿›å»</span></span><br><span class="line">            map.put(key,<span class="keyword">new</span> ArrayList<>());</span><br><span class="line">            map.get(key).add(strs[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ArrayList(map.values());</span><br><span class="line">}</span><br></strs.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚åº¦<code>O(NKlogK)</code>ï¼ŒKä¸ºå­—ç¬¦æ•°ç»„ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²ï¼Œ<code>O(KlogK)</code> æ˜¯ç»™è¿™ä¸ªå­—ç¬¦ä¸²æ’åºçš„ç»“æœ</p><p><strong>è§£æ³•ä¸‰</strong></p><p>æ ¹æ®å‡ºç°é¢‘æ¬¡æ„æˆçš„å­—ç¬¦ä¸²ä½œä¸ºkeyï¼Œæ¯”å¦‚<code>aba</code>ä»¥åŠæ‰€æœ‰çš„å¼‚ä½è¯éƒ½ä¼šè¢«æ˜ å°„ä¸º<code>2#1#</code> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<string>> groupAnagrams(String[] strs) {</list<string></span><br><span class="line">    HashMap<string,list<string>> map=<span class="keyword">new</span> HashMap<>();</string,list<string></span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<strs.length;i++) {< span><br><span class="line">        <span class="comment">//Arrays.fill(freq,0);</span></span><br><span class="line">        <span class="comment">//ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<strs[i].length();j++) {< span><br><span class="line">            freq[strs[i].charAt(j)-<span class="string">'a'</span>]++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ„å»ºå”¯ä¸€æ˜ å°„çš„key</span></span><br><span class="line">        StringBuilder key=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="comment">//è¿™ä¸ªå…¶å®ç±»ä¼¼æ¡¶æ’åº,ä¾æ¬¡å–abcde...</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<<span class="number">26</span>;j++) {</span><br><span class="line">            key.append(freq[j]);</span><br><span class="line">            <span class="comment">//è¿™ä¸ª#å¾ˆå…³é”®,ä¸ºäº†é˜²æ­¢é‡å¤,å› ä¸ºæœ‰çš„å­—ç¬¦å¯èƒ½å‡ºç°ä¸¤ä½æ•°çš„æ¬¡æ•°,ä»…ä»…å¯¹æ¯”æ•°å­—æ˜¯æ— æ³•ç¡®å®šçš„</span></span><br><span class="line">            key.append(<span class="string">"#"</span>);</span><br><span class="line">            <span class="comment">//é‡ç½®ä¸º0æ–¹ä¾¿åé¢é‡å¤ä½¿ç”¨</span></span><br><span class="line">            freq[j]=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        String skey=key.toString();</span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(skey)){</span><br><span class="line">            map.get(skey).add(strs[i]);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            map.put(skey,<span class="keyword">new</span> ArrayList());</span><br><span class="line">            map.get(skey).add(strs[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ArrayList(map.values());</span><br><span class="line">}</span><br></strs[i].length();j++)></span></strs.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>45msï¼Œ21% æ—¶é—´å¤æ‚åº¦<code>O(NK)</code> Kä¸ºå­—ç¬¦æ•°ç»„ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¾ˆç„å­¦ï¼Œè®²é“ç†åº”è¯¥ä¸ä¼šè¿™ä¹ˆæ…¢ï¼Œçœ‹äº†leetcodeä¸Šå‰å‡ åè·Ÿæˆ‘çš„å·®ä¸å¤šï¼Œå¼€å§‹åšçš„æ—¶å€™ç›´æ¥ç”¨ <code>StringBuilder</code> å¯¹è±¡ä½œä¸ºäº†keyç»“æœè‚¯å®šä¸å¯¹ï¼ŒStringBuilderæ²¡æœ‰è¦†ç›–equalsæ–¹æ³•ï¼Œkeyæ°¸è¿œä¸ä¼šç›¸ç­‰ï¼Œæ¯æ¬¡éƒ½æ˜¯æ–°çš„key</p><p><strong>è§£æ³•å››</strong></p><p><strong>ç®—æœ¯åŸºæœ¬å®šç†</strong>ï¼Œåˆç§°ä¸ºæ­£æ•´æ•°çš„å”¯ä¸€åˆ†è§£å®šç†ï¼Œå³ï¼šæ¯ä¸ªå¤§äº1çš„è‡ªç„¶æ•°ï¼Œè¦ä¹ˆæœ¬èº«å°±æ˜¯è´¨æ•°ï¼Œè¦ä¹ˆå¯ä»¥å†™ä¸º2ä¸ªä»¥ä¸Šçš„è´¨æ•°çš„ç§¯ï¼Œè€Œä¸”è¿™äº›è´¨å› å­æŒ‰å¤§å°æ’åˆ—ä¹‹åï¼Œå†™æ³•ä»…æœ‰ä¸€ç§æ–¹å¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<string>> groupAnagrams(String[] strs) {</list<string></span><br><span class="line">    HashMap<integer, list<string>> hash = <span class="keyword">new</span> HashMap<>();</integer,></span><br><span class="line">    <span class="comment">//æ¯ä¸ªå­—æ¯å¯¹åº”ä¸€ä¸ªè´¨æ•°</span></span><br><span class="line">    <span class="keyword">int</span>[] prime = { <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">67</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">97</span>, <span class="number">101</span>, <span class="number">103</span> };</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < strs.length; i++) {</span><br><span class="line">        <span class="keyword">int</span> key = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//ç´¯ä¹˜å¾—åˆ° key</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j < strs[i].length(); j++) {</span><br><span class="line">            key *= prime[strs[i].charAt(j) - <span class="string">'a'</span>];</span><br><span class="line">        } </span><br><span class="line">        <span class="keyword">if</span> (hash.containsKey(key)) {</span><br><span class="line">            hash.get(key).add(strs[i]);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            List<string> temp = <span class="keyword">new</span> ArrayList<string>();</string></string></span><br><span class="line">            temp.add(strs[i]);</span><br><span class="line">            hash.put(key, temp);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ArrayList<list<string>>(hash.values());</list<string></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚åº¦<code>O(NK)</code>ï¼Œå¼ºçš„8è¡Œ</p><blockquote><p>åˆ†æå®Œä¸Šé¢ä¸‰ç§è§£æ³•åå…¶å®å¾ˆåŒæ„å¾—å‡ºè¿™é¢˜çš„å…³é”®ï¼š<code>ç»™åŒç»„çš„å¼‚ä½è¯æ‰¾åˆ°ä¸€ä¸ªç›¸åŒçš„æ˜ å°„key</code>ï¼Œå°½é‡çš„ç¼©çŸ­æ±‚è¿™ä¸ªæ˜ å°„çš„æ—¶é—´å°±å¯ä¼˜åŒ–æ•´ä¸ªç®—æ³•</p></blockquote><h2 id="447-å›æ—‹é•–çš„æ•°é‡"><a href="#447-å›æ—‹é•–çš„æ•°é‡" class="headerlink" title="447. å›æ—‹é•–çš„æ•°é‡"></a><a href="https://leetcode-cn.com/problems/number-of-boomerangs/" target="_blank" rel="noopener">447. å›æ—‹é•–çš„æ•°é‡</a></h2><p>ç»™å®šå¹³é¢ä¸Š n å¯¹ä¸åŒçš„ç‚¹ï¼Œâ€œå›æ—‹é•–â€ æ˜¯ç”±ç‚¹è¡¨ç¤ºçš„å…ƒç»„ <code>(i, j, k)</code> ï¼Œå…¶ä¸­ i å’Œ j ä¹‹é—´çš„è·ç¦»å’Œ i å’Œ k ä¹‹é—´çš„è·ç¦»ç›¸ç­‰ï¼ˆ<strong>éœ€è¦è€ƒè™‘å…ƒç»„çš„é¡ºåº</strong>ï¼‰</p><p>æ‰¾åˆ°æ‰€æœ‰å›æ—‹é•–çš„æ•°é‡ã€‚ä½ å¯ä»¥å‡è®¾ n æœ€å¤§ä¸º 500ï¼Œæ‰€æœ‰ç‚¹çš„åæ ‡åœ¨é—­åŒºé—´ <code>[-10000, 10000]</code> ä¸­ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">2</span>,<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä¸¤ä¸ªå›æ—‹é•–ä¸º [[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">2</span>,<span class="number">0</span>]] å’Œ [[<span class="number">1</span>,<span class="number">0</span>],[<span class="number">2</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">0</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numberOfBoomerangs</span><span class="params">(<span class="keyword">int</span>[][] points)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<points.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<points.length;j++) {< span><br><span class="line">            <span class="keyword">if</span> (i!=j){</span><br><span class="line">                <span class="keyword">int</span> dis=dis(points[i],points[j]);</span><br><span class="line">                map.put(dis,map.getOrDefault(dis,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//C2m ç»„åˆé—®é¢˜</span></span><br><span class="line">        <span class="keyword">for</span> (Integer count:map.values()) {</span><br><span class="line">            <span class="keyword">if</span> (count><span class="number">1</span>) {</span><br><span class="line">                res+=count*(count-<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        map.clear();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dis</span><span class="params">(<span class="keyword">int</span>[] a,<span class="keyword">int</span>[] b)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> (a[<span class="number">0</span>]-b[<span class="number">0</span>])*(a[<span class="number">0</span>]-b[<span class="number">0</span>])+(a[<span class="number">1</span>]-b[<span class="number">1</span>])*(a[<span class="number">1</span>]-b[<span class="number">1</span>]);</span><br><span class="line">}</span><br></points.length;j++)></span></points.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>çœ‹ä¸€ä¸‹ç»™çš„æ•°æ®é‡<code>500</code>å°±çŸ¥é“å¤æ‚åº¦åªèƒ½æ˜¯<code>O(N^2)</code> çš„ï¼Œç”¨Hashè¡¨ç»Ÿè®¡åˆ°å½“å‰ç‚¹çš„è·ç¦»ç›¸åŒçš„ç‚¹æœ‰å¤šå°‘ä¸ªï¼Œç„¶ååˆ©ç”¨ç»„åˆæ•°æ±‚å¤šå°‘ç§ç»„åˆï¼Œä¸€å¼€å§‹å¹¶æ²¡æœ‰æƒ³åˆ°è¿™ç§æ–¹æ³•ï¼Œæˆ‘æƒ³çš„æ˜¯åˆ©ç”¨åæ ‡ç³»çš„å¯¹ç§°æ¥åšï¼Œå¤ªèœäº†</p><p>è¿™é‡Œè¿˜æœ‰ä¸ªå°ç»†èŠ‚ï¼Œä¸€å¼€å§‹å°†HashMapçš„åˆ›å»ºæ”¾åœ¨å†…å¾ªç¯ä¸­ï¼Œå‘ç°æ•ˆç‡å¾ˆä½ï¼Œ300mså·¦å³ï¼Œç„¶åå°†åˆ›å»ºHashMapç§»å‡ºå»åç”¨clearæ¸…ç©ºï¼Œç¬é—´å¿«äº†100mså·¦å³ï¼Œåˆ›å»ºHashMapçš„æˆæœ¬æœç„¶è¿˜æ˜¯æŒºå¤§çš„</p><p>è¿™é¢˜å…¶å®è¿˜å¯ä»¥å‡å°‘å†…å¾ªç¯çš„æ•°é‡ï¼Œ</p><h2 id="217-å­˜åœ¨é‡å¤å…ƒç´ "><a href="#217-å­˜åœ¨é‡å¤å…ƒç´ " class="headerlink" title="217. å­˜åœ¨é‡å¤å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/contains-duplicate/" target="_blank" rel="noopener">217. å­˜åœ¨é‡å¤å…ƒç´ </a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å¤å…ƒç´ ã€‚</p><p>å¦‚æœä»»ä½•å€¼åœ¨æ•°ç»„ä¸­å‡ºç°è‡³å°‘ä¸¤æ¬¡ï¼Œå‡½æ•°è¿”å› trueã€‚å¦‚æœæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç›¸åŒï¼Œåˆ™è¿”å› falseã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å€ŸåŠ©Hashè¡¨ï¼Œå¾ˆç®€å•çš„é¢˜</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">containsDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    HashSet<integer> set=<span class="keyword">new</span> HashSet<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (set.contains(nums[i])) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        set.add(nums[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®è¿˜å¯ä»¥ä¼˜åŒ–ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">containsDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    HashSet<integer> set=<span class="keyword">new</span> HashSet<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!set.add(nums[i])) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><code>set.add()</code> æœ¬èº«å°±å¸¦æœ‰è¿”å›å€¼ï¼Œå¯ä»¥å‡å°‘å¾ˆå¤šåˆ¤æ–­ï¼Œè¿™é¢˜è¿˜æœ‰ä¸€ä¸ªè¿›é˜¶ç‰ˆ <a href="https://leetcode-cn.com/problems/contains-duplicate-ii/" target="_blank" rel="noopener">219. å­˜åœ¨é‡å¤å…ƒç´  II</a> ä¹Ÿä¸éš¾ï¼Œæˆ‘æ”¾åˆ° <a href="http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou-tag/#3-%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2">æ»‘åŠ¨çª—å£ä¸“é¢˜</a> ä¸­å»äº†</p><h2 id="220-å­˜åœ¨é‡å¤å…ƒç´ -III"><a href="#220-å­˜åœ¨é‡å¤å…ƒç´ -III" class="headerlink" title="220. å­˜åœ¨é‡å¤å…ƒç´  III"></a><a href="https://leetcode-cn.com/problems/contains-duplicate-iii/" target="_blank" rel="noopener">220. å­˜åœ¨é‡å¤å…ƒç´  III</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦æœ‰ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• i å’Œ jï¼Œä½¿å¾— <code>nums [i]</code> å’Œ <code>nums [j]</code> çš„å·®çš„ç»å¯¹å€¼æœ€å¤§ä¸º tï¼Œå¹¶ä¸” i å’Œ j ä¹‹é—´çš„å·®çš„ç»å¯¹å€¼æœ€å¤§ä¸º k</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>], k = <span class="number">3</span>, t = <span class="number">0</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>], k = <span class="number">1</span>, t = <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">9</span>], k = <span class="number">2</span>, t = <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é‡Œå…¶å®å¯ä»¥ç®—éš¾é¢˜äº†ï¼Œé€šè¿‡ç‡åªæœ‰20%ï¼Œåˆ©ç”¨Javaä¸­æä¾›çš„TreeMapï¼Œæœ‰é¡ºåºè€Œä¸”æ’å…¥å’Œåˆ é™¤ç­‰æ“ä½œæ•ˆç‡éƒ½å¾ˆé«˜ï¼ˆlogNï¼‰ï¼Œç„¶åæŸ¥æ‰¾æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼Œçœ‹ç¬¦ä¸ç¬¦åˆé¢˜ç›®è¦æ±‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsNearbyAlmostDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k, <span class="keyword">int</span> t)</span> </span>{</span><br><span class="line">    TreeSet<integer> set=<span class="keyword">new</span> TreeSet<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//å¤§äºnums[i]çš„æœ€å°å…ƒç´ </span></span><br><span class="line">        Integer ceiling=set.ceiling(nums[i]);</span><br><span class="line">        <span class="comment">//å°äºnums[i]çš„æœ€å¤§å…ƒç´ </span></span><br><span class="line">        Integer floor=set.floor(nums[i]);</span><br><span class="line">        <span class="comment">//é˜²æ­¢æº¢å‡º</span></span><br><span class="line">        <span class="keyword">long</span> temp1=Long.valueOf(nums[i])+Long.valueOf(t);</span><br><span class="line">        <span class="keyword">long</span> temp2=Long.valueOf(nums[i])-Long.valueOf(t);</span><br><span class="line">        <span class="keyword">if</span>((ceiling!=<span class="keyword">null</span> && ceiling<=temp1) || (floor!=<span class="keyword">null</span> && floor>=temp2)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        set.add(nums[i]);</span><br><span class="line">        <span class="keyword">if</span> (set.size()>k) {</span><br><span class="line">            <span class="comment">//ç§»é™¤å·¦è¾¹ç•Œ</span></span><br><span class="line">            set.remove(nums[i-k]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>72msï¼Œ5%å·¦å³ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦<code>O(NlogN)</code> </p><p><strong>è§£æ³•äºŒ</strong></p><p>çœ‹äº†ä¸‹è¯„è®ºåŒºï¼Œå‘ç°å…¶å®å¯ä»¥ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªè¾¹ç•Œï¼Œè¿™æ ·å¯ä»¥å°‘ä¸€æ¬¡æŸ¥æ‰¾çš„æ“ä½œï¼Œæ•ˆç‡æœ‰å¾ˆå¤§æå‡</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsNearbyAlmostDuplicate2</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k, <span class="keyword">int</span> t)</span> </span>{</span><br><span class="line">    TreeSet<long> set=<span class="keyword">new</span> TreeSet<>();</long></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//å¤§äºnums[i]-tçš„æœ€å°å…ƒç´ </span></span><br><span class="line">        Long ceil=set.ceiling((<span class="keyword">long</span>)nums[i]-(<span class="keyword">long</span>)t);</span><br><span class="line">        <span class="keyword">if</span>(ceil!=<span class="keyword">null</span> && ceil<=(<span class="keyword">long</span>)nums[i]+(<span class="keyword">long</span>)t) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        set.add((<span class="keyword">long</span>)nums[i]);</span><br><span class="line">        <span class="keyword">if</span> (set.size()>k) {</span><br><span class="line">            set.remove((<span class="keyword">long</span>)nums[i-k]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>43msï¼Œ56%å·¦å³ï¼Œä¾ç„¶è¦æ³¨æ„æº¢å‡ºçš„é—®é¢˜</p><h2 id="å‰ç¼€å’Œç›¸å…³"><a href="#å‰ç¼€å’Œç›¸å…³" class="headerlink" title="å‰ç¼€å’Œç›¸å…³"></a><em>å‰ç¼€å’Œç›¸å…³</em></h2><h2 id="560-å’Œä¸ºKçš„å­æ•°ç»„"><a href="#560-å’Œä¸ºKçš„å­æ•°ç»„" class="headerlink" title="560. å’Œä¸ºKçš„å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/subarray-sum-equals-k/" target="_blank" rel="noopener">560. å’Œä¸ºKçš„å­æ•°ç»„</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° kï¼Œä½ éœ€è¦æ‰¾åˆ°è¯¥æ•°ç»„ä¸­å’Œä¸º k çš„è¿ç»­çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1 :</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:nums = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>], k = <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span> , [<span class="number">1</span>,<span class="number">1</span>] ä¸ [<span class="number">1</span>,<span class="number">1</span>] ä¸ºä¸¤ç§ä¸åŒçš„æƒ…å†µã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ :</strong></p><ul><li>æ•°ç»„çš„é•¿åº¦ä¸º [1, 20,000]ã€‚</li><li>æ•°ç»„ä¸­å…ƒç´ çš„èŒƒå›´æ˜¯ [-1000, 1000] ï¼Œä¸”æ•´æ•° k çš„èŒƒå›´æ˜¯ [-1e7, 1e7]ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å‰ç¼€å’Œ + hashè¡¨</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">subarraySum</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    HashMap<integer,integer> map = <span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    map.put(<span class="number">0</span>,<span class="number">1</span>);<span class="comment">//åˆå§‹åŒ–å¤´å“¨å…µ,é¿å…ä¸‹æ ‡è½¬æ¢</span></span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        sum+=nums[i];</span><br><span class="line">        <span class="comment">//-1 -1 1 | 0</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="comment">/*sum>=k && */</span>map.containsKey(sum-k)) {</span><br><span class="line">            res+=map.get(sum-k);</span><br><span class="line">        }</span><br><span class="line">        map.put(sum,map.getOrDefault(sum,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æˆ‘ä»¬å°†å„ä¸ªä½ç½®çš„å‰ç¼€å’Œä½œä¸ºé”®ï¼Œè¿™ä¸ªå‰ç¼€å’Œåœ¨<strong>å½“å‰ä½ç½®ä¹‹å‰å‡ºç°çš„æ¬¡æ•°ä½œä¸ºé”®</strong> (è¿™ä¸€ç‚¹ä¿è¯äº†è¿ç»­ï¼Œä¸ä¼šæ‰¾åˆ°åé¢å»)</p><p>ç„¶åæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°å’Œä¸ºkåŒºé—´æœ‰å¤šå°‘ä¸ªï¼ŒåŒºé—´å’Œåˆ©ç”¨å‰ç¼€å’Œå¯ä»¥ç›´æ¥ç®—å‡ºï¼Œä¹Ÿå°±æ˜¯ </p><p><code>sum[i~j] = sum[j] -sum[i]= k</code> ç„¶åè¿™ä¸ªé—®é¢˜å°±å¯ä»¥è½¬æ¢ä¸ºï¼Œå½“æˆ‘ä»¬éå†åˆ°æŸä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨mapä¸­æŸ¥æ‰¾å‰ç¼€å’Œä¸º<code>sum[j] - k</code>çš„å…ƒç´ æœ‰å‡ ä¸ªï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°åŒºé—´å’Œä¸ºkçš„åŒºé—´æœ‰å¤šå°‘ä¸ªï¼</p><p>å€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªåˆå§‹çš„<code>sum=0</code>çš„å€¼ï¼Œé¿å…ä¸‹æ ‡çš„è½¬æ¢</p><p>ç”»ä¸ªå›¾å°±åƒä¸‹é¢è¿™æ ·ï¼š</p><p><img alt="img" data-src="http://static.imlgw.top/blog/20191104/ECiyYqso8i2K.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h2 id="1248-ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€"><a href="#1248-ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€" class="headerlink" title="1248. ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€"></a><a href="https://leetcode-cn.com/problems/count-number-of-nice-subarrays/" target="_blank" rel="noopener">1248. ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° kã€‚</p><p>å¦‚æœæŸä¸ªå­æ•°ç»„ä¸­æ°å¥½æœ‰ k ä¸ªå¥‡æ•°æ•°å­—ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸ªå­æ•°ç»„æ˜¯<strong>ã€Œä¼˜ç¾å­æ•°ç»„ã€</strong>ã€‚</p><p>è¯·è¿”å›è¿™ä¸ªæ•°ç»„ä¸­ã€Œä¼˜ç¾å­æ•°ç»„ã€çš„æ•°ç›®ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>], k = <span class="number">3</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">2</span></span><br><span class="line">è§£é‡Šï¼šåŒ…å« <span class="number">3</span> ä¸ªå¥‡æ•°çš„å­æ•°ç»„æ˜¯ [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>] å’Œ [<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>] ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>], k = <span class="number">1</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">0</span></span><br><span class="line">è§£é‡Šï¼šæ•°åˆ—ä¸­ä¸åŒ…å«ä»»ä½•å¥‡æ•°ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä¼˜ç¾å­æ•°ç»„ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>], k = <span class="number">2</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">16</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= nums.length <= 50000</code></li><li><code>1 <= nums[i] <= 10^5</code></li><li><code>1 <= k <= nums.length</code></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>11.3 å‘¨èµ›ç¬¬äºŒé¢˜ï¼Œæ²¡åšå‡ºæ¥ï¼Œä»¥ä¸ºæ˜¯æ»‘åŠ¨çª—å£ï¼Œæ»‘äº†åŠå¤©æ²¡æ»‘å‡ºæ¥ï¼Œåæ¥çœ‹äº†è§£ç­”çŸ¥é“äº†æ˜¯åˆ©ç”¨å‰ç¼€å’Œ + Hashï¼Œå…¶å®å’Œä¸Šé¢ä¸€é¢˜æ˜¯ç±»ä¼¼çš„ï¼Œç›¸å½“äºä¸Šä¸€é¢˜çš„è¿›é˜¶</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numberOfSubarrays</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>,res=<span class="number">0</span>;</span><br><span class="line">    map.put(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (nums[i]%<span class="number">2</span>==<span class="number">1</span>) {</span><br><span class="line">            sum++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//é¢˜ç›®è¯´äº†éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä¼˜åŒ–ä¸‹</span></span><br><span class="line">        <span class="keyword">if</span> (sum>=k && map.containsKey(sum-k)) {</span><br><span class="line">            res+=map.get(sum-k);</span><br><span class="line">        }</span><br><span class="line">        map.put(sum,map.getOrDefault(sum,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®è¿™é‡Œå°±æ˜¯æŠŠå¥‡æ•°éƒ½çœ‹ä½œ 1ï¼Œå¶æ•°éƒ½çœ‹ä½œ0ï¼Œè¿™æ ·é—®é¢˜å°±å˜æˆäº†æ±‚å’Œä¸ºkçš„åŒºé—´ä¸ªæ•°æœ‰å¤šå°‘ä¸ªï¼Œç„¶ååœ¨æ ¹æ®ä¸Šé¢çš„å‰ç¼€å’Œ+Hashè¡¨ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„å¾—åˆ°ç­”æ¡ˆï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯é¢˜ç›®è¯´äº†æ•°æ®éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥åœ¨åˆ¤æ–­çš„æ—¶å€™å¯ä»¥åŠ ä¸€ä¸ª<code>sum>=k</code> æ¥å‡å°‘ä¸€ç‚¹åˆ¤æ–­ï¼Œå½“ç„¶è¿™é¢˜é¢˜ç›®æŒ‡å®šäº†æ•°æ®çš„èŒƒå›´ï¼Œæ‰€ä»¥è¿˜å¯ä»¥ç›´æ¥ç”¨æ•°ç»„åšmapæ˜ å°„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numberOfSubarrays</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//HashMap<integer,integer> map=new HashMap<>();</integer,integer></span></span><br><span class="line">    <span class="keyword">int</span>[] map=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">100001</span>];</span><br><span class="line">    map[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (nums[i]%<span class="number">2</span>==<span class="number">1</span>) {</span><br><span class="line">            sum++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (sum>=k) {</span><br><span class="line">            res+=map[sum-k];</span><br><span class="line">        }</span><br><span class="line">        map[sum]++;</span><br><span class="line">        <span class="comment">//System.out.println(sum+":"+map[sum]);</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="1282-ç”¨æˆ·åˆ†ç»„"><a href="#1282-ç”¨æˆ·åˆ†ç»„" class="headerlink" title="1282. ç”¨æˆ·åˆ†ç»„"></a><a href="https://leetcode-cn.com/problems/group-the-people-given-the-group-size-they-belong-to/" target="_blank" rel="noopener">1282. ç”¨æˆ·åˆ†ç»„</a></h2><p>æœ‰ n ä½ç”¨æˆ·å‚åŠ æ´»åŠ¨ï¼Œä»–ä»¬çš„ ID ä» 0 åˆ° n - 1ï¼Œæ¯ä½ç”¨æˆ·éƒ½ æ°å¥½ å±äºæŸä¸€ç”¨æˆ·ç»„ã€‚ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ groupSizesï¼Œå…¶ä¸­åŒ…å«æ¯ä½ç”¨æˆ·æ‰€å¤„çš„ç”¨æˆ·ç»„çš„å¤§å°ï¼Œè¯·ä½ è¿”å›ç”¨æˆ·åˆ†ç»„æƒ…å†µï¼ˆå­˜åœ¨çš„ç”¨æˆ·ç»„ä»¥åŠæ¯ä¸ªç»„ä¸­ç”¨æˆ·çš„ IDï¼‰ã€‚</p><p>ä½ å¯ä»¥ä»»ä½•é¡ºåºè¿”å›è§£å†³æ–¹æ¡ˆï¼ŒID çš„é¡ºåºä¹Ÿä¸å—é™åˆ¶ã€‚æ­¤å¤–ï¼Œé¢˜ç›®ç»™å‡ºçš„æ•°æ®ä¿è¯è‡³å°‘å­˜åœ¨ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šgroupSizes = [<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡ºï¼š[[<span class="number">5</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>]]</span><br><span class="line">è§£é‡Šï¼š </span><br><span class="line">å…¶ä»–å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæœ‰ [[<span class="number">2</span>,<span class="number">1</span>,<span class="number">6</span>],[<span class="number">5</span>],[<span class="number">0</span>,<span class="number">4</span>,<span class="number">3</span>]] å’Œ [[<span class="number">5</span>],[<span class="number">0</span>,<span class="number">6</span>,<span class="number">2</span>],[<span class="number">4</span>,<span class="number">3</span>,<span class="number">1</span>]]ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šgroupSizes = [<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡ºï¼š[[<span class="number">1</span>],[<span class="number">0</span>,<span class="number">5</span>],[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>groupSizes.length == n</code></li><li><code>1 <= n <= 500</code></li><li><code>1 <= groupSizes[i] <= n</code></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>12.8å‘¨èµ›çš„é¢˜ï¼Œæˆ‘æ˜¯æ¨¡æ‹Ÿåšçš„ï¼Œçœ‹äº†åˆ«äººçš„åšæ³•è¿˜æ˜¯æ„Ÿè§‰è¿™ç§æ¯”è¾ƒä¼˜é›…</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> groupThePeople(<span class="keyword">int</span>[] groupSizes) {</list<integer></span><br><span class="line">    HashMap<integer,list<integer>> map=<span class="keyword">new</span> HashMap<>();</integer,list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> LinkedList<>();</list<integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<groupsizes.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(groupSizes[i])) {</span><br><span class="line">            List<integer> list=<span class="keyword">new</span> LinkedList();</integer></span><br><span class="line">            map.put(groupSizes[i],list);</span><br><span class="line">        }</span><br><span class="line">        List<integer> gl=map.get(groupSizes[i]);</integer></span><br><span class="line">        gl.add(i);</span><br><span class="line">        <span class="keyword">if</span> (gl.size()==groupSizes[i]) {</span><br><span class="line">            res.add(gl);</span><br><span class="line">            map.remove(groupSizes[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></groupsizes.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚åº¦<code>O(N)</code></p><p><strong>è§£æ³•äºŒ</strong></p><p>æ¨¡æ‹Ÿçš„è§£æ³•ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(N^2)</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List<list<integer>> groupThePeople(<span class="keyword">int</span>[] groupSizes) {</list<integer></span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[groupSizes.length];</span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> LinkedList<>();</list<integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<groupsizes.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (visit[i]) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        List<integer> list= <span class="keyword">new</span> LinkedList<>();</integer></span><br><span class="line">        list.add(i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j<groupsizes.length;j++) {< span><br><span class="line">            <span class="keyword">if</span> (visit[j]) {</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (list.size()==groupSizes[i]) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (groupSizes[j]==groupSizes[i]) {</span><br><span class="line">                list.add(j);</span><br><span class="line">                visit[j]=<span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        res.add(list);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></groupsizes.length;j++)></span></groupsizes.length;i++)></span></pre></td></tr></tbody></table></figure></div></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> æŸ¥æ‰¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº(ä¸‰)</title>
      <link href="/2019/09/05/shen-ru-li-jie-java-xu-ni-ji-san/"/>
      <url>/2019/09/05/shen-ru-li-jie-java-xu-ni-ji-san/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><blockquote><p>è¿™ä¸€ç¯‡ä¸»è¦è®°å½•JVMç›¸å…³çš„Classæ–‡ä»¶ç»“æ„</p></blockquote><h2 id="Classç±»æ–‡ä»¶çš„ç»“æ„"><a href="#Classç±»æ–‡ä»¶çš„ç»“æ„" class="headerlink" title="Classç±»æ–‡ä»¶çš„ç»“æ„"></a>Classç±»æ–‡ä»¶çš„ç»“æ„</h2><p> Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥<strong>8ä¸ªå­—èŠ‚</strong>ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµï¼Œæ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒï¼ŒClassæ–‡ä»¶æ ¼å¼é‡‡ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ç§ä¼ªç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼š<strong>æ— ç¬¦å·æ•°å’Œè¡¨</strong> </p><p><strong>æ— ç¬¦å·æ•°</strong></p><p>æ— ç¬¦å·æ•°å±äºåŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä»¥u1ï¼Œu2ï¼Œu4ï¼Œu8æ¥åˆ†åˆ«è¡¨ç¤º1ï¼Œ2ï¼Œ4ï¼Œ8ä¸ªå­—èŠ‚å¤§å°çš„æ— ç¬¦å·æ•°ï¼Œæ— ç¬¦å·æ•°ç”¨æ¥æè¿°æ•°å­—ï¼Œç´¢å¼•å¼•ç”¨ï¼Œæ•°é‡å€¼ï¼Œæˆ–è€…æŒ‰ç…§UTF-8ç¼–ç æ„æˆå­—ç¬¦ä¸²å€¼</p><p><strong>è¡¨ï¼ˆæ•°ç»„ï¼‰</strong></p><p>è¡¨æ˜¯ç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–è€…å…¶ä»–è¡¨ä½œä¸ºæ•°æ®é¡¹æ„æˆçš„ç¬¦åˆæ•°æ®ç±»å‹ï¼Œæ‰€æœ‰è¡¨éƒ½ä¹ æƒ¯æ€§çš„ä»¥<code>_info</code> ç»“å°¾ï¼Œè¡¨ç”¨äºæè¿°æœ‰ç¨‹æ± å…³ç³»çš„å¤åˆç»“æ„çš„æ•°æ®ï¼Œæ•´ä¸ªClassæ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ è¡¨</p><h3 id="Classæ–‡ä»¶æ•´ä½“ç»“æ„"><a href="#Classæ–‡ä»¶æ•´ä½“ç»“æ„" class="headerlink" title="Classæ–‡ä»¶æ•´ä½“ç»“æ„"></a>Classæ–‡ä»¶æ•´ä½“ç»“æ„</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ClassFile{</span><br><span class="line">    <span class="function">u4                  <span class="title">magic</span><span class="params">(é­”æ•°<span class="number">0xCAFFBABE</span>)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">minor_version</span><span class="params">(æ¬¡ç‰ˆæœ¬å·)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">major_version</span><span class="params">(ä¸»ç‰ˆæœ¬å·)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">constant_pool_count</span><span class="params">(å¸¸é‡æ± ä¸ªæ•°)</span></span></span><br><span class="line"><span class="function">    cp_info             <span class="title">constant_pool</span><span class="params">(å¸¸é‡æ± è¡¨)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">access_flags</span><span class="params">(ç±»æˆ–æ¥å£çš„è®¿é—®æƒé™)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">this_class</span><span class="params">(ç±»å)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">super_class</span><span class="params">(çˆ¶ç±»å)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">interfaces_count</span><span class="params">(æ¥å£ä¸ªæ•°)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">interfaces</span><span class="params">(æ¥å£å)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">fields_count</span><span class="params">(å­—æ®µä¸ªæ•°)</span></span></span><br><span class="line"><span class="function">    field_info          <span class="title">fields</span><span class="params">(å­—æ®µè¡¨)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">methods_count</span><span class="params">(æ–¹æ³•æ•°)</span></span></span><br><span class="line"><span class="function">    method_info         <span class="title">methods</span><span class="params">(æ–¹æ³•è¡¨)</span></span></span><br><span class="line"><span class="function">    u2                  <span class="title">attributes_count</span><span class="params">(é™„åŠ å±æ€§ä¸ªæ•°)</span></span></span><br><span class="line"><span class="function">    attribute_info      <span class="title">attributes</span><span class="params">(é™„åŠ å±æ€§è¡¨)</span></span></span><br><span class="line"><span class="function">}</span></span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>åœ¨ç½‘ä¸Šçœ‹äº†<a href="https://www.infoq.cn/article/Secrets-of-the-Bytecode-Ninjas" target="_blank" rel="noopener">å›½å¤–çš„å¤§ä½¬</a>çš„ä¸€å¼ å›¾ï¼ŒæŒºæœ‰æ„æ€çš„<img alt="mark" data-src="http://static.imlgw.top/blog/20190902/4JDgENgQ9eIo.png?imageslim" src="/img/loading.gif" class="lazyload"></p></blockquote><p><strong>é­”æ•°å’ŒClassæ–‡ä»¶çš„ç‰ˆæœ¬</strong></p><p>æ¯ä¸ªClassæ–‡ä»¶çš„<strong>å¤´4ä¸ªå­—èŠ‚</strong>ç§°ä¸ºé­”æ•°ï¼Œä»–å”¯ä¸€çš„ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥æ”¶çš„Classæ–‡ä»¶ï¼Œè¿™ä¸ªå€¼ä¸º<code>0xCAFFBABE</code> ï¼Œç´§è·Ÿç€é­”æ•°çš„<strong>4ä¸ªå­—èŠ‚</strong>å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œé«˜ç‰ˆæœ¬çš„JDKèƒ½å…¼å®¹ä½ç‰ˆæœ¬çš„å­—èŠ‚ç ï¼Œè€Œä½ç‰ˆæœ¬JVMçš„æ— æ³•å…¼å®¹é«˜ç‰ˆæœ¬çš„Classæ–‡ä»¶</p><h2 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h2><p>ç´§è·Ÿç€ç‰ˆæœ¬å·ä¹‹åçš„å°±æ˜¯å¸¸é‡æ± å…¥å£ï¼Œä¸€ä¸ªJavaç±»ä¸­å®šä¹‰çš„å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯ç”±å¸¸é‡æ± æ¥ç»´æŠ¤å’Œæè¿°çš„ï¼Œå¯ä»¥å°†å¸¸é‡æ± çœ‹ä½œClassæ–‡ä»¶çš„èµ„æºä»“åº“ï¼Œæ¯”å¦‚è¯´Javaç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’Œå˜é‡ä¿¡æ¯ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œå¸¸é‡æ± ä¸­ä¸»è¦å­˜å‚¨çš„ä¸¤ç±»å¸¸é‡ï¼š</p><ul><li><strong>å­—é¢é‡ï¼š</strong> æ–‡æœ¬å­—ç¬¦ä¸²ï¼ŒJavaä¸­å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰</li><li><strong>ç¬¦å·å¼•ç”¨ï¼š</strong>ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼Œå­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼Œæ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ç­‰</li></ul><blockquote><p>å…³äºç¬¦å·å¼•ç”¨ï¼Œå…¶å®åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰ä»‹ç»è¿‡ï¼ŒJavaä»£ç åœ¨ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸åƒC++/Cä¸€æ ·æœ‰è¿æ¥çš„æ­¥éª¤ï¼Œè€Œæ˜¯åœ¨è™šæ‹ŸæœºåŠ è½½Classæ–‡ä»¶çš„æ—¶å€™è¿›è¡Œ<strong>åŠ¨æ€é“¾æ¥</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Classæ–‡ä»¶ä¸­ä¸ä¼šä¿å­˜å„ä¸ªæ–¹æ³•ï¼Œå­—æ®µçš„æœ€ç»ˆå†…å­˜å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤è¿™äº›å­—æ®µï¼Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ— æ³•ç›´æ¥è¢«è™šæ‹Ÿæœºä½¿ç”¨ï¼Œå½“è™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™ï¼Œéœ€è¦ä»å¸¸é‡æ± ä¸­è·å¾—å¯¹åº”å¾—ç¬¦å·å¼•ç”¨ï¼Œåœ¨ç±»åˆ›å»ºæˆ–è¿è¡Œå¾—æ—¶å€™è§£æï¼Œç¿»è¯‘åˆ°å…·ä½“çš„å†…å­˜åœ°å€ä¸­ã€‚</p></blockquote><h3 id="å¸¸é‡æ± é¡¹ç›®ç±»å‹"><a href="#å¸¸é‡æ± é¡¹ç›®ç±»å‹" class="headerlink" title="å¸¸é‡æ± é¡¹ç›®ç±»å‹"></a>å¸¸é‡æ± é¡¹ç›®ç±»å‹</h3><p>å¸¸é‡æ± çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼ŒJDK1.7ä¹‹å‰ä¸€å…±æœ‰11ç§<strong>ç»“æ„ä¸åŒ</strong>çš„è¡¨ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„11ç§ï¼ŒJDK1.7ä¹‹åä¸ºäº†æ›´å¥½çš„æ”¯æŒåŠ¨æ€è¯­è¨€çš„è°ƒç”¨ï¼Œåˆé¢å¤–çš„å¢åŠ äº†3ç§ï¼ˆCONSTANT_MethodHandle_infoï¼ŒCONSTANT_MethodType_infoï¼ŒCONSTANT_InvokeDynamic_infoï¼‰è¿™äº›è¡¨ç»“æ„éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œ<strong>è¡¨å¼€å§‹çš„ç¬¬ä¸€ä½éƒ½æ˜¯ä¸€ä¸ª<code>u1</code>ç±»å‹çš„æ ‡å¿—ä½<code>tag</code>ï¼Œç›®çš„å°±æ˜¯åŒºåˆ†è¿™ä¸ªå¸¸é‡å±äºé‚£ç§ç±»å‹çš„å¸¸é‡</strong>ï¼Œåé¢çš„å†…å®¹éƒ½å„æœ‰å„çš„ç»“æ„ï¼Œ<code>index</code>ä»£è¡¨çš„æ˜¯å¸¸é‡æ± ä¸­çš„å¯¹åº”çš„å¸¸é‡ç´¢å¼•ï¼Œ<code>bytes</code>ä»£è¡¨çš„å°±æ˜¯å­—èŠ‚æ•°æ®</p><h3 id="cp-info"><a href="#cp-info" class="headerlink" title="cp_info"></a>cp_info</h3><p><img alt="å¸¸é‡æ± è¡¨ç»“æ„" data-src="http://static.imlgw.top/blog/20190829/vjjWxwvrt0qg.png" src="/img/loading.gif" class="lazyload"></p><p>è¿™å¼ è¡¨ä¸Šçš„æ•°æ®ä¸ç”¨è®°ä½ï¼Œç”¨çš„æ—¶å€™çŸ¥é“å»å“ªé‡ŒæŸ¥å°±è¡Œäº†ï¼ˆè™½ç„¶ç”¨çš„æœºä¼šå¾ˆå°‘ğŸ˜‚ï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬ç¼–è¯‘ä¸€æ®µä»£ç ï¼Œçœ‹ä¸€ä¸‹å­—èŠ‚ç é•¿å•¥æ ·</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a=<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getA</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setA</span><span class="params">(<span class="keyword">int</span> a)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.a=a;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ¯<strong>ç¼–è¯‘å®Œæˆåç”¨16è¿›åˆ¶çš„ç¼–è¯‘å™¨(winHex)æ‰“å¼€Classæ–‡ä»¶</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190901/EOnrpm9sx8wE.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>âš¡ è¿™é‡Œå‰é¢çš„4ä¸ªå­—èŠ‚<code>0xCAFEBABE</code> ä»£è¡¨çš„å°±æ˜¯é­”æ•°ï¼Œåé¢çš„4ä¸ªå­—èŠ‚<code>0x00000034</code>ä»£è¡¨çš„å°±æ˜¯ç‰ˆæœ¬å·ï¼Œå†å¾€å2ä¸ªå­—èŠ‚<code>0x0018</code>å°±æ˜¯å¸¸é‡æ± çš„å…¥å£ï¼Œå¯¹åº”çš„å°±æ˜¯å¸¸é‡æ± çš„å¤§å°ï¼ˆconstant_pool_countï¼‰ï¼Œè½¬æ¢ä¸º10è¿›åˆ¶å°±æ˜¯24ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸æ˜¯24ä¸ªï¼Œå¸¸é‡æ± è®¡æ•°æ˜¯ä»1è€Œä¸æ˜¯0å¼€å§‹çš„ï¼Œè®¾è®¡è€…å°†0ä½ç½®çš„é¡¹ç©ºå‡ºæ¥ç›®çš„æ˜¯ä¸ºäº†è¡¨ç¤ºåé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹è¡¨ç¤º<strong>ä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®</strong>ï¼ˆå¤§å¸ˆå°±æ˜¯å¤§å¸ˆï¼Œå„ç§ç»†èŠ‚éƒ½èƒ½è€ƒè™‘åˆ°ï¼‰</p><p>âš¡ å†å¾€åçœ‹ï¼Œ<code>0x0A</code>ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„<code>tag</code>æ ‡å¿—ä½ï¼Œè½¬æ¢ä¸º10è¿›åˆ¶å°±æ˜¯<code>10</code> ï¼ŒæŸ¥ä¸€ä¸‹è¡¨å¯¹åº”çš„å¸¸é‡ç±»å‹æ˜¯<code>CONSTANT_Methodref_info</code>ï¼Œç´§è·Ÿç€çš„ä¸¤ä¸ªå­—èŠ‚<code>0x0004</code>æ˜¯ä¸€ä¸ª<code>index</code>ç±»å‹çš„æ•°æ®ï¼ŒæŒ‡å‘å£°æ˜æ–¹æ³•æè¿°ç¬¦<code>CONSTANT_Class_info</code> çš„ç´¢å¼•é¡¹ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± çš„ç¬¬4é¡¹ï¼Œå†å¾€åä¸¤ä¸ªå­—èŠ‚<code>0x0014</code>ä»£è¡¨çš„å°±æ˜¯æŒ‡å‘ç±»å‹æè¿°ç¬¦<code>CONSTANT_NameAndType</code>çš„ç´¢å¼•é¡¹ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± çš„ç¬¬20é¡¹</p><p>è¿™é‡Œæˆ‘ä»¬å°±ä¸ä¸€ä¸€çš„å»åˆ†æäº†ï¼Œæˆ‘ä»¬å€ŸåŠ©<code>javap</code> æ¥çœ‹çœ‹åç¼–è¯‘çš„ç»“æœå’Œæˆ‘ä»¬åˆ†æçš„æ˜¯ä¸æ˜¯ä¸€è‡´çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Last modified <span class="number">2019</span>-<span class="number">9</span>-<span class="number">1</span>; size <span class="number">485</span> bytes</span><br><span class="line">  MD5 checksum e8148a01ff25087c42827d62a9b827b0</span><br><span class="line">  Compiled from <span class="string">"Test1.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">jvmstudy</span>.<span class="title">classfile_stu</span>.<span class="title">Test1</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #4.#20         // java/lang/Object."<init>":()V</init></span><br><span class="line">   #2 = Fieldref           #3.#21         // jvmstudy/classfile_stu/Test1.a:I</span><br><span class="line">   #3 = Class              #22            // jvmstudy/classfile_stu/Test1</span><br><span class="line">   #4 = Class              #23            // java/lang/Object</span><br><span class="line">   #5 = Utf8               a</span><br><span class="line">   #6 = Utf8               I</span><br><span class="line">   #7 = Utf8               <init></init></span><br><span class="line">   #8 = Utf8               ()V</span><br><span class="line">   #9 = Utf8               Code</span><br><span class="line">  #10 = Utf8               LineNumberTable</span><br><span class="line">  #11 = Utf8               LocalVariableTable</span><br><span class="line">  #12 = Utf8               this</span><br><span class="line">  #13 = Utf8               Ljvmstudy/classfile_stu/Test1;</span><br><span class="line">  #14 = Utf8               getA</span><br><span class="line">  #15 = Utf8               ()I</span><br><span class="line">  #16 = Utf8               setA</span><br><span class="line">  #17 = Utf8               (I)V</span><br><span class="line">  #18 = Utf8               SourceFile</span><br><span class="line">  #19 = Utf8               Test1.java</span><br><span class="line">  #20 = NameAndType        #7:#8          // "<init>":()V</init></span><br><span class="line">  #21 = NameAndType        #5:#6          // a:I</span><br><span class="line">  #22 = Utf8               jvmstudy/classfile_stu/Test1</span><br><span class="line">  #23 = Utf8               java/lang/Object</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">public</span> jvmstudy.classfile_stu.Test1();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."<init>":()V</init></span><br><span class="line">         <span class="number">4</span>: aload_0</span><br><span class="line">         <span class="number">5</span>: iconst_1</span><br><span class="line">         6: putfield      #2                  // Field a:I</span><br><span class="line">         <span class="number">9</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">4</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">10</span>     <span class="number">0</span>  <span class="keyword">this</span>   Ljvmstudy/classfile_stu/Test1;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getA</span><span class="params">()</span></span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: getfield      #2                  // Field a:I</span><br><span class="line">         <span class="number">4</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Ljvmstudy/classfile_stu/Test1;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setA</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    descriptor: (I)V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">2</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: iload_1</span><br><span class="line">         2: putfield      #2                  // Field a:I</span><br><span class="line">         <span class="number">5</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">16</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">5</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">6</span>     <span class="number">0</span>  <span class="keyword">this</span>   Ljvmstudy/classfile_stu/Test1;</span><br><span class="line">            <span class="number">0</span>       <span class="number">6</span>     <span class="number">1</span>     a   I</span><br><span class="line">}</span><br><span class="line">SourceFile: <span class="string">"Test1.java"</span></span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬åˆ†æç»“æœæ˜¯ä¸€è‡´çš„ï¼Œé‚£è¿™ä¸ª<code>Methodref</code>æ˜¯è¡¨ç¤ºçš„é‚£ä¸ªæ–¹æ³•å‘¢ï¼Ÿå…¶å®æ ¹æ®åç¼–è¯‘çš„ç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æˆ‘ä»¬é»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•</p><h2 id="è®¿é—®æ ‡å¿—"><a href="#è®¿é—®æ ‡å¿—" class="headerlink" title="è®¿é—®æ ‡å¿—"></a>è®¿é—®æ ‡å¿—</h2><table><thead><tr><th>æ ‡å¿—åç§°</th><th>æ ‡å¿—å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x00 01</td><td>æ˜¯å¦ä¸ºPublicç±»å‹</td></tr><tr><td>ACC_FINAL</td><td>0x00 10</td><td>æ˜¯å¦è¢«å£°æ˜ä¸ºfinalï¼Œåªæœ‰ç±»å¯ä»¥è®¾ç½®</td></tr><tr><td>ACC_SUPER</td><td>0x00 20</td><td>æ˜¯å¦å…è®¸ä½¿ç”¨invokespecialå­—èŠ‚ç æŒ‡ä»¤çš„æ–°è¯­ä¹‰ï¼jdk1.0.2ä¹‹åéƒ½ä¸ºçœŸ</td></tr><tr><td>ACC_INTERFACE</td><td>0x02 00</td><td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ¥å£</td></tr><tr><td>ACC_ABSTRACT</td><td>0x04 00</td><td>æ˜¯å¦ä¸ºabstractç±»å‹ï¼Œå¯¹äºæ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥è¯´ï¼Œæ¬¡æ ‡å¿—å€¼ä¸ºçœŸï¼Œå…¶ä»–ç±»å‹ä¸ºå‡</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x10 00</td><td>æ ‡å¿—è¿™ä¸ªç±»å¹¶éç”±ç”¨æˆ·ä»£ç äº§ç”Ÿ</td></tr><tr><td>ACC_ANNOTATION</td><td>0x20 00</td><td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ³¨è§£</td></tr><tr><td>ACC_ENUM</td><td>ï¼x40 00</td><td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæšä¸¾</td></tr></tbody></table><p>åœ¨å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„<strong>ä¸¤ä¸ªå­—èŠ‚</strong>ä»£è¡¨è®¿é—®æ ‡å¿—ï¼ˆ<code>access_flags</code>ï¼‰ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ç±»æˆ–æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ªClassæ˜¯æ¥å£è¿˜æ˜¯æ–¹æ³•?æ˜¯å¦å®šä¹‰ä¸ºpublicç±»å‹ï¼Ÿæ˜¯å¦å®šä¹‰ä¸ºabstractï¼Ÿç­‰ï¼Œä¸¤ä¸ªå­—èŠ‚16ä¸ªæ ‡å¿—ä½ï¼Œå¯ä»¥è¡¨ç¤º2^16ç§çŠ¶æ€ï¼Œä½†æ˜¯å½“å‰åªå®šä¹‰äº†8ä¸ªæ ‡å¿—ä½æ²¡æœ‰ä½¿ç”¨åˆ°çš„ä¸€å¾‹è¦æ±‚ä¸º0</p><p>è¿˜æ˜¯å‚è€ƒä¸Šé¢çš„å­—èŠ‚ç ï¼Œå¸¸é‡æ± æ˜¯å›¾ä¸­ä»<code>0A~74</code> çš„ç´«è‰²éƒ¨åˆ†ï¼Œç´§è·Ÿç€åé¢çš„ä¸¤ä¸ªå­—èŠ‚<code>0x0021</code>å¯¹åº”çš„å°±æ˜¯è®¿é—®æ ‡å¿—ä½ï¼Œä¹Ÿå°±æ˜¯ <code>ACC_PUBLIC | ACC_SUPER</code> çš„å€¼</p><h2 id="ç±»ç´¢å¼•ï¼Œçˆ¶ç±»ç´¢å¼•æ¥å£ç´¢å¼•é›†åˆ"><a href="#ç±»ç´¢å¼•ï¼Œçˆ¶ç±»ç´¢å¼•æ¥å£ç´¢å¼•é›†åˆ" class="headerlink" title="ç±»ç´¢å¼•ï¼Œçˆ¶ç±»ç´¢å¼•æ¥å£ç´¢å¼•é›†åˆ"></a>ç±»ç´¢å¼•ï¼Œçˆ¶ç±»ç´¢å¼•æ¥å£ç´¢å¼•é›†åˆ</h2><p>ç±»ç´¢å¼•(<code>this_class</code>)å’Œçˆ¶ç±»ç´¢å¼•(<code>super_class</code>)éƒ½æ˜¯ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼Œè€Œæ¥å£ç´¢å¼•é›†åˆ(<code>interfaces</code>)æ˜¯ä¸€ç»„<code>u2</code> ç±»å‹çš„<strong>æ•°æ®çš„é›†åˆ</strong>ï¼ŒClassæ–‡ä»¶ä¸­ç”±è¿™ä¸‰é¡¹æ•°æ®æ¥è¡¨ç¤ºè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»</p><p>ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œçˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåï¼Œç”±äºJavaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Objectå¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º0ã€‚æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰implementsè¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯extendsè¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</p><p>ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥æ—¥ç´¢å¼•é›†åˆéƒ½æŒ‰é¡ºåºæ’åˆ—åœ¨è®¿é—®æ ‡å¿—ä¹‹åï¼Œç±»ç´¢å¼•å’Œçˆ¶ç±»ç´¢å¼•ç”¨ä¸¤ä¸ªu2ç±»å‹çš„ç´¢å¼•å€¼è¡¨ç¤ºï¼Œå®ƒä»¬å„è‡ªæŒ‡å‘ä¸€ä¸ªç±»å‹ä¸º<code>CONSTANT_Class_info</code>çš„ç±»æè¿°ç¬¦å¸¸é‡ï¼Œé€šè¿‡<code>CONSTANT_Class_info</code>ç±»å‹çš„å¸¸é‡ä¸­çš„ç´¢å¼•å€¼ä»¥æ‰¾åˆ°å®šä¹‰åœ¨<code>CONSTANT_Utf8_info</code>ç±»å‹çš„å¸¸é‡ä¸­çš„å…¨é™å®šåå­—ç¬¦ä¸²</p><p>æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„å­—èŠ‚ç æ–‡ä»¶åˆ†æï¼Œç´§æ¥ç€è®¿é—®æ ‡å¿—ç¬¦åé¢çš„u2æ˜¯<code>0x0003</code> ä¹Ÿå°±æ˜¯<code>this_class</code>åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•ï¼Œå†å¾€åçš„<code>0x0004</code>å¯¹åº”çš„å°±æ˜¯<code>super_class</code>åœ¨å¸¸é‡æ± çš„ç´¢å¼•<code>0x0000</code> è¯´æ˜æ²¡æœ‰çˆ¶æ¥å£ï¼Œåé¢çš„é›†åˆä¹Ÿå°±æ²¡æœ‰äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #4.#20         // java/lang/Object."<init>":()V</init></span><br><span class="line">   #2 = Fieldref           #3.#21         // jvmstudy/classfile_stu/Test1.a:I</span><br><span class="line">   #3 = Class              #22            // jvmstudy/classfile_stu/Test1</span><br><span class="line">   #4 = Class              #23            // java/lang/Object</span><br><span class="line">   #5 = Utf8               a</span><br><span class="line">   #6 = Utf8               I</span><br><span class="line">   #7 = Utf8               <init></init></span><br><span class="line">   #8 = Utf8               ()V</span><br><span class="line">   #9 = Utf8               Code</span><br><span class="line">  #10 = Utf8               LineNumberTable</span><br><span class="line">  #11 = Utf8               LocalVariableTable</span><br><span class="line">  #12 = Utf8               this</span><br><span class="line">  #13 = Utf8               Ljvmstudy/classfile_stu/Test1;</span><br><span class="line">  #14 = Utf8               getA</span><br><span class="line">  #15 = Utf8               ()I</span><br><span class="line">  #16 = Utf8               setA</span><br><span class="line">  #17 = Utf8               (I)V</span><br><span class="line">  #18 = Utf8               SourceFile</span><br><span class="line">  #19 = Utf8               Test1.java</span><br><span class="line">  #20 = NameAndType        #7:#8          // "<init>":()V</init></span><br><span class="line">  #21 = NameAndType        #5:#6          // a:I</span><br><span class="line">  #22 = Utf8               jvmstudy/classfile_stu/Test1</span><br><span class="line">  #23 = Utf8               java/lang/Object</span><br></pre></td></tr></tbody></table></figure></div><p>ç»“åˆåç¼–è¯‘çš„ç»“æœï¼Œå¸¸é‡æ± ç¬¬ä¸‰é¡¹å’Œç¬¬å››é¡¹éƒ½å¯¹åº”äº†ä¸€ä¸ª<code>CONSTANT_Class_info</code>çš„ç´¢å¼•å¸¸é‡ï¼Œå…¶æœ€ç»ˆæŒ‡å‘äº†ä¸€ä¸ª<code>CONSTANT_Utf8_info</code> çš„å¸¸é‡ï¼Œè¿™ä¸ªå¸¸é‡çš„å€¼å°±æ˜¯æˆ‘ä»¬çš„<code>this_class</code>å’Œ<code>super_class</code> çš„å…¨é™å®šå</p><h2 id="å­—æ®µè¡¨é›†åˆ"><a href="#å­—æ®µè¡¨é›†åˆ" class="headerlink" title="å­—æ®µè¡¨é›†åˆ"></a>å­—æ®µè¡¨é›†åˆ</h2><p>ç´§è·Ÿç€ä¸Šé¢ç±»ç´¢å¼•ç­‰ä¿¡æ¯åé¢çš„<code>u2</code>ç±»å‹çš„æ•°æ®<code>0x0001</code>å°±æ˜¯ä»£è¡¨çš„<code>fields_count</code>ï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ªå­—æ®µaæ‰€ä»¥è¿™é‡Œæ˜¯<code>1</code></p><h3 id="field-info"><a href="#field-info" class="headerlink" title="field_info"></a>field_info</h3><p>å­—æ®µè¡¨ï¼ˆ<code>field_info</code>ï¼‰ç”¨äºæè¿°æ¥å£æˆ–è€…ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚å­—æ®µï¼ˆ<code>field</code>ï¼‰åŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬åœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡</p><p>å­—æ®µçš„å„ç§ä¿®é¥°ç¬¦å…¶å®éƒ½æ˜¯ä¸ªå¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰è¦ä¹ˆæ²¡æœ‰ï¼Œæ‰€ä»¥å¾ˆå¥½è¡¨ç¤ºé€‚åˆç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºï¼Œä½†æ˜¯å­—æ®µçš„ç±»å‹ï¼Œåå­—è¿™äº›å°±å¾ˆéš¾å›ºå®š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>access_flags</td><td>1</td></tr><tr><td>u2</td><td>name_index</td><td>1</td></tr><tr><td>u2</td><td>descriptor_index</td><td>1</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attributes_count</td></tr></tbody></table><p>å‰ä¸‰é¡¹åˆ†åˆ«ä»£è¡¨ï¼Œè®¿é—®ä¿®é¥°ç¬¦ï¼Œåå­—çš„ç´¢å¼•ä»¥åŠ_æè¿°ç¬¦_ï¼ˆ<strong>å¯¹å­—æ®µæ¥è¯´å°±æ˜¯å­—æ®µçš„ç±»å‹</strong>ï¼‰çš„ç´¢å¼•ï¼Œè¿™ä¸‰é¡¹å°±å¯ä»¥æ„æˆä¸€ä¸ªå­—æ®µçš„å®Œæ•´çš„ä¿¡æ¯äº†ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹çœ‹çš„ä¹Ÿæ˜¯å‰ä¸‰é¡¹çš„ä¿¡æ¯ï¼Œå­—æ®µä¿®é¥°ç¬¦<code>access_flags</code>å…¶å®å’Œç±»ä¸­çš„<code>access_flags</code> ç±»ä¼¼ï¼Œåªä¸è¿‡å¯ä»¥è®¾ç½®çš„ä¿®é¥°ç¬¦ä¸å¤ªä¸€æ ·</p><p><strong>å­—æ®µè®¿é—®æ ‡å¿—</strong></p><table><thead><tr><th>æ ‡å¿—åç§°</th><th>æ ‡å¿—å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>å­—æ®µæ˜¯å¦public</td></tr><tr><td>ACC_PRIVATE</td><td>0x0002</td><td>å­—æ®µæ˜¯å¦private</td></tr><tr><td>ACC_PROTECTED</td><td>0x0004</td><td>å­—æ®µæ˜¯å¦protected</td></tr><tr><td>ACC_STATIC</td><td>0x0008</td><td>å­—æ®µæ˜¯å¦static</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>å­—æ®µæ˜¯å¦final</td></tr><tr><td>ACC_VOLATILE</td><td>0x0040</td><td>å­—æ®µæ˜¯å¦volatile</td></tr><tr><td>ACC_TRANSIENT</td><td>0x0080</td><td>å­—æ®µæ˜¯å¦transient</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x1000</td><td>å­—æ®µæ˜¯å¦ç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿçš„</td></tr><tr><td>ACC_ENUM</td><td>0x4000</td><td>å­—æ®µæ˜¯å¦enum</td></tr></tbody></table><p>ğŸ¯<strong>ç»§ç»­æ¥ç€ä¸Šé¢çš„ç±»ç´¢å¼•åˆ†æ</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190902/s5dWhYXNIuxq.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>âš¡<code>0x0001</code> å¯¹åº”<code>fields_count</code>ï¼Œå€¼ä¸º1å­—æ®µçš„æ•°é‡ä¸º 1ï¼Œåé¢çš„<code>field_info</code>æ•°é‡ä¸º1</p><p>âš¡<code>0x0002</code> å¯¹åº”å­—æ®µçš„<code>access_flags</code>ï¼Œä¸º<code>ACC_PRIVATE</code></p><p>âš¡<code>0x0005</code> å¯¹åº”å­—æ®µçš„åå­—çš„ç´¢å¼•ï¼Œåœ¨å¸¸é‡æ± ä¸­çš„ç¬¬5é¡¹ï¼Œç»“åˆä¸Šé¢åç¼–è¯‘çš„ç»“æœç¬¬5é¡¹ä¸º  <code>#5 = Utf8    a</code></p><p>âš¡<code>0x0006</code> å¯¹åº”å­—æ®µçš„æè¿°ç¬¦ç´¢å¼•ï¼Œåœ¨å¸¸é‡æ± ä¸­ç¬¬6é¡¹ï¼Œä¸º<code>#6 = Utf8   I</code></p><p>åˆ°è¿™é‡Œå…¶å®æˆ‘ä»¬å°±å¯ä»¥æ¨æ–­å‡ºè¿™ä¸ªå˜é‡çš„å®šä¹‰ä¸º <code>private int a</code></p><blockquote><p>å­—æ®µè¡¨é›†åˆä¸­ä¸ä¼šåˆ—å‡ºä»è¶…ç±»æˆ–è€…çˆ¶æ¥å£ä¸­ç»§æ‰¿è€Œæ¥çš„å­—æ®µï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šåˆ—å‡ºåŸæœ¬Javaä»£ç ä¸­æ²¡æœ‰çš„å­—æ®µï¼Œæ¯”å¦‚å†…éƒ¨ç±»ä¸­è‡ªåŠ¨æ·»åŠ æŒ‡å‘å¤–éƒ¨ç±»çš„å­—æ®µã€‚ä»æ‰€å‘¨çŸ¥ï¼Œåœ¨<strong>Java</strong>ä¸­å­—æ®µæ˜¯ä¸èƒ½é‡è½½çš„ï¼Œåªè¦ä¸¤ä¸ªå­—æ®µçš„åå­—æ˜¯ä¸èƒ½ä¸€æ ·çš„ï¼Œå¿…é¡»ä½¿ç”¨ä¸åŒçš„åç§°ï¼Œæ³¨æ„ï¼Œè¿™æ˜¯<strong>Javaçš„è¯­è¨€è§„èŒƒ</strong>ï¼Œå…¶å®åœ¨Classå­—èŠ‚ç æ¥è®²ï¼Œåªè¦ä¸¤ä¸ªå­—æ®µçš„æè¿°ç¬¦ä¸ä¸€æ ·ï¼Œé‡åå°±æ˜¯åˆæ³•çš„ã€‚</p></blockquote><p>å†å¾€åä¸¤ä¸ªå­—èŠ‚<code>0x0000</code>ä»£è¡¨<code>attributes_count</code>ï¼Œå…¶å€¼ä¸º0æ‰€ä»¥åé¢çš„å±æ€§è¡¨å°±æ²¡æœ‰äº†ï¼Œå¦‚æœè¿™é‡Œå°†å­—æ®µæ”¹ä¸º<code>static final int a</code> é‚£ä¹ˆ<code>attributes_count</code> å°†ä¸º1ï¼Œåé¢ä¼šå¤šå‡ºä¸€æ¡æŒ‡å‘å¸¸é‡æ± <code>ConstantValue</code>æ•°æ®çš„index(ä¸‹æ–‡ä¼šæ¼”ç¤º)</p><h2 id="æ–¹æ³•è¡¨é›†åˆ"><a href="#æ–¹æ³•è¡¨é›†åˆ" class="headerlink" title="æ–¹æ³•è¡¨é›†åˆ"></a>æ–¹æ³•è¡¨é›†åˆ</h2><p>ç´§è·Ÿç€å­—æ®µè¡¨ä¹‹åçš„u2ç±»å‹çš„æ•°æ® <code>0x0003</code>ä»£è¡¨çš„å°±æ˜¯<code>method_count</code> ï¼Œå€¼ä¸º3ä»£è¡¨æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œé¢åŒ…å«äº†JVMè‡ªåŠ¨ç”Ÿæˆçš„é»˜è®¤æ— å‚æ•°æ„é€ å™¨æ–¹æ³•ï¼Œæ‰€ä»¥æ˜¯3ä¸ª</p><h3 id="method-info"><a href="#method-info" class="headerlink" title="method_info"></a>method_info</h3><p>æ–¹æ³•è¡¨çš„ç»“æ„å…¶å®å’Œå­—æ®µè¡¨çš„ç»“æ„æ˜¯ä¸€æ ·çš„</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>access_flags</td><td>1</td></tr><tr><td>u2</td><td>name_index</td><td>1</td></tr><tr><td>u2</td><td>descriptor_index</td><td>1</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attributes_count</td></tr></tbody></table><p>ä½†æ˜¯å…·ä½“çš„<code>access_flags</code> å’Œ<code>attributes</code>é›†åˆä¸å¤ªä¸€æ ·</p><p><strong>æ–¹æ³•è®¿é—®æ ‡å¿—</strong></p><table><thead><tr><th>æ ‡å¿—åç§°</th><th>æ ‡å¿—å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x00 01</td><td>æ–¹æ³•æ˜¯å¦ä¸ºpublic</td></tr><tr><td>ACC_PRIVATE</td><td>0x00 02</td><td>æ–¹æ³•æ˜¯å¦ä¸ºprivate</td></tr><tr><td>ACC_PROTECTED</td><td>0x00 04</td><td>æ–¹æ³•æ˜¯å¦ä¸ºprotected</td></tr><tr><td>ACC_STATIC</td><td>0x00 08</td><td>æ–¹æ³•æ˜¯å¦ä¸ºstatic</td></tr><tr><td>ACC_FINAL</td><td>0x00 10</td><td>æ–¹æ³•æ˜¯å¦ä¸ºfinal</td></tr><tr><td>ACC_SYHCHRONRIZED</td><td>0x00 20</td><td>æ–¹æ³•æ˜¯å¦ä¸ºsynchronized</td></tr><tr><td>ACC_BRIDGE</td><td>0x00 40</td><td>æ–¹æ³•æ˜¯å¦æ˜¯ç”±ç¼–è¯‘å™¨äº§ç”Ÿçš„æ¡¥æ¥æ–¹æ³•</td></tr><tr><td>ACC_VARARGS</td><td>0x00 80</td><td>æ–¹æ³•æ˜¯å¦æ¥å—å‚æ•°</td></tr><tr><td>ACC_NATIVE</td><td>0x01 00</td><td>æ–¹æ³•æ˜¯å¦ä¸ºnative</td></tr><tr><td>ACC_ABSTRACT</td><td>0x04 00</td><td>æ–¹æ³•æ˜¯å¦ä¸ºabstract</td></tr><tr><td>ACC_STRICTFP</td><td>0x08 00</td><td>æ–¹æ³•æ˜¯å¦ä¸ºstrictfp</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x10 00</td><td>æ–¹æ³•æ˜¯å¦æ˜¯æœ‰ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿçš„</td></tr></tbody></table><p>ğŸ¯<strong>æˆ‘ä»¬ç»§ç»­æ¥ç€ä¸Šé¢çš„å­—æ®µè¡¨åé¢åˆ†æ</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190902/BuNVfOyD3mJy.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>âš¡<code>0x0003</code> æ–¹æ³•è¡¨çš„å…¥å£ï¼Œä»£è¡¨<code>methods_count</code> æ–¹æ³•çš„æ•°é‡ï¼Œå€¼ä¸º3ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼ˆåŒ…æ‹¬äº†ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„<code><init></init></code>æ–¹æ³•ï¼‰</p><p>âš¡ <code>0x0001</code> ç¬¬ä¸€ä¸ªæ–¹æ³•çš„è®¿é—®æ ‡å¿—å€¼ï¼Œä»£è¡¨<code>ACC_PUBLIC</code></p><p>âš¡ <code>0x0007</code> æ–¹æ³•åçš„<code>name_index</code>ï¼Œå€¼ä¸º7ä»£è¡¨å¸¸é‡æ± ä¸­ç¬¬7é¡¹å¸¸é‡ï¼Œç»“åˆåç¼–è¯‘çš„ç»“æœå…¶å€¼ä¸º</p><p><code>#7 = Utf8  <init></init></code>  ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å®ä¾‹æ„é€ æ–¹æ³•ï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆçš„ï¼‰</p><p>âš¡ <code>0x0008</code> æ–¹æ³•æè¿°ç¬¦çš„<code>descriptor_index</code> ï¼Œå€¼ä¸º8ä»£è¡¨å¸¸é‡æ± ä¸­ç¬¬8é¡¹å¸¸é‡ï¼Œå…¶å€¼ä¸º</p><p><code>#8 = Utf8  ()V</code>  è‡ªåŠ¨ç”Ÿæˆçš„æ— å‚æ„é€ å™¨çš„æè¿°</p><p>âš¡ <code>0x0001</code> æ–¹æ³•å±æ€§è¡¨(<code>attribute_info</code>)çš„å…¥å£ï¼Œä»£è¡¨<code>attributes_count</code> ï¼Œå€¼ä¸º1ä»£è¡¨æœ‰ä¸€ä¸ªå±æ€§è¡¨</p><p>âš¡ <code>0x0009</code> å±æ€§åç§°çš„ç´¢å¼•ï¼Œå¸¸é‡æ± ä¸­ä¸º <code>#9 = Utf8   Code</code>è¯´æ˜æ­¤å±æ€§æ˜¯æ–¹æ³•çš„å­—èŠ‚ç æè¿°ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•ä¸­çš„ä»£ç </p><blockquote><p>åœ¨æ–¹æ³•è¡¨ä¸­ï¼Œå¦‚æœå­ç±»æ²¡æœ‰é‡å†™çˆ¶ç±»çš„æ–¹æ³•å°±ä¸ä¼šå‡ºç°çˆ¶ç±»çš„æ–¹æ³•ä¿¡æ¯ï¼Œä½†æ˜¯ä¼šå‡ºç°ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ çš„æ–¹æ³•ï¼Œæœ€å…¸å‹çš„å°±æ˜¯<code><clinit></clinit></code>å’Œ<code><init></init></code>ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ é™æ€å˜é‡çš„èµ‹å€¼å’Œé™æ€è¯­å¥å—æ‰€ä»¥å¹¶æ²¡æœ‰ç”Ÿæˆ<code><clinit></clinit></code> æ–¹æ³•ï¼Œå¦å¤–ä¸€ç‚¹å’Œä¸Šé¢å­—æ®µè¡¨çš„ä¸€æ ·ï¼ŒJavaè¯­è¨€ä¸­é‡è½½æ˜¯ä¸èƒ½ä»¥è¿”å›å€¼æ¥ç•Œå®šçš„ï¼Œä½†æ˜¯åœ¨Classæ–‡ä»¶æ ¼å¼ä¸­ï¼Œåªè¦æè¿°ç¬¦ä¸ä¸€è‡´ï¼Œå°±æ˜¯å¯ä»¥å…±å­˜çš„ï¼Œè€Œæ–¹æ³•çš„æè¿°ç¬¦å°±åŒ…æ‹¬äº†å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼</p></blockquote><h2 id="å±æ€§è¡¨é›†åˆ"><a href="#å±æ€§è¡¨é›†åˆ" class="headerlink" title="å±æ€§è¡¨é›†åˆ"></a>å±æ€§è¡¨é›†åˆ</h2><p>å±æ€§è¡¨ï¼ˆattribute_infoï¼‰ï¼ŒClassæ–‡ä»¶ï¼Œå­—æ®µè¡¨ï¼Œæ–¹æ³•è¡¨ä¸­å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨ï¼Œè¯´æœ‰attribute_infoçš„å‰ä¸¤é¡¹éƒ½æ˜¯u2ç±»å‹çš„<code>attribute_name_index</code>å’Œu4ç±»å‹çš„<code>attribute_length</code>åˆ†åˆ«ä»£è¡¨å±æ€§åå­—çš„ç´¢å¼•å’Œå±æ€§å€¼çš„å¤§å° ï¼ŒJavaè™šæ‹Ÿæœºä¸­é¢„å®šä¹‰äº†ä¸€äº›å±æ€§ï¼Œè¿™äº›å±æ€§éƒ½å„æœ‰å„çš„å«ä¹‰å’Œç»“æ„</p><table><thead><tr><th align="left">å±æ€§åç§°</th><th>ä½¿ç”¨ä½ç½®</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">Code</td><td>æ–¹æ³•è¡¨</td><td align="left">Java ä»£ç ç¼–è¯‘æˆçš„å­—èŠ‚ç æŒ‡ä»¤</td></tr><tr><td align="left">ConstantValue</td><td>å­—æ®µè¡¨</td><td align="left">final å…³é”®å­—å®šä¹‰çš„å¸¸é‡å€¼</td></tr><tr><td align="left">Deprecated</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td align="left">è¢«å£°æ˜ä¸º <code>deprecated</code> çš„æ–¹æ³•å’Œå­—æ®µ</td></tr><tr><td align="left">Exceptions</td><td>æ–¹æ³•è¡¨</td><td align="left">æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸</td></tr><tr><td align="left">EnclosingMethod</td><td>ç±»æ–‡ä»¶</td><td align="left">ä»…å½“ä¸€ä¸ªç±»ä¸ºå±€éƒ¨ç±»æˆ–åŒ¿åç±»æ—¶æ‰èƒ½æ‹¥æœ‰è¿™ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨äºæ ‡è¯†è¿™ä¸ªç±»æ‰€åœ¨çš„å¤–å›´æ–¹æ³•</td></tr><tr><td align="left">InnerClasses</td><td>ç±»æ–‡ä»¶</td><td align="left">å†…éƒ¨ç±»åˆ—è¡¨</td></tr><tr><td align="left">LineNumberTable</td><td>Code å±æ€§</td><td align="left">Java æºç çš„è¡Œå·ä¸å­—èŠ‚ç æŒ‡ä»¤çš„å¯¹åº”å…³ç³»</td></tr><tr><td align="left">LocalVariableTable</td><td>Code å±æ€§</td><td align="left">æ–¹æ³•çš„å±€éƒ¨å˜é‡æè¿°</td></tr><tr><td align="left">StackMapTable</td><td>Code å±æ€§</td><td align="left">JDK 6 æ–°å¢çš„å±æ€§ï¼Œä¾›æ–°çš„ç±»å‹æ£€æŸ¥éªŒè¯å™¨ï¼ˆType Checkerï¼‰æ£€æŸ¥å’Œå¤„ç†ç›®æ ‡æ–¹æ³•çš„å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æ ˆæ‰€éœ€è¦çš„ç±»å‹æ˜¯å¦åŒ¹é…</td></tr><tr><td align="left">Signature</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td align="left">JDK 5 æ–°å¢çš„å±æ€§ï¼Œç”¨äºæ”¯æŒæ³›å‹æƒ…å†µä¸‹çš„æ–¹æ³•ç­¾åï¼Œåœ¨ Java è¯­è¨€ä¸­ï¼Œä»»ä½•ç±»ã€æ¥å£ã€åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ï¼ˆType Variablesï¼‰æˆ–å‚æ•°åŒ–ç±»å‹ï¼ˆParameterized Typesï¼‰ï¼Œåˆ™ Signature å±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯ã€‚ç”±äº Java çš„æ³›å‹é‡‡ç”¨æ“¦é™¤æ³•å®ç°ï¼Œåœ¨ä¸ºäº†é¿å…ç±»å‹ä¿¡æ¯è¢«æ“¦é™¤åå¯¼è‡´ç­¾åæ··ä¹±ï¼Œéœ€è¦è¿™ä¸ªå±æ€§è®°å½•æ³›å‹ä¸­çš„ç›¸å…³ä¿¡æ¯</td></tr><tr><td align="left">SourceFile</td><td>ç±»æ–‡ä»¶</td><td align="left">è®°å½•æºæ–‡ä»¶åç§°</td></tr><tr><td align="left">SourceDebugExtension</td><td>ç±»æ–‡ä»¶</td><td align="left">JDK 6 æ–°å¢å±æ€§ï¼Œç”¨äºå­˜å‚¨é¢å¤–çš„è°ƒè¯•ä¿¡æ¯ã€‚è­¬å¦‚åœ¨è¿›è¡Œ JSP æ–‡ä»¶è°ƒè¯•æ—¶ï¼Œæ— æ³•é€šè¿‡ Java å †æ ˆæ¥å®šä½åˆ° JSP æ–‡ä»¶çš„è¡Œå·ï¼ŒJSR-45 è§„èŒƒä¸ºè¿™äº›é Java è¯­è¨€ç¼–å†™ï¼Œå´éœ€è¦ç¼–è¯‘æˆå­—èŠ‚ç å¹¶è¿è¡Œåœ¨ Java è™šæ‹Ÿæœºä¸­çš„ç¨‹åºæä¾›äº†ä¸€ä¸ªè¿›è¡Œè°ƒè¯•çš„æ ‡å‡†æœºåˆ¶ï¼Œä½¿ç”¨è¯¥å±æ€§å°±å¯ä»¥å­˜å‚¨è¿™ä¸ªæ ‡å‡†æ‰€æ–°åŠ å…¥çš„è°ƒè¯•ä¿¡æ¯</td></tr><tr><td align="left">Synthetic</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td align="left">è¡¨ç¤ºæ–¹æ³•æˆ–å­—æ®µæ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„</td></tr><tr><td align="left">LocalVariableTypeTable</td><td>ç±»</td><td align="left">JDK 5 æ–°å¢å±æ€§ï¼Œå®ƒä½¿ç”¨ç‰¹å¾ç­¾åä»£æ›¿æè¿°ç¬¦ï¼Œä¸ºäº†å¼•å…¥æ³›å‹è¯­æ³•ä¹‹åèƒ½æè¿°æ³›å‹å‚æ•°åŒ–ç±»å‹è€Œæ·»åŠ </td></tr><tr><td align="left">RuntimeVisibleAnnotations</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td align="left">JDK 5 æ–°å¢å±æ€§ï¼Œä¸ºåŠ¨æ€æ³¨è§£æä¾›æ”¯æŒã€‚è¯¥å±æ€§æŒ‡æ˜å“ªäº›æ³¨è§£æ˜¯è¿è¡Œæ—¶ï¼ˆå®é™…ä¸Šè¿è¡Œæ—¶å°±æ˜¯è¿›è¡Œåå°„è°ƒç”¨ï¼‰å¯è§çš„</td></tr><tr><td align="left">RuntimeInvisibleAnnotations</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td align="left">JDK 5 æ–°å¢å±æ€§ï¼Œä¸ <code>RuntimeVisibleAnnotations</code> ä½œç”¨ç›¸åï¼Œç”¨äºæŒ‡æ˜å“ªäº›æ³¨è§£è¿è¡Œæ—¶ä¸å¯è§</td></tr><tr><td align="left">RuntimeVisibleParameterAnnotations</td><td>æ–¹æ³•è¡¨</td><td align="left">JDK 5 æ–°å¢å±æ€§ï¼Œä½œç”¨ä¸ <code>RuntimeVisibleAnnotations</code> ä½œç”¨ç›¸ä¼¼ï¼Œåªä¸è¿‡ä½œç”¨å¯¹è±¡ä¸ºæ–¹æ³•å‚æ•°</td></tr><tr><td align="left">RuntimeInvisibleParameterAnnotations</td><td>æ–¹æ³•è¡¨</td><td align="left">JDK 5 æ–°å¢å±æ€§ï¼Œä½œç”¨ä¸ <code>RuntimeInvisibleAnnotations</code> ä½œç”¨ç›¸ä¼¼ï¼Œåªä¸è¿‡ä½œç”¨å¯¹è±¡ä¸ºæ–¹æ³•å‚æ•°</td></tr><tr><td align="left">AnnotationDefault</td><td>æ–¹æ³•è¡¨</td><td align="left">JDK 5 æ–°å¢å±æ€§ï¼Œç”¨äºè®°å½•æ³¨è§£ç±»å…ƒç´ çš„é»˜è®¤å€¼</td></tr><tr><td align="left">BootstrapMethods</td><td>ç±»æ–‡ä»¶</td><td align="left">JDK 7 æ–°å¢å±æ€§ï¼Œç”¨äºå­˜å‚¨ <code>invokedynamic</code> æŒ‡ä»¤å¼•ç”¨çš„å¼•å¯¼æ–¹æ³•é™å®šç¬¦</td></tr></tbody></table><h3 id="Codeå±æ€§"><a href="#Codeå±æ€§" class="headerlink" title="Codeå±æ€§"></a>Codeå±æ€§</h3><p>Javaç¨‹åºæ–¹æ³•ä½“ä¸­çš„ä»£ç ç»è¿‡Javacç¼–è¯‘å™¨å¤„ç†è¿‡åï¼Œæœ€ç»ˆå˜ä¸ºå­—èŠ‚ç æŒ‡ä»¤å­˜å‚¨åœ¨Codeå±æ€§å†…</p><p>Codeå±æ€§å‡ºç°åœ¨<strong>æ–¹æ³•è¡¨çš„å±æ€§é›†åˆ</strong>ä¸­ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰çš„æ–¹æ³•è¡¨éƒ½å¿…é¡»å­˜åœ¨è¿™ä¸ªCodeå±æ€§ï¼Œ<strong>åƒæ¥å£å’ŒæŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å°±ä¸å­˜åœ¨Codeå±æ€§</strong></p><p><strong>Codeå±æ€§ç»“æ„</strong></p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>max_stack</td><td>1</td></tr><tr><td>u2</td><td>max_locals</td><td>1</td></tr><tr><td>u4</td><td>code_length</td><td>1</td></tr><tr><td>u1</td><td>code</td><td>code_length</td></tr><tr><td>u2</td><td>exception_table_length</td><td>1</td></tr><tr><td>exception_info</td><td>exception_table</td><td>exception_table_length</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td></tr><tr><td>attributes_info</td><td>attributes</td><td>attributes_count</td></tr></tbody></table><p>ğŸ¯<strong>ç´§æ¥ç€ä¸Šé¢çš„æ–¹æ³•è¡¨åˆ†æ</strong></p><p><em>è¿™é‡Œåˆ†æçš„è¿˜æ˜¯æ–¹æ³•è¡¨ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼ˆ<code><init></init></code>ï¼‰æ‰€æºå¸¦çš„å±æ€§è¡¨</em></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190904/Gd5cWl6Yr84x.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>âš¡ <code>0x0009</code> å¯¹åº”<code>attribute_name_index</code>ï¼Œå±æ€§åç§°çš„ç´¢å¼•ï¼Œå¸¸é‡æ± ä¸­ä¸º <code>#9 = Utf8   Code</code>è¯´æ˜æ­¤å±æ€§æ˜¯æ–¹æ³•çš„å­—èŠ‚ç æè¿°ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•ä¸­çš„ä»£ç </p><p>âš¡ <code>0x00000038</code> ä»£è¡¨<code>attribute_length</code> é¡¾åæ€ä¹‰å°±æ˜¯å±æ€§å€¼çš„é•¿åº¦ï¼Œè¿™é‡Œæ˜¯56ï¼ˆä¸åŒ…å«attribute_name_indexå’Œattribute_lengthï¼‰</p><p>âš¡<code>0x0002</code>ä»£è¡¨<code>max_stack</code> æ“ä½œæ•°æ ˆï¼ˆOperand Stacksï¼‰æ·±åº¦çš„æœ€å¤§å€¼ï¼Œè™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™ä¼šæ ¹æ®è¿™ä¸ªå€¼æ¥åˆ†é…æ ˆå¸§ï¼ˆStackFrameï¼‰ä¸­çš„æ“ä½œæ ˆæ·±åº¦</p><p>âš¡<code>0x0001</code>ä»£è¡¨<code>max_locals</code> ä»£è¡¨äº†<strong>å±€éƒ¨å˜é‡è¡¨</strong>æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ï¼Œè¿™é‡Œçš„å†…å­˜åˆ†é…å•ä½æ˜¯<code>Slot</code></p><blockquote><p><code>Slot</code>æ˜¯è™šæ‹Ÿæœºä¸ºå±€éƒ¨å˜é‡åˆ†é…å†…å­˜æ‰€ä½¿ç”¨çš„æœ€å°å•ä½ï¼Œå¯¹äºbyteï¼Œcharï¼Œfloatï¼Œintï¼Œshortï¼Œbooleanç­‰é•¿åº¦ä¸è¶…è¿‡32ä½çš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸ªå±€éƒ¨å˜é‡å ç”¨ä¸€ä¸ª<code>Slot</code> ï¼Œä½†æ˜¯å¯¹äºdoubleå’Œlongç­‰64ä½çš„æ•°æ®ç±»å‹åˆ™éœ€è¦ä¸¤ä¸ª<code>Slot</code> </p><p>æ–¹æ³•å‚æ•°ï¼ˆåŒ…æ‹¬å®ä¾‹æ–¹æ³•ä¸­çš„thiså¼•ç”¨ï¼‰ï¼Œtrycatchè¯­å¥ä¸­catchä¸­å®šä¹‰çš„å¼‚å¸¸ï¼Œæ–¹æ³•ä½“ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ éƒ½éœ€è¦ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨æ¥å­˜æ”¾ï¼Œä½†æ˜¯æœ€åå¹¶ä¸æ˜¯æŠŠæ‰€æœ‰è¿™äº›å±€éƒ¨å˜é‡å ç”¨çš„<code>Slot</code>åŠ èµ·æ¥å°±æ˜¯<code>max_locals</code> å› ä¸º<strong>å±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotæ˜¯å¯ä»¥å¤ç”¨çš„</strong>ï¼Œå½“ä»£ç æ‰§è¡Œè¶…è¿‡ä¸€ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæ—¶ï¼Œè¿™ä¸ªå˜é‡å ç”¨çš„Slotå°±å¯ä»¥è¢«å…¶ä»–å±€éƒ¨å˜é‡æ‰€ä½¿ç”¨ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šæ ¹æ®ä½œç”¨åŸŸæ¥åˆ†é…<code>Slot</code> ç»™å„ä¸ªå±€éƒ¨å˜é‡ä½¿ç”¨</p></blockquote><p>âš¡<code>0x0000000A</code>u4ç±»å‹çš„<code>code_length</code> ä»£è¡¨çš„å°±æ˜¯å­—èŠ‚ç çš„é•¿åº¦ï¼Œè¿™é‡Œæ˜¯10ï¼Œè¯´æ˜åé¢æœ‰10ä¸ªå­—èŠ‚é•¿åº¦çš„å­—èŠ‚ç æŒ‡ä»¤æµ</p><p>âš¡u1ç±»å‹çš„<code>code</code> å°±æ˜¯å…·ä½“ç”¨å­—èŠ‚ç æŒ‡ä»¤ï¼Œæ¯ä¸ªæŒ‡ä»¤éƒ½æ˜¯ä¸€ä¸ªu1çš„å•å­—èŠ‚æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šæœ‰256ä¸ªæŒ‡ä»¤ï¼Œç›®å‰Javaè™šæ‹Ÿæœºå·²ç»å®šä¹‰äº†å…¶ä¸­çº¦200æ¡ç¼–ç å€¼å¯¹åº”çš„æŒ‡ä»¤ï¼Œè¿™é‡Œæœ‰è¿ç»­çš„10ä¸ªå•å­—èŠ‚æŒ‡ä»¤ï¼Œæ„æˆäº†<code><init></init></code>æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤</p><p>âš¡<code>0x0000</code>ä»£è¡¨<code>exception_table_length</code> å¼‚å¸¸è¡¨çš„é•¿åº¦ï¼Œè¿™é‡Œ<code><init></init></code>æ–¹æ³•æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºæ‰€ä»¥ä¸º0</p><p>âš¡ <code>exception_info</code>ç±»å‹çš„<code>exception_table</code> å¼‚å¸¸è¡¨ï¼Œå­˜æ”¾å¤„ç†å¼‚å¸¸çš„ä¿¡æ¯ï¼ˆtry-catchä¸­çš„å¼‚å¸¸ï¼‰ï¼Œå‰é¢çš„é•¿åº¦ä¸º0æ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨è¿™ä¸€é¡¹æ•°æ®</p><p><strong>å¼‚å¸¸è¡¨ç»“æ„</strong></p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>start_pc</td><td>1</td></tr><tr><td>u2</td><td>end_pc</td><td>1</td></tr><tr><td>u2</td><td>handler_pc</td><td>1</td></tr><tr><td>u2</td><td>catch_type</td><td>1</td></tr></tbody></table><p>æ¯ä¸ªexception_tableè¡¨é¡¹ç”±start_pcï¼Œend_pcï¼Œhandler_pcï¼Œcatch_typeï¼ˆæŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Class_infoç±»å‹çš„å¸¸é‡ï¼‰ç»„æˆ</p><p>å½“å­—èŠ‚ç åœ¨start_pcåˆ°end_pcä¹‹é—´å‡ºç°äº†ç±»å‹ä¸ºcatch_typeæˆ–è€…å…¶å­ç±»çš„å¼‚å¸¸ï¼Œå°±è½¬åˆ°handler_pcè¡Œç»§ç»­æ‰§è¡Œï¼Œå½“catch_typeä¸º0æ—¶è¡¨ç¤ºå¤„ç†æ‰€æœ‰çš„å¼‚å¸¸</p><p>âš¡<code>0x0002</code> ä»£è¡¨<code>attributes_count</code> æ˜¯<code>Code</code> å±æ€§è¡¨çš„<strong>é™„åŠ å±æ€§</strong>çš„å…¥å£ï¼ˆä¸€å±‚å¥—ä¸€å±‚å•ŠğŸ˜‚ï¼‰ï¼Œå€¼ä¸º2æ„å‘³ç€é™„åŠ å±æ€§è¡¨çš„æ•°é‡ä¸º2</p><h3 id="LineNumberTableå±æ€§"><a href="#LineNumberTableå±æ€§" class="headerlink" title="LineNumberTableå±æ€§"></a>LineNumberTableå±æ€§</h3><p>è¿™ä¸ªå°±æ˜¯ä¸Šé¢<strong><code><init></init></code>æ–¹æ³•Codeå±æ€§é™„åŠ çš„ç¬¬ä¸€ä¸ªå±æ€§</strong>ï¼Œè¿™ä¸ªå±æ€§ç”¨äºæè¿°Javaæºä»£ç è¡Œå·å’Œå­—èŠ‚ç è¡Œå·ï¼ˆåç§»é‡ï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä»–å¹¶ä¸æ˜¯è¿è¡Œçš„å¿…é¡»å±æ€§ï¼Œä½†æ˜¯é»˜è®¤ä¼šç”Ÿæˆåˆ°Classæ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>-g:none</code>æˆ–<code>-g:lines</code>å–æ¶ˆç”Ÿæˆè¿™ä¸ªå±æ€§ï¼Œå–æ¶ˆä¹‹åç¨‹åºæŠ›å¼‚å¸¸çš„æ—¶å€™ä¸ä¼šæ˜¾ç¤ºå‡ºé”™çš„è¡Œå·ï¼Œå¹¶ä¸”åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œä¹Ÿæ— æ³•æŒ‰ç…§æºç è¡Œæ¥è®¾ç½®æ–­ç‚¹ï¼Œå…¶ç»“æ„å¦‚ä¸‹è¡¨</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>line_number_table_length</td><td>1</td></tr><tr><td>line_number_info</td><td>line_number_table</td><td>line_number_table_length</td></tr></tbody></table><p>ğŸ¯<strong>æˆ‘ä»¬å†æ¥ç€ä¸Šé¢çš„Codeå±æ€§çš„å±æ€§è¡¨åˆ†æï¼Œçœ‹çœ‹Codeçš„å±æ€§è¡¨æ˜¯å•¥</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190904/O7MuBcPXNPKT.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>âš¡<code>0x000A</code> attributes_infoçš„ç¬¬ä¸€é¡¹ï¼Œå¯¹åº”çš„æ˜¯atttibuteçš„åå­—çš„ç´¢å¼•ï¼Œå¸¸é‡æ± ä¸­å¯¹åº”ç¬¬10é¡¹çš„ç´¢å¼•æ˜¯ </p><p> <code>#10 = Utf8   LineNumberTable</code> è¯´æ˜è¿™ä¸ªå±æ€§æ˜¯LineNumberTableå±æ€§ï¼Œç„¶åæ ¹æ®ä¸Šé¢ç»™å‡ºçš„è¡¨æ ¼ç»§ç»­åˆ†æ</p><p>âš¡<code>0x0000000A</code> å¯¹åº”attribute_lengthï¼Œè¯´æ˜è¯¥å±æ€§å€¼é•¿åº¦ä¸º10</p><p>âš¡<code>0x0002</code>å¯¹åº”line_number_table_lengthï¼Œè¯´æ˜æœ‰ä¸¤å¤„å¯¹åº”å…³ç³»</p><p>âš¡ åé¢ç´§è·Ÿçš„å­—èŠ‚å°±å¯¹åº”çš„<code>line_number_table</code> è¯¥å±æ€§åˆæœ‰ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä¸º<code>start_pc</code>å’Œ<code>line_number</code>ä¸¤ä¸ªu2ç±»å‹çš„æ•°æ®é¡¹ï¼Œå‰è€…æ˜¯å­—èŠ‚ç è¡Œå·ï¼Œåè€…æ˜¯æºç è¡Œå·ï¼Œå‰é¢line_number_table_lengthä¸º2ï¼Œæ‰€ä»¥è¿™é‡Œåé¢æœ‰ä¸¤ä¸ªline_number_table</p><h3 id="LocalVariableTableå±æ€§"><a href="#LocalVariableTableå±æ€§" class="headerlink" title="LocalVariableTableå±æ€§"></a>LocalVariableTableå±æ€§</h3><p>è¿™ä¸ªå°±æ˜¯ä¸Šé¢<strong><code><init></init></code> æ–¹æ³•Codeå±æ€§é™„åŠ çš„ç¬¬äºŒä¸ªå±æ€§</strong>ï¼Œè¿™ä¸ªå±æ€§ä¸»è¦ç”¨äºæè¿°<strong>æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨</strong>ä¸­çš„å˜é‡å’ŒJavaæºä»£ç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œæ²¡æœ‰è¿™é¡¹å±æ€§å½“åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨è¯¥æ–¹æ³•çš„æ—¶å€™å…³äºå‚æ•°çš„åç§°éƒ½ä¼šä¸¢å¤±ï¼Œæœ€å…¸å‹çš„å°±æ˜¯IDEä¸­æœ‰æ—¶å€™åç¼–è¯‘ä¸€äº›æ¡†æ¶çš„ä»£ç å°±ä¼šçœ‹è§ä¸€äº›æ–¹æ³•å‚æ•°ä»€ä¹ˆçš„éƒ½æ˜¯arg0ï¼Œarg1ä»€ä¹ˆçš„</p><p><strong>LocalVariableTableå±æ€§ç»“æ„</strong></p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>local_variable_table_length</td><td>1</td></tr><tr><td>local_variable_info</td><td>local_variable_table</td><td>local_variable_table_length</td></tr></tbody></table><p>ğŸ¯ <strong>æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„LineNumberTableå±æ€§åˆ†æ<code>LocalVariableTable</code></strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190905/TafXz1oMkG4d.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>âš¡<code>0x000B</code>å’Œä¹‹å‰æ‰€æœ‰çš„attributes_infoä¸€æ ·ï¼Œè¿™ä¸ªç¬¬ä¸€é¡¹ä»£è¡¨è¯¥å±æ€§çš„åå­—åœ¨å¸¸é‡æ± çš„ç´¢å¼•å€¼ï¼Œè¿™é‡Œå¯¹åº”å¸¸é‡æ± ç¬¬11é¡¹ <code>#11 = Utf8   LocalVariableTable</code> </p><p>âš¡<code>0x0000000C</code> å¯¹åº”attribute_lengthï¼Œè¯´æ˜è¯¥å±æ€§å€¼é•¿åº¦ä¸º12</p><p>âš¡<code>0x0001</code>å¯¹åº”local_variable_table_lengthï¼Œå€¼ä¸º1è¯´æ˜åªæœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡</p><blockquote><p>å…¶å®åˆ°ç°åœ¨æˆ‘ä»¬åˆ†æçš„å±æ€§è¡¨éƒ½è¿˜æ˜¯åœ¨åˆ†æè¿™ä¸ªç±»çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼ŒJVMè‡ªåŠ¨ç”Ÿæˆçš„<code><init></init></code>æ–¹æ³•æ‰€å¯¹åº”çš„å±æ€§è¡¨ï¼Œè€Œè¿™ä¸ª<code><init></init></code>å¾ˆæ˜æ˜¾æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œæ˜¯ä¸€ä¸ªæ— å‚çš„ç©ºæ„é€ å™¨ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™é‡Œçš„å±€éƒ¨å˜é‡æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯0ï¼Ÿ</p><p>å…¶å®è¿™å¾ˆå¥½è§£é‡Šï¼Œå¹³å¸¸ç¼–ç çš„æ—¶å€™å¤§å®¶è‚¯å®šéƒ½ä½¿ç”¨è¿‡<code>this</code> è¿™ä¸ªå…³é”®å­—ï¼Œé€šè¿‡è¿™ä¸ªå…³é”®å­—å¯ä»¥åœ¨å®ä¾‹æ–¹æ³•ä¸­æ‹¿åˆ°å½“å‰çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ª1ä»£è¡¨å…¶å®å°±æ˜¯è¿™ä¸ª<code>this</code>ï¼Œåœ¨Javacç¼–è¯‘çš„æ—¶å€™ä¼šå°†å¯¹thisçš„è®¿é—®è½¬æ¢ä¸ºå¯¹ä¸€ä¸ªæ–¹æ³•å‚æ•°çš„è®¿é—®ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å‚æ•°ä¼šåœ¨è¿è¡Œè¿™ä¸ªå®ä¾‹æ–¹æ³•çš„æ—¶å€™ç”±JVMè‡ªåŠ¨çš„ä¼ å…¥ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ä¸­è‡³å°‘ä¼šå­˜åœ¨ä¸€ä¸ªæŒ‡å‘å½“å‰å®ä¾‹çš„å±€éƒ¨å˜é‡</p></blockquote><p>æˆ‘ä»¬ç»§ç»­åˆ†æåé¢çš„<code>local_variable_info</code> </p><p><strong>local_variable_infoå±æ€§ç»“æ„</strong></p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>start_pc</td><td>1</td></tr><tr><td>u2</td><td>length</td><td>1</td></tr><tr><td>u2</td><td>name_index</td><td>1</td></tr><tr><td>u2</td><td>descriptor_index</td><td>1</td></tr><tr><td>u2</td><td>index</td><td>1</td></tr></tbody></table><p>âš¡<code>0x0000</code> ä»£è¡¨<code>start_pc</code>ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹çš„å­—èŠ‚ç åç§»é‡</p><p>âš¡<code>0x000A</code>ä»£è¡¨<code>length</code>ä»£è¡¨è¿™ä¸ªå±€éƒ¨å˜é‡å…¶ä½œç”¨èŒƒå›´è¦†ç›–çš„é•¿åº¦</p><p>âš¡<code>0x000C</code>ä»£è¡¨<code>name_index</code> æ˜¯è¿™ä¸ªå±€éƒ¨å˜é‡çš„åå­—ç´¢å¼•ï¼ŒæŒ‡å‘å¸¸é‡æ± ä¸­ç¬¬12é¡¹å¸¸é‡ <code>#12 = Utf8   this</code>ç¬¦åˆæˆ‘ä»¬å‰é¢çš„åˆ†æ</p><p>âš¡<code>0x000D</code>ä»£è¡¨<code>decriptor_index</code> å±€éƒ¨å˜é‡æè¿°ç¬¦ï¼ˆå¯¹å˜é‡æ¥è¯´å°±æ˜¯å˜é‡çš„ç±»å‹ï¼‰çš„ç´¢å¼•ï¼ŒæŒ‡å‘å¸¸é‡æ± ç¬¬13é¡¹å¸¸é‡</p><p><code>#13 = Utf8    Ljvmstudy/classfile_stu/Test1;</code> å½“å‰å®ä¾‹å¯¹è±¡çš„<strong>å…¨é™å®šå</strong></p><p>âš¡<code>0x0000</code> å¯¹åº”<code>index</code> ä»£è¡¨è¿™ä¸ªå±€éƒ¨å˜é‡åœ¨<strong>æ ˆå¸§å±€éƒ¨å˜é‡è¡¨</strong>ä¸­Slotçš„ä½ç½®</p><blockquote><p>_<strong>â³ åˆ°è¿™é‡Œæˆ‘ä»¬çš„æ–¹æ³•è¡¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•<code><init></init></code>çš„Codeå±æ€§å°±ç»“æŸäº†ï¼Œç”±äº<code><init></init></code>æ–¹æ³•ä¸åŒ…å«å…¶ä»–çš„å±æ€§æ‰€ä»¥<code><init></init></code>æ–¹æ³•åœ¨å­—èŠ‚ç ä¸­ä¹Ÿå·²ç»ç»“æŸäº†</strong>_ï¼Œåé¢çš„æ–¹æ³•å°±ä¸å†é€ä¸ªå­—èŠ‚çš„åˆ†æäº†ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦çš„æ˜¯è¦ææ¸…æ¥šè¿™äº›å±æ€§çš„å±‚çº§å’ŒåŒ…å«å…³ç³»ï¼Œä¸è¦ææ··äº†</p></blockquote><h3 id="Exceptionså±æ€§"><a href="#Exceptionså±æ€§" class="headerlink" title="Exceptionså±æ€§"></a>Exceptionså±æ€§</h3><p><code>Exceptions</code> å±æ€§å’Œä¸Šé¢Codeå±æ€§æ˜¯å¹³çº§çš„ï¼Œå’ŒCodeå±æ€§é™„å¸¦çš„<code>exception_table</code>å¹¶ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œä¸è¦ææ··äº†ï¼ŒExceptionså±æ€§çš„ä½œç”¨æ˜¯åˆ—ä¸¾å‡ºæ–¹æ³•ä¸­å¯èƒ½æŠ›å‡ºçš„å—æ£€æŸ¥å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•æè¿°æ—¶åœ¨<code>throws</code>å…³é”®å­—åé¢åˆ—ä¸¾çš„å¼‚å¸¸ï¼Œç»“æ„å¦‚ä¸‹</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>number_of_exceptions</td><td>1</td></tr><tr><td>u2</td><td>exception_index_table</td><td>number_of_exceptions</td></tr></tbody></table><p><code>number_of_exceptions</code>è¡¨ç¤ºå¯èƒ½æŠ›å‡ºå¤šå°‘ç§å—æ£€æŸ¥å¼‚å¸¸ï¼Œæ¯ç§å¼‚å¸¸éƒ½æ˜¯ä¸€ä¸ª<code>exception_index_table</code> å¾ˆæ˜æ˜¾è¿™ä¸ªæ˜¯ä¸€ä¸ªç´¢å¼•ï¼ŒæŒ‡å‘å¸¸é‡æ± ä¸­å¯¹åº”çš„Exceptionçš„æè¿°ç¬¦</p><p>è¿™é‡Œæˆ‘ä»¬çš„<code><init></init></code> æ–¹æ³•å¹¶æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥è¿™ä¸€é¡¹å±æ€§å¹¶ä¸å­˜åœ¨ï¼Œé‚£æˆ‘ä»¬æ‰¾ä¸€ä¸ªæœ‰å¼‚å¸¸çš„æ¥çœ‹çœ‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> bbbb = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> aaaa = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List<integer> list=<span class="keyword">null</span>;</integer></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test2</span><span class="params">(<span class="keyword">int</span> a)</span> </span>{</span><br><span class="line">        bbbb = a;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">inc</span><span class="params">()</span> <span class="keyword">throws</span> ArithmeticException</span>{</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            x=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span>  x;</span><br><span class="line">        }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">            x=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            x=<span class="number">3</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deprecatedMethod</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190905/uG5AQrVoHphH.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å¯ä»¥çœ‹åˆ°<code>exception_table</code> é‡Œé¢è®°å½•äº†è¿™ä¸ªæ–¹æ³•çš„å¼‚å¸¸å¤„ç†è¡¨ï¼Œä¹Ÿå°±æ˜¯<code>try-catch</code>é‡Œé¢çš„å¼‚å¸¸å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯Javaä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äº†å¼‚å¸¸å¤„ç†è¡¨å»å¤„ç†å¼‚å¸¸å’Œfinallyæœºåˆ¶ï¼Œåœ¨jdk1.4ä¹‹å‰ä½¿ç”¨çš„æ˜¯ç®€å•çš„è·³è½¬æŒ‡ä»¤æ¥å®ç°ï¼Œè€ŒExceptionså±æ€§å’ŒCodeå¹³çº§ï¼Œåªæ˜¯åˆ—ä¸¾äº†ä¸€äº›å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Exceptions:</span><br><span class="line">  <span class="keyword">throws</span> java.lang.ArithmeticException</span><br></pre></td></tr></tbody></table></figure></div><h2 id="SourceFileå±æ€§"><a href="#SourceFileå±æ€§" class="headerlink" title="SourceFileå±æ€§"></a>SourceFileå±æ€§</h2><p>è¿™ä¸ªå±æ€§æ˜¯å±äºClassæ–‡ä»¶çš„å±æ€§ï¼Œå¾ˆæ˜æ˜¾æ˜¯ç”¨æ¥è®°å½•ç”Ÿæˆè¿™ä¸ªClassæ–‡ä»¶çš„æºä»£ç åç§°ï¼Œå…¶å€¼æŒ‡å‘ä¸€ä¸ªCONSTANT_Utf8_infoçš„ç´¢å¼•ï¼Œå€¼å°±æ˜¯æºæ–‡ä»¶çš„åå­—</p><h2 id="ConstantValueå±æ€§"><a href="#ConstantValueå±æ€§" class="headerlink" title="ConstantValueå±æ€§"></a>ConstantValueå±æ€§</h2><p>è¿™ä¸ªå±æ€§åœ¨å‰ä¸€ç¯‡ <a href="http://imlgw.top/2019/08/17/shen-ru-li-jie-java-xu-ni-ji-er/#%E5%87%86%E5%A4%87">ç±»åŠ è½½å™¨</a> ä¸­æåˆ°è¿‡ï¼Œ <code>ConstantValue</code>å±æ€§çš„ä½œç”¨æ˜¯é€šçŸ¥è™šæ‹Ÿæœºè‡ªåŠ¨ä¸ºé™æ€å˜é‡èµ‹å€¼ï¼Œåªæœ‰è¢«staticå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼ˆç±»å˜é‡ï¼‰å¯ä»¥ä½¿ç”¨è¿™é¡¹å±æ€§</p><p>å¦‚æœ<strong>åŒæ—¶ä½¿ç”¨finalå’Œstaticæ¥ä¿®é¥°ä¸€ä¸ªå˜é‡</strong>ï¼Œå¹¶ä¸”è¿™ä¸ªå˜é‡çš„æ•°æ®ç±»å‹æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…<code>java.lang.String</code>çš„è¯ï¼Œå°±ç”Ÿæˆ<code>ConstantValue</code>å±æ€§ï¼Œç”¨äºåœ¨<strong>å‡†å¤‡é˜¶æ®µ</strong>ç»™å˜é‡èµ‹åˆå§‹å€¼ï¼Œå¦‚æœè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«finalä¿®é¥°æˆ–è€…å¹¶éåŸºæœ¬ç±»å‹åŠå­—ç¬¦ä¸²ï¼Œåˆ™åœ¨å‡†å¤‡é˜¶æ®µä¼šè¢«åˆå§‹åŒ–ä¸ºé»˜è®¤çš„é›¶å€¼ï¼Œåœ¨<code><clinit></clinit></code>æ–¹æ³•ä¸­è¿›è¡ŒçœŸæ­£çš„åˆå§‹åŒ–</p><p><strong>ä¾ç„¶æ˜¯ä¸Šé¢Exceptionsçš„Demo</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190905/U8zwbs2c0n8a.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å¯ä»¥çœ‹åˆ°<code>aaaa</code> è¿™ä¸ªå¸¸é‡å­—æ®µé™„å¸¦äº† <code>ConstantValue</code> å±æ€§å…¶å€¼å°±æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­99çš„ä¸€ä¸ªç´¢å¼•</p><blockquote><p>ğŸ¯ åé¢è¿˜æœ‰ä¸€äº›å±æ€§å°±ä¸å†è¯¦ç»†ä»‹ç»äº†</p><p>Signatureç”¨æ¥è®°å½•æ³›å‹çš„ä¿¡æ¯ï¼ŒStackMapTableç”¨æ¥éªŒè¯å­—èŠ‚ç ï¼ŒBootstarapMethodsç”¨æ¥ä¿å­˜åŠ¨æ€è°ƒç”¨çš„å¼•å¯¼æ–¹æ³•é™å®šç¬¦ï¼ŒDeprecatedå’ŒSyntheticä¸¤ä¸ªbooleanå±æ€§â€¦â€¦</p></blockquote><h2 id="Synchnorizedå­—èŠ‚ç åˆ†æ"><a href="#Synchnorizedå­—èŠ‚ç åˆ†æ" class="headerlink" title="Synchnorizedå­—èŠ‚ç åˆ†æ"></a>Synchnorizedå­—èŠ‚ç åˆ†æ</h2><p><strong>synchnorized</strong>å…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°æ–¹æ³•ä½“ï¼Œæˆ–è€…æ–¹æ³•ä½“å†…çš„ä»£ç å—ï¼Œä¿®é¥°æ–¹æ³•ä½“çš„æ—¶å€™åŒæ­¥æ˜¯éšå¼çš„ï¼Œæ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›ä¸­ï¼Œä¸ºäº†çœ‹åˆ°å­—èŠ‚ç çš„å˜åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸è®¨è®ºè¿™ç§ï¼ˆä¸¤ç§æ–¹å¼çš„åº•å±‚å®ç°å…¶å®è¿˜æ˜¯ä¸€æ ·çš„ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test4</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setA</span><span class="params">(<span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            a = x;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç¼–è¯‘ååˆ©ç”¨å·¥å…·æŸ¥çœ‹setAæ–¹æ³•å†…ç”Ÿæˆçš„å­—èŠ‚ç æŒ‡ä»¤ï¼ˆçœç•¥äº†æ¬¡è¦çš„ä¸€äº›ä¿¡æ¯ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">0</span>: aload_0           <span class="comment">//å¯¹è±¡å¼•ç”¨thiså…¥æ ˆ</span></span><br><span class="line"><span class="number">1</span>: dup             <span class="comment">//å¤åˆ¶æ ˆé¡¶å…ƒç´ (this)</span></span><br><span class="line"><span class="number">2</span>: astore_2          <span class="comment">//å°†æ ˆé¡¶å…ƒç´ (this)å­˜å…¥å±€éƒ¨å˜é‡è¡¨Slotç´¢å¼•ä¸º2çš„ä½ç½®</span></span><br><span class="line"><span class="number">3</span>: monitorenter      <span class="comment">//ä»¥æ ˆé¡¶å…ƒç´ (this)ä¸ºé”è¿›å…¥åŒæ­¥å—</span></span><br><span class="line"><span class="number">4</span>: iload_1         <span class="comment">//å±€éƒ¨å˜é‡Slot 1ä½ç½®çš„å…ƒç´ (x)å…¥æ ˆ</span></span><br><span class="line">5: invokestatic  #2  // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span><br><span class="line">8: putstatic     #3  // Field a:Ljava/lang/Integer; ç”¨xç»™aèµ‹å€¼</span><br><span class="line"><span class="number">11</span>: aload_2          <span class="comment">//å±€éƒ¨å˜é‡è¡¨Slot 2å…ƒç´ (this)å…¥æ ˆ</span></span><br><span class="line"><span class="number">12</span>: monitorexit      <span class="comment">//é€€å‡ºåŒæ­¥</span></span><br><span class="line"><span class="number">13</span>: goto          <span class="number">21</span> <span class="comment">//è·³è½¬åˆ°21è¡Œç»“æŸ</span></span><br><span class="line"><span class="number">16</span>: astore_3         <span class="comment">//åˆ°è¿™é‡Œè¯´æ˜å¼‚å¸¸äº†ï¼Œå°†æ ˆé¡¶å…ƒç´ ï¼ˆå¼‚å¸¸å¯¹è±¡ï¼‰å­˜å…¥å±€éƒ¨å˜é‡è¡¨Slot 3ä½ç½®</span></span><br><span class="line"><span class="number">17</span>: aload_2          <span class="comment">//å±€éƒ¨å˜é‡è¡¨Slot 2å…ƒç´ (this)ä½ç½®å…¥æ ˆ</span></span><br><span class="line"><span class="number">18</span>: monitorexit      <span class="comment">//é€€å‡ºåŒæ­¥</span></span><br><span class="line"><span class="number">19</span>: aload_3          <span class="comment">//å±€éƒ¨å˜é‡è¡¨Slot 3ä½ç½®å…ƒç´ å…¥æ ˆ</span></span><br><span class="line"><span class="number">20</span>: athrow           <span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="number">21</span>: <span class="keyword">return</span>           <span class="comment">//æ–¹æ³•æ­£å¸¸è¿”å›</span></span><br><span class="line">Exception table:</span><br><span class="line">    from    to  target type</span><br><span class="line">       <span class="number">4</span>    <span class="number">13</span>    <span class="number">16</span>   any</span><br><span class="line">      <span class="number">16</span>    <span class="number">19</span>    <span class="number">16</span>   any</span><br></pre></td></tr></tbody></table></figure></div><p>æœ€å¼€å§‹æ²¡æœ‰å­¦å­—èŠ‚ç çš„æ—¶å€™ä¸€ç›´å¾ˆçº³é—·ä¸ºå•¥æœ‰ä¸¤ä¸ª<code>monitorexit</code> ï¼Œç°åœ¨ç®—æ˜¯æ˜ç™½äº†ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯synchnorizedåœ¨æ–¹æ³•å¼‚å¸¸çš„æƒ…å†µä¸‹ä»ç„¶å¯ä»¥æ­£å¸¸çš„é‡Šæ”¾é”ï¼Œè€Œä¸è‡³äºå¯¼è‡´é”æ³„éœ²ï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒæ¨èä½¿ç”¨synchnorizedçš„åŸå› ä¹‹ä¸€</p><p>é€šè¿‡å­—èŠ‚ç å¯ä»¥çœ‹åˆ°ï¼Œç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬è‡ªåŠ¨çš„ç”Ÿæˆäº†ä¸€ä¸ªå¼‚å¸¸è¡¨ï¼Œä¹Ÿå°±æ˜¯å‰é¢Codeå±æ€§ä¸­æºå¸¦çš„exception_tableå±æ€§ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„ç¨‹åºæ®µå†…å‘ç”Ÿå¼‚å¸¸ï¼Œä¼šæŒ‰ç…§å¼‚å¸¸è¡¨æŒ‡å®šçš„targetè¿›è¡Œè·³è½¬ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¼šé‡Šæ”¾è¿™ä¸ªé”</p><h2 id="æ€»ç»“-amp-å‚è€ƒ"><a href="#æ€»ç»“-amp-å‚è€ƒ" class="headerlink" title="æ€»ç»“ & å‚è€ƒ"></a>æ€»ç»“ & å‚è€ƒ</h2><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦è®°å½•äº†Classå­—èŠ‚ç çš„æ–‡ä»¶ç»“æ„ç›¸å…³çš„å†…å®¹ï¼Œä¹Ÿç®—æ˜¯æ˜¯é€ä¸ªå­—èŠ‚çš„åˆ†æäº†ä¸€éï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤§çš„ï¼Œå¯¹JVMå¹³å°çš„ç†è§£åˆåŠ æ·±äº†ï¼Œå½“ç„¶è¿™ä¸€ç¯‡ä¹Ÿæ˜¯ç»™ä¸‹ä¸€ç¯‡<strong>è™šæ‹ŸæœºèŠ‚ç çš„æ‰§è¡Œå¼•æ“</strong>åšé“ºå«</p><p><strong><em>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹â€”â€”å‘¨å¿—æ˜</em></strong></p></body></html>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Classç»“æ„ </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeåŠ¨æ€è§„åˆ’</title>
      <link href="/2019/09/01/leetcode-dong-tai-gui-hua/"/>
      <url>/2019/09/01/leetcode-dong-tai-gui-hua/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="70-çˆ¬æ¥¼æ¢¯"><a href="#70-çˆ¬æ¥¼æ¢¯" class="headerlink" title="70. çˆ¬æ¥¼æ¢¯"></a><a href="https://leetcode-cn.com/problems/climbing-stairs/" target="_blank" rel="noopener">70. çˆ¬æ¥¼æ¢¯</a></h2><p>You are climbing a stair case. It takes <em>n</em> steps to reach to the top.</p><p>Each time you can either climb 1 or 2 steps. In how many distinct ways can you climb to the top?</p><p><strong>Note:</strong> Given <em>n</em> will be a positive integer.</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="number">2</span></span><br><span class="line">Output: <span class="number">2</span></span><br><span class="line">Explanation: There are two ways to climb to the top.</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. <span class="number">1</span> step + <span class="number">1</span> step</span><br><span class="line"><span class="number">2</span>. <span class="number">2</span> steps</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="number">3</span></span><br><span class="line">Output: <span class="number">3</span></span><br><span class="line">Explanation: There are three ways to climb to the top.</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. <span class="number">1</span> step + <span class="number">1</span> step + <span class="number">1</span> step</span><br><span class="line"><span class="number">2</span>. <span class="number">1</span> step + <span class="number">2</span> steps</span><br><span class="line"><span class="number">3</span>. <span class="number">2</span> steps + <span class="number">1</span> step</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ²¡å•¥å¥½è¯´çš„ï¼Œå¯ä»¥è¯´æ˜¯æœ€ç»å…¸çš„dpé¢˜äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">climbStairsDp</span><span class="params">(<span class="keyword">int</span> n)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> []dp=<span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<=n;i++) {</span><br><span class="line">        dp[i]=dp[i-<span class="number">1</span>]+dp[i-<span class="number">2</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="198-æ‰“å®¶åŠ«èˆ"><a href="#198-æ‰“å®¶åŠ«èˆ" class="headerlink" title="198. æ‰“å®¶åŠ«èˆ"></a><a href="https://leetcode-cn.com/problems/house-robber/" target="_blank" rel="noopener">198. æ‰“å®¶åŠ«èˆ</a></h2><p>ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚</p><p>ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>]</span><br><span class="line">Output: <span class="number">4</span></span><br><span class="line">Explanation: Rob house <span class="number">1</span> (money = <span class="number">1</span>) and then rob house <span class="number">3</span> (money = <span class="number">3</span>).</span><br><span class="line">             Total amount you can rob = <span class="number">1</span> + <span class="number">3</span> = <span class="number">4</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: [<span class="number">2</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">1</span>]</span><br><span class="line">Output: <span class="number">12</span></span><br><span class="line">Explanation: Rob house <span class="number">1</span> (money = <span class="number">2</span>), rob house <span class="number">3</span> (money = <span class="number">9</span>) and rob house <span class="number">5</span> (money = <span class="number">1</span>).</span><br><span class="line">             Total amount you can rob = <span class="number">2</span> + <span class="number">9</span> + <span class="number">1</span> = <span class="number">12</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>ç®€å•çš„dpé¢˜ï¼Œdpæ–¹ç¨‹å¾ˆå®¹æ˜“å¾—åˆ°ï¼Œ<code>dp[i]=max(dp[i-2]+nums[i],dp[i-1])</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//  Max[i]=max(nums[i-2]+nums[i],nums[i-1])</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(nums.length==<span class="number">1</span>){</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> []dp=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    dp[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">    dp[<span class="number">1</span>]=nums[<span class="number">1</span>]>nums[<span class="number">0</span>]?nums[<span class="number">1</span>]:nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">2</span>;i<nums.length;i++) {< span><br><span class="line">        dp[i]=Math.max(dp[i-<span class="number">2</span>]+nums[i],dp[i-<span class="number">1</span>]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[i-<span class="number">1</span>];</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´ç©ºé—´éƒ½æ˜¯O(N)ï¼Œéœ€è¦æ³¨æ„è¾¹ç•Œæ¡ä»¶ï¼Œè¿™é¢˜è¿˜æœ‰å¦ä¸€ç§å†™æ³•ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯O(1)çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Max[i]=max(pre+nums[i],cur);  </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> pre= <span class="number">0</span>; <span class="comment">//å‰ä¸€å¤©</span></span><br><span class="line">    <span class="keyword">int</span> cur= <span class="number">0</span>; <span class="comment">//å½“å¤©ï¼Œå…¶å®å°±æ˜¯ä¸ºäº†ä¿å­˜å‰åä¸¤å¤©çš„dp[i]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> temp=cur;</span><br><span class="line">        cur=Math.max(pre+nums[i],cur);</span><br><span class="line">        <span class="comment">//å‘åèµ°</span></span><br><span class="line">        pre=temp;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="213-æ‰“å®¶åŠ«èˆ-II"><a href="#213-æ‰“å®¶åŠ«èˆ-II" class="headerlink" title="213. æ‰“å®¶åŠ«èˆ II"></a><a href="https://leetcode-cn.com/problems/house-robber-ii/" target="_blank" rel="noopener">213. æ‰“å®¶åŠ«èˆ II</a></h2><p>ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ã€‚è¿™ä¸ªåœ°æ–¹æ‰€æœ‰çš„æˆ¿å±‹éƒ½<strong>å›´æˆä¸€åœˆ</strong>ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªæˆ¿å±‹å’Œæœ€åä¸€ä¸ªæˆ¿å±‹æ˜¯ç´§æŒ¨ç€çš„ã€‚åŒæ—¶ï¼Œç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚</p><p>ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚</p><p>ç¤ºä¾‹ 1:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br><span class="line">è§£é‡Š: ä½ ä¸èƒ½å…ˆå·çªƒ <span class="number">1</span> å·æˆ¿å±‹ï¼ˆé‡‘é¢ = <span class="number">2</span>ï¼‰ï¼Œç„¶åå·çªƒ <span class="number">3</span> å·æˆ¿å±‹ï¼ˆé‡‘é¢ = <span class="number">2</span>ï¼‰, å› ä¸ºä»–ä»¬æ˜¯ç›¸é‚»çš„ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p>ç¤ºä¾‹ 2:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br><span class="line">è§£é‡Š: ä½ å¯ä»¥å…ˆå·çªƒ <span class="number">1</span> å·æˆ¿å±‹ï¼ˆé‡‘é¢ = <span class="number">1</span>ï¼‰ï¼Œç„¶åå·çªƒ <span class="number">3</span> å·æˆ¿å±‹ï¼ˆé‡‘é¢ = <span class="number">3</span>ï¼‰ã€‚</span><br><span class="line">     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = <span class="number">1</span> + <span class="number">3</span> = <span class="number">4</span> ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>ä¸ä¸Šä¸€é¢˜ç›¸æ¯”æˆ¿å±‹éƒ½å›´æˆä¸€åœˆäº†ï¼Œå…¶å®å›´æˆä¸€åœˆä¹Ÿå°±è¯´æ˜<code>nums[0]</code>å’Œ<code>nums[len-1]</code>ä¸èƒ½åŒæ—¶å·ï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ†ä¸¤ç§æƒ…å†µåˆ†åˆ«æ±‚æœ€å¤§å€¼ï¼Œç„¶åæ±‚æœ€ç»ˆçš„æœ€å¤§å€¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span> [] nums)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(nums.length==<span class="number">1</span>){</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(nums.length==<span class="number">2</span>){</span><br><span class="line">        <span class="keyword">return</span> Math.max(nums[<span class="number">0</span>],nums[<span class="number">1</span>]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> n=nums.length;</span><br><span class="line">    <span class="keyword">return</span> Math.max(rob(nums,<span class="number">1</span>,n),rob(nums,<span class="number">0</span>,n-<span class="number">1</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> start,<span class="keyword">int</span> end)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> pre=<span class="number">0</span>; <span class="comment">//å‰ä¸€å®¶æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">int</span> cur=<span class="number">0</span>; <span class="comment">//å½“å‰æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=start;i<end;i++) {< span><br><span class="line">        <span class="keyword">int</span> temp=cur;</span><br><span class="line">        cur=Math.max(pre+nums[i],cur);</span><br><span class="line">        pre=temp;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">}</span><br></end;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="337-æ‰“å®¶åŠ«èˆ-III"><a href="#337-æ‰“å®¶åŠ«èˆ-III" class="headerlink" title="337. æ‰“å®¶åŠ«èˆ III"></a><a href="https://leetcode-cn.com/problems/house-robber-iii/" target="_blank" rel="noopener">337. æ‰“å®¶åŠ«èˆ III</a></h2><p>åœ¨ä¸Šæ¬¡æ‰“åŠ«å®Œä¸€æ¡è¡—é“ä¹‹åå’Œä¸€åœˆæˆ¿å±‹åï¼Œå°å·åˆå‘ç°äº†ä¸€ä¸ªæ–°çš„å¯è¡Œçªƒçš„åœ°åŒºã€‚è¿™ä¸ªåœ°åŒºåªæœ‰ä¸€ä¸ªå…¥å£ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæ ¹â€ã€‚ é™¤äº†â€œæ ¹â€ä¹‹å¤–ï¼Œæ¯æ ‹æˆ¿å­æœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œçˆ¶â€œæˆ¿å­ä¸ä¹‹ç›¸è¿ã€‚ä¸€ç•ªä¾¦å¯Ÿä¹‹åï¼Œèªæ˜çš„å°å·æ„è¯†åˆ°â€œè¿™ä¸ªåœ°æ–¹çš„æ‰€æœ‰æˆ¿å±‹çš„æ’åˆ—ç±»ä¼¼äºä¸€æ£µäºŒå‰æ ‘â€ã€‚ å¦‚æœä¸¤ä¸ªç›´æ¥ç›¸è¿çš„æˆ¿å­åœ¨åŒä¸€å¤©æ™šä¸Šè¢«æ‰“åŠ«ï¼Œæˆ¿å±‹å°†è‡ªåŠ¨æŠ¥è­¦ã€‚</p><p>è®¡ç®—åœ¨ä¸è§¦åŠ¨è­¦æŠ¥çš„æƒ…å†µä¸‹ï¼Œå°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="keyword">null</span>,<span class="number">3</span>,<span class="keyword">null</span>,<span class="number">1</span>]</span><br><span class="line">  <span class="number">3</span></span><br><span class="line">/ \</span><br><span class="line">   <span class="number">2</span>   <span class="number">3</span></span><br><span class="line">    \   \ </span><br><span class="line">     <span class="number">3</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">7</span> </span><br><span class="line">è§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ = <span class="number">3</span> + <span class="number">3</span> + <span class="number">1</span> = <span class="number">7</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="keyword">null</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  <span class="number">3</span></span><br><span class="line">/ \</span><br><span class="line">   <span class="number">4</span>   <span class="number">5</span></span><br><span class="line">  / \   \ </span><br><span class="line"> <span class="number">1</span>   <span class="number">3</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">9</span></span><br><span class="line">è§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ = <span class="number">4</span> + <span class="number">5</span> = <span class="number">9</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æš´åŠ›é€’å½’ï¼Œåº”è¯¥è¿˜æ˜¯å†™å¾—å‡ºæ¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ACäº†,ä½†æ˜¯æ•ˆç‡å¾ˆä½</span></span><br><span class="line"><span class="comment">//å¯ä»¥ç”¨hashMapç¼“å­˜ä¸€ä¸‹æ¯ä¸ªèŠ‚ç‚¹robçš„å€¼,ä½†æ˜¯æ²¡å¿…è¦</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> tryRob(root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">tryRob</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (root.left==<span class="keyword">null</span> && root.right==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> root.val;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å·å–å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">int</span> res=root.val;</span><br><span class="line">    <span class="keyword">if</span> (root.left!=<span class="keyword">null</span>) {</span><br><span class="line">        res+=tryRob(root.left.left)+tryRob(root.left.right);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (root.right!=<span class="keyword">null</span>) {</span><br><span class="line">        res+=tryRob(root.right.left)+tryRob(root.right.right);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸å·å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">int</span> res2=<span class="number">0</span>;</span><br><span class="line">    res2=tryRob(root.left)+tryRob(root.right);</span><br><span class="line">    <span class="keyword">return</span> Math.max(res,res2);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>çœ‹è¯„è®ºåŒºè¯´æ˜¯å•¥æ ‘çŠ¶dp ? çŸ¥è¯†ç›²åŒºäº†hahaha</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(TreeNode root)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] res=tryRob(root);</span><br><span class="line">    <span class="keyword">return</span> Math.max(res[<span class="number">0</span>],res[<span class="number">1</span>]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‘å½¢dp???</span></span><br><span class="line"><span class="comment">//çœ‹çš„æ‡‚ï¼Œä½†æ˜¯è‚¯å®šå†™ä¸å‡ºæ¥ ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] tryRob(TreeNode root) {</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">if</span> (root==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> dp;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] left=tryRob(root.left);</span><br><span class="line">    <span class="keyword">int</span>[] right=tryRob(root.right);</span><br><span class="line">    <span class="comment">//ä¸åŒ…å«å½“å‰èŠ‚ç‚¹çš„æœ€å¤§å€¼</span></span><br><span class="line">    dp[<span class="number">0</span>]=Math.max(left[<span class="number">0</span>],left[<span class="number">1</span>])+Math.max(right[<span class="number">0</span>],right[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">//åŒ…å«å½“å‰èŠ‚ç‚¹çš„æœ€å¤§å€¼</span></span><br><span class="line">    dp[<span class="number">1</span>]=left[<span class="number">0</span>]+right[<span class="number">0</span>]+root.val;</span><br><span class="line">    <span class="keyword">return</span> dp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸æ˜¯æˆ‘å¹ï¼Œå°±è¿™æ ·çš„é¢˜ç›®ï¼Œå†é‡è§å¤šå°‘æ¬¡æˆ‘éƒ½å†™ä¸å‡ºæ¥è¿™æ ·çš„è§£ï¼ˆç¬‘</p><h2 id="64-æœ€å°è·¯å¾„å’Œ"><a href="#64-æœ€å°è·¯å¾„å’Œ" class="headerlink" title="64. æœ€å°è·¯å¾„å’Œ"></a><a href="https://leetcode-cn.com/problems/minimum-path-sum/" target="_blank" rel="noopener">64. æœ€å°è·¯å¾„å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„ m x n ç½‘æ ¼ï¼Œè¯·æ‰¾å‡ºä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œä¸ºæœ€å°ã€‚</p><p><strong>è¯´æ˜</strong>ï¼šæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">5</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: <span class="number">7</span></span><br><span class="line">è§£é‡Š: å› ä¸ºè·¯å¾„ <span class="number">1</span>â†’<span class="number">3</span>â†’<span class="number">1</span>â†’<span class="number">1</span>â†’<span class="number">1</span> çš„æ€»å’Œæœ€å°ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p>å¾ˆç»å…¸çš„DPé¢˜ã€‚</p><p>é€’æ¨å…¬å¼ï¼š<code>dp[i][j]  = grid[i][j] + Math.min(dp[i-1][j],dp[i][j-1])</code></p><p>dp[i] [j] ä¸ºæ¯ä¸ªæ ¼å­åˆ°<code>å·¦ä¸Šè§’</code>æœ€çŸ­è·¯å¾„ ï¼Œæ¯éš”æ ¼å­åˆ°å³ä¸Šè§’çš„æœ€å°è·ç¦»ç­‰äºï¼Œå·¦è¾¹æ ¼å­æœ€å°å€¼å’Œä¸Šè¾¹æ ¼å­æœ€å°å€¼çš„æœ€å°å€¼åŠ ä¸Šå½“å‰æ ¼å­çš„å€¼ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minPathSum</span><span class="params">(<span class="keyword">int</span>[][] grid)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[grid.length][grid[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<grid.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<grid[<span class="number">0</grid[<span></span>].length;j++) {</grid.length;i++)></span><br><span class="line">            <span class="comment">//ç¬¬ä¸€è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span> && j!=<span class="number">0</span>){</span><br><span class="line">                dp[i][j]=grid[i][j]+dp[i][j-<span class="number">1</span>];</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(i!=<span class="number">0</span> && j==<span class="number">0</span>){</span><br><span class="line">                dp[i][j]=grid[i][j]+dp[i-<span class="number">1</span>][j];</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(i!=<span class="number">0</span> && j!=<span class="number">0</span>){</span><br><span class="line">                dp[i][j]=grid[i][j]+Math.min(dp[i-<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>]);</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[i][j]=grid[i][j];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[grid.length-<span class="number">1</span>][grid[<span class="number">0</span>].length-<span class="number">1</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="62-ä¸åŒè·¯å¾„"><a href="#62-ä¸åŒè·¯å¾„" class="headerlink" title="62. ä¸åŒè·¯å¾„"></a><a href="https://leetcode-cn.com/problems/unique-paths/" target="_blank" rel="noopener">62. ä¸åŒè·¯å¾„</a></h2><p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚</p><p>æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚</p><p>é—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190818/DfwXk3ObWxX8.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è¯´æ˜ï¼š</strong>m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: m = <span class="number">3</span>, n = <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œæ€»å…±æœ‰ <span class="number">3</span> æ¡è·¯å¾„å¯ä»¥åˆ°è¾¾å³ä¸‹è§’ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. å‘å³ -> å‘å³ -> å‘ä¸‹</span><br><span class="line"><span class="number">2</span>. å‘å³ -> å‘ä¸‹ -> å‘å³</span><br><span class="line"><span class="number">3</span>. å‘ä¸‹ -> å‘å³ -> å‘å³</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: m = <span class="number">7</span>, n = <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="number">28</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>åŠ¨æ€è§„åˆ’è§£æ³•</strong></p><p>è¿™é¢˜ç®—æ˜¯æˆ‘ç¬¬ä¸€é“è‡ªå·±åšå‡ºæ¥çš„DPé¢˜äº†ï¼Œè™½ç„¶å’Œä¸Šé¢çš„ä¸€é¢˜ä¸€æ ·çš„æ€è·¯ï¼Œä½†æ˜¯è¿˜æ˜¯æŒºå¼€å¿ƒçš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(m<<span class="number">0</span>||n<<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[n][m];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<n;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<m;j++) {< span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>&&j!=<span class="number">0</span>){</span><br><span class="line">                dp[i][j]=<span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(j==<span class="number">0</span> && i!=<span class="number">0</span>){</span><br><span class="line">                dp[i][j]=<span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(j!=<span class="number">0</span>&&i!=<span class="number">0</span>){</span><br><span class="line">                dp[i][j]=dp[i][j-<span class="number">1</span>]+dp[i-<span class="number">1</span>][j];</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[i][j]=<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[n-<span class="number">1</span>][m-<span class="number">1</span>];</span><br><span class="line">}</span><br></m;j++)></span></n;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚åº¦<code>O(m*n)</code>ï¼Œç©ºé—´å¤æ‚åº¦<code>O(m*n)</code>å¯ä»¥çœ‹å‡ºæ¥å®Œå…¨æ˜¯æŒ‰ç…§å‰ä¸€é¢˜çš„æ¨¡æ¿æ¥çš„ï¼Œä»£ç å†™çš„ä¸å¥½ï¼Œå¯ä»¥æŠŠ if-elseåˆå¹¶èµ·æ¥ï¼Œè¿™é¢˜ç©ºé—´å¤æ‚åº¦å…¶å®è¿˜å¯ä»¥ä¼˜åŒ–æˆ O(m)æˆ–O(n)çš„ï¼ŒæŒ‰è¡Œæ¥å‘ä¸‹èµ°</p><p><strong>ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–</strong></p><p><img alt="leetCodeé¢˜è§£" data-src="http://static.imlgw.top/blog/20190824/7uacSvsRMaWq.png?imageslim" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">uniquePaths2</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(m<<span class="number">0</span>||n<<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[n]; </span><br><span class="line">    Arrays.fill(dp,<span class="number">1</span>); <span class="comment">//ç¬¬ä¸€è¡Œï¼Œç¬¬ä¸€åˆ—å‡ä¸º 1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<m;i++) { <span class="comment">//ä¸€è¡Œä¸€è¡Œå‘ä¸‹èµ°</m;i++)></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<n;j++) {< span><br><span class="line">            <span class="comment">//è¿™é‡Œçš„dp[j]å’Œdp[j-1]åˆ†åˆ«å°±ä»£è¡¨äº† ä¸Šè¾¹ å’Œ å·¦è¾¹çš„å…ƒç´ </span></span><br><span class="line">            dp[j]=dp[j]+dp[j-<span class="number">1</span>]; <span class="comment">//æ±‚æ¯ä¸€è¡Œæ¯ä¸ªå…ƒç´ çš„dpå€¼</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[n-<span class="number">1</span>]; <span class="comment">//æœ€åä¸€è¡Œæœ€åä¸€ä¸ªdpå€¼å°±æ˜¯ç»“æœ</span></span><br><span class="line">}</span><br></n;j++)></span></pre></td></tr></tbody></table></figure></div><p><strong>ç»„åˆæ•°å…¬å¼</strong></p><p>è¿™é¢˜å…¶å®å°±æ˜¯æˆ‘ä»¬åˆä¸­è¿˜æ˜¯é«˜ä¸­å­¦çš„æ’åˆ—ç»„åˆçš„é—®é¢˜ï¼Œæœºå™¨äººä¸€å…±èµ°<code>m+n-2</code> æ­¥ï¼Œå‘ä¸‹ä¼šèµ°<code>m-1</code> æ­¥ï¼Œå‘ä¸‹ä¼šèµ°<code>n-1</code> æ­¥ï¼Œæ‰€ä»¥å®é™…ä¸Šå°±æ˜¯æ±‚ä¸€ä¸ªç»„åˆæ•°çš„ç»“æœ <code>C(n-1ï¼Œm+n-2)</code> ï¼Œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(m<<span class="number">0</span>||n<<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> step=m+n-<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> down=n-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">long</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=down;i++) {</span><br><span class="line">        res=res*(step-down+i)/i; <span class="comment">//é€’æ¨</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>)res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="63-ä¸åŒè·¯å¾„-II"><a href="#63-ä¸åŒè·¯å¾„-II" class="headerlink" title="63. ä¸åŒè·¯å¾„ II"></a><a href="https://leetcode-cn.com/problems/unique-paths-ii/" target="_blank" rel="noopener">63. ä¸åŒè·¯å¾„ II</a></h2><p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚</p><p>æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚</p><p>ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190818/DfwXk3ObWxX8.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚</p><p><strong>è¯´æ˜ï¼š</strong>m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line">  [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">  [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line">è§£é‡Š:</span><br><span class="line"><span class="number">3</span>x3 ç½‘æ ¼çš„æ­£ä¸­é—´æœ‰ä¸€ä¸ªéšœç¢ç‰©ã€‚</span><br><span class="line">ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ä¸€å…±æœ‰ <span class="number">2</span> æ¡ä¸åŒçš„è·¯å¾„ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. å‘å³ -> å‘å³ -> å‘ä¸‹ -> å‘ä¸‹</span><br><span class="line"><span class="number">2</span>. å‘ä¸‹ -> å‘ä¸‹ -> å‘å³ -> å‘å³</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>çœ‹åˆ°è¿™ç§è·¯å¾„çš„é¢˜ï¼Œé¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯é€’å½’å›æº¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//dfså›æº¯ , TLE</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[][] direction={{<span class="number">0</span>,<span class="number">1</span>},{<span class="number">1</span>,<span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(<span class="keyword">int</span>[][] obstacleGrid)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (obstacleGrid==<span class="keyword">null</span> || obstacleGrid.length<=<span class="number">0</span> || obstacleGrid[<span class="number">0</span>][<span class="number">0</span>]==<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">boolean</span>[][] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[obstacleGrid.length][obstacleGrid[<span class="number">0</span>].length];</span><br><span class="line">    dfs(obstacleGrid,visit,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span>[][] obstacleGrid,<span class="keyword">boolean</span>[][] visit,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>{</span><br><span class="line">    <span class="comment">//!=1 æ˜¯ä¸ºäº†coner case</span></span><br><span class="line">    <span class="keyword">if</span> (x==obstacleGrid.length-<span class="number">1</span> && y==obstacleGrid[<span class="number">0</span>].length-<span class="number">1</span> && obstacleGrid[x][y]!=<span class="number">1</span>) {</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<direction.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> nx=x+direction[i][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> ny=y+direction[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (nx<obstaclegrid.length && ny<obstaclegrid[<span class="number">0</obstaclegrid.length></span>].length && !visit[nx][ny] && obstacleGrid[nx][ny] !=<span class="number">1</span>) {</direction.length;i++)></span><br><span class="line">            visit[nx][ny]=<span class="keyword">true</span>;</span><br><span class="line">            dfs(obstacleGrid,visit,nx,ny);</span><br><span class="line">            visit[nx][ny]=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç»“æœå¾ˆæƒ¨ï¼ŒTLEäº†ï¼Œåªè·‘äº†ä¸åˆ°ä¸€åŠçš„caseå°±TLEäº†</p><p><strong>è§£æ³•äºŒ</strong></p><p>åŠ¨æ€è§„åˆ’çš„è§£æ³•ï¼Œå…¶å®å’Œä¸Šé¢ä¸€é¢˜æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡éœ€è¦æ³¨æ„éšœç¢ç‰©ä½ç½®çš„dpå€¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(<span class="keyword">int</span>[][] obstacleGrid)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (obstacleGrid==<span class="keyword">null</span> || obstacleGrid.length<=<span class="number">0</span> || obstacleGrid[<span class="number">0</span>][<span class="number">0</span>]==<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[obstacleGrid.length][obstacleGrid[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<obstaclegrid.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j<obstaclegrid[<span class="number">0</obstaclegrid[<span></span>].length;j++) {</obstaclegrid.length;i++)></span><br><span class="line">            <span class="keyword">if</span> (obstacleGrid[i][j]==<span class="number">1</span>) {</span><br><span class="line">                dp[i][j]=<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span> (i==<span class="number">0</span> && j==<span class="number">0</span>) {</span><br><span class="line">                dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">0</span> && j!=<span class="number">0</span>){</span><br><span class="line">                dp[<span class="number">0</span>][j]=dp[<span class="number">0</span>][j-<span class="number">1</span>];</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span> (j==<span class="number">0</span> && i!=<span class="number">0</span>) {</span><br><span class="line">                dp[i][<span class="number">0</span>]=dp[i-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j]+dp[i][j-<span class="number">1</span>];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[obstacleGrid.length-<span class="number">1</span>][obstacleGrid[<span class="number">0</span>].length-<span class="number">1</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å’Œä¸Šé¢ä¸€æ ·ä¹Ÿå¯ä»¥è¿›è¡Œç©ºé—´ä¸Šçš„ä¼˜åŒ–</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸€ç»´dp</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(<span class="keyword">int</span>[][] obstacleGrid)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (obstacleGrid==<span class="keyword">null</span> || obstacleGrid.length<=<span class="number">0</span> || obstacleGrid[<span class="number">0</span>][<span class="number">0</span>]==<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä»¥è¡Œä¸ºå•ä½å‘ä¸‹èµ°</span></span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[obstacleGrid[<span class="number">0</span>].length];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<obstaclegrid.length;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j<obstaclegrid[<span class="number">0</obstaclegrid[<span></span>].length;j++) {</obstaclegrid.length;i++)></span><br><span class="line">            <span class="keyword">if</span> (obstacleGrid[i][j]==<span class="number">1</span>) {</span><br><span class="line">                dp[j]=<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">0</span> && j!=<span class="number">0</span>){ <span class="comment">//ç¬¬ä¸€è¡Œ</span></span><br><span class="line">                dp[j]=dp[j-<span class="number">1</span>];</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(i!=<span class="number">0</span> && j!=<span class="number">0</span>){ </span><br><span class="line">                dp[j]=dp[j]+dp[j-<span class="number">1</span>];</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æ¯ä¸€è¡Œç¬¬ä¸€åˆ—çš„dp[j]=dp[j],å’Œä¸Šä¸€è¡Œçš„ç¬¬ä¸€åˆ—ä¿æŒä¸€è‡´å°±è¡Œ</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[obstacleGrid[<span class="number">0</span>].length-<span class="number">1</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="303-åŒºåŸŸå’Œæ£€ç´¢-æ•°ç»„ä¸å¯å˜"><a href="#303-åŒºåŸŸå’Œæ£€ç´¢-æ•°ç»„ä¸å¯å˜" class="headerlink" title="303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜"></a><a href="https://leetcode-cn.com/problems/range-sum-query-immutable/" target="_blank" rel="noopener">303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„  numsï¼Œæ±‚å‡ºæ•°ç»„ä»ç´¢å¼• i åˆ° j  (i â‰¤ j) èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼ŒåŒ…å« i,  j ä¸¤ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®š nums = [-<span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, -<span class="number">5</span>, <span class="number">2</span>, -<span class="number">1</span>]ï¼Œæ±‚å’Œå‡½æ•°ä¸º sumRange()</span><br><span class="line"></span><br><span class="line">sumRange(<span class="number">0</span>, <span class="number">2</span>) -> <span class="number">1</span></span><br><span class="line">sumRange(<span class="number">2</span>, <span class="number">5</span>) -> -<span class="number">1</span></span><br><span class="line">sumRange(<span class="number">0</span>, <span class="number">5</span>) -> -<span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸å¯å˜ã€‚</li><li>ä¼šå¤šæ¬¡è°ƒç”¨ sumRange æ–¹æ³•ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å…¶å®ä¸€å¼€å§‹å°±æ˜¯æƒ³çš„ç¼“å­˜ä¸€ä¸‹ä¹‹å‰è°ƒç”¨äº§ç”Ÿçš„å€¼ï¼Œæ²¡æœ‰ç†è§£åˆ°è¿™é¢˜çš„è¦ç‚¹ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumArray</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] sums=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NumArray</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (nums!=<span class="keyword">null</span> && nums.length><span class="number">0</span>) {</span><br><span class="line">            sums=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">            sums[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<sums.length;i++) {< span><br><span class="line">                sums[i]=sums[i-<span class="number">1</span>]+nums[i];</span><br><span class="line">            }    </span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sumRange</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">0</span>){</span><br><span class="line">            <span class="keyword">return</span> sums[j];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> sums[j]-sums[i-<span class="number">1</span>];</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your NumArray object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * NumArray obj = new NumArray(nums);</span></span><br><span class="line"><span class="comment"> * int param_1 = obj.sumRange(i,j);</span></span><br><span class="line"><span class="comment"> */</span></span><br></sums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜å…³é”®æœ‰ä¸¤ä¸ªåœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯ <code>sumRange(i , j) = sumRange(0, j)-sumRange(0, i-1)</code> ï¼Œå¦ä¸€ä¸ªå…³é”®å°±æ˜¯åœ¨æ„é€ å™¨é‡Œé¢å°†æ‰€æœ‰çš„ <code>sumRange(0 , i)</code> ç»™é¢„å…ˆæ±‚å‡ºæ¥ï¼Œè¿™æ ·åœ¨åé¢çš„è°ƒç”¨æ—¶æ—¶é—´å¤æ‚åº¦å°±æ˜¯<code>O(1)</code>çš„äº†ã€‚</p><p>è¿™é‡Œæ±‚<code>sumRange(0, i)</code>çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„dp.</p><hr><h2 id="413-ç­‰å·®æ•°åˆ—åˆ’åˆ†"><a href="#413-ç­‰å·®æ•°åˆ—åˆ’åˆ†" class="headerlink" title="413. ç­‰å·®æ•°åˆ—åˆ’åˆ†"></a><a href="https://leetcode-cn.com/problems/arithmetic-slices/" target="_blank" rel="noopener">413. ç­‰å·®æ•°åˆ—åˆ’åˆ†</a></h2><p>å¦‚æœä¸€ä¸ªæ•°åˆ—è‡³å°‘æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ä»»æ„ä¸¤ä¸ªç›¸é‚»å…ƒç´ ä¹‹å·®ç›¸åŒï¼Œåˆ™ç§°è¯¥æ•°åˆ—ä¸ºç­‰å·®æ•°åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ•°åˆ—ä¸ºç­‰å·®æ•°åˆ—:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span></span><br><span class="line"><span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span></span><br><span class="line"><span class="number">3</span>, -<span class="number">1</span>, -<span class="number">5</span>, -<span class="number">9</span></span><br></pre></td></tr></tbody></table></figure></div><p>ä»¥ä¸‹æ•°åˆ—ä¸æ˜¯ç­‰å·®æ•°åˆ—ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p>æ•°ç»„ A åŒ…å« N ä¸ªæ•°ï¼Œä¸”ç´¢å¼•ä»0å¼€å§‹ã€‚æ•°ç»„ A çš„ä¸€ä¸ªå­æ•°ç»„åˆ’åˆ†ä¸ºæ•°ç»„ (P, Q)ï¼ŒP ä¸ Q æ˜¯æ•´æ•°ä¸”æ»¡è¶³ 0<=P<q<n ã€‚< p></q<n></p><p>å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™ç§°å­æ•°ç»„(P, Q)ä¸ºç­‰å·®æ•°ç»„ï¼š</p><p>å…ƒç´  A[P], A[p + 1], â€¦, A[Q - 1], A[Q] æ˜¯ç­‰å·®çš„ã€‚å¹¶ä¸” P + 1 < Q ã€‚</p><p>å‡½æ•°è¦è¿”å›æ•°ç»„ A ä¸­æ‰€æœ‰ä¸ºç­‰å·®æ•°ç»„çš„å­æ•°ç»„ä¸ªæ•°ã€‚</p><p> <strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">A = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">è¿”å›: <span class="number">3</span>, A ä¸­æœ‰ä¸‰ä¸ªå­ç­‰å·®æ•°ç»„: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] ä»¥åŠè‡ªèº« [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p>dpçš„é¢˜å•Šï¼Œç­”æ¡ˆä¸€çœ‹å°±æ˜ç™½ï¼Œå°±æ˜¯è‡ªå·±æƒ³ä¸åˆ°ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numberOfArithmeticSlices</span><span class="params">(<span class="keyword">int</span>[] A)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(A.length<<span class="number">3</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//dp[i]=dp[i-1]+1;</span></span><br><span class="line">    <span class="keyword">int</span> []dp=<span class="keyword">new</span> <span class="keyword">int</span>[A.length]; <span class="comment">//ä»¥ A[i] ç»“å°¾çš„ç­‰å·®æ•°åˆ—æœ‰å¤šå°‘ä¸ª</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<a.length;i++) {< span><br><span class="line">        <span class="keyword">if</span>(A[i]-A[i-<span class="number">1</span>]==A[i-<span class="number">1</span>]-A[i-<span class="number">2</span>]){</span><br><span class="line">            dp[i]=dp[i-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<dp.length;i++) {< span><br><span class="line">        res+=dp[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></dp.length;i++)></span></a.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å°±æ˜¯æ²¡æƒ³åˆ°è¦å¯¹ä»¥å½“å‰å…ƒç´ ç»“å°¾çš„åŠ¨æ€æ•°ç»„æ•°é‡åšdpï¼Œå½“ç„¶ä¸Šé¢çš„åšæ³•çš„ç©ºé—´è¿˜å¯ä»¥ä¼˜åŒ–æˆO(1)çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numberOfArithmeticSlices2</span><span class="params">(<span class="keyword">int</span>[] A)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(A.length<<span class="number">3</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//dp[i]=dp[i-1]+1;</span></span><br><span class="line">    <span class="keyword">int</span> dp=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<a.length;i++) {< span><br><span class="line">        <span class="keyword">if</span>(A[i]-A[i-<span class="number">1</span>]==A[i-<span class="number">1</span>]-A[i-<span class="number">2</span>]){</span><br><span class="line">            dp=dp+<span class="number">1</span>;</span><br><span class="line">            res+=dp;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            dp=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></a.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>åªéœ€è¦æ ¹æ®ä¸Šä¸€æ¬¡çš„dpå€¼æ›´æ–°å°±è¡Œï¼Œå¦‚æœbreakç­‰å·®æ•°åˆ—ï¼Œå°±ç½®ä¸º0</p><hr><h2 id="343-æ•´æ•°æ‹†åˆ†"><a href="#343-æ•´æ•°æ‹†åˆ†" class="headerlink" title="343. æ•´æ•°æ‹†åˆ†"></a><a href="https://leetcode-cn.com/problems/integer-break/" target="_blank" rel="noopener">343. æ•´æ•°æ‹†åˆ†</a></h2><p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•° nï¼Œå°†å…¶æ‹†åˆ†ä¸º<strong>è‡³å°‘</strong>ä¸¤ä¸ªæ­£æ•´æ•°çš„å’Œï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚ è¿”å›ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br><span class="line">è§£é‡Š: <span class="number">2</span> = <span class="number">1</span> + <span class="number">1</span>, <span class="number">1</span> Ã— <span class="number">1</span> = <span class="number">1</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">10</span></span><br><span class="line">è¾“å‡º: <span class="number">36</span></span><br><span class="line">è§£é‡Š: <span class="number">10</span> = <span class="number">3</span> + <span class="number">3</span> + <span class="number">4</span>, <span class="number">3</span> Ã— <span class="number">3</span> Ã— <span class="number">4</span> = <span class="number">36</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong> ä½ å¯ä»¥å‡è®¾ n ä¸å°äº 2 ä¸”ä¸å¤§äº 58ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>åˆ«é—®ï¼Œé—®å°±æ˜¯æš´åŠ›</p><p><img alt="leetCodeé¢˜è§£97wgl" data-src="http://static.imlgw.top/blog/20190822/BKqmfoXMVq3Q.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>é€’æ¨å¼ï¼š</strong> <code>F(n) = max {i * F(n - i)}ï¼Œi = 1ï¼Œ2ï¼Œ...ï¼Œn - 1</code>  </p><p>ç©·ä¸¾æ¯ä¸€ç§åˆ†è§£æƒ…å†µï¼Œæ±‚æœ€å¤§å€¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">integerBreak</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="comment">//é€’å½’å‡ºå£</span></span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">2</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<n;j++) {< span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªMaxæ±‚æœ€å¤§å€¼ï¼Œç¬¬äºŒä¸ªMaxä¸»è¦æ˜¯ä¸ºäº†è€ƒè™‘ åªåˆ†ä¸¤ä¸ªæ•°å°±æ˜¯æœ€å¤§å€¼çš„æƒ…å†µï¼ˆ<=7çš„æƒ…å†µï¼‰</span></span><br><span class="line">        res=Math.max(res, Math.max((n-j)*j,integerBreak(n-j)*j));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></n;j++)></span></pre></td></tr></tbody></table></figure></div><p>éœ€è¦æ³¨æ„çš„å°±æ˜¯ç¬¬äºŒä¸ªMax åˆ«å¿˜äº†<strong>åªåˆ†ä¸ºä¸¤ä¸ªæ•°å°±åˆ°è¾¾æœ€å¤§å€¼</strong>çš„æƒ…å†µï¼Œæ¯”å¦‚n<=7çš„æ—¶å€™ï¼Œ<code>integerBreak(n-j)*j)</code>  è‡³å°‘æ˜¯ä¸‰ä¸ªï¼Œä¸‹é¢çš„DPä¹Ÿæ˜¯ä¸€æ ·çš„è¦æ³¨æ„åˆ«å¿˜äº†ä¸¤ä¸ªæ•°çš„æƒ…å†µ</p><p>é€’å½’çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯<code>O(N!)</code> ï¼Œåé¢çš„caseä¼šè¶…æ—¶ï¼Œå…¶å®å¾ˆæ˜æ˜¾ï¼Œé€’å½’è¿‡ç¨‹ä¸­ä¼šæœ‰å¾ˆå¤šçš„é‡å¤è®¡ç®—æ‰€ä»¥å¯ä»¥é‡‡ç”¨è®°å¿†åŒ–é€’å½’ç¼“å­˜ä¸€ä¸‹ä¹‹å‰çš„å€¼ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span>  Integer[] cache=<span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//åªé¡¶å‘ä¸‹,è®°å¿†åŒ–é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">int</span> <span class="title">integerBreak</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> breakInteger(n);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">int</span> <span class="title">breakInteger</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (cache[n]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[n];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//é€’å½’å‡ºå£</span></span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">2</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<n;j++) {< span><br><span class="line">        res=Math.max(res, Math.max((n-j)*j,breakInteger(n-j)*j));</span><br><span class="line">    }</span><br><span class="line">    cache[n]=res;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></n;j++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·çš„è§£æ³•æ˜¯å¯ä»¥ACçš„ï¼Œç¼“å­˜ä¹‹å‰è®¡ç®—çš„ç»“æœï¼Œé¿å…äº†é‡å¤çš„è®¡ç®—</p><p><strong>è§£æ³•äºŒ</strong></p><p>åŠ¨æ€è§„åˆ’ï¼Œç»“åˆä¸Šé¢çš„é€’å½’å¾—åˆ°<code>é€’æ¨æ–¹ç¨‹</code></p><p><code>dp[i] = max(dp[i]ï¼Œmax(dp[ i-j ] * j ï¼Œ(i-j) * j));</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">integerBreak2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (n==<span class="number">2</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> [] dp=<span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">2</span>]=<span class="number">1</span>; <span class="comment">//0,1ä¸è€ƒè™‘</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">3</span>;i<=n;i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<i;j++) {< span><br><span class="line">            dp[i]=Math.max(dp[i],Math.max(dp[i-j]*j,(i-j)*j));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">}</span><br></i;j++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰</strong></p><p>æ‰“æ¿æ‰¾è§„å¾‹ï¼Œç¬”è¯•çš„æ—¶å€™èƒ½ç›´æ¥ä¸€çœ¼çœ‹å‡ºæ¥è§„å¾‹çš„è‚¯å®šä¼˜å…ˆæ‰¾è§„å¾‹äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">integerBreak3</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] base={<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">12</span>};</span><br><span class="line">    <span class="keyword">if</span>(n<=<span class="number">7</span>){</span><br><span class="line">        <span class="keyword">return</span> base[n-<span class="number">2</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">2</span>]=base[<span class="number">0</span>];</span><br><span class="line">    dp[<span class="number">3</span>]=base[<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">4</span>]=base[<span class="number">2</span>];</span><br><span class="line">    dp[<span class="number">5</span>]=base[<span class="number">3</span>];</span><br><span class="line">    dp[<span class="number">6</span>]=base[<span class="number">4</span>];</span><br><span class="line">    dp[<span class="number">7</span>]=base[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">8</span>;i<=n;i++) {</span><br><span class="line">        dp[i]=dp[i-<span class="number">3</span>]*<span class="number">3</span>; <span class="comment">//N>7ä¹‹å dp[N]=dp[N-3]*3</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•å››</strong></p><p>æ•°å­¦åˆ†æï¼Œå…¶å®åˆ†æä¸€ä¸‹ä¼šå‘ç°ï¼Œåªæœ‰2å’Œ3æ˜¯åˆ†è§£åå€¼æ¯”<strong>æœ¬èº«è¿˜è¦å°</strong>çš„ï¼Œ4åˆ†è§£åç›¸ç­‰ï¼Œè¿™æ ·ä¸€åˆ†æï¼Œä»æ•´ä½“ä¸Šæ¥çœ‹å…¶å®å°±æ¸…æ¥šäº†ï¼Œåªè¦åˆ†åˆ°2æˆ–è€…3çš„æ—¶å€™å°±ä¸å†åˆ†å°±è¡Œäº†ï¼Œæ­¤æ—¶çš„å€¼ä¸€å®šæ˜¯æœ€å¤§å€¼ï¼Œå¦‚æœ2ï¼Œ3ç»§ç»­åˆ†å€¼å°±ä¼šå‡å°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">integerBreak</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] base={<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>};</span><br><span class="line">    <span class="keyword">if</span>(n<=<span class="number">4</span>){</span><br><span class="line">        <span class="keyword">return</span> base[n-<span class="number">2</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n>=<span class="number">5</span>){</span><br><span class="line">        res*=<span class="number">3</span>;</span><br><span class="line">        n-=<span class="number">3</span>;</span><br><span class="line">    }</span><br><span class="line">    res*=n;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><hr><h2 id="279-å®Œå…¨å¹³æ–¹æ•°"><a href="#279-å®Œå…¨å¹³æ–¹æ•°" class="headerlink" title="279. å®Œå…¨å¹³æ–¹æ•°"></a><a href="https://leetcode-cn.com/problems/perfect-squares/" target="_blank" rel="noopener">279. å®Œå…¨å¹³æ–¹æ•°</a></h2><p>ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, â€¦ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: n = <span class="number">12</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span> </span><br><span class="line">è§£é‡Š: <span class="number">12</span> = <span class="number">4</span> + <span class="number">4</span> + <span class="number">4</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: n = <span class="number">13</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line">è§£é‡Š: <span class="number">13</span> = <span class="number">4</span> + <span class="number">9</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>åŠ¨æ€è§„åˆ’ï¼Œä¸å®¹æ˜“å•Šï¼Œè‡ªå·±æ¨å‡ºäº†DPæ–¹ç¨‹ï¼Œæ²¡çœ‹ç­”æ¡ˆï¼Œå…¶å®ä¹Ÿå€Ÿé‰´äº†ä¸Šä¸€é¢˜çš„æ€è·¯</p><p><code>dp[i] =min(dp[i]ï¼Œdp[i-j*j]+1)</code> </p><p>å…¶å®ä¹Ÿæ˜¯å°†æ•´æ•°æ‹†åˆ†ï¼Œä¸è¿‡æ‹†åˆ†çš„æ—¶å€™æŒ‰ç…§ <strong>å®Œå…¨å¹³æ–¹æ•°</strong> æ¥æ‹†åˆ†ï¼Œå®Œå…¨å¹³æ–¹æ•°çš„è‚¯å®šæ˜¯ 1æ‰€ä»¥æœ€åè¦åŠ ä¸ª 1</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numSquares</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=n;i++) {</span><br><span class="line">        dp[i]=Integer.MAX_VALUE; <span class="comment">//dp[i]åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;i>=j*j;++j){</span><br><span class="line">            dp[i]=Math.min(dp[i],dp[i-j*j]+<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>50%å·¦å³ï¼Œçœ‹äº†ä¸‹æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯ <code>O(N^1.5)</code>  è¿˜æ˜¯æŒºé«˜çš„ï¼ˆè¯„è®ºåŒºç”¨Pyçš„éƒ½è¶…æ—¶äº†ï¼‰</p><p><strong>è§£æ³•äºŒ</strong></p><p>BFSï¼Œå°†æ•°å­—æŒ‰ç…§å®Œå…¨å¹³æ–¹æ•°è¿æ¥ä¸ºä¸€ä¸ªå›¾ï¼Œç„¶åBFSæ±‚ä¸€ä¸ªä»nåˆ°0çš„æœ€çŸ­çš„è·¯å¾„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numSquares</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    Queue<pair> queue=<span class="keyword">new</span> LinkedList<>();</pair></span><br><span class="line">    <span class="keyword">boolean</span>[] visit=<span class="keyword">new</span> <span class="keyword">boolean</span>[n+<span class="number">1</span>];</span><br><span class="line">    queue.add(<span class="keyword">new</span> Pair(n,<span class="number">0</span>));</span><br><span class="line">    visit[n]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">while</span>(!queue.isEmpty()){</span><br><span class="line">        Pair pair=queue.poll();</span><br><span class="line">        <span class="keyword">int</span> num=pair.num;</span><br><span class="line">        <span class="keyword">int</span> step=pair.step;</span><br><span class="line">        <span class="keyword">if</span> (num==<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">return</span> step;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i*i<=num;i++) {</span><br><span class="line">            <span class="keyword">int</span> temp=num-i*i;</span><br><span class="line">            <span class="keyword">if</span> (!visit[temp]) {</span><br><span class="line">                queue.add(<span class="keyword">new</span> Pair(temp,step+<span class="number">1</span>));</span><br><span class="line">                visit[temp]=<span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> step;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(<span class="keyword">int</span> num,<span class="keyword">int</span> step)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.num=num;</span><br><span class="line">        <span class="keyword">this</span>.step=step;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜æœ€å¿«çš„åšæ³•åº”è¯¥æ˜¯åˆ©ç”¨ <strong>å››å¹³æ–¹å’Œå®šç†</strong> æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œæ‰€ä»¥æš‚æ—¶å…ˆä¸ç ”ç©¶è¿™ç§åšæ³•</p><h2 id="91-è§£ç æ–¹æ³•"><a href="#91-è§£ç æ–¹æ³•" class="headerlink" title="91. è§£ç æ–¹æ³•"></a><a href="https://leetcode-cn.com/problems/decode-ways/" target="_blank" rel="noopener">91. è§£ç æ–¹æ³•</a></h2><p>ä¸€æ¡åŒ…å«å­—æ¯ A-Z çš„æ¶ˆæ¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œäº†ç¼–ç ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">'A'</span> -> <span class="number">1</span></span><br><span class="line"><span class="string">'B'</span> -> <span class="number">2</span></span><br><span class="line">...</span><br><span class="line"><span class="string">'Z'</span> -> <span class="number">26</span></span><br></pre></td></tr></tbody></table></figure></div><p>ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„éç©ºå­—ç¬¦ä¸²ï¼Œè¯·è®¡ç®—è§£ç æ–¹æ³•çš„æ€»æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"12"</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line">è§£é‡Š: å®ƒå¯ä»¥è§£ç ä¸º <span class="string">"AB"</span>ï¼ˆ<span class="number">1</span> <span class="number">2</span>ï¼‰æˆ–è€… <span class="string">"L"</span>ï¼ˆ<span class="number">12</span>ï¼‰ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"226"</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br><span class="line">è§£é‡Š: å®ƒå¯ä»¥è§£ç ä¸º <span class="string">"BZ"</span> (<span class="number">2</span> <span class="number">26</span>), <span class="string">"VF"</span> (<span class="number">22</span> <span class="number">6</span>), æˆ–è€… <span class="string">"BBF"</span> (<span class="number">2</span> <span class="number">2</span> <span class="number">6</span>) ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å“‡ï¼Œè¿™é¢˜æˆ‘åäº†ï¼Œå¥½ä¸å®¹æ˜“çœ‹å‡ºæ¥äº†é€’æ¨å…¬å¼ï¼Œè¢«è¾¹ç•Œç»™æ•´æ­»äº†ã€‚ã€‚ã€‚é¢å‘æµ‹è¯•ç”¨ä¾‹ç¼–ç¨‹ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numDecodings</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s.startsWith(<span class="string">"0"</span>)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] s_nums=<span class="keyword">new</span> <span class="keyword">int</span>[s.length()];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        s_nums[i]=Integer.valueOf(s.charAt(i)-<span class="number">48</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] dp =<span class="keyword">new</span> <span class="keyword">int</span>[s_nums.length];</span><br><span class="line">    Arrays.fill(dp,<span class="number">1</span>);</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<s_nums.length;j++) {< span><br><span class="line">        <span class="keyword">if</span>(s_nums[j]==<span class="number">0</span> && s_nums[j-<span class="number">1</span>]==<span class="number">0</span> || (s_nums[j]==<span class="number">0</span> && s_nums[j-<span class="number">1</span>]><span class="number">2</span>)){</span><br><span class="line">            <span class="comment">//ç›´æ¥return</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>( s_nums[j]==<span class="number">0</span> || s_nums[j-<span class="number">1</span>]==<span class="number">0</span> || (j<s_nums.length-<span class="number">1</s_nums.length-<span></span> &&s_nums[j+<span class="number">1</span>]==<span class="number">0</span>)){</s_nums.length;j++)></span><br><span class="line">            <span class="comment">//ä¸ºäº†å¤„ç† 12120è¿™ç§æƒ…å†µ</span></span><br><span class="line">            res*=dp[j-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(s_nums[j-<span class="number">1</span>]*<span class="number">10</span>+s_nums[j]<=<span class="number">26</span>){</span><br><span class="line">            <span class="keyword">if</span>(j==<span class="number">1</span>){</span><br><span class="line">                dp[j]=<span class="number">2</span>;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[j]=dp[j-<span class="number">1</span>]+dp[j-<span class="number">2</span>];    </span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//åˆ’åˆ†ç‚¹ã€‚ã€‚ã€‚</span></span><br><span class="line">            res*=dp[j-<span class="number">1</span>];</span><br><span class="line">            dp[j-<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">            dp[j]=<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æœ€åä¸€æ®µ</span></span><br><span class="line">    res*=dp[s_nums.length-<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>é¦–å…ˆè¦æ¨å‡ºè¿™é¢˜çš„é€’æ¨å…¬å¼ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨çº¸ä¸Šç”»äº†åŠå¤©æ‰çœ‹å‡ºæ¥ï¼Œå¦‚æœè¿™ä¸ªæ•°ç»„å‰åä¸¤ä¸ªå…ƒç´ ä¹‹å’Œéƒ½æ˜¯å°äº26çš„é‚£ä¹ˆè¿™ä¸€æ®µçš„ç¼–ç æ–¹å¼å°±æ˜¯ä¸€ä¸ª<strong>æ–æ³¢æ‹‰å¥‘æ•°åˆ—</strong> ï¼Œä¹Ÿå°±æ˜¯ <code>dp[i]=dp[i-1]+dp[i-2]</code></p><p>80%å·¦å³ï¼Œè¿™é¢˜å…¶å®ä¸€å¼€å§‹å¹¶ä¸æ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘è§‰å¾—æˆ‘å¼€å§‹çš„æ€è·¯è¿˜æ˜¯æŒºå¥½çš„ï¼Œå°†å­—ç¬¦ä¸²åˆ†æ®µï¼Œå½“å‰ä¸€ä¸ªå’Œåä¸€ä¸ªæ— æ³•åˆå¹¶çš„æ—¶å€™å°±ä½œä¸ºä¸€ä¸ªåˆ†ç•Œç‚¹ï¼Œæœ€åå°†æ¯ä¸€æ®µçš„ç¼–ç æ–¹å¼ç›¸ä¹˜å°±æ˜¯ç»“æœäº†ã€‚</p><p>ä½†æ˜¯ ï¼ï¼ï¼ æˆ‘å¿½ç•¥äº†0è¿™ä¸ªä¸œè¥¿äº†ï¼Œè¿™é¢˜åé¢ç»™çš„caseé‡Œé¢éƒ½æ˜¯å¸¦æœ‰0çš„ï¼ï¼ï¼ï¼å¤„ç†è¿™ä¸ªè¾¹ç•Œå¤„ç†äº†ä¸€ä¸Šåˆç»ˆäºè·‘è¿‡äº†ã€‚ã€‚ã€‚ä»£ç ä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå†™çš„å¤ªçƒ‚äº†ï¼Œè¿™ç§ä»£ç æ²¡å•¥æ„ä¹‰ï¼Œéƒ½æ˜¯èµ°ä¸€æ­¥çœ‹ä¸€æ­¥ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numDecodings2</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s.startsWith(<span class="string">"0"</span>)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] s_nums=<span class="keyword">new</span> <span class="keyword">int</span>[s.length()];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        s_nums[i]=Integer.valueOf(s.charAt(i)-<span class="number">48</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[s.length()+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<=s.length();i++) {</span><br><span class="line">        <span class="keyword">int</span> a=s_nums[i-<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(a!=<span class="number">0</span>){</span><br><span class="line">            <span class="comment">//åˆ°è¿™é‡Œdp[i]==0,æ²¡æœ‰åˆå§‹åŒ–,é»˜è®¤å°±æ˜¯0</span></span><br><span class="line">            <span class="comment">//å…¶å®ç­‰ä»·äºdp[i]=dp[i-1],å»¶ç»­å‰ä¸€ä¸ªå­—ç¬¦çš„çŠ¶æ€</span></span><br><span class="line">            dp[i]+=dp[i-<span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(s_nums[i-<span class="number">2</span>]==<span class="number">0</span>){</span><br><span class="line">            <span class="comment">//å¦‚æœå‰å‰ä¸€ä¸ªå­—ç¬¦ä¸º0é‚£ä¹ˆå°±ä¸ç”¨dpäº†,ä¿æŒi-1çš„çŠ¶æ€å°±OK</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‰å‰ä¸€ä¸ªå­—ç¬¦å’Œ</span></span><br><span class="line">        <span class="keyword">int</span> b=s_nums[i-<span class="number">2</span>]*<span class="number">10</span>+s_nums[i-<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(b<=<span class="number">26</span>){</span><br><span class="line">            dp[i]+=dp[i-<span class="number">2</span>]; <span class="comment">//ä¸Šä¸‹è¿™ä¸¤ä¸ªdpå¿…é¡»æ‰§è¡Œä¸€ä¸ªå¦åˆ™æœ€åå°± return 0</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[s_nums.length];</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™ç§å†™æ³•å°±æ¸…æ™°å¤šäº†ï¼Œåˆ†æå„ç§æƒ…å†µï¼Œdpä»£è¡¨æˆªè‡³å­—ç¬¦çš„ç¼–ç æ–¹å¼</p><p>ğŸ’¬  <code>s_num[i-1]!=0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1] <=26</code>  </p><p>ç±»ä¼¼äº <strong>112</strong>  è¿™æ ·çš„ï¼Œè¿™å°±æ˜¯æ­£å¸¸dpçš„æƒ…å†µç¬¦åˆæ–æ³¢æ‹‰å¥‘æ•°åˆ—</p><p>ğŸ’¬  <code>s_num[i-1]==0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1] <=26</code></p><p>ç±»ä¼¼äº <strong>102</strong> è¿™æ ·çš„ï¼Œè¿™æ ·å°±ç›´æ¥<code>ç»§æ‰¿ dp[i-2]çš„çŠ¶æ€</code>å°±è¡Œäº†ï¼Œç›¸å½“äº<code>dp[i]=dp[i-2]</code></p><p>ğŸ’¬  <code>s_num[i-1]!=0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1] >26</code></p><p>ç±»ä¼¼äº <strong>132</strong> è¿™æ ·çš„ï¼Œè¿™æ ·å°±ç›´æ¥<code>ç»§æ‰¿ dp[i-2]çš„çŠ¶æ€</code>å°±è¡Œäº†ï¼Œç›¸å½“äº<code>dp[i]=dp[i-2]</code></p><p>ğŸ’¬ <code>s_num[i-1]!=0 && s_num[i-2]==0 && s_num[i-2]+s_num[i-1] <=26</code></p><p>ç±»ä¼¼äº <strong>â€¦012</strong>è¿™æ ·çš„ï¼Œ<code>dp[i]=dp[i-1]</code></p><p>ğŸ’¬ <code>s_num[i-1]==0 && s_num[i-2]==0</code> æˆ–è€…<code>s_num[i-1]==0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1]>26</code></p><p>ç±»ä¼¼äº<strong>00</strong> å’Œ<strong>30</strong> è¿™æ ·çš„ï¼Œ è¿™æ ·å°±ä»£è¡¨è¿™ä¸ªå­—ç¬¦ä¸²æ— æ³•ç¼–ç äº† <strong>dp[i]=0</strong> æœ€åè¿”å›çš„å°±æ˜¯0</p><hr><h2 id="300-æœ€é•¿ä¸Šå‡å­åºåˆ—"><a href="#300-æœ€é•¿ä¸Šå‡å­åºåˆ—" class="headerlink" title="300. æœ€é•¿ä¸Šå‡å­åºåˆ—"></a><a href="https://leetcode-cn.com/problems/longest-increasing-subsequence/" target="_blank" rel="noopener">300. æœ€é•¿ä¸Šå‡å­åºåˆ—</a></h2><p>ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">10</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">101</span>,<span class="number">18</span>]</span><br><span class="line">è¾“å‡º: <span class="number">4</span> </span><br><span class="line">è§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">101</span>]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ <span class="number">4</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚</li><li>ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º O(n2) ã€‚</li><li>è¿›é˜¶: ä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° O(n log n) å—?</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>LISï¼Œè¿™é¢˜å¥½åƒåœ¨å¾ˆå¤šåœ°æ–¹è§åˆ°è¿‡äº†ï¼Œè¿˜æ˜¯è¦å¥½å¥½ç†è§£ä¸‹ï¼Œ<strong>dp[i]è¡¨ç¤ºä»¥å½“å‰å…ƒç´ ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lengthOfLIS</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="comment">//Arrays.fill(dp,1);</span></span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        dp[i]=<span class="number">1</span>; <span class="comment">//åˆå§‹åŒ–dp[i]=1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<i;j++) {< span><br><span class="line">            <span class="keyword">if</span>(nums[i]>nums[j]){</span><br><span class="line">                <span class="comment">//éå†iä¹‹å‰çš„å…ƒç´ ,æ‰¾ä¸€ä¸ªæœ€å¤§çš„dp[j]+1</span></span><br><span class="line">                dp[i]=Math.max(dp[j]+<span class="number">1</span>,dp[i]);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<dp.length;i++) {< span><br><span class="line">        res=res>dp[i]?res:dp[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></dp.length;i++)></span></i;j++)></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>ä¸€å¼€å§‹é¢˜ç›®å°±æ²¡çœ‹æ¸…æ¥šå°±å¼€å§‹åšï¼Œä»¥ä¸ºæ˜¯è¿ç»­çš„ï¼Œå¿ƒæƒ³è¿™ä¸æ˜¯O(N)çš„ä¹ˆï¼Œä¸ºå•¥è¦æˆ‘å†™O(N^2)çš„ğŸ¤£ </p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190824/86VLMN8VWcpI.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>çµé­‚ç”»æ‰‹ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€é“å¾ˆç®€å•çš„DP(ç„¶è€Œæˆ‘è¿˜æ˜¯æ²¡æƒ³å‡ºæ¥)ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜O(N^2)ï¼Œå¯ä»¥ä¼˜åŒ–æˆO(NlogN)</p><p><strong>è§£æ³•äºŒ</strong></p><p><code>è´ªå¿ƒ+äºŒåˆ†</code>  è¿™ä¸ªè´ªå¿ƒè¿˜æ˜¯æœ‰ç‚¹éªšçš„ï¼Œæ ¸å¿ƒæ€æƒ³ï¼š</p><p><strong>å¦‚æœå‰é¢çš„æ•°è¶Šå°ï¼Œåé¢æ¥ä¸Šä¸€ä¸ªéšæœºæ•°ï¼Œå°±ä¼šæœ‰æ›´å¤§çš„å¯èƒ½æ€§æ„æˆä¸€ä¸ªæ›´é•¿çš„â€œä¸Šå‡å­åºåˆ—â€ã€‚</strong></p><p>è€Œ<code>tail[i]</code> ä¸­å­˜å‚¨é•¿åº¦ä¸º <code>i + 1</code> çš„æœ€é•¿é€’å¢å­åºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥æœ€ålenå°±æ˜¯æ•´ä¸ªæ•°ç»„çš„æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼Œæ›´å¤šé¢˜è§£å¯ä»¥ å‚è€ƒ<a href="https://leetcode-cn.com/problems/longest-increasing-subsequence/solution/dong-tai-gui-hua-er-fen-cha-zhao-tan-xin-suan-fa-p/" target="_blank" rel="noopener">LeetCodeé¢˜è§£</a> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lengthOfLIS</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] tail = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) {</span><br><span class="line">        <span class="keyword">int</span> index=binarySearch(tail,len,num); </span><br><span class="line">        <span class="comment">//æœ€éš¾ç†è§£çš„å°±æ˜¯è¿™ä¸€æ­¥ï¼Œç›´æ¥æ›¿æ¢äº†åŸæ•°ç»„é‡Œé¢çš„å¯¹åº”çš„å…ƒç´ </span></span><br><span class="line">        <span class="comment">//æŒ‰ç…§è´ªå¿ƒçš„è§„åˆ™,å°†indexä½ç½®çš„å…ƒç´ å˜å°ï¼Œæˆ–è€…æ·»åŠ åˆ°é˜Ÿå°¾</span></span><br><span class="line">        tail[index] = num;</span><br><span class="line">        <span class="keyword">if</span> (index == len) {</span><br><span class="line">            len++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> len;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›targetå¯ä»¥æ’å…¥çš„ä½ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> len, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> l=<span class="number">0</span>,r=len-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(l<=r){</span><br><span class="line">        <span class="keyword">int</span> mid=l+(r-l)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(target<nums[mid]){< span><br><span class="line">            r=mid-<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(target>nums[mid]){</span><br><span class="line">            l=mid+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">}</span><br></nums[mid]){<></span></pre></td></tr></tbody></table></figure></div><h2 id="53-æœ€å¤§å­åºå’Œ"><a href="#53-æœ€å¤§å­åºå’Œ" class="headerlink" title="53. æœ€å¤§å­åºå’Œ"></a><a href="https://leetcode-cn.com/problems/maximum-subarray/" target="_blank" rel="noopener">53. æœ€å¤§å­åºå’Œ</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [-<span class="number">2</span>,<span class="number">1</span>,-<span class="number">3</span>,<span class="number">4</span>,-<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,-<span class="number">5</span>,<span class="number">4</span>],</span><br><span class="line">è¾“å‡º: <span class="number">6</span></span><br><span class="line">è§£é‡Š: è¿ç»­å­æ•°ç»„ [<span class="number">4</span>,-<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>] çš„å’Œæœ€å¤§ï¼Œä¸º <span class="number">6</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶:</strong></p><p>å¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>åŠ¨æ€è§„åˆ’é€’æ¨çš„è§£æ³•ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œè¿™é¢˜å…¶å®è¿˜æœ‰ä¸€é“å§Šå¦¹é¢˜ï¼Œè¦æ±‚å‡ºæœ€å¤§å­åºåˆ—ï¼Œä¸ä»…ä»…æ˜¯æœ€å¤§å€¼ï¼Œ<a href="(http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou-tag/#239-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC)">æˆ‘æ”¾åˆ°äº†æ»‘åŠ¨çª—å£ä¸“é¢˜ä¸­</a> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™æ¬¡æ˜¯ç›´æ¥åœ¨Webä¸Šå†™çš„</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxSubArray</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span> || nums.length==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="comment">//ä¸€å¼€å§‹æ²¡å¤„ç†å¥½Waäº†ä¸€å‘</span></span><br><span class="line">    <span class="keyword">int</span> max=dp[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++){< span><br><span class="line">        <span class="keyword">if</span>(dp[i-<span class="number">1</span>]<=<span class="number">0</span>){</span><br><span class="line">            dp[i]=nums[i];</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            dp[i]=dp[i-<span class="number">1</span>]+nums[i];</span><br><span class="line">        }</span><br><span class="line">        max=Math.max(max,dp[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>æ ¹æ®äºŒç»´æ”¹ä¸€ç»´</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxSubArray</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span> || nums.length==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> dp1=nums[<span class="number">0</span>],dp2=<span class="number">0</span>,max=nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (dp1<=<span class="number">0</span>) {</span><br><span class="line">            dp2=nums[i];</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            dp2=dp1+nums[i];</span><br><span class="line">        }</span><br><span class="line">        dp1=dp2;</span><br><span class="line">        max=Math.max(max,dp2);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ„Ÿè§‰ä¸€ç»´çš„ä¸ç”¨å»ç†è§£å«ä¹‰ï¼Œèƒ½æ ¹æ®äºŒç»´æ”¹å‡ºæ¥å°±okäº†ï¼Œé‡ç‚¹æ˜¯ç†è§£å¤šç»´çš„</p><h2 id="646-æœ€é•¿æ•°å¯¹é“¾"><a href="#646-æœ€é•¿æ•°å¯¹é“¾" class="headerlink" title="646. æœ€é•¿æ•°å¯¹é“¾"></a><a href="https://leetcode-cn.com/problems/maximum-length-of-pair-chain/" target="_blank" rel="noopener">646. æœ€é•¿æ•°å¯¹é“¾</a></h2><p>ç»™å‡º <code>n</code> ä¸ªæ•°å¯¹ã€‚ åœ¨æ¯ä¸€ä¸ªæ•°å¯¹ä¸­ï¼Œç¬¬ä¸€ä¸ªæ•°å­—æ€»æ˜¯æ¯”ç¬¬äºŒä¸ªæ•°å­—å°ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ç§è·Ÿéšå…³ç³»ï¼Œå½“ä¸”ä»…å½“ <code>b < c</code> æ—¶ï¼Œæ•°å¯¹<code>(c, d)</code> æ‰å¯ä»¥è·Ÿåœ¨ <code>(a, b)</code> åé¢ã€‚æˆ‘ä»¬ç”¨è¿™ç§å½¢å¼æ¥æ„é€ ä¸€ä¸ªæ•°å¯¹é“¾ã€‚</p><p>ç»™å®šä¸€ä¸ªå¯¹æ•°é›†åˆï¼Œæ‰¾å‡ºèƒ½å¤Ÿå½¢æˆçš„æœ€é•¿æ•°å¯¹é“¾çš„é•¿åº¦ã€‚ä½ ä¸éœ€è¦ç”¨åˆ°æ‰€æœ‰çš„æ•°å¯¹ï¼Œä½ å¯ä»¥ä»¥ä»»ä½•é¡ºåºé€‰æ‹©å…¶ä¸­çš„ä¸€äº›æ•°å¯¹æ¥æ„é€ ã€‚</p><p><strong>ç¤ºä¾‹ :</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [[<span class="number">1</span>,<span class="number">2</span>], [<span class="number">2</span>,<span class="number">3</span>], [<span class="number">3</span>,<span class="number">4</span>]]</span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line">è§£é‡Š: æœ€é•¿çš„æ•°å¯¹é“¾æ˜¯ [<span class="number">1</span>,<span class="number">2</span>] -> [<span class="number">3</span>,<span class="number">4</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>ç»™å‡ºæ•°å¯¹çš„ä¸ªæ•°åœ¨ [1, 1000] èŒƒå›´å†…ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>åŠ¨æ€è§„åˆ’</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findLongestChain</span><span class="params">(<span class="keyword">int</span>[][] pairs)</span> </span>{</span><br><span class="line">    Arrays.sort(pairs,(a,b)->a[<span class="number">0</span>]-b[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[pairs.length];</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<pairs.length;i++) {< span><br><span class="line">        dp[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<i;j++) {< span><br><span class="line">            <span class="keyword">if</span> (pairs[i][<span class="number">0</span>]>pairs[j][<span class="number">1</span>]) {</span><br><span class="line">                dp[i]=Math.max(dp[i],dp[j]+<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        res=res>dp[i]?res:dp[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></i;j++)></span></pairs.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ³¨æ„è¿™é‡Œæ²¡æœ‰è¦æ±‚é¡ºåºï¼Œæ‰€ä»¥å…ˆç»™ä»–æ’ä¸ªåºï¼Œç„¶åå†è¿›è¡ŒDPï¼Œå¦‚æœä¸æ’åºå¾ˆéš¾dpï¼Œdp[i]è¡¨ç¤ºå½“å‰æ•°å¯¹èƒ½æ„æˆçš„æœ€é•¿é“¾ï¼Œdpè¿‡ç¨‹å’Œä¸Šé¢çš„æœ€é•¿ä¸Šå‡å­åºåˆ—ç›¸åŒ</p><p><strong>è§£æ³•äºŒ</strong></p><p>è´ªå¿ƒï¼Œä¹Ÿæ˜¯æœ€ä¼˜è§£ï¼ŒåŒæ ·å…ˆæ’åºï¼Œä¸è¿‡æ˜¯æŒ‰ç…§ç¬¬äºŒä¸ªå…ƒç´ æ¥æ’åºï¼Œæ ¸å¿ƒæ€æƒ³</p><p><code>æ¯æ¬¡éƒ½åœ¨åˆ—è¡¨ä¸­æ‰¾ç¬¬äºŒä¸ªå…ƒç´ æœ€å°çš„æ•°å¯¹ä¾æ¬¡ç»„æˆé“¾ï¼Œæœ€åå¾—åˆ°çš„ä¸€å®šæ˜¯æœ€é•¿çš„é“¾</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findLongestChain</span><span class="params">(<span class="keyword">int</span>[][] pairs)</span> </span>{</span><br><span class="line">    Arrays.sort(pairs,(a,b)->a[<span class="number">1</span>]-b[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> tail=pairs[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<pairs.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (pairs[i][<span class="number">0</span>]>tail) {</span><br><span class="line">            res++;</span><br><span class="line">            tail=pairs[i][<span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pairs.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰</strong></p><p>ä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„åˆ†æ²»æ³•ï¼Œåˆ†æ²»æ³•åœ¨è¿™é‡Œå¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(NlogN)</code>ï¼Œä½†æ˜¯æ€è·¯è¿˜æ˜¯å¾ˆå·§å¦™ï¼Œé¦–å…ˆä¹Ÿæ˜¯è®²æ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œç„¶åæœ€å¤§åºåˆ—å’Œå°±æœ‰ä¸‰ç§æƒ…å†µ    </p><ol><li>å…¨åœ¨å·¦è¾¹</li><li>å…¨åœ¨å³è¾¹</li><li>è·¨ä¸­ç‚¹ï¼Œä¸¤è¾¹éƒ½æœ‰</li></ol><p>ç„¶åç»Ÿè®¡ä¸‰ä¸ªå€¼å¾—æœ€å¤§å€¼ï¼Œé€’å½’å­è¿‡ç¨‹æ±‚è§£ï¼Œä»£ç å°±ä¸å†™äº†ï¼Œåé¢æƒ³èµ·æ¥æœ‰æ—¶é—´å†è¡¥</p><h2 id="376-æ‘†åŠ¨åºåˆ—"><a href="#376-æ‘†åŠ¨åºåˆ—" class="headerlink" title="376. æ‘†åŠ¨åºåˆ—"></a><a href="https://leetcode-cn.com/problems/wiggle-subsequence/" target="_blank" rel="noopener">376. æ‘†åŠ¨åºåˆ—</a></h2><p>å¦‚æœè¿ç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸ºæ‘†åŠ¨åºåˆ—ã€‚ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚å°‘äºä¸¤ä¸ªå…ƒç´ çš„åºåˆ—ä¹Ÿæ˜¯æ‘†åŠ¨åºåˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œ <code>[1,7,4,9,2,5]</code> æ˜¯ä¸€ä¸ªæ‘†åŠ¨åºåˆ—ï¼Œå› ä¸ºå·®å€¼ <code>(6,-3,5,-7,3)</code> æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºç°çš„ã€‚ç›¸å, <code>[1,4,7,2,5]</code> å’Œ <code>[1,7,4,5,5]</code> ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚</p><p>ç»™å®šä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œè¿”å›ä½œä¸ºæ‘†åŠ¨åºåˆ—çš„æœ€é•¿å­åºåˆ—çš„é•¿åº¦ã€‚ é€šè¿‡ä»åŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥è·å¾—å­åºåˆ—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŸå§‹é¡ºåºã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">5</span>]</span><br><span class="line">è¾“å‡º: <span class="number">6</span> </span><br><span class="line">è§£é‡Š: æ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">17</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="number">8</span>]</span><br><span class="line">è¾“å‡º: <span class="number">7</span></span><br><span class="line">è§£é‡Š: è¿™ä¸ªåºåˆ—åŒ…å«å‡ ä¸ªé•¿åº¦ä¸º <span class="number">7</span> æ‘†åŠ¨åºåˆ—ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä¸º[<span class="number">1</span>,<span class="number">17</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">10</span>,<span class="number">16</span>,<span class="number">8</span>]ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶:</strong></p><ul><li>ä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å®Œæˆæ­¤é¢˜?</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>O(N^2 )åŠ¨æ€è§„åˆ’ï¼Œdp[i]ä»£è¡¨ç›®å‰ä¸ºæ­¢ä»¥ nums[i]ç»“å°¾çš„æœ€é•¿çš„<code>ä¸Šå‡æ‘‡æ‘†åºåˆ—</code>ï¼Œdown[i]ä»£è¡¨ç›®å‰ä¸ºæ­¢ä»¥nums[i]ç»“å°¾çš„æœ€é•¿çš„<code>ä¸‹é™æ‘‡æ‘†åºåˆ—</code>ï¼Œåé¢è¿‡ç¨‹å°±å’Œä¸Šé¢çš„<code>LIS</code>çš„è§£æ³•ç±»ä¼¼äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">wiggleMaxLength</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> []up=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length]; </span><br><span class="line">    <span class="keyword">int</span> []down=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length]; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        up[i]=<span class="number">1</span>; down[i]=<span class="number">1</span>; <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<i;j++) {< span><br><span class="line">            <span class="keyword">if</span>(nums[i]>nums[j]){</span><br><span class="line">                <span class="comment">//æ‰¾ä¸€ä¸ªæœ€å¤§çš„ä¸‹é™æ²¿</span></span><br><span class="line">                up[i]=Math.max(up[i],down[j]+<span class="number">1</span>);</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(nums[i]<nums[j]){< span><br><span class="line">                <span class="comment">//æ‰¾ä¸€ä¸ªæœ€å¤§çš„ä¸Šå‡æ²¿</span></span><br><span class="line">                down[i]=Math.max(down[i],up[j]+<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.max(up[nums.length-<span class="number">1</span>],down[nums.length-<span class="number">1</span>]);</span><br><span class="line">}</span><br></nums[j]){<></span></i;j++)></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>çº¿æ€§åŠ¨æ€è§„åˆ’ï¼Œå…¶å®ä¸Šé¢çš„å¾ªç¯æ‰¾æœ€å¤§æ“ä½œæœ‰ç‚¹å¤šä½™ï¼Œå¦‚æœ<code>nums[i]>nums[i-1]</code> é‚£ä¹ˆä»¥nums[i]ä¸ºä¸Šå‡æ²¿ç»“å°¾ï¼ˆæ‘†åŠ¨ä¸Šå‡ï¼‰çš„æœ€é•¿æ‘‡æ‘†åºåˆ— <code>up[i]=down[i-1]+1</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">wiggleMaxLength2</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> []up=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="keyword">int</span> []down=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    up[<span class="number">0</span>]=down[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span>(nums[i]>nums[i-<span class="number">1</span>]){</span><br><span class="line">            up[i]=down[i-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">            down[i]=down[i-<span class="number">1</span>];</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(nums[i]<nums[i-<span class="number">1</nums[i-<span></span>]){</nums.length;i++)></span><br><span class="line">            down[i]=up[i-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">            up[i]=up[i-<span class="number">1</span>];</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//ç›¸ç­‰çš„æ—¶å€™åˆ«å¿˜äº†ç»§æ‰¿å‰é¢çš„çŠ¶æ€</span></span><br><span class="line">            down[i]=down[i-<span class="number">1</span>];</span><br><span class="line">            up[i]=up[i-<span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.max(up[nums.length-<span class="number">1</span>],down[nums.length-<span class="number">1</span>]);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æˆ‘æ„Ÿè§‰èƒ½å†™å‡ºO(1)çš„å‰ææ˜¯å…ˆå†™å‡ºO(N)çš„ï¼Œå†™å‡ºO(N)çš„ä¹‹åå†æ”¹æˆO(1)ä¼šæ¯”è¾ƒç®€å•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">wiggleMaxLength</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> up=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> down=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (nums[i]>nums[i-<span class="number">1</span>]) {</span><br><span class="line">            up=down+<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (nums[i]>nums[i-<span class="number">1</span>]){</span><br><span class="line">            down=up+<span class="number">1</span>;</span><br><span class="line">        }<span class="comment">//elseå°±æ˜¯ä¸å˜</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Math.max(up,down);</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘"><a href="#96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘" class="headerlink" title="96. ä¸åŒçš„äºŒå‰æœç´¢æ ‘"></a><a href="https://leetcode-cn.com/problems/unique-binary-search-trees/" target="_blank" rel="noopener">96. ä¸åŒçš„äºŒå‰æœç´¢æ ‘</a></h2><p>Given <em>n</em>, how many structurally unique <strong>BSTâ€™s</strong> (binary search trees) that store values 1 â€¦ <em>n</em>?</p><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="number">3</span></span><br><span class="line">Output: <span class="number">5</span></span><br><span class="line">Explanation:</span><br><span class="line">Given n = <span class="number">3</span>, there are a total of <span class="number">5</span> unique BST<span class="string">'s:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   1         3     3      2      1</span></span><br><span class="line"><span class="string">    \       /     /      / \      \</span></span><br><span class="line"><span class="string">     3     2     1      1   3      2</span></span><br><span class="line"><span class="string">    /     /       \                 \</span></span><br><span class="line"><span class="string">   2     1         2                 3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™ä¸ªè§£æ³•å®é™…ä¸Šæ¥è‡ª <a href="https://leetcode-cn.com/problems/unique-binary-search-trees-ii/" target="_blank" rel="noopener">95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II</a></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numTrees</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> generateTree(<span class="number">1</span>,n).size();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List<treenode> <span class="title">generateTree</span><span class="params">(<span class="keyword">int</span> start,<span class="keyword">int</span> end)</span></treenode></span>{</span><br><span class="line">    List<treenode> res=<span class="keyword">new</span> ArrayList<>();</treenode></span><br><span class="line">    <span class="keyword">if</span> (start>end) {</span><br><span class="line">        res.add(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=start;i<=end;i++) {</span><br><span class="line">        List<treenode> left=generateTree(start,i-<span class="number">1</span>);</treenode></span><br><span class="line">        List<treenode> right=generateTree(i+<span class="number">1</span>,end);</treenode></span><br><span class="line">        <span class="keyword">for</span> (TreeNode l:left) {</span><br><span class="line">            <span class="keyword">for</span> (TreeNode r:right) {</span><br><span class="line">                TreeNode currentNode=<span class="keyword">new</span> TreeNode(i);</span><br><span class="line">                currentNode.left=l;</span><br><span class="line">                currentNode.right=r;</span><br><span class="line">                res.add(currentNode);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§å†™æ³•å¾ˆæ˜æ˜¾è¿‡ä¸äº†è¿™é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦å¤ªé«˜äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¯ä»¥æ±‚å‡ºæ‰€æœ‰çš„BSTé›†åˆã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>åŠ¨æ€è§„åˆ’ï¼Œ<code>dp[i]</code>ä»£è¡¨é•¿åº¦ä¸º <code>i</code> çš„é€’å¢åºåˆ—æ„æˆçš„ä¸åŒçš„BSTçš„æ•°é‡ï¼ˆåºåˆ—ä»<code>1 åˆ° i</code> é€’å¢ï¼‰</p><p>é€’æ¨å…¬å¼: <code>dp[i]=dp[i-1]* dp[n-i]</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numTrees</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (n<=<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> []dp=<span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<=n;i++) { <span class="comment">//æ§åˆ¶åºåˆ—é•¿åº¦ ç›´åˆ°æˆ‘ä»¬æ±‚å¾— n</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<=i;j++) { <span class="comment">//æ§åˆ¶æ ¹çš„é€‰æ‹©</span></span><br><span class="line">            <span class="comment">//ç´¯åŠ å’Œï¼Œjä¸ºæ ¹èŠ‚ç‚¹ dp[j-1]ä»£è¡¨å·¦å­æ ‘æ•°é‡ï¼Œdp[i-j]ä»£è¡¨å³å­æ ‘æ•°é‡</span></span><br><span class="line">            dp[i]+=dp[j-<span class="number">1</span>]*dp[i-j];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä»¥ <code>i</code> ä½ç½®å…ƒç´ ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå¯ä»¥å¾—å‡ºå¯èƒ½çš„ BSTæ•°é‡ä¸ºï¼Œ<code>[1 ~ i-1]</code> å¯ä»¥æ„æˆçš„BSTæ•°é‡ ä¹˜ä»¥  <code>[i+1ï¼Œn]</code>å¯ä»¥æ„æˆçš„BSTæ•°é‡ï¼Œä¹Ÿå°±æ˜¯<em>å·¦å­æ ‘  *  å³å­æ ‘</em>  ï¼Œå†æ¨å¹¿åˆ°æ•´ä¸ªåºåˆ—çš„BSTæ€»æ•°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ <strong>ä»¥æ¯ä¸ªå…ƒç´ ä¸ºæ ¹èŠ‚ç‚¹æ„æˆçš„BSTçš„æ•°é‡ä¹‹å’Œ</strong> ï¼Œéœ€è¦ç†è§£çš„åœ°æ–¹å°±æ˜¯<code>dp[i]</code> çš„å«ä¹‰ï¼Œæ˜ç¡®æœ¬é¢˜ä¸­<code>dp[i]</code> å…¶å®<strong>åªå’Œé•¿åº¦ <code>i</code>æœ‰å…³</strong>è€Œå’Œå†…å®¹æ— å…³ï¼Œæ¯”å¦‚1ï¼Œ2ï¼Œ3å’Œ4ï¼Œ5ï¼Œ6æ‰€èƒ½æ„æˆçš„BSTæ•°é‡å…¶å®æ˜¯ç›¸åŒçš„</p><p><strong>è§£æ³•ä¸‰</strong></p><p>å¡å¡”å…°æ•°ï¼Œé€’æ¨å¼ <code>Gn+1 =2(2n+1)/ n+2  *  Gn</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numTrees3</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">long</span> C = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i < n; ++i){</span><br><span class="line">        C = C * <span class="number">2</span> * (<span class="number">2</span> * i + <span class="number">1</span>) /(i + <span class="number">2</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>) C;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="1143-æœ€é•¿å…¬å…±å­åºåˆ—"><a href="#1143-æœ€é•¿å…¬å…±å­åºåˆ—" class="headerlink" title="1143. æœ€é•¿å…¬å…±å­åºåˆ—"></a><a href="https://leetcode-cn.com/problems/longest-common-subsequence/" target="_blank" rel="noopener">1143. æœ€é•¿å…¬å…±å­åºåˆ—</a></h2><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² text1 å’Œ text2ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚</p><p>ä¸€ä¸ªå­—ç¬¦ä¸²çš„ å­åºåˆ— æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚<br>ä¾‹å¦‚ï¼Œâ€aceâ€ æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ï¼Œä½† â€œaecâ€ ä¸æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ã€‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ã€Œå…¬å…±å­åºåˆ—ã€æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚ è‹¥è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œåˆ™è¿”å› 0 </p><blockquote><p>æœ€é•¿å…¬å…±å­åºåˆ—é—®é¢˜æ˜¯åœ¨ä¸€ç»„åºåˆ—ï¼ˆé€šå¸¸2ä¸ªï¼‰ä¸­æ‰¾åˆ°æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆæ³¨æ„ï¼šä¸åŒäºå­ä¸²ï¼ŒLCSä¸éœ€è¦æ˜¯è¿ç»­çš„å­ä¸²ï¼‰ã€‚è¯¥é—®é¢˜æ˜¯å…¸å‹çš„è®¡ç®—æœºç§‘å­¦é—®é¢˜ï¼Œæ˜¯æ–‡ä»¶å·®å¼‚æ¯”è¾ƒç¨‹åºçš„åŸºç¡€ï¼Œåœ¨ç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ä¹Ÿæœ‰æ‰€åº”ç”¨</p></blockquote><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štext1 = <span class="string">"abcde"</span>, text2 = <span class="string">"ace"</span> </span><br><span class="line">è¾“å‡ºï¼š<span class="number">3</span>  </span><br><span class="line">è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ <span class="string">"ace"</span>ï¼Œå®ƒçš„é•¿åº¦ä¸º <span class="number">3</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štext1 = <span class="string">"abc"</span>, text2 = <span class="string">"abc"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">3</span></span><br><span class="line">è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ <span class="string">"abc"</span>ï¼Œå®ƒçš„é•¿åº¦ä¸º <span class="number">3</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼štext1 = <span class="string">"abc"</span>, text2 = <span class="string">"def"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">0</span></span><br><span class="line">è§£é‡Šï¼šä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œè¿”å› <span class="number">0</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>2019.10.19åŠ›æ‰£ç»ˆäºæœ‰è¿™é¢˜äº†ï¼Œé‡æ–°æ¥åšä¸€éï¼Œè¿™é¢˜ä¹Ÿå°±æ˜¯ç»å¸¸è¯´çš„LCSï¼Œdpçš„ç»å…¸é—®é¢˜</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestCommonSubsequence</span><span class="params">(String A, String B)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[A.length()+<span class="number">1</span>][B.length()+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=A.length();i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<=B.length();j++) {</span><br><span class="line">            <span class="keyword">if</span> (A.charAt(i-<span class="number">1</span>)==B.charAt(j-<span class="number">1</span>)) {</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[i][j]=Math.max(dp[i-<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>]);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[A.length()][B.length()];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®çœ‹è§è¿™ç§ä»€ä¹ˆæœ€é•¿çš„å¤šåŠå’Œdpæœ‰å…³ç³»ï¼Œè¿™é¢˜åªè¦æ˜ç™½å‡ ä¸ªè¦ç‚¹å°±å¯ä»¥æ¨å‡ºdpæ–¹ç¨‹</p><ul><li><p><code>dp[i][j]</code> ä»£è¡¨Aåºåˆ—å‰<code>i</code>ä¸ªå­—ç¬¦ï¼ˆè®°ä¸º<code>Ai</code>ï¼‰ï¼Œ å’ŒBåºåˆ—å‰<code>j</code>ä¸ªå­—ç¬¦ï¼ˆè®°ä¸º<code>Bj</code>ï¼‰ çš„LCS</p></li><li><p>ä¸¤å±‚forå¾ªç¯éå†ä¸¤ä¸ªåºåˆ—ï¼Œå½“<code>A[i]==B[j]</code>çš„æ—¶å€™ï¼ŒLCSé•¿åº¦å°±ä¼šå¢åŠ  1ï¼Œè¿›è€Œå¾—åˆ°dpæ–¹ç¨‹</p><p><code>dp[i][j]=dp[i-1][j-1]+1</code>   dp[i-1] [j-1]ä»£è¡¨çš„å°±æ˜¯ä¸åŒ…å«<code>Ai/Bj</code>çš„<code>Ai-1</code>å’Œ<code>Bj-1</code> çš„LCS</p></li><li><p><code>A[i]!=B[j]</code>çš„æ—¶å€™å°±æœ‰ä¸¤ç§æƒ…å†µäº†ï¼Œé¦–å…ˆ<code>A[i]</code>å’Œ<code>B[j]</code>å·²ç»<strong>ä¸å¯èƒ½åŒæ—¶å‡ºç°åœ¨æœ€ç»ˆçš„LCSé‡Œé¢</strong>äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å¦å¤–çš„ä¸¤ç§æƒ…å†µ<code>dp[i][j-1]</code>å’Œ<code>dp[i-1][j]</code>å–ä¸ªæœ€å¤§å€¼</p></li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„å°ç»†èŠ‚ï¼Œè¿™é‡Œå¾ªç¯éƒ½æ˜¯ä»1å¼€å§‹çš„ï¼Œè¿™æ ·å°±ä¸ç”¨å¤„ç†åˆå§‹å€¼ï¼Œå¦‚æœä»0å¼€å§‹çš„è¯ï¼Œå¤„ç†åˆå§‹æƒ…å†µï¼ˆiï¼Œj=0çš„æƒ…å†µï¼‰ä¼šæ¯”è¾ƒéº»çƒ¦â€¦â€¦</p><p><strong>è§£æ³•äºŒ</strong></p><p>2019.10.19é‡å†™äº†ä¸€ç§è®°å¿†åŒ–é€’å½’çš„æ–¹æ³•ï¼Œæ²¡æœ‰dpå¿«ï¼Œä½†æ˜¯æ€è·¯å…¶å®æ˜¯ç±»ä¼¼çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Integer[][] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestCommonSubsequence</span><span class="params">(String text1, String text2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(text2==<span class="keyword">null</span> || text1==<span class="keyword">null</span> || text1.length()<=<span class="number">0</span> ||text2.length()<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> len1=text1.length();</span><br><span class="line">    <span class="keyword">int</span> len2=text2.length();</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[len1][len2];</span><br><span class="line">    <span class="keyword">return</span> lcs(text1,len1-<span class="number">1</span>,text2,len2-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//lcså®šä¹‰: æ±‚text1[0,a]å’Œtext2[0,b]çš„æœ€é•¿å…¬å…±å­åºåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lcs</span><span class="params">(String text1, <span class="keyword">int</span> a,String text2,<span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(a==-<span class="number">1</span> || b==-<span class="number">1</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[a][b]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[a][b];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (text1.charAt(a)==text2.charAt(b)) {</span><br><span class="line">        cache[a][b]=lcs(text1,a-<span class="number">1</span>,text2,b-<span class="number">1</span>)+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> cache[a][b];</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        cache[a][b]=Math.max(lcs(text1,a-<span class="number">1</span>,text2,b),lcs(text1,a,text2,b-<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> cache[a][b];</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="120-ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ"><a href="#120-ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ" class="headerlink" title="120. ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ"></a><a href="https://leetcode-cn.com/problems/triangle/" target="_blank" rel="noopener">120. ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªä¸‰è§’å½¢ï¼Œæ‰¾å‡ºè‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œã€‚æ¯ä¸€æ­¥åªèƒ½ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œä¸­ç›¸é‚»çš„ç»“ç‚¹ä¸Šã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸‰è§’å½¢ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">     [<span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">   [<span class="number">6</span>,<span class="number">5</span>,<span class="number">7</span>],</span><br><span class="line">  [<span class="number">4</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">3</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p>è‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œä¸º <code>11</code>ï¼ˆå³ï¼Œ2 + 3 + 5 + 1 = 11ï¼‰ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><p>å¦‚æœä½ å¯ä»¥åªä½¿ç”¨ O(n) çš„é¢å¤–ç©ºé—´ï¼ˆn ä¸ºä¸‰è§’å½¢çš„æ€»è¡Œæ•°ï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆä½ çš„ç®—æ³•ä¼šå¾ˆåŠ åˆ†</p><p><strong>è§£æ³•ä¸€</strong></p><p>äºŒç»´dpï¼Œemmmï¼Œä¸€å¼€å§‹å†™æˆè´ªå¿ƒäº†ã€‚ã€‚è´ªå¿ƒæ˜æ˜¾æ˜¯é”™çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//dpåšæ³• O(N^2)ç©ºé—´</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minimumTotal</span><span class="params">(List<list<integer>> triangle)</list<integer></span> </span>{</span><br><span class="line">    <span class="keyword">int</span> rows=triangle.size();</span><br><span class="line">    <span class="comment">//dp[i][j]ä»£è¡¨çš„æ˜¯æ¯iå±‚ç¬¬jä¸ªå…ƒç´ åˆ°æœ€åº•å±‚çš„æœ€çŸ­è·ç¦»</span></span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[rows+<span class="number">1</span>][rows+<span class="number">1</span>]; <span class="comment">//row+1</span></span><br><span class="line">    <span class="comment">/*for (int i=0;i<triangle.get(rows-1).size();i++) {< span></triangle.get(rows-1).size();i++)></span><br><span class="line"><span class="comment">        //ç»™æœ€åä¸€è¡Œèµ‹åˆå§‹å€¼</span></span><br><span class="line"><span class="comment">        dp[rows-1][i]=triangle.get(rows-1).get(i);</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">    for (int i=rows-2;i>=0;i--) {</span></span><br><span class="line"><span class="comment">        for (int j=0;j<triangle.get(i).size();j++) {< span></triangle.get(i).size();j++)></span><br><span class="line"><span class="comment">            //æ ¸å¿ƒé€’æ¨å¼ dp[i][j]=min(dp[i+1][j],dp[i+1][j+1])+triangle(i)(j)</span></span><br><span class="line"><span class="comment">            dp[i][j]=Math.min(dp[i+1][j],dp[i+1][j+1])+triangle.get(i).get(j);</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">    }*/</span></span><br><span class="line">    <span class="comment">//ç›´æ¥ä»æœ€åä¸€è¡Œå¼€å§‹,è¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨ç»™æœ€åä¸€è¡Œèµ‹åˆå§‹å€¼äº†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=rows-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<triangle.get(i).size();j++) {< span><br><span class="line">            <span class="comment">//æ ¸å¿ƒé€’æ¨å¼ dp[i][j]=min(dp[i+1][j],dp[i+1][j+1])+triangle(i)(j)</span></span><br><span class="line">            dp[i][j]=Math.min(dp[i+<span class="number">1</span>][j],dp[i+<span class="number">1</span>][j+<span class="number">1</span>])+triangle.get(i).get(j);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">}</span><br></triangle.get(i).size();j++)></span></span></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>è®°å¿†åŒ–é€’å½’ï¼Œä¹Ÿå¾ˆå¿«</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è®°å¿†åŒ–é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minimumTotal2</span><span class="params">(List<list<integer>> triangle)</list<integer></span> </span>{</span><br><span class="line">    <span class="comment">//ç”¨Integeræ¯”è¾ƒå¥½,æ–¹ä¾¿åˆ¤ç©º</span></span><br><span class="line">    Integer [][] cache=<span class="keyword">new</span> Integer[triangle.size()][triangle.size()];</span><br><span class="line">    <span class="keyword">return</span> minimumTotal(triangle,<span class="number">0</span>,<span class="number">0</span>,cache);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minimumTotal</span><span class="params">(List<list<integer>> triangle,<span class="keyword">int</span> cen,<span class="keyword">int</span> index,Integer[][]cache)</list<integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (cache[cen][index]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[cen][index];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cen==triangle.size()-<span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">return</span> triangle.get(cen).get(index);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left=minimumTotal(triangle,cen+<span class="number">1</span>,index,cache);</span><br><span class="line">    <span class="keyword">int</span> right=minimumTotal(triangle,cen+<span class="number">1</span>,index+<span class="number">1</span>,cache);</span><br><span class="line">    <span class="keyword">return</span> cache[cen][index]=triangle.get(cen).get(index)+(left<right?left:right);< span><br><span class="line">}</span><br></right?left:right);<></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//dp O(N)ç©ºé—´</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minimumTotal</span><span class="params">(List<list<integer>> triangle)</list<integer></span> </span>{</span><br><span class="line">    <span class="keyword">int</span> rows=triangle.size();</span><br><span class="line">    <span class="comment">//dp[i]ä»£è¡¨çš„æ˜¯æ¯ä¸€å±‚ç¬¬iä¸ªå…ƒç´ åˆ°æœ€åº•å±‚çš„æœ€çŸ­è·ç¦»</span></span><br><span class="line">    <span class="comment">//ä¸Šé¢äºŒç»´dpå®é™…ä¸Šä¹Ÿåªå’Œä¸‹ä¸€å±‚çš„çŠ¶æ€æœ‰å…³,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡å¤çš„ä½¿ç”¨è¿™ä¸ªæ•°ç»„ä¿å­˜æ¯ä¸€å±‚çš„çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">int</span>[] dp=<span class="keyword">new</span> <span class="keyword">int</span>[rows+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=rows-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<triangle.get(i).size();j++) {< span><br><span class="line">            <span class="comment">//åˆ°è¿™é‡Œå…¶å®Math.min()é‡Œé¢çš„éƒ½æ˜¯ä¸Šä¸€æ¬¡å¾ªç¯çš„ç»“æœ</span></span><br><span class="line">            <span class="comment">//ä¹Ÿå°±æ˜¯ä¸‹ä¸€å±‚çš„,å¯¹åº”å½“å‰jä½ç½®å·¦å³ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹çš„æœ€å°è·ç¦»</span></span><br><span class="line">            dp[j]=Math.min(dp[j+<span class="number">1</span>],dp[j])+triangle.get(i).get(j);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">0</span>];</span><br><span class="line">}</span><br></triangle.get(i).size();j++)></span></pre></td></tr></tbody></table></figure></div><p>O(N)ç©ºé—´å¤æ‚åº¦ï¼Œåªå’Œä¸‹é¢é‚£ä¸€å±‚çš„æ¯ä¸€ä¸ªå…ƒç´ çš„dp[i]æœ‰å…³ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ”¹æˆä¸€ç»´dp</p><h2 id="121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"><a href="#121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº" class="headerlink" title="121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/" target="_blank" rel="noopener">121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚</p><p>å¦‚æœä½ <strong>æœ€å¤šåªå…è®¸å®Œæˆä¸€ç¬”äº¤æ˜“</strong>ï¼ˆå³ä¹°å…¥å’Œå–å‡ºä¸€æ”¯è‚¡ç¥¨ï¼‰ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚</p><p>æ³¨æ„ä½ ä¸èƒ½åœ¨ä¹°å…¥è‚¡ç¥¨å‰å–å‡ºè‚¡ç¥¨ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">7</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: <span class="number">5</span></span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ <span class="number">2</span> å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">1</span>ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ <span class="number">5</span> å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">6</span>ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = <span class="number">6</span>-<span class="number">1</span> = <span class="number">5</span>  ï¼Œæ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ <span class="number">7</span>-<span class="number">1</span> = <span class="number">6</span>, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">7</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br><span class="line">è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º <span class="number">0</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>éåŠ¨æ€è§„åˆ’çš„æ€è·¯ï¼Œè¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ±‚ä¸ªæœ€å¤§çš„å·®å€¼å°±okï¼Œå› ä¸ºåªèƒ½ä¹°ä¸€æ¬¡</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//éé€’å½’çš„æ€è·¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> min=Integer.MAX_VALUE,max=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<prices.length;i++) {< span><br><span class="line">        <span class="comment">//å½“å¤©ä»·æ ¼å‡å» *ä¹‹å‰* ä»·æ ¼æœ€ä½çš„ä¹°å…¥æ—¶æœº</span></span><br><span class="line">        max=Math.max(max,prices[i]-min);</span><br><span class="line">        <span class="comment">//ç»Ÿè®¡ä»·æ ¼æœ€ä½çš„ä¹°å…¥æ—¶æœº</span></span><br><span class="line">        min=Math.min(min,prices[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>æ—¢ç„¶æ˜¯åŠ¨æ€è§„åˆ’çš„é¢˜ï¼Œè‡ªç„¶å¾—å†™ä¸ªåŠ¨æ€è§„åˆ’çš„ç‰ˆæœ¬</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[prices.length][<span class="number">2</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">1</span>]= -prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+[i]);</span><br><span class="line">        dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],-prices[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[prices.length-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®æ”¹æˆä¸€ç»´çš„å°±å’Œä¸Šé¢çš„ä¸€æ¨¡ä¸€æ ·äº†</p><h2 id="122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II"><a href="#122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II" class="headerlink" title="122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/" target="_blank" rel="noopener">122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚</p><p>è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚<strong>ä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“</strong>ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">7</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: <span class="number">7</span></span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ <span class="number">2</span> å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">1</span>ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ <span class="number">3</span> å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">5</span>ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = <span class="number">5</span>-<span class="number">1</span> = <span class="number">4</span> ã€‚</span><br><span class="line">éšåï¼Œåœ¨ç¬¬ <span class="number">4</span> å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">3</span>ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ <span class="number">5</span> å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">6</span>ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = <span class="number">6</span>-<span class="number">3</span> = <span class="number">3</span> ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ <span class="number">1</span> å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">1</span>ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ <span class="number">5</span> å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = <span class="number">5</span>ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = <span class="number">5</span>-<span class="number">1</span> = <span class="number">4</span> ã€‚</span><br><span class="line">æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ <span class="number">1</span> å¤©å’Œç¬¬ <span class="number">2</span> å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">7</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br><span class="line">è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º <span class="number">0</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ­£å¸¸çš„æ€è·¯ï¼ˆéåŠ¨æ€è§„åˆ’ï¼‰ï¼Œæ³¨æ„å®¡é¢˜ï¼Œä¸Šé¢çš„åªèƒ½ä¹°ä¸€æ¬¡ï¼Œè¿™é‡Œæ˜¯ä¸é™åˆ¶æ¬¡æ•°çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (prices[i]>prices[i-<span class="number">1</span>]) {</span><br><span class="line">            ans+=prices[i]-prices[i-<span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œçš„ä»£ç è¿˜æ˜¯å¾ˆæœ‰è¿·æƒ‘æ€§çš„ï¼Œå®é™…ä¸Šåˆ†äº†ä¸‰ç§æƒ…å†µï¼Œæœ‰ä¸¤ç§åˆå¹¶äº†</p><blockquote><p><strong>å•ç‹¬äº¤æ˜“æ—¥</strong>ï¼šæ˜å¤©æ¯”ä»Šå¤©ä»·æ ¼é«˜ï¼Œä»Šå¤©ä¹°ï¼Œæ˜å¤©å–</p><p><strong>è¿ç»­ä¸Šæ¶¨äº¤æ˜“æ—¥</strong>ï¼šå¼€å§‹çš„ç¬¬ä¸€å¤©ä¹° , æ¶¨åœçš„æœ€åä¸€å¤©å–æœ€æœ‰åˆ©ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è½¬æ¢æˆè¯´<code>é™¤äº†ç¬¬ä¸€å¤©ï¼Œæ¯å¤©éƒ½å–äº†åˆä¹°</code>ï¼Œä¹Ÿå°±æ˜¯<code>pn-p1 = (p2-p1)+(p3-p2)+....(pn-pn-1)</code>  å¾ˆè‡ªç„¶çš„å°±è½¬æ¢æˆäº†å•ç‹¬äº¤æ˜“æ—¥çš„æƒ…å†µ<br><strong>è¿ç»­ä¸‹é™äº¤æ˜“æ—¥</strong>ï¼šä¸ä¹°å–æœ€æœ‰åˆ©</p></blockquote><p>å¦‚æœè¿˜æ˜¯ä¸æ˜ç™½å¯ä»¥çœ‹çœ‹å®˜æ–¹çš„å›¾</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191017/Wpsvs09EmnmF.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>A->Dæ˜¯ä¸€æ®µè¿ç»­ä¸Šæ¶¨æ—¥ï¼Œ<code>D-Açš„å·®å€¼</code> å°±æ˜¯A->Då„ä¸ªç›¸é‚»èŠ‚ç‚¹å·®å€¼ä¹‹å’Œ</p><p><strong>è§£æ³•äºŒ</strong></p><p>æˆ‘ä»¬çš„ä¸»è§’ï¼ŒåŠ¨æ€è§„åˆ’</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//dpçš„æ€è·¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[prices.length][<span class="number">2</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">1</span>]=-prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]);</span><br><span class="line">        dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],dp[i-<span class="number">1</span>][<span class="number">0</span>]-prices[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[prices.length-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>ç¬¬ä¸€çœ¼çœ‹å¯èƒ½è§‰å¾—çœ‹ä¸æ‡‚ï¼Œç†Ÿæ‚‰äº†å°±çŸ¥é“äº†ï¼Œå…¶å®éƒ½æ˜¯å¥—è·¯ï¼Œè‚¡ç¥¨é¢˜ç‰¹æœ‰çš„å¥—è·¯ï¼Œå…ˆè€ƒè™‘é¢˜ç›®æœ‰å‡ ç§çŠ¶æ€ï¼Œè¿™é¢˜è¯´äº†ä¸é™åˆ¶æ¬¡æ•°ï¼Œé‚£ä¹ˆå°±ä¸è€ƒè™‘æ¬¡æ•°çš„é—®é¢˜ï¼Œç„¶åå‰©ä¸‹çš„çŠ¶æ€å°±æ˜¯ï¼šé‚£ä¸€å¤©ï¼Œå’Œæ˜¯å¦æŒæœ‰è‚¡ç¥¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªäºŒç»´çš„æ•°ç»„æ¥è¡¨è¿°è¿™ä¸¤ç§çŠ¶æ€ æ¯”å¦‚<code>dp[i][0]</code> åˆ™ä»£è¡¨ç¬¬iå¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œ<code>dp[i][1]</code>åˆ™ä»£è¡¨ç¬¬iå¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œç„¶åæˆ‘ä»¬å†çœ‹çœ‹çŠ¶æ€è½¬æ¢çš„è¿‡ç¨‹</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191017/J7tfvKDvqC2b.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å…¶å®æ— éå°±æ˜¯è¿™ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ï¼Œç„¶åæ ¹æ®è¿™ä¸ªçŠ¶æ€è½¬æ¢çš„è¿‡ç¨‹å°±å¯ä»¥å¾ˆè½»æ˜“çš„å†™å‡ºæˆ‘ä»¬çš„çŠ¶æ€è½¬æ¢æ–¹ç¨‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]);</span><br><span class="line">dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],dp[i-<span class="number">1</span>][<span class="number">0</span>]-prices[i]);</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸è¿‡è¿™é‡Œå…¶å®ä¹Ÿå¾ˆå®¹æ˜“å°±å¯ä»¥æ”¹æˆä¸€å”¯çš„dpï¼Œç©ºé—´å¤æ‚åº¦å˜ä¸ºO(1)ï¼Œå› ä¸ºå½“å¤©çš„æœ€å¤§æ”¶ç›Šåªå’Œå‰ä¸€å¤©çš„æœ€å¤§æ”¶ç›Šç›¸å…³ï¼Œä¸¤ä¸ªå˜é‡å°±æ˜¯è¶³å¤Ÿè¡¨ç¤º</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> hlod=-prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> empty=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        <span class="comment">//ä¿å­˜å‰ä¸€å¤©çš„çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">int</span> temp=empty;</span><br><span class="line">        empty=Math.max(empty,hlod+prices[i]);</span><br><span class="line">        hlod=Math.max(hlod,temp-prices[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> empty;</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæˆ‘åˆå‘ç°äº†leetcodeçš„caseæœ‰é—®é¢˜ï¼Œæˆ‘å¼€å§‹æ²¡æœ‰ç¼“å­˜å‰ä¸€å¤©çš„emptyå€¼ï¼Œç›´æ¥å°†emptyå¸¦åˆ°holdå»äº†ï¼Œç»“æœè¿˜è¿‡äº†ã€‚ã€‚ã€‚ä¸è¿‡æˆ‘æ‡’å¾—å»æƒ³caseäº†ï¼Œåæ­£æäº¤äº†leecodeä¹Ÿä¸ä¼šç†æˆ‘ğŸ˜…</p><h2 id="714-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹"><a href="#714-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹" class="headerlink" title="714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/" target="_blank" rel="noopener">714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>prices</code>ï¼Œå…¶ä¸­ç¬¬ i ä¸ªå…ƒç´ ä»£è¡¨äº†ç¬¬ i å¤©çš„è‚¡ç¥¨ä»·æ ¼ ï¼Œéè´Ÿæ•´æ•° fee ä»£è¡¨äº†äº¤æ˜“è‚¡ç¥¨çš„æ‰‹ç»­è´¹ç”¨</p><p>ä½ å¯ä»¥æ— é™æ¬¡åœ°å®Œæˆäº¤æ˜“ï¼Œä½†æ˜¯ä½ æ¯æ¬¡äº¤æ˜“éƒ½éœ€è¦ä»˜æ‰‹ç»­è´¹ã€‚å¦‚æœä½ å·²ç»è´­ä¹°äº†ä¸€ä¸ªè‚¡ç¥¨ï¼Œåœ¨å–å‡ºå®ƒä¹‹å‰ä½ å°±ä¸èƒ½å†ç»§ç»­è´­ä¹°è‚¡ç¥¨äº†ã€‚</p><p>è¿”å›è·å¾—åˆ©æ¶¦çš„æœ€å¤§å€¼ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: prices = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">9</span>], fee = <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">8</span></span><br><span class="line">è§£é‡Š: èƒ½å¤Ÿè¾¾åˆ°çš„æœ€å¤§åˆ©æ¶¦:  </span><br><span class="line">åœ¨æ­¤å¤„ä¹°å…¥ prices[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">åœ¨æ­¤å¤„å–å‡º prices[<span class="number">3</span>] = <span class="number">8</span></span><br><span class="line">åœ¨æ­¤å¤„ä¹°å…¥ prices[<span class="number">4</span>] = <span class="number">4</span></span><br><span class="line">åœ¨æ­¤å¤„å–å‡º prices[<span class="number">5</span>] = <span class="number">9</span></span><br><span class="line">æ€»åˆ©æ¶¦: ((<span class="number">8</span> - <span class="number">1</span>) - <span class="number">2</span>) + ((<span class="number">9</span> - <span class="number">4</span>) - <span class="number">2</span>) = <span class="number">8</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„:</strong></p><ul><li><code>0 < prices.length <= 50000.</code></li><li><code>0 < prices[i] < 50000.</code></li><li><code>0 <= fee < 50000.</code></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>æˆ‘èµ·äº†ï¼Œä¸€æªç§’äº†ï¼Œæœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Ÿ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices, <span class="keyword">int</span> fee)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[prices.length][<span class="number">2</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">1</span>]=-prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]-fee);</span><br><span class="line">        dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],dp[i-<span class="number">1</span>][<span class="number">0</span>]-prices[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[prices.length-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ”¹ä¸ºO(1)ç©ºé—´</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ”¹ä¸ºO(1)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices, <span class="keyword">int</span> fee)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> empty=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> hold=-prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> temp=empty;</span><br><span class="line">        empty=Math.max(empty,hold+prices[i]-fee);</span><br><span class="line">        hold=Math.max(hold,temp-prices[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> empty;</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="309-æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ"><a href="#309-æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ" class="headerlink" title="309. æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/" target="_blank" rel="noopener">309. æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ i ä¸ªå…ƒç´ ä»£è¡¨äº†ç¬¬ i å¤©çš„è‚¡ç¥¨ä»·æ ¼ </p><p>è®¾è®¡ä¸€ä¸ªç®—æ³•è®¡ç®—å‡ºæœ€å¤§åˆ©æ¶¦ã€‚åœ¨æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ä¸‹ï¼Œä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰:</p><ul><li>ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰</li><li>å–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ (å³å†·å†»æœŸä¸º 1 å¤©)</li></ul><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">3</span> </span><br><span class="line">è§£é‡Š: å¯¹åº”çš„äº¤æ˜“çŠ¶æ€ä¸º: [ä¹°å…¥, å–å‡º, å†·å†»æœŸ, ä¹°å…¥, å–å‡º]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>ä¾ç„¶æ˜¯ä¸Šé¢é¢˜çš„å‡çº§ç‰ˆï¼Œç›¸æ¯”ä¸Šä¸€é¢˜åˆå¤šäº†ä¸ªé™åˆ¶æ¡ä»¶ï¼ŒåŠ äº†cdï¼Œä¹°å–ä¸€æ¬¡åæœ‰ä¸€å¤©çš„cdï¼Œå½“å¤©ä¸èƒ½å†ä¹°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//dp[i][0] ä»£è¡¨ç¬¬iå¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦</span></span><br><span class="line">    <span class="comment">//dp[i][1] ä»£è¡¨ç¬¬iå¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦</span></span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[prices.length][<span class="number">2</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">1</span>]=-prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        <span class="comment">//è¿™äº›ç©æ„æƒ³èµ·è¿˜æ˜¯è›®æ‰“è„‘é˜”çš„</span></span><br><span class="line">        dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i],dp[i-<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">        <span class="comment">//dp[i][1]=Math.max(i<2?-prices[i]:dp[i-2][0]-prices[i],dp[i-1][1]);</span></span><br><span class="line">        <span class="comment">//è¿™é‡Œi<2å°±æ˜¯ç¬¬ä¸€æ¬¡å¾ªç¯ï¼Œi=1,ä¹Ÿå°±æ˜¯ç¬¬äºŒå¤©æŒæœ‰è‚¡ç¥¨ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯é¦–æ¬¡ä¹°è‚¡ç¥¨ï¼Œç›´æ¥åˆå§‹åŒ–ä¸º -prices[1]</span></span><br><span class="line">        <span class="comment">//æ˜¨å¤©æœ‰è‚¡ç¥¨ï¼Œæˆ–è€…æ˜¨å¤©å†·å†»å‰å¤©å–å‡º</span></span><br><span class="line">        dp[i][<span class="number">1</span>]=Math.max(i<<span class="number">2</span>?-prices[<span class="number">1</span>]:dp[i-<span class="number">2</span>][<span class="number">0</span>]-prices[i],dp[i-<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[prices.length-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>è¯„è®ºåŒºå¾ˆå¤šçš„è§£æ³•éƒ½æ˜¯ç”¨äº†ä¸‰ä¸ªçŠ¶æ€æ•°ç»„ï¼Œç›¸æ¯”è¿™ç§å¤šäº†ä¸€ä¸ª å†·å†»æœŸçš„æœ€å¤§å€¼ï¼Œæ„Ÿè§‰æŒºè¿·æƒ‘çš„ã€‚ã€‚ã€‚è™½ç„¶ç»“æœæ˜¯å¯¹çš„ï¼Œä½†æ˜¯æ€»æ—¶æ„Ÿè§‰åˆ«æ‰­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œç”¨ä¸¤ä¸ªçŠ¶æ€è¡¨ç¤ºï¼ŒçŠ¶æ€è½¬æ¢å›¾å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20191017/J7tfvKDvqC2b.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å½“å¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œå°±æ˜¯ä½ å½“å¤©ä¹°è‚¡ç¥¨ï¼Œæˆ–è€…restå•¥ä¹Ÿä¸å¹²å»¶ç»­å‰ä¸€å¤©çš„çŠ¶æ€ï¼Œä¸¤è€…çš„æœ€å¤§å€¼</p><p>è¿™é‡Œå’Œä¸Šé¢ä¸åŒçš„å°±æ˜¯ä»<code>ä¸æŒæœ‰è‚¡ç¥¨</code> åˆ°<code>æŒæœ‰è‚¡ç¥¨</code>ï¼ˆä¹Ÿå°±æ˜¯ä¹°è‚¡ç¥¨ï¼‰çš„æƒ…å†µï¼Œ å› ä¸ºæœ‰å†·å†»æœŸçš„å­˜åœ¨ï¼Œ<strong>æ‰€ä»¥ä½ å½“å¤©ä¹°è‚¡ç¥¨çš„æœ€å¤§å€¼ä¸å†æ˜¯æ˜¨å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§å€¼ï¼Œè€Œæ˜¯å‰å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§å€¼</strong></p><p><strong>è§£æ³•ä¸‰</strong></p><p>æ”¹ä¸ºç©ºé—´å¤æ‚åº¦O(1)çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="keyword">null</span> || prices.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> hold=-prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> empty=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//å‰ä¸€å¤©ä¹°å‡ºçš„æœ€å¤§æ”¶ç›Š</span></span><br><span class="line">    <span class="keyword">int</span> prePre=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<prices.length;i++) {< span><br><span class="line">        <span class="keyword">int</span> temp=empty;</span><br><span class="line">        empty=Math.max(hold+prices[i],empty);</span><br><span class="line">        hold=Math.max(i<<span class="number">2</span>?-prices[<span class="number">1</span>]:prePre-prices[i],hold);</span><br><span class="line">        <span class="comment">//åˆ°è¿™é‡Œpreå°±å˜æˆäº†å‰ä¸€å¤©</span></span><br><span class="line">        prePre=temp;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> empty;</span><br><span class="line">}</span><br></prices.length;i++)></span></pre></td></tr></tbody></table></figure></div><blockquote><p>çœ‹äº†ä¸‹è¯„è®ºåŒºè¿˜æ˜¯è›®å¤šäº‰è®®çš„ï¼Œæ„Ÿè§‰è¿™é‡Œæ ¹æ®dp[i-2]è½¬æ¢æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œç„¶åç¿»äº†ç¿»è¯„è®ºåŒºçœ‹è§äº†å¤§ç¥çš„å›ç­”</p><p><code>dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])</code></p><p><code>dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i])</code></p><p>æ·»åŠ  â€œå†·å†»æœŸâ€ æ¡ä»¶åï¼Œä¹°å…¥çš„å‰ä¸€å¤©æ˜¯ä¸èƒ½å–çš„ï¼Œè€Œ<code>dp[i-1][0] - prices[i]</code>å¹¶ä¸èƒ½ç¡®ä¿ <code>i-1å¤©ä¸å–å‡º</code>   </p><p>æ‰€ä»¥è¿›ä¸€æ­¥æ‹†è§£<code>dp[i-1][0]</code>ï¼Œ å¥—ç”¨ä¸Šé¢çš„è½¬æ¢æ–¹ç¨‹å¯ä»¥å¾—åˆ°</p><p><code>dp[i-1][0] = max(dp[i-2][0], dp[i-2][1] + prices[i-1])</code> </p><p>å†å¸¦å…¥åŸå¼å­ï¼Œåˆ™å¯ä»¥å¾—åˆ°</p><p><code>dp[i][1] = max(dp[i-1][1], max(dp[i-2][0], dp[i-2][1] + prices[i-1]) - prices[i])</code></p><p>å…¶ä¸­<code>dp[i-2][1] + prices[i-1]</code> ä»£è¡¨ç€ <code>â€œi-1å‘ç”Ÿäº†å–å‡ºè¡Œä¸ºâ€</code>ï¼Œæœ‰è¿é¢˜æ„ï¼Œåº”äºˆåˆ é™¤ï¼Œå¾—ä¸‹å¼ï¼Œæœ€ç»ˆå’Œä¸Šé¢çš„çŠ¶æ€è½¬æ¢æ–¹ç¨‹ä¸€è‡´</p><p><code>dp[i][1] = max(dp[i-1][1], max(dp[i-2][0]) - prices[i])</code></p><p>è¿™æ ·ä¸€è¯æ˜å°±å¾ˆæ¸…æ¥šäº†</p></blockquote><h2 id="72-ç¼–è¾‘è·ç¦»"><a href="#72-ç¼–è¾‘è·ç¦»" class="headerlink" title="72. ç¼–è¾‘è·ç¦»"></a><a href="https://leetcode-cn.com/problems/edit-distance/" target="_blank" rel="noopener">72. ç¼–è¾‘è·ç¦»</a></h2><p>ç»™å®šä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œè®¡ç®—å‡ºå°† word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•° ã€‚</p><p>ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š</p><ul><li>æ’å…¥ä¸€ä¸ªå­—ç¬¦</li><li>åˆ é™¤ä¸€ä¸ªå­—ç¬¦</li><li>æ›¿æ¢ä¸€ä¸ªå­—ç¬¦</li></ul><p>*<em>ç¤ºä¾‹ 1: *</em></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: word1 = <span class="string">"horse"</span>, word2 = <span class="string">"ros"</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br><span class="line">è§£é‡Š: </span><br><span class="line">horse -> rorse (å°† <span class="string">'h'</span> æ›¿æ¢ä¸º <span class="string">'r'</span>)</span><br><span class="line">rorse -> rose (åˆ é™¤ <span class="string">'r'</span>)</span><br><span class="line">rose -> ros (åˆ é™¤ <span class="string">'e'</span>)</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: word1 = <span class="string">"intention"</span>, word2 = <span class="string">"execution"</span></span><br><span class="line">è¾“å‡º: <span class="number">5</span></span><br><span class="line">è§£é‡Š: </span><br><span class="line">intention -> inention (åˆ é™¤ <span class="string">'t'</span>)</span><br><span class="line">inention -> enention (å°† <span class="string">'i'</span> æ›¿æ¢ä¸º <span class="string">'e'</span>)</span><br><span class="line">enention -> exention (å°† <span class="string">'n'</span> æ›¿æ¢ä¸º <span class="string">'x'</span>)</span><br><span class="line">exention -> exection (å°† <span class="string">'n'</span> æ›¿æ¢ä¸º <span class="string">'c'</span>)</span><br><span class="line">exection -> execution (æ’å…¥ <span class="string">'u'</span>)</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å¾ˆç»å…¸çš„åŠ¨æ€è§„åˆ’çš„é—®é¢˜ï¼Œåšä¹‹å‰çœ‹äº†åŠ¨æ€è§„åˆ’çš„æ€è·¯ï¼Œç„¶åå¾ˆå¿«å†™å‡ºäº†é€’å½’çš„è§£æ³•ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Integer[][] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDistance</span><span class="params">(String word1, String word2)</span> </span>{</span><br><span class="line">    cache=<span class="keyword">new</span> Integer[word1.length()][word2.length()];</span><br><span class="line">    <span class="keyword">return</span> minDistance(word1,word1.length()-<span class="number">1</span>,word2,word2.length()-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€’å½’çš„å®šä¹‰: word1[0,idx1] å’Œ word2[0,idx2] çš„æœ€çŸ­ç¼–è¾‘è·ç¦»</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDistance</span><span class="params">(String word1,<span class="keyword">int</span> idx1,String word2,<span class="keyword">int</span> idx2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (idx1<<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> idx2+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (idx2<<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> idx1+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[idx1][idx2]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[idx1][idx2];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (word1.charAt(idx1) == word2.charAt(idx2)) {</span><br><span class="line">        <span class="keyword">return</span> cache[idx1][idx2]=minDistance(word1,idx1-<span class="number">1</span>,word2,idx2-<span class="number">1</span>);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="keyword">return</span> cache[idx1][idx2]=<span class="number">1</span>+Math.min(minDistance(word1,idx1-<span class="number">1</span>,word2,idx2),Math.min(minDistance(word1,idx1,word2,idx2-<span class="number">1</span>),minDistance(word1,idx1-<span class="number">1</span>,word2,idx2-<span class="number">1</span>)));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ ¸å¿ƒçš„é€’æ¨å…¬å¼å°±æ˜¯ </p><p><code>minDis(i,j)=minDis(i-1,j-1)  word1[i]==word2[j]</code></p><p><code>minDis(i,j)=min(minDis(i-1,j),minDis(i,j-1),minDis(i-1,j-1))+1  word1[i]!=word2[j]</code></p><p>ç¬¬ä¸€ä¸ªå…¬å¼å¥½è¯´ï¼Œç›¸ç­‰æ—¶å€™å°±åˆ«åŠ¨ï¼Œå»¶ç»­ä¹‹å‰çš„çŠ¶æ€ï¼Œå…³é”®æ˜¯ç¬¬äºŒä¸ªï¼Œä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ±‚å¯¹åº”çš„ä¸‰ç§æ“ä½œå¢ï¼Œåˆ ï¼Œæ”¹çš„æœ€å°å€¼ï¼Œä½†æ˜¯è¿™é‡Œï¼Œç¬¬äºŒç§åˆ çš„æ“ä½œï¼Œè¿™é‡Œè¦æƒ³æ¸…æ¥šï¼Œå…¶å®word1åˆ é™¤ä¸€ä¸ªå…¶å®å°±ç­‰ä»·äºword2å¢åŠ ä¸€ä¸ªï¼Œæ‰€ä»¥æ˜¯<code>minDis(i,j-1)</code>ï¼Œè™½ç„¶é¢˜ç›®è¯´çš„æ˜¯ä»word1è½¬æ¢ä¸ºword2ï¼Œä½†æ˜¯å…¶å®ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹å…¶å®æ˜¯å¯é€†çš„</p><p><strong>è§£æ³•äºŒ</strong></p><p>æ ‡å‡†çš„åŠ¨æ€è§„åˆ’å†™æ³•ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸Šé¢çš„è®°å¿†åŒ–é€’å½’å¥½å†™ï¼ŒåŠ¨æ€è§„åˆ’è¦è€ƒè™‘çš„è¾¹ç•Œæ¯”é€’å½’è¦å¤š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDistance2</span><span class="params">(String word1, String word2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (word1.length()<=<span class="number">0</span> || word2.length()<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> word2.length()==<span class="number">0</span>?word1.length():word2.length();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[word1.length()+<span class="number">1</span>][word2.length()+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=word2.length();i++) {</span><br><span class="line">        dp[<span class="number">0</span>][i]=i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=word1.length();i++) {</span><br><span class="line">        dp[i][<span class="number">0</span>]=i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i<=word1.length();i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<=word2.length();j++) {</span><br><span class="line">            <span class="keyword">if</span> (word1.charAt(i-<span class="number">1</span>)==word2.charAt(j-<span class="number">1</span>)) {</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[i][j]=<span class="number">1</span>+Math.min(dp[i-<span class="number">1</span>][j],Math.min(dp[i][j-<span class="number">1</span>],dp[i-<span class="number">1</span>][j-<span class="number">1</span>]));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dp[word1.length()][word2.length()];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="1269-åœåœ¨åŸåœ°çš„æ–¹æ¡ˆæ•°"><a href="#1269-åœåœ¨åŸåœ°çš„æ–¹æ¡ˆæ•°" class="headerlink" title="1269. åœåœ¨åŸåœ°çš„æ–¹æ¡ˆæ•°"></a><a href="https://leetcode-cn.com/problems/number-of-ways-to-stay-in-the-same-place-after-some-steps/" target="_blank" rel="noopener">1269. åœåœ¨åŸåœ°çš„æ–¹æ¡ˆæ•°</a></h2><p>æœ‰ä¸€ä¸ªé•¿åº¦ä¸º arrLen çš„æ•°ç»„ï¼Œå¼€å§‹æœ‰ä¸€ä¸ªæŒ‡é’ˆåœ¨ç´¢å¼• 0 å¤„ã€‚</p><p>æ¯ä¸€æ­¥æ“ä½œä¸­ï¼Œä½ å¯ä»¥å°†æŒ‡é’ˆå‘å·¦æˆ–å‘å³ç§»åŠ¨ 1 æ­¥ï¼Œæˆ–è€…åœåœ¨åŸåœ°ï¼ˆæŒ‡é’ˆä¸èƒ½è¢«ç§»åŠ¨åˆ°æ•°ç»„èŒƒå›´å¤–ï¼‰ã€‚</p><p>ç»™ä½ ä¸¤ä¸ªæ•´æ•° steps å’Œ arrLen ï¼Œè¯·ä½ è®¡ç®—å¹¶è¿”å›ï¼šåœ¨æ°å¥½æ‰§è¡Œ steps æ¬¡æ“ä½œä»¥åï¼ŒæŒ‡é’ˆä»ç„¶æŒ‡å‘ç´¢å¼• 0 å¤„çš„æ–¹æ¡ˆæ•°ã€‚</p><p>ç”±äºç­”æ¡ˆå¯èƒ½ä¼šå¾ˆå¤§ï¼Œè¯·è¿”å›æ–¹æ¡ˆæ•° æ¨¡ 10^9 + 7 åçš„ç»“æœã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šsteps = <span class="number">3</span>, arrLen = <span class="number">2</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">4</span></span><br><span class="line">è§£é‡Šï¼š<span class="number">3</span> æ­¥åï¼Œæ€»å…±æœ‰ <span class="number">4</span> ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥åœåœ¨ç´¢å¼• <span class="number">0</span> å¤„ã€‚</span><br><span class="line">å‘å³ï¼Œå‘å·¦ï¼Œä¸åŠ¨</span><br><span class="line">ä¸åŠ¨ï¼Œå‘å³ï¼Œå‘å·¦</span><br><span class="line">å‘å³ï¼Œä¸åŠ¨ï¼Œå‘å·¦</span><br><span class="line">ä¸åŠ¨ï¼Œä¸åŠ¨ï¼Œä¸åŠ¨</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹  2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šsteps = <span class="number">2</span>, arrLen = <span class="number">4</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">2</span></span><br><span class="line">è§£é‡Šï¼š<span class="number">2</span> æ­¥åï¼Œæ€»å…±æœ‰ <span class="number">2</span> ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥åœåœ¨ç´¢å¼• <span class="number">0</span> å¤„ã€‚</span><br><span class="line">å‘å³ï¼Œå‘å·¦</span><br><span class="line">ä¸åŠ¨ï¼Œä¸åŠ¨</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šsteps = <span class="number">4</span>, arrLen = <span class="number">2</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">8</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= steps <= 500</code></li><li><code>1 <= arrLen <= 10^6</code></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>11.24 çš„å‘¨èµ›æœ€åä¸€é¢˜ï¼Œå¾ˆå¯æƒœæ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚è¦æ˜¯æŠŠè¿™é¢˜æ”¾åœ¨ç¬¬ä¸‰é¢˜æˆ‘å¯èƒ½å°±åšå‡ºæ¥äº†ã€‚ã€‚ã€‚ã€‚è¿˜æ˜¯èœå•Š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numWays</span><span class="params">(<span class="keyword">int</span> steps, <span class="keyword">int</span> arrLen)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> mod=<span class="number">1_000_000_007</span>;</span><br><span class="line">    <span class="keyword">long</span>[][] dp=<span class="keyword">new</span> <span class="keyword">long</span>[steps+<span class="number">1</span>][steps+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=steps;i++) {</span><br><span class="line">        <span class="comment">//iæ­¥èƒ½è¾¾åˆ°çš„æœ€å¤§è·ç¦»å°±æ˜¯i,æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå–ä¸€ä¸ªæœ€å°å€¼</span></span><br><span class="line">        <span class="keyword">int</span> k=Math.min(i,arrLen-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<=k;j++) {</span><br><span class="line">            <span class="keyword">if</span> (j==<span class="number">0</span>) {</span><br><span class="line">                dp[i][j]=(dp[i-<span class="number">1</span>][j+<span class="number">1</span>]+dp[i-<span class="number">1</span>][j])%mod;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span> (j<k) {< span><br><span class="line">                dp[i][j]=(dp[i-<span class="number">1</span>][j-<span class="number">1</span>]+dp[i-<span class="number">1</span>][j+<span class="number">1</span>]+dp[i-<span class="number">1</span>][j])%mod;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp[i][j]=(dp[i-<span class="number">1</span>][j-<span class="number">1</span>]+dp[i-<span class="number">1</span>][j])%mod;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>)dp[steps][<span class="number">0</span>];</span><br><span class="line">}</span><br></k)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>æˆ‘æ¯”è¾ƒå–œæ¬¢çš„è®°å¿†åŒ–é€’å½’ğŸ˜ï¼Œ10msç”šè‡³æ¯”ä¸Šé¢è¿˜å¿«ä¸€ç‚¹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> mod=<span class="number">1_000_000_007</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//cache</span></span><br><span class="line">Long[][] cache;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numWays</span><span class="params">(<span class="keyword">int</span> steps, <span class="keyword">int</span> arrLen)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> maxIndex=Math.min(steps,arrLen-<span class="number">1</span>);</span><br><span class="line">    cache=<span class="keyword">new</span> Long[steps+<span class="number">1</span>][maxIndex+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>)dfs(steps,<span class="number">0</span>,maxIndex);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> steps, <span class="keyword">int</span> index,<span class="keyword">int</span> maxIndex)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (steps==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> index==<span class="number">0</span>?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (index<<span class="number">0</span> || index > maxIndex )  {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cache[steps][index]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[steps][index];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//stepsä¸€ç›´åœ¨é€’å‡,stepsæœ€å¤šèµ°åˆ°stepsä½ç½®</span></span><br><span class="line">    <span class="comment">//ä¸ºäº†èŠ‚çº¦æ—¶é—´å¯ä»¥åœ¨è¿™é‡Œä¼˜åŒ–ä¸‹</span></span><br><span class="line">    maxIndex=Math.min(steps,maxIndex);</span><br><span class="line">    <span class="comment">//ä¸åŠ¨</span></span><br><span class="line">    <span class="keyword">long</span> res=dfs(steps-<span class="number">1</span>,index,maxIndex);</span><br><span class="line">    <span class="comment">//å‘å³</span></span><br><span class="line">    res+=dfs(steps-<span class="number">1</span>,index-<span class="number">1</span>,maxIndex);</span><br><span class="line">    <span class="comment">//å‘å·¦</span></span><br><span class="line">    res+=dfs(steps-<span class="number">1</span>,index+<span class="number">1</span>,maxIndex);</span><br><span class="line">    <span class="keyword">return</span> cache[steps][index]=res%mod;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="152-ä¹˜ç§¯æœ€å¤§å­åºåˆ—"><a href="#152-ä¹˜ç§¯æœ€å¤§å­åºåˆ—" class="headerlink" title="152. ä¹˜ç§¯æœ€å¤§å­åºåˆ—"></a><a href="https://leetcode-cn.com/problems/maximum-product-subarray/" target="_blank" rel="noopener">152. ä¹˜ç§¯æœ€å¤§å­åºåˆ—</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºä¸€ä¸ªåºåˆ—ä¸­ä¹˜ç§¯æœ€å¤§çš„è¿ç»­å­åºåˆ—ï¼ˆè¯¥åºåˆ—è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°ï¼‰ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">2</span>,<span class="number">3</span>,-<span class="number">2</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: <span class="number">6</span></span><br><span class="line">è§£é‡Š: å­æ•°ç»„ [<span class="number">2</span>,<span class="number">3</span>] æœ‰æœ€å¤§ä¹˜ç§¯ <span class="number">6</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [-<span class="number">2</span>,<span class="number">0</span>,-<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br><span class="line">è§£é‡Š: ç»“æœä¸èƒ½ä¸º <span class="number">2</span>, å› ä¸º [-<span class="number">2</span>,-<span class="number">1</span>] ä¸æ˜¯å­æ•°ç»„ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è‡ªå·±æœ€å¼€å§‹è‡ªå·±å†™å‡ºæ¥çš„è„‘ç˜«dp</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">maxProduct</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] dp1=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="keyword">int</span>[] dp2=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="comment">//æœ€å¤§å€¼</span></span><br><span class="line">    dp1[<span class="number">0</span>]=nums[<span class="number">0</span>]>=<span class="number">0</span>?nums[<span class="number">0</span>]:<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//æœ€å°å€¼</span></span><br><span class="line">    dp2[<span class="number">0</span>]=nums[<span class="number">0</span>]>=<span class="number">0</span>?<span class="number">0</span>:nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> max=nums[<span class="number">0</span>]><span class="number">0</span>?dp1[<span class="number">0</span>]:dp2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++){< span><br><span class="line">        <span class="keyword">if</span> (nums[i]><span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (nums[i-<span class="number">1</span>]<<span class="number">0</span>) {</span><br><span class="line">                dp1[i]=dp1[i-<span class="number">1</span>]!=<span class="number">0</span>?nums[i]*dp1[i-<span class="number">1</span>]:nums[i];</span><br><span class="line">                dp2[i]=dp2[i-<span class="number">1</span>]*nums[i];</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(nums[i-<span class="number">1</span>]><span class="number">0</span>){</span><br><span class="line">                dp1[i]=dp1[i-<span class="number">1</span>]*nums[i];</span><br><span class="line">                dp2[i]=dp2[i-<span class="number">1</span>]!=<span class="number">0</span>?nums[i]*dp2[i-<span class="number">1</span>]:<span class="number">0</span>;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp1[i]=nums[i];</span><br><span class="line">                dp2[i]=<span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span> (nums[i]<<span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (nums[i-<span class="number">1</span>]<<span class="number">0</span>) {</span><br><span class="line">                dp1[i]=dp2[i-<span class="number">1</span>]*nums[i];</span><br><span class="line">                dp2[i]=dp1[i-<span class="number">1</span>]!=<span class="number">0</span>?dp1[i-<span class="number">1</span>]*nums[i]:nums[i];</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(nums[i-<span class="number">1</span>]><span class="number">0</span>){</span><br><span class="line">                dp1[i]=dp1[i-<span class="number">1</span>]!=<span class="number">0</span>?nums[i]*dp2[i-<span class="number">1</span>]:<span class="number">0</span>;</span><br><span class="line">                dp2[i]=dp1[i-<span class="number">1</span>]*nums[i];</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                dp1[i]=<span class="number">0</span>;</span><br><span class="line">                dp2[i]=nums[i];</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            dp1[i]=<span class="number">0</span>;</span><br><span class="line">            dp2[i]=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//System.out.println(dp1[i]+","+dp2[i]);</span></span><br><span class="line">        max=Math.max(max,dp1[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    //     -2  2  3   -4        </span></span><br><span class="line"><span class="comment">    //dp1:  0  2  6   48        </span></span><br><span class="line"><span class="comment">    //dp2: -2 -4 -12 -24 </span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">    // 2 -5   -2  -4   3</span></span><br><span class="line"><span class="comment">    // 2  0   20   8   24</span></span><br><span class="line"><span class="comment">    // 0 -10  -2  -80 -240</span></span><br><span class="line"><span class="comment">*/</span></span><br></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><p>ä¸æƒ³è§£é‡Šå¤ªå¤šï¼Œè™½ç„¶è¿‡äº†ï¼Œä½†æ˜¯ç¡®å®æœ‰ç‚¹è ¢</p><p><strong>è§£æ³•äºŒ</strong></p><p><code>max[i],min[i]</code> ä»£è¡¨çš„å°±æ˜¯ä»¥<code>nums[i]</code> ç»“å°¾çš„<strong>æœ€å¤§</strong>ä¹˜ç§¯å’Œ<strong>æœ€å°</strong>ä¹˜ç§¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">maxProduct</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>[] min=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="keyword">int</span>[] max=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="keyword">int</span> res=max[<span class="number">0</span>]=min[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        max[i]=Math.max(nums[i]*min[i-<span class="number">1</span>],Math.max(nums[i],nums[i]*max[i-<span class="number">1</span>]));</span><br><span class="line">        min[i]=Math.min(nums[i]*min[i-<span class="number">1</span>],Math.min(nums[i],nums[i]*max[i-<span class="number">1</span>]));</span><br><span class="line">        res=Math.max(res,max[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>ä¸ºä»€ä¹ˆè¦è®°å½•æœ€å°ä¹˜ç§¯ç›¸ä¿¡ä¸éœ€è¦æˆ‘å¤šè¯´äº†å§ï¼Œå…¶å®åªè¦æƒ³æ¸…æ¥šä¸€ç‚¹å°±okï¼Œæ¯ä¸ªä½ç½®çš„<code>max[i]</code>å…¶å®åªæœ‰ä¸‰ç§æ¥æºï¼ˆçº¸ä¸Šå†™å†™å°±æ˜ç™½äº†ï¼‰</p><ul><li><p><code>nums[i] >= 0</code> å¹¶ä¸”<code>max[i-1] > 0</code>ï¼Œ<code>max[i] = max[i-1] * nums[i]</code></p></li><li><p><code>nums[i] >= 0</code> å¹¶ä¸”<code>max[i-1] < 0</code>ï¼Œæ­¤æ—¶å¦‚æœå’Œå‰è¾¹çš„æ•°ç´¯ä¹˜çš„è¯ï¼Œä¼šå˜æˆè´Ÿæ•°ï¼Œæ‰€ä»¥<code>max[i] = nums[i]</code></p></li><li><p><code>nums[i] < 0</code>ï¼Œå¦‚æœæ˜¯è´Ÿæ•°å°±ä¸åº”è¯¥å†å’Œå‰é¢<code>max[i]</code>ç›¸ä¹˜ï¼Œè€Œæ˜¯è€ƒè™‘<code>min[i]</code></p><ul><li><code>å½“min[i-1] < 0ï¼Œmax[i] = min[i-1] * nums[i]</code></li><li><code>å½“min[i-1] >= 0ï¼Œmax[i] = nums[i]</code></li></ul><p>ç„¶åæˆ‘ä»¬ç›´æ¥æ±‚è¿™ä¸‰ç§æƒ…å†µçš„æœ€å¤§å€¼å°±okäº†ï¼Œä¸ç”¨è€ƒè™‘é‚£äº›åˆ†æ”¯ï¼Œæˆ‘ä¸Šé¢çš„ç¬¬ä¸€ç§è§£æ³•å…¶å®å°±æ˜¯è€ƒè™‘äº†æ‰€æœ‰åˆ†æ”¯ï¼Œç»“æœæ‰å†™å‡ºäº†é‚£æ ·çš„dpï¼Œ <code>min[i]</code> çš„è¿‡ç¨‹å’Œä¸Šé¢ä¸€æ ·ï¼Œå°±ä¸èµ˜è¿°</p></li></ul><h2 id="221-æœ€å¤§æ­£æ–¹å½¢"><a href="#221-æœ€å¤§æ­£æ–¹å½¢" class="headerlink" title="221. æœ€å¤§æ­£æ–¹å½¢"></a><a href="https://leetcode-cn.com/problems/maximal-square/" target="_blank" rel="noopener">221. æœ€å¤§æ­£æ–¹å½¢</a></h2><p>åœ¨ä¸€ä¸ªç”± 0 å’Œ 1 ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« 1 çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>é€’æ¨å…¬å¼ï¼š<code>dp[i][j]=1+min(dp[i-1][j-1],dp[i-1][j],dp[i][j-1])</code>  å—¯ï¼Œæƒ³ä¸åˆ°å°±å¾ˆå¯æƒœ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maximalSquare</span><span class="params">(<span class="keyword">char</span>[][] matrix)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (matrix==<span class="keyword">null</span> || matrix.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> m=matrix.length;</span><br><span class="line">    <span class="keyword">int</span> n=matrix[<span class="number">0</span>].length;</span><br><span class="line">    <span class="comment">//è¿™é‡Œ+1å¤„ç†è¾¹ç•Œ</span></span><br><span class="line">    <span class="keyword">int</span>[][] dp=<span class="keyword">new</span> <span class="keyword">int</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=m;i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<=n;j++) {</span><br><span class="line">            <span class="keyword">if</span> (matrix[i-<span class="number">1</span>][j-<span class="number">1</span>]==<span class="string">'1'</span>) {</span><br><span class="line">                dp[i][j]=<span class="number">1</span>+Math.min(dp[i-<span class="number">1</span>][j-<span class="number">1</span>],Math.min(dp[i][j-<span class="number">1</span>],dp[i-<span class="number">1</span>][j]));</span><br><span class="line">                max=Math.max(max,dp[i][j]);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max*max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜è¿˜æœ‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯è¾¹ç•Œçš„å¤„ç†ï¼Œè¿™é‡Œå®ç°çš„ä»£ç ä¸­<code>dp[i][j]</code> å…¶å®è¡¨ç¤ºçš„æ˜¯ä»¥ <code>matrix[i-1][j-1]</code> ä½œä¸ºå³ä¸‹è§’ç»“å°¾çš„æ­£æ–¹å½¢çš„æœ€å¤§è¾¹é•¿ï¼Œè¿™æ ·çš„è¯å°±ä¸ç”¨è€ƒè™‘ä¸Šä¸‹ä¸¤æ¡è¾¹çš„è¾¹ç•Œcaseï¼Œç›¸å½“äºåœ¨dpæ•°ç»„ä¸Šä¸‹è¾¹ç•Œä¹‹å¤–åˆåŠ äº†ä¸€å±‚ 0</p><blockquote><p>åˆ°è¿™é‡Œæˆ‘ä¹Ÿå¤§è‡´æ˜ç™½äº†ä¸€äº›åŠ¨æ€è§„åˆ’çš„é¢˜ç›®çš„é€’æ¨å†™æ³•ä¸ºéƒ½æ˜¯ä»1å¼€å§‹äº†ï¼Œæ¯”å¦‚ä¸Šé¢çš„ç¼–è¾‘è·ç¦»</p></blockquote><h2 id="1277-ç»Ÿè®¡å…¨ä¸º-1-çš„æ­£æ–¹å½¢å­çŸ©é˜µ"><a href="#1277-ç»Ÿè®¡å…¨ä¸º-1-çš„æ­£æ–¹å½¢å­çŸ©é˜µ" class="headerlink" title="1277. ç»Ÿè®¡å…¨ä¸º 1 çš„æ­£æ–¹å½¢å­çŸ©é˜µ"></a><a href="https://leetcode-cn.com/problems/count-square-submatrices-with-all-ones/" target="_blank" rel="noopener">1277. ç»Ÿè®¡å…¨ä¸º 1 çš„æ­£æ–¹å½¢å­çŸ©é˜µ</a></h2><p>ç»™ä½ ä¸€ä¸ª <code>m * n</code> çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­çš„å…ƒç´ ä¸æ˜¯ <code>0</code> å°±æ˜¯ <code>1</code>ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å›å…¶ä¸­å®Œå…¨ç”± <code>1</code> ç»„æˆçš„ <strong>æ­£æ–¹å½¢</strong> å­çŸ©é˜µçš„ä¸ªæ•°ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix =</span><br><span class="line">[</span><br><span class="line">  [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">15</span></span><br><span class="line">è§£é‡Šï¼š </span><br><span class="line">è¾¹é•¿ä¸º <span class="number">1</span> çš„æ­£æ–¹å½¢æœ‰ <span class="number">10</span> ä¸ªã€‚</span><br><span class="line">è¾¹é•¿ä¸º <span class="number">2</span> çš„æ­£æ–¹å½¢æœ‰ <span class="number">4</span> ä¸ªã€‚</span><br><span class="line">è¾¹é•¿ä¸º <span class="number">3</span> çš„æ­£æ–¹å½¢æœ‰ <span class="number">1</span> ä¸ªã€‚</span><br><span class="line">æ­£æ–¹å½¢çš„æ€»æ•° = <span class="number">10</span> + <span class="number">4</span> + <span class="number">1</span> = <span class="number">15</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šmatrix = </span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">7</span></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">è¾¹é•¿ä¸º <span class="number">1</span> çš„æ­£æ–¹å½¢æœ‰ <span class="number">6</span> ä¸ªã€‚ </span><br><span class="line">è¾¹é•¿ä¸º <span class="number">2</span> çš„æ­£æ–¹å½¢æœ‰ <span class="number">1</span> ä¸ªã€‚</span><br><span class="line">æ­£æ–¹å½¢çš„æ€»æ•° = <span class="number">6</span> + <span class="number">1</span> = <span class="number">7</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 <= arr.length <= 300</code></li><li><code>1 <= arr[0].length <= 300</code></li><li><code>0 <= arr[i][j] <= 1</code></li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>12.1çš„å‘¨èµ›é¢˜ç›®ï¼Œå…¶å®å…ˆåšçš„ä¸Šé¢çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œç„¶åå‘ç°è¿™ä¸€é¢˜å’Œä¸Šé¢çš„ä¸€æ ·ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countSquares</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (matrix==<span class="keyword">null</span> || matrix.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> m=matrix.length;</span><br><span class="line">    <span class="keyword">int</span> n=matrix[<span class="number">0</span>].length;</span><br><span class="line">    <span class="keyword">int</span> [][]dp=<span class="keyword">new</span> <span class="keyword">int</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<=m;i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>;j<=n;j++) {</span><br><span class="line">            <span class="keyword">if</span> (matrix[i-<span class="number">1</span>][j-<span class="number">1</span>]==<span class="number">1</span>) {</span><br><span class="line">                dp[i][j]=Math.min(dp[i-<span class="number">1</span>][j-<span class="number">1</span>],Math.min(dp[i][j-<span class="number">1</span>],dp[i-<span class="number">1</span>][j]))+<span class="number">1</span>;</span><br><span class="line">                res+=dp[i][j];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€æ‘¸ä¸€æ ·ï¼Œç†è§£ä¸€ç‚¹å°±okï¼Œ<strong>ä»¥<code>matrix[i][j]</code> ä¸ºå³ä¸‹è§’çš„æœ€å¤§æ­£æ–¹å½¢çš„è¾¹é•¿ï¼Œå°±æ˜¯ä»¥è¿™ä¸ªç‚¹ä¸ºå³ä¸‹è§’çš„æ­£æ–¹å½¢çš„æ•°é‡ï¼ï¼ï¼</strong></p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆäºŒï¼‰</title>
      <link href="/2019/08/17/shen-ru-li-jie-java-xu-ni-ji-er/"/>
      <url>/2019/08/17/shen-ru-li-jie-java-xu-ni-ji-er/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><blockquote><p>è¿™ä¸€ç¯‡ä¸»è¦è®²JVMçš„ç±»åŠ è½½æœºåˆ¶ï¼Œæœ¬æ¥å¾ˆä¹…ä¹‹å‰å°±å†™äº†ï¼Œä½†æ˜¯è¿™å‡ å¤©åˆé‡æ–°å­¦ä¹ äº†ä¸€éï¼Œçº æ­£äº†ä¹‹å‰å¾ˆå¤šé”™è¯¯çš„è§‚ç‚¹ï¼Œç„¶ååˆè¡¥å……äº†å¾ˆå¤šä¸œè¥¿</p></blockquote><h2 id="ç±»åŠ è½½çš„è¿‡ç¨‹"><a href="#ç±»åŠ è½½çš„è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½çš„è¿‡ç¨‹"></a>ç±»åŠ è½½çš„è¿‡ç¨‹</h2><p><strong>å‰è¨€ï¼š</strong></p><p>â€‹    åœ¨Javaè¯­è¨€ä¸­ï¼Œç±»å‹çš„åŠ è½½ï¼Œè¿æ¥å’Œåˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯åœ¨<strong>è¿è¡ŒæœŸé—´</strong>å®Œæˆçš„ï¼Œè¿™ä¸é‚£äº›åœ¨<strong>ç¼–è¯‘æœŸé—´</strong>éœ€è¦è¿›è¡Œé“¾æ¥å·¥ä½œçš„è¯­è¨€ï¼ˆC/C++ï¼‰ä¸åŒï¼Œè¿™æ ·æ¯«æ— ç–‘é—®ä¼šå¢åŠ ç±»åŠ è½½çš„æ€§èƒ½å¼€é”€ï¼Œä½†æ˜¯ä¼šä¸ºJavaæä¾›é«˜åº¦çš„çµæ´»æ€§ï¼ŒJavaå¤©ç”Ÿå¯ä»¥åŠ¨æ€æ‰©å±•çš„å°±æ˜¯ä¾èµ–äºè¿è¡Œæ—¶æœŸ<strong>åŠ¨æ€åŠ è½½å’ŒåŠ¨æ€é“¾æ¥</strong>è¿™ä¸ªç‰¹ç‚¹å®ç°çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¥å£ï¼Œå®Œå…¨å¯ä»¥åœ¨è¿è¡Œæ—¶æœŸåŠ¨æ€çš„æŒ‡å®šå…¶å…·ä½“çš„å®ç°ç±»ã€‚åˆæˆ–è€…ç”¨æˆ·å¯ä»¥é€šè¿‡ç±»åŠ è½½å™¨è®©ä¸€ä¸ªæœ¬åœ°çš„å¼•ç”¨è¿è¡Œæ—¶ä»å…¶ä»–åœ°æ–¹ï¼ˆç½‘ç»œç­‰ï¼‰åŠ è½½ä¸€ä¸ªäºŒè¿›åˆ¶çš„æµä½œä¸ºç¨‹åºä»£ç çš„ä¸€éƒ¨åˆ†ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190418/em4YNNmXXmho.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="â‘ åŠ è½½"><a href="#â‘ åŠ è½½" class="headerlink" title="â‘ åŠ è½½"></a>â‘ åŠ è½½</h3><ul><li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li><li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</li><li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ <code>java.lang.Class</code> å¯¹è±¡</li></ul><h4 id="ç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©"><a href="#ç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©" class="headerlink" title="ç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©"></a>ç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©</h4><blockquote><p>ç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©æ˜¯ä½äºå †ä¸­çš„<code>Class</code>å¯¹è±¡</p></blockquote><p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹é‡Œé¢ä»‹ç»çš„JVMå†…å­˜ç»“æ„(p39)</p><p><img alt="JVMå†…å­˜ç»“æ„" data-src="http://static.imlgw.top///20190417/yk2bzxILsCpL.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>å †ï¼ˆHeapï¼‰</strong>ï¼šæœ€å¤§çš„ä¸€å—åŒºåŸŸï¼Œçº¿ç¨‹å…±äº«ã€‚æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ã€‚å›æ”¶å™¨ä¸»è¦ç®¡ç†çš„å¯¹è±¡ã€‚</p><blockquote><p>The Java Virtual Machine has a <em>heap</em> that is <code>shared</code> among <code>all</code> Java Virtual Machine threads. The heap is the run-time data area from which memory for all class instances and arrays is allocated.</p><p>The heap is created on virtual machine <code>start-up</code>. Heap storage for objects is reclaimed by an automatic storage management system (known as a <em>garbage collector(GC)</em>); </p><p>æ‘˜è‡ª  <a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.3" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><p><strong>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</strong>ï¼šåˆç§°ä¸º<code>éå †</code>ï¼Œçº¿ç¨‹å…±äº«ã€‚å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚</p><blockquote><p>The Java Virtual Machine has a <em>method area</em> that is <code>shared</code> among all Java Virtual Machine threads. The method area is analogous to the storage area for compiled code of a conventional language or analogous to the â€œtextâ€ segment in an operating system process. It stores per-class structures such as the <strong>run-time constant pool</strong>, <strong>field</strong> and <strong>method data</strong>, and the code for methods and constructors, including the special methods (<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.9" target="_blank" rel="noopener">Â§2.9</a>) used in class and instance initialization and interface initialization.</p></blockquote><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± (run-time constant pool)</strong>ï¼š</p><p>æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡â€123â€ï¼Œâ€LGWâ€ ç­‰å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå’Œç¬¦å·å¼•ç”¨ã€‚è¿è¡Œæ—¶å¸¸é‡æ± å…·æœ‰åŠ¨æ€æ€§ï¼Œå¹¶éåªæœ‰Classæ–‡ä»¶ä¸­çš„å†…å®¹æ‰èƒ½è¿›å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œè¿è¡ŒæœŸé—´ä¹Ÿèƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ã€‚å¦‚String.intern()æ–¹æ³•ã€‚</p><p><strong>æ–¹æ³•æ ˆï¼ˆJVM Stackï¼‰</strong>ï¼š</p><p>çº¿ç¨‹ç§æœ‰ã€‚å­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ï¼Œ<code>å¯¹è±¡æŒ‡é’ˆ</code>ã€‚</p><p><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</strong>ï¼š</p><p>çº¿ç¨‹ç§æœ‰ã€‚ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Native æ–¹æ³•æœåŠ¡ã€‚å¦‚Javaä½¿ç”¨cæˆ–è€…c++ç¼–å†™çš„æ¥å£æœåŠ¡æ—¶ï¼Œä»£ç åœ¨æ­¤åŒºè¿è¡Œã€‚</p><p><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</strong>ï¼š</p><p>çº¿ç¨‹ç§æœ‰ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚æŒ‡å‘ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p><h4 id="åŠ è½½ç±»çš„æ–¹å¼"><a href="#åŠ è½½ç±»çš„æ–¹å¼" class="headerlink" title="åŠ è½½ç±»çš„æ–¹å¼"></a>åŠ è½½ç±»çš„æ–¹å¼</h4><ul><li>æœ¬åœ°ç£ç›˜ classpath</li><li>å†…å­˜ä¸­åŠ è½½ ï¼ŒåŠ¨æ€ä»£ç†ï¼ŸRPC?</li><li>é€šè¿‡ç½‘ç»œåŠ è½½.class</li><li>ä»zipï¼Œjarä¸­åŠ è½½</li><li>æ•°æ®åº“ä¸­æå–.class</li><li>åŠ¨æ€ç¼–è¯‘</li></ul><h3 id="â‘¡è¿æ¥"><a href="#â‘¡è¿æ¥" class="headerlink" title="â‘¡è¿æ¥:"></a>â‘¡è¿æ¥:</h3><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p><strong>æ–‡ä»¶æ ¼å¼éªŒè¯</strong></p><ul><li><p>æ˜¯å¦ä»¥é­”æ•°<code>0xCAFEBABE</code>ï¼ˆå’–å•¡å®è´ï¼‰å¼€å¤´</p></li><li><p>ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†…</p></li><li><p>å¸¸é‡æ± ä¸­çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡tagæ ‡å¿—ï¼‰</p></li><li><p>â€¦..</p></li></ul><p><strong>å…ƒæ•°æ®éªŒè¯</strong></p><p>ç¬¬äºŒé˜¶æ®µæ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„è¦æ±‚</p><p><strong>å­—èŠ‚ç éªŒè¯</strong></p><p>ä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„</p><p>ç”±äºæ•°æ®æµéªŒè¯çš„é«˜å¤æ‚æ€§ï¼Œè™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿä¸ºäº†é¿å…è¿‡å¤šçš„æ—¶é—´æ¶ˆè€—åœ¨å­—èŠ‚ç éªŒè¯é˜¶æ®µï¼Œåœ¨ JDK 1.6 ä¹‹åçš„ Javac ç¼–è¯‘å™¨å’Œ Java è™šæ‹Ÿæœºä¸­è¿›è¡Œäº†ä¸€é¡¹ä¼˜åŒ–ï¼Œç»™æ–¹æ³•ä½“çš„ Code å±æ€§çš„å±æ€§è¡¨ä¸­å¢åŠ äº†ä¸€é¡¹åä¸ºâ€ StackMapTableâ€ çš„å±æ€§, åªéœ€è¦æ£€æŸ¥StackMapTableå±æ€§ä¸­çš„è®°å½•æ˜¯å¦åˆæ³•çš†å¯ä»¥äº†</p><p><strong>ç¬¦å·å¼•ç”¨éªŒè¯</strong></p><p>ç¬¦å·å¼•ç”¨çš„æ ¡éªŒå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†<code>ç¬¦å·å¼•ç”¨</code>è½¬åŒ–ä¸º<code>ç›´æ¥å¼•ç”¨</code>çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”-<strong>è§£æ</strong>é˜¶æ®µä¸­å‘ç”Ÿï¼Œé€šå¸¸éœ€è¦æ ¡éªŒä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»</li><li>åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•çš„å­—æ®µæè¿°ä»¥åŠç®€å•åç§°è¯´æè¿°çš„æ–¹æ³•å’Œå­—æ®µã€‚</li><li>ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ï¼Œå­—æ®µï¼Œæ–¹æ³•çš„è®¿é—®æ€§æ˜¯å¦å¯ä»¥è¢«å½“å‰ç±»è®¿é—®</li><li>â€¦â€¦.</li></ul><p>å¦‚æœæ‰€è¿è¡Œçš„å…¨éƒ¨ä»£ç ï¼ˆåŒ…æ‹¬è‡ªå·±ç¼–å†™çš„åŠç¬¬ä¸‰æ–¹åŒ…ä¸­çš„ä»£ç ï¼‰éƒ½å·²ç»è¢«åå¤ä½¿ç”¨å’ŒéªŒè¯è¿‡ï¼Œé‚£ä¹ˆåœ¨å®æ–½é˜¶æ®µå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨-Xverify:none å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´</p><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><p>ä¸ºç±»çš„<strong>é™æ€å˜é‡</strong>åˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>boolean</td><td>false</td></tr><tr><td>char</td><td>â€˜/u0000â€™</td></tr><tr><td>byte</td><td>(byte)0</td></tr><tr><td>short</td><td>(short)0</td></tr><tr><td>int</td><td>0</td></tr><tr><td>long</td><td>0L</td></tr><tr><td>double</td><td>0.0d</td></tr><tr><td>float</td><td>0.0f</td></tr><tr><td>reference</td><td>null</td></tr></tbody></table><p>ğŸ¯ å½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šåˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œå¦‚æœå­—æ®µè¡¨çš„å±æ€§ä¸­æœ‰<code>ConstantValue</code> ï¼Œå‡†å¤‡é˜¶æ®µå°±ä¼šç›´æ¥åˆå§‹åŒ–ä¸ºè¿™ä¸ªè¿™ä¸ª<code>ConstantValue</code>å±æ€§çš„å€¼</p><h4 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h4><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†<strong>å¸¸é‡æ± </strong>å†…çš„<strong>ç¬¦å·å¼•ç”¨</strong>æ›¿æ¢ä¸º<strong>ç›´æ¥å¼•ç”¨</strong>çš„è¿‡ç¨‹ã€‚</p><ul><li><strong>ç¬¦å·å¼•ç”¨ï¼š</strong> ç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨çš„æ—¶å€™èƒ½æ— æ­§ä¹‰çš„å®šä½åˆ°ç›®æ ‡ä¸­å°±è¡Œã€‚</li><li><strong>ç›´æ¥å¼•ç”¨ï¼š</strong> ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆï¼Œç›¸å¯¹åç§»é‡æˆ–è€…ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</li></ul><p>é™¤ <code>invokedynamic</code>(åŠ¨æ€è¯­è¨€æ”¯æŒ) æŒ‡ä»¤ä»¥å¤–ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥å¯¹ç¬¬ä¸€æ¬¡è§£æçš„ç»“æœè¿›è¡Œç¼“å­˜ã€‚</p><p>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µè§£æã€ç±»æ–¹æ³•è§£æã€æ¥å£æ–¹æ³•è§£æã€æ–¹æ³•ç±»å‹è§£æã€æ–¹æ³•å¥æŸ„è§£æå’Œè°ƒç”¨ç‚¹é™å®šç¬¦ 7 ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚</p><p>å…³äºè¿™ä¸ªä¹Ÿå¯ä»¥çœ‹çœ‹Rå¤§çš„å›ç­” <a href="https://www.zhihu.com/question/30300585/answer/51335493" target="_blank" rel="noopener">JVMç¬¦å·å¼•ç”¨è½¬æ¢ç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ </a>( å¹çˆ†æˆ‘Rå¤§ ğŸ˜</p><h3 id="â‘¢åˆå§‹åŒ–ï¼š"><a href="#â‘¢åˆå§‹åŒ–ï¼š" class="headerlink" title="â‘¢åˆå§‹åŒ–ï¼š"></a>â‘¢åˆå§‹åŒ–ï¼š</h3><p>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œ<code>ç±»æ„é€ å™¨<clinit></clinit></code>æ–¹æ³•çš„è¿‡ç¨‹</p><h4 id="ç±»æ„é€ å™¨-lt-client-gt"><a href="#ç±»æ„é€ å™¨-lt-client-gt" class="headerlink" title="ç±»æ„é€ å™¨<client>"></a>ç±»æ„é€ å™¨<client></client></h4><p>ğŸ’¡<code><clinit></clinit></code>æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰<strong>ç±»å˜é‡çš„èµ‹å€¼</strong>åŠ¨ä½œå’Œ<strong>é™æ€è¯­å¥å—</strong>ï¼ˆstaticå—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­<strong>å‡ºç°çš„é¡ºåºå†³å®šçš„</strong>ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—<strong>å¯ä»¥èµ‹å€¼</strong>ï¼Œä½†æ˜¯<strong>ä¸èƒ½è®¿é—®</strong>ï¼ˆæ¯”å¦‚printï¼‰</p><p>ğŸ’¡ å’Œ<strong>å®ä¾‹æ„é€ å™¨</strong><code><init></init></code> ä¸åŒï¼Œä¸éœ€è¦æ˜¾å¼çš„å»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„<code><clinit></clinit></code>æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„<code><clinit></clinit></code>æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„<code><clinit></clinit></code> ä¸€å®šæ˜¯Objectç±»</p><p>ğŸ’¡<code><clinit></clinit></code> æ–¹æ³•å¯¹äºç±»æˆ–è€…æ¥å£æ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ä¹Ÿæ²¡æœ‰é™æ€å˜é‡çš„<strong>èµ‹å€¼</strong>æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ<code><clinit></clinit></code> æ–¹æ³•</p><p>ğŸ’¡ å¯¹äºæ¥å£ï¼Œä¸èƒ½ä½¿ç”¨staticå—ï¼Œä½†æ˜¯å¯ä»¥æœ‰é™æ€å˜é‡çš„èµ‹å€¼æ“ä½œã€‚å­ç±»æ¥å£çš„<code><clinit></clinit></code>æ–¹æ³•è°ƒç”¨å¹¶ä¸ä¿è¯çˆ¶æ¥å£çš„<code><clinit></clinit></code>æ–¹æ³•è¢«å…ˆè°ƒç”¨ï¼Œåªæœ‰ç”¨åˆ°çˆ¶æ¥å£çš„é™æ€å˜é‡çš„æ—¶å€™ï¼Œçˆ¶æ¥å£<code><clinit></clinit></code>æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ã€‚æ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„<code><clinit></clinit></code>æ–¹æ³•ã€‚</p><p>ğŸ’¡ è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„<code><clinit></clinit></code>æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åœ°åŠ é”ã€åŒæ­¥ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„<code><clinit></clinit></code>æ–¹æ³•è°ƒç”¨æ—¶é—´è¿‡é•¿ï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ã€‚Demoå¦‚ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClinitThreadTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">new</span> Thread(()-><span class="keyword">new</span> SimpleObj()).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-><span class="keyword">new</span> SimpleObj()).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-><span class="keyword">new</span> SimpleObj()).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleObj</span></span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> AtomicBoolean init=<span class="keyword">new</span> AtomicBoolean(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> {</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" i will be init"</span>);</span><br><span class="line">            <span class="keyword">while</span> (init.get()){</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="string">"i am finished"</span>);</span><br><span class="line">       }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼"><a href="#ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼" class="headerlink" title="ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼"></a>ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼</h4><p>ä¸‹é¢è¿™ä¸ªDemoå¾ˆç»å…¸ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ç±»åŠ è½½çš„è¿‡ç¨‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon ins=<span class="keyword">new</span> SingleTon();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">int</span> x=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span></span>{</span><br><span class="line">        x++;y++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getIns</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> ins;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SingleTon singleTon=getIns();</span><br><span class="line">        System.out.println(singleTon.x);</span><br><span class="line">        System.out.println(singleTon.y);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¦‚æœä¸ç†Ÿæ‚‰ç±»åŠ è½½çš„è¿‡ç¨‹å¯èƒ½ä¸€çœ¼å°±è§‰å¾—åº”è¯¥æ˜¯ï¼ˆ1ï¼Œ1ï¼‰ï¼Œå…¶å®ä¸ç„¶ï¼Œç»“åˆä¸Šé¢çš„åŠ è½½è¿‡ç¨‹åˆ†æ</p><p>ğŸ”º é¦–å…ˆåŠ è½½è¿æ¥ï¼Œç„¶åæ‰§è¡Œå‡†å¤‡å·¥ä½œï¼Œåœ¨æ‰§è¡Œå®Œ<strong>å‡†å¤‡é˜¶æ®µ</strong>å·¥ä½œåä¸‰ä¸ªé™æ€å˜é‡éƒ½æœ‰äº†<strong>é»˜è®¤çš„åˆå§‹å€¼</strong>ï¼Œç„¶åè¿›å…¥åˆå§‹åŒ–é˜¶æ®µ</p><p>ğŸ”º <code><clinit></clinit></code>åˆå§‹åŒ–é˜¶æ®µä¼šæŒ‰é¡ºåº<strong>ä»ä¸Šå¾€ä¸‹</strong>ä¾æ¬¡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼Œæ‰€ä»¥<strong>å…ˆæ‰§è¡Œ</strong>äº†<code>new Singleton()</code>ç»™<code>ins</code>èµ‹åˆå§‹å€¼ï¼Œä¼šè°ƒç”¨å®ƒçš„æ„é€ å™¨ï¼Œç„¶åxï¼Œyéƒ½++å˜ä¸º1ï¼Œ<strong>å†ç„¶å</strong>å°±ä¼šç»™xï¼Œyèµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼Œxåˆå§‹å€¼ä¸º0ï¼Œè€Œyæ²¡æœ‰åˆå§‹å€¼æ‰€ä»¥å°±æ˜¯ï¼ˆ0ï¼Œ1ï¼‰</p><h3 id="Classå¯¹è±¡åœ¨å“ªé‡Œï¼Ÿ"><a href="#Classå¯¹è±¡åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="Classå¯¹è±¡åœ¨å“ªé‡Œï¼Ÿ"></a>Classå¯¹è±¡åœ¨å“ªé‡Œï¼Ÿ</h3><p>å…ˆè¯´ç»“è®ºï¼ŒClasså¯¹è±¡å’Œå…¶ä»–æ™®é€šçš„Javaå¯¹è±¡ä¸€æ ·éƒ½æ˜¯å­˜æ”¾åœ¨å †ä¸­çš„ã€‚</p><p>å­˜æ”¾åœ¨æ–¹æ³•åŒºçš„æ˜¯ç±»çš„å…ƒæ•°æ®(InstanceKlassï¼ŒåŒ…æ‹¬ç±»çš„å¸¸é‡æ± ( constant pool)  ï¼ŒåŸŸ(Field)ä¿¡æ¯  ï¼Œæ–¹æ³•(Method)ä¿¡æ¯ ï¼Œé™¤äº†å¸¸é‡å¤–çš„æ‰€æœ‰é™æ€(static)å˜é‡ ç­‰)ï¼Œ<code>java.lang.Classå®ä¾‹</code>å¹¶ä¸è´Ÿè´£è®°å½•çœŸæ­£çš„ç±»å…ƒæ•°æ®ï¼Œè€Œåªæ˜¯å¯¹VMå†…éƒ¨çš„<code>InstanceKlass</code>å¯¹è±¡çš„ä¸€ä¸ªåŒ…è£…ä¾›Javaçš„åå°„è®¿é—®ç”¨ï¼Œåœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸€ä¹¦é‡Œé¢è¯´çš„å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­åº”è¯¥æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><p><strong>ç±»(é™æ€)å˜é‡å­˜æ”¾åœ¨å“ªé‡Œ</strong></p><p>ä»JDK 1.3åˆ°JDK 6çš„HotSpot VMï¼Œé™æ€å˜é‡ä¿å­˜åœ¨ç±»çš„å…ƒæ•°æ®ï¼ˆInstanceKlassï¼‰çš„æœ«å°¾(æ°¸ä¹…ä»£)ã€‚è€Œä»JDK 7å¼€å§‹çš„HotSpot VMï¼Œé™æ€å˜é‡åˆ™æ˜¯ä¿å­˜åœ¨ç±»çš„Javaé•œåƒï¼ˆjava.lang.Classå®ä¾‹ï¼‰çš„æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯å †ä¸­</p><p>å‚è€ƒ Rå¤§ <a href="https://www.zhihu.com/question/50258991" target="_blank" rel="noopener">çŸ¥ä¹å›ç­”</a> </p><h2 id="Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼"><a href="#Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼"></a>Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼</h2><p>æ‰€æœ‰çš„javaè™šæ‹Ÿæœºå®ç°å¿…é¡»åœ¨æ¯ä¸ªç±»æˆ–æ¥å£è¢«javaç¨‹åº<strong>é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨</strong>æ—¶æ‰<strong>åˆå§‹åŒ–</strong>å®ƒä»¬</p><h3 id="ä¸»åŠ¨ä½¿ç”¨"><a href="#ä¸»åŠ¨ä½¿ç”¨" class="headerlink" title="ä¸»åŠ¨ä½¿ç”¨"></a>ä¸»åŠ¨ä½¿ç”¨</h3><ul><li>åˆ›å»ºç±»çš„å®ä¾‹ï¼ˆnewï¼‰</li><li>å¯¹æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡è¿›è¡Œè¯»å†™ï¼ˆgetstaticï¼Œputstaticï¼‰</li><li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ï¼ˆinvokestaticï¼‰</li><li>åå°„æŸä¸ªç±» ï¼ˆClass.forName()ä¹Ÿå¯ä»¥è®¾ç½®ä¸åˆå§‹åŒ–ç±»ï¼‰</li><li>åˆå§‹åŒ–å­ç±»æ—¶ä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±»</li><li>å¯åŠ¨ç±» java HelloWorld  åŒ…å«mainå‡½æ•°çš„ç±»</li><li>Jdk1.7çš„åŠ¨æ€è¯­è¨€æ”¯æŒ</li></ul><h3 id="è¢«åŠ¨ä½¿ç”¨"><a href="#è¢«åŠ¨ä½¿ç”¨" class="headerlink" title="è¢«åŠ¨ä½¿ç”¨"></a>è¢«åŠ¨ä½¿ç”¨</h3><p>é™¤äº†ä¸Šé¢ 7 ä¸ªä¹‹å¤–ï¼Œå…¶å®ƒçš„éƒ½æ˜¯è¢«åŠ¨ä½¿ç”¨ï¼Œ<strong>ä¸ä¼šåˆå§‹åŒ–ç±»</strong>ï¼Œä¸‹é¢çš„Demoæœ‰å‡ ä¸ªå¾ˆå®¹æ˜“å‡ºé”™çš„çš„ä¾‹å­</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader_study.misc;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassActiveUse</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        System.out.println(<span class="string">"main is init"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>{</span><br><span class="line">        <span class="comment">//System.out.println(Obj.t);</span></span><br><span class="line">        <span class="comment">//Obj.getObj();</span></span><br><span class="line">        <span class="comment">//Class.forName("classloader_study.Obj");</span></span><br><span class="line">        <span class="comment">//System.out.println(ObjChild.age);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//çˆ¶ç±»ä¼šè¢«åˆå§‹åŒ– é€šè¿‡å­ç±»è°ƒç”¨çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ–ä½†æ˜¯ä¼šè¢«åŠ è½½ </span></span><br><span class="line">        <span class="comment">//1. System.out.println(ObjChild.n);</span></span><br><span class="line">        <span class="comment">//ä¸ä¼šåˆå§‹åŒ– å®šä¹‰åº”ç”¨æ•°ç»„ä¹Ÿä¸ä¼šåˆå§‹åŒ–ç±»ï¼Œä½†æ˜¯ä¼šåŠ è½½ç±»</span></span><br><span class="line">        <span class="comment">//2. Obj [] arrays=new Obj[10]; </span></span><br><span class="line">        <span class="comment">//ä¸ä¼šåˆå§‹åŒ– å¸¸é‡ä¼šåœ¨ç¼–è¯‘æœŸé—´æ”¾åˆ°å¸¸é‡æ± ä¸­ä¸ä¼šåˆå§‹åŒ–ç±»ä¹Ÿä¸ä¼šåŠ è½½ï¼Œå­ç±»åŠ è½½ä¹Ÿä¸€æ ·</span></span><br><span class="line">        <span class="comment">//3. System.out.println(Obj.t); </span></span><br><span class="line">        <span class="comment">//Objä¼šè¢«åˆå§‹åŒ–   finalä¿®é¥°çš„å¤æ‚åŒ–ç±»å‹å†ç¼–è¯‘æœŸé—´æ— æ³•è®¡ç®—å¾—åˆ°ï¼Œä¼šåˆå§‹åŒ–ç±»</span></span><br><span class="line">        <span class="comment">//4. System.out.println(Obj.x); </span></span><br><span class="line">        <span class="comment">// ç±»åŠ è½½å™¨å»åŠ è½½</span></span><br><span class="line">        <span class="comment">//5. ClassLoader.loadClass();</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Obj</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> <span class="keyword">int</span> t=<span class="number">10</span>;  <span class="comment">//ç¼–è¯‘æœŸé—´å°±å·²ç»ç¡®å®šäº†å°±æ˜¯10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> n=<span class="number">111</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> x=<span class="keyword">new</span> Random().nextInt(<span class="number">100</span>); <span class="comment">//å€¼ä¸æ˜¯å¸¸é‡ï¼Œè¿è¡ŒæœŸé—´æ‰ä¼šç¡®å®š</span></span><br><span class="line">    <span class="keyword">static</span> { </span><br><span class="line">        System.out.println(<span class="string">"Obj is init"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getObj</span><span class="params">()</span></span>{</span><br><span class="line">        System.out.println(<span class="string">"NULL"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjChild</span> <span class="keyword">extends</span> <span class="title">Obj</span></span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> age=<span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        System.out.println(<span class="string">"Child is init"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">I</span></span>{</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> a=<span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>âš¡new ä¸€ä¸ªObjæ•°ç»„çš„æ—¶å€™ï¼Œ<strong>ä¼šåŠ è½½</strong>Objç±»ï¼Œ<strong>ä¸ä¼šåˆå§‹åŒ–</strong>Objå¯¹è±¡ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å¦ä¸€ä¸ªç±»çš„åˆå§‹åŒ–: <code>Lclassloader_study.misc.Obj</code>  è¿™ä¸ªç±»å°±ä»£è¡¨äº†ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºObjçš„ä¸€ç»´æ•°ç»„ï¼Œæ•°ç»„ä¸­åº”æœ‰çš„å±æ€§lengthå’Œæ–¹æ³•clone()éƒ½æ˜¯åœ¨è¿™ä¸ªç±»å®ç°çš„ï¼Œè¿™ä¸ªç±»æ˜¯ç”±JVMåœ¨è¿è¡ŒæœŸé—´åŠ¨æ€çš„ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ï¼Œè¿™ä¸ªåŠ¨ä½œç”±<code>anewarray</code> æŒ‡ä»¤è§¦å‘ï¼Œè€ŒåŸºæœ¬ç±»å‹çš„æ•°ç»„ç”± <code>newarray</code> æŒ‡ä»¤è§¦å‘ã€‚</p><p>âš¡ finalä¿®é¥°çš„å¸¸é‡ä¼šåœ¨<strong>ç¼–è¯‘æœŸé—´</strong>å°±æ”¾åˆ°è°ƒç”¨è¿™ä¸ªå˜é‡çš„æ–¹æ³•çš„ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæ—¢ä¸ä¼šåŠ è½½ä¹Ÿä¸ä¼šåˆå§‹åŒ–ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åç¼–è¯‘<code>ClassActiveUse</code> çœ‹çš„åˆ°ï¼Œä¸¤ä¸ªç±»ä¸å­˜åœ¨ä»»ä½•å…³ç³»äº†ï¼Œç”šè‡³å¯ä»¥åœ¨ç¼–è¯‘å®Œæˆå<code>å°†Objçš„classæ–‡ä»¶åˆ æ‰</code>ä»ç„¶å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯åé¢çš„å¦ä¸€ä¸ªfinalå¸¸é‡å¾ˆæ˜æ˜¾åœ¨<strong>ç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šå€¼</strong>ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½å›å»åˆ°å€¼ï¼Œæ‰€ä»¥ä¼šåŠ è½½å¹¶åˆå§‹åŒ–ç±»</p><p>âš¡ å¯¹æ¥å£çš„åˆå§‹åŒ–å’Œå¯¹ç±»çš„åˆå§‹åŒ–æœ‰ä¸€ç‚¹ä¸åŒï¼Œæ¥å£ä¹Ÿæœ‰åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ¥å£å’Œç±»çœŸæ­£æœ‰åŒºåˆ«æ˜¯åœ¨ä¸Šé¢ä¸»åŠ¨ä½¿ç”¨çš„ç¬¬5ç‚¹ï¼Œåœ¨<strong>å­æ¥å£è¢«åŠ è½½çš„æ—¶å€™å¹¶ä¸è¦æ±‚å…¶çˆ¶æ¥å£å…¨éƒ¨å®Œæˆäº†åˆå§‹åŒ–</strong>ï¼Œåªæœ‰åœ¨çœŸæ­£ä½¿ç”¨åˆ°çˆ¶æ¥å£çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ï¼Œè¿™ä¸€ç‚¹å¯ä»¥å‚è€ƒå‰æ–‡çš„ <a href="#â‘¢åˆå§‹åŒ–ï¼š">ç±»æ„é€ å™¨éƒ¨åˆ†</a></p><blockquote><p><code>-XX:+TraceClassLoading</code> å¯ä»¥ç”¨æ¥è¿½è¸ªç±»çš„åŠ è½½ä¿¡æ¯å¹¶ä¸”æ‰“å°å‡ºæ¥</p></blockquote><h3 id="å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½"></a>å¯¹è±¡çš„è®¿é—®å®šä½</h3><p><strong>å¦‚æœç›´æ¥ä½¿ç”¨å¥æŸ„è®¿é—®</strong>ï¼Œjavaå †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreferenceä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190418/FRA9GB31iiXH.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®</strong>ï¼Œé‚£ä¹ˆjavaå †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œreferenceä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè‡ªå·±Classå¯¹è±¡çš„å¼•ç”¨(<code>getClass</code>)</p><p><img alt="mark" data-src="http://static.imlgw.top///20190418/1OtoI6wkivdz.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ï¼Œä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯referenceä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œreferenceæœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚</p><p>ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼çš„æœ€å¤§å¥½å¤„å°±æ˜¯é€Ÿåº¦æ›´å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚HotSpotè™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯ç›´æ¥æŒ‡é’ˆè®¿é—®çš„æ–¹å¼ã€‚å¥æŸ„æ¥è®¿é—®çš„æƒ…å†µä¹Ÿååˆ†å¸¸è§ã€‚</p><h2 id="JVMç±»åŠ è½½å™¨"><a href="#JVMç±»åŠ è½½å™¨" class="headerlink" title="JVMç±»åŠ è½½å™¨"></a>JVMç±»åŠ è½½å™¨</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>è™šæ‹Ÿæœºè®¾è®¡å›¢é˜ŸæŠŠåŠ è½½é˜¶æ®µä¸­çš„ <code>â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€</code> è¿™ä¸ªåŠ¨ä½œè¢«æ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿äºè®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç æ¨¡å—ç§°ä¸º <code>â€œç±»åŠ è½½å™¨â€</code></p></blockquote><p> ç±»åŠ è½½å™¨å¹¶ä¸éœ€è¦ç­‰åˆ°æŸä¸ªç±»è¢« â€œé¦–æ¬¡ä½¿ç”¨â€ æ—¶æ‰åŠ è½½å®ƒï¼Œè¿™ä¸€ç‚¹ä»å‰é¢è®²è§£çš„ <a href="#è¢«åŠ¨ä½¿ç”¨">è¢«åŠ¨ä½¿ç”¨çš„ä¾‹å­</a> å“ªé‡Œå°±çœ‹å¾—å‡ºæ¥</p><p>JVMè§„èŒƒå…è®¸ç±»åŠ è½½å™¨åœ¨é¢„æ–™æŸä¸ªç±»å°†è¦è¢«ä½¿ç”¨çš„æ—¶å€™å°±é¢„å…ˆåŠ è½½å®ƒï¼Œå¦‚æœåœ¨é¢„å…ˆåŠ è½½çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†classæ–‡ä»¶ç¼ºå¤±æˆ–è€…å­˜åœ¨é”™è¯¯ï¼Œç±»åŠ è½½å™¨å¿…é¡»åœ¨ç¨‹åº<strong>é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨</strong>è¯¥ç±»æ—¶æ‰æŠ¥å‘Šé”™è¯¯ï¼ˆLinkageErroré”™è¯¯ï¼‰</p><p> å¦‚æœè¿™ä¸ªç±»ä¸€ç›´æ²¡æœ‰è¢«ç¨‹åºä¸»åŠ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆç±»åŠ è½½å™¨å°±ä¸ä¼šæŠ¥å‘Šé”™è¯¯</p><p><img alt="JVMç±»åŠ è½½å™¨" data-src="http://static.imlgw.top///20190419/pKeI6Bx6lbcX.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>æ ¹ï¼ˆBootstrapï¼‰ç±»åŠ è½½å™¨</strong></p><p>è¯¥åŠ è½½å™¨æ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½è™šæ‹Ÿæœºçš„æ ¸å¿ƒç±»åº“ï¼Œå¦‚java.lang.*ç­‰ã€‚æ ¹ç±»åŠ è½½å™¨ä»ç³»ç»Ÿå±æ€§sun.boot.class.pathæ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ã€‚æ ¹ç±»åŠ è½½å™¨çš„å®ç°ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿï¼Œå±äºè™šæ‹Ÿæœºçš„å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¹¶æ²¡æœ‰ç»§æ‰¿ java.lang.ClassLoaderç±»(c/c++å®ç°çš„)ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">System.out.println(System.getProperty(<span class="string">"sun.boot.class.path"</span>));</span><br><span class="line">D:\java\jre\lib\resources.jar;D:\java\jre\lib\rt.jar;D:\java\jre\lib\sunrsasign.jar;D:\java\jre\lib\jsse.jar;D:\java\jre\lib\jce.jar;D:\java\jre\lib\charsets.jar;D:\java\jre\lib\jfr.jar;D:\java\jre\classes</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ‰©å±•ï¼ˆExtensionï¼‰ç±»åŠ è½½å™¨</strong></p><p>å®ƒçš„çˆ¶åŠ è½½å™¨ä¸ºæ ¹ç±»åŠ è½½å™¨ã€‚å®ƒä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–è€…ä»JDKçš„å®‰è£…ç›®å½•çš„jre.lib.extå­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰ä¸‹åŠ è½½ç±»åº“ï¼Œå¦‚æœæŠŠç”¨æˆ·åˆ›å»ºçš„<strong>JAR</strong>æ–‡ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚æ‰©å±•ç±»åŠ è½½å™¨æ˜¯çº¯Javaç±»ï¼Œæ˜¯ java.lang.ClassLoaderç±»çš„å­ç±»ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">System.out.println(System.getProperty(<span class="string">"java.ext.dirs"</span>)); <span class="comment">//java.ext.dirså±æ€§</span></span><br><span class="line">D:\java\jre\lib\ext;C:\WINDOWS\Sun\Java\lib\ext</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç³»ç»Ÿï¼ˆSystemï¼‰ç±»åŠ è½½å™¨</strong></p><p>ä¹Ÿç§°ä¸ºåº”ç”¨ç±»åŠ è½½å™¨ï¼Œå®ƒçš„çˆ¶åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨ã€‚å®ƒä»ç¯å¢ƒå˜é‡classpathæˆ–è€…ç³»ç»Ÿå±æ€§java.class.pathæ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»ï¼Œå®ƒæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„<code>é»˜è®¤çˆ¶åŠ è½½å™¨</code>ã€‚ç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯çº¯Javaç±»ï¼Œæ˜¯java.lang.ClassLoaderç±»çš„å­ç±»ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">System.out.println(System.getProperty(<span class="string">"java.class.path"</span>));</span><br><span class="line">D:\java\jre\lib\charsets.jar;D:\java\jre\lib\deploy.jar;</span><br><span class="line">D:\java\jre\lib\ext\access-bridge-<span class="number">64</span>.jar;</span><br><span class="line">D:\java\jre\lib\ext\cldrdata.jar;</span><br><span class="line">D:\java\jre\lib\ext\dnsns.jar;</span><br><span class="line">D:\java\jre\lib\ext\jaccess.jar;</span><br><span class="line">D:\java\jre\lib\ext\jfxrt.jar;</span><br><span class="line">D:\java\jre\lib\ext\localedata.jar;</span><br><span class="line">D:\java\jre\lib\ext\nashorn.jar;</span><br><span class="line">D:\java\jre\lib\ext\sunec.jar;</span><br><span class="line">D:\java\jre\lib\ext\sunjce_provider.jar;</span><br><span class="line">D:\java\jre\lib\ext\sunmscapi.jar;</span><br><span class="line">D:\java\jre\lib\ext\sunpkcs11.jar;</span><br><span class="line">D:\java\jre\lib\ext\zipfs.jar;</span><br><span class="line">D:\java\jre\lib\javaws.jar;</span><br><span class="line">D:\java\jre\lib\jce.jar;</span><br><span class="line">D:\java\jre\lib\jfr.jar;</span><br><span class="line">D:\java\jre\lib\jfxswt.jar;</span><br><span class="line">D:\java\jre\lib\jsse.jar;</span><br><span class="line">D:\java\jre\lib\management-agent.jar;</span><br><span class="line">D:\java\jre\lib\plugin.jar;</span><br><span class="line">D:\java\jre\lib\resources.jar;</span><br><span class="line">D:\java\jre\lib\rt.jar;</span><br><span class="line">C:\WorkSpace\concurrent_package\out\production\concurrent_package;</span><br><span class="line">C:\JetBrains\IntelliJ IDEA <span class="number">2018.1</span><span class="number">.4</span>\lib\idea_rt.jar</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å…¶å®æ‰€è°“çš„çˆ¶å­åŠ è½½å™¨å¹¶ä¸æ˜¯ç»§æ‰¿çš„çˆ¶å­å…³ç³»ï¼Œè€Œæ˜¯åŒ…å«çš„å…³ç³»ï¼Œå­åŠ è½½å™¨ä¸­åŒ…å«ä¸€ä¸ªçˆ¶åŠ è½½å™¨çš„å¼•ç”¨</p></blockquote><h3 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h3><p><strong>å…ˆçœ‹ä¸‹JDKçš„ClassLoader(1.8)æºç </strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class<!--?--> loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line">       <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">   {</span><br><span class="line">       <span class="keyword">synchronized</span> (getClassLoadingLock(name)) {</span><br><span class="line">           <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">           Class<!--?--> c = findLoadedClass(name);</span><br><span class="line">           <span class="keyword">if</span> (c == <span class="keyword">null</span>) {</span><br><span class="line">               <span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line">               <span class="keyword">try</span> {</span><br><span class="line">                   <span class="keyword">if</span> (parent != <span class="keyword">null</span>) {</span><br><span class="line">                       c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line">                   } <span class="keyword">else</span> {</span><br><span class="line">                       <span class="comment">//æ²¡æœ‰çˆ¶åŠ è½½å™¨å°±äº¤ç»™æ ¹åŠ è½½å™¨</span></span><br><span class="line">                       c = findBootstrapClassOrNull(name);</span><br><span class="line">                   }</span><br><span class="line">               } <span class="keyword">catch</span> (ClassNotFoundException e) {</span><br><span class="line">                   <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                   <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">               }</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> (c == <span class="keyword">null</span>) {</span><br><span class="line">                   <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                   <span class="comment">// to find the class.</span></span><br><span class="line">                   <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">                   <span class="comment">//éœ€è¦å­ç±»å»å®ç°</span></span><br><span class="line">                   c = findClass(name);</span><br><span class="line"></span><br><span class="line">                   <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                   sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                   sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                   sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">               }</span><br><span class="line">           }</span><br><span class="line">           <span class="keyword">if</span> (resolve) {</span><br><span class="line">               resolveClass(c);</span><br><span class="line">           }</span><br><span class="line">           <span class="keyword">return</span> c;</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ˜¯ClassLoaderç±»åŠ è½½ç±»çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸€æ®µ </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(parent!=<span class="keyword">null</span>){  c = parent.loadClass(name, <span class="keyword">false</span>);}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™å°±æ˜¯<strong>åŒäº²å§”æ´¾æœºåˆ¶</strong>çš„å®ç°ï¼Œå§”æ‰˜çˆ¶ç±»ï¼Œè®©çˆ¶ç±»å»åŠ è½½ï¼Œçˆ¶ç±»(æ ¹åŠ è½½å™¨)æ²¡æœ‰å°±ä¼šå†å±‚å±‚ä¸‹é™å¦‚æœæœ‰ä¸€ä¸ªåŠ è½½æˆåŠŸå°±ä¼šæˆåŠŸè¿”å›ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜è°ƒç”¨äº†ä¸€ä¸ªæ²¡æœ‰å®ç°çš„<code>findClass</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class<!--?--> findClass(String name) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(name);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¹Ÿå°±æ˜¯è¯´æƒ³è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„è¯å°±å¾—é‡å†™<code>findClass</code>æ–¹æ³•ï¼Œå®é™…ä¸Šè¿™ä¸ª<code>findClass</code>æ‰æ˜¯ç±»åŠ è½½çš„æ ¸å¿ƒï¼ŒçœŸæ­£åŠ è½½Classæ–‡ä»¶è½¬æ¢ä¸ºCLasså®ä¾‹çš„å°±æ˜¯<code>findClass</code>æ–¹æ³•ï¼Œ <code>loadClass()</code>åªæ˜¯å®ç°åŠ è½½çš„é€»è¾‘ï¼Œæ¯”å¦‚<strong>åŒäº²å§”æ´¾æœºåˆ¶</strong></p><p><strong>å®ç°ä¸€ä¸ªç®€æ˜“çš„ClassLoader</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>{</span><br><span class="line">    <span class="comment">//å°†å­—èŠ‚ç æ”¾åˆ°è¿™ä¸ªè·¯å¾„ä¸‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DIR = <span class="string">"D:\\ClassLoaderTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String dir = DEFAULT_DIR;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String classLoaderName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">()</span> </span>{</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(ClassLoader parent, String classLoaderName)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(parent);</span><br><span class="line">        <span class="keyword">this</span>.classLoaderName = classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDir</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> dir;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDir</span><span class="params">(String dir)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.dir = dir;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getClassLoaderName</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> classLoaderName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * xx.xx.xx.xx.xx.AAA</span></span><br><span class="line"><span class="comment">     * xx/xx/xx/xx/xx/.AAA.class</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class<!--?--> findClass(String name) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">        String classPath = name.replace(<span class="string">"."</span>, <span class="string">"/"</span>);</span><br><span class="line">        File classFile = <span class="keyword">new</span> File(dir, classPath + <span class="string">".class"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!classFile.exists()) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"The class "</span> + name + <span class="string">" not found under "</span> + dir);</span><br><span class="line">        }</span><br><span class="line"><span class="comment">//å­—èŠ‚ç æ–‡ä»¶çš„å­—èŠ‚æµ</span></span><br><span class="line">        <span class="keyword">byte</span>[] classBytes = loadClassBytes(classFile);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == classBytes || classBytes.length == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"load the class "</span> + name + <span class="string">" failed"</span>);</span><br><span class="line"><span class="comment">//defineClassæ–¹æ³•å¯ä»¥æŠŠäºŒè¿›åˆ¶æµå­—èŠ‚ç»„æˆçš„æ–‡ä»¶è½¬æ¢ä¸ºä¸€ä¸ªjava.lang.Class</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.defineClass(name, classBytes, <span class="number">0</span>, classBytes.length);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æ–‡ä»¶æµè½¬æ¢ä¸ºå­—èŠ‚æµ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] loadClassBytes(File classFile) {</span><br><span class="line">        <span class="keyword">try</span> (ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">             FileInputStream fis = <span class="keyword">new</span> FileInputStream(classFile)) {</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(buffer)) != -<span class="number">1</span>) {</span><br><span class="line">                baos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            }</span><br><span class="line">            baos.flush();</span><br><span class="line">            <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>defineClassæ–¹æ³•å¯ä»¥æŠŠäºŒè¿›åˆ¶æµå­—èŠ‚ç»„æˆçš„æ–‡ä»¶è½¬æ¢ä¸ºä¸€ä¸ªjava.lang.Classï¼Œå‰ææ˜¯Classæ–‡ä»¶æ˜¯åˆæ³•çš„ã€‚</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰çš„éœ€è¦åŠ è½½çš„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        System.out.println(<span class="string">"MyObject static is init"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span></span>{</span><br><span class="line">        System.out.println(<span class="string">"Hello World"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•è‡ªå®šä¹‰çš„ClassLoader</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException </span>{</span><br><span class="line">        MyClassLoader loader=<span class="keyword">new</span> MyClassLoader(<span class="string">"Resolmi"</span>);</span><br><span class="line">        <span class="comment">//Class<!--?--> aClass = loader.loadClass("classloader_study.myClassLoader.MyObject");</span></span><br><span class="line">        Class<!--?--> aClass = Class.forName(<span class="string">"classloader_study.myClassLoader.MyObject"</span>, <span class="keyword">true</span>, loader);</span><br><span class="line">        System.out.println(aClass);</span><br><span class="line">        System.out.println(aClass.getClassLoader());</span><br><span class="line"></span><br><span class="line">        Object obj=aClass.newInstance();</span><br><span class="line">        Method hello = aClass.getMethod(<span class="string">"Hello"</span>, <span class="keyword">null</span>);</span><br><span class="line">        hello.invoke(obj, <span class="keyword">new</span> Object[]{});</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œç›´æ¥<code>loadClass</code>æˆ–è€…<code>Class.forName()</code>éƒ½å¯ä»¥ï¼Œé€šå¸¸æˆ‘ä»¬çš„forName()éƒ½æ˜¯é»˜è®¤ç”¨çš„<strong>AppClassLoader</strong>ä¹Ÿå°±æ˜¯ç³»ç»ŸåŠ è½½å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæˆ‘ä»¬çš„è‡ªå®šä¹‰åŠ è½½å™¨ä¼ é€’è¿›å»ã€‚</p><blockquote><p>tip: loadClass ä¸ä¼šåˆå§‹åŒ–ç±»ï¼Œä¸å±äºä¸Šé¢æåˆ°çš„6ç§ä¸»åŠ¨ä½¿ç”¨çš„æ–¹å¼ï¼Œå±äºè¢«åŠ¨ä½¿ç”¨ï¼ŒClass.forName ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æ§åˆ¶æ˜¯å¦åˆå§‹åŒ–</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">MyObject <span class="keyword">static</span> is init</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classloader_study</span>.<span class="title">myClassLoader</span>.<span class="title">MyObject</span></span></span><br><span class="line"><span class="class"><span class="title">classloader_study</span>.<span class="title">myClassLoader</span>.<span class="title">MyClassLoader</span>@74<span class="title">a14482</span></span></span><br><span class="line"><span class="class"><span class="title">Hello</span> <span class="title">World</span></span></span><br></pre></td></tr></tbody></table></figure></div><p>å¦‚æœä½¿ç”¨äº†<code>ide</code>çš„è¯ï¼Œè¿™é‡Œå¾ˆæœ‰å¯èƒ½ç¼–è¯‘å™¨å¸®ä½ è‡ªåŠ¨ç¼–è¯‘äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨ä½ çš„classpathé‡Œé¢å·²ç»æœ‰å­—èŠ‚ç æ–‡ä»¶äº†ï¼Œæ‰€ä»¥å°±ç›´äº¤ç»™AppClassLoaderåŠ è½½äº†ï¼Œæ‰€ä»¥éœ€è¦å°†classpathé‡Œé¢çš„åˆ æ‰ï¼Œå°†å­—èŠ‚ç æ‹·è´åˆ°ä½ è‡ªå®šä¹‰çš„classLoaderæŒ‡å®šçš„ç›®å½•é‡Œé¢ã€‚</p><h3 id="åŒäº²å§”æ´¾æ¨¡å¼"><a href="#åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å¼"></a>åŒäº²å§”æ´¾æ¨¡å¼</h3><p>å³åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­å½“å‰ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œå¦‚æœè¢«åŠ è½½ï¼Œå°±ä¼šç›´æ¥è¿”å›å¯ç”¨çš„ç±»ï¼Œå¦åˆ™å°±ä¼šå°è¯•åŠ è½½ï¼Œåœ¨å°è¯•åŠ è½½æ—¶ï¼Œä¼šå…ˆè¯·æ±‚åŒäº²å¤„ç†ï¼Œå¦‚æœåŒäº²è¯·æ±‚å¤±è´¥ï¼Œåˆ™ä¼šè‡ªå·±åŠ è½½</p><p>è¿™é‡Œå…‰çœ‹å‡ ä¸ªå†…ç½®çš„ClassLoaderå¯èƒ½è¿˜ä¸å¤ªæ¸…æ™°è¿™é‡Œç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„Loaderæ¥è¯•è¯•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoaderTest2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InstantiationException, ClassNotFoundException </span>{</span><br><span class="line">        <span class="comment">//loader1çš„åŠ è½½ç›®å½•æ˜¯D:\\ClassLoaderTestï¼ˆé»˜è®¤çš„ï¼‰</span></span><br><span class="line">        MyClassLoader loader1=<span class="keyword">new</span> MyClassLoader(<span class="string">"Resolmi-father"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®loader1ä¸ºloader2çš„çˆ¶åŠ è½½å™¨</span></span><br><span class="line">        MyClassLoader loader2=<span class="keyword">new</span> MyClassLoader(loader1,<span class="string">"Resolmi2-son"</span>);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªç±»å­˜æ”¾åœ¨ D:\\ClassLoaderTest\\classloader_study\\myClassLoader ä¸‹é¢</span></span><br><span class="line">        Class<!--?--> aClass = loader2.loadClass(<span class="string">"classloader_study.myClassLoader.MyObject"</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®Loader2çš„åŠ è½½ç›®å½•ï¼Œè¿™æ˜¯ä¸ªç©ºç›®å½•ï¼Œä¸‹é¢ä»€ä¹ˆéƒ½æ²¡æœ‰</span></span><br><span class="line">        loader2.setDir(<span class="string">"D:\\ClassLoaderTest2"</span>);</span><br><span class="line">        System.out.println(aClass);</span><br><span class="line">        System.out.println(aClass.getClassLoader());</span><br><span class="line">        System.out.println(((MyClassLoader)aClass.getClassLoader()).getClassLoaderName());</span><br><span class="line">     }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ§åˆ¶å°æ‰“å°å¦‚ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classloader_study</span>.<span class="title">myClassLoader</span>.<span class="title">MyObject</span></span></span><br><span class="line"><span class="class"><span class="title">classloader_study</span>.<span class="title">myClassLoader</span>.<span class="title">MyClassLoader</span>@74<span class="title">a14482</span></span></span><br><span class="line"><span class="class"><span class="title">Resolmi</span>-<span class="title">father</span></span></span><br></pre></td></tr></tbody></table></figure></div><p>æˆ‘ä»¬ç”¨<code>Loader2</code>å»åŠ è½½ç±»ï¼Œä½†æ˜¯è¿™ä¸ªç±»çš„åŠ è½½ç›®å½•æ˜¯ç©ºçš„ï¼Œç„¶åæˆ‘ä»¬æŒ‡å®š<code>Loader2</code> çš„çˆ¶åŠ è½½å™¨ä¸º<code>Loader1</code>è€Œ<code>loader1</code> å¾—åŠ è½½è·¯å¾„å°±æ˜¯è¦åŠ è½½å¾—ç±»çš„è·¯å¾„ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿™ä¸ªç±»æœ€ç»ˆè¿˜æ˜¯è¢«åŠ è½½å‡ºæ¥äº†ï¼Œè€Œä¸”æ˜¯è¢« <code>loader1</code>åŠ è½½å‡ºæ¥çš„ï¼Œä¹Ÿå°±æ˜¯<code>loader2</code>æŠŠåŠ è½½ä»»åŠ¡å§”æ‰˜ç»™äº†çˆ¶åŠ è½½å™¨<code>loader1</code>,ç„¶åå±‚å±‚å§”æ‰˜å†å›åˆ°<code>loader1</code>ï¼Œç”±å®ƒåŠ è½½ã€‚</p><p>åˆ°è¿™é‡Œå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨åŒäº²å§”æ´¾æ¨¡å¼ï¼Ÿè¿™æ ·èµ°ä¸€åœˆå¤šæ…¢å•Šï¼Œå…¶å®è¿™æ ·åšä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢çš„åŸå› </p><p>ğŸ’¡ æé«˜ç³»ç»Ÿå®‰å…¨æ€§ï¼Œä½¿å¾— Java ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·æœ‰ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œä»è€Œä½¿å¾—åŸºç¡€ç±»å¾—åˆ°ç»Ÿä¸€ã€‚å¯¹äºä¸€äº›ç³»ç»Ÿæ ¸å¿ƒç±»ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„ä¸èµ·ä½œç”¨äº†ï¼Œå› ä¸ºéƒ½ä¼šäº¤ç»™<code>BootStrapLoader</code>å»åŠ è½½ï¼Œæ¯”å¦‚è‡ªå®šä¹‰äº†ä¸€ä¸ªjava.lang.Stringçš„ç±»ï¼Œç„¶ååœ¨åŠ è½½çš„æ—¶å€™ç»è¿‡å±‚å±‚å§”æ´¾æœ€åä¼šäº¤ç»™ <code>BootStrapLoader</code>å»åŠ è½½ç„¶åè¿”å›ï¼Œæ‰€ä»¥ä½ è‡ªå®šä¹‰çš„Stringæ ¹æœ¬æ²¡æœ‰åŠ è½½çš„æœºä¼šï¼Œè¿™æ ·å°±é¿å…äº†ç”¨æˆ·ç¯¡æ”¹Javaæ ¸å¿ƒçš„ç±»</p><p>ğŸ’¡ é¿å…é‡å¤åŠ è½½ï¼Œçˆ¶Loaderå·²ç»åŠ è½½è¿‡çš„ç±»ï¼Œå­Loaderå°±ä¸ç”¨å†åŠ è½½äº†ï¼Œæ¯”å¦‚<code>Objectç±»</code>è¿™ä¸ªç±»åœ¨<code>rt.jar</code>ä¸‹ï¼Œæ‰€ä»¥æ— è®ºæ˜¯åœ¨å“ªç§ç¯å¢ƒä¸‹ï¼Œæœ€ç»ˆéƒ½ä¼šäº¤ç»™<code>BootStrapClassLoader</code>å»åŠ è½½è¿™ä¸ªç±»ï¼ŒåŠ è½½å¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ª<code>Objectç±»</code>ï¼Œå¦‚æœä¸é‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶ï¼Œè®©å„ä¸ªLoaderè‡ªå·±åŠ è½½é‚£ä¹ˆå¯èƒ½åŠ è½½å‡ºæ¥çš„å°±ä¼šæœ‰å¾ˆå¤šä¸ªObjectç±»ï¼ˆä¸æ˜¯åŒä¸€ä¸ªObjectç±»ï¼Œä¸‹é¢ä¼šè¯´åˆ°ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.SecurityException: Prohibited <span class="keyword">package</span> name: java.lang</span><br></pre></td></tr></tbody></table></figure></div><h3 id="åŠ å¯†è§£å¯†ç±»åŠ è½½å™¨"><a href="#åŠ å¯†è§£å¯†ç±»åŠ è½½å™¨" class="headerlink" title="åŠ å¯†è§£å¯†ç±»åŠ è½½å™¨"></a>åŠ å¯†è§£å¯†ç±»åŠ è½½å™¨</h3><p>æœ¬è´¨ä¸Šå’Œä¸Šé¢çš„æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±æ˜¯å¤šäº†è§£å¯†çš„åŠŸèƒ½ï¼Œè¿™é‡Œé¦–å…ˆç”¨åŠ å¯†å·¥å…·ç±»åŠ å¯†class</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">EncryptUtil</span> </span>{</span><br><span class="line"><span class="comment">//ç›¸å½“äºå¯†é’¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span> ENCRYPT_FACTOR = (<span class="keyword">byte</span>) <span class="number">0xff</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EncryptUtil</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(String source, String target)</span> <span class="keyword">throws</span> FileNotFoundException </span>{</span><br><span class="line">        <span class="keyword">try</span> (FileInputStream in= <span class="keyword">new</span> FileInputStream(source); FileOutputStream out = <span class="keyword">new</span> FileOutputStream(target)) {</span><br><span class="line">            <span class="keyword">int</span> data;</span><br><span class="line">            <span class="keyword">while</span> ((data=in.read())!=-<span class="number">1</span>){</span><br><span class="line">                out.write(data^ENCRYPT_FACTOR);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException </span>{</span><br><span class="line">        encrypt(<span class="string">"D:\\ClassLoaderTest\\classloader_study\\myClassLoader\\MyObject.class"</span>,<span class="string">"D:\\ClassLoaderTest\\classloader_study\\myClassLoader\\MyObject2.class"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç„¶åç”¨åŠ å¯†è§£å¯†ç±»åŠ è½½å™¨åŠ è½½è¿™ä¸ªç±»</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecryptClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String DEFAULT_DIR = <span class="string">"D:\\ClassLoaderTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String dir = DEFAULT_DIR;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DecryptClassLoader</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DecryptClassLoader</span><span class="params">(ClassLoader parent)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(parent);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class<!--?--> findClass(String name) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">        String classPath = name.replace(<span class="string">"."</span>, <span class="string">"/"</span>);</span><br><span class="line">        File classFile = <span class="keyword">new</span> File(dir, classPath + <span class="string">".class"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!classFile.exists()) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"æ²¡æ‰¾åˆ°å¯¹åº”çš„ç±»æ–‡ä»¶ ï¼š"</span> + dir);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">byte</span>[] classBytes = loadClassByte(classFile);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == classBytes || classBytes.length == <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"åŠ è½½å¤±è´¥"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.defineClass(name, classBytes, <span class="number">0</span>, classBytes.length);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] loadClassByte(File classFile) {</span><br><span class="line">        <span class="keyword">try</span> (FileInputStream in = <span class="keyword">new</span> FileInputStream(classFile); ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream()) {</span><br><span class="line">            <span class="keyword">int</span> data;</span><br><span class="line">            <span class="keyword">while</span> ((data=in.read())!=-<span class="number">1</span>){</span><br><span class="line">                <span class="comment">//ä¸»è¦å°±æ˜¯è¿™é‡Œå‘ç”Ÿäº†å˜åŒ–ï¼Œå¼‚æˆ–äº†0xff</span></span><br><span class="line">                baos.write(data^<span class="number">0xff</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDir</span><span class="params">(String dir)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.dir = dir;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å½“ç„¶ç»“æœæ˜¯åŠ è½½æˆåŠŸå•¦ğŸ˜‹ï¼Œè¿™é‡Œå¦‚æœç”¨å…¶ä»–çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œæˆ–è€…æŠŠ0xffé‚£é‡Œå»æ‰ï¼Œå°±ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.ClassFormatError: Incompatible magic value <span class="number">889275713</span> in <span class="class"><span class="keyword">class</span> <span class="title">file</span> <span class="title">classloader_study</span>/<span class="title">myClassLoader</span>/<span class="title">MyObject</span></span></span><br><span class="line"><span class="class"><span class="title">at</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">ClassLoader</span>.<span class="title">defineClass1</span>(<span class="title">Native</span> <span class="title">Method</span>)</span></span><br><span class="line">at java.lang.ClassLoader.defineClass(ClassLoader.java:763)</span><br><span class="line">at java.lang.ClassLoader.defineClass(ClassLoader.java:<span class="number">642</span>)</span><br><span class="line">at classloader_study.myClassLoader.MyClassLoader.findClass(MyClassLoader.java:<span class="number">64</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">424</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">357</span>)</span><br><span class="line">at classloader_study.encryption_study.ClassLoaderTest.main(ClassLoaderTest.java:<span class="number">15</span>)</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªå¼‚å¸¸æ˜¯é“¾æ¥é˜¶æ®µéªŒè¯çš„é”™è¯¯ï¼Œæ˜¯ä¸Šé¢æåˆ°çš„<code>defineClass()</code>æŠ›å‡ºæ¥çš„ï¼Œå› ä¸ºä½ åŠ äº†å¯†ï¼ŒJVMåœ¨åŠ è½½è¿™ä¸ªäºŒè¿›åˆ¶æµçš„æ—¶å€™å°±æ— æ³•è¯†åˆ«äº†è‡ªç„¶å°±æ— æ³•åŠ è½½ã€‚</p><h3 id="æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"><a href="#æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"></a>æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶</h3><p><strong>è¦†ç›–loadClass()</strong></p><p>è¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ä¸»è¦å°±æ˜¯è¦è¦†ç›–<code>loadClass()</code>æ–¹æ³•ï¼Œè‡ªå·±å®šä¹‰åŠ è½½ç±»çš„æ–¹å¼ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class<!--?--> loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">    Class<!--?--> clazz = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®©çˆ¶åŠ è½½å™¨åŠ è½½javaæ ¸å¿ƒçš„åŒ…ï¼Œå› ä¸ºæœ‰äº›ç±»æ˜¯ç»§æ‰¿çš„Javaå†…éƒ¨çš„æ ¸å¿ƒç±»æ¯”å¦‚Objectç±»</span></span><br><span class="line">    <span class="keyword">if</span> (name.startsWith(<span class="string">"java."</span>)) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            ClassLoader system = ClassLoader.getSystemClassLoader();</span><br><span class="line">            <span class="comment">//è¿™é‡Œä»ç„¶æ˜¯å§”æ‰˜ä¸Šçº§</span></span><br><span class="line">            clazz = system.loadClass(name);</span><br><span class="line">            <span class="keyword">if</span> (clazz != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">if</span> (resolve)</span><br><span class="line">                    resolveClass(clazz);</span><br><span class="line">                <span class="keyword">return</span> clazz;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//è‡ªå·±å…ˆæ‰¾</span></span><br><span class="line">        clazz = findClass(name);</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//æ‰¾ä¸åˆ°å°±äº¤ç»™çˆ¶åŠ è½½å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (clazz == <span class="keyword">null</span> && getParent() != <span class="keyword">null</span>) {</span><br><span class="line">        getParent().loadClass(name);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®å°±æ˜¯è‡ªå·±å…ˆæ‰¾ï¼Œæ‰¾ä¸åˆ°æ‰ä¼šäº¤ç»™çˆ¶åŠ è½½å™¨ï¼Œç„¶åä¸€ä¸ªéœ€è¦æ³¨æ„çš„å°±æ˜¯ä½ æƒ³åŠ è½½çš„è¿™ä¸ªç±»å¯èƒ½ç»§æ‰¿äº†Javaå†…éƒ¨æ ¸å¿ƒçš„ç±»åƒ<code>Object</code>ç±»ï¼Œç„¶åè¦åŠ è½½å­ç±»å°±è¦å…ˆåŠ è½½å®ƒçš„çˆ¶ç±»ï¼Œè€Œä½ çš„è¿™ä¸ªåŒ…é‡Œé¢è‚¯å®šæ˜¯åŠ è½½ä¸åˆ°è¿™äº›Javaå†…éƒ¨çš„æ ¸å¿ƒç±»çš„ï¼Œæ‰€ä»¥è¿™äº›è¿˜æ˜¯å¾—äº¤ç»™ä¸Šå±‚çš„åŠ è½½å™¨å»åŠ è½½ã€‚</p><p><strong>æµ‹è¯•æ•ˆæœ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleClassLoaderTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, IllegalAccessException, InstantiationException </span>{</span><br><span class="line">        SimpleClassLoader simpleClassLoader = <span class="keyword">new</span> SimpleClassLoader();</span><br><span class="line">        Class<!--?--> aClass = simpleClassLoader.loadClass(<span class="string">"classloader_study.break_parent.SimpleObject"</span>);</span><br><span class="line">        System.out.println(aClass.getClassLoader());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ³¨æ„è¿™é‡Œåœ¨<code>classpath</code>é‡Œé¢æ˜¯æœ‰è¿™ä¸ªç±»çš„å­—èŠ‚ç æ–‡ä»¶çš„ï¼ŒæŒ‰ç…§åŒäº²å§”æ‰˜æœºåˆ¶åº”è¯¥ç”±AppClassLoaderå»åŠ è½½</p><p><img alt="mark" data-src="http://static.imlgw.top///20190420/5Nc0S6OoIa2D.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä½†æ˜¯ä»ç„¶æ˜¯ç”±æˆ‘ä»¬çš„SimpleClassLoaderåŠ è½½çš„ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸäº†æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼ˆè²Œä¼¼Tomcatä¹Ÿæ˜¯è¿™ç§åŠ è½½æœºåˆ¶ï¼Œæœ‰æ—¶é—´çœ‹çœ‹Tomcatçš„ç±»åŠ è½½å™¨ï¼‰</p><p><strong>é¢è¯•é¢˜</strong></p><p>â“ <strong>èƒ½ä¸èƒ½è‡ªå·±å†™ä¸ªç±»æ¯”å¦‚<code>java.lang.String</code>å»è¦†ç›–Javaçš„<code>String</code>ï¼Ÿå¦‚æœä¸è¦†ç›–<code>loadClass()</code>æ–¹æ³•ä½¿ç”¨åŒäº²å§”æ‰˜è‚¯å®šæ˜¯ä¸è¡Œï¼Œä½†æ˜¯æ—¢ç„¶ä¸Šé¢å·²ç»æ‰“ç ´äº†åŒäº²å§”æ‰˜é‚£æ˜¯ä¸æ˜¯å°±å¯ä»¥äº†å‘¢ï¼Ÿ</strong></p><p><code>Talk is cheapï¼Œshow me the code</code> è¯•è¯•å°±çŸ¥é“äº†</p><p>å…ˆå‡†å¤‡ä¸€ä¸ªStringç±»</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/4/18 12:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        System.out.println(<span class="string">"i am init"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVal</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span>  <span class="number">250</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç¼–è¯‘å¥½ä¹‹åæ”¾åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>ClassLoader</code>çš„ç›®å½•ä¸‹ï¼Œç„¶åå°†æˆ‘ä»¬<code>loadClass()</code>æ–¹æ³•åŠ è½½æ ¸å¿ƒåŒ…çš„åœ°æ–¹æ³¨é‡Šæ‰ï¼ˆä¸ç„¶è¿˜æ˜¯ä¼šäº¤ç»™çˆ¶åŠ è½½å™¨å»åŠ è½½ï¼‰ç„¶åä¸ºäº†è¡¨ç¤ºæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>ClassLoader</code>åŠ è½½çš„æˆ‘ä»¬æŠŠclasspathé‡Œé¢çš„å­—èŠ‚ç æ–‡ä»¶ä¹Ÿåˆ æ‰ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, IllegalAccessException, InstantiationException </span>{</span><br><span class="line">       SimpleClassLoader simpleClassLoader = <span class="keyword">new</span> SimpleClassLoader();</span><br><span class="line">       Class<!--?--> aClass = simpleClassLoader.loadClass(<span class="string">"java.lang.String"</span>);</span><br><span class="line">       System.out.println(aClass.getClassLoader());</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div><p>ç„¶åå°±ä¼šçœ‹åˆ°å¦‚ä¸‹çš„<code>SecurityException</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">java.lang.SecurityException: Prohibited <span class="keyword">package</span> name: java.lang</span><br><span class="line">at java.lang.ClassLoader.preDefineClass(ClassLoader.java:<span class="number">662</span>)</span><br><span class="line">at java.lang.ClassLoader.defineClass(ClassLoader.java:<span class="number">761</span>)</span><br><span class="line">at java.lang.ClassLoader.defineClass(ClassLoader.java:<span class="number">642</span>)</span><br><span class="line">at classloader_study.break_parent.SimpleClassLoader.findClass(SimpleClassLoader.java:<span class="number">52</span>)</span><br><span class="line">at classloader_study.break_parent.SimpleClassLoader.loadClass(SimpleClassLoader.java:<span class="number">77</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">357</span>)</span><br><span class="line">at classloader_study.break_parent.SimpleClassLoaderTest.main(SimpleClassLoaderTest.java:<span class="number">7</span>)</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®Javaä¸ºäº†å®‰å…¨ï¼Œè‡ªå®šä¹‰ç±»å–åä¸èƒ½å–<code>java.*</code>ç­‰æ ¸å¿ƒåŒ…åå¼€å¤´ï¼Œåœ¨<code>preDefineClass</code>é‡Œé¢åšäº†æ£€æŸ¥ï¼Œæ‰€ä»¥å³ä½¿ä½ æ‰“ç ´äº†åŒäº²å§”æ‰˜æœºåˆ¶ä½ ä¾ç„¶ä¸èƒ½å»è¦†ç›–Javaçš„æ ¸å¿ƒç±»ï¼ˆè‚¯å®šä¸è¡Œå•ŠğŸ˜„ï¼‰ã€‚</p><p>å…¶å®è¿™é‡Œåæ¥äº†è§£äº†<code>Unsafe</code>åä¹Ÿå°è¯•ç”¨<code>Unsafe</code> å»åŠ è½½è¿™ä¸ªç±»</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class<!--?--> findClass(String name) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">        Unsafe unsafe=UnsafeTest.getUnsafe();</span><br><span class="line">        String classPath = name.replace(<span class="string">"."</span>, <span class="string">"/"</span>);</span><br><span class="line">        File classFile = <span class="keyword">new</span> File(dir, classPath + <span class="string">".class"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!classFile.exists()) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"The class "</span> + name + <span class="string">" found under "</span> + dir);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] classBytes = loadClassBytes(classFile);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == classBytes || classBytes.length == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(<span class="string">"load the class "</span> + name + <span class="string">" failed"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> unsafe.defineClass(<span class="keyword">null</span>,classBytes,<span class="number">0</span>,classBytes.length,SimpleClassLoader.<span class="keyword">this</span>,<span class="keyword">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><code>loadClass</code> åŒä¸Šï¼Œå°è¯•åŠ è½½ä½ ä¼šå‘ç° ä¼šæç¤ºæ‰¾ä¸åˆ°<code>Object</code> ç±»ï¼Œå—¯ï¼Ÿå·²ç»åœ¨åŠ è½½çˆ¶ç±»äº†ï¼Œéš¾ä¸æˆè¿˜çœŸå¯ä»¥ï¼Ÿè¿™é‡Œå…¶å®å·²ç»å’Œä¸Šé¢çš„æ–¹æ³•ä¸åŒäº†ï¼Œä¸Šé¢çš„æ–¹æ³•æ˜¯ä¸ä¼šè¿›å…¥åˆ°åŠ è½½çˆ¶ç±»çš„ç¯èŠ‚çš„ï¼Œç›´æ¥åœ¨åŠ è½½å‰å°±è¢«æ£€æµ‹äº†åŒ…åç„¶åGGäº†ï¼Œéšåæˆ‘åœ¨<code>loadClass</code> ä¸­è®©ç³»ç»ŸåŠ è½½å™¨å»åŠ è½½Objectç±»ï¼Œå†æ¬¡å°è¯•åŠ è½½</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">java.lang.SecurityException: Prohibited <span class="keyword">package</span> name: java.lang</span><br><span class="line">at sun.misc.Unsafe.defineClass(Native Method)</span><br><span class="line">at classloader_study.break_parent.SimpleClassLoader.findClass(SimpleClassLoader.java:<span class="number">57</span>)</span><br><span class="line">at classloader_study.break_parent.SimpleClassLoader.loadClass(SimpleClassLoader.java:<span class="number">83</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">357</span>)</span><br><span class="line">at classloader_study.break_parent.SimpleClassLoaderTest.main(SimpleClassLoaderTest.java:<span class="number">7</span>)</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.NullPointerException</span><br><span class="line">at classloader_study.break_parent.SimpleClassLoaderTest.main(SimpleClassLoaderTest.java:<span class="number">8</span>)</span><br></pre></td></tr></tbody></table></figure></div><p>è¿˜æ˜¯ç†Ÿæ‚‰çš„å‘³é“ğŸ˜‚ <code>defineClass</code>è™šæ‹Ÿæœºæœ¬åœ°æ–¹æ³•æŠ›äº†å¼‚å¸¸</p><h3 id="ç±»åŠ è½½å™¨ç»†èŠ‚æ·±å…¥"><a href="#ç±»åŠ è½½å™¨ç»†èŠ‚æ·±å…¥" class="headerlink" title="ç±»åŠ è½½å™¨ç»†èŠ‚æ·±å…¥"></a>ç±»åŠ è½½å™¨ç»†èŠ‚æ·±å…¥</h3><p><strong>å®šä¹‰åŠ è½½å™¨&åˆå§‹åŠ è½½å™¨</strong></p><p>âš¡çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œçš„ç±»åŠ è½½å™¨å’Œå¯åŠ¨è¿™ä¸ªåŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨ï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚çœŸæ­£<code>å®Œæˆç±»çš„åŠ è½½</code>å·¥ä½œæ˜¯é€šè¿‡è°ƒç”¨ <code>defineClass(findClass)</code>æ¥å®ç°çš„ï¼›è€Œ<code>å¯åŠ¨</code>ç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨ <code>loadClass</code>æ¥å®ç°çš„ã€‚å‰è€…ç§°ä¸ºä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨ï¼ˆdefining loaderï¼‰ï¼Œåè€…ç§°ä¸ºåˆå§‹åŠ è½½å™¨ï¼ˆinitiating loaderï¼‰ã€‚åœ¨ Java è™šæ‹Ÿæœºåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„å®šä¹‰åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªç±»åŠ è½½å™¨å¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„åŠ è½½å™¨ã€‚ä¸¤ç§ç±»åŠ è½½å™¨çš„å…³è”ä¹‹å¤„åœ¨äºï¼š<strong>ä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨æ˜¯å®ƒå¼•ç”¨çš„å…¶å®ƒç±»çš„åˆå§‹åŠ è½½å™¨</strong>ã€‚å¦‚ç±» <code>com.example.Outer</code>å¼•ç”¨äº†ç±» <code>com.example.Inner</code>ï¼Œåˆ™ç”±ç±» <code>com.example.Outer</code>çš„<strong>å®šä¹‰åŠ è½½å™¨</strong>è´Ÿè´£å¯åŠ¨ç±» <code>com.example.Inner</code>çš„åŠ è½½è¿‡ç¨‹ã€‚</p><p><strong>å‘½åç©ºé—´&è¿è¡Œæ—¶åŒ…</strong></p><blockquote><p>æ¯ä¸ªç±»éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ç”±<code>è¯¥åŠ è½½å™¨åŠæ‰€æœ‰çˆ¶åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»</code>ç»„æˆï¼Œ<code>å­åŠ è½½å™¨çš„å‘½åç©ºé—´åŒ…å«æ‰€æœ‰çˆ¶åŠ è½½å™¨çš„å‘½åç©ºé—´</code>ï¼Œå› æ­¤å­åŠ è½½å™¨å¯ä»¥åŠ è½½çš„ç±»å¯ä»¥çœ‹å°±æŒ‰çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œä¾‹å¦‚ç³»ç»Ÿç±»åŠ è½½å™¨å¯ä»¥çœ‹è§æ ¹åŠ è½½å™¨åŠ è½½çš„ç±»ã€‚ç”±çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»çœ‹ä¸è§å­åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œå¦‚æœä¸¤ä¸ªç±»ä¹‹é—´æ²¡æœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„çˆ¶å­å…³ç³»ï¼Œé‚£ä¹ˆä»–ä»¬å„è‡ªåŠ è½½çš„ç±»ç›¸äº’ä¸å¯è§</p></blockquote><p>âš¡æ•°ç»„ç±»çš„Classä¸æ˜¯ç”±ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œæ˜¯ç”±JVMåœ¨è¿è¡ŒæœŸé—´åŠ¨æ€ç”Ÿæˆçš„ï¼Œä½†æ˜¯é€šè¿‡<code>getClassLoader</code>è¿”å›çš„ç±»åŠ è½½å™¨å’Œæ•°ç»„çš„å…ƒç´ çš„ç±»åŠ è½½å™¨æ˜¯ä¸€æ ·çš„ï¼ŒåŸç”Ÿçš„ç±»å‹æ¯”å¦‚<code>int</code> ä¹‹ç±»çš„æ²¡æœ‰ç±»åŠ è½½å™¨è¿”å›çš„æ˜¯null</p><p>âš¡æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰å…¶è‡ªå·±çš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ç”±è¯¥åŠ è½½å™¨å’Œå…¶æ‰€æœ‰çˆ¶ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ç»„æˆï¼ŒåŒä¸€ä»½å­—èŠ‚ç ä¸¤ä¸ªä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½å‡ºæ¥çš„ä¸æ˜¯åŒä¸€ä¸ªç±»ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoaderTest2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InstantiationException, ClassNotFoundException </span>{</span><br><span class="line">        <span class="comment">//æ³¨æ„è¿™é‡Œçš„ClassLoaderè¦ä¹ˆåˆ©ç”¨å‰é¢çš„æ‰“ç ´äº†åŒäº²å§”æ‰˜æœºåˆ¶çš„ï¼Œè¦ä¹ˆæŠŠclasspathé‡Œé¢å­—èŠ‚ç çš„åˆ æ‰ã€‚</span></span><br><span class="line">        MyClassLoader loader1=<span class="keyword">new</span> MyClassLoader(<span class="string">"Resolmi1"</span>);</span><br><span class="line">        MyClassLoader loader2=<span class="keyword">new</span> MyClassLoader(<span class="string">"Resolmi2"</span>);</span><br><span class="line">        Class<!--?--> aClass2 = loader2.loadClass(<span class="string">"classloader_study.myClassLoader.MyObject"</span>);</span><br><span class="line">        Class<!--?--> aClass1 = loader1.loadClass(<span class="string">"classloader_study.myClassLoader.MyObject"</span>);</span><br><span class="line">        <span class="comment">//ä¸¤ä¸ªä¸åŒçš„åŠ è½½å™¨ï¼ˆæ²¡æœ‰çˆ¶å­å…³ç³»ï¼‰åŠ è½½åŒä¸€ä¸ªç±»åŠ è½½å‡ºæ¥çš„ä¸æ˜¯åŒä¸€ä¸ª</span></span><br><span class="line">        System.out.println(aClass1.hashCode()); <span class="comment">//2133927002</span></span><br><span class="line">        System.out.println(aClass2.hashCode()); <span class="comment">//1836019240</span></span><br><span class="line">     }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>âš¡<strong>çˆ¶ç±»åŠ è½½å™¨</strong>æ— æ³•è®¿é—®<strong>å­ç±»åŠ è½½å™¨</strong>åŠ è½½çš„ç±»ï¼Œè€Œ<strong>å­åŠ è½½å™¨</strong>å¯ä»¥è®¿é—®åˆ°<strong>çˆ¶åŠ è½½å™¨</strong>æ‰€åŠ è½½çš„ç±»</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException </span>{</span><br><span class="line">        <span class="comment">//ä½¿ç”¨ä¸Šé¢è‡ªå®šä¹‰çš„ClassLoader</span></span><br><span class="line">        MyClassLoader loader=<span class="keyword">new</span> MyClassLoader(<span class="string">"Resolmi"</span>);</span><br><span class="line">        Class<!--?--> aClass = loader.loadClass(<span class="string">"classloader_study.myClassLoader.Parent"</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®ä¾‹</span></span><br><span class="line">        aClass.newInstance();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Parentç±»</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Parent</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"Parent is load by"</span> + <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">        Hello();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//çˆ¶åŠ è½½å™¨è®¿é—®å­åŠ è½½å™¨åŠ è½½çš„ç±»</span></span><br><span class="line">        System.out.println(<span class="string">"Parent can see the "</span> + Sub<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Subç±»</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sub</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sub</span><span class="params">()</span></span>{</span><br><span class="line">        System.out.println(<span class="string">"Sub is load by"</span>+<span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">        <span class="keyword">new</span> Parent(); <span class="comment">//æ„é€ Parentç±»</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åšå®Œäº†è¿™äº›å·¥ä½œä¹‹åï¼Œç¼–è¯‘ä»£ç ï¼Œç„¶åå°†classpathä¸­çš„<code>Parent.class</code>æ‹·è´åˆ°è‡ªå®šä¹‰çš„ClassLoaderè·¯å¾„ä¸‹é¢ï¼Œç„¶ååˆ æ‰classpathä¸­çš„<code>Parent.class</code> ï¼Œç„¶åè¿è¡Œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Sub is load byclassloader_study.myClassLoader.MyClassLoader@<span class="number">74</span>a14482</span><br><span class="line">Parent is load bysun.misc.Launcher$AppClassLoader@<span class="number">18</span>b4aac2</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.NoClassDefFoundError: classloader_study/myClassLoader/Sub</span><br><span class="line">at classloader_study.myClassLoader.Parent.Hello(Parent.java:<span class="number">15</span>)</span><br><span class="line">at classloader_study.myClassLoader.Parent.<init>(Parent.java:<span class="number">10</span>)</init></span><br><span class="line">at classloader_study.myClassLoader.Sub.<init>(Sub.java:<span class="number">10</span>)</init></span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">423</span>)</span><br><span class="line">at java.lang.Class.newInstance(Class.java:<span class="number">442</span>)</span><br><span class="line">at classloader_study.myClassLoader.ClassLoaderTest.main(ClassLoaderTest.java:<span class="number">14</span>)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: classloader_study.myClassLoader.Sub</span><br><span class="line">at java.net.URLClassLoader.findClass(URLClassLoader.java:<span class="number">381</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">424</span>)</span><br><span class="line">at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:<span class="number">349</span>)</span><br><span class="line">at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">357</span>)</span><br><span class="line">... <span class="number">9</span> more</span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„<code>Sub</code> æ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>MyClassLoader</code> åŠ è½½çš„ï¼Œå› ä¸ºæˆ‘ä»¬åˆ æ‰äº†Classpathä¸­çš„å­—èŠ‚ç ï¼Œè€Œåœ¨è‡ªå®šä¹‰çš„è·¯å¾„ä¸­æœ‰æ‰€ä»¥æœ€åè¿˜æ˜¯ç”±æˆ‘ä»¬çš„ <code>MyClassLoader</code> åŠ è½½äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<code>Parent</code>ç±»é¦–å…ˆä¹Ÿä¼šç”±æˆ‘ä»¬çš„<code>è‡ªå®šä¹‰ç±»åŠ è½½å™¨MyClassLoader</code>å»ä½œä¸º<strong>åˆå§‹åŠ è½½å™¨</strong>åŠ è½½ï¼Œç”±äºæˆ‘ä»¬çš„Classpathä¸­è¿˜æœ‰å­—èŠ‚ç æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨åŒäº²å§”æ´¾æœºåˆ¶ä¸‹<code>Subç±»</code> æœ€ç»ˆç”±<code>AppClassLoader</code>åŠ è½½ ï¼Œä¸¤ä¸ªç±»ç”±ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œç„¶åæˆ‘ä»¬åœ¨<code>Parent</code> ç±»ä¸­è¯•å›¾è®¿é—®<code>Sub</code> ç±»ï¼Œç»“æœæŠ›å‡ºäº†<code>ClassNotFoundException</code>  å’Œ<code>NoClassDefFoundError</code> å¼‚å¸¸</p><p>â“ <strong>é‚£æˆ‘ä»¬åè¿‡æ¥åœ¨<code>Sub</code>ç±»ä¸­è®¿é—® <code>Parent</code> ç±»ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæ”¹é€ ä¸€ä¸‹Parentå’ŒSub</strong></p><p><strong>Parentç±»</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Parent</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"Parent is load by"</span> + <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">        <span class="comment">//Hello();</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//çˆ¶åŠ è½½å™¨è®¿é—®å­åŠ è½½å™¨åŠ è½½çš„ç±»</span></span><br><span class="line">        System.out.println(<span class="string">"Parent can see the "</span> + Sub<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Subç±»</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sub</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sub</span><span class="params">()</span></span>{</span><br><span class="line">        System.out.println(<span class="string">"Sub is load by"</span>+<span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">        <span class="keyword">new</span> Parent(); <span class="comment">//æ„é€ Subç±»</span></span><br><span class="line">        <span class="comment">//è®¿é—®çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»</span></span><br><span class="line">        System.out.println(<span class="string">"Sub can see "</span>+Parent<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å’Œä¸Šé¢ä¸€æ ·åˆ æ‰Classpathä¸­Subç±»çš„classæ–‡ä»¶æ²¡ç„¶åè¿è¡Œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">findclass is invoke MyClassLoader is loadclassloader_study.myClassLoader.Sub</span><br><span class="line">Sub is load byclassloader_study.myClassLoader.MyClassLoader@<span class="number">74</span>a14482</span><br><span class="line">Parent is load bysun.misc.Launcher$AppClassLoader@<span class="number">18</span>b4aac2</span><br><span class="line">Sub can see <span class="class"><span class="keyword">class</span> <span class="title">classloader_study</span>.<span class="title">myClassLoader</span>.<span class="title">Parent</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Process</span> <span class="title">finished</span> <span class="title">with</span> <span class="title">exit</span> <span class="title">code</span> 0</span></span><br></pre></td></tr></tbody></table></figure></div><p>æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œç”±æ­¤å°±å¯ä»¥è¯æ˜æˆ‘ä»¬ä¸Šé¢çš„ç»“è®ºæ˜¯æ­£ç¡®çš„ã€‚</p><p>â“ <strong>é¢è¯•é¢˜ï¼šå¦‚ä½•è®©ä¸€ä¸ªç±»çš„staticä»£ç å—æ‰§è¡Œä¸¤æ¬¡</strong></p><p>ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨å»åŠ è½½è¿™ä¸ªç±»ï¼Œè‡³äºä¸ºä»€ä¹ˆåº”è¯¥ä¸ç”¨æˆ‘å¤šè¯´äº†å§ã€‚</p><p><strong>ç±»çš„å¸è½½å’ŒClassLoaderçš„å¸è½½</strong></p><blockquote><p> ç”±Javaè™šæ‹Ÿæœºè‡ªå¸¦çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ï¼Œåœ¨è™šæ‹Ÿæœºçš„ç”Ÿå‘½å‘¨æœŸä¸­<strong>å§‹ç»ˆä¸ä¼šè¢«å¸è½½</strong>ï¼ŒJavaè™šæ‹Ÿæœºæœ¬èº«ä¼šå¼•ç”¨è¿™äº›ç±»åŠ è½½å™¨ï¼Œè€Œè¿™äº›ç±»åŠ è½½å™¨åˆ™ä¼šå§‹ç»ˆå¼•ç”¨ä»–ä»¬æ‰€åŠ è½½çš„ç±»çš„Classå¯¹è±¡ï¼Œå› æ­¤è¿™äº›Classå¯¹è±¡å§‹ç»ˆæ˜¯å¯è¾¾çš„ã€‚</p></blockquote><p>âš¡JVMä¸­çš„Classåªæœ‰æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰èƒ½è¢«GCå›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯¥Classè¢«å¸è½½ï¼ˆunloadï¼‰</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«GCã€‚</li><li>åŠ è½½è¯¥ç±»çš„ClassLoaderå®ä¾‹å·²ç»è¢«GCã€‚(Classå¯¹è±¡é‡Œé¢æœ‰å¯¹ClassLoaderçš„å¼•ç”¨)</li><li>è¯¥ç±»çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚</li></ul><p>GCçš„æ—¶æœºæˆ‘ä»¬æ˜¯ä¸å¯æ§çš„ï¼Œé‚£ä¹ˆåŒæ ·çš„æˆ‘ä»¬å¯¹äºClassçš„å¸è½½ä¹Ÿæ˜¯ä¸å¯æ§çš„ï¼Œä½¿ç”¨<code>-XX:+TraceClassUnloading</code> æˆ–è€…jvisualvmå¯ä»¥çœ‹åˆ°ç±»çš„å¸è½½</p><h2 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨-TCCL"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨-TCCL" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨(TCCL)"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨(<strong>TCCL</strong>)</h2><p>â€‹    åœ¨è¯´TCCLä¹‹å‰ä¸å¾—ä¸è¯´ä¸€ä¸‹å¦ä¸€ä¸ªè¯é¢˜ï¼ŒSPIï¼ˆService Provider Interfaceï¼ŒSPIï¼‰æœåŠ¡æä¾›æ¥å£ï¼Œç”±ç¬¬ä¸‰æ–¹ä¸ºè¿™äº›æ¥å£æä¾›å®ç°ã€‚å¸¸è§çš„ SPI æœ‰ JDBCã€JCEã€JNDIã€JAXP å’Œ JBI ç­‰ã€‚è¿™äº› SPI çš„æ¥å£ç”± <strong>Java æ ¸å¿ƒåº“</strong>æ¥æä¾›ï¼Œè€Œè¿™äº› SPI çš„å®ç°ä»£ç åˆ™æ˜¯ä½œä¸º Java åº”ç”¨æ‰€ä¾èµ–çš„ jar åŒ…è¢«åŒ…å«è¿›<strong>ç±»è·¯å¾„</strong>ï¼ˆclasspathï¼‰é‡Œã€‚SPIæ¥å£ä¸­çš„ä»£ç ç»å¸¸éœ€è¦åŠ è½½å…·ä½“çš„å®ç°ç±»ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨SPI?  SPIæ˜¯JDKå†…ç½®çš„ä¸€ç§<strong>æœåŠ¡æä¾›å‘ç°æœºåˆ¶</strong>ã€‚è¿™æ ·åšçš„å¥½å¤„ä¸»è¦æ˜¯ä¸ºäº†è§£è€¦ï¼Œå®ç°åŠ¨æ€æ›¿æ¢ï¼Œå‡å°‘ç¡¬ç¼–ç ï¼ˆæ¯”å¦‚jdk1.6ä¹‹å‰çš„Class.forName(â€œXXXXâ€) ï¼‰é¢å‘æ¥å£ç¼–ç¨‹ï¼Œåœ¨å¾ˆå¤šå¼€æºæ¡†æ¶ä¸­éƒ½æœ‰ä½“ç°ï¼Œæ¯”å¦‚Dubboï¼ŒSpringç­‰</p></blockquote><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<code>SPIçš„æ¥å£</code>æ˜¯Javaæ ¸å¿ƒåº“çš„ä¸€éƒ¨åˆ†ä½äº<code>rt.jar</code>ä¸­ï¼Œæ˜¯ç”±<strong>æ ¹åŠ è½½å™¨</strong>(Bootstrap Classloader)æ¥åŠ è½½çš„ï¼Œè€Œ<code>SPIçš„å®ç°ç±»</code>æ˜¯ä¸€èˆ¬æ˜¯ç¬¬ä¸‰æ–¹çš„æä¾›çš„ï¼Œä½äº<code>classpath</code>ç›®å½•ä¸­ï¼Œè€Œ<strong>æ ¹åŠ è½½å™¨</strong>å¾ˆæ˜æ˜¾æ˜¯æ— æ³•ç›´æ¥åŠ è½½åˆ°è¿™ä¸ªç›®å½•ä¸‹çš„SPI çš„å®ç°ç±»çš„ (åŒäº²å§”æ´¾)ï¼Œé‚£<code>SPI</code>æ˜¯å¦‚ä½•è‡ªåŠ¨åŠ è½½åˆ°å®ç°ç±»çš„å‘¢ï¼Ÿ</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè™šæ‹Ÿæœºæä¾›äº†<strong>çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼ˆTCCLï¼‰</strong>é…åˆ<code>ServiceLoader</code>æ¥å¸®åŠ©ä¸Šå±‚åŠ è½½å™¨åŠ è½½ç±»ï¼Œ<code>TCCL</code>ç ´åäº†â€œåŒäº²å§”æ´¾æ¨¡å‹â€ï¼Œå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ‡æ¢ä¸º<code>TCCL</code> æ¥åŠ è½½ç¬¬ä¸‰æ–¹çš„SPIå®ç°ç±»ï¼ŒæŠ›å¼ƒåŒäº²å§”æ´¾æœºåˆ¶ï¼Œä½¿ç¨‹åºå¯ä»¥é€†å‘ä½¿ç”¨ç±»åŠ è½½å™¨ã€‚<strong>TCCL</strong>é»˜è®¤æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>setContextClassLoader</code>å»è®¾ç½®</p><h3 id="JDBCæºç æ¡ˆä¾‹åˆ†æ"><a href="#JDBCæºç æ¡ˆä¾‹åˆ†æ" class="headerlink" title="JDBCæºç æ¡ˆä¾‹åˆ†æ"></a>JDBCæºç æ¡ˆä¾‹åˆ†æ</h3><p>ç¿»åˆ°äº†æœ€å¼€å§‹å­¦JDBCçš„æ—¶å€™å†™çš„ä»£ç ğŸ˜„</p><p><img alt="JDBC" data-src="http://static.imlgw.top///20190420/K4uQf6h5czDb.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è´¾çæ¬²æ‰§äº‹</strong>ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ­¥è¿˜æ˜¯åŠ è½½å¹¶ä¸”åˆå§‹åŒ–é©±åŠ¨ï¼Œå‰é¢å·²ç»æåˆ°è¿™ä¸€æ­¥å…¶å®æ²¡æœ‰å¿…è¦äº†ï¼Œjdk1.6ä¹‹åå› ä¸ºServiceLoaderï¼ŒSPIæœºåˆ¶çš„å‡ºç°ï¼Œå°±ä¸ç”¨å†æ˜¾ç¤ºçš„åŠ è½½é©±åŠ¨ï¼Œä½†æ˜¯æ­£å¦‚ä¸Šé¢æ‰€è¯´<code>Driver</code>åªæ˜¯ä¸ªæ¥å£å­˜æ”¾äº<code>rt.jar</code> ä¸­ï¼Œç”±æ ¹åŠ è½½å™¨æ‰€åŠ è½½ï¼Œé‚£SPIæ˜¯æ€ä¹ˆè‡ªåŠ¨çš„åŠ è½½åˆ°<code>mysql</code>çš„<code>Driver</code>å®ä¾‹çš„å‘¢ï¼ŸğŸ˜•</p><p>æˆ‘ä»¬ä¸€æ­¥æ­¥çš„æ¥çœ‹ï¼Œé¦–å…ˆ<code>DriverManager.getConnection()</code>è¿™é‡Œï¼Œ<code>getConnection</code>æ˜¯ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨å®ƒå°±ä¼šå…ˆæ‰§è¡Œ<code>DriverManager</code>ç±»çš„é™æ€ä»£ç å—ï¼Œè€Œé™æ€ä»£ç å—é‡Œé¢ä¸»è¦æ‰§è¡Œçš„å°±æ˜¯<code>loadInitialDrivers()</code></p><h3 id="loadInitialDrivers-æºç "><a href="#loadInitialDrivers-æºç " class="headerlink" title="loadInitialDrivers()æºç "></a>loadInitialDrivers()æºç </h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadInitialDrivers</span><span class="params">()</span> </span>{</span><br><span class="line">    String drivers;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        drivers = AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction<string>() {</string></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">return</span> System.getProperty(<span class="string">"jdbc.drivers"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">        drivers = <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// If the driver is packaged as a Service Provider, load it.</span></span><br><span class="line">    <span class="comment">// Get all the drivers through the classloader</span></span><br><span class="line">    <span class="comment">// exposed as a java.sql.Driver.class service.</span></span><br><span class="line">    <span class="comment">// ServiceLoader.load() replaces the sun.misc.Providers()</span></span><br><span class="line"><span class="comment">// å¦‚æœé©±åŠ¨æ­£ç¡®æ‰“åŒ…ä¸ºjarå°±ä¼šç”¨ServiceLoaderå»åŠ è½½å®ƒ</span></span><br><span class="line">    AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction<void>() {</void></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">/****************************************************/</span></span><br><span class="line"><span class="comment">/*ServiceLoadå·¥å…·ç±»ï¼Œæ³¨æ„è¿™ä¸ªServiceLoadçš„åŠ è½½å™¨ï¼Œé»˜è®¤å°±æ˜¯TCCL*/</span></span><br><span class="line">            ServiceLoader<driver> loadedDrivers = ServiceLoader.load(Driver<span class="class">.<span class="keyword">class</span>)</span>;</driver></span><br><span class="line">            <span class="comment">/****************************************************/</span></span><br><span class="line">            <span class="comment">/*åœ¨è¿™é‡Œä¼šè·å–åˆ°ä¸€ä¸ªDriversçš„è¿­ä»£å™¨ï¼Œä½†æ˜¯å…¶å®è¿˜æ²¡æœ‰å¼€å§‹åŠ è½½ç±»*/</span></span><br><span class="line">            Iterator<driver> driversIterator = loadedDrivers.iterator();</driver></span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Load these drivers, so that they can be instantiated.</span></span><br><span class="line"><span class="comment">             * It may be the case that the driver class may not be there</span></span><br><span class="line"><span class="comment">             * i.e. there may be a packaged driver with the service class</span></span><br><span class="line"><span class="comment">             * as implementation of java.sql.Driver but the actual class</span></span><br><span class="line"><span class="comment">             * may be missing. In that case a java.util.ServiceConfigurationError</span></span><br><span class="line"><span class="comment">             * will be thrown at runtime by the VM trying to locate</span></span><br><span class="line"><span class="comment">             * and load the service.</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * Adding a try catch block to catch those runtime errors</span></span><br><span class="line"><span class="comment">             * if driver not available in classpath but it's</span></span><br><span class="line"><span class="comment">             * packaged as service and that service is there in classpath.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">try</span>{</span><br><span class="line">                <span class="keyword">while</span>(driversIterator.hasNext()) {</span><br><span class="line">                    <span class="comment">//è¿­ä»£çš„è¿‡ç¨‹ä¸­é€šè¿‡nextåå°„åŠ è½½å¹¶åˆå§‹åŒ–è¿™ä¸ªé©±åŠ¨å­—èŠ‚ç </span></span><br><span class="line">                    <span class="comment">//æ²¡æœ‰æ¥æ”¶è¿”å›çš„æ•°æ®åº“é©±åŠ¨å®ä¾‹</span></span><br><span class="line">                    driversIterator.next();</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span>(Throwable t) {</span><br><span class="line">            <span class="comment">// Do nothing</span></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"DriverManager.initialize: jdbc.drivers = "</span> + drivers);</span><br><span class="line"><span class="comment">//åŠ è½½Jdkä¸­çš„é©±åŠ¨å®ä¾‹ï¼ˆè™½ç„¶æˆ‘å¹¶ä¸çŸ¥é“æ˜¯ä»€ä¹ˆï¼‰æ€»ä¹‹æˆ‘ä»¬ç¬¬ä¸‰æ–¹çš„é©±åŠ¨å·²ç»åŠ è½½å¥½äº†</span></span><br><span class="line">    <span class="keyword">if</span> (drivers == <span class="keyword">null</span> || drivers.equals(<span class="string">""</span>)) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    String[] driversList = drivers.split(<span class="string">":"</span>);</span><br><span class="line">    println(<span class="string">"number of Drivers:"</span> + driversList.length);</span><br><span class="line">    <span class="keyword">for</span> (String aDriver : driversList) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            println(<span class="string">"DriverManager.Initialize: loading "</span> + aDriver);</span><br><span class="line">            Class.forName(aDriver, <span class="keyword">true</span>,</span><br><span class="line">                    ClassLoader.getSystemClassLoader());</span><br><span class="line">        } <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">            println(<span class="string">"DriverManager.Initialize: load failed: "</span> + ex);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸€è¡Œå¾ˆå…³é”®çš„ä»£ç </p><p> <code>ServiceLoader<driver> loadedDrivers = ServiceLoader.load(Driver.class);</driver></code></p><p>è¿™å°±æ˜¯æˆ‘ä¸Šé¢æ‰€æåˆ°çš„ <code>ServiceLoader</code> </p><blockquote><p>å¯¹äºSPIæœºåˆ¶ï¼ŒJDKæä¾›äº†<code>java.util.ServiceLoader</code>å·¥å…·ç±»ï¼Œåœ¨ä½¿ç”¨æŸä¸ªæœåŠ¡æ¥å£æ—¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾è¯¥æœåŠ¡æ¥å£çš„å®ç°ç±»ï¼ŒåŠ è½½å’Œåˆå§‹åŒ–ï¼Œå‰ææ¡ä»¶æ˜¯åŸºäºå®ƒçš„çº¦å®šï¼šå½“æœåŠ¡çš„æä¾›è€…æä¾›äº†æœåŠ¡æ¥å£çš„ä¸€ç§å®ç°ä¹‹åï¼Œåœ¨<code>jar</code>åŒ…çš„<code>META-INF/services/</code>ç›®å½•é‡ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªä»¥<code>æœåŠ¡æ¥å£å‘½åçš„æ–‡ä»¶</code>ã€‚è¯¥æ–‡ä»¶é‡Œå°±æ˜¯å®ç°è¯¥æœåŠ¡æ¥å£çš„å…·ä½“å®ç°ç±»ï¼ˆå»è§£å‹çœ‹çœ‹é‚£äº›jaråŒ…å°±å¯ä»¥çœ‹è§è¿™äº›ä¿¡æ¯o(<em>ï¿£â–½ï¿£</em>)ãƒ–ï¼‰</p></blockquote><h3 id="ServiceLoaderç±»æºç "><a href="#ServiceLoaderç±»æºç " class="headerlink" title="ServiceLoaderç±»æºç "></a>ServiceLoaderç±»æºç </h3><p>ä¸ºäº†èŠ‚çº¦ç¯‡å¹…åˆ æ‰äº†ä¸€äº›æ³¨é‡Šï¼Œå‘ç°å…¶å®æ•´ä¸ªç±»ä¹Ÿæ²¡å¤šå°‘è¡Œå¤§æ¦‚2ï¼Œ3ç™¾è¡Œçš„æ ·å­ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªç±»å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLoader</span><<span class="title">S</span>> <span class="keyword">implements</span> <span class="title">Iterable</span><<span class="title">S</span>> </span>{</span><br><span class="line"><span class="comment">//ç›®å½•å‰ç¼€å°±æ˜¯ä»è¿™é‡Œæ¥çš„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX = <span class="string">"META-INF/services/"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ç°ç±»Service</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class<s> service;</s></span><s><br><span class="line"></span><br><span class="line">    <span class="comment">// The class loader used to locate, load, and instantiate providers</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader loader;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The access control context taken when the ServiceLoader is created</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AccessControlContext acc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cached providers, in instantiation order</span></span><br><span class="line">    <span class="comment">// æŒ‰ç…§å®ä¾‹çš„é¡ºåºï¼Œæ¥ç¼“å­˜æœåŠ¡æä¾›è€…é¿å…é‡å¤çš„åŠ è½½ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„iteratoræ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> LinkedHashMap<string,s> providers = <span class="keyword">new</span> LinkedHashMap<>();</string,s></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The current lazy-lookup iterator</span></span><br><span class="line">    <span class="keyword">private</span> LazyIterator lookupIterator;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reload</span><span class="params">()</span> </span>{</span><br><span class="line">        providers.clear();</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–æ‡’åŠ è½½è¿­ä»£å™¨</span></span><br><span class="line">        lookupIterator = <span class="keyword">new</span> LazyIterator(service, loader);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ServiceLoader</span><span class="params">(Class<s> svc, ClassLoader cl)</s></span><s> </s></span><s>{</s></span><s><br><span class="line">        service = Objects.requireNonNull(svc, <span class="string">"Service interface cannot be null"</span>);</span><br><span class="line">        loader = (cl == <span class="keyword">null</span>) ? ClassLoader.getSystemClassLoader() : cl;</span><br><span class="line">        acc = (System.getSecurityManager() != <span class="keyword">null</span>) ? AccessController.getContext() : <span class="keyword">null</span>;</span><br><span class="line">        reload();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fail</span><span class="params">(Class<!--?--> service, String msg, Throwable cause)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServiceConfigurationError</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServiceConfigurationError(service.getName() + <span class="string">": "</span> + msg,</span><br><span class="line">                                            cause);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fail</span><span class="params">(Class<!--?--> service, String msg)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServiceConfigurationError</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServiceConfigurationError(service.getName() + <span class="string">": "</span> + msg);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fail</span><span class="params">(Class<!--?--> service, URL u, <span class="keyword">int</span> line, String msg)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServiceConfigurationError</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        fail(service, u + <span class="string">":"</span> + line + <span class="string">": "</span> + msg);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parse a single line from the given configuration file, adding the name</span></span><br><span class="line">    <span class="comment">// on the line to the names list.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">parseLine</span><span class="params">(Class<!--?--> service, URL u, BufferedReader r, <span class="keyword">int</span> lc,</span></span></span><br><span class="line"><span class="function"><span class="params">                          List<string> names)</string></span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServiceConfigurationError</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        String ln = r.readLine();</span><br><span class="line">        <span class="keyword">if</span> (ln == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> ci = ln.indexOf(<span class="string">'#'</span>);</span><br><span class="line">        <span class="keyword">if</span> (ci >= <span class="number">0</span>) ln = ln.substring(<span class="number">0</span>, ci);</span><br><span class="line">        ln = ln.trim();</span><br><span class="line">        <span class="keyword">int</span> n = ln.length();</span><br><span class="line">        <span class="keyword">if</span> (n != <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> ((ln.indexOf(<span class="string">' '</span>) >= <span class="number">0</span>) || (ln.indexOf(<span class="string">'\t'</span>) >= <span class="number">0</span>))</span><br><span class="line">                fail(service, u, lc, <span class="string">"Illegal configuration-file syntax"</span>);</span><br><span class="line">            <span class="keyword">int</span> cp = ln.codePointAt(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (!Character.isJavaIdentifierStart(cp))</span><br><span class="line">                fail(service, u, lc, <span class="string">"Illegal provider-class name: "</span> + ln);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = Character.charCount(cp); i < n; i += Character.charCount(cp)) {</span><br><span class="line">                cp = ln.codePointAt(i);</span><br><span class="line">                <span class="keyword">if</span> (!Character.isJavaIdentifierPart(cp) && (cp != <span class="string">'.'</span>))</span><br><span class="line">                    fail(service, u, lc, <span class="string">"Illegal provider-class name: "</span> + ln);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (!providers.containsKey(ln) && !names.contains(ln))</span><br><span class="line">                names.add(ln);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> lc + <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Iterator<string> <span class="title">parse</span><span class="params">(Class<!--?--> service, URL u)</span></string></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServiceConfigurationError</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        BufferedReader r = <span class="keyword">null</span>;</span><br><span class="line">        ArrayList<string> names = <span class="keyword">new</span> ArrayList<>();</string></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            in = u.openStream();</span><br><span class="line">            r = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in, <span class="string">"utf-8"</span>));</span><br><span class="line">            <span class="keyword">int</span> lc = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> ((lc = parseLine(service, u, r, lc, names)) >= <span class="number">0</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException x) {</span><br><span class="line">            fail(service, <span class="string">"Error reading configuration file"</span>, x);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">if</span> (r != <span class="keyword">null</span>) r.close();</span><br><span class="line">                <span class="keyword">if</span> (in != <span class="keyword">null</span>) in.close();</span><br><span class="line">            } <span class="keyword">catch</span> (IOException y) {</span><br><span class="line">                fail(service, <span class="string">"Error closing configuration file"</span>, y);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> names.iterator();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Private inner class implementing fully-lazy provider lookup</span></span><br><span class="line">    <span class="comment">// çœ‹åå­—å°±çŸ¥é“äº†ï¼Œæ‡’è¿­ä»£å™¨ï¼Œåœ¨è¿­ä»£çš„æ—¶å€™æ‰çœŸæ­£çš„åŠ è½½</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyIterator</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Iterator</span><<span class="title">S</span>></span></span><br><span class="line"><span class="class">    </span>{</span><br><span class="line"></span><br><span class="line">        Class<s> service;</s></span><s><br><span class="line">        ClassLoader loader;</span><br><span class="line">        Enumeration<url> configs = <span class="keyword">null</span>;</url></span><br><span class="line">        Iterator<string> pending = <span class="keyword">null</span>;</string></span><br><span class="line">        String nextName = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">LazyIterator</span><span class="params">(Class<s> service, ClassLoader loader)</s></span><s> </s></span><s>{</s></span><s><br><span class="line">            <span class="keyword">this</span>.service = service;</span><br><span class="line">            <span class="keyword">this</span>.loader = loader;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasNextService</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (nextName != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (configs == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    String fullName = PREFIX + service.getName();</span><br><span class="line">                    <span class="keyword">if</span> (loader == <span class="keyword">null</span>)</span><br><span class="line">                        configs = ClassLoader.getSystemResources(fullName);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        configs = loader.getResources(fullName);</span><br><span class="line">                } <span class="keyword">catch</span> (IOException x) {</span><br><span class="line">                    fail(service, <span class="string">"Error locating configuration files"</span>, x);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">while</span> ((pending == <span class="keyword">null</span>) || !pending.hasNext()) {</span><br><span class="line">                <span class="keyword">if</span> (!configs.hasMoreElements()) {</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                }</span><br><span class="line">                pending = parse(service, configs.nextElement());</span><br><span class="line">            }</span><br><span class="line">            nextName = pending.next();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line"><span class="comment">//è¿­ä»£å™¨çš„next</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> S <span class="title">nextService</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (!hasNextService())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">            String cn = nextName;</span><br><span class="line">            nextName = <span class="keyword">null</span>;</span><br><span class="line">            Class<!--?--> c = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//åˆ©ç”¨TCCLåŠ è½½å®ç°ç±»ï¼Œä½†æ˜¯ä¸åˆå§‹åŒ–</span></span><br><span class="line">                c = Class.forName(cn, <span class="keyword">false</span>, loader);</span><br><span class="line">            } <span class="keyword">catch</span> (ClassNotFoundException x) {</span><br><span class="line">                fail(service,</span><br><span class="line">                     <span class="string">"Provider "</span> + cn + <span class="string">" not found"</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (!service.isAssignableFrom(c)) {</span><br><span class="line">                fail(service,</span><br><span class="line">                     <span class="string">"Provider "</span> + cn  + <span class="string">" not a subtype"</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//newInstance()åˆå§‹åŒ–äº†å¯¹åº”çš„å®ç°ç±»</span></span><br><span class="line">                S p = service.cast(c.newInstance());</span><br><span class="line">                <span class="comment">//æ”¾åˆ°providersä¸­</span></span><br><span class="line">                providers.put(cn, p);</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            } <span class="keyword">catch</span> (Throwable x) {</span><br><span class="line">                fail(service,</span><br><span class="line">                     <span class="string">"Provider "</span> + cn + <span class="string">" could not be instantiated"</span>,</span><br><span class="line">                     x);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error();          <span class="comment">// This cannot happen</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (acc == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> hasNextService();</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                PrivilegedAction<boolean> action = <span class="keyword">new</span> PrivilegedAction<boolean>() {</boolean></boolean></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Boolean <span class="title">run</span><span class="params">()</span> </span>{ <span class="keyword">return</span> hasNextService(); }</span><br><span class="line">                };</span><br><span class="line">                <span class="keyword">return</span> AccessController.doPrivileged(action, acc);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> S <span class="title">next</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (acc == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> nextService();</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                PrivilegedAction<s> action = <span class="keyword">new</span> PrivilegedAction<s>() {</s></s></span><s><s><br><span class="line">                    <span class="function"><span class="keyword">public</span> S <span class="title">run</span><span class="params">()</span> </span>{ <span class="keyword">return</span> nextService(); }</span><br><span class="line">                };</span><br><span class="line">                <span class="keyword">return</span> AccessController.doPrivileged(action, acc);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Lazily loads the available providers of this loader's service.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  An iterator that lazily loads providers for this loader's</span></span><br><span class="line"><span class="comment">     *          service</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator<s> <span class="title">iterator</span><span class="params">()</span> </s></span><s>{</s></span><s><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Iterator<s>() {</s></span><s><br><span class="line"></span><br><span class="line">            Iterator<map.entry<string,s>> knownProviders</map.entry<string,s></span><br><span class="line">                = providers.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">if</span> (knownProviders.hasNext())</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">return</span> lookupIterator.hasNext();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> S <span class="title">next</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">if</span> (knownProviders.hasNext())</span><br><span class="line">                    <span class="keyword">return</span> knownProviders.next().getValue();</span><br><span class="line">                <span class="keyword">return</span> lookupIterator.next();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* é‡è½½çš„ServiceLoad */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <s> <span class="function">ServiceLoader<s> <span class="title">load</span><span class="params">(Class<s> service,</s></span></s></span></s></span><s><s><s><br><span class="line"><span class="function"><span class="params">                                            ClassLoader loader)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServiceLoader<>(service, loader);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">//DriverManageé‡Œé¢å°±æ˜¯è°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <s> <span class="function">ServiceLoader<s> <span class="title">load</span><span class="params">(Class<s> service)</s></span><s> </s></s></span><s><s>{</s></s></s></span><s><s><s><br><span class="line">        <span class="comment">//æ‹¿åˆ°äº†TCCL</span></span><br><span class="line">        ClassLoader cl = Thread.currentThread().getContextClassLoader();</span><br><span class="line">        <span class="comment">//è°ƒç”¨ä¸Šé¢é‡è½½çš„ServiceLoadæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> ServiceLoader.load(service, cl);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <s> <span class="function">ServiceLoader<s> <span class="title">loadInstalled</span><span class="params">(Class<s> service)</s></span><s> </s></s></span><s><s>{</s></s></s></span><s><s><s><br><span class="line">        ClassLoader cl = ClassLoader.getSystemClassLoader();</span><br><span class="line">        ClassLoader prev = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (cl != <span class="keyword">null</span>) {</span><br><span class="line">            prev = cl;</span><br><span class="line">            cl = cl.getParent();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ServiceLoader.load(service, prev);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"java.util.ServiceLoader["</span> + service.getName() + <span class="string">"]"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></s></s></s></s></s></s></s></s></s></s></s></s></s></s></s></s></s></pre></td></tr></tbody></table></figure></div><blockquote><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ä¸€ç‚¹ï¼Œ<code>Driveræ¥å£</code>ï¼Œ<code>DriverManageç±»</code>ï¼Œä»¥åŠ<code>ServiceLoader</code>éƒ½æ˜¯ç”±<strong>æ ¹åŠ è½½å™¨</strong>å»åŠ è½½çš„(å¦‚æœä¸ç›¸ä¿¡çš„è¯å¯ä»¥ç”¨TraceClassLoadingå»æŸ¥çœ‹)ï¼Œæ‰€ä»¥åœ¨<code>ServiceLoader</code>ä¸­ä¹Ÿæ˜¯æ— æ³•ç›´æ¥åŠ è½½å…·ä½“å¾—å®ç°ç±»çš„</p></blockquote><p>å‰é¢<code>loadInitialDriver()</code> è°ƒç”¨çš„å°±æ˜¯è¿™é‡Œçš„ <code>ServiceLoader.load(Class<s> service)</s></code><s> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­æ‚„æ‚„çš„æ‹¿åˆ°äº†<code>TCCL</code> ï¼Œè€ŒTCCLåœ¨<code>Launcher</code> ç±»ï¼ˆç³»ç»ŸåŠ è½½å™¨å’Œæ‰©å±•åŠ è½½å™¨éƒ½æ˜¯åœ¨Launcherä¸­å®ç°çš„ï¼‰ä¸­é»˜è®¤è®¾ç½®æˆäº†ç³»ç»ŸåŠ è½½å™¨ï¼Œå…·ä½“å¯ä»¥å»çœ‹ä¸€ä¸‹æºç è¿™é‡Œæˆ‘å°±ä¸å±•å¼€äº†ï¼Œç„¶åè°ƒç”¨å¦ä¸€ä¸ªé‡è½½çš„æ„é€ æ–¹æ³•å°†<code>TCCL</code> ä¼ é€’è¿›å»ï¼Œæœ€ç»ˆè°ƒç”¨äº† <code>reload()</code>æ–¹æ³•</s></p><s><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reload</span><span class="params">()</span> </span>{</span><br><span class="line">    providers.clear();</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–æ‡’åŠ è½½è¿­ä»£å™¨</span></span><br><span class="line">    lookupIterator = <span class="keyword">new</span> LazyIterator(service, loader);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p> åœ¨è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæ¸…ç©ºæœåŠ¡æä¾›è€…(providers)ç¼“å­˜ï¼Œç„¶ååˆå§‹åŒ–äº†ä¸€ä¸ª<code>LazyIterator</code> çœ‹åå­—å°±çŸ¥é“æ˜¯å•¥æ„æ€äº†ï¼Œå…¶å®åˆ°è¿™é‡Œä»ç„¶æ²¡æœ‰ä»»ä½•å…·ä½“çš„åŠ è½½åŠ¨ä½œï¼Œå› ä¸ºè¿™é‡Œé‡‡ç”¨çš„æ˜¯æŒ‰éœ€åŠ è½½ï¼Œä¹Ÿå°±æ˜¯æ‡’åŠ è½½ï¼Œåœ¨è¿­ä»£çš„æ—¶å€™æ‰ä¼šå»åŠ è½½ç±»</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span><<span class="title">S</span>></span>{</span><br><span class="line">Class<s> service;</s></span><s><br><span class="line">    ClassLoader loader;</span><br><span class="line">    Enumeration<url> configs = <span class="keyword">null</span>;</url></span><br><span class="line">    Iterator<string> pending = <span class="keyword">null</span>;</string></span><br><span class="line">    String nextName = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazyIterator</span><span class="params">(Class<s> service, ClassLoader loader)</s></span><s> </s></span><s>{</s></span><s><br><span class="line">        <span class="keyword">this</span>.service = service;</span><br><span class="line">        <span class="keyword">this</span>.loader = loader;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasNextService</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (nextName != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (configs == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//æ‹¿åˆ°æ¥å£å…¨å</span></span><br><span class="line">                String fullName = PREFIX + service.getName();</span><br><span class="line">                <span class="keyword">if</span> (loader == <span class="keyword">null</span>)</span><br><span class="line">                    configs = ClassLoader.getSystemResources(fullName);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    configs = loader.getResources(fullName);</span><br><span class="line">            } <span class="keyword">catch</span> (IOException x) {</span><br><span class="line">                fail(service, <span class="string">"Error locating configuration files"</span>, x);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> ((pending == <span class="keyword">null</span>) || !pending.hasNext()) {</span><br><span class="line">            <span class="keyword">if</span> (!configs.hasMoreElements()) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//è§£æ</span></span><br><span class="line">            pending = parse(service, configs.nextElement());</span><br><span class="line">        }</span><br><span class="line">        nextName = pending.next();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line"><span class="comment">//è¿­ä»£å™¨çš„next</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> S <span class="title">nextService</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!hasNextService())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">        String cn = nextName;</span><br><span class="line">        nextName = <span class="keyword">null</span>;</span><br><span class="line">        Class<!--?--> c = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//å…·ä½“åŠ è½½ç±»çš„åœ°æ–¹å°±æ˜¯åœ¨è¿™é‡Œ</span></span><br><span class="line">            <span class="comment">//åˆ©ç”¨å‰é¢ä¼ è¿›æ¥çš„TCCLåŠ è½½å®ç°ç±»ï¼Œä½†æ˜¯ä¸åˆå§‹åŒ–ç±»</span></span><br><span class="line">            c = Class.forName(cn, <span class="keyword">false</span>, loader);</span><br><span class="line">        } <span class="keyword">catch</span> (ClassNotFoundException x) {</span><br><span class="line">            fail(service,</span><br><span class="line">                 <span class="string">"Provider "</span> + cn + <span class="string">" not found"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!service.isAssignableFrom(c)) {</span><br><span class="line">            fail(service,</span><br><span class="line">                 <span class="string">"Provider "</span> + cn  + <span class="string">" not a subtype"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//newInstance()å®ä¾‹åŒ–å¯¹åº”çš„å®ç°ç±»</span></span><br><span class="line">            S p = service.cast(c.newInstance());</span><br><span class="line">            <span class="comment">//putåˆ°providersä¸­</span></span><br><span class="line">            providers.put(cn, p);</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        } <span class="keyword">catch</span> (Throwable x) {</span><br><span class="line">            fail(service,</span><br><span class="line">                 <span class="string">"Provider "</span> + cn + <span class="string">" could not be instantiated"</span>,</span><br><span class="line">                 x);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Error();          <span class="comment">// This cannot happen</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (acc == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> hasNextService();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            PrivilegedAction<boolean> action = <span class="keyword">new</span> PrivilegedAction<boolean>() {</boolean></boolean></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Boolean <span class="title">run</span><span class="params">()</span> </span>{ <span class="keyword">return</span> hasNextService(); }</span><br><span class="line">            };</span><br><span class="line">            <span class="keyword">return</span> AccessController.doPrivileged(action, acc);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> S <span class="title">next</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (acc == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> nextService();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            PrivilegedAction<s> action = <span class="keyword">new</span> PrivilegedAction<s>() {</s></s></span><s><s><br><span class="line">                <span class="function"><span class="keyword">public</span> S <span class="title">run</span><span class="params">()</span> </span>{ <span class="keyword">return</span> nextService(); }</span><br><span class="line">            };</span><br><span class="line">            <span class="keyword">return</span> AccessController.doPrivileged(action, acc);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></s></s></s></s></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ å¯ä»¥çœ‹åˆ°åœ¨è¿­ä»£å™¨çš„<code>nextService()</code> ä¸­æ‰å¼€å§‹åˆ©ç”¨çš„<code>Class.forName()</code> åŠ è½½çš„å…·ä½“å®ç°ç±»ï¼Œè€Œè¿™ä¸ªåŠ è½½å™¨æ­£å™¨æ­£æ˜¯å‰é¢<code>reload</code>ä¼ é€’è¿‡æ¥çš„ <code>TCCL</code> ä¹Ÿå°±æ˜¯é»˜è®¤çš„ç³»ç»Ÿç±»åŠ è½½å™¨</p><p>ğŸ”¸ éšååœ¨ç´§è·Ÿçš„tryè¯­å¥ä¸­é€šè¿‡ <code>newInstance()</code> å®ä¾‹åŒ–äº†å…·ä½“çš„å®ç°ç±»(MySqlçš„é©±åŠ¨) ï¼Œç„¶åputè¿›providersé˜Ÿåˆ—å¹¶ä¸”è¿”å›å®ä¾‹åŒ–çš„å®ç°ç±»ï¼Œä½†æ˜¯åœ¨<code>loadInitialDrivers</code>ä¸­å¹¶æ²¡æœ‰æ¥æ”¶è¿™ä¸ªè¿”å›ï¼Œé‚£ä»–è¿™é‡Œå®ä¾‹åŒ–æ˜¯ä»€ä¹ˆç”¨æ„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å›åˆ°<code>getConnection()</code> æ–¹æ³•</p><h3 id="getConnection-æºç "><a href="#getConnection-æºç " class="headerlink" title="getConnection()æºç "></a>getConnection()æºç </h3><p>å‰é¢çš„é™æ€æ–¹æ³•è°ƒç”¨å®Œæ¯•é©±åŠ¨å·²ç»åŠ è½½ï¼Œä¸‹é¢å°±æ˜¯è·å–æ•°æ®åº“è¿æ¥äº†.</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String url,</span></span></span><br><span class="line"><span class="function"><span class="params">    String user, String password)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">    java.util.Properties info = <span class="keyword">new</span> java.util.Properties();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user != <span class="keyword">null</span>) {</span><br><span class="line">        info.put(<span class="string">"user"</span>, user);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (password != <span class="keyword">null</span>) {</span><br><span class="line">        info.put(<span class="string">"password"</span>, password);</span><br><span class="line">    }</span><br><span class="line"><span class="comment">// Reflection.getCallerClass()è°ƒç”¨è€…çš„Classå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> (getConnection(url, info, Reflection.getCallerClass()));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€èˆ¬è·å–è¿æ¥éƒ½æ˜¯è°ƒç”¨çš„ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨å¦ä¸€ä¸ªé‡è½½çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¼ å…¥ä¸€ä¸ªè°ƒç”¨è€…çš„Classå¯¹è±¡</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String url, java.util.Properties info, Class<!--?--> caller)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * When callerCl is null, we should check the application's</span></span><br><span class="line"><span class="comment">     * (which is invoking this class indirectly)</span></span><br><span class="line"><span class="comment">     * classloader, so that the JDBC driver class outside rt.jar</span></span><br><span class="line"><span class="comment">     * can be loaded from here.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//Callerå°±æ˜¯è°ƒç”¨è€…çš„CLassä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„åº”ç”¨ä»£ç ç±»</span></span><br><span class="line">    <span class="comment">//è·å–åˆ°æˆ‘ä»¬åº”ç”¨ç±»çš„ç±»åŠ è½½å™¨</span></span><br><span class="line">    ClassLoader callerCL = caller != <span class="keyword">null</span> ? caller.getClassLoader() : <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">synchronized</span>(DriverManager<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">        <span class="comment">// synchronize loading of the correct classloader.</span></span><br><span class="line">        <span class="keyword">if</span> (callerCL == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//å¦‚æœä¸ºç©ºå°±ï¼Œè·å–çº¿ç¨‹çº¿ä¸‹æ–‡åŠ è½½å™¨</span></span><br><span class="line">            callerCL = Thread.currentThread().getContextClassLoader();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(url == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"The url cannot be null"</span>, <span class="string">"08001"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"DriverManager.getConnection(\""</span> + url + <span class="string">"\")"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Walk through the loaded registeredDrivers attempting to make a connection.</span></span><br><span class="line">    <span class="comment">// Remember the first exception that gets raised so we can reraise it.</span></span><br><span class="line">    SQLException reason = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†è¿™ä¸ªregisteredDriversé‡Œé¢éƒ½æ˜¯DriverInfo</span></span><br><span class="line">    <span class="keyword">for</span>(DriverInfo aDriver : registeredDrivers) {</span><br><span class="line">        <span class="comment">// If the caller does not have permission to load the driver then</span></span><br><span class="line">        <span class="comment">// skip it.</span></span><br><span class="line">        <span class="comment">//æ£€æŸ¥åŠ è½½é©±åŠ¨çš„åŠ è½½å™¨æ˜¯ä¸æ˜¯è°ƒç”¨è€…çš„ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="keyword">if</span>(isDriverAllowed(aDriver.driver, callerCL)) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                println(<span class="string">"    trying "</span> + aDriver.driver.getClass().getName());</span><br><span class="line">                <span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">                Connection con = aDriver.driver.connect(url, info);</span><br><span class="line">                <span class="keyword">if</span> (con != <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="comment">// Success!</span></span><br><span class="line">                    println(<span class="string">"getConnection returning "</span> + aDriver.driver.getClass().getName());</span><br><span class="line">                    <span class="keyword">return</span> (con);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (SQLException ex) {</span><br><span class="line">                <span class="keyword">if</span> (reason == <span class="keyword">null</span>) {</span><br><span class="line">                    reason = ex;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            println(<span class="string">"    skipping: "</span> + aDriver.getClass().getName());</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we got here nobody could connect.</span></span><br><span class="line">    <span class="keyword">if</span> (reason != <span class="keyword">null</span>)    {</span><br><span class="line">        println(<span class="string">"getConnection failed: "</span> + reason);</span><br><span class="line">        <span class="keyword">throw</span> reason;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"getConnection: no suitable driver found for "</span>+ url);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"No suitable driver found for "</span>+ url, <span class="string">"08001"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ å¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸€ä¸ªforeachå¾ªç¯ï¼Œéå†<code>registeredDrivers</code>ï¼Œè¿™æ˜¯ä¸ª<code>CopyOnWriteArrayList</code> è¿™ä¸ªç±»çœ‹åå­—å°±çŸ¥é“å­˜æ”¾çš„æ˜¯å·²ç»æ³¨å†Œçš„<code>Drivers</code> å®ç°ç±»ï¼Œé‚£è¿™äº›å®ç°ç±»æ˜¯ä»€ä¹ˆæ—¶å€™æ³¨å†Œè¿›æ¥çš„å‘¢ï¼Ÿå›åˆ°æˆ‘ä»¬ä¹‹å‰æŠ›å‡ºçš„ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨<code>ServiceLoader</code>çš„è¿­ä»£å™¨ä¸­åŠ è½½äº†å…·ä½“çš„ç±»ä¹‹åè¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œä½†æ˜¯<code>DriverManager</code> ä¸­å¹¶æ²¡æœ‰æ¥æ”¶è¿™ä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„é©±åŠ¨å®ç°ç±»</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mysql.cj.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Driver</span> <span class="keyword">extends</span> <span class="title">NonRegisteringDriver</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">sql</span>.<span class="title">Driver</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Driver</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//æ³¨å†Œåˆ°DriverManagerä¸­å»</span></span><br><span class="line">            DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">        } <span class="keyword">catch</span> (SQLException var1) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Can't register driver!"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œå¤§å®¶å°±æ˜ç™½äº†ï¼Œå‰é¢åˆå§‹åŒ–è¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯ä¸ºäº†èƒ½è§¦å‘è¿™ä¸ª<strong>é™æ€ä»£ç å—</strong>ï¼Œè¿›è€Œæ‰§è¡ŒregisterDriver()æ–¹æ³•è¿›è¡Œæ³¨å†Œï¼ŒçœŸæ˜¯å¦™å•ŠğŸ‘ä¸€ç¯å¥—ä¸€ç¯</p><p>ğŸ”¸ è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯è¿™é‡Œæ³¨å†Œçš„è™½ç„¶æ˜¯ä¸ªç©ºçš„Driverç±»ï¼Œä½†æ˜¯åˆ«å¿˜äº†å®ƒè¿˜æœ‰ä¸ªçˆ¶ç±»NonRegisteringDriver</p><p>è¿™ä¸ªç±»æ‰æ˜¯çœŸæ­£çš„å®ç°ç±»å…·ä½“çš„<code>connect()</code> ç­‰æ–¹æ³•éƒ½æ˜¯åœ¨è¿™ä¸ªé‡Œé¢å®ç°çš„ï¼Œè€ŒDriverç»§æ‰¿äº†å®ƒçš„æ–¹æ³•</p><p>ğŸ”¸ åœ¨éå†<code>registeredDrivers</code> çš„æ—¶å€™è¿˜è°ƒç”¨äº†ä¸€ä¸ª<code>isDriverAllowed(aDriver.driver, callerCL)</code> æ–¹æ³•è¿™ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯é©±åŠ¨çš„å®ç°ç±»ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å‰é¢è·å–åˆ°çš„<strong>è°ƒç”¨è€…çš„ç±»åŠ è½½å™¨</strong> ï¼Œä½œç”¨å°±æ˜¯é€šè¿‡åˆ©ç”¨ä¼ è¿›æ¥çš„åŠ è½½å™¨å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œç„¶ååˆ¤æ–­æ˜¯ä¸æ˜¯åŒä¸€ä¸ªç±»ï¼Œï¼ˆä¼—æ‰€å‘¨çŸ¥ä¸åŒçš„åŠ è½½å™¨å› ä¸ºå‘½åç©ºé—´çš„å­˜åœ¨ï¼Œå³ä½¿åŠ è½½åŒä¸€ä»½å­—èŠ‚ç æ–‡ä»¶å¾—åˆ°çš„ä¹Ÿä¸æ˜¯ä¸€ä¸ªç±»ï¼‰ å¦‚æœæ˜¯å°±å…è®¸åŠ è½½ï¼Œå¦åˆ™ä¸å…è®¸ï¼Œä¸ºå•¥è¦è¿™æ ·åšå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯å› ä¸ºå‘½åç©ºé—´çš„é—®é¢˜ï¼Œå› ä¸ºæœ‰äº†SPIçš„æœºåˆ¶ï¼Œä½ <strong>åŠ è½½åˆå§‹åŒ–è¿™ä¸ªå®ç°ç±»çš„åŠ è½½å™¨</strong>(TCCL)å’Œæœ€ç»ˆå»<strong>è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•çš„ç±»çš„åŠ è½½å™¨</strong>æœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªï¼Œå› ä¸ºç¨‹åºå‘˜å¯ä»¥å¾ˆå®¹æ˜“çš„å°†TCCLä¿®æ”¹æˆå…¶ä»–çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æœä¸ä¿è¯ä¸€è‡´çš„è¯åé¢å°±ä¼šå‡ºç°<code>ClassCastException</code>ç­‰å¼‚å¸¸ </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isDriverAllowed</span><span class="params">(Driver driver, ClassLoader classLoader)</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(driver != <span class="keyword">null</span>) {</span><br><span class="line">        Class<!--?--> aClass = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            aClass =  Class.forName(driver.getClass().getName(), <span class="keyword">true</span>, classLoader);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">            result = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">         result = ( aClass == driver.getClass() ) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><p>å½“é«˜å±‚æä¾›äº†ç»Ÿä¸€æ¥å£è®©ä½å±‚å»å®ç°ï¼ˆé¢å‘æ¥å£ç¼–ç¨‹ï¼Œè§£è€¦ï¼‰ï¼ŒåŒæ—¶åˆè¦æ˜¯åœ¨é«˜å±‚åŠ è½½ï¼ˆæˆ–å®ä¾‹åŒ–ï¼‰ä½å±‚çš„ç±»æ—¶ï¼Œå¿…é¡»é€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥å¸®åŠ©é«˜å±‚çš„ClassLoaderæ‰¾åˆ°å¹¶åŠ è½½è¯¥ç±»ã€‚</p><h2 id="Jar-Hell"><a href="#Jar-Hell" class="headerlink" title="Jar Hell"></a>Jar Hell</h2><p>JaråŒ…åœ°ç‹±ï¼Œ<a href="https://www.hidennis.tech/2016/05/30/what-is-jar-hell/" target="_blank" rel="noopener">å‚è€ƒ</a></p><p>è¿™ä¸ªé—®é¢˜å…¶å®å¯ä»¥é€šè¿‡<code>OSGI</code>ç­‰ç»„ä»¶åŒ–æ¡†æ¶æ¥è§£å†³ï¼Œä½¿ç”¨OSGIå¯ä»¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒOSGIæ˜¯åŸºäºæ¨¡å—ï¼ˆBundleï¼‰é©±åŠ¨çš„ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰å±äºè‡ªå·±çš„classpathå’Œç±»åŠ è½½å™¨ï¼Œæ¨¡å—ä¹‹é—´é€šè¿‡åŒ…æš´éœ²å’Œå¼•å…¥è¿›è¡Œå…³è”ï¼Œæ¯ä¸ªæ¨¡å—æœ‰ç€è‡ªå·±ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°å¯¹æ¨¡å—è¿›è¡ŒåŠ è½½ã€å¸è½½ã€æ›´æ–°ã€‚å¦‚æ­¤çœ‹æ¥ï¼ŒOSGIå¯ä»¥ç”¨ä¸€å¥è¯æè¿°ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ºJavaæä¾›çš„åŠ¨æ€æ¨¡å—åŒ–çš„ç³»ç»Ÿã€‚ä½†æ˜¯OSGIå¤ªè¿‡å¤æ‚ï¼Œå®ç”¨æ€§å¹¶ä¸å¼º</p><p><a href="http://hellojava.info/?p=152" target="_blank" rel="noopener">é˜¿é‡Œæ¶æ„å¸ˆå¯¹OSGIçš„è¯„ä»·</a></p><p>è¿™é‡Œæˆ‘ä¸»è¦æƒ³è¯´çš„æ˜¯æ€ä¹ˆåœ¨ä»£ç ä¸­åˆ©ç”¨ç±»åŠ è½½å™¨æ¥æ£€æµ‹Jar Hell</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JarHell</span> </span>{  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{  </span><br><span class="line">        <span class="keyword">try</span> {  </span><br><span class="line">            Enumeration<url> urls = Thread.currentThread().getContextClassLoader().getResources(<span class="string">"org/apache/log4j/Logger.class"</span>);  </url></span><br><span class="line">            <span class="keyword">while</span>(urls.hasMoreElements()) {  </span><br><span class="line">                URL url = urls.nextElement();  </span><br><span class="line">                System.out.println(url);  </span><br><span class="line">            }  </span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        }  </span><br><span class="line">       </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·å°±å¯ä»¥æ‰¾åˆ°classpathä¸­å†²çªçš„jaråŒ…ï¼Œå½“ç„¶é€šè¿‡ideaçš„å·¥å…·ä¼šæ›´æ–¹ä¾¿ ğŸ˜‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹</p><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-classloader/index.html#code4" target="_blank" rel="noopener">æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨</a></p></s></body></html>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> ClassLoader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆä¸€ï¼‰</title>
      <link href="/2019/08/11/shen-ru-li-jie-java-xu-ni-ji-yi/"/>
      <url>/2019/08/11/shen-ru-li-jie-java-xu-ni-ji-yi/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><p>æœ¬æ–‡åœ¨ <a href="https://cyc2018.github.io/CS-Notes/#/notes/Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA?id=minor-gc-%e5%92%8c-full-gc" target="_blank" rel="noopener">CyCå¤§ä½¬</a> çš„åšå®¢åŸºç¡€ä¹‹ä¸Šåšäº†ä¸€äº›æ‰©å……æ”¹ç¼–ï¼ˆ æ”¹ç¼–ä¸æ˜¯ä¹±ç¼–ï¼Œæˆè¯´ä¸æ˜¯èƒ¡è¯´ï¼Œä»Šå¹´ä¸‹åŠå¹´â€¦â€¦.ğŸµ</p><h2 id="Javaå†…å­˜åŒºåŸŸ"><a href="#Javaå†…å­˜åŒºåŸŸ" class="headerlink" title="Javaå†…å­˜åŒºåŸŸ"></a>Javaå†…å­˜åŒºåŸŸ</h2><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190817/rTyjnrafmg3Q.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h3><ul><li><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹æˆå½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</p></li><li><p>ç¨‹åºè®¡æ•°å™¨ä½äºçº¿ç¨‹ç‹¬å å»</p></li><li><p>å¦‚æœçº¿ç¨‹æ‰§è¡Œçš„æ˜¯Javaæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°é½è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼Œå¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯nativeæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨çš„å€¼ä¸ºundefined</p></li><li><p>æ­¤åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸ </p></li></ul><h3 id="Javaè™šæ‹Ÿæœºæ ˆ"><a href="#Javaè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="Javaè™šæ‹Ÿæœºæ ˆ"></a>Javaè™šæ‹Ÿæœºæ ˆ</h3><p>æ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ä»æ–¹æ³•è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><p><img alt="CyC" data-src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/8442519f-0b4d-48f4-8229-56f984363c69.png" src="/img/loading.gif" class="lazyload"></p><p>å¯ä»¥é€šè¿‡ -Xss è¿™ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šæ¯ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå†…å­˜å¤§å°ï¼Œåœ¨ JDK 1.4 ä¸­é»˜è®¤ä¸º 256Kï¼Œè€Œåœ¨ JDK 1.5+ é»˜è®¤ä¸º 1Mï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">java -Xss2M HackTheJavaCopy to clipboardErrorCopied</span><br></pre></td></tr></tbody></table></figure></div><p>è¯¥åŒºåŸŸå¯èƒ½æŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š</p><ul><li>å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡æœ€å¤§å€¼ï¼Œä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸ï¼›</li><li>æ ˆè¿›è¡ŒåŠ¨æ€æ‰©å±•æ—¶å¦‚æœæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜ï¼Œä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</li></ul><h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><p>æ‰€æœ‰å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼Œæ˜¯åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸï¼ˆâ€GC å †â€ï¼‰ã€‚</p><p>ç°ä»£çš„åƒåœ¾æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå…¶ä¸»è¦çš„æ€æƒ³æ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„å¯¹è±¡é‡‡å–ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚å¯ä»¥å°†å †å¤§è‡´åˆ†æˆä¸¤å—ï¼š</p><ul><li>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</li><li>è€å¹´ä»£ï¼ˆOld Generationï¼‰</li></ul><p>å †ä¸éœ€è¦è¿ç»­å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€å¢åŠ å…¶å†…å­˜ï¼Œå¢åŠ å¤±è´¥ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</p><p>å¯ä»¥é€šè¿‡ -Xms å’Œ -Xmx è¿™ä¸¤ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªç¨‹åºçš„å †å†…å­˜å¤§å°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æœ€å¤§å€¼ã€‚</p><h3 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h3><p>Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å°†å…¶æè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒè¿˜æœ‰ä¸€ä¸ªåˆ«åå°±å«åš<code>éå †</code>ï¼Œè€Œåœ¨HotSpotä¸­åˆ™ç§°ä¹‹ä¸º<code>æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰</code>ã€‚</p><p>è¿™ä¸€å—ä¸»è¦ç”¨äºå­˜æ”¾<strong>å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ï¼ˆç±»çš„ç‰ˆæœ¬ï¼Œå­—æ®µï¼Œæ–¹æ³•ï¼Œæ¥å£ï¼‰</strong>ã€<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ã€<strong>é™æ€å˜é‡</strong>ã€å³æ—¶ç¼–è¯‘å™¨(JIT)ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p><p>å’Œå †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•ï¼ŒåŠ¨æ€æ‰©å±•å¤±è´¥ä¸€æ ·ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</p><p>å¯¹è¿™å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ï¼Œä½†æ˜¯ä¸€èˆ¬æ¯”è¾ƒéš¾å®ç°ã€‚</p><p><code>HotSpot</code> è™šæ‹ŸæœºæŠŠå®ƒå½“æˆæ°¸ä¹…ä»£æ¥è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ä½†å¾ˆéš¾ç¡®å®šæ°¸ä¹…ä»£çš„å¤§å°ï¼Œå› ä¸ºå®ƒå—åˆ°å¾ˆå¤šå› ç´ å½±å“ï¼Œå¹¶ä¸”æ¯æ¬¡ Full GC ä¹‹åæ°¸ä¹…ä»£çš„å¤§å°éƒ½ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ç»å¸¸ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ä¸ºäº†æ›´å®¹æ˜“ç®¡ç†æ–¹æ³•åŒºï¼Œä» JDK 1.8 å¼€å§‹ï¼Œç§»é™¤æ°¸ä¹…ä»£ï¼Œå¹¶æŠŠæ–¹æ³•åŒºç§»è‡³å…ƒç©ºé—´ï¼Œå®ƒä½äºæœ¬åœ°å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚</p><p>æ–¹æ³•åŒºæ˜¯ä¸€ä¸ª JVM è§„èŒƒï¼Œæ°¸ä¹…ä»£ä¸å…ƒç©ºé—´éƒ½æ˜¯å…¶ä¸€ç§å®ç°æ–¹å¼ã€‚åœ¨ JDK 1.8 ä¹‹åï¼ŒåŸæ¥æ°¸ä¹…ä»£çš„æ•°æ®è¢«åˆ†åˆ°äº†å †å’Œå…ƒç©ºé—´ä¸­ã€‚å…ƒç©ºé—´å­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ï¼Œ<strong>é™æ€å˜é‡å’Œå­—ç¬¦ä¸²å¸¸é‡æ± ç­‰è¢«æ”¾å…¥å †ä¸­</strong>ã€‚</p><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œ<strong>Class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± </strong>ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆçš„<strong>å­—é¢é‡</strong>å’Œ<strong>ç¬¦å·å¼•ç”¨</strong>ï¼‰ä¼šåœ¨<strong>ç±»åŠ è½½å</strong>è¢«æ”¾å…¥è¿™ä¸ªåŒºåŸŸ</p><p>é™¤äº†åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„å¸¸é‡ï¼Œè¿˜å…è®¸åŠ¨æ€ç”Ÿæˆï¼Œä¾‹å¦‚ String ç±»çš„ intern()</p><blockquote><p>When the intern method is invoked, if the pool already contains a string equal to this {@code String} object as determined by the {@link #equals(Object)} method, then the string from the pool is returned. Otherwise, this {@code String} object is added to the pool and a reference to this {@code String} object is returned.</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringIntern</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//s1 s2å­˜æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­</span></span><br><span class="line">        <span class="comment">// abc å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­ï¼ˆå­—èŠ‚ç å¸¸é‡ï¼‰</span></span><br><span class="line">        String s1=<span class="string">"abc"</span>;</span><br><span class="line">        String s2=<span class="string">"abc"</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(s1==s2); <span class="comment">//true</span></span><br><span class="line">        <span class="comment">//newå‡ºæ¥çš„ä¸€å®šæ˜¯åœ¨å †å†…å­˜ä¸­</span></span><br><span class="line">        String s3=<span class="keyword">new</span> String(<span class="string">"abc"</span>);</span><br><span class="line">        System.out.println(s1==s3); <span class="comment">//false</span></span><br><span class="line">        <span class="comment">//è¿è¡Œæ—¶å¸¸é‡,internå°†å­—ç¬¦ä¸²æ·»åŠ åˆ°å¸¸é‡æ± ä¸­å¹¶ä¸”è¿”å›ä¸€ä¸ªå¼•ç”¨</span></span><br><span class="line">        System.out.println(s1==s3.intern()); <span class="comment">//true</span></span><br><span class="line">        <span class="comment">//é¢ è¦†è®¤çŸ¥çš„</span></span><br><span class="line">        <span class="comment">//å®é™…ä¸Šè¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸€ä¸ªåœ¨å †ä¸­ï¼Œä¸€ä¸ªåœ¨å¸¸é‡æ± ä¸­</span></span><br><span class="line">        System.out.println(s3==s3.intern()); <span class="comment">//false</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…³äºStringå¸¸é‡æ±  å‚è€ƒå¯ä»¥è¿™ç¯‡ <a href="https://blog.csdn.net/qq_34115899/article/details/86583262" target="_blank" rel="noopener">æ–‡ç« </a></p><p>æˆ–è¿™ä¸€ç¯‡<a href="https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html" target="_blank" rel="noopener">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></p><h3 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h3><p>åœ¨ JDK 1.4 ä¸­æ–°å¼•å…¥äº† NIO ç±»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ Java å †é‡Œçš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨å †å†…å­˜å’Œå †å¤–å†…å­˜æ¥å›æ‹·è´æ•°æ®ã€‚</p><h2 id="å¯¹è±¡åˆ›å»º"><a href="#å¯¹è±¡åˆ›å»º" class="headerlink" title="å¯¹è±¡åˆ›å»º"></a>å¯¹è±¡åˆ›å»º</h2><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190811/JcRnzxY4HN5q.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å‡è®¾Javaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰ç”¨è¿‡çš„å†…å­˜éƒ½æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´é‚£è¾¹æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸º<code>â€œæŒ‡é’ˆç¢°æ’â€</code>ï¼ˆBump the Pointerï¼‰ã€‚å¦‚æœJavaå †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„ï¼Œå·²ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆç¢°æ’äº†ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸º<code>â€œç©ºé—²åˆ—è¡¨â€</code>ï¼ˆFree Listï¼‰ã€‚é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”±<code>Javaå †æ˜¯å¦è§„æ•´</code>å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„<code>åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š</code>ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨Serialã€ParNewç­‰å¸¦Compactè¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨çš„åˆ†é…ç®—æ³•æ˜¯æŒ‡é’ˆç¢°æ’ï¼Œè€Œä½¿ç”¨CMSè¿™ç§åŸºäºMark-Sweepç®—æ³•çš„æ”¶é›†å™¨æ—¶ï¼Œé€šå¸¸é‡‡ç”¨ç©ºé—²åˆ—è¡¨ã€‚</p><h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>åˆ›å»ºå¯¹è±¡çš„æ—¶å€™éœ€è¦ä¿®æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹è¿™å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè™šæ‹Ÿæœºå¯ä»¥é‡‡ç”¨CASåŠ ä¸Šå¤±è´¥é‡è¯•ï¼ˆè‡ªæ—‹ï¼‰çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ï¼Œä½†æ˜¯è¿™æ ·ä¼šå½±å“æ€§èƒ½ï¼Œå¦ä¸€ç§æ˜¯æŠŠå†…å­˜åˆ†é…çš„åŠ¨ä½œæŒ‰ç…§çº¿ç¨‹åˆ’åˆ†åœ¨ä¸åŒçš„ç©ºé—´ä¹‹ä¸­è¿›è¡Œï¼Œå³æ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸º<code>æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²</code>ï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ã€‚å“ªä¸ªçº¿ç¨‹è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨å“ªä¸ªçº¿ç¨‹çš„TLABä¸Šåˆ†é…ï¼Œåªæœ‰TLABç”¨å®Œå¹¶åˆ†é…æ–°çš„FLABæ—¶ï¼Œæ‰éœ€è¦åŒæ­¥é”å®šã€‚è™šæ‹Ÿæœºæ˜¯å¦ä½¿ç”¨TLABï¼Œå¯ä»¥é€šè¿‡-XXï¼š+/-UseTLABå‚æ•°æ¥è®¾å®šã€‚</p><h3 id="å¯¹è±¡ç»“æ„"><a href="#å¯¹è±¡ç»“æ„" class="headerlink" title="å¯¹è±¡ç»“æ„"></a><strong>å¯¹è±¡ç»“æ„</strong></h3><h4 id="Object-Header"><a href="#Object-Header" class="headerlink" title="Object Header"></a>Object Header</h4><p>å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†</p><p><strong>è‡ªèº«è¿è¡Œæ—¶æ•°æ®ï¼ˆMark Wordï¼‰</strong>æ¯”å¦‚ å¯¹è±¡å“ˆå¸Œå€¼ï¼Œå¯¹è±¡åˆ†å¸¦å¹´é¾„ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œçº¿ç¨‹æŒæœ‰çš„é”ï¼Œåå‘çº¿ç¨‹IDï¼Œåå‘æ—¶é—´æˆ³ç­‰ï¼Œå¦ä¸€éƒ¨åˆ†å°±æ˜¯<strong>ç±»å‹æŒ‡é’ˆ</strong></p><h4 id="InstanceData"><a href="#InstanceData" class="headerlink" title="InstanceData"></a>InstanceData</h4><p>å®ä¾‹æ•°æ®ï¼Œæ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­å®šä¹‰çš„å„ä¸ªç±»å‹å­—æ®µçš„å†…å®¹ï¼Œæ— è®ºæ˜¯ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„è¿˜æ˜¯åœ¨ä¹‹ç±»ç§å®šä¹‰çš„ï¼Œéƒ½éœ€è¦è®°å½•ä¸‹æ¥ã€‚</p><h4 id="Padding"><a href="#Padding" class="headerlink" title="Padding"></a><strong>Padding</strong></h4><p>è¿™ä¸€éƒ¨åˆ†å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå…¶å®å°±æ˜¯ç”¨äºå†…å­˜å¯¹é½çš„ï¼ŒHotSpotè‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8ä¸ªå­—èŠ‚çš„æ•´æ•°å€ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8çš„æ•´æ•°å€ï¼Œå¦‚æœä¸å¤Ÿåˆ™éœ€è¦å¡«å……è¿™éƒ¨åˆ†å°±æ˜¯Padding</p><h3 id="HotSpotæºç "><a href="#HotSpotæºç " class="headerlink" title="HotSpotæºç "></a>HotSpotæºç </h3><p>æ‰¾åˆ°äº†openJdkçš„Java8å¯¹åº”çš„åˆ›å»ºå¯¹è±¡çš„<a href="http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/6a0ead6dc6db/src/share/vm/interpreter/bytecodeInterpreter.cpp" target="_blank" rel="noopener">æºç </a>ï¼Œå¤§æ¦‚1966è¡Œå·¦å³</p><h2 id="å †çš„åˆ’åˆ†"><a href="#å †çš„åˆ’åˆ†" class="headerlink" title="å †çš„åˆ’åˆ†"></a>å †çš„åˆ’åˆ†</h2><h3 id="å †ç»“æ„åˆ†ä»£"><a href="#å †ç»“æ„åˆ†ä»£" class="headerlink" title="å †ç»“æ„åˆ†ä»£"></a>å †ç»“æ„åˆ†ä»£</h3><p>Javaè™šæ‹Ÿæœºå°†å †å†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£æ˜¯HotSpotè™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼ˆJDK1.8ä¹‹åä¸ºmetaspaceæ›¿ä»£æ°¸ä¹…ä»£ï¼‰ï¼Œå®ƒé‡‡ç”¨æ°¸ä¹…ä»£çš„æ–¹å¼æ¥å®ç°æ–¹æ³•åŒºï¼Œå…¶ä»–çš„è™šæ‹Ÿæœºå®ç°æ²¡æœ‰è¿™ä¸€æ¦‚å¿µï¼Œè€Œä¸”HotSpotä¹Ÿæœ‰å–æ¶ˆæ°¸ä¹…ä»£çš„è¶‹åŠ¿ï¼Œåœ¨JDK 1.7ä¸­HotSpotå·²ç»å¼€å§‹äº†â€œå»æ°¸ä¹…åŒ–â€ï¼ŒæŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ç§»å‡ºã€‚æ°¸ä¹…ä»£ä¸»è¦å­˜æ”¾å¸¸é‡ã€ç±»ä¿¡æ¯ã€é™æ€å˜é‡ç­‰æ•°æ®ï¼Œä¸åƒåœ¾å›æ”¶å…³ç³»ä¸å¤§ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£æ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚</p><p><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</strong></p><p>æ–°ç”Ÿæˆçš„å¯¹è±¡ä¼˜å…ˆå­˜æ”¾åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ–°ç”Ÿä»£å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œå­˜æ´»ç‡å¾ˆä½ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ï¼Œå¸¸è§„åº”ç”¨è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†ä¸€èˆ¬å¯ä»¥å›æ”¶70% ~ 95% çš„ç©ºé—´ï¼Œå›æ”¶æ•ˆç‡å¾ˆé«˜ã€‚</p><p><strong>è€å¹´ä»£ï¼ˆOld Generationnï¼‰</strong></p><p>åœ¨æ–°ç”Ÿä»£ä¸­ç»å†äº†å¤šæ¬¡ï¼ˆå…·ä½“çœ‹è™šæ‹Ÿæœºé…ç½®çš„é˜€å€¼ï¼‰GCåä»ç„¶å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ä¸­ã€‚è€å¹´ä»£ä¸­çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œå­˜æ´»ç‡æ¯”è¾ƒé«˜ï¼Œåœ¨è€å¹´ä»£ä¸­è¿›è¡ŒGCçš„é¢‘ç‡ç›¸å¯¹è€Œè¨€è¾ƒä½ï¼Œè€Œä¸”å›æ”¶çš„é€Ÿåº¦ä¹Ÿæ¯”è¾ƒæ…¢ã€‚</p><p><strong>æ°¸ä¹…ä»£ï¼ˆPermanent Generationnï¼‰</strong></p><p>æ°¸ä¹…ä»£å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼Œå¯¹è¿™ä¸€åŒºåŸŸè€Œè¨€ï¼ŒJavaè™šæ‹Ÿæœºè§„èŒƒæŒ‡å‡ºå¯ä»¥ä¸è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œä¸€èˆ¬è€Œè¨€ä¸ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><h3 id="å †ç»“æ„åˆ†ä»£çš„æ„ä¹‰"><a href="#å †ç»“æ„åˆ†ä»£çš„æ„ä¹‰" class="headerlink" title="å †ç»“æ„åˆ†ä»£çš„æ„ä¹‰"></a>å †ç»“æ„åˆ†ä»£çš„æ„ä¹‰</h3><p>ã€€ã€€Javaè™šæ‹Ÿæœºæ ¹æ®å¯¹è±¡å­˜æ´»çš„å‘¨æœŸä¸åŒï¼ŒæŠŠå †å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ï¼ˆ<code>å¯¹HotSpotè™šæ‹Ÿæœºè€Œè¨€</code>ï¼‰ï¼Œè¿™å°±æ˜¯JVMçš„å†…å­˜åˆ†ä»£ç­–ç•¥ã€‚<br>ã€€ã€€å †å†…å­˜æ˜¯è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œä¹Ÿæ˜¯<code>åƒåœ¾å›æ”¶æœ€é¢‘ç¹</code>çš„ä¸€å—åŒºåŸŸï¼Œæˆ‘ä»¬ç¨‹åºæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½å­˜æ”¾åœ¨å †å†…å­˜ä¸­ã€‚ç»™å †å†…å­˜åˆ†ä»£æ˜¯ä¸ºäº†æé«˜å¯¹è±¡å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå †å†…å­˜æ²¡æœ‰åŒºåŸŸåˆ’åˆ†ï¼Œæ‰€æœ‰çš„æ–°åˆ›å»ºçš„å¯¹è±¡å’Œç”Ÿå‘½å‘¨æœŸå¾ˆé•¿çš„å¯¹è±¡æ”¾åœ¨ä¸€èµ·ï¼Œéšç€ç¨‹åºçš„æ‰§è¡Œï¼Œå †å†…å­˜éœ€è¦é¢‘ç¹è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œè€Œæ¯æ¬¡å›æ”¶éƒ½è¦éå†æ‰€æœ‰çš„å¯¹è±¡ï¼Œéå†è¿™äº›å¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ä»£ä»·æ˜¯å·¨å¤§çš„ï¼Œä¼šä¸¥é‡å½±å“æˆ‘ä»¬çš„GCæ•ˆç‡ã€‚<br>ã€€ã€€æœ‰äº†å†…å­˜åˆ†ä»£ï¼Œæƒ…å†µå°±ä¸åŒäº†ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡ä¼šåœ¨æ–°ç”Ÿä»£ä¸­åˆ†é…å†…å­˜ï¼Œç»è¿‡å¤šæ¬¡å›æ”¶ä»ç„¶å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å­˜æ”¾åœ¨<code>è€å¹´ä»£</code>ä¸­ï¼Œé™æ€å±æ€§ã€ç±»ä¿¡æ¯ç­‰å­˜æ”¾åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡å­˜æ´»æ—¶é—´çŸ­ï¼Œåªéœ€è¦åœ¨æ–°ç”Ÿä»£åŒºåŸŸä¸­é¢‘ç¹è¿›è¡ŒGCï¼Œè€å¹´ä»£ä¸­å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå†…å­˜å›æ”¶çš„é¢‘ç‡ç›¸å¯¹è¾ƒä½ï¼Œä¸éœ€è¦é¢‘ç¹è¿›è¡Œå›æ”¶ï¼Œæ°¸ä¹…ä»£ä¸­å›æ”¶æ•ˆæœå¤ªå·®ï¼Œä¸€èˆ¬ä¸è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿˜å¯ä»¥æ ¹æ®ä¸åŒå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚åˆ†ä»£æ”¶é›†å¤§å¤§æå‡äº†æ”¶é›†æ•ˆç‡ï¼Œè¿™äº›éƒ½æ˜¯å†…å­˜åˆ†ä»£å¸¦æ¥çš„å¥½å¤„ã€‚</p><h2 id="åƒåœ¾æ”¶é›†"><a href="#åƒåœ¾æ”¶é›†" class="headerlink" title="åƒåœ¾æ”¶é›†"></a>åƒåœ¾æ”¶é›†</h2><p>åƒåœ¾æ”¶é›†ä¸»è¦æ˜¯é’ˆå¯¹<code>å †å’Œæ–¹æ³•åŒº</code>è¿›è¡Œã€‚ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆè¿™ä¸‰ä¸ªåŒºåŸŸå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œåªå­˜åœ¨äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçº¿ç¨‹ç»“æŸä¹‹åå°±ä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä¸éœ€è¦å¯¹è¿™ä¸‰ä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><h3 id="åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶"><a href="#åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶"></a>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶</h3><p>åœ¨å †ä¸­å­˜æ”¾ç€Javaä¸–ç•Œä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶çš„æ—¶å€™ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­é‚£äº›è¿˜â€œæ´»ç€â€ï¼Œé‚£äº›å·²ç»â€œæ­»å»â€ï¼ˆä¸ä¼šå†è¢«ä½¿ç”¨ï¼‰</p><h4 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a><strong>å¼•ç”¨è®¡æ•°æ³•</strong></h4><p>ç»™å¯¹è±¡åŠ ä¸Šä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒçš„æ—¶å€™ï¼Œè®¡æ•°å™¨å€¼å°±åŠ 1ï¼Œå¼•ç”¨å¤±æ•ˆçš„æ—¶å€™å°±å‡ä¸€ï¼Œè®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p><p>ä½†æ˜¯åœ¨ä¸»æµçš„Javaè™šæ‹Ÿæœºä¸­éƒ½æ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨æ¥è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œä¸»è¦çš„åŸå› å°±æ˜¯å®ƒå¾ˆéš¾è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> Object instance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Test a = <span class="keyword">new</span> Test();</span><br><span class="line">        Test b = <span class="keyword">new</span> Test();</span><br><span class="line">        a.instance = b;</span><br><span class="line">        b.instance = a;</span><br><span class="line">        a = <span class="keyword">null</span>;</span><br><span class="line">        b = <span class="keyword">null</span>;</span><br><span class="line">        doSomething();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸Šé¢çš„ä»£ç ä¸­ <code>Test a</code>  å’Œ<code>Test b</code> äº’ç›¸å¼•ç”¨ï¼Œåœ¨åç»­å°†ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨èµ‹ä¸ºnullåä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ä»ç„¶ä¸ä¸º0ï¼Œå¯¼è‡´æ— æ³•å›æ”¶è¿™ä¸¤ä¸ªå¯¹è±¡ã€‚</p><h4 id="å¯è¾¾æ€§åˆ†ææ³•"><a href="#å¯è¾¾æ€§åˆ†ææ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†ææ³•"></a><strong>å¯è¾¾æ€§åˆ†ææ³•</strong></h4><p>ä»¥ <code>GC Roots</code> ä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œå¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºä½¿ç”¨è¯¥ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶ã€‚</p><p>Javaè¯­è¨€ä¸­å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡åŒ…æ‹¬ä¸‹é¢å‡ ç§</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><h4 id="OopMapï¼Œå®‰å…¨ç‚¹ï¼Œå®‰å…¨åŒº"><a href="#OopMapï¼Œå®‰å…¨ç‚¹ï¼Œå®‰å…¨åŒº" class="headerlink" title="OopMapï¼Œå®‰å…¨ç‚¹ï¼Œå®‰å…¨åŒº"></a>OopMapï¼Œå®‰å…¨ç‚¹ï¼Œå®‰å…¨åŒº</h4><p>é‡‡ç”¨å¯è¾¾æ€§åˆ†ææ³•é¦–å…ˆå°±æ‰¾æ‰¾åˆ°é‚£äº›æ˜¯<code>GC Root</code>ï¼Œç›®å‰ä¸»è¦æœ‰ä¸¤ç§æŸ¥æ‰¾ GC Roots çš„æ–¹æ³•ï¼š</p><p>ğŸ’¡<strong>ä¿å®ˆå¼ GC</strong>ï¼šéå†æ–¹æ³•åŒºå’Œæ ˆåŒºæŸ¥æ‰¾ï¼Œæ— æ³•ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œé™¤éé‡‡ç”¨<code>å¥æŸ„è®¿é—®å¯¹è±¡çš„æ–¹å¼</code>ä½†æ•ˆç‡ä¸é«˜ï¼Œæ— æ³•å‡†ç¡®åŒºåˆ†æ˜¯ä¸æ˜¯å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ç±»å‹çš„å˜é‡</p><p>ğŸ’¡<strong>å‡†ç¡®å¼ GC</strong>ï¼šä¸ä¿å®ˆå¼GCç›¸å¯¹çš„å°±æ˜¯å‡†ç¡®å¼GCï¼Œå°±æ˜¯æˆ‘ä»¬å‡†ç¡®çš„çŸ¥é“ï¼ŒæŸä¸ªä½ç½®ä¸Šé¢æ˜¯å¦æ˜¯æŒ‡é’ˆï¼Œå¯¹äºjavaæ¥è¯´ï¼Œå°±æ˜¯çŸ¥é“å¯¹äºæŸä¸ªä½ç½®ä¸Šçš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å‡ºæ‰€æœ‰çš„ä½ç½®ä¸Šçš„æ•°æ®æ˜¯ä¸æ˜¯æŒ‡å‘GCå †çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬æ ˆå’Œå¯„å­˜å™¨é‡Œçš„æ•°æ®ã€‚HotSpotåˆ™æ˜¯é€šè¿‡ <code>OopMap</code> æ•°æ®ç»“æ„æ¥è®°å½•åœ¨å¯¹è±¡å†…çš„ä»€ä¹ˆåç§»é‡ä¸Šæ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®</p><p>å¾ˆæ˜æ˜¾ï¼Œä¿å®ˆå¼ GC çš„æˆæœ¬å¤ªé«˜ã€‚å‡†ç¡®å¼ GC çš„ä¼˜ç‚¹å°±æ˜¯èƒ½å¤Ÿè®©è™šæ‹Ÿæœºå¿«é€Ÿå®šä½åˆ° GC Rootsã€‚</p><p>å¯¹åº” <code>OopMap</code> çš„ä½ç½®å³å¯ä½œä¸ºä¸€ä¸ª<code>Safe Point</code>ï¼ˆå®‰å…¨ç‚¹ï¼‰ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯å®‰å…¨ç‚¹ï¼Ÿ</strong></p><p>OopMapçš„ä½œç”¨æ˜¯ä¸ºäº†åœ¨GCçš„æ—¶å€™ï¼Œå¿«é€Ÿè¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰€ä»¥OopMapå¹¶ä¸éœ€è¦ä¸€å‘ç”Ÿæ”¹å˜å°±å»æ›´æ–°è¿™ä¸ªæ˜ å°„è¡¨ã€‚åªè¦è¿™ä¸ª<code>æ›´æ–°åœ¨GCå‘ç”Ÿä¹‹å‰</code>å°±å¯ä»¥äº†ã€‚æ‰€ä»¥OopMapåªéœ€è¦åœ¨é¢„å…ˆé€‰å®šçš„ä¸€äº›ä½ç½®ä¸Šè®°å½•å˜åŒ–çš„OopMapå°±è¡Œäº†ã€‚è¿™äº›ç‰¹å®šçš„ç‚¹å°±æ˜¯<code>SafePoint</code>ï¼ˆå®‰å…¨ç‚¹ï¼‰ã€‚ç”±æ­¤ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œç¨‹åºå¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„ä½ç½®ä¸Šéƒ½å¯ä»¥è¿›è¡ŒGCçš„ï¼Œåªæœ‰åœ¨è¾¾åˆ°è¿™æ ·çš„å®‰å…¨ç‚¹æ‰èƒ½æš‚åœä¸‹æ¥è¿›è¡ŒGCã€‚</p><p><strong>å®‰å…¨ç‚¹çš„é€‰å–</strong></p><p>åœ¨æ‰§è¡Œ GC æ“ä½œæ—¶ï¼Œæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹å¿…é¡»åœé¡¿ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<code>"Stop-The-World"</code>ï¼Œå› ä¸ºå¯è¾¾æ€§åˆ†æç®—æ³•å¿…é¡»æ˜¯åœ¨ä¸€ä¸ªç¡®ä¿ä¸€è‡´æ€§çš„å†…å­˜å¿«ç…§ä¸­è¿›è¡Œã€‚å¦‚æœåœ¨åˆ†æçš„è¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ†æç»“æœçš„å‡†ç¡®æ€§å°±ä¸èƒ½ä¿è¯ã€‚</p><p>å®‰å…¨ç‚¹æ„å‘³ç€åœ¨è¿™ä¸ªç‚¹æ—¶ï¼Œæ‰€æœ‰<code>å·¥ä½œçº¿ç¨‹çš„çŠ¶æ€æ˜¯ç¡®å®š</code>çš„ï¼ŒJVM å°±å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œ GC ã€‚</p><p>å®‰å…¨ç‚¹çš„é€‰å–ä¸€èˆ¬åœ¨ä»¥ä¸‹å‡ ä¸ªä½ç½®ï¼Œé¿å…ç¨‹åºè¿‡é•¿æ—¶é—´æ‰§è¡Œã€‚</p><ul><li><p>å¾ªç¯çš„æœ«å°¾</p></li><li><p>æ–¹æ³•ä¸´è¿”å›å‰</p></li><li><p>è°ƒç”¨æ–¹æ³•ä¹‹å</p></li><li><p>æŠ›å¼‚å¸¸çš„ä½ç½®</p></li></ul><p><strong>å®‰å…¨åŒº</strong></p><p>â€‹    å®‰å…¨ç‚¹çš„ä½¿ç”¨ä¼¼ä¹è§£å†³äº†OopMapè®¡ç®—çš„æ•ˆç‡çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å®‰å…¨ç‚¹éœ€è¦ç¨‹åºè‡ªå·±è·‘è¿‡å»ï¼Œé‚£ä¹ˆå¯¹äºé‚£äº›å·²ç»åœåœ¨è·¯è¾¹ä¼‘æ¯æˆ–è€…çœ‹é£æ™¯çš„ç¨‹åºï¼ˆæ¯”å¦‚é‚£äº›å¤„åœ¨Sleepæˆ–è€…BlockedçŠ¶æ€çš„çº¿ç¨‹ï¼‰ï¼Œä»–ä»¬å¯èƒ½å¹¶ä¸ä¼šåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è·‘åˆ°å®‰å…¨ç‚¹å»ã€‚æ‰€ä»¥è¿™é‡Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆå¼•å…¥äº†å®‰å…¨åŒºåŸŸçš„æ¦‚å¿µã€‚</p><p>â€‹    å®‰å…¨åŒºåŸŸå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨ç¨‹åºçš„ä¸€æ®µä»£ç ç‰‡æ®µä¸­å¹¶<code>ä¸ä¼šå¯¼è‡´å¼•ç”¨å…³ç³»å‘ç”Ÿå˜åŒ–</code>ï¼Œä¹Ÿå°±ä¸ç”¨å»æ›´æ–°OopMapè¡¨äº†ï¼Œé‚£ä¹ˆåœ¨è¿™æ®µä»£ç åŒºåŸŸå†…ä»»ä½•åœ°æ–¹è¿›è¡ŒGCéƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è¿™æ®µåŒºåŸŸå°±ç§°ä¹‹ä¸ºå®‰å…¨åŒºåŸŸã€‚çº¿ç¨‹æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿›å…¥åˆ°å®‰å…¨åŒºåŸŸå†…ï¼Œå°±ä¼šæ ‡å¿—è‡ªå·±å·²ç»è¿›è¡Œåˆ°å®‰å…¨åŒºåŸŸäº†ã€‚é‚£ä¹ˆè™šæ‹Ÿæœºè¦è¿›è¡ŒGCçš„æ—¶å€™ï¼Œå‘ç°è¯¥çº¿ç¨‹å·²ç»è¿è¡Œåˆ°å®‰å…¨åŒºåŸŸï¼Œå°±ä¸ä¼šç®¡è¯¥çº¿ç¨‹çš„æ­»æ´»äº†ã€‚æ‰€ä»¥ï¼Œè¯¥çº¿ç¨‹åœ¨è„±ç¦»å®‰å…¨åŒºåŸŸçš„æ—¶å€™ï¼Œè¦<code>è‡ªå·±æ£€æŸ¥</code>ç³»ç»Ÿæ˜¯å¦å·²ç»å®Œæˆäº†GCæˆ–è€…æ ¹èŠ‚ç‚¹æšä¸¾ï¼ˆè¿™ä¸ªè·ŸGCçš„ç®—æ³•æœ‰å…³ç³»ï¼‰ï¼Œå¦‚æœå®Œæˆäº†å°±ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæœªå®Œæˆï¼Œå®ƒå°±å¿…é¡»ç­‰å¾…æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€å®‰å…¨åŒºåŸŸçš„Safe Regionçš„ä¿¡å·ä¸ºæ­¢ã€‚</p><p><strong>ä¸­æ–­æ–¹å¼</strong></p><p>åœ¨ç¨‹åºéœ€è¦GCçš„æ—¶å€™æ€ä¹ˆè®©æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾å®‰å…¨ç‚¹ä¸­æ–­ç„¶åè¿›è¡ŒGC ?</p><ul><li><p>æŠ¢æ–­å¼ä¸­æ–­ï¼šæŠ¢æ–­å¼ä¸­æ–­å°±æ˜¯åœ¨GCçš„æ—¶å€™ï¼Œè®©æ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¸­æ–­ï¼Œå¦‚æœè¿™äº›çº¿ç¨‹ä¸­å‘ç°ä¸­æ–­åœ°æ–¹ä¸åœ¨å®‰å…¨ç‚¹ä¸Šçš„ï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©ä»–ä»¬é‡æ–°è·‘èµ·æ¥ï¼Œç›´åˆ°è·‘åˆ°å®‰å…¨ç‚¹ä¸Šã€‚ï¼ˆç°åœ¨å‡ ä¹æ²¡æœ‰è™šæ‹Ÿæœºé‡‡ç”¨è¿™ç§æ–¹å¼ï¼‰</p></li><li><p>ä¸»åŠ¨å¼ä¸­æ–­ï¼šä¸»åŠ¨å¼ä¸­æ–­åœ¨GCçš„æ—¶å€™ï¼Œä¸ä¼šä¸»åŠ¨å»ä¸­æ–­çº¿ç¨‹ï¼Œä»…ä»…æ˜¯è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå½“ç¨‹åºè¿è¡Œåˆ°å®‰å…¨ç‚¹æ—¶å°±å»è½®è®­è¯¥ä½ç½®ï¼Œå‘ç°è¯¥ä½ç½®è¢«è®¾ç½®ä¸ºçœŸæ—¶å°±è‡ªå·±ä¸­æ–­æŒ‚èµ·ã€‚æ‰€ä»¥è½®è®­æ ‡å¿—çš„åœ°æ–¹æ˜¯å’Œå®‰å…¨ç‚¹é‡åˆçš„ï¼Œå¦å¤–åˆ›å»ºå¯¹è±¡éœ€è¦åˆ†é…å†…å­˜çš„åœ°æ–¹ä¹Ÿéœ€è¦è½®è¯¢è¯¥ä½ç½®ã€‚</p></li></ul><h4 id="æ–¹æ³•åŒºçš„å›æ”¶"><a href="#æ–¹æ³•åŒºçš„å›æ”¶" class="headerlink" title="æ–¹æ³•åŒºçš„å›æ”¶"></a>æ–¹æ³•åŒºçš„å›æ”¶</h4><p>æ–¹æ³•åŒºï¼ˆHotSpotä¸­çš„æ°¸ä¹…ä»£ï¼‰ï¼Œåœ¨Javaè§„èŒƒä¸­å¹¶æ²¡æœ‰è¦æ±‚è™šæ‹Ÿæœºå¯¹è¯¥åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™ä¸ªåŒºåŸŸçš„åƒåœ¾å›æ”¶æ•ˆç‡è¦è¿œä½äºåœ¨<code>å †ä¸­</code> </p><p>å›æ”¶çš„ä¸»è¦å¯¹è±¡ï¼š</p><ul><li>åºŸå¼ƒå¸¸é‡</li><li>æ— ç”¨çš„ç±»(Classå¯¹è±¡)</li></ul><p>åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯åºŸå¼ƒå¸¸é‡ï¼Œåªè¦æ²¡æœ‰ä»»ä½•å¯¹è±¡å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡ï¼Œè¯¥å¸¸é‡å°±å¯ä»¥å›æ”¶ã€‚</p><p>åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯ä¸æ˜¯æ— ç”¨çš„ç±»æ¡ä»¶åˆ™æ¯”è¾ƒè‹›åˆ»ã€‚</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œæ­¤æ—¶å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„ Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•ã€‚</li></ul><p>æ»¡è¶³äº†ä¸Šè¿°æ¡ä»¶è™šæ‹Ÿæœºæ‰<strong>å¯ä»¥</strong> å¯¹å…¶è¿›è¡Œå›æ”¶ï¼Œä½†æ˜¯è¿™ä¹Ÿå¹¶ä¸æ˜¯å¿…ç„¶çš„ã€‚</p><h4 id="Finalize"><a href="#Finalize" class="headerlink" title="Finalize()"></a>Finalize()</h4><p>è¿™ä¸ªæ–¹æ³•å¿˜äº†å°±å¥½ğŸ˜</p><p>å½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœé‡å†™è¯¥å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚è‡ªæ•‘åªèƒ½è¿›è¡Œä¸€æ¬¡ï¼Œå¦‚æœå›æ”¶çš„å¯¹è±¡ä¹‹å‰è°ƒç”¨äº† finalize() æ–¹æ³•è‡ªæ•‘ï¼Œåé¢å›æ”¶æ—¶ä¸ä¼šå†è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><h3 id="å¼•ç”¨ç±»å‹"><a href="#å¼•ç”¨ç±»å‹" class="headerlink" title="å¼•ç”¨ç±»å‹"></a>å¼•ç”¨ç±»å‹</h3><p>æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶éƒ½ä¸å¼•ç”¨æœ‰å…³ã€‚</p><p>Java æä¾›äº†å››ç§å¼ºåº¦ä¸åŒçš„å¼•ç”¨ç±»å‹ã€‚</p><h4 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h4><p>è¢«å¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ã€‚</p><p>ä½¿ç”¨ new ä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºå¼ºå¼•ç”¨ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();Copy to clipboardErrorCopied</span><br></pre></td></tr></tbody></table></figure></div><h4 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h4><p>è¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶ã€‚</p><p>ä½¿ç”¨ SoftReference ç±»æ¥åˆ›å»ºè½¯å¼•ç”¨ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">SoftReference<object> sf = <span class="keyword">new</span> SoftReference<object>(obj);<br><span class="line">obj = <span class="keyword">null</span>;  <span class="comment">// ä½¿å¯¹è±¡åªè¢«è½¯å¼•ç”¨å…³è”Copy to clipboardErrorCopied</span></span><br></object></object></span></pre></td></tr></tbody></table></figure></div><h4 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h4><p>è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰ã€‚</p><p>ä½¿ç”¨ WeakReference ç±»æ¥åˆ›å»ºå¼±å¼•ç”¨ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">WeakReference<object> wf = <span class="keyword">new</span> WeakReference<object>(obj);<br><span class="line">obj = <span class="keyword">null</span>;Copy to clipboardErrorCopied</span><br></object></object></span></pre></td></tr></tbody></table></figure></div><h4 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a>è™šå¼•ç”¨</h4><p>åˆç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´é€ æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„å”¯ä¸€ç›®çš„æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p><p>ä½¿ç”¨ PhantomReference æ¥åˆ›å»ºè™šå¼•ç”¨ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">PhantomReference<object> pf = <span class="keyword">new</span> PhantomReference<object>(obj, <span class="keyword">null</span>);<br><span class="line">obj = <span class="keyword">null</span>;</span><br></object></object></span></pre></td></tr></tbody></table></figure></div><h3 id="åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="åƒåœ¾æ”¶é›†ç®—æ³•"></a>åƒåœ¾æ”¶é›†ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®° - æ¸…é™¤ç®—æ³•"></a>æ ‡è®° - æ¸…é™¤ç®—æ³•</h4><p><img alt="CyC" data-src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/005b481b-502b-4e3f-985d-d043c2b330aa.png" src="/img/loading.gif" class="lazyload"></p><p>åœ¨æ ‡è®°é˜¶æ®µï¼Œç¨‹åºä¼šæ£€æŸ¥æ¯ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œå¦‚æœæ˜¯æ´»åŠ¨å¯¹è±¡ï¼Œåˆ™ç¨‹åºä¼šåœ¨å¯¹è±¡å¤´éƒ¨æ‰“ä¸Šæ ‡è®°ã€‚</p><p>åœ¨æ¸…é™¤é˜¶æ®µï¼Œä¼šéå†æ•´ä¸ªå †è¿›è¡Œå¯¹è±¡å›æ”¶å¹¶å–æ¶ˆæ ‡å¿—ä½ï¼Œå¦å¤–ï¼Œè¿˜ä¼šåˆ¤æ–­å›æ”¶åçš„åˆ†å—ä¸å‰ä¸€ä¸ªç©ºé—²åˆ†å—æ˜¯å¦è¿ç»­ï¼Œè‹¥è¿ç»­ï¼Œä¼šåˆå¹¶è¿™ä¸¤ä¸ªåˆ†å—ã€‚å›æ”¶å¯¹è±¡å°±æ˜¯æŠŠå¯¹è±¡ä½œä¸ºåˆ†å—ï¼Œè¿æ¥åˆ°è¢«ç§°ä¸º <code>â€œç©ºé—²é“¾è¡¨â€</code> çš„å•å‘é“¾è¡¨ï¼Œä¹‹åè¿›è¡Œåˆ†é…æ—¶åªéœ€è¦éå†è¿™ä¸ªç©ºé—²é“¾è¡¨ï¼Œå°±å¯ä»¥æ‰¾åˆ°åˆ†å—ã€‚</p><p>åœ¨åˆ†é…æ—¶ï¼Œç¨‹åºä¼šæœç´¢ç©ºé—²é“¾è¡¨å¯»æ‰¾ç©ºé—´å¤§äºç­‰äºæ–°å¯¹è±¡å¤§å° size çš„å— blockã€‚å¦‚æœå®ƒæ‰¾åˆ°çš„å—ç­‰äº sizeï¼Œä¼šç›´æ¥è¿”å›è¿™ä¸ªåˆ†å—ï¼›å¦‚æœæ‰¾åˆ°çš„å—å¤§äº sizeï¼Œä¼šå°†å—åˆ†å‰²æˆå¤§å°ä¸º size ä¸ (block - size) çš„ä¸¤éƒ¨åˆ†ï¼Œè¿”å›å¤§å°ä¸º size çš„åˆ†å—ï¼Œå¹¶æŠŠå¤§å°ä¸º (block - size) çš„å—è¿”å›ç»™ç©ºé—²é“¾è¡¨ã€‚</p><p>è¯¦ç»†å¯ä»¥å‚è€ƒ <a href="http://www.ituring.com.cn/book/tupubarticle/10955" target="_blank" rel="noopener">åƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°</a></p><h4 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h4><p><img alt="CyC" data-src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/b2b77b9e-958c-4016-8ae5-9c6edd83871e.png" src="/img/loading.gif" class="lazyload"></p><p>å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´è¿›è¡Œä¸€æ¬¡æ¸…ç†ã€‚</p><p>ä¸»è¦ä¸è¶³æ˜¯<code>åªä½¿ç”¨äº†å†…å­˜çš„ä¸€åŠ</code>ã€‚</p><p>ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯ä¸€å—<code>è¾ƒå¤§çš„ Eden</code> ç©ºé—´å’Œ<code>ä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´</code>ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivorã€‚åœ¨å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å— Survivor ä¸Šï¼Œ<code>æœ€åæ¸…ç† Eden å’Œä½¿ç”¨è¿‡çš„é‚£ä¸€å— Survivorã€‚</code></p><p>HotSpot è™šæ‹Ÿæœºçš„ Eden å’Œ Survivor å¤§å°æ¯”ä¾‹é»˜è®¤ä¸º 8:1ï¼Œä¿è¯äº†å†…å­˜çš„åˆ©ç”¨ç‡è¾¾åˆ° 90%ã€‚å¦‚æœæ¯æ¬¡å›æ”¶æœ‰å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œé‚£ä¹ˆä¸€å— Survivor å°±ä¸å¤Ÿç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦<code>ä¾èµ–äºè€å¹´ä»£è¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿</code>ï¼Œä¹Ÿå°±æ˜¯å€Ÿç”¨è€å¹´ä»£çš„ç©ºé—´å­˜å‚¨æ”¾ä¸ä¸‹çš„å¯¹è±¡ã€‚</p><h4 id="æ ‡è®°-æ•´ç†"><a href="#æ ‡è®°-æ•´ç†" class="headerlink" title="æ ‡è®° - æ•´ç†"></a>æ ‡è®° - æ•´ç†</h4><p>å¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜çš„æ—¶å€™å°±è¦è¿›è¡Œå¾ˆå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šå˜ä½ï¼Œè€å¹´ä»£ä¹Ÿæ²¡æœ‰é¢å¤–çš„ç©ºé—´åšæ‹…ä¿ï¼Œæ‰€ä»¥è€å¹´ä»£ä¸€èˆ¬ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ç§ç®—æ³•ã€‚</p><p><img alt="CyC" data-src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ccd773a5-ad38-4022-895c-7ac318f31437.png" src="/img/loading.gif" class="lazyload"></p><p>è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><ul><li><p>ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p></li><li><p>éœ€è¦ç§»åŠ¨å¤§é‡å¯¹è±¡ï¼Œå¤„ç†æ•ˆç‡æ¯”è¾ƒä½ã€‚</p></li></ul><h4 id="åˆ†ä»£æ”¶é›†"><a href="#åˆ†ä»£æ”¶é›†" class="headerlink" title="åˆ†ä»£æ”¶é›†"></a>åˆ†ä»£æ”¶é›†</h4><p>åˆ†ä»£æ”¶é›†é¡¾åæ€ä¹‰å°±æ˜¯åˆ†ä»£æ¥æ”¶é›†ï¼Œé’ˆå¯¹ä¸åŒçš„ä»£æ‰§è¡Œä¸åŒçš„æ”¶é›†ç®—æ³•ã€‚</p><p>ä¸€èˆ¬å°†å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚</p><ul><li>æ–°ç”Ÿä»£ä½¿ç”¨ï¼šå°‘é‡å­˜æ´»å¯¹è±¡ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•åªéœ€è¦ä»˜å‡ºå°‘é‡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚</li><li>è€å¹´ä»£ä½¿ç”¨ï¼šå­˜æ´»ç‡é«˜æ²¡æœ‰æ‹…ä¿ï¼Œé‡‡ç”¨æ ‡è®° - æ¸…é™¤ æˆ–è€… æ ‡è®° - æ•´ç† ç®—æ³•ï¼Œ</li></ul><h3 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h3><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190813/3f2uQGV4SjI4.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä»¥ä¸Šæ˜¯ HotSpot è™šæ‹Ÿæœºä¸­çš„ 7 ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¿çº¿è¡¨ç¤ºåƒåœ¾æ”¶é›†å™¨å¯ä»¥é…åˆä½¿ç”¨ã€‚</p><h4 id="Serialæ”¶é›†å™¨"><a href="#Serialæ”¶é›†å™¨" class="headerlink" title="Serialæ”¶é›†å™¨"></a>Serialæ”¶é›†å™¨</h4><p><strong>Serialï¼ˆä¸²è¡Œï¼‰</strong>æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ï¼Œå®ƒæ˜¯é‡‡ç”¨<code>å¤åˆ¶ç®—æ³•</code>çš„<code>æ–°ç”Ÿä»£æ”¶é›†å™¨</code>ï¼Œæ›¾ç»ï¼ˆJDK 1.3.1ä¹‹å‰ï¼‰æ˜¯è™šæ‹Ÿæœº<code>æ–°ç”Ÿä»£</code>æ”¶é›†çš„å”¯ä¸€é€‰æ‹©ã€‚å®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œåªä¼šä½¿ç”¨ä¸€ä¸ªCPUæˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯<strong>å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´è‡³Serialæ”¶é›†å™¨æ”¶é›†ç»“æŸä¸ºæ­¢ï¼ˆâ€œStop The Worldâ€ï¼‰</strong>ã€‚è¿™é¡¹å·¥ä½œæ˜¯ç”±è™šæ‹Ÿæœºåœ¨åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆçš„ï¼Œåœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹æŠŠç”¨æˆ·æ­£å¸¸å·¥ä½œçš„çº¿ç¨‹å…¨éƒ¨åœæ‰ï¼Œè¿™å¯¹å¾ˆå¤šåº”ç”¨æ¥è¯´æ˜¯éš¾ä»¥æ¥æ”¶çš„ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†Serial æ”¶é›†å™¨ï¼ˆè€å¹´ä»£é‡‡ç”¨Serial Oldæ”¶é›†å™¨ï¼‰çš„è¿è¡Œè¿‡ç¨‹ï¼š</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190813/03PTqvGk6jdy.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä¸ºäº†æ¶ˆé™¤æˆ–å‡å°‘å·¥ä½œçº¿ç¨‹å› å†…å­˜å›æ”¶è€Œå¯¼è‡´çš„åœé¡¿ï¼ŒHotSpotè™šæ‹Ÿæœºå¼€å‘å›¢é˜Ÿåœ¨JDK 1.3ä¹‹åçš„Javaå‘å±•å†ç¨‹ä¸­ç ”å‘å‡ºäº†å„ç§å…¶ä»–çš„ä¼˜ç§€æ”¶é›†å™¨ï¼Œè¿™äº›å°†åœ¨ç¨åä»‹ç»ã€‚ä½†æ˜¯è¿™äº›æ”¶é›†å™¨çš„è¯ç”Ÿå¹¶ä¸æ„å‘³ç€Serialæ”¶é›†å™¨å·²ç»â€œè€è€Œæ— ç”¨â€ï¼Œå®é™…ä¸Šåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå®ƒä¾ç„¶æ˜¯<strong>HotSpotè™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„é»˜è®¤çš„æ–°ç”Ÿä»£æ”¶é›†å™¨</strong>ã€‚å®ƒä¹Ÿæœ‰ç€ä¼˜äºå…¶ä»–æ”¶é›†å™¨çš„åœ°æ–¹ï¼š<strong>ç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æ›´é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚</strong></p><p>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬ä¸ä¼šå¾ˆå¤§ï¼Œæ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„æ–°ç”Ÿä»£ï¼ˆä»…ä»…æ˜¯æ–°ç”Ÿä»£ä½¿ç”¨çš„å†…å­˜ï¼Œæ¡Œé¢åº”ç”¨åŸºæœ¬ä¸ä¼šå†å¤§äº†ï¼‰ï¼Œåœé¡¿æ—¶é—´å®Œå…¨å¯ä»¥æ§åˆ¶åœ¨å‡ åæ¯«ç§’æœ€å¤šä¸€ç™¾æ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œè¿™ç‚¹åœé¡¿æ—¶é—´å¯ä»¥æ¥æ”¶ã€‚æ‰€ä»¥ï¼ŒSerialæ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><h4 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew æ”¶é›†å™¨"></a>ParNew æ”¶é›†å™¨</h4><p><code>ParNew</code>æ”¶é›†å™¨å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª<code>æ–°ç”Ÿä»£æ”¶é›†å™¨</code>ã€‚é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ï¼ˆå¤åˆ¶ç®—æ³•ï¼‰ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰ä¸Serialæ”¶é›†å™¨å®Œå…¨ç›¸åŒï¼Œä¸¤è€…å…±ç”¨äº†ç›¸å½“å¤šçš„ä»£ç ã€‚</p><p>ParNewæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼ˆè€å¹´ä»£é‡‡ç”¨Serial Oldæ”¶é›†å™¨ï¼‰ï¼š</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190813/NDuVa0QjwwYM.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ParNewæ”¶é›†å™¨é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹æ”¶é›†å¤–ï¼Œå…¶ä»–ä¸Serialæ”¶é›†å™¨ç›¸æ¯”å¹¶æ— å¤ªå¤šåˆ›æ–°ä¹‹å¤„ï¼Œä½†å®ƒå´æ˜¯è®¸å¤šè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä¸­é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸æ€§èƒ½æ— å…³çš„é‡è¦åŸå› æ˜¯ï¼Œ<code>é™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½å’ŒCMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰é…åˆå·¥ä½œ</code>ï¼ŒCMSæ”¶é›†å™¨æ˜¯JDK 1.5æ¨å‡ºçš„ä¸€ä¸ªå…·æœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„æ”¶é›†å™¨ï¼Œå…·ä½“å†…å®¹å°†åœ¨ç¨åè¿›è¡Œä»‹ç»ã€‚</p><p>ParNew æ”¶é›†å™¨åœ¨<code>å•CPUçš„ç¯å¢ƒ</code>ä¸­ç»å¯¹ä¸ä¼šæœ‰æ¯”Serialæ”¶é›†å™¨æœ‰æ›´å¥½çš„æ•ˆæœï¼Œç”šè‡³ç”±äºå­˜åœ¨çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè¯¥æ”¶é›†å™¨åœ¨é€šè¿‡è¶…çº¿ç¨‹æŠ€æœ¯å®ç°çš„ä¸¤ä¸ªCPUçš„ç¯å¢ƒä¸­éƒ½ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾åœ°ä¿è¯å¯ä»¥è¶…è¶Šã€‚åœ¨å¤šCPUç¯å¢ƒä¸‹ï¼Œéšç€CPUçš„æ•°é‡å¢åŠ ï¼Œå®ƒå¯¹äºGCæ—¶ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨æ˜¯å¾ˆæœ‰å¥½å¤„çš„ã€‚å®ƒé»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šçš„æƒ…å†µä¸‹å¯ä½¿ç”¨<code>-XX:ParallerGCThreads</code>å‚æ•°è®¾ç½®ã€‚</p><h4 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h4><p><code>Parallel Scavenge</code>æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„å¤šçº¿ç¨‹<code>æ–°ç”Ÿä»£æ”¶é›†å™¨</code>ï¼Œå®ƒä¹Ÿä½¿ç”¨<code>å¤åˆ¶ç®—æ³•</code>ã€‚Parallel Scavengeæ”¶é›†å™¨çš„ç‰¹ç‚¹æ˜¯å®ƒçš„å…³æ³¨ç‚¹ä¸å…¶ä»–æ”¶é›†å™¨ä¸åŒï¼ŒCMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚</p><blockquote><p><strong>ååé‡</strong>ï¼šCPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å’ŒCPUæ¶ˆè€—çš„æ€»æ—¶é—´ï¼ˆCPUæ‰§è¡Œæ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰çš„æ¯”å€¼</p><p><strong>å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹</strong>ï¼šå•çº¿ç¨‹æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œå¤šçº¿ç¨‹ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼›</p><p><strong>å¹¶è¡Œï¼ˆParallelï¼‰</strong>ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å’Œç”¨æˆ·çº¿ç¨‹æ˜¯ä¸²è¡Œçš„ã€‚</p><p><strong>å¹¶å‘ï¼ˆConcurrentï¼‰</strong>ï¼šå¹¶å‘æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨å’Œç”¨æˆ·ç¨‹åºåŒæ—¶æ‰§è¡Œã€‚é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚</p></blockquote><p><code>åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åº</code>ï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚è€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨<code>åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</code>ã€‚</p><p><code>Parallel Scavenge</code>  æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºè¾ƒç²¾ç¡®æ§åˆ¶ååé‡</p><ul><li><p><code>-XX:MaxGCPauseMills</code> æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´</p></li><li><p><code>-XX:GCTimeRatio</code> ç›´æ¥è®¾ç½®ååé‡å¤§å°</p></li></ul><p>ç¼©çŸ­åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´æ¥æ¢å–çš„ï¼šæ–°ç”Ÿä»£ç©ºé—´å˜å°ï¼Œåƒåœ¾å›æ”¶å˜å¾—é¢‘ç¹ï¼Œå¯¼è‡´ååé‡ä¸‹é™ã€‚</p><p>Parallel Scavengeæ”¶é›†å™¨é™¤äº†ä¼šæ˜¾è€Œæ˜“è§åœ°æä¾›å¯ä»¥ç²¾ç¡®æ§åˆ¶ååé‡çš„å‚æ•°ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå‚æ•°<code>-XX:+UseAdaptiveSizePolicy</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œæ‰“å¼€å‚æ•°åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenå’ŒSurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º<code>GCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰</code>ã€‚è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯Parallel Scavengeæ”¶é›†å™¨ä¸ParNewæ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦åŒºåˆ«</p><p>å¦å¤–å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒParallel Scavengeæ”¶é›†å™¨<code>æ— æ³•ä¸CMSæ”¶é›†å™¨é…åˆä½¿ç”¨</code>ï¼Œæ‰€ä»¥åœ¨JDK 1.6æ¨å‡ºParallel Oldä¹‹å‰ï¼Œå¦‚æœæ–°ç”Ÿä»£é€‰æ‹©Parallel Scavengeæ”¶é›†å™¨ï¼Œè€å¹´ä»£åªæœ‰Serial Oldæ”¶é›†å™¨èƒ½ä¸ä¹‹é…åˆä½¿ç”¨ã€‚</p><h4 id="Serial-Oldæ”¶é›†å™¨"><a href="#Serial-Oldæ”¶é›†å™¨" class="headerlink" title="Serial Oldæ”¶é›†å™¨"></a>Serial Oldæ”¶é›†å™¨</h4><p>Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼ŒåŒæ ·æ˜¯å•çº¿ç¨‹ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190813/y1H9NyikWogV.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™ä¸ªæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰æ˜¯ç»™ Client åœºæ™¯ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœç”¨åœ¨ Server åœºæ™¯ä¸‹ï¼Œå®ƒæœ‰ä¸¤å¤§ç”¨é€”ï¼š</p><ul><li>åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</li><li>ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ <code>Concurrent Mode Failure</code> æ—¶ä½¿ç”¨ï¼ˆä¸‹é¢ä¼šä»‹ç»ï¼‰ã€‚</li></ul><h4 id="Parallel-Oldæ”¶é›†å™¨"><a href="#Parallel-Oldæ”¶é›†å™¨" class="headerlink" title="Parallel Oldæ”¶é›†å™¨"></a>Parallel Oldæ”¶é›†å™¨</h4><p>æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190813/itz21ThRoKAD.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨</p><h4 id="CMSæ”¶é›†å™¨ï¼ˆConcurrent-Mark-Sweepï¼‰"><a href="#CMSæ”¶é›†å™¨ï¼ˆConcurrent-Mark-Sweepï¼‰" class="headerlink" title="CMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰"></a>CMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰</h4><p>å¹¶å‘çš„è€å¹´ä»£æ”¶é›†å™¨ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼Œå®ƒçš„è¿ä½œç›¸å¯¹å‰é¢å‡ ç§æ¥è¯´è¦æ›´åŠ å¤æ‚ä¸€äº›ï¼Œæ•´ä½“åˆ†ä¸º4å“¥æ­¥éª¤</p><ul><li><strong>åˆå§‹æ ‡è®°</strong>ï¼šä»…ä»…æ˜¯æ ‡è®°ä¸€ä¸‹GC Rootèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦åœé¡¿</li><li><strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿›è¡ŒGC Root Tracingçš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œä¸éœ€è¦åœé¡¿ï¼Œ</li><li><strong>é‡æ–°æ ‡è®°</strong>ï¼šä¸ºäº†<code>ä¿®æ­£</code>å¹¶å‘æ ‡è®°é˜¶æ®µç¨‹åºç»§ç»­è¿è¡Œå¯¼è‡´æ ‡è®°å˜åŒ–çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿</li><li><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šä¸éœ€è¦åœé¡¿</li></ul><p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„<code>å¹¶å‘æ ‡è®°</code>å’Œ<code>å¹¶å‘æ¸…é™¤</code>è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦è¿›è¡Œåœé¡¿ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190813/zJiEhyXRjfTO.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¼ºç‚¹</strong></p><ul><li><p>å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ å…¶å®ï¼Œé¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹CPUèµ„æºæ¯”è¾ƒæ•æ„Ÿã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆæˆ–è€…è¯´CPUèµ„æºï¼‰è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ï¼ˆCPUæ•°é‡+3ï¼‰/4ï¼Œä¹Ÿå°±æ˜¯å½“CPUåœ¨4ä¸ªä»¥ä¸Šæ—¶ï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸å°‘äº25%çš„CPUèµ„æºï¼Œå¹¶ä¸”éšç€CPUæ•°é‡çš„å¢åŠ è€Œä¸‹é™ã€‚ä½†æ˜¯å½“CPUä¸è¶³4ä¸ªæ—¶ï¼ˆæ¯”å¦‚2ä¸ªï¼‰ï¼ŒCMSå¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ï¼Œå¦‚æœæœ¬æ¥CPUè´Ÿè½½å°±æ¯”è¾ƒå¤§ï¼Œè¿˜è¦åˆ†å‡ºä¸€åŠçš„è¿ç®—èƒ½åŠ›å»æ‰§è¡Œæ”¶é›†å™¨çº¿ç¨‹ï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦å¿½ç„¶é™ä½äº†50%ï¼Œå…¶å®ä¹Ÿè®©äººæ— æ³•æ¥å—ï¼Œåé¢å‡ºç°äº†<code>i-CMS</code>è®©GCçº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹äº¤æ›¿è¿è¡Œï¼Œä½†æ˜¯è¡¨ç°å¾ˆä¸€èˆ¬å·²è¢«å¼ƒç”¨ã€‚</p></li><li><p>æ— æ³•å¤„ç†<code>æµ®åŠ¨åƒåœ¾</code>ï¼Œå¯èƒ½å‡ºç° <code>Concurrent Mode Failure</code>ã€‚æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ã€‚å¦‚æœé¢„ç•™çš„å†…å­˜ä¸å¤Ÿç”¨æˆ·çº¿ç¨‹è¿è¡Œï¼Œå°±ä¼šå‡ºç° <code>Concurrent Mode Failure</code>ï¼Œjdk1.6ä¹‹åè™šæ‹Ÿæœºä¼šä¸´æ—¶å¯ç”¨ Serial Old æ¥æ›¿ä»£ CMSã€‚</p></li><li><p>æ ‡è®°-æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œè¿™æ„å‘³ç€æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘<code>Full GC</code></p></li></ul><h4 id="G1æ”¶é›†å™¨"><a href="#G1æ”¶é›†å™¨" class="headerlink" title="G1æ”¶é›†å™¨"></a>G1æ”¶é›†å™¨</h4><p>G1ï¼ˆGarbage-Firstï¼‰ï¼Œå®ƒæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨å¤š CPU å’Œå¤§å†…å­˜çš„åœºæ™¯ä¸‹æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚HotSpot å¼€å‘å›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯æœªæ¥å¯ä»¥æ›¿æ¢æ‰ CMS æ”¶é›†å™¨ã€‚</p><p>å †è¢«åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå…¶å®ƒæ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€å¹´ä»£ï¼Œè€Œ G1 å¯ä»¥ç›´æ¥å¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸€èµ·å›æ”¶ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190814/o8sxTPY30GnJ.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>G1 æŠŠå †åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†ç‰©ç†éš”ç¦»ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190814/3olH4WWVEysA.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>é€šè¿‡å¼•å…¥ Region çš„æ¦‚å¿µï¼Œä»è€Œå°†åŸæ¥çš„ä¸€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™ç§åˆ’åˆ†æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª Region åƒåœ¾å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡å»å›æ”¶çš„ç»éªŒè·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ª<code>ä¼˜å…ˆåˆ—è¡¨</code>ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚</p><p>ä½†æ˜¯å³ä½¿æ˜¯è¿™æ ·åˆ†äº†Regionåƒåœ¾å›æ”¶å™¨å°±ä¸€å®šä¼šä»¥Regionä¸ºå•ä½åˆ†é…ä¹ˆï¼Ÿæ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼ŒRegionä¸å¯èƒ½å®Œå…¨ç‹¬ç«‹ï¼Œä¸€ä¸ªå¯¹è±¡åˆ†é…åœ¨Regionä¸­å¹¶ä¸æ˜¯åªèƒ½è¢«å½“å‰Regionéƒ¨åˆ†å¼•ç”¨ï¼Œè€Œæ˜¯å¯ä»¥ä¸æ•´ä¸ªJavaå †çš„ä»»æ„å¯¹è±¡å‘ç”Ÿå¼•ç”¨å…³ç³»ï¼Œè¿™æ ·åœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å²‚ä¸æ˜¯ä»ç„¶éœ€è¦éå†æ•´ä¸ªå †? è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯åªåœ¨G1ä¸­å­˜åœ¨ï¼Œå…¶ä»–æ”¶é›†å™¨ä¹Ÿä¼šå­˜åœ¨ï¼Œåªæ˜¯G1è¿™æ ·åˆ’åˆ†ä¹‹åé—®é¢˜æ›´åŠ çªå‡ºäº†ï¼Œåœ¨<code>G1æ”¶é›†å™¨</code>ä¸­æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ª Remembered Setï¼Œç”¨æ¥è®°å½•è¯¥ Region å¯¹è±¡<code>çš„å¼•ç”¨å¯¹è±¡</code>æ‰€åœ¨çš„ Regionã€‚é€šè¿‡ä½¿ç”¨ Remembered Setï¼Œåœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚</p><p>å¦‚æœä¸è®¡ç®—ç»´æŠ¤Remembered Setçš„æ“ä½œï¼ŒG1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰</strong> ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNest Top Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ä»¥çš„Regionä¸­åˆ›å»ºå¯¹è±¡ï¼Œæ­¤é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚</li><li><strong>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</strong> ä»GC Root å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾åˆ°å­˜æ´»å¯¹è±¡ï¼Œæ­¤é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</li><li><strong>æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰</strong> ä¸ºäº†ä¿®æ­£åœ¨<code>å¹¶å‘æ ‡è®°æœŸé—´</code>å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„Remembered Set Logsé‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠRemembered Set Logsçš„æ•°æ®åˆå¹¶åˆ°Remembered Setä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦<code>åœé¡¿çº¿ç¨‹</code>ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚</li><li><strong>ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰</strong> é¦–å…ˆå¯¹å„ä¸ªRegionä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„GC åœé¡¿æ˜¯æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œ<code>ä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„</code>ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚</li></ul><p><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>å¹¶è¡Œä¸å¹¶å‘</strong> G1 èƒ½å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUæ¥ç¼©çŸ­â€œStop The Worldâ€åœé¡¿æ—¶é—´ï¼Œéƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©Javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li><li><strong>åˆ†ä»£æ”¶é›†</strong> ä¸å…¶ä»–æ”¶é›†å™¨ä¸€æ ·ï¼Œåˆ†ä»£æ¦‚å¿µåœ¨G1ä¸­ä¾ç„¶å¾—ä»¥ä¿ç•™ã€‚è™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†å®ƒèƒ½å¤Ÿé‡‡ç”¨ä¸åŒæ–¹å¼å»å¤„ç†æ–°åˆ›å»ºçš„å¯¹è±¡å’Œå·²å­˜æ´»ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡GCçš„æ—§å¯¹è±¡æ¥è·å–æ›´å¥½çš„æ”¶é›†æ•ˆæœã€‚</li><li><strong>ç©ºé—´æ•´åˆ</strong> G1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº<code>â€œæ ‡è®°-æ•´ç†â€</code>ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäº<strong>â€œå¤åˆ¶â€</strong>ç®—æ³•å®ç°çš„ã€‚è¿™æ„å‘³ç€G1è¿è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ï¼Œæ”¶é›†åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚æ­¤ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCã€‚</li><li><strong>å¯é¢„æµ‹çš„åœé¡¿</strong> è¿™æ˜¯G1ç›¸å¯¹CMSçš„ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1é™¤äº†é™ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨GCä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ï¼Œè¿™å‡ ä¹å·²ç»æ˜¯å®æ—¶Javaï¼ˆRTSJï¼‰çš„åƒåœ¾æ”¶é›†å™¨çš„ç‰¹å¾äº†ã€‚</li></ul><h4 id="ç†è§£GCæ—¥å¿—"><a href="#ç†è§£GCæ—¥å¿—" class="headerlink" title="ç†è§£GCæ—¥å¿—"></a>ç†è§£GCæ—¥å¿—</h4><p>GC(Garbage Collection)æ˜¯Javaè™šæ‹Ÿæœºä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éƒ½éœ€è¦æŸ¥çœ‹å®ƒçš„æ—¥å¿—ï¼Œä¸‹é¢å†…å®¹å°±æ˜¯ä»‹ç»å¦‚ä½•æŸ¥çœ‹GCæ—¥å¿—ã€‚</p><p>å¯é€‰å‚æ•°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">-XX:+PrintGC è¾“å‡ºGCæ—¥å¿—</span><br><span class="line">-XX:+PrintGCDetails è¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—</span><br><span class="line">-XX:+PrintGCTimeStamps è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰</span><br><span class="line">-XX:+PrintGCDateStamps è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ <span class="number">2013</span>-<span class="number">05</span>-<span class="number">04</span>T21:<span class="number">53</span>:<span class="number">59.234</span>+<span class="number">0800</span>ï¼‰</span><br><span class="line">-XX:+PrintHeapAtGC åœ¨è¿›è¡ŒGCçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯</span><br><span class="line">-Xloggc:../logs/gc.log æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•ç±»</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/8/15 17:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GCTest</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * vmå‚æ•° ï¼š-XX:+PrintGCDetails è¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] data =<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">10</span>]; <span class="comment">//10M</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        GCTest gcTest = <span class="keyword">new</span> GCTest();</span><br><span class="line">        gcTest=<span class="keyword">null</span>; <span class="comment">//for gc</span></span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(<span class="string">"GC Test"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ§åˆ¶å°æ‰“å°ç»“æœ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[GC (System.gc()) [PSYoungGen: <span class="number">12902</span>K-><span class="number">712</span>K(<span class="number">38400</span>K)] <span class="number">12902</span>K-><span class="number">720</span>K(<span class="number">125952</span>K), <span class="number">0.3622244</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.36</span> secs] </span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(System.gc()</span>) [PSYoungGen: 712K->0<span class="title">K</span><span class="params">(<span class="number">38400</span>K)</span>] [ParOldGen: 8K->638<span class="title">K</span><span class="params">(<span class="number">87552</span>K)</span>] 720K->638<span class="title">K</span><span class="params">(<span class="number">125952</span>K)</span>, [Metaspace: 3438K->3438<span class="title">K</span><span class="params">(<span class="number">1056768</span>K)</span>], 0.0103044 secs] [Times: user</span>=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] </span><br><span class="line">GC Test</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">38400</span>K, used <span class="number">998</span>K [<span class="number">0x00000000d5e00000</span>, <span class="number">0x00000000d8880000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space <span class="number">33280</span>K, <span class="number">3</span>% used [<span class="number">0x00000000d5e00000</span>,<span class="number">0x00000000d5ef9b20</span>,<span class="number">0x00000000d7e80000</span>)</span><br><span class="line">  from space <span class="number">5120</span>K, <span class="number">0</span>% used [<span class="number">0x00000000d7e80000</span>,<span class="number">0x00000000d7e80000</span>,<span class="number">0x00000000d8380000</span>)</span><br><span class="line">  to   space <span class="number">5120</span>K, <span class="number">0</span>% used [<span class="number">0x00000000d8380000</span>,<span class="number">0x00000000d8380000</span>,<span class="number">0x00000000d8880000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">87552</span>K, used <span class="number">638</span>K [<span class="number">0x0000000081a00000</span>, <span class="number">0x0000000086f80000</span>, <span class="number">0x00000000d5e00000</span>)</span><br><span class="line">  object space <span class="number">87552</span>K, <span class="number">0</span>% used [<span class="number">0x0000000081a00000</span>,<span class="number">0x0000000081a9fb68</span>,<span class="number">0x0000000086f80000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3446</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 376<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br><span class="line"><span class="class">  </span></span><br><span class="line"><span class="class"><span class="title">Process</span> <span class="title">finished</span> <span class="title">with</span> <span class="title">exit</span> <span class="title">code</span> 0</span></span><br></pre></td></tr></tbody></table></figure></div><p><code>PSYoungGen</code> çœ‹è§è¿™ä¸ªå…¶å®å°±çŒœçš„åˆ°äº†ï¼ŒParallel Scavengeæ”¶é›†å™¨æ”¶é›†çš„æ–°ç”Ÿä»£ï¼Œä»£è¡¨GCçš„åŒºåŸŸå’Œæ”¶é›†å™¨ã€‚ä¸‹é¢çš„<code>ParOldGen</code>å¯¹åº”çš„å°±æ˜¯Parallel Oldçš„è€å¹´ä»£ ï¼ŒPSYoungGenåé¢ç´§è·Ÿçš„ <code>12902K->712K(38400K)</code> åˆ™ä»£è¡¨ <code>GCå‰è¯¥åŒºåŸŸå·²ç»ä½¿ç”¨çš„å®¹é‡ -> GCåè¯¥åŒºåŸŸå·²ä½¿ç”¨çš„å®¹é‡ï¼ˆè¯¥åŒºåŸŸæ€»å®¹é‡ï¼‰</code>  ï¼Œè€Œæ–¹æ‹¬å·å¤–é¢çš„éƒ¨åˆ†åˆ™ä»£è¡¨ <code>GCå‰Javaå †å·²ä½¿ç”¨é‡ -> GCåJavaå †å·²ä½¿ç”¨é‡ï¼ˆJavaå †ä¸­å®¹é‡ï¼‰</code> ã€‚</p><h3 id="å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥"><a href="#å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥" class="headerlink" title="å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥"></a>å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</h3><ul><li><strong>Minor GC</strong>ï¼šå›æ”¶æ–°ç”Ÿä»£ï¼Œå› ä¸ºæ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ Minor GC ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰§è¡Œçš„é€Ÿåº¦ä¸€èˆ¬ä¹Ÿä¼šæ¯”è¾ƒå¿«ã€‚</li><li><strong>Full GC</strong>ï¼šå›æ”¶è€å¹´ä»£å’Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å¯¹è±¡å…¶å­˜æ´»æ—¶é—´é•¿ï¼Œå› æ­¤ Full GC å¾ˆå°‘æ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦ä¼šæ¯” Minor GC æ…¢å¾ˆå¤šï¼Œå‡ºç°Full GCé€šå¸¸ä¼šä¼´éšç€Minor GCï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šæœ‰æ—¶å€™ä¹Ÿä¼šç›´æ¥è¿›è¡ŒFull GCã€‚</li></ul><p>å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œå¾€å¤§çš„æ–¹å‘è®²å°±æ˜¯åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼ˆä¹Ÿæœ‰å¯èƒ½è¢«JITæ‹†æ•£å¹¶é—´æ¥çš„åœ¨æ ˆä¸Šåˆ†é…ï¼‰ï¼Œå¯¹è±¡ä¸»è¦åˆ†é…åœ¨æ–°ç”Ÿä»£çš„<code>Eden</code> åŒºä¸Šï¼Œå¦‚æœå¯åŠ¨äº†<code>æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²</code>ï¼ˆTLABï¼‰ ä¼šä¼˜å…ˆåœ¨TLABä¸Šåˆ†é…ï¼Œå°‘æ•°æƒ…å†µä¹Ÿä¼šç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­ï¼Œåˆ†é…çš„è§„åˆ™ä¸æ˜¯ç¡®å®šçš„ï¼Œå–å†³äºåƒåœ¾æ”¶é›†å™¨çš„ç»„åˆä»¥åŠè™šæ‹Ÿæœºç›¸å…³çš„å‚æ•°çš„è®¾ç½®ã€‚</p><blockquote><p>-Xms  åˆå§‹Heapå¤§å°</p><p>-Xmx  java heapæœ€å¤§å€¼ </p><p>-Xmn  Young generationçš„heapå¤§å°</p></blockquote><h4 id="å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨Edenä¸Š"><a href="#å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨Edenä¸Š" class="headerlink" title="å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨Edenä¸Š"></a>å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨Edenä¸Š</h4><p>å¤§å¤šæ•°æƒ…å†µï¼Œå¯¹è±¡ä¼šç›´æ¥åœ¨æ–°ç”Ÿä»£Edenä¸Šåˆ†é…ã€‚å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿçš„åŒºåŸŸè¿›è¡Œåˆ†é…çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºå°†ä¼šå‘èµ·ä¸€æ¬¡<code>Minor GC</code> ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¥æ„Ÿå—ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/8/15 17:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GCTest</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> _1M= <span class="number">1024</span>*<span class="number">1024</span>; <span class="comment">//1m</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment">        -verbose:gc</span></span><br><span class="line"><span class="comment">        -Xms20M é™åˆ¶Javaå †å¤§å°20Mä¸å¯æ‰©å±•</span></span><br><span class="line"><span class="comment">        -Xmx20M</span></span><br><span class="line"><span class="comment">        -Xmn10M 10Måˆ†é…ç»™æ–°ç”Ÿä»£</span></span><br><span class="line"><span class="comment">        -XX:SurvivorRatio=8</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">byte</span>[] alloc1,alloc2,alloc3,alloc4;</span><br><span class="line">        alloc1=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span>*_1M];</span><br><span class="line">        alloc2=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span>*_1M];</span><br><span class="line">        alloc3=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span>*_1M];</span><br><span class="line">        System.out.println(<span class="string">"GC Test"</span>); <span class="comment">//å‘ç”ŸGC</span></span><br><span class="line">        alloc4=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">3</span>*_1M];</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ§åˆ¶å°æ‰“å°</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">GC Test</span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">8002</span>K-><span class="number">696</span>K(<span class="number">9216</span>K)] <span class="number">8002</span>K-><span class="number">6840</span>K(<span class="number">19456</span>K), <span class="number">0.0028974</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[<span class="function">Full <span class="title">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 696K->0<span class="title">K</span><span class="params">(<span class="number">9216</span>K)</span>] [ParOldGen: 6144K->6783<span class="title">K</span><span class="params">(<span class="number">10240</span>K)</span>] 6840K->6783<span class="title">K</span><span class="params">(<span class="number">19456</span>K)</span>, [Metaspace: 3439K->3439<span class="title">K</span><span class="params">(<span class="number">1056768</span>K)</span>], 0.0042088 secs] [Times: user</span>=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">9216</span>K, used <span class="number">3154</span>K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K, <span class="number">38</span>% used [<span class="number">0x00000000ff600000</span>,<span class="number">0x00000000ff914930</span>,<span class="number">0x00000000ffe00000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K, <span class="number">0</span>% used [<span class="number">0x00000000ffe00000</span>,<span class="number">0x00000000ffe00000</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">10240</span>K, used <span class="number">6783</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  object space <span class="number">10240</span>K, <span class="number">66</span>% used [<span class="number">0x00000000fec00000</span>,<span class="number">0x00000000ff29fc88</span>,<span class="number">0x00000000ff600000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3446</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 376<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Process</span> <span class="title">finished</span> <span class="title">with</span> <span class="title">exit</span> <span class="title">code</span> 0</span></span><br></pre></td></tr></tbody></table></figure></div><p>åœ¨<code>alloc4</code>çš„æ—¶å€™ å‘ç°ç©ºé—´å·²ç»ä¸è¶³ä»¥è£…ä¸‹äº†ï¼Œæ‰€ä»¥è¿›è¡Œäº†ä¸€æ¬¡Minor GCï¼ŒéšåGCæ‰äº†YoungGenå¤§æ¦‚6Mçš„ç©ºé—´ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡å¤§äº<code>from</code> å’Œ<code>to</code> ä¸¤å—<code>Survivor</code> åŒºåŸŸæ— æ³•ç›´æ¥å­˜å…¥æ‰€ä»¥é€šè¿‡åˆ†é…æ‹…ä¿è¿›å…¥è€å¹´ä»£ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åé¢è€å¹´ä»£66%çš„å ç”¨å­˜æ”¾çš„å°±æ˜¯è¿™å‡ ä¸ªå¯¹è±¡ã€‚GCç»“æŸåï¼Œ<code>alloc4</code> ä¹Ÿé¡ºåˆ©çš„è¿›å…¥çš„<code>Eden</code> </p><h4 id="å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£"><a href="#å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£" class="headerlink" title="å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£"></a>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</h4><p>æ‰€è°“çš„å¤§å¯¹è±¡å…¶å®å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œæœ€å…¸å‹çš„å°±æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢ä»£ç ä¸­çš„byteæ•°ç»„ï¼Œç»å¸¸å‡ºç°å¤§å¯¹è±¡å®¹æ˜“å¯¼è‡´å†…å­˜è¿˜æœ‰ä¸å°‘ç©ºé—´å°±æå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´æ¥â€œå®‰ç½®â€è¿™äº›å¤§å¯¹è±¡ï¼Œæ‰€ä»¥åº”è¯¥é¿å…äº§ç”Ÿâ€œæœç”Ÿå¤•æ­»â€çš„çŸ­å‘½å¤§å¯¹è±¡ã€‚</p><p>è™šæ‹Ÿæœºæä¾›äº†ä¸€ä¸ª  <code>-XX: PretenureSizeThreshold</code>å‚æ•°ï¼Œä»¤å¤§äºè¿™ä¸ªè®¾ç½®å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼ˆåªå¯¹Serialå’ŒParNewä¸¤æ¬¾æ”¶é›†å™¨æœ‰æ•ˆï¼ŒParallelä¸€èˆ¬ä¸ç”¨è®¾ç½®ï¼‰ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GCTest</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> _1M= <span class="number">1024</span>*<span class="number">1024</span>; <span class="comment">//1m</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment">        -verbose:gc</span></span><br><span class="line"><span class="comment">        -Xms20M é™åˆ¶Javaå †å¤§å°20Mä¸å¯æ‰©å±•</span></span><br><span class="line"><span class="comment">        -Xmx20M</span></span><br><span class="line"><span class="comment">        -Xmn10M 10Måˆ†é…ç»™æ–°ç”Ÿä»£</span></span><br><span class="line"><span class="comment">        -XX:SurvivorRatio=8</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">byte</span>[] alloc1,alloc2,alloc3,alloc4;</span><br><span class="line">        alloc1=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">9</span>*_1M];</span><br><span class="line">        System.out.println(<span class="string">"GC Test"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ§åˆ¶å°æ‰“å°</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">GC Test</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">9216</span>K, used <span class="number">2022</span>K [<span class="number">0x00000000ff600000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space <span class="number">8192</span>K, <span class="number">24</span>% used [<span class="number">0x00000000ff600000</span>,<span class="number">0x00000000ff7f9990</span>,<span class="number">0x00000000ffe00000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K, <span class="number">0</span>% used [<span class="number">0x00000000ffe00000</span>,<span class="number">0x00000000ffe00000</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">10240</span>K, used <span class="number">9216</span>K [<span class="number">0x00000000fec00000</span>, <span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ff600000</span>)</span><br><span class="line">  object space <span class="number">10240</span>K, <span class="number">90</span>% used [<span class="number">0x00000000fec00000</span>,<span class="number">0x00000000ff500010</span>,<span class="number">0x00000000ff600000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3447</span>K, capacity <span class="number">4496</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">space</span>    <span class="title">used</span> 376<span class="title">K</span>, <span class="title">capacity</span> 388<span class="title">K</span>, <span class="title">committed</span> 512<span class="title">K</span>, <span class="title">reserved</span> 1048576<span class="title">K</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Process</span> <span class="title">finished</span> <span class="title">with</span> <span class="title">exit</span> <span class="title">code</span> 0</span></span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯¹è±¡å‡ ä¹å…¨éƒ¨è¢«æ”¾åˆ°äº†è€å¹´ä»£é‡Œé¢ï¼Œè€å¹´ä»£å ç”¨ç‡ 90%</p><h4 id="é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£"><a href="#é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£" class="headerlink" title="é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£"></a>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</h4><p>è™šæ‹Ÿæœºä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ Ageï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»å¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¯¹è±¡åœ¨SurvivoråŒºåŸŸæ¯ç†¬è¿‡ä¸€æ¬¡ Minor GCå¹´é¾„å°±å¢åŠ ä¸€å²ï¼Œå½“ä»–çš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º15å²ï¼‰ï¼Œå°±ä¼šå°†å®ƒç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ï¼ˆå¾ˆå½¢è±¡æœ‰æ²¡æœ‰ ğŸ˜ï¼‰<br><code>-XX:MaxTenuringThreshold</code> ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚</p><h4 id="åŠ¨æ€å¹´é¾„åˆ¤å®š"><a href="#åŠ¨æ€å¹´é¾„åˆ¤å®š" class="headerlink" title="åŠ¨æ€å¹´é¾„åˆ¤å®š"></a>åŠ¨æ€å¹´é¾„åˆ¤å®š</h4><p>è™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨ <code>Survivor</code> ä¸­<code>ç›¸åŒå¹´é¾„</code>æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº <code>Survivor ç©ºé—´çš„ä¸€åŠ</code>ï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€ç­‰åˆ°MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„</p><h4 id="ç©ºé—´åˆ†é…æ‹…ä¿"><a href="#ç©ºé—´åˆ†é…æ‹…ä¿" class="headerlink" title="ç©ºé—´åˆ†é…æ‹…ä¿"></a>ç©ºé—´åˆ†é…æ‹…ä¿</h4><p>åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„<code>è¿ç»­ç©ºé—´</code>æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ã€‚<br>å¦‚æœä¸æˆç«‹çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure çš„å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£<br>æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦<code>å¤§äº</code>å†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„<code>å¹³å‡å¤§å°</code>ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ Minor GCï¼›å¦‚æœå°äºï¼Œæˆ–è€… HandlePromotionFailure çš„å€¼ä¸å…è®¸å†’é™©ï¼Œé‚£ä¹ˆå°±è¦è¿›è¡Œä¸€æ¬¡ Full GCï¼Œå¦‚æœå‡ºç°äº†æ‹…ä¿å¤±è´¥ï¼Œé‚£å°±åªå¥½å‘èµ·ä¸€æ¬¡<code>Full GC</code>  ï¼Œç»•çš„åœˆå­æ˜¯æœ€å¤§çš„ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå¼€å…³è¿˜æ˜¯é»˜è®¤æ‰“å¼€çš„ï¼Œé¿å…äº§ç”Ÿå¤ªå¤šçš„Full GCï¼ŒJDK1.6ä¹‹åè¿™ä¸ªå‚æ•°å°±è¢«åºŸæ‰äº†ï¼Œ<code>åªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£æ€»ç©ºé—´æˆ–è€…æ¯æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°å°±è¿›è¡ŒMinor GCå¦åˆ™è¿›è¡ŒFull GC</code></p><h4 id="Full-GCè§¦å‘æ¡ä»¶"><a href="#Full-GCè§¦å‘æ¡ä»¶" class="headerlink" title="Full GCè§¦å‘æ¡ä»¶"></a>Full GCè§¦å‘æ¡ä»¶</h4><p>å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden ç©ºé—´å¿«æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GCã€‚è€Œ Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æƒ…å†µï¼š</p><p><strong><em>è°ƒç”¨ System.gc()</em></strong><br>åªæ˜¯å»ºè®®è™šæ‹Ÿæœºæ‰§è¡Œ Full GCï¼Œä½†æ˜¯è™šæ‹Ÿæœºä¸ä¸€å®šçœŸæ­£å»æ‰§è¡Œã€‚ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯è®©è™šæ‹Ÿæœºç®¡ç†å†…å­˜ã€‚</p><p><strong><em>è€å¹´ä»£ç©ºé—´ä¸è¶³</em></strong><br>è€å¹´ä»£ç©ºé—´ä¸è¶³çš„å¸¸è§åœºæ™¯ä¸ºå‰æ–‡æ‰€è®²çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ç­‰ã€‚<br>ä¸ºäº†é¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œåº”å½“å°½é‡ä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡ä»¥åŠæ•°ç»„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€šè¿‡ -Xmn è™šæ‹Ÿæœºå‚æ•°<br>è°ƒå¤§æ–°ç”Ÿä»£çš„å¤§å°ï¼Œè®©å¯¹è±¡å°½é‡åœ¨æ–°ç”Ÿä»£è¢«å›æ”¶æ‰ï¼Œä¸è¿›å…¥è€å¹´ä»£ã€‚è¿˜å¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold è°ƒå¤§å¯¹<br>è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œè®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´ã€‚</p><p><strong><em>ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥</em></strong><br>ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„ Minor GC éœ€è¦è€å¹´ä»£çš„å†…å­˜ç©ºé—´ä½œæ‹…ä¿ï¼Œå¦‚æœæ‹…ä¿å¤±è´¥ä¼šæ‰§è¡Œä¸€æ¬¡ Full GCã€‚</p><p><strong><em>JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</em></strong><br>åœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºæ˜¯ç”¨æ°¸ä¹…ä»£å®ç°çš„ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„ä¸ºä¸€äº› Class çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®<br>å½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨ CMS GC çš„æƒ…å†µä¸‹ä¹Ÿ<br>ä¼šæ‰§è¡Œ Full GCã€‚å¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŠ›å‡º java.lang.OutOfMemoryErrorã€‚<br>ä¸ºé¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§æ°¸ä¹…ä»£ç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨ CMS GCã€‚</p><p><strong><em>Concurrent Mode Failure</em></strong><br>æ‰§è¡Œ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼ˆå¯èƒ½æ˜¯ GC è¿‡ç¨‹ä¸­æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸è¶³ï¼‰ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘ Full GCã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><strong>å‘¨å¿—æ˜ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹</strong></p><p><a href="https://cyc2018.github.io/CS-Notes/#/notes/Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA?id=minor-gc-%e5%92%8c-full-gc" target="_blank" rel="noopener">CYCå¤§ä½¬çš„åšå®¢ğŸ™</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªæ—‹é”ï¼ŒCLHé”ï¼ŒMCSé”</title>
      <link href="/2019/08/10/zi-xuan-suo-clh-suo-mcs-suo/"/>
      <url>/2019/08/10/zi-xuan-suo-clh-suo-mcs-suo/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h2><p>è‡ªæ—‹é”(spin lock)æ˜¯ä¸€ä¸ªå…¸å‹çš„å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥æ‰‹æ®µï¼Œè‡ªæ—‹é”æ˜¯åŸºäºCASåŸè¯­çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯è½»é‡çº§çš„åŒæ­¥æ“ä½œï¼Œå®ƒçš„åç§°æ¥æºäºå®ƒçš„ç‰¹æ€§ã€‚è‡ªæ—‹é”æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœè¯¥é”å·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œå°±ä¸€ç›´å¾ªç¯æ£€æµ‹é”æ˜¯å¦è¢«é‡Šæ”¾ï¼Œè€Œä¸æ˜¯è¿›å…¥çº¿ç¨‹æŒ‚èµ·æˆ–ç¡çœ çŠ¶æ€ã€‚ç”±äºè‡ªæ—‹é”åªä¸è¿›è¡Œçº¿ç¨‹çŠ¶æ€çš„æ”¹å˜ï¼ˆæŒ‚èµ·çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥å½“çº¿ç¨‹ç«äº‰ä¸æ¿€çƒˆæ—¶ï¼Œå®ƒçš„å“åº”é€Ÿåº¦æå¿«ï¼ˆå› ä¸º<code>é¿å…äº†çº¿ç¨‹è°ƒåº¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</code>ï¼‰ã€‚è‡ªæ—‹é”é€‚ç”¨äºé”ä¿æŠ¤çš„ä¸´ç•ŒåŒºå¾ˆå°çš„æƒ…å†µï¼Œçº¿ç¨‹ç«äº‰ä¸æ¿€çƒˆçš„åœºæ™¯ä¸‹ã€‚å¦‚æœçº¿ç¨‹ä¹‹é—´ç«äº‰æ¿€çƒˆæˆ–è€…ä¸´ç•ŒåŒºçš„æ“ä½œç‰¹åˆ«è€—æ—¶ï¼Œé‚£ä¹ˆçº¿ç¨‹çš„è‡ªæ—‹æ“ä½œå°±ä¼šè€—è´¹å¤§é‡çš„cpuèµ„æºï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æ€§èƒ½å°±ä¼šä¸‹é™æ˜æ˜¾ã€‚</p><h3 id="ç®€å•è‡ªæ—‹é”"><a href="#ç®€å•è‡ªæ—‹é”" class="headerlink" title="ç®€å•è‡ªæ—‹é”"></a>ç®€å•è‡ªæ—‹é”</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleSpinLock</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> AtomicReference<thread> owner = <span class="keyword">new</span> AtomicReference<thread>();</thread></thread></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">        Thread currentThread = Thread.currentThread();</span><br><span class="line">        <span class="comment">// å¦‚æœé”æœªè¢«å ç”¨ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºé”çš„æ‹¥æœ‰è€…</span></span><br><span class="line">        <span class="comment">// åé¢è§£é”çš„å°±åªèƒ½æ˜¯å½“å‰çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> (!owner.compareAndSet(<span class="keyword">null</span>, currentThread)) {</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>{</span><br><span class="line">        Thread currentThread = Thread.currentThread();</span><br><span class="line">        <span class="comment">// åªæœ‰é”çš„æ‹¥æœ‰è€…æ‰èƒ½é‡Šæ”¾é”</span></span><br><span class="line">        owner.compareAndSet(currentThread, <span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¼ºç‚¹</strong></p><ul><li><p>CASæ“ä½œéœ€è¦ç¡¬ä»¶çš„é…åˆï¼ˆç°ä»£å¤„ç†å™¨å¤§å¤šéƒ½æ”¯æŒï¼‰</p></li><li><p>ä¿è¯å„ä¸ªCPUçš„ç¼“å­˜ï¼ˆL1ã€L2ã€L3ã€è·¨CPU Socketã€ä¸»å­˜ï¼‰çš„æ•°æ®ä¸€è‡´æ€§ï¼Œé€šè®¯å¼€é”€å¾ˆå¤§ï¼Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šæ›´ä¸¥é‡ï¼ˆè¿™æ˜¯ç”±äºAtomicçš„volatileå˜é‡å¯¼è‡´çš„ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯å¿…é¡»çš„ï¼‰</p></li><li><p>æ²¡æ³•ä¿è¯å…¬å¹³æ€§ï¼Œä¸ä¿è¯ç­‰å¾…è¿›ç¨‹/çº¿ç¨‹æŒ‰ç…§FIFOé¡ºåºè·å¾—é”ã€‚</p></li></ul><h3 id="Ticket-Lock"><a href="#Ticket-Lock" class="headerlink" title="Ticket Lock"></a>Ticket Lock</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketLock</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> AtomicInteger serviceNum = <span class="keyword">new</span> AtomicInteger(); <span class="comment">// æœåŠ¡å·</span></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger ticketNum = <span class="keyword">new</span> AtomicInteger(); <span class="comment">// æ’é˜Ÿå·</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// é¦–å…ˆåŸå­æ€§åœ°è·å¾—ä¸€ä¸ªæ’é˜Ÿå·</span></span><br><span class="line">        <span class="keyword">int</span> myTicketNum = ticketNum.getAndIncrement();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åªè¦å½“å‰æœåŠ¡å·ä¸æ˜¯è‡ªå·±çš„å°±ä¸æ–­è½®è¯¢</span></span><br><span class="line">        <span class="keyword">while</span> (serviceNum.get() != myTicketNum) {</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> myTicketNum;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(<span class="keyword">int</span> myTicket)</span> </span>{</span><br><span class="line">        <span class="comment">// è§£é”ååªæœ‰æ‹¥æœ‰è¯¥çº¿ç¨‹çš„ä¸‹ä¸€ä¸ªæ’é˜Ÿå·çº¿ç¨‹æ‰èƒ½åŠ é”,ä¿è¯äº†å…¬å¹³æ€§,ä¸ä¼šæœ‰æ’é˜Ÿçš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">int</span> next = myTicket + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// åªæœ‰å½“å‰çº¿ç¨‹æ‹¥æœ‰è€…æ‰èƒ½é‡Šæ”¾é”</span></span><br><span class="line">        serviceNum.compareAndSet(myTicket, next);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¼ºç‚¹</strong></p><p>Ticket Lock è™½ç„¶è§£å†³äº†å…¬å¹³æ€§çš„é—®é¢˜ï¼Œä½†æ˜¯å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹å ç”¨çš„å¤„ç†å™¨éƒ½åœ¨è¯»å†™åŒä¸€ä¸ªå˜é‡serviceNum ï¼Œæ¯æ¬¡è¯»å†™æ“ä½œéƒ½å¿…é¡»åœ¨å¤šä¸ªå¤„ç†å™¨ç¼“å­˜ä¹‹é—´è¿›è¡Œç¼“å­˜åŒæ­¥ï¼Œè¿™ä¼šå¯¼è‡´ç¹é‡çš„ç³»ç»Ÿæ€»çº¿å’Œå†…å­˜çš„æµé‡ï¼Œå¤§å¤§é™ä½ç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½ã€‚</p><h3 id="CLHé”"><a href="#CLHé”" class="headerlink" title="CLHé”"></a>CLHé”</h3><p>CLHçš„å‘æ˜äººæ˜¯ï¼šCraigï¼ŒLandin and Hagerstenï¼Œä¸‰ä¸ªäººçš„åå­—åˆç§°</p><p>CLHé”æ˜¯ä¸€ç§åŸºäºéšå¼é“¾è¡¨ï¼ˆèŠ‚ç‚¹é‡Œé¢æ²¡æœ‰nextæŒ‡é’ˆï¼‰çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ï¼Œç”³è¯·çº¿ç¨‹åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œå®ƒä¸æ–­è½®è¯¢å‰é©±çš„çŠ¶æ€ï¼Œå¦‚æœå‘ç°å‰é©±é‡Šæ”¾äº†é”å°±ç»“æŸè‡ªæ—‹ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CLHLock</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CLHNode</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> isLocked = <span class="keyword">true</span>; <span class="comment">// é»˜è®¤æ˜¯åœ¨ç­‰å¾…é”</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> CLHNode tail ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicReferenceFieldUpdater<clhlock, clhnode> UPDATER = AtomicReferenceFieldUpdater</clhlock,></span><br><span class="line">            . newUpdater(CLHLock.class, CLHNode .class , "tail" );</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">(CLHNode currentThreadNode)</span> </span>{</span><br><span class="line">        <span class="comment">//è·å–ä¹‹å‰çš„å°¾ç»“ç‚¹, ç„¶åå°†è‡ªå·±è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹</span></span><br><span class="line">        CLHNode preNode = UPDATER.getAndSet( <span class="keyword">this</span>, currentThreadNode);</span><br><span class="line">        <span class="keyword">if</span>(preNode != <span class="keyword">null</span>) {<span class="comment">//å·²æœ‰çº¿ç¨‹å ç”¨äº†é”ï¼Œè¿›å…¥è‡ªæ—‹</span></span><br><span class="line">            <span class="keyword">while</span>(preNode.isLocked ) {</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(CLHNode currentThreadNode)</span> </span>{</span><br><span class="line">        <span class="comment">// å¦‚æœé˜Ÿåˆ—é‡Œåªæœ‰å½“å‰çº¿ç¨‹ï¼Œåˆ™é‡Šæ”¾å¯¹å½“å‰çº¿ç¨‹çš„å¼•ç”¨ï¼ˆfor GCï¼‰ã€‚</span></span><br><span class="line">        <span class="comment">// å°è¯•è®¾ç½®å°¾èŠ‚ç‚¹ä¸ºè‡ªå·±, ä¼ å…¥çš„æœŸæœ›å€¼æ˜¯è‡ªå·±,æˆåŠŸå°±ä»£è¡¨é˜Ÿåˆ—ä¸­åªæœ‰å®ƒä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span> (!UPDATER.compareAndSet(<span class="keyword">this</span>, currentThreadNode, <span class="keyword">null</span>)) {</span><br><span class="line">            <span class="comment">// è¿˜æœ‰åç»­çº¿ç¨‹</span></span><br><span class="line">            currentThreadNode.isLocked = <span class="keyword">false</span> ;<span class="comment">// æ”¹å˜çŠ¶æ€ï¼Œè®©åç»­çº¿ç¨‹ç»“æŸè‡ªæ—‹</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œç”¨åˆ°äº†<code>åŸå­å­—æ®µæ›´æ–°å™¨</code>ï¼Œè®©tailå˜é‡å¯ä»¥å…·æœ‰CASçš„åŠŸèƒ½ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« <a href="http://imlgw.top/2019/04/22/cas-yu-yuan-zi-bian-liang/#%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E5%99%A8">CASä¸åŸå­å˜é‡</a></p><p><strong>ç¼ºç‚¹</strong></p><p>å…ˆè¯´ä¸€ä¸‹<code>NUMA</code>å’Œ<code>SMP</code>ä¸¤ç§å¤„ç†å™¨ç»“æ„<br>SMP(Symmetric Multi-Processor)ï¼Œå³å¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„ï¼ŒæŒ‡æœåŠ¡å™¨ä¸­å¤šä¸ªCPUå¯¹ç§°å·¥ä½œï¼Œæ¯ä¸ªCPUè®¿é—®å†…å­˜åœ°å€æ‰€éœ€æ—¶é—´ç›¸åŒã€‚å…¶ä¸»è¦ç‰¹å¾æ˜¯å…±äº«ï¼ŒåŒ…å«å¯¹CPUï¼Œå†…å­˜ï¼ŒI/Oç­‰è¿›è¡Œå…±äº«ã€‚SMPçš„ä¼˜ç‚¹æ˜¯<code>èƒ½å¤Ÿä¿è¯å†…å­˜ä¸€è‡´æ€§</code>ï¼Œç¼ºç‚¹æ˜¯è¿™äº›å…±äº«çš„èµ„æºå¾ˆå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œéšç€CPUæ•°é‡çš„å¢åŠ ï¼Œæ¯ä¸ªCPUéƒ½è¦è®¿é—®ç›¸åŒçš„å†…å­˜èµ„æºï¼Œå¯èƒ½å¯¼è‡´å†…å­˜è®¿é—®å†²çªï¼Œå¯èƒ½ä¼šå¯¼è‡´CPUèµ„æºçš„æµªè´¹ã€‚å¸¸ç”¨çš„PCæœºå°±å±äºè¿™ç§ã€‚</p><p>NUMA(Non-Uniform Memory Access)éä¸€è‡´å­˜å‚¨è®¿é—®ï¼Œå°†CPUåˆ†ä¸ºCPUæ¨¡å—ï¼Œæ¯ä¸ªCPUæ¨¡å—ç”±å¤šä¸ªCPUç»„æˆï¼Œå¹¶ä¸”å…·æœ‰ç‹¬ç«‹çš„æœ¬åœ°å†…å­˜ã€I/Oæ§½å£ç­‰ï¼Œæ¨¡å—ä¹‹é—´å¯ä»¥é€šè¿‡äº’è”æ¨¡å—ç›¸äº’è®¿é—®ï¼Œ<code>è®¿é—®æœ¬åœ°å†…å­˜çš„é€Ÿåº¦å°†è¿œè¿œé«˜äºè®¿é—®è¿œåœ°å†…å­˜(ç³»ç»Ÿå†…å…¶å®ƒèŠ‚ç‚¹çš„å†…å­˜)çš„é€Ÿåº¦</code>ï¼Œè¿™ä¹Ÿæ˜¯éä¸€è‡´å­˜å‚¨è®¿é—®NUMAçš„ç”±æ¥ã€‚NUMAä¼˜ç‚¹æ˜¯å¯ä»¥è¾ƒå¥½åœ°è§£å†³åŸæ¥SMPç³»ç»Ÿçš„æ‰©å±•é—®é¢˜ï¼Œç¼ºç‚¹æ˜¯ç”±äºè®¿é—®è¿œåœ°å†…å­˜çš„å»¶æ—¶è¿œè¿œè¶…è¿‡æœ¬åœ°å†…å­˜ï¼Œå› æ­¤å½“CPUæ•°é‡å¢åŠ æ—¶ï¼Œç³»ç»Ÿæ€§èƒ½æ— æ³•çº¿æ€§å¢åŠ ã€‚</p><p><strong>CLHé”çš„ç¼ºç‚¹æ˜¯åœ¨NUMAç³»ç»Ÿç»“æ„ä¸‹æ€§èƒ½å¾ˆå·®ï¼Œåœ¨è¿™ç§ç³»ç»Ÿç»“æ„ä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å†…å­˜ï¼Œå¦‚æœå‰è¶‹ç»“ç‚¹çš„å†…å­˜ä½ç½®æ¯”è¾ƒè¿œï¼Œè‡ªæ—‹åˆ¤æ–­å‰è¶‹ç»“ç‚¹çš„lockedåŸŸï¼Œæ€§èƒ½å°†å¤§æ‰“æŠ˜æ‰£ï¼Œåœ¨SMPæ¶æ„ä¸‹èƒ½å¤Ÿä¿è¯å†…å­˜ä¸€è‡´æ€§æ‰€ä»¥è‡ªæ—‹åˆ¤æ–­è¾ƒå¿«</strong></p><h3 id="MCSé”"><a href="#MCSé”" class="headerlink" title="MCSé”"></a>MCSé”</h3><p>MCS Spinlockæ˜¯ä¸€ç§åŸºäºæ˜¾å¼é“¾è¡¨ï¼ˆèŠ‚ç‚¹é‡Œé¢æ‹¥æœ‰nextæŒ‡é’ˆï¼‰çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ï¼Œç”³è¯·çº¿ç¨‹åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œç”±ç›´æ¥å‰é©±è´Ÿè´£é€šçŸ¥å…¶ç»“æŸè‡ªæ—‹ï¼ˆä¸CLHè‡ªæ—‹é”ä¸åŒçš„åœ°æ–¹ï¼Œä¸åœ¨è½®è¯¢å‰é©±çš„çŠ¶æ€ï¼Œè€Œæ˜¯ç”±å‰é©±ä¸»åŠ¨é€šçŸ¥ï¼‰ï¼Œä»è€Œæå¤§åœ°å‡å°‘äº†ä¸å¿…è¦çš„å¤„ç†å™¨ç¼“å­˜åŒæ­¥çš„æ¬¡æ•°ï¼Œé™ä½äº†æ€»çº¿å’Œå†…å­˜çš„å¼€é”€ã€‚è€ŒMCSæ˜¯åœ¨è‡ªå·±çš„ç»“ç‚¹çš„lockedåŸŸä¸Šè‡ªæ—‹ç­‰å¾…ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå®ƒè§£å†³äº†CLHåœ¨NUMAç³»ç»Ÿæ¶æ„ä¸­è·å–lockedåŸŸçŠ¶æ€å†…å­˜è¿‡è¿œçš„é—®é¢˜ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/8/10 21:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MCSLock</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MCSNode</span> </span>{</span><br><span class="line">        <span class="comment">//æŒæœ‰åç»§è€…çš„å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">volatile</span> MCSNode next;</span><br><span class="line">        <span class="comment">// é»˜è®¤æ˜¯åœ¨ç­‰å¾…é”</span></span><br><span class="line">        <span class="keyword">volatile</span> <span class="keyword">boolean</span> block = <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> MCSNode tail;<span class="comment">// æŒ‡å‘æœ€åä¸€ä¸ªç”³è¯·é”çš„MCSNode</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicReferenceFieldUpdater<mcslock, mcsnode> UPDATER = AtomicReferenceFieldUpdater</mcslock,></span><br><span class="line">            .newUpdater(MCSLock.class, MCSNode.class, "tail");</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">(MCSNode currentThreadMcsNode)</span> </span>{</span><br><span class="line">        <span class="comment">//æ›´æ–°tailä¸ºæœ€æ–°åŠ å…¥çš„çº¿ç¨‹èŠ‚ç‚¹ï¼Œå¹¶å–å‡ºä¹‹å‰çš„èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰èŠ‚ç‚¹çš„å‰é©±ï¼‰</span></span><br><span class="line">        MCSNode predecessor = UPDATER.getAndSet(<span class="keyword">this</span>, currentThreadMcsNode);</span><br><span class="line">        <span class="keyword">if</span> (predecessor != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//è¿æ¥åœ¨tailçš„å°¾éƒ¨</span></span><br><span class="line">            predecessor.next = currentThreadMcsNode;</span><br><span class="line">            <span class="comment">//è½®è¯¢è‡ªå·±çš„isLockedå±æ€§</span></span><br><span class="line">            <span class="keyword">while</span> (currentThreadMcsNode.block) {</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">//å‰é©±èŠ‚ç‚¹ä¸ºç©ºç›´æ¥è·å–é”,è‡ªå·±æ˜¯ç¬¬ä¸€ä¸ª</span></span><br><span class="line">            currentThreadMcsNode.block = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(MCSNode currentThreadMcsNode)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (currentThreadMcsNode.block) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (currentThreadMcsNode.next == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//CAS å°†tailè®¾ç½®ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> (UPDATER.compareAndSet(<span class="keyword">this</span>, currentThreadMcsNode, <span class="keyword">null</span>)) {</span><br><span class="line">                <span class="comment">// è®¾ç½®æˆåŠŸè¿”å›ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹ç­‰å¾…é”</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">//CASæ›´æ–°tailå¤±è´¥,æœ‰çº¿ç¨‹æŠ¢å…ˆä¸€æ­¥æ‰§è¡Œlockæ›´æ–°äº†tail</span></span><br><span class="line">                <span class="comment">//ä½†æ˜¯å¯èƒ½è¿˜æ²¡æœ‰è¿æ¥åœ¨ ä¹‹å‰çš„tail(å½“å‰èŠ‚ç‚¹)å</span></span><br><span class="line">                <span class="keyword">while</span> (currentThreadMcsNode.next == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="comment">//ç­‰å¾… predecessor.next = currentThreadMcsNodeæ‰§è¡Œ</span></span><br><span class="line">                    <span class="comment">//å¦åˆ™åé¢ä¼šæŠ¥NPE</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ä¿®æ”¹åç»§è€…çš„isLocked,é€šçŸ¥åç»§è€…ç»“æŸè‡ªæ—‹</span></span><br><span class="line">        currentThreadMcsNode.next.block = <span class="keyword">false</span>;</span><br><span class="line">        currentThreadMcsNode.next = <span class="keyword">null</span>;<span class="comment">// for GC</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¼ ç»Ÿçš„<code>Spin lock</code> å’Œ <code>Ticket Lock</code>éƒ½åœ¨åŒä¸€ä¸ªå…±äº«å˜é‡ä¸Šç«äº‰ï¼ˆä¾‹å¦‚SimpleSpinLockä¸­çš„ownerã€Ticket Lockä¸­çš„serviceNumï¼‰ï¼Œè¿™æ ·å¯¹ç»™CPUä¿è¯ç¼“å­˜ä¸€è‡´æ€§å¸¦æ¥çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œæ¯æ¬¡è¯»å†™éƒ½éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰çš„çº¿ç¨‹ï¼Œè€ŒMCSå’ŒCLHæœ€å¤§çš„ä¼˜åŒ–ç‚¹åœ¨äºæŠŠä¸Šè¿°åŒä¸€ä¸ªç‚¹ä¸Šçš„ç«äº‰åˆ†æ•£åˆ°é˜Ÿåˆ—çš„æ¯ä¸ªèŠ‚ç‚¹ä¸­å»äº†ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://coderbee.net/index.php/concurrent/20131115/577" target="_blank" rel="noopener">è‡ªæ—‹é”ã€æ’é˜Ÿè‡ªæ—‹é”ã€MCSé”ã€CLHé”</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜»å¡é˜Ÿåˆ—</title>
      <link href="/2019/08/07/zu-sai-dui-lie/"/>
      <url>/2019/08/07/zu-sai-dui-lie/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h2><p>é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚</p><p><strong>éé˜»å¡é˜Ÿåˆ—ä¸­çš„å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š</strong></p><ul><li><p><code>add(E e)</code>:å°†å…ƒç´ eæ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p></li><li><p><code>remove()</code>:ç§»é™¤é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥ç§»é™¤æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœç§»é™¤å¤±è´¥ï¼ˆé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p></li><li><p><code>offer(E e)</code>ï¼šå°†å…ƒç´ eæ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™è¿”å›false</p></li><li><p><code>poll()</code>ï¼šç§»é™¤å¹¶è·å–é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å›null</p></li><li><p><code>peek()</code>ï¼šè·å–é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å›null</p></li></ul><p>å¯¹äºéé˜»å¡é˜Ÿåˆ—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨offerã€pollå’Œpeekä¸‰ä¸ªæ–¹æ³•ï¼Œä¸å»ºè®®ä½¿ç”¨addå’Œremoveæ–¹æ³•ã€‚å› ä¸ºä½¿ç”¨offerã€pollå’Œpeekä¸‰ä¸ªæ–¹æ³•å¯ä»¥é€šè¿‡è¿”å›å€¼åˆ¤æ–­æ“ä½œæˆåŠŸä¸å¦ï¼Œè€Œä½¿ç”¨addå’Œremoveæ–¹æ³•å´ä¸èƒ½è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚æ³¨æ„ï¼Œéé˜»å¡é˜Ÿåˆ—ä¸­çš„æ–¹æ³•éƒ½æ²¡æœ‰è¿›è¡ŒåŒæ­¥æªæ–½ã€‚</p><p><strong>é˜»å¡é˜Ÿåˆ—ä¸­çš„å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š</strong></p><p>é˜»å¡é˜Ÿåˆ—åŒ…æ‹¬äº†éé˜»å¡é˜Ÿåˆ—ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œä¸Šé¢åˆ—ä¸¾çš„5ä¸ªæ–¹æ³•åœ¨é˜»å¡é˜Ÿåˆ—ä¸­éƒ½å­˜åœ¨ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™5ä¸ªæ–¹æ³•åœ¨é˜»å¡é˜Ÿåˆ—ä¸­éƒ½è¿›è¡Œäº†<strong>åŒæ­¥æªæ–½</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé˜»å¡é˜Ÿåˆ—æä¾›äº†å¦å¤–4ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼š</p><ul><li><p><code>put(E e)</code>æ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…</p></li><li><p><code>take()</code>æ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ç­‰å¾…</p></li><li><p><code>offer(E e,long timeout, TimeUnit unit)</code>æ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›falseï¼›å¦åˆ™è¿”å›true</p></li><li><p><code>poll(long timeout, TimeUnit unit)</code>æ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ç©ºï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœæ²¡å–åˆ°ï¼Œåˆ™è¿”å›nullï¼›å¦åˆ™è¿”å›å–å¾—çš„å…ƒç´ </p></li></ul><h3 id="Javaé‡Œçš„é˜»å¡é˜Ÿåˆ—"><a href="#Javaé‡Œçš„é˜»å¡é˜Ÿåˆ—" class="headerlink" title="Javaé‡Œçš„é˜»å¡é˜Ÿåˆ—"></a>Javaé‡Œçš„é˜»å¡é˜Ÿåˆ—</h3><ul><li><strong>ArrayBlockingQueue</strong> ï¼šä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong>LinkedBlockingQueue</strong> ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong>PriorityBlockingQueue</strong> ï¼šä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong>DelayQueue</strong>ï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong>SynchronousQueue</strong>ï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong>LinkedTransferQueue</strong>ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong>LinkedBlockingDeque</strong>ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</li></ul><blockquote><p>é™¤äº†è¿™å‡ ä¸ªå¤–è¿˜æœ‰ä¸€ä¸ª <code>ScheduledThreadPoolExecutor.DelayedWorkQueue</code>è¿™ä¸ªå…¶å®æ˜¯DelayQueueçš„ä¼˜åŒ–</p></blockquote><h3 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a>ArrayBlockingQueue</h3><p>ArrayBlockingQueueæ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯è®¿é—®è€…å…¬å¹³çš„è®¿é—®é˜Ÿåˆ—ï¼Œæ‰€è°“å…¬å¹³è®¿é—®é˜Ÿåˆ—æ˜¯æŒ‡é˜»å¡çš„æ‰€æœ‰ç”Ÿäº§è€…çº¿ç¨‹æˆ–æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå½“é˜Ÿåˆ—å¯ç”¨æ—¶ï¼Œå¯ä»¥æŒ‰ç…§é˜»å¡çš„å…ˆåé¡ºåºè®¿é—®é˜Ÿåˆ—ï¼Œå³å…ˆé˜»å¡çš„ç”Ÿäº§è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆå¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œå…ˆé˜»å¡çš„æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ ã€‚é€šå¸¸æƒ…å†µä¸‹ä¸ºäº†ä¿è¯å…¬å¹³æ€§ä¼šé™ä½ååé‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªå…¬å¹³çš„é˜»å¡é˜Ÿåˆ—ï¼š</p><p><code>ArrayBlockingQueue fairQueue = new ArrayBlockingQueue(1000,true);</code></p><p>è®¿é—®è€…çš„å…¬å¹³æ€§æ˜¯ä½¿ç”¨å¯é‡å…¥é”å®ç°çš„</p><h3 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h3><p>LinkedBlockingQueueæ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„<strong>æœ‰ç•Œ</strong>é˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</p><p>å®¹æ˜“è¢«è¯¯è§£ä¸ºæ— è¾¹ç•Œï¼Œä½†å…¶å®å…¶è¡Œä¸ºå’Œå†…éƒ¨ä»£ç éƒ½æ˜¯åŸºäºæœ‰ç•Œçš„é€»è¾‘å®ç°çš„ï¼Œåªä¸è¿‡å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶å°±æŒ‡å®šå®¹é‡ï¼Œé‚£ä¹ˆå…¶å®¹é‡é™åˆ¶å°±è‡ªåŠ¨è¢«<br>è®¾ç½®ä¸º Integer.MAX_VALUE ï¼Œæˆä¸ºäº†æ— ç•Œé˜Ÿåˆ—ã€‚</p><h3 id="PriorityBlockingQueue"><a href="#PriorityBlockingQueue" class="headerlink" title="PriorityBlockingQueue"></a>PriorityBlockingQueue</h3><p>PriorityBlockingQueueæ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜Ÿåˆ—ã€‚åº•å±‚é‡‡ç”¨æ•°ç»„å®ç°äº†äºŒå‰å †ï¼Œç›¸æ¯”PriorityQueueå…¶å®å°±æ˜¯å°†é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡å–è‡ªç„¶é¡ºåºæ’åˆ—ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¯”è¾ƒå™¨comparatoræ¥æŒ‡å®šå…ƒç´ çš„æ’åºè§„åˆ™ã€‚</p><h3 id="DelayQueue"><a href="#DelayQueue" class="headerlink" title="DelayQueue"></a>DelayQueue</h3><p>è¿™ä¸ªé˜Ÿåˆ—è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼ŒDelayQueueæ˜¯ä¸€ä¸ªæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚å†…éƒ¨ä½¿ç”¨PriorityQueueæ¥å­˜å‚¨å…ƒç´ ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ ã€‚åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡æ—¶æ‰èƒ½ä»é˜Ÿåˆ—ä¸­<strong>å–å‡º</strong>å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥å°†DelayQueueè¿ç”¨åœ¨ä»¥ä¸‹åº”ç”¨åœºæ™¯ï¼š</p><ul><li>ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡ï¼šå¯ä»¥ç”¨DelayQueueä¿å­˜ç¼“å­˜å…ƒç´ çš„æœ‰æ•ˆæœŸï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¾ªç¯æŸ¥è¯¢DelayQueueï¼Œä¸€æ—¦èƒ½ä»DelayQueueä¸­è·å–(åˆ é™¤)å…ƒç´ æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæœŸåˆ°äº†ã€‚</li><li>å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚ä½¿ç”¨DelayQueueä¿å­˜å½“å¤©å°†ä¼šæ‰§è¡Œçš„ä»»åŠ¡å’Œæ‰§è¡Œæ—¶é—´ï¼Œä¸€æ—¦ä»DelayQueueä¸­è·å–åˆ°ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œï¼Œä»æ¯”å¦‚TimerQueueå°±æ˜¯ä½¿ç”¨DelayQueueå®ç°çš„ã€‚</li></ul><p>é˜Ÿåˆ—ä¸­çš„Delayedå¿…é¡»å®ç°compareToæ¥æŒ‡å®šå…ƒç´ çš„é¡ºåºã€‚æ¯”å¦‚è®©å»¶æ—¶æ—¶é—´æœ€é•¿çš„æ”¾åœ¨é˜Ÿåˆ—çš„æœ«å°¾ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><p><strong>å¦‚ä½•å®ç°Delayedæ¥å£</strong></p><p>æˆ‘ä»¬å¯ä»¥å‚è€ƒScheduledThreadPoolExecutoré‡ŒScheduledFutureTaskç±»ã€‚è¿™ä¸ªç±»å®ç°äº†Delayedæ¥å£ã€‚</p><p>ç„¶åä½¿ç”¨getDelayå¯ä»¥æŸ¥è¯¢å½“å‰å…ƒç´ è¿˜éœ€è¦å»¶æ—¶å¤šä¹…ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> unit.convert(time - now(), TimeUnit.NANOSECONDS);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é€šè¿‡æ„é€ å‡½æ•°å¯ä»¥çœ‹å‡ºå»¶è¿Ÿæ—¶é—´å‚æ•°nsçš„å•ä½æ˜¯çº³ç§’ï¼Œè‡ªå·±è®¾è®¡çš„æ—¶å€™æœ€å¥½ä½¿ç”¨çº³ç§’ï¼Œå› ä¸ºgetDelayæ—¶å¯ä»¥æŒ‡å®šä»»æ„å•ä½ï¼Œä¸€æ—¦ä»¥çº³ç§’ä½œä¸ºå•ä½ï¼Œè€Œå»¶æ—¶çš„æ—¶é—´åˆç²¾ç¡®ä¸åˆ°çº³ç§’å°±éº»çƒ¦äº†ã€‚ä½¿ç”¨æ—¶è¯·æ³¨æ„å½“timeå°äºå½“å‰æ—¶é—´æ—¶ï¼ŒgetDelayä¼šè¿”å›è´Ÿæ•°ã€‚</p><p><strong>å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—</strong></p><p>å»¶æ—¶é˜Ÿåˆ—çš„å®ç°å¾ˆç®€å•ï¼Œå½“æ¶ˆè´¹è€…ä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ æ—¶ï¼Œå¦‚æœå…ƒç´ æ²¡æœ‰è¾¾åˆ°å»¶æ—¶æ—¶é—´ï¼Œå°±é˜»å¡å½“å‰çº¿ç¨‹ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Delayed;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayedEle</span> <span class="keyword">implements</span> <span class="title">Delayed</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> delayTime; <span class="comment">//å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> expire;  <span class="comment">//åˆ°æœŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String data;   <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DelayedEle</span><span class="params">(<span class="keyword">long</span> delay, String data)</span> </span>{</span><br><span class="line">        delayTime = delay;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        expire = System.currentTimeMillis() + delay;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰©ä½™æ—¶é—´=åˆ°æœŸæ—¶é—´-å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> unit.convert(<span class="keyword">this</span>.expire - System.currentTimeMillis() , TimeUnit.MILLISECONDS);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜å…ˆé˜Ÿåˆ—é‡Œé¢ä¼˜å…ˆçº§è§„åˆ™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed o)</span> </span>{</span><br><span class="line">        <span class="comment">//æ ¹æ®delayæ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (<span class="keyword">this</span>.getDelay(TimeUnit.MILLISECONDS) -o.getDelay(TimeUnit.MILLISECONDS));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">"DelayedElement{"</span>);</span><br><span class="line">        sb.append(<span class="string">"delay="</span>).append(delayTime);</span><br><span class="line">        sb.append(<span class="string">", expire="</span>).append(expire);</span><br><span class="line">        sb.append(<span class="string">", data='"</span>).append(data).append(<span class="string">'\''</span>);</span><br><span class="line">        sb.append(<span class="string">'}'</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.DelayQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/8/7 17:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayedQueueTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        DelayQueue<delayedele> delayQueue = <span class="keyword">new</span> DelayQueue<delayedele>();</delayedele></delayedele></span><br><span class="line"></span><br><span class="line">        DelayedEle element1 = <span class="keyword">new</span> DelayedEle(<span class="number">3000</span>,<span class="string">"lgw"</span>);</span><br><span class="line">        DelayedEle element2 = <span class="keyword">new</span> DelayedEle(<span class="number">3000</span>,<span class="string">"top"</span>);</span><br><span class="line"></span><br><span class="line">        delayQueue.offer(element1);</span><br><span class="line">        delayQueue.offer(element2);</span><br><span class="line">        <span class="keyword">long</span> l = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(l);</span><br><span class="line">        element1 =  delayQueue.take();</span><br><span class="line">        System.out.println(System.currentTimeMillis()-l);</span><br><span class="line"></span><br><span class="line">        System.out.println(element1);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æµ‹è¯•ç»“æœ</span></span><br><span class="line"><span class="comment"> *  1565176036796</span></span><br><span class="line"><span class="comment"> *  3016</span></span><br><span class="line"><span class="comment"> *  DelayedElement{delay=3000, expire=1565176039796, data='lgw'}</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="SynchronousQueue"><a href="#SynchronousQueue" class="headerlink" title="SynchronousQueue"></a>SynchronousQueue</h3><p>SynchronousQueueæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸€ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚SynchronousQueueå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªä¼ çƒæ‰‹ï¼Œè´Ÿè´£æŠŠç”Ÿäº§è€…çº¿ç¨‹å¤„ç†çš„æ•°æ®ç›´æ¥ä¼ é€’ç»™æ¶ˆè´¹è€…çº¿ç¨‹ã€‚é˜Ÿåˆ—æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œéå¸¸é€‚åˆäºä¼ é€’æ€§åœºæ™¯,æ¯”å¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®ï¼Œä¼ é€’ç»™å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼ŒSynchronousQueueçš„ååé‡é«˜äºLinkedBlockingQueue å’Œ ArrayBlockingQueueã€‚</p><blockquote><p>çº¿ç¨‹æ± å·¥å‚æ–¹æ³• <strong>newCachedThreadPool</strong> åº•å±‚å°±æ˜¯ç”¨çš„Synchronized</p></blockquote><h3 id="LinkedTransferQueue"><a href="#LinkedTransferQueue" class="headerlink" title="LinkedTransferQueue"></a>LinkedTransferQueue</h3><p>TransferQueueç›¸æ¯”SynchronousQueueç”¨å¤„æ›´å¹¿ã€æ›´å¥½ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥å†³å®šæ˜¯ä½¿ç”¨BlockingQueueçš„æ–¹æ³•ï¼ˆè¯‘è€…æ³¨ï¼šä¾‹å¦‚putæ–¹æ³•ï¼‰è¿˜æ˜¯ç¡®ä¿ä¸€æ¬¡ä¼ é€’å®Œæˆï¼ˆè¯‘è€…æ³¨ï¼šå³transferæ–¹æ³•ï¼‰ã€‚åœ¨é˜Ÿåˆ—ä¸­å·²æœ‰å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨transferæ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿é˜Ÿåˆ—ä¸­è¢«ä¼ é€’å…ƒç´ ä¹‹å‰çš„æ‰€æœ‰å…ƒç´ éƒ½èƒ½è¢«å¤„ç†ã€‚<a href="http://cs.oswego.edu/pipermail/concurrency-interest/2009-February/005888.html" target="_blank" rel="noopener">Doug Leaè¯´</a>ä»åŠŸèƒ½è§’åº¦æ¥è®²ï¼ŒLinkedTransferQueueå®é™…ä¸Šæ˜¯ConcurrentLinkedQueueã€SynchronousQueueï¼ˆå…¬å¹³æ¨¡å¼ï¼‰å’ŒLinkedBlockingQueueçš„è¶…é›†ã€‚è€Œä¸”LinkedTransferQueueæ›´å¥½ç”¨ï¼Œå› ä¸ºå®ƒä¸ä»…ä»…ç»¼åˆäº†è¿™å‡ ä¸ªç±»çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ›´é«˜æ•ˆçš„å®ç°ã€‚</p><p>LinkedTransferQueueæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜»å¡é˜Ÿåˆ—LinkedTransferQueueå¤šäº†tryTransferå’Œtransferæ–¹æ³•ã€‚</p><p>LinkedTransferQueueä¸SynchronousQueueä¸­å…¬å¹³æ¨¡å¼çš„å®ç°TransferQueueæ˜¯ä¸€æ ·çš„ï¼Œé˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä¸æ˜¯æ•°æ®ï¼Œè€Œæ˜¯æ“ä½œï¼ˆå–å‡ºæ•°æ®çš„æ“ä½œtakeå’Œæ”¾å…¥æ•°æ®çš„æ“ä½œputï¼‰é˜Ÿåˆ—ä¸­æ—¢å¯ä»¥å­˜æ”¾takeæ“ä½œä¹Ÿå¯ä»¥å­˜æ”¾putæ“ä½œï¼Œä½†æ˜¯é˜Ÿåˆ—ä¸­ä¸èƒ½åŒæ—¶å­˜åœ¨ä¸¤ç§ä¸åŒçš„æ“ä½œï¼Œå› ä¸ºä¸åŒçš„æ“ä½œä¼šè§¦å‘é˜Ÿåˆ—è¿›è¡Œé…å¯¹ï¼ˆæ“ä½œå‡ºé˜Ÿï¼‰ã€‚</p><p><strong>transferæ–¹æ³•</strong>ã€‚å¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…æ­£åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼ˆæ¶ˆè´¹è€…ä½¿ç”¨take()æ–¹æ³•æˆ–å¸¦æ—¶é—´é™åˆ¶çš„poll()æ–¹æ³•æ—¶ï¼‰ï¼Œtransferæ–¹æ³•å¯ä»¥æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç«‹åˆ»transferï¼ˆä¼ è¾“ï¼‰ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œtransferæ–¹æ³•ä¼šå°†å…ƒç´ å­˜æ”¾åœ¨é˜Ÿåˆ—çš„tailèŠ‚ç‚¹ï¼Œå¹¶ç­‰åˆ°è¯¥å…ƒç´ è¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚transferæ–¹æ³•çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">xfer</span><span class="params">(E e, <span class="keyword">boolean</span> haveData, <span class="keyword">int</span> how, <span class="keyword">long</span> nanos)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (haveData && (e == <span class="keyword">null</span>))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    Node s = <span class="keyword">null</span>;                        <span class="comment">// the node to append, if needed</span></span><br><span class="line"></span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (;;) {                            <span class="comment">// restart on append race</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Node h = head, p = h; p != <span class="keyword">null</span>;) { <span class="comment">// find & match first node</span></span><br><span class="line">            <span class="keyword">boolean</span> isData = p.isData;</span><br><span class="line">            Object item = p.item;</span><br><span class="line">            <span class="keyword">if</span> (item != p && (item != <span class="keyword">null</span>) == isData) { <span class="comment">// unmatched</span></span><br><span class="line">                <span class="keyword">if</span> (isData == haveData)   <span class="comment">// can't match</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> (p.casItem(item, e)) { <span class="comment">// match</span></span><br><span class="line">                    <span class="keyword">for</span> (Node q = p; q != h;) {</span><br><span class="line">                        Node n = q.next;  <span class="comment">// update by 2 unless singleton</span></span><br><span class="line">                        <span class="keyword">if</span> (head == h && casHead(h, n == <span class="keyword">null</span> ? q : n)) {</span><br><span class="line">                            h.forgetNext();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        }                 <span class="comment">// advance and retry</span></span><br><span class="line">                        <span class="keyword">if</span> ((h = head)   == <span class="keyword">null</span> ||</span><br><span class="line">                            (q = h.next) == <span class="keyword">null</span> || !q.isMatched())</span><br><span class="line">                            <span class="keyword">break</span>;        <span class="comment">// unless slack < 2</span></span><br><span class="line">                    }</span><br><span class="line">                    LockSupport.unpark(p.waiter);</span><br><span class="line">                    <span class="keyword">return</span> LinkedTransferQueue.<e>cast(item);</e></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            Node n = p.next;</span><br><span class="line">            p = (p != n) ? n : (h = head); <span class="comment">// Use head if p offlist</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (how != NOW) {                 <span class="comment">// No matches available</span></span><br><span class="line">            <span class="keyword">if</span> (s == <span class="keyword">null</span>)</span><br><span class="line">                s = <span class="keyword">new</span> Node(e, haveData);</span><br><span class="line">            <span class="comment">//ï¼ˆ1ï¼‰å°è¯•æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨</span></span><br><span class="line">            Node pred = tryAppend(s, haveData);</span><br><span class="line">            <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">continue</span> retry;           <span class="comment">// lost race vs opposite mode</span></span><br><span class="line">            <span class="keyword">if</span> (how != ASYNC)</span><br><span class="line">            <span class="comment">//ï¼ˆ2ï¼‰ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line">                <span class="keyword">return</span> awaitMatch(s, pred, e, (how == TIMED), nanos);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> e; <span class="comment">// not waiting</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ï¼ˆ1ï¼‰ä»£ç æ˜¯è¯•å›¾æŠŠå­˜æ”¾å½“å‰å…ƒç´ çš„sèŠ‚ç‚¹ä½œä¸ºtailèŠ‚ç‚¹ã€‚ï¼ˆ2ï¼‰ä»£ç æ˜¯è®©CPUè‡ªæ—‹ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹å…ƒç´ ã€‚å› ä¸ºè‡ªæ—‹ä¼šæ¶ˆè€—CPUï¼Œæ‰€ä»¥è‡ªæ—‹ä¸€å®šçš„æ¬¡æ•°åä½¿ç”¨Thread.yield()æ–¹æ³•æ¥æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚</p><p><strong>tryTransferæ–¹æ³•</strong>ã€‚åˆ™æ˜¯ç”¨æ¥è¯•æ¢ä¸‹ç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ æ˜¯å¦èƒ½ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œåˆ™è¿”å›falseã€‚å’Œtransferæ–¹æ³•çš„åŒºåˆ«æ˜¯tryTransferæ–¹æ³•æ— è®ºæ¶ˆè´¹è€…æ˜¯å¦æ¥æ”¶ï¼Œæ–¹æ³•ç«‹å³è¿”å›ã€‚è€Œtransferæ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚</p><p>å¯¹äºå¸¦æœ‰æ—¶é—´é™åˆ¶çš„tryTransfer(E e, long timeout, TimeUnit unit)æ–¹æ³•ï¼Œåˆ™æ˜¯è¯•å›¾æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥å…ƒç´ åˆ™ç­‰å¾…æŒ‡å®šçš„æ—¶é—´å†è¿”å›ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æ¶ˆè´¹å…ƒç´ ï¼Œåˆ™è¿”å›falseï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ¶ˆè´¹äº†å…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚</p><p><strong>å®ä¾‹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> juc_study.collection.blocking;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedTransferQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedTransferQueueDemo</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> LinkedTransferQueue<string> lnkTransQueue = <span class="keyword">new</span> LinkedTransferQueue<string>();</string></string></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ExecutorService exService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">        Producer producer = <span class="keyword">new</span> LinkedTransferQueueDemo().<span class="keyword">new</span> Producer();</span><br><span class="line">        Consumer consumer = <span class="keyword">new</span> LinkedTransferQueueDemo().<span class="keyword">new</span> Consumer();</span><br><span class="line">        exService.execute(producer);</span><br><span class="line">        exService.execute(consumer);</span><br><span class="line">        exService.shutdown();</span><br><span class="line">    }</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>{</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">3</span>;i++){</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    System.out.println(<span class="string">"Producer is waiting to transfer..."</span>);</span><br><span class="line">                    lnkTransQueue.transfer(<span class="string">"A"</span>+i);</span><br><span class="line">                    System.out.println(<span class="string">"producer transfered element: A"</span>+i);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>{</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">3</span>;i++){</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    System.out.println(<span class="string">"Consumer is waiting to take element..."</span>);</span><br><span class="line">                    String s= lnkTransQueue.take();</span><br><span class="line">                    System.out.println(<span class="string">"Consumer received Element: "</span>+s);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="LinkedBlockingDeque"><a href="#LinkedBlockingDeque" class="headerlink" title="LinkedBlockingDeque"></a>LinkedBlockingDeque</h3><p>LinkedBlockingDequeæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚æ‰€è°“åŒå‘é˜Ÿåˆ—æŒ‡çš„ä½ å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œç§»å‡ºå…ƒç´ ã€‚åŒç«¯é˜Ÿåˆ—å› ä¸ºå¤šäº†ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—çš„å…¥å£ï¼Œåœ¨å¤šçº¿ç¨‹åŒæ—¶å…¥é˜Ÿæ—¶ï¼Œä¹Ÿå°±å‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚ç›¸æ¯”å…¶ä»–çš„é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedBlockingDequeå¤šäº†addFirstï¼ŒaddLastï¼ŒofferFirstï¼ŒofferLastï¼ŒpeekFirstï¼ŒpeekLastç­‰æ–¹æ³•ï¼Œä»¥Firstå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–ï¼ˆpeekï¼‰æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä»¥Lastå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚å¦å¤–æ’å…¥æ–¹æ³•addç­‰åŒäºaddLastï¼Œç§»é™¤æ–¹æ³•removeç­‰æ•ˆäºremoveFirstã€‚ä½†æ˜¯takeæ–¹æ³•å´ç­‰åŒäºtakeFirstï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯Jdkçš„bugï¼Œä½¿ç”¨æ—¶è¿˜æ˜¯ç”¨å¸¦æœ‰Firstå’ŒLaståç¼€çš„æ–¹æ³•æ›´æ¸…æ¥šã€‚åœ¨åˆå§‹åŒ–LinkedBlockingDequeæ—¶å¯ä»¥åˆå§‹åŒ–é˜Ÿåˆ—çš„å®¹é‡ï¼Œç”¨æ¥é˜²æ­¢å…¶å†æ‰©å®¹æ—¶è¿‡æ¸¡è†¨èƒ€ã€‚å¦å¤–åŒå‘é˜»å¡é˜Ÿåˆ—å¯ä»¥è¿ç”¨åœ¨â€œå·¥ä½œçªƒå–â€æ¨¡å¼ä¸­ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://my.oschina.net/bzhangpoorman/blog/3044802" target="_blank" rel="noopener">å¹¶å‘å®¹å™¨å­¦ä¹ â€”LinkedTransferQueue</a></p><p><a href="https://blog.csdn.net/YJian2008/article/details/16951811" target="_blank" rel="noopener">é˜»å¡é˜Ÿåˆ—ä¹‹LinkedTransferQueue</a></p><p><a href="https://www.jianshu.com/p/2659eb72134b" target="_blank" rel="noopener">å¹¶å‘é˜Ÿåˆ—-æ— ç•Œé˜»å¡å»¶è¿Ÿé˜Ÿåˆ—DelayQueueåŸç†æ¢ç©¶</a></p><p><a href="http://ifeve.com/blocking-queues/" target="_blank" rel="noopener">å¹¶å‘ç¼–ç¨‹ç½‘</a></p><p><a href="http://ifeve.com/java-transfer-queue/" target="_blank" rel="noopener">Java 7ä¸­çš„TransferQueue</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ThreadPoolExecutoræºç </title>
      <link href="/2019/07/30/executor-kuang-jia/"/>
      <url>/2019/07/30/executor-kuang-jia/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="æ·±å…¥ThreadPoolExecutoræºç "><a href="#æ·±å…¥ThreadPoolExecutoræºç " class="headerlink" title="æ·±å…¥ThreadPoolExecutoræºç "></a>æ·±å…¥ThreadPoolExecutoræºç </h2><h3 id="ç±»ç»“æ„"><a href="#ç±»ç»“æ„" class="headerlink" title="ç±»ç»“æ„"></a>ç±»ç»“æ„</h3><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190802/wTkHh1NbyM8K.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™é‡Œä¸»è¦è¦è¯´çš„æ˜¯ <code>ThreadPoolExecutor</code>ç±»</p><h3 id="çº¿ç¨‹æ± çŠ¶æ€"><a href="#çº¿ç¨‹æ± çŠ¶æ€" class="headerlink" title="çº¿ç¨‹æ± çŠ¶æ€"></a>çº¿ç¨‹æ± çŠ¶æ€</h3><p>æ‰“å¼€æºç æ˜ å…¥çœ¼å¸˜çš„å°±æ˜¯è¿™å‡ ä¸ªå­—æ®µå’Œæ–¹æ³•ï¼Œå¯¹åº”çš„å°±æ˜¯çº¿ç¨‹æ± çš„ä¸€äº›è¿è¡ŒçŠ¶æ€å’Œç›¸å…³æ–¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ§åˆ¶çº¿ç¨‹æ± ä¸­æ•°é‡å’ŒçŠ¶æ€çš„å­—æ®µ,ç”¨AtomicIntegerä¿å­˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger ctl = <span class="keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="number">0</span>));</span><br><span class="line"><span class="comment">//count bité¡¾åæ€ä¹‰å°±æ˜¯ workerCountçš„ä½æ•°ï¼Œè¿™é‡Œæ˜¯29</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COUNT_BITS = Integer.SIZE - <span class="number">3</span>;</span><br><span class="line"><span class="comment">//1<<29 -1 == 1111....1111(29ä¸ª1) çº¿ç¨‹æ•°(workerCount)ä¸Šé™ å¤§çº¦5äº¿</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CAPACITY   = (<span class="number">1</span> << COUNT_BITS) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// runState is stored in the high-order bits</span></span><br><span class="line"><span class="comment">//é«˜ä¸‰ä½å­˜æ”¾çŠ¶æ€ï¼Œç›¸åº”çš„ä½29ä½å°±æ˜¯workerCount</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNNING    = -<span class="number">1</span> << COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHUTDOWN   =  <span class="number">0</span> << COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP       =  <span class="number">1</span> << COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TIDYING    =  <span class="number">2</span> << COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TERMINATED =  <span class="number">3</span> << COUNT_BITS;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Packing and unpacking ctl</span></span><br><span class="line"><span class="comment">// æ‹†è§£ctlè·å–çŠ¶æ€å’Œæ•°é‡</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">runStateOf</span><span class="params">(<span class="keyword">int</span> c)</span>     </span>{ <span class="keyword">return</span> c & ~CAPACITY; }</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">workerCountOf</span><span class="params">(<span class="keyword">int</span> c)</span>  </span>{ <span class="keyword">return</span> c & CAPACITY; }</span><br><span class="line"><span class="comment">// æ‹¼æ¥çŠ¶æ€å’Œæ•°é‡å¾—åˆ°ctl</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">ctlOf</span><span class="params">(<span class="keyword">int</span> rs, <span class="keyword">int</span> wc)</span> </span>{ <span class="keyword">return</span> rs | wc; }</span><br></pre></td></tr></tbody></table></figure></div><h4 id="çŠ¶æ€è½¬æ¢è¿‡ç¨‹"><a href="#çŠ¶æ€è½¬æ¢è¿‡ç¨‹" class="headerlink" title="çŠ¶æ€è½¬æ¢è¿‡ç¨‹"></a>çŠ¶æ€è½¬æ¢è¿‡ç¨‹</h4><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190802/EWlphYbCMVjv.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ğŸ’¡ <strong>RUNNING</strong> ï¼šèƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›</p><p>ğŸ’¡ <strong>SHUTDOWN</strong>ï¼šå…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å´å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡ã€‚åœ¨çº¿ç¨‹æ± å¤„äº <code>RUNNING</code> çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ <code>shutdown()</code>æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚ï¼ˆ<code>finalize()</code> æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šè°ƒç”¨shutdown()æ–¹æ³•è¿›å…¥è¯¥çŠ¶æ€ï¼‰</p><p>ğŸ’¡ <strong>STOP</strong>ï¼šä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº <code>RUNNING</code> æˆ– <code>SHUTDOWN</code> çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ <code>shutdownNow()</code> æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€</p><p>ğŸ’¡ <strong>TIDYING</strong>ï¼šå¦‚æœæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼ŒworkerCount (æœ‰æ•ˆçº¿ç¨‹æ•°) ä¸º0ï¼Œçº¿ç¨‹æ± è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒç”¨ terminated() æ–¹æ³•è¿›å…¥TERMINATED çŠ¶æ€</p><p>ğŸ’¡ <strong>TERMINATED</strong>ï¼šåœ¨terminated() æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€ï¼Œé»˜è®¤terminated()æ–¹æ³•ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚</p><p>è¿›å…¥<code>TERMINATED</code>çš„æ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li>çº¿ç¨‹æ± ä¸æ˜¯RUNNINGçŠ¶æ€ï¼›</li><li>çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯TIDYINGçŠ¶æ€æˆ–TERMINATEDçŠ¶æ€ï¼›</li><li>å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ˜¯SHUTDOWNå¹¶ä¸”workerQueueä¸ºç©ºï¼›</li><li>workerCountä¸º0ï¼›</li><li>è®¾ç½®TIDYINGçŠ¶æ€æˆåŠŸã€‚</li></ul><h3 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h3><p>å†å¾€ä¸‹ï¼Œå°±ä¼šçœ‹è§ä¸€äº›å¾ˆé‡è¦çš„æˆå‘˜å˜é‡</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œå­˜æ”¾å¾…æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue<runnable> workQueue; </runnable></span><br><span class="line"><span class="comment">//å¯é‡å…¥é”ï¼Œçº¿ç¨‹æ± ä¸»è¦çš„é”</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="comment">//çº¿ç¨‹é›†åˆ(çº¿ç¨‹æ± çš„workersé›†åˆ)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> HashSet<worker> workers = <span class="keyword">new</span> HashSet<worker>();</worker></worker></span><br><span class="line"><span class="comment">//å¯¹åº”çš„æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Condition termination = mainLock.newCondition(); </span><br><span class="line"><span class="comment">//ç”¨æ¥è®°å½•çº¿ç¨‹æ± ä¸­æ›¾ç»å‡ºç°è¿‡çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå’Œçº¿ç¨‹æ± å®¹é‡æ²¡æœ‰å…³ç³»</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> largestPoolSize;</span><br><span class="line"><span class="comment">//ç”¨æ¥è®°å½•å·²ç»æ‰§è¡Œå®Œæ¯•çš„ä»»åŠ¡ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> completedTaskCount; </span><br><span class="line"><span class="comment">//å·¥å‚æ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> ThreadFactory threadFactory; </span><br><span class="line"><span class="comment">//æ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> RejectedExecutionHandler handler; </span><br><span class="line"><span class="comment">//çº¿ç¨‹é—²ç½®æ—¶å€™çš„æœ€å¤§å­˜æ´»æ—¶é—´</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> keepAliveTime; </span><br><span class="line"><span class="comment">//æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹é—²ç½®çš„æ—¶å€™è¶…æ—¶</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> allowCoreThreadTimeOut; </span><br><span class="line"><span class="comment">//æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> corePoolSize; </span><br><span class="line"><span class="comment">//æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> maximumPoolSize; </span><br><span class="line"><span class="comment">//é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼šAbortPolicyç›´æ¥æ‹’ç»å¹¶æŠ›å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RejectedExecutionHandler defaultHandler = <span class="keyword">new</span> AbortPolicy();</span><br></pre></td></tr></tbody></table></figure></div><h3 id="execute"><a href="#execute" class="headerlink" title="execute()"></a>execute()</h3><p> <strong>æºç åˆ†æ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–çº¿ç¨‹æ± çš„çŠ¶æ€å’Œçº¿ç¨‹æ•°é‡</span></span><br><span class="line">    <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) < corePoolSize) { <span class="comment">//workerCountå°äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡</span></span><br><span class="line">        <span class="comment">//å°†ä»»åŠ¡æ·»åŠ åˆ°workersä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨æ˜¯å¦æ ¹æ®corePoolSizeæ¥æ·»åŠ çº¿ç¨‹ï¼Œfalseåˆ™æ ¹æ®maxPoolSize</span></span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//æ·»åŠ å¤±è´¥ï¼Œé‡æ–°è·å–ctl</span></span><br><span class="line">        c = ctl.get();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä¸Šé¢æ·»åŠ åˆ°workersä¸­å¤±è´¥ï¼Œæœ‰å¯èƒ½æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¸å¤Ÿç”¨äº†æˆ–è€…çº¿ç¨‹æ± ä¸æ˜¯è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">    <span class="comment">//å¦‚æœçº¿ç¨‹æ± æ˜¯RunningçŠ¶æ€ å°è¯•æ·»åŠ ä»»åŠ¡åˆ°é˜»å¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) && workQueue.offer(command)) {</span><br><span class="line">        <span class="comment">//æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—æˆåŠŸï¼Œé‡æ–°è·å–ctl</span></span><br><span class="line">        <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">        <span class="comment">//å¦‚æœçº¿ç¨‹æ± ä¸æ˜¯RunningçŠ¶æ€å°±ä»ç­‰å¾…é˜Ÿåˆ—ä¸­removeè¿™ä¸ªä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) && remove(command))</span><br><span class="line">            reject(command); <span class="comment">//é‡‡ç”¨æ‹’ç»ç­–ç•¥æ‹’ç»è¯¥ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//çº¿ç¨‹æ± Runningä½†æ˜¯æ²¡æœ‰çº¿ç¨‹</span></span><br><span class="line">            <span class="comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä½†æ˜¯ä¸ä¼ å…¥Runnable(å·²ç»åœ¨é˜»å¡é˜Ÿåˆ—ä¸­äº†)</span></span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">    <span class="comment">//1. çº¿ç¨‹æ± ä¸æ˜¯RunningçŠ¶æ€å¹¶ä¸”commandä¸ä¸ºnullï¼ŒaddWorkerä¼šç›´æ¥falseç„¶åæ‹’ç»è¿™ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="comment">//2. æ·»åŠ åˆ°workQueue(é˜»å¡é˜Ÿåˆ—)å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯ queueæ»¡äº†ï¼Œå¯èƒ½æ˜¯éœ€è¦æ‰©å®¹äº†</span></span><br><span class="line">    <span class="comment">//   æ‰€ä»¥åé¢çš„å‚æ•°æ˜¯falseï¼Œæ·»åŠ å¤±è´¥ä¹Ÿä¼šç›´æ¥æ‹’ç»</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">        reject(command);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œè¦ç†è§£addWorkerçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œtrueåˆ™ä»£è¡¨å½“å‰çº¿ç¨‹æ± çš„<strong>ä¸Šç•Œ</strong>ä»ç„¶æ˜¯corePoolSizeï¼Œåé¢çš„addWorkerä¼šæ ¹æ®ä¸Šç•Œæ¥åˆ¤æ–­æ˜¯å¦å¢åŠ çº¿ç¨‹ï¼Œfalseåˆ™ä»£è¡¨<strong>ä¸Šç•Œ</strong>æ˜¯maximumPoolSizeï¼Œè¿™ä¸€ç‚¹åœ¨åé¢çš„åˆ†æä¸­ä¼šçœ‹åˆ°ã€‚</p><p><strong>Executorå¤§è‡´æ‰§è¡Œæµç¨‹</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190803/j3xQrmOkc3Kl.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="addWorker"><a href="#addWorker" class="headerlink" title="addWorker()"></a>addWorker()</h3><p><code>addWorker()</code> çš„ä½œç”¨å°±æ˜¯åˆ›å»ºçº¿ç¨‹(Worker)å¹¶ä¸”æ·»åŠ åˆ°Workersé›†åˆä¸­ï¼Œç„¶åå¯åŠ¨çº¿ç¨‹</p><p><strong>æºç åˆ†æ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>{</span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// rs>=SHUTDOWNè¯´æ˜ä¸æ˜¯RUNNINGçŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (rs >= SHUTDOWN && !(rs == SHUTDOWN && firstTask == <span class="keyword">null</span> &&!workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">            <span class="comment">//å¦‚æœå¤§äºå¯å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œæˆ–è€…å¤§äºå½“å‰çš„çº¿ç¨‹æ± çš„ä¸Šç•Œï¼Œç›´æ¥false</span></span><br><span class="line">            <span class="comment">//ä¸Šé¢ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½œç”¨ä½“ç°å‡ºæ¥äº†ï¼Œä¸ºtrueä¸Šç•Œåˆ™æ˜¯corePoolSize</span></span><br><span class="line">            <span class="keyword">if</span> (wc >= CAPACITY || wc >= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">//åˆ©ç”¨CASè‡ªå¢ å¢å¤§workCountçº¿ç¨‹æ•°ï¼ŒæˆåŠŸåå°±è·³å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">break</span> retry;</span><br><span class="line">            <span class="comment">//CASå¤±è´¥ï¼Œé‡æ–°è·å–ctl</span></span><br><span class="line">            c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">            <span class="comment">//åˆ¤æ–­è¿˜æ˜¯ä¸æ˜¯RunningçŠ¶æ€(èƒ½åˆ°è¿™é‡Œè¯´æ˜rs==RunningçŠ¶æ€)ï¼Œä¸æ˜¯çš„è¯å°±è·³å‡ºå»é‡æ–°æ¥è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (runStateOf(c) != rs)</span><br><span class="line">                <span class="keyword">continue</span> retry;</span><br><span class="line">            <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">            <span class="comment">// CASå¤±è´¥å¹¶ä¸”è¿˜æ˜¯RunningçŠ¶æ€ï¼Œç»§ç»­è‡ªæ—‹å°è¯•è‡ªå¢</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ˜¯å¦å¯åŠ¨ï¼Œä»¥åŠçº¿ç¨‹æ˜¯å¦æ·»åŠ </span></span><br><span class="line">    <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">    Worker w = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªWorker(å¯¹çº¿ç¨‹çš„å°è£…)</span></span><br><span class="line">        w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">        <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">        <span class="keyword">if</span> (t != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">// Recheck while holding lock.</span></span><br><span class="line">                <span class="comment">// Back out on ThreadFactory failure or if</span></span><br><span class="line">                <span class="comment">// shut down before lock acquired.</span></span><br><span class="line">                <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line"><span class="comment">//æ˜¯RUNNINGçŠ¶æ€ æˆ–è€… æ˜¯SHUTDOWNçŠ¶æ€ä¸”æ²¡æœ‰æäº¤ä»»åŠ¡(SHUTDOWNçŠ¶æ€è¿˜å¯ä»¥æ‰§è¡Œé˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡)</span></span><br><span class="line">                <span class="keyword">if</span> (rs < SHUTDOWN ||</span><br><span class="line">                    (rs == SHUTDOWN && firstTask == <span class="keyword">null</span>)) {</span><br><span class="line">                    <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                    <span class="comment">//æ·»åŠ åˆ°å·¥ä½œé›†ä¸­</span></span><br><span class="line">                    workers.add(w);</span><br><span class="line">                    <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                    <span class="keyword">if</span> (s > largestPoolSize)</span><br><span class="line">                        largestPoolSize = s; <span class="comment">//è®°å½•æœ€å¤§å€¼</span></span><br><span class="line">                    workerAdded = <span class="keyword">true</span>; <span class="comment">//æ·»åŠ æˆåŠŸ</span></span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (workerAdded) {</span><br><span class="line">                <span class="comment">//å¯åŠ¨çº¿ç¨‹ï¼Œæ‰§è¡ŒWorkerçš„runæ–¹æ³•</span></span><br><span class="line">                t.start(); </span><br><span class="line">                workerStarted = <span class="keyword">true</span>; <span class="comment">//å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">            <span class="comment">//å¯åŠ¨å¤±è´¥ï¼Œå›æ»šworkerså¹¶å°è¯•å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">            addWorkerFailed(w);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> workerStarted;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦é€‚åˆç»§ç»­addWorkerï¼Œåˆ†æè¿™é‡Œçš„ifæ¡ä»¶ï¼ŒRUNNINGä¸ä¼šfalse ï¼ŒSTOPï¼ŒTIDYINGï¼ŒTERMINATEDç›´æ¥falseï¼ŒSHUTDOWNçŠ¶æ€å¦‚æœfirstTaskä¸ºç©º é˜»å¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡çš„æ—¶å€™ä¸ä¼šfalseï¼Œå…¶ä»–æƒ…å†µéƒ½falseã€‚</p><p>ğŸ”¸ è·å–å½“å‰çš„workerCountåˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†å½“å‰çš„ä¸Šç•Œï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†ç¬¬äºŒä¸ªå‚æ•°</p><p>ğŸ”¸ ç„¶ååˆ©ç”¨CASè‡ªæ—‹å¢åŠ workerCount</p><p>ğŸ”¸ åˆ›å»ºWorkerå¯¹è±¡ï¼Œè·å–mainLockå¹¶åŠ é”ï¼Œå› ä¸ºworkersæ˜¯HashSetå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><p>ğŸ”¸ å†æ¬¡è·å–çº¿ç¨‹æ± è½¬å°å¹¶åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œåˆæ³•å°±æ·»åŠ åˆ°workersä¸­ï¼Œç„¶ååœ¨finallyå—ä¸­é‡Šæ”¾é”</p><p>ğŸ”¸ æ ¹æ®å‰é¢çš„workerAdded åˆ¤æ–­æ˜¯å¦å¯åŠ¨çº¿ç¨‹</p><p>ğŸ”¸ åœ¨æœ€ç»ˆçš„finallyå—ä¸­æ ¹æ®æ˜¯å¦å¯åŠ¨æˆåŠŸæ¥å†³å®šæ˜¯å¦å›æ»š</p><h3 id="addWorkerFailed"><a href="#addWorkerFailed" class="headerlink" title="addWorkerFailed()"></a>addWorkerFailed()</h3><p>å¯åŠ¨å¤±è´¥ï¼Œå›æ»šä¹‹å‰çš„æ·»åŠ æ“ä½œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addWorkerFailed</span><span class="params">(Worker w)</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    <span class="comment">//è·å–é”</span></span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (w != <span class="keyword">null</span>)</span><br><span class="line">            <span class="comment">//ä»workersä¸­ç§»é™¤</span></span><br><span class="line">            workers.remove(w);</span><br><span class="line">        <span class="comment">//å‡å°‘workerCount</span></span><br><span class="line">        decrementWorkerCount();</span><br><span class="line">        <span class="comment">//å°è¯•å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        tryTerminate();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Workerç±»"><a href="#Workerç±»" class="headerlink" title="Workerç±»"></a>Workerç±»</h3><p>å°è£…äº†çº¿ç¨‹å¯¹è±¡ï¼Œçº¿ç¨‹æ± ç»´æŠ¤çš„å°±æ˜¯è¿™äº›worker</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This class will never be serialized, but we provide a</span></span><br><span class="line"><span class="comment">     * serialVersionUID to suppress a javac warning.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6138294804551838833L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Thread this worker is running in.  Null if factory fails. */</span></span><br><span class="line">    <span class="keyword">final</span> Thread thread;</span><br><span class="line">    <span class="comment">/** Initial task to run.  Possibly null. */</span></span><br><span class="line">    Runnable firstTask; <span class="comment">//ä¼ å…¥çš„ä»»åŠ¡</span></span><br><span class="line">    <span class="comment">/** Per-thread task counter */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> completedTasks;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates with given first task and thread from ThreadFactory.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> firstTask the first task (null if none)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Worker(Runnable firstTask) {</span><br><span class="line">        setState(-<span class="number">1</span>); <span class="comment">// è®¾ç½®çŠ¶æ€ä¸º -1</span></span><br><span class="line">        <span class="keyword">this</span>.firstTask = firstTask;</span><br><span class="line">        <span class="comment">//æ ¹æ®å·¥å‚æ–¹æ³•åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">        <span class="comment">//å°†Workerä¼ é€’è¿›å»ï¼Œä½œä¸ºThreadçš„å‚æ•°</span></span><br><span class="line">        <span class="comment">//new Thread(Worker worker);</span></span><br><span class="line">        <span class="keyword">this</span>.thread = getThreadFactory().newThread(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Delegates main run loop to outer runWorker  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        runWorker(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lock methods</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The value 0 represents the unlocked state.</span></span><br><span class="line">    <span class="comment">// The value 1 represents the locked state.</span></span><br><span class="line">    <span class="comment">// æ˜¯å¦è·å–åˆ°äº†é”</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> getState() != <span class="number">0</span>; </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>{</span><br><span class="line">        <span class="comment">//åˆ©ç”¨CASè®¾ç½®state</span></span><br><span class="line">        <span class="comment">//å¾ˆæ˜æ˜¾è¿™é‡Œæ˜¯ä¸ªä¸å¯é‡å…¥çš„ç‹¬å é”ï¼Œå…·ä½“å¯ä»¥å¯¹æ¯”ReentrantLockçš„å®ç°æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) {</span><br><span class="line">            <span class="comment">//ç»§æ‰¿è‡ªAbstractOwnableSynchronizer</span></span><br><span class="line">            <span class="comment">//ä¿å­˜å½“å‰çš„æŒæœ‰é”çš„çº¿ç¨‹</span></span><br><span class="line">            setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//é‡Šæ”¾é”è®¾ç½®state=0</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>{</span><br><span class="line">        <span class="comment">//è®¾ç½®ç‹¬å é”çº¿ç¨‹ä¸ºç©º</span></span><br><span class="line">        setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">        setState(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span>        </span>{ acquire(<span class="number">1</span>); } <span class="comment">//æœ€ç»ˆä¼šè°ƒç”¨tryAcquire(1);</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span>  </span>{ <span class="keyword">return</span> tryAcquire(<span class="number">1</span>); }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span>      </span>{ release(<span class="number">1</span>); } <span class="comment">//æœ€ç»ˆä¼šè°ƒç”¨tryRelease(1);</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>{ <span class="keyword">return</span> isHeldExclusively(); }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰“æ–­å·²ç»å¯åŠ¨çš„çº¿ç¨‹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">interruptIfStarted</span><span class="params">()</span> </span>{</span><br><span class="line">        Thread t;</span><br><span class="line">        <span class="keyword">if</span> (getState() >= <span class="number">0</span> && (t = thread) != <span class="keyword">null</span> && !t.isInterrupted()) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                t.interrupt();</span><br><span class="line">            } <span class="keyword">catch</span> (SecurityException ignore) {</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°Workerç»§æ‰¿äº†AQSå¹¶ä¸”å®ç°äº†Runnableæ¥å£ï¼Œç„¶åå€ŸåŠ©AQSå®ç°äº†ä¸€ä¸ª<code>ç‹¬å çš„ä¸å¯é‡å…¥çš„é”</code>ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯å¾ˆå·§å¦™çš„ä¸€ç‚¹ï¼ˆè¿™é‡Œæˆ‘å’Œåšå®¢ä¸Šçš„ç†è§£æœ‰ç‚¹å‡ºå…¥ï¼‰ã€‚</p><p>åˆ°è¿™é‡Œå¤§å®¶è‚¯å®šä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¦å®ç°AQSç„¶åå®ç°ä¸€ä¸ªé”ï¼Ÿæ—¢ç„¶è¦åˆä¸ºä»€ä¹ˆè¦å®ç°ä¸€ä¸ªä¸å¯é‡å…¥çš„ï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨<code>ReentrantLock</code> é‚£ä¸æ˜¯æ›´åŠ æ–¹ä¾¿ä¹ˆï¼Ÿï¼Ÿé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªå°ç»†èŠ‚å°±æ˜¯æ„é€ å™¨é‡Œé¢ä¸ºä»€ä¹ˆ<code>setState(-1)</code>  è¿™æ ·ä¸å°±è·å–ä¸åˆ°é”äº†ä¹ˆï¼Ÿï¼Ÿ</p><p>å…¶å®è¿™æ˜¯ä¸ºäº†åé¢<code>shutdown</code>çš„æ—¶å€™<code>interruptIdleWorkers</code>èƒ½åˆ¤æ–­å‡ºçº¿ç¨‹æ˜¯å¦åœ¨å·¥ä½œï¼Œä»è€Œæ‰“æ–­é‚£äº›ç©ºé—²çš„çº¿ç¨‹ã€‚å¦‚æœä½¿ç”¨å¯é‡å…¥é”çš„è¯å°±æ— æ³•é€šè¿‡<code>tryLock()</code> æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœ¨å·¥ä½œã€‚è€Œ<code>setState(-1)</code> åˆ™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨ä»»åŠ¡æ²¡æœ‰å¼€å§‹å‰è¢«æ‰“æ–­</p><h3 id="runWorker"><a href="#runWorker" class="headerlink" title="runWorker()"></a>runWorker()</h3><p>åœ¨ä¸Šé¢<code>AddWorker()</code>æœ€åæ·»åŠ æˆåŠŸåä¼šå¯åŠ¨Workerçº¿ç¨‹ï¼Œè€Œåœ¨workerçº¿ç¨‹ä¸­runæ–¹æ³•åˆä¼šè°ƒç”¨ä¸€ä¸ª<code>runWorker()</code>æ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯å…·ä½“æ‰§è¡Œä»»åŠ¡çš„åœ°æ–¹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runWorker</span><span class="params">(Worker w)</span> </span>{</span><br><span class="line">    <span class="comment">//å½“å‰æ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line">    Thread wt = Thread.currentThread();</span><br><span class="line">    <span class="comment">//æ‹¿åˆ°ä»»åŠ¡</span></span><br><span class="line">    Runnable task = w.firstTask; </span><br><span class="line">    w.firstTask = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//å‰é¢æ„é€ workerçš„æ—¶å€™è®¾ç½®äº†state=-1</span></span><br><span class="line">    <span class="comment">//è®¾ç½®stateä¸º0ï¼ŒtryRelease(1)</span></span><br><span class="line">    <span class="comment">//å…¶å®è¿™æ ·æ˜¯ä¸ºäº†åœ¨è¿™ä¹‹å‰ä¸ä¼šè¢«æ‰“æ–­ï¼ˆè¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼‰</span></span><br><span class="line">    w.unlock(); <span class="comment">// allow interrupts</span></span><br><span class="line">    <span class="keyword">boolean</span> completedAbruptly = <span class="keyword">true</span>; <span class="comment">//æ˜¯å¦å› ä¸ºå¼‚å¸¸è€Œé€€å‡ºï¼Ÿ</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//taskä¸ºç©ºå°±ä»é˜»å¡é˜Ÿåˆ—ä¸­æ‹¿ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="comment">//åŠ é”ï¼Œä½†æ˜¯è¿™ä¸ªé”ä¸ä¼šå’Œå…¶ä»–çš„Workeräº’æ–¥ï¼Œè¿™ä¸ªé”åªæ˜¯ç”¨æ¥åˆ¤æ–­workeræ˜¯å¦åœ¨å·¥ä½œ</span></span><br><span class="line">            w.lock();</span><br><span class="line">            <span class="comment">// If pool is stopping, ensure thread is interrupted;</span></span><br><span class="line">            <span class="comment">// if not, ensure thread is not interrupted.  This</span></span><br><span class="line">            <span class="comment">// requires a recheck in second case to deal with</span></span><br><span class="line">            <span class="comment">// shutdownNow race while clearing interrupt</span></span><br><span class="line">            <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                 (Thread.interrupted() &&</span><br><span class="line">                  runStateAtLeast(ctl.get(), STOP))) &&</span><br><span class="line">                !wt.isInterrupted())</span><br><span class="line">                <span class="comment">//æ‰“æ–­å½“å‰æ‰§è¡Œçº¿ç¨‹wt</span></span><br><span class="line">                wt.interrupt();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//ç©ºæ–¹æ³•äº¤ç»™å­ç±»å»å®ç°</span></span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                Throwable thrown = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    task.run(); <span class="comment">//æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                } <span class="keyword">catch</span> (RuntimeException x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                } <span class="keyword">catch</span> (Error x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                } <span class="keyword">catch</span> (Throwable x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> <span class="keyword">new</span> Error(x);</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    <span class="comment">//ç©ºæ–¹æ³•äº¤ç»™å­ç±»å»å®ç°</span></span><br><span class="line">                    afterExecute(task, thrown);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                task = <span class="keyword">null</span>;</span><br><span class="line">                w.completedTasks++; <span class="comment">//å®Œæˆä»»åŠ¡æ•°++</span></span><br><span class="line">                w.unlock();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        completedAbruptly = <span class="keyword">false</span>; <span class="comment">//ä¸‹é¢çš„æ”¶å°¾å·¥ä½œä¼šæ ¹æ®è¿™ä¸ªåˆ¤æ–­æ˜¯å¦è°ƒæ•´çº¿ç¨‹æ•°</span></span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        processWorkerExit(w, completedAbruptly); <span class="comment">//æ”¶å°¾å·¥ä½œ</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ é¦–å…ˆè·å–äº†å‚æ•°ä¼ é€’è¿›æ¥çš„workeræºå¸¦çš„ä»»åŠ¡</p><p>ğŸ”¸ ç„¶åæ‰§è¡Œäº†w.unlock()ï¼Œå®é™…ä¸Šè¿™é‡Œå°±å¯¹åº”äº†ä¸Šé¢Workerç±»æ„é€ å™¨ä¸­çš„setState(-1)ï¼Œæ­£å› ä¸ºå‰é¢è®¾ç½®äº†stateä¸º -1 æ‰€ä»¥åœ¨unlock()ä¹‹å‰ï¼Œè·å¾—é”çš„CASæ“ä½œè‚¯å®šéƒ½ä¼šå¤±è´¥ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ä¸ºäº†åœ¨ä»»åŠ¡å¯åŠ¨å‰ä¸ä¼šè¢«æ‰“æ–­ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œunlock()å°±åˆå°†stateè®¾ç½®ä¸ºäº†0 ä¹Ÿå°±è¡¨ç¤ºå¯ä»¥é€šè¿‡CASè·å¾—é”äº†ï¼Œä¹Ÿå¯ä»¥è¢«shutdownæ‰“æ–­äº†ã€‚</p><p>ğŸ”¸ ç„¶åè¿™ä¸ªçº¿ç¨‹å°±ä¼šæ‰§è¡Œworkerä¸­çš„ä»»åŠ¡ï¼Œå¦‚æœworkerä¸­ä»»åŠ¡ä¸ºç©ºå°±ä¼šä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡</p><p>ğŸ”¸ è·å–åˆ°ä»»åŠ¡åè¿›å…¥å¾ªç¯å…ˆè¿›è¡Œ lock() æ“ä½œï¼Œè¿™å°±ä»£è¡¨å·²ç»å¼€å§‹æ‰§è¡Œä»»åŠ¡äº†ï¼Œè¿™ä¸ªæ—¶å€™shutdownå°±æ— æ³•å‘é€ä¸­æ–­ä¿¡å·ä¸­æ–­è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œ (æ³¨æ„è¿™ä¸ªlockå¹¶ä¸ä¼šå’Œå…¶ä»–çš„workeräº’æ–¥ï¼Œå› ä¸ºæ¯ä¸ªWorkeréƒ½æ˜¯æ–°newå‡ºæ¥çš„ï¼Œå®Œå…¨ä¸ç›¸å…³çš„ï¼Œä»–ä»¬çš„stateçŠ¶æ€éƒ½æ˜¯ç‹¬ç«‹çš„)</p><p>ğŸ”¸ <code>runStateAtLeast(ctl.get(), STOP)</code> è¿”å›<code>ctl.get() >= STOP</code>  ï¼Œåˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦æ­£åœ¨å…³é—­å¦‚æœæ˜¯å°±æ‰“æ–­è¯¥çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯éœ€è¦ç¡®ä¿çº¿ç¨‹ä¸æ˜¯InterruptçŠ¶æ€</p><p><code>If pool is stopping, ensure thread is interrupted;  if not, ensure thread is not interrupted.</code></p><p>ğŸ”¸<code>beforeExecute()</code> å’Œ<code>afterExecute()</code> éƒ½æ˜¯ç©ºæ–¹æ³•äº¤ç»™å­ç±»å»å®ç°çš„ã€‚</p><p>ğŸ”¸ åˆ°finallyå—é‡Œé¢å°±ä»£è¡¨è¿™ä¸ªå·¥ä½œçº¿ç¨‹å·²ç»å¿«è¦ç»“æŸäº†ï¼Œ<code>processWorkerExit()</code>  å°±æ˜¯å¤„ç†ä¸€äº›â€åäº‹â€çš„</p><h3 id="getTask"><a href="#getTask" class="headerlink" title="getTask()"></a>getTask()</h3><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡çš„ï¼Œå¦‚æœ <code>getTask()</code> è¿”å›nullï¼Œåœ¨<code>runWorker()</code> é‡Œé¢æ¥æ”¶åˆ°<code>null</code> åå°±ä¼š<strong>è·³å‡ºå¾ªç¯</strong>è¿›è€Œæ‰§è¡Œ<code>finally</code> å—é‡Œé¢çš„<code>processWorkerExit()</code> ã€‚è€Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªçº¿ç¨‹<code>æ‰§è¡Œç»“æŸ</code>äº†ï¼Œä¸ä¼šåœ¨æ‰§è¡Œä»»åŠ¡äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç­‰å¾…JVMå›æ”¶è¿™ä¸ªçº¿ç¨‹ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Runnable <span class="title">getTask</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">//æ˜¯å¦è¶…æ—¶ï¼Ÿå’ŒkeepAliveTimeç›¸å…³</span></span><br><span class="line">    <span class="keyword">boolean</span> timedOut = <span class="keyword">false</span>; <span class="comment">// Did the last poll() time out?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">        <span class="comment">// å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—æ²¡ä»»åŠ¡ æˆ–è€… çº¿ç¨‹çŠ¶æ€>=STOP</span></span><br><span class="line">        <span class="keyword">if</span> (rs >= SHUTDOWN && (rs >= STOP || workQueue.isEmpty())) {</span><br><span class="line">            decrementWorkerCount();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Are workers subject to culling?</span></span><br><span class="line">        <span class="comment">// æ˜¯å¦å…è®¸çº¿ç¨‹è¶…æ—¶ å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶(ä¸»åŠ¨è¶…æ—¶)ï¼Ÿ æˆ–è€…wcå¤§äºäº†æ ¸å¿ƒçº¿ç¨‹æ•°(è¢«åŠ¨è¶…æ—¶)</span></span><br><span class="line">        <span class="keyword">boolean</span> timed = allowCoreThreadTimeOut || wc > corePoolSize;</span><br><span class="line"><span class="comment">//æ­¤æ—¶éœ€è¦å›æ”¶å¤šä½™çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> ((wc > maximumPoolSize || (timed && timedOut))</span><br><span class="line">            && (wc > <span class="number">1</span> || workQueue.isEmpty())) {</span><br><span class="line">            <span class="keyword">if</span> (compareAndDecrementWorkerCount(c)) <span class="comment">//caså‡å°‘çº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">//è¿”å›null</span></span><br><span class="line">            <span class="keyword">continue</span>; <span class="comment">//caså¤±è´¥ ç»§ç»­å¾ªç¯</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//æ ¹æ®timedåˆ¤æ–­æ˜¯é™æ—¶è·å–è¿˜æ˜¯ç›´æ¥è·å–</span></span><br><span class="line">            Runnable r = timed ?</span><br><span class="line">                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :</span><br><span class="line">                workQueue.take(); <span class="comment">//é˜»å¡çš„è·å–</span></span><br><span class="line">            <span class="keyword">if</span> (r != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            <span class="comment">//æ²¡è·å–åˆ°ï¼Œè¶…æ—¶äº†</span></span><br><span class="line">            timedOut = <span class="keyword">true</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException retry) {</span><br><span class="line">            timedOut = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸ è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—æ²¡ä»»åŠ¡ æˆ–è€… çº¿ç¨‹çŠ¶æ€>=STOP å°±é€šè¿‡CASè‡ªæ—‹å‡å°‘çº¿ç¨‹æ•°ï¼Œç„¶åè¿”å›null</p><p>ğŸ”¸ åˆ¤æ–­æ˜¯å¦å…è®¸å½“å‰çº¿ç¨‹è·å–ä»»åŠ¡è¶…æ—¶ï¼Œå¦‚æœå…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶å°±ä»£è¡¨æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¶…æ—¶é™åˆ¶ï¼Œåˆæˆ–è€…æ˜¯å½“å‰çº¿ç¨‹æ•°è¶…è¿‡äº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡äº†æ‰©å®¹ï¼Œæ‰€ä»¥æ ¸å¿ƒçº¿ç¨‹ä¹‹å¤–çš„çº¿ç¨‹éƒ½æ˜¯æœ‰è¶…æ—¶é™åˆ¶çš„ã€‚</p><p>ğŸ”¸ å¦‚æœ â‘  wcè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°  â‘¡æ²¡è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯è¶…æ—¶äº†å¹¶ä¸”æ­¤æ—¶wc>1(ç•™ä¸€ä¸ªå¤„ç†ä»»åŠ¡)â‘¢æ²¡è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯è¶…æ—¶äº†å¹¶ä¸”é˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œæ­¤æ—¶éœ€è¦å›æ”¶å¤šä½™çš„çº¿ç¨‹</p><p>ğŸ”¸ æ ¹æ®timedé€‰å–ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡çš„æ–¹å¼ï¼Œè¦ä¹ˆæ˜¯é™æ—¶è·å–çš„pollæˆ–è€…ä¸€ç›´é˜»å¡çš„takeï¼Œè·å–åˆ°äº†ä¹‹åè¿”å›</p><h3 id="processWorkerExit"><a href="#processWorkerExit" class="headerlink" title="processWorkerExit()"></a>processWorkerExit()</h3><p>çœ‹åå­—å°±çŸ¥é“æ˜¯ä¸€ä¸ªæ”¶å°¾çš„æ–¹æ³•ï¼Œæ‰§è¡Œçº¿ç¨‹ç»“æŸåçš„ä¸€äº›å¿…è¦æ”¶å°¾å·¥ä½œã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processWorkerExit</span><span class="params">(Worker w, <span class="keyword">boolean</span> completedAbruptly)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (completedAbruptly) <span class="comment">// If abrupt, then workerCount wasn't adjusted</span></span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯å› ä¸ºå¼‚å¸¸è€Œé€€å‡ºåˆ™ getTask() æ²¡æœ‰æœºä¼šå»è°ƒæ•´çº¿ç¨‹æ•°æ‰€ä»¥éœ€è¦åœ¨è¿™é‡Œè°ƒæ•´</span></span><br><span class="line">        decrementWorkerCount();  <span class="comment">// wc--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//å®Œæˆä»»åŠ¡æ€»æ•°+=è¯¥workerå®Œæˆçš„ä»»åŠ¡æ•°</span></span><br><span class="line">        completedTaskCount += w.completedTasks;</span><br><span class="line">        <span class="comment">//ç§»é™¤å‡ºçº¿ç¨‹é›†workers</span></span><br><span class="line">        workers.remove(w);</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°è¯•ç»“æŸçº¿ç¨‹æ± </span></span><br><span class="line">    tryTerminate();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è·å–ctl</span></span><br><span class="line">    <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">    <span class="keyword">if</span> (runStateLessThan(c, STOP)) {</span><br><span class="line">        <span class="comment">//éå¼‚å¸¸ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (!completedAbruptly) {</span><br><span class="line">            <span class="comment">//æœ€å°å€¼æ ¹æ®æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶æ¥åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">int</span> min = allowCoreThreadTimeOut ? <span class="number">0</span> : corePoolSize;</span><br><span class="line">            <span class="keyword">if</span> (min == <span class="number">0</span> && ! workQueue.isEmpty())</span><br><span class="line">                min = <span class="number">1</span>; <span class="comment">//å¦‚æœæœ€å°ä¸º0å¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºåˆ™ä¿è¯çº¿ç¨‹æ± ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™äº›ä»»åŠ¡</span></span><br><span class="line">            <span class="keyword">if</span> (workerCountOf(c) >= min)</span><br><span class="line">                <span class="keyword">return</span>; <span class="comment">// replacement not needed</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//1.å¼‚å¸¸ç»“æŸï¼Œæ–°å¢åŠ ä¸€ä¸ªçº¿ç¨‹åˆ°çº¿ç¨‹æ± ,ç›¸å½“äºæ›¿æ¢äº†å¼‚å¸¸çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="comment">//2.éå¼‚å¸¸ç»“æŸï¼Œå·¥ä½œçº¿ç¨‹å°äºæ ¸å¿ƒçº¿ç¨‹ï¼Œå¢åŠ çº¿ç¨‹ï¼Œç¡®ä¿åœ¨ä¸å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶çš„æƒ…å†µä¸‹çº¿ç¨‹æ•°ä¸å°äºcorePoolSize</span></span><br><span class="line">        addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><code>runStateLessThan</code>  c < STOP è¿”å›trueå°±è¯´æ˜æ˜¯<code>SHUTDOWN</code> æˆ–è€…<code>RUNNING</code> ï¼Œåˆ°è¿™é‡Œè¯¥å·¥ä½œçº¿ç¨‹ï¼ˆWorkerï¼‰çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ã€‚</p><h3 id="å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h3><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190803/NbjiMxDqJlu4.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="tryTerminate"><a href="#tryTerminate" class="headerlink" title="tryTerminate()"></a>tryTerminate()</h3><p>åœ¨ä¸Šé¢çš„å¤„ç†æ”¶å°¾å·¥ä½œçš„<code>processWorkerExit()</code> çš„æ—¶å€™ä¸­é—´è°ƒç”¨äº†ä¸€ä¸ª <code>tryTerminate()</code> æ–¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">tryTerminate</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯åœ¨RUNNINGçŠ¶æ€ ç›´æ¥return</span></span><br><span class="line">        <span class="comment">//å¦‚æœå·²ç»æ˜¯TIDYINGæˆ–è€…TERMINATEDçŠ¶æ€ ç›´æ¥return</span></span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯SHUTDOWNçŠ¶æ€å¹¶ä¸”é˜»å¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ ç›´æ¥return</span></span><br><span class="line">        <span class="comment">//returnå°±è¯´æ˜çº¿ç¨‹æ± è¿˜ä¸åˆ°å…³é—­çš„æ—¶å€™</span></span><br><span class="line">        <span class="keyword">if</span> (isRunning(c) ||</span><br><span class="line">            runStateAtLeast(c, TIDYING) ||</span><br><span class="line">            (runStateOf(c) == SHUTDOWN && ! workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//åˆ°è¿™é‡Œå°±è¯´æ˜è¦ä¹ˆæ˜¯STOPçŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯SHUTDOWNçŠ¶æ€é˜»å¡é˜Ÿåˆ—ä¹Ÿæ²¡ä»»åŠ¡äº†</span></span><br><span class="line">        <span class="keyword">if</span> (workerCountOf(c) != <span class="number">0</span>) { <span class="comment">// Eligible to terminate</span></span><br><span class="line">            <span class="comment">//ä¸­æ–­ä¸€ä¸ªç©ºé—²çš„workerçº¿ç¨‹</span></span><br><span class="line">            interruptIdleWorkers(ONLY_ONE);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//wc==0 æ²¡æœ‰çº¿ç¨‹å­˜æ´»äº†</span></span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//CASè‡ªæ—‹ ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ä¸ºTIDYING</span></span><br><span class="line">            <span class="keyword">if</span> (ctl.compareAndSet(c, ctlOf(TIDYING, <span class="number">0</span>))) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    terminated(); <span class="comment">//ç©ºæ–¹æ³•,äº¤ç»™å­ç±»å»å®ç°çš„</span></span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    <span class="comment">//è®¾ç½®çŠ¶æ€ä¸º TERMINATED</span></span><br><span class="line">                    ctl.set(ctlOf(TERMINATED, <span class="number">0</span>));</span><br><span class="line">                    <span class="comment">//å”¤é†’terminationä¸Šawiatçš„çº¿ç¨‹</span></span><br><span class="line">                    termination.signalAll();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// else retry on failed CAS</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæœ€åçš„<code>termination.signalAll()</code> å®é™…ä¸Šæ˜¯å”¤é†’çš„<code>awaitTermination()</code> æ–¹æ³•é˜»å¡çš„çº¿ç¨‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">awaitTermination</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">    <span class="keyword">long</span> nanos = unit.toNanos(timeout);</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="keyword">if</span> (runStateAtLeast(ctl.get(), TERMINATED))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (nanos <= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">//é™æ—¶ç­‰å¾…</span></span><br><span class="line">            nanos = termination.awaitNanos(nanos);</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown()"></a>shutdown()</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">        <span class="comment">//CASè‡ªæ—‹è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸º SHUTDOWN</span></span><br><span class="line">        advanceRunState(SHUTDOWN);</span><br><span class="line">        <span class="comment">//æ‰“æ–­idle(ç©ºé—²)çš„worker</span></span><br><span class="line">        interruptIdleWorkers(); </span><br><span class="line">        onShutdown(); <span class="comment">// hook for ScheduledThreadPoolExecutor</span></span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    tryTerminate();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œå…³é”®çš„å°±æ˜¯è¿™ä¸ªæ‰“æ–­ç©ºé—²çº¿ç¨‹çš„æ“ä½œã€‚</p><h3 id="interruptIdleWorkers"><a href="#interruptIdleWorkers" class="headerlink" title="interruptIdleWorkers()"></a>interruptIdleWorkers()</h3><p>æ‰“æ–­ç©ºé—²çš„workerï¼Œè¿™é‡Œçš„ç©ºé—²çº¿ç¨‹å…¶å®æŒ‡çš„å°±æ˜¯åœ¨é˜»å¡é˜Ÿåˆ—ä¸Šè·å–ä¸åˆ°ä»»åŠ¡è€Œé˜»å¡çš„çº¿ç¨‹</p><p>ç»è¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“Workerä¼šä¸æ–­çš„ä»é˜»å¡é˜Ÿåˆ—ä¸­å»æ‹¿ä»»åŠ¡ä¹Ÿå°±æ˜¯ <code>getTask()</code> æ–¹æ³•ï¼Œå¦‚æœé˜»å¡é˜Ÿåˆ—ä¸ºç©ºå°±ä¼šé˜»å¡ä½ ç›´åˆ°æœ‰ä»»åŠ¡æäº¤åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…æ‰§è¡Œçº¿ç¨‹è¢«ä¸­æ–­ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æ˜¯è¦SHUTDOWNé‚£é˜»å¡é˜Ÿåˆ—ä¸­è‚¯å®šæ˜¯ä¸ä¼šå†æœ‰ä»»åŠ¡æäº¤ï¼Œæ‰€ä»¥<code>take()</code> ä¼šé˜»å¡ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½é€šè¿‡æ‰“æ–­æ‰§è¡Œçº¿ç¨‹çš„æ–¹å¼æ¥æ‰“æ–­<code>take()</code> æ“ä½œï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ï¼Œçº¿ç¨‹æ± æ— æ³•å…³é—­ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">interruptIdleWorkers</span><span class="params">(<span class="keyword">boolean</span> onlyOne)</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock(); <span class="comment">//åŠ é”ï¼Œå› ä¸ºWokersæ˜¯HashSetæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">for</span> (Worker w : workers) {</span><br><span class="line">            Thread t = w.thread;</span><br><span class="line">            <span class="comment">//æ²¡æœ‰è¢«æ‰“æ–­å¹¶ä¸”æ²¡æœ‰åœ¨å·¥ä½œ(ç©ºé—²)</span></span><br><span class="line">            <span class="keyword">if</span> (!t.isInterrupted() && w.tryLock()) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">//æ‰“æ–­Workeré‡Œé¢çš„çº¿ç¨‹</span></span><br><span class="line">                    t.interrupt();</span><br><span class="line">                } <span class="keyword">catch</span> (SecurityException ignore) {</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    w.unlock();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//åªæ‰“æ–­ä¸€ä¸ªå°±ç›´æ¥break</span></span><br><span class="line">            <span class="keyword">if</span> (onlyOne)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ğŸ”¸é¦–å…ˆè·å–äº†mainLockä¿è¯äº†workersçš„çº¿ç¨‹å®‰å…¨é¿å…äº§ç”Ÿå¹¶å‘ä¿®æ”¹å¼‚å¸¸ã€‚</p><p>ğŸ”¸ç„¶åéå†workersï¼Œæ‰“æ–­é‚£äº›æ²¡æœ‰è¢«æ‰“æ–­å¹¶ä¸”æ²¡æœ‰å·¥ä½œçš„çº¿ç¨‹ï¼Œé‚£è¿™é‡Œæ€ä¹ˆçŸ¥é“çº¿ç¨‹æ˜¯ä¸æ˜¯åœ¨å·¥ä½œå‘¢ï¼Ÿ</p><p>åˆ«å¿˜äº†å‰é¢æåˆ°çš„Workerç±»å€ŸåŠ©AQSå®ç°äº†ä¸€ä¸ª<code>ä¸å¯é‡å…¥</code>çš„<code>lock</code> æ–¹æ³•ï¼Œè€Œåœ¨workeræ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ä¼šæ‰§è¡Œ <code>lock</code> åŠ é”ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œ<code>tryLock()</code> å¦‚æœè¿”å›<code>true</code>åˆ™è¯´æ˜ å¹¶æ²¡æœ‰åœ¨å·¥ä½œå¯ä»¥æ‰“æ–­ï¼Œåä¹‹å¦‚æœæ­£åœ¨å·¥ä½œ<code>tryLock()</code> ä¸å¯é‡å…¥ï¼Œæ— æ³•è·å–åˆ°è‡ªå·±æŒæœ‰çš„é”è¿”å›falseï¼Œæ‰€ä»¥çº¿ç¨‹è‚¯å®šæ˜¯åœ¨å·¥ä½œçŠ¶æ€æ‰€ä»¥ä¸åº”è¯¥æ‰“æ–­ï¼Œè¿™äº›çº¿ç¨‹ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åè‡ªè¡Œäº†æ–­ï¼Œå› ä¸ºçº¿ç¨‹æ± çŠ¶æ€å·²ç»è®¾ç½®ä¸º<code>SHUTDOWN</code> å½“ç„¶å‰ææ˜¯è¿™äº›ä»»åŠ¡æ˜¯<strong>å¯ç»ˆæ­¢çš„</strong></p><p>ğŸ”¸æ‰“æ–­åé‡Šæ”¾<code>tryLock()</code>è·å–åˆ°çš„é”</p><p>ğŸ”¸å¦‚æœåªæ‰“æ–­ä¸€ä¸ªå°±ç›´æ¥breakï¼Œå¦åˆ™å°±ç»§ç»­ä¸‹ä¸€è½®å¾ªç¯</p><p>ğŸ”¸é‡Šæ”¾mianLock</p><blockquote><p>ççŒœ: è¿™é‡Œå¯ä»¥é€šè¿‡getStateåˆ¤æ–­çº¿ç¨‹çŠ¶æ€ä½†æ˜¯æœ‰å¯èƒ½åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿‡ä¸­é˜»å¡</p></blockquote><h3 id="shutdownNow"><a href="#shutdownNow" class="headerlink" title="shutdownNow()"></a>shutdownNow()</h3><p>å’Œä¸Šé¢çš„shutdown()ä¸€æ ·éƒ½æ˜¯ç”¨æ¥å…³é—­çº¿ç¨‹æ± çš„ä½†æ˜¯çœ‹æ–¹æ³•åå°±çŸ¥é“è¿™ä¸ªæ¯”è¾ƒç²—æš´ï¼ŒshutdownNowç«‹åˆ»é©¬ä¸Šå…³é—­ï¼Œä¸€ç‚¹æƒ…é¢éƒ½ä¸ç»™ğŸ˜‚ï¼Œè™½ç„¶è¯´æ˜¯æ‰“æ–­æ‰€æœ‰çš„çº¿ç¨‹ä½†æ˜¯æ¯•ç«Ÿä½¿ç”¨çš„æ˜¯<code>Interrupt</code> ï¼Œä¹Ÿè®¸åˆ«äººæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ ¹æœ¬å°±ä¸ä¼šç†ä½ ğŸ˜‚ï¼Œæ‰€ä»¥åœ¨æäº¤ä»»åŠ¡çš„æ—¶å€™è¦å¯¹ä»»åŠ¡è¿›è¡Œæ­£ç¡®çš„interruptå“åº”ï¼Œæˆ–è€…ç¡®ä¿çº¿ç¨‹ä¸ä¼šä¸€ç›´é˜»å¡å¦åˆ™çº¿ç¨‹æ± å°±æ— æ³•æ­£å¸¸å…³é—­</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<runnable> <span class="title">shutdownNow</span><span class="params">()</span> </runnable></span>{</span><br><span class="line">    List<runnable> tasks;</runnable></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">        <span class="comment">//CASè‡ªæ—‹è®¾ç½®çŠ¶æ€ä¸ºSTOP</span></span><br><span class="line">        advanceRunState(STOP);</span><br><span class="line">        <span class="comment">//æ‰“æ–­æ‰€æœ‰çš„çº¿ç¨‹åŒ…æ‹¬æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹</span></span><br><span class="line">        interruptWorkers();</span><br><span class="line">        <span class="comment">//æ’å¹²é˜»å¡é˜Ÿåˆ—ï¼Œå› ä¸ºå·²ç»STOPäº†ä¸ä¼šå†æ‰§è¡Œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡äº†</span></span><br><span class="line">        tasks = drainQueue();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å°è¯•å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">    tryTerminate();</span><br><span class="line">    <span class="keyword">return</span> tasks;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="interruptWorkers"><a href="#interruptWorkers" class="headerlink" title="interruptWorkers()"></a>interruptWorkers()</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">interruptWorkers</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">for</span> (Worker w : workers)</span><br><span class="line">            <span class="comment">//æ‰“æ–­æ‰€æœ‰å¯åŠ¨çš„çº¿ç¨‹</span></span><br><span class="line">            w.interruptIfStarted();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ‰“æ–­äº†æ‰€æœ‰çš„å¯åŠ¨çš„çº¿ç¨‹ï¼Œå³ä½¿ä»–ä»¬å¯èƒ½ä¸ä¼šå“åº”è¿™ä¸ªInterruptedä¿¡å·ï¼Œä½†æ˜¯ç”±äºçº¿ç¨‹æ± çŠ¶æ€å·²ç»å˜ä¸ºäº†STOPï¼Œæ‰€ä»¥ä»–ä»¬ä¹Ÿæ´»ä¸é•¿äº†(å½“ç„¶å‰ææ˜¯æ‰§è¡Œçš„ä»»åŠ¡æ˜¯å¯ä»¥ç»“æŸçš„)ï¼Œåœ¨ä¸‹ä¸€æ¬¡è·å–ä»»åŠ¡çš„æ—¶å€™å°±ä¼šç›´æ¥return ã€‚</p><h2 id="ThreadPoolExecutorä½¿ç”¨"><a href="#ThreadPoolExecutorä½¿ç”¨" class="headerlink" title="ThreadPoolExecutorä½¿ç”¨"></a>ThreadPoolExecutorä½¿ç”¨</h2><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue<runnable> workQueue,</runnable></span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize < <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize <= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize < corePoolSize ||</span><br><span class="line">        keepAliveTime < <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.acc = System.getSecurityManager() == <span class="keyword">null</span> ?</span><br><span class="line">            <span class="keyword">null</span> :</span><br><span class="line">            AccessController.getContext();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®ä»ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºå¯¹å„ä¸ªå‚æ•°çš„ä¸€äº›é™åˆ¶ã€‚</p><p><strong>corePoolSizeï¼š</strong>æ ¸å¿ƒæ± çš„å¤§å°ï¼Œè¿™ä¸ªå‚æ•°ä¸åé¢è®²è¿°çš„çº¿ç¨‹æ± çš„å®ç°åŸç†æœ‰éå¸¸å¤§çš„å…³ç³»ã€‚åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­å¹¶æ²¡æœ‰ä»»ä½•çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…æœ‰ä»»åŠ¡åˆ°æ¥æ‰åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œé™¤éè°ƒç”¨äº†<code>prestartAllCoreThreads()</code>æˆ–è€…<code>prestartCoreThread()</code>æ–¹æ³•ï¼Œä»è¿™2ä¸ªæ–¹æ³•çš„åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œæ˜¯é¢„åˆ›å»ºçº¿ç¨‹çš„æ„æ€ï¼Œå³åœ¨æ²¡æœ‰ä»»åŠ¡åˆ°æ¥ä¹‹å‰å°±åˆ›å»ºcorePoolSizeä¸ªçº¿ç¨‹æˆ–è€…ä¸€ä¸ªçº¿ç¨‹ã€‚<code>é»˜è®¤æƒ…å†µä¸‹</code>ï¼Œåœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼Œå½“æœ‰ä»»åŠ¡æ¥ä¹‹åï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeåï¼Œå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“å­˜é˜Ÿåˆ—å½“ä¸­</p><p><strong>maximumPoolSizeï¼š</strong>çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œå®ƒè¡¨ç¤ºåœ¨çº¿ç¨‹æ± ä¸­æœ€å¤šå…è®¸åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹</p><p><strong>keepAliveTime</strong>ï¼šè¡¨ç¤ºçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶æœ€å¤šä¿æŒå¤šä¹…æ—¶é—´ä¼šç»ˆæ­¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å½“<code>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶</code>ï¼ŒkeepAliveTimeæ‰ä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºcorePoolSizeï¼šå³å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äº<code>corePoolSize</code>æ—¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹ç©ºé—²çš„æ—¶é—´è¾¾åˆ°keepAliveTimeï¼Œåˆ™ä¼šç»ˆæ­¢ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸è¶…è¿‡corePoolSizeï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨äº†<code>allowCoreThreadTimeOut(boolean)</code>æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºcorePoolSizeæ—¶ï¼ŒkeepAliveTimeå‚æ•°ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼Œè¿™äº›å†…å®¹å…¶å®åœ¨ä¸Šé¢çš„æ·±å…¥æºç ä¸­éƒ½æœ‰è¿‡åˆ†æã€‚</p><p><strong>unitï¼š</strong>å‚æ•°keepAliveTimeçš„æ—¶é—´å•ä½</p><p><strong>workQueue</strong>ï¼šä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™ä¸ªå‚æ•°çš„é€‰æ‹©ä¼šå¯¹çº¿ç¨‹æ± çš„è¿è¡Œè¿‡ç¨‹äº§ç”Ÿé‡å¤§å½±å“</p><p><strong>threadFactory</strong>ï¼šçº¿ç¨‹å·¥å‚ï¼Œä¸»è¦ç”¨æ¥åˆ›å»ºçº¿ç¨‹(æ ¹æ®ä¼ è¿›æ¥çš„Runnable/Callable)</p><p><strong>handler</strong>ï¼šè¡¨ç¤ºå½“æ‹’ç»å¤„ç†ä»»åŠ¡æ—¶çš„ç­–ç•¥ï¼Œæœ‰ä»¥ä¸‹å››ç§å–å€¼</p><ul><li><strong>ThreadPoolExecutor.AbortPolicy</strong> ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ </li><li><strong>ThreadPoolExecutor.DiscardPolicy</strong> ä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ </li><li><strong>ThreadPoolExecutor.DiscardOldestPolicy</strong> ä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰</li><li><strong>ThreadPoolExecutor.CallerRunsPolicy</strong>  ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ </li></ul><h3 id="çº¿ç¨‹æ± çš„å…³é—­"><a href="#çº¿ç¨‹æ± çš„å…³é—­" class="headerlink" title="çº¿ç¨‹æ± çš„å…³é—­"></a>çº¿ç¨‹æ± çš„å…³é—­</h3><p><code>shutdown()</code>  <code>shutdownNow()</code> ï¼Œä¸Šé¢å·²ç»åˆ†æè¿‡äº†ï¼Œå°±ä¸å†è¿‡å¤šä»‹ç»äº†ã€‚</p><h3 id="å·¥å‚æ–¹æ³•"><a href="#å·¥å‚æ–¹æ³•" class="headerlink" title="å·¥å‚æ–¹æ³•"></a>å·¥å‚æ–¹æ³•</h3><p>ä¸Šé¢çš„æ„é€ å™¨ä¸­ä¸€å…±æœ‰7ä¸ªå‚æ•°ï¼Œå¯è§è¦æ„é€ ä¸€ä¸ªçº¿ç¨‹æ± å¹¶éé‚£ä¹ˆå®¹æ˜“ï¼Œæ‰€ä»¥jdk åœ¨<code>Executors</code> ç±»ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ„é€ ä¸€äº›ç‰¹å®šçš„çº¿ç¨‹æ± ã€‚</p><p><strong>newCachedThreadPool()</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue<runnable>());</runnable></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°<code>core</code>ä¸º0ï¼Œæœ€å¤§å€¼ä¸º<code>Integer.MAX_VALUE</code>ï¼Œä»»åŠ¡é˜Ÿåˆ—ä½¿ç”¨çš„<code>SynchronousQueue</code> ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸€ä¸ªå¾ˆå¥‡è‘©çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®é™…ä¸Šå®ƒä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œæ¯ä¸ªåˆ é™¤æ“ä½œéƒ½è¦ç­‰å¾…æ’å…¥æ“ä½œï¼Œåä¹‹æ¯ä¸ªæ’å…¥æ“ä½œä¹Ÿéƒ½è¦ç­‰å¾…åˆ é™¤åŠ¨ä½œï¼Œåªæœ‰ä¸¤ä¸ªéƒ½å‡†å¤‡å¥½çš„æ—¶å€™æ‰ä¸ä¼šé˜»å¡ï¼Œæ‰€ä»¥å®ƒå†…éƒ¨ä¸ä¼šä¸ºé˜Ÿåˆ—å…ƒç´ ç»´æŠ¤ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶ä¸ä¼šç¼“å­˜ä»»åŠ¡ï¼Œä¸€æ—¦æäº¤äº†(put)ä»»åŠ¡ï¼Œè¦ä¹ˆå°±ç”±ç©ºé—²çº¿ç¨‹å»æ‰§è¡Œ(take)ï¼Œè¦ä¹ˆåˆ›å»ºä¸€æ¡æ–°çº¿ç¨‹å»æ‰§è¡Œ(take)ã€‚</p><p><strong>newFixedThreadPool()</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue<runnable>());</runnable></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€å¤§å€¼å’Œcoreéƒ½æ˜¯ <code>nThread</code> ï¼Œä¹Ÿå°±æ˜¯æœ€å¤š<code>nThread</code>ä¸ªçº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—é‡‡ç”¨ <code>LinkedBlockQueue</code> </p><p><strong>newSingleThreadExecutor()</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue<runnable>()));</runnable></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç­‰ä»·äº<code>newFixedThreadPool(1)</code> ï¼Œä½†æ˜¯è¿™é‡Œçš„è¿”å›å€¼ç»è¿‡äº†ä¸€å±‚åŒ…è£… è¿”å›çš„ä¸å†æ˜¯<code>ThreadPoolExecutor</code> ä¹Ÿå°±æ˜¯ä¸ä¼šå†æœ‰é‚£äº›æ‰©å±•çš„monitoræ–¹æ³•</p><blockquote><p>A wrapper class that exposes only the ExecutorService methods  of an ExecutorService implementation.</p></blockquote><p>ç±»ä¼¼çš„æ–¹æ³•å…¶å®è¿˜æœ‰ä¸€äº›ï¼Œåƒ<code>newWorkStealingPool</code> ç­‰ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±å»æŸ¥ä¸€æŸ¥ã€‚</p><p>å…¶å®è¿™é‡Œé˜¿é‡Œå·´å·´Javaå¼€å‘è§„èŒƒå¹¶ä¸å»ºè®®ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºçº¿ç¨‹</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190806/lMVPdlPqEPNO.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>æ‰€ä»¥å»ºè®®è¿˜æ˜¯é€šè¿‡æ„é€ å™¨çš„æ–¹å¼å»åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ ·ä¹Ÿæ›´åŠ çµæ´»æ›´åŠ å¯æ§ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå¹¶å‘å·¥å…·åŒ…</title>
      <link href="/2019/07/24/bing-fa-gong-ju-bao/"/>
      <url>/2019/07/24/bing-fa-gong-ju-bao/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h2><p>ç»“åˆå‰é¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“<code>Thread.join()</code>å¯ä»¥å®ç°ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹<code>ç»“æŸ</code>å†æ‰§è¡Œï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½å¹¶ä¸éœ€è¦ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ç»“æŸï¼Œåªéœ€è¦ç­‰å¾…ç‰¹å®šçš„æ“ä½œç»“æŸåå°±å¯ä»¥ï¼Œå¯èƒ½æœ‰äººä¼šè¯´å¯ä»¥é€šè¿‡<code>wait/notify</code>æ¨¡å‹æ¥å®ç°ï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ›´åŠ æ–¹ä¾¿çš„å·¥å…·ç±»ä¹Ÿå°±æ˜¯ <code>java.util.concurrent.CountDownLatch</code>ã€‚</p><table><thead><tr><th>Constructor and Description</th></tr></thead><tbody><tr><td><code>CountDownLatch(int count)</code>   æ„é€ ä¸€ä¸ªä»¥ç»™å®šè®¡æ•° <code>CountDownLatch</code> CountDownLatchã€‚</td></tr></tbody></table><p><strong>æ¡ˆä¾‹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random random=<span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService executor=Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  CountDownLatch latch;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">int</span>  []data=query();</span><br><span class="line">        <span class="comment">//æ„é€ å™¨çš„å‚æ•°ä»£è¡¨éœ€è¦æ‰§è¡Œçš„å…ˆå†³æ¡ä»¶çš„æ•°é‡</span></span><br><span class="line">        latch=<span class="keyword">new</span> CountDownLatch(data.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i <data.length ; i++) {< span><br><span class="line">            executor.execute(<span class="keyword">new</span> SimpleRunnable(data,i,latch));</span><br><span class="line">        }</span><br><span class="line">        latch.await();</span><br><span class="line">        <span class="comment">//å¼‚æ­¥å…³é—­</span></span><br><span class="line">        executor.shutdown();</span><br><span class="line">        System.out.println(<span class="string">"all of works done "</span>);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> []data;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> index;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CountDownLatch latch;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SimpleRunnable</span><span class="params">(<span class="keyword">int</span>[] data, <span class="keyword">int</span> index, CountDownLatch latch)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.data = data;</span><br><span class="line">            <span class="keyword">this</span>.index = index;</span><br><span class="line">            <span class="keyword">this</span>.latch=latch;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(random.nextInt(<span class="number">2000</span>));</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">int</span> value=data[index];</span><br><span class="line">            <span class="keyword">if</span> (value%<span class="number">2</span>==<span class="number">0</span>) {</span><br><span class="line">                data[index]=<span class="number">2</span>*value;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                data[index]=<span class="number">10</span>*value;</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" finished"</span>);</span><br><span class="line">            latch.countDown();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] query(){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>};</span><br><span class="line">    }</span><br><span class="line">}</span><br></data.length></span></pre></td></tr></tbody></table></figure></div><p><code>CountDownLatch</code>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªæœªæ‰§è¡Œæ“ä½œçš„è®¡æ•°å™¨ <code>count</code>è¿™ä¸ªcountéœ€è¦é€šè¿‡æ„é€ å™¨ä¼ å…¥ï¼ŒCountDownLatch å®ä¾‹çš„countdownæ–¹æ³•æ¯æ‰§è¡Œä¸€æ¬¡<code>count</code> å°±ä¼šå‡ä¸€ ï¼Œåœ¨<code>count</code> å‡ä¸º0ä¹‹å‰<code>await</code> æ–¹æ³•çš„æ‰§è¡Œçº¿ç¨‹ä¼šè¢«æš‚åœï¼Œ</p><p>ç›´åˆ°<code>count</code>å‡ä¸º0çš„æ—¶å€™æ‰ä¼šè¢«å”¤é†’ç»§ç»­æ‰§è¡Œã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/24 15:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest2</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">final</span> CountDownLatch latch=<span class="keyword">new</span> CountDownLatch(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i <<span class="number">10</span>; i++) {</span><br><span class="line">                data=i;</span><br><span class="line">                latch.countDown();</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>));</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">        latch.await();</span><br><span class="line">        System.out.println(<span class="string">"data:"</span>+data);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>CountDownLatchä¼ å…¥çš„countä¸º4ï¼Œå¾ªç¯æ‰§è¡Œäº†10æ¬¡ï¼Œç»“æœæ˜¯å¤šå°‘ï¼Ÿå½“ç„¶æ˜¯4äº†ï¼Œå½“å‡ä¸º0çš„æ—¶å€™awaitè°ƒç”¨å°±ä¼šè¿”å›ä¸ä¼šå†ç­‰å¾…ï¼Œåé¢å³ä½¿countå·²ç»å‡ä¸º0å†å‡ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚</p><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><table><thead><tr><th>Modifier and Type</th><th>Method and Description</th></tr></thead><tbody><tr><td><code>void</code></td><td><code>await()</code>   å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰åˆ°é”å­˜å™¨è®¡æ•°åˆ°é›¶ï¼Œé™¤éçº¿ç¨‹æ˜¯ interrupted ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>await(long timeout,  TimeUnit unit)</code>  ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°é”å­˜å™¨è®¡æ•°åˆ°é›¶ä¸ºæ­¢ï¼Œé™¤éçº¿ç¨‹ä¸º interruptedæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚</td></tr><tr><td><code>void</code></td><td><code>countDown()</code>   å‡å°‘é”å­˜å™¨çš„è®¡æ•°ï¼Œå¦‚æœè®¡æ•°è¾¾åˆ°é›¶ï¼Œé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚</td></tr><tr><td><code>long</code></td><td><code>getCount()</code>   è¿”å›å½“å‰è®¡æ•°ã€‚</td></tr><tr><td><code>String</code></td><td><code>toString()</code>   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤é”å­˜å™¨çš„å­—ç¬¦ä¸²åŠå…¶çŠ¶æ€ã€‚</td></tr></tbody></table><h2 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h2><p>æœ‰æ—¶å€™å¤šä¸ªçº¿ç¨‹å¯èƒ½éœ€è¦ç›¸äº’ç­‰å¾…å¯¹æ–¹æ‰§è¡Œåˆ°æŸä¸€æ­¥ç„¶åå†æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚ç”Ÿæ´»ä¸­å°±æœ‰å¾ˆå¤šè¿™æ ·çš„æƒ…å½¢ï¼Ÿæ¯”å¦‚ç›¸çº¦çˆ¬å±±ï¼šå¤§å®¶çº¦å®šå¥½é›†åˆçš„åœ°ç‚¹ç„¶åç­‰æ‰€æœ‰äººåˆ°è¾¾æŒ‡å®šçš„é›†åˆåœ°ç‚¹åå†ä¸€èµ·å»ï¼Œå…ˆåˆ°è¾¾çš„äººéœ€è¦ç­‰å¾…ååˆ°è¾¾çš„äººï¼Œåªæœ‰æ‰€æœ‰äººåˆ°é½åæ‰ä¼šå‡ºå‘å»çˆ¬å±±ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/24 15:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicbarrierTest1</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>{</span><br><span class="line">        CyclicBarrier cyclicBarrier=<span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//do something</span></span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                System.out.println(<span class="string">"t1 finished"</span>);</span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">                System.out.println(<span class="string">"other thread is done too"</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">catch</span> (BrokenBarrierException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//do something</span></span><br><span class="line">                Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">                System.out.println(<span class="string">"t2 finished"</span>);</span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">                System.out.println(<span class="string">"other thread is done too"</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">catch</span> (BrokenBarrierException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸Šé¢çš„ä»£ç å°±ä½“ç°äº†è¿™ç§æƒ…å†µï¼Œä¸¤ä¸ªçº¿ç¨‹å¼€å§‹å…ˆåˆ†åˆ«åšå„è‡ªçš„äº‹æƒ…ï¼Œç„¶ååˆ°è¾¾ä¸€ä¸ªç‚¹ä¹‹åï¼Œéœ€è¦ç›¸äº’ç­‰å¾…ï¼Œå…ˆåˆ°è¾¾çš„ç­‰å¾…ååˆ°è¾¾çš„ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­å¾ˆæ˜¾ç„¶ <code>t1</code> å…ˆåˆ°è¾¾å®ƒéœ€è¦ç­‰å¾…<code>t2</code> åˆ°è¾¾åæ‰èƒ½ç»§ç»­è¿è¡Œã€‚</p><p>åŒæ—¶ï¼Œå¦‚æœå¤–ç•Œæ˜¯æƒ³è¦çŸ¥é“è¿™ä¸ªCyclicBarrierçš„ä»»åŠ¡æ‰§è¡Œæƒ…å†µå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­åŠ å…¥ä¸€ä¸ªå›è°ƒçš„<code>Runnable</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">CyclicBarrier cyclicBarrier=<span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>,()->{</span><br><span class="line">    System.out.println(<span class="string">"t1,t2 both arrived"</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·çš„æ–¹å¼è¿˜æ˜¯å¾ˆä¼˜é›…çš„ã€‚</p><p>å¦‚æœç»†å¿ƒçš„è¯å…¶å®ä½ è¿˜ä¼šå‘ç°ç›¸æ¯”ä¸Šé¢çš„CountDownå¤šäº†ä¸€ä¸ªBrokenBarrierExceptionï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹doc</p><p>å¦‚æœæœ‰çº¿ç¨‹æ­£åœ¨waitingè€Œ Barrierå·²ç»è¢«resetäº†</p><blockquote><p>If the barrier is {@link #reset} while any thread is waiting</p><p>or if the barrier {@linkplain #isBroken is broken} when</p><p>{@code await} is invoked, or while any thread is waiting, then</p><p>{@link BrokenBarrierException} is thrown.</p></blockquote><p>å¦‚æœæŸä¸€ä¸ªçº¿ç¨‹åœ¨waitingçš„æ—¶å€™è¢«æ‰“æ–­äº†ï¼Œé‚£ä¹ˆå…¶ä»–çš„waitingçº¿ç¨‹å°†ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸</p><blockquote><p>If any thread is {@linkplain Thread#interrupt interrupted} while waiting</p><p>then all other waiting threads will throw</p><p>{@link BrokenBarrierException} and the barrier is placed in the broken</p><p>state.</p></blockquote><p><strong>æºç è§£æ</strong></p><p><code>CyclicBarrier</code>å¹¶æ²¡æœ‰å€ŸåŠ©AQSè€Œæ˜¯åˆ©ç”¨<code>Condition</code>æ¡ä»¶å˜é‡æ¥å®ç°çš„ï¼Œå…³äº<code>Condition</code>åé¢ä¼šä»‹ç»ã€‚</p><p><strong>doAwait()</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">dowait</span><span class="params">(<span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, BrokenBarrierException,</span></span><br><span class="line"><span class="function">           TimeoutException </span>{</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock(); <span class="comment">//åŠ é”</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">final</span> Generation g = generation;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (g.broken)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BrokenBarrierException();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Thread.interrupted()) {</span><br><span class="line">            breakBarrier();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> index = --count; <span class="comment">//å’ŒcountDownLatchç±»ä¼¼</span></span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) {  <span class="comment">// tripped æ‰€æœ‰çº¿ç¨‹éƒ½æŠµè¾¾äº†</span></span><br><span class="line">            <span class="keyword">boolean</span> ranAction = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">final</span> Runnable command = barrierCommand; </span><br><span class="line">                <span class="keyword">if</span> (command != <span class="keyword">null</span>)</span><br><span class="line">                    command.run(); <span class="comment">//æ‰§è¡Œæ„é€ å™¨ä¸­ä¼ å…¥çš„CallBack</span></span><br><span class="line">                ranAction = <span class="keyword">true</span>;</span><br><span class="line">                nextGeneration(); <span class="comment">//ä¸‹ä¸€ä¸ªè½®å›</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                <span class="keyword">if</span> (!ranAction)</span><br><span class="line">                    breakBarrier();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// loop until tripped, broken, interrupted, or timed out</span></span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">if</span> (!timed)</span><br><span class="line">                    trip.await();</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (nanos > <span class="number">0L</span>)</span><br><span class="line">                    nanos = trip.awaitNanos(nanos);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException ie) {</span><br><span class="line">                <span class="keyword">if</span> (g == generation && ! g.broken) {</span><br><span class="line">                    breakBarrier();</span><br><span class="line">                    <span class="keyword">throw</span> ie;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="comment">// We're about to finish waiting even if we had not</span></span><br><span class="line">                    <span class="comment">// been interrupted, so this interrupt is deemed to</span></span><br><span class="line">                    <span class="comment">// "belong" to subsequent execution.</span></span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (g.broken)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BrokenBarrierException();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (g != generation)</span><br><span class="line">                <span class="keyword">return</span> index;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (timed && nanos <= <span class="number">0L</span>) {</span><br><span class="line">                breakBarrier();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> TimeoutException();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        lock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p> <strong>nextGeneration()</strong> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">nextGeneration</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// signal completion of last generation</span></span><br><span class="line">    trip.signalAll(); <span class="comment">//å”¤é†’è¿™ä¸ªbarrierä¸Šæ‰€æœ‰çš„ç­‰å¾…çº¿ç¨‹ï¼Œtripæ˜¯ä¸€ä¸ªcondition</span></span><br><span class="line">    <span class="comment">// set up next generation</span></span><br><span class="line">    count = parties; <span class="comment">//countå¤ä½</span></span><br><span class="line">    generation = <span class="keyword">new</span> Generation();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®ä¹Ÿå¯ä»¥ç”¨CountDownLatchå®ç°å’ŒCyclicBarrierç±»ä¼¼çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸å†æ¼”ç¤ºã€‚</p><h3 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h3><table><thead><tr><th>Modifier and Type</th><th>Method and Description</th></tr></thead><tbody><tr><td><code>int</code></td><td><code>await()</code>   ç­‰å¾…æ‰€æœ‰ partiesåˆ°è¾¾å±éšœï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªéšœç¢ä¸Šè°ƒç”¨<code>await</code> ã€‚</td></tr><tr><td><code>int</code></td><td><code>await(long timeout,  TimeUnit unit)</code>  ç­‰å¾…æ‰€æœ‰ partieså·²ç»åœ¨æ­¤å±éšœä¸Šè°ƒç”¨  <code>await</code> ï¼Œæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚</td></tr><tr><td><code>int</code></td><td><code>getNumberWaiting()</code>   è¿”å›ç›®å‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹çš„æ•°é‡ã€‚</td></tr><tr><td><code>int</code></td><td><code>getParties()</code>   è¿”å›parties</td></tr><tr><td><code>boolean</code></td><td><code>isBroken()</code>   æŸ¥è¯¢è¿™ä¸ªéšœç¢æ˜¯å¦å¤„äºBroken</td></tr><tr><td><code>void</code></td><td><code>reset()</code>   å°†å±éšœé‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚</td></tr></tbody></table><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><ul><li><p><code>CountDownLatch</code>ä¸èƒ½<code>reset</code>ï¼ˆé€’å‡åˆ°0åä¸èƒ½å¤åŸï¼‰ï¼Œ<code>CyclicBarrier</code>æ­£å¦‚å…¶åæ˜¯å¯ä»¥å¾ªç¯ä½¿ç”¨çš„ã€‚</p></li><li><p><code>CountDownLatch</code>å·¥ä½œçº¿ç¨‹ä¹‹é—´äº’ä¸å…³å¿ƒï¼Œ<code>CyclicBarrier</code>æ‰€æœ‰çº¿ç¨‹å¿…é¡»åˆ°è¾¾ä¸€ä¸ªå…±åŒçš„ç‚¹æ‰ä¼šç»§ç»­æ‰§è¡Œ</p></li></ul><h2 id="Exchanger"><a href="#Exchanger" class="headerlink" title="Exchanger"></a>Exchanger</h2><p>JDK1.5å¼•å…¥çš„ï¼Œçœ‹åå­—å°±çŒœå¾—åˆ°å¤§æ¦‚æ˜¯å¹²å˜›çš„ï¼Œä¸»è¦å°±æ˜¯ç”¨äº<code>ä¸¤ä¸ªçº¿ç¨‹</code> ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œå…¶å®ä¹Ÿå°±ç›¸å½“äºåªæœ‰ä¸¤ä¸ªå‚ä¸æ–¹çš„<code>CyclicBarrier</code> å½“ä¸¤ä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°<code>exchanger point</code> (é›†åˆç‚¹) å°±ä¼šè¿›è¡Œæ•°æ®çš„äº¤æ¢ï¼Œ<code>ä¸€æ‰‹äº¤é’±ï¼Œä¸€æ‰‹äº¤è´§</code> æ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿè¦æ³¨æ„ä¸¤ä¸ªçº¿ç¨‹èƒ½å¦æ­£ç¡®çš„åˆ°è¾¾<code>exchanger point</code> å¦‚æœæœ‰ä¸€æ–¹æ— æ³•åˆ°è¾¾åˆ™å¦ä¸€æ–¹å°±ä¼šé™·å…¥ç­‰å¾…ï¼Œå½“ç„¶ä½ å¯ä»¥åŠ ä¸Štimeoutã€‚å¦å¤–è¿™ä¸ªåªé€‚ç”¨ä¸ä¸¤ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæœ‰2ä¸ªä»¥ä¸Šçš„çº¿ç¨‹å‚ä¸å°†ä¼šé€ æˆæ•°æ®ä¼ è¾“æ··ä¹±ï¼Œæ— æ³•æ§åˆ¶ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/25 13:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerTest1</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> Exchanger<string> exchanger=<span class="keyword">new</span> Exchanger<>();</string></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" start"</span>);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                String res = exchanger.exchange(<span class="string">"i am  A"</span>,<span class="number">10</span>,TimeUnit.SECONDS);</span><br><span class="line">                System.out.println(<span class="string">"back msg="</span> +res);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">catch</span> (TimeoutException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">"done"</span>);</span><br><span class="line">        }).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" start"</span>);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                String res = exchanger.exchange(<span class="string">"i am  B"</span>);</span><br><span class="line">                System.out.println(<span class="string">"back msg="</span> +res);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">"done"</span>);</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>ç¡®å®Exchangerå¦‚æœä½¿ç”¨ä¸å½“ä¼šé€ æˆå¾ˆå¤šé—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦è°¨æ…ï¼Œé¦–å…ˆå®ƒåªé€‚ç”¨ä¸ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œå…¶æ¬¡è¿™é‡Œä¼ è¾“çš„å¯¹è±¡æ˜¯<code>åŒä¸€ä¸ª</code> ï¼Œä¹Ÿå°±æ˜¯è¯´å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„å¯¹è±¡å†…å­˜åœ°å€æ˜¯ä¸€æ ·çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/25 15:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerTest2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> Exchanger<simple> exchanger=<span class="keyword">new</span> Exchanger<>();</simple></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            Simple simple = <span class="keyword">new</span> Simple(<span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" start. send to B"</span>+simple);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Simple res = exchanger.exchange(simple);</span><br><span class="line">                <span class="comment">//ä¼‘çœ 10s</span></span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                System.out.println(<span class="string">"A receive from B obj:"</span>+res +<span class="string">" data:"</span>+res.a);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" done"</span>);</span><br><span class="line">        },<span class="string">"A"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            Simple simple = <span class="keyword">new</span> Simple(<span class="number">2</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" start. send to A:"</span>+simple);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Simple res = exchanger.exchange(simple);</span><br><span class="line">                <span class="comment">//ä¿®æ”¹å‘é€å‡ºå»çš„obj</span></span><br><span class="line">                simple.setA(<span class="number">100000</span>);</span><br><span class="line">                System.out.println(<span class="string">"B receive from A obj:"</span>+res +<span class="string">" data:"</span>+res.a);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" done"</span>);</span><br><span class="line">        },<span class="string">"B"</span>).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Simple</span></span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> a;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Simple</span><span class="params">(<span class="keyword">int</span> a)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.a = a;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getA</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setA</span><span class="params">(<span class="keyword">int</span> a)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.a = a;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç»“æœ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">A start. send to Bjuc_study.tools.Exchanger.ExchangerTest2$Simple@<span class="number">72</span>d6db17</span><br><span class="line">B start. send to A:juc_study.tools.Exchanger.ExchangerTest2$Simple@<span class="number">4295</span>c176</span><br><span class="line">B receive from A obj:juc_study.tools.Exchanger.ExchangerTest2$Simple@<span class="number">72</span>d6db17 data:<span class="number">1</span></span><br><span class="line">B done</span><br><span class="line">A receive from B obj:juc_study.tools.Exchanger.ExchangerTest2$Simple@<span class="number">4295</span>c176 data:<span class="number">100000</span></span><br><span class="line">A done</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸¤ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡å¹¶ä¸æ˜¯æ‹·è´ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶çš„å»æ“ä½œè¿™ä¸ªå¯¹è±¡è¿™å…¶å®æ˜¯å¾ˆå±é™©çš„å¾ˆæœ‰å¯èƒ½å°±ä¼šäº§ç”Ÿä¸€äº›çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„</p><h2 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h2><p>ä¿¡å·é‡ï¼Œç›¸ä¿¡å­¦è¿‡æ“ä½œç³»ç»Ÿçš„åŒå­¦è‚¯å®šå¯¹è¿™ä¸ªå¾ˆç†Ÿæ‚‰äº†ï¼Œç†Ÿæ‚‰PVæ“ä½œçš„è¯è¿™ä¸ªä¸€çœ‹å°±æ‡‚äº†ã€‚</p><table><thead><tr><th>Constructor and Description</th></tr></thead><tbody><tr><td><code>Semaphore(int permits)</code>   åˆ›å»ºä¸€ä¸ª <code>Semaphore</code>ä¸ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œé»˜è®¤éå…¬å¹³é”</td></tr><tr><td><code>Semaphore(int permits,  boolean fair)</code>  åˆ›å»ºä¸€ä¸ª <code>Semaphore</code>ä¸ç»™å®šæ•°é‡çš„è®¸å¯è¯å’Œæ˜¯å¦å…¬å¹³</td></tr></tbody></table><h3 id="Semaphoreå®ç°ä¸€ä¸ªæ˜¾ç¤ºé”"><a href="#Semaphoreå®ç°ä¸€ä¸ªæ˜¾ç¤ºé”" class="headerlink" title="Semaphoreå®ç°ä¸€ä¸ªæ˜¾ç¤ºé”"></a>Semaphoreå®ç°ä¸€ä¸ªæ˜¾ç¤ºé”</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/25 15:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreTest1</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> SemaphoreLock semaphoreLock=<span class="keyword">new</span> SemaphoreLock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                semaphoreLock.lock();</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">" get the lock"</span>);</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }<span class="keyword">finally</span> {</span><br><span class="line">                semaphoreLock.unlock();</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">"release the lock"</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                semaphoreLock.lock();</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">" get the lock"</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }<span class="keyword">finally</span> {</span><br><span class="line">                semaphoreLock.unlock();</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">"release the lock"</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreLock</span></span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span>  Semaphore semaphore =<span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">            semaphore.acquire();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>{</span><br><span class="line">            semaphore.release();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"><a href="#å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"></a>å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</h3><p>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹å…¶å®ä¹ŸæŒºé‡è¦çš„ï¼Œæœ‰æ—¶å€™é¢è¯•ä¼šè®©ä½ æ‰‹å†™ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å…¶å®æœ‰å®ç°è¿‡ä¸€ä¸ªä½†æ˜¯é‚£ä¸ªå…¶å®è¿˜æ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªï¼Œé‚£ä¸ªæ˜¯æ²¡æœ‰Bufferçš„ï¼Œä¸‹é¢è¿™ä¸ªç”¨ä¿¡å·é‡å®ç°çš„å°±æ˜¯æœ‰Bufferçš„ï¼Œåé¢ä¼šå•ç‹¬æ•´ç†å‡ºæ‰€æœ‰çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„å®ç°æ–¹æ³•ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/25 16:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProduceConsumerV4</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ProduceConsumerV4 pc = <span class="keyword">new</span> ProduceConsumerV4();</span><br><span class="line">        Stream.of(<span class="string">"Produce1"</span>, <span class="string">"Produce2"</span>, <span class="string">"Produce3"</span>, <span class="string">"Produce4"</span>).forEach(n -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    pc.produce();</span><br><span class="line">                }</span><br><span class="line">            }, n).start();</span><br><span class="line">        });</span><br><span class="line">        Stream.of(<span class="string">"Consumer1"</span>, <span class="string">"Consumer2"</span>, <span class="string">"Consumer3"</span>, <span class="string">"Consumer4"</span>).forEach(n -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    pc.consumer();</span><br><span class="line">                }</span><br><span class="line">            }, n).start();</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//bufferè½½ä½“</span></span><br><span class="line">    <span class="keyword">private</span> LinkedList<object> buffer=<span class="keyword">new</span> LinkedList<>();<br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Semaphore full = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//bufferæœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Semaphore empty = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//äº’æ–¥é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Semaphore mutex= <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//å·²ç»ç”Ÿäº§äº†</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            empty.acquire();</span><br><span class="line">            <span class="comment">//ä¸èƒ½å’Œä¸Šé¢çš„ä¿¡å·é‡äº¤æ¢</span></span><br><span class="line">            mutex.acquire();</span><br><span class="line">            buffer.add(<span class="keyword">new</span> Object());</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" produce a obj , current list size:"</span> +buffer.size());</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            mutex.release();</span><br><span class="line">            full.release();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            full.acquire();</span><br><span class="line">            mutex.acquire();</span><br><span class="line">            <span class="comment">//ç§»é™¤æœ€åä¸€ä¸ª</span></span><br><span class="line">            buffer.removeLast();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" consumer a obj, current size: "</span> + buffer.size());<span class="comment">//consumer</span></span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            mutex.release();</span><br><span class="line">            empty.release();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></object></span></pre></td></tr></tbody></table></figure></div><h3 id="API-2"><a href="#API-2" class="headerlink" title="API"></a>API</h3><table><thead><tr><th>Modifier and Type</th><th>Method and Description</th></tr></thead><tbody><tr><td><code>void</code></td><td><code>acquire()</code>   ä»è¯¥ä¿¡å·é‡è·å–è®¸å¯è¯ï¼Œé˜»å¡ç›´åˆ°è·å–åˆ°ï¼Œå¯ä»¥è¢«interrupt</td></tr><tr><td><code>void</code></td><td><code>acquire(int permits)</code>   ä»è¯¥ä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œé˜»å¡ç›´åˆ°è·å–åˆ°å¯ä»¥è¢«interrupt</td></tr><tr><td><code>void</code></td><td><code>acquireUninterruptibly()</code>  ä»è¯¥ä¿¡å·é‡è·å–è®¸å¯è¯ï¼Œé˜»å¡ç›´åˆ°è·å–åˆ°ï¼Œæ— è§†interruptï¼Œä¸ä¼šè¢«interrupt</td></tr><tr><td><code>void</code></td><td><code>acquireUninterruptibly(int permits)</code>   ä»è¯¥ä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œé˜»æ­¢ç›´åˆ°è·å–åˆ°ï¼Œä¸å¯è¢«interruptã€‚</td></tr><tr><td><code>int</code></td><td><code>availablePermits()</code>   è¿”å›æ­¤ä¿¡å·é‡ä¸­å½“å‰å¯ç”¨çš„è®¸å¯æ•°ã€‚</td></tr><tr><td><code>int</code></td><td><code>drainPermits()</code>   è·å–å¹¶è¿”å›æ‰€æœ‰å¯ç«‹å³è·å¾—çš„è®¸å¯è¯ã€‚</td></tr><tr><td><code>protected Collection<thread></thread></code></td><td><code>getQueuedThreads()</code>   è¿”å›ä¸€ä¸ªåŒ…å«<code>å¯èƒ½</code>æ­£åœ¨ç­‰å¾…è·å–çš„çº¿ç¨‹çš„é›†åˆã€‚</td></tr><tr><td><code>int</code></td><td><code>getQueueLength()</code>   è¿”å›ç­‰å¾…è·å–çš„çº¿ç¨‹æ•°çš„ä¼°è®¡å€¼ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>hasQueuedThreads()</code>   æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹ç­‰å¾…è·å–ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>isFair()</code>   æ˜¯ä¸æ˜¯å…¬å¹³é”</td></tr><tr><td><code>protected void</code></td><td><code>reducePermits(int reduction)</code>   ç¼©å°å¯ç”¨è®¸å¯è¯çš„æ•°é‡ã€‚</td></tr><tr><td><code>void</code></td><td><code>release()</code>   é‡Šæ”¾è®¸å¯è¯ï¼Œå°†å…¶è¿”å›åˆ°ä¿¡å·é‡ã€‚(0çš„æ—¶å€™ä¹Ÿå¯ä»¥release)</td></tr><tr><td><code>void</code></td><td><code>release(int permits)</code>   é‡Šæ”¾ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œå°†å…¶è¿”å›åˆ°ä¿¡å·é‡ã€‚</td></tr><tr><td><code>String</code></td><td><code>toString()</code>   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤ä¿¡å·é‡çš„å­—ç¬¦ä¸²åŠå…¶çŠ¶æ€ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>tryAcquire()</code>   ä»è¿™ä¸ªä¿¡å·é‡è·å¾—è®¸å¯è¯ï¼Œç«‹å³è¿”å›ï¼Œä¸ä¼šé˜»å¡ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>tryAcquire(int permits)</code>   ä»è¿™ä¸ªä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œä¸ä¼šé˜»å¡</td></tr><tr><td><code>boolean</code></td><td><code>tryAcquire(int permits,  long timeout, TimeUnit unit)</code>  ä»è¯¥ä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œå¦‚æœåœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´è·å–åˆ°ï¼Œå°±è¿”å›trueï¼Œå¯ä»¥è¢«æ‰“æ–­</td></tr><tr><td><code>boolean</code></td><td><code>tryAcquire(long timeout,  TimeUnit unit)</code>  ä»è¯¥ä¿¡å·é‡è·å–è®¸å¯è¯ï¼Œå¦‚æœåœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´è·å–åˆ°ï¼Œå°±è¿”å›trueï¼Œå¯ä»¥è¢«æ‰“æ–­</td></tr></tbody></table><h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><p>é€šå¸¸è¢«ç§°ä¸ºæ˜¾å¼é”ï¼Œä¸ä¹‹å¯¹åº”çš„<code>synchroized</code> åˆ™è¢«ç§°ä¸ºå†…éƒ¨é”ï¼Œæ˜¾å¼é”æ˜¯jdk1.5å¼•å…¥çš„é”ï¼Œä»–çš„ä½œç”¨ä¸å†…éƒ¨é”ç›¸åŒï¼Œä½†æ˜¯å®ƒçš„åŠŸèƒ½æ¯”å†…éƒ¨é”æ›´åŠ å¼ºå¤§ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å†…éƒ¨é”çš„æ›¿ä»£å“ï¼Œå…¶å®åœ¨ä¹‹å‰çš„ <a href="http://imlgw.top/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/#LOCK%E6%8E%A5%E5%8F%A3">Javaå¤šçº¿ç¨‹åŸºç¡€</a>  ä¸€æ–‡ä¸­å°±æ‰‹å†™è¿‡ä¸€ä¸ªå¸¦æœ‰<code>é™æ—¶ç­‰å¾…</code>çš„é” ï¼Œé‚£ä¸ªå…¶å®å°±æ˜¯æ¨¡ä»¿çš„<code>Lock</code> æ¥å£</p><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><p>ReentrantLockæ˜¯Lockæ¥å£çš„ä¸€ä¸ªå®ç°ç±»ä¹Ÿæ˜¯ç”¨çš„æœ€å¤šçš„ä¸€ä¸ªå®ç°ç±»ï¼Œ<code>Reentrant</code> æœ¬æ„å°±æ˜¯ å¯é‡å…¥çš„ï¼Œå¯å†å…¥çš„ï¼Œ è¡¨ç¤ºå½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å–ä¸€ä¸ªå®ƒå·²ç»è·å–çš„é”æ—¶ï¼Œè¿™ä¸ªè·å–åŠ¨ä½œå°±è‡ªåŠ¨æˆåŠŸï¼Œ<code>synchnorized</code>ä¹Ÿæ˜¯å¯é‡å…¥çš„ã€‚</p><table><thead><tr><th>Constructor and Description</th></tr></thead><tbody><tr><td><code>ReentrantLock()</code>   åˆ›å»ºä¸€ä¸ª <code>ReentrantLock</code>çš„å®ä¾‹ã€‚</td></tr><tr><td><code>ReentrantLock(boolean fair)</code>   æ ¹æ®ç»™å®šçš„å…¬å¹³ç­–ç•¥åˆ›å»ºä¸€ä¸ª <code>ReentrantLock</code>çš„å®ä¾‹ã€‚</td></tr></tbody></table><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/25 20:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReentrantLockTest1</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        Thread thread0 = <span class="keyword">new</span> Thread(() -> needLock() );</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(() -> needLock() );</span><br><span class="line">        thread0.start();</span><br><span class="line">        thread1.start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        thread1.interrupt();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">needLock</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//å¯æ‰“æ–­çš„è·å–é”</span></span><br><span class="line">            lock.lockInterruptibly();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" is get the lock"</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line"><span class="comment">//ç©ºè½¬</span></span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            lock.unlock(); <span class="comment">//ç¡®ä¿é”çš„é‡Šæ”¾</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Thread-<span class="number">0</span> is get the lock</span><br><span class="line">java.lang.InterruptedException</span><br><span class="line">at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchronizer.java:<span class="number">898</span>)</span><br><span class="line">at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:<span class="number">1222</span>)</span><br><span class="line">at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:<span class="number">335</span>)</span><br><span class="line">at juc_study.tools.Lock.ReentrantLockTest1.needLock(ReentrantLockTest1.java:<span class="number">26</span>)</span><br><span class="line">at juc_study.tools.Lock.ReentrantLockTest1.lambda$main$<span class="number">1</span>(ReentrantLockTest1.java:<span class="number">16</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line">Exception in thread <span class="string">"Thread-1"</span> java.lang.IllegalMonitorStateException</span><br><span class="line">at java.util.concurrent.locks.ReentrantLock$Sync.tryRelease(ReentrantLock.java:<span class="number">151</span>)</span><br><span class="line">at java.util.concurrent.locks.AbstractQueuedSynchronizer.release(AbstractQueuedSynchronizer.java:<span class="number">1261</span>)</span><br><span class="line">at java.util.concurrent.locks.ReentrantLock.unlock(ReentrantLock.java:<span class="number">457</span>)</span><br><span class="line">at juc_study.tools.Lock.ReentrantLockTest1.needLock(ReentrantLockTest1.java:<span class="number">34</span>)</span><br><span class="line">at juc_study.tools.Lock.ReentrantLockTest1.lambda$main$<span class="number">1</span>(ReentrantLockTest1.java:<span class="number">16</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br></pre></td></tr></tbody></table></figure></div><h4 id="API-3"><a href="#API-3" class="headerlink" title="API"></a>API</h4><table><thead><tr><th>Modifier and Type</th><th>Method and Description</th></tr></thead><tbody><tr><td><code>int</code></td><td><code>getHoldCount()</code>  å½“å‰çº¿ç¨‹è°ƒç”¨lock()çš„æ¬¡æ•° (é‡å…¥çš„æ¬¡æ•°)</td></tr><tr><td><code>protected Thread</code></td><td><code>getOwner()</code>   è¿”å›å½“å‰æ‹¥æœ‰æ­¤é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¿”å› <code>null</code> ã€‚</td></tr><tr><td><code>protected Collection<thread></thread></code></td><td><code>getQueuedThreads()</code>   è¿”å›åŒ…å«å¯èƒ½æ­£åœ¨ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹çš„é›†åˆã€‚</td></tr><tr><td><code>int</code></td><td><code>getQueueLength()</code>   è¿”å›ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹æ•°çš„ä¼°è®¡å€¼ã€‚</td></tr><tr><td><code>protected Collection<thread></thread></code></td><td><code>getWaitingThreads(Condition condition)</code>   è¿”å›åŒ…å«å¯èƒ½åœ¨ä¸æ­¤é”ç›¸å…³è”çš„ç»™å®šæ¡ä»¶ä¸‹ç­‰å¾…çš„çº¿ç¨‹çš„é›†åˆã€‚</td></tr><tr><td><code>int</code></td><td><code>getWaitQueueLength(Condition condition)</code>   è¿”å›ä¸æ­¤é”ç›¸å…³è”çš„ç»™å®šæ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹æ•°çš„ä¼°è®¡ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>hasQueuedThread(Thread thread)</code>  æŸ¥è¯¢ç»™å®šçº¿ç¨‹æ˜¯å¦ç­‰å¾…è·å–æ­¤é”ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>hasQueuedThreads()</code>   æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–æ­¤é”ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>hasWaiters(Condition condition)</code>   æŸ¥è¯¢ä»»ä½•çº¿ç¨‹æ˜¯å¦ç­‰å¾…ä¸æ­¤é”ç›¸å…³è”çš„ç»™å®šæ¡ä»¶ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>isFair()</code>   å¦‚æœæ­¤é”çš„å…¬å¹³è®¾ç½®ä¸ºtrueï¼Œåˆ™è¿”å› <code>true</code> ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>isHeldByCurrentThread()</code>   æŸ¥è¯¢æ­¤é”æ˜¯å¦ç”±å½“å‰çº¿ç¨‹æŒæœ‰ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>isLocked()</code>   æŸ¥è¯¢æ­¤é”æ˜¯å¦ç”±ä»»ä½•çº¿ç¨‹æŒæœ‰ã€‚</td></tr><tr><td><code>void</code></td><td><code>lock()</code>   è·å¾—é”ï¼Œä¸èƒ½è¢«æ‰“æ–­</td></tr><tr><td><code>void</code></td><td><code>lockInterruptibly()</code>   è·å¾—é”ï¼Œå¯ä»¥è¢«æ‰“æ–­</td></tr><tr><td><code>Condition</code></td><td><code>newCondition()</code>   è¿”å›<code>Condition</code>ç”¨äºè¿™ç§ç”¨é€”å®ä¾‹<code>Lock</code>å®ä¾‹ã€‚</td></tr><tr><td><code>String</code></td><td><code>toString()</code>   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤é”çš„å­—ç¬¦ä¸²ä»¥åŠå…¶é”å®šçŠ¶æ€ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>tryLock()</code>   å°è¯•è·å–è¯¥é”ï¼Œä¸ä¼šé˜»å¡ï¼Œç›´æ¥è¿”å›ï¼Œ</td></tr><tr><td><code>boolean</code></td><td><code>tryLock(long timeout,  TimeUnit unit)</code>  å°è¯•åœ¨ç»™å®šæ—¶é—´å†…è·å–é”ï¼Œå¯ä»¥è¢«æ‰“æ–­</td></tr><tr><td><code>void</code></td><td><code>unlock()</code>   é‡Šæ”¾é”ã€‚</td></tr></tbody></table><h3 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h3><p>çœ‹åå­—å°±çŸ¥é“æ˜¯å¹²å•¥çš„äº†ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨ <a href="http://imlgw.top/2019/04/09/java-duo-xian-cheng-li-mian-de-she-ji-mo-shi/#%E8%AF%BB%E5%86%99%E9%94%81%E5%88%86%E7%A6%BB%E6%A8%A1%E5%BC%8F">å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼</a> ä¸­ä¹Ÿæåˆ°äº†è¯»å†™é”ï¼Œå¹¶ä¸”å®ç°äº†ä¸€ä¸ªç®€æ˜“çš„è¯»å†™é”ã€‚</p><p><strong>è¯»å†™é”æ¡ˆä¾‹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/26 12:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockTest1</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ReentrantReadWriteLock readWriteLock=<span class="keyword">new</span> ReentrantReadWriteLock(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Lock readLock=readWriteLock.readLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Lock writeLock=readWriteLock.writeLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span> <span class="keyword">final</span> List<long> data=<span class="keyword">new</span> ArrayList<>();</long></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread thread0 = <span class="keyword">new</span> Thread(() -> write());</span><br><span class="line">        thread0.start();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(() -> read());</span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(() -> read());</span><br><span class="line">        thread2.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            writeLock.lock();</span><br><span class="line">            data.add(System.currentTimeMillis());</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            writeLock.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            readLock.lock();</span><br><span class="line">            data.forEach(System.out::println);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" ===="</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            readLock.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="æ˜¾å¼é”å¯¹æ¯”å†…éƒ¨é”"><a href="#æ˜¾å¼é”å¯¹æ¯”å†…éƒ¨é”" class="headerlink" title="æ˜¾å¼é”å¯¹æ¯”å†…éƒ¨é”"></a>æ˜¾å¼é”å¯¹æ¯”å†…éƒ¨é”</h3><p>æ˜¾å¼é”å’Œå†…éƒ¨é”éƒ½å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œè°ä¹Ÿä¸èƒ½æ›¿ä»£è°ï¼ˆè¿™é‡Œçš„æ˜¾å¼é”ä¸»è¦æŒ‡<code>ReentrantLock</code>ï¼‰ã€‚</p><p><strong>ç‰¹æ€§ä¸Š</strong></p><ul><li><p>æ˜¾å¼é”æ”¯æŒå…¬å¹³é”ï¼ˆæ˜¾å¼é”ï¼Œå†…éƒ¨é”é»˜è®¤éƒ½æ˜¯éå…¬å¹³çš„ï¼‰</p></li><li><p>æ˜¾å¼é”å¯ä»¥<code>tryLock()</code>æ— éœ€ç­‰å¾…ï¼Œå†…éƒ¨é”åªèƒ½ä¸€ç›´ç­‰å¾…é”é‡Šæ”¾</p></li><li><p>æ˜¾å¼é”æœ‰å¸¦è¶…æ—¶çš„<code>tryLock(long timeout,  TimeUnit unit)</code>ã€‚</p></li><li><p>æ˜¾å¼é”å¯ä»¥å“åº”ä¸­æ–­è¯·æ±‚ <code>lockInterruptibly()</code></p></li><li><p>æ˜¾å¼é”æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å¯¹é”çš„ç›¸å…³ä¿¡æ¯ç›‘æ§ï¼Œå†…éƒ¨é”åˆ™æ²¡æœ‰</p></li><li><p>â€¦â€¦â€¦</p></li></ul><p><strong>æ€§èƒ½ä¸Š</strong></p><p>å…¶å®å¾ˆå¤šäººä¼šè®¤ä¸º<code>synchronized</code>æ€§èƒ½å¾ˆå·®ï¼Œä¸å¦‚æ˜¾å¼é”</p><ul><li>jdk1.5ä¸­ï¼Œåœ¨é«˜äº‰ç”¨çš„æƒ…å†µä¸‹ï¼Œç¡®å®æ˜¾å¼é”è¦ä¼˜äºå†…éƒ¨é”</li><li>jdk1.5ä¹‹åï¼Œ å¯¹å†…éƒ¨é”è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ <strong>é”æ¶ˆé™¤</strong>ï¼Œ<strong>é”ç²—åŒ–</strong>ï¼Œ<strong>åå‘é”</strong>ï¼Œå’Œ<strong>é€‚åº”æ€§é”</strong> (è¿™äº›ä¼˜åŒ–åé¢çš„æ–‡ç« ä¼šå†åšè§£é‡Š) ã€‚è¿™äº›ä¼˜åŒ–ä½¿å¾—å†…éƒ¨é”çš„æ€§èƒ½æå‡äº†å¾ˆå¤šï¼Œç”šè‡³åœ¨ä½äº‰ç”¨æƒ…å†µä¸‹æ€§èƒ½è¿˜è¦ä¼˜äº æ˜¾å¼é”ã€‚</li></ul><p><strong>ä½¿ç”¨ä¸Š</strong></p><ul><li><p>Lockä¸æ˜¯Javaè¯­è¨€å†…ç½®çš„ï¼Œsynchronizedæ˜¯Javaè¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ã€‚Lockæ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—®ã€‚</p></li><li><p>Lockå’Œsynchronizedæœ‰ä¸€ç‚¹éå¸¸å¤§çš„ä¸åŒï¼Œé‡‡ç”¨synchronizedä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“synchronizedæ–¹æ³•æˆ–è€…synchronizedä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ï¼Œè€ŒLockåˆ™å¿…é¡»è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡ã€‚</p></li></ul><p>å…¶å®å¾ˆæ˜æ˜¾å†…éƒ¨é”ç›¸æ¯”æ˜¾å¼é”ä½¿ç”¨èµ·æ¥è¦ç®€å•æ˜“ç”¨ï¼Œæ‰€ä»¥ä¿å®ˆä¸€ç‚¹é»˜è®¤ä¼˜å…ˆä½¿ç”¨å†…éƒ¨é”ï¼Œåœ¨éœ€è¦æ˜¾å¼é”çš„ç‰¹æ€§çš„æ—¶å€™å†é€‰ç”¨æ˜¾å¼é”ã€‚</p><h2 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h2><p>Conditionå¯¹åº”çš„å…¶å®å°±æ˜¯æ˜¾å¼é”çš„é€šä¿¡æ–¹æ³•ï¼Œ<code>Lock.newCondition()</code> è¿”å›çš„å°±æ˜¯ä¸€ä¸ªConditionå®ä¾‹ </p><p><code>Condition</code>æ¥å£çš„<code>await()/signal()</code>  å…¶å®å°±å¯¹åº”äº† <code>synchronize</code> çš„ <code>wait()/notify()</code> ï¼Œä½†æ˜¯ç›¸å¯¹äº <code>wait()/notify()</code>  Conditionæ¥å£è§£å†³äº† <strong>è¿‡æ—©å”¤é†’</strong>  é—®é¢˜ä»¥åŠ <code>Object.wait(time)</code> æ— æ³•åŒºåˆ†æ˜¯å¦æ˜¯ç”±äºç­‰å¾…è¶…æ—¶è¿˜æ˜¯è¢«å”¤é†’çš„é—®é¢˜ã€‚</p><p><code>Object.wait()/notify()</code>è¦æ±‚æ‰§è¡Œçº¿ç¨‹æŒæœ‰æ‰€å±å¯¹è±¡çš„å†…éƒ¨é”ï¼ŒåŒæ ·<code>Condition.await()/notify()</code>ä¹Ÿéœ€è¦çº¿ç¨‹æŒæœ‰<strong>åˆ›å»º</strong>è¯¥Conditionçš„æ˜¾å¼é”ï¼Œ<code>æ¯ä¸ªCondition</code>å®ä¾‹å†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œä¸åŒçš„Conditionä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œè¿™æ ·ä¸€æ¥å°±è§£å†³äº†è¿‡æ—©å”¤é†’çš„é—®é¢˜ï¼Œå¯¹äºç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ç»™æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…åˆ›å»ºä¸€ä¸ªConditionï¼Œç”Ÿäº§è€…é€šçŸ¥æ¶ˆè´¹è€…æ—¶å€™åªä¼šå”¤é†’æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…é€šçŸ¥ç”Ÿäº§è€…çš„æ—¶å€™ä¹Ÿåªä¼šé€šçŸ¥ç”Ÿäº§è€…ã€‚</p><h3 id="è§£å†³è¿‡æ—©å”¤é†’"><a href="#è§£å†³è¿‡æ—©å”¤é†’" class="headerlink" title="è§£å†³è¿‡æ—©å”¤é†’"></a>è§£å†³è¿‡æ—©å”¤é†’</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/26 15:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConditionTest1</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ReentrantLock LOCK = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Condition pCondition = LOCK.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Condition cCondition = LOCK.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LinkedList<long> buffer = <span class="keyword">new</span> LinkedList<>();</long></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer MAX_BUFFER = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ConditionTest1 conditionTest1 = <span class="keyword">new</span> ConditionTest1();</span><br><span class="line">        Stream.of(<span class="string">"p1"</span>, <span class="string">"p2"</span>, <span class="string">"p3"</span>, <span class="string">"p4"</span>, <span class="string">"p5"</span>, <span class="string">"p6"</span>, <span class="string">"p7"</span>, <span class="string">"p8"</span>, <span class="string">"p9"</span>, <span class="string">"p10"</span>, <span class="string">"p11"</span>).forEach(name -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> conditionTest1.produce(), name).start();</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        Stream.of(<span class="string">"c1"</span>, <span class="string">"c2"</span>, <span class="string">"c3"</span>, <span class="string">"c4"</span>, <span class="string">"c5"</span>, <span class="string">"c6"</span>, <span class="string">"c7"</span>, <span class="string">"c8"</span>, <span class="string">"c9"</span>, <span class="string">"c10"</span>, <span class="string">"c11"</span>).forEach(name -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> conditionTest1.consumer(), name).start();</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            LOCK.lock();</span><br><span class="line">            <span class="keyword">while</span> (buffer.size() >= MAX_BUFFER) {</span><br><span class="line">                pCondition.await();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">long</span> l = System.currentTimeMillis();</span><br><span class="line">            buffer.add(l);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" produced "</span> + l + <span class="string">" ,current buffer size "</span> + buffer.size());</span><br><span class="line">            <span class="comment">//é€šçŸ¥æ¶ˆè´¹è€…</span></span><br><span class="line">            cCondition.signalAll();</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            LOCK.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            LOCK.lock();</span><br><span class="line">            <span class="keyword">while</span> (buffer.size() == <span class="number">0</span>) {</span><br><span class="line">                cCondition.await();</span><br><span class="line">            }</span><br><span class="line">            Long aLong = buffer.removeLast();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" consumer "</span> + aLong + <span class="string">" ,current buffer size "</span> + buffer.size());</span><br><span class="line">            <span class="comment">//é€šçŸ¥ç”Ÿäº§è€…</span></span><br><span class="line">            pCondition.signalAll();</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            LOCK.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="è§£å†³Object-wait-æ— æ³•åŒºåˆ†å…¶è¿”å›åŸå› "><a href="#è§£å†³Object-wait-æ— æ³•åŒºåˆ†å…¶è¿”å›åŸå› " class="headerlink" title="è§£å†³Object.wait()æ— æ³•åŒºåˆ†å…¶è¿”å›åŸå› "></a>è§£å†³Object.wait()æ— æ³•åŒºåˆ†å…¶è¿”å›åŸå› </h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/26 17:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConditionTest2</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ReentrantLock LOCK = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Condition condition = LOCK.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> isReady = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="comment">//3s+</span></span><br><span class="line">            Date date = <span class="keyword">new</span> Date(System.currentTimeMillis() + <span class="number">3000</span>);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                LOCK.lock();</span><br><span class="line">                <span class="keyword">while</span> (!isReady) {</span><br><span class="line">                    <span class="keyword">boolean</span> b = condition.awaitUntil(date);</span><br><span class="line">                    <span class="keyword">if</span> (!b) {</span><br><span class="line">                        System.out.println(<span class="string">"Fucking t0!!!!!, i am timeout"</span>);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    }</span><br><span class="line">                    System.out.println(<span class="string">"oh i get the lock!!!"</span>);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                LOCK.unlock();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"t1"</span>).start();</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                LOCK.lock();</span><br><span class="line">                isReady = <span class="keyword">true</span>;</span><br><span class="line">                condition.signal();</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                LOCK.unlock();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"t0"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯è§<strong>awaitUntil()</strong> æ˜¯æœ‰ä¸€ä¸ªè¿”å›å€¼çš„ï¼Œè¿”å›trueåˆ™è¡¨ç¤ºåœ¨ç­‰å¾…æ—¶é—´å†…è·å–åˆ°äº†é”ï¼Œåä¹‹åˆ™æ˜¯å› ä¸ºè¶…æ—¶.</p><blockquote><p>å†™è¿™ä¸ªDemoçš„æ—¶å€™æ˜¯æ‹¿ä¹‹å‰çš„æ”¹çš„ï¼Œç„¶åæœ‰ä¸€ä¸ªåœ°æ–¹çš„notifyå¿˜äº†æ”¹æˆsignalï¼Œç„¶åä¸€ç›´æŠ›å¼‚å¸¸ã€‚ã€‚ã€‚å› ä¸ºconditioné‡Œé¢ä¹Ÿæœ‰wait/notifyæ–¹æ³•æ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ä¸è¦è°ƒé”™äº†ã€‚</p></blockquote><h3 id="API-4"><a href="#API-4" class="headerlink" title="API"></a>API</h3><table><thead><tr><th>Modifier and Type</th><th>Method and Description</th></tr></thead><tbody><tr><td><code>void</code></td><td><code>await()</code>   ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­</td></tr><tr><td><code>boolean</code></td><td><code>await(long time,  TimeUnit unit)</code>  ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­ï¼Œæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚</td></tr><tr><td><code>long</code></td><td><code>awaitNanos(long nanosTimeout)</code>   ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­ï¼Œæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚</td></tr><tr><td><code>void</code></td><td><code>awaitUninterruptibly()</code>   ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>awaitUntil(Date deadline)</code>  ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­ï¼Œæˆ–è€…æŒ‡å®šçš„æœ€åæœŸé™åˆ°è¾¾ã€‚</td></tr><tr><td><code>void</code></td><td><code>signal()</code>   å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚</td></tr><tr><td><code>void</code></td><td><code>signalAll()</code>   å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚</td></tr></tbody></table><h2 id="StampedLock"><a href="#StampedLock" class="headerlink" title="StampedLock"></a>StampedLock</h2><p><code>StampedLock</code>æ˜¯<code>Java8</code>å¼•å…¥çš„ä¸€ç§æ–°çš„é”æœºåˆ¶ï¼Œæ˜¯å¯¹è¯»å†™é”<code>ReentrantReadWriteLock</code>çš„å¢å¼ºï¼Œè¯»å†™é”è™½ç„¶åˆ†ç¦»äº†è¯»å’Œå†™çš„åŠŸèƒ½ï¼Œä½¿å¾—è¯»ä¸è¯»ä¹‹é—´ä¸äº’æ–¥ï¼Œä½†æ˜¯è¯»å’Œå†™ä¹‹é—´ä¾ç„¶æ˜¯äº’æ–¥çš„ï¼Œæœ¬è´¨ä¸Šä»ç„¶æ˜¯æ‚²è§‚é”ï¼Œå¦‚æœæœ‰å¤§é‡çš„è¯»çº¿ç¨‹å°±ä¼šå¼•èµ·å†™çº¿ç¨‹çš„é¥¥é¥¿ï¼Œè€Œ<code>StampedLock</code>åˆ™æä¾›äº†ä¸€ç§ä¹è§‚çš„è¯»ç­–ç•¥,è¿™ç§ä¹è§‚ç­–ç•¥çš„é”éå¸¸ç±»ä¼¼äºæ— é”çš„æ“ä½œï¼Œä½¿å¾—ä¹è§‚é”å®Œå…¨ä¸ä¼šå†™çº¿ç¨‹</p><h3 id="æ‚²è§‚é”ç­–ç•¥"><a href="#æ‚²è§‚é”ç­–ç•¥" class="headerlink" title="æ‚²è§‚é”ç­–ç•¥"></a>æ‚²è§‚é”ç­–ç•¥</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/28 13:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StampedLockTest1</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> StampedLock stampedLock = <span class="keyword">new</span> StampedLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> List<long> shareData = <span class="keyword">new</span> ArrayList<>();</long></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        Runnable readRunnable = () -> {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                read();</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        Runnable writeRunnable = () -> {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                write();</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line">        executorService.submit(readRunnable);</span><br><span class="line"></span><br><span class="line">        executorService.submit(writeRunnable);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">long</span> stamped = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            stamped = stampedLock.readLock();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" read "</span> + shareData);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            stampedLock.unlockRead(stamped);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">long</span> stamp = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            stamp = stampedLock.writeLock();</span><br><span class="line">            shareData.add(System.currentTimeMillis());</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" Write "</span>);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            stampedLock.unlockWrite(stamp);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®è¿™ç§æ–¹å¼å°±å’Œ<code>ReadWriteLock</code> æ˜¯ç­‰ä»·çš„äº†ã€‚</p><h3 id="ä¹è§‚è¯»ç­–ç•¥"><a href="#ä¹è§‚è¯»ç­–ç•¥" class="headerlink" title="ä¹è§‚è¯»ç­–ç•¥"></a>ä¹è§‚è¯»ç­–ç•¥</h3><p>ç›¸å¯¹ä¸Šé¢çš„æ–¹å¼ï¼Œå…¶å®å°±æ˜¯æ”¹å˜äº†è¯»çš„ç­–ç•¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">long</span> stamp = stampedLock.tryOptimisticRead(); <span class="comment">//éé˜»å¡</span></span><br><span class="line">    <span class="comment">//æš‚å­˜res</span></span><br><span class="line">    String res=Thread.currentThread().getName() + <span class="string">" read "</span> + shareData;</span><br><span class="line">    <span class="keyword">if</span> (!stampedLock.validate(stamp)) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//éªŒè¯å¤±è´¥,è¯´æ˜æœ‰çº¿ç¨‹è¿›è¡Œäº†å†™æ“ä½œ,å¯èƒ½é€ æˆæ•°æ®ä¸ä¸€è‡´</span></span><br><span class="line">            <span class="comment">//è¿›è¡Œé”å‡çº§,è·å–å…±äº«è¯»é”</span></span><br><span class="line">            stamp = stampedLock.readLock();</span><br><span class="line">            <span class="comment">//è¦†ç›–res</span></span><br><span class="line">            res=Thread.currentThread().getName() + <span class="string">" read "</span> + shareData;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            stampedLock.unlockRead(stamp);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    System.out.println(res);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…ˆå°è¯•è·å–ä¹è§‚è¯»é”ï¼ˆéé˜»å¡ï¼‰è¿”å›ä¸€ä¸ªæˆ³ï¼Œç„¶åè¿›è¡Œè¯»æ“ä½œï¼Œç¼“å­˜è¯»çš„ç»“æœï¼Œç„¶åæ ¹æ®å‰é¢è¿”å›çš„æˆ³éªŒè¯åœ¨æ­¤è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰å†™çº¿ç¨‹è¢«å ç”¨è¿‡ï¼Œå¦‚æœè¢«å ç”¨è¿‡å°±è¡¨ç¤ºæ•°æ®å¯èƒ½ä¸ä¸€è‡´äº†ï¼Œå°±éœ€è¦è½¬æ¢æˆæ™®é€šçš„<code>å…±äº«è¯»é”</code> ï¼Œå†æ¬¡è¯»å–æ•°æ®åˆ·æ–°ç»“æœï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæœ€åé‡Šæ”¾é”ã€‚</p><p>è¿™é‡Œä¸€å¼€å§‹è¢«è§†é¢‘é‡Œé¢è®²çš„ææ‡µäº†ä»–å†™çš„æ˜¯è¿™æ ·çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">long</span> stamp = stampedLock.tryOptimisticRead(); <span class="comment">//éé˜»å¡</span></span><br><span class="line">    <span class="keyword">if</span> (stampedLock.validate(stamp)) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            stamp = stampedLock.readLock();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" read "</span> + shareData);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            stampedLock.unlockRead(stamp);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç„¶åå°±è¯´è¿™æ ·æ¯”ReadWriteLockæ•ˆç‡é«˜å¾ˆå¤šï¼Œæˆ‘è¶Šçœ‹è¶Šè§‰å¾—ä¸å¯¹åŠ²ï¼Œç„¶åè‡ªå·±æŸ¥äº†ä¸‹ï¼Œçœ‹äº†ä¸‹å®˜æ–¹çš„Demoå‘ç°ä»–å†™çš„ç¡®å®æ˜¯é”™çš„ã€‚ã€‚ã€‚</p><p>APIä»€ä¹ˆçš„å°±ä¸å¤šè¯´äº†ï¼Œè¿™é‡Œå¦‚æœæƒ³äº†è§£æ›´å¤šå¯ä»¥çœ‹çœ‹<a href="https://segmentfault.com/a/1190000015808032#articleHeader20" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a></p><p>å¦å¤–å¦‚æœæƒ³çœ‹çœ‹æ€§èƒ½å¯¹æ¯”çš„å¯ä»¥çœ‹çœ‹ <a href="http://ifeve.com/java-8-stampedlocks-vs-readwritelocks-and-synchronized/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a></p><blockquote><p>è¿™é‡Œè¿˜è¦å­˜ä¸ªç–‘ï¼Œæœ€åçš„é‡Šæ”¾è¯»é”ä¹‹ååˆ°æœ€åä¸€æ­¥çš„æ—¶å€™ä¸æ˜¯ä¹Ÿæœ‰å¯èƒ½æœ‰å†™çº¿ç¨‹è¿›å…¥ä¹ˆï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µä¹ˆï¼Ÿ å› ä¸ºæºç ä¸Šæ³¨é‡Šçš„Demoä¹Ÿæ˜¯è¿™æ ·å†™çš„æ‰€ä»¥è¿™é‡Œè¿˜æ˜¯æœ‰ç‚¹ç–‘é—®çš„ã€‚</p></blockquote><h3 id="éœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#éœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="éœ€è¦æ³¨æ„çš„åœ°æ–¹"></a>éœ€è¦æ³¨æ„çš„åœ°æ–¹</h3><ul><li><p>æ‰€æœ‰è·å–é”çš„æ–¹æ³•ï¼Œéƒ½è¿”å›ä¸€ä¸ªé‚®æˆ³ï¼ˆStampï¼‰ï¼ŒStampä¸º0è¡¨ç¤ºè·å–å¤±è´¥ï¼Œå…¶ä½™éƒ½è¡¨ç¤ºæˆåŠŸï¼›</p></li><li><p>æ‰€æœ‰é‡Šæ”¾é”çš„æ–¹æ³•ï¼Œéƒ½éœ€è¦ä¸€ä¸ªé‚®æˆ³ï¼ˆStampï¼‰ï¼Œè¿™ä¸ªStampå¿…é¡»æ˜¯å’ŒæˆåŠŸè·å–é”æ—¶å¾—åˆ°çš„Stampä¸€è‡´ï¼›</p></li><li><p>StampedLockæ˜¯ä¸å¯é‡å…¥çš„ (å¦‚æœä¸€ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰äº†å†™é”ï¼Œå†å»è·å–å†™é”çš„è¯å°±ä¼šé€ æˆæ­»é”)ï¼Œæ‰€ä»¥è¿™å°±è¦æˆ‘ä»¬å¼€å‘äººå‘˜ä¸è¦å»ä¿®æ”¹è¿”å›çš„æˆ³æˆ–è€…è®©å®ƒé€ƒé€¸å‡ºå»</p></li><li><p>StampedLock ä¸æ”¯æŒCondition</p></li></ul><h2 id="ForkJoin"><a href="#ForkJoin" class="headerlink" title="ForkJoin"></a>ForkJoin</h2><p>ForkJoinæ˜¯Java7æä¾›çš„åŸç”Ÿå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†æ¡†æ¶ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯å°†å¤§ä»»åŠ¡åˆ†å‰²æˆå°ä»»åŠ¡ï¼Œæœ€åå°†å°ä»»åŠ¡èšåˆèµ·æ¥å¾—åˆ°ç»“æœã€‚forkæ˜¯åˆ†è§£çš„æ„æ€, joinæ˜¯æ”¶é›†çš„æ„æ€. å®ƒéå¸¸ç±»ä¼¼äºHADOOPæä¾›çš„MapReduceæ¡†æ¶ï¼Œåªæ˜¯MapReduceçš„ä»»åŠ¡å¯ä»¥é’ˆå¯¹é›†ç¾¤å†…çš„æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨é›†ç¾¤çš„èƒ½åŠ›å®Œæˆè®¡ç®—ä»»åŠ¡ã€‚ForkJoinæ›´åŠ ç±»ä¼¼äºå•æœºç‰ˆçš„MapReduceã€‚</p><h3 id="RecursiveTask"><a href="#RecursiveTask" class="headerlink" title="RecursiveTask"></a>RecursiveTask</h3><p><strong>è®¡ç®—sumå’Œ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/30 11:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecursiveTest1</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸ªå€¼ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§æ•°æ®ï¼Œä¸èƒ½å¤ªå°ä¹Ÿä¸èƒ½å¤ªå¤§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_THRESHOLD=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> ForkJoinPool forkJoinPool=<span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">        ForkJoinTask<integer> submit = forkJoinPool.submit(<span class="keyword">new</span> CaculateRecursiveTask(<span class="number">0</span>, <span class="number">100</span>));</integer></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Integer integer = submit.get();</span><br><span class="line">            System.out.println(integer);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (ExecutionException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CaculateRecursiveTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span><<span class="title">Integer</span>></span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> start;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> end;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">CaculateRecursiveTask</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">            <span class="keyword">this</span>.end = end;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span>(end-start<=MAX_THRESHOLD){</span><br><span class="line">                <span class="keyword">return</span> IntStream.rangeClosed(start,end).sum();</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">int</span> mid=(start+end)/<span class="number">2</span>;</span><br><span class="line">                CaculateRecursiveTask leftTask=<span class="keyword">new</span> CaculateRecursiveTask(start,mid);</span><br><span class="line">                CaculateRecursiveTask rightTask=<span class="keyword">new</span> CaculateRecursiveTask(mid+<span class="number">1</span>,end);</span><br><span class="line">                <span class="comment">//é˜»å¡</span></span><br><span class="line">                leftTask.fork();</span><br><span class="line">                rightTask.fork();</span><br><span class="line">                <span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line">                <span class="keyword">return</span> leftTask.join()+rightTask.join();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="RecursiveAction"><a href="#RecursiveAction" class="headerlink" title="RecursiveAction"></a>RecursiveAction</h3><p><strong>è®¡ç®—sumå’Œ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/30 13:08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecursiveActionTest1</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_THRESHOLD=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger SUM=<span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">final</span> ForkJoinPool forkJoinPool=<span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">        forkJoinPool.submit(<span class="keyword">new</span> CalculateRecursiveAction(<span class="number">0</span>, <span class="number">100</span>));</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        System.out.println(SUM.get());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculateRecursiveAction</span> <span class="keyword">extends</span> <span class="title">RecursiveAction</span></span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> start;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> end;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">CalculateRecursiveAction</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">            <span class="keyword">this</span>.end = end;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">compute</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(end-start<=MAX_THRESHOLD){</span><br><span class="line">                SUM.addAndGet(IntStream.rangeClosed(start,end).sum());</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">int</span> mid=(start+end)/<span class="number">2</span>;</span><br><span class="line">                CalculateRecursiveAction leftTask=<span class="keyword">new</span> CalculateRecursiveAction(start,mid);</span><br><span class="line">                CalculateRecursiveAction rightTask=<span class="keyword">new</span> CalculateRecursiveAction(mid+<span class="number">1</span>,end);</span><br><span class="line">                <span class="comment">//é˜»å¡</span></span><br><span class="line">                leftTask.fork();</span><br><span class="line">                rightTask.fork();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="Phaser"><a href="#Phaser" class="headerlink" title="Phaser"></a>Phaser</h2><p>CountDownLatchå’ŒCyclicBarrieréƒ½æ˜¯JDK 1.5å¼•å…¥çš„ï¼Œè€ŒPhaseræ˜¯JDK 1.7å¼•å…¥çš„ã€‚Phaserçš„åŠŸèƒ½ä¸CountDownLatchå’ŒCyclicBarrieræœ‰éƒ¨åˆ†é‡å ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ›´ä¸°å¯Œçš„è¯­ä¹‰å’Œæ›´çµæ´»çš„ç”¨æ³•ã€‚</p><p>Phaseré¡¾åæ€ä¹‰ï¼Œä¸é˜¶æ®µç›¸å…³ã€‚Phaseræ¯”è¾ƒé€‚åˆè¿™æ ·ä¸€ç§åœºæ™¯ï¼Œä¸€ç§ä»»åŠ¡å¯ä»¥åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œç°å¸Œæœ›å¤šä¸ªçº¿ç¨‹å»å¤„ç†è¯¥æ‰¹ä»»åŠ¡ï¼Œå¯¹äºæ¯ä¸ªé˜¶æ®µï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘è¿›è¡Œï¼Œä½†æ˜¯å¸Œæœ›ä¿è¯åªæœ‰å‰é¢ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å®Œæˆä¹‹åæ‰èƒ½å¼€å§‹åé¢çš„ä»»åŠ¡ã€‚è¿™ç§åœºæ™¯å¯ä»¥ä½¿ç”¨å¤šä¸ªCyclicBarrieræ¥å®ç°ï¼Œæ¯ä¸ªCyclicBarrierè´Ÿè´£ç­‰å¾…ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å…¨éƒ¨å®Œæˆã€‚ä½†æ˜¯ä½¿ç”¨CyclicBarrierçš„ç¼ºç‚¹åœ¨äºï¼Œéœ€è¦æ˜ç¡®çŸ¥é“æ€»å…±æœ‰å¤šå°‘ä¸ªé˜¶æ®µï¼ŒåŒæ—¶å¹¶è¡Œçš„ä»»åŠ¡æ•°éœ€è¦æå‰é¢„å®šä¹‰å¥½ï¼Œä¸”æ— æ³•åŠ¨æ€ä¿®æ”¹ã€‚è€ŒPhaserå¯åŒæ—¶è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/30 13:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhaserTest1</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> Phaser phaser = <span class="keyword">new</span> Phaser();</span><br><span class="line"></span><br><span class="line">        Stream.of(<span class="string">"t1"</span>, <span class="string">"t2"</span>, <span class="string">"t3"</span>, <span class="string">"t4"</span>, <span class="string">"t5"</span>).forEach(name -> <span class="keyword">new</span> Thread(<span class="keyword">new</span> Task(phaser), name).start());</span><br><span class="line">        <span class="comment">//æ³¨å†Œmainçº¿ç¨‹</span></span><br><span class="line">        phaser.register();</span><br><span class="line">        phaser.arriveAndAwaitAdvance();</span><br><span class="line">        System.out.println(<span class="string">"all of work finished"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Phaser phaser;</span><br><span class="line"></span><br><span class="line">        Task(Phaser phaser) {</span><br><span class="line">            <span class="keyword">this</span>.phaser = phaser;</span><br><span class="line">            <span class="comment">//åŠ¨æ€å¢åŠ </span></span><br><span class="line">            <span class="keyword">this</span>.phaser.register();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" is working"</span>);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            phaser.arriveAndAwaitAdvance();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="API-5"><a href="#API-5" class="headerlink" title="API"></a>API</h3><table><thead><tr><th>Modifier and Type</th><th>Method and Description</th></tr></thead><tbody><tr><td><code>int</code></td><td><code>arrive()</code>   æŠµè¾¾è¿™ä¸ªç§»ç›¸å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…åˆ«äººåˆ°è¾¾ã€‚</td></tr><tr><td><code>int</code></td><td><code>arriveAndAwaitAdvance()</code>   åˆ°è¾¾è¿™ä¸ªç§»ç›¸å™¨ï¼Œç­‰å¾…å…¶ä»–äººã€‚</td></tr><tr><td><code>int</code></td><td><code>arriveAndDeregister()</code>   åˆ°è¾¾è¿™ä¸ªç§»ç›¸å™¨å¹¶ä»å…¶ä¸­æ³¨é”€ï¼Œè€Œæ— éœ€ç­‰å¾…åˆ«äººåˆ°è¾¾ã€‚</td></tr><tr><td><code>int</code></td><td><code>awaitAdvance(int phase)</code>   ç­‰å¾…è¯¥ç›¸ä½å™¨çš„ç›¸ä½ä»ç»™å®šç›¸ä½å€¼å‰è¿›ï¼Œå¦‚æœå½“å‰ç›¸ä½ä¸ç­‰äºç»™å®šç›¸ä½å€¼ï¼Œåˆ™ç«‹å³è¿”å›ï¼Œæˆ–è€…è¯¥ç›¸ä½å™¨è¢«ç»ˆæ­¢ã€‚</td></tr><tr><td><code>int</code></td><td><code>awaitAdvanceInterruptibly(int phase)</code>   ç­‰å¾…è¯¥ç§»ç›¸å™¨çš„é˜¶æ®µä»ç»™å®šçš„ç›¸ä½å€¼æ¨è¿›ï¼Œå¦‚æœåœ¨ç­‰å¾…æ—¶ <code>InterruptedException</code>åˆ™æŠ›å‡º  <code>InterruptedException</code> ï¼Œæˆ–è€…å¦‚æœå½“å‰ç›¸ä½ä¸ç­‰äºç»™å®šçš„ç›¸ä½å€¼æˆ–è€…è¯¥ç›¸ä½å™¨è¢«ç»ˆæ­¢ï¼Œåˆ™ç«‹å³è¿”å›ã€‚</td></tr><tr><td><code>int</code></td><td><code>awaitAdvanceInterruptibly(int phase,  long timeout, TimeUnit unit)</code>  ç­‰å¾…è¯¥ç§»ç›¸å™¨çš„é˜¶æ®µä»ç»™å®šçš„ç›¸ä½å€¼æˆ–ç»™å®šçš„è¶…æ—¶æ—¶é—´  <code>InterruptedException</code>åˆ°ç­‰å¾…æ—¶æŠ›å‡º <code>InterruptedException</code>  ï¼Œå¦‚æœå½“å‰ç›¸ä½ä¸ç­‰äºç»™å®šçš„ç›¸ä½å€¼ï¼Œåˆ™ç«‹å³è¿”å›ï¼Œæˆ–è€…è¯¥ç›¸ä½å™¨è¢«ç»ˆæ­¢ã€‚</td></tr><tr><td><code>int</code></td><td><code>bulkRegister(int parties)</code>   å¢åŠ ç»™å®šæ•°é‡çš„æ–°çš„æœ‰äº‰è®®çš„æ´¾å¯¹åˆ°è¿™ä¸ªç§»ç›¸å™¨ã€‚</td></tr><tr><td><code>void</code></td><td><code>forceTermination()</code>   å¼ºåˆ¶æ­¤ç§»ç›¸å™¨è¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚</td></tr><tr><td><code>int</code></td><td><code>getArrivedParties()</code>   è¿”å›åœ¨æ­¤ç§»ç›¸å™¨çš„å½“å‰é˜¶æ®µåˆ°è¾¾çš„å·²æ³¨å†Œæ–¹çš„æ•°é‡ã€‚</td></tr><tr><td><code>Phaser</code></td><td><code>getParent()</code>   è¿”å›æ­¤ç§»ç›¸å™¨çš„çˆ¶çº§ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å› <code>null</code> ã€‚</td></tr><tr><td><code>int</code></td><td><code>getPhase()</code>   è¿”å›å½“å‰ç›¸ä½æ•°ã€‚</td></tr><tr><td><code>int</code></td><td><code>getRegisteredParties()</code>   è¿”å›åœ¨æ­¤ç§»åŠ¨è®¾å¤‡ä¸Šæ³¨å†Œçš„å„æ–¹æ•°é‡ã€‚</td></tr><tr><td><code>Phaser</code></td><td><code>getRoot()</code>   è¿”å›æ­¤ç§»ç›¸å™¨çš„æ ¹ç¥–å…ˆï¼Œå¦‚æœå®ƒæ²¡æœ‰çˆ¶ä»£ï¼Œåˆ™ä¸è¯¥ç§»ç›¸å™¨ç›¸åŒã€‚</td></tr><tr><td><code>int</code></td><td><code>getUnarrivedParties()</code>   è¿”å›å°šæœªåˆ°è¾¾æ­¤ç§»ç›¸å™¨å½“å‰é˜¶æ®µçš„å·²æ³¨å†Œæ–¹çš„æ•°é‡ã€‚</td></tr><tr><td><code>boolean</code></td><td><code>isTerminated()</code>   è¿”å› <code>true</code>å¦‚æœç§»ç›¸å™¨å·²è¢«ç»ˆæ­¢ã€‚</td></tr><tr><td><code>protected boolean</code></td><td><code>onAdvance(int phase,  int registeredParties)</code>  åœ¨å³å°†è¿›è¡Œçš„ç›¸ä½æå‰æ‰§è¡ŒåŠ¨ä½œçš„å¯è¦†ç›–æ–¹æ³•ï¼Œå¹¶æ§åˆ¶ç»ˆæ­¢ã€‚</td></tr><tr><td><code>int</code></td><td><code>register()</code>   æ·»åŠ ä¸€ä¸ªæ–°çš„unririved partyåˆ°è¿™ä¸ªç§»ç›¸å™¨ã€‚</td></tr><tr><td><code>String</code></td><td><code>toString()</code>   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤ç§»ç›¸å™¨çš„å­—ç¬¦ä¸²åŠå…¶çŠ¶æ€ã€‚</td></tr></tbody></table><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¤§è‡´å½’çº³äº†ä¸€äº›å¸¸è§çš„å¹¶å‘å·¥å…·ï¼Œå½“ç„¶åªæ˜¯æµ…æ˜¾çš„è®°å½•äº†ä¸€ä¸‹æ€æ ·ä½¿ç”¨ï¼ŒåŸç†éƒ¨åˆ†è¿˜æ²¡æœ‰æ·±å…¥çš„äº†è§£ï¼Œåç»­è‚¯å®šä¼šå»ç ”ç©¶åº•å±‚å®ç°æºç åŒ…æ‹¬<code>AQS</code>å’Œ<code>LockSupport</code>ç­‰ç­‰ï¼Œå…¶å®è¶Šå¾€åå­¦å°±è¶Šæƒ³çŸ¥é“åˆ°åº•å±‚æ˜¯æ€æ ·ä¸ªè¿‡ç¨‹ï¼Œåˆ°åº•æ˜¯å¦‚ä½•åŠ é”å¦‚ä½•è§£é”ï¼ŸCASåˆèµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ï¼ŸSynchnorizedåº•å±‚åˆæ˜¯å¦‚ä½•å®ç°ï¼Ÿâ€¦å­¦æ— æ­¢å¢ƒå•Š. JUCé™¤äº†è¿™äº›å¹¶å‘å·¥å…·å¤–è¿˜æœ‰<strong>çº¿ç¨‹æ± </strong> ï¼Œ<strong>é˜»å¡é˜Ÿåˆ—</strong> è¿˜æ²¡ä»‹ç»ï¼Œåé¢ä¼šç»§ç»­ä»‹ç»ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ»‘åŠ¨çª—å£</title>
      <link href="/2019/07/20/leetcode-hua-dong-chuang-kou/"/>
      <url>/2019/07/20/leetcode-hua-dong-chuang-kou/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="LeetCode-æ»‘åŠ¨çª—å£"><a href="#LeetCode-æ»‘åŠ¨çª—å£" class="headerlink" title="LeetCode æ»‘åŠ¨çª—å£"></a>LeetCode æ»‘åŠ¨çª—å£</h2><p>æ»‘åŠ¨é—®é¢˜åŒ…å«ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ä¸€ä¸ªå¤§æ•°ç»„ä¸Šçš„å­åˆ—è¡¨ï¼Œè¯¥æ•°ç»„æ˜¯ä¸€ä¸ªåº•å±‚å…ƒç´ é›†åˆã€‚å‡è®¾æœ‰æ•°ç»„ [a b c d e f g h ]ï¼Œä¸€ä¸ªå¤§å°ä¸º 3 çš„ <strong>æ»‘åŠ¨çª—å£</strong> åœ¨å…¶ä¸Šæ»‘åŠ¨ï¼Œåˆ™æœ‰ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[a b c]</span><br><span class="line">  [b c d]</span><br><span class="line">    [c d e]</span><br><span class="line">      [d e f]</span><br><span class="line">        [e f g]</span><br><span class="line">          [f g h]</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯ä½¿ç”¨è¿™ä¸ªçª—å£åœ¨æ•°ç»„çš„ <strong>åˆæ³•åŒºé—´</strong> å†…è¿›è¡Œæ»‘åŠ¨ï¼ŒåŒæ—¶ <strong>åŠ¨æ€åœ°</strong>è®°å½•ä¸€äº›æœ‰ç”¨çš„æ•°æ®ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæå¤§åœ°æé«˜ç®—æ³•åœ°æ•ˆç‡ã€‚</p><h2 id="239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/sliding-window-maximum/" target="_blank" rel="noopener">239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <em>nums*ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º *k</em> çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£ <em>k</em> å†…çš„æ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚</p><p>è¿”å›æ»‘åŠ¨çª—å£æœ€å¤§å€¼ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">3</span>,-<span class="number">1</span>,-<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>], å’Œ k = <span class="number">3</span></span><br><span class="line">è¾“å‡º: [<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>] </span><br><span class="line">è§£é‡Š: </span><br><span class="line"></span><br><span class="line">  æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[<span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span>] -<span class="number">3</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>       <span class="number">3</span></span><br><span class="line"> <span class="number">1</span> [<span class="number">3</span>  -<span class="number">1</span>  -<span class="number">3</span>] <span class="number">5</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>       <span class="number">3</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span> [-<span class="number">1</span>  -<span class="number">3</span>  <span class="number">5</span>] <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>       <span class="number">5</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span> [-<span class="number">3</span>  <span class="number">5</span>  <span class="number">3</span>] <span class="number">6</span>  <span class="number">7</span>       <span class="number">5</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span>  -<span class="number">3</span> [<span class="number">5</span>  <span class="number">3</span>  <span class="number">6</span>] <span class="number">7</span>       <span class="number">6</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span>  -<span class="number">3</span>  <span class="number">5</span> [<span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>]      <span class="number">7</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ³¨æ„ï¼š</strong></p><p>ä½ å¯ä»¥å‡è®¾ <em>k</em> æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œ1 â‰¤ k â‰¤ è¾“å…¥æ•°ç»„çš„å¤§å°ï¼Œä¸”è¾“å…¥æ•°ç»„ä¸ä¸ºç©ºã€‚</p><p><strong>è¿›é˜¶ï¼š</strong></p><p>ä½ èƒ½åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦å†…è§£å†³æ­¤é¢˜å—ï¼Ÿ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] maxSlidingWindow2(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) {</span><br><span class="line">    <span class="comment">//é¢˜ç›®ä¸Šè¯´çš„ä¸ä¸ºç©ºï¼Œè¿˜æ˜¯ç»™æˆ‘æ¥äº†ä¸ªç©ºã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="keyword">if</span>(nums.length==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{};</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">1</span>) <span class="keyword">return</span> nums;</span><br><span class="line">    LinkedList<integer> list=<span class="keyword">new</span> LinkedList<integer>();</integer></integer></span><br><span class="line">    <span class="keyword">int</span> []res=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length-k+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">    list.add(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">while</span>(!list.isEmpty() && nums[list.getLast()]<nums[i]){< span><br><span class="line">            <span class="comment">//å°äºnums[i]çš„å…ƒç´ ,ä»å³è¾¹(å°¾)å‡ºé˜Ÿåˆ— ,æ§åˆ¶æœ€å·¦è¾¹(å¤´)æœ€å¤§</span></span><br><span class="line">            list.removeLast();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ç„¶åå°†å®ƒåŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä»å³è¾¹(å°¾)</span></span><br><span class="line">        list.addLast(i);</span><br><span class="line">        <span class="comment">//å¦‚æœé˜Ÿåˆ—æº¢å‡ºäº†å°±ä»å³è¾¹ç§»é™¤ä¸€ä¸ªï¼ˆå¤´ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span>(i-list.getFirst()==k){</span><br><span class="line">            list.removeFirst();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(i>=k-<span class="number">1</span>){</span><br><span class="line">            res[index++]=nums[list.getFirst()];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums[i]){<></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®å¼€å§‹æˆ‘ä¹Ÿä¸ä¼šåšï¼Œçœ‹äº†æç¤ºåæäº†åŠå¤©æ‰å¼„å‡ºæ¥ï¼Œ23msï¼Œ70%å·¦å³ï¼Œæ€è·¯å°±æ˜¯åˆ©ç”¨ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—(å¤´å°¾éƒ½å¯ä»¥è¿›å‡º)ï¼Œé˜Ÿåˆ—ä¸­å­˜<strong>æ•°ç»„ä¸‹æ ‡</strong>ï¼Œç„¶åéå†æ•°ç»„ï¼Œåœ¨è¿›å…¥é˜Ÿåˆ—æ—¶ä»å³å‘å·¦éå†é˜Ÿå°¾ï¼Œå°†<strong>å°äºå½“å‰å…ƒç´ </strong>çš„é˜Ÿå°¾å…ƒç´ å»é™¤(å› ä¸ºå·²ç»æ²¡ç”¨äº†ï¼Œåé¢çš„æœ€å¤§å€¼ä¸å¯èƒ½æ˜¯å®ƒä»¬)ï¼Œä¸¾ä¸ªä¾‹å­</p><blockquote><p>[2ï¼Œ1ï¼Œ-1ï¼Œ3ï¼Œâ€¦â€¦]  k=3 ï¼Œå½“è¯»åˆ°<strong>3</strong>è¿™ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œçª—å£å†å‘å³ç§»åŠ¨æœ€å¤§å€¼è‚¯å®šä¸ä¼šæ˜¯å³è¾¹çš„å…ƒç´ äº†ï¼Œæ‰€ä»¥ç›´æ¥å‰”é™¤ä»–ä»¬ï¼Œåœ¨çº¸ä¸Šç”»ä¸€ç”»å°±æ˜ç™½äº†</p></blockquote><p>ç„¶åå¾ˆå…³é”®çš„ä¸€æ­¥å°±æ˜¯ä»€ä¹ˆæ—¶å€™ç§»é™¤æœ€å·¦è¾¹çš„å…ƒç´ ï¼Œå…¶å®æŒ‰ç…§äººçš„æ€è·¯æ¥æƒ³å°±æ˜¯æœ€å·¦è¾¹çš„å…ƒç´ ä¸åœ¨çª—å£å†…çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œè¯»åˆ°<strong>3</strong>çš„æ—¶å€™ï¼Œ<strong>2</strong>å…¶å®å°±åº”è¯¥å‰”é™¤äº†å› ä¸ºå®ƒå·²ç»ä¸åœ¨çª—å£å†…äº†ã€‚ç”¨ä»£ç æ¥æè¿°å°±æ˜¯</p><p><code>i-list.getFirst()==k</code>ï¼Œiä»£è¡¨<strong>å½“å‰å…ƒç´ ä¸‹æ ‡</strong>ï¼Œä¸Šé¢çš„ä¾‹å­<strong>3</strong>å¯¹åº”çš„<strong>i</strong>å°±æ˜¯<strong>3</strong>ï¼Œ<strong>list.getFirst()=0</strong>ï¼Œåˆšå¥½å·®ä¸ºkï¼Œå°±ä»£è¡¨<strong>2</strong>å·²ç»è¶…å‡ºçª—å£äº†åº”è¯¥ç§»é™¤äº†ã€‚</p><p>å…¶å®è¿™é‡Œæˆ‘å¼€å§‹ä¸æ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘åœ¨é˜Ÿåˆ—é‡Œé¢å­˜çš„ä¸æ˜¯å…ƒç´ ç´¢å¼•ï¼Œæˆ‘å­˜çš„æ˜¯å…ƒç´ ï¼Œç„¶ååœ¨åˆ¤æ–­ä»€ä¹ˆæ—¶å€™ç§»é™¤çš„æ—¶å€™å‘ç°åˆ¤æ–­ä¸äº†ï¼Œ<strong>index</strong>ä¹Ÿåªæ˜¯ç»“æœå…ƒç´ çš„ä¸‹æ ‡ï¼Œå¹¶ä¸èƒ½ä»£è¡¨é˜Ÿåˆ—æœ€å·¦å…ƒç´ çš„ä¸‹æ ‡ï¼Œå¯¹äºæ•°ç»„å­˜ä¸‹æ ‡ä¼˜å…ˆäºå­˜å…ƒç´ ï¼Œå¤šä¸€ä¸ªå·²çŸ¥é‡æœ‰æ—¶å€™è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„</p><p>è¿™é¢˜å…¶å®è¿˜æœ‰å…¶ä»–çš„åšæ³•ï¼Œåº”è¯¥è¯´ä¹Ÿæ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œæäº¤è®°å½•ä¸Šæœ€å¿«çš„æ–¹æ³•ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] maxSlidingWindow3(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) {</span><br><span class="line">    <span class="comment">//é¢˜ç›®ä¸Šè¯´çš„ä¸ä¸ºç©ºï¼Œè¿˜æ˜¯ç»™æˆ‘æ¥äº†ä¸ªç©ºã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="keyword">int</span> len = nums.length;</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{};</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{nums[<span class="number">0</span>]};</span><br><span class="line">    <span class="keyword">int</span> localMax = Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[len - k + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < k; i++) {</span><br><span class="line">        <span class="comment">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªçª—å£çš„æœ€å¤§å€¼</span></span><br><span class="line">        localMax = max(nums[i], localMax);</span><br><span class="line">    }</span><br><span class="line">    result[<span class="number">0</span>] = localMax;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i < len - k + <span class="number">1</span>; i++) {</span><br><span class="line">        <span class="comment">//çª—å£çš„ä¸‹ä¸€ä¸ªå…ƒç´  k=3 , i=1 ä¸‹ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡ä¸º 3</span></span><br><span class="line">        <span class="keyword">if</span> (nums[i + k - <span class="number">1</span>] > localMax) {</span><br><span class="line">            <span class="comment">//åˆ¤æ–­å½“å‰çª—å£æœ€å¤§å€¼å’Œä¸‹ä¸€ä¸ªå…ƒç´ çš„å¤§å°</span></span><br><span class="line">            <span class="comment">//å¦‚æœæ¯”å½“å‰çª—å£çš„æœ€å¤§å€¼è¿˜è¦å¤§ å°±ä¸ç”¨æ‰¾äº† å°±æ˜¯å®ƒäº†</span></span><br><span class="line">            localMax = nums[i + k - <span class="number">1</span>];</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (nums[i - <span class="number">1</span>] == localMax) {</span><br><span class="line">            <span class="comment">//ä¸‹ä¸€ä¸ªå…ƒç´ æ¯”å½“å‰çª—å£æœ€å¤§å€¼å° è€Œä¸”å¾ˆä¸å·§</span></span><br><span class="line">            <span class="comment">//å½“å‰æœ€å¤§å€¼åˆšå¥½æ˜¯å½“å‰çª—å£çš„æœ€å·¦è¾¹çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯é©¬ä¸Šè¦è¶…è¿‡çª—å£çš„å…ƒç´ </span></span><br><span class="line">            localMax = nums[i];</span><br><span class="line">            <span class="comment">//æ‰€ä»¥å°±è¦é‡æ–°æ‰¾æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = i; x < i + k; x++) {</span><br><span class="line">                localMax = max(nums[x], localMax);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å‰©ä¸‹çš„è¯·å†µå°±æ˜¯ æ¯”å½“å‰æœ€å¤§å€¼å°ï¼Œå¹¶ä¸”æœ€å¤§å€¼ä¸æ˜¯æœ€å·¦è¾¹çš„å…ƒç´ (è¿˜æ²¡æœ‰å‡ºç•Œ)ï¼Œæœ€å¤§å€¼ä¸å˜</span></span><br><span class="line">        <span class="comment">//copyåˆ°ç»“æœä¸­</span></span><br><span class="line">        result[i] = localMax;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…¶å®å¯ä»¥ç”¨Math.max()</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(a>=b)<span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>2msï¼Œ99%  è¿™ç§åšæ³•æ˜¯æœ€å¿«çš„ï¼Œè€Œä¸”ä¹Ÿæ¯”è¾ƒç›´ç™½ï¼Œæ—¶é—´å¤æ‚åº¦æœ€ååº”è¯¥éƒ½æ˜¯O(NK)ï¼Œç¬¬ä¸€ç§è€—æ—¶åº”è¯¥ä¸»è¦åœ¨é˜Ÿåˆ—çš„ç§»é™¤å’Œæ·»åŠ å…ƒç´ ä¸Šé¢ã€‚</p><h2 id="3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/" target="_blank" rel="noopener">3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ <strong>æœ€é•¿å­ä¸²</strong> çš„é•¿åº¦ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"abcabcbb"</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span> </span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ <span class="string">"abc"</span>ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º <span class="number">3</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"bbbbb"</span></span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ <span class="string">"b"</span>ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º <span class="number">1</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"pwwkew"</span></span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ <span class="string">"wke"</span>ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º <span class="number">3</span>ã€‚</span><br><span class="line">     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ<span class="string">"pwke"</span> æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å…¶å®å¾ˆä¹…ä»¥å‰(åŠå¹´å‰)åšè¿‡ä¸€æ¬¡ï¼Œå½“æ—¶ç”¨çš„æ–¹æ³•å¾ˆlowğŸ˜‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190503/zQ9MBrOhQm4S.png?imageslim" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">char</span> [] chars = s.toCharArray();</span><br><span class="line">    <span class="keyword">if</span> (chars.length == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> length = <span class="number">1</span>;</span><br><span class="line">    String temp=<span class="keyword">new</span> String();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i <s.length()-<span class="number">1</s.length()-<span></span>; i++) {<br><span class="line">        <span class="keyword">if</span>(chars[i] != chars[i+<span class="number">1</span>]) {</span><br><span class="line">            temp=s.substring(i, i+<span class="number">2</span>);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">2</span>; j < s.length(); j++) {</span><br><span class="line">            <span class="keyword">if</span> (!temp.contains(chars[j]+<span class="string">""</span>)) {</span><br><span class="line">                temp = s.substring(i, j+<span class="number">1</span>);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//Breakå‡ºæ¥ååˆ¤æ–­æ˜¯å¦æ˜¯æœ€é•¿çš„k</span></span><br><span class="line">        length=temp.length()>length?temp.length():length;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> length;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æˆ‘è¿™ç§å®Œå…¨å°±æ˜¯åˆ©ç”¨apiæš´åŠ›æ³•ï¼Œå±…ç„¶è¿˜è·‘è¿‡äº†ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯O(N3)ï¼Œè¿™é¢˜çš„acç‡è¿˜æ˜¯æŒºä½çš„åªæœ‰ 29.3%</p><p><strong>è§£æ³•äºŒ</strong></p><p>ä¸‹é¢çš„æ˜¯æˆ‘ä¸‹åˆé‡æ–°åšçš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring4</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="comment">//è¾¹ç•Œé—®é¢˜æ°¸è¿œä¸èƒ½å¿½ç•¥</span></span><br><span class="line">    <span class="comment">//LinkedList<integer> list=new LinkedList<>();</integer></span></span><br><span class="line">    <span class="keyword">int</span> length=s.length();</span><br><span class="line">    <span class="keyword">if</span>(length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head=<span class="number">0</span>,tail=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<length;i++) {< span><br><span class="line">        <span class="keyword">int</span> index=i-<span class="number">1</span>; <span class="comment">//å½“å‰å…ƒç´ å‰ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">while</span>(index>=head){</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(i)!=s.charAt(index)){</span><br><span class="line">                index--;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="comment">//æŒ‰æ€è·¯åº”è¯¥æ˜¯æŠŠç›¸ç­‰å‰æ‰€æœ‰å…ƒç´ ç§»é™¤ï¼Œä½†æ˜¯é‚£æ ·æ•ˆç‡å¥½ä½ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å†³å®šç”¨æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—</span></span><br><span class="line">                head=index+<span class="number">1</span>;</span><br><span class="line">                tail++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//ä»å°¾éå†åˆ°å¤´ä»ç„¶æ²¡æœ‰ç›¸ç­‰ï¼Œå¯ä»¥æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">            <span class="keyword">if</span>(index==head-<span class="number">1</span>){</span><br><span class="line">                tail++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ¯æ¬¡ç»“æŸå¾ªç¯å å°¾index-å¤´index</span></span><br><span class="line">        max=tail-head+<span class="number">1</span> > max?tail-head+<span class="number">1</span>:max;</span><br><span class="line">        <span class="comment">//System.out.println(max);</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></length;i++)></span></pre></td></tr></tbody></table></figure></div><p>20mså·¦å³80%å·¦å³ï¼Œæ€è·¯ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œéå†å­—ç¬¦ä¸²ï¼Œç„¶åä»åå¾€å‰éå†å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å½“å‰å­—ç¬¦ä¸²åœ¨å‰é¢æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯å°±å°†å‰é¢ç›¸ç­‰é‚£ä¸ªå…ƒç´ (index)å‰çš„å…ƒç´ éƒ½ç§»é™¤ï¼ˆçª—å£å³ç§»ï¼‰</p><p>eg: <code>[head...index....tail] i</code>  å‘å³ç§»åŠ¨<code>....index [head ... i]</code></p><p>æŠŠå½“å‰å…ƒç´ æ·»åŠ è¿›æ¥ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N^2)ï¼Œæ¯”ä¸Šé¢å•çº¯çš„æš´åŠ›æ³•è¦å¿«å¤šäº†ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æœ€ä¼˜è§£</p><p><strong>è§£æ³•ä¸‰</strong></p><p>ä¸Šé¢çš„ç®—æ³•ï¼Œå…¶å®è¿˜å¯ä»¥ä¼˜åŒ–ï¼Œæ¯æ¬¡åˆ¤æ–­å‰é¢æœ‰æ²¡æœ‰é‡å¤å…ƒç´ çš„æ—¶å€™å¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªå¤§å°256çš„æ‰©å±•ASCIIç è¡¨æ•°ç»„æ¥åˆ¤æ–­ï¼ˆå‰ææ˜¯è¿™äº›å­—ç¬¦éƒ½åœ¨æ ‡å‡†çš„ASCIIå­—ç¬¦ä¸­ï¼‰ï¼Œ<code>freq[s.charAt(i)]</code> ä»£è¡¨çš„å°±æ˜¯s.charAt(i)è¿™ä¸ªå­—ç¬¦åœ¨çª—å£å†…å‡ºç°è¿‡æ²¡æœ‰ï¼Œå‡ºç°è¿‡å°±ä¸º1ï¼Œå¦åˆ™å°±æ˜¯0ï¼Œè¿™é‡Œå¦‚æœASCIIä¸å¤Ÿå…¶å®ä¹Ÿå¯ä»¥ç”¨HashMapï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¹Ÿå¾ˆé«˜æ¥è¿‘O(1)</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> length=s.length();</span><br><span class="line">    <span class="keyword">if</span>(length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>]; <span class="comment">//ASCIIç è¡¨</span></span><br><span class="line">    freq[s.charAt(<span class="number">0</span>)]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> head=<span class="number">0</span>,tail=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(head<length){< span><br><span class="line">        <span class="keyword">if</span>(tail+<span class="number">1</span><length&&freq[s.charat(tail+<span class="number">1</length&&freq[s.charat(tail+<span></span>)]==<span class="number">0</span>){</length){<></span><br><span class="line">            <span class="comment">//æ²¡æœ‰é‡å¤ï¼Œå³è¾¹ç•Œå³ç§»</span></span><br><span class="line">            tail++;</span><br><span class="line">            freq[s.charAt(tail)]++;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//é€æ¸ç¼©å‡å·¦è¾¹ç•Œï¼Œç›´åˆ°ä¸å†æœ‰é‡å¤å…ƒç´ </span></span><br><span class="line">            freq[s.charAt(head)]--;</span><br><span class="line">            head++;</span><br><span class="line">        }</span><br><span class="line">        max=max<tail-head+<span class="number">1</tail-head+<span></span>?tail-head+<span class="number">1</span>:max;<br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§åšæ³•æœ€åæƒ…å†µï¼ˆæ²¡æœ‰é‡å¤çš„å­—ç¬¦ï¼‰ä¸‹å…¶å®ä¼šéå†ä¸¤éæ•°ç»„tailå…ˆç§»åŠ¨åˆ°å°¾éƒ¨headéšåæœ‰ç§»åŠ¨åˆ°å°¾éƒ¨ï¼Œä½†æ˜¯æ¯”è¾ƒå¥½ç†è§£ï¼Œè§£æ³•å››å®é™…ä¸Šå°±æ˜¯å¯¹è¿™é‡Œçš„ä¼˜åŒ–ï¼Œheadæ¯æ¬¡ç§»åŠ¨éƒ½æ˜¯ç›´æ¥ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªé‡å¤å…ƒç´ çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å‘å³ç§»</p><p><strong>è§£æ³•å››</strong></p><p>æäº¤è®°å½•ä¸Šæœ€å¿«çš„æ–¹æ³•ï¼Œç†è§£èµ·æ¥æœ‰ç‚¹è´¹åŠ²ï¼Œç°åœ¨å›å¤´çœ‹åˆçœ‹ä¸æ‡‚äº†ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> n = s.length(), ans = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//ç´¢å¼•ä¸ºå…ƒç´ å€¼ï¼Œè¿™é‡Œå› ä¸ºå…ƒç´ éƒ½æ˜¯å­—ç¬¦è½¬è¿‡æ¥å°±æ˜¯askllç ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿™æ ·</span></span><br><span class="line">    <span class="keyword">int</span>[] index = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">128</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, i = <span class="number">0</span>; j < n; j++) {</span><br><span class="line">        <span class="comment">//å¦‚æœå­—ç¬¦ char åœ¨æ²¡æœ‰å‡ºç°è¿‡ï¼Œindex[char]ä¸º0ï¼Œå‡ºç°åˆ™index[char]æ˜¯éå†å‡ºç°çš„æœ€åçš„charçš„ä½ç½®</span></span><br><span class="line">        <span class="comment">// index[s.charAt(j)] æ˜¯å½“å‰å­—ç¬¦ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®(ä»1å¼€å§‹)</span></span><br><span class="line">        i = Math.max(i,index[s.charAt(j)]);</span><br><span class="line">        <span class="comment">//j - i + 1 å°±æ˜¯èˆå¼ƒs.charAt(j)é‡å¤å‡ºç°ä¹‹å‰å­—ç¬¦çš„é•¿åº¦  å¦‚abca,å½“s.charAt(j) == aæ—¶ï¼Œj - i + 1å°±æ˜¯bcaçš„é•¿åº¦</span></span><br><span class="line">        <span class="comment">//æ±‚æœ€å¤§å€¼å¸¸è§„æ“ä½œ</span></span><br><span class="line">        ans = Math.max(ans, j - i + <span class="number">1</span>);</span><br><span class="line">        index[s.charAt(j)] = j + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// ä»1å¼€å§‹</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæœ€ä¸»è¦å°±æ˜¯è¿™ä¸ª<strong>i</strong>çš„ç†è§£</p><p><img alt="mark" data-src="http://static.imlgw.top///20190503/Qcj2l3E0v5sN.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™ä¸ªiä¸ä¸€å®šæ˜¯å½“å‰å…ƒç´ ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç¦»<strong>å½“å‰</strong>å…ƒç´ ä»å³å‘å·¦<strong>æœ€è¿‘</strong>çš„<strong>é‡å¤å­—ç¬¦</strong>çš„_ä½ç½®_ã€‚è€Œindexä¸­å­˜çš„å°±æ˜¯è¿™ä¸ªå…ƒç´ çš„ç´¢å¼•ä½ç½®+1ï¼Œä¸ºä»€ä¹ˆè¦åŠ 1ï¼Ÿ</p><p><img alt="mark" data-src="http://static.imlgw.top///20190503/N4GzYaft0suh.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä¸»è¦æ˜¯å› ä¸ºiçš„é»˜è®¤å€¼æ˜¯0è€Œæ•°ç»„é»˜è®¤å€¼ä¹Ÿæ˜¯0ï¼Œå¦‚æœä»¥0å¼€å§‹å°±ä¼šå‡ºç°ä¸Šé¢çš„æƒ…å†µã€‚</p><p>å…¶å®è¿™ä¸¤ç§ç®—æ³•ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œåªæ˜¯åé¢åˆ¤æ–­å­—ç¬¦æ˜¯å¦å‡ºç°è¿‡çš„æ–¹å¼ä¸åŒï¼Œå‰è€…æ˜¯ç›´æ¥éå†è¿™ä¸ªå­ä¸²ï¼Œåè€…æ˜¯åˆ©ç”¨å­—ç¬¦ä¸ºç´¢å¼•ï¼Œå…¶å€¼å°±æ˜¯ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®(+1)ï¼Œå€Ÿæ­¤æ¥è®¡ç®—é•¿åº¦ã€‚</p><p><strong>å›é¦–æ</strong></p><p>19/9/14ï¼Œåœ¨ç½‘é¡µä¸Šåˆå†™äº†ä¸€ç§ä¸åŒçš„è§£æ³•ï¼Œå±äºè§£æ³•4çš„å˜ä½“ï¼ˆåšçš„æ—¶å€™å¹¶æ²¡æœ‰æƒ³åˆ°è§£æ³•4ï¼‰ï¼Œ<code>freq[]</code> æ•°ç»„ç´¢å¼•æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å€¼æ˜¯è¯¥å­—ç¬¦åœ¨sä¸­å¯¹åº”çš„ç´¢å¼•ï¼Œä¸ä¼šéå†ä¸¤éæ•°ç»„ï¼Œleftå¯ä»¥é€šè¿‡ç´¢å¼•ç›´æ¥è·³åˆ°ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring6</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="keyword">null</span>||s.length()<<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s.length()==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=<span class="number">0</span>,res=<span class="number">0</span>;</span><br><span class="line">    Arrays.fill(freq,-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(right<s.length()){< span><br><span class="line">        <span class="keyword">char</span> sr=s.charAt(right);</span><br><span class="line">        <span class="comment">//å·²ç»å­˜åœ¨,å¹¶ä¸”åœ¨çª—å£å†…</span></span><br><span class="line">        <span class="keyword">if</span>(freq[sr]!=-<span class="number">1</span> && freq[sr]>=left){</span><br><span class="line">            <span class="comment">//System.out.println(left+","+right+","+freq[sr]);</span></span><br><span class="line">            res=Math.max(res,right-left);</span><br><span class="line">            left=freq[sr]+<span class="number">1</span>;</span><br><span class="line">            freq[sr]=right;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            res=Math.max(res,right-left+<span class="number">1</span>);</span><br><span class="line">            freq[sr]=right;</span><br><span class="line">        }</span><br><span class="line">        right++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></s.length()){<></span></pre></td></tr></tbody></table></figure></div><p><strong>å›é¦–æ2</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring7</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="keyword">null</span>||s.length()<<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s.length()==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span>[] freq=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=<span class="number">0</span>,res=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//Arrays.fill(freq,-1);</span></span><br><span class="line">    <span class="keyword">while</span>(right<s.length()){< span><br><span class="line">        <span class="keyword">char</span> sr=s.charAt(right);</span><br><span class="line">        <span class="comment">//å·²ç»å­˜åœ¨(å‡ºç°è¿‡),å¹¶ä¸”ä¸Šä¸€æ¬¡å‡ºç°åœ¨çª—å£å†…</span></span><br><span class="line">        <span class="keyword">if</span>(freq[sr]!=<span class="number">0</span> && freq[sr]>=left){</span><br><span class="line">            <span class="comment">//è¿™é‡Œä¸åŒ…å«right,æ‰€ä»¥ä¸ç”¨åŠ 1</span></span><br><span class="line">            res=Math.max(res,right-left);</span><br><span class="line">            <span class="comment">//leftç§»åŠ¨åˆ°é‡å¤ä½ç½®å…ƒç´ çš„ä¸‹ä¸€ä¸ª</span></span><br><span class="line">            <span class="comment">//å› ä¸ºfreqçš„å€¼æ˜¯å­˜çš„ç´¢å¼•+1æ‰€ä»¥è¿™é‡Œä¸ç”¨+1</span></span><br><span class="line">            left=freq[sr];</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//è¿™é‡ŒåŒ…å«rightæ‰€ä»¥éœ€è¦åŠ 1</span></span><br><span class="line">            res=Math.max(res,right-left+<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//åŠ 1æ˜¯ä¸ºäº†åŒºåˆ«sçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">        freq[sr]=right+<span class="number">1</span>;</span><br><span class="line">        right++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></s.length()){<></span></pre></td></tr></tbody></table></figure></div><p>æ„Ÿè§‰å¯¹è¿™é¢˜æœ‰å¾ˆæ·±çš„æ‰§å¿µğŸ˜…ï¼Œå¯¹ä¸Šé¢å³ä¼˜åŒ–äº†ä¸€ä¸‹ï¼Œä½†æ˜¯å…¶å®è¿˜æ˜¯ä¸Šé¢çš„è§£æ³•ä¸‰æ¯”è¾ƒç®€å•ï¼Œè¯´åˆ°è§£æ³•ä¸‰ï¼Œæˆ‘åˆæŠ½é£æ”¹äº†ä¸€ä¸ªbooleanæ•°ç»„ç‰ˆæœ¬çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç”¨booleanæ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring8</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> length=s.length();</span><br><span class="line">    <span class="keyword">if</span>(length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//ASCIIç è¡¨</span></span><br><span class="line">    <span class="keyword">boolean</span>[] freq=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">256</span>]; </span><br><span class="line">    freq[s.charAt(<span class="number">0</span>)]=<span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">int</span> head=<span class="number">0</span>,tail=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> max=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(head<length){< span><br><span class="line">        <span class="keyword">if</span>(tail+<span class="number">1</span><length&&!freq[s.charat(tail+<span class="number">1</length&&!freq[s.charat(tail+<span></span>)]){</length){<></span><br><span class="line">            tail++;</span><br><span class="line">            freq[s.charAt(tail)]=<span class="keyword">true</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            freq[s.charAt(head)]=<span class="keyword">false</span>;</span><br><span class="line">            head++;</span><br><span class="line">        }</span><br><span class="line">        max=max<tail-head+<span class="number">1</tail-head+<span></span>?tail-head+<span class="number">1</span>:max;<br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="219-å­˜åœ¨é‡å¤å…ƒç´ -II"><a href="#219-å­˜åœ¨é‡å¤å…ƒç´ -II" class="headerlink" title="219. å­˜åœ¨é‡å¤å…ƒç´  II"></a><a href="https://leetcode-cn.com/problems/contains-duplicate-ii/" target="_blank" rel="noopener">219. å­˜åœ¨é‡å¤å…ƒç´  II</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° <em>k</em>ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• <em>i</em> å’Œ <em>j</em>ï¼Œä½¿å¾— <strong>nums [i] = nums [j]</strong>ï¼Œå¹¶ä¸” <em>i</em> å’Œ <em>j</em> çš„å·®çš„ç»å¯¹å€¼æœ€å¤§(ä¸è¶…è¿‡)ä¸º <em>k</em>ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>], k = <span class="number">3</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>], k = <span class="number">1</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], k = <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å»ºè®®åŒºçœ‹çœ‹åŸç‰ˆçš„è‹±æ–‡é¢˜ï¼Œè¿™é‡Œç¿»è¯‘è¿‡æ¥æœ‰ç‚¹è¯¯å¯¼äººï¼Œåº”è¯¥æ˜¯ä¸è¶…è¿‡kï¼Œå†™ä¸ªæœ€å¤§æå¾—æˆ‘æœ‰ç‚¹æ‡µ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">containsNearbyDuplicate2</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="comment">//if(k==35000) return false; å“ˆå“ˆå“ˆå“ˆ</span></span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">0</span>||k==<span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<len;i++) {< span><br><span class="line">        <span class="keyword">int</span> index=i-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i-index<=k){</span><br><span class="line">            <span class="comment">//kæ­¥ä¹‹å†…</span></span><br><span class="line">            <span class="keyword">if</span>(index<<span class="number">0</span>){</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span>(nums[i]==nums[index--]){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></len;i++)></span></pre></td></tr></tbody></table></figure></div><p>æš´åŠ›æ³•ï¼Œæƒ¨ä¸å¿ç¹ï¼Œ600msï¼Œ15%beats ã€‚è¿™é¢˜æœ€å¥½çš„åšæ³•è¿˜æ˜¯å€ŸåŠ©hashè¡¨</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">containsNearbyDuplicate3</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">0</span>||k==<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<len;i++) {< span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(nums[i])){</span><br><span class="line">            <span class="keyword">int</span> index=map.get(nums[i]);</span><br><span class="line">            <span class="keyword">if</span>(i-index<=k) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">//å¤§äºkäº†é‚£å‰é¢é‚£ä¸ªæ²¡ç”¨äº†</span></span><br><span class="line">                map.replace(nums[i],i);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            map.put(nums[i],i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></len;i++)></span></pre></td></tr></tbody></table></figure></div><p>12msï¼Œ90%ï¼Œå…¶å®æ•ˆç‡çš„å·®è·å°±åœ¨æŸ¥æ‰¾å­ä¸²é‡Œæœ‰æ²¡æœ‰è¿™ä¸ªå­—ç¬¦ä¸Šï¼ŒHashMapçš„containsKeyçš„æ•ˆç‡æ¯”æˆ‘ä»¬éå†çš„ä¸çŸ¥é“é«˜åˆ°é‚£é‡Œå»äº†ï¼Œåº•å±‚æºç æš‚æ—¶è¿˜çœ‹ä¸å¤ªæ‡‚ï¼Œä»¥åçœ‹çš„æ—¶å€™å†ä¸“é—¨æ¥è®²</p><p>19.9.14åˆåšäº†ä¸€éï¼Œç›´æ¥åœ¨ç½‘é¡µä¸Šå†™çš„ï¼Œæœ¬æ¥åº”è¯¥æ˜¯bugfreeçš„ï¼Œç»“æœå‡åäº†ã€‚ã€‚ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">containsNearbyDuplicate4</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">HashMap<integer,integer> hashMap=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line"><span class="keyword">int</span> left=<span class="number">0</span>,right=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(right<nums.length){< span><br><span class="line"><span class="keyword">if</span>(hashMap.containsKey(nums[right])){</span><br><span class="line"><span class="comment">//md,é‡æ–°åšçš„æ—¶å€™è¿™é‡Œå‡åäº†çœŸæ˜¯ä¸ªzz</span></span><br><span class="line"><span class="keyword">if</span>(right-hashMap.get(nums[right])<=k){</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">} <span class="keyword">else</span>{</span><br><span class="line">hashMap.put(nums[right],right);</span><br><span class="line">}</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">hashMap.put(nums[right],right);</span><br><span class="line">}</span><br><span class="line">right++;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></nums.length){<></span></pre></td></tr></tbody></table></figure></div><p>19.9.15åˆåšäº†ä¸€éï¼Œè¿™æ¬¡ä»£ç å†™çš„å¾ˆç®€æ´ï¼Œæ€è·¯ä¹Ÿä¸åŒäº†ï¼Œç›´æ¥åˆ©ç”¨seté›†åˆï¼Œç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„è¿ç»­set(çª—å£)</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsNearbyDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    HashSet<integer> set=<span class="keyword">new</span> HashSet<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!set.add(nums[i])) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (set.size()>k) {</span><br><span class="line">            set.remove(nums[i-k]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="209-é•¿åº¦æœ€å°çš„å­æ•°ç»„"><a href="#209-é•¿åº¦æœ€å°çš„å­æ•°ç»„" class="headerlink" title="209. é•¿åº¦æœ€å°çš„å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/minimum-size-subarray-sum/" target="_blank" rel="noopener">209. é•¿åº¦æœ€å°çš„å­æ•°ç»„</a></h2><p>ç»™å®šä¸€ä¸ªå«æœ‰ <strong>n</strong> ä¸ªæ­£æ•´æ•°çš„æ•°ç»„å’Œä¸€ä¸ªæ­£æ•´æ•° <strong>s ï¼Œ</strong>æ‰¾å‡ºè¯¥æ•°ç»„ä¸­æ»¡è¶³å…¶å’Œ <strong>â‰¥ s</strong> çš„é•¿åº¦æœ€å°çš„è¿ç»­å­æ•°ç»„<strong>ã€‚</strong>å¦‚æœä¸å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„è¿ç»­å­æ•°ç»„ï¼Œè¿”å› 0ã€‚</p><p><strong>ç¤ºä¾‹:</strong> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: s = <span class="number">7</span>, nums = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line">è§£é‡Š: å­æ•°ç»„ [<span class="number">4</span>,<span class="number">3</span>] æ˜¯è¯¥æ¡ä»¶ä¸‹çš„é•¿åº¦æœ€å°çš„è¿ç»­å­æ•°ç»„ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶:</strong></p><p>å¦‚æœä½ å·²ç»å®Œæˆäº†<em>O</em>(<em>n</em>) æ—¶é—´å¤æ‚åº¦çš„è§£æ³•, è¯·å°è¯• <em>O</em>(<em>n</em> log <em>n</em>) æ—¶é—´å¤æ‚åº¦çš„è§£æ³•ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>è€è§„çŸ©å…ˆä¸Šä¸ªæ…¢çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">minSubArrayLen</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> minLen=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<len;i++){< span><br><span class="line">        <span class="keyword">if</span>(nums[i-<span class="number">1</span>]>=s) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> index=i-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> sum=nums[i];</span><br><span class="line">        <span class="comment">//ç´¯åŠ å‰é¢çš„å…ƒç´ ï¼Œç›´åˆ°å¤§äºsæˆ–è€…index<0</span></span><br><span class="line">        <span class="keyword">while</span>(sum<s&&index>=<span class="number">0</span>){</s&&index></span><br><span class="line">            sum+=nums[index--];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(sum>=s){</span><br><span class="line">            minLen=minLen>i-index?i-index:minLen;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(i==len-<span class="number">1</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> minLen;</span><br><span class="line">}</span><br></len;i++){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªæ˜¯æœ€å¼€å§‹æƒ³åˆ°äº†æ€è·¯æ¯”è¾ƒæ¸…æ™°ï¼Œéå†æ•°ç»„ç„¶åé€†åºæ±‚å’Œç›´åˆ°å¤§äºSï¼Œè¦æ³¨æ„è¾¹ç•Œï¼Œæ¯”è¾ƒæ…¢ï¼Œä¸»è¦å°±æ˜¯é‚£ä¸ªå¾ªç¯ç´¯åŠ å‰é¢çš„å…ƒç´ ä¼šå¾ˆè€—è´¹æ—¶é—´ï¼Œ111msï¼Œ14% beatsğŸ¤£</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">minSubArrayLen2</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len =nums.length;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//çª—å£å·¦å³è¾¹ç•Œ</span></span><br><span class="line">    <span class="keyword">int</span> head=<span class="number">0</span>,tail=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> minLen=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 2,3,1,2,4,3 | 7</span></span><br><span class="line">    <span class="keyword">while</span> (tail<len) {< span><br><span class="line">        <span class="keyword">if</span>(sum>=s){</span><br><span class="line">            minLen=minLen>tail-head+<span class="number">1</span>?tail-head+<span class="number">1</span>:minLen;</span><br><span class="line">            <span class="comment">//System.out.println(minLen);</span></span><br><span class="line">            <span class="comment">//åˆ é™¤å¤´èŠ‚ç‚¹ï¼ˆå·¦è¾¹ç•Œå·¦ç§»ï¼‰</span></span><br><span class="line">            sum-=nums[head++];</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//å°¾æŒ‡é’ˆåˆ°è¾¾è¾¹ç•Œäº†</span></span><br><span class="line">            <span class="keyword">if</span>(tail==len-<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//å°¾èŠ‚ç‚¹++ï¼Œ(å³è¾¹ç•Œå³ç§»)</span></span><br><span class="line">            sum+=nums[++tail];</span><br><span class="line">            <span class="comment">//å¦‚æœæœ‰å…ƒç´ å¤§äºsç›´æ¥è¿”å›ï¼ŒèŠ‚çº¦æ—¶é—´</span></span><br><span class="line">            <span class="keyword">if</span>(nums[tail]>=s){</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> minLen==Integer.MAX_VALUE?<span class="number">0</span>:minLen;</span><br><span class="line">}</span><br></len)></span></pre></td></tr></tbody></table></figure></div><p>2ms ï¼Œ99%beatsï¼Œä¸€å¯¹æ¯”å·®è·å°±å‡ºæ¥äº†ï¼Œä¸Šé¢è¿™ç§åšæ³•å°±æ˜¯åˆ©ç”¨äº†æ»‘åŠ¨çª—å£çš„æ€æƒ³ï¼Œå¾ˆå·§å¦™çš„åˆ©ç”¨äº†ä¸Šä¸€æ¬¡è®¡ç®—çš„å€¼ï¼Œä¸ç”¨é‡å¤çš„è®¡ç®—ç´¯åŠ å’Œï¼Œä¸Šé¢çš„é‚£ç§æ–¹æ³•æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®—ç´¯åŠ å’Œï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ˜¯é‡å¤çš„è®¡ç®—ï¼Œæ‰€ä»¥æµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼Œè¦æ³¨æ„è¾¹ç•Œæ¡ä»¶</p><p><code>2 3 1 2 4 3  s=7</code></p><p><img alt="mark" data-src="http://static.imlgw.top///20190504/U9BTOJMRVhDO.jpg?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è‡ªå·±åœ¨çº¸ä¸Šç”»ä¸€ä¸‹å°±æ‡‚äº†</p><p><strong>è§£æ³•ä¸‰</strong></p><p>æ‰¾åˆ°ä¸€ä¸ªæ¿å­ï¼Œç»Ÿä¸€ä¸€ä¸‹å†™æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">minSubArrayLen3</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len =nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> head=<span class="number">0</span>,tail=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> minLen=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 2,3,1,2,4,3 | 7</span></span><br><span class="line">    <span class="keyword">while</span> (head<=len) {</span><br><span class="line">        <span class="keyword">if</span>(tail+<span class="number">1</span><=len && sum<s){< span><br><span class="line">            sum+=nums[++tail];</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            sum-=nums[head++];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(sum>=s){</span><br><span class="line">            minLen=minLen>tail-head+<span class="number">1</span>?tail-head+<span class="number">1</span>:minLen;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> minLen==Integer.MAX_VALUE?<span class="number">0</span>:minLen;</span><br><span class="line">}</span><br></s){<></span></pre></td></tr></tbody></table></figure></div><h2 id="480-æ»‘åŠ¨çª—å£ä¸­ä½æ•°"><a href="#480-æ»‘åŠ¨çª—å£ä¸­ä½æ•°" class="headerlink" title="480. æ»‘åŠ¨çª—å£ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/sliding-window-median/" target="_blank" rel="noopener">480. æ»‘åŠ¨çª—å£ä¸­ä½æ•°</a></h2><p>ä¸­ä½æ•°æ˜¯æœ‰åºåºåˆ—æœ€ä¸­é—´çš„é‚£ä¸ªæ•°ã€‚å¦‚æœåºåˆ—çš„å¤§å°æ˜¯å¶æ•°ï¼Œåˆ™æ²¡æœ‰æœ€ä¸­é—´çš„æ•°ï¼›æ­¤æ—¶ä¸­ä½æ•°æ˜¯æœ€ä¸­é—´çš„ä¸¤ä¸ªæ•°çš„å¹³å‡æ•°ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]ï¼Œä¸­ä½æ•°æ˜¯ <span class="number">3</span></span><br><span class="line">[<span class="number">2</span>,<span class="number">3</span>]ï¼Œä¸­ä½æ•°æ˜¯ (<span class="number">2</span> + <span class="number">3</span>) / <span class="number">2</span> = <span class="number">2.5</span></span><br></pre></td></tr></tbody></table></figure></div><p>ç»™å‡ºä¸€ä¸ªæ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º <em>k</em> çš„çª—å£ä»æœ€å·¦ç«¯æ»‘åŠ¨åˆ°æœ€å³ç«¯ã€‚çª—å£ä¸­æœ‰ k ä¸ªæ•°ï¼Œæ¯æ¬¡çª—å£ç§»åŠ¨ 1 ä½ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ‰¾å‡ºæ¯æ¬¡çª—å£ç§»åŠ¨åå¾—åˆ°çš„æ–°çª—å£ä¸­å…ƒç´ çš„ä¸­ä½æ•°ï¼Œå¹¶è¾“å‡ºç”±å®ƒä»¬ç»„æˆçš„æ•°ç»„ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>ç»™å‡º <em>nums</em> = <code>[1,3,-1,-3,5,3,6,7]</code>ï¼Œä»¥åŠ <em>k</em> = 3ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">çª—å£ä½ç½®                      ä¸­ä½æ•°</span><br><span class="line">---------------               -----</span><br><span class="line">[<span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span>] -<span class="number">3</span>  <span class="number">5</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>       <span class="number">1</span></span><br><span class="line"> <span class="number">1</span> [<span class="number">3</span>  -<span class="number">1</span>  -<span class="number">3</span>] <span class="number">5</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>       -<span class="number">1</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span> [-<span class="number">1</span>  -<span class="number">3</span>  <span class="number">5</span>] <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>       -<span class="number">1</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span> [-<span class="number">3</span>  <span class="number">5</span>  <span class="number">3</span>] <span class="number">6</span>  <span class="number">7</span>       <span class="number">3</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span>  -<span class="number">3</span> [<span class="number">5</span>  <span class="number">3</span>  <span class="number">6</span>] <span class="number">7</span>       <span class="number">5</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">3</span>  -<span class="number">1</span>  -<span class="number">3</span>  <span class="number">5</span> [<span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span>]      <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p> å› æ­¤ï¼Œè¿”å›è¯¥æ»‘åŠ¨çª—å£çš„ä¸­ä½æ•°æ•°ç»„ <code>[1,-1,-1,3,5,6]</code>ã€‚</p><p><strong>æç¤ºï¼š</strong><br>å‡è®¾<code>k</code>æ˜¯åˆæ³•çš„ï¼Œå³ï¼š<code>k</code> å§‹ç»ˆå°äºè¾“å…¥çš„éç©ºæ•°ç»„çš„å…ƒç´ ä¸ªæ•°.</p><p>headé¢˜ï¼Œç†æ¸…æ¥šæ€è·¯åä¹Ÿä¸éš¾ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span>[] medianSlidingWindow(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) {</span><br><span class="line">    <span class="comment">//çœ‹äº†ä¸€åœˆè¯„è®ºåŒºï¼Œå¤§æ¦‚çŸ¥é“æ€è·¯äº†ï¼Œè¿˜æ˜¯è¦æ’åº</span></span><br><span class="line">    <span class="comment">//List<integer> list=new ArrayList<>(); ç”¨é“¾è¡¨è¿˜æ˜¯ä¸æ–¹ä¾¿å•Š</integer></span></span><br><span class="line">    <span class="keyword">int</span> [] queue=<span class="keyword">new</span> <span class="keyword">int</span>[k];</span><br><span class="line">    <span class="keyword">int</span> head=<span class="number">0</span>,tail=k-<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//å¤´å°¾</span></span><br><span class="line">    <span class="keyword">double</span> [] res=<span class="keyword">new</span> <span class="keyword">double</span>[nums.length-k+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<k;i++) {< span><br><span class="line">        queue[i]=nums[i];</span><br><span class="line">    }</span><br><span class="line">    Arrays.sort(queue);</span><br><span class="line">    printArray(queue);</span><br><span class="line">    <span class="keyword">if</span> (k%<span class="number">2</span>==<span class="number">0</span>) {</span><br><span class="line">        res[<span class="number">0</span>]=queue[(k-<span class="number">1</span>)/<span class="number">2</span>]/<span class="number">2.0</span>+queue[(k-<span class="number">1</span>)/<span class="number">2</span>+<span class="number">1</span>]/<span class="number">2.0</span>;</span><br><span class="line">        <span class="comment">//æ³¨æ„é™¤å°æ•° .ã€‚ã€‚ã€‚ã€‚è¿™é‡Œçš„æµ‹è¯•ç”¨ä¾‹Integeræœ€å¤§å€¼ï¼Œç›´æ¥ç›¸åŠ /2ä¼šè¶Šç•Œ</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res[<span class="number">0</span>]=queue[k/<span class="number">2</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=k;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//æ’å…¥ä¹‹å‰è¦ç§»é™¤ä¸Šä¸€æ¬¡çš„å¤´å…ƒç´ ï¼Œè¿™é‡Œç”¨æ•°ç»„ä¸å¥½æå•Šå•Š</span></span><br><span class="line">        <span class="comment">//System.out.println(nums[i-k]);</span></span><br><span class="line">        deleHead(queue,nums[i-k]);</span><br><span class="line">        tail--;</span><br><span class="line">        <span class="comment">//printArray(queue);</span></span><br><span class="line">        <span class="comment">//äºŒåˆ†æ‰¾æ’å…¥ç‚¹</span></span><br><span class="line">        <span class="keyword">int</span> index=binarySearch(queue,<span class="number">0</span>,tail,nums[i]);</span><br><span class="line">        System.out.println(index);</span><br><span class="line">        tail++;</span><br><span class="line">        <span class="comment">//æ’å…¥å…ƒç´ ï¼Œtail++;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=tail;j>index;j--) {</span><br><span class="line">            <span class="comment">//åä¸€ä¸ªç­‰äºå‰ä¸€ä¸ªï¼Œç»™æ’å…¥çš„å…ƒç´ è…¾å‡ºä½ç½®</span></span><br><span class="line">            queue[j]=queue[j-<span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line">        queue[index]=nums[i];</span><br><span class="line">        <span class="comment">//æ±‚ä¸­ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (k%<span class="number">2</span>==<span class="number">0</span>) {</span><br><span class="line">            res[i-k+<span class="number">1</span>]=queue[head+(tail-head)/<span class="number">2</span>]/<span class="number">2.0</span>+queue[head+(tail-head)/<span class="number">2</span>+<span class="number">1</span>]/<span class="number">2.0</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            res[i-k+<span class="number">1</span>]=queue[head+(tail-head)/<span class="number">2</span>];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleHead</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> target)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>,i=<span class="number">0</span>;j<nums.length;j++,i++) {< span><br><span class="line">        <span class="keyword">if</span>(nums[j]==target){</span><br><span class="line">            <span class="keyword">if</span> (i==nums.length-<span class="number">1</span>) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">while</span>(i<nums.length-<span class="number">1</nums.length-<span></span>){</nums.length;j++,i++)></span><br><span class="line">                nums[i]=nums[i+<span class="number">1</span>];</span><br><span class="line">                i++;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi,<span class="keyword">int</span> target)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid]<target){< span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]>target){</span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> lo;</span><br><span class="line">}</span><br></target){<></span></nums.length;i++)></span></k;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ ¹æ®è¯„è®ºåŒºæä¾›çš„æ€è·¯ï¼Œç”¨æ•°ç»„å®ç°äº†ä¸€éï¼Œå½“æ—¶å°±æ„Ÿè§‰æœ‰é—®é¢˜ï¼Œç¡®å®ï¼Œæœ€å 164ms ï¼Œ27%ï¼Œå¾ˆæ…¢äº†ï¼Œæˆ‘è§‰å¾—ä¸»è¦é—®é¢˜å°±æ˜¯é‚£ä¸ªåˆ é™¤å¤´çš„æ“ä½œï¼Œä½†æ˜¯æ¯•ç«Ÿæ•°ç»„ï¼Œæ²¡åŠæ³•ï¼Œéšå³æ”¹ç”¨é“¾è¡¨</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span>[] medianSlidingWindow2(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) {</span><br><span class="line">    <span class="comment">//çœ‹äº†ä¸€åœˆè¯„è®ºåŒºï¼Œå¤§æ¦‚çŸ¥é“æ€è·¯äº†ï¼Œè¿˜æ˜¯è¦æ’åº</span></span><br><span class="line">    List<integer> list=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">int</span> head=<span class="number">0</span>,tail=k-<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//å¤´å°¾</span></span><br><span class="line">    <span class="keyword">double</span> [] res=<span class="keyword">new</span> <span class="keyword">double</span>[nums.length-k+<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//Arrays.sort(nums,0,k);</span></span><br><span class="line">    <span class="keyword">int</span> []temp=<span class="keyword">new</span> <span class="keyword">int</span>[k];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<k;i++) {< span><br><span class="line">        temp[i]=nums[i];</span><br><span class="line">    }</span><br><span class="line">    Arrays.sort(temp);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<k;i++) {< span><br><span class="line">        list.add(temp[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (k%<span class="number">2</span>==<span class="number">0</span>) {</span><br><span class="line">        res[<span class="number">0</span>]=list.get((k-<span class="number">1</span>)/<span class="number">2</span>)/<span class="number">2.0</span>+list.get((k-<span class="number">1</span>)/<span class="number">2</span>+<span class="number">1</span>)/<span class="number">2.0</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        res[<span class="number">0</span>]=list.get(k/<span class="number">2</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=k;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//æ’å…¥ä¹‹å‰è¦ç§»é™¤ä¸Šä¸€æ¬¡çš„å¤´å…ƒç´ ï¼Œè¿™é‡Œç”¨æ•°ç»„ä¸å¥½æå•Šå•Š</span></span><br><span class="line">        <span class="comment">//list.remove((Object)nums[i-k]); ç›´æ¥åˆ å¤ªæ…¢äº†</span></span><br><span class="line">        <span class="keyword">int</span> dele=binarySearch(list,<span class="number">0</span>,k-<span class="number">1</span>,nums[i-k]);</span><br><span class="line">        list.remove(dele);</span><br><span class="line">        <span class="comment">//System.out.println(list);</span></span><br><span class="line">        <span class="comment">//äºŒåˆ†æ‰¾æ’å…¥ç‚¹ï¼Œæ‰¾çš„åŒºé—´ä¸º [i-k+1, i-1]</span></span><br><span class="line">        <span class="comment">//int head=i-k+1,tail=i-1;</span></span><br><span class="line">        <span class="keyword">int</span> index=binarySearch(list,<span class="number">0</span>,k-<span class="number">2</span>,nums[i]);</span><br><span class="line">        System.out.println(index);</span><br><span class="line">        list.add(-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=k-<span class="number">1</span>;j>index;j--) {</span><br><span class="line">            <span class="comment">//åä¸€ä¸ªç­‰äºå‰ä¸€ä¸ªï¼Œç»™æ’å…¥çš„å…ƒç´ è…¾å‡ºä½ç½®</span></span><br><span class="line">            list.set(j,list.get(j-<span class="number">1</span>));</span><br><span class="line">        }</span><br><span class="line">        list.set(index,nums[i]);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        <span class="comment">//æ±‚ä¸­ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (k%<span class="number">2</span>==<span class="number">0</span>) {</span><br><span class="line">            res[i-k+<span class="number">1</span>]=list.get((k-<span class="number">1</span>)/<span class="number">2</span>) / <span class="number">2.0</span> + list.get((k-<span class="number">1</span>)/<span class="number">2</span>+<span class="number">1</span>)/<span class="number">2.0</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            res[i-k+<span class="number">1</span>]=list.get(k/<span class="number">2</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(List<integer> list,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi,<span class="keyword">int</span> target)</integer></span></span>{</span><br><span class="line">    <span class="keyword">while</span>(lo<=hi){</span><br><span class="line">        <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(list.get(mid)<target){< span><br><span class="line">            lo=mid+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(list.get(mid)>target){</span><br><span class="line">            hi=mid-<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> lo;</span><br><span class="line">}</span><br></target){<></span></nums.length;i++)></span></k;i++)></span></k;i++)></span></pre></td></tr></tbody></table></figure></div><p>47msï¼Œ70%å·¦å³ï¼Œåˆ é™¤çš„æ—¶å€™åˆ©ç”¨äºŒåˆ†åˆ é™¤ï¼Œå¦‚æœç›´æ¥æ ¹æ®å…ƒç´ å»åˆ å°±è·Ÿæ•°ç»„æ•ˆç‡å·®ä¸å¤šäº†ã€‚</p><h2 id="76-æœ€å°è¦†ç›–å­ä¸²"><a href="#76-æœ€å°è¦†ç›–å­ä¸²" class="headerlink" title="76. æœ€å°è¦†ç›–å­ä¸²"></a><a href="https://leetcode-cn.com/problems/minimum-window-substring/" target="_blank" rel="noopener">76. æœ€å°è¦†ç›–å­ä¸²</a></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² Sã€ä¸€ä¸ªå­—ç¬¦ä¸² Tï¼Œè¯·åœ¨å­—ç¬¦ä¸² S é‡Œé¢æ‰¾å‡ºï¼šåŒ…å« T æ‰€æœ‰å­—æ¯çš„æœ€å°å­ä¸²ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: S = <span class="string">"ADOBECODEBANC"</span>, T = <span class="string">"ABC"</span></span><br><span class="line">è¾“å‡º: <span class="string">"BANC"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>å¦‚æœ S ä¸­ä¸å­˜è¿™æ ·çš„å­ä¸²ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² â€œâ€ã€‚</li><li>å¦‚æœ S ä¸­å­˜åœ¨è¿™æ ·çš„å­ä¸²ï¼Œæˆ‘ä»¬ä¿è¯å®ƒæ˜¯å”¯ä¸€çš„ç­”æ¡ˆã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">minWindow</span><span class="params">(String s, String t)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> slen=s.length();</span><br><span class="line">    <span class="keyword">int</span> tlen=t.length();</span><br><span class="line">    <span class="keyword">int</span> l=<span class="number">0</span>,r=<span class="number">0</span>; <span class="comment">//åˆå§‹éƒ½ä¸º0</span></span><br><span class="line">    <span class="keyword">int</span>[] target=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>]; <span class="comment">//A:1 B:1 C:1</span></span><br><span class="line">    <span class="keyword">int</span>[] window=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>; <span class="comment">//ä¸åŒå­—ç¬¦çš„æ•°é‡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<tlen;i++) {< span><br><span class="line">        target[t.charAt(i)]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> a:target) {</span><br><span class="line">        <span class="keyword">if</span> (a!=<span class="number">0</span>) {</span><br><span class="line">            count++; <span class="comment">//ç»Ÿè®¡ä¸åŒå­—ç¬¦å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> match=<span class="number">0</span>; <span class="comment">//matchä»£è¡¨å·²ç»åŒ¹é…çš„å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">int</span>[] res=<span class="keyword">new</span> <span class="keyword">int</span>[]{<span class="number">0</span>,Integer.MAX_VALUE};</span><br><span class="line">    <span class="keyword">while</span>(r<slen){< span><br><span class="line">        <span class="keyword">char</span> c=s.charAt(r); </span><br><span class="line">        <span class="keyword">if</span>(target[c]!=<span class="number">0</span>){ <span class="comment">//åœ¨ç›®æ ‡å­ä¸²ä¸­å­˜åœ¨</span></span><br><span class="line">            window[c]++; <span class="comment">//windowå¯¹åº”çš„char++</span></span><br><span class="line">            <span class="keyword">if</span>(window[c]==target[c]){ <span class="comment">//åˆ°è¾¾äº†ç›®æ ‡ä¸²ä¸­è¯¥charæ‰€éœ€çš„æ•°é‡</span></span><br><span class="line">                match++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        r++;</span><br><span class="line">        <span class="keyword">while</span>(l<r&&count==match) { <span class="comment">//æ»¡è¶³ç›®æ ‡ä¸²ï¼Œæ³¨æ„åˆ«è¶Šç•Œ</r&&count==match)></span></slen){<></span><br><span class="line">            <span class="keyword">char</span> d=s.charAt(l);</span><br><span class="line">            <span class="keyword">if</span> (r-l<res[<span class="number">1</res[<span></span>]-res[<span class="number">0</span>]) { <span class="comment">//ç»Ÿè®¡æœ€å°å€¼</span></tlen;i++)></span><br><span class="line">                res[<span class="number">0</span>]=l;</span><br><span class="line">                res[<span class="number">1</span>]=r;</span><br><span class="line">            }</span><br><span class="line">            l++;</span><br><span class="line">            <span class="keyword">if</span> (target[d]!=<span class="number">0</span>) {</span><br><span class="line">                window[d]--;</span><br><span class="line">                <span class="keyword">if</span> (window[d]<target[d]) {<span class="comment">//å·¦è¾¹ç•Œå·¦ç§»åä¸å†æ»¡è¶³ç›®æ ‡ä¸²</target[d])></span><br><span class="line">                    match--;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res[<span class="number">1</span>]==Integer.MAX_VALUE?<span class="string">""</span>:s.substring(res[<span class="number">0</span>],res[<span class="number">1</span>]);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>10ms 86%ï¼ŒHardé¢˜ï¼Œå…¶å®å¤§è‡´çš„æ€è·¯è¿˜æ˜¯æœ‰çš„ï¼Œä¸»è¦æ˜¯ä¸çŸ¥é“æ€ä¹ˆå»å’Œç›®æ ‡ä¸²å¯¹æ¯”ï¼Œæ²¡æƒ³åˆ°ç”¨ä¸€ä¸ª<code>window</code>æ•°ç»„å»å¯¹æ¯”ï¼Œä¸€è‡´æƒ³çš„æ˜¯åœ¨ç›®æ ‡ä¸²çš„æ•°ç»„ä¸Šåšæ‰‹è„šï¼Œä½†æ˜¯è¶Šæƒ³è¶Šå¤æ‚ã€‚ã€‚ã€‚å¤ªè ¢äº†ğŸ˜…ï¼Œè¿™é¢˜å…¶å®ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªHashMapæ¥åšï¼Œä½†æ˜¯æˆ‘çœ‹äº†ä¸‹æäº¤è®°å½•ä¸Šçš„æ™®ééƒ½æ˜¯7,80msï¼Œç›¸å¯¹éƒ½æ¯”è¾ƒæ…¢ï¼Œå®é™…ä¸Šé¢˜ç›®æ²¡æœ‰æ˜ç¡®çš„è¯´æ˜æœ‰ç‰¹æ®Šå­—ç¬¦çš„è¯éƒ½æ˜¯å¯ä»¥ç”¨ä¸€ä¸ª<strong>ASCII</strong>æ•°ç»„æ¥å……å½“HashMapçš„ï¼Œå½“ç„¶æˆ‘è¿™é‡Œç”¨æ•°ç»„çš„æ—¶å€™ç›¸æ¯”HashMapè¦å¤šäº†ä¸€æ­¥ï¼Œéœ€è¦ç»Ÿè®¡ä¸åŒå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œä¸è¿‡è¿™ä¸ªæ“ä½œä¹Ÿæ˜¯å¸¸æ•°çº§åˆ«çš„æ“ä½œï¼Œå¹¶ä¸è€—æ—¶ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦O(N+M)ï¼ŒNMåˆ†åˆ«ä»£è¡¨ç›®æ ‡å­ä¸²<code>t</code> å’Œæºå­—ç¬¦ä¸² <code>p</code>çš„é•¿åº¦ï¼Œé¦–å…ˆéå†äº†<code>t</code> ç„¶åæ»‘åŠ¨çª—å£ï¼Œåé¢çš„æ»‘åŠ¨çª—å£å·¦å³è¾¹ç•Œæœ€å¤šç§»åŠ¨2Mæ¬¡</p><h2 id="438-æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯"><a href="#438-æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯" class="headerlink" title="438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯"></a><a href="https://leetcode-cn.com/problems/find-all-anagrams-in-a-string/" target="_blank" rel="noopener">438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² <strong>s</strong> å’Œä¸€ä¸ªéç©ºå­—ç¬¦ä¸² <strong>p</strong>ï¼Œæ‰¾åˆ° <strong>s</strong> ä¸­æ‰€æœ‰æ˜¯ <strong>p</strong> çš„å­—æ¯å¼‚ä½è¯çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚</p><p>å­—ç¬¦ä¸²åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”å­—ç¬¦ä¸² <strong>s</strong> å’Œ <strong>p</strong> çš„é•¿åº¦éƒ½ä¸è¶…è¿‡ 20100ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚</li><li>ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚</li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s: <span class="string">"cbaebabacd"</span> p: <span class="string">"abc"</span></span><br><span class="line">è¾“å‡º:</span><br><span class="line">[<span class="number">0</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">èµ·å§‹ç´¢å¼•ç­‰äº <span class="number">0</span> çš„å­ä¸²æ˜¯ <span class="string">"cba"</span>, å®ƒæ˜¯ <span class="string">"abc"</span> çš„å­—æ¯å¼‚ä½è¯ã€‚</span><br><span class="line">èµ·å§‹ç´¢å¼•ç­‰äº <span class="number">6</span> çš„å­ä¸²æ˜¯ <span class="string">"bac"</span>, å®ƒæ˜¯ <span class="string">"abc"</span> çš„å­—æ¯å¼‚ä½è¯ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p> <strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s: <span class="string">"abab"</span> p: <span class="string">"ab"</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º:</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">èµ·å§‹ç´¢å¼•ç­‰äº <span class="number">0</span> çš„å­ä¸²æ˜¯ <span class="string">"ab"</span>, å®ƒæ˜¯ <span class="string">"ab"</span> çš„å­—æ¯å¼‚ä½è¯ã€‚</span><br><span class="line">èµ·å§‹ç´¢å¼•ç­‰äº <span class="number">1</span> çš„å­ä¸²æ˜¯ <span class="string">"ba"</span>, å®ƒæ˜¯ <span class="string">"ab"</span> çš„å­—æ¯å¼‚ä½è¯ã€‚</span><br><span class="line">èµ·å§‹ç´¢å¼•ç­‰äº <span class="number">2</span> çš„å­ä¸²æ˜¯ <span class="string">"ab"</span>, å®ƒæ˜¯ <span class="string">"ab"</span> çš„å­—æ¯å¼‚ä½è¯ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å’Œä¸Šé¢ä¸€é¢˜å…¶å®ä¸€æ ·ï¼Œåªæ˜¯è¿™é‡Œè¦æ±‚æ˜¯è¿ç»­çš„ï¼Œåœ¨ä¸Šé¢ä¸€é¢˜çš„åŸºç¡€ä¸Šåœ¨æ·»åŠ ç»“æœçš„æ—¶å€™åˆ¤æ–­ä¸‹é•¿åº¦å°±OK</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">findAnagrams</span><span class="params">(String s, String p)</span> </integer></span>{</span><br><span class="line">    <span class="keyword">int</span>[] target=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span>[] window=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span> l=<span class="number">0</span>,r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> plen=p.length();</span><br><span class="line">    <span class="keyword">int</span> slen=s.length();</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>,match=<span class="number">0</span>;</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArraysList<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<plen;i++) {< span><br><span class="line">        target[p.charAt(i)]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> a:target) {</span><br><span class="line">        <span class="keyword">if</span>(a!=<span class="number">0</span>){</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(r<slen){< span><br><span class="line">        <span class="keyword">char</span> right=s.charAt(r);</span><br><span class="line">        <span class="keyword">if</span> (target[right]!=<span class="number">0</span>) {</span><br><span class="line">            window[right]++;</span><br><span class="line">            <span class="keyword">if</span> (window[right]==target[right]) {</span><br><span class="line">                match++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        r++;</span><br><span class="line">        <span class="keyword">while</span>(l<r && count="=match){</span"><br><span class="line">            <span class="keyword">char</span> left=s.charAt(l);</span><br><span class="line">            <span class="keyword">if</span> (r-l==res) {</span><br><span class="line">                res.add(l);</span><br><span class="line">            }</span><br><span class="line">            l++;</span><br><span class="line">            <span class="keyword">if</span> (target[left]!=<span class="number">0</span>) {</span><br><span class="line">                window[left]--;</span><br><span class="line">                <span class="comment">//ä¸æ»¡è¶³äº†</span></span><br><span class="line">                <span class="keyword">if</span> (window[left]<target[left]) {< span><br><span class="line">                    match--;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></target[left])></span></r></span></slen){<></span></plen;i++)></span></pre></td></tr></tbody></table></figure></div><p>15msï¼Œ86%æ—¶é—´å¤æ‚åº¦<code>O(M+N)</code>ï¼Œä½†æ˜¯è¿™å¾ˆæ˜æ˜¾å¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œå› ä¸ºè¿™é¢˜çš„çª—å£é•¿åº¦å…¶å®æ˜¯å¯ä»¥å›ºå®šçš„ï¼Œæ»‘åŠ¨çš„å¯ä»¥æ›´å¿«ï¼Œåªç”¨éå†ä¸€éï¼Œç­‰ä»¥åæœ‰æ—¶é—´å†ç ”ç©¶å§</p><h2 id="424-æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦"><a href="#424-æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦" class="headerlink" title="424. æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦"></a><a href="https://leetcode-cn.com/problems/longest-repeating-character-replacement/" target="_blank" rel="noopener">424. æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦</a></h2><p>ç»™ä½ ä¸€ä¸ªä»…ç”±å¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥å°†ä»»æ„ä½ç½®ä¸Šçš„å­—ç¬¦æ›¿æ¢æˆå¦å¤–çš„å­—ç¬¦ï¼Œæ€»å…±å¯æœ€å¤šæ›¿æ¢ k æ¬¡ã€‚åœ¨æ‰§è¡Œä¸Šè¿°æ“ä½œåï¼Œæ‰¾åˆ°åŒ…å«é‡å¤å­—æ¯çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚</p><p><strong>æ³¨æ„:</strong><br>å­—ç¬¦ä¸²é•¿åº¦ å’Œ k ä¸ä¼šè¶…è¿‡ 104ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s = <span class="string">"ABAB"</span>, k = <span class="number">2</span></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="number">4</span></span><br><span class="line">è§£é‡Š:</span><br><span class="line">ç”¨ä¸¤ä¸ª<span class="string">'A'</span>æ›¿æ¢ä¸ºä¸¤ä¸ª<span class="string">'B'</span>,åä¹‹äº¦ç„¶ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">s = <span class="string">"AABABBA"</span>, k = <span class="number">1</span></span><br><span class="line">è¾“å‡º:</span><br><span class="line"><span class="number">4</span></span><br><span class="line">è§£é‡Š:</span><br><span class="line">å°†ä¸­é—´çš„ä¸€ä¸ª<span class="string">'A'</span>æ›¿æ¢ä¸º<span class="string">'B'</span>,å­—ç¬¦ä¸²å˜ä¸º <span class="string">"AABBBBA"</span></span><br><span class="line">å­ä¸² <span class="string">"BBBB"</span> æœ‰æœ€é•¿é‡å¤å­—æ¯, ç­”æ¡ˆä¸º <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">characterReplacement</span><span class="params">(String s, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> max = <span class="number">0</span>, start = <span class="number">0</span>, end = <span class="number">0</span>, cur = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span>[] count = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">while</span> (end < s.length()) {</span><br><span class="line">        <span class="comment">//å½“å‰çª—å£å‡ºç°æœ€å¤šçš„å­—ç¬¦</span></span><br><span class="line">        cur = Math.max(cur, ++count[s.charAt(end)]);</span><br><span class="line">        <span class="comment">//ä¸èƒ½æ›¿æ¢äº†,ä¸åŒå­—ç¬¦å¤ªå¤šäº†,éœ€è¦ç¼©å‡çª—å£</span></span><br><span class="line">        <span class="keyword">while</span> (end - start + <span class="number">1</span> - cur > k){</span><br><span class="line">            <span class="comment">//ç¼©å‡å·¦è¾¹ç•Œçš„count</span></span><br><span class="line">            count[s.charAt(start)]--;</span><br><span class="line">            start++;<span class="comment">//ä¸èƒ½æ›¿æ¢äº†ï¼Œstart++</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ç»Ÿè®¡æœ€å¤§å€¼</span></span><br><span class="line">        max = Math.max(max, end - start + <span class="number">1</span>);</span><br><span class="line">        end++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="1234-æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²"><a href="#1234-æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²" class="headerlink" title="1234. æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/replace-the-substring-for-balanced-string/" target="_blank" rel="noopener">1234. æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²</a></h2><p>æœ‰ä¸€ä¸ªåªå«æœ‰ <code>'Q', 'W', 'E', 'R'</code> å››ç§å­—ç¬¦ï¼Œä¸”é•¿åº¦ä¸º n çš„å­—ç¬¦ä¸²ã€‚</p><p>å‡å¦‚åœ¨è¯¥å­—ç¬¦ä¸²ä¸­ï¼Œè¿™å››ä¸ªå­—ç¬¦éƒ½æ°å¥½å‡ºç° <code>n/4</code> æ¬¡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚</p><p>ç»™ä½ ä¸€ä¸ªè¿™æ ·çš„å­—ç¬¦ä¸² <code>s</code>ï¼Œè¯·é€šè¿‡ã€Œæ›¿æ¢å­ä¸²ã€çš„æ–¹å¼ï¼Œä½¿åŸå­—ç¬¦ä¸² s å˜æˆä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚</p><p>ä½ å¯ä»¥ç”¨å’Œã€Œå¾…æ›¿æ¢å­ä¸²ã€é•¿åº¦ç›¸åŒçš„ ä»»ä½• å…¶ä»–å­—ç¬¦ä¸²æ¥å®Œæˆæ›¿æ¢ã€‚</p><p>è¯·è¿”å›å¾…æ›¿æ¢å­ä¸²çš„æœ€å°å¯èƒ½é•¿åº¦ã€‚</p><p>å¦‚æœåŸå­—ç¬¦ä¸²è‡ªèº«å°±æ˜¯ä¸€ä¸ªå¹³è¡¡å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› 0 </p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"QWER"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">0</span></span><br><span class="line">è§£é‡Šï¼šs å·²ç»æ˜¯å¹³è¡¡çš„äº†ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"QQWE"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">1</span></span><br><span class="line">è§£é‡Šï¼šæˆ‘ä»¬éœ€è¦æŠŠä¸€ä¸ª <span class="string">'Q'</span> æ›¿æ¢æˆ <span class="string">'R'</span>ï¼Œè¿™æ ·å¾—åˆ°çš„ <span class="string">"RQWE"</span> (æˆ– <span class="string">"QRWE"</span>) æ˜¯å¹³è¡¡çš„ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"QQQW"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">2</span></span><br><span class="line">è§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æŠŠå‰é¢çš„ <span class="string">"QQ"</span> æ›¿æ¢æˆ <span class="string">"ER"</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = <span class="string">"QQQQ"</span></span><br><span class="line">è¾“å‡ºï¼š<span class="number">3</span></span><br><span class="line">è§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æ›¿æ¢å <span class="number">3</span> ä¸ª <span class="string">'Q'</span>ï¼Œä½¿ s = <span class="string">"QWER"</span>ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li>1 <= s.length <= 10^5</li><li>s.length æ˜¯ 4 çš„å€æ•°</li><li>s ä¸­åªå«æœ‰ â€˜Qâ€™, â€˜Wâ€™, â€˜Eâ€™, â€˜Râ€™ å››ç§å­—ç¬¦</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å‘¨èµ›é¢˜ï¼Œè¯´å®è¯ä¸å¤šåšåšç«èµ›çœŸä¸çŸ¥é“è‡ªå·±å¤šèœ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">balancedString</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span>|| s.length()<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> len=s.length();</span><br><span class="line">    <span class="keyword">int</span> balance=len/<span class="number">4</span>;</span><br><span class="line">    <span class="comment">//æ˜ å°„å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">int</span>[] count=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">128</span>];</span><br><span class="line">    <span class="comment">//ç»Ÿè®¡4ä¸ªå­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<len;i++) {< span><br><span class="line">        count[s.charAt(i)]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=<span class="number">0</span>,res=len;</span><br><span class="line">    <span class="keyword">while</span>(right<len){< span><br><span class="line">        count[s.charAt(right)]--;</span><br><span class="line">        <span class="keyword">while</span>(left<len && count[<span class="string">'Q'</len></span>]<=balance && count[<span class="string">'W'</span>]<=balance && count[<span class="string">'E'</span>] <=balance && count[<span class="string">'R'</span>]<=balance){</len){<></span><br><span class="line">            res=Math.min(res, right-left+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//çª—å£å·¦ç§»ï¼Œç¼©å°çª—å£</span></span><br><span class="line">            count[s.charAt(left)]++;</span><br><span class="line">            left++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ‰©å¤§å³è¾¹ç•Œ</span></span><br><span class="line">        right++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></len;i++)></span></pre></td></tr></tbody></table></figure></div><p>å·¦æŒ‡é’ˆè¿½èµ¶å³æŒ‡é’ˆï¼Œå½¢æˆæ»‘åŠ¨çª—å£ï¼Œæ„Ÿè§‰æ»‘åŠ¨çª—å£çš„é¢˜çœŸçš„æœ‰ç‚¹ä¸å¥½æå•Šï¼ï¼ï¼</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> æ»‘åŠ¨çª—å£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Socketç½‘ç»œç¼–ç¨‹</title>
      <link href="/2019/07/19/socket-wang-luo-bian-cheng/"/>
      <url>/2019/07/19/socket-wang-luo-bian-cheng/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h3 id="Socketæ¦‚è¿°"><a href="#Socketæ¦‚è¿°" class="headerlink" title="Socketæ¦‚è¿°"></a>Socketæ¦‚è¿°</h3><p>â€‹    å¥—æ¥å­—ï¼ˆsocketï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œå¯å¯¹å…¶è¿›è¡Œåƒå¯¹æ–‡ä»¶ä¸€æ ·çš„æ‰“å¼€ã€è¯»å†™å’Œå…³é—­ç­‰æ“ä½œã€‚å¥—æ¥å­—å…è®¸åº”ç”¨ç¨‹åºå°†I/Oæ’å…¥åˆ°ç½‘ç»œä¸­ï¼Œå¹¶ä¸ç½‘ç»œä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ç½‘ç»œå¥—æ¥å­—æ˜¯IPåœ°å€ä¸ç«¯å£çš„ç»„åˆã€‚socketæä¾›çš„å‡½æ•°æ˜¯<strong>æ“ä½œç³»ç»Ÿå†…æ ¸å°†â€œTCP/IPåè®®æ ˆ + åº•å±‚ç½‘å¡â€æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªä¸ªç”¨æˆ·å‹å¥½çš„å‡½æ•°ï¼Œç”¨äºæ“çºµæœ¬åœ°çš„â€œTCP/IPåè®®æ ˆ + åº•å±‚ç½‘å¡â€ä¸è¿œç«¯çš„æœåŠ¡å™¨/ä¸»æœºå®Œæˆé€šä¿¡çš„ä»»åŠ¡ã€‚</strong></p><h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p>ğŸ”¸ TCPæ˜¯é¢å‘è¿æ¥çš„é€šä¿¡åè®®</p><p>ğŸ”¸ é€šè¿‡<code>ä¸‰æ¬¡æ¡æ‰‹</code>å»ºç«‹è¿æ¥ï¼Œé€šè®¯å®Œæˆæ—¶è¦æ‹†é™¤è¿æ¥</p><p>ğŸ”¸ ç”±äºTCPæ˜¯é¢å‘è¿æ¥çš„æ‰€ä»¥åªèƒ½ç”¨äºç«¯åˆ°ç«¯çš„é€šè®¯</p><p>ğŸ”¸ ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</p><p>ğŸ”¸ å…·æœ‰æ ¡éªŒæœºåˆ¶ï¼Œå¯é ï¼Œæ•°æ®ä¼ è¾“ç¨³å®š</p><h4 id="ç®€å•çš„Socketå°æ¡ˆä¾‹"><a href="#ç®€å•çš„Socketå°æ¡ˆä¾‹" class="headerlink" title="ç®€å•çš„Socketå°æ¡ˆä¾‹"></a>ç®€å•çš„Socketå°æ¡ˆä¾‹</h4><p><strong>Socketå®¢æˆ·ç«¯</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TcpDemo;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 9:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REMOTE_PORT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LOCAL_PORT = <span class="number">30000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        Socket socket = creatSocket();</span><br><span class="line">        initSocket(socket);</span><br><span class="line">        <span class="comment">//setRecessAddresså‰</span></span><br><span class="line">        socket.bind(<span class="keyword">new</span> InetSocketAddress(InetAddress.getLocalHost(), LOCAL_PORT));</span><br><span class="line">        <span class="comment">//è¿æ¥è¿œç¨‹server</span></span><br><span class="line">        socket.connect(<span class="keyword">new</span> InetSocketAddress(InetAddress.getLocalHost(), REMOTE_PORT), <span class="number">3000</span>);</span><br><span class="line">        System.out.println(<span class="string">"å®¢æˆ·ç«¯å·²ç»å‘èµ·è¿æ¥"</span>);</span><br><span class="line">        System.out.println(<span class="string">"å®¢æˆ·ç«¯ä¿¡æ¯:"</span> + socket.getLocalAddress() + <span class="string">"port:"</span> + socket.getLocalPort());</span><br><span class="line">        System.out.println(<span class="string">"æœåŠ¡ç«¯ä¿¡æ¯"</span> + socket.getInetAddress() + <span class="string">"port:"</span> + socket.getPort());</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            sendMsg(socket);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            System.err.println(<span class="string">"è¿æ¥å¼‚å¸¸å…³é—­ï¼ï¼ï¼ï¼"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            socket.close();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initSocket</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> SocketException </span>{</span><br><span class="line">        socket.setSoTimeout(<span class="number">3000</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å¤ç”¨æœªå®Œå…¨å…³é—­åçš„ç«¯å£(TIME_WAITçŠ¶æ€)ï¼Œå¿…é¡»åœ¨bindå‰ï¼Œæ‰€ä»¥å°±ä¸èƒ½é€šè¿‡æ„é€ å™¨æ¥ç»‘å®šæœ¬åœ°ç«¯å£</span></span><br><span class="line">        socket.setReuseAddress(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å¼€å¯Nagleç®—æ³•(é»˜è®¤å¼€å¯) https://baike.baidu.com/item/Nagle%E7%AE%97%E6%B3%95</span></span><br><span class="line">        socket.setTcpNoDelay(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//é•¿æ—¶é—´æ— æ•°æ®ç›¸åº”çš„æ—¶å€™å‘é€ç¡®è®¤æ•°æ®ï¼ˆå¿ƒè·³åŒ…ï¼‰æ—¶é—´å¤§çº¦ä¸¤ä¸ªå°æ—¶</span></span><br><span class="line">        socket.setKeepAlive(<span class="keyword">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          closeå…³é—­åçš„å¤„ç†</span></span><br><span class="line"><span class="comment">          è¿™ä¸ªSocketé€‰é¡¹å¯ä»¥å½±å“closeæ–¹æ³•çš„è¡Œä¸ºã€‚</span></span><br><span class="line"><span class="comment">          false 0 é»˜è®¤æƒ…å†µ å…³é—­åç«‹å³è¿”å›ï¼Œåº•å±‚ç³»ç»Ÿæ¥ç®¡è¾“å‡ºæµï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å‘é€å®Œæˆ</span></span><br><span class="line"><span class="comment">          true 0 å…³é—­åç›´æ¥è¿”å› ç¼“å†²åŒºæ•°æ®ç›´æ¥æŠ›å¼ƒ ç›´æ¥å‘é€RESç»“æŸå‘½ä»¤åˆ°å¯¹æ–¹ï¼Œæ— éœ€ç»è¿‡2MSLç­‰å¾…</span></span><br><span class="line"><span class="comment">          true 200 å…³é—­æ—¶æœ€é•¿é˜»å¡200s éšåæŒ‰ç¬¬äºŒæƒ…å†µå¤„ç†</span></span><br><span class="line"><span class="comment">          (æ˜¯sä¸æ˜¯ms,å¼€å§‹æé”™äº† è®¾ç½®äº†20é‡å¯å°±ä¼šç«¯å£å ç”¨ã€‚ã€‚ã€‚ã€‚)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        socket.setSoLinger(<span class="keyword">true</span>, <span class="number">0</span>);</span><br><span class="line">       </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è®¾ç½®ç´§æ€¥æ•°æ®æ˜¯å¦å†…æ•›,å¦‚æœè¿™ä¸ªSocketé€‰é¡¹æ‰“å¼€ï¼Œ</span></span><br><span class="line"><span class="comment">        å¯ä»¥é€šè¿‡Socketç±»çš„sendUrgentDataæ–¹æ³•</span></span><br><span class="line"><span class="comment">        å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå•å­—èŠ‚çš„æ•°æ® è¿™ä¸ªå•å­—èŠ‚æ•°æ®å¹¶ä¸ç»è¿‡è¾“å‡ºç¼“å†²åŒºï¼Œè€Œæ˜¯ç«‹å³å‘å‡ºã€‚</span></span><br><span class="line"><span class="comment">        è™½ç„¶åœ¨å®¢æˆ·ç«¯å¹¶ä¸æ˜¯ä½¿ç”¨OutputStreamå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œ</span></span><br><span class="line"><span class="comment">        ä½†åœ¨æœåŠ¡ç«¯ç¨‹åºä¸­è¿™ä¸ªå•å­—èŠ‚çš„æ•°æ®æ˜¯å’Œå…¶å®ƒçš„æ™®é€šæ•°æ®æ··åœ¨ä¸€èµ·çš„</span></span><br><span class="line"><span class="comment">        å› æ­¤ï¼Œåœ¨æœåŠ¡ç«¯ç¨‹åºä¸­å¹¶ä¸çŸ¥é“ç”±å®¢æˆ·</span></span><br><span class="line"><span class="comment">        ç«¯å‘è¿‡æ¥çš„æ•°æ®æ˜¯ç”±OutputStream</span></span><br><span class="line"><span class="comment">        è¿˜æ˜¯ç”±sendUrgentDataå‘è¿‡æ¥çš„</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        socket.setOOBInline(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ”¶å‘ç¼“å†²å™¨å¤§å°ï¼Œé»˜è®¤32K</span></span><br><span class="line">        socket.setReceiveBufferSize(<span class="number">64</span>*<span class="number">1024</span>);</span><br><span class="line">        socket.setSendBufferSize(<span class="number">64</span>*<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ€§èƒ½å‚æ•°çš„ ä¼˜å…ˆçº§  çŸ­é“¾æ¥ å»¶è¿Ÿ å¸¦å®½</span></span><br><span class="line">        socket.setPerformancePreferences(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Socket <span class="title">creatSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //æ— ä»£ç†æ¨¡å¼, ç›¸å½“äºç©ºæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">        Socket socket = new Socket(Proxy.NO_PROXY);</span></span><br><span class="line"><span class="comment">        //HTTPä»£ç†æ¨¡å¼ä¼ è¾“çš„æ•°æ®å°†é€šè¿‡www.imlgw.topè½¬å‘</span></span><br><span class="line"><span class="comment">        socket = new Socket(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(Inet4Address.getByName("www.imlgw.top"), 80)));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        //ä¸‹é¢ä¸¤ç§æ–¹å¼å›åœ¨åˆ›å»ºçš„æ—¶å€™å°±å»é“¾æ¥è¿œç¨‹çš„æœåŠ¡å™¨(å…·ä½“çœ‹æºç ),ç„¶è€Œä¸€èˆ¬æƒ…å†µä¸‹å…¶å®åœ¨è¿æ¥ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€äº›å‚æ•°</span></span><br><span class="line"><span class="comment">        //æ–°å»ºä¸€ä¸ªå¥—æ¥å­— é“¾æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å’Œç«¯å£ï¼ˆæœ¬åœ°ç«¯å£ä¸ºç³»ç»Ÿåˆ†é…ï¼‰</span></span><br><span class="line"><span class="comment">        socket = new Socket("imlgw.top", REMOTE_PORT);</span></span><br><span class="line"><span class="comment">        //æ–°å»ºå¥—æ¥å­—ç›´æ¥é“¾æ¥åˆ°è¿œç¨‹ç«¯å£ å¹¶ç»‘å®šæœ¬åœ°ç«¯å£</span></span><br><span class="line"><span class="comment">        socket=new Socket("imlgw.top",REMOTE_PORT,InetAddress.getLocalHost(),LOCAL_PORT);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–°å»ºsocketç„¶åç»‘å®šåˆ°æœ¬åœ°ç«¯å£</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket();</span><br><span class="line">        <span class="keyword">return</span> socket;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="comment">//é”®ç›˜çš„è¾“å…¥æµ</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="comment">//æ‹¿åˆ°socketçš„è¾“å‡ºæµ</span></span><br><span class="line">        OutputStream socketOutputStream = socket.getOutputStream();</span><br><span class="line">        <span class="comment">//è½¬æ¢ä¸ºæ‰“å°æµ</span></span><br><span class="line">        PrintStream printStream = <span class="keyword">new</span> PrintStream(socketOutputStream);</span><br><span class="line">        <span class="comment">//socketçš„è¾“å…¥æµ</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        <span class="comment">//è½¬æ¢ä½bufferæµ</span></span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">do</span> {</span><br><span class="line">            <span class="comment">//å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">            printStream.println(scanner.nextLine());</span><br><span class="line">            <span class="comment">//æœåŠ¡ç«¯çš„å“åº”</span></span><br><span class="line">            String s = bufferedReader.readLine();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"bye"</span>.equals(s)) {</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                System.out.println(<span class="string">"æœåŠ¡ç«¯å“åº”ï¼š"</span> + s);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">while</span> (flag);</span><br><span class="line">        bufferedReader.close();</span><br><span class="line">        printStream.close();</span><br><span class="line">        scanner.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>SocketæœåŠ¡ç«¯</strong></p><p> è¿™é‡Œä¸ºäº†åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è®¾è®¡æˆäº†<strong>å¤šçº¿ç¨‹</strong>å¼‚æ­¥çš„æ¨¡å¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TcpDemo;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 9:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVER_PORT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        ServerSocket server = creatServerSocket();</span><br><span class="line">        initServerSocket(server);</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ä¹‹åå†ç»‘å®šï¼Œä¸ç„¶ä¸€äº›è®¾ç½®ä¼šå¤±æ•ˆï¼Œæ¯”å¦‚ setReuseAddress</span></span><br><span class="line">        server.bind(<span class="keyword">new</span> InetSocketAddress(InetAddress.getLocalHost(), SERVER_PORT), <span class="number">50</span>);</span><br><span class="line">        System.out.println(<span class="string">"æœåŠ¡å™¨å‡†å¤‡å°±ç»ª"</span>);</span><br><span class="line">        System.out.println(<span class="string">"æœåŠ¡ç«¯ä¿¡æ¯"</span> + server.getInetAddress() + <span class="string">" port:"</span> + server.getLocalPort());</span><br><span class="line">        <span class="comment">//ç›‘å¬å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="comment">//é˜»å¡æ–¹æ³•</span></span><br><span class="line">            Socket client = server.accept();</span><br><span class="line">            ClientHandle clientHandle = <span class="keyword">new</span> ClientHandle(client);</span><br><span class="line">            <span class="keyword">new</span> Thread(clientHandle).start();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initServerSocket</span><span class="params">(ServerSocket server)</span> <span class="keyword">throws</span> SocketException </span>{</span><br><span class="line">        <span class="comment">//åŒclient</span></span><br><span class="line">        server.setReuseAddress(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®acceptçš„buffer</span></span><br><span class="line">        server.setReceiveBufferSize(<span class="number">64</span> * <span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®timeout</span></span><br><span class="line">        <span class="comment">//server.setSoTimeout(2000);</span></span><br><span class="line">        <span class="comment">//è®¾ç½®æ€§èƒ½å‚æ•°,è¿æ¥å‰è®¾ç½®</span></span><br><span class="line">        server.setPerformancePreferences(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ServerSocket <span class="title">creatServerSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket();</span><br><span class="line">        <span class="comment">//ç»‘å®šç«¯å£ backlog:æ–°è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶,ä¸æ˜¯é“¾æ¥çš„æ•°é‡,æ˜¯å…è®¸ç­‰å¾…çš„é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">        <span class="comment">//server.bind(new InetSocketAddress(InetAddress.getLocalHost(),SERVER_PORT),50);</span></span><br><span class="line">        <span class="comment">//server =new ServerSocket(SERVER_PORT,50); ç­‰æ•ˆæ–¹æ¡ˆ</span></span><br><span class="line">        <span class="comment">//server =new ServerSocket(SERVER_PORT,50,InetAddress.getLocalHost());</span></span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientHandle</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">        ClientHandle(Socket client) {</span><br><span class="line">            <span class="keyword">this</span>.socket = client;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            System.out.println(<span class="string">"æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š"</span> + socket.getInetAddress() + <span class="string">"portï¼š"</span> + socket.getPort());</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//è¾“å…¥æµè·å–ä¿¡æ¯</span></span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line">                <span class="comment">//è¾“å‡ºæµå“åº”å®¢æˆ·ç«¯</span></span><br><span class="line">                PrintStream printStream = <span class="keyword">new</span> PrintStream(socket.getOutputStream());</span><br><span class="line">                <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">do</span> {</span><br><span class="line">                    String s = reader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">"bye"</span>.equalsIgnoreCase(s)) {</span><br><span class="line">                        flag = <span class="keyword">false</span>;</span><br><span class="line">                        System.out.println(<span class="string">"å®¢æˆ·ç«¯å…³é—­äº†è¿æ¥"</span>);</span><br><span class="line">                        printStream.println(<span class="string">"bye"</span>);</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        System.out.println(s);</span><br><span class="line">                        printStream.println(<span class="string">"å­—ç¬¦ä¸²é•¿åº¦#"</span> + s.length());</span><br><span class="line">                    }</span><br><span class="line">                } <span class="keyword">while</span> (flag);</span><br><span class="line">                reader.close();</span><br><span class="line">                printStream.close();</span><br><span class="line">            } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    socket.close();</span><br><span class="line">                } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å…·ä½“çš„ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•è§£é‡Šéƒ½åœ¨ä»£ç çš„æ³¨é‡Šä¸­ <a href="https://elf8848.iteye.com/blog/1739598" target="_blank" rel="noopener">å‚è€ƒ</a></p></blockquote><p><img alt="mark" data-src="http://static.imlgw.top/image/20190707/eBKfzShaiIHU.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h4 id="ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹"><a href="#ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹"></a>ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹</h4><p>ä¸Šé¢çš„å“ªä¸ªå°æ¡ˆä¾‹ä¼ é€çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿè®¸æœ‰åŒå­¦ä¼šè¯´è¿™äº›åŸºæœ¬ç±»å‹ä¸éƒ½æ˜¯å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥ä¼ å—ï¼Ÿä¸ºä»€ä¹ˆè¦è´¹é‚£ä¸ªåŠ²å»ä¼ è¿™äº›åŸºæœ¬ç±»å‹ï¼Ÿå…¶å®ä¸ç„¶ï¼Œè¿™é‡Œå‡è®¾è¦ä¼ é€çš„æ˜¯ intç±»å‹çš„12345678 ï¼Œå¦‚æœé€šè¿‡ <code>int</code> æ¥ä¼ è¾“åªè¦åœ¨èŒƒå›´å†…éƒ½æ˜¯<strong>4</strong>ä¸ªå­—èŠ‚å¤§å°å›ºå®šï¼Œç„¶è€Œé€šè¿‡<code>String</code>ä¼ é€å°†ä¼šæ˜¯â€12345678â€ ä¹Ÿå°±æ˜¯<strong>8</strong>ä¸ªå­—èŠ‚ï¼Œæ¶ˆè€—è¦æ¯”ä½¿ç”¨<code>int</code>è¦å¤§ï¼Œè€Œä¸”é•¿åº¦ä¸å›ºå®šï¼Œä¸æ–¹ä¾¿åæœŸæ¥å—çš„é•¿åº¦åˆ¤æ–­ã€‚</p><p> <strong><code>int</code> ç±»å‹</strong>  </p><p>åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„éƒ½æ˜¯ä»¥<strong>Byte</strong>ä¸ºåŸºæœ¬å•ä½ï¼Œå¦‚æœè¦ä¼ é€<strong>int</strong>æˆ‘ä»¬å°±éœ€è¦å°†<strong>int</strong>è½¬æ¢ä¸º<strong>byte</strong>ï¼Œä¸€ä¸ª<strong>int</strong>æ˜¯4ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª<strong>byte[]</strong>æ•°ç»„ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/11 13:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ByteTools</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] int2byte(<span class="keyword">int</span> a) {</span><br><span class="line">        <span class="comment">//æ— ç¬¦å·å³ç§»</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[]{</span><br><span class="line">                (<span class="keyword">byte</span>) (a >>> <span class="number">24</span>),</span><br><span class="line">                (<span class="keyword">byte</span>) (a >>> <span class="number">16</span>),</span><br><span class="line">                (<span class="keyword">byte</span>) (a >>> <span class="number">8</span>),</span><br><span class="line">                (<span class="keyword">byte</span>) (a)</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">byte2int</span><span class="params">(<span class="keyword">byte</span>[] a)</span> </span>{</span><br><span class="line">        <span class="comment">//&0xff-->è½¬æ¢ä¸ºint å°†é«˜ä½è¡¥0,ä½8ä½ä¸å˜</span></span><br><span class="line">        <span class="comment">//-127 ï¼š10000001(è¡¥) &0xff --> 00000000 00000000 00000000 10000001</span></span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">3</span>] & <span class="number">0xff</span> | (a[<span class="number">2</span>] & <span class="number">0xff</span>) << <span class="number">8</span> | (a[<span class="number">1</span>] & <span class="number">0xff</span>) << <span class="number">16</span> | (a[<span class="number">0</span>] & <span class="number">0xff</span>) << <span class="number">24</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸ºä»€ä¹ˆè¿™æ ·åšçš„ä¸€äº›ç»†èŠ‚å¯ä»¥å‚è€ƒ <a href="https://www.cnblogs.com/think-in-java/p/5527389.html" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a></p><p>æœ‰äº†è¿™ä¸ªå·¥å…·ç±»æˆ‘ä»¬å°±å¯ä»¥å°†<strong>int</strong>è½¬æ¢ä¸º<strong>byte[]</strong>åè¿›è¡Œä¼ è¾“ï¼ŒåŒæ—¶æ¥æ”¶ç«¯ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•å°†æ•°æ®è¿˜åŸã€‚</p><p>ç­‰ç­‰ğŸ™„ ï¼Œè¿™æ ·ä¸€æ¥ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹å¯¹åº”çš„éƒ½è¦å»å†™ä¸ªè¿™æ ·çš„è½¬æ¢çš„æ–¹æ³•ï¼Ÿé‚£è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œæ‰€ä»¥è¿™æ ·çš„äº‹æƒ…<strong>JDK</strong>å¸®æˆ‘ä»¬åšäº†</p><p><strong><code>ByteBuffer</code></strong>ï¼šnioä¸­çš„ä¸€ä¸ªåŒ…ï¼Œè¿™é‡Œæˆ‘è¿˜ä¸å¤ªç†Ÿæ‚‰è¿™ä¸ªå…·ä½“çš„ä½œç”¨ï¼Œç›®å‰åªçŸ¥é“å¯ä»¥ç”¨æ¥åŒ…è£…<strong>byte[]</strong>ï¼Œç„¶åå¯ä»¥å®ç°ä¸Šé¢çš„ç±»å‹è½¬æ¢</p><p><strong>Clientå‘é€ç«¯</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] buffer=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">256</span>];</span><br><span class="line"><span class="comment">//åŒ…è£…buffer (è£…é¥°å™¨æ¨¡å¼ï¼Ÿ</span></span><br><span class="line">ByteBuffer byteBuffer = ByteBuffer.wrap(buffer);</span><br><span class="line"><span class="comment">//byte  1</span></span><br><span class="line">byteBuffer.put((<span class="keyword">byte</span>) <span class="number">126</span>);</span><br><span class="line"><span class="comment">//int ç±»å‹ 4</span></span><br><span class="line">byteBuffer.putInt(<span class="number">123</span>);</span><br><span class="line"><span class="comment">//char 2(unicode)</span></span><br><span class="line">byteBuffer.putChar(<span class="string">'A'</span>);</span><br><span class="line"><span class="comment">//long 8</span></span><br><span class="line">byteBuffer.putLong(<span class="number">323333231234124321L</span>);</span><br><span class="line"><span class="keyword">boolean</span> isOk=<span class="keyword">true</span>;</span><br><span class="line"><span class="comment">//byte 1</span></span><br><span class="line">byteBuffer.put((<span class="keyword">byte</span>) (isOk?<span class="number">1</span>:<span class="number">0</span>));</span><br><span class="line"><span class="comment">//float 4</span></span><br><span class="line">byteBuffer.putFloat(<span class="number">123.2132F</span>);</span><br><span class="line"><span class="comment">//double 8 =28</span></span><br><span class="line">byteBuffer.putDouble(<span class="number">231.1412421321</span>);</span><br><span class="line"><span class="comment">//String 10</span></span><br><span class="line">byteBuffer.put(<span class="string">"HelloWorld"</span>.getBytes());</span><br><span class="line"><span class="comment">//å‘é€ 38 Byte </span></span><br><span class="line">socketOutputStream.write(buffer,<span class="number">0</span>,byteBuffer.position());</span><br></pre></td></tr></tbody></table></figure></div><p>éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯æœ€å<strong>write</strong>çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªå‚æ•°<strong>len</strong>ï¼Œç›´æ¥ä¼ <strong>position()</strong>,å°±å¯ä»¥äº†ï¼Œä¸ç”¨+1ï¼Œè¿™ä¸ªpositionæ˜¯ä¸‹ä¸€ä¸ªå­—èŠ‚ä½ç½®</p><blockquote><p>è¿™é‡Œå…¶å®æˆ‘çœ‹çš„æ•™ç¨‹è¿™é‡Œæ˜¯åŠ 1äº†çš„ï¼Œæœ€åæ¥æ”¶è¿‡æ¥çš„æ•°æ®é•¿åº¦æ­»æ´»å¯¹ä¸ä¸Šï¼Œæˆ‘å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä»€ä¹ˆ<strong>å†…å­˜å¯¹é½</strong>ï¼Œä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„ç„¶åæ‰å‘ç°æ˜¯è¿™é‡Œæœ‰é—®é¢˜ã€‚ã€‚ã€‚</p></blockquote><p><strong>Serveræ¥æ”¶ç«¯</strong></p><p>åŸºæœ¬ç±»å‹çš„è¯»å–ä¸ä¸Šé¢å¯¹åº”çš„<strong>get</strong>ï¼Œæœ€åä¸€ä¸ªStringéœ€è¦æ³¨æ„ï¼Œç›´æ¥ç”¨åŸå§‹çš„<strong>buffer</strong>å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å€ŸåŠ©<strong>ByteBuffer</strong>ï¼Œè¿™é‡ŒåŒæ ·åé¢ä¸ç”¨-1</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String str = <span class="keyword">new</span> String(buffer, byteBuffer.position(), readByteCount-byteBuffer.position());</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•ç»“æœ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">æœåŠ¡å™¨å‡†å¤‡å°±ç»ª</span><br><span class="line">æœåŠ¡ç«¯ä¿¡æ¯LAPTOP-V5R5ABUJ/<span class="number">192.168</span><span class="number">.25</span><span class="number">.1</span> port:<span class="number">20000</span></span><br><span class="line">æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š/<span class="number">192.168</span><span class="number">.25</span><span class="number">.1</span>portï¼š<span class="number">30000</span></span><br><span class="line">å½“å‰ä¸‹æ ‡<span class="number">28</span></span><br><span class="line">æ¥å—åˆ°Clientæ•°æ®é•¿åº¦(<span class="keyword">byte</span>)ï¼š<span class="number">38</span></span><br><span class="line">Clientå‘é€çš„æ•°æ®:</span><br><span class="line"><span class="number">126</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line">A</span><br><span class="line"><span class="number">323333231234124321</span></span><br><span class="line"><span class="keyword">true</span></span><br><span class="line"><span class="number">123.2132</span></span><br><span class="line"><span class="number">231.1412421321</span></span><br><span class="line">HelloWorld</span><br></pre></td></tr></tbody></table></figure></div><h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p>ğŸ”¸  UDPæ˜¯æ— è¿æ¥çš„ï¼Œå³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚</p><p>ğŸ”¸  UDPä½¿ç”¨å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨ã€‚</p><p>ğŸ”¸   UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡ã€‚</p><p>ğŸ”¸   UDPæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ã€‚å¾ˆå¤šçš„å®æ—¶åº”ç”¨ï¼ˆå¦‚IPç”µè¯ã€å®æ—¶è§†é¢‘ä¼šè®®ç­‰ï¼‰è¦å»æºä¸»æœºä»¥æ’å®šçš„é€Ÿç‡å‘é€æ•°æ®ï¼Œå¹¶ä¸”å…è®¸åœ¨ç½‘ç»œå‘ç”Ÿæ‹¥å¡æ—¶ä¸¢å¤±ä¸€äº›æ•°æ®ï¼Œä½†å´ä¸å…è®¸æ•°æ®æœ‰å¤ªå¤šçš„æ—¶å»¶ã€‚UDPæ­£å¥½ç¬¦åˆè¿™ç§è¦æ±‚ã€‚</p><p>ğŸ”¸   UDPæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚</p><p>ğŸ”¸   UDPçš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ¯”TCPçš„20ä¸ªå­—èŠ‚çš„é¦–éƒ¨è¦çŸ­ã€‚</p><h4 id="å•æ’­"><a href="#å•æ’­" class="headerlink" title="å•æ’­"></a>å•æ’­</h4><p><strong>æ¶ˆæ¯æ¥æ”¶è€…</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPProvide</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="comment">//ç›‘å¬20000ç«¯å£</span></span><br><span class="line">        DatagramSocket socket=<span class="keyword">new</span> DatagramSocket(<span class="number">20000</span>);</span><br><span class="line">        System.out.println(<span class="string">"UDPProvide is start...."</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">        <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket</span></span><br><span class="line">        DatagramPacket udp_receive=<span class="keyword">new</span> DatagramPacket(buf,buf.length);</span><br><span class="line">        <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket (é˜»å¡)</span></span><br><span class="line">        socket.receive(udp_receive);</span><br><span class="line">        <span class="comment">//è·å–å‘é€äººçš„SocketAddress</span></span><br><span class="line">        SocketAddress socketAddress = udp_receive.getSocketAddress();</span><br><span class="line">        <span class="keyword">int</span> datalen = udp_receive.getLength();</span><br><span class="line">        <span class="comment">//è·å–å‘é€çš„æ•°æ®</span></span><br><span class="line">        String receive=<span class="keyword">new</span> String(udp_receive.getData(),<span class="number">0</span>,datalen);</span><br><span class="line">        System.out.println(<span class="string">"receive from the: "</span>+socketAddress);</span><br><span class="line">        System.out.println(<span class="string">"receive data: "</span>+ receive);</span><br><span class="line">        <span class="comment">//æ„å»ºå“åº”çš„DatagramPacket</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = (<span class="string">"provider receive the data success "</span>+datalen).getBytes();</span><br><span class="line">        DatagramPacket udp_sendBack=<span class="keyword">new</span> DatagramPacket(bytes,bytes.length,socketAddress);</span><br><span class="line">        socket.send(udp_sendBack);</span><br><span class="line">        <span class="comment">//ç»“æŸ</span></span><br><span class="line">        System.out.println(<span class="string">"UDPProvide Finished."</span>);</span><br><span class="line">        socket.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ¶ˆæ¯å‘é€è€…</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPSearch</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch is ready..."</span>);</span><br><span class="line">        <span class="comment">//æ„å»ºsocket</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">        <span class="keyword">byte</span>[] buff= <span class="string">"hello world"</span>.getBytes();</span><br><span class="line">        <span class="comment">//æ„å»ºå‘é€æ®µ</span></span><br><span class="line">        DatagramPacket udp_send=<span class="keyword">new</span> DatagramPacket(buff,buff.length);</span><br><span class="line">        <span class="comment">//æŒ‡å®šå¯¹æ–¹ip</span></span><br><span class="line">        udp_send.setAddress(InetAddress.getLocalHost());</span><br><span class="line">        udp_send.setPort(<span class="number">20000</span>);</span><br><span class="line">        socket.send(udp_send);</span><br><span class="line">        <span class="comment">//è·å–å“åº”æ®µ</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">        DatagramPacket udp_receive=<span class="keyword">new</span> DatagramPacket(buf,buf.length);</span><br><span class="line">        socket.receive(udp_receive);</span><br><span class="line">        String s = <span class="keyword">new</span> String(udp_receive.getData(), <span class="number">0</span>, udp_receive.getLength());</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch is over"</span>);</span><br><span class="line">        socket.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="å¤šæ’­-amp-å¹¿æ’­"><a href="#å¤šæ’­-amp-å¹¿æ’­" class="headerlink" title="å¤šæ’­&å¹¿æ’­"></a>å¤šæ’­&å¹¿æ’­</h4><p><strong>æ¶ˆæ¯å»ºé€ å™¨</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/8 8:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageCreator</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SN_HEADER = <span class="string">"æ”¶åˆ°æš—å·,æˆ‘æ˜¯SN:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PORT_HEADER = <span class="string">"è¿™æ˜¯æš—å·,è¯·å›é€åˆ°è¯¥ç«¯å£:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">buildWithPort</span><span class="params">(<span class="keyword">int</span> port)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> PORT_HEADER + port;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parsePort</span><span class="params">(String sn)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (sn.startsWith(PORT_HEADER)) {</span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(sn.substring(PORT_HEADER.length()));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span>  -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">buildWithSn</span><span class="params">(String sn)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> SN_HEADER+sn;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">parseSn</span><span class="params">(String sn)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(sn.startsWith(SN_HEADER)){</span><br><span class="line">            <span class="keyword">return</span> sn.substring(SN_HEADER.length());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ¶ˆæ¯æ¥å—è€…</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UdpDemo2;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPProvide</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> PROVIDE_LISTEN_PORT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        String sn = UUID.randomUUID().toString();</span><br><span class="line">        Provider provider = <span class="keyword">new</span> Provider(sn);</span><br><span class="line">        <span class="keyword">new</span> Thread(provider).start();</span><br><span class="line">        System.in.read();</span><br><span class="line">        provider.shutdown();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> isDone = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">public</span> DatagramSocket socket = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> String sn;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Provider</span><span class="params">(String sn)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.sn = sn;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            System.out.println(<span class="string">"UDPProvide is start...."</span>);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                socket = <span class="keyword">new</span> DatagramSocket(PROVIDE_LISTEN_PORT);</span><br><span class="line">                <span class="keyword">while</span> (!isDone) {</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket</span></span><br><span class="line">                    DatagramPacket udp_receive = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">                    <span class="comment">//æ¥å—DatagramPacket (é˜»å¡)</span></span><br><span class="line">                    socket.receive(udp_receive);</span><br><span class="line">                    <span class="comment">//è·å–å‘é€äººçš„SocketAddress</span></span><br><span class="line">                    InetSocketAddress socketAddress = (InetSocketAddress) udp_receive.getSocketAddress();</span><br><span class="line">                    <span class="keyword">int</span> datalen = udp_receive.getLength();</span><br><span class="line">                    <span class="comment">//è·å–å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">                    String receive = <span class="keyword">new</span> String(udp_receive.getData(), <span class="number">0</span>, datalen);</span><br><span class="line">                    <span class="comment">//æ‰“å°è·å–åˆ°çš„æ•°æ®</span></span><br><span class="line">                    System.out.println(<span class="string">"receive from the: "</span> + socketAddress);</span><br><span class="line">                    System.out.println(<span class="string">"receive data: "</span> + receive);</span><br><span class="line">                    <span class="comment">//è§£æsn,è·å–éœ€è¦å›é€çš„ç«¯å£</span></span><br><span class="line">                    <span class="keyword">int</span> port = MessageCreator.parsePort(receive);</span><br><span class="line">                    <span class="keyword">if</span> (port != -<span class="number">1</span>) {</span><br><span class="line">                        <span class="comment">//æ„å»ºå›é€çš„DatagramPacket</span></span><br><span class="line">                        <span class="keyword">byte</span>[] responseBody = MessageCreator.buildWithSn(sn).getBytes();</span><br><span class="line">                        DatagramPacket udp_sendBack = <span class="keyword">new</span> DatagramPacket(responseBody, <span class="number">0</span>, responseBody.length, socketAddress.getAddress(), port);</span><br><span class="line">                        socket.send(udp_sendBack);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                <span class="comment">// e.printStackTrace();</span></span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                closeRes();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//ç»“æŸ</span></span><br><span class="line">            System.out.println(<span class="string">"UDPProvide Finished."</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>{</span><br><span class="line">            isDone = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">//è¿™é‡Œä»…ä»…isDone=true è¿œè¿œä¸å¤Ÿ,å› ä¸ºsocket.receiveæ˜¯ä¸€ä¸ªæ°¸ä¹…é˜»å¡çš„æ–¹æ³•</span></span><br><span class="line">            <span class="comment">//æ‰€ä»¥ä¸‹é¢è¿˜è¦closeè¿™ä¸ªsocketè¿™æ ·å°±ä¼šæ•è·åˆ°ä¸€ä¸ªå¼‚å¸¸ç„¶åç»“æŸ</span></span><br><span class="line">            closeRes();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeRes</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="keyword">null</span>) {</span><br><span class="line">                socket.close();</span><br><span class="line">                socket = <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸ä¸Šé¢ä¸åŒçš„æ˜¯è¿™é‡Œä¸ºäº†éšæ—¶å¯ä»¥åœæ­¢å°†å…¶æ„å»ºæˆäº†å¼‚æ­¥çº¿ç¨‹ï¼Œå½“æ¥å—åˆ°ç»ˆæ­¢ä¿¡å·çš„æ—¶å€™å°±ä¼šæ”¹å˜çŠ¶æ€é‡ï¼Œå¹¶closeèµ„æºï¼Œç„¶ååˆ©ç”¨å¼‚å¸¸åœæ­¢çº¿ç¨‹ã€‚</p><p><strong>æ¶ˆæ¯å‘é€è€…</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UdpDemo2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPSearch</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SEARCH_LISTEN_PORT = <span class="number">30000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DatagramSocket socket = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>{</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch is start..."</span>);</span><br><span class="line">        Listener listen = listen();</span><br><span class="line">        sendBoard();</span><br><span class="line">        System.in.read();</span><br><span class="line">        List<device> devices = listen.closeAndGetDeviceList();</device></span><br><span class="line">        <span class="keyword">for</span> (Device device : devices) {</span><br><span class="line">            System.out.println(device);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Listener <span class="title">listen</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch Listener is start"</span>);</span><br><span class="line">        CountDownLatch countDownLatch=<span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">        Listener listener=<span class="keyword">new</span> Listener(SEARCH_LISTEN_PORT,countDownLatch);</span><br><span class="line">        <span class="keyword">new</span> Thread(listener).start();</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        <span class="keyword">return</span> listener;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendBoard</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="comment">//ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„ç«¯å£</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">        <span class="comment">//æ„å»ºsocket</span></span><br><span class="line">        <span class="keyword">byte</span>[] buff = MessageCreator.buildWithPort(SEARCH_LISTEN_PORT).getBytes();</span><br><span class="line">        <span class="comment">//æ„å»ºå‘é€æ®µ</span></span><br><span class="line">        DatagramPacket udp_send = <span class="keyword">new</span> DatagramPacket(buff, buff.length);</span><br><span class="line">        <span class="comment">//å¹¿æ’­åœ°å€</span></span><br><span class="line">        udp_send.setAddress(InetAddress.getByName(<span class="string">"255.255.255.255"</span>));</span><br><span class="line">        <span class="comment">//æ¥æ”¶æ–¹çš„ç«¯å£</span></span><br><span class="line">        udp_send.setPort(UDPProvide.PROVIDE_LISTEN_PORT);</span><br><span class="line">        socket.send(udp_send);</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch Board is over"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Device</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> port;</span><br><span class="line">        String ip;</span><br><span class="line">        String sn;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Device</span><span class="params">(<span class="keyword">int</span> port, String ip, String sn)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.port = port;</span><br><span class="line">            <span class="keyword">this</span>.ip = ip;</span><br><span class="line">            <span class="keyword">this</span>.sn = sn;</span><br><span class="line">        }</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Device{"</span> +</span><br><span class="line">                    <span class="string">"port="</span> + port +</span><br><span class="line">                    <span class="string">", ip='"</span> + ip + <span class="string">'\''</span> +</span><br><span class="line">                    <span class="string">", sn='"</span> + sn + <span class="string">'\''</span> +</span><br><span class="line">                    <span class="string">'}'</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Listener</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> listenPort;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CountDownLatch countDownLatch;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List<device> deviceList = <span class="keyword">new</span> ArrayList<device>();</device></device></span><br><span class="line">        <span class="comment">//private static DatagramSocket socket = null;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isDone = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Listener</span><span class="params">(<span class="keyword">int</span> listenPort, CountDownLatch countDownLatch)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.listenPort = listenPort;</span><br><span class="line">            <span class="keyword">this</span>.countDownLatch = countDownLatch;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">//é€šçŸ¥å·²ç»å¯åŠ¨</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                socket = <span class="keyword">new</span> DatagramSocket(listenPort);</span><br><span class="line">                <span class="keyword">while</span> (!isDone) {</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket</span></span><br><span class="line">                    DatagramPacket udp_receive = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">                    <span class="comment">//æ¥å—DatagramPacket (é˜»å¡)</span></span><br><span class="line">                    socket.receive(udp_receive);</span><br><span class="line">                    <span class="comment">//è·å–å‘é€äººçš„SocketAddress</span></span><br><span class="line">                    InetSocketAddress socketAddress = (InetSocketAddress) udp_receive.getSocketAddress();</span><br><span class="line">                    <span class="keyword">int</span> datalen = udp_receive.getLength();</span><br><span class="line">                    <span class="comment">//è·å–å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">                    String sn = <span class="keyword">new</span> String(udp_receive.getData(), <span class="number">0</span>, datalen);</span><br><span class="line">                    System.out.println(<span class="string">"back from theï¼š"</span> + socketAddress);</span><br><span class="line">                    System.out.println(<span class="string">"back dataï¼š"</span> + sn);</span><br><span class="line">                    sn=MessageCreator.parseSn(sn);</span><br><span class="line">                    <span class="keyword">if</span> (sn != <span class="keyword">null</span>) {</span><br><span class="line">                        deviceList.add(<span class="keyword">new</span> Device(socketAddress.getPort(), socketAddress.getAddress().toString(), sn));</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">               <span class="comment">//e.printStackTrace();</span></span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                closeRes();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="string">"UDPSearch Listener is Finished..."</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeRes</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="keyword">null</span>) {</span><br><span class="line">                socket.close();</span><br><span class="line">                socket = <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function">List<device> <span class="title">closeAndGetDeviceList</span><span class="params">()</span> </device></span>{</span><br><span class="line">            isDone = <span class="keyword">true</span>;</span><br><span class="line">            closeRes();</span><br><span class="line">            <span class="keyword">return</span> deviceList;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯å¹¿æ’­çš„åœ°å€<strong>255.255.255.255</strong></p><blockquote><p>å¦‚æœæ˜¯åœ¨å±€åŸŸç½‘å†…å’Œå…¶ä»–æœºå™¨é€šä¿¡éœ€è¦å…³é—­è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œä¸ç„¶æ˜¯èµ°çš„è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œå…¶ä»–æœºå™¨æ¥æ”¶ä¸åˆ°ã€‚(æˆ‘è¯´æ€ä¹ˆå‘é€çš„<strong>IP</strong>ä¸æ˜¯æˆ‘çš„æœ¬æœºçš„<strong>IP</strong>)</p></blockquote><p>ğŸ”¸UDPæ˜¯é¢å‘æ— è¿æ¥çš„é€šè®¯åè®®ï¼ŒåŸºäºç”¨æˆ·æ•°æ®æŠ¥çš„åè®®</p><p>ğŸ”¸UDPæ•°æ®åŒ…æ‹¬ç›®çš„ç«¯å£å·å’Œæºç«¯å£å·ä¿¡æ¯</p><p>ğŸ”¸é€šè®¯ä¸éœ€è¦è¿æ¥ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¹¿æ’­å‘é€ï¼Œå¹¶ä¸å±€é™äºç«¯åˆ°ç«¯</p><p>ğŸ”¸ç»“æ„ç®€å•ï¼Œæ— æ ¡éªŒï¼Œé€Ÿåº¦å¿«ï¼Œå®¹æ˜“ä¸¢åŒ…ï¼Œå¯å¹¿æ’­</p><p>ğŸ”¸ä»–ä¸€æ—¦æŠŠåº”ç”¨ç¨‹åºå‘ç»™ç½‘ç»œå±‚çš„æ•°æ®å‘é€å‡ºå»å°±ä¸ä¿ç•™æ•°æ®å¤‡ä»½</p><h3 id="UDPè¾…åŠ©TCP-å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“"><a href="#UDPè¾…åŠ©TCP-å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“" class="headerlink" title="UDPè¾…åŠ©TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“"></a>UDPè¾…åŠ©TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“</h3><p>å®¢æˆ·ç«¯å…ˆåˆ©ç”¨<code>UDP</code>å‘å±€åŸŸç½‘å‘é€å¹¿æ’­ï¼Œç„¶åå¯¹åº”çš„æœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åå°±ä¼šå°†å¯¹åº”çš„<code>TCP</code>çš„ç«¯å£å›é€ç»™å®¢æˆ·ç«¯ï¼Œç„¶åäºŒè€…è¿›è¡ŒTCPçš„åŒå‘é€šä¿¡ï¼Œä»£ç å¤ªå¤šè¿™é‡Œå°±åªæ”¾ä¸€ä¸‹<code>Server</code>ç«¯çš„<code>Handler</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> udp_tcp_concurrency.server.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> udp_tcp_concurrency.utils.CloseUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/17 11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">ClientHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerReadHandler serverReadHandler;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerWriterHandler serverWriterHandle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CloseNotify closeNotify;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientHandler</span><span class="params">(Socket socket, CloseNotify closeNotify)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="keyword">this</span>.socket = socket;</span><br><span class="line">        <span class="keyword">this</span>.serverReadHandler = <span class="keyword">new</span> ServerReadHandler(socket.getInputStream());</span><br><span class="line">        <span class="keyword">this</span>.serverWriterHandle = <span class="keyword">new</span> ServerWriterHandler(socket.getOutputStream());</span><br><span class="line">        <span class="keyword">this</span>.closeNotify = closeNotify;</span><br><span class="line">        System.out.println(<span class="string">"æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š"</span> + socket.getInetAddress() + <span class="string">"portï¼š"</span> + socket.getPort());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String str)</span> </span>{</span><br><span class="line">        serverWriterHandle.send(str);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»å¤–ç•Œå…³é—­</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>{</span><br><span class="line">        serverReadHandler.stopRead();</span><br><span class="line">        serverWriterHandle.stopWriter();</span><br><span class="line">        CloseUtils.close(socket);</span><br><span class="line">        System.out.println(<span class="string">"å®¢æˆ·ç«¯å·²ç»é€€å‡º"</span>);</span><br><span class="line">        System.out.println(<span class="string">"address:"</span> + socket.getInetAddress() + <span class="string">",port:"</span> + socket.getPort());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªæˆ‘å…³é—­--->è‡ªé—­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopByMyself</span><span class="params">()</span> </span>{</span><br><span class="line">        stop();</span><br><span class="line">        closeNotify.onSelfClosed(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯»å–å¹¶æ‰“å°åˆ°å±å¹•(å¯åŠ¨ClientReadHandleçº¿ç¨‹)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read2Print</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">new</span> Thread(serverReadHandler).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  å°†å·²ç»å…³é—­çš„handleæš´éœ²ç»™TCPServerç„¶åä»listä¸­ç§»é™¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CloseNotify</span></span>{</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onSelfClosed</span><span class="params">(ClientHandler clientHandler)</span></span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœåŠ¡ç«¯ç”¨äºè¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯çš„ Handle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ServerReadHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> InputStream inputStream;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServerReadHandler</span><span class="params">(InputStream inputStream)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.inputStream = inputStream;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="comment">//è¾“å…¥æµè·å–ä¿¡æ¯</span></span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">                <span class="keyword">do</span> {</span><br><span class="line">                    String s = reader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (s == <span class="keyword">null</span>) {</span><br><span class="line">                        System.out.println(<span class="string">"å®¢æˆ·ç«¯å·²ç»æ— æ³•å‘é€æ•°æ®"</span>);</span><br><span class="line">                        <span class="comment">//ç»“æŸå½“å‰Handle</span></span><br><span class="line">                        ClientHandler.<span class="keyword">this</span>.stopByMyself();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">//æ‰“å°åˆ°å±å¹•</span></span><br><span class="line">                    System.out.println(s);</span><br><span class="line">                } <span class="keyword">while</span> (!done);</span><br><span class="line">            } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                <span class="keyword">if</span> (!done) {</span><br><span class="line">                    <span class="comment">//éæ­£å¸¸å…³é—­</span></span><br><span class="line">                    System.err.println(<span class="string">"è¿æ¥å¼‚å¸¸æ–­å¼€"</span>+e.getMessage());</span><br><span class="line">                    ClientHandler.<span class="keyword">this</span>.stopByMyself();</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                CloseUtils.close(inputStream);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopRead</span><span class="params">()</span> </span>{</span><br><span class="line">            done = <span class="keyword">true</span>;</span><br><span class="line">            CloseUtils.close(inputStream);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„Handle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ServerWriterHandler</span>  </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> PrintStream printStream;</span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServerWriterHandler</span><span class="params">(OutputStream outputStream)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.printStream = <span class="keyword">new</span> PrintStream(outputStream);</span><br><span class="line">            <span class="comment">//å•ä¾‹çº¿ç¨‹æ± </span></span><br><span class="line">            executorService = Executors.newSingleThreadExecutor();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String str)</span> </span>{</span><br><span class="line">            <span class="comment">//è¿™é‡Œå¦‚æœä¸ç”¨çº¿ç¨‹æ± </span></span><br><span class="line">            executorService.submit(<span class="keyword">new</span> WriteRunnable(str));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ± çš„Runnable</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">WriteRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">WriteRunnable</span><span class="params">(String msg)</span> </span>{</span><br><span class="line">                <span class="keyword">this</span>.msg = msg;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">if</span>(ServerWriterHandler.<span class="keyword">this</span>.done){</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    ServerWriterHandler.<span class="keyword">this</span>.printStream.println(msg);</span><br><span class="line">                }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">                    System.out.println(<span class="string">"write å¼‚å¸¸é€€å‡ºï¼š"</span>+e.getMessage());</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopWriter</span><span class="params">()</span> </span>{</span><br><span class="line">            done = <span class="keyword">true</span>;</span><br><span class="line">            CloseUtils.close(printStream);</span><br><span class="line">            executorService.shutdownNow();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å®Œæ•´ä»£ç æ”¾åœ¨ <a href="https://github.com/imlgw/socketDemo" target="_blank" rel="noopener">github</a> æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç”¨äº†ä¸€ä¸ªå•çº¿ç¨‹æ± å»å¤„ç†æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œè¿™é‡Œå…¶å®ç”¨çº¿ç¨‹é€šä¿¡æœºåˆ¶<code>wait/notify</code>ä¹Ÿå¯ä»¥åšåˆ°ä½†æ˜¯ç›¸æ¯”ä½¿ç”¨çº¿ç¨‹æ± ä¼šå¤æ‚è®¸å¤šã€‚</p><h3 id="å±€åŸŸç½‘èŠå¤©å®¤å®ç°"><a href="#å±€åŸŸç½‘èŠå¤©å®¤å®ç°" class="headerlink" title="å±€åŸŸç½‘èŠå¤©å®¤å®ç°"></a>å±€åŸŸç½‘èŠå¤©å®¤å®ç°</h3><blockquote><p>è¿™é‡Œçš„èŠå¤©å®¤ï¼Œå…¶å®å…³é”®çš„åœ°æ–¹å°±åœ¨äºå¯¹å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯äº¤ç”±æœåŠ¡ç«¯è¿›è¡Œè½¬å‘ã€‚</p></blockquote><p>åŸºäºä¸Šé¢çš„è¿›è¡Œæ”¹é€ </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å›è°ƒæ¥å£</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClientHandleCallBack</span> </span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å°†å·²ç»å…³é—­çš„handleæš´éœ²ç»™TCPServerç„¶åä»listä¸­ç§»é™¤</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onSelfClosed</span><span class="params">(ClientHandler clientHandler)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å°†æ¶ˆæ¯äº¤ç»™æœåŠ¡å™¨è½¬å‘</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> clientHandler</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onNewMessageArrived</span><span class="params">(ClientHandler clientHandler,String msg)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¢åŠ ä¸€ä¸ªæ¶ˆæ¯æŠµè¾¾çš„æ¥å£ï¼Œç„¶åä¸ºäº†é¿å…é˜»å¡äº¤ç»™å¼‚æ­¥çš„å•çº¿ç¨‹æ± å»å¤„ç†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNewMessageArrived</span><span class="params">(ClientHandler clientHandler, String msg)</span> </span>{</span><br><span class="line">       System.out.println(<span class="string">"Receive from:"</span>+clientHandler.getClientInfo()+<span class="string">" msg:"</span>+msg);</span><br><span class="line">       forwardThreadPool.submit(()->{</span><br><span class="line">           <span class="keyword">for</span> (ClientHandler clientHandle : clientHandles) {</span><br><span class="line">               <span class="comment">//è·³è¿‡è‡ªå·±</span></span><br><span class="line">               <span class="keyword">if</span>(clientHandle.equals(clientHandler)){</span><br><span class="line">                   <span class="keyword">continue</span>;</span><br><span class="line">               }</span><br><span class="line">               <span class="comment">//å¯¹å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">               clientHandle.send(msg);</span><br><span class="line">           }</span><br><span class="line">       });</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div><p>è¯¦ç»†ä»£ç  è§<a href="https://github.com/imlgw/socketDemo" target="_blank" rel="noopener">Github</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Socket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JMeterå‹æµ‹</title>
      <link href="/2019/06/06/jmeter-ya-ce-gong-ju/"/>
      <url>/2019/06/06/jmeter-ya-ce-gong-ju/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="JMeterå…¥é—¨"><a href="#JMeterå…¥é—¨" class="headerlink" title="JMeterå…¥é—¨"></a>JMeterå…¥é—¨</h2><p><a href="http://jmeter.apache.org/" target="_blank" rel="noopener">å®˜ç½‘åœ°å€</a> ä¸‹è½½å¥½ä¹‹åç›´æ¥è¿è¡ŒjaråŒ… </p><h3 id="ç®€å•ä¸Šæ‰‹"><a href="#ç®€å•ä¸Šæ‰‹" class="headerlink" title="ç®€å•ä¸Šæ‰‹"></a>ç®€å•ä¸Šæ‰‹</h3><p><strong>æ·»åŠ çº¿ç¨‹ç»„</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190529/wBWwVD5chqtc.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è®¾ç½®çº¿ç¨‹ä¸ªæ•°å’Œé…ç½®</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190529/KonWE6pHVdMz.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>Ramp-Upå°±æ˜¯å¤šé•¿æ—¶é—´å†…å¯åŠ¨è¿™äº›çº¿ç¨‹è®¾ç½®ä½0å°±æ˜¯åŒæ—¶å¯åŠ¨ã€‚</p><p><strong>è®¾ç½®HTTPè¯·æ±‚é»˜è®¤å€¼</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190529/73A4su1jMAWM.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è®¾ç½®å¥½åå†æ·»åŠ å…·ä½“çš„è¯·æ±‚çš„æ—¶å€™å°±ä¸ç”¨å†å†™è¿™ä¸ªäº†</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190529/Uwy5zrWzFsji.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>æ·»åŠ HTTPè¯·æ±‚</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190529/iVbmgkdG7D88.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™é‡Œå¯¹æˆ‘ä»¬çš„ç§’æ€å•†å“åˆ—è¡¨è¿›è¡Œå‹æµ‹ã€‚</p><p><strong>æ·»åŠ ç›‘å¬å™¨</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190529/yVm6imNhWYKe.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™é‡Œæ·»åŠ æ¯”è¾ƒå¸¸ç”¨çš„èšåˆæŠ¥å‘Šå°±å¯ä»¥äº†</p><p><strong>ç»“æœ</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190531/C3pwAwyh7BhG.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥éœ€è¦å…³æ³¨çš„å°±æ˜¯ååé‡è¿™ä¸ªå‚æ•°ï¼Œä¸€å¼€å§‹å¯èƒ½ä¼šä¸å¤ªå‡†å¤šæµ‹å‡ æ¬¡ã€‚</p><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨Linuxçš„<code>top</code>å‘½ä»¤æŸ¥çœ‹å½“å‰CPUçš„åˆ©ç”¨ç‡ã€‚</p><h3 id="æ·»åŠ è‡ªå®šä¹‰å‚æ•°"><a href="#æ·»åŠ è‡ªå®šä¹‰å‚æ•°" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰å‚æ•°"></a>æ·»åŠ è‡ªå®šä¹‰å‚æ•°</h3><p><img alt="mark" data-src="http://static.imlgw.top/image/20190601/VQ9adD8KBfvA.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190601/j1XB0mewqvJG.png?imageslim" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">17362363659</span>,<span class="number">3</span>d3ae96d381d4376b87cb7ebf14aadb6</span><br><span class="line"><span class="number">12012341234</span>,fbb11e35f16b4a54be1315a0a1619193</span><br><span class="line"><span class="number">11012341234</span>,<span class="number">58</span>d63f1d9482472f907829da2ae3b4ff</span><br><span class="line"><span class="number">10012341234</span>,<span class="number">09f</span>e09587b924c49b6db64f763c1ad10</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ•ˆæœ</strong></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190601/5up85aDbSTWM.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="ç”Ÿæˆtoken"><a href="#ç”Ÿæˆtoken" class="headerlink" title="ç”Ÿæˆtoken"></a>ç”Ÿæˆtoken</h3><p>æ–¹ä¾¿åé¢çš„å‹æµ‹ï¼Œå¯ä»¥ç›´æ¥å†™ä¸€ä¸ªå·¥å…·ç±»ç”Ÿæˆtokenä¾›åé¢çš„redisä½¿ç”¨</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">TokenUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpikeUserService spikeUserService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String str=<span class="string">"0123456789"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>  Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> HttpServletResponse resp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        FileOutputStream outputStream=<span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"D:\\AliyunKey\\config.txt"</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">20000</span>;i++){</span><br><span class="line">            String phone = creatPhone();</span><br><span class="line">            RegisterVo registerVo = <span class="keyword">new</span> RegisterVo(phone,<span class="string">"123456"</span>,<span class="string">"user-"</span>+i);</span><br><span class="line">            spikeUserService.register(registerVo);</span><br><span class="line">            <span class="comment">//éœ€è¦åœ¨serviceå±‚tokenè¿”å›å‡ºæ¥</span></span><br><span class="line">            String token= spikeUserService.login(resp, <span class="keyword">new</span> LoginVo(registerVo.getMobile(), registerVo.getPassword()));</span><br><span class="line">            outputStream.write((phone+<span class="string">","</span>+token+<span class="string">"\n"</span>).getBytes());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  String <span class="title">creatPhone</span><span class="params">()</span></span>{</span><br><span class="line">        String res=<span class="string">"1"</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">10</span>;i++){</span><br><span class="line">            res+=str.charAt(random.nextInt(<span class="number">10</span>));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Rediså‹æµ‹"><a href="#Rediså‹æµ‹" class="headerlink" title="Rediså‹æµ‹"></a>Rediså‹æµ‹</h3><p>â‘ redis-benchmark -h 127.0.0.1 -p 6379 -c 100 -n 100000</p><p>100ä¸ªå¹¶å‘ï¼Œåä¸‡ä¸ªè¯·æ±‚ï¼Œå¯¹å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤è¿›è¡Œæµ‹è¯•</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190601/oPkioXCFgL8R.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>â‘¡redis-benchmark -h 127.0.0.1 -p 6379 -q -d 100</p><p>100 bytes payload </p><p>-q æ˜¯quietè¾“å‡ºä¿¡æ¯è¾ƒå°‘</p><p>â‘¢ redis-benchmark -n 100000 -q script load â€œredis.call(â€˜setâ€™,â€™fooâ€™,â€™barâ€™)â€</p><p>å¯¹ç‰¹å®šçš„è¯­å¥å‹æµ‹</p><h2 id="æ­å»ºå‹æµ‹ç¯å¢ƒ"><a href="#æ­å»ºå‹æµ‹ç¯å¢ƒ" class="headerlink" title="æ­å»ºå‹æµ‹ç¯å¢ƒ"></a>æ­å»ºå‹æµ‹ç¯å¢ƒ</h2><h3 id="å‘½ä»¤è¡Œå‹æµ‹"><a href="#å‘½ä»¤è¡Œå‹æµ‹" class="headerlink" title="å‘½ä»¤è¡Œå‹æµ‹"></a>å‘½ä»¤è¡Œå‹æµ‹</h3><p>å…¶å®è¿˜æ˜¯éœ€è¦å€ŸåŠ©å›¾å½¢ç•Œé¢æ¥å½•å¥½jmxæ–‡ä»¶ç„¶åä¸Šä¼ åˆ°Linuxä¸Šï¼Œç„¶åæ‰§è¡Œ</p><p>sh jmeter.sh -n -t Xxx.jmx -l result.jtl</p><p>ç„¶åå†ç”¨å›¾å½¢ç•Œé¢å¯¼å…¥result.jtlå°±å¯ä»¥çœ‹åˆ°ç»“æœ</p><blockquote><p>ä¸Šé¢çš„æµ‹è¯•éƒ½æ˜¯åœ¨æˆ‘çš„å¼€å‘æœº(win)ä¸Šè¿›è¡Œçš„ï¼Œå‹æµ‹å’ŒæœåŠ¡éƒ½åœ¨æœ¬åœ°ï¼Œç»“æœå¯èƒ½å¹¶ä¸å‡†ç¡®ï¼Œè¿™é‡Œä¸ºäº†éš”ç¦»ç¯å¢ƒæˆ‘å¼€äº†äº†2ä¸ªè™šæ‹Ÿæœºï¼Œä¸€ä¸ªæ˜¯éƒ¨ç½²æœåŠ¡çš„æœºå™¨ï¼ˆ2G 4æ ¸ï¼‰ï¼Œä¸€ä¸ªæ˜¯éƒ¨ç½²mysqlå’Œredisçš„æœºå™¨ï¼ˆ2G 4æ ¸ï¼‰ï¼Œè¿™é‡Œåœ¨Linuxä¸Šè¿è¡Œéƒ¨ç½²é¡¹ç›®æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æ‰“æˆwaråŒ…æ”¾åœ¨tomcatç›®å½•ä¸‹ï¼Œä¸€ç§æ˜¯æ‰“æˆjaråŒ…ç›´æ¥è¿è¡Œã€‚</p></blockquote><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>âœ” 192.168.25.123   Centos6  mysql+redis  2G4æ ¸</p><p>âœ” 192.168.25.4     Centos7   SpikeServer+å‹æµ‹  2.5G 4æ ¸</p><p>âœ”<del>win10å¼€å‘æœº     Jmeterå‹æµ‹ SpikeServer</del> </p><p>âœ”<del>192.168.25.129 Centos7 å‹æµ‹è®¾å¤‡ 2G4æ ¸</del></p><h3 id="SpringBootæ‰“waråŒ…"><a href="#SpringBootæ‰“waråŒ…" class="headerlink" title="SpringBootæ‰“waråŒ…"></a>SpringBootæ‰“waråŒ…</h3><p><strong>æ·»åŠ tomcatä¾èµ–(ç¼–è¯‘æ—¶ä¾èµ–)</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>org.springframework.boot</groupid></span><br><span class="line">    <artifactid>spring-boot-starter-tomcat</artifactid></span><br><span class="line"><scope>provided</scope></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ·»åŠ ä¸€ä¸ªmavenæ’ä»¶</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><plugin></plugin></span><br><span class="line">    <groupid>org.apache.maven.plugins</groupid></span><br><span class="line">    <artifactid>maven-war-plugin</artifactid></span><br><span class="line"><configuration></configuration></span><br><span class="line">    <failonmissingwebxml>false</failonmissingwebxml></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ä¿®æ”¹pomæ‰“åŒ…æ–¹å¼ä½war</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><packaging>war</packaging></span><br></pre></td></tr></tbody></table></figure></div><p><strong>bootç±»æ·»åŠ ä¸€ä¸ªæ–¹æ³•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpikeApplication</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(SpikeApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰“ waråŒ…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder builder)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> builder.sources(SpikeApplication<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç„¶ååœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ<code>mvn clean package</code>å°±ä¼šåœ¨targetç›®å½•ä¸‹ç”ŸæˆwaråŒ…ï¼Œç„¶åå°†waråŒ…æ‹·åˆ°tomcaté‡Œé¢å°±å¯ä»¥ç›´æ¥è¿è¡Œäº†ã€‚</p><h3 id="SpringBootæ‰“jaråŒ…"><a href="#SpringBootæ‰“jaråŒ…" class="headerlink" title="SpringBootæ‰“jaråŒ…"></a>SpringBootæ‰“jaråŒ…</h3><p><strong>pomé‡Œçš„æ‰“åŒ…æ–¹å¼æ”¹ä¸ºjar(é»˜è®¤å°±æ˜¯jar)</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><packaging>war</packaging></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ·»åŠ ä¸€ä¸ªmavenæ’ä»¶</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!--æ‰“jaråŒ…çš„æ’ä»¶--></span><br><span class="line"><plugin></plugin></span><br><span class="line">    <groupid>org.springframework.boot</groupid></span><br><span class="line"><artifactid>spring-boot-maven-plugin</artifactid></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p><strong>æ‰§è¡Œmvn clean package</strong></p><p>åŒä¸Šä¼šåœ¨targetç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªjaråŒ…ï¼ŒjaråŒ…å†…å®¹å¤§è‡´å¦‚ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Manifest-Version: <span class="number">1.0</span></span><br><span class="line">Implementation-Title: Spike</span><br><span class="line">Implementation-Version: <span class="number">1.0</span>-SNAPSHOT</span><br><span class="line">Built-By: priva</span><br><span class="line">Implementation-Vendor-Id: top.imlgw</span><br><span class="line">Spring-Boot-Version: <span class="number">2.1</span><span class="number">.2</span>.RELEASE</span><br><span class="line">Main-Class: org.springframework.boot.loader.JarLauncher</span><br><span class="line">Start-Class: top.imlgw.spike.SpikeApplication</span><br><span class="line">Spring-Boot-Classes: BOOT-INF/classes/</span><br><span class="line">Spring-Boot-Lib: BOOT-INF/lib/</span><br><span class="line">Created-By: Apache Maven <span class="number">3.5</span><span class="number">.3</span></span><br><span class="line">Build-Jdk: <span class="number">1.8</span><span class="number">.0_172</span></span><br><span class="line">Implementation-URL: https:<span class="comment">//projects.spring.io/spring-boot/#/spring-bo</span></span><br><span class="line"> ot-starter-parent/Spike</span><br></pre></td></tr></tbody></table></figure></div><p>å¦‚æœç¡®å°‘ä¸€äº›ä¿¡æ¯æ¯”å¦‚Main-Classå’ŒStart-Classï¼Œè¯´æ˜jaråŒ…æ‰“çš„æœ‰é—®é¢˜ï¼Œè¿è¡Œä¼šæŠ¥<code>æ²¡æœ‰ä¸»æ¸…å•å±æ€§</code>ï¼Œæˆ‘ä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œæˆ‘çš„<code>plugins</code>ä¸Šå±‚è¿˜æœ‰ä¸ª<code>pluginmanagement</code>æ’ä»¶æ ¹æœ¬æ²¡åŠ è½½è¿›æ¥ï¼Œå»æ‰å°±è¡Œäº†ã€‚</p><h2 id="å¼€å§‹å‹æµ‹"><a href="#å¼€å§‹å‹æµ‹" class="headerlink" title="å¼€å§‹å‹æµ‹"></a>å¼€å§‹å‹æµ‹</h2><h3 id="å‹æµ‹å•†å“åˆ—è¡¨é¡µé¢"><a href="#å‹æµ‹å•†å“åˆ—è¡¨é¡µé¢" class="headerlink" title="å‹æµ‹å•†å“åˆ—è¡¨é¡µé¢"></a>å‹æµ‹å•†å“åˆ—è¡¨é¡µé¢</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/to_list"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">tolist</span><span class="params">(Model model,SpikeUser spikeUser)</span> </span>{</span><br><span class="line">    List<goodsvo> goodsVos = goodsService.goodsVoList();</goodsvo></span><br><span class="line">    model.addAttribute(<span class="string">"user"</span>, spikeUser);</span><br><span class="line">    model.addAttribute(<span class="string">"goodsList"</span>,goodsVos);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"goods_list"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªæ¥å£ä¸»è¦å°±åšäº†ä¸€ä¸ªæŸ¥è¯¢çš„mysqlçš„æ“ä½œï¼Œæ²¡æœ‰cookieæ‰€ä»¥ä¸ä¼šå»æ“ä½œredis</p><h3 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h3><p>ä¸€å¼€å§‹ç›´æ¥è®¾ç½®äº† 5000*10 çš„å¹¶å‘ï¼Œç„¶åæœåŠ¡ç«¯æŠ¥äº†   æ‰“å¼€æ–‡ä»¶è¿‡å¤šçš„é”™è¯¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">java.io.IOException: æ‰“å¼€çš„æ–‡ä»¶è¿‡å¤š</span><br><span class="line">        at sun.nio.ch.ServerSocketChannelImpl.accept0(Native Method) ~[na:<span class="number">1.8</span><span class="number">.0_171</span>]</span><br><span class="line">        at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:<span class="number">422</span>) ~[na:<span class="number">1.8</span><span class="number">.0_171</span>]</span><br><span class="line">        at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:<span class="number">250</span>) ~[na:<span class="number">1.8</span><span class="number">.0_171</span>]</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint.serverSocketAccept(NioEndpoint.java:<span class="number">448</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.14</span>.jar!/:<span class="number">9.0</span><span class="number">.14</span>]</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint.serverSocketAccept(NioEndpoint.java:<span class="number">70</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.14</span>.jar!/:<span class="number">9.0</span><span class="number">.14</span>]</span><br><span class="line">        at org.apache.tomcat.util.net.Acceptor.run(Acceptor.java:<span class="number">95</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.14</span>.jar!/:<span class="number">9.0</span><span class="number">.14</span>]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">748</span>) [na:<span class="number">1.8</span><span class="number">.0_171</span>]</span><br></pre></td></tr></tbody></table></figure></div><p>googleåå‘ç°æ˜¯å¥æŸ„å¤ªå°‘çš„åŸå› ï¼ŒLinuxé»˜è®¤æ˜¯1024ï¼Œè€Œæˆ‘ä»¬åŒæ—¶èµ·äº†5000ä¸ªçº¿ç¨‹è‡ªç„¶å°±å‡ºé—®é¢˜äº†ã€‚</p><p>é€šè¿‡<code>ulimit -a</code> å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰çš„æœ€å¤§å¥æŸ„æ•°<code>open files</code> ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>ulimit -n 2048</code>ä¸´æ—¶çš„è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼Œä½†æ˜¯é‡å¯åå°±ä¼šå¤±æ•ˆã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">core file <span class="title">size</span>          <span class="params">(blocks, -c)</span> 0</span></span><br><span class="line"><span class="function">data seg <span class="title">size</span>           <span class="params">(kbytes, -d)</span> unlimited</span></span><br><span class="line"><span class="function">scheduling <span class="title">priority</span>             <span class="params">(-e)</span> 0</span></span><br><span class="line"><span class="function">file <span class="title">size</span>               <span class="params">(blocks, -f)</span> unlimited</span></span><br><span class="line"><span class="function">pending <span class="title">signals</span>                 <span class="params">(-i)</span> 14707</span></span><br><span class="line"><span class="function">max locked <span class="title">memory</span>       <span class="params">(kbytes, -l)</span> 64</span></span><br><span class="line"><span class="function">max memory <span class="title">size</span>         <span class="params">(kbytes, -m)</span> unlimited</span></span><br><span class="line"><span class="function">open <span class="title">files</span>                      <span class="params">(-n)</span> 1024</span></span><br><span class="line"><span class="function">pipe <span class="title">size</span>            <span class="params">(<span class="number">512</span> bytes, -p)</span> 8</span></span><br><span class="line"><span class="function">POSIX message <span class="title">queues</span>     <span class="params">(bytes, -q)</span> 819200</span></span><br><span class="line"><span class="function">real-time <span class="title">priority</span>              <span class="params">(-r)</span> 0</span></span><br><span class="line"><span class="function">stack <span class="title">size</span>              <span class="params">(kbytes, -s)</span> 8192</span></span><br><span class="line"><span class="function">cpu <span class="title">time</span>               <span class="params">(seconds, -t)</span> unlimited</span></span><br><span class="line"><span class="function">max user <span class="title">processes</span>              <span class="params">(-u)</span> 14707</span></span><br><span class="line"><span class="function">virtual <span class="title">memory</span>          <span class="params">(kbytes, -v)</span> unlimited</span></span><br><span class="line"><span class="function">file <span class="title">locks</span>                      <span class="params">(-x)</span> unlimited</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæœ€å¥½æ˜¯ç›´æ¥ä¿®æ”¹  /etc/security/limits.conf</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">*  soft nofile  <span class="number">32768</span></span><br><span class="line">*  hard nofile <span class="number">65536</span></span><br></pre></td></tr></tbody></table></figure></div><p>å°±å¯ä»¥å°†æ–‡ä»¶å¥æŸ„é™åˆ¶ç»Ÿä¸€æ”¹æˆè½¯32768ï¼Œç¡¬65536ã€‚é…ç½®æ–‡ä»¶æœ€å‰é¢çš„æ˜¯æŒ‡domainï¼Œè®¾ç½®ä¸ºæ˜Ÿå·ä»£è¡¨å…¨å±€ï¼Œå¦å¤–ä½ ä¹Ÿå¯ä»¥é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·åšå‡ºä¸åŒçš„é™åˆ¶ã€‚</p><p>æ³¨æ„ï¼šè¿™ä¸ªå½“ä¸­çš„ç¡¬é™åˆ¶æ˜¯å®é™…çš„é™åˆ¶ï¼Œè€Œè½¯é™åˆ¶ï¼Œæ˜¯warnningé™åˆ¶ï¼Œåªä¼šåšå‡ºwarningï¼Œå…¶å®ulimitå‘½ä»¤æœ¬èº«å°±æœ‰åˆ†è½¯ç¡¬è®¾ç½®ï¼ŒåŠ -Hå°±æ˜¯ç¡¬ï¼ŒåŠ -Så°±æ˜¯è½¯</p><p>ä¿®æ”¹åè®°å¾—é‡å¯æ‰ä¼šç”Ÿæ•ˆ <a href="https://www.cnblogs.com/ibook360/archive/2012/05/11/2495405.html" target="_blank" rel="noopener">å‚è€ƒèµ„æ–™</a> </p><p>ä¸€å¼€å§‹æ˜¯æ‰“ç®—ç›´æ¥ç”¨winå¼€å‘æœºåšå‹æµ‹çš„ï¼Œä½†æ˜¯å‘ç°åœ¨è¿›ç¨‹å¼€å¤§äº†ä¹‹åè€æ˜¯è·‘ä¸å®Œï¼Œè·‘ä¸€åŠå°±åœäº†ï¼ˆå¯èƒ½æ˜¯å†…å­˜ç»™å°äº†ï¼‰ï¼Œè€Œä¸”æ•°æ®å‡ºå…¥ä¹Ÿæ¯”è¾ƒå¤§ï¼Œç„¶åæ”¹ç”¨ç§’æ€æœåŠ¡çš„é‚£æ¡æœºå™¨æ¥å‹æµ‹ï¼Œä¸€å¼€å§‹åªå¢å¤§äº†è·‘ç§’æ€æœåŠ¡çš„è™šæ‹Ÿæœºï¼Œå‘ç°è¿˜æ˜¯ä¼šæœ‰å¼‚å¸¸ï¼Œç„¶åæˆ‘æŠŠmysqlå’Œredisçš„è™šæ‹Ÿæœºä¹Ÿè°ƒå¤§äº†å°±æ²¡æŠ¥å¼‚å¸¸äº†ï¼Œä½†æ˜¯åœ¨å‹æµ‹çš„æ—¶å€™ç§’æ€æœåŠ¡çš„è™šæ‹Ÿæœºcpué£™åˆ°äº† <code>9.0+</code>ï¼Œ4æ ¸çš„æœºå­ï¼Œcpué£™åˆ°è¿™ä¹ˆé«˜å°±æœ‰ç‚¹é—®é¢˜äº†ä¸€èˆ¬æ¥è¯´åº”è¯¥ç»´æŒåœ¨ <code>4*0.7</code> å·¦å³ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190604/LedMcRvfSXeb.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190604/UbcTCaTGiEJ9.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å¯ä»¥çœ‹åˆ°å¹³å‡ç­‰å¾…æ—¶é—´éƒ½åœ¨2sä»¥ä¸Šã€‚</p><p>ä¸ºäº†æ›´å‡†ç¡®çš„æ¨¡æ‹Ÿï¼Œæˆ‘åˆå¼€äº†ä¸€å°<del>1G2æ ¸</del> 2G4æ ¸çš„è™šæ‹Ÿæœºä¸“é—¨æ¥åšå‹æµ‹ï¼ˆ8Gå†…å­˜åƒä¸æ¶ˆäº†ï¼‰ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190604/pr4yMAE2Jamf.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™é‡Œç”¨topè§‚å¯Ÿäº†ä¸¤å°è™šæ‹Ÿæœºçš„æƒ…å†µå‘ç°mysqlçš„é‚£å°æœºå™¨è´Ÿè½½ä¸€ç›´å¾ˆä½ï¼ŒSpikeServeré‚£å°æœºå™¨ï¼ˆ1GåŒæ ¸ï¼‰è´Ÿè½½ä¸€è·¯é£™åˆ°6.0+ã€‚ååç‡ä¹Ÿæ˜æ˜¾çš„ä¸‹é™äº†ï¼Œè¿™é‡Œæˆ‘è¿ç»­æµ‹è¯•äº†ä¸¤æ¬¡éƒ½æ˜¯400å¤šã€‚</p><h3 id="æœ€ç»ˆé…ç½®"><a href="#æœ€ç»ˆé…ç½®" class="headerlink" title="æœ€ç»ˆé…ç½®"></a>æœ€ç»ˆé…ç½®</h3><p>ç»è¿‡ä¸€ä¸Šåˆçš„æŠ˜è…¾ï¼Œæˆ‘å†³å®šè¿˜æ˜¯å€¼åˆ©ç”¨ä¸¤å°ä½ è™šæ‹Ÿæœºï¼Œä¸€å°è·‘SpikeServerå’Œå‹æµ‹ï¼Œå¦å¤–ä¸€å°è·‘mysqlå’Œredisï¼Œå†å¯åŠ¨ä¸€å°æˆæœ¬å¤ªå¤§äº†ï¼Œè¿™é‡Œä¸»è¦æ ¹æ®è¿™ä¸ªåšä¸€ä¸ªæ ‡å‡†é‡ï¼ŒåæœŸä¼˜åŒ–åæ‹¿æ¥å¯¹æ¯”</p><h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img alt="mark" data-src="http://static.imlgw.top/image/20190604/IEGxtWU8pujI.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>åé¢åœ¨è°ƒæ•´æœºå™¨æˆ–è¿ç»­æµ‹è¯•äº†5ï¼Œ6æ¬¡ åœ¨5000çš„å¹¶å‘ä¸‹QPSå¤§æ¦‚æ˜¯1000å·¦å³çš„æ ·å­ï¼Œå°äº1000ã€‚</p><h3 id="å‹æµ‹RedisæŸ¥è¯¢çš„æ€§èƒ½"><a href="#å‹æµ‹RedisæŸ¥è¯¢çš„æ€§èƒ½" class="headerlink" title="å‹æµ‹RedisæŸ¥è¯¢çš„æ€§èƒ½"></a>å‹æµ‹RedisæŸ¥è¯¢çš„æ€§èƒ½</h3><p>ä¸Šé¢çš„goods_listå®é™…ä¸Šåªå¯¹mysqlè¿›è¡Œäº†ä¸€ä¸ªæŸ¥è¯¢æ“ä½œï¼Œè€Œmysqlçš„å¹¶å‘é‡å¹¶ä¸å¤§ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å•ç‹¬å¯¹redisåšä¸€ä¸‹å‹æµ‹ï¼Œçœ‹ä¸‹ç³»ç»Ÿçš„QPSï¼ˆè¿™é‡Œï¼‰</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190604/h2NOJszwC7Lo.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h4 id="ç»“æœ-1"><a href="#ç»“æœ-1" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p>ä¸€å¼€æµ‹è¯•å¿˜äº†è°ƒå¤§redisé“¾æ¥æ± çš„å¤§å°ï¼Œä¸€ç›´è·‘ä¸å‡ºæ¥ï¼Œåæ¥æ”¹å¤§ä¹‹åæµ‹äº†4ï¼Œ5æ¬¡ï¼ŒåŒæ ·çš„5000å¹¶å‘10æ¬¡ï¼ŒQPSå¤§æ¦‚åœ¨3000å·¦å³</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190606/58L5ieKaxR7a.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å¯ä»¥è¯´æ˜¯ç›¸å½“å¿«äº†ï¼Œè€Œä¸”<code>top</code>è§‚å¯Ÿredisé‚£å°æœºå™¨å‘ç°è´Ÿè½½ä¾ç„¶å¾ˆä½ï¼Œè¯´æ˜è¿™ç‚¹å¹¶å‘ç¡®å®å¯¹redisæ¥è¯´æ˜¯å°æ„æ€ï¼Œå‰é¢å…¶å®ä¹Ÿå•ç‹¬å¯¹redisç”¨å®ƒè‡ªå¸¦çš„å‹æµ‹å·¥å…·æµ‹è¯•è¿‡ï¼Œå¤§æ¦‚æ¯ç§’10 0000çš„GETæ˜¯æ²¡é—®é¢˜çš„</p><h3 id="é‡å¤´æˆâ€”å‹æµ‹do-spikeæ¥å£"><a href="#é‡å¤´æˆâ€”å‹æµ‹do-spikeæ¥å£" class="headerlink" title="é‡å¤´æˆâ€”å‹æµ‹do_spikeæ¥å£"></a>é‡å¤´æˆâ€”å‹æµ‹do_spikeæ¥å£</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/do_spike"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">do_spike</span><span class="params">(Model model, SpikeUser spikeUser, @RequestParam(<span class="string">"goodsId"</span>)</span> <span class="keyword">long</span> goodsId) </span>{</span><br><span class="line">       <span class="keyword">if</span> (spikeUser==<span class="keyword">null</span>) { <span class="comment">//æ²¡æœ‰ç™»å½•</span></span><br><span class="line">           <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">       }</span><br><span class="line">       <span class="comment">//æ£€æŸ¥åº“å­˜</span></span><br><span class="line">       GoodsVo goodsVo= goodsService.getGoodsVoByGoodsId(goodsId);</span><br><span class="line">       <span class="keyword">int</span> stock=goodsVo.getStockCount(); <span class="comment">//è¿™é‡Œæ‹¿çš„ç§’æ€å•†å“é‡Œé¢çš„åº“å­˜,ä¸æ˜¯å•†å“é‡Œé¢çš„åº“å­˜</span></span><br><span class="line">       <span class="keyword">if</span>(stock<=<span class="number">0</span>){</span><br><span class="line">           model.addAttribute(<span class="string">"failMsg"</span>,CodeMsg.STOCK_EMPTY);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"spike_fail"</span>;</span><br><span class="line">       }</span><br><span class="line">       <span class="comment">//çœ‹æ˜¯å¦é‡å¤ç§’æ€</span></span><br><span class="line">       SpikeOrder spikeOrder=spikeService.getGoodsVoByUserIdAndGoodsId(spikeUser.getId(), goodsId);</span><br><span class="line">       <span class="keyword">if</span>(spikeOrder!=<span class="keyword">null</span>){</span><br><span class="line">           model.addAttribute(<span class="string">"failMsg"</span>,CodeMsg.SKIPE_REPEAT);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"spike_fail"</span>;</span><br><span class="line">       }</span><br><span class="line">       OrderInfo orderInfo=spikeService.doSpike(spikeUser.getId(),goodsVo);</span><br><span class="line">       model.addAttribute(<span class="string">"orderInfo"</span>,orderInfo);</span><br><span class="line">       model.addAttribute(<span class="string">"goods"</span>,goodsVo);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"order_detail"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ­¥éª¤éƒ½è·Ÿä¸Šé¢ä¸€æ ·ï¼Œä¸è¿‡è¦å¤šåŠ ä¸€ä¸ªå•†å“idçš„å‚æ•°ï¼Œè¿™é‡Œä¾ç„¶æ˜¯5000çš„å¹¶å‘10æ¬¡ï¼Œå…¶å®è¿™é‡Œæµ‹å‡ºæ¥çš„ç»“æœå’Œä¸Šé¢çš„å•†å“åˆ—è¡¨å·®ä¸å¤ªå¤šï¼Œå·®ä¸å¤š950å·¦å³QPSï¼Œæ¯•ç«Ÿè¿™é‡Œæœ‰åˆ¤æ–­åº“å­˜çš„æ“ä½œï¼Œä¸€æ—¦å°äº0ä¹‹åå°±ä¸ä¼šå¯¹mysqlå†è¿›è¡Œæ“ä½œï¼Œè¿›è¡Œå¤æ‚çš„<strong>å‡åº“å­˜</strong>å’Œ<strong>ç”Ÿæˆè®¢å•</strong>æ“ä½œ</p><h4 id="è¶…å–é—®é¢˜"><a href="#è¶…å–é—®é¢˜" class="headerlink" title="è¶…å–é—®é¢˜"></a>è¶…å–é—®é¢˜</h4><p>æœ¬æ¥åªæœ‰10ä»¶å•†å“ï¼Œç¡¬ç”Ÿç”Ÿç»™å‡æˆäº†è´Ÿæ•°ğŸ˜‚</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190606/m5RhIzmdXRV1.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å¯ä»¥çœ‹åˆ°æœ‰16ä¸ªäººç§’æ€åˆ°äº†è¿™ä¸ªå•†å“è¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190606/nJmnvKvVzAHt.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™ä¸ªé—®é¢˜ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­æå‡ºè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸€ç¯‡ä¸»è¦ç†Ÿæ‚‰ä¸‹å‹æµ‹ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JMeter </tag>
            
            <tag> ç§’æ€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebMvcConfigurerå°ç»“</title>
      <link href="/2019/05/20/webmvcconfigurer/"/>
      <url>/2019/05/20/webmvcconfigurer/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h2><p>åˆ©ç”¨Redisåšåˆ†å¸ƒå¼sessionï¼Œå› ä¸ºæ²¡æœ‰å€ŸåŠ©Spring-sessionæˆ–è€…å…¶ä»–çš„sessionå…±äº«æ–¹æ¡ˆï¼Œæ‰‹åŠ¨å¤„ç†sessionçš„å­˜å–ï¼Œåœ¨æ§åˆ¶å±‚è·å–cookieä¸­çš„æ•°æ®æ˜¯è¾ƒä¸ºéº»çƒ¦ï¼Œæ‰€ä»¥å¸Œæœ›ç›´æ¥å°†cookieçš„æ•°æ®è½¬åŒ–ä¸ºéœ€è¦çš„beanç„¶åç»‘å®šåˆ°å‚æ•°ä¸­ï¼Œè¿™é‡Œå°±å¯ä»¥å€ŸåŠ©<strong>WebMvcConfigurer</strong>æ¥å®ç°è¿™ä¸ªéœ€æ±‚ç®€åŒ–ä»£ç </p><h2 id="WebMvcConfigureræ˜¯å¹²å˜›çš„ï¼Ÿ"><a href="#WebMvcConfigureræ˜¯å¹²å˜›çš„ï¼Ÿ" class="headerlink" title="WebMvcConfigureræ˜¯å¹²å˜›çš„ï¼Ÿ"></a>WebMvcConfigureræ˜¯å¹²å˜›çš„ï¼Ÿ</h2><p>SpringæŠŠå®ç°äº†WebMvcConfigureræ¥å£çš„beanéƒ½çœ‹ä½œä¸ºSpringMvcçš„<strong>æ‰©å±•é…ç½®</strong>ï¼Œå¦‚æœæ—¢æƒ³è¦ä½¿ç”¨SpringBootå¯¹SpringMvcçš„è‡ªåŠ¨é…ç½®ï¼Œåˆæƒ³è¦å¯¹è‡ªåŠ¨é…ç½®è¿›è¡Œæ‰©å±•ï¼Œæ·»åŠ ä¸€äº›ç”¨æˆ·è‡ªå·±çš„é…ç½®ï¼Œåƒæ‹¦æˆªå™¨ï¼Œæ¶ˆæ¯è½¬æ¢å™¨æˆ–è€…ä¸‹æ–‡ä¸­çš„å‚æ•°ç»‘å®šï¼Œåªéœ€è¦å†™ä¸€ä¸ªå®ç°äº†WebMvcConfigureræ¥å£çš„é…ç½®ç±»ï¼Œå®ç°ç›¸å…³æ–¹æ³•å°±èƒ½å¤Ÿæ·»åŠ è‡ªå·±çš„é…ç½®äº†ã€‚</p><blockquote><p>SpringBoot2.0ä¹‹å‰ä¹Ÿå°±æ˜¯Spring5ä¹‹å‰å¯ä»¥ç›´æ¥ç»§æ‰¿<strong>WebMvcConfigurationAdapter</strong>+<strong>@EnableWebMvc</strong>æ³¨è§£æ¥å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•åœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­å¼ƒç”¨äº†(è¿˜å¯ä»¥ç”¨ä½†æ˜¯ä¸å¤ªå¥½)ï¼Œå› ä¸ºjdk8ä¹‹åçš„æ¥å£ä¸­å¯ä»¥æœ‰<strong>é»˜è®¤æ–¹æ³•</strong>äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæŠ½è±¡ç±»å°±å¹¶æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†</p></blockquote><h3 id="WebMvcConfigurationSupport"><a href="#WebMvcConfigurationSupport" class="headerlink" title="WebMvcConfigurationSupport"></a>WebMvcConfigurationSupport</h3><p>å…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯ç›´æ¥ç»§æ‰¿è¿™ä¸ªWebMvcConfigurationSupportï¼Œä¸Šé¢çš„WebMvcConfigureråªæ˜¯æ‰©å±•é…ç½®ï¼Œå¦‚æœç›´æ¥ç»§æ‰¿WebMvcConfigurationSupportï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡å†™é»˜è®¤çš„é…ç½®ï¼Œå¦‚æœå¯¹åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šçš„å¼€å‘è€…ä¸å°å¿ƒé‡å†™é”™äº†é»˜è®¤çš„é…ç½®ï¼Œspringmvcå¯èƒ½ç›¸å…³åŠŸèƒ½å°±æ— æ³•ç”Ÿæ•ˆã€‚</p><h2 id="WebMvcConfigurerå†…çš„æ–¹æ³•"><a href="#WebMvcConfigurerå†…çš„æ–¹æ³•" class="headerlink" title="WebMvcConfigurerå†…çš„æ–¹æ³•"></a>WebMvcConfigurerå†…çš„æ–¹æ³•</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WebMvcConfigurer</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">configureAsyncSupport</span><span class="params">(AsyncSupportConfigurer configurer)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//æ·»åŠ èµ„æºå¤„ç†å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//è§†å›¾æ§åˆ¶å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> </span>{</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//æ·»åŠ å‚æ•°è§£æå™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">addArgumentResolvers</span><span class="params">(List<handlermethodargumentresolver> resolvers)</handlermethodargumentresolver></span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">addReturnValueHandlers</span><span class="params">(List<handlermethodreturnvaluehandler> handlers)</handlermethodreturnvaluehandler></span> </span>{</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List<httpmessageconverter<?>> converters)</httpmessageconverter<?></span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List<httpmessageconverter<?>> converters)</httpmessageconverter<?></span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">configureHandlerExceptionResolvers</span><span class="params">(List<handlerexceptionresolver> resolvers)</handlerexceptionresolver></span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">extendHandlerExceptionResolvers</span><span class="params">(List<handlerexceptionresolver> resolvers)</handlerexceptionresolver></span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Validator <span class="title">getValidator</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> MessageCodesResolver <span class="title">getMessageCodesResolver</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>åœ¨<strong>SpringBoot</strong>ä¸‹è‡ªå®šä¹‰çš„WebMvcConfigurerå®ç°é…ç½®ç±»ä¸Šæ˜¯ä¸éœ€è¦æ·»åŠ <strong>@EnableWebMvc</strong>çš„ï¼Œå› ä¸º<strong>SpringBoot</strong>å·²ç»å®ä¾‹åŒ–äº†WebMvcConfigurationSupportï¼Œå¦‚æœæ·»åŠ äº†è¯¥æ³¨è§£ï¼Œé»˜è®¤çš„WebMvcConfigurationSupporté…ç½®ç±»å°±ä¼šå¤±æ•ˆï¼Œmvcé»˜è®¤çš„é…ç½®ä¼šå¤±æ•ˆï¼Œä¹Ÿå°±æ˜¯ä»¥ç”¨æˆ·å®šä¹‰çš„ä¸ºä¸»ï¼Œä¸€èˆ¬å»ºè®®è¿˜æ˜¯ä¸è¦†ç›–é»˜è®¤çš„å¥½ã€‚</p><p>è¿™ç‚¹å¯ä»¥ä»SpringBootçš„<strong>WebMvcAutoConfiguration</strong>ä¸­çœ‹åˆ°ã€‚ï¼ˆ@EnableWebMvcä¼šå¯¼å…¥ä¸€ä¸ªWebMvcConfigurationSupportçš„å­ç±»ï¼Œå« DelegatingWebMvcConfigurationï¼‰ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190520/p5I6RuWHJPMy.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å½“æ²¡æœ‰WebMvcConfigurationSupportçš„æ—¶å€™è‡ªåŠ¨é…ç½®æ‰ä¼šç”Ÿæ•ˆ</p><blockquote><p><a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-auto-configuration" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><p>If you want to keep Spring Boot MVC features and you want to add additional <a href="https://docs.spring.io/spring/docs/5.0.4.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">MVC configuration</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, you can declare a <code>WebMvcRegistrationsAdapter</code> instance to provide such components.</p></blockquote><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><h3 id="Controllerå‚æ•°ç»‘å®š"><a href="#Controllerå‚æ•°ç»‘å®š" class="headerlink" title="Controllerå‚æ•°ç»‘å®š"></a>Controllerå‚æ•°ç»‘å®š</h3><p>åœ¨SpringMVCé‡Œé¢å¯ä»¥è½»æ¾çš„æŠŠè¡¨å•çš„æ•°æ®æ˜ å°„åˆ°å¯¹åº”çš„beanä¸­ï¼Œä½†æ˜¯æœ‰æ—¶å€™è¿™å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/to_list"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">tolist</span><span class="params">(HttpServletResponse response, Model model,</span></span></span><br><span class="line"><span class="function"><span class="params">                         @CookieValue(value = SpikeUserService.COOK1_NAME_TOKEN, required = <span class="keyword">false</span>)</span> String cookie,</span></span><br><span class="line"><span class="function">                         @<span class="title">RequestParam</span><span class="params">(value = SpikeUserService.COOK1_NAME_TOKEN, required = <span class="keyword">false</span>)</span> String param) </span>{</span><br><span class="line">        <span class="comment">/*æ‰‹æœºæµè§ˆå™¨ï¼Œæœ‰å¯èƒ½å°†cookieæ”¾åœ¨å‚æ•°ä¸­*/</span></span><br><span class="line">        <span class="keyword">if</span> (param == <span class="keyword">null</span> && cookie == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">        }</span><br><span class="line">        String cook = cookie != <span class="keyword">null</span> ? cookie : param;</span><br><span class="line">        SpikeUser user = spikeUserService.getUserByToken(response, cook);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        model.addAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"goods_list"</span>;</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸ºäº†è·å–è¿™ä¸ª<strong>SpikeUser</strong>å¯¹è±¡å¹¶ä¸èƒ½ç›´æ¥ä»è¡¨å•ä¸­è·å–ï¼Œéœ€è¦å€ŸåŠ©cookieç„¶åä»redisé‡Œé¢æŸ¥è¯¢ï¼Œå¦‚æœä¸‹é¢è¿˜æœ‰ä¸€äº›å…¶ä»–çš„controlleréœ€è¦è·å–è¿™ä¸ªå¯¹è±¡ï¼Œåˆè¦å†™å¾ˆå¤šé‡å¤çš„ä»£ç ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸Šé¢ä»‹ç»çš„WebMvcConfigureræ¥å®ç°ç®€åŒ–ä»£ç ã€‚</p><h4 id="é‡å†™addArgumentResolvers"><a href="#é‡å†™addArgumentResolvers" class="headerlink" title="é‡å†™addArgumentResolvers"></a>é‡å†™addArgumentResolvers</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//æ³¨å…¥æˆ‘ä»¬çš„å‚æ•°è§£æå™¨</span></span><br><span class="line">    SpikeUserArgumentResolver spikeUserArgumentResolver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addArgumentResolvers</span><span class="params">(List<handlermethodargumentresolver> argumentResolvers)</handlermethodargumentresolver></span> </span>{</span><br><span class="line">        argumentResolvers.add(spikeUserArgumentResolver);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œåªéœ€è¦å®ç°<strong>addArgumentResolvers</strong>å°±å¯ä»¥äº†ï¼Œæ³¨æ„åŠ ä¸Š<strong>@Configuration</strong>æ³¨è§£å°†WebConfigæ‰˜ä»˜ç»™Springï¼Œä½¿æˆ‘ä»¬æ·»åŠ çš„å‚æ•°è§£æå™¨ç”Ÿæ•ˆã€‚</p><h4 id="å®ç°HandlerMethodArgumentResolver"><a href="#å®ç°HandlerMethodArgumentResolver" class="headerlink" title="å®ç°HandlerMethodArgumentResolver"></a>å®ç°HandlerMethodArgumentResolver</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpikeUserArgumentResolver</span> <span class="keyword">implements</span> <span class="title">HandlerMethodArgumentResolver</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpikeUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span> </span>{</span><br><span class="line">        Class<!--?--> clazz = parameter.getParameterType();</span><br><span class="line">        <span class="comment">//å¤„ç†SpikeUserç±»å‹çš„</span></span><br><span class="line">        <span class="keyword">return</span> clazz==SpikeUser<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter parameter, ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  NativeWebRequest webRequest, WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        HttpServletResponse response = webRequest.getNativeResponse(HttpServletResponse<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        String paramToken = request.getParameter(SpikeUserService.COOK1_NAME_TOKEN);</span><br><span class="line">        String cookieToken = getCookieValue(request, SpikeUserService.COOK1_NAME_TOKEN);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(cookieToken) && StringUtils.isEmpty(paramToken)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        String token = StringUtils.isEmpty(paramToken)?cookieToken:paramToken;</span><br><span class="line">        <span class="keyword">return</span> userService.getUserByToken(response,token);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getCookieValue</span><span class="params">(HttpServletRequest request, String cookiName)</span> </span>{</span><br><span class="line">        Cookie[]  cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">for</span>(Cookie cookie : cookies) {</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName().equals(cookiName)) {</span><br><span class="line">                <span class="keyword">return</span> cookie.getValue();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç„¶åå°±å¯ä»¥ç›´æ¥åœ¨åœ¨æ§åˆ¶å™¨ä¸­æ‹¿åˆ°SpikeUseräº†ï¼Œä»£ç å˜å¾—æ¸…çˆ½ç®€æ´</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/to_list"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">tolist</span><span class="params">(Model model,SpikeUser spikeUser)</span> </span>{</span><br><span class="line">       <span class="keyword">if</span> (spikeUser==<span class="keyword">null</span>) {</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">       }</span><br><span class="line">       model.addAttribute(<span class="string">"user"</span>, spikeUser);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"goods_list"</span>;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœªä¼˜åŒ–</span></span><br><span class="line">   <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/to_list0"</span>)</span><br><span class="line">   <span class="meta">@Deprecated</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">tolist0</span><span class="params">(HttpServletResponse response, Model model,</span></span></span><br><span class="line"><span class="function"><span class="params">                        @CookieValue(value = SpikeUserService.COOK1_NAME_TOKEN, required = <span class="keyword">false</span>)</span> String cookie,</span></span><br><span class="line"><span class="function">                        @<span class="title">RequestParam</span><span class="params">(value = SpikeUserService.COOK1_NAME_TOKEN, required = <span class="keyword">false</span>)</span> String param) </span>{</span><br><span class="line">                           <span class="comment">//æ‰‹æœºæµè§ˆå™¨ï¼Œæœ‰å¯èƒ½å°†cookieæ”¾åœ¨å‚æ•°ä¸­</span></span><br><span class="line">       System.out.println(<span class="string">"cookie:"</span> +cookie);</span><br><span class="line">       System.out.println(<span class="string">"param "</span> +param);</span><br><span class="line">       <span class="keyword">if</span> (param == <span class="keyword">null</span> && cookie == <span class="keyword">null</span>) {</span><br><span class="line">           <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">       }</span><br><span class="line">       String cook = cookie != <span class="keyword">null</span> ? cookie : param;</span><br><span class="line">       SpikeUser user = spikeUserService.getUserByToken(response, cook);</span><br><span class="line">       System.out.println(user);</span><br><span class="line">       model.addAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"goods_list"</span>;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ä¹Ÿç®—æ˜¯å¯¹SpringMVCåŸç†çš„åˆæ¬¡æ¥è§¦å§ï¼Œåé¢å…³äºæ¡†æ¶è¿˜æ˜¯å¤šçœ‹æºç å•Šã€‚</p><p>å…³äº<strong>Spring-Session</strong>çš„å†…å®¹åé¢ç”¨åˆ°å†æ¥ä»‹ç»ã€‚</p><h3 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h3><p>ä¾ç„¶æ˜¯SpringBoot2ï¼Œæ‰€ä»¥è¿˜æ˜¯å®ç°çš„<strong>WebMvcConfigurer</strong>æ¥å£</p><p>å…ˆçœ‹ä¸‹æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹</p><p><img alt="æ¥è‡ªæ…•è¯¾" data-src="http://static.imlgw.top/image/20190609/vUv7FDoickvl.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h4 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.spike.intercept;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/6/9 15:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> NeedLogin {</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">needLogin</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="é‡å†™HandlerInterceptor"><a href="#é‡å†™HandlerInterceptor" class="headerlink" title="é‡å†™HandlerInterceptor"></a>é‡å†™HandlerInterceptor</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.spike.intercept;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> top.imlgw.spike.entity.SpikeUser;</span><br><span class="line"><span class="keyword">import</span> top.imlgw.spike.service.SpikeUserService;</span><br><span class="line"><span class="keyword">import</span> top.imlgw.spike.utils.UserContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/6/8 23:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginIntercept</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpikeUserService spikeUserService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åœ¨ç™»é™†å‰æ‹¦æˆª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod)){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        HandlerMethod hm=(HandlerMethod) handler;</span><br><span class="line">        SpikeUser spikeUser = getSpikeUser(request, response);</span><br><span class="line">        <span class="comment">//æœ‰çš„é¡µé¢ä¸éœ€è¦ç™»é™†(äºŒæ¬¡ç™»é™†)ä½†æ˜¯éœ€è¦ç”¨æˆ·ä¿¡æ¯(è®¢å•é¡µé¢...)ï¼Œæ‰€ä»¥éœ€è¦å…ˆå­˜è¿›å»</span></span><br><span class="line">        UserContext.setUser(spikeUser);</span><br><span class="line">        <span class="comment">//è·å–æ–¹æ³•ä¸Šçš„æ³¨è§£</span></span><br><span class="line">        NeedLogin needLogin = hm.getMethodAnnotation(NeedLogin<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span>(needLogin==<span class="keyword">null</span> || ! needLogin.needLogin()){</span><br><span class="line">            <span class="comment">//æ²¡æœ‰æ³¨è§£åè€…æ³¨è§£ä¸ºfalse,å°±ç›´æ¥æ”¾è¿‡</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æœ‰æ³¨è§£ï¼Œæ²¡ç™»é™†</span></span><br><span class="line">        <span class="keyword">if</span>(spikeUser==<span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** è§†å›¾æ¸²æŸ“å®Œæ¯•åè°ƒç”¨(æ”¶å°¾å·¥ä½œ)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">//åˆ é™¤ThreadLocalä¸­çš„Userå¦åˆ™ä¼šäº§ç”Ÿé”™ä¹±</span></span><br><span class="line">        UserContext.removeUser();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> SpikeUser <span class="title">getSpikeUser</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span></span>{</span><br><span class="line">        <span class="comment">//æ‹¿å‚æ•°ä¸­çš„token</span></span><br><span class="line">        String paramToken = request.getParameter(SpikeUserService.COOK_NAME_TOKEN);</span><br><span class="line">        <span class="comment">//æ‹¿cookieä¸­çš„token</span></span><br><span class="line">        String cookieToken = getCookieValue(request, SpikeUserService.COOK_NAME_TOKEN);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(cookieToken) && StringUtils.isEmpty(paramToken)) {</span><br><span class="line">            <span class="comment">//æ²¡ç™»é™†cookieä¸ºç©º</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        String token = StringUtils.isEmpty(paramToken)?cookieToken:paramToken;</span><br><span class="line">        SpikeUser user = spikeUserService.getUserByToken(response, token);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * è·å–cookieä¸­çš„User</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getCookieValue</span><span class="params">(HttpServletRequest request, String cookieName)</span> </span>{</span><br><span class="line">        Cookie[]  cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span>(cookies == <span class="keyword">null</span> || cookies.length <= <span class="number">0</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span>(Cookie cookie : cookies) {</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName().equals(cookieName)) {</span><br><span class="line">                <span class="keyword">return</span> cookie.getValue();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="WebConfigé‡Œé¢æ·»åŠ æ‹¦æˆªå™¨"><a href="#WebConfigé‡Œé¢æ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="WebConfigé‡Œé¢æ·»åŠ æ‹¦æˆªå™¨"></a>WebConfigé‡Œé¢æ·»åŠ æ‹¦æˆªå™¨</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.spike.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.support.HandlerMethodArgumentResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> top.imlgw.spike.intercept.LoginIntercept;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>{</span><br><span class="line"><span class="comment">//è‡ªåŠ¨è£…é…æˆ–è€… æ‰‹åŠ¨åˆ›å»ºbean,åŠ åˆ°Iocå®¹å™¨ä¸­ï¼Œå¦åˆ™å–ä¸åˆ°service</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpikeUserArgumentResolver spikeUserArgumentResolver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    LoginIntercept loginIntercept;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addArgumentResolvers</span><span class="params">(List<handlermethodargumentresolver> argumentResolvers)</handlermethodargumentresolver></span> </span>{</span><br><span class="line">        argumentResolvers.add(spikeUserArgumentResolver);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>{</span><br><span class="line">        registry.addInterceptor(loginIntercept).addPathPatterns(<span class="string">"/**"</span>).</span><br><span class="line">            excludePathPatterns(<span class="string">"/login/*"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="è§†å›¾è§£æå™¨"><a href="#è§†å›¾è§£æå™¨" class="headerlink" title="è§†å›¾è§£æå™¨"></a>è§†å›¾è§£æå™¨</h3><p>ä¸ç”¨ä¸ºäº†è·³è½¬é¡µé¢è€Œä¸“é—¨å†™ä¸€ä¸ª<strong>controller</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>{</span><br><span class="line">    <span class="comment">//è¿™é‡Œå¦‚æœæ˜¯ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œå°±åªèƒ½æ˜¯æ¨¡æ¿å¼•æ“templateé‡Œé¢çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œåé¢é»˜è®¤æŒ‡çš„æ˜¯staticé‡Œé¢çš„æ–‡ä»¶ï¼Œåç¼€ä¸ºhtml</span></span><br><span class="line">    registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">    registry.addViewController(<span class="string">"/goodslist"</span>).setViewName(<span class="string">"goods_list"</span>);</span><br><span class="line">    registry.addViewController(<span class="string">"/register"</span>).setViewName(<span class="string">"register"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å…¶ä»–çš„ä»¥åç”¨åˆ°ä¼šç»§ç»­è¡¥å……</p></blockquote></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“å¤§ä½œä¸š</title>
      <link href="/2019/05/20/shu-ju-ku-da-zuo-ye/"/>
      <url>/2019/05/20/shu-ju-ku-da-zuo-ye/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><ul><li>JDK(å»ºè®®1.8ä»¥ä¸Š)</li><li>å¼€å‘å·¥å…·ï¼ŒEclipseæˆ–è€…idea â€¦</li><li><strong>mysql</strong>æˆ–è€…<strong>mssql</strong>(æˆ‘æ˜¯ç”¨çš„<strong>mysql5.7.17</strong>ï¼Œç»™çš„demoæ˜¯mysqlçš„)</li></ul><h3 id="æµ‹è¯•ç»™çš„Demo"><a href="#æµ‹è¯•ç»™çš„Demo" class="headerlink" title="æµ‹è¯•ç»™çš„Demo"></a>æµ‹è¯•ç»™çš„Demo</h3><p>â‘ è£…å¥½mysqlä¹‹åå¯åŠ¨å®ƒï¼Œç„¶åç”¨ç®¡ç†å·¥å…·æˆ‘ç”¨çš„æ˜¯<strong>navicat</strong>ï¼Œæ‰“å¼€ç„¶åå°†ç»™çš„demoé‡Œé¢çš„sqlè„šæœ¬å¯¼å…¥è¿›å»(å¯¼å…¥ä¸å¥½çš„å¯ä»¥æ‰‹åŠ¨å»ºç«‹ä¸€ä¸ªï¼Œç”¨è„šæœ¬æ–‡ä»¶å¯¼å…¥åçš„åå­—æ˜¯tb_demoï¼Œæˆ‘è¿™é‡Œæ˜¯æ‰‹åŠ¨å»ºçš„)</p><p><video controls="controls" src="http://static.imlgw.top/image/20190530/M2IOTaKdyaQO.mp4" width="100%"></video></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190524/oNHeEFJhHEYX.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>æœ€åå·®ä¸å¤šæ˜¯è¿™æ ·çš„ç»“æ„</p><p>â‘¡åœ¨<strong>Eclipse</strong>é‡Œé¢<strong>import</strong>é¡¹ç›®ï¼Œè¿™é‡Œæˆ‘<strong>import</strong>ä¼šæœ‰ä¸ªæ„Ÿå¹å·ï¼Œ<strong>æœ€å¥½é‡æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä¸ç„¶å¯èƒ½ä¼šæœ‰å¥‡æ€ªçš„é”™è¯¯</strong>ä¸‹é¢æ˜¯<strong>å¦‚ä½•æ–°å»ºçš„æ­¥éª¤è§†é¢‘</strong></p><p><video controls="controls" src="http://static.imlgw.top/f0xim-iyaow.mp4" width="100%"></video></p><p>è¿™é‡Œè¦æ”¹çš„åœ°æ–¹å°±æ˜¯DbUtilé‡Œé¢æ•°æ®åº“é…ç½®</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbUtil</span> </span>{</span><br><span class="line"><span class="comment">//com.microsoft.sqlserver.jdbc.SQLServerDriver</span></span><br><span class="line">    <span class="comment">//æ•°æ®åº“é©±åŠ¨çš„åå­—ï¼ˆ1.6è¿˜æ˜¯1.8ä¹‹åå°±ä¸éœ€è¦äº†ï¼Œè¿™é‡Œè¿˜æ˜¯åŠ ä¸Šå§ï¼‰</span></span><br><span class="line">String driverName = <span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line"><span class="comment">//jdbc:sqlserver://127.0.0.1:1433;DatabaseName=demo</span></span><br><span class="line">    <span class="comment">//è¿æ¥æ•°æ®åº“çš„åœ°å€ï¼Œå‰é¢çš„ä¸ç”¨æ”¹ï¼Œè¿™é‡Œè¦æ”¹çš„å°±æ˜¯åé¢çš„ demo æ¢æˆä½ çš„æ•°æ®åº“åå­—ï¼ˆæˆ‘ä¸Šé¢çš„æ˜¯demoï¼‰</span></span><br><span class="line">String dbURL = <span class="string">"jdbc:mysql://localhost:3306/demo"</span>;</span><br><span class="line">    <span class="comment">//ä½ çš„æ•°æ®åº“çš„å¸å·</span></span><br><span class="line">String userName = <span class="string">"root"</span>;</span><br><span class="line">    <span class="comment">//è£…mysqlæ—¶è®¾ç½®çš„å¯†ç </span></span><br><span class="line">String userPwd = <span class="string">"admin"</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getCon</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException </span>{</span><br><span class="line">Class.forName(driverName);</span><br><span class="line">Connection conn = DriverManager.getConnection(dbURL, userName, userPwd);</span><br><span class="line"><span class="keyword">return</span> conn;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeCon</span><span class="params">(Connection conn)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line"><span class="keyword">if</span> (conn != <span class="keyword">null</span>)</span><br><span class="line">conn.close();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">DbUtil dbUtil = <span class="keyword">new</span> DbUtil();</span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">dbUtil.getCon();</span><br><span class="line">System.out.println(<span class="string">"è¿æ¥æˆåŠŸ"</span>);</span><br><span class="line">} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">e.printStackTrace();</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//com.microsoft.sqlserver.jdbc.SQLServerDriver</span></span><br><span class="line">   <span class="comment">//æ•°æ®åº“é©±åŠ¨çš„åå­—ï¼ˆ1.6è¿˜æ˜¯1.8ä¹‹åå°±ä¸éœ€è¦äº†ï¼Œè¿™é‡Œè¿˜æ˜¯åŠ ä¸Šå§ï¼‰</span></span><br><span class="line">String driverName = <span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line"><span class="comment">//jdbc:sqlserver://127.0.0.1:1433;DatabaseName=demo</span></span><br><span class="line">   <span class="comment">//è¿æ¥æ•°æ®åº“çš„åœ°å€ï¼Œè¿™é‡Œè¦æ”¹çš„å°±æ˜¯åé¢çš„ demo æ¢æˆä½ çš„æ•°æ®åº“åå­—ï¼ˆæˆ‘ä¸Šé¢çš„æ˜¯demoï¼‰</span></span><br><span class="line">String dbURL = <span class="string">"jdbc:mysql://localhost:3306/demo"</span>;</span><br><span class="line">   <span class="comment">//ä½ çš„æ•°æ®åº“çš„å¸å·</span></span><br><span class="line">String userName = <span class="string">"root"</span>;</span><br><span class="line">   <span class="comment">//å¯†ç </span></span><br><span class="line">String userPwd = <span class="string">"admin"</span>;</span><br></pre></td></tr></tbody></table></figure></div><p>è¦æ”¹çš„å·®ä¸å¤šå°±æ˜¯è¿™4ä¸ªé…ç½®</p><p>â‘ å¦‚æœæ˜¯<strong>mysql</strong>å¹¶ä¸”ç‰ˆæœ¬æ˜¯8ä»¥ä¸‹çš„ï¼Œé‚£ä¹ˆ<strong>driverName</strong> å¯ä»¥ä¸ç”¨æ”¹ï¼Œå¦‚æœæ˜¯8ä»¥ä¸Šçš„ï¼ˆç¾¤é‡Œé¢é‚£ä¸ªæ˜¯8ä»¥ä¸Šçš„ï¼‰å°±éœ€è¦æ”¹æˆ</p><p><strong>com.mysql.cj.jdbc.Driver</strong>ï¼Œå¹¶ä¸”<strong>æ‰¾åˆ°é€‚åˆç‰ˆæœ¬çš„é©±åŠ¨æ‹·è´åˆ°libç›®å½•ç„¶åå³é”®bulidpath</strong>ï¼ˆåœ¨è¿™ä¹‹å‰å…ˆå°†è€çš„é©±åŠ¨åˆ æ‰ï¼Œbulidpathçš„ä½œç”¨æ˜¯å°†jaråŒ…<strong>çœŸæ­£çš„</strong>åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­å»ï¼‰</p><ul><li><p>8 ä»¥ä¸Š é©±åŠ¨ä¸‹è½½åœ°å€ é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1WXjAAHX5gQC6v5pfiTOqmQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1WXjAAHX5gQC6v5pfiTOqmQ</a>  æå–ç ï¼š5lf5 </p></li><li><p>sqlServeréœ€è¦æ”¹çš„åœ°æ–¹æˆ‘ä¹Ÿæ³¨é‡Šåœ¨ä¸Šé¢ä½†æ˜¯æˆ‘ç”µè„‘ä¸Šæ²¡sqlserveræˆ‘æ²¡æœ‰æµ‹è¯•ï¼Œè€å¸ˆç»™çš„åŒ…é‡Œé¢æœ‰sqlserverçš„é©±åŠ¨</p></li></ul><p>â‘¡<strong>dbURL</strong>ï¼Œå‰é¢çš„ä¸ç”¨æ”¹ï¼Œè¿™é‡Œåªéœ€è¦æ”¹ä¸€ä¸‹åé¢çš„æ•°æ®åº“åå­—ï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢å»ºçš„æ•°æ®åº“åå­—æ˜¯<strong>demo</strong>,åé¢å°±åº”è¯¥æ˜¯<strong>/demo</strong>ï¼ˆå¦‚æœç”¨è„šæœ¬ç›´æ¥å¯¼å…¥ç”Ÿæˆçš„æ•°æ®åº“åå­—æ˜¯db_demoï¼Œè¿™é‡Œå°±è¦æ”¹æˆjdbc:mysql://localhost:3306/db_demo</p><ul><li>å¯¹åº”sqlserverçš„æˆ‘ä¹Ÿæ”¾åœ¨ä¸Šé¢ä½†æ˜¯æˆ‘æ²¡è£…sqlserveræ‰€ä»¥æ²¡æµ‹è¯•ã€‚</li></ul><p>â‘¢<strong>userName</strong>ï¼Œæ•°æ®åº“è´¦å·ï¼ˆä¸€èˆ¬é»˜è®¤å°±æ˜¯rootï¼‰</p><p>â‘£<strong>password</strong>ï¼Œæ•°æ®åº“å¯†ç </p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>åœ¨viewåŒ…ä¸‹çš„<strong>MainPage</strong>ï¼Œè¿™æ˜¯ç”¨javaçš„swingç»„ä»¶å¼€å‘çš„ä¸€ä¸ªGUIé¡µé¢ï¼Œæœ€ä¸‹é¢æœ‰ä¸€ä¸ªmainå‡½æ•°ç›´æ¥å¯åŠ¨å®ƒå°±è¡Œï¼Œï¼ˆå¦‚æœæœ‰ä¹±ç ï¼Œéœ€è¦å°†eclipesçš„å·¥ä½œç©ºé—´çš„ç¼–ç æ–¹å¼æ¢ä¸º<strong>utf-8</strong>ï¼‰ï¼Œåˆ°æ­¤ç¯å¢ƒå°±åŸºæœ¬okäº†ï¼Œåé¢çš„å°±æ˜¯å†™ä»£ç çš„äº‹äº†ã€‚</p><h3 id="æ”¹ç”¨è‡ªå·±çš„æ•°æ®åº“"><a href="#æ”¹ç”¨è‡ªå·±çš„æ•°æ®åº“" class="headerlink" title="æ”¹ç”¨è‡ªå·±çš„æ•°æ®åº“"></a>æ”¹ç”¨è‡ªå·±çš„æ•°æ®åº“</h3><blockquote><p>åé¢çš„éƒ¨åˆ†ä¸»è¦æ˜¯ä»£ç çš„é—®é¢˜äº†ï¼Œæ¯ä¸ªäººæ•°æ®åº“ä¸åŒä¹Ÿä¼šæœ‰ä¸€äº›å·®è·</p></blockquote><ul><li><p>å¯¼å…¥è‡ªå·±çš„æ•°æ®</p><p>æ•°æ®åº“åå­—ï¼Œå­—æ®µåä¸è¦ç”¨ä¸­æ–‡ï¼</p><p>æ•°æ®åº“åå­—ï¼Œå­—æ®µåä¸è¦ç”¨ä¸­æ–‡ ï¼</p><p>æ•°æ®åº“åå­—ï¼Œå­—æ®µåä¸è¦ç”¨ä¸­æ–‡ï¼</p></li><li><p>å®ä½“ç±»æ”¹æˆè‡ªå·±çš„</p></li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StuInfo</span> </span>{</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Long stuId;</span><br><span class="line"><span class="keyword">private</span> String stuName;</span><br><span class="line"><span class="keyword">private</span> String stuSex;</span><br><span class="line"><span class="keyword">private</span> Date stuDob;</span><br><span class="line"><span class="keyword">private</span> String stuMajor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getStuId</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">return</span> stuId;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuId</span><span class="params">(Long stuId)</span> </span>{</span><br><span class="line"><span class="keyword">this</span>.stuId = stuId;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getStuName</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">return</span> stuName;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuName</span><span class="params">(String stuName)</span> </span>{</span><br><span class="line"><span class="keyword">this</span>.stuName = stuName;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getStuSex</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">return</span> stuSex;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuSex</span><span class="params">(String stuSex)</span> </span>{</span><br><span class="line"><span class="keyword">this</span>.stuSex = stuSex;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getStuDob</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">return</span> stuDob;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuDob</span><span class="params">(Date stuDob)</span> </span>{</span><br><span class="line"><span class="keyword">this</span>.stuDob = stuDob;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getStuMajor</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">return</span> stuMajor;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuMajor</span><span class="params">(String stuMajor)</span> </span>{</span><br><span class="line"><span class="keyword">this</span>.stuMajor = stuMajor;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StuInfo</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StuInfo</span><span class="params">(String stuName, String stuSex, Date stuDob, String stuMajor)</span> </span>{</span><br><span class="line"><span class="keyword">this</span>.stuName = stuName;</span><br><span class="line"><span class="keyword">this</span>.stuSex = stuSex;</span><br><span class="line"><span class="keyword">this</span>.stuDob = stuDob;</span><br><span class="line"><span class="keyword">this</span>.stuMajor = stuMajor;</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œå®ä½“ç±»æ˜¯å’Œæ•°æ®åº“çš„è¡¨å’Œå­—æ®µå¯¹åº”çš„ï¼Œä¸€ä¸ªStuInfoå¯¹è±¡å°±å¯¹åº”ä¸€æ¡æ•°æ®ã€‚</p><ul><li>å¢åˆ æ”¹æŸ¥çš„ä¿®æ”¹</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResultSet <span class="title">getUsers</span><span class="params">(User user, Connection con)</span> <span class="keyword">throws</span> SQLException </span>{</span><br><span class="line">StringBuffer sql = <span class="keyword">new</span> StringBuffer(<span class="string">"select * from t_user "</span>);</span><br><span class="line"><span class="keyword">if</span> (user.getUserName()!= <span class="keyword">null</span>) {</span><br><span class="line">sql.append(<span class="string">" where userName like '%"</span>+user.getUserName()+<span class="string">"%'"</span>);</span><br><span class="line">}</span><br><span class="line">PreparedStatement ps = con.prepareStatement(sql.toString());</span><br><span class="line"><span class="keyword">return</span> ps.executeQuery();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(User user, Connection con)</span> <span class="keyword">throws</span> SQLException</span>{</span><br><span class="line">String sql=<span class="string">"delete from t_user where userName='"</span>+user.getUserName()+<span class="string">"'"</span>;</span><br><span class="line">PreparedStatement ps = con.prepareStatement(sql);</span><br><span class="line"><span class="keyword">return</span> ps.executeUpdate();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(User user, Connection con)</span> <span class="keyword">throws</span> SQLException</span>{</span><br><span class="line">String sql=<span class="string">"insert into t_user  values(?,?)"</span>;</span><br><span class="line">PreparedStatement ps = con.prepareStatement(sql);</span><br><span class="line">ps.setString(<span class="number">1</span>, user.getUserName());</span><br><span class="line">ps.setString(<span class="number">2</span>, user.getTel());</span><br><span class="line"><span class="keyword">return</span> ps.executeUpdate();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">modify</span><span class="params">(User user, Connection con)</span> <span class="keyword">throws</span> SQLException</span>{</span><br><span class="line">String sql=<span class="string">"update t_user  set userName=?, tel=? where userName = '"</span>+user.getUserName()+<span class="string">"'"</span>;</span><br><span class="line">PreparedStatement ps = con.prepareStatement(sql);</span><br><span class="line">ps.setString(<span class="number">1</span>, user.getUserName());</span><br><span class="line">ps.setString(<span class="number">2</span>, user.getTel());</span><br><span class="line">System.out.println(sql);</span><br><span class="line"><span class="keyword">return</span> ps.executeUpdate();</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æœ€ç»ˆéƒ½æ˜¯é€šè¿‡è°ƒç”¨è¿™ä¸ªDaoç±»å®ç°çš„å¢åˆ æ”¹æŸ¥ã€‚</p><ul><li>é¡µé¢çš„ä¿®æ”¹</li></ul><p>æŒ‰ç…§è€å¸ˆçš„è¦æ±‚æ˜¯å¯¹æˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®åº“åšå¢åˆ æ”¹æŸ¥ï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ•°æ®åº“å’Œç»™çš„demoçš„è¡¨ç»“æ„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹MainPageï¼Œè¿™ä¸ªæ˜¯ç”¨javaçš„swingå†™çš„ä¸€ä¸ªGUIï¼Œæ‰€ä»¥éœ€è¦æ”¹è¿™äº›ç•Œé¢ä¸Šçš„ä¸€äº›å…ƒç´ ï¼Œæˆ‘è®°çš„å¥½åƒæœ‰ä¸ªæ’ä»¶å¯ä»¥ç›´æ¥æ‹–åŠ¨ç”Ÿæˆswingè¿™äº›ç•Œé¢çš„(çœ‹è§åˆ˜å‹‡ç”¨è¿‡)ï¼Œæˆ‘å¯¹swingä¸ç†Ÿæ‚‰ï¼ˆæ—©å°±è¿‡æ—¶äº†ï¼Œæ²¡æœ‰å­¦çš„æ„ä¹‰ï¼‰ï¼Œæˆ‘ç”¨webå†™çš„ç•Œé¢</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190530/96gB7wwVz4Xj.png?imageslim" src="/img/loading.gif" class="lazyload"></p><h3 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h3><p><a href="https://blog.csdn.net/mr_green1024/article/details/53222526?tdsourcetag=s_pcqq_aiomsg" target="_blank" rel="noopener">Mysql5.7è§£å‹ç‰ˆçš„å®‰è£…å’Œå¸è½½åŠå¸¸è§é—®é¢˜</a></p></body></html>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSR303-å‚æ•°æ£€éªŒ</title>
      <link href="/2019/05/13/jsr303-can-shu-xiao-yan/"/>
      <url>/2019/05/13/jsr303-can-shu-xiao-yan/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="JSR303"><a href="#JSR303" class="headerlink" title="JSR303"></a>JSR303</h2><p>ç›®å‰æœ€æ–°çš„è§„èŒƒå·²ç»æ˜¯JSR380äº†ï¼Œä¹Ÿå°±æ˜¯Bean Validation 2.0.</p><p><img alt="mark" data-src="http://static.imlgw.top///20190513/qa5DNu5Nsq26.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å‚æ•°æ ¡éªŒæ˜¯ä¸€ä¸ªæˆç†Ÿçš„ç½‘ç«™å¿…é¡»çš„åŠŸèƒ½ï¼Œç„¶è€Œæœ‰çš„æ—¶å€™ä¸ºäº†æ ¡éªŒå‚æ•°ä¹Ÿè¦è´¹å¥½å¤§çš„åŠ²ï¼Œå…ä¸äº†å†™å¾ˆå¤šif-elseï¼Œä¸€ç‚¹ä¹Ÿä¸ä¼˜é›…ã€‚</p><h2 id="ä¸Šæ‰‹"><a href="#ä¸Šæ‰‹" class="headerlink" title="ä¸Šæ‰‹"></a>ä¸Šæ‰‹</h2><h3 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"> <!--SpringBootWeb è¿™ä¸ªåŒ…é‡Œé¢è‡ªå¸¦äº†hibernateçš„æ ¡éªŒåŒ…--></span><br><span class="line"><dependency></dependency></span><br><span class="line"><groupid>org.springframework.boot</groupid></span><br><span class="line"><artifactid>spring-boot-starter-web</artifactid></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><h3 id="JSRæä¾›çš„æ³¨è§£"><a href="#JSRæä¾›çš„æ³¨è§£" class="headerlink" title="JSRæä¾›çš„æ³¨è§£"></a>JSRæä¾›çš„æ³¨è§£</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Null</span>   è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º <span class="keyword">null</span>    </span><br><span class="line"><span class="meta">@NotNull</span>    è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º <span class="keyword">null</span>    </span><br><span class="line"><span class="meta">@AssertTrue</span>     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º <span class="keyword">true</span>    </span><br><span class="line"><span class="meta">@AssertFalse</span>    è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º <span class="keyword">false</span>    </span><br><span class="line"><span class="meta">@Min</span>(value)     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼    </span><br><span class="line"><span class="meta">@Max</span>(value)     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼    </span><br><span class="line"><span class="meta">@DecimalMin</span>(value)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼    </span><br><span class="line"><span class="meta">@DecimalMax</span>(value)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼    </span><br><span class="line"><span class="meta">@Size</span>(max=, min=)   è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…    </span><br><span class="line"><span class="meta">@Digits</span> (integer, fraction)     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…    </span><br><span class="line"><span class="meta">@Past</span>   è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ    </span><br><span class="line"><span class="meta">@Future</span>     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ    </span><br><span class="line"><span class="meta">@Pattern</span>(regex=,flag=)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Hibernateæä¾›çš„"><a href="#Hibernateæä¾›çš„" class="headerlink" title="Hibernateæä¾›çš„"></a>Hibernateæä¾›çš„</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">@NotBlank(message =)   éªŒè¯å­—ç¬¦ä¸²énullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº0    </span><br><span class="line">@Email  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€    </span><br><span class="line">@Length(min=,max=)  è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…    </span><br><span class="line">@NotEmpty   è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º    </span><br><span class="line">@Range(min=,max=,message=)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</span><br></pre></td></tr></tbody></table></figure></div><h3 id="è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£"><a href="#è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£"></a>è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£</h3><p><strong>@IsMobileæ³¨è§£</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.spike.validator;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Constraint;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Payload;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/5/13 17:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE})</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint</span>(</span><br><span class="line">        validatedBy = {IsMobileValidator<span class="class">.<span class="keyword">class</span>} //æŒ‡å®šçœŸæ­£æ ¡éªŒçš„ç±»</span></span><br><span class="line"><span class="class">)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">IsMobile</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "å·ç æ ¼å¼é”™è¯¯"</span>;</span><br><span class="line"></span><br><span class="line">    Class<!--?-->[] groups() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    Class<!--? extends Payload-->[] payload() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>IsMobileValidatorç±»</strong></p><blockquote><p>è‡ªå®šä¹‰çš„æ ¡éªŒå™¨è¦å®ç° ConstraintValidatoræ¥å£</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.spike.validator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> top.imlgw.spike.utils.ValidatorUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidator;</span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidatorContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/5/13 18:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IsMobileValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span><<span class="title">IsMobile</span>, <span class="title">String</span>> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> required=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(IsMobile constraintAnnotation)</span> </span>{</span><br><span class="line">        required=constraintAnnotation.required();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String s, ConstraintValidatorContext constraintValidatorContext)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(required){</span><br><span class="line">            <span class="keyword">return</span>  ValidatorUtil.isMobile(s);</span><br><span class="line">        }<span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(s)){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }<span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span>  ValidatorUtil.isMobile(s);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="å­—æ®µä¸ŠåŠ æ³¨è§£"><a href="#å­—æ®µä¸ŠåŠ æ³¨è§£" class="headerlink" title="å­—æ®µä¸ŠåŠ æ³¨è§£"></a>å­—æ®µä¸ŠåŠ æ³¨è§£</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.spike.entity;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/5/11 15:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"idä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"åå­—ä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@Length</span>(min = <span class="number">6</span>,message = <span class="string">"å¯†ç é•¿åº¦è‡³å°‘6ä½"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User{"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String name, Integer age, String password)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">        <span class="keyword">this</span>.id=id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>@Valid åŠ BindingResult</strong></p><p><img alt="mark" data-src="http://static.imlgw.top///20190513/ILDAz6Bdj3cz.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>åœ¨Controlleå±‚å¾…æ ¡éªŒçš„çš„å‚æ•°ä¸ŠåŠ ä¸Š<code>@Valid</code>æ³¨è§£ï¼Œç„¶ååœ¨åé¢ç´§è·Ÿä¸€ä¸ª <code>BindingResult</code>ï¼Œæ ¡éªŒçš„ç»“æœä¼šå°è£…åœ¨è¿™ä¸ªå¯¹è±¡é‡Œé¢ï¼ŒBindingResult çš„ä½œç”¨æ˜¯å½“å‚æ•°ä¸åˆæ³•æ—¶èƒ½å¤Ÿæ•æ‰åˆ°é”™è¯¯ï¼Œä¸ä¼šç›´æ¥æŠ›å¼‚å¸¸ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ã€‚</p><p><strong>@ValidåŠ å…¨å±€å¼‚å¸¸æ•è·</strong></p><p>ä¸Šé¢çš„æ–¹æ³•å¦‚æœä¸åŠ åé¢çš„BindingResultåœ¨æ ¡éªŒå¤±è´¥åå°±ä¼šæŠ›ä¸€ä¸ªBindException</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">org.springframework.validation.BindException: org.springframework.validation.BeanPropertyBindingResult: <span class="number">1</span> errors</span><br><span class="line">Field error in object <span class="string">'user'</span> on field <span class="string">'id'</span>: rejected value [<span class="keyword">null</span>]; codes [NotNull.user.id,NotNull.id,NotNull.<span class="keyword">long</span>,NotNull]; arguments .......</span><br></pre></td></tr></tbody></table></figure></div><p>é‚£æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>@ControllerAdvice+@ExceptionHandler</code>æ¥å®šä¹‰ä¸€ä¸ªå…¨å±€çš„å¼‚å¸¸å¤„ç†å™¨æ¥å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œ<code>@ExceptionHandle</code>ï¼Œé’ˆå¯¹çš„ä»…ä»…æ˜¯å•ä¸ªcontrollerï¼ŒåŠ ä¸Š<code>@ControllerAdvice</code>å°±å¯ä»¥å¯¹æ‰€æœ‰çš„Controllerå±‚å¼‚å¸¸è¿›è¡Œæ•è·ï¼Œè¿™é‡Œçš„å…¨å±€ä»…ä»…æŒ‡çš„æ˜¯controllerå±‚ã€‚</p><h3 id="è‡ªå®šä¹‰å¼‚å¸¸"><a href="#è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸"></a>è‡ªå®šä¹‰å¼‚å¸¸</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.spike.exception;</span><br><span class="line"><span class="keyword">import</span> top.imlgw.spike.result.CodeMsg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€é€šç”¨å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/5/14 20:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> CodeMsg cm;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlobalException</span><span class="params">(CodeMsg cm)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(cm.toString());</span><br><span class="line">        <span class="keyword">this</span>.cm = cm;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CodeMsg <span class="title">getCm</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> cm;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="å…¨å±€å¼‚å¸¸å¤„ç†å™¨"><a href="#å…¨å±€å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="å…¨å±€å¼‚å¸¸å¤„ç†å™¨"></a>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Controllerå±‚å¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/5/13 18:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="meta">@ResponseBody</span> <span class="comment">//ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦jsonçš„è½¬æ¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>{</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception<span class="class">.<span class="keyword">class</span>) //å¤„ç†<span class="title">controller</span>å±‚æ‰€æœ‰å¼‚å¸¸</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Result</span><<span class="title">String</span>> <span class="title">exceptionHandle</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Exception</span> <span class="title">e</span>) </span>{</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> GlobalException) {</span><br><span class="line">            <span class="comment">//å…¨å±€å¼‚å¸¸</span></span><br><span class="line">            GlobalException ex = (GlobalException) e;</span><br><span class="line">            <span class="keyword">return</span> Result.error(ex.getCm());</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BindException) {</span><br><span class="line">            <span class="comment">//@Validated æ£€éªŒå™¨çš„å¼‚å¸¸</span></span><br><span class="line">            BindException ex = (BindException) e;</span><br><span class="line">            List<objecterror> errors = ex.getAllErrors();</objecterror></span><br><span class="line">            ObjectError error = errors.get(<span class="number">0</span>);</span><br><span class="line">            String msg = error.getDefaultMessage();</span><br><span class="line">            <span class="keyword">return</span> Result.error(CodeMsg.BIND_ERROR.fillArgs(msg));</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> Result.error(CodeMsg.SERVER_ERROR);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æµ‹è¯•Demo çœ‹å…ˆå¤„ç†é‚£ä¸ª</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = GlobalException<span class="class">.<span class="keyword">class</span>) //å¤„ç†<span class="title">controller</span>å±‚æ‰€æœ‰å¼‚å¸¸</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Result</span><<span class="title">String</span>> <span class="title">GLe</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Exception</span> <span class="title">e</span>) </span>{</span><br><span class="line">        System.out.println(<span class="string">"ä¼˜å…ˆå¤„ç†äº†è¿™ä¸ªGlobalException"</span>);</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="comment">//å…¨å±€å¼‚å¸¸</span></span><br><span class="line">        GlobalException ex = (GlobalException) e;</span><br><span class="line">        <span class="keyword">return</span> Result.error(ex.getCm());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œä¹Ÿåšäº†ä¸ªå°æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å®šä¹‰äº†ä¸¤ä¸ª@ExceptionHandleï¼Œä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„å­ç±»ï¼Œçœ‹ä¼šå…ˆå¤„ç†é‚£ä¸ªï¼Œæµ‹è¯•åå‘ç°ä¼šå…ˆå¤„ç†å°å¼‚å¸¸ï¼Œé‚£ä¸ªæœ€å¤§çš„å¼‚å¸¸å…¶å®ç›¸å½“äºâ€™â€™å…œåº•â€™â€™çš„ã€‚å…¶å®åé¢æˆ‘ä¸ºäº†è·Ÿç²¾ç»†çš„å¤„ç†ï¼Œå°†ç»‘å®šå¼‚å¸¸å’Œè‡ªå®šä¹‰çš„å¼‚å¸¸åˆ†å¼€å¤„ç†äº†ã€‚</p><blockquote><p>@ControllerAdvice :</p><p>It is typically used to define {@link ExceptionHandler <strong>@ExceptionHandler</strong>},</p><p>{@link InitBinder <strong>@InitBinder</strong>}, and {@link ModelAttribute <strong>@ModelAttribute</strong>}</p><p>methods that <strong>apply to all</strong> {@link RequestMapping <strong>@RequestMapping</strong>} methods.</p><p>@author Rossen Stoyanchev</p><p>@since 3.2</p></blockquote><h3 id="åˆ†ç»„æ ¡éªŒ"><a href="#åˆ†ç»„æ ¡éªŒ" class="headerlink" title="åˆ†ç»„æ ¡éªŒ"></a>åˆ†ç»„æ ¡éªŒ</h3><p>åªéœ€è¦åœ¨voé‡ŒåŠ ä¸Šå¯¹åº”åˆ†ç»„çš„æ¥å£ç„¶ååœ¨æ³¨è§£ä¸ŠåŠ ä¸Šå°±å¯ä»¥äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginVo</span> </span>{</span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"æ‰‹æœºå·ä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="meta">@IsMobile</span>(groups = Test1<span class="class">.<span class="keyword">class</span>) //åªæœ‰åœ¨<span class="title">Test1</span>åˆ†ç»„ä¸‹æ‰ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">String</span> <span class="title">mobile</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"å¯†ç ä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="meta">@Length</span>(min=<span class="number">6</span> ,groups = Test2<span class="class">.<span class="keyword">class</span>,<span class="title">message</span> </span>= <span class="string">"å¯†ç é•¿åº¦è¿‡çŸ­"</span>) <span class="comment">//åªæœ‰åœ¨Test2åˆ†ç»„ä¸‹æ‰ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMobile</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> mobile;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMobile</span><span class="params">(String mobile)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.mobile = mobile;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"LoginVo [mobile="</span> + mobile + <span class="string">", password="</span> + password + <span class="string">"]"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Test1</span></span>{}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Test2</span></span>{}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä½¿ç”¨æ—¶æ³¨æ„ç”¨<code>@Validated</code>ï¼Œè¿™ä¸ªå…¶å®æ˜¯Springå¯¹Hibernateçš„äºŒæ¬¡å°è£…ï¼Œå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/jsr303-2"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJSR</span><span class="params">(@Validated({LoginVo.Test2.class})</span> LoginVo vo)</span>{</span><br><span class="line">  <span class="comment">//........</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·åœ¨è¿™ä¸ªControlleré‡Œpostå¯†ç å°±æ²¡æœ‰é•¿åº¦çš„é™åˆ¶äº†ã€‚</p><blockquote><p>å…¶å®è¿˜æœ‰ä¸€äº›æ ¡éªŒçš„æ–¹æ³•ï¼ŒåŸºäºæ–¹æ³•æ ¡éªŒï¼ŒåŸºäºå°‘é‡å‚æ•°çš„æ ¡éªŒï¼Œä»¥åç”¨åˆ°å†æ¥è®°å½•</p></blockquote></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‚æ•°æ ¡éªŒ </tag>
            
            <tag> JSR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeæ•°ç»„</title>
      <link href="/2019/05/04/leetcode-shu-zu/"/>
      <url>/2019/05/04/leetcode-shu-zu/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="LeetCode-æ•°ç»„"><a href="#LeetCode-æ•°ç»„" class="headerlink" title="LeetCode æ•°ç»„"></a>LeetCode æ•°ç»„</h2><p>é¢è¯•ä¸­çš„ç®—æ³•é—®é¢˜ï¼Œæœ‰å¾ˆå¤šå¹¶ä¸éœ€è¦å¤æ‚çš„æ•°æ®ç»“æ„æ”¯æ’‘ã€‚å°±æ˜¯ç”¨æ•°ç»„ï¼Œå°±èƒ½è€ƒå¯Ÿå‡ºå¾ˆå¤šä¸œè¥¿äº†ã€‚å…¶å®ï¼Œç»å…¸çš„æ’åºé—®é¢˜ï¼ŒäºŒåˆ†æœç´¢ç­‰ç­‰é—®é¢˜ï¼Œå°±æ˜¯åœ¨æ•°ç»„è¿™ç§æœ€åŸºç¡€çš„ç»“æ„ä¸­å¤„ç†é—®é¢˜çš„ã€‚ </p><h2 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1. ä¸¤æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/two-sum/" target="_blank" rel="noopener">1. ä¸¤æ•°ä¹‹å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªç›®æ ‡å€¼ <code>target</code>ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ <strong>ä¸¤ä¸ª</strong> æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>], target = <span class="number">9</span></span><br><span class="line"></span><br><span class="line">å› ä¸º nums[<span class="number">0</span>] + nums[<span class="number">1</span>] = <span class="number">2</span> + <span class="number">7</span> = <span class="number">9</span></span><br><span class="line">æ‰€ä»¥è¿”å› [<span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å¹³ç”Ÿä¸è¯†<strong>TwoSum</strong>ï¼ŒåšéLeetCodeä¹Ÿæ‰ç„¶</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) {</span><br><span class="line">    <span class="keyword">int</span> length = nums.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < length - <span class="number">1</span>; i++) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j < length - i; j++) {</span><br><span class="line">            <span class="keyword">int</span> result = nums[i] + nums[i + j];</span><br><span class="line">            <span class="keyword">if</span> (result == target) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[] { i, i + j };</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æœ€å¼€å§‹çš„åšæ³•ï¼Œç›´æ¥æš´åŠ›æ±‚è§£ï¼Œç®€å•ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½ï¼Œ50msï¼Œ41% beatsï¼Œå…¶å®åœ¨ç¬”è¯•æˆ–è€…å…¶å®ƒå¯¹æ•ˆç‡è¦æ±‚æ²¡é‚£ä¹ˆä¸¥æ ¼çš„åœ°æ–¹ç”¨æš´åŠ›æ³•ä¹Ÿæ²¡æ¯›ç—…èŠ‚çº¦å¾ˆå¤šæ—¶é—´ï¼Œèƒ½ç›´æ¥å†™å‡ºæœ€ä¼˜è§£è‚¯å®šå¥½ï¼Œä½†æ˜¯å®åœ¨æ²¡åŠæ³•äº†æš´åŠ›æ³•ä¹Ÿä¸å¤±ä¸ºä¸€ç§å¥½æ–¹æ³•ï¼Œæœ€ä¼˜è§£å¯ä»¥ä¸‹æ¥åå†ç ”ç©¶ã€‚</p><p><strong>hashæŸ¥æ‰¾</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) {</span><br><span class="line">        HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">        <span class="comment">//ç¬¬ä¸€éæŠŠæ‰€æœ‰çš„å…ƒç´ å’Œç´¢å¼•å­˜åˆ°hashMapä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">            map.put(nums[i],i);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å†æŸ¥æ‰¾hash</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">            <span class="comment">//ä¸èƒ½é‡å¤æ‰€ä»¥ ä¸‹æ ‡éœ€è¦é™åˆ¶ä¸‹</span></span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(target-nums[i]) && map.get(target-nums[i])!=i){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{i,map.get(target-nums[i])};</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{};</span><br><span class="line">    }</span><br></nums.length;i++)></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®å¯ä»¥åªhashä¸€éï¼Œhashä¸¤éä¸»è¦è€ƒè™‘é¡ºåºçš„é—®é¢˜ã€‚ç›´æ¥åˆ©ç”¨hashMapæŸ¥æ‰¾ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] twoSum2(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) {</span><br><span class="line">    HashMap<integer,integer> map=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//ä¸èƒ½é‡å¤æ‰€ä»¥ ä¸‹æ ‡éœ€è¦é™åˆ¶ä¸‹</span></span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(target-nums[i]) && map.get(target-nums[i])!=i){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{i,map.get(target-nums[i])};</span><br><span class="line">        }</span><br><span class="line">        map.put(nums[i],i);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{};</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æäº¤è®°å½•ä¸Šæœ€å¿«çš„åšæ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) {</span><br><span class="line">        <span class="keyword">int</span> index;</span><br><span class="line">        <span class="keyword">int</span> indexArrayMax=<span class="number">2047</span>;</span><br><span class="line">        <span class="keyword">int</span>[] indexArrays=<span class="keyword">new</span> <span class="keyword">int</span>[indexArrayMax+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> diff;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++){< span><br><span class="line">            diff=target-nums[i];</span><br><span class="line">            <span class="comment">//i=0æ—¶ç´¢å¼•æ— æ•ˆ,æ‰€ä»¥å•ç‹¬å¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span>(diff==nums[<span class="number">0</span>]){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{<span class="number">0</span>,i};</span><br><span class="line">            }</span><br><span class="line">            index=diff&indexArrayMax;</span><br><span class="line">            <span class="keyword">if</span>(indexArrays[index]!=<span class="number">0</span>){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{indexArrays[index],i};</span><br><span class="line">            }</span><br><span class="line">            indexArrays[nums[i]&indexArrayMax]=i;   </span><br><span class="line">        }   </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">}</span><br></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><p>æ²¡çœ‹æ‡‚ã€‚ã€‚ã€‚ç¾¤é‡Œé—®äº†ä¸‹ï¼Œæ‰‹åŠ¨hashã€‚ã€‚ã€‚ã€‚ä»¥åå†æ¥ç ”ç©¶å§.</p><h2 id="167-ä¸¤æ•°ä¹‹å’Œ-II-è¾“å…¥æœ‰åºæ•°ç»„"><a href="#167-ä¸¤æ•°ä¹‹å’Œ-II-è¾“å…¥æœ‰åºæ•°ç»„" class="headerlink" title="167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„"></a><a href="https://leetcode-cn.com/problems/two-sum-ii-input-array-is-sorted/" target="_blank" rel="noopener">167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„</a></h2><p>ç»™å®šä¸€ä¸ªå·²æŒ‰ç…§<strong>å‡åºæ’åˆ—</strong> çš„æœ‰åºæ•°ç»„ï¼Œæ‰¾åˆ°ä¸¤ä¸ªæ•°ä½¿å¾—å®ƒä»¬ç›¸åŠ ä¹‹å’Œç­‰äºç›®æ ‡æ•°ã€‚</p><p>å‡½æ•°åº”è¯¥è¿”å›è¿™ä¸¤ä¸ªä¸‹æ ‡å€¼ index1 å’Œ index2ï¼Œå…¶ä¸­ index1 å¿…é¡»å°äº index2<em>ã€‚</em></p><p><strong>è¯´æ˜:</strong></p><ul><li>è¿”å›çš„ä¸‹æ ‡å€¼ï¼ˆindex1 å’Œ index2ï¼‰ä¸æ˜¯ä»é›¶å¼€å§‹çš„ã€‚</li><li>ä½ å¯ä»¥å‡è®¾æ¯ä¸ªè¾“å…¥åªå¯¹åº”å”¯ä¸€çš„ç­”æ¡ˆï¼Œè€Œä¸”ä½ ä¸å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„å…ƒç´ ã€‚</li></ul><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: numbers = [<span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>], target = <span class="number">9</span></span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è§£é‡Š: <span class="number">2</span> ä¸ <span class="number">7</span> ä¹‹å’Œç­‰äºç›®æ ‡æ•° <span class="number">9</span> ã€‚å› æ­¤ index1 = <span class="number">1</span>, index2 = <span class="number">2</span> ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸¤æ•°ä¹‹å’Œçš„å˜ç§ï¼Œçœ‹è§<strong>æœ‰åº</strong>å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨äºŒåˆ†æ¥åšï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(NlogN)</code>ï¼Œç›¸å¯¹è¾ƒé«˜</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] twoSum(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {</span><br><span class="line">        <span class="keyword">if</span>(numbers==<span class="keyword">null</span>||numbers.length<=<span class="number">0</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> left=<span class="number">0</span>,right=numbers.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(right>left){</span><br><span class="line">            <span class="keyword">int</span> sum=numbers[right]+numbers[left];</span><br><span class="line">            <span class="keyword">if</span>(sum==target){</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{left+<span class="number">1</span>,right+<span class="number">1</span>};</span><br><span class="line">            }<span class="keyword">if</span>(sum<target){< span><br><span class="line">                left++;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                right--;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></target){<></span></pre></td></tr></tbody></table></figure></div><p><strong>å¯¹æ’æŒ‡é’ˆ</strong>ï¼Œå¾ˆåŸºç¡€çš„é¢˜ã€‚</p><h2 id="11-ç››æœ€å¤šæ°´çš„å®¹å™¨"><a href="#11-ç››æœ€å¤šæ°´çš„å®¹å™¨" class="headerlink" title="11. ç››æœ€å¤šæ°´çš„å®¹å™¨"></a><a href="https://leetcode-cn.com/problems/container-with-most-water/" target="_blank" rel="noopener">11. ç››æœ€å¤šæ°´çš„å®¹å™¨</a></h2><p>ç»™å®š <em>n</em> ä¸ªéè´Ÿæ•´æ•° <em>a</em>1ï¼Œ<em>a</em>2ï¼Œâ€¦ï¼Œ<em>a</em>nï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹ (<em>i</em>, <em>ai</em>) ã€‚åœ¨åæ ‡å†…ç”» <em>n</em> æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ <em>i</em> çš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º (<em>i</em>, <em>ai</em>) å’Œ (<em>i</em>, 0)ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ <em>x</em> è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</p><p><strong>è¯´æ˜ï¼š</strong>ä½ ä¸èƒ½å€¾æ–œå®¹å™¨ï¼Œä¸” <em>n</em> çš„å€¼è‡³å°‘ä¸º 2ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190505/1uze479AHHLo.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„ [1,8,6,2,5,4,8,3,7]ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º 49ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">7</span>]</span><br><span class="line">è¾“å‡º: <span class="number">49</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(<span class="keyword">int</span>[] height)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> len=height.length;</span><br><span class="line">        <span class="keyword">if</span>(len==<span class="number">0</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<len-<span class="number">1</len-<span></span>;i++){<br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j<len;j++){< span><br><span class="line">                <span class="keyword">int</span> minHight=height[i]>height[j]?height[j]:height[i];</span><br><span class="line">                max=max>(j-i)*minHight ? max:(j-i)*minHight;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line"> }</span><br></len;j++){<></span></pre></td></tr></tbody></table></figure></div><p>522msï¼Œ13% å«åº•äº†ï¼Œåˆ«é—®ï¼Œé—®å°±æ˜¯æš´åŠ›ğŸ¤£</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(<span class="keyword">int</span>[] height)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> len=height.length;</span><br><span class="line">        <span class="keyword">if</span>(len==<span class="number">0</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> head=<span class="number">0</span>,tail=len-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">while</span>(head<len){< span><br><span class="line">            tail=len-<span class="number">1</span>; <span class="comment">//å¼€å§‹æ”¹çš„æ—¶å€™è¿™ä¸€å¥å¿˜äº†åŠ </span></span><br><span class="line">            <span class="keyword">while</span>(head!=tail){</span><br><span class="line">                <span class="keyword">int</span> minHight=height[tail]>height[head]?height[head]:height[tail];</span><br><span class="line">                max=max>(tail-head)*minHight ? max:(tail-head)*minHight;</span><br><span class="line">                <span class="keyword">if</span>(height[head]<=height[tail]){</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }<span class="keyword">else</span>{</span><br><span class="line">                    tail--;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            head++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></len){<></span></pre></td></tr></tbody></table></figure></div><p>212msï¼Œ40%ï¼Œåˆ©ç”¨åŒæŒ‡é’ˆç¨å¾®ä¼˜åŒ–äº†ä¸‹ï¼Œä¾ç„¶æ˜¯éå†æ‰¾æ¯ä¸ªæŸ±çš„æœ€å¤§å€¼ï¼Œä½†æ˜¯å°¾æŒ‡é’ˆåœ¨ç§»åŠ¨æ—¶å…ˆåˆ¤æ–­ä¸‹ï¼Œå¦‚æœæ¯”å¤´æŒ‡é’ˆå¤§å°±ç›´æ¥breakï¼Œå› ä¸º<strong>å·²ç»æ˜¯æœ€å¤§å€¼</strong>äº†ï¼Œtailæ˜¯ä»å³å‘å·¦ç§»åŠ¨çš„</p><blockquote><p>å¼€å§‹æ”¹çš„æ—¶å€™å¿˜äº†å°†å°¾æŒ‡é’ˆå½’ä½ï¼Œç»“æœè¿˜å¯¹äº†ï¼Œè€Œä¸”90%çš„beatsâ€¦..å“ˆå“ˆå“ˆï¼Œè¯¯æ‰“è¯¯æ’æäº†ä¸ªæœ€ä¼˜è§£å‡ºæ¥ã€‚</p></blockquote><p><strong>è§£æ³•äºŒ</strong></p><p>ä¸Šé¢ä¸¤ç§å…¶å®éƒ½æ˜¯æš´åŠ›ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½å¾ˆé«˜</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxArea</span><span class="params">(<span class="keyword">int</span>[] height)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> len=height.length;</span><br><span class="line">        <span class="keyword">if</span>(len==<span class="number">0</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> left=<span class="number">0</span>,right=len-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">while</span>(left<right) {< span><br><span class="line">            <span class="keyword">int</span> minHight=height[left]>height[right]?height[right]:height[left];</span><br><span class="line">            max=max>(right-left)*minHight ? max:(right-left)*minHight;</span><br><span class="line">            <span class="keyword">if</span>(height[left]<=height[right]){</span><br><span class="line">                left++;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                right--;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">}</span><br></right)></span></pre></td></tr></tbody></table></figure></div><p><strong>æ ‡å‡†</strong>çš„æœ€ä¼˜è§£ï¼Œè¿™é¢˜ä¸»è¦è€ƒå¯Ÿçš„å°±æ˜¯åŒæŒ‡é’ˆï¼Œä¸¤ä¸ªæŒ‡é’ˆä¸€å¤´ä¸€å°¾ï¼Œå…ˆç®—å‡ºè¿™ä¸ªå¤´å°¾çš„é¢ç§¯å¤§å°ï¼Œç„¶åä¸‹ä¸€æ­¥æ€è€ƒæ€ä¹ˆæ‰©å¤§è¿™ä¸ªåŒºåŸŸçš„é¢ç§¯ï¼Œç»“åˆé¢˜ä¸Šé¢çš„å›¾ï¼ˆæœ€å·¦è¾¹ä¸ºå¤´ï¼Œæœ€å³è¾¹ä¸ºå°¾ï¼‰</p><p><img alt="mark" data-src="http://static.imlgw.top///20190505/1uze479AHHLo.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è¿™ä¸ªæ—¶å€™å¦‚æœç§»åŠ¨å°¾æŒ‡é’ˆï¼Œæ˜æ˜¾é¢ç§¯åªå¯èƒ½å‡å°ï¼Œæ‰€ä»¥åªæœ‰ç§»åŠ¨å¤´æŒ‡é’ˆæ‰æœ‰å¯èƒ½å¢å¤§è¿™ä¸ªåŒºåŸŸçš„é¢ç§¯ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥çœæ‰å¾ˆå¤šæ²¡å¿…è¦çš„è®¡ç®—ï¼Œæœ‰ç‚¹åƒè´ªå¿ƒï¼Œæ—¶é—´å¤æ‚åº¦O(N)</p><h2 id="15-ä¸‰æ•°ä¹‹å’Œ"><a href="#15-ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="15. ä¸‰æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/3sum/" target="_blank" rel="noopener">15. ä¸‰æ•°ä¹‹å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å« <em>n</em> ä¸ªæ•´æ•°çš„æ•°ç»„ <code>nums</code>ï¼Œåˆ¤æ–­ <code>nums</code> ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  <em>aï¼Œbï¼Œc ï¼Œ*ä½¿å¾— *a + b + c =</em> 0 ï¼Ÿæ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ä¾‹å¦‚, ç»™å®šæ•°ç»„ nums = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">4</span>]ï¼Œ</span><br><span class="line"></span><br><span class="line">æ»¡è¶³è¦æ±‚çš„ä¸‰å…ƒç»„é›†åˆä¸ºï¼š</span><br><span class="line">[</span><br><span class="line">  [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">  [-<span class="number">1</span>, -<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p>æƒ³å¤ªå¤šäº†ï¼Œæ²¡åšå‡ºæ¥ï¼Œçœ‹äº†è¯„è®ºæ‰åšå‡ºæ¥ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List<list<integer>> threeSum(<span class="keyword">int</span>[] nums) {</list<integer></span><br><span class="line">    List<list<integer>> list = <span class="keyword">new</span> ArrayList();</list<integer></span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    <span class="comment">// å…ˆæ’åº  o(nlogn)</span></span><br><span class="line">    <span class="keyword">int</span> len = nums.length;</span><br><span class="line">    <span class="keyword">if</span>(nums == <span class="keyword">null</span> || len < <span class="number">3</span>) <span class="keyword">return</span> list;</span><br><span class="line">    <span class="comment">// å®Œå¤‡æ€§</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < len-<span class="number">2</span>; i++) {</span><br><span class="line">        <span class="keyword">if</span>(nums[i]><span class="number">0</span>){</span><br><span class="line">            <span class="comment">//å¤§äº0äº†ï¼Œåé¢çš„å’ŒåŠ èµ·æ¥è‚¯å®š>0äº†</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//éå†æ•°ç»„ï¼Œç›¸åŒçš„å…ƒç´ åªéœ€è¦éå†ä¸€éï¼Œä¸ç„¶ä¼šé‡å¤</span></span><br><span class="line">        <span class="keyword">if</span>(i > <span class="number">0</span> && nums[i] == nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// ä¸€æ¬¡å»é‡ä¼˜åŒ–</span></span><br><span class="line">        <span class="comment">//å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class="line">        <span class="keyword">int</span> L = i+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å°¾å…ƒç´ </span></span><br><span class="line">        <span class="keyword">int</span> R = len-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(L<r){< span><br><span class="line">            <span class="keyword">int</span> sum = nums[i] + nums[L] + nums[R];</span><br><span class="line">            <span class="keyword">if</span>(sum == <span class="number">0</span>){</span><br><span class="line">                list.add(Arrays.asList(nums[i],nums[L],nums[R]));</span><br><span class="line">                <span class="comment">//-4 -1 -1 0 1 2</span></span><br><span class="line">                <span class="keyword">while</span> (L<r && nums[l]="=" nums[l+<span class="number">1</r></span>]) L++;</r){<></span><br><span class="line">                <span class="comment">//äºŒæ¬¡å»é‡ä¼˜åŒ–</span></span><br><span class="line">                <span class="keyword">while</span> (L<r && nums[r]="=" nums[r-<span class="number">1</r></span>]) R--;<br><span class="line">                L++;</span><br><span class="line">                R--;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (sum < <span class="number">0</span>){ <span class="comment">//å°äº0æ‰€ä»¥è¦å¢å¤§L,é€¼è¿‘0 else R--;</span></span><br><span class="line">                 L++;   </span><br><span class="line">            } <span class="keyword">else</span> R--; <span class="comment">//å¤§äº0å°±å‡å°R</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä»£ç æ€è·¯å°±æ˜¯éå†æ•°ç»„ï¼Œç„¶åä»<strong>i</strong>ä½ç½®åé¢çš„æ•°ç»„ä¸­æ‰¾èƒ½å’Œ<strong>i</strong>å‡‘æˆä¸€å¯¹çš„å…ƒç´ ï¼Œè¿™é‡Œå…³é”®å°±æ˜¯è¿™é‡Œæ€ä¹ˆæ‰¾è¿™ä¸¤ä¸ªå…ƒç´  æ»¡è¶³nums[L]+nums[R]=-nums[i]ï¼Œé—®é¢˜å°±è½¬åŒ–æˆäº†ä¸Šé¢çš„<strong>ä¸¤æ•°ä¹‹å’Œ</strong>ï¼Œä½†æ˜¯è¿™é‡Œç”¨æš´åŠ›æ³•è‚¯å®šæ˜¯è¿‡ä¸äº†çš„ï¼ŒhashMapè¿™é‡Œä¹Ÿä¸å¥½ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥å…ˆç»™æ•°ç»„æ’ä¸ªåºï¼Œç„¶ååˆ©ç”¨<strong>åŒæŒ‡é’ˆå¯¹æ’</strong>ï¼Œé€æ¸é€¼è¿‘0ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯äºŒæ¬¡å»é‡ï¼Œå¦‚ä¸‹å›¾</p><p><img alt="mark" data-src="http://static.imlgw.top///20190505/5YlNbCLe57fb.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å½“æ‰¾åˆ°ä¸€ç»„æ—¶æœ‰å¯èƒ½Lï¼ŒRçš„ä¸‹ä¸€ä¸ªä½ç½®çš„å€¼æ²¡å˜è¿™æ ·å°±ä¼šå¯¼è‡´é‡å¤ã€‚</p><h2 id="16-æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ"><a href="#16-æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/3sum-closest/" target="_blank" rel="noopener">16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…æ‹¬ <em>n</em> ä¸ªæ•´æ•°çš„æ•°ç»„ <code>nums</code> å’Œ ä¸€ä¸ªç›®æ ‡å€¼ <code>target</code>ã€‚æ‰¾å‡º <code>nums</code> ä¸­çš„ä¸‰ä¸ªæ•´æ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œä¸ <code>target</code> æœ€æ¥è¿‘ã€‚è¿”å›è¿™ä¸‰ä¸ªæ•°çš„å’Œã€‚å‡å®šæ¯ç»„è¾“å…¥åªå­˜åœ¨å”¯ä¸€ç­”æ¡ˆã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ä¾‹å¦‚ï¼Œç»™å®šæ•°ç»„ nums = [-<span class="number">1</span>ï¼Œ<span class="number">2</span>ï¼Œ<span class="number">1</span>ï¼Œ-<span class="number">4</span>], å’Œ target = <span class="number">1</span>.</span><br><span class="line"></span><br><span class="line">ä¸ target æœ€æ¥è¿‘çš„ä¸‰ä¸ªæ•°çš„å’Œä¸º <span class="number">2</span>. (-<span class="number">1</span> + <span class="number">2</span> + <span class="number">1</span> = <span class="number">2</span>).</span><br></pre></td></tr></tbody></table></figure></div><p>è·Ÿä¸Šé¢çš„é¢˜å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸»è¦æ—¶ä¸ºäº†æ£€æµ‹ä¸‹è‡ªå·±ä¸Šé¢çš„ææ‡‚äº†æ²¡</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">threeSumClosest</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||len<<span class="number">3</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    <span class="keyword">int</span> closest=nums[<span class="number">0</span>]+nums[<span class="number">1</span>]+nums[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<len-<span class="number">2</len-<span></span>;i++) {<br><span class="line">        <span class="keyword">if</span>(i!=<span class="number">0</span>&&nums[i]==nums[i-<span class="number">1</span>])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">//è·³è¿‡é‡å¤å…ƒç´ æé«˜æ•ˆç‡</span></span><br><span class="line">        <span class="keyword">int</span> L=i+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> R=len-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(L<r){< span><br><span class="line">            <span class="keyword">int</span> sum=nums[L]+nums[R]+nums[i];</span><br><span class="line">            closest=Math.abs(closest-target)>Math.abs(sum-target)?sum:closest;</span><br><span class="line">            <span class="keyword">if</span>(sum==target){</span><br><span class="line">                <span class="keyword">return</span> target;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span>(sum>target){</span><br><span class="line">                <span class="keyword">while</span>(L<r && nums[r]="=nums[R-<span" class="number">1</r></span>])R--;</r){<></span><br><span class="line">                R--;</span><br><span class="line">            } <span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">while</span>(L<r && nums[l]="=nums[L+<span" class="number">1</r></span>])L++;<br><span class="line">                L++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> closest;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€é<strong>bugfree</strong>ï¼Œå…¶å®éƒ½æŒºç®€å•ï¼Œè¿™ä¸¤é¢˜æˆ‘ä¸€ç›´åœ¨è€ƒè™‘åˆ«çš„ç®—æ³•ï¼Œæˆ‘æƒ³çš„æ˜¯æ’åºåä»ä¸¤éå‘ä¸­é—´ç„¶åâ€¦å°±ä¸bbäº†ï¼Œåä¹‹å¾ˆå¤šæ²¡è€ƒè™‘åˆ°çš„åœ°æ–¹ã€‚</p><h2 id="18-å››æ•°ä¹‹å’Œ"><a href="#18-å››æ•°ä¹‹å’Œ" class="headerlink" title="18. å››æ•°ä¹‹å’Œ"></a><a href="https://leetcode-cn.com/problems/4sum/" target="_blank" rel="noopener">18. å››æ•°ä¹‹å’Œ</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªç›®æ ‡å€¼ <code>target</code>ï¼Œåˆ¤æ–­ <code>nums</code> ä¸­æ˜¯å¦å­˜åœ¨å››ä¸ªå…ƒç´  aï¼Œbï¼Œc å’Œ d ï¼Œä½¿å¾— <code>a + b + c + d</code> çš„å€¼ä¸ <code>target</code> ç›¸ç­‰ï¼Ÿæ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„å››å…ƒç»„ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p>ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„å››å…ƒç»„ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®šæ•°ç»„ nums = [<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, -<span class="number">2</span>, <span class="number">2</span>]ï¼Œå’Œ target = <span class="number">0</span>ã€‚</span><br><span class="line"></span><br><span class="line">æ»¡è¶³è¦æ±‚çš„å››å…ƒç»„é›†åˆä¸ºï¼š</span><br><span class="line">[</span><br><span class="line">  [-<span class="number">1</span>,  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">  [-<span class="number">2</span>, -<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  [-<span class="number">2</span>,  <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸‰æ•°ä¹‹å’Œä¸€æ ·ï¼Œä½†æ˜¯æ›´åŠ ç¹çäº†ï¼Œæäº¤äº†5ï¼Œ6æ¬¡æ‰ACï¼Œè¿˜æ˜¯çœ‹äº†åˆ«äººçš„ä»£ç çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List<list<integer>> fourSum(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target) {</list<integer></span><br><span class="line">    List<list<integer>> res=<span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    <span class="keyword">int</span> n=nums.length;</span><br><span class="line">    <span class="comment">//0 0 -1 1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<n-<span class="number">3</n-<span></span>;i++) {<br><span class="line">        <span class="comment">//è¿™é‡Œæˆ‘å¼€å§‹å†™çš„æ˜¯å’Œåä¸€ä¸ªæ¯”è¾ƒï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0è¿™ç§è¿‡ä¸äº†</span></span><br><span class="line">        <span class="keyword">if</span>(i><span class="number">0</span> && nums[i]==nums[i-<span class="number">1</span>])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[i]+nums[i+<span class="number">1</span>]+nums[i+<span class="number">2</span>]+nums[i+<span class="number">3</span>]>target) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[i]+nums[n-<span class="number">1</span>]+nums[n-<span class="number">2</span>]+nums[n-<span class="number">3</span>]<target) <span class="keyword">continue</target)></span>;<br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j<n-<span class="number">2</n-<span></span>;j++) {<br><span class="line">            <span class="comment">//åŒä¸Š</span></span><br><span class="line">            <span class="keyword">if</span>(j>i+<span class="number">1</span>&&nums[j]==nums[j-<span class="number">1</span>])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]+nums[j]+nums[j+<span class="number">2</span>]+nums[j+<span class="number">1</span>]>target) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]+nums[j]+nums[n-<span class="number">2</span>]+nums[n-<span class="number">1</span>]<target) <span class="keyword">continue</target)></span>;<br><span class="line">            <span class="keyword">int</span> two=nums[i]+nums[j];</span><br><span class="line">            <span class="comment">//å·¦å³è¾¹ç•Œ</span></span><br><span class="line">            <span class="keyword">int</span> left=j+<span class="number">1</span>,right=n-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(left<right){< span><br><span class="line">                <span class="keyword">if</span> (target-two==nums[left]+nums[right]) {</span><br><span class="line">                    res.add(Arrays.asList(nums[i],nums[j],nums[left],nums[right]));</span><br><span class="line">                    <span class="comment">//æƒ³æ¸…æ¥šä»€ä¹ˆæ—¶å€™è·³,æ”¾å¤–é¢å°±é”™äº†</span></span><br><span class="line">                    <span class="keyword">while</span>(left<right && nums[left]="=nums[left+<span" class="number">1</right></span>]){left++;};</right){<></span><br><span class="line">                    <span class="keyword">while</span>(left<right && nums[right]="=nums[right-<span" class="number">1</right></span>]){right--;};<br><span class="line">                    left++;</span><br><span class="line">                    right--;</span><br><span class="line">                }<span class="keyword">else</span> <span class="keyword">if</span> (target-two>nums[left]+nums[right]) {</span><br><span class="line">                    left++;</span><br><span class="line">                }<span class="keyword">else</span>{</span><br><span class="line">                    right--;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="26-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"><a href="#26-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹" class="headerlink" title="26. åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"></a><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/" target="_blank" rel="noopener">26. åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a></h2><p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„ï¼Œä½ éœ€è¦åœ¨<strong>åŸåœ°</strong>åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨<strong>åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®šæ•°ç»„ nums = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>], </span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ <span class="number">2</span>, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º <span class="number">1</span>, <span class="number">2</span>ã€‚ </span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ <span class="number">5</span>, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å®ä¸ç›¸ç’ï¼Œè¿™é¢˜ä¸€å¼€å§‹æˆ‘æš´åŠ›åšçš„ï¼Œå†’æ³¡çš„æ€æƒ³ï¼Œå¤ªè ¢äº†ğŸ˜… ï¼Œæ³¨æ„é¢˜ç›®è¦æ±‚ç©ºé—´å¤æ‚åº¦O(1)</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j < nums.length; j++) {</span><br><span class="line">        <span class="keyword">if</span> (nums[j] != nums[i]) {</span><br><span class="line">            nums[i++] = nums[j];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åŒæŒ‡é’ˆï¼ŒçœŸçš„ç”¨çš„æŒºå¤šçš„ã€‚</p><h2 id="80-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹-II"><a href="#80-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹-II" class="headerlink" title="80. åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II"></a><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array-ii/" target="_blank" rel="noopener">80. åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II</a></h2><p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„ï¼Œä½ éœ€è¦åœ¨<strong>åŸåœ°</strong>åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨<strong>åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = <span class="number">5</span>, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span> ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = <span class="number">7</span>, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span> ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><p>ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢?</p><p>è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥<strong>â€œå¼•ç”¨â€</strong>æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</p><p>ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´</span></span><br><span class="line"><span class="keyword">int</span> len = removeDuplicates(nums);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</span></span><br><span class="line"><span class="comment">// æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­è¯¥é•¿åº¦èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < len; i++) {</span><br><span class="line">    print(nums[i]);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸Šé¢é¢˜ç›®åŠ ä¸€ç‚¹ï¼Œåœ¨å‰åç›¸ç­‰çš„æ—¶å€™åˆ¤æ–­indexå‰æ˜¯å¦å·²ç»æœ‰ä¸¤ä¸ªç›¸ç­‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<nums.length;i++){< span><br><span class="line">        <span class="keyword">if</span>(nums[i]!=nums[i-<span class="number">1</span>] || (nums[i]==nums[i-<span class="number">1</span>] && nums[index-<span class="number">2</span>]!=nums[index-<span class="number">1</span>])){</span><br><span class="line">            nums[index++]=nums[i];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">}</span><br></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><h2 id="27-ç§»é™¤å…ƒç´ "><a href="#27-ç§»é™¤å…ƒç´ " class="headerlink" title="27. ç§»é™¤å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/remove-element/" target="_blank" rel="noopener">27. ç§»é™¤å…ƒç´ </a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <em>nums</em> å’Œä¸€ä¸ªå€¼ <em>val<em>ï¼Œä½ éœ€è¦*</em>åŸåœ°**ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº *val</em> çš„å…ƒç´ ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨<strong>åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><p>å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>], val = <span class="number">3</span>,</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ <span class="number">2</span>, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º <span class="number">2</span>ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®š nums = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">2</span>], val = <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ <span class="number">5</span>, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>ã€‚</span><br><span class="line"></span><br><span class="line">æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p>ç›®æ ‡å…ƒç´ å¤šæ—¶</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeElement</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> val)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j < nums.length; j++) {</span><br><span class="line">        <span class="keyword">if</span> (nums[j] != val) {</span><br><span class="line">            nums[i++] = nums[j];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç›®æ ‡å…ƒç´ å°‘æ—¶</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeElement2</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> val)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> n = nums.length;</span><br><span class="line">    <span class="keyword">while</span> (i < n) {</span><br><span class="line">        <span class="keyword">if</span> (nums[i] == val) {</span><br><span class="line">            nums[i] = nums[--n];</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            i++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="283-ç§»åŠ¨é›¶"><a href="#283-ç§»åŠ¨é›¶" class="headerlink" title="283. ç§»åŠ¨é›¶"></a><a href="https://leetcode-cn.com/problems/move-zeroes/" target="_blank" rel="noopener">283. ç§»åŠ¨é›¶</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>nums</code>ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ <code>0</code> ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">12</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜</strong>:</p><ul><li><p>å¿…é¡»åœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼Œä¸èƒ½æ‹·è´é¢å¤–çš„æ•°ç»„ã€‚</p></li><li><p>å°½é‡å‡å°‘æ“ä½œæ¬¡æ•°ã€‚</p></li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">1</span>){</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++){< span><br><span class="line">            <span class="keyword">if</span>(nums[i]!=<span class="number">0</span>){</span><br><span class="line">                nums[index++]=nums[i];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=index;i<nums.length;i++){< span><br><span class="line">            nums[i]=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">}</span><br></nums.length;i++){<></span></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®å°±æ˜¯å€ŸåŠ©ä¸Šé¢é¢˜ç›®çš„æ€è·¯ï¼Œæœ€åå†è¡¥0å°±okäº†ï¼Œå…¶å®ä¹Ÿè¿˜å¯ä»¥ä¼˜åŒ–ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> m=<span class="number">0</span>; <span class="comment">//[0,k)ä¸ºé0å…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++){< span><br><span class="line">        <span class="keyword">if</span>(nums[i]!=<span class="number">0</span>){</span><br><span class="line">            <span class="keyword">if</span>(i!=m){</span><br><span class="line">                <span class="keyword">int</span> temp=nums[i];</span><br><span class="line">                nums[i]=nums[m];</span><br><span class="line">                nums[m]=temp;   </span><br><span class="line">            }</span><br><span class="line">            m++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><h2 id="31-ä¸‹ä¸€ä¸ªæ’åˆ—"><a href="#31-ä¸‹ä¸€ä¸ªæ’åˆ—" class="headerlink" title="31. ä¸‹ä¸€ä¸ªæ’åˆ—"></a><a href="https://leetcode-cn.com/problems/next-permutation/" target="_blank" rel="noopener">31. ä¸‹ä¸€ä¸ªæ’åˆ—</a></h2><p>å®ç°è·å–ä¸‹ä¸€ä¸ªæ’åˆ—çš„å‡½æ•°ï¼Œç®—æ³•éœ€è¦å°†ç»™å®šæ•°å­—åºåˆ—é‡æ–°æ’åˆ—æˆå­—å…¸åºä¸­ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ã€‚</p><p>å¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ï¼Œåˆ™å°†æ•°å­—é‡æ–°æ’åˆ—æˆæœ€å°çš„æ’åˆ—ï¼ˆå³å‡åºæ’åˆ—ï¼‰ã€‚</p><p>å¿…é¡»<strong>åŸåœ°</strong>ä¿®æ”¹ï¼Œåªå…è®¸ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼Œè¾“å…¥ä½äºå·¦ä¾§åˆ—ï¼Œå…¶ç›¸åº”è¾“å‡ºä½äºå³ä¾§åˆ—ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> â†’ <span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span></span><br><span class="line"><span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span> â†’ <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line"><span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span> â†’ <span class="number">1</span>,<span class="number">5</span>,<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p>ç›´æ¥ä¸Šæœ€ä¼˜è§£å§ï¼Œè¿™é¢˜æš´åŠ›æ³•O(N!)ï¼Œç©ºé—´ä¹Ÿè¶…è¿‡äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">nextPermutation</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||len<=<span class="number">1</span>){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=len-<span class="number">2</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">while</span>(i>=<span class="number">0</span> &&nums[i]>=nums[i+<span class="number">1</span>]){</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªå³°å€¼å·¦ç›¸é‚»çš„å…ƒç´ ï¼ˆä»å·¦åˆ°å³ï¼‰</span></span><br><span class="line">            i--;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//é€†åºçš„, æ²¡æœ‰æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">if</span>(i==-<span class="number">1</span>){</span><br><span class="line">            reverse(nums,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ‰¾åˆ°å³°å€¼å³è¾¹ [i+1 , len-1] æœ€åä¸€ä¸ªæ¯”i å¤§çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=len-<span class="number">1</span>;j>i;j--) {</span><br><span class="line">            <span class="keyword">if</span>(nums[j]>nums[i]){</span><br><span class="line">                swap(nums,j,i);</span><br><span class="line">                reverse(nums,i+<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//ç¿»è½¬æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> start)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=start,j=nums.length-<span class="number">1</span>;i<j;i++,j--) {< span><br><span class="line">        swap(nums,i,j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">private</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> temp = nums[i];</span><br><span class="line">    nums[i] = nums[j];</span><br><span class="line">    nums[j] = temp;</span><br><span class="line">}</span><br></j;i++,j--)></span></pre></td></tr></tbody></table></figure></div><ul><li><p>ç¬¬ä¸€æ­¥ï¼Œé€†åºæ‰¾åˆ°ç¬¬ä¸€ä¸ªå³°å€¼çš„å·¦è¾¹ç¬¬ä¸€ä¸ªå…ƒç´  <code>a[i-1]</code>ã€‚</p></li><li><p>å°†å³°å€¼å³è¾¹çš„<strong>æœ€å°çš„</strong>æ¯”<code>a[i-1]</code>å¤§çš„<code>a[j]</code>(å…¶å®å°±æ˜¯<code>å³è¾¹æœ€åä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ </code>)å…ƒç´ ä¸<strong>a[i-1]</strong>äº¤æ¢ã€‚</p></li><li><p>ç¿»è½¬åˆšåˆšè°ƒæ•´è¿‡<code>a[i-1]</code>åé¢çš„é€†åºçš„æ•°ç»„(<code>a[i]-->a[len-1]</code>)ã€‚</p></li></ul><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190728/G6uqlPyjPLdV.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>è‡³äºä¸ºä»€ä¹ˆè¿™æ ·åšè‡ªå·±æ¨¡æ‹Ÿä¸‹å°±æ‡‚äº†ï¼Œé€†åºéƒ¨åˆ†æ˜¯æ²¡æœ‰ä¸‹ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ’åˆ—çš„ï¼Œæ‰€ä»¥å¦‚æœæƒ³è®©æ•´ä¸ªæ’åˆ—å˜å¤§åªèƒ½ä»è¿™ä¸ªé€†åºçš„æ’åˆ—é‡Œé¢é€‰ä¸€ä¸ªæ¯”é€†åºå‰æœ€åä¸€ä¸ªâ€™â€™ç¨å¾®â€™â€™å¤§ä¸€ç‚¹çš„å…ƒç´ ä¸ä¹‹äº¤æ¢ï¼Œç„¶åå°†æ•´ä¸ªé€†åºçš„éƒ¨åˆ†ç¿»è½¬å°±æ˜¯ä¸‹ä¸€ä¸ªæ’åˆ—ï¼Œè¿™é¢˜çœ‹äº†é¢˜è§£åå¤„ç†è¾¹ç•Œåˆå¤„ç†äº†åŠå¤©ï¼Œ<strong>å¾ªç¯é‡Œé¢çš„å¾ªç¯è¾¹ç•Œæ¡ä»¶ä¸€å®šè¦æ³¨æ„</strong></p><h2 id="556-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -III"><a href="#556-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -III" class="headerlink" title="556. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  III"></a><a href="https://leetcode-cn.com/problems/next-greater-element-iii/" target="_blank" rel="noopener">556. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  III</a></h2><p>ç»™å®šä¸€ä¸ª32ä½æ­£æ•´æ•° nï¼Œä½ éœ€è¦æ‰¾åˆ°æœ€å°çš„32ä½æ•´æ•°ï¼Œå…¶ä¸ n ä¸­å­˜åœ¨çš„ä½æ•°å®Œå…¨ç›¸åŒï¼Œå¹¶ä¸”å…¶å€¼å¤§äºnã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„32ä½æ•´æ•°ï¼Œåˆ™è¿”å›-1ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">12</span></span><br><span class="line">è¾“å‡º: <span class="number">21</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">21</span></span><br><span class="line">è¾“å‡º: -<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸Šé¢é‚£ä¸€é¢˜ä¸€æ ·ï¼Œæƒå½“å¤ä¹ äº†ä¸€ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">nextGreaterElement</span><span class="params">(<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">while</span>(n/<span class="number">10</span>><span class="number">0</span>){</span><br><span class="line">        sb.append(n%<span class="number">10</span>);</span><br><span class="line">        n/=<span class="number">10</span>;</span><br><span class="line">    }</span><br><span class="line">    sb.append(n);</span><br><span class="line">    System.out.println(sb);</span><br><span class="line">    <span class="keyword">char</span>[] nums=sb.reverse().toString().toCharArray();</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=len-<span class="number">1</span>;i><span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">if</span> (nums[i]>nums[i-<span class="number">1</span>]) { <span class="comment">//é€†åºçš„å³°å€¼i</span></span><br><span class="line">            <span class="keyword">if</span> (i==<span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>; </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=len-<span class="number">1</span>;j>=i;j--) {</span><br><span class="line">                <span class="keyword">if</span> (nums[j]>nums[i-<span class="number">1</span>]) {</span><br><span class="line">                    swap(nums,j,i-<span class="number">1</span>);</span><br><span class="line">                    reverse(nums,i,len-<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">return</span> Long.valueOf(<span class="keyword">new</span> String(nums))>Integer.MAX_VALUE?-<span class="number">1</span>:Integer.valueOf(<span class="keyword">new</span> String(nums));</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">char</span>[] nums,<span class="keyword">int</span> begin,<span class="keyword">int</span> end)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=begin,j=end;i<j;i++,j--) {< span><br><span class="line">        swap(nums,i,j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">char</span>[] nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">char</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></j;i++,j--)></span></pre></td></tr></tbody></table></figure></div><h2 id="136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"><a href="#136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—" class="headerlink" title="136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/single-number/" target="_blank" rel="noopener">136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</a></h2><p>ç»™å®šä¸€ä¸ª<strong>éç©ºæ•´æ•°</strong>æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><p>ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å¾ˆå¯æƒœï¼Œæƒ³åˆ°äº†ä½è¿ç®—ï¼Œä½†æ˜¯æ²¡è¯•ï¼Œç„äº†ä¸€çœ¼è¯„è®ºåŒºï¼Œçœ‹è§å¼‚æˆ–ä¸¤ä¸ªå­—é©¬ä¸Šå°±æ»šå›æ¥å†™äº†è¿™ä¸ªğŸ˜‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++){< span><br><span class="line">        nums[i]^=nums[i-<span class="number">1</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[nums.length-<span class="number">1</span>];</span><br><span class="line">}</span><br></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><h2 id="55-è·³è·ƒæ¸¸æˆ"><a href="#55-è·³è·ƒæ¸¸æˆ" class="headerlink" title="55. è·³è·ƒæ¸¸æˆ"></a><a href="https://leetcode-cn.com/problems/jump-game/" target="_blank" rel="noopener">55. è·³è·ƒæ¸¸æˆ</a></h2><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚</p><p>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚</p><p>åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [2,3,1,1,4]</span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: æˆ‘ä»¬å¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä½ç½® 0 åˆ°è¾¾ ä½ç½® 1, ç„¶åå†ä»ä½ç½® 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">4</span>]</span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br><span class="line">è§£é‡Š: æ— è®ºæ€æ ·ï¼Œä½ æ€»ä¼šåˆ°è¾¾ç´¢å¼•ä¸º <span class="number">3</span> çš„ä½ç½®ã€‚ä½†è¯¥ä½ç½®çš„æœ€å¤§è·³è·ƒé•¿åº¦æ˜¯ <span class="number">0</span> ï¼Œ æ‰€ä»¥ä½ æ°¸è¿œä¸å¯èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å›æº¯ï¼Œå‹‰å¼ºèƒ½è¿‡ã€‚ã€‚ã€‚å¤ªè ¢äº†ï¼Œä¸ºå•¥æƒ³ä¸åˆ°ç®€å•çš„æ–¹æ³•ï¼Œå°±éå¾—å¾€å¤æ‚äº†æƒ³ï¼Ÿå°±è¿™ä¹ˆå‚»ä¹ˆï¼Ÿ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Boolean[] cache=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canJump</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums==<span class="keyword">null</span> || nums.length<=<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    cache=<span class="keyword">new</span> Boolean[nums.length];</span><br><span class="line">    <span class="keyword">return</span> jump(nums,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">jump</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> index)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (nums[index] >= nums.length-<span class="number">1</span> -index) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (cache[index]!=<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> cache[index];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=nums[index];i>=<span class="number">1</span>;i--) {</span><br><span class="line">        <span class="keyword">if</span> (index+i<nums.length && jump(nums,index+i)) {< span><br><span class="line">            <span class="keyword">return</span> cache[index]=<span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cache[index]=<span class="keyword">false</span>;</span><br><span class="line">}</span><br></nums.length></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>ä¸ç”¨å¤šè¯´äº†ï¼Œéå†æ•°ç»„ï¼Œä¸æ–­æ›´æ–°èƒ½åˆ°è¾¾çš„æœ€è¿œè·ç¦»ï¼Œå¦‚æœ<strong>æŸä¸ªä½ç½®çš„indexå¤§äºå½“å‰èƒ½åˆ°è¾¾çš„æœ€è¿œè·ç¦»å°±ç›´æ¥è¿”å›false</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//MDZZ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canJump</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> maxIndex=nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length-<span class="number">1</nums.length-<span></span>;i++) {<br><span class="line">        <span class="keyword">if</span>(maxIndex >= nums.length-<span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (i>maxIndex) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        maxIndex=Math.max(maxIndex,i+nums[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="169-å¤šæ•°å…ƒç´ "><a href="#169-å¤šæ•°å…ƒç´ " class="headerlink" title="169. å¤šæ•°å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/majority-element/" target="_blank" rel="noopener">169. å¤šæ•°å…ƒç´ </a></h2><p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>åˆ†æ²»æ³•ï¼Œ (<code>HashMap</code>æˆ–è€…æ’åºä»€ä¹ˆçš„æ–¹æ³•å°±ä¸è¯´äº†ï¼Œç¬”è¯•å¯ä»¥é‚£æ ·å†™ï¼Œé¢è¯•å°±ä¸èƒ½è¿™æ ·äº†)</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> majorityElement(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> lo,<span class="keyword">int</span> hi)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (lo==hi) {</span><br><span class="line">        <span class="keyword">return</span> nums[lo];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> leftMode=majorityElement(nums,lo,mid);</span><br><span class="line">    <span class="keyword">int</span> rightMode=majorityElement(nums,mid+<span class="number">1</span>,hi);</span><br><span class="line">    <span class="keyword">if</span> (leftMode==rightMode) {</span><br><span class="line">        <span class="keyword">return</span> rightMode;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> countMode(nums,lo,mid,leftMode)>countMode(nums,mid+<span class="number">1</span>,hi,rightMode)?leftMode:rightMode;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countMode</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> left,<span class="keyword">int</span> right,<span class="keyword">int</span> mode)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=left;i<=right;i++) {</span><br><span class="line">        <span class="keyword">if</span> (mode==nums[i]) {</span><br><span class="line">            count++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(NlogN)</code>ï¼Œåªæ˜¯ä¸€ç§æ€è·¯å§</p><p><strong>è§£æ³•äºŒ</strong></p><p>æ‘©å°”æŠ•ç¥¨æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> sum=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> res=nums[<span class="number">0</span>]; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (sum==<span class="number">0</span>) {</span><br><span class="line">            res=nums[i];</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å°†ä¼—æ•°çœ‹åš1,å…¶ä»–çš„çœ‹ä½œ-1,æœ€åå’Œä¸€å®šæ˜¯å¤§äº0çš„</span></span><br><span class="line">        <span class="keyword">if</span> (res!=nums[i]) {</span><br><span class="line">            sum--;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            sum++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="229-æ±‚ä¼—æ•°-II"><a href="#229-æ±‚ä¼—æ•°-II" class="headerlink" title="229. æ±‚ä¼—æ•° II"></a><a href="https://leetcode-cn.com/problems/majority-element-ii/" target="_blank" rel="noopener">229. æ±‚ä¼—æ•° II</a></h2><p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­æ‰€æœ‰å‡ºç°è¶…è¿‡ âŒŠ n/3 âŒ‹ æ¬¡çš„å…ƒç´ ã€‚</p><p><strong>è¯´æ˜:</strong> è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å’Œä¸Šé¢çš„æ–¹æ³•ä¸€æ ·ï¼ŒæŠµæ¶ˆå»é™¤ä¸‰ä¸ªä¸åŒçš„å…ƒç´ å¯¹ä¼—æ•°æ²¡æœ‰ä»»ä½•å½±å“</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List<integer> <span class="title">majorityElement</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </integer></span>{</span><br><span class="line">    List<integer> res = <span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span> (nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    <span class="keyword">int</span> candidateA = nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> candidateB = nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> countA = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> countB = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) {</span><br><span class="line">        <span class="keyword">if</span> (num == candidateA) {</span><br><span class="line">            countA++;<span class="comment">//æŠ•A</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (num == candidateB) {</span><br><span class="line">            countB++;<span class="comment">//æŠ•B</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (countA == <span class="number">0</span>) {</span><br><span class="line">            candidateA = num;</span><br><span class="line">            countA++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (countB == <span class="number">0</span>) {</span><br><span class="line">            candidateB = num;</span><br><span class="line">            countB++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        countA--;</span><br><span class="line">        countB--;</span><br><span class="line">    }</span><br><span class="line">    countA = <span class="number">0</span>;</span><br><span class="line">    countB = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) {</span><br><span class="line">        <span class="keyword">if</span> (num == candidateA)</span><br><span class="line">            countA++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (num == candidateB)</span><br><span class="line">            countB++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (countA > nums.length / <span class="number">3</span>)</span><br><span class="line">        res.add(candidateA);</span><br><span class="line">    <span class="keyword">if</span> (countB > nums.length / <span class="number">3</span>)</span><br><span class="line">        res.add(candidateB);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="41-ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"><a href="#41-ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°" class="headerlink" title="41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"></a><a href="https://leetcode-cn.com/problems/first-missing-positive/" target="_blank" rel="noopener">41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°</a></h2><p>ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­æ²¡æœ‰å‡ºç°çš„æœ€å°çš„æ­£æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>]</span><br><span class="line">è¾“å‡º: <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">3</span>,<span class="number">4</span>,-<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">12</span>]</span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>Headé¢˜ï¼Œæƒ³åˆ°äº†æ¡¶æ’åºï¼Œä½†æ˜¯ç©ºé—´ä¸ç¬¦åˆè¦æ±‚ï¼Œçœ‹äº†è¯„è®ºæ‰£äº†åŠå¤©è¾¹ç•Œä¹Ÿæ²¡æŠ å‡ºæ¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstMissingPositive</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;++i){< span><br><span class="line">        <span class="comment">//å°†æ¯ä¸ªå…ƒç´ å½’ä½ï¼Œæˆ‘å¼€å§‹åªæœ‰ä¸€å±‚å¾ªç¯ï¼Œé‚£æ ·ä¼šæ¼æ‰å¾ˆå¤šå…ƒç´ ï¼ˆå¯èƒ½è¢«äº¤æ¢çš„å…ƒç´  åé¢ä¹Ÿéœ€è¦äº¤æ¢ï¼‰ï¼Œè¿™æ ·çš„å°±æ˜¯ä¸€æ¬¡ç›´æ¥åˆ°ä½ã€‚</span></span><br><span class="line">        <span class="keyword">while</span>(nums[i]>=<span class="number">1</span>&&nums[i]<=nums.length&&nums[nums[i]-<span class="number">1</span>]!=nums[i])</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">int</span> temp=nums[nums[i]-<span class="number">1</span>];</span><br><span class="line">            nums[nums[i]-<span class="number">1</span>]=nums[i];</span><br><span class="line">            nums[i]=temp;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;++i){< span><br><span class="line">        <span class="keyword">if</span>(nums[i]!=i+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> i+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums.length+<span class="number">1</span>;</span><br><span class="line">}</span><br></nums.length;++i){<></span></nums.length;++i){<></span></pre></td></tr></tbody></table></figure></div><p>ä¸è€ƒè™‘ç©ºé—´å¤æ‚åº¦åˆ©ç”¨æ¡¶æ’åºçš„æ€æƒ³</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">firstMissingPositive2</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> [] bucket=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;++i){< span><br><span class="line">            <span class="keyword">if</span>(nums[i]><span class="number">0</span> && nums[i]<=nums.length){</span><br><span class="line">                bucket[nums[i]-<span class="number">1</span>]=<span class="number">1</span>; <span class="comment">//ä»£è¡¨è¿™ä¸ªæ¡¶æœ‰å…ƒç´ äº†</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<bucket.length;++i){< span><br><span class="line">            <span class="keyword">if</span>(bucket[i]==<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> i+<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> nums.length+<span class="number">1</span>;</span><br><span class="line">}</span><br></bucket.length;++i){<></span></nums.length;++i){<></span></pre></td></tr></tbody></table></figure></div><p>lcä¸Šæäº¤åçš„ç©ºé—´æ¶ˆè€—å±…ç„¶æ¯”ä¸Šé¢çš„è¿˜å°ä¸€ç‚¹ğŸ˜‚</p><h2 id="42-æ¥é›¨æ°´"><a href="#42-æ¥é›¨æ°´" class="headerlink" title="42. æ¥é›¨æ°´"></a><a href="https://leetcode-cn.com/problems/trapping-rain-water/" target="_blank" rel="noopener">42. æ¥é›¨æ°´</a></h2><p>ç»™å®š <em>n</em> ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚</p><p><img alt="rainwatertrap.png" data-src="https://i.loli.net/2019/05/14/5cda71129045d93180.png" src="/img/loading.gif" class="lazyload"></p><p>ä¸Šé¢æ˜¯ç”±æ•°ç»„ [0,1,0,2,1,0,1,3,2,1,2,1] è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡º: <span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™ç§è§£æ³•çš„å…³é”®å°±æ˜¯æ¯ä¸ªæŸ±å­èƒ½æ¥çš„æ°´æ˜¯<strong>å·¦å³æœ€é•¿æŸ±å­(éƒ½å¤§äºå½“å‰æŸ±å­)ä¸­çš„è¾ƒå°çš„é‚£ä¸ªå‡å»å½“å‰æŸ±å­</strong>ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">trap3</span><span class="params">(<span class="keyword">int</span> []height)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (height == <span class="keyword">null</span> || height.length <= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = height.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> left_max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right_max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (left < right) {</span><br><span class="line">        <span class="keyword">if</span> (height[left] < height[right]) {</span><br><span class="line">            <span class="keyword">if</span> (height[left] < left_max) <span class="comment">//å½“å‰å·¦è¾¹å…ƒç´  æ¯”å³è¾¹æœ€å¤§å€¼å°ï¼Œæ¯”å·¦è¾¹æœ€å¤§å€¼å°æ˜¯ä¸ªâ€œå‡¹ç‚¹â€</span></span><br><span class="line">                res += left_max - height[left]; </span><br><span class="line">            <span class="keyword">else</span> left_max = height[left]; <span class="comment">//æ›´æ–°å·¦è¾¹æŸ±å­æœ€å¤§å€¼</span></span><br><span class="line">            left++;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">if</span> (height[right] < right_max) <span class="comment">//å½“å‰å·¦è¾¹å…ƒç´  æ¯”å·¦è¾¹æœ€å¤§å€¼å°ï¼Œæ¯”å³è¾¹æœ€å¤§å€¼å°æ˜¯ä¸ªâ€œå‡¹ç‚¹â€</span></span><br><span class="line">                res += right_max - height[right]; </span><br><span class="line">            <span class="keyword">else</span> right_max = height[right]; <span class="comment">//æ›´æ–°å³è¾¹æŸ±å­æœ€å¤§å€¼</span></span><br><span class="line">            right--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res; </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>æˆ‘æœ€å¼€å§‹æ€è·¯æ˜¯å¡«æ»¡åç”¨æ€»é¢ç§¯å‡æ•°ç»„å’Œï¼Œè·‘è¿‡äº†130+ä¸ªï¼Œæœ‰ä¸€ç§ç‰¹æ®Šçš„è·‘ä¸è¿‡äº†ï¼Œæ‡’å¾—å»å¤„ç†é‚£ä¸ªè¾¹ç•Œäº†ï¼Œä¸å¤ªä¼˜é›…</p></blockquote><p><strong>è§£æ³•äºŒ</strong></p><p>è¿˜æœ‰ä¸€ç§å¾ˆå·§å¦™çš„æ–¹æ³•ï¼Œä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œæ‰¾åˆ°æœ€å¤§å€¼ï¼Œç„¶ååˆ†åˆ«å¯¹ä¸¤è¾¹çš„æŸ±å­è¿›è¡Œéå†ï¼Œå¦‚æœå½“å‰çš„æŸ±å­å°äºå‰é¢æŸ±å­çš„æœ€å¤§å€¼ï¼Œå°±è¯´æ˜ä¸€å®šå¯ä»¥æ¥åˆ°æ°´ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è®°å½•æŸ±å­å·¦è¾¹çš„æœ€å¤§å€¼ï¼Œç”¨äºè®¡ç®—å¯ä»¥æ¥æ°´çš„é‡ï¼Œæœ€åè®¡ç®—æ€»å’Œ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">trap5</span><span class="params">(<span class="keyword">int</span> []height)</span></span>{</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">int</span> n=height.length,idx=<span class="number">0</span>,lefth=<span class="number">0</span>,righth=<span class="number">0</span>,area=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<n;i++) idx="height[idx]<=height[i]?i:idx;</span"><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<idx;i++){< span><br><span class="line">        <span class="keyword">if</span>(height[i]<lefth) area+="lefth-height[i];" < span><br><span class="line">        <span class="keyword">else</span> lefth=height[i]; <span class="comment">//æ›´æ–°æœ€å¤§å€¼</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=n-<span class="number">1</span>;i>idx;i--){</span><br><span class="line">        <span class="keyword">if</span>(height[i]<righth) area+="righth-height[i];" < span><br><span class="line">        <span class="keyword">else</span> righth=height[i]; <span class="comment">//æ›´æ–°æœ€å¤§å€¼</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> area;</span><br><span class="line">}</span><br></righth)></span></lefth)></span></idx;i++){<></span></n;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰</strong></p><p>åˆ©ç”¨æ ˆçš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">trap6</span><span class="params">(<span class="keyword">int</span>[] height)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (height == <span class="keyword">null</span> || height.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Deque<integer> stack = <span class="keyword">new</span> ArrayDeque<>(); <span class="comment">//æ ˆé‡Œé¢ç»´æŠ¤ä¸€ä¸ªé€’å‡åºåˆ—</span></integer></span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < height.length; i++){</span><br><span class="line">            <span class="keyword">while</span> ( ! stack.isEmpty() && height[stack.peek()] < height[i]) { <span class="comment">//å½“éå†çš„å…ƒç´ å¤§äºæ ˆé¡¶å…ƒç´ </span></span><br><span class="line">                <span class="keyword">int</span> tmp = stack.pop(); <span class="comment">//æ ˆé¡¶å¼¹å‡ºæ¥</span></span><br><span class="line">                <span class="keyword">if</span> (stack.isEmpty()) <span class="keyword">break</span>;</span><br><span class="line">                res += (Math.min(height[i],height[stack.peek()]) - height[tmp]) * (i - stack.peek() - <span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//ç»´æŠ¤é€’å‡åºåˆ—</span></span><br><span class="line">            stack.push(i);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œå…¶å®æ˜¯æŒ‰ç…§å±‚æ¥è®¡ç®—çš„ï¼Œæ ˆé‡Œé¢æ˜¯é€’å‡çš„å…ƒç´ ï¼Œå¦‚æœè¯»åˆ°æ¯”æ ˆé¡¶å¤§çš„å…ƒç´ å°±<strong>æŒ‰å±‚</strong>è®¡ç®—é€’å‡æ ˆ<strong>åº•éƒ¨å…ƒç´ </strong>åˆ°<strong>å½“å‰å…ƒç´ </strong>èƒ½è“„æ°´çš„é¢ç§¯ã€‚</p><h2 id="75-é¢œè‰²åˆ†ç±»"><a href="#75-é¢œè‰²åˆ†ç±»" class="headerlink" title="75. é¢œè‰²åˆ†ç±»"></a><a href="https://leetcode-cn.com/problems/sort-colors/" target="_blank" rel="noopener">75. é¢œè‰²åˆ†ç±»</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ï¼Œä¸€å…± <em>n</em> ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œ<strong>åŸåœ°</strong>å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚</p><p>æ­¤é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚</p><p><strong>æ³¨æ„:</strong><br>ä¸èƒ½ä½¿ç”¨ä»£ç åº“ä¸­çš„æ’åºå‡½æ•°æ¥è§£å†³è¿™é“é¢˜ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">è¾“å‡º: [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿›é˜¶ï¼š</strong></p><ul><li>ä¸€ä¸ªç›´è§‚çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è®¡æ•°æ’åºçš„ä¸¤è¶Ÿæ‰«æç®—æ³•ã€‚<br>é¦–å…ˆï¼Œè¿­ä»£è®¡ç®—å‡º0ã€1 å’Œ 2 å…ƒç´ çš„ä¸ªæ•°ï¼Œç„¶åæŒ‰ç…§0ã€1ã€2çš„æ’åºï¼Œé‡å†™å½“å‰æ•°ç»„ã€‚</li><li>ä½ èƒ½æƒ³å‡ºä¸€ä¸ªä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´çš„ä¸€è¶Ÿæ‰«æç®—æ³•å—ï¼Ÿ</li></ul><p>é¢˜ç›®ä¸Šå·²ç»æœ‰äº†æç¤ºï¼Œå¾ˆç›´è§‚çš„åšæ³•å°±æ˜¯åˆ©ç”¨æ¡¶æ’åºçš„æ–¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sortColors</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> [] bucket=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line">    <span class="comment">//åŸºäºæ¡¶æ’åº</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++){< span><br><span class="line">        bucket[nums[i]]++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//é‡æ–°æ„é€ å‡ºæ¥</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="keyword">while</span> (bucket[index]<=<span class="number">0</span>) {</span><br><span class="line">            index++;</span><br><span class="line">        }</span><br><span class="line">        nums[i]=index;</span><br><span class="line">        bucket[index]--;</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><p>å½“ç„¶è¿˜æœ‰æ›´ä¼˜ç§€çš„åšæ³•ï¼Œåˆ©ç”¨<strong>ä¸‰å‘åˆ‡åˆ†å¿«æ’</strong>çš„æ€æƒ³(è·å…°å›½æ——é—®é¢˜)</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sortColors</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> less=-<span class="number">1</span>,more=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l<=more){</span><br><span class="line">        <span class="keyword">if</span>(nums[l]<<span class="number">1</span>){</span><br><span class="line">            swap(nums,++less,l++);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums[l]><span class="number">1</span>){</span><br><span class="line">            swap(nums,more--,l);</span><br><span class="line">        } <span class="keyword">else</span>{ </span><br><span class="line">            l++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="125-éªŒè¯å›æ–‡ä¸²"><a href="#125-éªŒè¯å›æ–‡ä¸²" class="headerlink" title="125. éªŒè¯å›æ–‡ä¸²"></a><a href="https://leetcode-cn.com/problems/valid-palindrome/" target="_blank" rel="noopener">125. éªŒè¯å›æ–‡ä¸²</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œåªè€ƒè™‘å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œå¯ä»¥å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚</p><p><strong>è¯´æ˜ï¼š</strong>æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†ç©ºå­—ç¬¦ä¸²å®šä¹‰ä¸ºæœ‰æ•ˆçš„å›æ–‡ä¸²ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"A man, a plan, a canal: Panama"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"race a car"</span></span><br><span class="line">è¾“å‡º: <span class="keyword">false</span></span><br></pre></td></tr></tbody></table></figure></div><p>easyé¢˜ï¼Œå¯¹æ’æŒ‡é’ˆ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">isPalindrome</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="keyword">null</span>||s.length()<=<span class="number">1</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    s=s.toLowerCase();</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=s.length()-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">char</span> lch=s.charAt(left);</span><br><span class="line">        <span class="keyword">char</span> rch=s.charAt(right);</span><br><span class="line">        <span class="keyword">if</span>(isNumOrchar(lch) && isNumOrchar(rch)){</span><br><span class="line">            <span class="comment">//System.out.println(lch+","+rch);</span></span><br><span class="line">            <span class="keyword">if</span>(lch==rch){</span><br><span class="line">                left++;</span><br><span class="line">                right--;</span><br><span class="line">            } <span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>((!isNumOrchar(lch)) && isNumOrchar(rch)){</span><br><span class="line">            left++;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(isNumOrchar(lch) && !isNumOrchar(rch)){</span><br><span class="line">            right--;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">isNumOrchar</span><span class="params">(<span class="keyword">char</span> ch)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>((ch>=<span class="string">'0'</span> && ch<=<span class="string">'9'</span>) || (ch>=<span class="string">'a'</span> && ch<=<span class="string">'z'</span>) || (ch>=<span class="string">'A'</span> &&  ch<=<span class="string">'Z'</span>)){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></right){<></span></pre></td></tr></tbody></table></figure></div><p>ä»£ç å†™å¤šäº†ï¼Œä¸å¤Ÿç®€æ´ï¼Œå…¶å®å¯ä»¥ç›´æ¥ç”¨<strong>Character</strong>çš„API</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">isPalindrome</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (s.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = s.length() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i < j) {</span><br><span class="line">        <span class="keyword">while</span> (i < j && !Character.isLetterOrDigit(s.charAt(i))) i++;</span><br><span class="line">        <span class="keyword">while</span> (i < j && !Character.isLetterOrDigit(s.charAt(j))) j--;</span><br><span class="line">        <span class="keyword">if</span> (Character.toLowerCase(s.charAt(i)) != Character.toLowerCase(s.charAt(j))){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        i++;</span><br><span class="line">        j--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "><a href="#215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ " class="headerlink" title="215.æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/kth-largest-element-in-an-array/" target="_blank" rel="noopener">215.æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a></h2><p>Find the <strong>k</strong>th largest element in an unsorted array. Note that it is the kth largest element in the sorted order, not the kth distinct element.</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">Input: [3,2,1,5,6,4] and k = 2</span><br><span class="line">Output: 5</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">Input: [3,2,3,1,2,4,5,5,6] and k = 4</span><br><span class="line">Output: 4</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Note:</strong><br>You may assume k is always valid, 1 â‰¤ k â‰¤ arrayâ€™s length.</p><blockquote><p>è¿™é¢˜å¿…é¡»å¤šè¯´å‡ å¥</p></blockquote><p><strong>è§£æ³•ä¸€</strong></p><p>å¤§æ ¹å †çš„åšæ³•ï¼ˆé¦–å…ˆæƒ³åˆ°çš„æ–¹æ³•ï¼Œä¸æ˜¯å¸¸è§„ç”¨å †çš„åšæ³•ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findKthLargest</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="comment">//æ„å»ºäº†å¤§æ ¹å †</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++){< span><br><span class="line">        siftUp(nums,i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> size=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<k-<span class="number">1</k-<span></span>;i++) {</nums.length;i++){<></span><br><span class="line">        swap(nums,<span class="number">0</span>,size);<span class="comment">//å’Œå †é¡¶äº¤æ¢Kæ¬¡</span></span><br><span class="line">        siftDown(nums,<span class="number">0</span>,--size);<span class="comment">//é‡æ–°è°ƒæ•´å †</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> i)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(nums[i]>nums[(i-<span class="number">1</span>)/<span class="number">2</span>]){</span><br><span class="line">        swap(nums,i,(i-<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">        i=(i-<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//i å˜å° ä¸‹æ²‰</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> i,<span class="keyword">int</span> size)</span></span>{</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆå·¦å­©å­ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> left=i*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<size){< span><br><span class="line">        <span class="keyword">int</span> right=left+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å·¦å³èŠ‚ç‚¹æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">int</span> larger=left+<span class="number">1</span><size && nums[left]<nums[left+<span class="number">1</size></span>] ?left+<span class="number">1</span>:left;</size){<></span><br><span class="line">        <span class="keyword">if</span>(nums[larger]>nums[i]){</span><br><span class="line">            swap(nums,larger,i);</span><br><span class="line">            i=larger;</span><br><span class="line">            left=larger*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>70%å·¦å³çš„beatï¼Œå½“æ—¶æ„Ÿè§‰è¿˜è¡Œï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯<code>O(KlogN)</code>ï¼Œåæ¥è¶Šæƒ³è¶Šä¸å¯¹ï¼Œåˆå»çœ‹äº†ä¸‹å †æ’åºï¼Œå‘ç°æˆ‘ä¹‹å‰å†™çš„å †æ’åºéƒ½æ˜¯æœ‰é—®é¢˜çš„</p><p><strong>ä¼˜åŒ–åçš„å¤§æ ¹å †åšæ³•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findKthLargest</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> last=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=nums.length/<span class="number">2</span>-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        siftDown(nums,i,last);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<k-<span class="number">1</k-<span></span>;i++) {<br><span class="line">        swap(nums,<span class="number">0</span>,last);</span><br><span class="line">        siftDown(nums,<span class="number">0</span>,--last);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//i å˜å° ä¸‹æ²‰</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> i,<span class="keyword">int</span> last)</span></span>{</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆå·¦å­©å­ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> left=i*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<=last){</span><br><span class="line">        <span class="keyword">int</span> right=left+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å·¦å³èŠ‚ç‚¹æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">int</span> larger=right<=last && nums[right] > nums[left]?right:left;</span><br><span class="line">        <span class="keyword">if</span>(nums[larger]>nums[i]){</span><br><span class="line">            swap(nums,larger,i);</span><br><span class="line">            i=larger;</span><br><span class="line">            left=larger*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>95% beatï¼Œæ¯”ä¸Šé¢çš„è¦å¿«å¾ˆå¤šï¼Œç›¸æ¯”ä¹‹å‰çš„æ–¹æ³•ï¼Œæ„é€ å †çš„æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸Šé¢é‚£ç§é€šè¿‡è‡ªä¸Šè€Œä¸‹çš„insertæ–¹å¼æ—¶é—´å¤æ‚åº¦æ˜¯O(NlogN)ï¼Œå…¶å®æƒ³æƒ³ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯å®Œå…¨ç›¸åçš„ï¼Œinsertçš„æ–¹å¼ï¼Œæœ€åä¸€å±‚æ¯ä¸ªå…ƒç´ æœ€åéƒ½å¯èƒ½è°ƒæ•´<code>logN</code>æ¬¡ï¼Œè€Œæœ€åä¸€å±‚ä¹Ÿæ˜¯å…ƒç´ æœ€å¤šçš„ä¸€å±‚ï¼Œè¿™æ ·ä¸€æ¥å¤æ‚åº¦å°±ä¼šå¤§å¤§å¢åŠ ï¼Œç›¸åå¦‚æœé‡‡ç”¨ä»åº•å‘ä¸Šçš„<code>swim</code>æ–¹å¼æœ€åä¸€å±‚éƒ½åªéœ€è¦è°ƒæ•´<code>1</code>æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹éœ€è¦è°ƒæ•´<code>logN</code>æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œæ—¶é—´å¤æ‚åº¦å°±ä¼šå¤§å¤§é™ä½ï¼Œæœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯<code>O(N)</code>ï¼Œ<a href="https://www.zhihu.com/question/20729324" target="_blank" rel="noopener">å…·ä½“æ¨ç®—å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« </a>ï¼Œ ç°åœ¨çš„æ—¶é—´å¤æ‚åº¦æ‰çœŸçš„æ˜¯<code>O(KlogN)</code></p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190617/kVuvnMfjuSns.png?imageslim" src="/img/loading.gif" class="lazyload"></p><blockquote><p>ğŸ’¥ğŸ’¥ ä¸Šé¢è¿™ä¸¤ç§åšæ³•æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¤±å»äº†ç”¨å †çš„ä¼˜åŠ¿ï¼Œå¤§æ ¹å †çš„åšæ³•å¿…é¡»è¦é˜¿å°†æ•´ä¸ªå †æ„å»ºå®Œæˆåæ‰èƒ½å»æ‰¾topkè¿™æ ·çš„è¯å†…å­˜æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œåº”è¯¥ç»´æŠ¤ä¸€ä¸ªå°æ ¹å †ï¼Œè¿™æ ·å¦‚æœæ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ä¸ç”¨å…¨è¯»å…¥å†…å­˜ä¸­ï¼Œ  è¿™é¢˜å› ä¸ºæ˜¯æˆ‘è‡ªå·±å®ç°çš„å †ï¼Œæ‰€ä»¥å»ºå †çš„å¤æ‚åº¦æ˜¯O(N)ï¼ˆå¦‚æœä½¿ç”¨å®˜æ–¹çš„APIï¼Œå»ºå †çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯NlogNï¼‰ï¼Œæœ€ç»ˆå¤§æ ¹å †å°æ ¹å †å¤æ‚åº¦å–å†³äºKå’ŒNçš„å¤§å°å…³ç³»ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™æœ€å¥½ä¸è¦è¯´ç”¨å¤§æ ¹å †çš„åšæ³•</p></blockquote><p><strong>è§£æ³•äºŒ</strong></p><p>å°æ ¹å †çš„åšæ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findKthLargest</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> size=nums.length;</span><br><span class="line">    <span class="comment">//å…ˆç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„å°æ ¹å † ,è¿™é‡Œè¦æ³¨æ„kä¸æ˜¯ä¸‹æ ‡ï¼Œk=index+1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = k/<span class="number">2</span>; i >=<span class="number">0</span>; i--) {</span><br><span class="line">        heapIfy(nums,i,k);</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//å†ä»kå¼€å§‹å‘é‡Œé¢æ’å…¥å…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=k;i<size;i++) {< span><br><span class="line">        <span class="keyword">if</span>(nums[i]>nums[<span class="number">0</span>]) { <span class="comment">//å¤§äºå°æ ¹å †å †é¡¶,è¿›å–ä»£å®ƒ</span></span><br><span class="line">            <span class="comment">//å°æ ¹å †æ±‚ç¬¬Kå¤§,ä¿è¯è¿™ä¸ªå †çš„å…ƒç´ æ˜¯æ•´ä¸ªå †çš„å‰kå¤§çš„å…ƒç´ ï¼Œå †é¡¶å°±æ˜¯ç¬¬kå¤§</span></span><br><span class="line">            swap(nums,i,<span class="number">0</span>);</span><br><span class="line">            heapIfy(nums,<span class="number">0</span>,k);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å°äºå †é¡¶å°±ä¸ç”¨ç®¡äº†</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°æ ¹å †è°ƒæ•´</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">heapIfy</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> i, <span class="keyword">int</span> size)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left < size) {</span><br><span class="line">        <span class="keyword">int</span> right = left + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> small = right < size && nums[right] < nums[left] ? right: left;</span><br><span class="line">        <span class="keyword">if</span>(nums[small]<nums[i]) {< span><br><span class="line">            swap(nums,small,i);</span><br><span class="line">            i=small;</span><br><span class="line">            left=<span class="number">2</span>*i+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span>  <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> temp = nums[l];</span><br><span class="line">    nums[l] = nums[r];</span><br><span class="line">    nums[r] = temp;</span><br><span class="line">}</span><br></nums[i])></span></size;i++)></span></pre></td></tr></tbody></table></figure></div><p>2msï¼Œ99%beatï¼Œä¸€èˆ¬æƒ…å†µä¸‹çš„topKé—®é¢˜ï¼Œå¦‚æœç”¨å †è§£å†³çš„è¯åº”è¯¥éƒ½æ˜¯é‡‡ç”¨<strong>å°æ ¹å †</strong>è¿™ç§åšæ³•æ¥åšï¼Œæ—¶é—´å¤æ‚åº¦ä¸º<code>O(NlogK)</code>ï¼Œç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„å°æ ¹å †ï¼Œç„¶åå†éå†åé¢n-kä¸ªå…ƒç´ ï¼Œä¾æ¬¡å’Œå½“å‰æœ€å°å †çš„å †é¡¶æ¯”è¾ƒï¼ˆå½“å‰topKä¸­çš„æœ€å°å…ƒç´ ï¼Œå †é¡¶ï¼‰ï¼Œå¦‚æœæ¯”å®ƒå°å°±å’Œå®ƒäº¤æ¢ç„¶åè°ƒæ•´å †ï¼Œè¿™æ ·å°±å§‹ç»ˆä¿æŒäº†è¿™ä¸ªå †æ˜¯å½“å‰çš„topKå°ï¼Œæœ€åçš„å †é¡¶å°±æ˜¯ç¬¬Kå¤§çš„å…ƒç´ ã€‚</p><p><strong>è§£æ³•ä¸‰</strong></p><p>å…¶å®è¿˜æœ‰ä¸€ç±»åšæ³•ï¼Œåˆ©ç”¨<code>å¿«æ’+äºŒåˆ†</code>çš„æ€æƒ³</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findKthLargest</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> n=nums.length;</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<=right){</span><br><span class="line">        <span class="comment">//åˆ†æ²»</span></span><br><span class="line">        <span class="keyword">int</span> base=partion(nums,left,right); <span class="comment">//æ‹¿åˆ°åˆ’åˆ†ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(base<n-k){< span><br><span class="line">            left=base+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(base>n-k){</span><br><span class="line">            right=base-<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">return</span> nums[base];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partion</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">    <span class="comment">//éšæœºå–å€¼</span></span><br><span class="line">    swap(nums,left,left+(<span class="keyword">int</span>) (Math.random() * (right - left + <span class="number">1</span>)));</span><br><span class="line">    <span class="keyword">int</span> base=left;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">while</span>(left<right&&nums[right]>nums[base]){</right&&nums[right]></span><br><span class="line">            right--;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span>(left<right&&nums[left]<=nums[base]){< span><br><span class="line">            left++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(left<right){< span><br><span class="line">            swap(nums,left,right);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å½’ä½</span></span><br><span class="line">    swap(nums,left,base);</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></right){<></span></right&&nums[left]<=nums[base]){<></span></right){<></span></n-k){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæœ€å¥½ç”¨<strong>éšæœº</strong>çš„<strong>partition</strong>ï¼Œæˆ‘è¯•äº†ä¸‹<strong>ä¸éšæœº</strong>å¤§æ¦‚<code>50+ms 30%beat</code>ï¼Œè¿™ç§éšæœºçš„å¤§æ¦‚<code>3ms 97%beats</code>ï¼Œå·®è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯<strong>O(N)</strong></p><blockquote><p>è‡³äºä¸ºä»€ä¹ˆæ˜¯O(N)ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸‹ï¼Œè¿™é‡Œ<strong>å‡è®¾æ¯æ¬¡åˆ’åˆ†éƒ½æ˜¯å·®ä¸å¤šä¸­ç‚¹çš„ä½ç½®</strong>ï¼Œå¦‚æœæ˜¯å¿«æ’ï¼Œé‚£ä¹ˆåœ¨<strong>partition</strong>ä¹‹åä¾ç„¶éœ€è¦ä¸¤è¾¹çš„å­æ•°ç»„è¿›è¡Œ<strong>partition</strong>ï¼Œåˆ†æ²»æ•´ä¸ªé€’å½’æ ˆçš„é«˜åº¦å°±æ˜¯<code>logN</code>ï¼Œæ¯å±‚éƒ½æ˜¯Nï¼Œæ‰€ä»¥æ•´ä½“çš„å¤æ‚åº¦å°±<strong>O(NlogN)</strong>â€¦.æ‰¯è¿œäº†ï¼Œå›åˆ°æ­£é¢˜</p><p>æ¥è¯´è¯´æˆ‘ä»¬è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯O(N)ï¼Œè¿™é‡Œæˆ‘ä»¬æ²¿ç”¨å‰é¢çš„åˆ†æè¿‡ç¨‹ï¼Œé€’å½’æ ˆæ·±åº¦ä¾ç„¶æ˜¯<code>logN</code>ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œç¬¬ä¸€æ¬¡ç¡®å®šåˆ’åˆ†ç‚¹çš„ç›¸å¯¹<strong>k</strong>çš„ä½ç½®åï¼Œä¸‹ä¸€æ­¥<strong>åªéœ€è¦åˆ’åˆ†å…¶ä¸­ä¸€è¾¹çš„å…ƒç´ ï¼Œä¸ç”¨å¯¹å¦ä¸€è¾¹çš„å…ƒç´ ç»§ç»­</strong>ï¼Œä¹Ÿå°±æ˜¯n/2ï¼Œå†å¾€ä¸‹å°±æ˜¯n/4ï¼Œn/8ï¼Œn/16 â€¦.   è€Œ <code>(1+1/2+1/4+1/8+......1/2^n)n <=2n</code> ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä½“çš„å¤æ‚åº¦æ˜¯ä½äºO(2N)çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¤æ‚åº¦å°±æ˜¯O(N)</p></blockquote><p><strong>è§£æ³•å››</strong></p><p><a href="https://zhuanlan.zhihu.com/p/31498036" target="_blank" rel="noopener">BFPRTç®—æ³•</a> å¤§ä½¬ä»¬æå‡ºæ¥çš„æ ¹æ®ä¸Šé¢å¿«æ’æ”¹è¿›è€Œæ¥ï¼Œå…¶å®é¢è¯•æŠŠå°æ ¹å †å’Œå¿«æ’çš„è§£æ³•ç­”å‡ºæ¥åº”è¯¥å°±å·®ä¸å¤šäº†ï¼Œè¿™ä¸ªè§£æ³•è¿˜æ˜¯æœ‰äº›ä¸å®¹æ˜“å†™å‡ºæ¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findKthLargest</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> findKthLargest(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>,k);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findKthLargest</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> mid=findMid(nums,l,r);</span><br><span class="line">    swap(nums,mid,l);</span><br><span class="line">    <span class="keyword">int</span> m=partition(nums,l,r);</span><br><span class="line">    <span class="keyword">if</span>(m==nums.length-k){</span><br><span class="line">        <span class="keyword">return</span> nums[m];</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸‹é¢çš„ç±»ä¼¼äº†</span></span><br><span class="line">    <span class="keyword">if</span>(m>nums.length-k){</span><br><span class="line">        <span class="keyword">return</span> findKthLargest(nums,l,m-<span class="number">1</span>,k);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> findKthLargest(nums,m+<span class="number">1</span>,r,k);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸­ä½æ•°çš„ä¸­ä½æ•°ï¼Œä¸»è¦çš„æ ¸å¿ƒå°±æ˜¯åœ¨è¿™é‡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>  <span class="title">findMid</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> leftSub=l;</span><br><span class="line">    <span class="comment">//åˆ†ç»„æ±‚ä¸­ä½æ•°ï¼Œ5ç­‰åˆ†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l;i<r-<span class="number">4</r-<span></span>;i+=<span class="number">5</span>) {<br><span class="line">        insertSort(nums,i,i+<span class="number">4</span>);</span><br><span class="line">        <span class="comment">//å°†æ¯ä¸€ç»„çš„ä¸­ä½æ•°ç»Ÿä¸€æ”¾åˆ°å·¦ä¾§ï¼Œç”¨äºé€’å½’</span></span><br><span class="line">        swap(nums,leftSub++,i+<span class="number">2</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¤„ç†å‰©ä¸‹çš„ä¸è¶³5ä¸ªçš„</span></span><br><span class="line">    <span class="keyword">if</span> (r-l<<span class="number">4</span>) {</span><br><span class="line">        insertSort(nums,l,r);</span><br><span class="line">        swap(nums,leftSub,l+(r-l)/<span class="number">2</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æ‰¾åˆ°äº†</span></span><br><span class="line">    <span class="keyword">if</span>(l==leftSub){</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> findMid(nums,l,leftSub);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//äº”ç­‰åˆ†çš„æ’å…¥</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<r;i++) {< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j>=l&&nums[j]<nums[i];j--) {< span><br><span class="line">            swap(nums,j,i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¿«æ’partition</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> base=left;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">while</span>(left<right&&nums[right]>nums[base]){</right&&nums[right]></span><br><span class="line">            right--;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span>(left<right&&nums[left]<=nums[base]){< span><br><span class="line">            left++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(left<right){< span><br><span class="line">            swap(nums,left,right);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å½’ä½</span></span><br><span class="line">    swap(nums,left,base);</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></right){<></span></right&&nums[left]<=nums[base]){<></span></right){<></span></nums[i];j--)></span></r;i++)></span></pre></td></tr></tbody></table></figure></div><p><a href="https://zhuanlan.zhihu.com/p/31498036" target="_blank" rel="noopener">å…·ä½“çš„æ—¶é—´å¤æ‚åº¦è¯æ˜</a>ï¼Œå½“nå–5æ—¶å€™ï¼Œåœ¨åˆ’åˆ†çš„æ—¶å€™<strong>è‡³å°‘</strong>ä¼šå¤§äº<strong>3n/10</strong>çš„å…ƒç´ ï¼Œé¿å…äº†æç«¯æƒ…å†µï¼Œä¿è¯åœ¨æœ€åæƒ…å†µä¸‹ä¹Ÿä¸ä¼šå¤ªåã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/image/20190617/Lc4M5f2qkegH.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å¦‚ä¸Šå›¾ï¼Œæ¯ä¸€åˆ—ä¸ºåˆ†å¥½çš„ä¸€ç»„å…ƒç´ ï¼Œä¸­é—´é»„è‰²éƒ¨åˆ†ä¸ºæ¯ç»„çš„ä¸­ä½æ•°ï¼Œçº¢è‰²å—ä¸º<strong>ä¸­ä½æ•°çš„ä¸­ä½æ•°</strong>ï¼Œè¿™ä¸ªä¸­ä½æ•°è‡³å°‘ä¼šå¤§äºç­‰äºå·¦ä¸Šè§’é»‘æ¡†æ¡†ä½çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨åˆ’åˆ†çš„æ—¶å€™ä¼šä¿è¯è‡³å°‘å‡å°å¤§çº¦3n/10 çš„è§„æ¨¡ã€‚</p><p>æ‰€ä»¥æ—¶é—´å¤æ‚åº¦   <code>T(N)<=T(n/5)+T( 7n/10)+c*n</code>  æ€»ä½“æ—¶é—´å¤æ‚åº¦<strong>O(N)</strong>ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–çš„å…ƒç´ å¯ä»¥çœ‹çœ‹ä¸Šé¢çš„é‚£ç¯‡æ–‡ç« ã€‚</p><h2 id="345-åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯"><a href="#345-åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯" class="headerlink" title="345. åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯"></a><a href="https://leetcode-cn.com/problems/reverse-vowels-of-a-string/" target="_blank" rel="noopener">345. åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯</a></h2><p>Write a function that takes a string as input and reverse only the vowels of a string.</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">Input: "hello"</span><br><span class="line">Output: "holle"</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">Input: "leetcode"</span><br><span class="line">Output: "leotcede"</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Note:</strong><br>The vowels does not include the letter â€œyâ€.</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reverseVowels</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="keyword">null</span>||s.length()<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">char</span>[] ss=s.toCharArray();</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=s.length()-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        <span class="keyword">while</span>(left<right && !isyy(ss[left])){< span><br><span class="line">            left++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span>(left<right && !isyy(ss[right])){< span><br><span class="line">            right--;</span><br><span class="line">        }</span><br><span class="line">        swap(left++,right--,ss);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(ss);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">isYy</span><span class="params">(<span class="keyword">char</span> ch)</span></span>{</span><br><span class="line">    <span class="keyword">char</span> temp=Character.toLowerCase(ch);</span><br><span class="line">    <span class="keyword">return</span> temp==<span class="string">'a'</span>|| temp==<span class="string">'e'</span>||temp==<span class="string">'i'</span>||temp==<span class="string">'o'</span>||temp==<span class="string">'u'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">char</span>[] s)</span></span>{</span><br><span class="line">    <span class="keyword">char</span> temp=s[a];</span><br><span class="line">    s[a]=s[b];</span><br><span class="line">    s[b]=temp;</span><br><span class="line">}</span><br></right></span></right></span></right){<></span></pre></td></tr></tbody></table></figure></div><p>å¾ˆç®€å•çš„å¯¹æ’æŒ‡é’ˆé¢˜</p><h2 id="88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"><a href="#88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„" class="headerlink" title="88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"></a><a href="https://leetcode-cn.com/problems/merge-sorted-array/" target="_blank" rel="noopener">88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></h2><p>Given two sorted integer arrays <em>nums1</em> and <em>nums2</em>, merge <em>nums2</em> into <em>nums1</em> as one sorted array.</p><p><strong>Note:</strong></p><ul><li>The number of elements initialized in <em>nums1</em> and <em>nums2</em> are <em>m</em> and <em>n</em> respectively.</li><li>You may assume that <em>nums1</em> has enough space (size that is greater or equal to <em>m</em> + <em>n</em>) to hold additional elements from <em>nums2</em>.</li></ul><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">nums1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>], m = <span class="number">3</span></span><br><span class="line">nums2 = [<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>],       n = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">Output: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br></pre></td></tr></tbody></table></figure></div><p>å…¸å‹çš„äºŒè·¯å½’å¹¶</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span> m, <span class="keyword">int</span>[] nums2, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums1.length<=<span class="number">0</span>||nums2.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> []res=<span class="keyword">new</span> <span class="keyword">int</span>[m+n];</span><br><span class="line">    <span class="keyword">int</span> i1=<span class="number">0</span>,i2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i1<m&&i2<n;i++) {< span><br><span class="line">        <span class="keyword">if</span>(nums1[i1]<=nums2[i2]) {</span><br><span class="line">            res[i]=nums1[i1++];</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums1[i1]>nums2[i2] ){</span><br><span class="line">            res[i]=nums2[i2++];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(i1>=m){</span><br><span class="line">        System.arraycopy(nums2,i2,res,i2+m,n-i2);</span><br><span class="line">    } <span class="keyword">else</span>{</span><br><span class="line">        System.arraycopy(nums1,i1,res,i1+n,m-i1);</span><br><span class="line">    }</span><br><span class="line">    System.arraycopy(res,<span class="number">0</span>,nums1,<span class="number">0</span>,res.length);</span><br><span class="line">}</span><br></m&&i2<n;i++)></span></pre></td></tr></tbody></table></figure></div><p>1ms ï¼Œ98%beats.</p><p>çœ‹äº†ä¸‹è¯„è®ºåŒºå‘ç°è‡ªå·±è¿˜æ˜¯å¤ªå¹´è½»äº†ï¼ŒåŸæ¥è¿™é¢˜æ˜¯å¯ä»¥åœ¨<strong>O(1)</strong>çš„ç©ºé—´å¤æ‚åº¦ä¸‹å®Œæˆçš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge3</span><span class="params">(<span class="keyword">int</span>[] nums1, <span class="keyword">int</span> m, <span class="keyword">int</span>[] nums2, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums1.length<=<span class="number">0</span>||nums2.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> i1=m-<span class="number">1</span>,i2=n-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=m+n-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">if</span>(i1<<span class="number">0</span>){</span><br><span class="line">            nums1[i]=nums2[i2--];</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(i2<<span class="number">0</span>){</span><br><span class="line">            nums1[i]=nums1[i1--];</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums1[i1]>nums2[i2]) {</span><br><span class="line">            nums1[i]=nums1[i1--];</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums1[i1]<=nums2[i2] ){</span><br><span class="line">            nums1[i]=nums2[i2--];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åˆå¹¶åçš„é•¿åº¦ç¡®å®šï¼Œnums1çš„ç©ºé—´ä¹Ÿè¶³å¤Ÿï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥ä»åå¾€å‰ï¼Œä»å¤§åˆ°å°ï¼Œä»è€Œé¿å…äº†ä½¿ç”¨é¢å¤–çš„ç©ºé—´å‚¨å­˜ç»“æœï¼Œå­¦åˆ°äº†å­¦åˆ°äº†ğŸ‘</p><h2 id="118-æ¨è¾‰ä¸‰è§’"><a href="#118-æ¨è¾‰ä¸‰è§’" class="headerlink" title="118. æ¨è¾‰ä¸‰è§’"></a><a href="https://leetcode-cn.com/problems/pascals-triangle/" target="_blank" rel="noopener">118. æ¨è¾‰ä¸‰è§’</a></h2><p>Given a non-negative integer <em>numRows</em>, generate the first <em>numRows</em> of Pascalâ€™s triangle.</p><p><img alt="img" data-src="https://upload.wikimedia.org/wikipedia/commons/0/0d/PascalTriangleAnimated2.gif" src="/img/loading.gif" class="lazyload"><br>In Pascalâ€™s triangle, each number is the sum of the two numbers directly above it.</p><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="number">5</span></span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">     [<span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">   [<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>],</span><br><span class="line"> [<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">1</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p>é€’å½’ä¸“é¢˜é‡Œé¢çš„é¢˜ç›®ï¼Œæ‰€ä»¥ç›´æ¥ç”¨é€’å½’æ¥å®ç°äº†ä¸‹ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List<list<integer>> generate(<span class="keyword">int</span> numRows) {</list<integer></span><br><span class="line">    <span class="keyword">if</span>(numRows<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList();</span><br><span class="line">    }</span><br><span class="line">    List<list<integer>> res = <span class="keyword">new</span> ArrayList<>();</list<integer></span><br><span class="line">    res.add(<span class="keyword">new</span> ArrayList<integer>() {</integer></span><br><span class="line">        {</span><br><span class="line">            add(<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    );</span><br><span class="line">    generate(<span class="number">1</span>, res.get(<span class="number">0</span>), res, numRows);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generate</span><span class="params">(<span class="keyword">int</span> numRow, List<integer> preRow, List<list<integer>> res, <span class="keyword">int</span> rowMax)</list<integer></integer></span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (rowMax == numRow) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    List<integer> row = <span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    row.add(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i < preRow.size(); i++) {</span><br><span class="line">        row.add(preRow.get(i - <span class="number">1</span>) + preRow.get(i));</span><br><span class="line">    }</span><br><span class="line">    row.add(<span class="number">1</span>);</span><br><span class="line">    res.add(row);</span><br><span class="line">    generate(numRow + <span class="number">1</span>,row,res,rowMax);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å°¾é€’å½’ï¼Œå¾ˆé¸¡è‚‹ã€‚</p><h2 id="119-æ¨è¾‰ä¸‰è§’-II"><a href="#119-æ¨è¾‰ä¸‰è§’-II" class="headerlink" title="119. æ¨è¾‰ä¸‰è§’ II"></a><a href="https://leetcode-cn.com/problems/pascals-triangle-ii/" target="_blank" rel="noopener">119. æ¨è¾‰ä¸‰è§’ II</a></h2><p>Given a non-negative index <em>k</em> where <em>k</em> â‰¤ 33, return the <em>k</em>th index row of the Pascalâ€™s triangle.</p><p>Note that the row index starts from 0.</p><p><img alt="img" data-src="https://upload.wikimedia.org/wikipedia/commons/0/0d/PascalTriangleAnimated2.gif" src="/img/loading.gif" class="lazyload"><br>In Pascalâ€™s triangle, each number is the sum of the two numbers directly above it.</p><p><strong>Example:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: <span class="number">3</span></span><br><span class="line">Output: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Follow up:</strong></p><p>Could you optimize your algorithm to use only <em>O</em>(<em>k</em>) extra space?</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<integer> <span class="title">getRow</span><span class="params">(<span class="keyword">int</span> rowIndex)</span> </integer></span>{</span><br><span class="line">       List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">       <span class="keyword">long</span> cur=<span class="number">1</span>;</span><br><span class="line">       res.add((<span class="keyword">int</span>)cur);</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i<=rowIndex;i++){</span><br><span class="line">           cur=cur*(rowIndex-i+<span class="number">1</span>)/i;</span><br><span class="line">           res.add((<span class="keyword">int</span>)cur);</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç›´æ¥åˆ©ç”¨ç»„åˆæ•°çš„å…¬å¼ï¼Œmåˆ—ç¬¬nä¸ªå…ƒç´ ç­‰äºC(n-1,M-1)</p><h2 id="54-èºæ—‹çŸ©é˜µ"><a href="#54-èºæ—‹çŸ©é˜µ" class="headerlink" title="54. èºæ—‹çŸ©é˜µ"></a><a href="https://leetcode-cn.com/problems/spiral-matrix/" target="_blank" rel="noopener">54. èºæ—‹çŸ©é˜µ</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å« m x n ä¸ªå…ƒç´ çš„çŸ©é˜µï¼ˆm è¡Œ, n åˆ—ï¼‰ï¼Œè¯·æŒ‰ç…§é¡ºæ—¶é’ˆèºæ—‹é¡ºåºï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line"> [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ],</span><br><span class="line"> [ <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> ],</span><br><span class="line"> [ <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span> ]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">  [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å¾ˆä¹…ä¹‹å‰åšè¿‡ï¼Œè¿™æ¬¡åˆæ¥åšçš„æ—¶å€™è¿˜æ˜¯æ²¡åšå‡ºæ¥ï¼Œå¿˜äº†ä¹‹å‰å’‹åšçš„äº†ï¼Œç”¨æ¨¡æ‹Ÿçš„æ–¹æ³•æäº†åŠå¤©ï¼Œæ²¡æå‡ºæ¥ï¼Œç„¶åç„äº†ä¸€çœ¼ä¹‹å‰å†™çš„æ‰å†™å‡ºæ¥â€¦.</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List<integer> <span class="title">spiralOrder2</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </integer></span>{</span><br><span class="line">    List<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">if</span>(matrix.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//a: è¡Œ</span></span><br><span class="line">    <span class="comment">//b: åˆ—</span></span><br><span class="line">    <span class="keyword">int</span> la=<span class="number">0</span>,lb=<span class="number">0</span>,ra=matrix.length-<span class="number">1</span>,rb=matrix[<span class="number">0</span>].length-<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">while</span>(lb<=rb && la<=ra){</span><br><span class="line">        <span class="comment">//ç¼“å­˜å„ä¸ªåæ ‡</span></span><br><span class="line">        <span class="keyword">int</span> tla=la,tlb=lb,tra=ra,trb=rb;</span><br><span class="line">        <span class="comment">//ç‰¹æ®Šæƒ…å†µï¼Œç‰¹æ®Šå¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span>(tla==tra){<span class="comment">//åŒä¸€è¡Œ</span></span><br><span class="line">            <span class="keyword">while</span>(tlb<=trb){</span><br><span class="line">                res.add(matrix[tla][tlb++]);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(tlb==trb){<span class="comment">//åŒä¸€åˆ—</span></span><br><span class="line">            <span class="keyword">while</span>(tla<=tra){</span><br><span class="line">                res.add(matrix[tla++][tlb]);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//å‘å·¦</span></span><br><span class="line">            <span class="keyword">while</span>(tlb<rb){< span><br><span class="line">                res.add(matrix[tla][tlb++]);</span><br><span class="line">            }</span><br><span class="line"><span class="comment">//å‘ä¸‹</span></span><br><span class="line">            <span class="keyword">while</span>(tla<ra){< span><br><span class="line">                res.add(matrix[tla++][tlb]);</span><br><span class="line">            }</span><br><span class="line"><span class="comment">//å‘å³</span></span><br><span class="line">            <span class="keyword">while</span>(trb>lb){</span><br><span class="line">                res.add(matrix[tra][trb--]);</span><br><span class="line">            }</span><br><span class="line"><span class="comment">//å‘ä¸Š</span></span><br><span class="line">            <span class="keyword">while</span>(tra>la){</span><br><span class="line">                res.add(matrix[tra--][trb]);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å‘å†…é æ‹¢(ç¼©åœˆ)</span></span><br><span class="line">        la++;</span><br><span class="line">        lb++;</span><br><span class="line">        ra--;</span><br><span class="line">        rb--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></ra){<></span></rb){<></span></pre></td></tr></tbody></table></figure></div><p>æ¨¡æ‹Ÿçš„æ–¹å¼ç›¸å¯¹è¦å¤æ‚ç‚¹ï¼Œéœ€è¦è®°å½•æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦è®¿é—®ç„¶ååœ¨é€‰æ‹©ï¼Œè¿™é‡Œçš„æ–¹å¼å°±å¾ˆå·§å¦™ï¼Œç›´æ¥æŒ‰å±‚éå†ï¼Œç”±å¤–åˆ°å†…ï¼Œä¸ç”¨è€ƒè™‘é‚£ä¹ˆå¤šã€‚æ—¶é—´å¤æ‚åº¦<code>O(NM)</code>ç©ºé—´å¤æ‚åº¦<code>O(NM)</code>ã€‚</p><h2 id="48-æ—‹è½¬å›¾åƒ"><a href="#48-æ—‹è½¬å›¾åƒ" class="headerlink" title="48. æ—‹è½¬å›¾åƒ"></a><a href="https://leetcode-cn.com/problems/rotate-image/" target="_blank" rel="noopener">48. æ—‹è½¬å›¾åƒ</a></h2><p>ç»™å®šä¸€ä¸ª <em>n</em> Ã— <em>n</em> çš„äºŒç»´çŸ©é˜µè¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚</p><p>å°†å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><p>ä½ å¿…é¡»åœ¨<strong>åŸåœ°</strong>æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚<strong>è¯·ä¸è¦</strong>ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Given input matrix = </span><br><span class="line">[</span><br><span class="line">  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">  [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],</span><br><span class="line">  [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">rotate the input matrix in-place such that it becomes:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">7</span>,<span class="number">4</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">8</span>,<span class="number">5</span>,<span class="number">2</span>],</span><br><span class="line">  [<span class="number">9</span>,<span class="number">6</span>,<span class="number">3</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Given input matrix =</span><br><span class="line">[</span><br><span class="line">  [ <span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>,<span class="number">11</span>],</span><br><span class="line">  [ <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>,<span class="number">10</span>],</span><br><span class="line">  [<span class="number">13</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>],</span><br><span class="line">  [<span class="number">15</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">16</span>]</span><br><span class="line">], </span><br><span class="line"></span><br><span class="line">rotate the input matrix in-place such that it becomes:</span><br><span class="line">[</span><br><span class="line">  [<span class="number">15</span>,<span class="number">13</span>, <span class="number">2</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="number">14</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>],</span><br><span class="line">  [<span class="number">12</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>],</span><br><span class="line">  [<span class="number">16</span>, <span class="number">7</span>,<span class="number">10</span>,<span class="number">11</span>]</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å’Œä¸Šé¢å“ªä¸€é¢˜æ”¾åœ¨ä¸€èµ·å¾ˆæœ‰å¿…è¦ï¼Œå¾ˆç±»ä¼¼çš„é¢˜å‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[][] matrix)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (matrix==<span class="keyword">null</span> || matrix.length==<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> len=matrix.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> lx=<span class="number">0</span>,ly=<span class="number">0</span>,rx=len,ry=len;</span><br><span class="line">    <span class="keyword">while</span>(lx<=rx){</span><br><span class="line">        <span class="comment">//len=ry-ly;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<len;i++) {< span><br><span class="line">            <span class="keyword">int</span> temp=matrix[lx][ly+i];</span><br><span class="line">            matrix[lx][ly+i]=matrix[rx-i][ly];</span><br><span class="line">            matrix[rx-i][ly]=matrix[rx][ry-i];</span><br><span class="line">            matrix[rx][ry-i]=matrix[lx+i][ry];</span><br><span class="line">            matrix[lx+i][ry]=temp;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ç¼©åœˆ</span></span><br><span class="line">        len-=<span class="number">2</span>; <span class="comment">//å†™ry-lyå¯èƒ½ä¼šå¥½ä¸€ç‚¹ï¼Œæ— æ‰€è°“</span></span><br><span class="line">        lx++;ly++;</span><br><span class="line">        rx--;ry--;</span><br><span class="line">    }</span><br><span class="line">}</span><br></len;i++)></span></pre></td></tr></tbody></table></figure></div><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯ä»æ•´ä½“å‡ºå‘ï¼Œä»å¤–å±‚åˆ°å†…å±‚ï¼Œè€ƒè™‘æ¯ä¸€å±‚çš„å‰<code>n-1</code>ä¸ªèŠ‚ç‚¹çš„æ—‹è½¬è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦è‡ªå·±åœ¨çº¸ä¸Šç”»ä¸€ç”»ï¼Œç©ºæƒ³å®¹æ˜“æé”™</p><h2 id="347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ "><a href="#347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ " class="headerlink" title="347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/top-k-frequent-elements/" target="_blank" rel="noopener">347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ </a></h2><p>ç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>], k = <span class="number">2</span></span><br><span class="line">è¾“å‡º: [<span class="number">1</span>,<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: nums = [<span class="number">1</span>], k = <span class="number">1</span></span><br><span class="line">è¾“å‡º: [<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ä½ å¯ä»¥å‡è®¾ç»™å®šçš„ k æ€»æ˜¯åˆç†çš„ï¼Œä¸” <span class="number">1</span> â‰¤ k â‰¤ æ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ã€‚</span><br><span class="line">ä½ çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¿…é¡»ä¼˜äº O(n log n) , n æ˜¯æ•°ç»„çš„å¤§å°ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p>ä¹Ÿæ˜¯TopKé—®é¢˜ï¼Œä½†æ˜¯è¿™é¢˜å…¶å®è¿˜æœ‰ä¸ªæ¡ä»¶ï¼Œ<code>ä¸ä¼šç»™å‡ºæœ‰æ­§ä¹‰çš„æ•°æ®</code> ï¼Œä¸¾ä¸ªä¾‹å­</p><p><code>nums=[1,1,1,2,2,2,3,3,3] ï¼Œk=2</code> è¿™æ ·çš„å°±æ˜¯æœ‰æ­§ä¹‰çš„</p><p>ä½†æ˜¯é¢˜ç›®ä¸­ä¹Ÿæ²¡æœ‰è§„å®šè¿™æ ·çš„å¦‚ä½•å¤„ç†ï¼Œç»è¿‡æµ‹è¯•ï¼Œå‘ç°å®˜æ–¹çš„è§£åœ¨é‡åˆ°è¿™ç§æƒ…å†µä¼šæŠ›ä¸€ä¸ªå¼‚å¸¸ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>å¤§æ ¹å †çš„åšæ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List<integer> <span class="title">topKFrequent</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </integer></span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    HashMap<integer,integer> fre=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//fre.get(i) nums[i]å‡ºç°çš„é¢‘æ¬¡</span></span><br><span class="line">        fre.put(nums[i],fre.getOrDefault(nums[i],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//1:3,2:3,3:1</span></span><br><span class="line">    PriorityQueue<hashmap.entry<integer,integer>> pq=<span class="keyword">new</span> PriorityQueue(<span class="keyword">new</span> ComparatorMap());</hashmap.entry<integer,integer></span><br><span class="line">    <span class="keyword">for</span> (HashMap.Entry ent:fre.entrySet()) {</span><br><span class="line">        pq.add(ent);</span><br><span class="line">    }</span><br><span class="line">    ArrayList<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<k;i++) {< span><br><span class="line">        res.add(pq.poll().getKey());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¯”è¾ƒå™¨</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ComparatorMap</span> <span class="keyword">implements</span> <span class="title">Comparator</span><<span class="title">HashMap</span>.<span class="title">Entry</span><<span class="title">Integer</span>,<span class="title">Integer</span>>></span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Map.Entry<integer, integer> o1, Map.Entry<integer, integer> o2)</integer,></integer,></span> </span>{</span><br><span class="line">        <span class="keyword">return</span> o2.getValue()-o1.getValue();</span><br><span class="line">    }</span><br><span class="line">}</span><br></k;i++)></span></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>ç”¨å¤§æ ¹å †ä¸å¤ªå¥½ï¼Œå®¹æ˜“çˆ†å†…å­˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸€é¢˜å¯ä»¥ä¿è¯é¡ºåºï¼Œ<code>ä½†æ˜¯é¢˜ç›®å¹¶æ²¡æœ‰è¦æ±‚é¡ºåº</code>ï¼Œæ—¶é—´å¤æ‚åº¦<del>O(KlogN)</del></p><p>è¿™é‡Œé”™äº†ï¼Œå»ºå †çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯<code>O(NlogN)</code>äº†ï¼Œåªæœ‰è‡ªå·±æ‰‹å†™çš„å †ï¼Œé‡‡ç”¨è‡ªåº•å‘ä¸Šçš„æ–¹å¼å»ºå †æ—¶é—´å¤æ‚åº¦æ‰æ˜¯O(N) ï¼Œå¯ä»¥å‚è€ƒ <a href="http://imlgw.top/2018/12/11/chang-jian-pai-xu-suan-fa-zong-jie/#%E5%A0%86%E6%8E%92%E5%BA%8F%E6%9B%B4%E4%BC%98%E7%9A%84%E5%81%9A%E6%B3%95">ä¹‹å‰çš„æ–‡ç« </a> ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šé¢topKé—®é¢˜ä¸­æåˆ°çš„</p><p><strong>è§£æ³•äºŒ</strong></p><p>å°æ ¹å †çš„åšæ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List<integer> <span class="title">topKFrequent</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </integer></span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    HashMap<integer,integer> fre=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//fre.get(i) nums[i]å‡ºç°çš„é¢‘æ¬¡</span></span><br><span class="line">        fre.put(nums[i],fre.getOrDefault(nums[i],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//1:3,2:3,3:1</span></span><br><span class="line">    <span class="comment">//å…¶å®å¯ä»¥è¿™æ ·å†™ï¼Œä½†æ˜¯å¯¹æ¯”äº†ä¸€ä¸‹lambdaå¤§æ¦‚è¦60msï¼Œè€Œç›´æ¥æ„é€ æ¯”è¾ƒå™¨åªè¦20ms</span></span><br><span class="line">    <span class="comment">//PriorityQueue<hashmap.entry<integer,integer>> pq=new PriorityQueue<>((o1,o2)->o1.getValue()-o2.getValue());</hashmap.entry<integer,integer></span></span><br><span class="line">    PriorityQueue<hashmap.entry<integer,integer>> pq=<span class="keyword">new</span> PriorityQueue(<span class="keyword">new</span> ComparatorMap());</hashmap.entry<integer,integer></span><br><span class="line">    <span class="keyword">for</span> (HashMap.Entry ent:fre.entrySet()) {</span><br><span class="line">        pq.add(ent);</span><br><span class="line">        <span class="keyword">if</span>(pq.size()>k){</span><br><span class="line">            pq.poll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    ArrayList<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">while</span> (!pq.isEmpty()) {</span><br><span class="line">        res.add(pq.poll().getKey());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ComparatorMap</span> <span class="keyword">implements</span> <span class="title">Comparator</span><<span class="title">HashMap</span>.<span class="title">Entry</span><<span class="title">Integer</span>,<span class="title">Integer</span>>></span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Map.Entry<integer, integer> o1, Map.Entry<integer, integer> o2)</integer,></integer,></span> </span>{</span><br><span class="line">        <span class="keyword">return</span> o1.getValue()-o2.getValue();</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚åº¦<code>O(NlogK)</code>å› ä¸ºåªç»´æŠ¤äº†ä¸€ä¸ªKå¤§å°çš„å°æ ¹å † ï¼Œæ—¶é—´å¤æ‚åº¦å’Œå¤§æ ¹å †<del>O(KlogN)</del> <code>O(NlogN)</code>ç›¸æ¯”ä¼šå¿«å¾ˆå¤šï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœNå’ŒKå¾ˆæ¥è¿‘çš„è¯å¯ä»¥è€ƒè™‘<code>O(Nlog(N-K))</code> çš„åšæ³•ï¼Œç»´æŠ¤ä¸€ä¸ªN-Kçš„å¤§æ ¹å †ï¼Œé‡Œé¢å­˜é¢‘ç‡æœ€ä½çš„é‚£äº›å…ƒç´ ï¼Œæœ€åè¿”å›å…¶ä»–çš„å…ƒç´ ï¼ˆno codeï¼Œ just talkï¼‰</p><p><strong>è§£æ³•ä¸‰</strong></p><p>æ¡¶æ’åºï¼Œè¿™é¢˜çš„æœ€ä¼˜è§£åº”è¯¥å°±æ˜¯æ¡¶æ’åº</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List<integer> <span class="title">topKFrequent</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </integer></span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    HashMap<integer,integer> fre=<span class="keyword">new</span> HashMap<>();</integer,integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++) {< span><br><span class="line">        <span class="comment">//è®°å½•nums[i]å‡ºç°çš„é¢‘æ¬¡</span></span><br><span class="line">        fre.put(nums[i],fre.getOrDefault(nums[i],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    ArrayList<integer> [] bucket=<span class="keyword">new</span> ArrayList[nums.length+<span class="number">1</span>];</integer></span><br><span class="line">    <span class="keyword">for</span> (Integer num:fre.keySet()) {</span><br><span class="line">        <span class="keyword">if</span>(bucket[fre.get(num)]==<span class="keyword">null</span>){</span><br><span class="line">            bucket[fre.get(num)]=<span class="keyword">new</span> ArrayList<>();</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ¡¶æ’åº</span></span><br><span class="line">        bucket[fre.get(num)].add(num); <span class="comment">//æ‰€æœ‰å‡ºç°fre.get(num)æ¬¡çš„å…ƒç´ æ„æˆä¸€æ¡é“¾è¡¨</span></span><br><span class="line">    }</span><br><span class="line">    ArrayList<integer> res=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">int</span> topk=bucket.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">        <span class="comment">//ä»åå‘å‰éå†ï¼ˆä»é¢‘æ¬¡å¤§åˆ°å°ï¼‰</span></span><br><span class="line">        <span class="comment">//æŒ‡é’ˆç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">while</span>(bucket[topk]==<span class="keyword">null</span>&&topk><span class="number">0</span>){</span><br><span class="line">            topk--;</span><br><span class="line">        }</span><br><span class="line">        res.addAll(bucket[topk--]);</span><br><span class="line">        <span class="keyword">if</span>(res.size()==k){</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ¡¶æ’åºçš„æ€è·¯ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(N)</code>ï¼Œç©ºé—´å¤æ‚åº¦ä¹Ÿæ˜¯<code>O(N)</code>ï¼Œåœ¨leetcodeæäº¤ä¸‰ç§æ–¹æ³•çš„å·®è·ä¸å¤§ï¼Œå¯èƒ½æ˜¯æ•°æ®é‡å¤ªå°‘äº†</p><h2 id="67-äºŒè¿›åˆ¶æ±‚å’Œ"><a href="#67-äºŒè¿›åˆ¶æ±‚å’Œ" class="headerlink" title="67. äºŒè¿›åˆ¶æ±‚å’Œ"></a><a href="https://leetcode-cn.com/problems/add-binary/" target="_blank" rel="noopener">67. äºŒè¿›åˆ¶æ±‚å’Œ</a></h2><p>ç»™å®šä¸¤ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿”å›ä»–ä»¬çš„å’Œï¼ˆç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚</p><p>è¾“å…¥ä¸ºéç©ºå­—ç¬¦ä¸²ä¸”åªåŒ…å«æ•°å­— 1 å’Œ 0ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: a = <span class="string">"11"</span>, b = <span class="string">"1"</span></span><br><span class="line">è¾“å‡º: <span class="string">"100"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: a = <span class="string">"1010"</span>, b = <span class="string">"1011"</span></span><br><span class="line">è¾“å‡º: <span class="string">"10101"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é¢˜å’Œä¸‹é¢çš„é¢˜ç›®æ˜¯æˆ‘æœ‰æ„æ”¾åœ¨ä¸€èµ·çš„ï¼Œè¿™é¢˜ä¹Ÿå¯ä»¥ä½œä¸ºå¤§æ•°ç›¸åŠ çš„æ¨¡æ¿</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addBinary</span><span class="params">(String a, String b)</span> </span>{</span><br><span class="line">    StringBuilder res=<span class="keyword">new</span> StringBuilder(); </span><br><span class="line">    <span class="keyword">int</span> idxA=a.length()-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> idxB=b.length()-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">boolean</span> carry=<span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//int carry=0;</span></span><br><span class="line">    <span class="keyword">while</span>(idxA >=<span class="number">0</span> || idxB >=<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">char</span> bina=idxA>=<span class="number">0</span>?a.charAt(idxA):<span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">char</span> binb=idxB>=<span class="number">0</span>?b.charAt(idxB):<span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">if</span>(bina == <span class="string">'1'</span> && binb ==<span class="string">'1'</span>){</span><br><span class="line">            res.append(carry?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">            carry=<span class="keyword">true</span>;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>((bina == <span class="string">'1'</span> && binb ==<span class="string">'0'</span>) ||(bina == <span class="string">'0'</span> && binb ==<span class="string">'1'</span>)){</span><br><span class="line">            res.append(carry?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            res.append(carry?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">            carry=<span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        idxA--;idxB--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(carry) res.append(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> res.reverse().toString();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="43-å­—ç¬¦ä¸²ç›¸ä¹˜"><a href="#43-å­—ç¬¦ä¸²ç›¸ä¹˜" class="headerlink" title="43. å­—ç¬¦ä¸²ç›¸ä¹˜"></a><a href="https://leetcode-cn.com/problems/multiply-strings/" target="_blank" rel="noopener">43. å­—ç¬¦ä¸²ç›¸ä¹˜</a></h2><p>ç»™å®šä¸¤ä¸ªä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºçš„éè´Ÿæ•´æ•° num1 å’Œ num2ï¼Œè¿”å› num1 å’Œ num2 çš„ä¹˜ç§¯ï¼Œå®ƒä»¬çš„ä¹˜ç§¯ä¹Ÿè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å½¢å¼ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: num1 = <span class="string">"2"</span>, num2 = <span class="string">"3"</span></span><br><span class="line">è¾“å‡º: <span class="string">"6"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: num1 = <span class="string">"123"</span>, num2 = <span class="string">"456"</span></span><br><span class="line">è¾“å‡º: <span class="string">"56088"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ï¼š</strong></p><ol><li>num1 å’Œ num2 çš„é•¿åº¦å°äº110ã€‚</li><li>num1 å’Œ num2 åªåŒ…å«æ•°å­— 0-9ã€‚</li><li>num1 å’Œ num2 å‡ä¸ä»¥é›¶å¼€å¤´ï¼Œé™¤éæ˜¯æ•°å­— 0 æœ¬èº«ã€‚</li><li>ä¸èƒ½ä½¿ç”¨ä»»ä½•æ ‡å‡†åº“çš„å¤§æ•°ç±»å‹ï¼ˆæ¯”å¦‚ BigIntegerï¼‰æˆ–ç›´æ¥å°†è¾“å…¥è½¬æ¢ä¸ºæ•´æ•°æ¥å¤„ç†ã€‚</li></ol><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">multiply2</span><span class="params">(String num1, String num2)</span> </span>{</span><br><span class="line">    <span class="comment">// 1 2 3 </span></span><br><span class="line">    <span class="comment">// 4 5 6</span></span><br><span class="line">    <span class="comment">// 501 6</span></span><br><span class="line">    <span class="keyword">int</span> n1=num1.length();</span><br><span class="line">    <span class="keyword">int</span> n2=num2.length();</span><br><span class="line">    <span class="comment">//n1*n2 ç»“æœæœ€é•¿ä¸º n1+n2</span></span><br><span class="line">    <span class="keyword">int</span>[] res=<span class="keyword">new</span> <span class="keyword">int</span>[n1+n2];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=n1-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=n2-<span class="number">1</span>;j>=<span class="number">0</span>;j--) {</span><br><span class="line">            <span class="comment">//ä¸»è¦å°±æ˜¯å¯¹è¿™ä¸ªi+j+1çš„ç†è§£</span></span><br><span class="line">            res[i+j+<span class="number">1</span>]+=(num1.charAt(i)-<span class="number">48</span>)*(num2.charAt(j)-<span class="number">48</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¤„ç†è¿›ä½</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=res.length-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">if</span>(res[i]>=<span class="number">10</span>){</span><br><span class="line">            res[i-<span class="number">1</span>]+=res[i]/<span class="number">10</span>;</span><br><span class="line">            res[i]%=<span class="number">10</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å»æ‰å‰é¢å¤šä½™çš„0</span></span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (index<res.length-<span class="number">1</res.length-<span></span>&&res[index]==<span class="number">0</span>) { <br><span class="line">        index++;</span><br><span class="line">    }</span><br><span class="line">    StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i<res.length;i++) {< span><br><span class="line">        sb.append(res[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">}</span><br></res.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å…¶å®å°±æ˜¯æ¨¡æ‹Ÿçš„æ‰‹ç®—çš„è¿‡ç¨‹ï¼Œå…³é”®çš„åœ°æ–¹å°±æ˜¯ <code>i+j+1</code> çš„ç†è§£</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190928/4xnHi4yd4hwA.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è§£æ³•äºŒ</strong></p><p>å…¶å®ä»”ç»†åˆ†æï¼Œä¼šå‘ç°ä¸Šé¢çš„ä»£ç å…¶å®æœ‰å¾ˆå¤šå¤šä½™çš„æ“ä½œï¼Œæ¯”å¦‚å»æ‰å‰é¢çš„0ï¼Œå› ä¸ºä¸¤ä¸ª<strong>é0çš„æ•°ç›¸ä¹˜</strong>ï¼Œæœ€åçš„ç»“æœæœ€å¤šn1+n2ä½ï¼Œæœ€å°‘n1+n2-1ä½ï¼Œæ‰€ä»¥å‰é¢çš„0<strong>æœ€å¤šå°±ä¸€ä¸ª</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">multiply</span><span class="params">(String num1, String num2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (num1.equals(<span class="string">"0"</span>) || num2.equals(<span class="string">"0"</span>)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"0"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> n1=num1.length();</span><br><span class="line">    <span class="keyword">int</span> n2=num2.length();</span><br><span class="line">    <span class="keyword">int</span>[] res=<span class="keyword">new</span> <span class="keyword">int</span>[n1+n2];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=n1-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=n2-<span class="number">1</span>;j>=<span class="number">0</span>;j--) {</span><br><span class="line">            <span class="comment">//æ³¨æ„è¿™é‡Œçš„i+j+1</span></span><br><span class="line">            res[i+j+<span class="number">1</span>]+=(num1.charAt(i)-<span class="number">48</span>)*(num2.charAt(j)-<span class="number">48</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¤„ç†è¿›ä½(å…¶å®è¿™é‡Œres[0]æ˜¯ä¸å¯èƒ½å¤§äº10çš„)ï¼Œæ¨¡æ‹Ÿä¸‹çŸ¥é“äº†</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=res.length-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">if</span>(res[i]>=<span class="number">10</span>){</span><br><span class="line">            res[i-<span class="number">1</span>]+=res[i]/<span class="number">10</span>;</span><br><span class="line">            res[i]%=<span class="number">10</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<res.length;i++) {< span><br><span class="line">        <span class="comment">//å‰é¢æœ€å¤šåªæœ‰ä¸€ä¸ª0(é™¤äº†ä¸¤ä¸ªæ•°ä¸­æœ‰ä¸€ä¸ªä¸º0çš„æ—¶å€™)</span></span><br><span class="line">        <span class="keyword">if</span> (i==<span class="number">0</span> && res[i]==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        sb.append(res[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">}</span><br></res.length;i++)></span></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰</strong></p><p>å…¶å®ä¸Šé¢çš„è¿›ä½å’Œè®¡ç®—å¯¹åº”ä½ç½®çš„å€¼å¯ä»¥åŒæ—¶å¤„ç†ï¼Œè¿™æ˜¯æœ€æ¥è¿‘äººæ‰‹ç®—çš„æ€è·¯äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">multiply3</span><span class="params">(String num1, String num2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (num1.equals(<span class="string">"0"</span>) || num2.equals(<span class="string">"0"</span>)) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"0"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> n1=num1.length();</span><br><span class="line">    <span class="keyword">int</span> n2=num2.length();</span><br><span class="line">    <span class="keyword">int</span>[] res=<span class="keyword">new</span> <span class="keyword">int</span>[n1+n2];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=n1-<span class="number">1</span>;i>=<span class="number">0</span>;i--) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=n2-<span class="number">1</span>;j>=<span class="number">0</span>;j--) {</span><br><span class="line">            <span class="keyword">int</span> sum=res[i+j+<span class="number">1</span>]+(num1.charAt(i)-<span class="number">48</span>)*(num2.charAt(j)-<span class="number">48</span>);</span><br><span class="line">            res[i+j+<span class="number">1</span>]=sum%<span class="number">10</span>;</span><br><span class="line">            res[i+j]+=sum/<span class="number">10</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<res.length;i++) {< span><br><span class="line">        <span class="comment">//å‰é¢æœ€å¤šåªæœ‰ä¸€ä¸ª0(é™¤äº†ä¸¤ä¸ªæ•°ä¸­æœ‰ä¸€ä¸ªä¸º0çš„æ—¶å€™)</span></span><br><span class="line">        <span class="keyword">if</span> (i==<span class="number">0</span> && res[i]==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        sb.append(res[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">}</span><br></res.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="392-åˆ¤æ–­å­åºåˆ—"><a href="#392-åˆ¤æ–­å­åºåˆ—" class="headerlink" title="392. åˆ¤æ–­å­åºåˆ—"></a><a href="https://leetcode-cn.com/problems/is-subsequence/" target="_blank" rel="noopener">392. åˆ¤æ–­å­åºåˆ—</a></h2><p>ç»™å®šå­—ç¬¦ä¸² s å’Œ t ï¼Œåˆ¤æ–­ s æ˜¯å¦ä¸º t çš„å­åºåˆ—ã€‚</p><p>ä½ å¯ä»¥è®¤ä¸º s å’Œ t ä¸­ä»…åŒ…å«è‹±æ–‡å°å†™å­—æ¯ã€‚å­—ç¬¦ä¸² t å¯èƒ½ä¼šå¾ˆé•¿ï¼ˆé•¿åº¦ ~= 500,000ï¼‰ï¼Œè€Œ s æ˜¯ä¸ªçŸ­å­—ç¬¦ä¸²ï¼ˆé•¿åº¦ <=100ï¼‰ã€‚</p><p>å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­åºåˆ—æ˜¯åŸå§‹å­—ç¬¦ä¸²åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å­—ç¬¦è€Œä¸æ”¹å˜å‰©ä½™å­—ç¬¦ç›¸å¯¹ä½ç½®å½¢æˆçš„æ–°å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å¦‚ï¼Œ<code>"ace"</code>æ˜¯<code>"abcde"</code>çš„ä¸€ä¸ªå­åºåˆ—ï¼Œè€Œ<code>"aec"</code>ä¸æ˜¯ï¼‰ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">s = <span class="string">"abc"</span>, t = <span class="string">"ahbgdc"</span></span><br><span class="line">è¿”å› <span class="keyword">true</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">s = <span class="string">"axc"</span>, t = <span class="string">"ahbgdc"</span></span><br><span class="line">è¿”å› <span class="keyword">false</span>.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>åç»­æŒ‘æˆ˜ :</strong></p><p>å¦‚æœæœ‰å¤§é‡è¾“å…¥çš„ Sï¼Œç§°ä½œS1, S2, â€¦ , Sk å…¶ä¸­ k >= 10äº¿ï¼Œä½ éœ€è¦ä¾æ¬¡æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸º T çš„å­åºåˆ—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šæ€æ ·æ”¹å˜ä»£ç ï¼Ÿ</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSubsequence</span><span class="params">(String s, String t)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span> || t==<span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> sindex=<span class="number">0</span>,tindex=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(sindex<s.length()) {< span><br><span class="line">        <span class="keyword">while</span>(tindex<t.length() && sindex<s.length()){< span><br><span class="line">            <span class="keyword">if</span> (s.charAt(sindex)==t.charAt(tindex)) {</span><br><span class="line">                sindex++;</span><br><span class="line">            }</span><br><span class="line">            tindex++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (tindex==t.length()) {</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sindex==s.length();</span><br><span class="line">}</span><br></t.length()></span></s.length())></span></pre></td></tr></tbody></table></figure></div><p>å¯ä»¥æ”¹æˆé€’å½’ï¼ˆå¤šç»ƒä¹ é€’å½’ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSubsequence</span><span class="params">(String s,String t)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> subsequence(s,t,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">subsequence</span><span class="params">(String s,String t,<span class="keyword">int</span> sindex,<span class="keyword">int</span> tindex)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (sindex == s.length()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸Šä¸‹ifä¸èƒ½äº¤æ¢,å¯èƒ½æœ€åä¸€ä¸ªæ‰ç›¸ç­‰</span></span><br><span class="line">    <span class="keyword">if</span> (tindex == t.length()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> s.charAt(sindex)==t.charAt(tindex)?subsequence(s,t,sindex+<span class="number">1</span>,tindex+<span class="number">1</span>):subsequence(s,t,sindex,tindex+<span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å¤§é‡çš„så­—ç¬¦ä¸² å¤„ç†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSubsequence3</span><span class="params">(String s, String t)</span> </span>{</span><br><span class="line">    <span class="comment">//é¢„å¤„ç†</span></span><br><span class="line">    ArrayList<arraylist<integer>> hash=<span class="keyword">new</span> ArrayList<>();</arraylist<integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">26</span>;i++) {</span><br><span class="line">        hash.add(<span class="keyword">new</span> ArrayList());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<t.length();i++) {< span><br><span class="line">        hash.get(t.charAt(i)-<span class="string">'a'</span>).add(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ç»è¿‡ä¸Šé¢çš„é¢„å¤„ç†,åé¢çš„å¤„ç†å°±ä¼šå¾ˆå¿«,ä¸ç”¨å†éå†tå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">int</span> lastIndex=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<s.length();i++) {< span><br><span class="line">        List<integer> indexList=hash.get(s.charAt(i)-<span class="string">'a'</span>);</integer></span><br><span class="line">        <span class="keyword">int</span> temp=binarySearch(indexList,lastIndex);</span><br><span class="line">        <span class="keyword">if</span> (temp==indexList.size()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        lastIndex=indexList.get(temp);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”targetå¤§çš„å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(List<integer> list,<span class="keyword">int</span> target)</integer></span></span>{</span><br><span class="line">    <span class="keyword">int</span> left=<span class="number">0</span>,right=list.size()-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<=right){</span><br><span class="line">        <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (list.get(mid)>target) {</span><br><span class="line">            right=mid-<span class="number">1</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            left=mid+<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">}</span><br></s.length();i++)></span></t.length();i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="189-æ—‹è½¬æ•°ç»„"><a href="#189-æ—‹è½¬æ•°ç»„" class="headerlink" title="189. æ—‹è½¬æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/rotate-array/" target="_blank" rel="noopener">189. æ—‹è½¬æ•°ç»„</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>] å’Œ k = <span class="number">3</span></span><br><span class="line">è¾“å‡º: [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">è§£é‡Š:</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">1</span> æ­¥: [<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">2</span> æ­¥: [<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">3</span> æ­¥: [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [-<span class="number">1</span>,-<span class="number">100</span>,<span class="number">3</span>,<span class="number">99</span>] å’Œ k = <span class="number">2</span></span><br><span class="line">è¾“å‡º: [<span class="number">3</span>,<span class="number">99</span>,-<span class="number">1</span>,-<span class="number">100</span>]</span><br><span class="line">è§£é‡Š: </span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">1</span> æ­¥: [<span class="number">99</span>,-<span class="number">1</span>,-<span class="number">100</span>,<span class="number">3</span>]</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">2</span> æ­¥: [<span class="number">3</span>,<span class="number">99</span>,-<span class="number">1</span>,-<span class="number">100</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜:</strong></p><ul><li>å°½å¯èƒ½æƒ³å‡ºæ›´å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li><li>è¦æ±‚ä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸º O(1) çš„ <strong>åŸåœ°</strong> ç®—æ³• </li></ul><p><strong>è§£æ³•ä¸€</strong></p><p>å¸¸è§„è§£æ³•ï¼Œæ¯æ¬¡ä¿ç•™æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»åå¾€å‰å°†æ¯ä¸ªå…ƒç´ èµ‹å€¼ä¸ºå‰ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œè¿™æ ·å°±ç›¸å½“äºå°†æ•°ç»„æ•´ä½“å‘åå¾ªç¯ç§»åŠ¨ä¸€æ¬¡ï¼Œå¾ªç¯ç§»åŠ¨kæ¬¡å°±æ˜¯æœ€åçš„ç»“æœ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">1</span>||k==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    k=k%len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<k;i++) {< span><br><span class="line">        <span class="keyword">int</span> temp=nums[len-<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=len-<span class="number">1</span>;j>=<span class="number">0</span>;j--) {</span><br><span class="line">            nums[j]=nums[j-<span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line">        nums[<span class="number">0</span>]=temp;</span><br><span class="line">    }</span><br><span class="line">}</span><br></k;i++)></span></pre></td></tr></tbody></table></figure></div><p>æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œ<code>O(NK)</code> Javaå¯ä»¥è¿‡ï¼Œä½†æ˜¯C/C++å¯èƒ½è¿‡ä¸äº†</p><p><strong>è§£æ³•äºŒ</strong></p><p>è¿™ä¸ªåšæ³•å°±ç›¸å½“å·§å¦™äº†ï¼Œä¸‰æ¬¡ç¿»è½¬ğŸ‚ğŸº</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç¿»è½¬çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="keyword">null</span>||nums.length<=<span class="number">1</span>||k==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> len=nums.length;</span><br><span class="line">    k=k%len;</span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span>;</span><br><span class="line">    reverse(nums,<span class="number">0</span>,len-k-<span class="number">1</span>);</span><br><span class="line">    reverse(nums,len-k,len-<span class="number">1</span>);</span><br><span class="line">    reverse(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(left<right){< span><br><span class="line">        swap(nums,left++,right--);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></right){<></span></pre></td></tr></tbody></table></figure></div><p><code>O(N)</code> åº”è¯¥æ˜¯æœ€ä¼˜è§£äº†</p><h2 id="1232-ç¼€ç‚¹æˆçº¿"><a href="#1232-ç¼€ç‚¹æˆçº¿" class="headerlink" title="1232. ç¼€ç‚¹æˆçº¿"></a><a href="https://leetcode-cn.com/problems/check-if-it-is-a-straight-line/" target="_blank" rel="noopener">1232. ç¼€ç‚¹æˆçº¿</a></h2><p>åœ¨ä¸€ä¸ª XY åæ ‡ç³»ä¸­æœ‰ä¸€äº›ç‚¹ï¼Œæˆ‘ä»¬ç”¨æ•°ç»„ coordinates æ¥åˆ†åˆ«è®°å½•å®ƒä»¬çš„åæ ‡ï¼Œå…¶ä¸­ coordinates[i] = [x, y] è¡¨ç¤ºæ¨ªåæ ‡ä¸º xã€çºµåæ ‡ä¸º y çš„ç‚¹ã€‚</p><p>è¯·ä½ æ¥åˆ¤æ–­ï¼Œè¿™äº›ç‚¹æ˜¯å¦åœ¨è¯¥åæ ‡ç³»ä¸­å±äºåŒä¸€æ¡ç›´çº¿ä¸Šï¼Œæ˜¯åˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¯·è¿”å›  <code>false</code></p><p><strong>è§£æ³•ä¸€</strong></p><p>10.20ç«èµ›ç¬¬ä¸€é¢˜ï¼Œåˆ¤æ–­ç»™å®šçš„ç‚¹æ˜¯ä¸æ˜¯å†ä¸€æ¡ç›´çº¿ä¸Šï¼Œåˆ¤æ–­å’Œå‰ä¸¤ä¸ªç‚¹æ˜¯ä¸æ˜¯åœ¨ä¸€æ¡ç›´çº¿ä¸Šï¼Œæ³¨æ„ä¸è¦ç›´æ¥é™¤ç®—æ–œç‡ï¼Œé‚£æ ·æ˜¯ä¸å‡†ç¡®çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkStraightLine</span><span class="params">(<span class="keyword">int</span>[][] coordinates)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i<coordinates.length;i++) {< span><br><span class="line">        <span class="keyword">if</span>((coordinates[i][<span class="number">1</span>]-coordinates[i-<span class="number">1</span>][<span class="number">1</span>])*(coordinates[i-<span class="number">1</span>][<span class="number">0</span>]-coordinates[i-<span class="number">2</span>][<span class="number">0</span>])!=</span><br><span class="line">           (coordinates[i][<span class="number">0</span>]-coordinates[i-<span class="number">1</span>][<span class="number">0</span>])*(coordinates[i-<span class="number">1</span>][<span class="number">1</span>]-coordinates[i-<span class="number">2</span>][<span class="number">1</span>])){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></coordinates.length;i++)></span></pre></td></tr></tbody></table></figure></div><h2 id="1233-åˆ é™¤å­æ–‡ä»¶å¤¹"><a href="#1233-åˆ é™¤å­æ–‡ä»¶å¤¹" class="headerlink" title="1233. åˆ é™¤å­æ–‡ä»¶å¤¹"></a><a href="https://leetcode-cn.com/problems/remove-sub-folders-from-the-filesystem/" target="_blank" rel="noopener">1233. åˆ é™¤å­æ–‡ä»¶å¤¹</a></h2><p>ä½ æ˜¯ä¸€ä½ç³»ç»Ÿç®¡ç†å‘˜ï¼Œæ‰‹é‡Œæœ‰ä¸€ä»½æ–‡ä»¶å¤¹åˆ—è¡¨ folderï¼Œä½ çš„ä»»åŠ¡æ˜¯è¦åˆ é™¤è¯¥åˆ—è¡¨ä¸­çš„æ‰€æœ‰ å­æ–‡ä»¶å¤¹ï¼Œå¹¶ä»¥ ä»»æ„é¡ºåº è¿”å›å‰©ä¸‹çš„æ–‡ä»¶å¤¹ã€‚</p><p>æˆ‘ä»¬è¿™æ ·å®šä¹‰ã€Œå­æ–‡ä»¶å¤¹ã€ï¼š</p><ul><li><p>å¦‚æœæ–‡ä»¶å¤¹ <code>folder[i]</code> ä½äºå¦ä¸€ä¸ªæ–‡ä»¶å¤¹ <code>folder[j]</code> ä¸‹ï¼Œé‚£ä¹ˆ <code>folder[i]</code> å°±æ˜¯ <code>folder[j]</code> çš„å­æ–‡ä»¶å¤¹ã€‚<br>æ–‡ä»¶å¤¹çš„ã€Œè·¯å¾„ã€æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‰ä»¥ä¸‹æ ¼å¼ä¸²è”å½¢æˆçš„å­—ç¬¦ä¸²ï¼š</p></li><li><p><code>/</code> åè·Ÿä¸€ä¸ªæˆ–è€…å¤šä¸ªå°å†™è‹±æ–‡å­—æ¯ã€‚<br>ä¾‹å¦‚ï¼Œ<code>/leetcode</code> å’Œ <code>/leetcode/problems</code> éƒ½æ˜¯æœ‰æ•ˆçš„è·¯å¾„ï¼Œè€Œç©ºå­—ç¬¦ä¸²å’Œ <code>/</code> ä¸æ˜¯ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p></li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šfolder = [<span class="string">"/a"</span>,<span class="string">"/a/b"</span>,<span class="string">"/c/d"</span>,<span class="string">"/c/d/e"</span>,<span class="string">"/c/f"</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="string">"/a"</span>,<span class="string">"/c/d"</span>,<span class="string">"/c/f"</span>]</span><br><span class="line">è§£é‡Šï¼š<span class="string">"/a/b/"</span> æ˜¯ <span class="string">"/a"</span> çš„å­æ–‡ä»¶å¤¹ï¼Œè€Œ <span class="string">"/c/d/e"</span> æ˜¯ <span class="string">"/c/d"</span> çš„å­æ–‡ä»¶å¤¹ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šfolder = [<span class="string">"/a"</span>,<span class="string">"/a/b/c"</span>,<span class="string">"/a/b/d"</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="string">"/a"</span>]</span><br><span class="line">è§£é‡Šï¼šæ–‡ä»¶å¤¹ <span class="string">"/a/b/c"</span> å’Œ <span class="string">"/a/b/d/"</span> éƒ½ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ <span class="string">"/a"</span> çš„å­æ–‡ä»¶å¤¹ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šfolder = [<span class="string">"/a/b/c"</span>,<span class="string">"/a/b/d"</span>,<span class="string">"/a/b/ca"</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="string">"/a/b/c"</span>,<span class="string">"/a/b/ca"</span>,<span class="string">"/a/b/d"</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ul><li>1 <= folder.length <= 4 * 10^4</li><li>2 <= folder[i].length <= 100</li><li>folder[i] åªåŒ…å«å°å†™å­—æ¯å’Œ /</li><li>folder[i] æ€»æ˜¯ä»¥å­—ç¬¦ / èµ·å§‹</li><li>æ¯ä¸ªæ–‡ä»¶å¤¹åéƒ½æ˜¯å”¯ä¸€çš„</li></ul><p><strong>è§£æ³•ä¸€</strong></p><p><code>2019.10.20</code>çš„ç«èµ›é¢˜ï¼Œå½“æ—¶æ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚ä¸€ç›´è¶…æ—¶ï¼Œå¤ªèœäº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List<string> <span class="title">removeSubfolders</span><span class="params">(String[] folder)</span> </string></span>{</span><br><span class="line">    Arrays.sort(folder);</span><br><span class="line">    List<string> res=<span class="keyword">new</span> LinkedList<>();</string></span><br><span class="line">    <span class="keyword">int</span> root=<span class="number">0</span>;</span><br><span class="line">    res.add(folder[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<folder.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (!folder[i].startsWith(folder[root]+<span class="string">"/"</span>)) {</span><br><span class="line">            res.add(folder[i]);</span><br><span class="line">            root=i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></folder.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>å½“æ—¶æˆ‘æƒ³åˆ°äº†æ’åºï¼Œä½†æ˜¯å¹¶æ²¡å¤„ç†å¥½ï¼Œæ’åºä¹‹åè¿˜æ˜¯å‚»å‚»çš„ä¸€ä¸ªä¸ªå»å¯¹æ¯”ï¼Œå…¶å®æ’åºåå°±å¾ˆæ¸…æ¥šäº†</p><p><code>folder = ["/a","/a/b","/c/d","/c/d/e","/c/f"]</code> é¢˜ç›®å…¶å®ä¹Ÿåœ¨æš—ç¤ºæˆ‘ä»¬è¦æ’åºï¼Œç»™çš„caseéƒ½æ˜¯æ’å¥½åºçš„</p><p>å½“ç„¶è¿™é‡Œå¾ˆç²¾é«“çš„ä¸€æ­¥å°±æ˜¯åœ¨å¯¹æ¯”çš„æ—¶å€™åœ¨ <code>folder[root]</code> åé¢åŠ ä¸Šä¸€ä¸ª <code>"/"</code> ï¼Œè¿™æ ·å°±ä¸ä¼šå°† <code>a/b/c</code> åˆ¤æ–­ä¸º <code>a/b/ca</code> çš„æ ¹ç›®å½•äº†~</p><h2 id="5-æœ€é•¿å›æ–‡å­ä¸²"><a href="#5-æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="5. æœ€é•¿å›æ–‡å­ä¸²"></a><a href="https://leetcode-cn.com/problems/longest-palindromic-substring/" target="_blank" rel="noopener">5. æœ€é•¿å›æ–‡å­ä¸²</a></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s çš„æœ€å¤§é•¿åº¦ä¸º 1000ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"babad"</span></span><br><span class="line">è¾“å‡º: <span class="string">"bab"</span></span><br><span class="line">æ³¨æ„: <span class="string">"aba"</span> ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="string">"cbbd"</span></span><br><span class="line">è¾“å‡º: <span class="string">"bb"</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ˜¯é¢è¯•ç»å¸¸è€ƒçš„ä¸€é¢˜ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">longestPalindrome</span><span class="params">(String s)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (s==<span class="keyword">null</span> || s.length()<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    }</span><br><span class="line">    String res=s.charAt(<span class="number">0</span>)+<span class="string">""</span>;<span class="comment">//åªæœ‰1ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<s.length();i++) {< span><br><span class="line">        String even=palindrome(s,i-<span class="number">1</span>,i); <span class="comment">//å¶æ•°é•¿åº¦å›æ–‡,ä»ä¸¤ä¸ªå­—ç¬¦ä¸­é—´å¼€å§‹æ‰©æ•£</span></span><br><span class="line">        String odd=palindrome(s,i,i); <span class="comment">//å¥‡æ•°é•¿åº¦å›æ–‡,ä»æŸä¸€ä¸ªå­—ç¬¦å¼€å§‹æ‰©æ•£</span></span><br><span class="line">        String temp=odd.length()>even.length()?odd:even;</span><br><span class="line">        <span class="keyword">if</span> (temp.length()>res.length()) {</span><br><span class="line">            res=temp;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">palindrome</span><span class="params">(String s,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(i>=<span class="number">0</span> && j<=s.length()-<span class="number">1</span> && s.charAt(i)==s.charAt(j)){</span><br><span class="line">        i--;</span><br><span class="line">        j++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> s.substring(i+<span class="number">1</span>,j);</span><br><span class="line">}</span><br></s.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>å¦‚æœé‡‡ç”¨æš´åŠ›æ³•çš„è¯å°±æ˜¯æšä¸¾æ‰€æœ‰å­ä¸²ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯å›æ–‡ä¸²ï¼Œæœ€åæ±‚ä¸ªæœ€é•¿çš„ï¼Œæ—¶é—´å¤æ‚åº¦<code>O(N^3)</code> ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å›æ–‡çš„ç‰¹å¾ï¼Œåˆ©ç”¨ä¸­å¿ƒæ‰©æ•£æ³•ï¼Œä»¥<code>str</code>çš„<strong>å„ä¸ªä½ç½®</strong>ä½œä¸ºä¸­å¿ƒï¼Œå‘ä¸¤è¾¹æ‰©æ•£ï¼Œæœ€åæ±‚å¾—æœ€å¤§å€¼ï¼Œæ³¨æ„å¾—è¿™é‡Œè¯´çš„æ˜¯<strong>å„ä¸ªä½ç½®</strong>ï¼Œè¿™ä¸ªé‡Œé¢å…¶å®å°±åŒ…å«äº†å…ƒç´ ä¹‹é—´çš„é—´éš™ï¼Œå…¶å®æ•´ä½“æ€è·¯è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä½†ç»è¿‡æˆ‘ä»¬å°å°çš„è½¬æ¢æ€è·¯ï¼Œæ—¶é—´å¤æ‚åº¦å°±é™ä½åˆ°äº†<code>O(N^2)</code>ï¼Œå½“ç„¶ï¼Œè¿™é‡Œè¿˜ä¸æ˜¯æœ€ä¼˜è§£ï¼Œæœ€ä¼˜åº”è¯¥æ˜¯<a href="https://oi-wiki.org/string/manacher/" target="_blank" rel="noopener">Manacher</a> ï¼ˆé©¬æ‹‰è½¦ï¼‰ç®—æ³•ï¼Œç­‰åé¢æœ‰æ—¶é—´æˆ‘å†æ¥ç ”ç©¶è¿™ç§ç®—æ³•</p><h2 id="56-åˆå¹¶åŒºé—´"><a href="#56-åˆå¹¶åŒºé—´" class="headerlink" title="56. åˆå¹¶åŒºé—´"></a><a href="https://leetcode-cn.com/problems/merge-intervals/" target="_blank" rel="noopener">56. åˆå¹¶åŒºé—´</a></h2><p>ç»™å‡ºä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œè¯·åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [[<span class="number">1</span>,<span class="number">3</span>],[<span class="number">2</span>,<span class="number">6</span>],[<span class="number">8</span>,<span class="number">10</span>],[<span class="number">15</span>,<span class="number">18</span>]]</span><br><span class="line">è¾“å‡º: [[<span class="number">1</span>,<span class="number">6</span>],[<span class="number">8</span>,<span class="number">10</span>],[<span class="number">15</span>,<span class="number">18</span>]]</span><br><span class="line">è§£é‡Š: åŒºé—´ [<span class="number">1</span>,<span class="number">3</span>] å’Œ [<span class="number">2</span>,<span class="number">6</span>] é‡å , å°†å®ƒä»¬åˆå¹¶ä¸º [<span class="number">1</span>,<span class="number">6</span>].</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [[<span class="number">1</span>,<span class="number">4</span>],[<span class="number">4</span>,<span class="number">5</span>]]</span><br><span class="line">è¾“å‡º: [[<span class="number">1</span>,<span class="number">5</span>]]</span><br><span class="line">è§£é‡Š: åŒºé—´ [<span class="number">1</span>,<span class="number">4</span>] å’Œ [<span class="number">4</span>,<span class="number">5</span>] å¯è¢«è§†ä¸ºé‡å åŒºé—´ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>æ€è·¯ä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œç±»ä¼¼è´ªå¿ƒå§</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[][] merge(<span class="keyword">int</span>[][] intervals) {</span><br><span class="line">    <span class="keyword">if</span> (intervals ==<span class="keyword">null</span> || intervals.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[][]{};</span><br><span class="line">    }</span><br><span class="line">    Arrays.sort(intervals,(a,b)->a[<span class="number">0</span>]-b[<span class="number">0</span>]);</span><br><span class="line">    LinkedList<<span class="keyword">int</span>[]> list=<span class="keyword">new</span> LinkedList<>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<intervals.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (intervals[i][<span class="number">0</span>]<=intervals[i-<span class="number">1</span>][<span class="number">1</span>]) {</span><br><span class="line">            <span class="keyword">if</span> (intervals[i][<span class="number">1</span>]>intervals[i-<span class="number">1</span>][<span class="number">1</span>]) {</span><br><span class="line">                intervals[i][<span class="number">0</span>]=intervals[i-<span class="number">1</span>][<span class="number">0</span>];   </span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                intervals[i][<span class="number">0</span>]=intervals[i-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">                intervals[i][<span class="number">1</span>]=intervals[i-<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">            }</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            list.add(intervals[i-<span class="number">1</span>]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    list.add(intervals[intervals.length-<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">/*  int[][] res=new int[list.size()][2];</span></span><br><span class="line"><span class="comment">        for (int i=0;i<list.size();i++) {< span></list.size();i++)></span><br><span class="line"><span class="comment">            res[i][0]=list.get(i)[0];</span></span><br><span class="line"><span class="comment">            res[i][1]=list.get(i)[1];</span></span><br><span class="line"><span class="comment">        }*/</span></span><br><span class="line">    <span class="keyword">return</span> list.toArray(<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">0</span>][<span class="number">0</span>]); <span class="comment">//é¢˜è§£å“ªé‡Œå­¦åˆ°ä¸€æ‹›</span></span><br><span class="line">}</span><br></span></intervals.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>æœ€å¤§çš„æ”¶è·å°±æ˜¯å­¦åˆ°äº†ä¸€æ‹›listè½¬arrayçš„æ–¹æ³•ğŸ˜</p><h2 id="435-æ— é‡å åŒºé—´"><a href="#435-æ— é‡å åŒºé—´" class="headerlink" title="435. æ— é‡å åŒºé—´"></a><a href="https://leetcode-cn.com/problems/non-overlapping-intervals/" target="_blank" rel="noopener">435. æ— é‡å åŒºé—´</a></h2><p>ç»™å®šä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œæ‰¾åˆ°éœ€è¦ç§»é™¤åŒºé—´çš„æœ€å°æ•°é‡ï¼Œä½¿å‰©ä½™åŒºé—´äº’ä¸é‡å ã€‚</p><p>æ³¨æ„:</p><ul><li>å¯ä»¥è®¤ä¸ºåŒºé—´çš„ç»ˆç‚¹æ€»æ˜¯å¤§äºå®ƒçš„èµ·ç‚¹ã€‚</li><li>åŒºé—´ [1,2] å’Œ [2,3] çš„è¾¹ç•Œç›¸äº’â€œæ¥è§¦â€ï¼Œä½†æ²¡æœ‰ç›¸äº’é‡å ã€‚</li></ul><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [ [<span class="number">1</span>,<span class="number">2</span>], [<span class="number">2</span>,<span class="number">3</span>], [<span class="number">3</span>,<span class="number">4</span>], [<span class="number">1</span>,<span class="number">3</span>] ]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š: ç§»é™¤ [<span class="number">1</span>,<span class="number">3</span>] åï¼Œå‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [ [<span class="number">1</span>,<span class="number">2</span>], [<span class="number">1</span>,<span class="number">2</span>], [<span class="number">1</span>,<span class="number">2</span>] ]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š: ä½ éœ€è¦ç§»é™¤ä¸¤ä¸ª [<span class="number">1</span>,<span class="number">2</span>] æ¥ä½¿å‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: [ [<span class="number">1</span>,<span class="number">2</span>], [<span class="number">2</span>,<span class="number">3</span>] ]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">è§£é‡Š: ä½ ä¸éœ€è¦ç§»é™¤ä»»ä½•åŒºé—´ï¼Œå› ä¸ºå®ƒä»¬å·²ç»æ˜¯æ— é‡å çš„äº†ã€‚</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>åŠ¨æ€è§„åˆ’ï¼Œå…¶å®å’Œæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ä¸€æ ·çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eraseOverlapIntervals</span><span class="params">(<span class="keyword">int</span>[][] intervals)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (intervals==<span class="keyword">null</span> || intervals.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    Arrays.sort(intervals,(a,b)->a[<span class="number">0</span>]-b[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">int</span>[]dp=<span class="keyword">new</span> <span class="keyword">int</span>[intervals.length];</span><br><span class="line">    <span class="keyword">int</span> max=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<intervals.length;i++) {< span><br><span class="line">        dp[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<i;j++) {< span><br><span class="line">            <span class="keyword">if</span>(intervals[i][<span class="number">0</span>]>=intervals[j][<span class="number">1</span>]){</span><br><span class="line">                dp[i]=Math.max(dp[j]+<span class="number">1</span>,dp[i]);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        max=Math.max(max,dp[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> intervals.length-max;</span><br><span class="line">}</span><br></i;j++)></span></intervals.length;i++)></span></pre></td></tr></tbody></table></figure></div><p>171msï¼Œ8%ï¼Œæ„Ÿè§‰å¿«è¦è¿‡ä¸äº†äº†ã€‚ã€‚ã€‚æœ¬æ¥æ˜¯æ˜¯å†™çš„è®°å¿†åŒ–é€’å½’çš„ï¼Œç»“æœè¿‡ä¸äº†ã€‚ã€‚ã€‚å¡åœ¨å€’æ•°ç¬¬äºŒä¸ªcaseä¸Š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">HashMap<pair,integer> cache=<span class="keyword">new</span> HashMap<>();<span class="comment">//TLE</span></pair,integer></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eraseOverlapIntervals2</span><span class="params">(<span class="keyword">int</span>[][] intervals)</span> </span>{</span><br><span class="line">    Arrays.sort(intervals,(a,b)->a[<span class="number">0</span>]-b[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> intervals.length-dfs(intervals,<span class="number">0</span>,Integer.MIN_VALUE);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//èƒŒåŒ…é—®é¢˜,è¿”å›æœ€å¤šå¯ä»¥ç•™ä¸‹çš„åŒºé—´</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span>[][] intervals,<span class="keyword">int</span> index,<span class="keyword">int</span> prev)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (index==intervals.length) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    Pair key=<span class="keyword">new</span> Pair(index,prev);</span><br><span class="line">    <span class="keyword">if</span> (cache.containsKey(key)) {</span><br><span class="line">        <span class="keyword">return</span> cache.get(key);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> res=dfs(intervals,index+<span class="number">1</span>,prev);</span><br><span class="line">    <span class="keyword">if</span> (intervals[index][<span class="number">0</span>]>=prev) {</span><br><span class="line">        res=Math.max(res,dfs(intervals,index+<span class="number">1</span>,intervals[index][<span class="number">1</span>])+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    cache.put(key,res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ</strong></p><p>è´ªå¿ƒï¼Œæ—¶é—´å¤æ‚åº¦é™ä½ä¸ºçº¿æ€§</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eraseOverlapIntervals</span><span class="params">(<span class="keyword">int</span>[][] intervals)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (intervals==<span class="keyword">null</span> || intervals.length<=<span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æŒ‰ç…§èµ·ç‚¹æ’åº,é‡å çš„æ—¶å€™é€‰æ‹©ä¿ç•™ç»“å°¾å°çš„é‚£ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">//Arrays.sort(intervals,(a,b)->a[0]-b[0]); lambdaåˆå§‹åŒ–æ•ˆç‡ä¼šä½ä¸€ç‚¹</span></span><br><span class="line">    Arrays.sort(intervals,<span class="keyword">new</span> Comparator<<span class="keyword">int</span>[]>(){</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">int</span>[] a,<span class="keyword">int</span>[] b)</span></span>{</span><br><span class="line">            <span class="keyword">return</span> a[<span class="number">0</span>]-b[<span class="number">0</span>];</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> prev=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<intervals.length;i++) {< span><br><span class="line">        <span class="keyword">if</span> (intervals[i][<span class="number">0</span>]>=intervals[prev][<span class="number">1</span>]) {</span><br><span class="line">            res++;</span><br><span class="line">            prev=i;</span><br><span class="line">        }<span class="keyword">else</span> <span class="keyword">if</span>(intervals[i][<span class="number">1</span>]<intervals[prev][<span class="number">1</intervals[prev][<span></span>]){</intervals.length;i++)></span><br><span class="line">            prev=i; <span class="comment">//é€‰æ‹©ç»“å°¾å°çš„é‚£ä¸€ä¸ª</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> intervals.length-res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æŒ‰ç…§èµ·ç‚¹æ’åºï¼Œåœ¨é‡å çš„æ—¶å€™ä¼˜å…ˆé€‰æ‹©ç»“å°¾å°çš„å“ªä¸€ä¸ªï¼Œè¿™æ ·å°±å¯èƒ½å¾—åˆ°æ›´å¤šçš„åŒºé—´ç»„åˆï¼Œå…³äºè¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§æˆ‘å°±ä¸è¯æ˜äº†</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JNIåˆæ¢</title>
      <link href="/2019/05/02/jni-chu-tan/"/>
      <url>/2019/05/02/jni-chu-tan/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="JNIç®€ä»‹"><a href="#JNIç®€ä»‹" class="headerlink" title="JNIç®€ä»‹"></a>JNIç®€ä»‹</h2><blockquote><p>JNIæ˜¯<strong>Java Native Interface</strong>çš„ç¼©å†™ï¼Œå®ƒæä¾›äº†è‹¥å¹²çš„APIå®ç°äº†Javaå’Œå…¶ä»–è¯­è¨€çš„é€šä¿¡ï¼ˆä¸»è¦æ˜¯<a href="https://baike.baidu.com/item/C/7252092" target="_blank" rel="noopener">C</a>&<a href="https://baike.baidu.com/item/C%2B%2B" target="_blank" rel="noopener">C++</a>ï¼‰ã€‚ä»Java1.1å¼€å§‹ï¼ŒJNIæ ‡å‡†æˆä¸ºjavaå¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸Javaä»£ç å’Œå…¶ä»–è¯­è¨€å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚JNIä¸€å¼€å§‹æ˜¯ä¸ºäº†æœ¬åœ°å·²ç¼–è¯‘è¯­è¨€ï¼Œå°¤å…¶æ˜¯Cå’ŒC++è€Œè®¾è®¡çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å¦¨ç¢ä½ ä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œåªè¦è°ƒç”¨çº¦å®šå—æ”¯æŒå°±å¯ä»¥äº†ã€‚ä½¿ç”¨javaä¸æœ¬åœ°å·²ç¼–è¯‘çš„ä»£ç äº¤äº’ï¼Œé€šå¸¸ä¼šä¸§å¤±å¹³å°å¯ç§»æ¤æ€§ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹è¿™æ ·åšæ˜¯å¯ä»¥æ¥å—çš„ï¼Œç”šè‡³æ˜¯å¿…é¡»çš„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸€äº›æ—§çš„åº“ï¼Œä¸ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œæˆ–è€…ä¸ºäº†æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚JNIæ ‡å‡†è‡³å°‘è¦ä¿è¯æœ¬åœ°ä»£ç èƒ½å·¥ä½œåœ¨ä»»ä½•Java è™šæ‹Ÿæœºç¯å¢ƒã€‚</p></blockquote><p>ç›¸ä¿¡å¤§å®¶åœ¨çœ‹æºç çš„æ—¶å€™éƒ½çœ‹è§è¿‡ç”¨<strong>native</strong>ä¿®é¥°çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°±æ˜¯ç”¨C/C++è¯­è¨€å®ç°çš„ï¼Œé‚£åˆ°åº•javaæ˜¯å¦‚ä½•è°ƒç”¨çš„è¿™äº›æ–¹æ³•çš„å‘¢ï¼Ÿ</p><h2 id="ä¸Šæ‰‹"><a href="#ä¸Šæ‰‹" class="headerlink" title="ä¸Šæ‰‹"></a>ä¸Šæ‰‹</h2><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><blockquote><p>æ–‡ä¸­ç¯å¢ƒä¸ºLinuxä¸‹Centos6ç‰ˆæœ¬</p></blockquote><p>âœ… é¦–å…ˆéœ€è¦æœ‰<code>JDK</code>(æˆ‘çš„æ˜¯jdk1.7)ï¼Œç¼–è¯‘java</p><p>âœ… ç„¶åéœ€è¦<code>gcc</code> ç”¨æ¥ç¼–è¯‘C/C++</p><p><strong>Javaä»£ç </strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JniTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">new</span> JniTest().hi();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="comment">//åŠ è½½ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">        System.loadLibrary(<span class="string">"jniTest"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">hi</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åœ¨é™æ€ä»£ç å—é‡Œé¢åŠ è½½äº†ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93%E6%96%87%E4%BB%B6" target="_blank" rel="noopener">åŠ¨æ€é“¾æ¥åº“</a></p><p>ç¼–å†™å®Œä¹‹åç›´æ¥<code>javac JniTest.java</code>ç¼–è¯‘ä¸€ä¸‹ï¼Œç„¶åæ‰§è¡Œ<code>javah -jni  JniTest</code>ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>JniTest.h</code>çš„å¤´æ–‡ä»¶å¦‚ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string"><jni.h></jni.h></span></span></span><br><span class="line"><span class="comment">/* Header for class JniTest */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_JniTest</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_JniTest</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> {</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     JniTest</span></span><br><span class="line"><span class="comment"> * Method:    hi</span></span><br><span class="line"><span class="comment"> * Signature: ()V</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT <span class="keyword">void</span> JNICALL Java_JniTest_hi</span><br><span class="line">  (JNIEnv *, jobject);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Cä»£ç </strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">#include<stdio.h></stdio.h></span><br><span class="line">#include "JniTest.h"</span><br><span class="line">#include <jni.h></jni.h></span><br><span class="line"><span class="comment">//è¿™ä¸€æ®µæ¥è‡ªä¸Šé¢çš„å¤´æ–‡ä»¶</span></span><br><span class="line">JNIEXPORT <span class="keyword">void</span> JNICALL Java_JniTest_hi</span><br><span class="line">  (JNIEnv *env, jobject o){</span><br><span class="line">        printf(<span class="string">"you  successfully called the c code\n"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><ul><li><code>JNIEnv*</code>ï¼šç”¨äºå¼•ç”¨JNIç¯å¢ƒï¼Œè¯¥æŒ‡é’ˆå˜é‡å¯ä»¥è®¿é—®æ‰€æœ‰JNIå‡½æ•°</li><li><code>jobject</code>ï¼šå¼•ç”¨<code>this</code> Javaå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç”¨æ¥è®¿é—®å½“å‰javaè°ƒç”¨è€…</li></ul><p>å†™å®Œä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç¼–è¯‘å®ƒ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">gcc -fPIC -D_REENTRANT  -I<span class="string">"$JAVA_HOME/include"</span>  -I<span class="string">"$JAVA_HOME/include/linux"</span> -c JniTest.c</span><br></pre></td></tr></tbody></table></figure></div><p>ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>JniTest.o</code>çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>ç„¶åæ‰§è¡Œ</p><p><code>gcc -shared JniTest.o -o libjniTest.so</code></p><p>æ³¨æ„<code>linux</code>ä¸ŠåŠ¨æ€é“¾æ¥åº“å¿…é¡»ä»¥<code>lib</code>å¼€å¤´ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯<code>libjniTest</code>åé¢çš„æ˜¯å‰é¢<code>java</code>ä»£ç ä¸­åŠ è½½çš„å“ªä¸ªåŠ¨æ€é“¾æ¥åº“åç§°<code>jniTest</code>ï¼Œæœ€åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>libjniTest.so</code>çš„åŠ¨æ€åº“</p><p><strong>æ‰§è¡Œ</strong></p><p>é¦–å…ˆç»™<code>libjniTest.so</code>èµ‹äºˆå¯æ‰§è¡Œæƒé™</p><p><code>chmod 777 libjniTest.so</code></p><p>å› ä¸ºæˆ‘è¿™é‡Œæ²¡æœ‰è®¾ç½®<code>java.library.path</code>æ‰€ä»¥éœ€è¦åœ¨è¿è¡Œçš„æ—¶å€™åŠ ä¸Šè·¯å¾„</p><p><code>java -Djava.library.path=/usr/jnitest JniTest</code></p><p><strong>ç»“æœ</strong></p><p><img alt="mark" data-src="http://static.imlgw.top///20190502/rKdNPEwUmstf.png?imageslim" src="/img/loading.gif" class="lazyload"></p><blockquote><p> ç¯‡æ–‡ç« ä¸­åªæ˜¯ç®€å•çš„è°ƒç”¨äº†Cè¯­è¨€çš„ä»£ç ï¼Œå…³äºå¦‚ä½•ä¼ é€’å‚æ•°ï¼Œå¦‚ä½•è¿”å›å€¼ï¼Œåé¢é‡åˆ°ä¹‹å†åšè®°å½•</p></blockquote></body></html>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JNI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Volatileå…³é”®å­—è¯¦è§£</title>
      <link href="/2019/04/29/volatile-guan-jian-zi/"/>
      <url>/2019/04/29/volatile-guan-jian-zi/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="JMM-amp-CPUç¼“å­˜"><a href="#JMM-amp-CPUç¼“å­˜" class="headerlink" title="JMM&CPUç¼“å­˜"></a>JMM&CPUç¼“å­˜</h2><h3 id="CPUç¼“å­˜"><a href="#CPUç¼“å­˜" class="headerlink" title="CPUç¼“å­˜"></a>CPUç¼“å­˜</h3><p>å…¶å®è¿™ä¸ªå¹¶ä¸æ˜¯æŒ‡æŸä¸€ä¸ªå…·ä½“çš„éƒ¨ä»¶ï¼Œ<code>å¯„å­˜å™¨(Register)</code>ï¼Œ<code>é«˜é€Ÿç¼“å­˜(Cache)</code>ï¼Œ<code>å†™ç¼“å†²å™¨(Store Buffer)</code>ï¼Œ<code>æ— æ•ˆåŒ–é˜Ÿåˆ—(Invalidate Queue)</code>ç­‰ç­‰éƒ½å¯ä»¥ç§°ä¸º CPUç¼“å­˜ã€‚</p><h4 id="ä¸ºä»€ä¹ˆè¦æœ‰CPUç¼“å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰CPUç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰CPUç¼“å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æœ‰CPUç¼“å­˜ï¼Ÿ</h4><p><code>ç¼“å­˜</code>é€šå¸¸æ„ä¹‰ä¸‹éƒ½æ˜¯ä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œè¿™é‡ŒåŒæ ·ä¹Ÿæ˜¯ï¼Œå› ä¸ºCPUçš„é€Ÿåº¦æ¯”<code>ä¸»å†…å­˜(RAM)</code>å¿«å¾ˆå¤šï¼Œ<code>ä¸»å†…å­˜</code>ä¼šæ‹–CPUåè…¿å½±å“æ•´ä½“çš„æ•ˆç‡ï¼Œæ‰€ä»¥ç¼“å­˜å°±å‡ºç°äº†ï¼Œç¼“å­˜çš„é€Ÿåº¦æ¯”<code>ä¸»å†…å­˜</code>å¿«å¾ˆå¤š(é€ ä»·é«˜)CPUä¼šç›´æ¥é€šè¿‡ç¼“å­˜æ¥å¯¹ä¸»å†…å­˜è¿›è¡Œè¯»å†™æ“ä½œï¼Œæ‰€ä»¥ç¼“å­˜é‡Œé¢å®é™…ä¸Šç›¸å½“äºæ˜¯<code>ä¸»å†…å­˜</code>çš„å‰¯æœ¬ã€‚</p><h4 id="ä½¿ç”¨CPUç¼“å­˜å¸¦æ¥çš„é—®é¢˜"><a href="#ä½¿ç”¨CPUç¼“å­˜å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="ä½¿ç”¨CPUç¼“å­˜å¸¦æ¥çš„é—®é¢˜"></a>ä½¿ç”¨CPUç¼“å­˜å¸¦æ¥çš„é—®é¢˜</h4><p>æ­£å¸¸æƒ…å†µä¸‹CPUæ‰§è¡Œè®¡ç®—çš„è¿‡ç¨‹å¦‚ä¸‹</p><p>1ï¸âƒ£ç¨‹åºä»¥åŠæ•°æ®è¢«åŠ è½½åˆ°ä¸»å†…å­˜</p><p>2ï¸âƒ£æŒ‡ä»¤å’Œæ•°æ®è¢«åŠ è½½åˆ°CPUç¼“å­˜</p><p>3ï¸âƒ£CPUæ‰§è¡ŒæŒ‡ä»¤ï¼ŒæŠŠç»“æœå†™åˆ°é«˜é€Ÿç¼“å­˜</p><p>4ï¸âƒ£é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å†™å›ä¸»å†…å­˜</p><p>å¦‚æœæ˜¯å•æ ¸CPUï¼Œä¸Šé¢çš„æ­¥éª¤æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†å¦‚æœæ˜¯å¤šæ ¸CPUå°±å¯èƒ½ä¼šå‡ºç°ä¸€äº›æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªæ ¸</p><p>ä¸‹é¢è¿™ç§æƒ…å†µä¹Ÿæ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„</p><p>1ï¸âƒ£æ ¸0è¯»å–äº†ä¸€ä¸ªå­—èŠ‚ï¼Œæ ¹æ®å±€éƒ¨æ€§åŸç†ï¼Œå®ƒç›¸é‚»çš„å­—èŠ‚åŒæ ·è¢«è¢«è¯»å…¥æ ¸0çš„ç¼“å­˜</p><p>2ï¸âƒ£æ ¸1åšäº†ä¸Šé¢åŒæ ·çš„å·¥ä½œï¼Œè¿™æ ·æ ¸0ä¸æ ¸1çš„ç¼“å­˜æ‹¥æœ‰åŒæ ·çš„æ•°æ®</p><p>3ï¸âƒ£æ ¸0ä¿®æ”¹äº†é‚£ä¸ªå­—èŠ‚ï¼Œè¢«ä¿®æ”¹åï¼Œé‚£ä¸ªå­—èŠ‚è¢«å†™å›æ ¸0çš„ç¼“å­˜ï¼Œä½†æ˜¯è¯¥ä¿¡æ¯å¹¶æ²¡æœ‰å†™å›ä¸»å­˜</p><p>4ï¸âƒ£æ ¸1è®¿é—®è¯¥å­—èŠ‚ï¼Œç”±äºæ ¸0å¹¶æœªå°†æ•°æ®å†™å›ä¸»å­˜ï¼Œæ•°æ®ä¸åŒæ­¥</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>ğŸ”¶LOCK# æ€»çº¿é”ï¼Œæ•ˆç‡å¾ˆä½ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªCPUå¯¹å†…å­˜æ“ä½œï¼Œå…¶ä»–çš„CPUåªèƒ½å¹²ç­‰ç€</p><p>ğŸ”¶ç¼“å­˜ä¸€è‡´æ€§<code>åè®®</code>ï¼Œç¼“å­˜ä¸€è‡´æ€§åè®®æœ‰å¤šç§ï¼Œ<code>MESI</code>åè®®æ˜¯å½“å‰æœ€ä¸»æµçš„ç¼“å­˜ä¸€è‡´æ€§åè®®</p><p><img alt="MESIçŠ¶æ€" data-src="http://static.imlgw.top///20190411/GYdTPdVBGCQB.png?imageslim" src="/img/loading.gif" class="lazyload">)æ—¥å¸¸å¤„ç†çš„å¤§å¤šæ•°è®¡ç®—æœºè®¾å¤‡éƒ½å±äº<code>å—…æ¢(snooping)</code>åè®®ï¼ŒCPUç¼“å­˜ä¸ä»…ä»…åœ¨åšå†…å­˜ä¼ è¾“çš„æ—¶å€™æ‰ä¸æ€»çº¿æ‰“äº¤é“ï¼Œè€Œæ˜¯ä¸åœåœ¨å—…æ¢æ€»çº¿ä¸Šå‘ç”Ÿçš„æ•°æ®äº¤æ¢ï¼Œè·Ÿè¸ªå…¶ä»–ç¼“å­˜åœ¨åšä»€ä¹ˆã€‚æ‰€ä»¥å½“ä¸€ä¸ªç¼“å­˜ä»£è¡¨å®ƒæ‰€å±çš„å¤„ç†å™¨å»<code>è¯»å†™å†…å­˜</code>æ—¶ï¼Œå…¶å®ƒå¤„ç†å™¨éƒ½ä¼šå¾—åˆ°é€šçŸ¥ï¼Œå®ƒä»¬ä»¥æ­¤æ¥ä½¿è‡ªå·±çš„ç¼“å­˜ä¿æŒåŒæ­¥ã€‚åªè¦æŸä¸ªå¤„ç†å™¨ä¸€<code>å†™å†…å­˜</code>ï¼Œå…¶å®ƒå¤„ç†å™¨é©¬ä¸ŠçŸ¥é“è¿™å—å†…å­˜åœ¨å®ƒä»¬çš„ç¼“å­˜æ®µä¸­<code>å·²å¤±æ•ˆ(Invaid)</code>ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æœ‰å¤„ç†å™¨æƒ³<code>è¯»å†…å­˜</code>(ä¼šè¢«ç«‹å³å¯Ÿè§‰åˆ°ï¼Œå› ä¸ºä¸€ç›´åœ¨å—…æ¢æ€»çº¿)ï¼Œé‚£ä¹ˆå·²ä¿®æ”¹çš„ç¼“å­˜è¡Œ(Cache line)å°±ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å­˜ä¸­ï¼Œç„¶åè®¾ç½®ä¸º<code>Share</code>çŠ¶æ€ï¼Œè¿™æ ·ä¸€æ¥è¯»å–åˆ°çš„æ•°æ®å°±ä¸æ˜¯è„æ•°æ®äº†ã€‚</p><p>å†æ”¾ä¸€å¼  å¤„ç†å™¨&ç¼“å­˜&ä¸»å†…å­˜äº¤äº’çš„å›¾ï¼ˆæ¥è‡ªç»„æˆåŸç†ä¹¦ä¸Šçš„å›¾ï¼‰</p><p><img alt="CacheåŸºæœ¬ç»“æ„" data-src="http://static.imlgw.top///20190415/lJzPTl3yQWBn.jpg?imageslim" src="/img/loading.gif" class="lazyload"></p><p>æ—¢ç„¶æœ‰äº†MESIåè®®ï¼Œæ˜¯ä¸æ˜¯å°±ä¸éœ€è¦volatileçš„å¯è§æ€§è¯­ä¹‰äº†ï¼Ÿå½“ç„¶ä¸æ˜¯</p><ul><li><strong>å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶æ¶æ„éƒ½æä¾›äº†ç›¸åŒçš„ä¸€è‡´æ€§ä¿è¯ï¼ŒJVMéœ€è¦volatileç»Ÿä¸€è¯­ä¹‰</strong>ï¼ˆå°±ç®—æ˜¯MESIï¼Œä¹Ÿåªè§£å†³CPUç¼“å­˜å±‚é¢çš„é—®é¢˜ï¼Œæ²¡æœ‰æ¶‰åŠå…¶ä»–å±‚é¢ï¼‰ã€‚</li><li>å¯è§æ€§é—®é¢˜ä¸ä»…ä»…å±€é™äºCPUç¼“å­˜å†…ï¼ŒJVMè‡ªå·±ç»´æŠ¤çš„<code>å†…å­˜æ¨¡å‹</code>ä¸­ä¹Ÿæœ‰å¯è§æ€§é—®é¢˜ã€‚ä½¿ç”¨volatileåšæ ‡è®°ï¼Œå¯ä»¥è§£å†³JVMå±‚é¢çš„å¯è§æ€§é—®é¢˜ã€‚</li><li><a href="https://www.zhihu.com/question/277395220" target="_blank" rel="noopener">è¿™ä¸ªå›ç­”åº”è¯¥å¾ˆå¥½çš„è§£é‡Šäº†</a> å¤§æ¦‚å°±æ˜¯ç¼“å­˜ä¸€è‡´æ€§åè®®å¹¶ä¸èƒ½ä¿è¯å®æ—¶æ€§ï¼Œè€Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¿è¯ä¸¥æ ¼çš„å®æ—¶æ€§</li></ul><h3 id="Javaå†…å­˜æ¨¡å‹-JMM"><a href="#Javaå†…å­˜æ¨¡å‹-JMM" class="headerlink" title="Javaå†…å­˜æ¨¡å‹(JMM)"></a>Javaå†…å­˜æ¨¡å‹(JMM)</h3><blockquote><p>ä¸ºäº†å±è”½å„ä¸ªæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„å·®å¼‚ï¼Œä½¿å¾— Java ç¨‹åºåœ¨æ‰€æœ‰å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœï¼Œæ‰€ä»¥ Java è™šæ‹Ÿæœºå®šä¹‰äº†ä¸€ç§ Java å†…å­˜æ¨¡å‹ã€‚</p></blockquote><p>Javaå†…å­˜æ¨¡å‹(å³Java Memory Modelï¼Œç®€ç§°JMM)æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ç»„è§„åˆ™æˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„è§„èŒƒå®šä¹‰äº†ç¨‹åºä¸­å„ä¸ªå˜é‡ï¼ˆåŒ…æ‹¬å®ä¾‹å­—æ®µï¼Œé™æ€å­—æ®µå’Œæ„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ ï¼‰çš„è®¿é—®æ–¹å¼ã€‚ï¼ˆè¿™é‡Œçš„å˜é‡ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡å’Œæ–¹æ³•å‚æ•°ï¼Œå› ä¸ºé‚£æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸ä¼šäº§ç”Ÿç«äº‰ï¼‰</p><p>Java è™šæ‹Ÿæœºè§„å®šæ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œçº¿ç¨‹ï¼ˆWork Memory æœ‰äº›åœ°æ–¹ç§°ä¸ºçº¿ç¨‹æ ˆï¼‰ã€‚</p><p>çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œæ˜¯åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œé¦–å…ˆè¦å°†å˜é‡ä»ä¸»å†…å­˜æ‹·è´çš„è‡ªå·±çš„å·¥ä½œå†…å­˜ç©ºé—´ï¼Œç„¶åå¯¹å˜é‡è¿›è¡Œæ“ä½œï¼Œæ“ä½œå®Œæˆåå†å°†å˜é‡å†™å›ä¸»å†…å­˜ï¼Œè€Œä¸èƒ½ç›´æ¥å¯¹ä¸»å†…å­˜çš„å˜é‡è¿›è¡Œè¯»å–èµ‹å€¼ã€‚</p><p>ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œéœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥è¿›è¡Œä¼ é€’ã€‚</p><p><img alt="JMM" data-src="http://static.imlgw.top///20190411/PjL8vV724vXx.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ï¼ˆæ¥è‡ª <a href="https://blog.csdn.net/javazejian/article/details/72772461" target="_blank" rel="noopener">zejian</a>ï¼‰</p><p>å·¥ä½œå†…å­˜å®é™…ä¸Šå°±æ˜¯å¯¹ä¸Šé¢<strong>CPUç¼“å­˜</strong>çš„æŠ½è±¡ã€‚</p><h4 id="å†…å­˜é—´äº¤äº’"><a href="#å†…å­˜é—´äº¤äº’" class="headerlink" title="å†…å­˜é—´äº¤äº’"></a>å†…å­˜é—´äº¤äº’</h4><p>Java å†…å­˜æ¨¡å‹å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’æ“ä½œã€‚<br>readï¼šæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ä¸­<br>loadï¼šåœ¨ read ä¹‹åæ‰§è¡Œï¼ŒæŠŠ read å¾—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­<br>useï¼šæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“<br>assignï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡<br>storeï¼šæŠŠå·¥ä½œå†…å­˜çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­<br>writeï¼šåœ¨ store ä¹‹åæ‰§è¡Œï¼ŒæŠŠ store å¾—åˆ°çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­<br>lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡<br>unlockï¼šå¯¹åº”lock</p><p><strong>JMM</strong>è¿˜å®šä¹‰äº†ä¸€äº›å…³äº<code>happens-before</code>å…³ç³»çš„è§„åˆ™å¦‚ä¸‹</p><ul><li><p>ä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œç¼–å†™åœ¨å‰é¢çš„å‘ç”Ÿåœ¨ç¼–å†™åœ¨åé¢çš„ã€‚</p></li><li><p>unlock å¿…é¡»å‘ç”Ÿåœ¨lockä¹‹å</p></li><li><p>volatile ä¿®é¥°çš„ å†™æ“ä½œå…ˆå‘ç”Ÿåœ¨è¯»ä¹‹å‰</p></li><li><p>ä¼ é€’è§„åˆ™ ï¼ŒA å…ˆäºB Bå…ˆäºC Aè‚¯å®šå…ˆäºC</p></li><li><p>çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼Œstartè‚¯å®šç°åœºå‘ç”Ÿä¸run</p></li><li><p>çº¿ç¨‹ä¸­æ–­æ–¹æ³•ï¼Œinterrupt å¿…é¡»å‘ç”Ÿåœ¨æ•è·ä¹‹å‰</p></li><li><p>å¯¹è±¡çš„åˆå§‹åŒ–å¿…é¡»å‘ç”Ÿåœ¨finalizeå‰</p></li><li><p>çº¿ç¨‹ç»ˆç»“è§„åˆ™ï¼Œæ‰€æœ‰æ“ä½œéƒ½å‘ç”Ÿåœ¨çº¿ç¨‹æ­»äº¡å‰</p></li></ul><p><a href="https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/happens-before.html" target="_blank" rel="noopener">å‚è€ƒ</a></p><h2 id="Volatileå¹²äº†ä»€ä¹ˆï¼Ÿ"><a href="#Volatileå¹²äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Volatileå¹²äº†ä»€ä¹ˆï¼Ÿ"></a>Volatileå¹²äº†ä»€ä¹ˆï¼Ÿ</h2><h3 id="ä¿è¯å¯è§æ€§"><a href="#ä¿è¯å¯è§æ€§" class="headerlink" title="ä¿è¯å¯è§æ€§"></a>ä¿è¯å¯è§æ€§</h3><p>è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„Demoã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹1</span></span><br><span class="line"><span class="keyword">boolean</span> stop = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">while</span>(!stop){</span><br><span class="line">    <span class="comment">//doSomething();</span></span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="comment">//çº¿ç¨‹2</span></span><br><span class="line">stop = <span class="keyword">true</span>;</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®åœ¨ä¸Šä¸€ç¯‡ <a href="http://imlgw.top/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/">Javaå¤šçº¿ç¨‹åŸºç¡€</a> é‡Œé¢ â€œä¼˜é›…çš„ç»“æŸçº¿ç¨‹â€ é‡Œé¢æœ‰ç±»ä¼¼çš„ä»£ç </p><p><img alt="mark" data-src="http://static.imlgw.top///20190428/LQuwmhuMiwxp.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å½“æ—¶æ²¡æœ‰è¯´æ˜ä¸ºå•¥è¦åŠ <code>Volatile</code>ï¼Œå…¶å®è¿™é‡Œä¸Šé¢çš„ä»£ç å¦‚æœä¸ç»™çŠ¶æ€é‡åŠ ä¸Š <code>volatile</code>  å¹¶ä¸”ç”¨<code>server</code>æ¨¡å¼è¿è¡Œæœ‰å¯èƒ½å°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œå³ä½¿åœ¨ä¸»çº¿ç¨‹é‡Œé¢å°†<code>isCancel</code>ä¿®æ”¹ä¸º<code>true</code>ä»ç„¶æ— æ³•ç»“æŸï¼Œçº¿ç¨‹é™·å…¥äº†æ­»å¾ªç¯ï¼Œæ°¸è¿œæ— æ³•åœæ­¢ï¼ï¼!ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿï¼Ÿï¼Ÿ</p><p><img alt="mark" data-src="http://static.imlgw.top///20190410/nCcFbqyGiqIz.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ğŸ”¸ åœ¨<code>server</code>æ¨¡å¼ä¸‹JITå¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ç”¨serveræ¨¡å¼è¿è¡Œçš„åŸå› ï¼Œ<strong>Client VMçš„ç¼–è¯‘å™¨æ²¡æœ‰åƒServer VMä¸€æ ·æ‰§è¡Œè®¸å¤šå¤æ‚çš„ä¼˜åŒ–ç®—æ³•</strong>ï¼‰ã€‚å®ƒä¼šå°†ä»£ç ä¼˜åŒ–ä¸ºç±»ä¼¼ä¸‹é¢è¿™æ ·çš„æ•ˆæœ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!stop){</span><br><span class="line"> <span class="keyword">while</span> (stop){</span><br><span class="line"><span class="comment">//do something....</span></span><br><span class="line"> }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><code>JIT</code>è®¤ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…é‡å¤çš„è¯»å–çŠ¶æ€å˜é‡<code>stop</code>å°±å°†ä»£ç è¿›è¡Œäº† <a href="https://zh.wikipedia.org/wiki/%E5%BE%AA%E7%8E%AF%E4%B8%8D%E5%8F%98%E4%BB%A3%E7%A0%81%E5%A4%96%E6%8F%90" target="_blank" rel="noopener">å¾ªç¯ä¸å˜è¡¨è¾¾å¼å¤–æ</a>ï¼ˆwikipediaï¼‰ï¼Œè€Œè¿™æ°æ°å¯¼è‡´äº†æ­»å¾ªç¯</p><p>ğŸ”¸å¦ä¸€æ–¹é¢ï¼Œä¹Ÿå’Œè®¡ç®—æœºçš„å‚¨å­˜ç³»ç»Ÿæœ‰å…³ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢<code>CPUç¼“å­˜</code>çš„é—®é¢˜ä¸­æåˆ°çš„ï¼Œè¿™é‡Œ <code>stop</code>å°±æ˜¯å…±äº«å˜é‡ï¼Œå½“çº¿ç¨‹â‘ å’Œâ‘¡è¿è¡Œçš„æ—¶å€™å…ˆå°†ä¸»å†…å­˜çš„<code>stop</code>æ‹·è´äº†ä¸€ä»½åˆ°<code>å·¥ä½œå†…å­˜</code>ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†<code>stop</code>çš„å€¼ä½†æ˜¯å…¶ä»–çš„çº¿ç¨‹æ— æ³•æ„ŸçŸ¥åˆ°è¿™ä¸ªå˜åŒ–å°±å¯èƒ½ä¼šé™·å…¥æ­»å¾ªç¯ã€‚</p><p>ğŸ“¢ <code>volatile</code>åœ¨è¿™é‡Œèµ·åˆ°çš„ä½œç”¨å°±æ˜¯</p><p>â‘  é˜»æ­¢<code>JIT</code>çš„å¼‚å¸¸ä¼˜åŒ–</p><p>â‘¡ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†<code>volatile</code>ä¿®é¥°çš„å…±äº«å˜é‡åä¼š<strong>ç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜</strong>å½“ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º_å†²åˆ·å¤„ç†å™¨ç¼“å­˜_ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨è¯»<code>voaltile</code>ä¿®é¥°çš„å˜é‡å°±ä¼šä½¿ç›¸åº”çš„å¤„ç†å™¨<strong>å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¿›è¡ŒåŒæ­¥</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸º_åˆ·æ–°å¤„ç†å™¨ç¼“å­˜_ï¼Œä»è€Œä¿è¯äº†å¯è§æ€§ï¼Œé€šä¿—çš„è®²å°±æ˜¯<code>è¯»å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¯»ï¼Œå†™å¿…é¡»åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­</code>ã€‚</p><h3 id="ä¿è¯æœ‰åºæ€§"><a href="#ä¿è¯æœ‰åºæ€§" class="headerlink" title="ä¿è¯æœ‰åºæ€§"></a>ä¿è¯æœ‰åºæ€§</h3><p><strong>é‡æ’åº</strong></p><p>æåˆ°æœ‰åºæ€§å°±ä¸å¾—ä¸è¯´é‡æ’åºï¼Œå…ˆæ¥çœ‹ä¸€ä¸ª<code>Demo</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isReady=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">int</span> data=getFromXxx(); <span class="comment">//â‘ </span></span><br><span class="line">    isReady=<span class="keyword">true</span> <span class="comment">//â‘¡</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(isReady){</span><br><span class="line">        <span class="comment">//doSth</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸€çœ‹ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œwriterçº¿ç¨‹å®Œæˆåå¼€å§‹readï¼Œé—®é¢˜å°±å‡ºæ¥è¿™é‡Œï¼Œ<strong>æœ‰å¯èƒ½dataæ•°æ®è¿˜æ²¡è·å–åˆ°ï¼ŒisReadyå°±å·²ç»æ˜¯trueäº†</strong>ä¹Ÿå°±æ˜¯è¯´â‘¡å’Œâ‘ çš„æ‰§è¡Œäº¤æ¢äº†é¡ºåºï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<strong>é‡æ’åº</strong>ï¼Œè¿™æ ·çš„é‡æ’åºå°†ä¼šå¯¼è‡´ä¸å¯é¢„çŸ¥çš„é”™è¯¯ï¼Œè€Œå¯¼è‡´è¿™ç§ç°è±¡çš„æ¥æºå¾ˆå¤šï¼Œæ¯”å¦‚ç¼–è¯‘å™¨(JIT)ï¼Œå¤„ç†å™¨å’Œå­˜å‚¨å­ç³»ç»Ÿ(Cache)ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦é‡æ’åºï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†æå‡æ€§èƒ½ï¼Œå½“ç„¶é‡æ’åºå¯¹å•çº¿ç¨‹æ¥è®²æ˜¯æ²¡æœ‰å½±å“çš„(æœ‰å½±å“é‚£è¿˜å¾—äº†ğŸ˜‚)</p><p><strong>å…¶å®ä¸åªæ˜¯ä¸Šé¢é‚£ç§æ¯”è¾ƒæ˜¾è€Œæ˜“è§çš„é‡æ’åºï¼Œè¿˜æœ‰ä¸‹é¢è¿™ç§æ¯”è¾ƒéšå«çš„</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonObjectPlus</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  SingletonObjectPlus singletonObjectPlus =<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonObjectPlus <span class="title">getSingletonObject3</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(singletonObjectPlus==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">synchronized</span>(SingletonObject<span class="class">.<span class="keyword">class</span>)</span>{</span><br><span class="line">            <span class="keyword">if</span>(singletonObjectPlus==<span class="keyword">null</span>){</span><br><span class="line">                singletonObjectPlus= <span class="keyword">new</span> SingletonObjectPlus();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">     <span class="keyword">return</span> singletonObjectPlus;</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç†Ÿæ‚‰çš„æœ‹å‹å¯èƒ½çœ‹å‡ºæ¥äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªDCLå•ä¾‹ï¼Œé‚£å®ƒæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå®ƒä¹Ÿä¼šè¢«é‡æ’åºä¹ˆï¼Ÿé‚£ä¹ˆä¼šåœ¨å“ªé‡Œé‡æ’åºå‘¢ï¼Ÿ</p><p>ä¸Šè¿°ä»£ç ç¡®å®æœ‰é—®é¢˜ï¼Œé—®é¢˜åœ¨<strong>new SingletonObjectPlus();</strong>é‡Œé¢ï¼Œå®é™…ä¸Šnewè¿™ä¸ªæ“ä½œå¯ä»¥åˆ’åˆ†ä¸ºå¦‚ä¸‹å¥½å‡ æ­¥</p><ol><li>åˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´ <code>objRef=allocate(SingleObjectPlus.class);</code></li><li>åˆå§‹åŒ–å¼•ç”¨çš„å¯¹è±¡ <code>invokeConstructor(objRef);</code></li><li>è®¾ç½®<code>singletonObjectPlus</code>æŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€<code>singletonObjectPlus=objRef</code></li></ol><p>è€Œè¿™äº›æ­¥éª¤æœ‰å¯èƒ½å°±ä¼šè¢«é‡æ’åºï¼Œæ¯”å¦‚å°†â‘¢æ’åˆ°â‘¡ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆå°±ä¼šè¢«è¿”å›(å·²ç»åˆ†é…ç©ºé—´äº†ï¼Œå°±ä¸ä¸ºnulläº†)ï¼Œè¿™æ ·åœ¨<code>æœ€å¤–å±‚if</code>åˆ¤æ–­çš„æ—¶å€™å°±å¯èƒ½ä¼šç›´æ¥è¿”å›ä¸€ä¸ªåˆå§‹åŒ–æœªå®Œæˆçš„å¯¹è±¡</p><blockquote><p>å‘ç”Ÿè¿™æ ·é‡æ’åºçš„æ¦‚ç‡å¾ˆä½ï¼Œå¹¶ä¸æ˜¯å¿…ç„¶å‡ºç°çš„ï¼Œé‡æ’åºä¹Ÿä¸æ˜¯éšæ„çš„é¡ºåºè°ƒæ•´ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å»é‡æ’åºï¼Œä¿è¯ä¸ä¼šå¯¹å•çº¿ç¨‹ç¨‹åºè¿è¡Œç»“æœé€ æˆå½±å“ï¼Œæ˜¾è€Œæ˜“è§ï¼Œå¦‚æœä¸¤æ¡è¯­å¥ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œè‚¯å®šæ˜¯ä¸ä¼šé‡æ’åºçš„ï¼Œå…·ä½“å°±æ˜¯ä¸¤æ¡è¯­å¥è®¿é—®åŒä¸€ä¸ªå˜é‡åœ°å€ï¼Œè‡³å°‘æœ‰ä¸€æ¡ä¸ºå†™æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸¤æ¡æŒ‡ä»¤å°±å­˜åœ¨ä¾èµ–å…³ç³»å°±ä¸ä¼šè¢«é‡æ’åºæ¯”å¦‚ x=1;x=2;è¿™æ ·çš„ å°±ä¸ä¼šè¢«é‡æ’åºã€‚</p></blockquote><p>å…¶å®ä¸Šé¢çš„é—®é¢˜éƒ½å¾ˆå¥½è§£å†³ï¼Œåªè¦åœ¨<strong>isReady</strong>å’Œ<strong>singletonObjectPlus</strong>ä¸ŠåŠ ä¸Š<code>volatile</code>å°±okäº†ï¼Œåœ¨è¿™é‡Œvolatileä¼šç¦æ­¢æŒ‡ä»¤çš„é‡æ’åºï¼ˆåº•å±‚é€šè¿‡è°ƒç”¨å¤„ç†å™¨æä¾›çš„å†…å­˜å±éšœï¼‰</p><h3 id="ä¿éšœLong-Doubleå˜é‡å†™çš„åŸå­æ€§"><a href="#ä¿éšœLong-Doubleå˜é‡å†™çš„åŸå­æ€§" class="headerlink" title="ä¿éšœLong/Doubleå˜é‡å†™çš„åŸå­æ€§"></a>ä¿éšœLong/Doubleå˜é‡å†™çš„åŸå­æ€§</h3><p>è¿™ä¸€ç‚¹å…¶å®å¾ˆå®¹æ˜“è¢«é—å¿˜ï¼Œå®é™…ä¸ŠJavaå¯¹æ‰€æœ‰é™¤äº†Longå’ŒDoubleçš„å˜é‡çš„<strong>è¯»å†™</strong>æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒ…æ‹¬åŸºç¡€ç±»å‹(byteï¼Œbooleanï¼Œshortï¼Œfloatï¼Œå’Œint)å’Œå¼•ç”¨ç±»å‹ã€‚å› ä¸ºDoubleå’ŒLongç±»å‹çš„å˜é‡ä¼šå ç”¨64ä½ï¼Œå¦‚æœåœ¨<code>32ä½æœºå™¨</code>ä¸ŠJVMå¯¹è¿™ç§å˜é‡çš„è¯»å†™å¯èƒ½å°±æ˜¯ä¼šè¢«åˆ†è§£ä¸ºä¸¤ä¸ªæ“ä½œè€Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å°±ä¼šå‡ºç°é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ï¼ŒçŸ¥é“æœ‰è¿™ä¹ˆä¸ªäº‹å°±è¡Œäº†ã€‚åœ¨åŠ ä¸Š<code>Volatile</code>ä¹‹åå°±å¯ä»¥ä¿è¯è¯¥æ“ä½œçš„åŸå­æ€§äº†ã€‚</p><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><blockquote><p>volatileåœ¨ä¿éšœå¯è§æ€§çš„æ—¶å€™ä»…ä»…åªèƒ½ä¿éšœèƒ½å¤Ÿè¯»å–åˆ°è¯¥å…±äº«å˜é‡çš„ç›¸å¯¹æ–°å€¼ï¼Œå¯¹äºå¼•ç”¨ç±»å‹å˜é‡å’Œæ•°ç»„ç±»å‹çš„å˜é‡ï¼Œvolatileèƒ½ä¿è¯çš„ä¹Ÿä»…ä»…æ˜¯è¯¥å˜é‡æœ¬èº«çš„å¯è§æ€§ï¼Œè€Œå¯¹äºæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¼•ç”¨ç±»å‹ä¸­çš„å­—æ®µï¼ˆå®ä¾‹å˜é‡ï¼Œé™æ€å˜é‡ï¼‰åˆ™æ— æ³•ä¿è¯å…¶å¯è§æ€§ï¼Œå¯¹äºè¿™äº›å˜é‡å¯è§æ€§çš„ä¿éšœå¯ä»¥åˆ©ç”¨JUCå·¥å…·åŒ…ä¸­çš„<code>AtomicåŸå­ç±»</code>ã€‚</p></blockquote><h2 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h2><p>å…ˆç®€å•äº†è§£ä¸¤ä¸ªæŒ‡ä»¤ï¼š</p><ul><li>Storeï¼šå°†å¤„ç†å™¨ç¼“å­˜çš„æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ã€‚</li><li>Loadï¼šå°†å†…å­˜å­˜å‚¨çš„æ•°æ®æ‹·è´åˆ°å¤„ç†å™¨çš„ç¼“å­˜ä¸­ã€‚</li></ul><table><thead><tr><th>å±éšœç±»å‹</th><th>æŒ‡ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>LoadLoad Barriers</td><td>Load1;<code>LoadLoad</code>;Load2</td><td>è¯¥å±éšœç¡®ä¿Load1æ•°æ®çš„è£…è½½å…ˆäºLoad2åŠå…¶åæ‰€æœ‰è£…è½½æŒ‡ä»¤çš„çš„æ“ä½œ</td></tr><tr><td>StoreStore Barriers</td><td>Store1;<code>StoreStore</code>;Store2</td><td>è¯¥å±éšœç¡®ä¿Store1ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜(ä½¿å…¶å¯¹å…¶ä»–å¤„ç†å™¨å¯è§)çš„æ“ä½œå…ˆäºStore2åŠå…¶åæ‰€æœ‰å­˜å‚¨æŒ‡ä»¤çš„æ“ä½œ</td></tr><tr><td>LoadStore Barriers</td><td>Load1;<code>LoadStore</code>;Store2</td><td>ç¡®ä¿Load1çš„æ•°æ®è£…è½½å…ˆäºStore2åŠå…¶åæ‰€æœ‰çš„å­˜å‚¨æŒ‡ä»¤åˆ·æ–°æ•°æ®åˆ°å†…å­˜çš„æ“ä½œ</td></tr><tr><td>StoreLoad Barriers</td><td>Store1;<code>StoreLoad</code>;Load2</td><td>è¯¥å±éšœç¡®ä¿Store1ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜çš„æ“ä½œå…ˆäºLoad2åŠå…¶åæ‰€æœ‰è£…è½½æŒ‡ä»¤çš„æ“ä½œã€‚å®ƒä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤(å­˜å‚¨æŒ‡ä»¤å’Œè®¿é—®æŒ‡ä»¤)å®Œæˆä¹‹å,æ‰æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤</td></tr></tbody></table><p>StoreLoad BarriersåŒæ—¶å…·å¤‡å…¶ä»–ä¸‰ä¸ªå±éšœçš„æ•ˆæœï¼Œå› æ­¤ä¹Ÿç§°ä¹‹ä¸º<code>å…¨èƒ½å±éšœ</code>ï¼ˆmfenceï¼‰ï¼Œæ˜¯ç›®å‰å¤§å¤šæ•°å¤„ç†å™¨æ‰€æ”¯æŒçš„ï¼›ä½†æ˜¯ç›¸å¯¹å…¶ä»–å±éšœï¼Œè¯¥å±éšœçš„å¼€é”€ç›¸å¯¹æ˜‚è´µ</p><ul><li><p>æŒ‰ç…§å¯è§æ€§åˆ’åˆ†ï¼Œå†…å­˜å±éšœå¯ä»¥åˆ†ä¸º<strong>åŠ è½½å±éšœ</strong>(Load Barrier)ï¼Œå’Œ<strong>å­˜å‚¨å±éšœ</strong>(Store Barrier)</p></li><li><p>æŒ‰ç…§æœ‰åºæ€§åˆ’åˆ†å¯åˆ†ä¸º<strong>è·å–å±éšœ</strong>(Acquire Barrier)å’Œ<strong>é‡Šæ”¾å±éšœ</strong>(Release Barrier)</p></li></ul><p>å…·ä½“é‚£ä¸ªå……å½“åŠ è½½å±éšœï¼Œé‚£ä¸ªå……å½“å­˜å‚¨å±éšœï¼Œæˆ‘å¹¶ä¸æƒ³è®¨è®ºï¼Œå„ç§åšå®¢å„ç§èµ„æ–™å„æœ‰å„çš„è¯´æ³•ï¼Œå…¶å®å…³äºç©¶ç«Ÿåº•å±‚æ˜¯å¦‚ä½•å®ç°ï¼Œå¦‚ä½•æ’å…¥ï¼Œæ’å…¥çš„å“ªä¸€ç§è¿™äº›ç»†èŠ‚æˆ‘ä»¬ä¸ç”¨å»å…³å¿ƒï¼Œä¸åŒçš„CPUä¸åŒçš„æ¶æ„å®ç°çš„æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œå¤ªè¿‡æ·±å…¥ä¹Ÿæ²¡æœ‰å¤šå¤§çš„æ„ä¹‰ï¼Œå¾ˆå¤šåšå®¢ä»‹ç»çš„ä¹Ÿ<code>å®Œå…¨ä¸åŒ</code>ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“å¤§æ¦‚çš„åŸç†å°±è¡Œäº†ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šå¯ä»¥å‚è€ƒä¸‹åˆ—æ–‡ç« </p><p><a href="http://www.0xffffff.org/2017/02/21/40-atomic-variable-mutex-and-memory-barrier/" target="_blank" rel="noopener">èŠèŠåŸå­å˜é‡ã€é”ã€å†…å­˜å±éšœé‚£ç‚¹äº‹</a></p><p><a href="https://monkeysayhi.github.io/2017/12/28/%E4%B8%80%E6%96%87%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C/" target="_blank" rel="noopener">ä¸€æ–‡è§£å†³å†…å­˜å±éšœ</a></p><p><a href="https://www.jianshu.com/p/506c1e38a922" target="_blank" rel="noopener">é¢è¯•å¿…é—®çš„volatileï¼Œä½ äº†è§£å¤šå°‘ï¼Ÿ</a></p><p><a href="https://www.infoq.cn/article/java-memory-model-4/?utm_source=infoq&%253Butm_medium=related_content_link&%253Butm_campaign=relatedContent_articles_clk" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Java å†…å­˜æ¨¡å‹ï¼ˆå››ï¼‰â€”â€”volatile</a></p><h3 id="é”ä¸å†…å­˜å±éšœ"><a href="#é”ä¸å†…å­˜å±éšœ" class="headerlink" title="é”ä¸å†…å­˜å±éšœ"></a>é”ä¸å†…å­˜å±éšœ</h3><p>ç”¨<strong>OneNote</strong>ç”»äº†å‡ å¼ å›¾</p><p><img alt="mark" data-src="http://static.imlgw.top///20190428/EUPpWHTPnlH8.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å®é™…ä¸Šé”å°±æ˜¯é€šè¿‡<strong>å†…å­˜å±éšœ</strong>æ¥ä¿è¯äº†æœ‰åºæ€§å’Œå¯è§æ€§ï¼Œé€šè¿‡<strong>äº’æ–¥æ’å®ƒ</strong>æ¥ä¿è¯äº†åŸå­æ€§</p><h3 id="Volatileå’Œå†…å­˜å±éšœ"><a href="#Volatileå’Œå†…å­˜å±éšœ" class="headerlink" title="Volatileå’Œå†…å­˜å±éšœ"></a>Volatileå’Œå†…å­˜å±éšœ</h3><p><strong>Volatileå†™æ“ä½œå’Œå†…å­˜å±éšœ</strong></p><p><img alt="volatileå˜é‡çš„å†™æ“ä½œ" data-src="http://static.imlgw.top///20190428/PImPUeLGqau6.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ğŸ”” å†™çº¿ç¨‹å¯¹äº<code>volatileå˜é‡çš„å†™æ“ä½œ</code>ä¼šäº§ç”Ÿç±»ä¼¼äº<code>é”é‡Šæ”¾</code>çš„æ•ˆæœã€‚åœ¨å†™å®Œæˆåä¼š<code>å†²åˆ·å¤„ç†å™¨ç¼“å­˜</code>å°†ç»“æœç«‹å³åˆ·æ–°åˆ°ä¸»å­˜ä¸­è®©å…¶ä»–å¤„ç†å™¨å¯¹åº”çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œè®©å…¶ä»–å¤„ç†å™¨å¯åŒæ­¥è¯¥æ•°æ®</p><blockquote><p>volatileå˜é‡åœ¨åŸå­æ€§æ–¹é¢ä»…ä»…ä¿è¯å¯¹è¢«ä¿®é¥°çš„å˜é‡çš„è¯»å†™<code>æœ¬èº«</code>çš„åŸå­æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œä¸èƒ½æ¶‰åŠä»»ä½•å…±äº«å˜é‡(åŒ…æ‹¬volatileå˜é‡æœ¬èº«)çš„è®¿é—®ï¼Œæ¯”å¦‚ volatile1=volatile2+1ï¼Œvolatile++ è¿™æ ·çš„æ“ä½œæ— æ³•ä¿è¯å®ƒçš„åŸå­æ€§ï¼Œå¦å¤–ï¼Œvoaltileå¯ä»¥ä¿è¯<code>long</code>å’Œ<code>double</code>å˜é‡åœ¨<code>32ä½</code>æœºä¸Šå†™çš„åŸå­æ€§</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬å†å›å¤´çœ‹çœ‹å‰é¢çš„å•ä¾‹çš„ä¾‹å­</p><p>â‘ åˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´ objRef=allocate(SingleObjectPlus.class);</p><p>â‘¡åˆå§‹åŒ–å¼•ç”¨çš„å¯¹è±¡ invokeConstructor(objRef);</p><p>â‘¢è®¾ç½®singletonObjectPlusæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ singletonObjectPlus=objRef</p><p>è™½ç„¶è¿™é‡Œvolatileå­ä¿è¯äº†å­æ“ä½œâ‘¢çš„åŸå­æ€§ ä½†æ˜¯â‘ â‘¡æ“ä½œåªæ¶‰åŠåˆ°äº†å±€éƒ¨å˜é‡æ²¡æœ‰æ¶‰åŠåˆ°å…±äº«å˜é‡ï¼Œç”±äºå†…å­˜å±éšœçš„ä½œç”¨â‘ â‘¡æ“ä½œä¸å¯èƒ½é‡æ’åºåˆ°â‘¢ä¹‹åï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯åœ¨å¾—åˆ°è¿”å›ä¹‹å‰å¯¹è±¡ä¸€å®šå·²ç»åˆå§‹åŒ–å®Œæ¯•äº†ï¼Œä¸ä¼šå‡ºç°æ²¡åˆå§‹åŒ–å®Œæ¯•å°±è¿”å›çš„æƒ…å†µ</p><p><strong>Volatileè¯»æ“ä½œå’Œå†…å­˜å±éšœ</strong></p><p><img alt="volatileå˜é‡çš„è¯»æ“ä½œ" data-src="http://static.imlgw.top///20190428/tJcC98zgp532.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ğŸ”” è¯»çº¿ç¨‹å¯¹äº<code>volatileå˜é‡çš„è¯»æ“ä½œ</code>ä¼šäº§ç”Ÿç±»ä¼¼äº<code>è·å¾—é”</code>çš„æ•ˆæœã€‚è¯»volatileå˜é‡å‰ä¼šå…ˆ<code>åˆ·æ–°å¤„ç†å™¨ç¼“å­˜</code>ä»ä¸»å­˜æˆ–å…¶ä»–å¤„ç†å™¨ç¼“å­˜ä¸­<code>åŒæ­¥</code>è¯¥æ•°æ®</p><blockquote><p>volatileåªèƒ½ä¿è¯è¯»çº¿ç¨‹è¯»åˆ°å…±äº«å˜é‡çš„ç›¸å¯¹æ–°å€¼ï¼Œå¯¹äºå¼•ç”¨ç±»å‹å’Œæ•°ç»„ç±»å‹çš„å¹¶ä¸èƒ½ä¿è¯å®ä¾‹çš„å­—æ®µæˆ–æ•°ç»„çš„å…ƒç´ çš„ç›¸å¯¹æ–°å€¼ï¼Œåªæ˜¯ä¿éšœäº†<code>å¼•ç”¨åœ°å€</code>çš„ç›¸å¯¹æ–°å€¼(<code>ç›¸å¯¹æ–°å€¼</code>è¡¨ç¤ºè¯»çš„è¿‡ç¨‹ä¸­å…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½æ›´æ”¹äº†è¿™ä¸ªå€¼ï¼Œå¯¹åº”çš„è¿˜æœ‰<code>æœ€æ–°å€¼</code>ï¼Œè¯»çš„è¿‡ç¨‹ä¸­å†™çº¿ç¨‹æ— æ³•æ›´æ”¹)</p></blockquote><h3 id="Volatileå˜é‡çš„å¼€é”€-amp-åœºæ™¯"><a href="#Volatileå˜é‡çš„å¼€é”€-amp-åœºæ™¯" class="headerlink" title="Volatileå˜é‡çš„å¼€é”€&åœºæ™¯"></a>Volatileå˜é‡çš„å¼€é”€&åœºæ™¯</h3><p><strong>å¼€é”€</strong></p><p>volatileå˜é‡çš„è¯»å†™éƒ½ä¸ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥å¼€é”€æ¯”é”è¦å°ï¼Œä»ä¸Šé¢çš„ä»‹ç»ä¸­å¯ä»¥çœ‹å‡º å†™ä¸€ä¸ªvoaltileä¼šä½¿è¯¥æ“ä½œå’Œè¯¥æ“ä½œå‰çš„æ‰€æœ‰å†™æ“ä½œå¯¹åé¢çš„çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œæ‰€ä»¥å®ƒçš„æˆæœ¬ä¼šæ¯”æ™®é€šå˜é‡å¤§ä¸€äº›ä½†æ˜¯æ¯”é”å°ä¸€ç‚¹ï¼Œè¯»ä¸€ä¸ªvolatileå˜é‡ä¹Ÿä¼šæ¯”é”å°ï¼Œä½†æ˜¯ä¼šæ¯”æ™®é€šå˜é‡å¤§å› ä¸ºå˜é‡éƒ½ä¼šä»å†…å­˜æˆ–å…¶ä»–å¤„ç†å™¨é«˜é€Ÿç¼“å­˜ä¸­å»æ‹¿æ— æ³•ç›´æ¥ä»å¯„å­˜å™¨ä¸­å»æ‹¿ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå¿«äº†ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong></p><p>ğŸ”¶ ä½¿ç”¨volatileå˜é‡ä½œä¸ºçŠ¶æ€æ ‡å¿—ä½ï¼Œåº”ç”¨ç¨‹åºçš„æŸä¸ªçŠ¶æ€ç”±ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè¯»å–è¯¥çŠ¶æ€ä½œä¸ºåé¢æ“ä½œçš„ä¾æ®ï¼Œæ­¤æ—¶ç”¨volatileä½œä¸ºåŒæ­¥æœºåˆ¶å¥½å¤„å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŠæ—¶â€é€šçŸ¥â€å¦ä¸€ä¸ªçº¿ç¨‹æŸç§äº‹ä»¶(ä¾‹å¦‚æ‰çº¿é‡è¿)è€Œé¿å…ä½¿ç”¨é”é€ æˆè¾ƒå¤§å¼€é”€</p><p>ğŸ”¶ä½¿ç”¨volatileä¿éšœå¯è§æ€§ï¼Œä¸€ä¸ªçº¿ç¨‹æ›´æ–°äº†å…±äº«å˜é‡å…¶ä»–çº¿ç¨‹æ— éœ€åŠ é”ä¹Ÿå¯ä»¥çœ‹åˆ°è¯¥æ›´æ–°</p><p>ğŸ”¶volatile beanæ¨¡å¼ï¼ˆä¸‹é¢æ˜¯æˆ‘çš„ä¸ªäººç†è§£å¯ä»¥ç›´æ¥è·³è¿‡ï¼‰</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String firstName,String lastName,<span class="keyword">int</span> age)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    }</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>{ <span class="keyword">return</span> firstName; }</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>{ <span class="keyword">return</span> lastName; }</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>{ <span class="keyword">return</span> age; }</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String firstName)</span> </span>{ </span><br><span class="line">    <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>{ </span><br><span class="line">    <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>{ </span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…³äºè¿™ä¸ªåœºæ™¯çš„æˆ‘ç†è§£çš„å°±æ˜¯ä¼šä¿è¯ç±»ä¼¼volatile Person  preson=new Person(xx,xx,xx,xx);è¿™æ ·çš„æ“ä½œå…·æœ‰å¯è§æ€§æˆ–è€…è¯´å®Œæ•´æ€§ï¼Œä¸ä¼šåˆå§‹åŒ–ä¸€åŠå°±è¿”å›å¯¹è±¡è¦ä¹ˆä¸ºnullè¦ä¹ˆå°±åˆå§‹åŒ–å®Œæ¯•ï¼Œç±»ä¼¼äºä¸Šé¢çš„æåˆ°çš„dclå•ä¾‹çš„ä¾‹å­ã€‚</p><p>ğŸ”¶ç®€æ˜“è¯»å†™é”</p><p>å…è®¸è¯»çº¿ç¨‹è¯»å–çš„æ—¶å€™å†™çº¿ç¨‹è¿›è¡Œæ›´æ–°ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯å®ç°ä¸€ä¸ªè®¡æ•°å™¨å¦‚ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>{ <span class="keyword">return</span> value; }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> value++;</span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æƒ³äº†è§£æ›´å¤šå»çœ‹çœ‹IBMè¿™ç¯‡æ–‡ç« <a href="https://www.ibm.com/developerworks/cn/java/j-jtp06197.html" target="_blank" rel="noopener">Java ç†è®ºä¸å®è·µ:æ­£ç¡®ä½¿ç”¨ Volatile å˜é‡</a></p><h2 id="ä¸€ä¸ªå°é—®é¢˜"><a href="#ä¸€ä¸ªå°é—®é¢˜" class="headerlink" title="ä¸€ä¸ªå°é—®é¢˜"></a>ä¸€ä¸ªå°é—®é¢˜</h2><p><img alt="å¯è§æ€§çš„ä¾‹å­" data-src="http://static.imlgw.top///20190428/4CYfervOyHH3.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä¸Šé¢å¯è§æ€§çš„é—®é¢˜ï¼Œå›¾ä¸­çš„ä»£ç å¦‚æœå¾ªç¯é‡Œé¢åŠ ä¸Šå›¾ä¸­æ¡†å†…ç±»ä¼¼çš„ä»£ç ï¼Œä¼šå‘ç°å³ä½¿å…±äº«å˜é‡ä¸Šé¢ä¸åŠ <strong>volatile</strong>ç¨‹åºä¾ç„¶å¯ä»¥æ­£å¸¸é€€å‡ºï¼Œä¸Šé¢å‡ºç°çš„æ­»å¾ªç¯å¹¶æ²¡æœ‰å‡ºç° (æˆ‘çš„JDKç‰ˆæœ¬æ˜¯1.8ï¼Œä¸åŒçš„ç‰ˆæœ¬æƒ…å†µå¯èƒ½ä¸ä¸€æ ·)ï¼Œé‚£æ˜¯ä¸æ˜¯è¯´è¿™äº›æ“ä½œä¹Ÿè¾¾åˆ°äº†ä¿è¯å¯è§æ€§çš„ä½œç”¨å‘¢ï¼Ÿå…¶å®ä»”ç»†åˆ†æè¿™å‡ è¡Œä»£ç ï¼Œåé¢ä¸‰ç§éƒ½ä¼šåˆ·æ–°æˆ–å†²åˆ·å¤„ç†å™¨ç¼“å­˜(printé‡Œé¢ä¹Ÿæ˜¯åŠ é”äº†çš„)ï¼Œæˆ‘ä¸€å¼€å§‹è§‰å¾—å¯èƒ½æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´çš„ï¼Œä½†æ˜¯æŒ‰é“ç†åº”è¯¥æ˜¯åªä¼šä¿è¯åŒæ­¥å—å†…éƒ¨çš„å˜é‡çš„å¯è§æ€§ï¼Œä½†æ˜¯sleepå¹¶æ²¡æœ‰åŠ é”ï¼Œæ˜¯ä¸ªæœ¬åœ°æ–¹æ³•ä¸ºå•¥è¿˜æ˜¯ä¼šå¯¼è‡´è¿™æ ·çš„ç»“æœå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä¹Ÿä¸æƒ³æ·±ç©¶äº†ï¼Œæˆ‘æ„Ÿè§‰ä¹Ÿæ²¡å•¥å¿…è¦äº†ï¼Œå…·ä½“çš„åœºæ™¯ä¸‹è¯¥åŠ <strong>volatile</strong>è¿˜æ˜¯è€è€å®å®åŠ <strong>volatile</strong>ï¼Œå¦‚æœç»§ç»­æ¢ç©¶ä¸‹å¯ä»¥çœ‹ä¸‹<a href="http://www.importnew.com/19434.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç«  </a>ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><p>ã€ŠJavaå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜æŒ‡å—ï¼šæ ¸å¿ƒç¯‡ã€‹</p></li><li><p><a href="https://blog.csdn.net/javazejian/article/details/72772461" target="_blank" rel="noopener">javazejian</a></p></li><li><p>â€¦</p></li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CASä¸åŸå­å˜é‡</title>
      <link href="/2019/04/22/cas-yu-yuan-zi-bian-liang/"/>
      <url>/2019/04/22/cas-yu-yuan-zi-bian-liang/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h2><p><em>è¿™ä¸ª<strong>CAS</strong>å¯ä¸æ˜¯å•ç‚¹ç™»é™†çš„é‚£ä¸ªCASğŸ˜„!!!</em></p><blockquote><p>CASï¼ˆCompare-and-Swapï¼‰ï¼Œæ˜¯å¯¹ä¸€ç§å¤„ç†å™¨æŒ‡ä»¤çš„ç§°å‘¼ï¼Œå¾ˆå¤šJavaå¤šçº¿ç¨‹ç›¸å…³çš„ç±»åº“çš„æœ€ç»ˆå®ç°éƒ½ä¼šå€ŸåŠ©CAS</p></blockquote><p>â€‹    ä»æ‰€å‘¨çŸ¥ï¼Œç±»ä¼¼<code>i++</code>è‡ªå¢è¿™æ ·çš„æ“ä½œå¹¶ä¸æ˜¯åŸå­çš„ï¼Œæ˜¯ä¸€ä¸ª<code>read-modify-write</code>çš„æ“ä½œ ï¼Œå¦‚æœè¦ä¿è¯è¿™ç§æ“ä½œçš„åŸå­æ€§æŒ‰ç…§ä¹‹å‰çš„åšæ³•å¯ä»¥ä½¿ç”¨<code>synchronized</code>å†…éƒ¨é”æ¥è§£å†³ï¼Œä½†æ˜¯è¿™æ ·ä¼¼ä¹æœ‰ç‚¹å¤ªå°é¢˜å¤§åšäº†ï¼Œé”ç¡®å®å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å‰é¢çš„æ–‡ç« ä¹Ÿæåˆ°è¿‡ï¼Œé”æ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½çš„ï¼Œå¹¶ä¸æ˜¯æœ€å¥½çš„åšæ³•ï¼Œæ¯”è¾ƒå¥½çš„åšæ³•å°±æ˜¯<strong>CAS</strong>ï¼Œå®ƒèƒ½å¤Ÿå°†è¿™äº›æ“ä½œè½¬æ¢ä¸ºåŸå­æ“ä½œã€‚</p><p>â€‹    Compare and Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ç§<code>if-then-act</code>çš„æ“ä½œï¼Œè€Œè¿™ä¸ªæ“ä½œçš„åŸå­æ€§ç”±<code>å¤„ç†å™¨</code>ä¿è¯(ç¡¬ä»¶é”)ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³è¦å°†å˜é‡Vçš„å€¼ç”±Aå˜ä¸ºBï¼Œå€ŸåŠ©CASå°±ä¼šäº§ç”Ÿç±»ä¼¼ä¸‹é¢ä»£ç çš„ä½œç”¨</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">comapreAndSet</span><span class="params">(Variable V,Object A,Objext B)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(V.get()==A){ <span class="comment">//åˆ¤æ–­æ˜¯å¦å’Œå½“å‰Vçš„å€¼ç›¸åŒï¼ˆæ˜¯å¦è¢«ä¿®æ”¹ï¼‰</span></span><br><span class="line">        V.set(B);   <span class="comment">//æ²¡è¢«ä¿®æ”¹å°±æ›´æ–°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">//è¢«ä¿®æ”¹è¿‡å°±ç›´æ¥return</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·ä¸€æ¥å°±æ˜¯å…ˆä¸‹æ‰‹ä¸ºå¼ºäº†ï¼Œå½“ä½ æœ€å…ˆä¿®æ”¹äº†Vçš„å€¼ï¼Œåé¢çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç›´æ¥å¤±è´¥ï¼Œæ‰€ä»¥å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§å¿«é€Ÿå¤±è´¥ç­–ç•¥ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å°è¯•å†æ¬¡è¯·æ±‚ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p><h2 id="åŸå­å˜é‡ç±»"><a href="#åŸå­å˜é‡ç±»" class="headerlink" title="åŸå­å˜é‡ç±»"></a>åŸå­å˜é‡ç±»</h2><p>_åŸå­å˜é‡ç±»_æ˜¯åŸºäºCASå®ç°çš„ä¸€ç»„ä¿è¯å…±äº«å˜é‡<code>read-modify-write</code>æ“ä½œ(ä¾‹å¦‚è‡ªå¢)åŸå­æ€§çš„å·¥å…·ç±»</p><table><thead><tr><th>åˆ†ç»„</th><th>ç±»</th></tr></thead><tbody><tr><td>åŸºç¡€æ•°æ®ç±»å‹</td><td>AtomicIntegerï¼ŒAtomicLongï¼ŒAtomicBoolean</td></tr><tr><td>æ•°ç»„ç±»</td><td>AtomicIntegerArrayï¼ŒAtomicLongArrayï¼ŒAtomicReferenceArray</td></tr><tr><td>å­—æ®µæ›´æ–°å™¨</td><td>AtomicIntegerFieldUpdaterï¼ŒAtomicLongFieldUpdaterï¼ŒAtomicReferenceFieldUpdater</td></tr><tr><td>å¼•ç”¨å‹</td><td>AtomicReferenceï¼ŒAtomicStampedReferenceï¼ŒAtomicMarkableReference</td></tr></tbody></table><p>å…³äºæ€ä¹ˆä½¿ç”¨å°±ä¸å¤šä»‹ç»ï¼ŒAPIä¸Šéƒ½å†™çš„æ˜æ˜ç™½ç™½ï¼Œè¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œæ•°ç»„ç±»å•çº¯çš„GET/SETå¹¶ä¸æ˜¯åŸå­æ“ä½œã€‚</p><h3 id="åˆ©ç”¨CASå†™ä¸€ä¸ªé”"><a href="#åˆ©ç”¨CASå†™ä¸€ä¸ªé”" class="headerlink" title="åˆ©ç”¨CASå†™ä¸€ä¸ªé”"></a>åˆ©ç”¨CASå†™ä¸€ä¸ªé”</h3><p><a href="http://imlgw.top/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/">å‰é¢çš„æ–‡ç« </a>  åˆ©ç”¨å†…éƒ¨é”å®ç°è¿‡ä¸€ä¸ª<strong>BooleanLock</strong>ï¼Œè¿™é‡Œåˆ©ç”¨CASå†å®ç°ä¸€ä¸ªç®€æ˜“çš„é”</p><p><strong>getLockException</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetLockException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GetLockException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GetLockException</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>CASLock</strong> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CASLock</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicInteger value = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Thread lockedThread;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trylock</span><span class="params">()</span> <span class="keyword">throws</span> GetLockException </span>{</span><br><span class="line">        <span class="keyword">boolean</span> success = value.compareAndSet(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (!success) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GetLockException(<span class="string">"è·å¾—é”å¤±è´¥"</span>);</span><br><span class="line">        }</span><br><span class="line">        lockedThread = Thread.currentThread();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == value.get()) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (lockedThread == Thread.currentThread()) {</span><br><span class="line">            <span class="comment">//è§£é“ƒè¿˜é¡»ç³»é“ƒäºº</span></span><br><span class="line">            <span class="keyword">boolean</span> success = value.compareAndSet(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" é‡Šæ”¾äº†é”"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®æŒºç®€å•çš„ï¼Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯é‡Šæ”¾é”çš„æ—¶å€™åˆ«å¿˜äº†åˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹åŠ çš„é”ï¼Œè§£é“ƒè¿˜é¡»ç³»é“ƒäººğŸ˜‚</p><h3 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h3><blockquote><p>ä»æ‰€å‘¨çŸ¥ï¼ŒCASæˆç«‹çš„æ¡ä»¶å°±æ˜¯å…±äº«å˜é‡å½“å‰å€¼å’Œå½“å‰çº¿ç¨‹æ‰€æä¾›çš„æ—§å€¼ç›¸åŒï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯¹äºä¸€ä¸ªå…±äº«å˜é‡<strong>V</strong>ï¼Œå¦‚æœå½“å‰çº¿ç¨‹çœ‹åˆ°å®ƒçš„æ—¶å€™å®ƒçš„å€¼æ˜¯Aï¼Œå½“å®ƒæƒ³æ‰§è¡ŒCASä¿®æ”¹è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†<strong>V</strong>çš„å€¼ä»Aâ€“>Bâ€“>Aï¼Œé‚£ä¹ˆè¿™æ—¶å½“å‰çº¿ç¨‹å†æ¥æ‰§è¡ŒCASçš„æ—¶å€™ï¼Œæ˜¯å¦å¯ä»¥è®¤ä¸ºå˜é‡<strong>V</strong>æ²¡æœ‰è¢«ä¿®æ”¹è¿‡å‘¢ï¼Ÿè¿™é‡Œæ‰§è¡Œè‚¯å®šæ˜¯ä¼šæˆåŠŸçš„ï¼Œä½†æ˜¯è¿™æ ·ç»“æœæ˜¯å¦å¯ä»¥æ¥å—å‘¢ ?</p></blockquote><h4 id="æ— æ³•æ¥å—çš„ä¾‹å­"><a href="#æ— æ³•æ¥å—çš„ä¾‹å­" class="headerlink" title="æ— æ³•æ¥å—çš„ä¾‹å­"></a>æ— æ³•æ¥å—çš„ä¾‹å­</h4><p><img alt="mark" data-src="http://static.imlgw.top///20190423/vakfPgUQChGb.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä¸Šå›¾ä¸ºç”¨<strong>å•é“¾è¡¨</strong>å®ç°çš„æ ˆç»“æ„ï¼Œè‹¥T2å…ˆæŠ¢åˆ°äº†æ‰§è¡Œæƒï¼Œå°†Aï¼ŒBå¼¹å‡ºæ ˆï¼Œç„¶åä¾æ¬¡<code>push</code>äº†Dï¼ŒCï¼ŒAï¼Œç„¶åT1æ‰§è¡Œï¼Œåˆ©ç”¨CASï¼Œhead.compareAndSet(Aï¼ŒB)ï¼Œæ‰§è¡ŒæˆåŠŸï¼Œæ ˆé¡¶å˜ä¸ºBï¼Œç„¶è€ŒBå°±æ˜¯ä¸ªå­¤å„¿èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸€æ¥Cï¼ŒDèŠ‚ç‚¹å°±è¢«è«åå…¶å¦™è¢«ä¸¢æ‰äº†è¿™æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„</p><h4 id="å¦‚ä½•è§£å†³ABAé—®é¢˜"><a href="#å¦‚ä½•è§£å†³ABAé—®é¢˜" class="headerlink" title="å¦‚ä½•è§£å†³ABAé—®é¢˜"></a>å¦‚ä½•è§£å†³ABAé—®é¢˜</h4><p>å…¶å®ABAé—®é¢˜å¹¶éå®Œå…¨æ— æ³•æ¥å—ï¼Œè¦è€ƒè™‘å…·ä½“çš„åœºæ™¯ï¼Œå½“ç„¶Javaä¸­ä¹Ÿæä¾›äº†è§£å†³çš„æ–¹æ¡ˆ:</p><p><code>AtomicStampedReference</code> è¿™ä¸ªç±»çœ‹åå­—å°±çŸ¥é“æ˜¯å¸¦äº†æˆ³çš„ï¼Œå¸¦äº†ä¸€ä¸ªç±»ä¼¼ç‰ˆæœ¬å·çš„ä¸œè¥¿ï¼Œç›´æ¥ä¸Šæºç å§ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util.concurrent.atomic;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An {<span class="doctag">@code</span> AtomicStampedReference} maintains an object reference</span></span><br><span class="line"><span class="comment"> * along with an integer "stamp", that can be updated atomically.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <p>Implementation note: This implementation maintains stamped<br><span class="line"><span class="comment"> * references by creating internal objects representing "boxed"</span></span><br><span class="line"><span class="comment"> * [reference, integer] pairs.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea çœŸæ­£çš„å¤§å¸ˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <v> The type of object referred to by this reference</v></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicStampedReference</span><<span class="title">V</span>> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span><<span class="title">T</span>> </span>{</span><br><span class="line">        <span class="keyword">final</span> T reference;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> stamp;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Pair</span><span class="params">(T reference, <span class="keyword">int</span> stamp)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.reference = reference;</span><br><span class="line">            <span class="keyword">this</span>.stamp = stamp;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">static</span> <t> <span class="function">Pair<t> <span class="title">of</span><span class="params">(T reference, <span class="keyword">int</span> stamp)</span> </t></span>{</t></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Pair<t>(reference, stamp);</t></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Pair<v> pair;</v></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AtomicStampedReference</span><span class="params">(V initialRef, <span class="keyword">int</span> initialStamp)</span> </span>{</span><br><span class="line">        pair = Pair.of(initialRef, initialStamp);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the current value of the reference.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the current value of the reference</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getReference</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> pair.reference;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStamp</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> pair.stamp;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(<span class="keyword">int</span>[] stampHolder)</span> </span>{</span><br><span class="line">        Pair<v> pair = <span class="keyword">this</span>.pair;</v></span><br><span class="line">        stampHolder[<span class="number">0</span>] = pair.stamp;</span><br><span class="line">        <span class="keyword">return</span> pair.reference;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">weakCompareAndSet</span><span class="params">(V   expectedReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     V   newReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="keyword">int</span> expectedStamp,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="keyword">int</span> newStamp)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> compareAndSet(expectedReference, newReference,</span><br><span class="line">                             expectedStamp, newStamp);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Atomically sets the value of both the reference and stamp</span></span><br><span class="line"><span class="comment">     * to the given update values if the</span></span><br><span class="line"><span class="comment">     * current reference is {<span class="doctag">@code</span> ==} to the expected reference</span></span><br><span class="line"><span class="comment">     * and the current stamp is equal to the expected stamp.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expectedReference the expected value of the reference</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newReference the new value for the reference</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expectedStamp the expected value of the stamp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newStamp the new value for the stamp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if successful</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(V   expectedReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 V   newReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="keyword">int</span> expectedStamp,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="keyword">int</span> newStamp)</span> </span>{</span><br><span class="line">        Pair<v> current = pair;</v></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            expectedReference == current.reference && <span class="comment">//æœŸæœ›å€¼å’Œå½“å‰å€¼ç›¸ç­‰</span></span><br><span class="line">            expectedStamp == current.stamp &&<span class="comment">//æœŸæœ›çš„æˆ³å’Œå½“å‰çš„æˆ³ä¸€è‡´</span></span><br><span class="line">            ((newReference == current.reference && <span class="comment">//æ–°çš„å€¼æ˜¯ä¸æ˜¯å’Œå½“å‰çš„å€¼ä¸€æ ·</span></span><br><span class="line">              newStamp == current.stamp) ||<span class="comment">//æ–°çš„æˆ³æ˜¯ä¸æ˜¯å’Œå½“å‰çš„æˆ³ä¸€æ ·</span></span><br><span class="line">             casPair(current, Pair.of(newReference, newStamp))); <span class="comment">//å¦‚æœä¸ä¸€æ ·å°±åˆ©ç”¨CASè®¾ç½®æ–°å€¼</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(V newReference, <span class="keyword">int</span> newStamp)</span> </span>{</span><br><span class="line">        Pair<v> current = pair;</v></span><br><span class="line">        <span class="keyword">if</span> (newReference != current.reference || newStamp != current.stamp)</span><br><span class="line">            <span class="keyword">this</span>.pair = Pair.of(newReference, newStamp);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">attemptStamp</span><span class="params">(V expectedReference, <span class="keyword">int</span> newStamp)</span> </span>{</span><br><span class="line">        Pair<v> current = pair;</v></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            expectedReference == current.reference &&</span><br><span class="line">            (newStamp == current.stamp ||</span><br><span class="line">             casPair(current, Pair.of(expectedReference, newStamp)));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unsafe mechanics åº•å±‚è°ƒç”¨unsafeçš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> pairOffset =</span><br><span class="line">        objectFieldOffset(UNSAFE, <span class="string">"pair"</span>, AtomicStampedReference<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//casè®¾ç½®æ–°å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">casPair</span><span class="params">(Pair<v> cmp, Pair<v> val)</v></v></span> </span>{</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, pairOffset, cmp, val);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">objectFieldOffset</span><span class="params">(sun.misc.Unsafe UNSAFE,</span></span></span><br><span class="line"><span class="function"><span class="params">                                  String field, Class<!--?--> klazz)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.objectFieldOffset(klazz.getDeclaredField(field));</span><br><span class="line">        } <span class="keyword">catch</span> (NoSuchFieldException e) {</span><br><span class="line">            <span class="comment">// Convert Exception to corresponding Error</span></span><br><span class="line">            NoSuchFieldError error = <span class="keyword">new</span> NoSuchFieldError(field);</span><br><span class="line">            error.initCause(e);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></p></span></span></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œåˆ æ‰äº†éƒ¨åˆ†æ³¨é‡Šï¼Œ å¯ä»¥çœ‹åˆ°é‡Œé¢å°è£…äº†ä¸€ä¸ª<code>Pair</code>é‡Œé¢æœ‰å¯¹è±¡çš„å¼•ç”¨å’Œä¸€ä¸ªæˆ³ï¼Œåœ¨è¿›è¡ŒCASçš„æ—¶å€™ä¼šåˆ¤æ–­<code>æœŸæœ›çš„å¼•ç”¨</code>ï¼ˆä¼ è¿›æ¥çš„å¼•ç”¨ï¼‰å’Œ<code>å½“å‰å®é™…çš„å¼•ç”¨</code>æ˜¯ä¸æ˜¯ä¸€è‡´ï¼Œ<code>æœŸæœ›çš„æˆ³</code>ï¼ˆä¼ è¿›æ¥çš„æˆ³ï¼‰å’Œ<code>å½“å‰å®é™…çš„æˆ³</code>æ˜¯ä¸æ˜¯ä¸€è‡´çš„ï¼Œä¸ä¸€è‡´å°±ä¼šç›´æ¥<code>fail</code>ï¼Œå…³é”®çš„CASä»£ç ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(V   expectedReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 V   newReference,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="keyword">int</span> expectedStamp,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="keyword">int</span> newStamp)</span> </span>{</span><br><span class="line">        Pair<v> current = pair;</v></span><br><span class="line">        <span class="keyword">return</span>  </span><br><span class="line">            expectedReference == current.reference && <span class="comment">//æœŸæœ›å€¼å’Œå½“å‰å€¼ç›¸ç­‰</span></span><br><span class="line">            expectedStamp == current.stamp &&<span class="comment">//æœŸæœ›çš„æˆ³å’Œå½“å‰çš„æˆ³ä¸€è‡´</span></span><br><span class="line">            ((newReference == current.reference && <span class="comment">//æ–°çš„å€¼æ˜¯ä¸æ˜¯å’Œå½“å‰çš„å€¼ä¸€æ ·</span></span><br><span class="line">              newStamp == current.stamp) ||<span class="comment">//æ–°çš„æˆ³æ˜¯ä¸æ˜¯å’Œå½“å‰çš„æˆ³ä¸€æ ·</span></span><br><span class="line">             casPair(current, Pair.of(newReference, newStamp))); <span class="comment">//å¦‚æœä¸ä¸€æ ·å°±åˆ©ç”¨CASè®¾ç½®æ–°å€¼</span></span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•AtomicStampedReference</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicRefStampedTest</span> </span>{</span><br><span class="line">   <span class="keyword">static</span> AtomicStampedReference<integer> reference=<span class="keyword">new</span> AtomicStampedReference<>(<span class="number">100</span>,<span class="number">0</span>);</integer></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒABAæ“ä½œ</span></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                System.out.println(<span class="string">"t1 "</span>+reference.compareAndSet(<span class="number">100</span>, <span class="number">101</span>, reference.getStamp(), reference.getStamp()+<span class="number">1</span>));</span><br><span class="line">                System.out.println(reference.getStamp()+<span class="string">","</span>+reference.getReference());</span><br><span class="line">                System.out.println(<span class="string">"t1 "</span>+ reference.compareAndSet(<span class="number">101</span>, <span class="number">100</span>,reference.getStamp() , reference.getStamp()+<span class="number">1</span>));</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }).start();</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒä¸ªçº¿ç¨‹ç­‰å¾…ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œ</span></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">int</span> stamp = reference.getStamp();</span><br><span class="line">                <span class="comment">//å‡è®¾æ‰§è¡Œåˆ°è¿™é‡Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</span></span><br><span class="line">                System.out.println(<span class="string">"Before sleep:stamp="</span>+stamp);</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">                System.out.println(<span class="string">"After sleep:stamp="</span>+reference.getStamp());</span><br><span class="line">                <span class="keyword">boolean</span> b = reference.compareAndSet(<span class="number">100</span>, <span class="number">101</span>, stamp, stamp + <span class="number">1</span>);</span><br><span class="line">                System.out.println(b);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Before sleep:stamp=0</span></span><br><span class="line"><span class="comment">t1 true</span></span><br><span class="line"><span class="comment">1,101</span></span><br><span class="line"><span class="comment">t1 true</span></span><br><span class="line"><span class="comment">After sleep:stamp=2</span></span><br><span class="line"><span class="comment">false</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></tbody></table></figure></div><p>ç»“æœè‚¯å®šæ˜¯t2æ‰§è¡Œå¤±è´¥äº†ï¼Œæ¯•ç«Ÿæˆ³ä¸ä¸€æ ·äº†ï¼Œå°±ç®—å¼•ç”¨ä¸€æ ·ä¹Ÿæ²¡ç”¨ã€‚</p><h4 id="å°æ’æ›²-Integerç¼“å­˜"><a href="#å°æ’æ›²-Integerç¼“å­˜" class="headerlink" title="å°æ’æ›²(Integerç¼“å­˜)"></a>å°æ’æ›²(Integerç¼“å­˜)</h4><p>è¿™é‡Œä¸€å¼€å§‹å‘ç”Ÿäº†ä¸€ä¸ªå°æ’æ›²ï¼Œé¦–å…ˆè¿™é‡Œæ˜¯çš„å¼•ç”¨ç±»å‹æ˜¯ <code>Integer</code>ç±»å‹çš„ï¼Œç„¶åæˆ‘åœ¨è¿›è¡ŒCASçš„æ—¶å€™ä»100â€”>200 ,ç„¶ååˆä»200â€“>100ï¼Œå¯èƒ½ç»†å¿ƒçš„æœ‹å‹å·²ç»çŸ¥é“å•¥é—®é¢˜äº†ï¼Œåé¢çš„ä»200â€“>100ä¼šå¤±è´¥ï¼Œä¸ºå•¥ï¼Ÿè¿™ä¸ª200å’Œå‰é¢çš„200ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¼•ç”¨ä¸ä¸€æ ·ï¼Œé‚£ä¸ºå•¥101å°±å¯ä»¥å‘¢ï¼Ÿå¯¹ï¼ŒIntegeræœ‰ä¸€ä¸ªç¼“å†²æ± ï¼Œå¤§å°åœ¨-128â€“127ä¹‹é—´çš„æ•°ï¼Œå¯ä»¥ç›´æ¥ä»ç¼“å†²æ± ä¸­æ‹¿ï¼Œæˆ‘å¼€å§‹åœ¨è¿™é‡Œçº ç»“äº†å¥½ä¸€ä¼šå„¿ğŸ˜‚</p><h3 id="å­—æ®µæ›´æ–°å™¨"><a href="#å­—æ®µæ›´æ–°å™¨" class="headerlink" title="å­—æ®µæ›´æ–°å™¨"></a>å­—æ®µæ›´æ–°å™¨</h3><p>å¦‚æœæˆ‘ä»¬åªéœ€è¦æŸä¸ªç±»é‡Œçš„æŸä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´è®©æ™®é€šçš„å˜é‡ä¹Ÿäº«å—åŸå­æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨åŸå­æ›´æ–°å­—æ®µç±»ï¼Œå¦‚åœ¨æŸäº›æ—¶å€™ç”±äºé¡¹ç›®å‰æœŸè€ƒè™‘ä¸å‘¨å…¨ï¼Œé¡¹ç›®éœ€æ±‚åˆå‘ç”Ÿå˜åŒ–ï¼Œä½¿å¾—æŸä¸ªç±»ä¸­çš„å˜é‡éœ€è¦æ‰§è¡Œå¤šçº¿ç¨‹æ“ä½œï¼Œç”±äºè¯¥å˜é‡å¤šå¤„ä½¿ç”¨ï¼Œæ”¹åŠ¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”åŸæ¥ä½¿ç”¨çš„åœ°æ–¹æ— éœ€ä½¿ç”¨çº¿ç¨‹å®‰å…¨ï¼Œåªè¦æ±‚æ–°åœºæ™¯éœ€è¦ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å€ŸåŠ©åŸå­æ›´æ–°å™¨å¤„ç†è¿™ç§åœºæ™¯ï¼ŒJavaä¸­æä¾›äº†å‡ ç§å­—æ®µæ›´æ–°å™¨<code>AtomicIntegerFieldUpdater</code>ï¼Œ<code>AtomicLongFieldUpdater</code>ï¼Œ<code>AtomicReferenceFieldUpdater</code>ï¼Œçœ‹åå­—å°±çŸ¥é“æ˜¯å¯¹åº”å•¥çš„</p><h4 id="AtomicIntegerFieldUpdateræµ‹è¯•"><a href="#AtomicIntegerFieldUpdateræµ‹è¯•" class="headerlink" title="AtomicIntegerFieldUpdateræµ‹è¯•"></a>AtomicIntegerFieldUpdateræµ‹è¯•</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicIntegerFieldUpdaterTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        AtomicIntegerFieldUpdater updater = AtomicIntegerFieldUpdater.newUpdater(TestUpdate.class, "num");</span><br><span class="line">        TestUpdate testUpdate = <span class="keyword">new</span> TestUpdate();</span><br><span class="line">        Stream.of(<span class="string">"t1"</span>, <span class="string">"t2"</span>, <span class="string">"t3"</span>, <span class="string">"t4"</span>, <span class="string">"t5"</span>).forEach(s -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">int</span> MAX = <span class="number">100</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < MAX; i++) {</span><br><span class="line">                    System.out.println(updater.getAndIncrement(testUpdate));</span><br><span class="line">                }</span><br><span class="line">            }, s).start();</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUpdate</span> </span>{</span><br><span class="line">        <span class="keyword">volatile</span> <span class="keyword">int</span> num;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·å°±ä¿è¯äº†Integerå­—æ®µè‡ªå¢æ“ä½œçš„åŸå­æ€§ï¼Œå¦å¤–ä¸¤ä¸ªä¸ä¹‹ç±»ä¼¼ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„åœ°æ–¹</strong></p><ul><li><p>æ“ä½œçš„å­—æ®µä¸èƒ½æ˜¯staticç±»å‹ã€‚</p></li><li><p>æ“ä½œçš„å­—æ®µä¸èƒ½æ˜¯finalç±»å‹çš„ï¼Œå› ä¸ºfinalæ ¹æœ¬æ²¡æ³•ä¿®æ”¹ã€‚</p></li><li><p>å­—æ®µå¿…é¡»æ˜¯volatileä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯æ•°æ®æœ¬èº«æ˜¯è¯»ä¸€è‡´çš„ã€‚</p></li><li><p>å±æ€§å¿…é¡»å¯¹å½“å‰çš„Updateræ‰€åœ¨çš„åŒºåŸŸæ˜¯å¯è§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºä½•æ—¶éƒ½åº”è¯¥ä¿è¯æ“ä½œç±»ä¸è¢«æ“ä½œç±»é—´çš„å¯è§æ€§ã€‚</p></li></ul><p><img alt="mark" data-src="http://static.imlgw.top///20190430/hIuzU4rePaAe.png?imageslim" src="/img/loading.gif" class="lazyload"></p><blockquote><p>ä½¿ç”¨å­—æ®µæ›´æ–°å™¨æ¯”èµ·ç›´æ¥ä½¿ç”¨åŸå­ç±»è¦èŠ‚çº¦å†…å­˜ï¼Œä½†æ˜¯æ“ä½œèµ·æ¥ä¸æ–¹ä¾¿</p></blockquote><h2 id="UnsafeåŒåˆƒå‰‘"><a href="#UnsafeåŒåˆƒå‰‘" class="headerlink" title="UnsafeåŒåˆƒå‰‘"></a>UnsafeåŒåˆƒå‰‘</h2><p><strong>Unsafe</strong>ç±»ï¼Œçœ‹åå­—å°±çŸ¥é“ä¸å®‰å…¨ï¼Œå¹¶ä¸æ˜¯å®ƒå†™çš„ä¸å®‰å…¨ï¼Œè€Œæ˜¯ç”¨èµ·æ¥ä¸å®‰å…¨ï¼Œå› ä¸ºå®ƒå¯ä»¥åƒc/c++ä¸€æ ·å»æ“ä½œå†…å­˜åœ°å€ï¼Œ<strong>unsafe</strong>é‡Œé¢çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯<strong>native</strong>çš„ï¼Œåº•å±‚éƒ½æ˜¯c/c++å®ç°çš„ï¼Œç›´æ¥ä¸æ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œä¸Šé¢CASæ‰§è¡Œä¹Ÿä¾èµ–äº<strong>unsafe</strong>ç±»ä¸­çš„æ–¹æ³•ï¼Œå…¶å®æ•´ä¸ªå¹¶å‘åŒ…é‡Œçš„ç±»éƒ½ä¾èµ–äº<strong>unsafe</strong>ï¼Œä½†æ˜¯å®˜æ–¹å¹¶ä¸å»ºè®®ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªç±»</p><ul><li>Unsafeæœ‰å¯èƒ½åœ¨æœªæ¥çš„Jdkç‰ˆæœ¬ç§»é™¤æˆ–è€…ä¸å…è®¸Javaåº”ç”¨ä»£ç ä½¿ç”¨ï¼Œè¿™ä¸€ç‚¹å¯èƒ½å¯¼è‡´ä½¿ç”¨äº†Unsafeçš„åº”ç”¨æ— æ³•è¿è¡Œåœ¨é«˜ç‰ˆæœ¬çš„Jdk</li><li>Unsafeçš„ä¸å°‘æ–¹æ³•ä¸­å¿…é¡»æä¾›åŸå§‹åœ°å€(å†…å­˜åœ°å€)å’Œè¢«æ›¿æ¢å¯¹è±¡çš„åœ°å€ï¼Œåç§»é‡è¦è‡ªå·±è®¡ç®—ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜å°±æ˜¯JVMå´©æºƒçº§åˆ«çš„å¼‚å¸¸ï¼Œä¼šå¯¼è‡´æ•´ä¸ªJVMå®ä¾‹å´©æºƒï¼Œè¡¨ç°ä¸ºåº”ç”¨ç¨‹åºç›´æ¥å´©æ‰ã€‚</li><li>Unsafeæä¾›çš„ç›´æ¥å†…å­˜è®¿é—®çš„æ–¹æ³•ä¸­ä½¿ç”¨çš„å†…å­˜ä¸å—JVMç®¡ç†(æ— æ³•è¢«GC)ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼Œä¸€æ—¦å‡ºç°ç–å¿½å¾ˆæœ‰å¯èƒ½æˆä¸ºå†…å­˜æ³„æ¼çš„æºå¤´ã€‚</li></ul><h3 id="è·å–Unsafe"><a href="#è·å–Unsafe" class="headerlink" title="è·å–Unsafe"></a>è·å–Unsafe</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–Unsafe</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title">getUnsafe</span><span class="params">()</span> </span>{</span><br><span class="line">    Field f = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        f = Unsafe.class.getDeclaredField("theUnsafe");</span><br><span class="line">        f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> (Unsafe)f.get(<span class="keyword">null</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="CASç›¸å…³"><a href="#CASç›¸å…³" class="headerlink" title="CASç›¸å…³"></a>CASç›¸å…³</h3><p>Javaä¸­çš„CASå®ç°è°ƒç”¨çš„å°±æ˜¯ä¸‰ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨çš„å°±æ˜¯å®ä¾‹å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨éœ€è¦CASå­—æ®µåœ¨è¯¥å®ä¾‹ä¸Šçš„åç§»é‡ï¼ˆä¸ç”¨è‡ªå·±è®¡ç®—ï¼ŒUnsafeæä¾›äº†æ–¹æ³•è®¡ç®—åç§»é‡ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯æœŸæœ›å€¼ï¼Œæœ€åä¸€ä¸ªå‚æ•°å°±æ˜¯æ›´æ–°çš„å€¼</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapObject</span><span class="params">(Object var1, <span class="keyword">long</span> var2, Object var4, Object var5)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapInt</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">int</span> var4, <span class="keyword">int</span> var5)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapLong</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">long</span> var4, <span class="keyword">long</span> var6)</span></span>;</span><br></pre></td></tr></tbody></table></figure></div><h3 id="åˆ©ç”¨Unsafeè‡ªå·±å†™ä¸€ä¸ªåŸå­Counter"><a href="#åˆ©ç”¨Unsafeè‡ªå·±å†™ä¸€ä¸ªåŸå­Counter" class="headerlink" title="åˆ©ç”¨Unsafeè‡ªå·±å†™ä¸€ä¸ªåŸå­Counter"></a>åˆ©ç”¨Unsafeè‡ªå·±å†™ä¸€ä¸ªåŸå­Counter</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CASCounter</span> <span class="keyword">implements</span> <span class="title">Counter</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CASCounter</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException </span>{</span><br><span class="line">        unsafe = getUnsafe();</span><br><span class="line">        <span class="comment">//è·å–counterå­—æ®µçš„å†…å­˜åç§»é‡</span></span><br><span class="line">        offset= unsafe.objectFieldOffset(CASCounter.class.getDeclaredField("counter"));</span><br><span class="line">        System.out.println(offset);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Unsafe unsafe;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> offset;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title">getUnsafe</span><span class="params">()</span> </span>{</span><br><span class="line">        Field f = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            f = Unsafe.class.getDeclaredField("theUnsafe");</span><br><span class="line">            f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> (Unsafe)f.get(<span class="keyword">null</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">long</span> current=counter;</span><br><span class="line">        <span class="keyword">while</span> (!unsafe.compareAndSwapLong(<span class="keyword">this</span>,offset,current,current+<span class="number">1</span>)){</span><br><span class="line">            current=counter;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getCounter</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> counter;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Counter</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">getCounter</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Unsafeçš„éªšæ“ä½œ"><a href="#Unsafeçš„éªšæ“ä½œ" class="headerlink" title="Unsafeçš„éªšæ“ä½œ"></a>Unsafeçš„éªšæ“ä½œ</h3><p><strong>ç»•è¿‡æ„é€ å™¨åˆ›å»ºå¯¹è±¡</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnsafeFooTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException,InstantiationException, NoSuchFieldException </span>{</span><br><span class="line">        Unsafe unsafe = UnsafeTest.getUnsafe();</span><br><span class="line">        <span class="comment">//ç»•è¿‡æ„é€ å™¨åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        Simple simple = (Simple) unsafe.allocateInstance(Simple<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(simple.get()); <span class="comment">//null</span></span><br><span class="line">        System.out.println(simple.getClass().getClassLoader());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Simple</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> String a = <span class="string">"a"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Simple</span><span class="params">()</span> </span>{</span><br><span class="line">            a = <span class="string">"new"</span>;</span><br><span class="line">            System.out.println(<span class="string">"============== "</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">static</span> {</span><br><span class="line">            System.out.println(<span class="string">"é™æ€ä»£ç å—"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ä¿®æ”¹å­—æ®µåœ¨å†…å­˜ä¸­çš„å€¼</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnsafeFooTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, NoSuchFieldException </span>{</span><br><span class="line">        Unsafe unsafe = UnsafeTest.getUnsafe();</span><br><span class="line">        Permission permission = <span class="keyword">new</span> Permission();</span><br><span class="line">        permission.doSth();</span><br><span class="line">        <span class="comment">//é€šè¿‡åå°„ä¹Ÿå¯ä»¥åšåˆ°ï¼Œä½†æ˜¯unsafeç›´æ¥æ˜¯åˆ°å†…å­˜åœ°å€ä¸­å°†å€¼ä¿®æ”¹äº†</span></span><br><span class="line">        Field access_allow = permission.getClass().getDeclaredField(<span class="string">"ACCESS_ALLOW"</span>);</span><br><span class="line">        <span class="comment">//è·å–å­—æ®µå†å¯¹è±¡ä¸­çš„å†…å­˜åç§»é‡ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæŒ‡é’ˆï¼ˆå†…å­˜åœ°å€ï¼‰</span></span><br><span class="line">        unsafe.putLong(permission,unsafe.objectFieldOffset(access_allow),-<span class="number">1</span>);</span><br><span class="line">        permission.doSth();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Permission</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ACCESS_ALLOW = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAllow</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span>  ACCESS_ALLOW==-<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSth</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (isAllow()) {</span><br><span class="line">            System.out.println(<span class="string">"i am workind"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>defindClassåŠ è½½ç±»æ–‡ä»¶</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnsafeFooTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, NoSuchFieldException, IllegalAccessException, NoSuchMethodException, InvocationTargetException </span>{</span><br><span class="line">        Unsafe unsafe = UnsafeTest.getUnsafe();</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = loadClassContent();</span><br><span class="line">        Class<!--?--> aClass = unsafe.defineClass(<span class="keyword">null</span>, bytes, <span class="number">0</span>, bytes.length, ClassLoader.getSystemClassLoader(), <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">int</span> get = (<span class="keyword">int</span>) aClass.getMethod(<span class="string">"get"</span>).invoke(aClass.newInstance(), <span class="keyword">null</span>);</span><br><span class="line">        System.out.println(get);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°†classå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] loadClassContent() {</span><br><span class="line">        File f = <span class="keyword">new</span> File(<span class="string">"D:\\ClassLoaderTest\\Res.class"</span>);</span><br><span class="line">        FileInputStream stream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            stream = <span class="keyword">new</span> FileInputStream(f);</span><br><span class="line">             bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) f.length()];</span><br><span class="line">            stream.read(bytes);</span><br><span class="line">            stream.close();</span><br><span class="line">        } <span class="keyword">catch</span> (FileNotFoundException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> bytes;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å°†ç¼–è¯‘å¥½çš„classæ–‡ä»¶æ”¾åˆ°å¯¹åº”çš„ç›®å½•ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Res</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Res</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.i=<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç»“æœ</strong>ï¼Œæ˜¯ä¸æ˜¯å¾ˆç‰›çš®ï¼ŸğŸ‚ğŸºæ˜¯ğŸ‚ğŸºä½†æ˜¯è¿™ä¸ªç©æ„å°½é‡çš„åˆ«ç”¨ã€‚ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top/blog/20190720/zLJJUhQ6GAdc.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>Unsafe</strong>é‡Œé¢çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šè¿™é‡Œå°±ä¸éƒ½åˆ—ä¸¾äº†ï¼Œæ¯•ç«Ÿæš‚æ—¶è¿˜ç”¨ä¸åˆ°ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šå¯ä»¥çœ‹çœ‹è¿™å‡ ç¯‡æ–‡ç« </p><ul><li><p><a href="https://www.cnblogs.com/throwable/p/9139947.html" target="_blank" rel="noopener">JAVAä¸­ç¥å¥‡çš„åŒåˆƒå‰‘â€“Unsafe</a></p></li><li><p><a href="https://www.zhihu.com/question/29266773?sort=created" target="_blank" rel="noopener">Rå¤§å…³äºUnsafeçš„ä½¿ç”¨å»ºè®®</a></p></li><li><p><a href="https://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.html" target="_blank" rel="noopener">Javaé­”æ³•ç±»ï¼šUnsafeåº”ç”¨è§£æ</a></p></li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¤šçº¿ç¨‹ä¹‹è®¾è®¡æ¨¡å¼</title>
      <link href="/2019/04/09/java-duo-xian-cheng-li-mian-de-she-ji-mo-shi/"/>
      <url>/2019/04/09/java-duo-xian-cheng-li-mian-de-she-ji-mo-shi/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h2><blockquote><p> è§‚å¯Ÿè€…è®¢é˜…è¢«è§‚å¯Ÿè€…çš„çŠ¶æ€ï¼Œå½“è¢«è§‚å¯Ÿè€…çŠ¶æ€æ”¹å˜çš„æ—¶å€™ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…çš„è§‚å¯Ÿè€…çš„è¿‡ç¨‹</p></blockquote><p><strong>è§‚å¯Ÿè€…æ¥å£</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>  <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>{</span><br><span class="line">    <span class="keyword">protected</span> Subject subject;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Observer</span><span class="params">(Subject subject)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.subject=subject;</span><br><span class="line">        subject.attach(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">abstract</span>  <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§‚å¯Ÿè€…1</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryObserver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BinaryObserver</span><span class="params">(Subject subject)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(subject);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"Binarry String :"</span>+ Integer.toBinaryString(subject.getState()));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§‚å¯Ÿè€…2</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OctalOberver</span> <span class="keyword">extends</span> <span class="title">Observer</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OctalOberver</span><span class="params">(Subject subject)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(subject);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"Octal String:"</span>+Integer.toOctalString(subject.getState()));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¢«è§‚å¯Ÿè€…</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>{</span><br><span class="line">    <span class="comment">//è§‚å¯Ÿè€…ä»¬</span></span><br><span class="line">    <span class="keyword">private</span>  List<observer> observers = <span class="keyword">new</span> ArrayList<>();</observer></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.state;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨å†Œè§‚å¯Ÿè€…</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(Observer observer)</span></span>{</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> state)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(state==<span class="keyword">this</span>.state){</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">this</span>.state=state;</span><br><span class="line">        notifyAllObserver();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çº¿ç¨‹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span>  <span class="keyword">void</span>  <span class="title">notifyAllObserver</span><span class="params">()</span></span>{</span><br><span class="line">        observers.stream().forEach(Observer::update);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserverCLi</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> Subject subject=<span class="keyword">new</span> Subject();</span><br><span class="line">        BinaryObserver binary=<span class="keyword">new</span> BinaryObserver(subject);</span><br><span class="line">        OctalOberver octalOberver = <span class="keyword">new</span> OctalOberver(subject);</span><br><span class="line">        System.out.println(<span class="string">"=================="</span>);</span><br><span class="line">        subject.setState(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"=================="</span>);</span><br><span class="line">        subject.setState(<span class="number">12</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="è¯»å†™é”åˆ†ç¦»æ¨¡å¼"><a href="#è¯»å†™é”åˆ†ç¦»æ¨¡å¼" class="headerlink" title="è¯»å†™é”åˆ†ç¦»æ¨¡å¼"></a>è¯»å†™é”åˆ†ç¦»æ¨¡å¼</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLock</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> readingR = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> waitingR = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> writingW = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> waitingW = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">readLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>{</span><br><span class="line">        <span class="keyword">this</span>.waitingR++;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//å¦‚æœæœ‰çº¿ç¨‹åœ¨å†™å°±ä¸èƒ½è¯»</span></span><br><span class="line">            <span class="keyword">while</span> (writingW > <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">this</span>.readingR++;</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">this</span>.waitingR--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">readUnlock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>{</span><br><span class="line">        <span class="keyword">this</span>.readingR--;</span><br><span class="line">        notifyAll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">writeLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>{</span><br><span class="line">        <span class="keyword">this</span>.waitingW++;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">while</span> (readingR><span class="number">0</span>||writingW><span class="number">0</span>){</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">this</span>.writingW++;</span><br><span class="line">        }<span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">this</span>.waitingW--;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">writeUnlock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>{</span><br><span class="line">        <span class="keyword">this</span>.writingW--;</span><br><span class="line">        notifyAll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åªæœ‰è¯»çš„æ—¶å€™ä¸åŠ é”ï¼Œå…¶ä»–çš„æ—¶å€™åŠ é”ï¼Œåœ¨è¯»çš„æ“ä½œå¤šäºå†™çš„æ“ä½œæ—¶ï¼Œæ•ˆç‡æå‡æ˜æ˜¾ã€‚</p><h2 id="ä¸å¯å˜å¯¹è±¡è®¾è®¡æ¨¡å¼"><a href="#ä¸å¯å˜å¯¹è±¡è®¾è®¡æ¨¡å¼" class="headerlink" title="ä¸å¯å˜å¯¹è±¡è®¾è®¡æ¨¡å¼"></a>ä¸å¯å˜å¯¹è±¡è®¾è®¡æ¨¡å¼</h2><p>è¿™ä¸ªè®¾è®¡æ¨¡å¼è¿˜æ˜¯å¾ˆé‡è¦ä¹Ÿå¾ˆå¸¸è§çš„ï¼Œ<code>ä¸å¯å˜</code>é¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨è¢«åˆ›å»ºåå¯¹è±¡æ‰€æœ‰çš„çŠ¶æ€å’Œå±æ€§éƒ½åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚</p><blockquote><p>ä¸å¯å˜å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„(é‡Œé¢çš„ä»»ä½•å±æ€§æˆ–è€…åº”ç”¨ç±»å‹çš„éƒ½ä¸èƒ½è¢«ä¿®æ”¹)ï¼Œå¯å˜å¯¹è±¡ä¸ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„(SrtingBuffer)ã€‚J2EEé‡Œé¢ï¼ŒServletå°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œstruts1çš„Actionä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote><p>é€šå¸¸æ¥è¯´ï¼Œåˆ›å»ºä¸å¯å˜ç±»åŸåˆ™æœ‰ä»¥ä¸‹å‡ æ¡ï¼š</p><p>â‘  æ‰€æœ‰æˆå‘˜å˜é‡å¿…é¡»æ˜¯<code>private</code></p><p>â‘¡ æœ€å¥½åŒæ—¶ç”¨<code>final</code>ä¿®é¥°(éå¿…é¡»)</p><p>â‘¢ ä¸æä¾›èƒ½å¤Ÿä¿®æ”¹åŸæœ‰å¯¹è±¡çŠ¶æ€çš„æ–¹æ³•</p><ul><li><p>æœ€å¸¸è§çš„æ–¹å¼æ˜¯ä¸æä¾›setteræ–¹æ³•</p></li><li><p>å¦‚æœæä¾›ä¿®æ”¹æ–¹æ³•ï¼Œéœ€è¦æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶åœ¨æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šè¿›è¡Œä¿®æ”¹</p></li></ul><p>â‘£ é€šè¿‡æ„é€ å™¨åˆå§‹åŒ–æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œå¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡å¿…é¡»è¿›è¡Œæ·±æ‹·è´(deep copy)</p><p>â‘¤ getteræ–¹æ³•ä¸èƒ½å¯¹å¤–æ³„éœ²thiså¼•ç”¨ä»¥åŠæˆå‘˜å˜é‡çš„å¼•ç”¨</p><p>â‘¥ æœ€å¥½ä¸å…è®¸ç±»è¢«ç»§æ‰¿(éå¿…é¡»)</p><p>ã€€ã€€JDKä¸­æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬åˆ›å»ºä¸å¯å˜é›†åˆï¼Œå¦‚ï¼š</p><p><code>Collections.unmodifiableList(List<!--? extends T--> list)</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>{</span><br><span class="line">    <span class="comment">//å®šä¹‰æˆfinal</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">final</span> String name,<span class="keyword">final</span> String address)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person{"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è™½ç„¶è¯´æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œä½†æ˜¯å…¶å®é€šè¿‡åå°„ç­‰æ–¹æ³•è¿˜æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException </span>{</span><br><span class="line">        <span class="comment">/*String s="Hello";</span></span><br><span class="line"><span class="comment">        String s1=s.replace("l","K");</span></span><br><span class="line"><span class="comment">        System.out.println(s.hashCode());</span></span><br><span class="line"><span class="comment">        System.out.println(s1.hashCode());*/</span></span><br><span class="line">        String s = <span class="string">"Hello World"</span>;</span><br><span class="line">        System.out.println(<span class="string">"s = "</span> + s);<span class="comment">//Hello World</span></span><br><span class="line"><span class="comment">//Stringç±»é‡Œé¢çš„char[]</span></span><br><span class="line">        Field valueFieldOfString = String.class.getDeclaredField("value");</span><br><span class="line">        valueFieldOfString.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span>[] value = (<span class="keyword">char</span>[]) valueFieldOfString.get(s);</span><br><span class="line">        value[<span class="number">5</span>] = <span class="string">'_'</span>;</span><br><span class="line">        System.out.println(<span class="string">"s = "</span> + s); <span class="comment">//Hello_World</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="Futureè®¾è®¡æ¨¡å¼-å¼‚æ­¥"><a href="#Futureè®¾è®¡æ¨¡å¼-å¼‚æ­¥" class="headerlink" title="Futureè®¾è®¡æ¨¡å¼(å¼‚æ­¥)"></a>Futureè®¾è®¡æ¨¡å¼(å¼‚æ­¥)</h2><p><code>Future</code>æ¥å£</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Future</span><<span class="title">T</span>> </span>{</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><code>FutureTask</code>æ¥å£</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FutureTask</span><<span class="title">T</span>> </span>{</span><br><span class="line">    <span class="function">T <span class="title">call</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><code>AsynFuture</code>å¼‚æ­¥</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsynFuture</span><<span class="title">T</span>> <span class="keyword">implements</span> <span class="title">Future</span><<span class="title">T</span>> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T result;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">(T result)</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            <span class="keyword">this</span>.result = result;</span><br><span class="line">            <span class="keyword">this</span>.done = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">//å®Œæˆä»»åŠ¡é€šçŸ¥è°ƒç”¨è€…</span></span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">            <span class="keyword">while</span> (!done) {</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><code>FutureService</code>è¿æ¥<code>Future</code>å’Œ<code>FutureTask</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <t> <span class="function">Future<t> <span class="title">submit</span><span class="params">(<span class="keyword">final</span> FutureTask<t> task)</t></span> </t></span>{</t></span><br><span class="line">        AsynFuture<t> asynFuture = <span class="keyword">new</span> AsynFuture<>();</t></span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            T result = task.call();</span><br><span class="line">            asynFuture.done(result);</span><br><span class="line">        }).start();</span><br><span class="line">        <span class="keyword">return</span> asynFuture;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//java8 å›è°ƒ callback</span></span><br><span class="line">    <span class="keyword">public</span> <t> <span class="function">Future<t> <span class="title">submit</span><span class="params">(<span class="keyword">final</span> FutureTask<t> task, <span class="keyword">final</span> Consumer<t> consumer)</t></t></span> </t></span>{</t></span><br><span class="line">        AsynFuture<t> asynFuture = <span class="keyword">new</span> AsynFuture<>();</t></span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            T result = task.call();</span><br><span class="line">            asynFuture.done(result);</span><br><span class="line">            consumer.accept(result);</span><br><span class="line">        }).start();</span><br><span class="line">        <span class="keyword">return</span> asynFuture;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æµ‹è¯•<code>Future</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncInvoker</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line"></span><br><span class="line">        FutureService futureService = <span class="keyword">new</span> FutureService();</span><br><span class="line">        Future<string> submit = futureService.submit(() -> {</string></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">10000l</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"FINISH"</span>;</span><br><span class="line">        },System.out::println);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"==========="</span>);</span><br><span class="line">        System.out.println(<span class="string">" do other thing."</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="string">"==========="</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        Thread.sleep(<span class="number">10000l</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"FINISH"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>Future   ->æœªæ¥çš„ç¥¨æ®</p><p>FutureTask   ->å®é™…æ‰§è¡Œçš„ä»»åŠ¡</p><p>FutureService  ->æ¡¥æ¥Futureå’ŒFutureTask</p></blockquote><h2 id="Guarded-Suspensionè®¾è®¡æ¨¡å¼"><a href="#Guarded-Suspensionè®¾è®¡æ¨¡å¼" class="headerlink" title="Guarded Suspensionè®¾è®¡æ¨¡å¼"></a>Guarded Suspensionè®¾è®¡æ¨¡å¼</h2><p><code>ä¿æŠ¤æ€§æš‚æŒ‚æ¨¡å¼</code></p><p>Guardedæ˜¯è¢«å®ˆæŠ¤çš„æ„æ€ã€‚Suspensionæ˜¯æš‚åœçš„æ„æ€ï¼ŒGuarded Suspensionæ¨¡å¼é€šè¿‡è®©çº¿ç¨‹ç­‰å¾…æ¥ä¿è¯å®ä¾‹çš„å®‰å…¨æ€§ã€‚</p><blockquote><p>æ ¸å¿ƒæ€æƒ³: å¦‚æœæŸä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šçš„æ“ä½œå‰éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œåˆ™åœ¨è¯¥æ¡ä»¶æœªæ»¡è¶³æ—¶å°†çº¿ç¨‹æš‚åœè¿è¡Œï¼ˆå³æš‚æŒ‚çº¿ç¨‹ï¼Œä½¿å…¶å¤„äºç­‰å¾…ï¼ˆwaitingï¼‰çŠ¶æ€ï¼Œç›´åˆ°è¯¥æ¡ä»¶æ»¡è¶³æ—¶æ‰ç»§ç»­è¿è¡Œï¼‰</p></blockquote><p><strong>Requestå¯¹è±¡</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">(String value)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>RequestQueue</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestQueue</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LinkedList<request> queue = <span class="keyword">new</span> LinkedList<>();</request></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Request <span class="title">getRequest</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (queue) {</span><br><span class="line">            <span class="keyword">while</span> (queue.size() <= <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">//é˜Ÿåˆ—ä¸ºç©ºç­‰ä¸€ä¸‹</span></span><br><span class="line">                    queue.wait();</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            Request request = queue.removeFirst();</span><br><span class="line">            <span class="keyword">return</span> request;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putRequest</span><span class="params">(Request request)</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (queue) {</span><br><span class="line">            queue.addLast(request);</span><br><span class="line">            queue.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Server</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RequestQueue queue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Random random;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> closed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerThread</span><span class="params">(RequestQueue queue)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.queue = queue;</span><br><span class="line">        random = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (!closed) {</span><br><span class="line">            Request request = queue.getRequest();</span><br><span class="line">            <span class="comment">//getå¯èƒ½ä¼šè¿”å›null</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == request) {</span><br><span class="line">                System.out.println(<span class="string">"Received the empty request."</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="string">"Server ->"</span> + request.getValue());</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(random.nextInt(<span class="number">1000</span>));</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                <span class="comment">//æ‰“æ–­åç›´æ¥return</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.closed = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.interrupt();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Client</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RequestQueue queue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Random random;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String sendValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientThread</span><span class="params">(RequestQueue queue, String sendValue)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.queue = queue;</span><br><span class="line">        <span class="keyword">this</span>.sendValue = sendValue;</span><br><span class="line">        random = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">10</span>; i++) {</span><br><span class="line">            System.out.println(<span class="string">"Client -> request "</span> + sendValue);</span><br><span class="line">            <span class="comment">//å®¢æˆ·ç«¯å‘é€è¯·æ±‚</span></span><br><span class="line">            queue.putRequest(<span class="keyword">new</span> Request(sendValue));</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(random.nextInt(<span class="number">1000</span>));</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuspensionClient</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">final</span> RequestQueue queue = <span class="keyword">new</span> RequestQueue();</span><br><span class="line">        <span class="keyword">new</span> ClientThread(queue, <span class="string">"Shaw"</span>).start();</span><br><span class="line">        ServerThread serverThread = <span class="keyword">new</span> ServerThread(queue);</span><br><span class="line">        serverThread.start();</span><br><span class="line">        <span class="comment">//serverThread.join(); joinä½äº†åé¢è¿˜å’‹closeï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">        Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">        serverThread.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><p>çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹ä¿é™©ç®±ï¼Œä»¥<code>Thread</code>ä½œä¸º<code>key</code></p><blockquote><p>This class provides <code>thread-local variables</code>. These variables differ from their normal counterparts in that each thread that accesses one (via its <code>get</code> or <code>set</code> method) has its own, independently initialized copy of the variable.</p></blockquote><p>æ¨¡æ‹Ÿ<code>ThreadLocal</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalSimulator</span><<span class="title">T</span>> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map<thread,t> threadMap=<span class="keyword">new</span> HashMap<>();</thread,t></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span></span>{</span><br><span class="line">        Thread currentThread=Thread.currentThread();</span><br><span class="line">        <span class="keyword">synchronized</span> (threadMap){</span><br><span class="line">            threadMap.put(currentThread,t);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span></span>{</span><br><span class="line">        Thread currentThread =Thread.currentThread();</span><br><span class="line">        <span class="keyword">if</span>(threadMap.get(currentThread)==<span class="keyword">null</span>){</span><br><span class="line">             threadMap.put(currentThread,initVal());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> threadMap.get(currentThread);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> T <span class="title">initVal</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="Balkingè®¾è®¡æ¨¡å¼"><a href="#Balkingè®¾è®¡æ¨¡å¼" class="headerlink" title="Balkingè®¾è®¡æ¨¡å¼"></a>Balkingè®¾è®¡æ¨¡å¼</h2><blockquote><p>æ ¸å¿ƒæ€æƒ³ï¼šå½“ä¸å†é€‚åˆæˆ–è€…æ²¡æœ‰å¿…è¦è¿›è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œå°±ç›´æ¥æ”¾å¼ƒè¿›è¡Œè¿™ä¸ªæ“ä½œè€Œç›´æ¥è¿”å›ï¼Œä¸éœ€è¦å°±ç®—äº†</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BalkingData</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> changed;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BalkingData</span><span class="params">(String fileName, String content, <span class="keyword">boolean</span> changed)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">        <span class="keyword">this</span>.changed = changed;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(String newContent)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.content = newContent;</span><br><span class="line">        <span class="keyword">this</span>.changed = <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="keyword">if</span> (!changed) {</span><br><span class="line">            <span class="comment">//é¡¾å®¢æ²¡æœ‰æœåŠ¡è¯·æ±‚ï¼Œé‚£ä¹ˆæ”¾å¼ƒæä¾›æœåŠ¡æ“ä½œï¼Œç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        doSave();</span><br><span class="line">        <span class="keyword">this</span>.changed = <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doSave</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" call  do save content"</span>);</span><br><span class="line">        <span class="keyword">try</span>(Writer writer = <span class="keyword">new</span> FileWriter(fileName, <span class="keyword">true</span>)) {</span><br><span class="line">            writer.write(content);</span><br><span class="line">            writer.write(<span class="string">"\n"</span>);</span><br><span class="line">            writer.flush();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>CustomerThread</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BalkingData balkingData;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Random random = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerThread</span><span class="params">(BalkingData balkingData)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"Customer"</span>);</span><br><span class="line">        <span class="keyword">this</span>.balkingData = balkingData;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            balkingData.save();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">20</span>; i++) {</span><br><span class="line">                balkingData.change(<span class="string">"No."</span> + i);</span><br><span class="line">                Thread.sleep(random.nextInt(<span class="number">1000</span>));</span><br><span class="line">                balkingData.save();</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>WaiterThread</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaiterThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BalkingData balkingData;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WaiterThread</span><span class="params">(BalkingData balkingData)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"Waiter"</span>);</span><br><span class="line">        <span class="keyword">this</span>.balkingData = balkingData;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">200</span>; i++) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                balkingData.save();</span><br><span class="line">                Thread.sleep(<span class="number">1_000L</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="CountDownè®¾è®¡æ¨¡å¼"><a href="#CountDownè®¾è®¡æ¨¡å¼" class="headerlink" title="CountDownè®¾è®¡æ¨¡å¼"></a>CountDownè®¾è®¡æ¨¡å¼</h2><p><strong>CountDown</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDown</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> total;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> counter;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountDown</span><span class="params">(<span class="keyword">int</span> total)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.total = total;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">down</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>){</span><br><span class="line">            <span class="keyword">this</span>.counter++;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>){</span><br><span class="line">            <span class="keyword">while</span> (counter!=total){</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æµ‹è¯•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDKCountDown</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Random random = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="comment">//JDKçš„CountDown</span></span><br><span class="line">        <span class="comment">//final CountDownLatch latch=new CountDownLatch(5);</span></span><br><span class="line">        <span class="keyword">final</span> CountDown latch=<span class="keyword">new</span> CountDown(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"å‡†å¤‡å¤šçº¿ç¨‹å¤„ç†ä»»åŠ¡"</span>);</span><br><span class="line">        <span class="comment">//the first phase</span></span><br><span class="line">        IntStream.range(<span class="number">0</span>,<span class="number">5</span>).forEach(i->{</span><br><span class="line">            <span class="keyword">new</span> Thread(()->{</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">" is working"</span>);</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">                latch.down();</span><br><span class="line">            },String.valueOf(i)).start();</span><br><span class="line">        });</span><br><span class="line">        latch.await();</span><br><span class="line">        <span class="comment">//the second phase</span></span><br><span class="line">        System.out.println(<span class="string">"å¤šçº¿ç¨‹ä»»åŠ¡å…¨éƒ¨ç»“æŸï¼Œå‡†å¤‡ç¬¬äºŒé˜¶æ®µä»»åŠ¡"</span>);</span><br><span class="line">        System.out.println(<span class="string">"........"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Finish"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><h3 id="Double-check"><a href="#Double-check" class="headerlink" title="Double check"></a>Double check</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonObjectPlus</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span>  SingletonObjectPlus singletonObjectPlus =<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonObjectPlus <span class="title">getSingletonObject3</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(singletonObjectPlus==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">synchronized</span>(SingletonObject<span class="class">.<span class="keyword">class</span>)</span>{</span><br><span class="line">            <span class="keyword">if</span>(singletonObjectPlus==<span class="keyword">null</span>){</span><br><span class="line">                singletonObjectPlus= <span class="keyword">new</span> SingletonObjectPlus();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">     <span class="keyword">return</span> singletonObjectPlus;</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>è¿™ç§æ–¹å¼åœ¨å®ä¾‹å¯¹è±¡ä¸Šè¦åŠ ä¸Š <code>volatile</code>ï¼Œé¿å…å®ä¾‹å¯¹è±¡æ²¡æœ‰åˆå§‹åŒ–å®Œæˆå°±è¿”å›</p></blockquote><h3 id="InstanceHolder"><a href="#InstanceHolder" class="headerlink" title="InstanceHolder"></a>InstanceHolder</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleGraceful</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingleGraceful</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//privateé™æ€å†…éƒ¨ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceHolder</span></span>{</span><br><span class="line">        <span class="comment">//åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> SingleGraceful instance=<span class="keyword">new</span> SingleGraceful();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleGraceful <span class="title">getInstance</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">return</span> SingleGraceful.InstanceHolder.instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>JVMåªä¼šä¸ºstaticå˜é‡åˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œä¹Ÿå°±æ˜¯åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œè€Œå†…éƒ¨ç±»ä¸ä¼šåœ¨å…¶å¤–éƒ¨ç±»è¢«åŠ è½½çš„åŒæ—¶è¢«åŠ è½½ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆç®€æ´å¾ˆä¼˜ç§€çš„å•ä¾‹</p><h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleGraceful2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingleGraceful2</span><span class="params">()</span> </span>{}</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> Singleton {</span><br><span class="line">        INSTANCE;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SingleGraceful2 instance;</span><br><span class="line"></span><br><span class="line">        Singleton() {</span><br><span class="line">            instance = <span class="keyword">new</span> SingleGraceful2();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SingleGraceful2 <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleGraceful2 <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Singleton.INSTANCE.getInstance();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><ul><li>æšä¸¾ç±»æ„é€ å‡½æ•°æ˜¯<code>private</code>ç±»å‹çš„</li><li>æšä¸¾ç±»çš„åŸŸ(field)(<code>INSTANCE</code>)å…¶å®æ˜¯ç›¸åº”çš„enumç±»å‹(<code>Singleton</code>)çš„ä¸€ä¸ªé™æ€å®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œæ„é€ å™¨ä¹Ÿåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</li><li>æšä¸¾å•ä¾‹å¯ä»¥é˜²æ­¢<code>ååºåˆ—åŒ–</code> ï¼Œ<code>åå°„</code>ï¼Œ<code>å…‹éš†</code>å¯¹å•ä¾‹çš„ç ´åï¼Œæ‰€ä»¥æ˜¯ä¸€ç§æå…¶ä¼˜ç§€çš„å•ä¾‹å®ç°ã€‚</li></ul><blockquote><p>è¿™é‡Œå…¶å®è¿˜æœ‰å¾ˆå¤šæ²¡æœ‰ä»‹ç»å‡ºæ¥ï¼Œè®¾è®¡æ¨¡å¼è¿™äº›ä¸œè¥¿æ²¡æœ‰å®é™…çš„åœºæ™¯å»ç”¨ç¡®å®éš¾ä»¥ä½“ä¼šåˆ°å®ƒçš„ç²¾é«“ï¼Œéœ€è¦æ…¢æ…¢çš„ç§¯ç´¯ç»éªŒæ‰è¡Œã€‚</p></blockquote></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¤šçº¿ç¨‹åŸºç¡€</title>
      <link href="/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/"/>
      <url>/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="1-çº¿ç¨‹ä¸è¿›ç¨‹åŒºåˆ«"><a href="#1-çº¿ç¨‹ä¸è¿›ç¨‹åŒºåˆ«" class="headerlink" title="1.çº¿ç¨‹ä¸è¿›ç¨‹åŒºåˆ«"></a>1.çº¿ç¨‹ä¸è¿›ç¨‹åŒºåˆ«</h2><p>æ¯ä¸ªæ­£åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„ç¨‹åºéƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹åŒ…å«ä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹æ˜¯ä¸€ç»„æŒ‡ä»¤çš„é›†åˆï¼Œæˆ–è€…æ˜¯ç¨‹åºçš„ç‰¹æ®Šæ®µï¼Œå®ƒå¯ä»¥åœ¨ç¨‹åºé‡Œç‹¬ç«‹æ‰§è¡Œã€‚ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä»£ç è¿è¡Œçš„ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥çº¿ç¨‹åŸºæœ¬ä¸Šæ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œå®ƒè´Ÿè´£åœ¨å•ä¸ªç¨‹åºé‡Œæ‰§è¡Œå¤šä»»åŠ¡ã€‚é€šå¸¸ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å¤šä¸ªçº¿ç¨‹çš„è°ƒåº¦å’Œæ‰§è¡Œã€‚</p><p>ä½¿ç”¨çº¿ç¨‹å¯ä»¥æŠŠå æ®æ—¶é—´é•¿çš„ç¨‹åºä¸­çš„ä»»åŠ¡æ”¾åˆ°åå°å»å¤„ç†ï¼Œç¨‹åºçš„è¿è¡Œé€Ÿåº¦å¯èƒ½åŠ å¿«ï¼Œåœ¨ä¸€äº›ç­‰å¾…çš„ä»»åŠ¡å®ç°ä¸Šå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶è¯»å†™å’Œç½‘ç»œæ”¶å‘æ•°æ®ç­‰ï¼Œçº¿ç¨‹å°±æ¯”è¾ƒæœ‰ç”¨äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥é‡Šæ”¾ä¸€äº›çè´µçš„èµ„æºå¦‚å†…å­˜å ç”¨ç­‰ç­‰ã€‚</p><p>å¦‚æœæœ‰å¤§é‡çš„çº¿ç¨‹,ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ï¼Œæ›´å¤šçš„çº¿ç¨‹éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹çš„ä¸­æ­¢éœ€è¦è€ƒè™‘å…¶å¯¹ç¨‹åºè¿è¡Œçš„å½±å“ã€‚é€šå¸¸å—æ¨¡å‹æ•°æ®æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«çš„ï¼Œéœ€è¦é˜²æ­¢çº¿ç¨‹æ­»é”æƒ…å†µçš„å‘ç”Ÿã€‚</p><p>æ€»ç»“:è¿›ç¨‹æ˜¯æ‰€æœ‰çº¿ç¨‹çš„é›†åˆï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚</p><h2 id="2-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿå¤šçº¿ç¨‹åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿå¤šçº¿ç¨‹åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="2.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿå¤šçº¿ç¨‹åº”ç”¨åœºæ™¯ï¼Ÿ"></a>2.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿå¤šçº¿ç¨‹åº”ç”¨åœºæ™¯ï¼Ÿ</h2><p>ç­”:ä¸»è¦èƒ½ä½“ç°åˆ°å¤šçº¿ç¨‹æé«˜ç¨‹åºæ•ˆç‡ã€‚</p><p>ä¸¾ä¾‹: è¿…é›·å¤šçº¿ç¨‹ä¸‹è½½ã€æ•°æ®åº“è¿æ¥æ± ã€åˆ†æ‰¹å‘é€çŸ­ä¿¡ç­‰ã€‚</p><h2 id="3-çº¿ç¨‹åˆ›å»ºæ–¹å¼"><a href="#3-çº¿ç¨‹åˆ›å»ºæ–¹å¼" class="headerlink" title="3.çº¿ç¨‹åˆ›å»ºæ–¹å¼"></a>3.çº¿ç¨‹åˆ›å»ºæ–¹å¼</h2><h3 id="ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•"><a href="#ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•" class="headerlink" title="ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•"></a>ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlayGame</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">50</span>; i++) {</span><br><span class="line">System.out.println(<span class="string">"PlayGame"</span> + (i + <span class="number">1</span>));</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="comment">//void say() {}</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListenMusic</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">50</span>; i++) {</span><br><span class="line">System.out.println(<span class="string">"ListenMusic"</span> + (i + <span class="number">1</span>));<span class="comment">//åº•å±‚æ“ä½œå±…ç„¶æ˜¯ç”¨çš„StringBuilder</span></span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> </span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">Thread music = <span class="keyword">new</span> ListenMusic();</span><br><span class="line">Thread pg = <span class="keyword">new</span> PlayGame();</span><br><span class="line">music.start(); <span class="comment">//ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡ŒæŠ¢å èµ„æº</span></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">pg.start();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">50</span>; i++) {</span><br><span class="line">System.out.println(<span class="string">"    mainæ–¹æ³•:"</span> + (i + <span class="number">1</span>));</span><br><span class="line">}</span><br><span class="line">pg.start();</span><br><span class="line">} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">System.out.println(<span class="string">"å‡ºç°äº†IllegalThreadStateExceptionå¼‚å¸¸"</span>);  <span class="comment">//çº¿ç¨‹åªèƒ½å¯åŠ¨ä¸€æ¬¡</span></span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§æ–¹æ³•å®˜æ–¹ä¹Ÿä¸æ¨èä½¿ç”¨å› ä¸ºJavaæ˜¯å•ç»§æ‰¿çš„ç»§æ‰¿äº†Threadç±»ä¹‹åå°±ä¸èƒ½ç»§æ‰¿å…¶ä»–çš„ç±»</p><h3 id="å®ç°Runnableæ¥å£"><a href="#å®ç°Runnableæ¥å£" class="headerlink" title="å®ç°Runnableæ¥å£"></a>å®ç°Runnableæ¥å£</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">for</span> (inti = <span class="number">0</span>; i< <span class="number">10</span>; i++) {</span><br><span class="line">System.out.println(<span class="string">"i:"</span> + i);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo2</span> </span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">System.out.println(<span class="string">"-----å¤šçº¿ç¨‹åˆ›å»ºå¼€å§‹-----"</span>);</span><br><span class="line"><span class="comment">// 1.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">CreateRunnable createThread = <span class="keyword">new</span> CreateRunnable();</span><br><span class="line"><span class="comment">// 2.å¼€å§‹æ‰§è¡Œçº¿ç¨‹ æ³¨æ„ å¼€å¯çº¿ç¨‹ä¸æ˜¯è°ƒç”¨runæ–¹æ³•ï¼Œè€Œæ˜¯startæ–¹æ³•</span></span><br><span class="line">System.out.println(<span class="string">"-----å¤šçº¿ç¨‹åˆ›å»ºå¯åŠ¨-----"</span>);</span><br><span class="line">Thread thread = <span class="keyword">new</span> Thread(createThread);</span><br><span class="line">thread.start();</span><br><span class="line">System.out.println(<span class="string">"-----å¤šçº¿ç¨‹åˆ›å»ºç»“æŸ-----"</span>);</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InClass</span> </span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"> Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i< <span class="number">100</span>; i++) {</span><br><span class="line">System.out.println(<span class="string">"i:"</span> + i);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">});</span><br><span class="line">thread.start();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//lambdaè¡¨è¾¾å¼è¿˜æ˜¯æ¯”è¾ƒç®€æ´</span></span><br><span class="line"> <span class="keyword">new</span> Thread(()-> {<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i <<span class="number">100</span>; i++) {System.out.println(<span class="string">"lambda:"</span> +i);}}).start();</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>çº¿ç¨‹åˆ›å»ºæ–¹å¼ä¸åªè¿™äº›è¿˜æœ‰å¾ˆå¤šï¼Œåé¢å†ä»‹ç»</p><h3 id="Thread-ç±»ä¸­çš„start-å’Œ-run-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Thread-ç±»ä¸­çš„start-å’Œ-run-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Thread ç±»ä¸­çš„start() å’Œ run() æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Thread ç±»ä¸­çš„start() å’Œ run() æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>è¿™ä¸ªé—®é¢˜ç»å¸¸è¢«é—®åˆ°ï¼Œä½†è¿˜æ˜¯èƒ½ä»æ­¤åŒºåˆ†å‡ºé¢è¯•è€…å¯¹Javaçº¿ç¨‹æ¨¡å‹çš„ç†è§£ç¨‹åº¦ã€‚<code>start()</code>æ–¹æ³•è¢«ç”¨æ¥å¯åŠ¨æ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œè€Œä¸”<code>start()</code>å†…éƒ¨nativeæ–¹æ³•<code>start0()</code>è°ƒç”¨äº†run()æ–¹æ³•ï¼Œè¿™å’Œç›´æ¥è°ƒç”¨<code>run()</code>æ–¹æ³•çš„æ•ˆæœä¸ä¸€æ ·ã€‚å½“ä½ è°ƒç”¨<code>run()</code>æ–¹æ³•çš„æ—¶å€™ï¼Œåªä¼šæ˜¯åœ¨åŸæ¥çš„çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œæ²¡æœ‰æ–°çš„çº¿ç¨‹å¯åŠ¨ï¼Œ<code>start()</code>æ–¹æ³•æ‰ä¼šå¯åŠ¨æ–°çº¿ç¨‹</p><h2 id="4-Threadæ„é€ å‡½æ•°"><a href="#4-Threadæ„é€ å‡½æ•°" class="headerlink" title="4.Threadæ„é€ å‡½æ•°"></a>4.Threadæ„é€ å‡½æ•°</h2><table><thead><tr><th align="left"><strong>å¸¸ç”¨çº¿ç¨‹apiæ–¹æ³•</strong></th><th></th></tr></thead><tbody><tr><td align="left">start()</td><td>å¯åŠ¨çº¿ç¨‹</td></tr><tr><td align="left">currentThread()</td><td>è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</td></tr><tr><td align="left">getID()</td><td>è·å–å½“å‰çº¿ç¨‹ID   Thread-ç¼–å· è¯¥ç¼–å·ä»0å¼€å§‹</td></tr><tr><td align="left">getName()</td><td>è·å–å½“å‰çº¿ç¨‹åç§°</td></tr><tr><td align="left">sleep(long mill)</td><td>ä¼‘çœ çº¿ç¨‹</td></tr><tr><td align="left">Stopï¼ˆï¼‰</td><td>åœæ­¢çº¿ç¨‹,</td></tr><tr><td align="left"><strong>å¸¸ç”¨çº¿ç¨‹æ„é€ å‡½æ•°</strong></td><td></td></tr><tr><td align="left">Threadï¼ˆï¼‰</td><td>åˆ†é…ä¸€ä¸ªæ–°çš„ Thread å¯¹è±¡</td></tr><tr><td align="left">Threadï¼ˆString nameï¼‰</td><td>åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡ï¼Œå…·æœ‰æŒ‡å®šçš„ nameæ­£å¦‚å…¶åã€‚</td></tr><tr><td align="left">Threadï¼ˆRunnable rï¼‰</td><td>åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡</td></tr><tr><td align="left">Threadï¼ˆRunable r, String nameï¼‰</td><td>åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡ï¼Œå…·æœ‰æŒ‡å®šçš„ nameæ­£å¦‚å…¶åã€‚</td></tr><tr><td align="left">Thread(ThreadGroup group, Runnable target)</td><td>åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡ï¼Œå¦‚æœä¸ä¼ <code>ThreadGroup</code>é»˜è®¤åŠ å…¥å½“å‰çº¿ç¨‹çš„<code>ThreadGroup</code>ä¸­</td></tr><tr><td align="left">Thread(ThreadGroup group, Runnable target, String name)</td><td>åˆ†é…ä¸€ä¸ªæ–°çš„ <code>Thread</code>å¯¹è±¡ï¼Œä½¿å…¶å…·æœ‰  <code>target</code>ä½œä¸ºå…¶è¿è¡Œå¯¹è±¡ï¼Œå…·æœ‰æŒ‡å®šçš„ <code>name</code>ä½œä¸ºå…¶åç§°ï¼Œå±äº  <code>group</code>å¼•ç”¨çš„çº¿ç¨‹ç»„ã€‚</td></tr><tr><td align="left">Thread(ThreadGroup group, Runnable target, String name,  long stackSize)</td><td>åˆ†é…ä¸€ä¸ªæ–°çš„ <code>Thread</code>å¯¹è±¡ï¼Œä»¥ä¾¿å®ƒå…·æœ‰  <code>target</code>ä½œä¸ºå…¶è¿è¡Œå¯¹è±¡ï¼Œå°†æŒ‡å®šçš„ <code>name</code>æ­£å¦‚å…¶åï¼Œä»¥åŠå±äºè¯¥çº¿ç¨‹ç»„ç”±ç§°ä½œ  <code>group</code> ï¼Œå¹¶å…·æœ‰æŒ‡å®šçš„ <em>å †æ ˆå¤§å°</em></td></tr></tbody></table><h3 id="Threadæ„é€ æ–¹æ³•çš„ä¸€äº›ç»†èŠ‚"><a href="#Threadæ„é€ æ–¹æ³•çš„ä¸€äº›ç»†èŠ‚" class="headerlink" title="Threadæ„é€ æ–¹æ³•çš„ä¸€äº›ç»†èŠ‚"></a>Threadæ„é€ æ–¹æ³•çš„ä¸€äº›ç»†èŠ‚</h3><p>ç›´æ¥ä¸Šæºç </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ThreadGroup g, Runnable target, String name,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">long</span> stackSize, AccessControlContext acc,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">boolean</span> inheritThreadLocals)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"name cannot be null"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line"></span><br><span class="line">    Thread parent = currentThread();</span><br><span class="line">    SecurityManager security = System.getSecurityManager();</span><br><span class="line">    <span class="keyword">if</span> (g == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">/* Determine if it's an applet or not */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* If there is a security manager, ask the security manager</span></span><br><span class="line"><span class="comment">               what to do. */</span></span><br><span class="line">        <span class="keyword">if</span> (security != <span class="keyword">null</span>) {</span><br><span class="line">            g = security.getThreadGroup();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* If the security doesn't have a strong opinion of the matter</span></span><br><span class="line"><span class="comment">               use the parent thread group. */</span></span><br><span class="line">        <span class="keyword">if</span> (g == <span class="keyword">null</span>) {</span><br><span class="line">            g = parent.getThreadGroup();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* checkAccess regardless of whether or not threadgroup is</span></span><br><span class="line"><span class="comment">           explicitly passed in. */</span></span><br><span class="line">    g.checkAccess();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Do we have the required permissions?</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">if</span> (security != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">if</span> (isCCLOverridden(getClass())) {</span><br><span class="line">            security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    g.addUnstarted();</span><br><span class="line">    <span class="keyword">this</span>.group = g;</span><br><span class="line">    <span class="comment">//è¿™é‡Œç»§æ‰¿äº†çˆ¶ç±»çš„ä¸€äº›å±æ€§</span></span><br><span class="line">    <span class="keyword">this</span>.daemon = parent.isDaemon();</span><br><span class="line">    <span class="keyword">this</span>.priority = parent.getPriority();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (security == <span class="keyword">null</span> || isCCLOverridden(parent.getClass()))</span><br><span class="line">        <span class="keyword">this</span>.contextClassLoader = parent.getContextClassLoader();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">this</span>.contextClassLoader = parent.contextClassLoader;</span><br><span class="line">    <span class="keyword">this</span>.inheritedAccessControlContext =</span><br><span class="line">        acc != <span class="keyword">null</span> ? acc : AccessController.getContext();</span><br><span class="line">    <span class="comment">//ä¼ å…¥çš„Runnableæ¥å£</span></span><br><span class="line">    <span class="keyword">this</span>.target = target;</span><br><span class="line">    setPriority(priority);</span><br><span class="line">    <span class="keyword">if</span> (inheritThreadLocals && parent.inheritableThreadLocals != <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">this</span>.inheritableThreadLocals =</span><br><span class="line">        ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);</span><br><span class="line">    <span class="comment">/* Stash the specified stack size in case the VM cares */</span></span><br><span class="line">    <span class="keyword">this</span>.stackSize = stackSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Set thread ID */</span></span><br><span class="line">    tid = nextThreadID();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>â‘  åˆ›å»ºçš„çº¿ç¨‹ä¼šç»§æ‰¿çˆ¶çº¿ç¨‹çš„ä¸€äº›å±æ€§ï¼Œæ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ ï¼Œå’Œä¼˜å…ˆçº§ã€‚</p><p>â‘¡ä½¿ç”¨Thread(Runnable r)åˆ›å»ºçº¿ç¨‹æ—¶<code>this.target = target</code>ä¼ å…¥çš„<code>Runnable</code>æ¥å£åœ¨è¿™é‡Œèµ‹å€¼ç„¶åä¼šåœ¨<code>runæ–¹æ³•</code>ä¸­è¢«è°ƒç”¨ã€‚</p><p>â‘¢<code>stacksize</code>è¿™ä¸ªå‚æ•°ä¼šå½±å“<code>è™šæ‹Ÿæœºæ ˆ</code>çš„å¤§å°ï¼Œè¿™ä¸ªå€¼è¶Šå¤§èƒ½å­˜æ”¾çš„<code>æ ˆå¸§</code>å°±è¶Šå¤šï¼Œå¯è¾¾åˆ°çš„é€’å½’æ·±åº¦è¶Šæ·±ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°ä¸ä¸€å®šæœ‰æ•ˆï¼Œæœ‰çš„å¹³å°å¯èƒ½å¹¶æ²¡æœ‰æ•ˆæœï¼Œå…·ä½“çš„<code>JVM</code>åº•å±‚çš„çŸ¥è¯†ç­‰åé¢å­¦åˆ°å†æ¥ç»†åŒ–</p><p>â‘£ä¸€ç§å¥‡æ€ªçš„å†™æ³•ï¼Œè¿™é‡Œåªä¼šæ‰§è¡Œé‡å†™<code>Thread</code>çš„<code>run</code>æ–¹æ³•ï¼Œè¿™é‡Œä»æºç ä¸Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¼ é€’<code>Runnable</code>æ¥å£å…¶å®æ˜¯åœ¨Threadçš„runæ–¹æ³•ä¸­è°ƒç”¨äº†<code>target</code>çš„<code>run</code>æ–¹æ³•ï¼Œå¦‚æœåŒæ—¶å†<code>ç»§æ‰¿</code>Threadç±»ï¼Œé‡å†™<code>run</code>æ–¹æ³•ï¼Œè°ƒç”¨çš„å°±ä¸å†æ˜¯Threadç±»çš„runæ–¹æ³•ï¼Œè€Œæ˜¯åŒ¿åThreadå­ç±»é‡å†™çš„runæ–¹æ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Thread t = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">    System.out.println(<span class="string">"Runnable"</span>);</span><br><span class="line">}) {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"Thread"</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure></div><p>â‘£çº¿ç¨‹<code>tid</code>é€šè¿‡<code>threadSeqNumber</code>ä»0è‡ªå¢çš„æ¥ï¼Œmainçº¿ç¨‹æ˜¯ç¬¬<code>10</code>ä¸ªçº¿ç¨‹å› ä¸ºä¼šæœ‰ä¸€äº›å®ˆæŠ¤çº¿ç¨‹ä¼šåœ¨mainå¯åŠ¨å‰å¯åŠ¨.</p><h2 id="5-å®ˆæŠ¤çº¿ç¨‹"><a href="#5-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="5.å®ˆæŠ¤çº¿ç¨‹"></a>5.å®ˆæŠ¤çº¿ç¨‹</h2><p>Javaä¸­æœ‰ä¸¤ç§çº¿ç¨‹ï¼Œä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå¦ä¸€ç§æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</p><p>ç”¨æˆ·çº¿ç¨‹æ˜¯æŒ‡ç”¨æˆ·è‡ªå®šä¹‰åˆ›å»ºçš„çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹åœæ­¢ï¼Œç”¨æˆ·çº¿ç¨‹ä¸ä¼šåœæ­¢</p><ul><li>å®ˆæŠ¤çº¿ç¨‹é¡¾åæ€ä¹‰å½“çˆ¶çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šè¢«åœæ­¢ã€‚</li><li>JVMåªæœ‰åœ¨æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹ç»“æŸåæ‰ä¼šé€€å‡º</li><li>åœ¨çº¿ç¨‹startå‰<code>setDaemon(true)</code>æ–¹æ³•è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™</li><li>çˆ¶çº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå­çº¿ç¨‹é»˜è®¤æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Daemon</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">500</span>;i++) {</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonDemo</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span> </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getPriority());</span><br><span class="line">        Thread r1=<span class="keyword">new</span> Thread(<span class="keyword">new</span> Daemon(),<span class="string">"åå°çº¿ç¨‹"</span>);     <span class="comment">//è®¾ç½®è¯¥çº¿ç¨‹ä¸ºåå°çº¿ç¨‹</span></span><br><span class="line">        r1.setDaemon(<span class="keyword">true</span>);                        <span class="comment">//å‰å°çº¿ç¨‹æŒ‚æ‰åï¼Œåå°çº¿ç¨‹å°±ä¼šæŒ‚æ‰</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<<span class="number">50</span>;i++) {                   </span><br><span class="line">            System.out.println(<span class="string">"main"</span>+i);</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">10</span>) {</span><br><span class="line">                r1.start();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p><code>å¿ƒè·³æ£€æµ‹</code>ï¼Œåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¼šéœ€è¦åˆ¤æ–­å¯¹æ–¹æ˜¯å¦åœ¨çº¿ï¼Œä¼šéœ€è¦åˆ›å»ºä¸€æ¡çº¿ç¨‹å»åšè¿™äº›äº‹æƒ…ï¼Œä½†æ˜¯å¦‚æœè¿™æ ·ä¼šå¯¼è‡´<code>ä¸»çº¿ç¨‹åœæ­¢å·¥ä½œ</code>äº†ï¼Œä½†æ˜¯æ£€æµ‹å¿ƒè·³çš„çº¿ç¨‹ä»ç„¶åœ¨ç»§ç»­å·¥ä½œï¼ŒJVMå°±æ— æ³•åœä¸‹æ¥ï¼Œæ˜¾ç„¶è¿™æ ·æ—¶ä¸åˆç†çš„ï¼Œè¿™æ—¶å°±å¯ä»¥æŠŠæ£€æµ‹å¿ƒè·³çš„çº¿ç¨‹è®¾ç½®ä¸º<code>å®ˆæŠ¤çº¿ç¨‹</code>ï¼Œè¿™æ ·å½“å®ƒä¸»çº¿ç¨‹åœæ­¢å·¥ä½œæ—¶å®ƒçš„å®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šéšä¹‹åœæ­¢ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å¿ƒè·³æ£€æµ‹MOCK</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            Thread inThread = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    System.out.println(<span class="string">"start heart check"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        Thread.sleep(<span class="number">1_00</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">            <span class="comment">//å°†å­çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">            inThread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">            inThread.start();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">1_000</span>);</span><br><span class="line">                System.err.println(<span class="string">"Thread finish done..."</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">//ä¸»çº¿ç¨‹(main)-->t-->inThread</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div><h2 id="6-çº¿ç¨‹çš„çŠ¶æ€"><a href="#6-çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="6.çº¿ç¨‹çš„çŠ¶æ€"></a>6.çº¿ç¨‹çš„çŠ¶æ€</h2><p>çº¿ç¨‹ä»åˆ›å»ºã€è¿è¡Œåˆ°ç»“æŸæ€»æ˜¯å¤„äºä¸‹é¢äº”ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼šæ–°å»ºçŠ¶æ€ã€å°±ç»ªçŠ¶æ€ã€è¿è¡ŒçŠ¶æ€ã€é˜»å¡çŠ¶æ€åŠæ­»äº¡çŠ¶æ€ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20181226/WXPYz3SiidMT.png?imageslim" src="/img/loading.gif" class="lazyload"></p><ul><li><p>æ–°å»ºçŠ¶æ€<br>å½“ç”¨newæ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œ ä¾‹å¦‚new Thread(r)ï¼Œçº¿ç¨‹è¿˜æ²¡æœ‰å¼€å§‹è¿è¡Œï¼Œæ­¤æ—¶çº¿ç¨‹å¤„åœ¨æ–°å»ºçŠ¶æ€ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹å¤„äºæ–°ç”ŸçŠ¶æ€æ—¶ï¼Œç¨‹åºè¿˜æ²¡æœ‰å¼€å§‹è¿è¡Œçº¿ç¨‹ä¸­çš„ä»£ç </p></li><li><p>å°±ç»ªçŠ¶æ€<br>ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹å¹¶ä¸è‡ªåŠ¨å¼€å§‹è¿è¡Œï¼Œè¦æ‰§è¡Œçº¿ç¨‹ï¼Œå¿…é¡»è°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•ã€‚å½“çº¿ç¨‹å¯¹è±¡è°ƒç”¨start()æ–¹æ³•å³å¯åŠ¨äº†çº¿ç¨‹ï¼Œstart()æ–¹æ³•åˆ›å»ºçº¿ç¨‹è¿è¡Œçš„ç³»ç»Ÿèµ„æºï¼Œå¹¶è°ƒåº¦çº¿ç¨‹è¿è¡Œrun()æ–¹æ³•ã€‚å½“start()æ–¹æ³•è¿”å›åï¼Œçº¿ç¨‹å°±å¤„äºå°±ç»ªçŠ¶æ€ã€‚<br>å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹å¹¶ä¸ä¸€å®šç«‹å³è¿è¡Œrun()æ–¹æ³•ï¼Œçº¿ç¨‹è¿˜å¿…é¡»åŒå…¶ä»–çº¿ç¨‹ç«äº‰CPUæ—¶é—´ï¼Œåªæœ‰è·å¾—CPUæ—¶é—´æ‰å¯ä»¥è¿è¡Œçº¿ç¨‹ã€‚å› ä¸ºåœ¨å•CPUçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œä¸å¯èƒ½åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªæ—¶åˆ»ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å› æ­¤æ­¤æ—¶å¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€ã€‚å¯¹å¤šä¸ªå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹æ˜¯ç”±<code>Java</code>è¿è¡Œæ—¶ç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ç¨‹åº(<em>thread scheduler</em>)æ¥è°ƒåº¦çš„ã€‚</p></li><li><p>è¿è¡ŒçŠ¶æ€<br>å½“çº¿ç¨‹è·å¾—CPUæ—¶é—´åï¼Œå®ƒæ‰è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼ŒçœŸæ­£å¼€å§‹æ‰§è¡Œrun()æ–¹æ³•.</p></li><li><p>é˜»å¡çŠ¶æ€<br>çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ç”±äºå„ç§åŸå› è¿›å…¥é˜»å¡çŠ¶æ€:<br>1>çº¿ç¨‹é€šè¿‡è°ƒç”¨sleepæ–¹æ³•è¿›å…¥ç¡çœ çŠ¶æ€ï¼›<br>2>çº¿ç¨‹è°ƒç”¨ä¸€ä¸ªåœ¨I/Oä¸Šè¢«é˜»å¡çš„æ“ä½œï¼Œå³è¯¥æ“ä½œåœ¨è¾“å…¥è¾“å‡ºæ“ä½œå®Œæˆä¹‹å‰ä¸ä¼šè¿”å›åˆ°å®ƒçš„è°ƒç”¨è€…ï¼›<br>3>çº¿ç¨‹è¯•å›¾å¾—åˆ°ä¸€ä¸ªé”ï¼Œè€Œè¯¥é”æ­£è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼›<br>4>çº¿ç¨‹åœ¨ç­‰å¾…æŸä¸ªè§¦å‘æ¡ä»¶ï¼›</p></li><li><p>æ­»äº¡çŠ¶æ€</p><p>æœ‰ä¸¤ä¸ªåŸå› ä¼šå¯¼è‡´çº¿ç¨‹æ­»äº¡ï¼š</p><p>1) runæ–¹æ³•æ­£å¸¸é€€å‡ºè€Œè‡ªç„¶æ­»äº¡ï¼Œ</p><p>2) ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†runæ–¹æ³•è€Œä½¿çº¿ç¨‹çŒæ­»ã€‚ ä¸ºäº†ç¡®å®šçº¿ç¨‹åœ¨å½“å‰æ˜¯å¦å­˜æ´»ç€ï¼ˆå°±æ˜¯è¦ä¹ˆæ˜¯å¯è¿è¡Œçš„ï¼Œè¦ä¹ˆæ˜¯è¢«é˜»å¡äº†ï¼‰ï¼Œéœ€è¦ä½¿ç”¨<code>isAlive</code>æ–¹æ³•ã€‚å¦‚æœæ˜¯å¯è¿è¡Œæˆ–è¢«é˜»å¡ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›trueï¼› å¦‚æœçº¿ç¨‹ä»æ—§æ˜¯newçŠ¶æ€ä¸”ä¸æ˜¯å¯è¿è¡Œçš„ï¼Œ æˆ–è€…çº¿ç¨‹æ­»äº¡äº†ï¼Œåˆ™è¿”å›false.</p></li></ul><h2 id="7-join-æ–¹æ³•"><a href="#7-join-æ–¹æ³•" class="headerlink" title="7.join()æ–¹æ³•"></a>7.join()æ–¹æ³•</h2><h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">join</span><span class="params">(<span class="keyword">long</span> millis)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">       <span class="keyword">long</span> base = System.currentTimeMillis();</span><br><span class="line">       <span class="keyword">long</span> now = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span> (millis < <span class="number">0</span>) {</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"timeout value is negative"</span>);</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">if</span> (millis == <span class="number">0</span>) {</span><br><span class="line">           <span class="keyword">while</span> (isAlive()) {</span><br><span class="line">               wait(<span class="number">0</span>);</span><br><span class="line">           }</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">           <span class="keyword">while</span> (isAlive()) {</span><br><span class="line">               <span class="keyword">long</span> delay = millis - now;</span><br><span class="line">               <span class="keyword">if</span> (delay <= <span class="number">0</span>) {</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               }</span><br><span class="line">               wait(delay);</span><br><span class="line">               now = System.currentTimeMillis() - base;</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div><p>â‘ <code>thread.join()</code>æ²¡æœ‰å‚æ•°ä¼šé»˜è®¤è°ƒç”¨<code>join(0)</code>ç„¶åå›è½®è¯¢æ£€æŸ¥è°ƒç”¨<code>join()</code>çš„çº¿ç¨‹ä¹Ÿå°±æ˜¯æ˜¯<code>thread</code>çº¿ç¨‹æ˜¯å¦<code>isAlive()</code>å¦‚æœthreadä¾ç„¶å­˜æ´»å°±å›é‡Šæ”¾<code>å½“å‰çº¿ç¨‹</code>çš„CPUæ‰§è¡Œæƒï¼Œç„¶åç»§ç»­è½®è¯¢ï¼ŒçŸ¥é“<code>thread</code>è¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚</p><p>â‘¡<code>join(long millis)</code> å‚æ•°çš„ä½œç”¨å°±æ˜¯å½“å‰çº¿ç¨‹æœ€å¤šç­‰å¾…æ—¶é—´ï¼Œé™æ—¶ç­‰å¾…ï¼Œé¿å…æ— æ­¢å¢ƒçš„ç­‰å¾…ã€‚</p><p>â‘¢ä¸€ä¸ªçº¿ç¨‹è‡ªå·±è°ƒç”¨è‡ªå·±çš„<code>join</code>æ–¹æ³•è¯¥çº¿ç¨‹å°±å›ä¸€ç›´<code>wait</code>ä¸‹å»å› ä¸ºä»–è‡ªå·±è¦ä¸€ç›´ç­‰è‡ªå·±ğŸ˜„</p><h3 id="åº”ç”¨åœºæ™¯-1"><a href="#åº”ç”¨åœºæ™¯-1" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><blockquote><p> å¤šçº¿ç¨‹åŒæ—¶é‡‡é›†æ•°æ®ï¼Œæœ€åå°†ç»Ÿè®¡çš„æ€»æ—¶é—´ç­‰ä¿¡æ¯å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¦‚æœä¸jionå°±æ— æ³•ç»Ÿä¸€ç»“æŸçš„æ—¶é—´</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadJoin3</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">long</span> l1 = System.currentTimeMillis();</span><br><span class="line">        Thread t0 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> CaptureMachine(<span class="string">"M0"</span>, <span class="number">1000</span>));</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> CaptureMachine(<span class="string">"M1"</span>, <span class="number">2000</span>));</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> CaptureMachine(<span class="string">"M2"</span>, <span class="number">4000</span>));</span><br><span class="line">        t0.start();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        <span class="comment">//è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ç»“æŸç„¶åç»Ÿè®¡æœ€åæ€»ä½“ç»“æŸçš„æ—¶é—´</span></span><br><span class="line">        t0.join();</span><br><span class="line">        t1.join();</span><br><span class="line">        t2.join();</span><br><span class="line">        <span class="keyword">long</span> l = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"end save begin timestamp:"</span> + l1 + <span class="string">"end timestamp"</span> + l);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CaptureMachine</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> String machineId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> spentTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CaptureMachine</span><span class="params">(String machineId, <span class="keyword">long</span> spentTime)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.machineId = machineId;</span><br><span class="line">        <span class="keyword">this</span>.spentTime = spentTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(spentTime);</span><br><span class="line">            System.out.println(machineId + <span class="string">" capture done"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="8-ä¼˜å…ˆçº§"><a href="#8-ä¼˜å…ˆçº§" class="headerlink" title="8.ä¼˜å…ˆçº§"></a>8.ä¼˜å…ˆçº§</h2><p>ç°ä»£æ“ä½œç³»ç»ŸåŸºæœ¬é‡‡ç”¨æ—¶åˆ†çš„å½¢å¼è°ƒåº¦è¿è¡Œçš„çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ†é…å¾—åˆ°çš„æ—¶é—´ç‰‡çš„å¤šå°‘å†³å®šäº†çº¿ç¨‹ä½¿ç”¨å¤„ç†å™¨èµ„æºçš„å¤šå°‘ï¼Œä¹Ÿå¯¹åº”äº†çº¿ç¨‹ä¼˜å…ˆçº§è¿™ä¸ªæ¦‚å¿µã€‚åœ¨JAVAçº¿ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªint priorityæ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼ŒèŒƒå›´ä¸º1-10ï¼Œå…¶ä¸­10æœ€é«˜ï¼Œé»˜è®¤å€¼ä¸º5ã€‚ä¸‹é¢æ˜¯Demoï¼ˆåŸºäº1.8ï¼‰ä¸­å…³äºpriorityçš„ä¸€äº›é‡å’Œæ–¹æ³•ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadSimpleAPI2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread t0 = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">1000</span>; i++) {</span><br><span class="line">                Optional.of(Thread.currentThread().getName() + <span class="string">"-index"</span> + i).ifPresent(System.out::println);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        t0.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">1000</span>; i++) {</span><br><span class="line">                Optional.of(Thread.currentThread().getName() + <span class="string">"-index"</span> + i).ifPresent(System.out::println);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        t1.setPriority(Thread.NORM_PRIORITY);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">1000</span>; i++) {</span><br><span class="line">                Optional.of(Thread.currentThread().getName() + <span class="string">"-index"</span> + i).ifPresent(System.out::println);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        t2.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line">        t0.start();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="9-Interruptæ–¹æ³•"><a href="#9-Interruptæ–¹æ³•" class="headerlink" title="9.Interruptæ–¹æ³•"></a>9.Interruptæ–¹æ³•</h2><h3 id="çœ‹çœ‹æºç "><a href="#çœ‹çœ‹æºç " class="headerlink" title="çœ‹çœ‹æºç "></a>çœ‹çœ‹æºç </h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interrupt</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != Thread.currentThread())</span><br><span class="line">            checkAccess();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (blockerLock) {</span><br><span class="line">            Interruptible b = blocker;</span><br><span class="line">            <span class="keyword">if</span> (b != <span class="keyword">null</span>) {</span><br><span class="line">                interrupt0();           <span class="comment">// Just to set the interrupt flag</span></span><br><span class="line">                b.interrupt(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        interrupt0();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åœ¨çŸ¥ä¹ä¸Šçœ‹è§ä¸€ä¸ªå¥½çš„å›ç­”ï¼šé¦–å…ˆï¼Œä¸€ä¸ªçº¿ç¨‹ä¸åº”è¯¥ç”±å…¶ä»–çº¿ç¨‹æ¥å¼ºåˆ¶ä¸­æ–­æˆ–åœæ­¢ï¼Œè€Œæ˜¯åº”è¯¥ç”±çº¿ç¨‹è‡ªå·±<code>è‡ªè¡Œåœæ­¢</code>ã€‚æ‰€ä»¥ï¼Œ<code>Thread.stop()</code> ,<code>Thread.suspend()</code>,<code>Thread.resume()</code>éƒ½å·²ç»è¢«åºŸå¼ƒäº†ã€‚è€Œ<code>Thread.interrupt()</code>çš„ä½œç”¨ä¹Ÿä¸æ˜¯ä¸­æ–­çº¿ç¨‹ï¼Œ<em>è€Œæ˜¯é€šçŸ¥çº¿ç¨‹è¯¥ç»“æŸäº†</em> å…·ä½“ä¸­æ–­è¿˜æ˜¯ç»§ç»­è¿è¡Œè¿˜æ˜¯ç”±è¢«é€šçŸ¥çš„çº¿ç¨‹è‡ªå·±å¤„ç†ã€‚å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨<code>interrupt()</code>æ—¶</p><p>â‘ å¦‚æœçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€(sleep,wait,joinç­‰)ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†<del>ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€</del>å¹¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸(2019.8.10 fix)</p><blockquote><p>è¿™é‡Œå…¶å®æ˜¯æœ‰ç‚¹é—®é¢˜çš„ï¼Œåœ¨æœ‰åŒæ­¥é”å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¸€å®šä¼šç«‹å³é€€å‡ºè¢«é˜»å¡çš„çŠ¶æ€ï¼Œå³ä½¿æŠ›å‡ºå¼‚å¸¸ä¹Ÿè¦ç­‰åˆ°å†æ¬¡æ‹¿åˆ°é”ä¹‹åæ‰èƒ½æŠ›å‡ºï¼ŒåŒæ—¶ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„é˜»å¡æ“ä½œéƒ½ä¼šå“åº”ä¸­æ–­ä¿¡å·ï¼Œæ¯”å¦‚IOæ“ä½œä¹‹ç±»çš„éƒ½ä¸ä¼šå“åº”ä¸­æ–­ä¿¡å·</p></blockquote><p><strong>éªŒè¯Demo</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitNotify</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">synchronized</span> (object) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹1 è·å–åˆ°ç›‘è§†å™¨é”"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        object.wait();</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹1 æ¢å¤å•¦ã€‚æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆä¹…æ‰æ¢å¤ï¼Œå› ä¸ºnotifyæ–¹æ³•è™½ç„¶æ—©å°±å‘ç”Ÿäº†ï¼Œå¯æ˜¯æˆ‘è¿˜è¦è·å–é”æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚"</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹1 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸ï¼Œå³ä½¿æ˜¯å¼‚å¸¸ï¼Œæˆ‘ä¹Ÿæ˜¯è¦è·å–åˆ°ç›‘è§†å™¨é”äº†æ‰ä¼šæŠ›å‡º"</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹1"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">synchronized</span> (object) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹2 æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºçº¿ç¨‹1 åœ¨ wait æ–¹æ³•çš„æ—¶å€™ä¼šè‡ªåŠ¨é‡Šæ”¾é”"</span>);</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹2 è®¾ç½®çº¿ç¨‹1 ä¸­æ–­"</span>);</span><br><span class="line">                    thread1.interrupt();</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹2 æ‰§è¡Œå®Œäº† ä¸­æ–­ï¼Œå…ˆä¼‘æ¯3ç§’å†è¯´ã€‚"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹2 ä¼‘æ¯å®Œå•¦ã€‚æ³¨æ„äº†ï¼Œè°ƒsleepæ–¹æ³•å’Œwaitæ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸ä¼šé‡Šæ”¾ç›‘è§†å™¨é”"</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line"></span><br><span class="line">                    }</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹2 ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸæ“ä½œ"</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹2"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>â‘¡å¦‚æœçº¿ç¨‹å¤„äºæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„<code>ä¸­æ–­æ ‡å¿—ä½</code>è®¾ç½®ä¸ºtrueï¼Œä»…æ­¤è€Œå·²ï¼Œè¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œä¸å—å½±å“ã€‚</p><p>â‘¢å¯¹å·²ç»ç»“æŸçš„çº¿ç¨‹è°ƒç”¨<code>interupt</code>æ²¡æœ‰ä»»ä½•æ•ˆæœ</p><p>ä¸Šé¢åªæ˜¯ç®€å•çš„åˆ†æï¼Œå…¶å®æƒ…å†µè¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œåé¢å†æ¥æ€»ç»“</p><p><strong>å…·ä½“çš„å°æ¡ˆä¾‹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadInterrup2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread main=Thread.currentThread();</span><br><span class="line"></span><br><span class="line">        Thread t=<span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        t.start();</span><br><span class="line"></span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//t.interrupt(); è¿™é‡Œæ‰“æ–­çš„æ˜¯tçº¿ç¨‹ä½†æ˜¯é˜»å¡çš„æ˜¯mainçº¿ç¨‹æ‰€ä»¥æ‰“æ–­ä¸äº†ï¼Œæ•è·ä¸åˆ°å¼‚å¸¸</span></span><br><span class="line">            main.interrupt();</span><br><span class="line">            System.out.println(<span class="string">"æ‰“æ–­ main çº¿ç¨‹"</span>);</span><br><span class="line">        });</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//è¿™é‡Œé˜»å¡çš„æ˜¯mainçº¿ç¨‹</span></span><br><span class="line">            t.join();</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>çœ‹æ‡‚è¿™ä¸ªå°æ¡ˆä¾‹åº”è¯¥å°±ç†è§£interruptäº†ã€‚</p><h3 id="å¦‚ä½•ä¼˜é›…çš„ç»“æŸçº¿ç¨‹"><a href="#å¦‚ä½•ä¼˜é›…çš„ç»“æŸçº¿ç¨‹" class="headerlink" title="å¦‚ä½•ä¼˜é›…çš„ç»“æŸçº¿ç¨‹"></a>å¦‚ä½•ä¼˜é›…çš„ç»“æŸçº¿ç¨‹</h3><p><strong>1. ä½¿ç”¨â€œå¼€å…³â€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadCloseGraceful</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        Worker worker=<span class="keyword">new</span> Worker();</span><br><span class="line">        worker.start();</span><br><span class="line">        Thread.sleep(<span class="number">10000</span>); <span class="comment">//ç­‰å¾…10s</span></span><br><span class="line">        worker.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>{</span><br><span class="line">    <span class="comment">//ä¼˜é›…çš„åœæ­¢çº¿ç¨‹-----å¼€å…³</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> start = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (start){</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.start=<span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>ä¸ºäº†åŠæ—¶çš„æ„ŸçŸ¥åˆ°å¼€å…³çš„å˜åŒ– startéœ€è¦å£°æ˜ä¸º volatileï¼ˆåé¢è®²Volatileçš„æ—¶å€™ä¼šè¯´åˆ°ï¼‰</p></blockquote><p><strong>2. è½®è¯¢ä¸­æ–­æ ‡å¿—ä½</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadCloseGraceful2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        Worker2 worker2 = <span class="keyword">new</span> Worker2();</span><br><span class="line">        worker2.start();</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        worker2.interrupt();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Worker2</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>{</span><br><span class="line">    <span class="comment">//ä¼˜é›…çš„åœæ­¢çº¿ç¨‹2-----æ‰“æ–­</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line">            <span class="comment">/*try {</span></span><br><span class="line"><span class="comment">                Thread.sleep(1);</span></span><br><span class="line"><span class="comment">            } catch (InterruptedException e) {</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">                break; //return ä¼šç›´æ¥é€€å‡º</span></span><br><span class="line"><span class="comment">            }*/</span></span><br><span class="line">            <span class="comment">//ä»£ç æœ‰å¯èƒ½åœ¨æ‰§è¡ŒisInterruptedä¹‹å‰å°±Blockäº†</span></span><br><span class="line">            <span class="keyword">if</span>(isInterrupted()){</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//-----------</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>3. åˆ©ç”¨å®ˆæŠ¤çº¿ç¨‹</strong></p><p>ä¸Šé¢çš„ä»£ç å·²ç»æåˆ°äº†ï¼Œæœ‰å¯èƒ½åœ¨è½®è¯¢<code>å¼€å…³</code> æˆ–è€… è½®è¯¢<code>ä¸­æ–­æ ‡å¿—ä½</code>ä¹‹å‰å°±å µå¡äº†ï¼Œè¿™æ—¶ä¹Ÿä¸èƒ½ä¸€ç›´ç­‰è¯¥ä¸‹å»æ‰€ä»¥å°±éœ€è¦å¼ºåˆ¶ç»“æŸçº¿ç¨‹çš„æ–¹æ³•ï¼Œ<code>ï¼ˆå½“ç„¶ä¸ä¼šæ˜¯stopï¼‰</code> è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨å®ˆæŠ¤çº¿ç¨‹çš„ç‰¹æ€§å»å®Œæˆè¿™ä»¶äº‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadService</span> </span>{</span><br><span class="line">    <span class="keyword">private</span>  Thread executeThread;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">volatile</span>  <span class="keyword">boolean</span> finished=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task)</span></span>{</span><br><span class="line">        executeThread =<span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="comment">//å­çº¿ç¨‹</span></span><br><span class="line">            Thread t=<span class="keyword">new</span> Thread(()->{</span><br><span class="line">                task.run();</span><br><span class="line">            });</span><br><span class="line">            t.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">            t.start();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                t.join(); <span class="comment">//è¿™é‡Œé˜»å¡çš„æ˜¯executeThread</span></span><br><span class="line">                finished=<span class="keyword">true</span>;</span><br><span class="line">                <span class="comment">//åˆ°è¿™é‡Œè¯´æ˜executeThreadå·²ç»ä¸é˜»å¡äº†,å­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œäº†ï¼Œæ²¡æœ‰è¶…æ—¶</span></span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                System.out.println(<span class="string">"TLEï¼ŒexecuteThread execution was interrupted"</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        executeThread.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">(<span class="keyword">long</span> mills)</span></span>{</span><br><span class="line">        <span class="keyword">long</span> base=System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">while</span> (!finished){ <span class="comment">//è½®è¯¢æ£€æŸ¥æ ‡å¿—ä½ï¼Œçœ‹æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">            <span class="keyword">if</span>(System.currentTimeMillis()-base>=mills){</span><br><span class="line">                <span class="comment">//è¶…æ—¶äº†æ²¡æœ‰å®Œæˆ</span></span><br><span class="line">                System.out.println(<span class="string">"TLE, will end it now"</span>);</span><br><span class="line">                executeThread.interrupt(); <span class="comment">//æ‰“æ–­executeThread</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æ²¡è¶…æ—¶</span></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                executeThread.sleep(<span class="number">10</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                System.out.println(<span class="string">"executeThread was interrupted when shutdown"</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ ‡å¿—ä½å¤åŸ</span></span><br><span class="line">        finished=<span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å°†å¾…æ‰§è¡Œçš„<code>task</code>ä¼ é€’åˆ°<code>ThreadService</code>ä¸­ç„¶åä¼šåˆ›å»ºä¸€ä¸ª<code>executeThread</code>çš„çº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œ<code>task</code>çš„<code>run</code>æ–¹æ³•ç„¶åå°†å­çº¿ç¨‹è®¾ç½®ä¸º<code>executeThread</code>çš„å®ˆæŠ¤çº¿ç¨‹ç„¶å<code>join</code>é˜»å¡<code>executeThread</code>çº¿ç¨‹ï¼ŒåŒæ—¶ä¼šè°ƒç”¨<code>ThreadService</code>çš„<code>shutdown</code>æ–¹æ³•ä¼ å…¥ä¸€ä¸ªæœ€é•¿ç­‰å¾…æ—¶é—´ç„¶å<code>è½®è¯¢æ ‡å¿—ä½</code>æ£€æŸ¥æ˜¯å¦ç»“æŸï¼Œå¦‚æœè¶…æ—¶å°±ä¼šæ‰“æ–­<code>executeThread</code>è¿›è€Œç»“æŸ<code>executeThread</code>çš„å­çº¿ç¨‹ä¹Ÿå°±æ˜¯<code>task</code></p><h3 id="Thread-interrupted"><a href="#Thread-interrupted" class="headerlink" title="Thread.interrupted()"></a>Thread.interrupted()</h3><p>è¿™ä¸ªæ–¹æ³•å’Œ<code>isInterrupt()</code>ç±»ä¼¼ä½†æ˜¯ä»–ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ä¸º<code>false</code>æ–¹ä¾¿ä¹‹åçš„ä¸­æ–­æ“ä½œè€Œä¸”è¿™ä¸ªæ˜¯<code>é™æ€æ–¹æ³•</code>ï¼Œæ‰€ä»¥ä½ ç”¨çº¿ç¨‹å®ä¾‹å»è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå®ƒè¿™é‡Œæ˜¯ç”¨æ¥åˆ¤æ–­<strong>å½“å‰æ‰§è¡Œçº¿ç¨‹</strong>æ˜¯å¦ <code>interrupt</code> ï¼Œå¹¶ä¸”è®¾ç½®ä¸­æ–­æ ‡å¿—ä½ä¸º<code>false</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">html</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Tests whether the current thread has been interrupted.  The</span><br><span class="line"> * <span class="tag"><<span class="name">i</span>></span>interrupted status<span class="tag"><!--<span class="name"-->i</span>></span> of the thread is cleared by this method.  In<br><span class="line"> * other words, if this method were to be called twice in succession, the</span><br><span class="line"> * second call would return false (unless the current thread were</span><br><span class="line"> * interrupted again, after the first call had cleared its interrupted</span><br><span class="line"> * status and before the second call had examined it).</span><br><span class="line"> *</span><br><span class="line"> * <span class="tag"><<span class="name">p</span>></span>A thread interruption ignored because a thread was not alive</span><br><span class="line"> * at the time of the interrupt will be reflected by this method</span><br><span class="line"> * returning false.</span><br><span class="line"> *</span><br><span class="line"> * @return  <span class="tag"><<span class="name">code</span>></span>true<span class="tag"><!--<span class="name"-->code</span>></span> if the current thread has been interrupted;<br><span class="line"> *          <span class="tag"><<span class="name">code</span>></span>false<span class="tag"><!--<span class="name"-->code</span>></span> otherwise.<br><span class="line"> * @see #isInterrupted()</span><br><span class="line"> * @revised 6.0</span><br><span class="line"> */</span><br></pre></td></tr></tbody></table></figure></div><p>åŒæ—¶åœ¨æŠ›å‡º<code>InterruptedException</code> ä¹‹åä¸­æ–­çŠ¶æ€ä¹Ÿä¼šè¢«è‡ªåŠ¨æ¸…é™¤ä¸ºfalse</p><blockquote><p>if any thread has interrupted the current thread. The <i>interrupted status</i> of the current thread is cleared when this exception is thrown.     â€”-Thread.sleepæ³¨é‡Š</p></blockquote><h2 id="10-Yieldæ–¹æ³•"><a href="#10-Yieldæ–¹æ³•" class="headerlink" title="10.Yieldæ–¹æ³•"></a>10.Yieldæ–¹æ³•</h2><p>Thread.yield()æ–¹æ³•çš„ä½œç”¨ï¼šæš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚ï¼ˆå¯èƒ½æ²¡æœ‰æ•ˆæœï¼‰<br>yield()è®©å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å›åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä»¥å…è®¸å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶ä»–çº¿ç¨‹è·å¾—è¿è¡Œçš„æœºä¼šã€‚å› æ­¤ï¼Œä½¿ç”¨yield()çš„ç›®çš„æ˜¯è®©å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹‹é—´èƒ½å¤Ÿé€‚å½“çš„è½®æ¢æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå®é™…ä¸­æ— æ³•ä¿è¯yield()è¾¾åˆ°è®©æ­¥çš„ç›®çš„ï¼Œå› ä¸ºï¼Œè®©æ­¥çš„çº¿ç¨‹å¯èƒ½è¢«çº¿ç¨‹è°ƒåº¦ç¨‹åºå†æ¬¡é€‰ä¸­ã€‚<br>ç»“è®ºï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œyield()å°†å¯¼è‡´çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä½†æœ‰å¯èƒ½æ²¡æœ‰æ•ˆæœã€‚</p><h2 id="11-Synchronizedå…³é”®å­—"><a href="#11-Synchronizedå…³é”®å­—" class="headerlink" title="11.Synchronizedå…³é”®å­—"></a>11.Synchronizedå…³é”®å­—</h2><h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_NO = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                <span class="keyword">if</span> (index > MAX_NO) {</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    Thread.sleep(<span class="number">5</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"ç¬¬ï¼š"</span> + index++);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç”¨è¿™ä¸ªåˆ›å»ºå¤šä¸ª<code>Thread</code>ç„¶åè¿è¡Œ</p><blockquote><p>äºŒå·çª—å£ç¬¬ï¼š497<br>ä¸‰å·çª—å£ç¬¬ï¼š499<br>ä¸€å·çª—å£ç¬¬ï¼š498<br>ä¸€å·çª—å£ç¬¬ï¼š500<br>äºŒå·çª—å£ç¬¬ï¼š<code>502</code><br>ä¸‰å·çª—å£ç¬¬ï¼š<code>501</code></p></blockquote><p>å¯ä»¥çœ‹å‡ºæ‰“å°å‡ºäº†501ï¼Œ502æ˜æ˜¾ä¸å¯¹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§é—®é¢˜å‘¢ï¼Ÿå…¶å®ä»”ç»†æƒ³æƒ³ä¹Ÿå¾ˆå®¹æ˜“ç†è§£</p><p><img alt="mark" data-src="http://static.imlgw.top///20190326/zSGNeiCW2zc1.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>å½“ä¸¤ä¸ªçº¿ç¨‹å¦‚å›¾æ‰€ç¤ºçš„æƒ…å†µï¼Œ2å·çº¿ç¨‹<code>index=500</code>ç„¶å<code>index++</code>ç„¶å 1å·çº¿ç¨‹è¯»å–åˆ°<code>index</code>çš„å€¼å°±ä¼šäº§ç”Ÿè¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="åŒæ­¥ä»£ç å—"><a href="#åŒæ­¥ä»£ç å—" class="headerlink" title="åŒæ­¥ä»£ç å—"></a>åŒæ­¥ä»£ç å—</h3><p><strong>è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_NO = <span class="number">500</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object MONITOR = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">synchronized</span> (MONITOR) {</span><br><span class="line">                <span class="comment">//å•çº¿ç¨‹</span></span><br><span class="line">                <span class="keyword">if</span> (index > MAX_NO) {</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    Thread.sleep(<span class="number">5</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"ç¬¬ï¼š"</span> + index++);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åˆ©ç”¨<code>MONITOR</code>å¯¹è±¡ä½œä¸ºåŒæ­¥é”åŒæ­¥ä¹‹åçš„éƒ¨åˆ†å°±ç›¸å½“äºå•çº¿ç¨‹ï¼Œ<code>MONITOR</code>é”å¯¹è±¡ä¸€èˆ¬è®¾ç½®ä¸º<code>final</code>çš„é¿å…åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹<code>MONITOR</code>å¯¹è±¡è¿›è¡Œæ”¹å˜è€Œäº§ç”Ÿæ— æ³•é¢„æ–™çš„åæœ</p><h3 id="åŒæ­¥æ–¹æ³•"><a href="#åŒæ­¥æ–¹æ³•" class="headerlink" title="åŒæ­¥æ–¹æ³•"></a>åŒæ­¥æ–¹æ³•</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizeRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_NO = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//thisé”</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">if</span> (ticket()) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">ticket</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">//synchronized (this) {</span></span><br><span class="line">            <span class="comment">//1.getFiled</span></span><br><span class="line">            <span class="keyword">if</span> (index > MAX_NO) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">5</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// getFiled index</span></span><br><span class="line">            <span class="comment">// index=index+1</span></span><br><span class="line">            <span class="comment">// putFiled index</span></span><br><span class="line">            <span class="comment">//åŒæ­¥ä»£ç å—å°±æ˜¯ä¿æŠ¤å…±äº«æ•°æ®index, MAX_NOä¸æ˜¯,ä»–æ˜¯åªè¯»æ•°æ®</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"ç¬¬ï¼š"</span> + index++);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">       <span class="comment">// }</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é»˜è®¤åŠ çš„æ˜¯<code>this</code>é”</p><p><strong>è¯æ˜thisé”çš„å­˜åœ¨</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedThis</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ThisLock thisLock = <span class="keyword">new</span> ThisLock();</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -> thisLock.m1(), <span class="string">"Thread0"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(() -> thisLock.m2(), <span class="string">"Thread1"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(() -> thisLock.m3(), <span class="string">"Thread2"</span>);</span><br><span class="line">        thread2.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThisLock</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m1</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m2</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m3</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">            System.out.println(Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿è¡Œä¸Šé¢çš„ä»£ç ä¼šå‘ç°<code>Thread0</code>å’Œ<code>Thread2</code>ä¼šå…ˆæ‰“å°å‡ºæ¥å› ä¸ºä»–ä»¬ä¸æ˜¯åŒä¸€ä¸ªé”ä¸ç”¨ç­‰å¾…å¯¹æ–¹ï¼Œè€Œ<code>Thread1</code>ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´åæ‰ä¼šæ‰§è¡Œå› ä¸ºå®ƒéœ€è¦ç­‰å¾…<code>Thread0</code>é‡Šæ”¾é”è€Œè¿™ä¸ªé”åªèƒ½æ˜¯<code>thisé”</code></p><p><strong>è¯æ˜classé”çš„å­˜åœ¨</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedClass</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread thread0 = <span class="keyword">new</span> Thread(() -> ClassLock.m1(), <span class="string">"Thread0"</span>);</span><br><span class="line">        thread0.start();</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(() -> ClassLock.m2(), <span class="string">"Thread1"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(() -> ClassLock.m3(), <span class="string">"Thread2"</span>);</span><br><span class="line">        thread2.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassLock</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="keyword">synchronized</span> (ClassLock<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">            System.out.println(<span class="string">"static"</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m1</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m2</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m3</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">10_000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿è¡Œä¸Šé¢çš„ä»£ç ä¼šå‘ç°æœ€å¼€å§‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå»æ‰§è¡Œé™æ€ä»£ç å¿«ï¼Œåœ¨é™æ€ä»£ç å¿«æ‰§è¡Œå®Œä¹‹å<code>Thread2</code>ä¼šå’Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼Œè¯´æ˜ä¸€å¼€å§‹<code>Thread2</code>å›å’Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æŠ¢<code>Classé”</code>æ‰§è¡Œé™æ€ä»£ç å—ï¼ˆé™æ€ä»£ç å—åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼‰</p><h3 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h3><blockquote><p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŒæœ‰å¤šä¸ªé”ï¼Œè€Œè¿™æ ·å°±å¯èƒ½ä¼šå¯¼è‡´<code>æ­»é”</code>çš„äº§ç”Ÿ</p></blockquote><p><strong>æ­»é”ç¤ºä¾‹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service1</span> </span>{</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span> Object LOCK=<span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Service2 service2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">s1</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK){</span><br><span class="line">            System.out.println(<span class="string">"s1=============="</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">s2</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK){</span><br><span class="line">            System.out.println(<span class="string">"s2=============="</span>);</span><br><span class="line">            service2.m2();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setService2</span><span class="params">(Service2 service2)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.service2 = service2;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">---------------------------------------------------</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service2</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Service1 service1;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Service2</span><span class="params">(Service1 service1)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.service1 = service1;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  Object LOCK=<span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">m1</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK){</span><br><span class="line">            System.out.println(<span class="string">"m1"</span>);</span><br><span class="line">            service1.s1();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">m2</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK){</span><br><span class="line">            System.out.println(<span class="string">"m2"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">-------------------------------------------------</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLockTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Service1 service1=<span class="keyword">new</span> Service1();</span><br><span class="line">        Service2 service2 =<span class="keyword">new</span> Service2(service1);</span><br><span class="line">        service1.setService2(service2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line">                service2.m1();</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()->{</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line">                service1.s2();</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ‰§è¡Œä¸Šé¢ä»£ç å°±ä¼šå‘ç°åœ¨è¿è¡Œä¸€æ®µæ—¶é—´åä¸¤ä¸ªçº¿ç¨‹éƒ½<code>é˜»å¡</code>äº†ï¼Œè¿™å°±æ˜¯<code>æ­»é”</code></p><ul><li><code>jps</code>&<code>jstack</code>  åˆ†ææ­»é”</li></ul><p><img alt="mark" data-src="http://static.imlgw.top///20190328/BG9eU9Rq8ae0.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ä¸¤ä¸ªçº¿ç¨‹éƒ½éœ€è¦å¯¹æ–¹æ‰‹ä¸Šçš„çš„é”ï¼Œé™·å…¥åƒµæŒçŠ¶æ€ï¼Œå°±ä¼šäº§ç”Ÿæ­»é”ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>jconsole</code>å›¾å½¢åŒ–ç•Œé¢æ¥åˆ†æ</p><h2 id="12-çº¿ç¨‹é—´é€šè®¯"><a href="#12-çº¿ç¨‹é—´é€šè®¯" class="headerlink" title="12.çº¿ç¨‹é—´é€šè®¯"></a>12.çº¿ç¨‹é—´é€šè®¯</h2><p>åœ¨Javaå¹³å°ä¸­ï¼ŒObject.wait()/notify() ç­‰æ–¹æ³•å¯ç”¨äºå®ç°çº¿ç¨‹çš„ç­‰å¾…å’Œé€šçŸ¥ï¼Œwaitå°†å½“å‰çº¿ç¨‹æš‚åœç”Ÿå‘½å‘¨æœŸå˜ä¸º <strong>WAITING</strong> ï¼Œè€Œnotify() åˆ™å¯ä»¥å”¤é†’ä¸€ä¸ªè¢«æš‚åœçš„çº¿ç¨‹ä»è€Œå®ç°é€šçŸ¥ï¼Œä¸€èˆ¬æ¥è¯´wait() ä»£ç æ¨¡æ¿ç±»ä¼¼ä¸‹é¢</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(someObj){</span><br><span class="line">    <span class="keyword">while</span>(ä¿æŠ¤æ¡ä»¶ä¸æˆç«‹){</span><br><span class="line">        <span class="comment">//ç­‰å¾…</span></span><br><span class="line">        someObj.wait();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¿æŠ¤æ¡ä»¶æ»¡è¶³</span></span><br><span class="line">    doAction();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è€Œ<code>notify()</code> å¯¹åº”ä»£ç æ¨¡æ¿å¦‚ä¸‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(someObj){</span><br><span class="line">    <span class="comment">//æ›´æ–°ç­‰å¾…çº¿ç¨‹çš„ä¿æŠ¤æ¡ä»¶è®¾è®¡çš„å…±äº«å˜é‡</span></span><br><span class="line">    updateSharedDate();</span><br><span class="line">    <span class="comment">//å”¤é†’å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">    someObj,notify();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"></a>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</h3><p><strong>é”™è¯¯ç¤ºä¾‹</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProduceConsumerVersion1</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ProduceConsumerVersion1 pc = <span class="keyword">new</span> ProduceConsumerVersion1();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                pc.produce();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"Produce"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                pc.consumer();</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"Consumer"</span>).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">            System.out.println(<span class="string">"Produce->"</span> + (i++));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">            System.out.println(<span class="string">"Consumer->"</span> + (i));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§æ¨¡å‹å½“ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯åŠ¨åä¼šå‘ç°ä¸¤ä¸ªçº¿ç¨‹æ— æ³•åä½œï¼Œç”Ÿäº§è€…ä¸æ–­ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…<code>ä¸æ¶ˆè´¹</code>æˆ–è€…<code>é‡å¤æ¶ˆè´¹</code></p><p><strong>å•ç”Ÿäº§è€…&å•æ¶ˆè´¹è€…</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProduceConsumerVersion2</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ProduceConsumerVersion2 pc = <span class="keyword">new</span> ProduceConsumerVersion2();</span><br><span class="line">        Stream.of(<span class="string">"Produce1"</span>).forEach(n -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    pc.produce();</span><br><span class="line">                }</span><br><span class="line">            }, n).start();</span><br><span class="line">        });</span><br><span class="line">        Stream.of(<span class="string">"Consumer1"</span>).forEach(n -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    pc.consumer();</span><br><span class="line">                }</span><br><span class="line">            }, n).start();</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> isProduced = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">            <span class="keyword">if</span> (isProduced) {</span><br><span class="line">                <span class="comment">//å·²ç»ç”Ÿäº§äº†</span></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    LOCK.wait();<span class="comment">//ç­‰å¾…æ¶ˆè´¹è€…å”¤é†’</span></span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"-->"</span> + (++i));<span class="comment">//produce</span></span><br><span class="line">            isProduced = <span class="keyword">true</span>;</span><br><span class="line">            LOCK.notify();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">            <span class="keyword">if</span> (!isProduced) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    LOCK.wait();<span class="comment">//ç­‰å¾…ç”Ÿäº§è€…å”¤é†’</span></span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"-->"</span> + (i));<span class="comment">//consumer</span></span><br><span class="line">            isProduced = <span class="keyword">false</span>;</span><br><span class="line">            LOCK.notify();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>wait()ï¼š</strong> å½“å‰çº¿ç¨‹<code>é‡Šæ”¾é”</code>è¿›å…¥è¯¥é”å¯¹è±¡çš„<code>ç­‰å¾…é˜Ÿåˆ—</code> </p><blockquote><p>Causes the current thread to wait until another thread invokes the</p><p>{@link java.lang.Object#notify()} method or the</p><p>{@link java.lang.Object#notifyAll()} method for this object.</p><p>In other words, this method behaves exactly as if it simply</p><p>performs the call {@code <code>wait(0)</code>}.</p><p>The current thread <code>must own this object's monitor.</code> The thread</p><p><code>releases</code> ownership of this monitor and waits until another thread</p><p>notifies threads waiting on this objectâ€™s monitor to wake up</p><p>either through a call to the {@code notify} method or the</p><p>{@code notifyAll} method. The thread then waits until it can</p><p>re-obtain ownership of the monitor and resumes execution.</p></blockquote><p><strong>wait(long timeout)ï¼š</strong><code>wait()</code>çš„é‡è½½æ–¹æ³•å¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯å¹²å•¥çš„âœ”</p><blockquote><p>Causes the current thread to wait until either another thread invokes the</p><p>{@link java.lang.Object#notify()} method or the</p><p>{@link java.lang.Object#notifyAll()} method for this object, or a</p><p><code>specified amount of time has elapsed.</code></p><p>The current thread must own this objectâ€™s monitor.</p><p>@throws  <code>IllegalArgumentException</code>  if the value of timeout is negative.</p></blockquote><p><strong>notify()ï¼š</strong> å”¤é†’è¯¥<code>é”å¯¹è±¡</code>çš„<code>ç­‰å¾…é˜Ÿåˆ—</code>çš„çº¿ç¨‹ï¼Œå”¤é†’æ–¹æ³•ä¸åŒçš„è™šæ‹Ÿæœºå®ç°ä¸åŒæœ‰çš„å¯èƒ½æ˜¯<code>FCFS</code>æœ‰çš„å¯èƒ½æ˜¯<code>SJF</code> ç­‰ç­‰â€¦.æ‰€ä»¥å”¤é†’çš„æ˜¯é‚£ä¸ªçº¿ç¨‹æ˜¯æ— æ³•ç¡®å®šçš„</p><blockquote><p>Wakes up a single thread that is <code>waiting on this object's</code></p><p><code>monitor</code>. If any threads are waiting on this object, one of them</p><p>is chosen to be awakened. <code>The choice is arbitrary and occurs at</code></p><p><code>the discretion of the implementation</code>. A thread waits on an objectâ€™s</p><p>monitor by calling one of the {@code wait} methods.</p><p>The awakened thread will not be able to proceed until the current</p><p>thread <code>relinquishes</code> the lock on this object. The awakened thread will</p><p>compete in the usual manner with any other threads that might be</p><p>actively competing to synchronize on this object; for example, the</p><p>awakened thread enjoys no reliable privilege or disadvantage in being</p><p>the next thread to lock this object.</p></blockquote><p>ç”Ÿäº§è€…ç”Ÿäº§ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€ä¸ªï¼Œæ²¡æ¯›ç—…ï¼Œä½†æ˜¯ä¸Šé¢çš„ä»£ç ä»…ä»…é€‚ç”¨äº<code>å•ç”Ÿäº§è€…&æ¶ˆè´¹è€…</code>å¯¹äºå¤šä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…å°±ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå…·ä½“é—®é¢˜å¦‚ä¸‹</p><p><strong>æµ‹è¯•å¤šæ¶ˆè´¹è€…&ç”Ÿäº§è€…</strong></p><p>æ²¿ç”¨ä¸Šé¢single p&cçš„ä»£ç ï¼Œæµ‹è¯•å¤šæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    ProduceConsumerVersion3 pc = <span class="keyword">new</span> ProduceConsumerVersion3();</span><br><span class="line">    Stream.of(<span class="string">"Produce1"</span>, <span class="string">"Produce2"</span>, <span class="string">"Produce3"</span>, <span class="string">"Produce4"</span>).forEach(n -> {</span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                pc.produce();</span><br><span class="line">            }</span><br><span class="line">        }, n).start();</span><br><span class="line">    });</span><br><span class="line">    Stream.of(<span class="string">"Consumer1"</span>, <span class="string">"Consumer2"</span>, <span class="string">"Consumer3"</span>).forEach(n -> {</span><br><span class="line">        <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                pc.consumer();</span><br><span class="line">            }</span><br><span class="line">        }, n).start();</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿è¡Œä¼šå‘ç°ç¨‹åºè¿›å…¥<code>â€æ­»é”â€œ</code>çŠ¶æ€ï¼Œç”¨<code>jps&jstack</code>åˆ†æ</p><p><img alt="mark" data-src="http://static.imlgw.top///20190328/pzXBY0ertEVV.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>ç¨‹åºå¹¶æ²¡æœ‰å‘ç°æ­»é”âï¼Œè¿™å°±æ˜¯å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…ä¼šäº§ç”Ÿçš„<code>å‡æ­»</code>çŠ¶æ€ï¼Œå®é™…ä¸Šæ˜¯æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¿›å…¥äº†<code>wait()</code>çŠ¶æ€éƒ½æ”¾å¼ƒäº†<code>CPU</code>çš„æ‰§è¡Œæƒ</p><p><strong>å‡æ­»åŸå› åˆ†æ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Produce1--><span class="number">1</span>notify C1 wait</span><br><span class="line">Consumer1--><span class="number">1</span>notify P1 wait</span><br><span class="line">Produce1--><span class="number">2</span>    notify C2 wait</span><br><span class="line">Consumer2--><span class="number">2</span>   notify P2 wait</span><br><span class="line">Produce2--><span class="number">3</span>notify P1 wait ---> Produce1-->wait</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸Šé¢æ˜¯å…¶ä¸­ä¸€ç§æƒ…å†µï¼Œå¤§è‡´åˆ†æä¸‹ï¼šå‰ä¸¤æ¬¡ç”Ÿäº§æ¶ˆè´¹éƒ½æ­£å¸¸ä¸€ä¸ª<code>æ¶ˆè´¹è€…</code>å”¤é†’ä¸€ä¸ª<code>ç”Ÿäº§è€…</code>ï¼Œå‰ä¸¤æ¬¡æ‰§è¡Œå®Œä¹‹å<code>P1 C1 C2</code>éƒ½è¿›å…¥<code>wait</code>çŠ¶æ€ç„¶åç¬¬ä¸‰æ¬¡ç”Ÿäº§çš„æ—¶å€™<code>P2</code>å”¤é†’äº†ä¸€ä¸ªä¸è¯¥å”¤é†’çš„äººğŸ˜‚ å”¤é†’äº†<code>P1</code>ç„¶å<code>wait</code>äº†ï¼Œ<code>P1</code>é†’æ¥åå‘ç°å·²ç»ç”Ÿäº§äº†ç„¶åä¹Ÿ<code>wait</code>å»äº†ï¼Œè‡³æ­¤æ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨è¿›å…¥<code>wait</code>çŠ¶æ€å°±é€ æˆäº†å‡æ­»ã€‚è¿™ä¸ªé—®é¢˜è®°å¾—å¤§ä¸€çš„æ—¶å€™è¿˜é—®è¿‡è€å¸ˆå½“æ—¶ç‰¹åˆ«çº ç»“ä¸ºå•¥ä¼šæ­»é”ï¼Œç°åœ¨çœ‹çœ‹å…¶å®ä¹Ÿæ²¡å•¥ï¼Œä¸»è¦å°±æ˜¯<code>notify</code>å”¤é†’çš„çº¿ç¨‹æ˜¯ä¸ç¡®å®šçš„ï¼Œæ˜¯ç”±<code>JVM</code>å†³å®šçš„æ¯ç§<code>JDK</code>çš„å®ç°ä¹Ÿä¸å¤ªä¸€æ ·ï¼Œæ— æ³•ä¿è¯æ¶ˆè´¹è€…ä¸€å®šå”¤é†’ç”Ÿäº§è€…ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p><strong>å¤šç”Ÿäº§è€…&å¤šæ¶ˆè´¹è€…</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProduceConsumerVersion3</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ProduceConsumerVersion3 pc = <span class="keyword">new</span> ProduceConsumerVersion3();</span><br><span class="line">        Stream.of(<span class="string">"Produce1"</span>, <span class="string">"Produce2"</span>, <span class="string">"Produce3"</span>, <span class="string">"Produce4"</span>).forEach(n -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    pc.produce();</span><br><span class="line">                }</span><br><span class="line">            }, n).start();</span><br><span class="line">        });</span><br><span class="line">        Stream.of(<span class="string">"Consumer1"</span>, <span class="string">"Consumer2"</span>, <span class="string">"Consumer3"</span>).forEach(n -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    pc.consumer();</span><br><span class="line">                }</span><br><span class="line">            }, n).start();</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> isProduced = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">produce</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">            <span class="keyword">while</span> (isProduced) {</span><br><span class="line">                <span class="comment">//å·²ç»ç”Ÿäº§äº†</span></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    LOCK.wait(); <span class="comment">//åŠ å…¥LOCKé”çš„waité˜Ÿåˆ—</span></span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"-->"</span> + (++i));<span class="comment">//produce</span></span><br><span class="line">            isProduced = <span class="keyword">true</span>;</span><br><span class="line">            LOCK.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (LOCK) {</span><br><span class="line">            <span class="keyword">while</span> (!isProduced) {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    LOCK.wait();</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"-->"</span> + (i));<span class="comment">//consumer</span></span><br><span class="line">            isProduced = <span class="keyword">false</span>;</span><br><span class="line">            LOCK.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>notifyAll()ï¼š</strong>å”¤é†’å½“å‰é”å¯¹è±¡ç­‰å¾…é˜Ÿåˆ—ä¸Šçš„<code>æ‰€æœ‰</code>çº¿ç¨‹</p><blockquote><p>Wakes up <code>all threads</code> that are waiting on <code>this object's monitor</code>. A</p><p>thread waits on an objectâ€™s monitor by calling one of the</p><p>{@code wait} methods.</p><p>The awakened threads will not be able to proceed until the current</p><p>thread relinquishes the lock on this object. The awakened threads</p><p>will <code>compete in the usual manner</code> with any other threads that might</p><p>be actively competing to synchronize on this object; for example,</p><p>the awakened threads enjoy <code>no reliable privilege or disadvantage</code> in</p><p>being the next thread to lock this object.</p></blockquote><p>â‘  ä¸ºäº†è§£å†³ä¸Šé¢çš„<code>å‡æ­»</code>é—®é¢˜è¿™é‡Œä½¿ç”¨äº†<code>notifyAll()</code>æ¥å”¤é†’<code>ç­‰å¾…é˜Ÿåˆ—</code>çš„çº¿ç¨‹ï¼Œçœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ–¹æ³•ä¼šå”¤é†’æ‰€æœ‰çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆä¸Šé¢çš„å‡æ­»é—®é¢˜å°±è‡ªç„¶è§£å†³äº†ã€‚</p><p>â‘¡ è¿˜æœ‰ä¸€ç‚¹ä¸åŒçš„æ˜¯è¿™é‡Œåˆ¤æ–­ç”Ÿäº§çŠ¶æ€æ—¶ç”¨çš„æ˜¯<code>while</code>è€Œä¸æ˜¯<code>if</code>ä¸ºä»€ä¹ˆä¸ç”¨<code>if</code>? å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£å¦‚æœæœ‰å¤šä¸ªç”Ÿäº§è€…æˆ–è€…æ¶ˆè´¹è€…åŒæ—¶åœ¨<code>ç­‰å¾…é˜Ÿåˆ—</code>ä¸­ï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªæŠ¢åˆ°é”åæ‰§è¡Œï¼Œæ‰§è¡Œå®Œç”Ÿäº§åå”¤é†’äº†æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå‡è®¾å”¤é†’çš„æ˜¯<code>ç”Ÿäº§è€…</code>çš„è¯ï¼Œå› ä¸ºæ˜¯<code>ifè¯­å¥</code>æ§åˆ¶çš„è¢«å”¤é†’çš„ç”Ÿäº§è€…æŠ¢åˆ°é”ä¹‹åå°±ç›´æ¥é¡ºç€æ‰§è¡Œä¸‹å»äº†ï¼Œå°±ç›´æ¥å»ç”Ÿäº§äº†ï¼Œå°±ä¼šé€ æˆ<code>é‡å¤çš„ç”Ÿäº§</code>å½“ç„¶ç”¨<code>else</code>è¯­å¥è²Œä¼¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯é‚£ä¼šå½±å“æ•ˆç‡ï¼ˆä¸ªäººæ„Ÿè§‰ï¼‰ï¼Œè€Œä¸”å¾ˆåˆ«æ‰­ï¼ˆè¢«å”¤é†’äº†ç›´æ¥é€€å‡ºï¼Ÿï¼Ÿï¼Ÿï¼‰. æ‰€ä»¥è¿™é‡Œç”¨<code>while</code>æ¥è¿›è¡Œ<code>äºŒæ¬¡æ£€æµ‹</code>é¿å…è¿™ç§æƒ…å†µï¼Œè¿™ç§whileå¾ªç¯ä¹Ÿè¢«ç§°ä¸º<code>è‡ªæ—‹é”</code> è¿™ä¸€å—åé¢çš„æ–‡ç« ä¼šå†è¯¦ç»†çš„è®²ã€‚</p><h3 id="ä¸ºä»€ä¹ˆwaitå’Œnotifyå¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆwaitå’Œnotifyå¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆwaitå’Œnotifyå¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆwaitå’Œnotifyå¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ</h3><p>è¿™æ˜¯<code>é˜¿é‡Œå·´å·´</code>çš„ä¸€é“é¢è¯•é¢˜</p><p>â‘  é¦–å…ˆä»è¯­æ³•å±‚é¢è®²ï¼Œå¦‚æœä¸åœ¨åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—ä¸­è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åŠ é”ï¼Œè‡ªç„¶å°±ä¸ç”¨è°ˆæ˜¯ä¸æ˜¯<code>é”å¯¹è±¡çš„æŒæœ‰è€…</code> ï¼Œå°±ä¼šæŠ¥<code>IllegalMonitorStateException</code>.</p><blockquote><p>@throws  <code>IllegalMonitorStateException</code>  if the current thread is not</p><p>the owner of the objectâ€™s monitor.</p></blockquote><p>â‘¡è®¾æƒ³ä¸‹å¦‚æœä¸åŠ é”å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿæ‰€è°“çš„<code>ç«æ€æ¡ä»¶</code>ï¼Œå‡è®¾<code>wait()</code>,<code>notify()</code>,<code>notifyAll()</code>æ–¹æ³•ä¸éœ€è¦åŠ é”å°±èƒ½å¤Ÿè¢«è°ƒç”¨ã€‚æ­¤æ—¶æ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨<code>wait()</code>æ­£åœ¨è¿›å…¥çŠ¶æ€å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—(è¯‘è€…æ³¨:å¯èƒ½è¿˜æœªè¿›å…¥)ã€‚åœ¨åŒä¸€æ—¶åˆ»ï¼Œç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨<code>notify()</code>æ–¹æ³•æ‰“ç®—å‘æ¶ˆè´¹è€…çº¿ç¨‹é€šçŸ¥çŠ¶æ€æ”¹å˜ã€‚é‚£ä¹ˆæ­¤æ—¶æ¶ˆè´¹è€…çº¿ç¨‹å°†é”™è¿‡è¿™ä¸ªé€šçŸ¥å¹¶ä¸€ç›´é˜»å¡ã€‚å› æ­¤ï¼Œå¯¹è±¡çš„<code>wait()</code>,<code>notify()</code>,<code>notifyAll()</code>æ–¹æ³•å¿…é¡»åœ¨è¯¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­è¢«äº’æ–¥åœ°è°ƒç”¨ã€‚</p><blockquote><p>è®¡ç®—çš„æ­£ç¡®æ€§å–å†³äºå¤šä¸ªçº¿ç¨‹çš„äº¤æ›¿æ‰§è¡Œæ—¶åºæ—¶å°±ä¼šäº§ç”Ÿç«æ€æ¡ä»¶</p></blockquote><h3 id="wait-åè¢«å”¤é†’ä¼šæ€ä¹ˆæ ·ï¼Ÿ"><a href="#wait-åè¢«å”¤é†’ä¼šæ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="wait()åè¢«å”¤é†’ä¼šæ€ä¹ˆæ ·ï¼Ÿ"></a>wait()åè¢«å”¤é†’ä¼šæ€ä¹ˆæ ·ï¼Ÿ</h3><p>ä¸Šé¢è¯´åˆ°è¢«å”¤é†’åä¼šå»æŠ¢é”ï¼Œä½†æ˜¯è¿™é‡Œæœ‰äººå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œå»æŠ¢é”ä¼šä¸ä¼šå›åˆ°åŒæ­¥çš„èµ·ç‚¹å»äº‰æŠ¢é”ï¼Œç„¶åæŠŠwaitå‰çš„é€»è¾‘å†æ‰§è¡Œä¸€éï¼Ÿè¿™é‡Œè‚¯å®šäº‹ä¸ä¼šçš„ï¼Œç¡®å®æ˜¯è¦æŠ¢é”ä½†æ˜¯ä¼šæœ‰è®°å½•ä¼šç»§ç»­é¡ºç€waitæ–¹æ³•èµ°ä¸‹å»ã€‚</p><h3 id="notifyå’Œä¸­æ–­çš„ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç°è±¡"><a href="#notifyå’Œä¸­æ–­çš„ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç°è±¡" class="headerlink" title="notifyå’Œä¸­æ–­çš„ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç°è±¡"></a>notifyå’Œä¸­æ–­çš„ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç°è±¡</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifyInter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">        Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">        NotifyInter waitNotify = <span class="keyword">new</span> NotifyInter();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">                <span class="keyword">synchronized</span> (object) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹1 è·å–åˆ°ç›‘è§†å™¨é”"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        object.wait();</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹1 æ­£å¸¸æ¢å¤å•¦ã€‚ä½†æ˜¯ isInterrupt = "</span>+ Thread.currentThread().isInterrupted());</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹1 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸"</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹1"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">                <span class="keyword">synchronized</span> (object) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹2 è·å–åˆ°ç›‘è§†å™¨é”"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        object.wait();</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹2 æ­£å¸¸æ¢å¤å•¦ã€‚"</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹2 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸"</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹2"</span>);</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™é‡Œè®© thread1 å’Œ thread2 å…ˆèµ·æ¥ï¼Œç„¶åå†èµ·åé¢çš„ thread3</span></span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">synchronized</span> (object) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚"</span>);</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 è®¾ç½®çº¿ç¨‹1ä¸­æ–­"</span>);</span><br><span class="line">                    thread1.interrupt(); <span class="comment">// 1</span></span><br><span class="line">                    <span class="comment">//waitNotify.a = 1; // è¿™è¡Œæ˜¯ä¸ºäº†ç¦æ­¢ä¸Šä¸‹çš„ä¸¤è¡Œä¸­æ–­å’Œnotifyä»£ç é‡æ’åº</span></span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 è°ƒç”¨notify"</span>);</span><br><span class="line">                    object.notify(); <span class="comment">//2</span></span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 è°ƒç”¨å®Œnotifyåï¼Œä¼‘æ¯ä¸€ä¼š"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    }</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸåŒæ­¥ä»£ç å—"</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹3"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¤šæ‰§è¡Œå‡ æ¬¡å¯èƒ½å°±å¯èƒ½ä¼šå‘ç”Ÿå¦‚ä¸‹æƒ…å†µï¼Œçº¿ç¨‹1è¢«æ‰“æ–­åå±…ç„¶æ­£å¸¸çš„è¿”å›äº†ï¼ï¼ï¼ï¼çº¿ç¨‹2è¢«é˜»å¡ä½äº†</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">çº¿ç¨‹<span class="number">1</span> è·å–åˆ°ç›‘è§†å™¨é”</span><br><span class="line">çº¿ç¨‹<span class="number">2</span> è·å–åˆ°ç›‘è§†å™¨é”</span><br><span class="line">çº¿ç¨‹<span class="number">3</span> æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚</span><br><span class="line">çº¿ç¨‹<span class="number">3</span> è®¾ç½®çº¿ç¨‹<span class="number">1</span>ä¸­æ–­</span><br><span class="line">çº¿ç¨‹<span class="number">3</span> è°ƒç”¨notify</span><br><span class="line">çº¿ç¨‹<span class="number">3</span> è°ƒç”¨å®Œnotifyåï¼Œä¼‘æ¯ä¸€ä¼š</span><br><span class="line">çº¿ç¨‹<span class="number">3</span> ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸåŒæ­¥ä»£ç å—</span><br><span class="line">çº¿ç¨‹<span class="number">1</span> æ­£å¸¸æ¢å¤å•¦ã€‚ä½†æ˜¯ isInterrupt = <span class="keyword">true</span></span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®è¿™é‡Œä¸»è¦é—®é¢˜å°±æ˜¯ <code>notify()</code> å’Œ<code>interrupt()</code> æ‰§è¡Œé¡ºåºçš„é—®é¢˜</p><ul><li><p>å¦‚æœå…ˆè¢«æ‰“æ–­ï¼Œé‚£ä¹ˆåç»­çš„notifyä¼šè¿™ä¸ªçº¿ç¨‹æ— æ•ˆï¼Œä¾ç„¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœè¿™æ˜¯è¯¥é”å®ä¾‹ä¸Šä»ç„¶æœ‰å…¶ä»–çº¿ç¨‹å¤„äºwaitçŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªnotifyä¼šå”¤é†’å…¶ä¸­çš„ä¸€ä¸ªï¼Œä¸èƒ½è™šå‘ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.2.4" target="_blank" rel="noopener">Javaè¯­è¨€è§„èŒƒæ–‡æ¡£17.2.4</a></p><blockquote><p>The above specifications allow us to determine several properties having to do with the interaction of waits, notification, and interruption.</p><p>If a thread is both notified and interrupted while waiting, it may either:</p><ul><li>return normally from <code>wait</code>, while still having a pending interrupt (in other words, a call to <code>Thread.interrupted</code> would return true)</li><li>return from <code>wait</code> by throwing an <code>InterruptedException</code></li></ul><p>The thread may not reset its interrupt status and return normally from the call to <code>wait</code>.</p><p>Similarly, notifications cannot be lost due to interrupts. Assume that a set <em>s</em> of threads is in the wait set of an object <em>m</em>, and another thread performs a <code>notify</code> on <em>m</em>. Then either:</p><ul><li>at least one thread in <em>s</em> must return normally from <code>wait</code>, or</li><li>all of the threads in <em>s</em> must exit <code>wait</code> by throwing <code>InterruptedException</code></li></ul><p>Note that if a thread is both interrupted and woken via <code>notify</code>, and that thread returns from <code>wait</code> by throwing an <code>InterruptedException</code>, then some other thread in the wait set must be notified.</p></blockquote></li><li><p>å¦‚æœå…ˆè¢«notify()ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šä»waitä¸­é†’æ¥ï¼Œç„¶åä¸­æ–­ï¼Œè®¾ç½®ä¸­æ–­æ ‡å¿—ä½ä¸º trueï¼Œä½†ä¸ä¼šåœ¨è¿™ä¸ªwaitä¸ŠæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¼šå½±å“åé¢çš„é˜»å¡æ“ä½œï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„Demo</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifyInter</span> </span>{</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Object object = <span class="keyword">new</span> Object();</span><br><span class="line">        NotifyInter waitNotify = <span class="keyword">new</span> NotifyInter();</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">synchronized</span> (object) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹1 è·å–åˆ°ç›‘è§†å™¨é”"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        object.wait();</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹1 æ­£å¸¸æ¢å¤å•¦ã€‚ä½†æ˜¯ isInterrupt = "</span>+ Thread.currentThread().isInterrupted());</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        System.out.println(<span class="string">"çº¿ç¨‹1 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸"</span>);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        System.out.println(<span class="string">"åœ¨sleepä¸­è¢«ä¸­æ–­"</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹1"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="comment">// è¿™é‡Œè®© thread1 å’Œ thread2 å…ˆèµ·æ¥ï¼Œç„¶åå†èµ·åé¢çš„ thread3</span></span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">synchronized</span> (object) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚"</span>);</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 è®¾ç½®çº¿ç¨‹1ä¸­æ–­"</span>);</span><br><span class="line">                    object.notify(); <span class="comment">//2</span></span><br><span class="line">                    waitNotify.a = <span class="number">1</span>; <span class="comment">// è¿™è¡Œæ˜¯ä¸ºäº†ç¦æ­¢ä¸Šä¸‹çš„ä¸¤è¡Œä¸­æ–­å’Œnotifyä»£ç é‡æ’åº</span></span><br><span class="line">                    thread1.interrupt(); <span class="comment">// 1</span></span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 è°ƒç”¨notify"</span>);</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 è°ƒç”¨å®Œnotifyåï¼Œä¼‘æ¯ä¸€ä¼š"</span>);</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    }</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹3 ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸåŒæ­¥ä»£ç å—"</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }, <span class="string">"çº¿ç¨‹3"</span>).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h3 id="wait-å’Œsleep-çš„åŒºåˆ«"><a href="#wait-å’Œsleep-çš„åŒºåˆ«" class="headerlink" title="wait()å’Œsleep()çš„åŒºåˆ«"></a>wait()å’Œsleep()çš„åŒºåˆ«</h3><p>è¿™ä¹Ÿæ˜¯ä¸€é“é¢è¯•å¸¸é—®çš„é¢˜</p><p>â‘  é¦–å…ˆ<code>sleep()</code>æ˜¯çº¿ç¨‹Threadçš„é™æ€æ–¹æ³•ï¼Œ<code>wait()</code>æ˜¯<code>Object</code>ç±»çš„å®ä¾‹æ–¹æ³•</p><p>â‘¡<code>sleep()</code>ä¸ä¼šé‡Šæ”¾é”å¯¹è±¡ï¼Œ<code>wait()</code>ä¼šé‡Šæ”¾é”å¯¹è±¡ï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒé‡è¦</p><p>â‘¢ æ‰¿æ¥ç¬¬äºŒç‚¹ï¼Œ<code>wait()</code>ä¼šé‡Šæ”¾é”ï¼Œä½†æ˜¯è¦æ˜¯ä½ æ²¡æœ‰é”å‘¢ï¼Ÿå…¶å®å°±æ˜¯ä¸Šé¢è¯­æ³•å±‚é¢è¯´åˆ°çš„ï¼Œæ‰€ä»¥è°ƒç”¨<code>wait()</code>å¿…é¡»è¦<code>æŒæœ‰</code>é”å¯¹è±¡å¦åˆ™å°±ä¼šæŠ¥<code>IllegalMonitorStateException</code></p><p>â‘£<code>sleep()</code>ä¸éœ€è¦è¢«å”¤é†’<code>timeout</code>åä¼šè‡ªåŠ¨é†’æ¥ï¼Œè€Œ<code>wait()</code>éœ€è¦è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ï¼ˆ<code>wait(long time)</code>é™¤å¤–ï¼‰</p><h3 id="çº¿ç¨‹é€šè®¯ç»¼åˆæ¡ˆä¾‹"><a href="#çº¿ç¨‹é€šè®¯ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="çº¿ç¨‹é€šè®¯ç»¼åˆæ¡ˆä¾‹"></a>çº¿ç¨‹é€šè®¯ç»¼åˆæ¡ˆä¾‹</h3><p>æ§åˆ¶åŒä¸€æ—¶é—´æ‰§è¡ŒåŒä¸€æ–¹æ³•çº¿ç¨‹çš„æ•°é‡</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ControlThreadNum</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> LinkedList THREADS = <span class="keyword">new</span> LinkedList<>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_THREAD = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        List<thread> worker = <span class="keyword">new</span> ArrayList();</thread></span><br><span class="line">        <span class="comment">//åˆ›å»ºäº†åä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯æ§åˆ¶æ¯æ¬¡æœ€å¤šåŒæ—¶è¿è¡Œçš„åªæœ‰5ä¸ª</span></span><br><span class="line">        Arrays.asList(<span class="string">"M1"</span>, <span class="string">"M2"</span>, <span class="string">"M3"</span>, <span class="string">"M4"</span>, <span class="string">"M5"</span>, <span class="string">"M6"</span>, <span class="string">"M7"</span>, <span class="string">"M8"</span>, <span class="string">"M9"</span>, <span class="string">"M10"</span>).stream().map(ControlThreadNum::captureThread).forEach(t -> {</span><br><span class="line">            t.start();</span><br><span class="line">            worker.add(t);</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">//mainçº¿ç¨‹ç­‰å¾…workerçš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span></span><br><span class="line">        worker.stream().forEach(thread -> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                thread.join();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        Optional.of(<span class="string">"All capture is done"</span>).ifPresent(System.out::println);</span><br><span class="line">        Optional.of(System.currentTimeMillis() - start).ifPresent(System.out::println);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Thread <span class="title">captureThread</span><span class="params">(String name)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">            Optional.of(<span class="string">"Thread "</span> + Thread.currentThread().getName() + <span class="string">"  is begin"</span>).ifPresent(System.out::println);</span><br><span class="line">            <span class="keyword">synchronized</span> (THREADS) {</span><br><span class="line">                <span class="keyword">while</span> (THREADS.size() >= MAX_THREAD) {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        THREADS.wait();</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//THREADS åªæ˜¯ç”¨æ¥æ§åˆ¶æ•°é‡&é” å…ƒç´ æ˜¯ä»€ä¹ˆå¹¶ä¸é‡è¦</span></span><br><span class="line">                THREADS.addLast(<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//åˆ°è¿™é‡Œæ˜¯å¹¶è¡Œ</span></span><br><span class="line">            Optional.of(<span class="string">"Thread "</span> + Thread.currentThread().getName() + <span class="string">"  is running"</span>).ifPresent(System.out::println);</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">synchronized</span> (THREADS) {</span><br><span class="line">                Optional.of(<span class="string">"Thread "</span> + Thread.currentThread().getName() + <span class="string">"  is end"</span>).ifPresent(System.out::println);</span><br><span class="line">                THREADS.removeLast();</span><br><span class="line">                THREADS.notifyAll();</span><br><span class="line">            }</span><br><span class="line">        }, name);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œä¸€å¼€å§‹ä¸€å…±åˆ›å»ºäº†10ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ—¶å€™ä¼šæ§åˆ¶<code>running</code>çš„ä¸ªæ•°å°äº5ä¸ªï¼Œ<code>runnning</code>çº¿ç¨‹ä¸ªæ•°ç”¨ä¸€ä¸ª<code>LinkList</code>è®°å½•ï¼Œè‹¥<code>size()>=5</code>å°±è¿›å…¥<code>wait</code>ç„¶åå¦‚æœæœ‰çº¿ç¨‹<code>end</code>å°±ä¼š<code>notifyAll</code>å”¤é†’è¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Thread M2  is begin</span><br><span class="line">Thread M3  is begin</span><br><span class="line">Thread M2  is running</span><br><span class="line">Thread M1  is begin</span><br><span class="line">Thread M1  is running</span><br><span class="line">Thread M3  is running</span><br><span class="line">Thread M4  is begin</span><br><span class="line">Thread M4  is running</span><br><span class="line">Thread M5  is begin</span><br><span class="line">Thread M6  is begin</span><br><span class="line">Thread M5  is running</span><br><span class="line">Thread M7  is begin</span><br><span class="line">Thread M8  is begin</span><br><span class="line">Thread M9  is begin</span><br><span class="line">Thread M10  is begin</span><br><span class="line">Thread M3  is `end`</span><br><span class="line">Thread M10  is running</span><br><span class="line">Thread M5  is `end`</span><br><span class="line">Thread M1  is `end`</span><br><span class="line">Thread M2  is `end`</span><br><span class="line">Thread M4  is `end`</span><br><span class="line">Thread M6  is running</span><br><span class="line">Thread M7  is running</span><br><span class="line">Thread M9  is running</span><br><span class="line">Thread M8  is running</span><br><span class="line">Thread M10  is end</span><br><span class="line">Thread M8  is end</span><br><span class="line">Thread M9  is end</span><br><span class="line">Thread M7  is end</span><br><span class="line">Thread M6  is end</span><br><span class="line">All capture is done</span><br><span class="line"><span class="number">20124</span></span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·å°±æ˜¯å…¶å®å°±æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œçº¿ç¨‹å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œçº¿ç¨‹åˆ›å»ºå¤ªå¤šï¼Œå°±ä¼šè¾¾åˆ°ç“¶é¢ˆï¼Œæ•ˆç‡åè€Œä¼šé™ä½ï¼Œå› ä¸ºæ—¶é—´éƒ½æ¶ˆè€—åœ¨äº†<code>çº¿ç¨‹åˆ‡æ¢</code>ä¸Šäº†ï¼Œå½“ç„¶è¿™æ˜¯åœ¨æ²¡æœ‰<code>çº¿ç¨‹æ± </code>çš„æƒ…å†µä¸‹ï¼Œåé¢ç”¨<code>çº¿ç¨‹æ± </code>å°±ä¸ä¼šè¿™ä¹ˆéº»çƒ¦äº†ã€‚</p><h3 id="wait-notifyçš„å¼€é”€åŠé—®é¢˜"><a href="#wait-notifyçš„å¼€é”€åŠé—®é¢˜" class="headerlink" title="wait()/notifyçš„å¼€é”€åŠé—®é¢˜"></a>wait()/notifyçš„å¼€é”€åŠé—®é¢˜</h3><p><strong>è¿‡æ—©å”¤é†’</strong> </p><p> æ¯”å¦‚ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ä¸­ç”Ÿäº§è€…ç”Ÿäº§åå”¤é†’äº†ç”Ÿäº§è€…ï¼Œå…¶å®å°±æ˜¯è¿‡æ—©å”¤é†’äº†ï¼Œè¿‡æ—©å”¤é†’ä½¿å¾—é‚£äº›æœ¬æ¥æ— é¡»è¢«å”¤é†’çš„ç­‰å¾…çº¿ç¨‹ä¹Ÿè¢«å”¤é†’äº†ï¼Œä»è€Œé€ æˆèµ„æºæµªè´¹ã€‚è¿™å°±å¥½æ¯”ä½ åœ¨äººç¾¤é‡Œå¤§å–Šä¸€å£°â€œç¾å¥³â€ï¼Œä¾¿ä¼šæœ‰è®¸å¤šè‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½çš„å¥³æ€§å›å¤´ä¸€æ ·â€”â€”å°½ç®¡ä½ è¦å–Šçš„ä»…ä»…æ˜¯å…¶ä¸­æŸä¸€ä¸ªäººï¼Œä½†å¤§å®¶å´éƒ½ä»¥ä¸ºä½ æ˜¯åœ¨å–Šè‡ªå·±ã€‚è¿‡æ—©å”¤é†’é—®é¢˜å¯ä»¥åˆ©ç”¨JDK<br>1.5å¼•å…¥çš„<code>java.util.concurrent.locks.Condition</code>æ¥å£æ¥è§£å†³ï¼Œåé¢çš„æ–‡ç« ä¼šè®²åˆ°ã€‚</p><p><strong>ä¿¡å·ä¸¢å¤±</strong></p><p>ä¿¡å·ä¸¢å¤±ï¼ˆMissed Signalï¼‰é—®é¢˜ã€‚å¦‚æœç­‰å¾…çº¿ç¨‹åœ¨æ‰§è¡Œ<code>Object.wait()</code>å‰æ²¡æœ‰å…ˆåˆ¤æ–­ä¿æŠ¤æ¡ä»¶æ˜¯å¦å·²ç„¶æˆç«‹ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å½¢â€”â€”é€šçŸ¥çº¿ç¨‹åœ¨è¯¥ç­‰å¾…çº¿ç¨‹è¿›äººä¸´ç•ŒåŒºä¹‹å‰å°±å·²ç»æ›´æ–°äº†ç›¸å…³å…±äº«å˜é‡ï¼Œä½¿å¾—ç›¸åº”çš„ä¿æŠ¤æ¡ä»¶æˆç«‹å¹¶è¿›è¡Œäº†é€šçŸ¥ï¼Œä½†æ˜¯æ­¤æ—¶ç­‰å¾…çº¿ç¨‹è¿˜æ²¡æœ‰è¢«æš‚åœï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ‰€è°“å”¤é†’äº†ã€‚è¿™å°±å¯èƒ½é€ æˆç­‰å¾…çº¿ç¨‹ç›´æ¥æ‰§è¡Œ<code>Object.wait()</code>è€Œè¢«æš‚åœçš„æ—¶å€™ï¼Œè¯¥çº¿ç¨‹ç”±äºæ²¡æœ‰å…¶ä»–çº¿ç¨‹è¿›è¡Œé€šçŸ¥è€Œä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚è¿™ç§ç°è±¡å°±ç›¸å½“äºç­‰å¾…çº¿ç¨‹é”™è¿‡äº†ä¸€ä¸ªæœ¬æ¥â€œå‘é€â€ç»™å®ƒçš„â€œä¿¡å·â€ï¼Œå› æ­¤è¢«ç§°ä¸ºä¿¡å·ä¸¢å¤±ï¼ˆMissed Signalï¼‰ã€‚åªè¦å°†å¯¹ä¿æŠ¤æ¡ä»¶çš„åˆ¤æ–­å’Œ<code>Object.wait()</code>è°ƒç”¨æ”¾åœ¨ä¸€ä¸ªå¾ªç¯è¯­å¥ä¹‹ä¸­å°±å¯ä»¥é¿å…ä¸Šè¿°åœºæ™¯çš„ä¿¡å·ä¸¢å¤±ã€‚ä¿¡å·ä¸¢å¤±çš„å¦å¤–ä¸€ä¸ªè¡¨ç°æ˜¯åœ¨åº”è¯¥è°ƒç”¨<code>Object.notifyAll()</code> çš„åœ°æ–¹å´è°ƒç”¨äº†<code>Object.notify()</code>ã€‚æ¯”å¦‚ï¼Œå¯¹äºä½¿ç”¨åŒä¸€ä¸ªä¿æŠ¤æ¡ä»¶çš„å¤šä¸ªç­‰å¾…çº¿ç¨‹ï¼Œå¦‚æœé€šçŸ¥çº¿ç¨‹åœ¨ä¾¦æµ‹åˆ°è¿™ä¸ªä¿æŠ¤æ¡ä»¶æˆç«‹åè°ƒç”¨çš„æ˜¯<code>Object.notify()</code>ï¼Œé‚£ä¹ˆè¿™äº›ç­‰å¾…çº¿ç¨‹æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å”¤é†’ï¼Œç”šè‡³ä¸€ä¸ªä¹Ÿæ²¡æœ‰è¢«å”¤é†’â€”â€”è¢«å”¤é†’çš„çº¿ç¨‹æ˜¯<code>Object.notify()</code>æ‰€å±å¯¹è±¡ä¸Šä½¿ç”¨å…¶ä»–ä¿æŠ¤æ¡ä»¶çš„ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡é€šçŸ¥çº¿ç¨‹åœ¨è°ƒç”¨<code>Object.notify()</code>å‰å¯èƒ½è€ƒè™‘ï¼ˆåˆ¤æ–­ï¼‰äº†æŸä¸ªç‰¹å®šçš„ä¿æŠ¤æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œä½†æ˜¯<code>Object.notify()</code>æœ¬èº«åœ¨å…¶å”¤é†’çº¿ç¨‹æ—¶æ˜¯ä¸è€ƒè™‘ä»»ä½•ä¿æŠ¤æ¡ä»¶çš„ï¼è¿™å°±å¯èƒ½ä½¿å¾—é€šçŸ¥çº¿ç¨‹æ‰§è¡Œ<code>Object.notify()</code>è¿›è¡Œçš„é€šçŸ¥å¯¹äºä½¿ç”¨ç›¸åº”ä¿æŠ¤æ¡ä»¶çš„ç­‰å¾…çº¿ç¨‹æ¥è¯´ä¸¢å¤±äº†ã€‚è¿™ç§æƒ…å½¢ä¸‹ï¼Œé¿å…ä¿¡å·ä¸¢å¤±çš„ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨å¿…è¦çš„æ—¶å€™ä½¿ç”¨<code>Object.notifyAll()</code>æ¥é€šçŸ¥ã€‚æ€»çš„æ¥è¯´ï¼Œä¿¡å·ä¸¢å¤±æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä»£ç é”™è¯¯ï¼Œè€Œä¸æ˜¯Javaæ ‡å‡†åº“APIè‡ªèº«çš„é—®é¢˜ã€‚</p><p><strong>æ¬ºéª—æ€§å”¤é†’</strong></p><p>ç”±äºè«åå…¶å¦™çš„åŸå› ï¼Œçº¿ç¨‹æœ‰å¯èƒ½åœ¨æ²¡æœ‰è°ƒç”¨è¿‡<code>notify()</code>å’Œ<code>notifyAll()</code>çš„æƒ…å†µä¸‹é†’æ¥ã€‚è¿™å°±æ˜¯æ‰€è°“çš„å‡å”¤é†’ï¼ˆspurious wakeupsï¼‰ï¼Œæ— ç«¯ç«¯åœ°é†’è¿‡æ¥äº†ï¼Œç„¶è€Œæ­¤æ—¶å¯èƒ½ä¿æŠ¤æ¡ä»¶å¹¶æ²¡æœ‰æˆç«‹ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³åŒæ ·æ˜¯è®² ä¿æŠ¤æ¡ä»¶å’Œwaitæ”¾åœ¨ä¸´ç•ŒåŒºå†…åŒä¸€ä¸ªå¾ªç¯ä½“å†…å°±å¯ä»¥äº†ã€‚</p><p><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></p><p>â€‹    é¦–å…ˆï¼Œç­‰å¾…çº¿ç¨‹æ‰§è¡Œ<code>Object.wait()</code>è‡³å°‘ä¼šå¯¼è‡´è¯¥çº¿ç¨‹å¯¹ç›¸åº”å¯¹è±¡å†…éƒ¨é”çš„ä¸¤æ¬¡ç”³è¯·ä¸é‡Šæ”¾ã€‚é€šçŸ¥çº¿ç¨‹åœ¨æ‰§è¡Œ<code>Object.notify()/notifyAll()</code>æ—¶éœ€è¦æŒæœ‰ç›¸åº”å¯¹è±¡çš„å†…éƒ¨é”ï¼Œå› æ­¤<code>Object.notify()/notifyAll()</code>è°ƒç”¨ä¼šå¯¼è‡´ä¸€æ¬¡é”çš„ç”³è¯·ã€‚è€Œé”çš„ç”³è¯·ä¸é‡Šæ”¾å¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>â€‹    å…¶æ¬¡ï¼Œç­‰å¾…çº¿ç¨‹ä»è¢«æš‚åœåˆ°å”¤é†’è¿™ä¸ªè¿‡ç¨‹æœ¬èº«å°±ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>â€‹    å†æ¬¡ï¼Œè¢«å”¤é†’çš„ç­‰å¾…çº¿ç¨‹åœ¨ç»§ç»­è¿è¡Œæ—¶éœ€è¦å†æ¬¡ç”³è¯·ç›¸åº”å¯¹è±¡çš„å†…éƒ¨é”ï¼Œæ­¤æ—¶ç­‰å¾…çº¿ç¨‹å¯èƒ½éœ€è¦å’Œç›¸åº”å¯¹è±¡çš„å…¥å£é›†ä¸­çš„å…¶ä»–çº¿ç¨‹ä»¥åŠå…¶ä»–æ–°æ¥çš„æ´»è·ƒçº¿ç¨‹ï¼ˆå³ç”³è¯·ç›¸åº”çš„å†…éƒ¨é”ä¸”å¤„äºRUNNABLEçŠ¶æ€çš„çº¿ç¨‹ï¼‰äº‰ç”¨ç›¸åº”çš„å†…éƒ¨é”ï¼Œè€Œè¿™åˆå¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<br>æœ€åï¼Œè¿‡æ—©å”¤é†’é—®é¢˜ä¹Ÿä¼šå¯¼è‡´é¢å¤–çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™æ˜¯å› ä¸ºè¢«è¿‡æ—©å”¤é†’çš„çº¿ç¨‹ä»ç„¶éœ€è¦ç»§ç»­ç­‰å¾…ï¼Œå³å†æ¬¡ç»å†è¢«æš‚åœå’Œå”¤é†’çš„è¿‡ç¨‹ã€‚</p><p><a href="http://ifeve.com/thread-signaling/" target="_blank" rel="noopener">æ›´å¤šå‚è€ƒ</a></p><h2 id="13-æ‰‹å†™ä¸€ä¸ªBooleanLock"><a href="#13-æ‰‹å†™ä¸€ä¸ªBooleanLock" class="headerlink" title="13.æ‰‹å†™ä¸€ä¸ªBooleanLock"></a>13.æ‰‹å†™ä¸€ä¸ªBooleanLock</h2><p><code>Synchronized</code>çš„ç¼ºç‚¹å…¶å®å¾ˆæ˜æ˜¾ï¼Œå½“å¤šä¸ªçº¿ç¨‹ç«äº‰é”çš„æ—¶å€™ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°é”åå…¶ä»–çš„çº¿ç¨‹åªèƒ½å‚»å‚»çš„ç­‰ç€ï¼Œè¿™æ ·ä¼šå½±å“æ•ˆç‡ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è‡ªå·±ç®€å•æ‰‹å†™ä¸€ä¸ªé™åˆ¶ç­‰å¾…æ—¶é—´çš„é”ã€‚</p><h3 id="LOCKæ¥å£"><a href="#LOCKæ¥å£" class="headerlink" title="LOCKæ¥å£"></a>LOCKæ¥å£</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lock</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TimeOutException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TimeOutException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(message);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">(<span class="keyword">long</span> time)</span> <span class="keyword">throws</span> InterruptedException,TimeOutException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Collection<thread> <span class="title">getBlockThread</span><span class="params">()</span></thread></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å®šä¹‰äº†ä¸€ä¸ª<code>TimeOutException</code></p><h3 id="BooleanLockå®ç°ç±»"><a href="#BooleanLockå®ç°ç±»" class="headerlink" title="BooleanLockå®ç°ç±»"></a>BooleanLockå®ç°ç±»</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooleanLock</span> <span class="keyword">implements</span> <span class="title">Lock</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">//false indicated free</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> initValue;</span><br><span class="line">    <span class="comment">//åŠ é”çš„çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">private</span> Thread lockedThread;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Collection<thread> blockThreadCollection = <span class="keyword">new</span> ArrayList<>();</thread></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BooleanLock</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.initValue = <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">while</span> (initValue) {</span><br><span class="line">            blockThreadCollection.add(Thread.currentThread());</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" is wait"</span>);</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        }</span><br><span class="line">        blockThreadCollection.remove(Thread.currentThread());</span><br><span class="line">        <span class="keyword">this</span>.initValue = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.lockedThread = Thread.currentThread();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">(<span class="keyword">long</span> time)</span> <span class="keyword">throws</span> InterruptedException, TimeOutException </span>{</span><br><span class="line">        <span class="keyword">if</span> (time <= <span class="number">0</span>) lock();</span><br><span class="line">        <span class="keyword">long</span> remainTime=time;</span><br><span class="line">        <span class="keyword">long</span> endTime=System.currentTimeMillis()+time;</span><br><span class="line">        <span class="keyword">while</span> (initValue){</span><br><span class="line">            <span class="keyword">if</span>(remainTime<=<span class="number">0</span>){</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> TimeOutException(<span class="string">"time is out"</span>);</span><br><span class="line">            }</span><br><span class="line">            blockThreadCollection.add(Thread.currentThread());</span><br><span class="line">            <span class="keyword">this</span>.wait(time);</span><br><span class="line">            remainTime=endTime-System.currentTimeMillis();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">this</span>.initValue=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.lockedThread=Thread.currentThread();</span><br><span class="line">        blockThreadCollection.remove(Thread.currentThread());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">unLock</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯åŠ é”çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (lockedThread == Thread.currentThread()) {</span><br><span class="line">            <span class="keyword">this</span>.initValue = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            Optional.of(Thread.currentThread().getName() + <span class="string">"  release the lock monitor"</span>).ifPresent(System.out::println);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection<thread> <span class="title">getBlockThread</span><span class="params">()</span> </thread></span>{</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableCollection(blockThreadCollection);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="æµ‹è¯•BooleanLockçš„æ•ˆæœ"><a href="#æµ‹è¯•BooleanLockçš„æ•ˆæœ" class="headerlink" title="æµ‹è¯•BooleanLockçš„æ•ˆæœ"></a>æµ‹è¯•BooleanLockçš„æ•ˆæœ</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> BooleanLock booleanLock = <span class="keyword">new</span> BooleanLock();</span><br><span class="line">        Stream.of(<span class="string">"t0"</span>, <span class="string">"t1"</span>, <span class="string">"t2"</span>).forEach(name -> {</span><br><span class="line">            <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    booleanLock.lock(<span class="number">10</span>);</span><br><span class="line">                    Optional.of(Thread.currentThread().getName() + <span class="string">" get the lock"</span>).ifPresent(System.out::println);</span><br><span class="line">                    doSomething();</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                } <span class="keyword">catch</span> (Lock.TimeOutException e) {</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">" Time out"</span>);</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    booleanLock.unLock();</span><br><span class="line">                }</span><br><span class="line">            }, name).start();</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">//mainçº¿ç¨‹é‡Šæ”¾é”ï¼Œä¸åº”è¯¥ï¼Œè°åŠ çš„é”åº”è¯¥ç”±è°å»é‡Šæ”¾é”</span></span><br><span class="line">        <span class="comment">//booleanLock.unLock();</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>{</span><br><span class="line">        Optional.of(Thread.currentThread().getName() + <span class="string">" is working..."</span>).ifPresent(System.out::println);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œè®¾ç½®åœ¨æŠ¢ä¸åˆ°é”çš„æ—¶å€™ï¼Œåªç­‰å¾…<code>10ms</code>ï¼Œç„¶å<code>doSomething</code>ä¼š<code>sleep</code>5000msï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŠ¢åˆ°é”åé¢çš„éƒ½ä¼šè¶…æ—¶ throw <code>TimeOutException</code>å…¸å‹çš„<code>é™æ—¶ç­‰å¾…</code>æ¨¡å‹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">t0 get the lock</span><br><span class="line">t0 is working...</span><br><span class="line">`base_thread_study.chaper10.Lock$TimeOutException: time is out`</span><br><span class="line">at base_thread_study.chaper10.BooleanLock.lock(BooleanLock.java:<span class="number">41</span>)</span><br><span class="line">at base_thread_study.chaper10.LockTest.lambda$<span class="keyword">null</span>$<span class="number">0</span>(LockTest.java:<span class="number">12</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line">`base_thread_study.chaper10.Lock$TimeOutException: time is out`</span><br><span class="line">at base_thread_study.chaper10.BooleanLock.lock(BooleanLock.java:<span class="number">41</span>)</span><br><span class="line">at base_thread_study.chaper10.LockTest.lambda$<span class="keyword">null</span>$<span class="number">0</span>(LockTest.java:<span class="number">12</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line">t2 Time out</span><br><span class="line">t1 Time out</span><br><span class="line">t0  release the lock monitor</span><br></pre></td></tr></tbody></table></figure></div><h2 id="14-ç»™åº”ç”¨ç¨‹åºæ³¨å…¥é’©å­Hook"><a href="#14-ç»™åº”ç”¨ç¨‹åºæ³¨å…¥é’©å­Hook" class="headerlink" title="14.ç»™åº”ç”¨ç¨‹åºæ³¨å…¥é’©å­Hook"></a>14.ç»™åº”ç”¨ç¨‹åºæ³¨å…¥é’©å­Hook</h2><p>å…³äº<code>Hook</code>æ˜¯ä»€ä¹ˆå°±ä¸å¤šä»‹ç»äº†ï¼Œè¿™é‡Œçš„é’©å­å’Œ<code>git</code>,<code>svn</code>é‡Œé¢çš„æ˜¯ä¸€æ ·çš„ï¼Œç±»ä¼¼çš„åœ¨ä½¿ç”¨<code>Tomcat</code>ç­‰æœåŠ¡çš„æ—¶å€™ï¼Œåœ¨ä½ å…³é—­å®ƒä¹‹åå®ƒä»ç„¶ä¼šæ‰“å°æ—¥å¿—å’Œé‡Šæ”¾ä¸€äº›èµ„æºï¼Œè¿™å°±æ˜¯<code>Hook</code>çš„ä¸€ç§ï¼Œå½“ç„¶<code>Hook</code>æœ‰å¤šç§ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExitCap</span></span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String []arg)</span></span>{</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread(()->{</span><br><span class="line">       System.out.println(<span class="string">"The test app will shutdown"</span>);</span><br><span class="line">    notifyAndRelease();</span><br><span class="line">}));</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>){</span><br><span class="line"><span class="keyword">try</span>{</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">System.out.println(<span class="string">"i am working"</span>);</span><br><span class="line">}<span class="keyword">catch</span>(Exception e){</span><br><span class="line"> <span class="comment">//donothing</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span>(i><span class="number">10</span>){</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">}</span><br><span class="line">i++;    </span><br><span class="line">}</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">notifyAndRelease</span><span class="params">()</span></span>{</span><br><span class="line">System.out.println(<span class="string">"notify to admin"</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">try</span>{</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">}<span class="keyword">catch</span>(Exception e){}</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"release the resources(socker. file, connection.)"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>{</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        }<span class="keyword">catch</span>(Exception e){}</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"release and notify done"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæ˜¯åœ¨<code>Linux</code>ä¸Šè¿›è¡Œçš„æµ‹è¯•ï¼Œå› ä¸ºæ•ˆæœæ¯”è¾ƒæ˜æ˜¾ï¼Œé¡ºä¾¿ä¹Ÿç†Ÿæ‚‰ä¸‹<code>Linux</code>çš„å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„é’©å­å°±æ˜¯é€šè¿‡<code>Runtime.getRuntime().addShutdownHook()</code>æ³¨å…¥äº†ä¸€ä¸ª<code>Thread</code>è¿›å»çš„ï¼Œè¿™æ ·å°±ä¼šæ£€æµ‹åˆ°ç¨‹åºçš„é€€å‡ºå¹¶è§¦å‘<code>Hook</code>åšä¸€äº›é‡Šæ”¾èµ„æºä¹‹ç±»çš„å·¥ä½œã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">i am working</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.RuntimeException</span><br><span class="line">at base_thread_study.chaper10.ExitCap.main(ExitCap.java:<span class="number">18</span>)</span><br><span class="line">i am working</span><br><span class="line">`The test app will shutdown`</span><br><span class="line">`notify to admin`</span><br><span class="line">`<span class="function">release the <span class="title">resources</span><span class="params">(socker. file, connection.)</span>`</span></span><br><span class="line"><span class="function">`release and notify done`</span></span><br></pre></td></tr></tbody></table></figure></div><p>ä¸Šé¢æ˜¯åœ¨æ­£å¸¸æƒ…å†µä¸‹ç»ˆæ­¢çº¿ç¨‹æ¯”å¦‚ <code>å¼‚å¸¸</code>ï¼Œ<code>ctrl C</code>æˆ–è€… <code>kill pid</code>å¦‚æœä½¿ç”¨ <code>kill -9 pid</code>å°±ä¸ä¼šè§¦å‘é’©å­ï¼Œå¼ºåˆ¶åœæ­¢ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®ç”¨<code>kill -9</code></p><h2 id="15-æ•è·çº¿ç¨‹çš„Runtimeå¼‚å¸¸"><a href="#15-æ•è·çº¿ç¨‹çš„Runtimeå¼‚å¸¸" class="headerlink" title="15.æ•è·çº¿ç¨‹çš„Runtimeå¼‚å¸¸"></a>15.æ•è·çº¿ç¨‹çš„Runtimeå¼‚å¸¸</h2><p>åœ¨Javaå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä¸å…è®¸æŠ›å‡ºæœªæ•è·çš„<code>checked exception</code>(æ¯”å¦‚sleepçš„InterruptException)ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªçº¿ç¨‹å¿…é¡»è‡ªå·±æŠŠè‡ªå·±çš„<code>checked exception</code>å¤„ç†æ‰ï¼Œä½†æ˜¯å¦‚æœæ˜¯<code>unchecked exception</code>å‘¢ï¼Ÿä¸»è¦å°±æ˜¯æŒ‡<code>RuntimeException</code>æ­¤ç±»å¼‚å¸¸æŠ›å‡ºæ—¶è¯¥çº¿ç¨‹ä¼š<code>shutdown</code>ä½†æ˜¯å…¶å®ƒçº¿ç¨‹ä¸å—å½±å“ä¹Ÿæ— æ³•æ„ŸçŸ¥åˆ°è¿™ä¸ªå¼‚å¸¸ï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadException</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread thread = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            thread=<span class="keyword">new</span> Thread(()->{</span><br><span class="line">                <span class="keyword">int</span> res=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">            });</span><br><span class="line">            thread.start();</span><br><span class="line">        }<span class="keyword">catch</span> (Exception e){</span><br><span class="line">            System.out.println(<span class="string">"æ•è·åˆ°å¼‚å¸¸"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ§åˆ¶å°è¾“å‡º<code>mainçº¿ç¨‹</code>å¹¶æ²¡æœ‰æ•è·åˆ°å¼‚å¸¸ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„ç†å¿µï¼Œæ¯ä¸ªçº¿ç¨‹çš„äº‹æƒ…åº”è¯¥ç”±çº¿ç¨‹è‡ªå·±å»å¤„ç†ä¸åº”è¯¥ç”±å…¶ä»–çº¿ç¨‹å»å¹²æ‰°ï¼Œæ­£å¦‚<code>stop/resume/suspend</code>è¿™äº›æ–¹æ³•è¢«å¼ƒç”¨çš„åŸå› ã€‚ä½†æ˜¯è¿™äº›å¼‚å¸¸å¦‚æœä¸å»å¤„ç†å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸¥é‡çš„åæœï¼ŒJDK1.5ä¹‹åå®˜æ–¹ä¹Ÿæä¾›äº†APIå»å¤„ç†çº¿ç¨‹çš„å¼‚å¸¸ã€‚setDefaultUncaughtExceptionHandler()å’ŒsetUncaughtExceptionHandler()å‰è€…æ˜¯<code>Thread</code>çš„é™æ€æ–¹æ³•ï¼Œç”¨äºç»™æ‰€æœ‰çš„çº¿ç¨‹è®¾ç½®é»˜è®¤çš„å¼‚å¸¸å¤„ç†ï¼Œåè€…æ˜¯å®ä¾‹æ–¹æ³•ï¼Œé’ˆå¯¹æ¯ä¸ªçº¿ç¨‹ä¼šç»™æ¯ä¸ªçº¿ç¨‹åŠ ä¸Šä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œå¦‚ä¸‹Demo</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadException</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> A = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> B = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(() -> {</span><br><span class="line">              <span class="keyword">int</span> res = A / B;</span><br><span class="line">            }</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//æœ€å¥½åœ¨startå‰è®¾ç½®å¼‚å¸¸å¤„ç†å™¨ï¼Œæ”¾åœ¨åé¢å¯èƒ½ä¼šèµ·ä¸åˆ°ä½œç”¨ã€‚</span></span><br><span class="line">        thread.setUncaughtExceptionHandler((t, e) -> {</span><br><span class="line">            System.out.println(t.getName());</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        });</span><br><span class="line">        thread.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p><code>Thread-0</code><br><code>java.lang.ArithmeticException: / by zero</code></p></blockquote><p>å¯ä»¥çœ‹åˆ°å·²ç»æ•è·åˆ°äº†è¿™ä¸ªå¼‚å¸¸ï¼Œå½“çº¿ç¨‹é‡åˆ°æœªæ•è·çš„å¼‚å¸¸è€Œç»“æŸæ—¶ä¼šè°ƒç”¨<code>UncaughtExceptionHandler</code> å¤„ç†ä¸€äº›â€åäº‹â€å’Œé‡Šæ”¾ä¸€äº›å®è´µçš„èµ„æºï¼Œ<code>setUncaughtExceptionHandler</code>å»ºè®®æ”¾åœ¨çº¿ç¨‹startä¹‹å‰ï¼Œä¸ç„¶å¯èƒ½èµ·ä¸åˆ°ä½œç”¨ã€‚</p><h2 id="16-ThreadGroupçº¿ç¨‹ç»„"><a href="#16-ThreadGroupçº¿ç¨‹ç»„" class="headerlink" title="16.ThreadGroupçº¿ç¨‹ç»„"></a>16.ThreadGroupçº¿ç¨‹ç»„</h2><h3 id="è·å–çº¿ç¨‹ç»„ä¿¡æ¯"><a href="#è·å–çº¿ç¨‹ç»„ä¿¡æ¯" class="headerlink" title="è·å–çº¿ç¨‹ç»„ä¿¡æ¯"></a>è·å–çº¿ç¨‹ç»„ä¿¡æ¯</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadGroupAPI</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        ThreadGroup tgp = <span class="keyword">new</span> ThreadGroup(<span class="string">"TGP1"</span>);</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(tgp, <span class="string">"t0"</span>) {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        System.out.println(getThreadGroup().getName());</span><br><span class="line">                        System.out.println(getThreadGroup().getParent());</span><br><span class="line">                        <span class="comment">//å¯ä»¥è®¿é—®ï¼Œæ–‡æ¡£ä¸Šè¯´ä¸è¡Œ</span></span><br><span class="line">                        System.out.println(getThreadGroup().getParent().activeCount());</span><br><span class="line">                        Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">                    } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        t.start();</span><br><span class="line"></span><br><span class="line">        ThreadGroup tgp2 = <span class="keyword">new</span> ThreadGroup(<span class="string">"TGP2"</span>);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(tgp2, <span class="string">"t0"</span>) {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                System.out.println(tgp.getName());</span><br><span class="line">                System.out.println(tgp.activeCount());</span><br><span class="line">                Thread[] threads=<span class="keyword">new</span> Thread[tgp.activeCount()];</span><br><span class="line">                tgp.enumerate(threads);</span><br><span class="line">                <span class="comment">//ä¹Ÿå¯ä»¥è®¿é—®</span></span><br><span class="line">                Arrays.asList(threads).forEach(System.out::println);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="comment">//System.out.println(tgp2.getName());</span></span><br><span class="line">        <span class="comment">//System.out.println(tgp2.getParent().getName());</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ–‡æ¡£ä¸Šè¯´çš„ä¸èƒ½è®¿é—®å…¶ä»–çº¿ç¨‹ç»„çš„ä¿¡æ¯ï¼Œè¿™é‡Œæµ‹è¯•çš„å‡ ä¸ªéƒ½å¯ä»¥ï¼Œå¯èƒ½æè¿°æœ‰ç‚¹é—®é¢˜ï¼Œ<code>çº¿ç¨‹ç»„</code>çš„åˆ›å»ºç±»ä¼¼äº<code>çº¿ç¨‹</code>çš„åˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®šçº¿ç¨‹ç»„éƒ½ä¼šé»˜è®¤åŠ åˆ°çˆ¶çº¿ç¨‹çš„çº¿ç¨‹ç»„ä¸­ã€‚</p><h3 id="æ‰“æ–­çº¿ç¨‹ç»„interrupt"><a href="#æ‰“æ–­çº¿ç¨‹ç»„interrupt" class="headerlink" title="æ‰“æ–­çº¿ç¨‹ç»„interrupt()"></a>æ‰“æ–­çº¿ç¨‹ç»„interrupt()</h3><blockquote><p>Interrupts all threads in this thread group.</p><p>First, the <code>checkAccess</code> method of this thread group is</p><p>called with no arguments; this may result in a security exception.</p><p>This method then calls the <code>interrupt</code> method on all the</p><p>threads in this thread group and in <code>all of its subgroups.</code></p></blockquote><p>æ‰“æ–­è¯¥çº¿ç¨‹ç»„é‡Œé¢æ‰€æœ‰çš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬å­çº¿ç¨‹ç»„çš„çº¿ç¨‹ã€‚</p><h3 id="çº¿ç¨‹ç»„setDaemon"><a href="#çº¿ç¨‹ç»„setDaemon" class="headerlink" title="çº¿ç¨‹ç»„setDaemon()"></a>çº¿ç¨‹ç»„setDaemon()</h3><p>å’Œçº¿ç¨‹çš„<code>setDaemon</code>ä¸ä¸€æ ·ã€‚</p><blockquote><p>Changes the daemon status of this thread group.</p><p>First, the <code>checkAccess</code> method of this thread group is</p><p>called with no arguments; this may result in a security exception.</p><p>A daemon thread group is <code>automatically</code> <code>destroyed</code> when its last</p><p>thread is stopped or its <code>last thread group is destroyed</code>.</p></blockquote><p>å½“æœ€åä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨é”€æ¯çº¿ç¨‹ç»„ï¼Œå½“ç„¶ä¸å…¶å¯¹åº”çš„ä¹Ÿæœ‰æ‰‹åŠ¨é”€æ¯çš„æ–¹æ³•<code>destroy()</code>è¿™ä¸ªæ–¹æ³•å¦‚æœçº¿ç¨‹æ²¡æ‰§è¡Œå®Œæ¯•å°±è°ƒç”¨ä¼šæŠ›<code>IllegalThreadStateException</code>ï¼Œå…¶ä»–çš„æ–¹æ³•è¯¦ç»†å¯ä»¥å‚è€ƒæ–‡æ¡£ã€‚</p><h2 id="17-çº¿ç¨‹æ± "><a href="#17-çº¿ç¨‹æ± " class="headerlink" title="17.çº¿ç¨‹æ± "></a>17.çº¿ç¨‹æ± </h2><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± "><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± " class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± "></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± </h3><p> åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¼€é”€å¤§ï¼Œåˆ©ç”¨å¥½çº¿ç¨‹æ± å¯ä»¥é¿å…cpuèŠ±è´¹ä¸å¿…è¦çš„æ—¶é—´åœ¨è¿™ä¸Šé¢ï¼Œä»è€Œä¸“æ³¨äºå…·ä½“çš„ä»»åŠ¡:)</p><p>åŸºæœ¬çš„çº¿ç¨‹æ± åŒ…æ‹¬ä¸‹é¢å‡ éƒ¨åˆ†ï¼š</p><p>â‘ ä»»åŠ¡é˜Ÿåˆ—</p><p>â‘¡æ‹’ç»ç­–ç•¥(æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥ä¸¢å¼ƒï¼Œé˜»å¡ï¼Œä¸´æ—¶é˜Ÿåˆ—)</p><p>â‘¢<code>init</code>(<code>min</code>)åˆå§‹å¤§å°</p><p>â‘£<code>active</code>ä¸­é—´å¸¸æ€å¤§å°</p><p>â‘¤<code>max</code>æœ€å¤§ä¸ªæ•°ï¼Œè¶…è¿‡å°±ä¼šåŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡å°±ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥</p><blockquote><p>min<=active<=max</p></blockquote><h3 id="æ‰‹å†™çº¿ç¨‹æ± "><a href="#æ‰‹å†™çº¿ç¨‹æ± " class="headerlink" title="æ‰‹å†™çº¿ç¨‹æ± "></a>æ‰‹å†™çº¿ç¨‹æ± </h3><h4 id="ä¸´æ—¶é˜Ÿåˆ—"><a href="#ä¸´æ—¶é˜Ÿåˆ—" class="headerlink" title="ä¸´æ—¶é˜Ÿåˆ—"></a>ä¸´æ—¶é˜Ÿåˆ—</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleThreadPool</span> </span>{</span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="comment">//é»˜è®¤å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DEFAULT_SIZE = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> LinkedList<runnable> TASK_QUEUE = <span class="keyword">new</span> LinkedList<>();</runnable></span><br><span class="line"><span class="comment">//çº¿ç¨‹åºå·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> seq = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//çº¿ç¨‹ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ThreadGroup GROUP = <span class="keyword">new</span> ThreadGroup(<span class="string">"Pool_Group"</span>);</span><br><span class="line"><span class="comment">//çº¿ç¨‹å‰ç¼€å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String THREAD_PREFIX = <span class="string">"SIMPLE_THREAD_POOL-"</span>;</span><br><span class="line"><span class="comment">//çº¿ç¨‹é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> List<mythread> THREAD_QUEUE = <span class="keyword">new</span> ArrayList<>();</mythread></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleThreadPool</span><span class="params">(<span class="keyword">int</span> size)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">        init();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(DEFAULT_SIZE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; i++) {</span><br><span class="line">            createThreadQueue();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æš´éœ²å¯¹å¤–çš„æ¥å£ï¼Œæäº¤ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (TASK_QUEUE) {</span><br><span class="line">            TASK_QUEUE.addLast(runnable);</span><br><span class="line">            <span class="comment">//å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</span></span><br><span class="line">            TASK_QUEUE.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createThreadQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        MyThread thread = <span class="keyword">new</span> MyThread(GROUP, THREAD_PREFIX + (seq++));</span><br><span class="line">        thread.start();</span><br><span class="line">        THREAD_QUEUE.add(thread);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> ThreadState {</span><br><span class="line">        FREE, RUNNING, BLOCKED, DEAD</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒ…è£…çš„çº¿ç¨‹ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> ThreadState threadState = ThreadState.FREE;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ThreadState <span class="title">getThreadState</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.threadState;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(ThreadGroup group, String name)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(group, name);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            OUTER:</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">this</span>.threadState != ThreadState.DEAD) {</span><br><span class="line">                <span class="comment">//å½“å‰çº¿ç¨‹æ²¡æœ‰dead</span></span><br><span class="line">                Runnable runnable;</span><br><span class="line">                <span class="keyword">synchronized</span> (TASK_QUEUE) {</span><br><span class="line">                    <span class="keyword">while</span> (TASK_QUEUE.isEmpty()) {</span><br><span class="line">                        <span class="comment">//ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå…¨å‘˜wait</span></span><br><span class="line">                        <span class="keyword">try</span> {</span><br><span class="line">                            <span class="keyword">this</span>.threadState = ThreadState.BLOCKED;</span><br><span class="line">                            TASK_QUEUE.wait();</span><br><span class="line">                        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                            System.out.println(<span class="string">"break"</span>);</span><br><span class="line">                            <span class="keyword">break</span> OUTER;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    runnable = TASK_QUEUE.removeFirst();</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//è¿™é‡Œåº”è¯¥å¹¶è¡Œ</span></span><br><span class="line">                Optional.of(runnable).ifPresent(t -> {</span><br><span class="line">                    <span class="keyword">this</span>.threadState = ThreadState.RUNNING;</span><br><span class="line">                    t.run();</span><br><span class="line">                    <span class="keyword">this</span>.threadState = ThreadState.FREE;</span><br><span class="line">                });</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.threadState = ThreadState.DEAD;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æœ€å¼€å§‹å®ç°çš„æ—¶å€™<code>synchronized</code>çš„èŒƒå›´å¤ªå¤§ï¼Œå°†å…·ä½“çš„æ‰§è¡Œ<code>run</code>çš„è¿‡ç¨‹ä¹ŸåŒæ­¥äº†èµ·æ¥ï¼Œè¿™æ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼Œåªéœ€è¦åŒæ­¥å…±äº«å˜é‡å°±å¯ä»¥äº†ï¼ŒåŒæ­¥äº†åé¢çš„ä»£ç é‚£å°±è·Ÿå•çº¿ç¨‹ä¸€æ ·äº†ã€‚</p><h4 id="å…³é—­çº¿ç¨‹æ± -amp-æ‹’ç»ç­–ç•¥"><a href="#å…³é—­çº¿ç¨‹æ± -amp-æ‹’ç»ç­–ç•¥" class="headerlink" title="å…³é—­çº¿ç¨‹æ± &æ‹’ç»ç­–ç•¥"></a>å…³é—­çº¿ç¨‹æ± &æ‹’ç»ç­–ç•¥</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleThreadPool</span> </span>{</span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</span><br><span class="line"><span class="comment">//ä»»åŠ¡é˜Ÿåˆ—å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> queueSize;</span><br><span class="line"><span class="comment">//é»˜è®¤çº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DEFAULT_SIZE = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//çº¿ç¨‹æ± ä¸­çº¿ç¨‹ç¼–å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> seq = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//é»˜è®¤ä»»åŠ¡é˜Ÿåˆ—çš„å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DEFAULT_TASK_QUEUE_SIZE = <span class="number">2000</span>;</span><br><span class="line"><span class="comment">//çº¿ç¨‹ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ThreadGroup GROUP = <span class="keyword">new</span> ThreadGroup(<span class="string">"Pool_Group"</span>);</span><br><span class="line"><span class="comment">//çº¿ç¨‹åå‰ç¼€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String THREAD_PREFIX = <span class="string">"SIMPLE_THREAD_POOL-"</span>;</span><br><span class="line"><span class="comment">//ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> LinkedList<runnable> TASK_QUEUE = <span class="keyword">new</span> LinkedList<>();</runnable></span><br><span class="line"><span class="comment">//çº¿ç¨‹é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> List<mythread> THREAD_QUEUE = <span class="keyword">new</span> ArrayList<>();</mythread></span><br><span class="line"><span class="comment">//æ‹’ç»ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DiscardPolicy discardPolicy;</span><br><span class="line"><span class="comment">//çº¿ç¨‹æ¬¡æ˜¯å¦é”€æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> destroy = <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">//é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼ˆæŠ›å¼‚å¸¸ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> DiscardPolicy DEFAULT_DISCARD_POLICY = () -> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> DiscardException(<span class="string">"Discard this Task!!!!(Default Policy)"</span>);</span><br><span class="line">    };</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleThreadPool</span><span class="params">(<span class="keyword">int</span> size, <span class="keyword">int</span> queueSize, DiscardPolicy discardPolicy)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">        <span class="keyword">this</span>.queueSize = queueSize;</span><br><span class="line">        <span class="keyword">this</span>.discardPolicy = discardPolicy;</span><br><span class="line">        init();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(DEFAULT_SIZE, DEFAULT_TASK_QUEUE_SIZE, DEFAULT_DISCARD_POLICY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < size; i++) {</span><br><span class="line">            createThreadQueue();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (destroy) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The Pool is shutdown , you can't submit now ! !"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">synchronized</span> (TASK_QUEUE) {</span><br><span class="line">            <span class="keyword">if</span> (TASK_QUEUE.size() > queueSize) {</span><br><span class="line">                discardPolicy.discard();</span><br><span class="line">            }</span><br><span class="line">            TASK_QUEUE.addLast(runnable);</span><br><span class="line">            <span class="comment">//å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</span></span><br><span class="line">            TASK_QUEUE.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">while</span> (!TASK_QUEUE.isEmpty()) {</span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> initVal = THREAD_QUEUE.size();</span><br><span class="line">        <span class="keyword">while</span> (initVal > <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">for</span> (MyThread thread : THREAD_QUEUE) {</span><br><span class="line">                <span class="keyword">if</span> (thread.getThreadState() == ThreadState.BLOCKED) {</span><br><span class="line">                    thread.close();</span><br><span class="line">                    thread.interrupt();</span><br><span class="line">                    initVal--;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    Thread.sleep(<span class="number">10</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">this</span>.destroy = <span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">"My Thread pool is shutdown"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.destroy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createThreadQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        MyThread thread = <span class="keyword">new</span> MyThread(GROUP, THREAD_PREFIX + (seq++));</span><br><span class="line">        thread.start();</span><br><span class="line">        THREAD_QUEUE.add(thread);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> ThreadState {</span><br><span class="line">        FREE, RUNNING, BLOCKED, DEAD</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscardException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DiscardException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(message);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DiscardPolicy</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">discard</span><span class="params">()</span> <span class="keyword">throws</span> DiscardException</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> ThreadState threadState = ThreadState.FREE;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ThreadState <span class="title">getThreadState</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.threadState;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(ThreadGroup group, String name)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(group, name);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            OUTER:</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">this</span>.threadState != ThreadState.DEAD) {</span><br><span class="line">                Runnable runnable;</span><br><span class="line">                <span class="keyword">synchronized</span> (TASK_QUEUE) {</span><br><span class="line">                    <span class="keyword">while</span> (TASK_QUEUE.isEmpty()) {</span><br><span class="line">                        <span class="keyword">try</span> {</span><br><span class="line">                            <span class="keyword">this</span>.threadState = ThreadState.BLOCKED;</span><br><span class="line">                            TASK_QUEUE.wait();</span><br><span class="line">                        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                            System.out.println(Thread.currentThread().getName() + <span class="string">" is dead"</span>);</span><br><span class="line">                            <span class="keyword">break</span> OUTER;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    runnable = TASK_QUEUE.removeFirst();</span><br><span class="line">                }</span><br><span class="line">                Optional.of(runnable).ifPresent(t -> {</span><br><span class="line">                    <span class="keyword">this</span>.threadState = ThreadState.RUNNING;</span><br><span class="line">                    t.run();</span><br><span class="line">                    <span class="keyword">this</span>.threadState = ThreadState.FREE;</span><br><span class="line">                });</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.threadState = ThreadState.DEAD;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><ul><li><code>shutdown</code>æ–¹æ³•å®ç°</li></ul><p>â‘ å…ˆè½®è¯¢ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºå°±ä¼šè®©<code>å½“å‰çº¿ç¨‹</code>ç­‰å¾…<code>çº¿ç¨‹é˜Ÿåˆ—</code>çš„çº¿ç¨‹æ‰§è¡Œå®Œæ‰€æœ‰ä»»åŠ¡ã€‚</p><p>â‘¡å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œéå†<code>çº¿ç¨‹é˜Ÿåˆ—</code>ï¼Œç„¶åæ‰“æ–­<code>BLOCK</code>çš„çº¿ç¨‹å¹¶ä¸”è®¾ç½®ä¸º<code>DEAD</code>çŠ¶æ€è·³å‡ºå¾ªç¯ï¼Œå› ä¸º<code>ä»»åŠ¡é˜Ÿåˆ—</code>ä¸ºç©º<code>çº¿ç¨‹é˜Ÿåˆ—</code>é‡Œé¢çš„çº¿ç¨‹éƒ½ä¼šåœ¨<code>TASK_QUEUE</code>ä¸Šé¢<code>BLOCK</code>ä½ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ç‰¹æ®Šæƒ…å†µï¼Œå¯èƒ½æŸä¸ªçº¿ç¨‹åˆšæ‹¿åˆ°æœ€åä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥ç¨å¾®ç­‰ä¸€ä¸‹ï¼Œç­‰å®ƒ<code>BLOCK</code>ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸ª<code>lg(N)-lg(N2)</code>çš„æ–¹æ³•</p><p>â‘¢è®¾ç½®<code>destory</code>çŠ¶æ€ä¸ºtrueï¼Œç„¶ååœ¨<code>submit</code>çš„æ—¶å€™ä¼šæ ¹æ®è¿™ä¸ªå˜é‡æ¥åˆ¤æ–­æ˜¯å¦å·²ç»é”€æ¯ï¼Œå¦‚æœå·²ç»é”€æ¯å°±ä¼šæŠ›å‡ºä¸€ä¸ª<code>RunntimeException</code></p><ul><li><code>æ‹’ç»ç­–ç•¥</code>å®ç°</li></ul><p>è¿™é‡Œå®ç°äº†ä¸€ä¸ªÂ·é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨submitçš„æ—¶å€™åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä¸æ˜¯æ»¡çš„ï¼Œå¦‚æœæ»¡äº†å°±ç›´æ¥æŠ›å¼‚å¸¸ï¼Œè¿™é‡Œå¦‚æœç”¨è¿™ç§æ–¹å¼æ‹’ç»ï¼Œä¸€ä½†å‡ºç°å¼‚å¸¸<code>å½“å‰çº¿ç¨‹</code>å°±ä¼š<code>ç›´æ¥ç»“æŸ</code>å¯èƒ½å°±æ— æ³•å…³é—­è¿æ¥æ± ã€‚</p><h4 id="è‡ªåŠ¨æ‰©å®¹-amp-é—²æ—¶å›æ”¶"><a href="#è‡ªåŠ¨æ‰©å®¹-amp-é—²æ—¶å›æ”¶" class="headerlink" title="è‡ªåŠ¨æ‰©å®¹&é—²æ—¶å›æ”¶"></a>è‡ªåŠ¨æ‰©å®¹&é—²æ—¶å›æ”¶</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleThreadPool</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="comment">//çº¿ç¨‹å¤§å°å˜åŒ–å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> min;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> active;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> max;</span><br><span class="line">    <span class="comment">//é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MIN = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> ACTIVE = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX = <span class="number">12</span>;</span><br><span class="line">    <span class="comment">//ä»»åŠ¡é˜Ÿåˆ—å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> queueSize;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getActive</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> active;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMax</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ± ä¸­çº¿ç¨‹ç¼–å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> seq = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//é»˜è®¤ä»»åŠ¡é˜Ÿåˆ—çš„å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DEFAULT_TASK_QUEUE_SIZE = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çº¿ç¨‹ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ThreadGroup GROUP = <span class="keyword">new</span> ThreadGroup(<span class="string">"Pool_Group"</span>);</span><br><span class="line">    <span class="comment">//çº¿ç¨‹åå‰ç¼€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String THREAD_PREFIX = <span class="string">"SIMPLE_THREAD_POOL-"</span>;</span><br><span class="line">    <span class="comment">//ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> LinkedList<runnable> TASK_QUEUE = <span class="keyword">new</span> LinkedList<>();</runnable></span><br><span class="line">    <span class="comment">//çº¿ç¨‹é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> List<mythread> THREAD_QUEUE = <span class="keyword">new</span> ArrayList<>();</mythread></span><br><span class="line">    <span class="comment">//æ‹’ç»ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DiscardPolicy discardPolicy;</span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ± æ˜¯å¦é”€æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> destroy = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼ˆæŠ›å¼‚å¸¸ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> DiscardPolicy DEFAULT_DISCARD_POLICY = () -> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> DiscardException(<span class="string">"Discard this Task!!!!(Default Policy)"</span>);</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleThreadPool</span><span class="params">(<span class="keyword">int</span> min, <span class="keyword">int</span> active, <span class="keyword">int</span> max, <span class="keyword">int</span> queueSize, DiscardPolicy discardPolicy)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.queueSize = queueSize;</span><br><span class="line">        <span class="keyword">this</span>.discardPolicy = discardPolicy;</span><br><span class="line">        <span class="keyword">this</span>.min = min;</span><br><span class="line">        <span class="keyword">this</span>.active = active;</span><br><span class="line">        <span class="keyword">this</span>.max = max;</span><br><span class="line">        init();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(MIN, ACTIVE, MAX, DEFAULT_TASK_QUEUE_SIZE, DEFAULT_DISCARD_POLICY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ± çš„çº¿ç¨‹ï¼Œç»´æŠ¤æ•´ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (!destroy) {</span><br><span class="line">            System.err.printf(<span class="string">"Pool#min:%d,active:%d,max:%d,currentSize:%d,taskRemain:%d\n"</span>,</span><br><span class="line">                    <span class="keyword">this</span>.min, <span class="keyword">this</span>.active, <span class="keyword">this</span>.max, <span class="keyword">this</span>.size, TASK_QUEUE.size());</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                <span class="keyword">if</span> (TASK_QUEUE.size() > active && size < active) {</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = size; i < active; i++) {</span><br><span class="line">                        createThreadQueue();</span><br><span class="line">                    }</span><br><span class="line">                    System.out.println(<span class="string">"increment to active success"</span>);</span><br><span class="line">                    <span class="keyword">this</span>.size = active;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (TASK_QUEUE.size() > max && size < MAX) {</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = size; i < max; i++) {</span><br><span class="line">                        createThreadQueue();</span><br><span class="line">                    }</span><br><span class="line">                    System.out.println(<span class="string">"increment to max success"</span>);</span><br><span class="line">                    <span class="keyword">this</span>.size = max;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (TASK_QUEUE.isEmpty() && size > active) {</span><br><span class="line">                    System.out.println(<span class="string">"==================reduce================="</span>);</span><br><span class="line">                    <span class="comment">//é˜²æ­¢å¹¶å‘ä¿®æ”¹ï¼Œåœ¨shutdownçš„æ—¶å€™reduce</span></span><br><span class="line">                    <span class="keyword">synchronized</span> (THREAD_QUEUE) {</span><br><span class="line">                        <span class="keyword">int</span> release = size - active;</span><br><span class="line">                        <span class="comment">//Itertorå¯ä»¥åœ¨éå†çš„è¿‡ç¨‹ä¸­remove</span></span><br><span class="line">                        <span class="keyword">for</span> (Iterator<mythread> it = THREAD_QUEUE.iterator(); it.hasNext(); ) {</mythread></span><br><span class="line">                            <span class="keyword">if</span> (release <= <span class="number">0</span>)</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            MyThread mt = it.next();</span><br><span class="line">                            <span class="comment">//å¦‚æœè¯¥çº¿ç¨‹åœ¨å·¥ä½œå°±ä¸è¦æ‰“æ–­å®ƒ</span></span><br><span class="line">                            <span class="keyword">if</span>(mt.getThreadState()==ThreadState.RUNNING){</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            }</span><br><span class="line">                            mt.close();</span><br><span class="line">                            mt.interrupt();</span><br><span class="line">                            it.remove();</span><br><span class="line">                            release--;</span><br><span class="line">                        }</span><br><span class="line">                        <span class="keyword">this</span>.size = active;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">/*    for (int i = 0; i < size; i++) {</span></span><br><span class="line"><span class="comment">            createThreadQueue();</span></span><br><span class="line"><span class="comment">        }*/</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="keyword">this</span>.min; i++) {</span><br><span class="line">            createThreadQueue();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">this</span>.size = min;</span><br><span class="line">        <span class="keyword">this</span>.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (destroy) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The Pool is shutdown , you can't submit now ! !"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">synchronized</span> (TASK_QUEUE) {</span><br><span class="line">            <span class="keyword">if</span> (TASK_QUEUE.size() > queueSize) {</span><br><span class="line">                discardPolicy.discard();</span><br><span class="line">            }</span><br><span class="line">            TASK_QUEUE.addLast(runnable);</span><br><span class="line">            <span class="comment">//å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</span></span><br><span class="line">            TASK_QUEUE.notifyAll();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        <span class="keyword">while</span> (!TASK_QUEUE.isEmpty()) {</span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> initVal = THREAD_QUEUE.size();</span><br><span class="line">        <span class="keyword">synchronized</span> (THREAD_QUEUE) {</span><br><span class="line">            <span class="keyword">while</span> (initVal > <span class="number">0</span>) {</span><br><span class="line">                <span class="keyword">for</span> (MyThread thread : THREAD_QUEUE) {</span><br><span class="line">                    <span class="keyword">if</span> (thread.getThreadState() == ThreadState.BLOCKED) {</span><br><span class="line">                        <span class="comment">//è®¾ç½®ä¸ºDEADçŠ¶æ€</span></span><br><span class="line">                        thread.close();</span><br><span class="line">                        thread.interrupt();</span><br><span class="line">                        initVal--;</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        Thread.sleep(<span class="number">10</span>);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">this</span>.destroy = <span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">"My Thread pool is shutdown"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.destroy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createThreadQueue</span><span class="params">()</span> </span>{</span><br><span class="line">        MyThread thread = <span class="keyword">new</span> MyThread(GROUP, THREAD_PREFIX + (seq++));</span><br><span class="line">        thread.start();</span><br><span class="line">        THREAD_QUEUE.add(thread);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> ThreadState {</span><br><span class="line">        FREE, RUNNING, BLOCKED, DEAD</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscardException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DiscardException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(message);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DiscardPolicy</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">discard</span><span class="params">()</span> <span class="keyword">throws</span> DiscardException</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> ThreadState threadState = ThreadState.FREE;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ThreadState <span class="title">getThreadState</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.threadState;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(ThreadGroup group, String name)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(group, name);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            OUTER:</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">this</span>.threadState != ThreadState.DEAD) {</span><br><span class="line">                Runnable runnable;</span><br><span class="line">                <span class="keyword">synchronized</span> (TASK_QUEUE) {</span><br><span class="line">                    <span class="keyword">while</span> (TASK_QUEUE.isEmpty()) {</span><br><span class="line">                        <span class="keyword">try</span> {</span><br><span class="line">                            <span class="keyword">this</span>.threadState = ThreadState.BLOCKED;</span><br><span class="line">                            TASK_QUEUE.wait();</span><br><span class="line">                        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                            System.out.println(Thread.currentThread().getName() + <span class="string">" is dead"</span>);</span><br><span class="line">                            <span class="keyword">break</span> OUTER;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    runnable = TASK_QUEUE.removeFirst();</span><br><span class="line">                }</span><br><span class="line">                Optional.of(runnable).ifPresent(t -> {</span><br><span class="line">                    <span class="keyword">this</span>.threadState = ThreadState.RUNNING;</span><br><span class="line">                    t.run();</span><br><span class="line">                    <span class="keyword">this</span>.threadState = ThreadState.FREE;</span><br><span class="line">                });</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.threadState = ThreadState.DEAD;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç›¸æ¯”ä¸Šé¢å›ºå®šçš„sizeè¿™ä¸ªç‰ˆæœ¬</p><p>â‘  å¢åŠ äº†ä¸‰ä¸ªå­—æ®µç”¨äºåŠ¨æ€çš„æ‰©å®¹ï¼Œå› ä¸ºéœ€è¦ç®¡ç†è¿™äº›çº¿ç¨‹ï¼Œæ‰€ä»¥å°†æ•´ä¸ªçº¿ç¨‹æ± ä¹Ÿç»§æ‰¿äº†<code>Thread</code>å¹¶å®ç°äº†runæ–¹æ³•ï¼Œä¸»è¦å°±æ˜¯åˆ¤æ–­<code>TASK_QUEUE.size() > active && size < active</code>å½“å‰ä»»åŠ¡é˜Ÿåˆ—ä»»åŠ¡å¤šäº<code>active</code>å¹¶ä¸”å½“å‰çº¿ç¨‹é˜Ÿåˆ—çº¿ç¨‹æ•°å°äº<code>active</code>ï¼Œå°±å¯ä»¥æ‰©å®¹åˆ°activeï¼ŒmaxåŒç†</p><p>â‘¡<code>TASK_QUEUE.isEmpty() && size > active</code> é—²æ—¶å›æ”¶ï¼Œä»»åŠ¡é˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡ï¼Œä½†æ˜¯çº¿ç¨‹é˜Ÿåˆ—çº¿ç¨‹è¿˜å¾ˆå¤šï¼Œæµªè´¹äº†èµ„æºï¼Œæ‰€ä»¥éœ€è¦<code>reduce</code>ä¸€äº›ç©ºé—²çš„çº¿ç¨‹ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªå°ç»†èŠ‚ï¼Œ1.åœ¨reduceå’Œshutdownçš„æ—¶å€™éœ€è¦åŒæ­¥<code>çº¿ç¨‹é˜Ÿåˆ—</code>ä¸ç„¶åœ¨<code>reduce</code>çš„æ—¶å€™<code>shutdown</code>ä¼šäº§ç”Ÿ<code>å¹¶å‘ä¿®æ”¹å¼‚å¸¸</code>ï¼ˆä¸€ä¸ªåœ¨éå†ï¼Œä¸€ä¸ªåœ¨removeï¼‰ã€‚</p><h3 id="æµ‹è¯•çº¿ç¨‹æ± "><a href="#æµ‹è¯•çº¿ç¨‹æ± " class="headerlink" title="æµ‹è¯•çº¿ç¨‹æ± "></a>æµ‹è¯•çº¿ç¨‹æ± </h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>{</span><br><span class="line">        SimpleThreadPool threadPool= <span class="keyword">new</span> SimpleThreadPool();</span><br><span class="line">        IntStream.rangeClosed(<span class="number">0</span>, <span class="number">40</span>)</span><br><span class="line">                .forEach(i -> {</span><br><span class="line">                    threadPool.submit(() -> {</span><br><span class="line">                        System.out.println(<span class="string">"The task "</span> + i + <span class="string">"  runnable by thread "</span> + Thread.currentThread().getName() + <span class="string">" start"</span>);</span><br><span class="line">                        <span class="keyword">try</span> {</span><br><span class="line">                            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        }</span><br><span class="line">                        System.out.println(<span class="string">"The task "</span> + i + <span class="string">"  runnable by thread "</span> + Thread.currentThread().getName() + <span class="string">" end"</span>);</span><br><span class="line">                    });</span><br><span class="line">                    System.out.println(<span class="string">"submit "</span> + i);</span><br><span class="line">                });</span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€ŠJavaå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜æŒ‡å—ã€‹ </li><li><a href="http://ifeve.com" target="_blank" rel="noopener">å¹¶å‘ç¼–ç¨‹ç½‘</a></li><li><a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.2.4" target="_blank" rel="noopener">Javaè¯­è¨€è§„èŒƒ</a></li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeé“¾è¡¨</title>
      <link href="/2019/02/27/leetcode-lian-biao/"/>
      <url>/2019/02/27/leetcode-lian-biao/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="2-ä¸¤æ•°ç›¸åŠ "><a href="#2-ä¸¤æ•°ç›¸åŠ " class="headerlink" title="2. ä¸¤æ•°ç›¸åŠ "></a>2. ä¸¤æ•°ç›¸åŠ </h2><p>ç»™å‡ºä¸¤ä¸ª <strong>éç©º</strong> çš„é“¾è¡¨ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å…¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„ä½æ•°æ˜¯æŒ‰ç…§ <strong>é€†åº</strong> çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ <strong>ä¸€ä½</strong> æ•°å­—ã€‚<br> å¦‚æœï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ•°ç›¸åŠ èµ·æ¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥è¡¨ç¤ºå®ƒä»¬çš„å’Œã€‚<br>æ‚¨å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚<br><strong>ç¤ºä¾‹ï¼š</strong><br><strong>è¾“å…¥ï¼š</strong>(2 -> 4 -> 3) + (5 -> 6 -> 4)<br><strong>è¾“å‡º</strong>ï¼š7 -> 0 -> 8<br><strong>åŸå› </strong>ï¼š342 + 465 = 807</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>{</span><br><span class="line">     <span class="comment">// å…ˆç”¨0è¡¥é½çŸ­çš„å“ªä¸€ä¸ª</span></span><br><span class="line">       ListNode n1 = l1;</span><br><span class="line">       ListNode n2 = l2;</span><br><span class="line">       <span class="keyword">while</span> (n1 != <span class="keyword">null</span> && n2 != <span class="keyword">null</span>) {</span><br><span class="line">           <span class="keyword">if</span> (n1.next == <span class="keyword">null</span> && n2.next != <span class="keyword">null</span>) {</span><br><span class="line">               n1.next = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">           } <span class="keyword">else</span> <span class="keyword">if</span> (n1.next != <span class="keyword">null</span> && n2.next == <span class="keyword">null</span>) {</span><br><span class="line">               n2.next = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">           } <span class="keyword">else</span> <span class="keyword">if</span> (n1.next == <span class="keyword">null</span> && n2.next == <span class="keyword">null</span>) {</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           }</span><br><span class="line">           n1 = n1.next;</span><br><span class="line">           n2 = n2.next;</span><br><span class="line">       }</span><br><span class="line">       <span class="comment">// ä»å¤´å¼€å§‹åŠ </span></span><br><span class="line">       ListNode res = <span class="keyword">null</span>;</span><br><span class="line">       <span class="comment">//å®é™…æ“ä½œçš„é“¾è¡¨</span></span><br><span class="line">       ListNode real=<span class="keyword">null</span>;</span><br><span class="line">       <span class="comment">// è¿›ä½</span></span><br><span class="line">       <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">while</span> (l1 != <span class="keyword">null</span>) {</span><br><span class="line">           <span class="comment">// å½“å‰ä½</span></span><br><span class="line">           m = (l1.val + l2.val) % <span class="number">10</span>+n;</span><br><span class="line">           <span class="comment">// åˆ¤æ–­è¿›ä½åæ˜¯å¦ä¸º10</span></span><br><span class="line">           <span class="keyword">if</span>(m==<span class="number">10</span>) {</span><br><span class="line">               m=<span class="number">0</span>;</span><br><span class="line">               n=<span class="number">1</span>;</span><br><span class="line">           }<span class="keyword">else</span> {         </span><br><span class="line">            <span class="comment">// è¿›ä½ 0 or 1</span></span><br><span class="line">            n = (l1.val + l2.val) / <span class="number">10</span>;</span><br><span class="line">           }</span><br><span class="line">           <span class="comment">// æ·»åŠ åˆ°åŸé“¾è¡¨çš„åé¢</span></span><br><span class="line">           <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡</span></span><br><span class="line">           <span class="keyword">if</span> (i == <span class="number">0</span>) {</span><br><span class="line">               real=res = <span class="keyword">new</span> ListNode(m);</span><br><span class="line">           } <span class="keyword">else</span> {</span><br><span class="line">               ListNode temp = <span class="keyword">new</span> ListNode(m);</span><br><span class="line">               real.next = temp;</span><br><span class="line">               real=temp;</span><br><span class="line">           }</span><br><span class="line">           <span class="comment">//åˆ¤æ–­ä½æ•°ç›¸åŒçš„æƒ…å†µä¸‹æœ€åä¸€ä½å’Œå¤§äº10çš„æƒ…å†µ</span></span><br><span class="line">           <span class="keyword">if</span>(n==<span class="number">1</span>&&l1.next==<span class="keyword">null</span>) {</span><br><span class="line">               <span class="comment">//åœ¨æœ€ååŠ ä¸ª1</span></span><br><span class="line">               real.next=<span class="keyword">new</span> ListNode(<span class="number">1</span>);</span><br><span class="line">           }</span><br><span class="line">           l2 = l2.next;</span><br><span class="line">           l1 = l1.next;</span><br><span class="line">           i++;</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¾ˆä¹…ä¹‹å‰å†™çš„ä»£ç äº†ï¼Œä»£ç å¾ˆä¹±ï¼Œç”¨0è¡¥é½çŸ­çš„é‚£ä¸ªç„¶åå¯¹åº”ç›¸åŠ æ³¨æ„è¿›ä½å°±è¡Œäº†ã€‚</p><h2 id="445-ä¸¤æ•°ç›¸åŠ â…¡"><a href="#445-ä¸¤æ•°ç›¸åŠ â…¡" class="headerlink" title="445. ä¸¤æ•°ç›¸åŠ â…¡"></a>445. ä¸¤æ•°ç›¸åŠ â…¡</h2><p>ç»™å®šä¸¤ä¸ª<strong>éç©º</strong>é“¾è¡¨æ¥ä»£è¡¨ä¸¤ä¸ªéè´Ÿæ•´æ•°ã€‚æ•°å­—æœ€é«˜ä½ä½äºé“¾è¡¨å¼€å§‹ä½ç½®ã€‚å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨å•ä¸ªæ•°å­—ã€‚å°†è¿™ä¸¤æ•°ç›¸åŠ ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚<br>ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°å­—éƒ½ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚<br><strong>è¿›é˜¶:</strong><br>å¦‚æœè¾“å…¥é“¾è¡¨ä¸èƒ½ä¿®æ”¹è¯¥å¦‚ä½•å¤„ç†ï¼Ÿæ¢å¥è¯è¯´ï¼Œä½ ä¸èƒ½å¯¹åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹è¿›è¡Œç¿»è½¬ã€‚<br><strong>ç¤ºä¾‹:</strong><br><strong>è¾“å…¥:</strong> (7 -> 2 -> 4 -> 3) + (5 -> 6 -> 4)<br><strong>è¾“å‡º:</strong> 7 -> 8 -> 0 -> 7</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>{</span><br><span class="line">    BigInteger b1 = <span class="keyword">new</span> BigInteger(list2num(l1));</span><br><span class="line">    BigInteger b2 = <span class="keyword">new</span> BigInteger(list2num(l2));</span><br><span class="line">    String resStr=b1.add(b2).toString();</span><br><span class="line">    <span class="comment">//å†å˜æˆå­—ç¬¦ä¸²å­˜åˆ°è¿è¡¨é‡Œé¢</span></span><br><span class="line">    ListNode res=<span class="keyword">new</span> ListNode(<span class="number">1</span>);</span><br><span class="line">    ListNode real=res;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<resstr.length();i++) {< span><br><span class="line">        real.next=<span class="keyword">new</span> ListNode(Integer.valueOf(resStr.charAt(i)-<span class="number">48</span>));</span><br><span class="line">        real=real.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res.next;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String  <span class="title">list2num</span><span class="params">(ListNode l)</span></span>{</span><br><span class="line">    String num=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">while</span>(l!=<span class="keyword">null</span>){</span><br><span class="line">        num=num+l.val;</span><br><span class="line">        l=l.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">}</span><br></resstr.length();i++)></span></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸¤é¢˜æ–¹æ³•å¾ˆå¤šï¼Œä¸‹é¢é‚£é¢˜å®é™…ä¸Šæ˜¯ä¸Šé¢é‚£ä¸€é¢˜åè¿‡æ¥çš„ï¼Œä½†æ˜¯é¢˜ç›®è¦æ±‚ä¸æ”¹å˜é“¾è¡¨æ‰€ä»¥å¯ä»¥åˆ©ç”¨æ ˆæ¥åè½¬ï¼Œç„¶åå°±è·Ÿä¸Šé¢çš„ç±»ä¼¼äº†ï¼Œç„¶åè¿™é‡Œæˆ‘å·äº†ä¸ªæ‡’ç”¨çš„<code>BigInteger</code>æçš„é€Ÿåº¦ä¹Ÿè¿˜è¡Œ 77%beatã€‚</p><hr><h2 id="876-é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹"><a href="#876-é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹" class="headerlink" title="876. é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹"></a><strong>876. é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹</strong></h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">middleNode</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">        ListNode fast=head;</span><br><span class="line">        ListNode slow=head;</span><br><span class="line">        <span class="comment">// 1 2 3 4 5 6 7</span></span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="keyword">null</span>&&fast.next!=<span class="keyword">null</span>){</span><br><span class="line">            fast=fast.next.next;</span><br><span class="line">            slow=slow.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p><code>å¿«æ…¢æŒ‡é’ˆ</code>ï¼Œå¾ˆå¸¸è§å¾ˆç»å…¸çš„åšæ³•åé¢å¾ˆå¤šé¢˜ä¼šç”¨åˆ°è¿™ä¸ªã€‚</p></blockquote><hr><h2 id="206-åè½¬é“¾è¡¨"><a href="#206-åè½¬é“¾è¡¨" class="headerlink" title="206. åè½¬é“¾è¡¨"></a><strong>206. åè½¬é“¾è¡¨</strong></h2><p>åè½¬ä¸€ä¸ªå•é“¾è¡¨ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p><strong>è¾“å…¥:</strong> 1->2->3->4->5->NULL<br><strong>è¾“å‡º:</strong> 5->4->3->2->1->NULL</p><p><strong>è¿›é˜¶:</strong><br>ä½ å¯ä»¥è¿­ä»£æˆ–é€’å½’åœ°åè½¬é“¾è¡¨ã€‚ä½ èƒ½å¦ç”¨ä¸¤ç§æ–¹æ³•è§£å†³è¿™é“é¢˜ï¼Ÿ</p><p><strong>è§£æ³•ä¸€:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line">    ListNode newHead = reverseList(head.next);</span><br><span class="line">    <span class="comment">//ä»åå¾€å‰</span></span><br><span class="line">    head.next.next = head;</span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒ:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸‰æŒ‡é’ˆè¿­ä»£</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">reverseList2</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    ListNode pre=head;</span><br><span class="line">    ListNode cur=head.next;</span><br><span class="line">    ListNode temp;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">        temp=cur.next;</span><br><span class="line">        cur.next=pre;</span><br><span class="line">        pre=cur;</span><br><span class="line">        cur=temp;</span><br><span class="line">    }</span><br><span class="line">    head.next=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><hr><h2 id="92-åè½¬é“¾è¡¨â…¡"><a href="#92-åè½¬é“¾è¡¨â…¡" class="headerlink" title="92. åè½¬é“¾è¡¨â…¡"></a><strong>92. åè½¬é“¾è¡¨â…¡</strong></h2><p>åè½¬ä»ä½ç½® <em>m</em> åˆ° <em>n</em> çš„é“¾è¡¨ã€‚è¯·ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®Œæˆåè½¬ã€‚</p><p><strong>è¯´æ˜:</strong><br>1 â‰¤ <em>m</em> â‰¤ <em>n</em> â‰¤ é“¾è¡¨é•¿åº¦ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p><strong>è¾“å…¥:</strong> 1->2->3->4->5->NULL, <em>m</em> = 2, <em>n</em> = 4<br><strong>è¾“å‡º:</strong> 1->4->3->2->5->NULL</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">reverseBetween</span><span class="params">(ListNode head, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(m==n) <span class="keyword">return</span> head;</span><br><span class="line">    <span class="comment">//ç”¨æ¥éå†</span></span><br><span class="line">    ListNode pre=head;</span><br><span class="line">    ListNode mid=head.next;</span><br><span class="line">    ListNode rear=<span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//åœ¨éå†çš„ä¸­é—´è¿æ¥è¿™ä¸ªè¡¨ æ—¶é—´å¤æ‚åšåº¦O(N)</span></span><br><span class="line">    <span class="comment">//æ‰€ä»¥éœ€è¦å…ˆä¿å­˜ må‰çš„èŠ‚ç‚¹ç”¨äºåé¢åˆ°nçš„æ—¶å€™è¿æ¥nå’Œå‰é¢çš„éƒ¨åˆ† preM</span></span><br><span class="line">    <span class="comment">//è¿˜è¦ä¿å­˜mèŠ‚ç‚¹ï¼Œåœ¨åé¢éå†åˆ°nçš„æ—¶å€™å°†MèŠ‚ç‚¹å’Œåé¢çš„éƒ¨åˆ†è¿æ¥</span></span><br><span class="line">    <span class="comment">//ä¸­é—´æ®µçš„å‰åèŠ‚ç‚¹ </span></span><br><span class="line">    ListNode preM =<span class="keyword">null</span>;</span><br><span class="line">    ListNode valM=head;</span><br><span class="line">    <span class="comment">//ListNode nNext=null;</span></span><br><span class="line">    <span class="keyword">int</span> count =<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(count <=n-<span class="number">1</span>){</span><br><span class="line">        <span class="comment">//countçš„ä½ç½®å®é™…ä¸Šæ˜¯æŒ‡çš„preçš„ä½ç½®å› ä¸ºåªæœ‰preæ˜¯ä»headå¼€å§‹èµ°çš„</span></span><br><span class="line">        <span class="comment">//å°¾æŒ‡é’ˆåç§»</span></span><br><span class="line">        rear=mid.next;</span><br><span class="line">        <span class="keyword">if</span>(count==m-<span class="number">1</span>){</span><br><span class="line">            <span class="comment">//ä¿å­˜Mç‚¹å‰é¢çš„èŠ‚ç‚¹å’ŒMèŠ‚ç‚¹</span></span><br><span class="line">            preM=pre;</span><br><span class="line">            valM=mid;</span><br><span class="line">            <span class="comment">//System.out.println("preM :"+preM.val);</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(count==n-<span class="number">1</span>){</span><br><span class="line">            <span class="comment">//è¿æ¥nåé¢èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">            valM.next=rear;</span><br><span class="line">            <span class="comment">//åœ¨è¿™é‡Œåˆ¤æ–­ä¸‹må‰æœ‰æ²¡æœ‰å…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span>(m==<span class="number">1</span>){</span><br><span class="line">                head=mid;</span><br><span class="line">            } <span class="keyword">else</span>{</span><br><span class="line">                preM.next=mid;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(count >= m && count <=n-<span class="number">1</span>){</span><br><span class="line">            <span class="comment">//åªæœ‰midçš„ä½ç½®å¤§äºmå°äºç­‰äºnæ‰ä¼šå°†èŠ‚ç‚¹nextåŸŸåè½¬</span></span><br><span class="line">            mid.next=pre;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å…¶ä»–ä¸¤ä¸ªæŒ‡é’ˆä¹Ÿå‘åç§»åŠ¨</span></span><br><span class="line">        pre=mid;</span><br><span class="line">        mid=rear;</span><br><span class="line">        count++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä»£ç å†™çš„æ¯”è¾ƒçƒ‚ä½†æ˜¯æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°ï¼Œåªæ‰«æäº†ä¸€éé“¾è¡¨ 2ms beat 100%ï¼Œä½†æ˜¯åˆ›å»ºçš„æŒ‡é’ˆæœ‰ç‚¹å¤šï¼ŒæŠ è¾¹ç•Œè¦ç»†å¿ƒã€‚</p><hr><h2 id="725-åˆ†éš”é“¾è¡¨"><a href="#725-åˆ†éš”é“¾è¡¨" class="headerlink" title="725. åˆ†éš”é“¾è¡¨"></a><strong><a href="https://leetcode-cn.com/problems/split-linked-list-in-parts/" target="_blank" rel="noopener">725. åˆ†éš”é“¾è¡¨</a></strong></h2><p>Given a (singly) linked list with head node <code>root</code>, write a function to split the linked list into <code>k</code> consecutive linked list â€œpartsâ€.</p><p>The length of each part should be as equal as possible: no two parts should have a size differing by more than 1. This may lead to some parts being null.</p><p>The parts should be in order of occurrence in the input list, and parts occurring earlier should always have a size greater than or equal parts occurring later.</p><p>Return a List of ListNodeâ€™s representing the linked list parts that are formed.</p><p>Examples 1->2->3->4, k = 5 // 5 equal parts [ [1], [2], [3], [4], null ]</p><p><strong>Example 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line">root = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], k = <span class="number">5</span></span><br><span class="line">Output: [[<span class="number">1</span>],[<span class="number">2</span>],[<span class="number">3</span>],[],[]]</span><br><span class="line">Explanation:</span><br><span class="line">The input and each element of the output are ListNodes, not arrays.</span><br><span class="line">For example, the input root has root.val = <span class="number">1</span>, root.next.val = <span class="number">2</span>, \root.next.next.val = <span class="number">3</span>, and root.next.next.next = <span class="keyword">null</span>.</span><br><span class="line">The first element output[<span class="number">0</span>] has output[<span class="number">0</span>].val = <span class="number">1</span>, output[<span class="number">0</span>].next = <span class="keyword">null</span>.</span><br><span class="line">The last element output[<span class="number">4</span>] is <span class="keyword">null</span>, but it<span class="string">'s string representation as a ListNode is [].</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>Example 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Input: </span><br><span class="line">root = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>], k = <span class="number">3</span></span><br><span class="line">Output: [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>], [<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]]</span><br><span class="line">Explanation:</span><br><span class="line">The input has been split into consecutive parts with size difference at most <span class="number">1</span>, and earlier parts are a larger size than the later parts.</span><br></pre></td></tr></tbody></table></figure></div><p><strong>Note:</strong></p><p>The length of <code>root</code> will be in the range <code>[0, 1000]</code>.</p><p>Each value of a node in the input will be an integer in the range <code>[0, 999]</code>.</p><p><code>k</code> will be an integer in the range <code>[1, 50]</code>.</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode[] splitListToParts(ListNode root, <span class="keyword">int</span> k) {</span><br><span class="line">    <span class="comment">//å…ˆè¦è·å–ä¸‹é“¾è¡¨çš„é•¿åº¦</span></span><br><span class="line">    ListNode temp=root;</span><br><span class="line">    ListNode next=root;</span><br><span class="line">    ListNode [] result=<span class="keyword">new</span> ListNode[k];</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        temp=temp.next;</span><br><span class="line">        count++;</span><br><span class="line">    }</span><br><span class="line">    temp=root;</span><br><span class="line">    <span class="comment">//ä»»æ„ä¸¤éƒ¨åˆ†å·®è·ä¸èƒ½å¤§äº1ï¼Œå¤§çš„åœ¨å‰ï¼Œå°çš„åœ¨åé¢</span></span><br><span class="line">    <span class="comment">//å…¶å®å°±æ˜¯å¯¹countè¿›è¡Œåˆ†é…</span></span><br><span class="line">    <span class="comment">//æ³¨æ„: æœ‰nullçš„æƒ…å†µä¸€å®šæ˜¯ k>count ç›´æ¥æŒ‰ 1 åˆ‡åˆ†å°±å®Œäº‹äº†</span></span><br><span class="line">    <span class="comment">//k<countçš„æƒ…å†µåªè¦åœ¨ count k çš„å‰å‡ ä¸ªå…ƒç´ ä¸ŠåŠ ä¸Š çš„ä½™æ•°å°±è¡Œäº†< span></countçš„æƒ…å†µåªè¦åœ¨></span><br><span class="line">    <span class="keyword">int</span> size=count/k;</span><br><span class="line">    <span class="keyword">int</span> num=count%k;</span><br><span class="line">    result[<span class="number">0</span>]=root;</span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(k<=count){</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;temp!=<span class="keyword">null</span> && index < k;i++){</span><br><span class="line">            next=temp.next;</span><br><span class="line">            <span class="keyword">if</span>(i<=(size+<span class="number">1</span>)*num && i%(size+<span class="number">1</span>)==<span class="number">0</span>){</span><br><span class="line">                <span class="comment">//å‰å‡ ä¸ªresçš„åˆ†å‰²ç‚¹</span></span><br><span class="line">                result[index++]=next;</span><br><span class="line">                <span class="comment">//åˆ‡æ–­</span></span><br><span class="line">                temp.next=<span class="keyword">null</span>;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span>(i>(size+<span class="number">1</span>)*num && (i-num)%size==<span class="number">0</span>){</span><br><span class="line">                result[index++]=next;</span><br><span class="line">                temp.next=<span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">            temp=next;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span>{</span><br><span class="line">        <span class="comment">//å‰©ä¸‹çš„æƒ…å†µå°±æ˜¯åé¢è¦è¡¥nullçš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œä¸¤ç§æƒ…å†µåº”è¯¥æ˜¯å¯ä»¥åˆå¹¶çš„ï¼Œä½†æ˜¯k>count num>0 æ‡’å¾—å»æŠ è¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<k;i++){< span><br><span class="line">            <span class="keyword">if</span>(temp==<span class="keyword">null</span>){</span><br><span class="line">                <span class="comment">//è¿™ä¸ªifå…¶å®æ²¡å¿…è¦</span></span><br><span class="line">                result[i]=<span class="keyword">null</span>;</span><br><span class="line">            } <span class="keyword">else</span>{</span><br><span class="line">                next=temp.next;</span><br><span class="line">                result[i]=next;</span><br><span class="line">                temp.next=<span class="keyword">null</span>;</span><br><span class="line">                temp=next;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></k;i++){<></span></span></pre></td></tr></tbody></table></figure></div><p>3ms beat 89% è¿™é¢˜ä¹Ÿæ¯”è¾ƒç®€å•ä¸»è¦æ˜¯è¾¹ç•Œè¦æŠ å¥½</p><hr><h2 id="86-åˆ†éš”-å‰²-é“¾è¡¨"><a href="#86-åˆ†éš”-å‰²-é“¾è¡¨" class="headerlink" title="86. åˆ†éš”(å‰²)é“¾è¡¨"></a><strong>86. åˆ†éš”(å‰²)é“¾è¡¨</strong></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨å’Œä¸€ä¸ªç‰¹å®šå€¼_ x_ï¼Œå¯¹é“¾è¡¨è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ‰€æœ‰å°äº <em>x</em> çš„èŠ‚ç‚¹éƒ½åœ¨å¤§äºæˆ–ç­‰äº <em>x</em> çš„èŠ‚ç‚¹ä¹‹å‰ã€‚</p><p>ä½ åº”å½“ä¿ç•™ä¸¤ä¸ªåˆ†åŒºä¸­æ¯ä¸ªèŠ‚ç‚¹çš„åˆå§‹ç›¸å¯¹ä½ç½®ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p><strong>è¾“å…¥:</strong> head = 1->4->3->2->5->2, <em>x</em> = 3<br><strong>è¾“å‡º:</strong> 1->2->2->4->3->5</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">partition</span><span class="params">(ListNode head, <span class="keyword">int</span> x)</span> </span>{</span><br><span class="line">    <span class="comment">//å…ˆåœ¨å¤´éƒ¨åŠ ä¸€ä¸ªdummyèŠ‚ç‚¹ç»Ÿä¸€æ“ä½œ</span></span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    dummyNode.next=head;</span><br><span class="line">    <span class="comment">//åˆ†å‰²ç‚¹</span></span><br><span class="line">    ListNode pre=cutNode=dummyNode;</span><br><span class="line">    ListNode cur=head;</span><br><span class="line">    <span class="keyword">int</span> cut=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(cur.val>=x&&cut==<span class="number">0</span>){</span><br><span class="line">            <span class="comment">//åªä¼šæ‰§è¡Œä¸€æ¬¡åœ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªval>=xçš„èŠ‚ç‚¹çš„æ—¶å€™---ä¿å­˜åˆ†å‰²ç‚¹</span></span><br><span class="line">            cutNode=pre;</span><br><span class="line">            cut=<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(cur.val<x && cut="=<span" class="number">1</x></span>){<br><span class="line">            <span class="comment">//æ‰¾åˆ°åˆ†å‰²ç‚¹å éå†åˆ°val<xçš„èŠ‚ç‚¹çš„æƒ…å†µ---å°†curè¿æ¥åˆ°cutnodeçš„åé¢ å¤„ç†å¥½curç›¸é‚»çš„ä¸¤ä¸ªèŠ‚ç‚¹< span></xçš„èŠ‚ç‚¹çš„æƒ…å†µ---å°†curè¿æ¥åˆ°cutnodeçš„åé¢></span><br><span class="line">            <span class="comment">//å…ˆå¤„ç†å¥½curç›¸é‚»çš„èŠ‚ç‚¹</span></span><br><span class="line">            pre.next=cur.next;</span><br><span class="line">            <span class="comment">//è¿æ¥cutNode</span></span><br><span class="line">            cur.next=cutNode.next;</span><br><span class="line">            cutNode.next=cur;</span><br><span class="line">            <span class="comment">//cutNodeåç§»</span></span><br><span class="line">            cutNode=cur;</span><br><span class="line">        }</span><br><span class="line">        pre=cur;</span><br><span class="line">        cur=cur.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next</span><br><span class="line">}</span><br></span></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜ä¹ŸæŒºç®€å•å’Œä¸Šé¢çš„é‚£é¢˜åå­—ä¸€æ ·æ˜¯åœ¨æ•´ç†è¿™ç¯‡åšå®¢çš„æ—¶å€™ç°åœºåšçš„(2019.2.27)å‰åå¤§æ¦‚åŠä¸ªå°æ—¶orzã€‚ã€‚ã€‚æ¯”è¾ƒèœï¼Œä½†æ˜¯è¿™ä¸ªæˆ‘æ²¡æœ‰åœ¨æœ¬åœ°è·‘ç›´æ¥åœ¨LeetCodeä¸Šæäº¤çš„ç„¶åå°±è¿‡äº† 1ms beat84% æ„Ÿè§‰æ€è·¯æ¯”è¾ƒæ¸…æ™°å°±æ²¡æœ‰æœ¬åœ°è·‘ï¼Œæäº¤è®°å½•ä¸Šæœ€å¿«çš„å±…ç„¶æ˜¯ç”¨äº†é¢å¤–ç©ºé—´newäº†ä¸¤ä¸ªé“¾è¡¨ç„¶åè¿èµ·æ¥çš„ã€‚ã€‚ã€‚é†‰äº†å¯èƒ½æ˜¯æµ‹è¯•ç”¨ä¾‹å¤ªå°‘äº†ã€‚</p><hr><h2 id="160-ç›¸äº¤é“¾è¡¨"><a href="#160-ç›¸äº¤é“¾è¡¨" class="headerlink" title="160. ç›¸äº¤é“¾è¡¨"></a><strong>160. ç›¸äº¤é“¾è¡¨</strong></h2><p>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾åˆ°ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚<br>å¦‚ä¸‹é¢çš„ä¸¤ä¸ªé“¾è¡¨ï¼š<br><img alt="mark" data-src="http://static.imlgw.top///20190303/NVEXndTcF1R6.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/ymln2djUVieT.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è¾“å…¥</strong>: intersectVal = 8, listA = [4,1,8,4,5], listB = [5,0,1,8,4,5], skipA = 2, skipB = 3<br><strong>è¾“å‡º</strong>: Reference of the node with value = 8<br><strong>è¾“å…¥è§£é‡Š</strong>:ç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/2F7qqhkUIWog.png?imageslim" src="/img/loading.gif" class="lazyload"><br><strong>è¾“å…¥</strong>:intersectVal = 2, listA = [0,9,1,2,4], listB = [3,2,4], skipA = 3, skipB = 1<br><strong>è¾“å‡º</strong>:Reference of the node with value = 2<br><strong>è¾“å…¥è§£é‡Š</strong>:ç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 2 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [0,9,1,2,4]ï¼Œé“¾è¡¨ B ä¸º [3,2,4]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 1 ä¸ªèŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/hKSAelGSE1TY.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è¾“å…¥</strong>:intersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3, skipB = 2<br><strong>è¾“å‡º</strong>:null<br><strong>è¾“å…¥è§£é‡Š</strong>:ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [2,6,4]ï¼Œé“¾è¡¨ B ä¸º [1,5]ã€‚ç”±äºè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ intersectVal å¿…é¡»ä¸º 0ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚<br><strong>è§£é‡Š</strong>:è¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å› nullã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› <code>null</code>.</li><li>åœ¨è¿”å›ç»“æœåï¼Œä¸¤ä¸ªé“¾è¡¨ä»é¡»ä¿æŒåŸæœ‰çš„ç»“æ„ã€‚</li><li>å¯å‡å®šæ•´ä¸ªé“¾è¡¨ç»“æ„ä¸­æ²¡æœ‰å¾ªç¯ã€‚</li><li>ç¨‹åºå°½é‡æ»¡è¶³ O(<em>n</em>) æ—¶é—´å¤æ‚åº¦ï¼Œä¸”ä»…ç”¨ O(<em>1</em>) å†…å­˜ã€‚</li></ul><p><strong>è§£æ³•ä¸€ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> </span>{</span><br><span class="line">    ListNode pA=headA;</span><br><span class="line">    ListNode pB=headB;</span><br><span class="line">    <span class="comment">//è®¡ç®—ä¸¤ä¸ªé“¾è¡¨é•¿åº¦ç„¶åè®¡ç®—å·®è·ç„¶åå‘åå¯¹é½</span></span><br><span class="line">    <span class="keyword">int</span> lenA=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> lenB=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(pA!=<span class="keyword">null</span>){</span><br><span class="line">        pA=pA.next;</span><br><span class="line">        lenA++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(pB!=<span class="keyword">null</span>){</span><br><span class="line">        pB=pB.next;</span><br><span class="line">        lenB++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> dis=lenB>lenA?lenB-lenA:lenA-lenB;</span><br><span class="line">    <span class="keyword">if</span>(lenB>lenA){</span><br><span class="line">        <span class="keyword">while</span>(dis--><span class="number">0</span>){</span><br><span class="line">            headB=headB.next;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span>{</span><br><span class="line">        <span class="keyword">while</span>(dis--><span class="number">0</span>){</span><br><span class="line">            headA=headA.next;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸ç›¸ç­‰å°±ä¸€ç›´å‘åç§»</span></span><br><span class="line">    <span class="keyword">while</span>(headA!=headB){</span><br><span class="line">        <span class="comment">//å¦‚æœæœ‰ä¸€æ¡ä¸ºç©ºè¯´æ˜æ²¡æœ‰äº¤ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(headA.next==<span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        headA=headA.next;</span><br><span class="line">        headB=headB.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> headA;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§æ–¹æ³•æ¯”è¾ƒç›´æ¥ç›´æ¥è®¡ç®—ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ç„¶åè®¡ç®—å·®å€¼ç„¶åå°†é•¿çš„é‚£ä¸ªç§»åŠ¨åˆ°å¯¹åº”çš„ä½ç½®è®©<code>ä¸¤æ¡é“¾è¡¨å°¾å¯¹é½</code>ç„¶åä¸€èµ·å‘åç§»åŠ¨<br><strong>è§£æ³•äºŒï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•äºŒ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">getIntersectionNode2</span><span class="params">(ListNode headA, ListNode headB)</span> </span>{</span><br><span class="line">    <span class="comment">//å½“ä¸€ä¸ªæŒ‡é’ˆåˆ°ç»“å°¾æ—¶è½¬åˆ°å¦ä¸€ä¸ªé“¾è¡¨å¤´å†å‘åç§»åŠ¨ ï¼Œè¿™æ ·åšçš„ç›®çš„å’Œå°±æ˜¯å¯ä»¥ç›´æ¥æ¶ˆé™¤é“¾è¡¨ä¹‹é—´çš„é•¿åº¦å·®ï¼Œå‘åå¯¹é½ï¼Œæ–¹æ³•è¿˜æ˜¯å¾ˆå·§å¦™çš„ã€‚</span></span><br><span class="line">    ListNode pA=headA;</span><br><span class="line">    ListNode pB=headB;</span><br><span class="line">    <span class="keyword">if</span>(headB==<span class="keyword">null</span> || headA==<span class="keyword">null</span>)</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//while(pA!=null && pB!=null ){</span></span><br><span class="line">    <span class="keyword">while</span>(pA!=pB){</span><br><span class="line">        <span class="comment">//è¦ä¿è¯ä¸¤ä¸ª==nullçš„æ—¶å€™éƒ½åªèƒ½æ‰§è¡Œä¸€æ¬¡ä¸ç„¶å¦‚æœæ²¡æœ‰äº¤ç‚¹å°±ä¼šæ­»å¾ªç¯</span></span><br><span class="line">        <span class="comment">//æ”¹å˜whileçš„æ¡ä»¶</span></span><br><span class="line">        <span class="comment">//æ”¹å˜pAï¼ŒpBè·³è½¬çš„æ¡ä»¶</span></span><br><span class="line">        <span class="comment">//è¿™æ ·å°±å¯ä»¥ä¿è¯æœ€åæ²¡äº¤ç‚¹çš„æ—¶å€™ ç¬¬äºŒéå¾ªç¯pAå’ŒpBæœ€åä¼šåŒæ—¶ç­‰äºnullä¼šæœ‰å‡ºå£ä¸ä¼šæ­»å¾ªç¯</span></span><br><span class="line">        pA=pA==<span class="keyword">null</span>?headB:pA.next;</span><br><span class="line">        pB=pB==<span class="keyword">null</span>?headA:pB.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> pA;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p> åŒæ—¶éå†ä¸¤ä¸ªé“¾è¡¨ï¼Œå½“ä¸€ä¸ªæŒ‡é’ˆåˆ°ç»“å°¾æ—¶è½¬åˆ°å¦ä¸€ä¸ªé“¾è¡¨å¤´å†å‘åç§»åŠ¨ ï¼Œè¿™æ ·åšçš„ç›®çš„å’Œå°±æ˜¯å¯ä»¥ç›´æ¥æ¶ˆé™¤é“¾è¡¨ä¹‹é—´çš„é•¿åº¦å·®ï¼Œä½¿ä¹‹å°¾å¯¹é½ï¼Œæ–¹æ³•è¿˜æ˜¯å¾ˆå·§å¦™çš„ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒç®€æ´ã€‚</p></blockquote><hr><h2 id="234-å›æ–‡é“¾è¡¨"><a href="#234-å›æ–‡é“¾è¡¨" class="headerlink" title="234. å›æ–‡é“¾è¡¨"></a><strong>234. å›æ–‡é“¾è¡¨</strong></h2><p>è¯·åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><p><strong>è¾“å…¥:</strong> 1->2<br><strong>è¾“å‡º:</strong> false</p><p><strong>ç¤ºä¾‹ 2:</strong></p><p><strong>è¾“å…¥:</strong> 1->2->2->1<br><strong>è¾“å‡º:</strong> true</p><p><strong>è¿›é˜¶ï¼š</strong><br>ä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å’Œ O(1) ç©ºé—´å¤æ‚åº¦è§£å†³æ­¤é¢˜ï¼Ÿ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span> || head.next==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// åˆ©ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­ç‚¹</span></span><br><span class="line">    ListNode fast = head;</span><br><span class="line">    ListNode slow = head;</span><br><span class="line">    <span class="keyword">while</span> (fast.next != <span class="keyword">null</span>) {</span><br><span class="line">        fast = fast.next.next == <span class="keyword">null</span> ? fast.next : fast.next.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å¶æ•°èŠ‚ç‚¹ï¼Œslowå°±æ˜¯åå³çš„é‚£ä¸ª å¥‡æ•°å°±æ˜¯æ­£ä¸­é—´çš„ å¥‡æ•°åœ¨æ­£ä¸­é—´ä¸ç”¨ç®¡</span></span><br><span class="line">    <span class="comment">// fastæ˜¯å°¾èŠ‚ç‚¹ 1 1 1 1 1 1</span></span><br><span class="line">    resverList(slow);</span><br><span class="line">    <span class="comment">//slow.next==null</span></span><br><span class="line">    <span class="comment">// check</span></span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="keyword">null</span> && head != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">if</span> (fast.val != head.val) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        fast = fast.next;</span><br><span class="line">        head = head.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">resverList</span><span class="params">(ListNode node)</span> </span>{</span><br><span class="line">    ListNode cur = node;</span><br><span class="line">    ListNode pre = <span class="keyword">null</span>;</span><br><span class="line">    ListNode next = node;</span><br><span class="line">    <span class="keyword">while</span> (cur != <span class="keyword">null</span>) {</span><br><span class="line">        next = next.next;</span><br><span class="line">        cur.next = pre;</span><br><span class="line">        pre = cur;</span><br><span class="line">        cur = next;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜å°±ç”¨åˆ°äº†ä¸Šé¢çš„ç¿»è½¬é“¾è¡¨çš„æ–¹æ³•ï¼Œä¸è¿‡è¿™é‡Œåªç¿»è½¬äº†ä¸€åŠï¼Œç¿»è½¬äº†ååŠæ®µç„¶åä»ä¸¤è¾¹åˆ°ä¸­é—´é€ä¸ªèŠ‚ç‚¹å¯¹æ¯”</p><hr><h2 id="237-åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"><a href="#237-åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹" class="headerlink" title="237. åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"></a><strong>237. åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</strong></h2><p>è¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶å¯ä»¥åˆ é™¤æŸä¸ªé“¾è¡¨ä¸­ç»™å®šçš„ï¼ˆéæœ«å°¾ï¼‰èŠ‚ç‚¹ï¼Œä½ å°†åªè¢«ç»™å®šè¦æ±‚è¢«åˆ é™¤çš„èŠ‚ç‚¹ã€‚</p><p>ç°æœ‰ä¸€ä¸ªé“¾è¡¨ â€“ head = [4,5,1,9]ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸º:</p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/9MUvMzlcAN0G.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¤ºä¾‹ 1:</strong></p><p><strong>è¾“å…¥:</strong> head = [4,5,1,9], node = 5<br><strong>è¾“å‡º:</strong> [4,1,9]<br><strong>è§£é‡Š:</strong> ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 5 çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -> 1 -> 9.</p><p><strong>ç¤ºä¾‹ 2:</strong></p><p><strong>è¾“å…¥:</strong> head = [4,5,1,9], node = 1<br><strong>è¾“å‡º:</strong> [4,5,9]<br><strong>è§£é‡Š:</strong> ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 1 çš„ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -> 5 -> 9.</p><p><strong>è¯´æ˜:</strong></p><ul><li>é“¾è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ã€‚</li><li>é“¾è¡¨ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li>ç»™å®šçš„èŠ‚ç‚¹ä¸ºéæœ«å°¾èŠ‚ç‚¹å¹¶ä¸”ä¸€å®šæ˜¯é“¾è¡¨ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹ã€‚</li><li>ä¸è¦ä»ä½ çš„å‡½æ•°ä¸­è¿”å›ä»»ä½•ç»“æœã€‚</li></ul><p><strong>äºŒè´§åšæ³•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteNodelow</span><span class="params">(ListNode node)</span> </span>{</span><br><span class="line">    <span class="comment">//æ€è·¯å°±æ˜¯å’Œnodeåé¢çš„å…ƒç´ ä¸€ç›´äº¤æ¢ï¼Œå°±åƒå†’æ³¡æ’åºä¸€æ ·</span></span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode temp=<span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">    ListNode pre=temp;</span><br><span class="line">    <span class="keyword">while</span>(node.next!=<span class="keyword">null</span>){</span><br><span class="line">        next=node.next;</span><br><span class="line">        <span class="keyword">if</span>(node.next.next==<span class="keyword">null</span>){</span><br><span class="line">            pre=node;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å…ˆä¿å­˜æœ€åä¸€ä¸ªèŠ‚ç‚¹å‰çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">//äº¤æ¢å½“å‰èŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        temp.val=node.val;</span><br><span class="line">        node.val=next.val;</span><br><span class="line">        next.val=temp.val;</span><br><span class="line">        node=next;</span><br><span class="line">    }</span><br><span class="line">    pre.next=<span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é¦–å…ˆæƒ³åˆ°çš„æ„šè ¢çš„åšæ³•,æ€ä¹ˆè¿™ä¹ˆè ¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><p><strong>æ­£ç¡®åšæ³•</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteNode</span><span class="params">(ListNode node)</span> </span>{</span><br><span class="line">      node.val=node.next.val;</span><br><span class="line">      node.next=node.next.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><hr><h2 id="203-ç§»é™¤é“¾è¡¨å…ƒç´ "><a href="#203-ç§»é™¤é“¾è¡¨å…ƒç´ " class="headerlink" title="203. ç§»é™¤é“¾è¡¨å…ƒç´ "></a><strong>203. ç§»é™¤é“¾è¡¨å…ƒç´ </strong></h2><p>åˆ é™¤é“¾è¡¨ä¸­ç­‰äºç»™å®šå€¼ <strong>_val _</strong>çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p><strong>è¾“å…¥:</strong> 1->2->6->3->4->5->6, <em><strong>val</strong></em> = 6<br><strong>è¾“å‡º:</strong> 1->2->3->4->5</p><p><strong>è§£æ³•ä¸€ï¼š</strong><br>åŒæŒ‡é’ˆ + è™šæ‹Ÿå¤´èŠ‚ç‚¹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">removeElements</span><span class="params">(ListNode head, <span class="keyword">int</span> val)</span> </span>{</span><br><span class="line">       <span class="keyword">if</span> (head == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       ListNode dummyHead = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">       <span class="comment">//å†å¤´æ¥å¾…ä½ ä¹‹å‰åŠ äº†æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">       dummyHead.next = head;</span><br><span class="line">       ListNode pre = dummyHead, cur = head;</span><br><span class="line">       <span class="keyword">while</span> (cur != <span class="keyword">null</span>) {</span><br><span class="line">           <span class="keyword">if</span> (cur.val == val) {</span><br><span class="line">               pre.next = cur.next;</span><br><span class="line">           } <span class="keyword">else</span> {</span><br><span class="line">               <span class="comment">//ä¸æ˜¯ç›¸ç­‰çš„å€¼å°±å‘åç§»åŠ¨</span></span><br><span class="line">               pre = cur;</span><br><span class="line">           }</span><br><span class="line">           cur = cur.next;</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span> dummyHead.next;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒï¼š</strong></p><p>é€’å½’æ–¹æ³•æ¯”è¾ƒç®€æ´</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">removeElements2</span><span class="params">(ListNode head, <span class="keyword">int</span> val)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span>)</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//å°†ä¸‹ä¸€ä¸ªå…ƒç´ æ”¾è¿›é€’å½’å¦‚æœæ˜¯==valçš„å°±ä¼šæŠŠä¸‹ä¸€ä¸ªçš„ä¸‹ä¸€ä¸ªå…ƒç´ è¿”å›è¿æ¥åˆ°å½“å‰å…ƒç´ </span></span><br><span class="line">    head.next = removeElements2(head.next, val);</span><br><span class="line">    <span class="keyword">return</span> head.val == val ? head.next : head;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><hr><h2 id="19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"><a href="#19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹" class="headerlink" title="19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"></a><strong>19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</strong></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚<br>ç¤ºä¾‹ï¼š<br>ç»™å®šä¸€ä¸ªé“¾è¡¨: 1->2->3->4->5, å’Œ n = 2.<br>å½“åˆ é™¤äº†å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹åï¼Œé“¾è¡¨å˜ä¸º 1->2->3->5.<br>è¯´æ˜ï¼š<br>ç»™å®šçš„ n ä¿è¯æ˜¯æœ‰æ•ˆçš„ã€‚<br>è¿›é˜¶ï¼š<br>ä½ èƒ½å°è¯•ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®ç°å—ï¼Ÿ</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">removeNthFromEnd</span><span class="params">(ListNode head, <span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>&&head.next==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//åŒæŒ‡é’ˆ ä¸»è¦æ˜¯å¤´å’Œå°¾çš„åˆ é™¤éœ€è¦æŠ ä¸€ä¸‹è¾¹ç•Œ</span></span><br><span class="line">    <span class="comment">//  -1 | 1 2 3 4 5 6</span></span><br><span class="line">    ListNode fast=head;</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    dummyNode.next=head;</span><br><span class="line">    ListNode slow=dummyNode;</span><br><span class="line">    <span class="comment">//åŠ äº†å“‘èŠ‚ç‚¹ï¼Œç›´æ¥å…ˆåŠ 1</span></span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="keyword">null</span>){</span><br><span class="line">        fast=fast.next;</span><br><span class="line">        slow=count<n?slow:slow.next;< span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">if</span>(fast.next==<span class="keyword">null</span>){</span><br><span class="line">            <span class="comment">//slowåˆ°è¾¾éœ€è¦åˆ é™¤çš„ä½ç½®çš„å‰ä¸€ä¸ª</span></span><br><span class="line">            slow.next=slow.next.next;</span><br><span class="line">            <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></n?slow:slow.next;<></span></pre></td></tr></tbody></table></figure></div><p>çœ‹äº†è¯„è®ºæ‰çŸ¥é“å’‹ä¸€éå¾ªç¯ï¼Œä¸»è¦å°±æ˜¯æ§åˆ¶slowæŒ‡é’ˆèµ°<code>length-n</code>æ­¥ï¼Œè®©å¿«æŒ‡é’ˆå…ˆèµ°næ­¥ï¼Œç„¶åå¿«æ…¢ä¸€èµ·èµ°ï¼Œå¿«æŒ‡é’ˆåˆ°å¤´æ—¶æ…¢æŒ‡é’ˆå°±åˆ°<code>length-n</code>çš„ä½ç½®äº†ï¼Œè¿™é¢˜ä¹Ÿå¯ä»¥ç”¨Listä¿å­˜æ¯ä¸ªèŠ‚ç‚¹è®©ç„¶åæŠŠå¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å‰ä¸€ä¸ªæ‹¿å‡ºæ¥æ“ä½œï¼Œéå†ä¸¤éçš„æ–¹æ³•æ¯”è¾ƒç®€å•å°±ä¸å†™äº†ï¼Œæ„Ÿè§‰è¿™ç§æ–¹æ³•æ¯”è¾ƒå¥½ , è¿™é¢˜çš„OJ caseæ¯”è¾ƒå°‘æ‰€ä»¥æ²¡ä»€ä¹ˆå¯æ¯”æ€§ , å‰å‡ ä¸ªéƒ½æ˜¯è·‘äº†ä¸¤éçš„ï¼Œæˆ‘æŠŠæœ€å¿«çš„æ‹·è¿‡æ¥è·‘çš„æ¯”æˆ‘è¿˜æ…¢ã€‚ã€‚ã€‚ã€‚ç„¶åæˆ‘åˆæäº¤äº†ä¸€æ¬¡ beat 90%â€¦â€¦.</p><hr><h2 id="82-åˆ é™¤é“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ â…¡"><a href="#82-åˆ é™¤é“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ â…¡" class="headerlink" title="82. åˆ é™¤é“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ â…¡"></a><strong>82. åˆ é™¤é“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ â…¡</strong></h2><p>ç»™å®šä¸€ä¸ªæ’åºé“¾è¡¨ï¼Œåˆ é™¤æ‰€æœ‰å«æœ‰é‡å¤æ•°å­—çš„èŠ‚ç‚¹ï¼Œåªä¿ç•™åŸå§‹é“¾è¡¨ä¸­ _æ²¡æœ‰é‡å¤å‡ºç° _çš„æ•°å­—ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><p><strong>è¾“å…¥:</strong> 1->2->3->3->4->4->5<br><strong>è¾“å‡º:</strong> 1->2->5</p><p><strong>ç¤ºä¾‹ 2:</strong></p><p><strong>è¾“å…¥:</strong> 1->1->1->2->3<br><strong>è¾“å‡º:</strong> 2->3</p><blockquote><p>ä¹ä¸€çœ‹è·Ÿä¸Šé¢é‚£ä¸€é¢˜ä¸€æ ·ï¼Ÿè¿™é¢˜æ˜¯æ’åºé“¾è¡¨ä¸Šé¢é‚£é¢˜æ˜¯æ— åºçš„ï¼Œè€Œä¸”è¿™é¢˜ä¸ç»™å®šå…ƒç´ </p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> ListNode <span class="title">deleteDuplicates</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//é¦–å…ˆæƒ³åˆ°çš„æ€è·¯æ˜¯3æŒ‡é’ˆï¼Œç„¶åéå†çš„è¿‡ç¨‹ä¸­åé¢çš„æŒ‡é’ˆé‡åˆ°==valçš„æƒ…å†µå°±è®©åé¢çš„æŒ‡é’ˆä¸€ç›´åç§»èµ°åˆ°ï¼=val</span></span><br><span class="line">    <span class="comment">//å…ˆæ·»åŠ ä¸ªå“‘èŠ‚ç‚¹</span></span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    dummyNode.next=head;</span><br><span class="line">    ListNode cur=head;</span><br><span class="line">    ListNode next=head.next;</span><br><span class="line">    ListNode pre=dummyNode;</span><br><span class="line">    <span class="keyword">while</span>(next!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">while</span>(next.val==cur.val){</span><br><span class="line">            next=next.next;</span><br><span class="line">            <span class="keyword">if</span>(next==<span class="keyword">null</span>){</span><br><span class="line">                pre.next=<span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span>(next.val!=cur.val){</span><br><span class="line">                pre.next=next;</span><br><span class="line">                <span class="comment">//curè·Ÿä¸Š</span></span><br><span class="line">                cur=next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å…³é”®å°±æ˜¯preç§»åŠ¨è¿™é‡Œæœ‰å‘ ä¸èƒ½ç›´æ¥å°†preç§»åˆ°cur,å› ä¸ºä¼šæœ‰è¿ç»­çš„è¿ç»­å­˜åœ¨</span></span><br><span class="line">        pre=cur.next!=<span class="keyword">null</span>&&cur.val==cur.next.val?pre:cur;</span><br><span class="line">        cur=next;</span><br><span class="line">        next=next.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ•´ä½“æ¥è¯´è¿˜æ˜¯æŒºç®€å•çš„åªè·‘äº†ä¸€è¶Ÿ 1ms beta98%ï¼Œè¯„è®ºé‡Œé¢å¤§éƒ½åªç”¨äº†ä¸¤ä¸ªæŒ‡é’ˆæˆ‘ç”¨äº†ä¸‰ä¸ªè¿™æ ·æ„Ÿè§‰æ¯”è¾ƒæ¸…æ™°<br>æ€ä¹ˆå¥½ç†è§£æ€ä¹ˆæ¥ã€‚è²Œä¼¼æœ€å¿«çš„æ˜¯ä¸€ä¸ªé€’å½’çš„ï¼Œé€’å½’å†™èµ·æ¥ç¡®å®ç„å­¦è¿˜è¦å¤šç»ƒç»ƒå•Š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">deleteDuplicates</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (head == <span class="keyword">null</span>) {</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> (head.next != <span class="keyword">null</span> && head.val == head.next.val) {</span><br><span class="line">          <span class="keyword">while</span> (head.next != <span class="keyword">null</span> && head.val == head.next.val) {</span><br><span class="line">              head = head.next;</span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">return</span> deleteDuplicates(head.next);</span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">          head.next = deleteDuplicates(head.next);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> head;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜è¿˜æœ‰ä¸ªç®€å•ç‰ˆçš„é‚£ä¸ªåˆ é™¤åä¼šç•™ä¸‹ä¸€ä¸ªï¼Œé‚£æ ·å‘æˆ‘ä¸Šé¢è¿™æ ·å†™preçš„è·³è½¬å°±ä¼šæ›´ç®€å•ä¸€ç‚¹ï¼Œè¿™é‡Œå°±ä¸å†™äº†</p><hr><h2 id="143-é‡æ’é“¾è¡¨"><a href="#143-é‡æ’é“¾è¡¨" class="headerlink" title="143. é‡æ’é“¾è¡¨"></a><strong>143. <a href="https://leetcode-cn.com/problems/reorder-list/" target="_blank" rel="noopener">é‡æ’é“¾è¡¨</a></strong></h2><p>ç»™å®šä¸€ä¸ªå•é“¾è¡¨ <em>L</em>ï¼šL0â†’L1â†’â€¦â†’Ln-1â†’Ln<br>å°†å…¶é‡æ–°æ’åˆ—åå˜ä¸ºï¼š L0â†’Lnâ†’L1â†’Ln-1â†’L2â†’Ln-2â†’â€¦</p><p>ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><p>ç»™å®šé“¾è¡¨ 1->2->3->4, é‡æ–°æ’åˆ—ä¸º 1->4->2->3.</p><p><strong>ç¤ºä¾‹ 2:</strong></p><p>ç»™å®šé“¾è¡¨ 1->2->3->4->5, é‡æ–°æ’åˆ—ä¸º 1->5->2->4->3.</p><blockquote><p>è¿™é¢˜å’Œä¸Šé¢çš„å›æ–‡é“¾è¡¨æœ‰ç‚¹ç±»ä¼¼ï¼Œéƒ½æ˜¯å¿«æ…¢æŒ‡é’ˆä¸è¿‡è¿™é¢˜ç¨å¾®å¤æ‚ç‚¹</p></blockquote><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reorderList</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    ListNode right = head;</span><br><span class="line">    ListNode slow = head;</span><br><span class="line">    <span class="comment">// 1 1 1 1 1 1 1</span></span><br><span class="line">    <span class="keyword">while</span> (right.next != <span class="keyword">null</span>) {</span><br><span class="line">        right = right.next.next != <span class="keyword">null</span> ? right.next.next : right.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ä»slowå¼€å§‹ç¿»è½¬</span></span><br><span class="line">    res(slow);</span><br><span class="line">    <span class="comment">//å·¦åŠéƒ¨åˆ†</span></span><br><span class="line">    ListNode left = head;</span><br><span class="line">    <span class="comment">//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    ListNode rnext = right;</span><br><span class="line">    ListNode lnext = left;</span><br><span class="line">    <span class="comment">// 1 2 3 4 5 6 7 8 </span></span><br><span class="line">    <span class="comment">// 1 8 2 7 3 6 4 5</span></span><br><span class="line">    <span class="keyword">while</span> (right != <span class="keyword">null</span> && left != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">// è¦ä¿å­˜rightçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ , leftä¹Ÿéœ€è¦,ä¸ç„¶æ— æ³•å¯¼èˆªåˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        lnext = lnext.next;</span><br><span class="line">        rnext = rnext.next;</span><br><span class="line">        <span class="comment">// å¶æ•°ä¸ªæ•°èŠ‚ç‚¹,å¦‚æœéå†åˆ°righté“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// å¶æ•°çš„è¯righté“¾è¡¨ä¼šçŸ­ä¸€ç‚¹ æœ€åè¿æ¥çš„æ—¶å€™</span></span><br><span class="line">        <span class="comment">// left: 1->2->3->4->5 right: 8->7->6->5   </span></span><br><span class="line">        <span class="comment">// åƒè¿™æ ·ä¼šå°†5åŠ åˆ°leftçš„4å’Œ5ä¹‹é—´,ä½†æ˜¯æ˜æ˜¾åªæœ‰ä¸€ä¸ª5è¿™æ ·æ·»åŠ å°±æ˜¯æœ‰é—®é¢˜çš„</span></span><br><span class="line">        <span class="keyword">if</span>(right.next==<span class="keyword">null</span>){</span><br><span class="line">            <span class="comment">//æ‰€ä»¥è¿™é‡Œå§lnextèµ‹å€¼ä¸ºnull,åé¢å°±ä¸ä¼šé‡å¤è¿æ¥5è¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            lnext=<span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å¥‡æ•°ä¸ªæ•°çš„æ—¶å€™è¿™æ ·è¿æ¥æ²¡é—®é¢˜</span></span><br><span class="line">        <span class="comment">// 1 2 3 4 5 </span></span><br><span class="line">        <span class="comment">// 9 8 7 6 5</span></span><br><span class="line">        <span class="comment">//5.next=5</span></span><br><span class="line">        left.next = right;</span><br><span class="line">        <span class="comment">//å¦‚æœå¥‡æ•°ä¸ªæ•°åˆ°æœ€åè¿™ä¸€æ­¥ rightå’Œleftæ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¸ºå€¼æ˜¯5çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥è¿™é‡Œä¸‹é¢çš„ç›´æ¥è¦†ç›–äº†ä¸Šé¢çš„</span></span><br><span class="line">        <span class="comment">//5.next=null</span></span><br><span class="line">        right.next = lnext;</span><br><span class="line">        left = lnext;</span><br><span class="line">        right = rnext;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åè½¬</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">res</span><span class="params">(ListNode node)</span> </span>{</span><br><span class="line">    ListNode pre = <span class="keyword">null</span>;</span><br><span class="line">    ListNode cur = node;</span><br><span class="line">    ListNode nex = node;</span><br><span class="line">    <span class="keyword">while</span> (cur != <span class="keyword">null</span>) {</span><br><span class="line">        nex = nex.next;</span><br><span class="line">        cur.next = pre;</span><br><span class="line">        pre = cur;</span><br><span class="line">        cur = nex;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¹Ÿæ˜¯ä¹‹å‰çš„ä»£ç äº†ï¼Œå†™çš„æ¯”è¾ƒçƒ‚ï¼Œä½†æ˜¯æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œè¾¹ç•Œéœ€è¦æ³¨æ„ï¼Œé€Ÿåº¦è¿˜è¡Œ 4ms  77% ã€‚</p><hr><h2 id="21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/" target="_blank" rel="noopener">21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></h2><p>å°†ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ </p><p><strong>ç¤ºä¾‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š <span class="number">1</span>-><span class="number">2</span>-><span class="number">4</span>, <span class="number">1</span>-><span class="number">3</span>-><span class="number">4</span></span><br><span class="line">è¾“å‡ºï¼š <span class="number">1</span>-><span class="number">1</span>-><span class="number">2</span>-><span class="number">3</span>-><span class="number">4</span>-><span class="number">4</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><p>å¸¸è§„è¿­ä»£çš„åšæ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>{</span><br><span class="line">        ListNode temp=<span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        ListNode res=temp;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="keyword">null</span>&&l2!=<span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">if</span>(l2.val<l1.val){< span><br><span class="line">                temp.next=l2;</span><br><span class="line">                l2=l2.next;</span><br><span class="line">                temp=temp.next;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                temp.next=l1;</span><br><span class="line">                l1=l1.next;</span><br><span class="line">                temp=temp.next;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        temp.next=l1==<span class="keyword">null</span>?l2:l1;</span><br><span class="line">        <span class="keyword">return</span> res.next;</span><br><span class="line">}</span><br></l1.val){<></span></pre></td></tr></tbody></table></figure></div><p>å½’å¹¶åˆ†æ²»çš„æ€æƒ³ï¼ŒæœŸæœ«è€ƒè¯•çš„ä¸€é“é¢˜</p><p><strong>è§£æ³•äºŒ</strong></p><p>é€’å½’çš„åšæ³•</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>{</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    mergeTwoLists(l1,l2,dummyNode);</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2,ListNode res)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(l1==<span class="keyword">null</span>){</span><br><span class="line">        res.next=l2;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(l2==<span class="keyword">null</span>){</span><br><span class="line">        res.next=l1;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(l1.val>l2.val){</span><br><span class="line">        res.next=l2;</span><br><span class="line">        mergeTwoLists(l1,l2.next,res.next);</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        res.next=l1;</span><br><span class="line">        mergeTwoLists(l1.next,l2,res.next);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸Šé¢æ˜¯æˆ‘ä¸€å¼€å§‹è‡ªå·±å†™çš„ï¼Œä¸€ç‚¹ä¹Ÿä¸<em>é€’å½’</em> </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(l1==<span class="keyword">null</span>) <span class="keyword">return</span> l2;</span><br><span class="line">    <span class="keyword">if</span>(l2==<span class="keyword">null</span>) <span class="keyword">return</span> l1;</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(l1.val<l2.val){< span><br><span class="line">        l1.next=mergeTwoLists(l1.next,l2);</span><br><span class="line">        <span class="keyword">return</span> l1;</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        l2.next=mergeTwoLists(l1,l2.next);</span><br><span class="line">        <span class="keyword">return</span> l2;</span><br><span class="line">    }</span><br><span class="line">}</span><br></l2.val){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™ç§çœ‹ç€å°±å¾ˆç®€æ´</p><hr><h2 id="23-åˆå¹¶Kä¸ªæ’åºé“¾è¡¨"><a href="#23-åˆå¹¶Kä¸ªæ’åºé“¾è¡¨" class="headerlink" title="23. åˆå¹¶Kä¸ªæ’åºé“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/merge-k-sorted-lists/" target="_blank" rel="noopener">23. åˆå¹¶Kä¸ªæ’åºé“¾è¡¨</a></h2><p>åˆå¹¶ k ä¸ªæ’åºé“¾è¡¨ï¼Œè¿”å›åˆå¹¶åçš„æ’åºé“¾è¡¨ã€‚è¯·åˆ†æå’Œæè¿°ç®—æ³•çš„å¤æ‚åº¦ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  <span class="number">1</span>-><span class="number">4</span>-><span class="number">5</span>,</span><br><span class="line">  <span class="number">1</span>-><span class="number">3</span>-><span class="number">4</span>,</span><br><span class="line">  <span class="number">2</span>-><span class="number">6</span></span><br><span class="line">]</span><br><span class="line">è¾“å‡º: <span class="number">1</span>-><span class="number">1</span>-><span class="number">2</span>-><span class="number">3</span>-><span class="number">4</span>-><span class="number">4</span>-><span class="number">5</span>-><span class="number">6</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists</span><span class="params">(ListNode[] lists)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(lists.length==<span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    ListNode temp=lists[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<lists.length-<span class="number">1</lists.length-<span></span>;i++){<br><span class="line">        temp=merge2List(temp,lists[i+<span class="number">1</span>]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">merge2List</span><span class="params">(ListNode headA,ListNode headB)</span></span>{</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    ListNode res=dummyNode;</span><br><span class="line">    ListNode tempA=headA;</span><br><span class="line">    ListNode tempB=headB;</span><br><span class="line">    <span class="keyword">while</span>(tempB!=<span class="keyword">null</span>&&tempA!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(tempB.val>tempA.val){</span><br><span class="line">            res.next=tempA;</span><br><span class="line">            tempA=tempA.next;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            res.next=tempB;</span><br><span class="line">            tempB=tempB.next;</span><br><span class="line">        }</span><br><span class="line">        res=res.next;</span><br><span class="line">    }</span><br><span class="line">    res.next=tempA==<span class="keyword">null</span>?tempB:tempA;</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æœ€å…ˆæƒ³åˆ°çš„æ–¹æ³•ï¼Œå’Œå‰é¢çš„äºŒè·¯å½’å¹¶ä¸€æ ·ï¼ŒæŠŠå‰ä¸¤ä¸ªå½’å¹¶çš„ç»“æœå’Œåé¢çš„ç»§ç»­å½’å¹¶ã€‚é€Ÿåº¦å¤ªæ…¢äº†200mså·¦å³â€¦..æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(N^2)</code>.<br><strong>è§£æ³•äºŒï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists2</span><span class="params">(ListNode[] lists)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(lists.length==<span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> divide(lists,<span class="number">0</span>,lists.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">divide</span><span class="params">(ListNode[] lists,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(left>=right)<span class="keyword">return</span> lists[left];</span><br><span class="line">    <span class="keyword">int</span> mid=left+((right-left)>><span class="number">1</span>);</span><br><span class="line">    ListNode l = divide(lists,left,mid);</span><br><span class="line">    ListNode r = divide(lists,mid+<span class="number">1</span>,right);</span><br><span class="line">    <span class="keyword">return</span> merge2List(l,r);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">merge2List</span><span class="params">(ListNode headA,ListNode headB)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(headA==<span class="keyword">null</span>)<span class="keyword">return</span> headB;</span><br><span class="line">    <span class="keyword">if</span>(headB==<span class="keyword">null</span>)<span class="keyword">return</span> headA;</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    ListNode res=dummyNode;</span><br><span class="line">    ListNode tempA=headA;</span><br><span class="line">    ListNode tempB=headB;</span><br><span class="line">    <span class="keyword">while</span>(tempB!=<span class="keyword">null</span>&&tempA!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(tempB.val>tempA.val){</span><br><span class="line">            res.next=tempA;</span><br><span class="line">            tempA=tempA.next;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            res.next=tempB;</span><br><span class="line">            tempB=tempB.next;</span><br><span class="line">        }</span><br><span class="line">        res=res.next;</span><br><span class="line">    }</span><br><span class="line">    res.next=tempA==<span class="keyword">null</span>?tempB:tempA;</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>çœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿï¼Ÿæ²¡é”™å°±æ˜¯å½’å¹¶æ’åºçš„æ€è·¯ï¼Œåˆ©ç”¨åˆ†æ²»çš„æ€æƒ³ï¼Œå…ˆå½’å¹¶å·¦è¾¹ï¼Œå†å½’å¹¶å³è¾¹ï¼Œç„¶åmergeå·¦å³çš„ç»“æœï¼Œæ—¶é—´å¤æ‚åº¦ä¸º<code>O(NlogK)</code> (é€’å½’æ ‘æ·±åº¦ä¸ºlogKï¼Œå½’å¹¶æ¯ä¸€å±‚æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯N)ï¼Œ 10mså·¦å³ï¼ŒNæ˜¯é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°ï¼ŒKæ˜¯é“¾è¡¨ä¸ªæ•°ã€‚è€Œä¸”å› ä¸ºæ˜¯é“¾è¡¨ç©ºé—´å¤æ‚åº¦ä¹Ÿä¸é«˜ã€‚å¦å¤–è¿™é¢˜ä¹Ÿå¯ä»¥æ”¹æˆéé€’å½’çš„æ–¹å¼å¦‚ä¸‹:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists3</span><span class="params">(ListNode [] lists)</span></span>{</span><br><span class="line">    <span class="keyword">if</span> (lists.length == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> k = lists.length;</span><br><span class="line">    <span class="keyword">while</span> (k > <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < k / <span class="number">2</span>; i++) {</span><br><span class="line">            <span class="comment">//ä¸¤ä¸¤åˆå¹¶å°†ç»“æœä¿å­˜åœ¨å‰åŠéƒ¨åˆ†çš„èŠ‚ç‚¹ä¸­ç„¶åç¼©å°ä¸€åŠçš„èŒƒå›´</span></span><br><span class="line">            lists[i] = merge2Lists(lists[i], lists[i + (k + <span class="number">1</span>) / <span class="number">2</span>]);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ç¼©å°ä¸€åŠçš„èŒƒå›´</span></span><br><span class="line">        k = (k + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> lists[<span class="number">0</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸‰ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å°æ ¹å †çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeKLists4</span><span class="params">(ListNode[] lists)</span> </span>{</span><br><span class="line">    <span class="comment">//åˆ©ç”¨ä¸€ä¸ªæŒ‰èŠ‚ç‚¹å€¼æœ€å°æ¬¡åºæ’åˆ—çš„ä¼˜å…ˆé˜Ÿåˆ—, æ¯æ¬¡å–æœ€å°çš„èŠ‚ç‚¹åŠ å…¥è¿”å›é“¾è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">if</span>(lists.length < <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    Queue<listnode> pq = <span class="keyword">new</span> PriorityQueue<>((a, b) -> (a.val - b.val));</listnode></span><br><span class="line">    ListNode head = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">    ListNode cur = head;</span><br><span class="line">    <span class="keyword">for</span> (ListNode p : lists){</span><br><span class="line">        <span class="keyword">if</span>(p != <span class="keyword">null</span>)</span><br><span class="line">        pq.offer(p);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(!pq.isEmpty()) {</span><br><span class="line">        cur.next = pq.poll();</span><br><span class="line">        cur = cur.next;</span><br><span class="line">        <span class="keyword">if</span>(cur.next != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">//è®²å½“å‰èŠ‚ç‚¹åä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">        pq.offer(cur.next);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> head.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>åˆ©ç”¨äº†å°æ ¹å †ï¼ŒJavaé‡Œé¢æœ‰å°æ ¹å †å¯ä»¥ç›´æ¥ç”¨ï¼Œæ€è·¯å°±æ˜¯æ¯æ¬¡æŠŠæ¯æ¡é“¾è¡¨çš„å¤´å…ƒç´ éƒ½æ”¾è¿›å°æ ¹å †é‡Œé¢ç„¶åæ‰¾å‡ºæœ€å°çš„åŠ åˆ°æ–°é“¾è¡¨ä¸­ç„¶åï¼Œæœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹çš„é“¾è¡¨å‘åç§»å†åŠ åˆ°å°æ ¹å †é‡Œé¢ï¼Œæ–¹æ³•è¿˜æ˜¯ç›¸å½“ç®€æ´çš„ã€‚ä½†æ˜¯ç”¨äº†90mså·¦å³æ¯”è¾ƒæ…¢ï¼Œæˆ‘æƒ³äº†ä¸‹æ„Ÿè§‰è¿™ä¸ªæ—¶é—´å¤æ‚åº¦å¥½åƒæ˜¯NKlogK,ä½†æ˜¯è¯„è®ºè¯´æ˜¯NlogKã€‚ã€‚ã€‚ç®—æ³•æ¸£æ¸£æœ‰ç‚¹è¿·ã€‚ã€‚ã€‚</p><hr><h2 id="430-æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨"><a href="#430-æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨" class="headerlink" title="430. æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨"></a>430. æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨</h2><p>æ‚¨å°†è·å¾—ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œé™¤äº†ä¸‹ä¸€ä¸ªå’Œå‰ä¸€ä¸ªæŒ‡é’ˆä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå­æŒ‡é’ˆï¼Œå¯èƒ½æŒ‡å‘å•ç‹¬çš„åŒå‘é“¾è¡¨ã€‚è¿™äº›å­åˆ—è¡¨å¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå·±çš„å­é¡¹ï¼Œä¾æ­¤ç±»æ¨ï¼Œç”Ÿæˆå¤šçº§æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚</p><p>æ‰å¹³åŒ–åˆ—è¡¨ï¼Œä½¿æ‰€æœ‰ç»“ç‚¹å‡ºç°åœ¨å•çº§åŒé“¾è¡¨ä¸­ã€‚æ‚¨å°†è·å¾—åˆ—è¡¨ç¬¬ä¸€çº§çš„å¤´éƒ¨ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p><strong>è¾“å…¥:</strong><br> 1â€”2â€”3â€”4â€”5â€”6â€“NULL<br>         |<br>         7â€”8â€”9â€”10â€“NULL<br>             |<br>             11â€“12â€“NULL</p><p><strong>è¾“å‡º:</strong><br>1-2-3-7-8-11-12-9-10-4-5-6-NULL<br><strong>ä»¥ä¸Šç¤ºä¾‹çš„è¯´æ˜:</strong></p><p>ç»™å‡ºä»¥ä¸‹å¤šçº§åŒå‘é“¾è¡¨:</p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/DqC2qKF5h63V.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>æˆ‘ä»¬åº”è¯¥è¿”å›å¦‚ä¸‹æ‰€ç¤ºçš„æ‰å¹³åŒå‘é“¾è¡¨:</p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/qOSn0TLmMuCt.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è§£æ³•ä¸€ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        è¿™ç§è§£æ³•æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„</span></span><br><span class="line"><span class="comment">        æ¯æ¬¡æœ‰å­é“¾çš„æ—¶å€™å°±ç›´æ¥æŠŠå­é“¾éå†åˆ°å°¾ ç„¶åæ·»åŠ åˆ°é“¾è¡¨ä¸­å½¢æˆæ–°ä¸»é“¾ æŠŠå­é“¾çš„å…¥å£èŠ‚ç‚¹childæŒ‡å®šä¸ºnull</span></span><br><span class="line"><span class="comment">        ç„¶åä¸»é“¾ç»§ç»­å‘åéå†æ‰€ä»¥æ•´ä¸ªéå†çš„æ¬¡æ•°å°±æ˜¯æ•´ä¸ªé“¾è¡¨å…ƒç´ çš„ä¸ªæ•° O(M)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">flatten1</span><span class="params">(Node head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span> || head.next==<span class="keyword">null</span>&&head.child==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line">    Node cur=head;</span><br><span class="line">    Node nNext;</span><br><span class="line">    Node child;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(cur.child!=<span class="keyword">null</span>){</span><br><span class="line">            <span class="comment">//æœ‰å­é“¾è¡¨</span></span><br><span class="line">            child=cur.child;</span><br><span class="line">            <span class="comment">//å­é“¾è¡¨çš„è¡¨å¤´</span></span><br><span class="line">            nNext=cur.next;</span><br><span class="line">            <span class="comment">//ä¸»é“¾çš„ä¸‹ä¸€èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">//è¿æ¥å­é“¾è¡¨</span></span><br><span class="line">            cur.next=child;</span><br><span class="line">            <span class="comment">//ä¸»é“¾çš„ä¸‹ä¸€èŠ‚ç‚¹ä¸ºå­é“¾è¡¨å¤´</span></span><br><span class="line">            child.prev=cur;</span><br><span class="line">            <span class="comment">//å­é“¾è¡¨çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">//å·²ç»æ‹¼æ¥åˆ°ä¸»é“¾ï¼Œå­©å­é“¾ç½®ä¸ºç©º ï¼ˆè¿™æ­¥è¿˜å¾ˆå…³é”®æˆ‘å¼€å§‹ä¸€ç›´å¿˜è®¾ç½®ä¸ºnullï¼‰</span></span><br><span class="line">            cur.child=<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span>(nNext==<span class="keyword">null</span>){</span><br><span class="line">                <span class="comment">//éå†åˆ°ä¸»é“¾æœ€åä¸€ä¸ªäº†</span></span><br><span class="line">                <span class="comment">//æ‰€ä»¥æ²¡æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåé¢çš„æ­¥éª¤ä¸ç”¨ç»§ç»­ä½†æ˜¯ä¹Ÿä¸èƒ½Break å› ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹æœ‰å¯èƒ½è¿˜æœ‰å­é“¾è¡¨</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">while</span>(child.next!=<span class="keyword">null</span>){</span><br><span class="line">                <span class="comment">//æ‰¾åˆ°æ–°ä¸»é“¾çš„ä¸‹ä¸€èŠ‚ç‚¹ (å­é“¾çš„æœ€åä¸€ä¸ª)</span></span><br><span class="line">                child=child.next;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//è¿æ¥ä»¥å‰çš„ä¸»é“¾</span></span><br><span class="line">            child.next=nNext;</span><br><span class="line">            nNext.prev=child;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ä¸»é“¾è¡¨å‘åç§»åŠ¨</span></span><br><span class="line">        cur=cur.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•äºŒï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ ‡å‡†çš„DFS</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">flatten2</span><span class="params">(Node node)</span> </span>{</span><br><span class="line">   <span class="keyword">if</span>(node==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    }</span><br><span class="line">    Node head = node;</span><br><span class="line">    <span class="keyword">while</span> (head!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="comment">//æˆ‘æ„Ÿè§‰è¿™æ ·ä¼šå¿«ä¸€äº›</span></span><br><span class="line">         Node next = head.next;</span><br><span class="line">        <span class="keyword">if</span>(head.child!=<span class="keyword">null</span>){</span><br><span class="line">            next = head.next;</span><br><span class="line">            <span class="comment">//å­é“¾è¡¨æ‰å¹³åŒ– è¿”å›å¤´èŠ‚ç‚¹</span></span><br><span class="line">            Node nextLayer = flatten2(head.child);<span class="comment">//å­é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">//è¿æ¥å­é“¾è¡¨å¤´å’Œä¸»é“¾</span></span><br><span class="line">            head.next = nextLayer;</span><br><span class="line">            nextLayer.prev = head;</span><br><span class="line">            <span class="comment">//ç„¶åå­é“¾è¡¨ç½®ä¸ºnull</span></span><br><span class="line">            head.child = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//éå†åˆ°å­é“¾è¡¨çš„ç»“å°¾</span></span><br><span class="line">            <span class="keyword">while</span> (nextLayer.next!=<span class="keyword">null</span>){</span><br><span class="line">                nextLayer = nextLayer.next;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//è¿æ¥å­é“¾è¡¨çš„å°¾éƒ¨</span></span><br><span class="line">            nextLayer.next = next;</span><br><span class="line">            <span class="keyword">if</span>(next!=<span class="keyword">null</span>){</span><br><span class="line">                next.prev = nextLayer;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¿™é‡Œå°±ç›´æ¥è·³è¿‡å­é“¾è¡¨ ä¹‹å‰çš„æ˜¯head=head.next; ä½†æ˜¯å› ä¸ºä¹‹å‰çš„å­é“¾è¡¨å·²ç»åŠ åˆ°ä¸»é“¾è¡¨ä¸­æ‰€ä»¥ä¼šæµªè´¹ä¸€äº›æ—¶é—´ï¼ˆå­é“¾è¡¨è‚¯å®šæ˜¯å·²ç»æ‰å¹³åŒ–çš„è‚¯å®šéƒ½æ²¡æœ‰å­é“¾è¡¨ï¼‰</span></span><br><span class="line">        head = next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸¤ç§æ–¹æ³•éƒ½æ˜¯çœ‹çš„è¯„è®ºé‡Œé¢çš„ç¬¬äºŒç§æˆ‘ç¨å¾®æ”¹äº†ä¸‹ï¼Œç›´æ¥è·³è¿‡å­é“¾è¡¨æ•ˆç‡ä¼šé«˜å¾ˆå¤šï¼Œä¸è¿‡è¿™é¢˜caseä¹Ÿæ¯”è¾ƒå°‘çœ‹ä¸å‡ºå·®å¼‚ã€‚</p><hr><h2 id="141-ç¯å½¢é“¾è¡¨"><a href="#141-ç¯å½¢é“¾è¡¨" class="headerlink" title="141. ç¯å½¢é“¾è¡¨"></a><strong>141. ç¯å½¢é“¾è¡¨</strong></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p><p>ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° <code>pos</code> æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ <code>pos</code> æ˜¯ <code>-1</code>ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><strong>è¾“å…¥ï¼š</strong>head = [3,2,0,-4], pos = 1<br><strong>è¾“å‡ºï¼š</strong>true<br><strong>è§£é‡Šï¼š</strong>é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/H2wmyaG9uoiz.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¤ºä¾‹ 2ï¼š</strong><br><strong>è¾“å…¥ï¼š</strong> head = [1,2], pos = 0<br><strong>è¾“å‡ºï¼š</strong> true<br><strong>è§£é‡Šï¼š</strong> é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/UqIc2XWwtxbo.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><p><strong>è¾“å…¥ï¼š</strong> head = [1], pos = -1<br><strong>è¾“å‡ºï¼š</strong> false<br><strong>è§£é‡Šï¼š</strong> é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</p><p><img alt="mark" data-src="http://static.imlgw.top///20190303/dAg8QrxqJJga.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p><strong>è¿›é˜¶ï¼š</strong></p><p>ä½ èƒ½ç”¨ _O(1)_ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ</p><p><strong>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µåº”è¯¥æ˜¯ä¸è€ƒè™‘çš„ç›´æ¥ false ã€‚</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">hasCycle</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>)</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//å¿«æ…¢æŒ‡é’ˆ ç›¸é‡çš„æ—¶å€™å¿«æŒ‡é’ˆå›åˆ°å¤´éƒ¨stepæ”¹ä¸º1 å†æ¬¡ç›¸é‡çš„æ—¶å€™å°±æ˜¯ç¯çš„pos</span></span><br><span class="line">    <span class="comment">//è¿™é¢˜åªæ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰ç¯æ‰€ä»¥åªè¦ç›¸é‡å°±æœ‰ç¯</span></span><br><span class="line">    ListNode slow=head;</span><br><span class="line">    ListNode fast=head.next;</span><br><span class="line">    <span class="keyword">while</span>(slow!=fast){</span><br><span class="line">        <span class="comment">//æœ‰ç¯æ˜¯ä¸ä¼šèµ°åˆ°å°½å¤´çš„</span></span><br><span class="line">        <span class="keyword">if</span>(fast.next==<span class="keyword">null</span> || fast.next.next==<span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        fast=fast.next.next;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><hr><h2 id="141-ç¯å½¢é“¾è¡¨â…¡"><a href="#141-ç¯å½¢é“¾è¡¨â…¡" class="headerlink" title="141. ç¯å½¢é“¾è¡¨â…¡"></a>141. ç¯å½¢é“¾è¡¨â…¡</h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› <code>null</code>ã€‚</p><p>ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° <code>pos</code> æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ <code>pos</code> æ˜¯ <code>-1</code>ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</p><p><strong>è¯´æ˜ï¼š</strong> ä¸å…è®¸ä¿®æ”¹ç»™å®šçš„é“¾è¡¨ã€‚ ps:ä¸Šé¢˜çš„åŸºç¡€ä¸Šè¿”å›å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">detectCycle</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    ListNode fast=head;</span><br><span class="line">    ListNode slow=head;</span><br><span class="line">    Boolean isMeet=<span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//å¿«æŒ‡é’ˆæ²¡æœ‰åˆ°å°½å¤´</span></span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="keyword">null</span>&&fast.next!=<span class="keyword">null</span>){</span><br><span class="line">        fast=isMeet?fast.next:fast.next.next;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">        <span class="keyword">if</span>(fast==slow){</span><br><span class="line">            <span class="keyword">if</span>(!isMeet){</span><br><span class="line">                <span class="comment">//ç¬¬ä¸€æ¬¡ç›¸é‡</span></span><br><span class="line">                <span class="comment">//æˆ‘è¿™ç§å†™æ³•å¼€å§‹æ²¡è€ƒè™‘åˆ°è¿™ç§æƒ…å†µ,å…¥ç¯èŠ‚ç‚¹å°±æ˜¯å¤´èŠ‚ç‚¹å°±ä¸èƒ½ç»§ç»­èµ°äº†</span></span><br><span class="line">                <span class="keyword">if</span>(fast==head) <span class="keyword">return</span>;</span><br><span class="line">                fast=head;</span><br><span class="line">                isMeet=<span class="keyword">true</span>;</span><br><span class="line">            } <span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">return</span> fast;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>è¿™ç§è§£æ³•è¿˜æ˜¯æŒºæœ‰æ„æ€çš„<code>å¿«æ…¢æŒ‡é’ˆ</code>ï¼Œå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤æ­¥æ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€æ­¥åœ¨ç¯ä¸Šç›¸é‡çš„æ—¶å€™å¿«æŒ‡é’ˆå›åˆ°å¤´èŠ‚ç‚¹æ­¥æ•°è°ƒæ•´ä¸º1ï¼Œå†>æ¬¡ç›¸é‡çš„>æ—¶å€™ï¼ˆè¿™é‡Œæœ‰å¯èƒ½é‡åˆï¼Œå½“å¤´èŠ‚ç‚¹å°±æ˜¯å…¥ç¯èŠ‚ç‚¹çš„æ—¶å€™ï¼‰å°±æ˜¯å…¥ç¯èŠ‚ç‚¹ã€‚<br>åŸç† :<br>Aâ€”->Bâ€”->C      åˆ†åˆ«ä¸º<code>å¤´èŠ‚ç‚¹</code>ï¼Œ<code>å…¥ç¯èŠ‚ç‚¹</code>ï¼Œ<code>ç¬¬ä¸€æ¬¡ç›¸é‡çš„èŠ‚ç‚¹</code><br>åˆ†æç¬¬ä¸€æ¬¡ç›¸é‡æ—¶å¿«æ…¢æŒ‡é’ˆèµ°è¿‡çš„è·¯å¾„å¯å¾—<br>AB+BC+CB+BC=2(AB+BC)  å¿«æŒ‡é’ˆèµ°è¿‡çš„è·¯ç¨‹è‚¯å®šæ˜¯æ…¢æŒ‡é’ˆçš„ä¸¤å€<br>åŒ–ç®€æœ€åå°±å¾—åˆ°AB=CB æ‰€ä»¥ä»–ä»¬<code>å†æ¬¡ç›¸é‡</code>å°±æ˜¯å…¥ç¯çš„èŠ‚ç‚¹</p></blockquote><hr><h2 id="61-æ—‹è½¬é“¾è¡¨"><a href="#61-æ—‹è½¬é“¾è¡¨" class="headerlink" title="61. æ—‹è½¬é“¾è¡¨"></a><strong>61. <a href="https://leetcode-cn.com/problems/rotate-list/" target="_blank" rel="noopener">æ—‹è½¬é“¾è¡¨</a></strong></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œæ—‹è½¬é“¾è¡¨ï¼Œå°†é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹å‘å³ç§»åŠ¨  <em>k</em>ä¸ªä½ç½®ï¼Œå…¶ä¸­ <em>k</em>æ˜¯éè´Ÿæ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">1</span>-><span class="number">2</span>-><span class="number">3</span>-><span class="number">4</span>-><span class="number">5</span>->NULL, k = <span class="number">2</span></span><br><span class="line">è¾“å‡º: <span class="number">4</span>-><span class="number">5</span>-><span class="number">1</span>-><span class="number">2</span>-><span class="number">3</span>->NULL</span><br><span class="line">è§£é‡Š:</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">1</span> æ­¥: <span class="number">5</span>-><span class="number">1</span>-><span class="number">2</span>-><span class="number">3</span>-><span class="number">4</span>->NULL</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">2</span> æ­¥: <span class="number">4</span>-><span class="number">5</span>-><span class="number">1</span>-><span class="number">2</span>-><span class="number">3</span>->NULL</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥: <span class="number">0</span>-><span class="number">1</span>-><span class="number">2</span>->NULL, k = <span class="number">4</span></span><br><span class="line">è¾“å‡º: <span class="number">2</span>-><span class="number">0</span>-><span class="number">1</span>->NULL</span><br><span class="line">è§£é‡Š:</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">1</span> æ­¥: <span class="number">2</span>-><span class="number">0</span>-><span class="number">1</span>->NULL</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">2</span> æ­¥: <span class="number">1</span>-><span class="number">2</span>-><span class="number">0</span>->NULL</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">3</span> æ­¥: <span class="number">0</span>-><span class="number">1</span>-><span class="number">2</span>->NULL</span><br><span class="line">å‘å³æ—‹è½¬ <span class="number">4</span> æ­¥: <span class="number">2</span>-><span class="number">0</span>-><span class="number">1</span>->NULL</span><br></pre></td></tr></tbody></table></figure></div><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">rotateRight</span><span class="params">(ListNode head, <span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å…ˆè·å–ä¸‹é“¾è¡¨çš„é•¿åº¦ï¼Œé¡ºä¾¿è®°å½•tailçš„å€¼</span></span><br><span class="line">    ListNode temp=head;</span><br><span class="line">    ListNode tail=head;</span><br><span class="line">    <span class="keyword">int</span> length=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        length++;</span><br><span class="line">        <span class="keyword">if</span>(temp.next==<span class="keyword">null</span>){</span><br><span class="line">            tail=temp;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å°†KåŒ–ç®€</span></span><br><span class="line">    k=k%length;</span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>) <span class="keyword">return</span> head;</span><br><span class="line">    temp=head;</span><br><span class="line">    <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//ç„¶åå†éå†ä¸€éé“¾è¡¨åœ¨ length-k çš„åœ°æ–¹æ–­å¼€</span></span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(count==(length-k-<span class="number">1</span>)){</span><br><span class="line">            tail.next=head;</span><br><span class="line">            head=temp.next;</span><br><span class="line">            temp.next=<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        }</span><br><span class="line">        count++;</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è™½ç„¶éš¾åº¦æ˜¯midï¼Œä½†æ˜¯æ„Ÿè§‰è¿™é¢˜è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œæˆ‘çœ‹è§æœ‰ä¸€ç§æ¯”è¾ƒå¥½ç‚¹çš„æ–¹æ³•æ˜¯åœ¨ç¬¬ä¸€éå¾ªç¯å®Œä¹‹åå°†é“¾è¡¨è½¬æ¢ä¸º<code>åŒå‘é“¾è¡¨</code>ç„¶åå†ç§»åŠ¨è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„</p><hr><h2 id="328-å¥‡å¶é“¾è¡¨"><a href="#328-å¥‡å¶é“¾è¡¨" class="headerlink" title="328. å¥‡å¶é“¾è¡¨"></a><strong>328. å¥‡å¶é“¾è¡¨</strong></h2><p>ç»™å®šä¸€ä¸ªå•é“¾è¡¨ï¼ŒæŠŠæ‰€æœ‰çš„å¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹åˆ†åˆ«æ’åœ¨ä¸€èµ·ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„å¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹æŒ‡çš„æ˜¯èŠ‚ç‚¹ç¼–å·çš„å¥‡å¶æ€§ï¼Œè€Œä¸æ˜¯èŠ‚ç‚¹çš„å€¼çš„å¥‡å¶æ€§ã€‚</p><p>è¯·å°è¯•ä½¿ç”¨åŸåœ°ç®—æ³•å®Œæˆã€‚ä½ çš„ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦åº”ä¸º O(1)ï¼Œæ—¶é—´å¤æ‚åº¦åº”ä¸º O(nodes)ï¼Œnodes ä¸ºèŠ‚ç‚¹æ€»æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><p><strong>è¾“å…¥:</strong> <code>1->2->3->4->5->NULL</code><br><strong>è¾“å‡º:</strong> <code>1->3->5->2->4->NULL</code></p><p><strong>ç¤ºä¾‹ 2:</strong></p><p><strong>è¾“å…¥:</strong> <code>2->1->3->5->6->4->7->NULL</code><br><strong>è¾“å‡º:</strong> <code>2->3->6->7->1->5->4->NULL</code></p><p><strong>è¯´æ˜:</strong></p><ul><li>åº”å½“ä¿æŒå¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹çš„ç›¸å¯¹é¡ºåºã€‚</li><li>é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è§†ä¸ºå¥‡æ•°èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹è§†ä¸ºå¶æ•°èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å¥‡å¶é“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">oddEvenList</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>||head.next.next==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    <span class="comment">// 1 2 3 4 5 6 7</span></span><br><span class="line">    <span class="comment">// 1 2 3 4 5 6</span></span><br><span class="line">    ListNode pOdd=head;</span><br><span class="line">    ListNode pEven=head.next;</span><br><span class="line">    ListNode temp=pEven;</span><br><span class="line">    <span class="keyword">while</span>(pEven!=<span class="keyword">null</span>&&pEven.next!=<span class="keyword">null</span>){</span><br><span class="line">        pOdd.next=pEven.next;</span><br><span class="line">        <span class="comment">//å¥‡æ•°å…ˆèµ°</span></span><br><span class="line">        pOdd=pOdd.next;</span><br><span class="line">        pEven.next=pOdd.next;</span><br><span class="line">        pEven=pEven.next;</span><br><span class="line">    }</span><br><span class="line">    pOdd.next=temp;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å¾ˆåƒè¸©çŸ³å¤´è¿‡æ²³çš„æ¸¸æˆï¼Œä¸€é“å¾ˆç®€å•çš„midï¼Œä¸çŸ¥é“ä¸ºå•¥ä¸€å¼€å§‹æŠ äº†åŠå¤©çš„è¾¹ç•Œã€‚ã€‚ã€‚æœç„¶<br>è¿˜æ˜¯ä¸ç†Ÿæ‚‰å•Šã€‚Add oil ! ! ! ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘</p></blockquote><hr><h2 id="147-å¯¹é“¾è¡¨è¿›è¡Œæ’å…¥æ’åº"><a href="#147-å¯¹é“¾è¡¨è¿›è¡Œæ’å…¥æ’åº" class="headerlink" title="147. å¯¹é“¾è¡¨è¿›è¡Œæ’å…¥æ’åº"></a><strong>147. å¯¹é“¾è¡¨è¿›è¡Œæ’å…¥æ’åº</strong></h2><p>æ’å…¥æ’åºçš„åŠ¨ç”»æ¼”ç¤ºå¦‚ä¸Šç¯‡æ–‡ç« ã€‚<br>æ¯æ¬¡è¿­ä»£æ—¶ï¼Œä»è¾“å…¥æ•°æ®ä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼ˆç”¨çº¢è‰²è¡¨ç¤ºï¼‰ï¼Œå¹¶åŸåœ°å°†å…¶æ’å…¥åˆ°å·²æ’å¥½åºçš„é“¾è¡¨ä¸­ã€‚<br>æ’å…¥æ’åºç®—æ³•ï¼š<br>æ’å…¥æ’åºæ˜¯è¿­ä»£çš„ï¼Œæ¯æ¬¡åªç§»åŠ¨ä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰åºçš„è¾“å‡ºåˆ—è¡¨ã€‚<br>æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ’å…¥æ’åºåªä»è¾“å…¥æ•°æ®ä¸­ç§»é™¤ä¸€ä¸ªå¾…æ’åºçš„å…ƒç´ ï¼Œæ‰¾åˆ°å®ƒåœ¨åºåˆ—ä¸­é€‚å½“çš„ä½ç½®ï¼Œå¹¶å°†å…¶æ’å…¥ã€‚<br>é‡å¤ç›´åˆ°æ‰€æœ‰è¾“å…¥æ•°æ®æ’å…¥å®Œä¸ºæ­¢ã€‚<br>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥: 4->2->1->3<br>è¾“å‡º: 1->2->3->4<br>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥: -1->5->3->4->0<br>è¾“å‡º: -1->0->3->4->5</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//beat 50%</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  ListNode <span class="title">insertionSortList</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    <span class="comment">//å“‘èŠ‚ç‚¹</span></span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(Integer.MIN_VALUE);</span><br><span class="line">    System.out.println(dummyNode.val);</span><br><span class="line">    dummyNode.next=head;</span><br><span class="line">    ListNode tempNode=head;</span><br><span class="line">    <span class="comment">//å¤–å¾ªç¯å†…çš„æŒ‡é’ˆ</span></span><br><span class="line">    ListNode loopVariable=head.next;</span><br><span class="line">    ListNode loopPre=head;</span><br><span class="line">    <span class="comment">//å†…å¾ªç¯çš„æŒ‡é’ˆ</span></span><br><span class="line">    ListNode tempPre=dummyNode;</span><br><span class="line">    <span class="keyword">while</span>(loopVariable!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="comment">//å¤´æ’æ³•</span></span><br><span class="line">        <span class="keyword">for</span> (tempNode=dummyNode;tempNode!=loopVariable;tempNode=tempNode.next){</span><br><span class="line">            <span class="keyword">if</span>(tempNode.val>loopVariable.val){</span><br><span class="line">                <span class="comment">//System.out.println(loopVariable.val);</span></span><br><span class="line">                <span class="comment">//printList(dummyNode.next);</span></span><br><span class="line">                <span class="comment">//å…ˆå¤„ç†å¥½loopVariableçš„å‰åèŠ‚ç‚¹</span></span><br><span class="line">                loopPre.next=loopVariable.next;</span><br><span class="line">                <span class="comment">//å†å¤„ç†tempNodeå‰åçš„èŠ‚ç‚¹</span></span><br><span class="line">                loopVariable.next=tempNode;</span><br><span class="line">                tempPre.next=loopVariable;</span><br><span class="line">                <span class="comment">//loopVariable å½’ä½</span></span><br><span class="line">                loopVariable=loopPre;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            tempPre=tempNode;</span><br><span class="line">        }</span><br><span class="line">        loopPre=loopVariable;</span><br><span class="line">        loopVariable=loopVariable.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸Šé¢çš„æ˜¯æˆ‘å¼€å§‹è‡ªå·±å†™çš„ï¼Œä½†æ˜¯æäº¤åå‘ç°é€Ÿåº¦æœ‰ç‚¹æ…¢40ms 50%å·¦å³ ç„¶åæˆ‘æœ‰ç‚¹ä¸ä¿¡æŠŠæ¯”è¾ƒé å‰çš„æ‹·äº†ä¸€ä¸ª 10msğŸ˜‚å‰å‡ å10msä»¥å†…çš„éƒ½æ˜¯ç”¨çš„æ–¹æ³•ä¸æ˜¯æ’å…¥â€¦.<br>åœ¨ç ”ç©¶åˆ«äºº10msçš„ä»£ç æ—¶çªç„¶æ„è¯†åˆ°äº†é—®é¢˜æ‰€åœ¨ æˆ‘åœ¨è¿›è¡Œæ’å…¥çš„æ—¶å€™æ²¡æœ‰åˆ¤æ–­å°±æ—¶æ²¡æœ‰å…³å¿ƒæ˜¯ä¸æ˜¯åº”è¯¥è¿›è¡Œæ’å…¥æ“ä½œï¼Œå¯¹äºæ•°ç»„çš„æ’å…¥æ’åºæ˜¯ä¸ç”¨å…³å¿ƒè¿™ä¸ªé—®é¢˜çš„ï¼Œå› ä¸ºæ˜¯åå‘éå†çš„ è€Œè¿™é‡Œæ˜¯é“¾è¡¨åªèƒ½æ­£å‘çš„éå†å¦‚æœä¸åˆ¤æ–­å°±ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 16ms  beat  70% å¼€å§‹å°‘å†™äº†ä¸€ä¸ªifåˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  ListNode <span class="title">insertionSortList</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    <span class="comment">//å“‘èŠ‚ç‚¹</span></span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(Integer.MIN_VALUE);</span><br><span class="line">    System.out.println(dummyNode.val);</span><br><span class="line">    dummyNode.next=head;</span><br><span class="line">    ListNode tempNode=head;</span><br><span class="line">    <span class="comment">//å¤–å¾ªç¯å†…çš„æŒ‡é’ˆ</span></span><br><span class="line">    ListNode loopVariable=head.next;</span><br><span class="line">    ListNode loopPre=head;</span><br><span class="line">    <span class="comment">//å†…å¾ªç¯çš„æŒ‡é’ˆ</span></span><br><span class="line">    ListNode tempPre=dummyNode;</span><br><span class="line">    <span class="keyword">while</span>(loopVariable!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="comment">//å¤´æ’æ³•</span></span><br><span class="line">        <span class="keyword">if</span>(loopVariable.val<looppre.val){< span><br><span class="line">            <span class="keyword">for</span> (tempNode=dummyNode;tempNode!=loopVariable;tempNode=tempNode.next){</span><br><span class="line">                <span class="keyword">if</span>(tempNode.val>loopVariable.val){</span><br><span class="line">                    <span class="comment">//System.out.println(loopVariable.val);</span></span><br><span class="line">                    <span class="comment">//printList(dummyNode.next);</span></span><br><span class="line">                    <span class="comment">//å…ˆå¤„ç†å¥½loopVariableçš„å‰åèŠ‚ç‚¹</span></span><br><span class="line">                    loopPre.next=loopVariable.next;</span><br><span class="line">                    <span class="comment">//å†å¤„ç†tempNodeå‰åçš„èŠ‚ç‚¹</span></span><br><span class="line">                    loopVariable.next=tempNode;</span><br><span class="line">                    tempPre.next=loopVariable;</span><br><span class="line">                    <span class="comment">//loopVariable å½’ä½</span></span><br><span class="line">                    loopVariable=loopPre;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                tempPre=tempNode;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        loopPre=loopVariable;</span><br><span class="line">        loopVariable=loopVariable.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></looppre.val){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™é¢˜æ•´ä½“æ€è·¯å°±æ˜¯æŒ‰ç…§æ’å…¥æ’åºçš„æ€è·¯æ¥çš„ï¼Œå€¼å¾—æ³¨æ„çš„å°±æ˜¯é“¾è¡¨åªèƒ½æ­£å‘éå†ï¼Œè€Œä¸”éœ€è¦è€ƒè™‘ä¿å­˜çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªï¼Œæ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªï¼Œä»¥åŠå¾…æ’å…¥çš„å‰ä¸€ä¸ª(å¤´æ’æ³•)ã€‚</p><hr><h2 id="148-æ’åºé“¾è¡¨"><a href="#148-æ’åºé“¾è¡¨" class="headerlink" title="148. æ’åºé“¾è¡¨"></a><font color="red" size="5" face="é»‘ä½“">148. æ’åºé“¾è¡¨</font></h2><p>åœ¨ O(n log n) æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦ä¸‹ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ’åºã€‚</p><p>ç¤ºä¾‹ 1:</p><p>è¾“å…¥: 4->2->1->3<br>è¾“å‡º: 1->2->3->4<br>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: -1->5->3->4->0<br>è¾“å‡º: -1->0->3->4->5</p><blockquote><p>ä¸Šé¢é‚£é¢˜æ—¶é—´å¤æ‚åº¦æ˜æ˜¾æ˜¯O(n2)æœ€åï¼Œè¿™é¢˜è¦æ±‚æ˜¯O(nlogn)å’Œå¸¸æ•°ç©ºé—´ä¸Šé¢çš„æ’å…¥è‚¯å®šä¸é€‚åˆäº†</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å½’å¹¶æ’æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  ListNode <span class="title">sortList</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>)<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> mergeSort(head);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">mergeSort</span><span class="params">(ListNode head)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(head.next==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line">    ListNode fast=head;</span><br><span class="line">    ListNode slow=head;</span><br><span class="line">    ListNode pre=head;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="keyword">null</span>&&fast.next!=<span class="keyword">null</span>){</span><br><span class="line">        pre=slow;</span><br><span class="line">        fast=fast.next.next;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">    }</span><br><span class="line">    pre.next=<span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//è¿™é‡Œè¦æ³¨æ„æ–­å¼€ä¸¤æ¡é“¾è¡¨ä¸ç„¶åé¢ä¸æ–¹ä¾¿æ‰¾ä¸­ç‚¹</span></span><br><span class="line">    ListNode left = mergeSort(head);</span><br><span class="line">    <span class="comment">//å½’å¹¶å·¦è¾¹</span></span><br><span class="line">    ListNode right = mergeSort(slow);</span><br><span class="line">    <span class="comment">//å½’å¹¶å³è¾¹</span></span><br><span class="line">    <span class="keyword">return</span> merge2list(left,right);</span><br><span class="line">    <span class="comment">//è¿”å› å·¦å³ä¸¤æ¡é“¾è¡¨å½’å¹¶ç»“æœ</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">merge2list</span><span class="params">(ListNode headA,ListNode headB)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(headA==<span class="keyword">null</span>)<span class="keyword">return</span> headB;</span><br><span class="line">    <span class="keyword">if</span>(headB==<span class="keyword">null</span>)<span class="keyword">return</span> headA;</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    dummyNode.next=headA;</span><br><span class="line">    ListNode temp=dummyNode;</span><br><span class="line">    <span class="keyword">while</span>(headA!=<span class="keyword">null</span>&&headB!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(headA.val>headB.val){</span><br><span class="line">            temp.next=headB;</span><br><span class="line">            headB=headB.next;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            temp.next=headA;</span><br><span class="line">            headA=headA.next;</span><br><span class="line">        }</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    temp.next=headA==<span class="keyword">null</span>?headB:headA;</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>â€‹        4ms 85%  æ ‡å‡†çš„<code>å½’å¹¶æ“ä½œ</code><em>åˆ†æ²»</em>çš„æ€æƒ³ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ‰£äº†å¥½é•¿æ—¶é—´ï¼Œæœ€åè¿˜æ˜¯çœ‹äº†åˆ«äººçš„ä»£ç æ‰çŸ¥é“ï¼Œå…¶å®ä¸€å¼€å§‹å°±æƒ³åˆ°äº†<code>å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹</code>ä½†æ˜¯æ„Ÿè§‰æ—¶é—´å¤æ‚åº¦å¯èƒ½ä¼šå˜å¾—æ›´é«˜å°±æ²¡é‚£æ ·åšã€‚ã€‚ã€‚è¿˜æ˜¯å¤ªèœäº†æ—¶é—´å¤æ‚åº¦éƒ½ä¸ä¼šåˆ†æã€‚ã€‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå°åœ°æ–¹å°±æ˜¯æ‰¾åˆ°ä¸­ç‚¹ä¹‹åè¦è®°å¾—æ–­å¼€ä¸­ç‚¹å’Œåé¢é“¾è¡¨çš„è¿æ¥ï¼Œè¿™æ ·ä¼šæ–¹ä¾¿åé¢å½’å¹¶ï¼Œä¸ç„¶å°±éœ€è¦ä¼ é€’ä¸€ä¸ªè¾¹ç•Œçš„æŒ‡é’ˆé‚£æ ·åˆä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼ˆæ²¡é”™æˆ‘å¼€å§‹å°±æ˜¯è¿™ä¹ˆåšçš„ğŸ˜­ï¼‰</p><p>   ä¸‹é¢è¿™ç§æ˜¯åæ¥åˆå†™çš„<code>ç»å…¸å¿«æ’</code>ï¼Œ400msï¼Œ12% æˆ‘éƒ½æ€€ç–‘æˆ‘åˆ°åº•å†™äº†ä¸ªå•¥ï¼Ÿåæ¥æŠŠæ’å…¥æ‹¿æ¥è¯•äº†ä¸‹884+msç„¶ååˆçœ‹äº†ä¸€éæ‰ç›¸ä¿¡æˆ‘å†™çš„æ˜¯å¿«æ’ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æˆ‘è‡ªå·±å†™çš„å¿«æ’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">sortList4</span><span class="params">(ListNode head)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    sortList(head,<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¿«æ’å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sortList</span><span class="params">(ListNode head,ListNode tail)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(tail==head){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ç¡®å®šæ¢çº½å…ƒç´ </span></span><br><span class="line">    ListNode base=partion(head,tail);</span><br><span class="line">    sortList(head,base);</span><br><span class="line">    sortList(base.next,tail);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//çœ‹äº†ä¸‹åˆ«äººçš„åšå®¢ä¹Ÿå­¦åˆ°äº†ä¸€ç§å¿«æ’çš„æ–°æ€è·¯</span></span><br><span class="line"><span class="comment">//æ…¢æŒ‡é’ˆå·¦è¾¹éƒ½æ˜¯å°äºbaseæ¢çº½å…ƒç´ çš„ï¼Œå¿«æŒ‡é’ˆå’Œæ…¢æŒ‡é’ˆä¸­é—´éƒ½æ˜¯å¤§äºç­‰äºbaseæ¢çº½å…ƒç´ çš„</span></span><br><span class="line"><span class="comment">//æ…¢æŒ‡é’ˆåé¢çš„éƒ½æ˜¯æœªçŸ¥åŒºåŸŸ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">partion</span><span class="params">(ListNode head,ListNode tail)</span></span>{</span><br><span class="line">    ListNode base=head;</span><br><span class="line">    ListNode fast=head.next;</span><br><span class="line">    ListNode slow=head;</span><br><span class="line">    <span class="comment">// 3  1  3  2  5  -1 0</span></span><br><span class="line">    <span class="comment">//    s  f</span></span><br><span class="line">    <span class="keyword">while</span>(fast!=tail){</span><br><span class="line">        <span class="keyword">if</span>(fast.val<=base.val){</span><br><span class="line">            <span class="comment">//äº¤æ¢ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">            swap(fast,slow.next);</span><br><span class="line">            slow=slow.next;</span><br><span class="line">        }</span><br><span class="line">        fast=fast.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å½’ä½</span></span><br><span class="line">    swap(head,slow);</span><br><span class="line">    <span class="comment">//åº”è¯¥å¯ä»¥è¯•è¯•è¿”å›åŒºé—´</span></span><br><span class="line">    <span class="keyword">return</span> slow;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(ListNode a,ListNode b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=a.val;</span><br><span class="line">    a.val=b.val;</span><br><span class="line">    b.val=temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>å®é™…ä¸Šå¿«æ’ç¡®å®ä¸é€‚åˆé“¾è¡¨ï¼ˆä¸‹é¢å…‰é€Ÿæ‰“è„¸ï¼‰å› ä¸ºæ¯•ç«Ÿä¸æ˜¯æ•°ç»„å¯ä»¥ä»ä¸¤è¾¹å¼€å§‹éå†ï¼Œé“¾è¡¨æ¯æ¬¡éƒ½éœ€è¦éå†æ•´ä¸ªé“¾è¡¨æ‰èƒ½åˆ’åˆ†å¥½åŸºå‡†ä½ç½®ã€‚</p></blockquote><p>çœ‹äº†ä¸‹å‰å‡ çš„ä»£ç å‘ç°äº†è¿™ä¸ªï¼Œ<code>éæ ‡å‡†çš„ä¸‰å‘åˆ‡åˆ†çš„å¿«æ’</code>ï¼Œä¸ºå•¥è¯´æ˜¯éæ ‡å‡†å‘¢ï¼Ÿçœ‹ä¸‹é¢ä»£ç å°±çŸ¥é“äº†ï¼Œæˆ‘ç»™åŠ äº†æ³¨é‡Š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">sortList3</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    ListNode node = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">    node.next = head;</span><br><span class="line">    sort(node, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> node.next;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(ListNode from, ListNode to)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (from == <span class="keyword">null</span> || from == to || from.next == to || from.next.next == to)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> v = from.next.val;</span><br><span class="line">    <span class="comment">//åŸºå‡†å…ƒç´ </span></span><br><span class="line">    ListNode mid = from;</span><br><span class="line">    <span class="comment">//åˆ‡åˆ†ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    ListNode equal = from.next;</span><br><span class="line">    <span class="comment">//ç­‰äºåŒºåŸŸå³è¾¹ç•Œ</span></span><br><span class="line">    ListNode node = from.next;</span><br><span class="line">    <span class="comment">//éå†ç”¨çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">while</span> (node.next != to) {</span><br><span class="line">        <span class="comment">//nodeä¸åˆ°å¤´  å·¦å¼€å³å¼€åŒºé—´ï¼ˆfrom,toï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (node.next.val < v) {</span><br><span class="line">            <span class="comment">//å°äºåŸºå‡†ä½ç½®å…ƒç´ </span></span><br><span class="line">            <span class="comment">//ä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œç”¨äºæ’å…¥èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">//å°äºåŸºå‡†å…ƒç´ çš„èŠ‚ç‚¹</span></span><br><span class="line">            ListNode currentNext = node.next.next;</span><br><span class="line">            <span class="comment">//ä¿å­˜åˆ‡åˆ†ç‚¹çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä½œç”¨åŒä¸Š</span></span><br><span class="line">            ListNode midNext = mid.next;</span><br><span class="line">            <span class="comment">//äº¤æ¢node.nextå’Œmid</span></span><br><span class="line">            <span class="comment">//çº¸ä¸Šç”»ä¸€ä¸‹å°±äº†è§£äº†</span></span><br><span class="line">            mid.next = node.next;</span><br><span class="line">            node.next.next = midNext;</span><br><span class="line">            node.next = currentNext;</span><br><span class="line">            <span class="comment">//åˆ‡åˆ†ç‚¹åç§»</span></span><br><span class="line">            mid = mid.next;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (node.next.val == v) {</span><br><span class="line">            <span class="comment">//nodeçš„ä¸‹ä¸€ä¸ªç­‰äºåŸºå‡†å…ƒç´ </span></span><br><span class="line">            <span class="comment">//3 1 2 3 4 5 6</span></span><br><span class="line">            <span class="keyword">if</span> (equal == node) {</span><br><span class="line">                <span class="comment">//ç­‰äºåŒºåŸŸå’Œnode.next==valç›¸é‚»äº†ï¼Œç›´æ¥è·³è¿‡</span></span><br><span class="line">                equal = node.next;</span><br><span class="line">                node = node.next;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">//å°†node.nextæ’å…¥equalåé¢</span></span><br><span class="line">                <span class="comment">//ç„¶åequalå‘åç§»åŠ¨</span></span><br><span class="line">                <span class="comment">//å’Œä¸Šé¢çš„ç±»ä¼¼</span></span><br><span class="line">                ListNode nodeNext = node.next.next;</span><br><span class="line">                ListNode equalNext = equal.next;</span><br><span class="line">                equal.next = node.next;</span><br><span class="line">                node.next.next = equalNext;</span><br><span class="line">                node.next = nodeNext;</span><br><span class="line">                equal = equal.next;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">//å¤§äºç›´æ¥è·³è¿‡</span></span><br><span class="line">            node = node.next;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// [mid.next---equal] ä¸ºç­‰äºvalçš„èŠ‚ç‚¹</span></span><br><span class="line">    sort(from, mid.next);</span><br><span class="line">    sort(equal, to);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ•´ä½“æ€è·¯å°±æ˜¯ä¸€å…±æœ‰ä¸‰ä¸ªæŒ‡é’ˆï¼Œ<code>mid</code>(åˆ‡åˆ†ç‚¹)  <code>equal</code>(ç­‰äºåŒº) <code>node</code>(éå†æŒ‡é’ˆ) nodeä»froméå†åˆ°toï¼Œæ³¨æ„è¿™é‡Œæ˜¯<code>å·¦å¼€å³å¼€åŒºé—´</code> å°±æ˜¯è¯´å¤´fromå’Œå°¾toéƒ½å–ä¸åˆ°ï¼Œç„¶åå°†å°ä¸baseçš„èŠ‚ç‚¹æ’å…¥åˆ°midçš„åé¢ï¼Œç„¶åmidåç§»ï¼Œç­‰äºåŒºæ’å…¥åˆ°equalçš„åé¢ï¼Œæœ€åå½¢æˆçš„å°±æ˜¯<code>[mid.next---equal]</code> ä¸ºç­‰äºvalçš„èŠ‚ç‚¹ï¼Œç„¶åå¯¹å­åŒºåŸŸé€’å½’å°±okäº†ï¼Œè¿™ä¸ªç”¨æ—¶ <code>4ms</code> ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è¿˜è¦ç»§ç»­åŠ æ²¹å•Šï¼ï¼ï¼</p><hr><h2 id="138-å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨"><a href="#138-å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨" class="headerlink" title="138.å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨"></a><font color="red" size="5" face="é»‘ä½“">138.å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨</font></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚</p><p>è¦æ±‚è¿”å›è¿™ä¸ªé“¾è¡¨çš„æ·±æ‹·è´ã€‚<br>ç¤ºä¾‹ï¼š<br><img alt="mark" data-src="http://static.imlgw.top///20190308/tR8e3eu2yqaq.png?imageslim" src="/img/loading.gif" class="lazyload"><br>è¾“å…¥ï¼š<br><code>{"$id":"1","next":{"$id":"2","next":null,"random":{"$ref":"2"},"val":2},"random":{"$ref":"2"},"val":1}</code><br>è§£é‡Šï¼š<br>èŠ‚ç‚¹ 1 çš„å€¼æ˜¯ 1ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆå’ŒéšæœºæŒ‡é’ˆéƒ½æŒ‡å‘èŠ‚ç‚¹ 2 ã€‚<br>èŠ‚ç‚¹ 2 çš„å€¼æ˜¯ 2ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ nullï¼ŒéšæœºæŒ‡é’ˆæŒ‡å‘å®ƒè‡ªå·±ã€‚</p><p>æç¤ºï¼š<br>ä½ å¿…é¡»è¿”å›ç»™å®šå¤´çš„æ‹·è´ä½œä¸ºå¯¹å…‹éš†åˆ—è¡¨çš„å¼•ç”¨ã€‚</p><p><strong>è§£æ³•ä¸€ï¼š</strong> åˆ©ç”¨Map</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">copyRandomList</span><span class="params">(Node head)</span> </span>{</span><br><span class="line">    Map<node,node> copNode =<span class="keyword">new</span> HashMap<>();</node,node></span><br><span class="line">    Node temp=head;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="comment">//å»ºç«‹å¯¹åº”å…³ç³»</span></span><br><span class="line">        copNode.put(temp,<span class="keyword">new</span> Node(temp.val,<span class="keyword">null</span>,<span class="keyword">null</span>));</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å†å¾ªç¯ä¸€æ¬¡å¤åˆ¶nextå’ŒRadomèŠ‚ç‚¹</span></span><br><span class="line">    temp=head;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        copNode.get(temp).next=copNode.get(temp.next);</span><br><span class="line">        copNode.get(temp).random=copNode.get(temp.random);</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> copNode.get(head);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç¬¬ä¸€ä¸ªå¾ªç¯åˆ©ç”¨Mapå°†åŸé“¾è¡¨å’Œæ‹·è´é“¾è¡¨å½¢æˆå¯¹åº”å…³ç³»ï¼Œç¬¬äºŒä¸ªå¾ªç¯å°±æ˜¯ç›´æ¥ç»™æ‹·è´é“¾è¡¨çš„nextåŸŸå’ŒrandomåŸŸèµ‹å€¼ã€‚</p><p><strong>è§£æ³•äºŒï¼š</strong><code>å¥¥ä¹‰ å½±åˆ†èº«</code></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">copyRandomList2</span><span class="params">(Node head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    Node temp=head;</span><br><span class="line">    <span class="comment">//é“¾è¡¨  å¥¥ä¹‰ - å½±åˆ†èº«</span></span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="comment">//è¿™é‡Œç›´æ¥å°†nextåŸŸä¼ å…¥æ„é€ å™¨å®Œæˆå’Œåé¢å…ƒç´ çš„è¿æ¥</span></span><br><span class="line">        temp.next=<span class="keyword">new</span> Node(temp.val,temp.next,<span class="keyword">null</span>);</span><br><span class="line">        temp=temp.next.next;</span><br><span class="line">    }</span><br><span class="line">    temp=head;</span><br><span class="line">    <span class="comment">//è¿æ¥randomåŸŸ</span></span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(temp.random!=<span class="keyword">null</span>){</span><br><span class="line">            temp.next.random=temp.random.next;</span><br><span class="line">        }</span><br><span class="line">        temp=temp.next.next;</span><br><span class="line">    }</span><br><span class="line">    temp=head;</span><br><span class="line">    <span class="comment">// åˆ†ç¦»</span></span><br><span class="line">    Node newHead=head.next;</span><br><span class="line">    Node next=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        next=temp.next;</span><br><span class="line">        <span class="keyword">if</span>(next!=<span class="keyword">null</span>){</span><br><span class="line">            temp.next=next.next;</span><br><span class="line">        }</span><br><span class="line">        temp=next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸ºå•¥è¦å«å½±åˆ†èº«ï¼Ÿå› ä¸ºå¸…â€¦è¿™ç§æ–¹æ³•æ¯”ä¸Šé¢çš„è¦å¿«ä¸€ç‚¹å¯èƒ½æ˜¯åˆ›å»ºhashMapæ¯”è¾ƒè€—æ—¶é—´ï¼Œå…¶å®åˆ†æè¿™ä¸¤ç§æ–¹æ³•å…¶å®éƒ½æ˜¯å…ˆæŠŠé“¾è¡¨æ‹·è´äº†ä¸€ä»½ï¼Œç„¶åé€šè¿‡å¯¹åº”å…³ç³»æ¥è¿æ¥æ‹·è´é“¾è¡¨çš„nextå’ŒrandomåŸŸï¼Œmapæ˜¯é€šè¿‡é”®å€¼å¯¹çš„æ–¹å¼å¯¹åº”æ‹·è´é“¾è¡¨ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿çš„é€šè¿‡åŸé“¾è¡¨æ‰¾åˆ°æ‹·è´é“¾è¡¨çš„random. ç„¶åä¸Šé¢è¿™ç§æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·ï¼Œåœ¨åŸé“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹åé¢copyä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„randomæ¥æ‰¾æ‹·è´èŠ‚ç‚¹çš„random(å‰ä¸€ä¸ªèŠ‚ç‚¹çš„randomçš„next) ä¸»è¦å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”å…³ç³».</p><blockquote><p>tips: è¿™é¢˜OJä¸Šçš„0msæ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™é¢˜æœ¬æ„è‚¯å®šä¹Ÿä¸æ˜¯è¿™ä¸ª</p><p><img alt="mark" data-src="http://static.imlgw.top///20190308/p1GPgJVYaURp.png?imageslim" src="/img/loading.gif" class="lazyload"></p></blockquote><p>æœ€å¼€å§‹èƒ½é€šè¿‡ä¸»è¦æ˜¯OJåå°åªåˆ¤æ–­äº†valçš„å€¼ï¼Œå¯ä»¥çœ‹å‡ºç°åœ¨é¢˜ç›®å·²ç»æ”¹äº†ã€‚ç°åœ¨è‚¯å®šæ˜¯è·‘ä¸è¿‡çš„ï¼Œå¯èƒ½æ˜¯åˆ¤æ–­äº†randomæ˜¯ä¸æ˜¯newå‡ºæ¥çš„(æˆ‘è¯•äº†ä¸‹çœ‹äº†ä¸‹è¿”å›è¿™ä¸ª)<br>è¾“å…¥<br><code>{"$id":"1","next":{"$id":"2","next":null,"random":{"$ref":"2"},"val":2},"random":{"$ref":"2"},"val":1}</code><br>è¾“å‡º<br><code>{"$id":"1","next":{"$id":"2","next":null,"random":</code></p><p><code>{"$id":"3","next":null,"random":null,"val":2},"val":2},</code></p><p><code>"random":{"$id":"4","next":null,"random":null,"val":2},"val":1}</code><br>é¢„æœŸç»“æœ<br><code>{"$id":"1","next":{"$id":"2","next":null,"random":{"$ref":"2"},"val":2},"random":{"$ref":"2"},"val":1}</code></p><hr><h2 id="24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"><a href="#24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹" class="headerlink" title="24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"></a><strong>24. <a href="https://leetcode-cn.com/problems/swap-nodes-in-pairs/" target="_blank" rel="noopener">ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</a></strong></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›äº¤æ¢åçš„é“¾è¡¨ã€‚</p><p>ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><p>ç»™å®š 1->2->3->4, ä½ åº”è¯¥è¿”å› 2->1->4->3.</p><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">swapPairs</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    dummyNode.next=head;</span><br><span class="line">    ListNode nex=head.next;</span><br><span class="line">    ListNode cur=head;</span><br><span class="line">    ListNode pre=dummyNode;</span><br><span class="line">    <span class="comment">// -1|1 2 3 4</span></span><br><span class="line">    <span class="keyword">while</span>(nex!=<span class="keyword">null</span>){</span><br><span class="line">        pre.next=nex;</span><br><span class="line">        cur.next=nex.next;</span><br><span class="line">        nex.next=cur;</span><br><span class="line">        pre=cur;</span><br><span class="line">        <span class="keyword">if</span>(cur.next==<span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">        }</span><br><span class="line">        cur=cur.next;</span><br><span class="line">        nex=cur.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®è·Ÿåè½¬é“¾è¡¨æ˜¯ä¸€æ ·çš„ï¼Œä¸‰ä¸ªæŒ‡é’ˆåˆ†åˆ«è®°å½•å‰ ä¸­ åä¸‰ä¸ªèŠ‚ç‚¹ç„¶åé€†åºï¼Œåªä¸è¿‡æ­¥é•¿ä¸ä¸€æ ·ï¼Œè¿™é‡Œstepä¸º2ï¼Œä¸€æ¬¡èµ°ä¸¤æ­¥ï¼Œ æˆ‘ä¸Šé¢çš„ä»£ç å¯èƒ½å†™çš„æœ‰äº›ä¹±ï¼Œæ€è·¯è¿˜æ˜¯ä¸€æ ·çš„</p><p><strong>è§£æ³•äºŒ</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//é€’å½’ç‰ˆæœ¬</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ListNode <span class="title">swapPairs</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line">    ListNode next=head.next;</span><br><span class="line">    head.next=swapPairs(next.next);</span><br><span class="line">    next.next=head;</span><br><span class="line">    <span class="keyword">return</span> next;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>é€’å½’æ˜¯çœŸçš„ç®€æ´ï¼Œæˆ‘æœ€å¼€å§‹å†™åè½¬é“¾è¡¨çš„é€’å½’å°±æ˜¯è¿™ä¹ˆå†™çš„ğŸ˜‚</p><hr><h2 id="25-Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"><a href="#25-Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨" class="headerlink" title="25.Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"></a><font color="red" size="5" face="é»‘ä½“">25.Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</font></h2><p>ç»™å‡ºä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ k ä¸ªèŠ‚ç‚¹ä¸€ç»„è¿›è¡Œç¿»è½¬ï¼Œå¹¶è¿”å›ç¿»è½¬åçš„é“¾è¡¨ã€‚</p><p>k æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå®ƒçš„å€¼å°äºæˆ–ç­‰äºé“¾è¡¨çš„é•¿åº¦ã€‚å¦‚æœèŠ‚ç‚¹æ€»æ•°ä¸æ˜¯ k çš„æ•´æ•°å€ï¼Œé‚£ä¹ˆå°†æœ€åå‰©ä½™èŠ‚ç‚¹ä¿æŒåŸæœ‰é¡ºåºã€‚</p><p><strong>ç¤ºä¾‹ :</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®šè¿™ä¸ªé“¾è¡¨ï¼š<span class="number">1</span>-><span class="number">2</span>-><span class="number">3</span>-><span class="number">4</span>-><span class="number">5</span></span><br><span class="line">å½“ k = <span class="number">2</span> æ—¶ï¼Œåº”å½“è¿”å›: <span class="number">2</span>-><span class="number">1</span>-><span class="number">4</span>-><span class="number">3</span>-><span class="number">5</span></span><br><span class="line">å½“ k = <span class="number">3</span> æ—¶ï¼Œåº”å½“è¿”å›: <span class="number">3</span>-><span class="number">2</span>-><span class="number">1</span>-><span class="number">4</span>-><span class="number">5</span></span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¯´æ˜ :</strong></p><ul><li>ä½ çš„ç®—æ³•åªèƒ½ä½¿ç”¨å¸¸æ•°çš„é¢å¤–ç©ºé—´ã€‚</li><li>ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚</li></ul><p><strong>è§£æ³•ä¸€</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//éé€’å½’ï¼Œç†ä¸€ä¸‹æ€è·¯ï¼š è®°å½•æ¯æ¬¡ç¿»è½¬å‰åçš„èŠ‚ç‚¹ ç„¶åç¿»è½¬è¿”å›å¤´ å°†æ¯ K ä¸ªå…ƒç´ å½“æˆä¸€ä¸ªæ•´ä½“</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">reverseKGroup</span><span class="params">(ListNode head,<span class="keyword">int</span> k)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>)<span class="keyword">return</span> head;</span><br><span class="line">    ListNode dummyNode=<span class="keyword">new</span> ListNode(-<span class="number">1</span>);</span><br><span class="line">    dummyNode.next=head;</span><br><span class="line">    ListNode pre=dummyNode;</span><br><span class="line">    ListNode cur=head;</span><br><span class="line">    ListNode next=head;</span><br><span class="line">    ListNode temp;</span><br><span class="line">    <span class="keyword">while</span>(next!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="comment">//temp ä¿å­˜ cur æ–¹ä¾¿åé¢è¿æ¥  K+1ä½ç½®çš„å…ƒç´ </span></span><br><span class="line">        temp=cur;</span><br><span class="line">        <span class="comment">//k ä¸ªä¸€ç»„ç¿»è½¬</span></span><br><span class="line">        <span class="keyword">int</span> step=k;</span><br><span class="line">        <span class="keyword">while</span>(step><span class="number">0</span> && next!=<span class="keyword">null</span>){</span><br><span class="line">            <span class="comment">//nextèµ°åˆ° K+1 ä½ç½®èŠ‚ç‚¹</span></span><br><span class="line">            next=next.next;</span><br><span class="line">            step--;</span><br><span class="line">            <span class="comment">//å°ç»†èŠ‚ k>é“¾è¡¨é•¿åº¦æ—¶åº”è¯¥ç›´æ¥è¿”å›ï¼ˆæˆ‘è®¤ä¸ºï¼‰ç­‰ä¸‹æäº¤äº†çœ‹çœ‹</span></span><br><span class="line">            <span class="comment">//æ‰€ä»¥ç›´æ¥åº”è¯¥ç›´æ¥è¿”å› (æ‰äº†kçš„å€¼åˆ¤æ–­ å› ä¸ºæœ‰å¯èƒ½åˆšå¥½æœ‰kä¸ªå…ƒç´ )</span></span><br><span class="line">            <span class="keyword">if</span>(next==<span class="keyword">null</span>&& step!=<span class="number">0</span>){</span><br><span class="line">                <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ç¿»è½¬ cur--next.prev è¿”å›å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">//è¿æ¥ åè½¬åçš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">        pre.next=reverse(cur,k);</span><br><span class="line">        temp.next=next;</span><br><span class="line">        <span class="comment">//pre tempå‘åç§»åŠ¨</span></span><br><span class="line">        pre=temp;</span><br><span class="line">        cur=next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// -1| 1 2 3 | 4 5 6 | 7 8</span></span><br><span class="line"><span class="comment">//ç¿»è½¬é“¾è¡¨å¹¶è¿”å›å­é“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title">reverse</span><span class="params">(ListNode node,<span class="keyword">int</span> k)</span></span>{</span><br><span class="line">    ListNode pre=<span class="keyword">null</span>;</span><br><span class="line">    ListNode cur=node;</span><br><span class="line">    ListNode next=node;</span><br><span class="line">    <span class="keyword">while</span>(k><span class="number">0</span>&&next!=<span class="keyword">null</span>){</span><br><span class="line">        next=next.next;</span><br><span class="line">        cur.next=pre;</span><br><span class="line">        pre=cur;</span><br><span class="line">        cur=next;</span><br><span class="line">        k--;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è¿”å›åè½¬åçš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">    System.out.println(<span class="string">"å¤´"</span>+pre.val);</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><blockquote><p>7ms 74% ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€é“åšå‡ºæ¥çš„å›°éš¾é¢˜ï¼Œ<a href="http://imlgw.top/2018/10/31/%E4%B8%80%E9%81%93LeetCode%E5%BC%95%E5%8F%91%E7%9A%84%E6%83%A8%E6%A1%88/">ä¸Šä¸€é“å›°éš¾é¢˜è¶…æ—¶äº†</a><br>è¿™é¢˜è™½ç„¶è¯´æ˜¯å›°éš¾é¢˜ä½†æ˜¯å…¶å®ä¹Ÿä¸éš¾ï¼Œæ„Ÿè§‰å°±midå·¦å³çš„æ°´å¹³ï¼Œç¡®å®æ¯”ä¸Šä¸€é¢˜è¦å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯åªè¦æ€è·¯ç†æ¸…æ¥šå…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œä¸‹é¢æ˜¯æˆ‘ç”¨OneNoteç”»çš„ä¸€å¼ å›¾ç‰‡ã€‚<br>4ä¸ªæŒ‡é’ˆåˆ†åˆ«å¯¹åº” K é“¾è¡¨çš„ å‰ä¸€ä¸ª(pre)  Ké“¾è¡¨çš„å¤´èŠ‚ç‚¹(cur) æ²¡æœ‰ç¿»è½¬å‰çš„Ké“¾è¡¨çš„å¤´èŠ‚ç‚¹and<code>ç¿»è½¬åçš„å°¾èŠ‚ç‚¹(temp)</code>   Ké“¾è¡¨çš„åä¸€ä¸ªèŠ‚ç‚¹(next)ã€‚ç„¶åå…¶å®å°±ç®€å•äº†ï¼Œå†™ä¸€ä¸ªç¿»è½¬é“¾è¡¨çš„å‡½æ•°ç„¶åè¿”å›å¤´èŠ‚ç‚¹(ä¹Ÿå¯ä»¥å¤šåŠ ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘<code>ç¿»è½¬å‰çš„å¤´èŠ‚ç‚¹</code>)ï¼Œç„¶åå°±ç®€å•äº†ï¼ŒnextæŒ‡é’ˆä¸€æ¬¡èµ°Kæ­¥ï¼Œèµ°åˆ° K+1 ä½ç½® åŒæ—¶ä¹Ÿæ˜¯<code>ä¸‹ä¸€æ¬¡Ké“¾è¡¨çš„å¤´èŠ‚ç‚¹</code>ï¼Œè€Œtempåˆ™ä¸ºä¸‹ä¸€æ¬¡Ké“¾è¡¨çš„preâ€¦ç„¶åå¾ªç¯è¿™ä¸ªè¿‡ç¨‹å°±è¡Œäº†ï¼Œå…¶å®å†™æˆé€’å½’ä¼šå¾ˆç®€æ´ï¼Œä½†æ˜¯æˆ‘æ˜¯çœŸçš„ä¸ä¼šå†™é€’å½’ï¼Œå¤ªèœäº†Orz</p></blockquote><p><img alt="mark" data-src="http://static.imlgw.top///20190312/jl7moiy7PbjH.png?imageslim" src="/img/loading.gif" class="lazyload"></p><hr><h2 id="817-é“¾è¡¨ç»„ä»¶"><a href="#817-é“¾è¡¨ç»„ä»¶" class="headerlink" title="817. é“¾è¡¨ç»„ä»¶"></a><strong>817. é“¾è¡¨ç»„ä»¶</strong></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼ˆé“¾è¡¨ç»“ç‚¹åŒ…å«ä¸€ä¸ªæ•´å‹å€¼ï¼‰çš„å¤´ç»“ç‚¹ headã€‚<br>åŒæ—¶ç»™å®šåˆ—è¡¨ Gï¼Œè¯¥åˆ—è¡¨æ˜¯ä¸Šè¿°é“¾è¡¨ä¸­æ•´å‹å€¼çš„ä¸€ä¸ªå­é›†ã€‚<br>è¿”å›åˆ—è¡¨ G ä¸­ç»„ä»¶çš„ä¸ªæ•°ï¼Œè¿™é‡Œå¯¹ç»„ä»¶çš„å®šä¹‰ä¸ºï¼šé“¾è¡¨ä¸­ä¸€æ®µæœ€é•¿è¿ç»­ç»“ç‚¹çš„å€¼ï¼ˆè¯¥å€¼å¿…é¡»åœ¨åˆ—è¡¨ G ä¸­ï¼‰æ„æˆçš„é›†åˆã€‚<br>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥:<br>head: 0->1->2->3<br>G = [0, 1, 3]<br>è¾“å‡º: 2<br>è§£é‡Š:<br>é“¾è¡¨ä¸­,0 å’Œ 1 æ˜¯ç›¸è¿æ¥çš„ï¼Œä¸” G ä¸­ä¸åŒ…å« 2ï¼Œæ‰€ä»¥ [0, 1] æ˜¯ G çš„ä¸€ä¸ªç»„ä»¶ï¼ŒåŒç† [3] ä¹Ÿæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œæ•…è¿”å› 2ã€‚<br>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥:<br>head: 0->1->2->3->4<br>G = [0, 3, 1, 4]<br>è¾“å‡º: 2<br>è§£é‡Š:<br>é“¾è¡¨ä¸­ï¼Œ0 å’Œ 1 æ˜¯ç›¸è¿æ¥çš„ï¼Œ3 å’Œ 4 æ˜¯ç›¸è¿æ¥çš„ï¼Œæ‰€ä»¥ [0, 1] å’Œ [3, 4] æ˜¯ä¸¤ä¸ªç»„ä»¶ï¼Œæ•…è¿”å› 2ã€‚<br>æ³¨æ„:<br>å¦‚æœ N æ˜¯ç»™å®šé“¾è¡¨ head çš„é•¿åº¦ï¼Œ1 <= N <= 10000ã€‚<br>é“¾è¡¨ä¸­æ¯ä¸ªç»“ç‚¹çš„å€¼æ‰€åœ¨èŒƒå›´ä¸º [0, N - 1]ã€‚<br>1 <= G.length <= 10000<br>G æ˜¯é“¾è¡¨ä¸­æ‰€æœ‰ç»“ç‚¹çš„å€¼çš„ä¸€ä¸ªå­é›†.</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numComponents</span><span class="params">(ListNode head, <span class="keyword">int</span>[] G)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="keyword">null</span>||head.next==<span class="keyword">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">    ListNode temp=head;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(isInG(temp.val,G)){</span><br><span class="line">            <span class="keyword">while</span>(temp!=<span class="keyword">null</span>&&isInG(temp.val,G)){</span><br><span class="line">                temp=temp.next;</span><br><span class="line">            }</span><br><span class="line">            res++;</span><br><span class="line">            <span class="keyword">if</span>(temp==<span class="keyword">null</span>){</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">isInG</span><span class="params">(<span class="keyword">int</span> val,<span class="keyword">int</span>[] G)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<g.length;i++){< span><br><span class="line">        <span class="keyword">if</span>(G[i]==val){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br></g.length;i++){<></span></pre></td></tr></tbody></table></figure></div><p>é¦–å…ˆæƒ³åˆ°çš„æ–¹æ³• 91ms 19%â€¦.. æœ‰ç‚¹æ…¢äº†ï¼Œç„¶åæˆ‘ç¨å¾®æ”¹äº†ä¸‹ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numComponents2</span><span class="params">(ListNode head, <span class="keyword">int</span>[] G)</span> </span>{</span><br><span class="line">    ListNode temp=head;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    Boolean [] isInG=<span class="keyword">new</span> Boolean[<span class="number">10000</span>];</span><br><span class="line">    <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<g.length;i++){< span><br><span class="line">            <span class="keyword">if</span>(G[i]==temp.val){</span><br><span class="line">                isInG[j]=<span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        j++;</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    temp=head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;temp!=<span class="keyword">null</span>;temp=temp.next,i++){</span><br><span class="line">        <span class="keyword">if</span>(isInG[i]){</span><br><span class="line">            <span class="keyword">while</span>(temp!=<span class="keyword">null</span>&&isInG[i]){</span><br><span class="line">                temp=temp.next;</span><br><span class="line">                i++;</span><br><span class="line">            }</span><br><span class="line">            res++;</span><br><span class="line">            <span class="keyword">if</span>(temp==<span class="keyword">null</span>){</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></g.length;i++){<></span></pre></td></tr></tbody></table></figure></div><p>   ç”¨äº†ä¸€ä¸ªæ•°ç»„ä¿å­˜äº†æ¯ä¸ªä½ç½®çš„çŠ¶æ€é€Ÿåº¦è·Ÿå‰é¢çš„å·®ä¸å¤šã€‚ã€‚ã€‚ä¸»è¦é—®é¢˜å°±æ˜¯é‚£ä¸ªæ•°ç»„çš„åˆ›å»ºï¼Œè¿™ç§åˆ›å»ºæ–¹å¼ç”¨è¿ç»­çš„ä¸‹æ ‡æ¥å¯¹åº”è¿ç»­çš„é“¾è¡¨çš„æ¯ä¸ªå…ƒç´ ï¼Œæ¯æ¬¡éƒ½è¦éå†Gæ‰çŸ¥é“å½“å‰ä½ç½®æ˜¯ä¸æ˜¯åœ¨Gä¸­ã€‚</p><p>   å…¶å®å¯ä»¥ç›´æ¥æŠŠå½“å‰èŠ‚ç‚¹çš„valä½œä¸ºæ•°ç»„çš„ä¸‹æ ‡è¿™æ ·æ—¢æœ‰äº†å¯¹åº”å…³ç³»ä¹Ÿä¸ç”¨éå†G.å¯ä»¥è¯´æ˜¯å¾ˆä¼˜ç§€äº†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™æ ·åšæ˜¯æœ‰å‰ææ¡ä»¶çš„é‚£å°±æ˜¯é“¾è¡¨ä¸­çš„å…ƒç´ å€¼åº”è¯¥<code>æ²¡æœ‰è´Ÿæ•°</code>ï¼Œè¿˜æ˜¯é¢˜åšå°‘äº†å•Š Orzã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numComponents3</span><span class="params">(ListNode head, <span class="keyword">int</span>[] G)</span> </span>{</span><br><span class="line">    ListNode temp=head;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">    Boolean [] isInG=<span class="keyword">new</span> Boolean[<span class="number">10000</span>];</span><br><span class="line">    <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//æ¢ä¸€ç§æ–¹å¼ ä»¥node.valä½œä¸ºæ•°ç»„çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i:G){</span><br><span class="line">        isInG[i]=<span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">        <span class="keyword">if</span>(isInG[temp.val]){</span><br><span class="line">            <span class="keyword">while</span>(temp!=<span class="keyword">null</span>&&isInG[temp.val]){</span><br><span class="line">                temp=temp.next;</span><br><span class="line">            }</span><br><span class="line">            res++;</span><br><span class="line">            <span class="keyword">if</span>(temp==<span class="keyword">null</span>){</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        temp = temp.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><hr><h2 id="109-æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘"><a href="#109-æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘" class="headerlink" title="109. æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘"></a><strong>109. æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘</strong></h2><p>ç»™å®šä¸€ä¸ªå•é“¾è¡¨ï¼Œå…¶ä¸­çš„å…ƒç´ æŒ‰å‡åºæ’åºï¼Œå°†å…¶è½¬æ¢ä¸ºé«˜åº¦å¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ã€‚</p><p>æœ¬é¢˜ä¸­ï¼Œä¸€ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æ ‘æ˜¯æŒ‡ä¸€ä¸ªäºŒå‰æ ‘<em>æ¯ä¸ªèŠ‚ç‚¹</em> çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line">ç»™å®šçš„æœ‰åºé“¾è¡¨ï¼š [-10, -3, 0, 5, 9],</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªå¯èƒ½çš„ç­”æ¡ˆæ˜¯ï¼š[0, -3, 9, -10, null, 5], å®ƒå¯ä»¥è¡¨ç¤ºä¸‹é¢è¿™ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼š</span><br><span class="line"></span><br><span class="line">      0</span><br><span class="line">     / \</span><br><span class="line">   -3   9</span><br><span class="line">   /   /</span><br><span class="line"> -10  5</span><br></pre></td></tr></tbody></table></figure></div><p>BSTä¸å¤ªç†Ÿçœ‹äº†ä¸‹è¯„è®ºå†™å‡ºæ¥çš„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TreeNode <span class="title">sortedListToBST</span><span class="params">(ListNode head)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> build(head,<span class="keyword">null</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TreeNode <span class="title">build</span><span class="params">(ListNode head,ListNode tail)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(head==tail){</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹</span></span><br><span class="line">    ListNode fast=head,slow=head;</span><br><span class="line">    <span class="keyword">while</span>(fast!=tail&&fast.next!=tail){</span><br><span class="line">        <span class="comment">//å·¦é—­å³å¼€</span></span><br><span class="line">        fast=fast.next.next;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//slowä¸ºä¸­ç‚¹æˆ–ä¸­ç‚¹åä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">//1 2 3 4</span></span><br><span class="line">    TreeNode root=<span class="keyword">new</span> TreeNode(slow.val);</span><br><span class="line">    root.left=build(head,slow);</span><br><span class="line">    root.right=build(slow.next,tail);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><hr><h2 id="1019-é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹"><a href="#1019-é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹" class="headerlink" title="1019. é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/next-greater-node-in-linked-list/" target="_blank" rel="noopener">1019. é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹</a></h2><p>ç»™å‡ºä¸€ä¸ªä»¥å¤´èŠ‚ç‚¹ <code>head</code> ä½œä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾è¡¨ã€‚é“¾è¡¨ä¸­çš„èŠ‚ç‚¹åˆ†åˆ«ç¼–å·ä¸ºï¼š<code>node_1, node_2, node_3, ...</code> ã€‚</p><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§å€¼ï¼ˆ<em>next larger</em> <strong>value</strong>ï¼‰ï¼šå¯¹äº <code>node_i</code>ï¼Œå¦‚æœå…¶ <code>next_larger(node_i)</code> æ˜¯ <code>node_j.val</code>ï¼Œé‚£ä¹ˆå°±æœ‰ <code>j > i</code> ä¸”  <code>node_j.val > node_i.val</code>ï¼Œè€Œ <code>j</code> æ˜¯å¯èƒ½çš„é€‰é¡¹ä¸­æœ€å°çš„é‚£ä¸ªã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„ <code>j</code>ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ›´å¤§å€¼ä¸º <code>0</code> ã€‚</p><p>è¿”å›æ•´æ•°ç­”æ¡ˆæ•°ç»„ <code>answer</code>ï¼Œå…¶ä¸­ <code>answer[i] = next_larger(node_{i+1})</code> ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯¸å¦‚ <code>[2,1,5]</code> è¿™æ ·çš„<strong>è¾“å…¥</strong>ï¼ˆä¸æ˜¯è¾“å‡ºï¼‰æ˜¯é“¾è¡¨çš„åºåˆ—åŒ–è¡¨ç¤ºï¼Œå…¶å¤´èŠ‚ç‚¹çš„å€¼ä¸º 2ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹å€¼ä¸º 1ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹å€¼ä¸º 5 ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="number">5</span>,<span class="number">5</span>,<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[<span class="number">2</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="number">7</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š[<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>]</span><br><span class="line">è¾“å‡ºï¼š[<span class="number">7</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure></div><p><strong>æç¤ºï¼š</strong></p><ol><li>å¯¹äºé“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œ<code>1 <= node.val <= 10^9</code></li><li>ç»™å®šåˆ—è¡¨çš„é•¿åº¦åœ¨ <code>[0, 10000]</code> èŒƒå›´å†…</li></ol><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] nextLargerNodes(ListNode head) {</span><br><span class="line">    <span class="comment">//listé‡Œé¢å­˜å…ƒç´ </span></span><br><span class="line">    ArrayList<integer> A = <span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (ListNode node = head; node != <span class="keyword">null</span>; node = node.next)</span><br><span class="line">                A.add(node.val);</span><br><span class="line">    <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[A.size()];</span><br><span class="line">    <span class="comment">//æ ˆé‡Œé¢å­˜ç´¢å¼•</span></span><br><span class="line">    Stack<integer> stack = <span class="keyword">new</span> Stack<>();</integer></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < A.size(); ++i) {</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty() && A.get(stack.peek()) < A.get(i))</span><br><span class="line">             res[stack.pop()] = A.get(i);</span><br><span class="line">        stack.push(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ–°é¢˜ï¼Œç£¨äº†å¥½é•¿æ—¶é—´ï¼Œæ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚çœŸæ˜¯èœå•Š Orzï¼Œ70msï¼Œå› ä¸ºè·‘ä¸¤éã€‚ä¸‹é¢è¿™ä¸ª<code>14ms</code>å¯ä»¥è¯´æ˜¯ç›¸å½“å¿«äº†ï¼Œä½†ï¼Œæ—¶é—´å¯èƒ½è€—è´¹åœ¨å»ºç«‹æ ˆå’Œlistä¸Šäº†ï¼Œçœ‹äº†ä¸‹æäº¤ä¸Šçš„å‰å‡ ä¸ªéƒ½æ˜¯ç”¨çš„æ•°ç»„ï¼Œç”¨æ•°ç»„æ¨¡æ‹Ÿçš„æ ˆã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å’Œä¸Šé¢çš„æ–¹æ³•å·®ä¸å¤š,ä½†è¿™ä¸ªæ›´å¿«ï¼Œä¸Šé¢é‚£ä¸ªè·‘äº†ä¸¤é</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] nextLargerNodes3(ListNode head) {</span><br><span class="line">    <span class="keyword">int</span>[] stack = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">    <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">    <span class="comment">//tempæ˜¯é“¾è¡¨çš„å‰¯æœ¬ï¼Œç›¸å½“äºä¸Šé¢çš„list</span></span><br><span class="line">    <span class="keyword">int</span>[] temp = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">    <span class="comment">//top æ ˆé¡¶</span></span><br><span class="line">    <span class="keyword">int</span> top = -<span class="number">1</span>, i = <span class="number">0</span>;</span><br><span class="line">    ListNode node = head;</span><br><span class="line">    <span class="keyword">while</span> (node != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">while</span> (top != -<span class="number">1</span> && temp[stack[top]] < node.val){</span><br><span class="line">            <span class="comment">//åä¸€ä¸ªå¤§äºå½“å‰èŠ‚ç‚¹, æ ˆä¸ä¸ºç©º</span></span><br><span class="line">            <span class="comment">//popå‡ºæ¯”å®ƒå°çš„å…ƒç´ å¹¶èµ‹å€¼resï¼Œé‡æ–°ç”Ÿæˆå•è°ƒæ ˆ</span></span><br><span class="line">            res[stack[top--]] = node.val;</span><br><span class="line">        }</span><br><span class="line">        stack[++top] = i;</span><br><span class="line">        temp[i++] = node.val;</span><br><span class="line">        node = node.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> Arrays.copyOf(res, i);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ€è·¯å°±æ˜¯åˆ©ç”¨<code>å•è°ƒæ ˆ</code>ï¼Œæ ˆé‡Œé¢å­˜çš„ç´¢å¼•å¯¹åº”çš„å…ƒç´ éƒ½æ˜¯å•è°ƒé€’å‡çš„ï¼Œé‡åˆ°ä¸é€’å‡çš„å°±ä¼šä¸€ç›´pop()ç›´åˆ°å†æ¬¡å•è°ƒé€’å‡ã€‚è¿™æ ·å¾ˆå®¹æ˜“å°±æ‰¾åˆ°äº†æ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæœ€å¤§å…ƒç´ äº†ã€‚</p><p>19.7.21 é‡æ–°åšäº†ä¸€éè¿™é“é¢˜ï¼Œç¬¬ä¸€éè¿˜æ˜¯æ²¡æƒ³å‡ºæ¥ï¼Œè¿˜æ˜¯çœ‹äº†ä¹‹å‰çš„ä»£ç </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] nextLargerNodes5(ListNode head) {</span><br><span class="line">        List<integer> list=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">        ListNode temp=head;</span><br><span class="line">        <span class="keyword">while</span>(temp!=<span class="keyword">null</span>){</span><br><span class="line">            list.add(temp.val);</span><br><span class="line">            temp=temp.next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> [] stack=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">        <span class="keyword">int</span> stackIndex=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> [] res=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<list.size();i++) {< span><br><span class="line">            <span class="keyword">while</span>(stackIndex!=-<span class="number">1</span> && list.get(i)>list.get(stack[stackIndex])){</span><br><span class="line">                res[stack[stackIndex--]]=list.get(i);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//ç»´æŠ¤ä¸€ä¸ªé€’å‡çš„æ ˆ</span></span><br><span class="line">            stack[++stackIndex]=i;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span>  Arrays.copyOf(res, list.size());</span><br><span class="line">}</span><br></list.size();i++)></span></pre></td></tr></tbody></table></figure></div><p>ç›¸æ¯”ä¸Šé¢çš„æ–¹æ³•ä¸€ï¼Œé‡‡ç”¨äº†æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—(æ•°æ®èŒƒå›´å·²ç»ç»™å®šäº†)ï¼Œ30msï¼Œ80% ã€‚ä»”ç»†çœ‹çœ‹ä»£ç å‘ç°å…¶å®ç¬¬ä¸€ä¸ªå¾ªç¯å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œå¯ä»¥ä¸€è¾¹éå†ä¸€è¾¹å­˜è¿›å»ã€‚</p><p><strong>ä¸€æ¬¡éå†</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] nextLargerNodes6(ListNode head) {</span><br><span class="line">    List<integer> list=<span class="keyword">new</span> ArrayList<>();</integer></span><br><span class="line">    ListNode temp=head;</span><br><span class="line">    <span class="keyword">int</span> [] stack=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">    <span class="keyword">int</span> stackIndex=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> [] res=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;temp!=<span class="keyword">null</span>;i++) {</span><br><span class="line">        list.add(temp.val);</span><br><span class="line">        <span class="keyword">while</span>(stackIndex!=-<span class="number">1</span> && list.get(i)>list.get(stack[stackIndex])){</span><br><span class="line">            res[stack[stackIndex--]]=list.get(i);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ç»´æŠ¤ä¸€ä¸ªé€’å‡çš„æ ˆ</span></span><br><span class="line">        stack[++stackIndex]=i;</span><br><span class="line">        temp=temp.next;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span>  Arrays.copyOf(res, list.size());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¼˜åŒ–åå‘ç°æ¯”ä¹‹å‰è¿˜æ…¢äº†ã€‚ã€‚ã€‚</p><p><strong>æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] nextLargerNodes7(ListNode head) {</span><br><span class="line">       <span class="keyword">int</span> [] list=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">       ListNode temp=head;</span><br><span class="line">       <span class="keyword">int</span> [] stack=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">       <span class="keyword">int</span> stackIndex=-<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">int</span> [] res=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line"></span><br><span class="line">       <span class="keyword">int</span> i;</span><br><span class="line">       <span class="keyword">for</span> ( i=<span class="number">0</span>;temp!=<span class="keyword">null</span>;i++) {</span><br><span class="line">           list[i]=temp.val;</span><br><span class="line">           <span class="keyword">while</span>(stackIndex!=-<span class="number">1</span> && list[i]>list[stack[stackIndex]]){</span><br><span class="line">               res[stack[stackIndex--]]=list[i];</span><br><span class="line">           }</span><br><span class="line">           <span class="comment">//ç»´æŠ¤ä¸€ä¸ªé€’å‡çš„æ ˆ</span></span><br><span class="line">           stack[++stackIndex]=i;</span><br><span class="line">           temp=temp.next;</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span>  Arrays.copyOf(res, i);</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ¬¡æäº¤äº†å‡ æ¬¡ç›´æ¥ 8ms 100%äº†ã€‚ã€‚ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§çš„æ’åºç®—æ³•æ€»ç»“</title>
      <link href="/2018/12/11/chang-jian-pai-xu-suan-fa-zong-jie/"/>
      <url>/2018/12/11/chang-jian-pai-xu-suan-fa-zong-jie/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="å¸¸è§æ’åºç®—æ³•æ€»ç»“"><a href="#å¸¸è§æ’åºç®—æ³•æ€»ç»“" class="headerlink" title="å¸¸è§æ’åºç®—æ³•æ€»ç»“"></a>å¸¸è§æ’åºç®—æ³•æ€»ç»“</h2><p>å…³äºæ’åºçš„éƒ¨åˆ†ä¸€ç›´æƒ³æ€»ç»“ä¸‹ä¸€ç›´æ²¡æ—¶é—´ï¼Œç°åœ¨æ¥æ€»ç»“ä¸‹å§ã€‚gifå›¾æ¥è‡ªå¾®ä¿¡ä¸Šçš„æ–‡ç«  (<strong>äº”åˆ†é’Ÿå­¦ç®—æ³•</strong>çš„å…¬ä¼—å·ï¼ŒæŒºä¸é”™å¹²è´§æŒºå¤šçš„)ï¼ŒåŸç†æ€§çš„ä¸œè¥¿å°±ä¸è®²äº†ï¼Œå›¾è®²çš„æ¯”æˆ‘å¥½ã€‚å¦‚æœè¿˜æ˜¯ä¸æ‡‚å¯ä»¥çœ‹çœ‹ã€Šç®—æ³•ã€‹é‡Œé¢çš„è½¨è¿¹å›¾ï¼Œé‚£ä¸ªä¹Ÿå¾ˆç›´è§‚ </p><h3 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h3><p>  <img alt="weixin" data-src="http://static.imlgw.top/f02ace7b7fb9b810274e683c2be54a02_640_wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1.gif" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å†’æ³¡æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MaoPaoSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=nums.length-<span class="number">1</span>;i>=<span class="number">0</span>;i--){</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<i;j++){< span><br><span class="line">            <span class="keyword">if</span>(nums[j]>nums[j+<span class="number">1</span>]){</span><br><span class="line">                swap(nums,j,j+<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></i;j++){<></span></pre></td></tr></tbody></table></figure></div><h3 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h3><p><img alt="weixin" data-src="http://static.imlgw.top/640.gif" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//é€‰æ‹©æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SelectSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++){< span><br><span class="line">        <span class="keyword">int</span> min=nums[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j<nums.length;j++){< span><br><span class="line">            <span class="keyword">if</span>(nums[j]<min){< span><br><span class="line">                min=nums[j];</span><br><span class="line">                swap(nums,j,i);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></min){<></span></nums.length;j++){<></span></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><h3 id="ç›´æ¥æ’å…¥æ’åº"><a href="#ç›´æ¥æ’å…¥æ’åº" class="headerlink" title="ç›´æ¥æ’å…¥æ’åº"></a>ç›´æ¥æ’å…¥æ’åº</h3><p><img alt="weixin" data-src="http://static.imlgw.top/640%20%281%29.gif" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//ç›´æ¥æ’å…¥æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InsertSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++){< span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i;j><span class="number">0</span>&&nums[j]<nums[j-<span class="number">1</nums[j-<span></span>];j--){</nums.length;i++){<></span><br><span class="line">            swap(nums,j,j-<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h3><p><img alt="weixin" data-src="http://static.imlgw.top/640%20%282%29.gif" src="/img/loading.gif" class="lazyload"></p><h4 id="å›¾ä¸Šé¢çš„æ˜¯é€’å½’ç‰ˆæœ¬çš„å½’å¹¶ï¼Œå®ç°å¦‚ä¸‹"><a href="#å›¾ä¸Šé¢çš„æ˜¯é€’å½’ç‰ˆæœ¬çš„å½’å¹¶ï¼Œå®ç°å¦‚ä¸‹" class="headerlink" title="å›¾ä¸Šé¢çš„æ˜¯é€’å½’ç‰ˆæœ¬çš„å½’å¹¶ï¼Œå®ç°å¦‚ä¸‹"></a>å›¾ä¸Šé¢çš„æ˜¯é€’å½’ç‰ˆæœ¬çš„å½’å¹¶ï¼Œå®ç°å¦‚ä¸‹</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å½’å¹¶æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MergerSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">    help=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    MergerSort(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MergerSort</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(left>=right){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//ä¸èƒ½ç›´æ¥åœ¨è¿™é‡Œåˆ›å»ºæ•°ç»„ï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¯ä»¥åœ¨ä¸Šé¢å†å¥—ä¸€å±‚æ–¹æ³•ï¼Œæˆ–è€…é‡‡ç”¨merger2çš„æ–¹å¼(ä¹Ÿä¸å¥½ï¼Œåº”è¯¥ä¿è¯è¾…åŠ©æ•°ç»„åªåˆå§‹åŒ–ä¸€æ¬¡)</span></span><br><span class="line">    <span class="comment">//help=new int[nums.length];</span></span><br><span class="line">    <span class="keyword">int</span> mid=left+((right-left)>><span class="number">1</span>);</span><br><span class="line">    MergerSort(nums,left,mid);</span><br><span class="line">    MergerSort(nums,mid+<span class="number">1</span>,right);</span><br><span class="line">    merger(nums,left,mid,right);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾…åŠ©æ•°ç»„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> []help;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½’å¹¶æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merger</span><span class="params">(<span class="keyword">int</span> []nums ,<span class="keyword">int</span> left,<span class="keyword">int</span> mid,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> i=left,j=mid+<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//å…¶å®æ²¡åŒºåˆ«ç©ºé—´å¤æ‚åº¦ï¼Œéƒ½æ˜¯O(N) åé¢è¿™ä¸ªä¼šæ›´åŠ è€—è´¹æ—¶é—´</span></span><br><span class="line">    <span class="comment">//int []help=new int[right-left+1];</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=left;k<=right;k++){</span><br><span class="line">        <span class="comment">//ä¸€è¾¹çš„åˆ°è¾¾å°½å¤´,å…ˆåˆ¤æ–­ä¸¤ä¸ªè¾¹ç•Œ,ä¸ç„¶å°±è¦æƒ³ä¸‹é¢é‚£æ ·å†™</span></span><br><span class="line">        <span class="keyword">if</span>(i>mid){</span><br><span class="line">            help[k]=nums[j++];</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(j>right){</span><br><span class="line">            help[k]=nums[i++];</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(nums[i]>nums[j]){</span><br><span class="line">            help[k]=nums[j++];</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§</span></span><br><span class="line">            help[k]=nums[i++];</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/*// 2 </span></span><br><span class="line"><span class="comment">            if( i<=mid &&j<=right && nums[i]>nums[j]){</span></span><br><span class="line"><span class="comment">                help[k]=nums[j++];</span></span><br><span class="line"><span class="comment">            }else if( i<=mid &&j<=right && nums[i]<=nums[j]){</span></span><br><span class="line"><span class="comment">                //ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§</span></span><br><span class="line"><span class="comment">                help[k]=nums[i++];</span></span><br><span class="line"><span class="comment">            }else if(i>mid){</span></span><br><span class="line"><span class="comment">                help[k]=nums[j++];</span></span><br><span class="line"><span class="comment">            }else if(j>right){ </span></span><br><span class="line"><span class="comment">                help[k]=nums[i++];</span></span><br><span class="line"><span class="comment">            }*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å¤åˆ¶</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=left;k<=right;k++){</span><br><span class="line">        nums[k]=help[k];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*while (p1 <= m && p2 <= r) {</span></span><br><span class="line"><span class="comment">            help[i++] = arr[p1] < arr[p2] ? arr[p1++] : arr[p2++];</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">        while (p1 <= m) {</span></span><br><span class="line"><span class="comment">            help[i++] = arr[p1++];</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">        while (p2 <= r) {</span></span><br><span class="line"><span class="comment">            help[i++] = arr[p2++];</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">        for (i = 0; i < help.length; i++) {</span></span><br><span class="line"><span class="comment">            arr[l + i] = help[i];</span></span><br><span class="line"><span class="comment">        }*/</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="éé€’å½’ç‰ˆæœ¬"><a href="#éé€’å½’ç‰ˆæœ¬" class="headerlink" title="éé€’å½’ç‰ˆæœ¬"></a>éé€’å½’ç‰ˆæœ¬</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å½’å¹¶æ’åºï¼ˆéé€’å½’ï¼Œæ–¹å‘ä¸ä¸€æ ·ï¼Œæ—¶é—´å¤æ‚åº¦ä¸€æ ·éƒ½ä¸ºO(NlogN)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MergerSortNoRecurse</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">    help=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">    <span class="comment">//æ§åˆ¶åˆå¹¶çš„é•¿åº¦ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> sz=<span class="number">1</span>;sz<nums.length;sz*=<span class="number">2</nums.length;sz*=<span></span>){<br><span class="line">        <span class="comment">//æ§åˆ¶åˆå¹¶çš„å‘åç§»åŠ¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length-sz;i+=<span class="number">2</nums.length-sz;i+=<span></span>*sz){<br><span class="line">            <span class="keyword">int</span> r=i+<span class="number">2</span>*sz-<span class="number">1</span><nums.length-<span class="number">1</nums.length-<span></span>?i+<span class="number">2</span>*sz-<span class="number">1</span>:nums.length-<span class="number">1</span>;<br><span class="line">            merger(nums,i,i+sz-<span class="number">1</span>,r);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="ä¸‰å‘åˆ‡åˆ†çš„å¿«æ’-è·å…°å›½æ——é—®é¢˜"><a href="#ä¸‰å‘åˆ‡åˆ†çš„å¿«æ’-è·å…°å›½æ——é—®é¢˜" class="headerlink" title="ä¸‰å‘åˆ‡åˆ†çš„å¿«æ’(è·å…°å›½æ——é—®é¢˜)"></a>ä¸‰å‘åˆ‡åˆ†çš„å¿«æ’(è·å…°å›½æ——é—®é¢˜)</h3><p><img alt="weixin" data-src="http://static.imlgw.top/640%20%283%29.gif" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å¿«æ’ (ä¸å…·æœ‰ç¨³å®šæ€§æˆ–è€…éš¾ä»¥å®ç°)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">QuickSort</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l>r){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//éšæœºä¸€ä¸ªæ•°å’Œräº¤æ¢ ---éšæœºå¿«æ’</span></span><br><span class="line">    swap(nums, l + (<span class="keyword">int</span>) (Math.random() * (r - l + <span class="number">1</span>)), r);</span><br><span class="line">    <span class="keyword">int</span> []index=partition2(nums,l,r);</span><br><span class="line">    QuickSort(nums,l,index[<span class="number">0</span>]-<span class="number">1</span>);</span><br><span class="line">    QuickSort(nums,index[<span class="number">1</span>]+<span class="number">1</span>,r);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition1</span><span class="params">(<span class="keyword">int</span> []nums ,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> base = l;</span><br><span class="line">    <span class="comment">//åŒæŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">int</span> lo = l, hi = r;</span><br><span class="line">    <span class="comment">//è¿™ç§partitionçš„å®ç°ç»†èŠ‚æœ‰ç‚¹ä¸å¥½ç†è§£</span></span><br><span class="line">    <span class="comment">//è¿™ç§partitionä¸èƒ½éšæœºåŸºå‡†å…ƒç´ ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="comment">//å‚ç…§äº†å·¦ç¥çš„ä»£ç å‘ç°å…¶å®å¯ä»¥åœ¨partitionä¹‹å‰éšæœºä¸€ä¸ªå˜é‡å’Œloäº¤æ¢ï¼Œä¹Ÿæœ‰åŒæ ·çš„æ•ˆæœä¹Ÿæ¶ˆé™¤äº†è¾“å…¥çš„å½±å“</span></span><br><span class="line">    <span class="keyword">while</span> (lo < hi) {</span><br><span class="line">        <span class="comment">//å¿…é¡»å…ˆä»å³å¾€å·¦,ä¸»è¦æ˜¯ä¸ºäº†å½’ä½çš„æ—¶å€™ä¸å‡ºç°é—®é¢˜</span></span><br><span class="line">        <span class="comment">//æ¯”å¦‚è¿™é‡Œé€‰å–çš„åŸºå‡†å…ƒç´ æ˜¯ lo ä¹Ÿå°±æ˜¯å­æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœå…ˆä»å·¦å¾€å³æœ€åäº¤æ¢çš„å°±æ˜¯loå’Œä¸€ä¸ªæ¯”loå¤§çš„æ•°ç„¶è€Œæ¯”loå¤§çš„æ•°åº”è¯¥æ”¾åœ¨å³è¾¹</span></span><br><span class="line">        <span class="comment">//åä¹‹å¦‚æœé€‰çš„æ˜¯hiä¸ºåŸºå‡†å°±è¦å…ˆä»å·¦å¾€å³</span></span><br><span class="line">        <span class="comment">// 7  0  1  2    10  11  22</span></span><br><span class="line">        <span class="keyword">while</span> (nums[hi] >= nums[base] && lo < hi) {</span><br><span class="line">            hi--;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (nums[lo] <= nums[base] && lo < hi) {</span><br><span class="line">            lo++;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (lo < hi) {</span><br><span class="line">            swap(nums, lo, hi);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å½’ä½ lo==hi</span></span><br><span class="line">    swap(nums, hi, base);</span><br><span class="line">    <span class="keyword">return</span> lo;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å…°å›½æ——ä¼˜åŒ–çš„å¿«æ’</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] partition2(<span class="keyword">int</span> []arr ,<span class="keyword">int</span> l,<span class="keyword">int</span> r){</span><br><span class="line">    <span class="comment">// 7  0  1  2    10  11  22        </span></span><br><span class="line">    <span class="comment">//å°äºåŒºä¸ºç©º</span></span><br><span class="line">    <span class="keyword">int</span> less=l-<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//l ----> more ä¸ºå¾…å®šåŒº</span></span><br><span class="line">    <span class="keyword">int</span> more=r;</span><br><span class="line">    <span class="keyword">while</span>(l<more){< span><br><span class="line">        <span class="keyword">if</span>(arr[l]<arr[r]){< span><br><span class="line">            swap(arr,++less,l++);</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(arr[l]>arr[r]){</span><br><span class="line">            <span class="comment">//å¤§äºåŸºå‡†æ—¶ , å¤§äºåŒºæ‰©å¤§(å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ å’Œå½“å‰å…ƒç´ äº¤æ¢ï¼Œä½†æ˜¯ä¸çŸ¥é“å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œæ‰€ä»¥ä¸èƒ½l++)</span></span><br><span class="line">            swap(arr,--more,l);</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            l++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å’Œå¤§äºåŒºé—´çš„ç¬¬ä¸€ä¸ªäº¤æ¢ ä¿è¯å½’ä½æ­£ç¡®,å¦‚æœé€‰å–çš„æ˜¯ä»¥æœ€å·¦è¾¹ä¸ºåŸºå‡†å…ƒç´  è¿™é‡Œå°±åº”è¯¥å’Œlessäº¤æ¢</span></span><br><span class="line">    <span class="comment">//åˆ°è¿™é‡Œ  [less+1,more-1]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„</span></span><br><span class="line">    swap(arr,more,r);</span><br><span class="line">    <span class="comment">//åˆ°è¿™  [less+1,more]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{less+<span class="number">1</span>,more};</span><br><span class="line">}</span><br></arr[r]){<></span></more){<></span></pre></td></tr></tbody></table></figure></div><h3 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h3><p><img alt="weixin" data-src="http://static.imlgw.top/640%20%284%29.gif" src="/img/loading.gif" class="lazyload"></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å †æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">HeapSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(nums.length<<span class="number">2</span>){</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//æ„å»ºå¤§æ ¹å †</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i<nums.length; i++) {< span><br><span class="line">        heapInsert(nums,i);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//äº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">int</span> size= nums.length;</span><br><span class="line">    swap(nums,size-<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    size--;</span><br><span class="line">    <span class="keyword">while</span>(size><span class="number">1</span>){</span><br><span class="line">        <span class="comment">//è°ƒæ•´</span></span><br><span class="line">        heapIfy(nums,<span class="number">0</span>,size);</span><br><span class="line">        <span class="comment">//æ¯æ¬¡éƒ½å’Œæœ€åä¸€ä¸ªå­©å­èŠ‚ç‚¹äº¤æ¢ï¼Œç„¶åsize--</span></span><br><span class="line">        swap(nums,--size,<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘ä¸Šçˆ¬</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapInsert</span><span class="params">(<span class="keyword">int</span> []nums, <span class="keyword">int</span> index)</span></span>{</span><br><span class="line">    <span class="comment">//è¿­ä»£æ¯”è¾ƒå½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å€¼çš„å¤§å°</span></span><br><span class="line">    <span class="keyword">while</span>(nums[index]>nums[(index-<span class="number">1</span>)/<span class="number">2</span>]){</span><br><span class="line">        swap(nums,index,(index-<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">        index=(index-<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘ä¸‹çˆ¬</span></span><br><span class="line"><span class="comment">//indexä½ç½®çš„å€¼å˜å°åç»§ç»­è°ƒæ•´ä¸ºå¤§æ ¹å †</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapIfy</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> index,<span class="keyword">int</span> size)</span></span>{</span><br><span class="line">    <span class="comment">//å·¦å­©å­</span></span><br><span class="line">    <span class="keyword">int</span> left=index*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹æœ‰å·¦å­©å­</span></span><br><span class="line">    <span class="keyword">while</span>(left<size){< span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰å³å­©å­.....</span></span><br><span class="line">        <span class="comment">//å·¦å³å­©å­é‡Œçš„æœ€å¤§å€¼ æœ‰å³å­©å­ä¸”å³å­©å­å¤§äºå·¦å­©å­</span></span><br><span class="line">        <span class="keyword">int</span> largest=left+<span class="number">1</span><size && nums[left]<nums[left+<span class="number">1</size></span>] ?left+<span class="number">1</span>:left;</size){<></span><br><span class="line">        largest=nums[largest]>nums[index]?largest:index;</span><br><span class="line">        <span class="comment">//æœ€å¤§å€¼ç­‰äºè‡ªå·±</span></span><br><span class="line">        <span class="keyword">if</span>(largest==index){</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//äº¤æ¢å¤§å­©å­èŠ‚ç‚¹å’Œè‡ªå·±</span></span><br><span class="line">        swap(nums,largest,index);</span><br><span class="line">        <span class="comment">//è®¾ç½®å¤§å­©å­çš„indexå’Œå·¦å­©å­</span></span><br><span class="line">        index=largest;</span><br><span class="line">        left=index*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;></span></pre></td></tr></tbody></table></figure></div><h3 id="å †æ’åºæ›´ä¼˜çš„åšæ³•"><a href="#å †æ’åºæ›´ä¼˜çš„åšæ³•" class="headerlink" title="å †æ’åºæ›´ä¼˜çš„åšæ³•"></a>å †æ’åºæ›´ä¼˜çš„åšæ³•</h3><p>ä¸Šé¢çš„åšæ³•å¹¶ä¸æ˜¯æœ€ä¼˜çš„å †æ’åº</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> last=nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//Næ„å»ºå¤§æ ¹å †</span></span><br><span class="line">    <span class="comment">//ä»å€’æ•°ç¬¬äºŒå±‚å¼€å§‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=nums.length/<span class="number">2</span>-<span class="number">1</span> ;i>=<span class="number">0</span>;i--){</span><br><span class="line">        heapIfy(nums,i,last);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//printArray(nums);</span></span><br><span class="line">    <span class="keyword">while</span>(last>=<span class="number">1</span>){</span><br><span class="line">        swap(nums,<span class="number">0</span>,last--);</span><br><span class="line">        heapIfy(nums,<span class="number">0</span>,last);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//i å¤§æ ¹å †è°ƒæ•´</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapIfy</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> i,<span class="keyword">int</span> last)</span></span>{</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆå·¦å­©å­ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> left=i*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(left<=last){</span><br><span class="line">        <span class="keyword">int</span> right=left+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å·¦å³èŠ‚ç‚¹æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">int</span> larger=right<=last && nums[right] > nums[left]?right:left;</span><br><span class="line">        <span class="keyword">if</span>(nums[larger]>nums[i]){</span><br><span class="line">            swap(nums,larger,i);</span><br><span class="line">            i=larger;</span><br><span class="line">            left=larger*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        } <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> temp=nums[a];</span><br><span class="line">    nums[a]=nums[b];</span><br><span class="line">    nums[b]=temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å¯¹æ¯”ä¹‹å‰çš„æ–¹æ³•ï¼Œæ„é€ å †çš„æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸Šé¢é‚£ç§é€šè¿‡è‡ªä¸Šè€Œä¸‹çš„<code>insert</code>æ–¹å¼æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(NlogN)</code>ï¼Œå…¶å®ä»”ç»†æƒ³æƒ³ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯å®Œå…¨ç›¸åçš„ï¼Œinsertçš„æ–¹å¼ï¼Œæœ€åä¸€å±‚æ¯ä¸ªå…ƒç´ æœ€åéƒ½å¯èƒ½è°ƒæ•´<code>logN</code>æ¬¡ï¼Œè€Œæœ€åä¸€å±‚ä¹Ÿæ˜¯å…ƒç´ æœ€å¤šçš„ä¸€å±‚ï¼Œè¿™æ ·ä¸€æ¥å¤æ‚åº¦å°±ä¼šå¤§å¤§å¢åŠ ï¼Œç›¸åå¦‚æœé‡‡ç”¨ä»åº•å‘ä¸Šçš„<code>heapIfy</code>æ–¹å¼æœ€åä¸€å±‚éƒ½åªéœ€è¦è°ƒæ•´<code>1</code>æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹éœ€è¦è°ƒæ•´<code>logN</code>æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹<strong>åªæœ‰ä¸€ä¸ª</strong>æ—¶é—´å¤æ‚åº¦å°±ä¼šå¤§å¤§é™ä½ï¼Œæœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(N)ï¼Œ<a href="https://www.zhihu.com/question/20729324" target="_blank" rel="noopener">å…·ä½“æ¨ç®—è¿‡ç¨‹å¯ä»¥çœ‹è¿™äº›å›ç­”</a> </p><p><strong>æ‰‹æ¨è¿‡ç¨‹</strong></p><p><img alt="img" data-src="http://static.imlgw.top/image/20190617/kVuvnMfjuSns.png?imageslim" src="/img/loading.gif" class="lazyload"></p><p>æœ€åæ¨å¾—åˆ°å¾—å¤æ‚åº¦æ˜¯å°äº<code>O(2N)</code>ï¼Œä¹Ÿå°±æ˜¯<code>O(N)</code>çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¦‚æœä¸æ˜¯åˆ·<code>leetCode</code> çœ‹åˆ°äº†ç±»ä¼¼çš„é¢˜å¯èƒ½ä¼šä¸€ç›´è¢«é‚£æ ·å»å†™ğŸ˜‚</p><h3 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h3><p>å®é™…ä¸Šå†™æ’åºå°±æ˜¯åŸºäºæ’å…¥æ’åºçš„ï¼Œåœ¨å®ƒä¹‹ä¸Šè¿›è¡Œäº†æ•°å­¦ä¸Šçš„ä¼˜åŒ–ã€‚</p><p><img alt="image" data-src="http://static.imlgw.top/640%20%285%29.gif" src="/img/loading.gif" class="lazyload"><br>    å®é™…ä¸Šä»é€†åºå¯¹çš„è§’åº¦æ¥çœ‹ï¼ŒåŸºäºæ¯”è¾ƒçš„æ’åºå°±æ˜¯ä¸ºäº†æ¶ˆé™¤é€†åºå¯¹çš„ä¸ªæ•°ï¼Œè€Œè¯¸å¦‚å†’æ³¡é€‰æ‹©æ¯æ¬¡éƒ½åªæ˜¯äº¤æ¢ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼Œæ¯æ¬¡äº¤æ¢æœ€å¤šåªå‡å°‘ä¸€ä¸ªé€†åºå¯¹ï¼Œè€Œå¸Œå°”æ’åºæ‰©å¤§äº†è¿™ä¸ªé—´è·ï¼Œå°±å¢å¤§äº†å‡å°‘é€†åºå¯¹çš„å¯èƒ½ã€‚ä¸è¿‡è¦ç ”ç©¶ä»–çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯æ•°å­¦ä¸Šçš„ç ”ç©¶çš„é—®é¢˜äº†ï¼Œè‡³äºæ¯æ¬¡é—´è·éƒ½å‡åŠè¿™ä¸ªä¹Ÿæ˜¯æ ¹æ®å¤§æ ·æœ¬æµ‹è¯•ä¸‹è¿™ç§é€’å¢åºåˆ—æ€§èƒ½ä¼šæ›´å¥½ O(âˆ©_âˆ©)O</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ’å…¥æ’åºçš„æ”¹è¿›</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShellSort</span><span class="params">(<span class="keyword">int</span> [] nums)</span></span>{</span><br><span class="line">    <span class="keyword">int</span> h=nums.length>><span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(h><span class="number">0</span>){</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=h;i<nums.length;i++){< span><br><span class="line">            <span class="comment">//å®é™…ä¸Šæ˜¯å¢å¤§äº†æ’å…¥æ’åºçš„é—´éš™ï¼Œæœ€åè¿˜æ˜¯å¯¹è¿›è¡Œä¸€æ¬¡æ’å…¥æ’åº,ä¸è¿‡é‚£ä¸ªæ—¶å€™çš„æ•°æ®å·²ç»æ˜¯é«˜åº¦æœ‰åºäº†</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i;j-h>=<span class="number">0</span>&&nums[j]<nums[j-h];j-=h) {< span><br><span class="line">                swap(nums,j,j-h);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        h=h>><span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums[j-h];j-=h)></span></nums.length;i++){<></span></pre></td></tr></tbody></table></figure></div><hr><h3 id="BUG"><a href="#BUG" class="headerlink" title="BUG"></a>BUG</h3><p>æ’ä¸ªåºè¿˜èƒ½æ’å‡ºBugï¼Ÿå¯¹çš„æ²¡é”™å°±æ˜¯æ’å‡ºäº†BugğŸ¤£ çœ‹çœ‹æˆ‘æœ€å¼€å§‹å†™çš„äº¤æ¢å‡½æ•°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">    nums[a]=nums[a]^nums[b];</span><br><span class="line">    nums[b]=nums[a]^nums[b];</span><br><span class="line">    nums[a]=nums[a]^nums[b];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸ºäº†æŠ–è¿™ä¸ªæœºçµä»˜å‡ºäº†æƒ¨ç—›çš„ä»£ä»·ï¼Œä¹‹å‰ç”¨ >> æ‹¿æ¥å½“é™¤2æ“ä½œçš„æ—¶å€™å°±å¿½ç•¥äº†<code>ä¼˜å…ˆçº§</code>çš„é—®é¢˜ã€‚ã€‚ã€‚é‚£è¿™é‡Œçš„æœºçµæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿä¸€ä¸ªæ•°å¼‚æˆ–åŒä¸€ä¸ªæ•°ä¸¤æ¬¡å°±è¿˜åŸæ²¡æ¯›ç—…å•Šï¼ŸButå¦‚æœäº¤æ¢çš„ä¸¤ä¸ªæ•°æ˜¯åŒä¸€ä¸ªå…ƒç´ æ¯”å¦‚ä¸Šé¢åœ¨æ•°ç»„ä¸­ a==bæ—¶ nums[a]å¼‚æˆ–äº†3æ¬¡è‡ªå·±ç›¸å½“äº<code>nums[a]^nums[a]^nums[a]^nums[a]=0^0=0</code>ï¼Œæœ€åå°±ä¼šå‡ºé—®é¢˜,å…¶å®å¼€å§‹å‰é¢çš„æ’åºéƒ½æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œä¸»è¦æ˜¯åé¢çš„å¿«æ’æ—¶å‘ç°äº†è¿™ä¸ªBugå› ä¸ºå¿«æ’ä¸ºäº†é¿å…æ•°æ®åˆ†å¸ƒçš„å½±å“éšæœºé€‰å–åŸºå‡†å€¼ï¼Œå¯èƒ½éšæœºçš„æ˜¯æœ€åä¸€ä¸ªï¼Œè€Œä¸”å¿«æ’çš„partitionè¿‡ç¨‹ä¸­ä¹Ÿä¼šæœ‰æ—¶ä¹Ÿä¼šè‡ªå·±å’Œè‡ªå·±äº¤æ¢ï¼Œæœ€å¼€å§‹çš„ç¬¬ä¸€æ­¥å°±æ˜¯è‡ªå·±å’Œç›´æ¥äº¤æ¢ï¼Œè®©å°äºåŒºæ‰©å¤§ã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä»…ä»…åªèƒ½ç”¨æ¥æŠ–ä¸€æŠ–æœºçµï¼Œæ²¡å•¥å®é™…æ„ä¹‰ï¼Œä»¥åè¿˜æ˜¯è¦è€è€å®å®å†™ï¼Œä¸ç„¶å’‹æ­»çš„éƒ½ä¸çŸ¥é“ğŸ˜</p><blockquote><p> æœªå®Œå¾…ç»­â€¦â€¦è¿˜æœ‰ä¸€ç±»éåŸºäºæ¯”è¾ƒçš„æ’åº æ¡¶æ’åºä¹‹ç±»çš„ç­‰åé¢å†æ¥æ€»ç»“åŠ ä¸Šå».</p></blockquote><h3 id="å¯¹æ•°å™¨"><a href="#å¯¹æ•°å™¨" class="headerlink" title="å¯¹æ•°å™¨"></a>å¯¹æ•°å™¨</h3><p>ç›´æ¥æ‹¿çš„å·¦ç¥çš„å¯¹æ•°å™¨ğŸ˜„ï¼Œæ‰€æœ‰æ’åºéƒ½æ˜¯ç»è¿‡å¯¹æ•°å™¨æµ‹è¯•çš„ã€‚ <em>talk is cheap show me the code</em></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorts</span></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">/*int []nums={1,0,-1,-22,213,4,535,-112,99999};</span></span><br><span class="line"><span class="comment">        //ShellSort(nums);</span></span><br><span class="line"><span class="comment">        //MaoPaoSort(nums);</span></span><br><span class="line"><span class="comment">        //SelectSort(nums);</span></span><br><span class="line"><span class="comment">        //MergerSort(nums,0,nums.length-1);</span></span><br><span class="line"><span class="comment">        QuickSort(nums,0,nums.length-1);</span></span><br><span class="line"><span class="comment">        printArray(nums);*/</span></span><br><span class="line">        <span class="keyword">int</span> testTime = <span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">int</span> maxSize = <span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">int</span> maxValue = <span class="number">100</span>;</span><br><span class="line">        Boolean succeed = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < testTime; i++) {</span><br><span class="line">            <span class="keyword">int</span>[] arr1 = generateRandomArray(maxSize, maxValue);</span><br><span class="line">            <span class="keyword">int</span>[] arr2 = copyArray(arr1);</span><br><span class="line">            <span class="keyword">long</span> time=System.currentTimeMillis();</span><br><span class="line">            <span class="comment">//å†’æ³¡</span></span><br><span class="line">            <span class="comment">//MaoPaoSort(arr1);</span></span><br><span class="line">            <span class="comment">//é€‰æ‹©</span></span><br><span class="line">            <span class="comment">//SelectSort(arr1);</span></span><br><span class="line">            <span class="comment">//æ’å…¥</span></span><br><span class="line">            <span class="comment">//InsertSort(arr1);</span></span><br><span class="line">            <span class="comment">//å½’å¹¶</span></span><br><span class="line">            <span class="comment">//MergerSort(arr1);</span></span><br><span class="line">            <span class="comment">//éé€’å½’å½’å¹¶</span></span><br><span class="line">            <span class="comment">//MergerSortNoRecurse(arr1);</span></span><br><span class="line">            <span class="comment">//å¸Œå°”</span></span><br><span class="line">            <span class="comment">//ShellSort(arr1);</span></span><br><span class="line">            <span class="comment">//å¿«æ’</span></span><br><span class="line">            <span class="comment">//QuickSort(arr1,0,arr1.length-1);</span></span><br><span class="line">            <span class="comment">//å †æ’åº</span></span><br><span class="line">            HeapSort(arr1);</span><br><span class="line">            <span class="keyword">long</span> time2=System.currentTimeMillis();</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>){</span><br><span class="line">                System.out.println(time2-time);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//ç³»ç»Ÿæ’åº</span></span><br><span class="line">            comparator(arr2);</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>){</span><br><span class="line">                System.out.println(System.currentTimeMillis()-time2);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (!isEqual(arr1, arr2)) {</span><br><span class="line">                succeed = <span class="keyword">false</span>;</span><br><span class="line">                printArray(arr1);</span><br><span class="line">                printArray(arr2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        System.out.println(succeed ? <span class="string">"Nice!"</span> : <span class="string">"Fucking fucked!"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//åˆçº§æ’åºç®—æ³•</span></span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="comment">//å†’æ³¡æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MaoPaoSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=nums.length-<span class="number">1</span>;i>=<span class="number">0</span>;i--){</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j<i;j++){< span><br><span class="line">                <span class="keyword">if</span>(nums[j]>nums[j+<span class="number">1</span>]){</span><br><span class="line">                    swap(nums,j,j+<span class="number">1</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="comment">//é€‰æ‹©æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SelectSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length;i++){< span><br><span class="line">            <span class="keyword">int</span> min=nums[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j<nums.length;j++){< span><br><span class="line">                <span class="keyword">if</span>(nums[j]<min){< span><br><span class="line">                    min=nums[j];</span><br><span class="line">                    swap(nums,j,i);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="comment">//ç›´æ¥æ’å…¥æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InsertSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i<nums.length;i++){< span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=i;j><span class="number">0</span>&&nums[j]<nums[j-<span class="number">1</nums[j-<span></span>];j--){</nums.length;i++){<></span><br><span class="line">                swap(nums,j,j-<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="comment">//æ’å…¥æ’åºçš„æ”¹è¿›</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShellSort</span><span class="params">(<span class="keyword">int</span> [] nums)</span></span>{</span><br><span class="line">        <span class="keyword">int</span> h=nums.length>><span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(h><span class="number">0</span>){</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=h;i<nums.length;i++){< span><br><span class="line">                <span class="comment">//å®é™…ä¸Šæ˜¯å¢å¤§äº†æ’å…¥æ’åºçš„é—´éš™ï¼Œæœ€åè¿˜æ˜¯å¯¹è¿›è¡Œä¸€æ¬¡æ’å…¥æ’åº,ä¸è¿‡é‚£ä¸ªæ—¶å€™çš„æ•°æ®å·²ç»æ˜¯é«˜åº¦æœ‰åºäº†</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j=i;j-h>=<span class="number">0</span>&&nums[j]<nums[j-h];j-=h) {< span><br><span class="line">                    swap(nums,j,j-h);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            h=h>><span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="comment">//å½’å¹¶æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MergerSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">        help=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        MergerSort(nums,<span class="number">0</span>,nums.length-<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MergerSort</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(left>=right){</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//ä¸èƒ½ç›´æ¥åœ¨è¿™é‡Œåˆ›å»ºæ•°ç»„ï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¯ä»¥åœ¨ä¸Šé¢å†å¥—ä¸€å±‚æ–¹æ³•ï¼Œæˆ–è€…é‡‡ç”¨merger2çš„æ–¹å¼(ä¹Ÿä¸å¥½ï¼Œåº”è¯¥ä¿è¯è¾…åŠ©æ•°ç»„åªåˆå§‹åŒ–ä¸€æ¬¡)</span></span><br><span class="line">        <span class="comment">//help=new int[nums.length];</span></span><br><span class="line">        <span class="keyword">int</span> mid=left+((right-left)>><span class="number">1</span>);</span><br><span class="line">        MergerSort(nums,left,mid);</span><br><span class="line">        MergerSort(nums,mid+<span class="number">1</span>,right);</span><br><span class="line">        merger(nums,left,mid,right);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è¾…åŠ©æ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> []help;</span><br><span class="line">    <span class="comment">//å½’å¹¶æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merger</span><span class="params">(<span class="keyword">int</span> []nums ,<span class="keyword">int</span> left,<span class="keyword">int</span> mid,<span class="keyword">int</span> right)</span></span>{</span><br><span class="line">        <span class="keyword">int</span> i=left,j=mid+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å…¶å®æ²¡åŒºåˆ«ç©ºé—´å¤æ‚åº¦ï¼Œéƒ½æ˜¯O(N) åé¢è¿™ä¸ªä¼šæ›´åŠ è€—è´¹æ—¶é—´</span></span><br><span class="line">        <span class="comment">//int []help=new int[right-left+1];</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k=left;k<=right;k++){</span><br><span class="line">            <span class="comment">//ä¸€è¾¹çš„åˆ°è¾¾å°½å¤´,å…ˆåˆ¤æ–­ä¸¤ä¸ªè¾¹ç•Œ,ä¸ç„¶å°±è¦æƒ³ä¸‹é¢é‚£æ ·å†™</span></span><br><span class="line">            <span class="keyword">if</span>(i>mid){</span><br><span class="line">                help[k]=nums[j++];</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span>(j>right){</span><br><span class="line">                help[k]=nums[i++];</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span>(nums[i]>nums[j]){</span><br><span class="line">                help[k]=nums[j++];</span><br><span class="line">            } <span class="keyword">else</span>{</span><br><span class="line">                <span class="comment">//ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§</span></span><br><span class="line">                help[k]=nums[i++];</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">/*// 2 </span></span><br><span class="line"><span class="comment">            if( i<=mid &&j<=right && nums[i]>nums[j]){</span></span><br><span class="line"><span class="comment">                help[k]=nums[j++];</span></span><br><span class="line"><span class="comment">            }else if( i<=mid &&j<=right && nums[i]<=nums[j]){</span></span><br><span class="line"><span class="comment">                //ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§</span></span><br><span class="line"><span class="comment">                help[k]=nums[i++];</span></span><br><span class="line"><span class="comment">            }else if(i>mid){</span></span><br><span class="line"><span class="comment">                help[k]=nums[j++];</span></span><br><span class="line"><span class="comment">            }else if(j>right){ </span></span><br><span class="line"><span class="comment">                help[k]=nums[i++];</span></span><br><span class="line"><span class="comment">            }*/</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å¤åˆ¶</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k=left;k<=right;k++){</span><br><span class="line">            nums[k]=help[k];</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//asddsdasdasdasd</span></span><br><span class="line">        <span class="comment">/*while (p1 <= m && p2 <= r) {</span></span><br><span class="line"><span class="comment">            help[i++] = arr[p1] < arr[p2] ? arr[p1++] : arr[p2++];</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">        while (p1 <= m) {</span></span><br><span class="line"><span class="comment">            help[i++] = arr[p1++];</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">        while (p2 <= r) {</span></span><br><span class="line"><span class="comment">            help[i++] = arr[p2++];</span></span><br><span class="line"><span class="comment">        }</span></span><br><span class="line"><span class="comment">        for (i = 0; i < help.length; i++) {</span></span><br><span class="line"><span class="comment">            arr[l + i] = help[i];</span></span><br><span class="line"><span class="comment">        }*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å½’å¹¶æ’åºï¼ˆéé€’å½’ï¼Œæ–¹å‘ä¸ä¸€æ ·ï¼Œæ—¶é—´å¤æ‚åº¦ä¸€æ ·éƒ½ä¸ºO(NlogN)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MergerSortNoRecurse</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">        help=<span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="comment">//æ§åˆ¶åˆå¹¶çš„é•¿åº¦ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> sz=<span class="number">1</span>;sz<nums.length;sz*=<span class="number">2</nums.length;sz*=<span></span>){</nums[j-h];j-=h)></span><br><span class="line">            <span class="comment">//æ§åˆ¶åˆå¹¶çš„å‘åç§»åŠ¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i<nums.length-sz;i+=<span class="number">2</nums.length-sz;i+=<span></span>*sz){</nums.length;i++){<></span><br><span class="line">                <span class="keyword">int</span> r=i+<span class="number">2</span>*sz-<span class="number">1</span><nums.length-<span class="number">1</nums.length-<span></span>?i+<span class="number">2</span>*sz-<span class="number">1</span>:nums.length-<span class="number">1</span>;</min){<></span><br><span class="line">                merger(nums,i,i+sz-<span class="number">1</span>,r);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="comment">//å¿«æ’ (ä¸å…·æœ‰ç¨³å®šæ€§æˆ–è€…éš¾ä»¥å®ç°)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">QuickSort</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(l>r){</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//éšæœºä¸€ä¸ªæ•°å’Œräº¤æ¢ ---éšæœºå¿«æ’</span></span><br><span class="line">        swap(nums, l + (<span class="keyword">int</span>) (Math.random() * (r - l + <span class="number">1</span>)), r);</span><br><span class="line">        <span class="keyword">int</span> []index=partition2(nums,l,r);</span><br><span class="line">        QuickSort(nums,l,index[<span class="number">0</span>]-<span class="number">1</span>);</span><br><span class="line">        QuickSort(nums,index[<span class="number">1</span>]+<span class="number">1</span>,r);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition1</span><span class="params">(<span class="keyword">int</span> []nums ,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>{</span><br><span class="line">        <span class="keyword">int</span> base = l;</span><br><span class="line">        <span class="comment">//åŒæŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">int</span> lo = l, hi = r;</span><br><span class="line">        <span class="comment">//è¿™ç§partitionçš„å®ç°ç»†èŠ‚æœ‰ç‚¹ä¸å¥½ç†è§£</span></span><br><span class="line">        <span class="comment">//è¿™ç§partitionä¸èƒ½éšæœºåŸºå‡†å…ƒç´ ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">        <span class="comment">//å‚ç…§äº†å·¦ç¥çš„ä»£ç å‘ç°å…¶å®å¯ä»¥åœ¨partitionä¹‹å‰éšæœºä¸€ä¸ªå˜é‡å’Œloäº¤æ¢ï¼Œä¹Ÿæœ‰åŒæ ·çš„æ•ˆæœä¹Ÿæ¶ˆé™¤äº†è¾“å…¥çš„å½±å“</span></span><br><span class="line">        <span class="keyword">while</span> (lo < hi) {</span><br><span class="line">            <span class="comment">//å¿…é¡»å…ˆä»å³å¾€å·¦,ä¸»è¦æ˜¯ä¸ºäº†å½’ä½çš„æ—¶å€™ä¸å‡ºç°é—®é¢˜</span></span><br><span class="line">            <span class="comment">//æ¯”å¦‚è¿™é‡Œé€‰å–çš„åŸºå‡†å…ƒç´ æ˜¯ lo ä¹Ÿå°±æ˜¯å­æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœå…ˆä»å·¦å¾€å³æœ€åäº¤æ¢çš„å°±æ˜¯loå’Œä¸€ä¸ªæ¯”loå¤§çš„æ•°ç„¶è€Œæ¯”loå¤§çš„æ•°åº”è¯¥æ”¾åœ¨å³è¾¹</span></span><br><span class="line">            <span class="comment">//åä¹‹å¦‚æœé€‰çš„æ˜¯hiä¸ºåŸºå‡†å°±è¦å…ˆä»å·¦å¾€å³</span></span><br><span class="line">            <span class="comment">// 7  0  1  2    10  11  22</span></span><br><span class="line">            <span class="keyword">while</span> (nums[hi] >= nums[base] && lo < hi) {</span><br><span class="line">                hi--;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">while</span> (nums[lo] <= nums[base] && lo < hi) {</span><br><span class="line">                lo++;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (lo < hi) {</span><br><span class="line">                swap(nums, lo, hi);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å½’ä½ lo==hi</span></span><br><span class="line">        swap(nums, hi, base);</span><br><span class="line">        <span class="keyword">return</span> lo;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è·å…°å›½æ——ä¼˜åŒ–çš„å¿«æ’</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] partition2(<span class="keyword">int</span> []arr ,<span class="keyword">int</span> l,<span class="keyword">int</span> r){</span><br><span class="line">        <span class="comment">// 7  0  1  2    10  11  22        </span></span><br><span class="line">        <span class="comment">//å°äºåŒºä¸ºç©º</span></span><br><span class="line">        <span class="keyword">int</span> less=l-<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//l ----> more ä¸ºå¾…å®šåŒº</span></span><br><span class="line">        <span class="keyword">int</span> more=r;</span><br><span class="line">        <span class="keyword">while</span>(l<more){< span><br><span class="line">            <span class="keyword">if</span>(arr[l]<arr[r]){< span><br><span class="line">                swap(arr,++less,l++);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span>(arr[l]>arr[r]){</span><br><span class="line">                <span class="comment">//å¤§äºåŸºå‡†æ—¶ , å¤§äºåŒºæ‰©å¤§(å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ å’Œå½“å‰å…ƒç´ äº¤æ¢ï¼Œä½†æ˜¯ä¸çŸ¥é“å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œæ‰€ä»¥ä¸èƒ½l++)</span></span><br><span class="line">                swap(arr,--more,l);</span><br><span class="line">            } <span class="keyword">else</span>{</span><br><span class="line">                l++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//å’Œå¤§äºåŒºé—´çš„ç¬¬ä¸€ä¸ªäº¤æ¢ ä¿è¯å½’ä½æ­£ç¡®,å¦‚æœé€‰å–çš„æ˜¯ä»¥æœ€å·¦è¾¹ä¸ºåŸºå‡†å…ƒç´  è¿™é‡Œå°±åº”è¯¥å’Œlessäº¤æ¢</span></span><br><span class="line">        <span class="comment">//åˆ°è¿™é‡Œ  [less+1,more-1]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„</span></span><br><span class="line">        swap(arr,more,r);</span><br><span class="line">        <span class="comment">//åˆ°è¿™  [less+1,more]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]{less+<span class="number">1</span>,more};</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="comment">//å †æ’åº</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">HeapSort</span><span class="params">(<span class="keyword">int</span> []nums)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(nums.length<<span class="number">2</span>){</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//æ„å»ºå¤§æ ¹å †</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i<nums.length; i++) {< span><br><span class="line">            heapInsert(nums,i);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//äº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">int</span> size= nums.length;</span><br><span class="line">        swap(nums,size-<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">while</span>(size><span class="number">1</span>){</span><br><span class="line">            <span class="comment">//è°ƒæ•´</span></span><br><span class="line">            heapIfy(nums,<span class="number">0</span>,size);</span><br><span class="line">            <span class="comment">//æ¯æ¬¡éƒ½å’Œæœ€åä¸€ä¸ªå­©å­èŠ‚ç‚¹äº¤æ¢ï¼Œç„¶åsize--</span></span><br><span class="line">            swap(nums,--size,<span class="number">0</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å‘ä¸Šçˆ¬</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapInsert</span><span class="params">(<span class="keyword">int</span> []nums, <span class="keyword">int</span> index)</span></span>{</span><br><span class="line">        <span class="comment">//è¿­ä»£æ¯”è¾ƒå½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å€¼çš„å¤§å°</span></span><br><span class="line">        <span class="keyword">while</span>(nums[index]>nums[(index-<span class="number">1</span>)/<span class="number">2</span>]){</span><br><span class="line">            swap(nums,index,(index-<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">            index=(index-<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//å‘ä¸‹çˆ¬</span></span><br><span class="line">    <span class="comment">//indexä½ç½®çš„å€¼å˜å°åç»§ç»­è°ƒæ•´ä¸ºå¤§æ ¹å †</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapIfy</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> index,<span class="keyword">int</span> size)</span></span>{</span><br><span class="line">        <span class="comment">//å·¦å­©å­</span></span><br><span class="line">        <span class="keyword">int</span> left=index*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//èŠ‚ç‚¹æœ‰å·¦å­©å­</span></span><br><span class="line">        <span class="keyword">while</span>(left<size){< span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰å³å­©å­.....</span></span><br><span class="line">            <span class="comment">//å·¦å³å­©å­é‡Œçš„æœ€å¤§å€¼ æœ‰å³å­©å­ä¸”å³å­©å­å¤§äºå·¦å­©å­</span></span><br><span class="line">            <span class="keyword">int</span> largest=left+<span class="number">1</span><size && nums[left]<nums[left+<span class="number">1</size></span>] ?left+<span class="number">1</span>:left;</size){<></span><br><span class="line">            largest=nums[largest]>nums[index]?largest:index;</span><br><span class="line">            <span class="comment">//æœ€å¤§å€¼ç­‰äºè‡ªå·±</span></span><br><span class="line">            <span class="keyword">if</span>(largest==index){</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//äº¤æ¢å¤§å­©å­èŠ‚ç‚¹å’Œè‡ªå·±</span></span><br><span class="line">            swap(nums,largest,index);</span><br><span class="line">            <span class="comment">//è®¾ç½®å¤§å­©å­çš„indexå’Œå·¦å­©å­</span></span><br><span class="line">            index=largest;</span><br><span class="line">            left=index*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//************************************************************************</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> []nums,<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">        <span class="comment">//ä¸çŸ¥é“ä¸ºå•¥å¿«æ’äº¤æ¢çš„æ—¶å€™è¿™æ ·å†™ä¼šå‡ºç°å¾ˆå¤š0</span></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢çŸ¥é“ï¼Œå½“a==bæ—¶è‡ªå·±å’Œç›´æ¥äº¤æ¢ï¼Œaå¼‚æˆ–è‡ªå·±4æ¬¡åa==0.....</span></span><br><span class="line">        nums[a]=nums[a]^nums[b];</span><br><span class="line">        nums[b]=nums[a]^nums[b];</span><br><span class="line">        nums[a]=nums[a]^nums[b];</span><br><span class="line">        <span class="comment">/*int temp=nums[a];</span></span><br><span class="line"><span class="comment">        nums[a]=nums[b];</span></span><br><span class="line"><span class="comment">        nums[b]=temp;*/</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// for test  å¯¹æ•°å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">comparator</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>{</span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// for test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] generateRandomArray(<span class="keyword">int</span> maxSize, <span class="keyword">int</span> maxValue) {</span><br><span class="line">        <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[(<span class="keyword">int</span>) ((maxSize + <span class="number">1</span>) * Math.random())];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < arr.length; i++) {</span><br><span class="line">            arr[i] = (<span class="keyword">int</span>) ((maxValue + <span class="number">1</span>) * Math.random()) - (<span class="keyword">int</span>) (maxValue * Math.random());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// for test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] copyArray(<span class="keyword">int</span>[] arr) {</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[arr.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < arr.length; i++) {</span><br><span class="line">            res[i] = arr[i];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// for test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">isEqual</span><span class="params">(<span class="keyword">int</span>[] arr1, <span class="keyword">int</span>[] arr2)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> ((arr1 == <span class="keyword">null</span> && arr2 != <span class="keyword">null</span>) || (arr1 != <span class="keyword">null</span> && arr2 == <span class="keyword">null</span>)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (arr1 == <span class="keyword">null</span> && arr2 == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (arr1.length != arr2.length) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < arr1.length; i++) {</span><br><span class="line">            <span class="keyword">if</span> (arr1[i] != arr2[i]) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// for test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < arr.length; i++) {</span><br><span class="line">            System.out.print(arr[i] + <span class="string">" "</span>);</span><br><span class="line">        }</span><br><span class="line">        System.out.println();</span><br><span class="line">    }</span><br><span class="line">}</span><br></nums.length;></span></arr[r]){<></span></more){<></span></nums.length;j++){<></span></nums.length;i++){<></span></i;j++){<></span></pre></td></tr></tbody></table></figure></div><p>â€‹        </p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeJSæ¨¡ä»¿Expresså°è£…è·¯ç”±</title>
      <link href="/2018/12/03/nodejs-mo-fang-express-feng-zhuang-lu-you/"/>
      <url>/2018/12/03/nodejs-mo-fang-express-feng-zhuang-lu-you/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="NodeJSæ¨¡ä»¿Expresså°è£…è·¯ç”±"><a href="#NodeJSæ¨¡ä»¿Expresså°è£…è·¯ç”±" class="headerlink" title="NodeJSæ¨¡ä»¿Expresså°è£…è·¯ç”±"></a>NodeJSæ¨¡ä»¿Expresså°è£…è·¯ç”±</h2><p><em>æœ€è¿‘æ‰å¼€å§‹å­¦NodeJsä¹Ÿä¸çŸ¥é“ä¸ºå•¥å°±çªç„¶å¯¹è¿™ä¸ªå¾ˆæ„Ÿå…´è¶£,(å¯èƒ½Javaå†™çƒ¦äº†ğŸ˜„)ï¼Œæ„Ÿè§‰ç”¨è¿™ä¸ªå¼€å‘è¿˜æ˜¯æŒºå¿«çš„ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿå¾ˆå¥½ï¼Œå€Ÿæ­¤ä¹Ÿäº†è§£ä¸‹å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹ç‚¹å’Œå¼‚æ­¥ç¼–ç¨‹çš„æ€æƒ³ã€‚</em></p><ul><li><h3 id="æ²¡å°è£…å‰"><a href="#æ²¡å°è£…å‰" class="headerlink" title="æ²¡å°è£…å‰"></a>æ²¡å°è£…å‰</h3>åŸç”Ÿçš„å°±å·®ä¸å¤šæ˜¯è¿™æ ·çš„ã€‚</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    Node.js æœªå°è£… 1.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = require(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = require(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> path = require(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = require(<span class="string">"querystring"</span>); <span class="comment">//jsonè½¬æ¢</span></span><br><span class="line"><span class="keyword">const</span> scores = require(<span class="string">"./StudentScore.json"</span>);</span><br><span class="line"><span class="keyword">const</span> template = require(<span class="string">"art-template"</span>);</span><br><span class="line">http.createServer((req, resp) => {</span><br><span class="line">    <span class="keyword">if</span> (req.url.startsWith(<span class="string">"/query"</span>) && req.method == <span class="string">'GET'</span>) {</span><br><span class="line">        <span class="comment">//è¿™é‡Œå¯ä»¥é‡‡ç”¨æ¨¡æ¿ä¸ºäº†å’Œä¸‹é¢çš„å¯¹æ¯”ä¸€ä¸‹</span></span><br><span class="line">        fs.readFile(path.join(__dirname, <span class="string">"querypage.html"</span>), (err, content) => {</span><br><span class="line">            <span class="keyword">if</span> (err) {</span><br><span class="line">                resp.writeHead(<span class="number">500</span>, {</span><br><span class="line">                    <span class="string">'Content-Type'</span>: <span class="string">'text/plain;charset=utf8'</span></span><br><span class="line">                });</span><br><span class="line">                resp.end(<span class="string">'æœåŠ¡å™¨é”™è¯¯'</span>);</span><br><span class="line">            }</span><br><span class="line">            resp.end(content);</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> (req.url.startsWith(<span class="string">"/scores"</span>)) {</span><br><span class="line">        let pdata = <span class="string">''</span>;</span><br><span class="line">        <span class="comment">//äº‹ä»¶ç»‘å®š</span></span><br><span class="line">        <span class="comment">//è·å–æ•°æ®ï¼ˆidï¼‰</span></span><br><span class="line">        req.on(<span class="string">'data'</span>, (ck) => {</span><br><span class="line">            pdata += ck;</span><br><span class="line">        });</span><br><span class="line">        <span class="comment">//åœ¨è¿™é‡Œè¿”å›</span></span><br><span class="line">        req.on(<span class="string">'end'</span>, () => {</span><br><span class="line">            let obj = querystring.parse(pdata); <span class="comment">//å°†å‚æ•° çš„å­—ç¬¦ä¸²è½¬æ¢æˆ å¯¹è±¡</span></span><br><span class="line">            let result = scores[obj.stunum];</span><br><span class="line">            let content = template(path.join(__dirname, <span class="string">"scores.art"</span>), result);</span><br><span class="line">            resp.end(content);</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}).listen(<span class="number">9999</span>, () => {</span><br><span class="line">    console.log(<span class="string">'Server is runing on 9999'</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div><ul><li>Expressçš„æ–¹å¼<br>é€šè¿‡const app=express(); è·å¾—ä¸€ä¸ªappçš„å¯¹è±¡åé¢å°±é€šè¿‡è¿™ä¸ªæ¥æ“ä½œ<br><img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/D~KS%28D1%5B%5DUS5TBZPO7KTJ88.png" src="/img/loading.gif" class="lazyload"></li><li>æ‰‹åŠ¨å°è£…</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> url = require(<span class="string">'url'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è£…æ–¹æ³•æ”¹å˜res  ç»‘å®šres.send()</span></span><br><span class="line"><span class="function">function <span class="title">changeRes</span><span class="params">(res)</span> </span>{</span><br><span class="line"></span><br><span class="line">    res.send = function(data) {</span><br><span class="line"></span><br><span class="line">        res.writeHead(<span class="number">200</span>, {</span><br><span class="line">            <span class="string">"Content-Type"</span>: <span class="string">"text/html;charset=utf-8"</span></span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        res.end(data);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰æš´éœ²çš„æ¨¡å—  return é‡Œé¢å®šä¹‰çš„æ¨¡å—</span></span><br><span class="line"><span class="keyword">var</span> Server = function() {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> G = <span class="keyword">this</span>; <span class="comment">/*å…¨å±€å˜é‡*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤„ç†getå’Œpostè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">this</span>._get = {};</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>._post = {};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> app = function(req, res) {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        changeRes(res);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–è·¯ç”±</span></span><br><span class="line">        <span class="keyword">var</span> pathname = url.parse(req.url).pathname;</span><br><span class="line">        <span class="keyword">if</span> (!pathname.endsWith(<span class="string">'/'</span>)) {</span><br><span class="line">            pathname = pathname + <span class="string">'/'</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–è¯·æ±‚çš„æ–¹å¼ get  post</span></span><br><span class="line">        <span class="keyword">var</span> method = req.method.toLowerCase();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (G[<span class="string">'_'</span> + method][pathname]) {</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (method == <span class="string">'post'</span>) { <span class="comment">/*æ‰§è¡Œpostè¯·æ±‚*/</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> postStr = <span class="string">''</span>;</span><br><span class="line">                req.on(<span class="string">'data'</span>, function(chunk) {</span><br><span class="line"></span><br><span class="line">                    postStr += chunk;</span><br><span class="line">                })</span><br><span class="line">                req.on(<span class="string">'end'</span>, function(err, chunk) {</span><br><span class="line">                    <span class="comment">//æ·»åŠ è¯·æ±‚å±æ€§</span></span><br><span class="line">                    req.myBody = postStr; <span class="comment">/*è¡¨ç¤ºæ‹¿åˆ°postçš„å€¼*/</span></span><br><span class="line">                    <span class="comment">/*æ‰§è¡Œæ–¹æ³•*/</span></span><br><span class="line">                    G[<span class="string">'_'</span> + method][pathname](req, res);</span><br><span class="line">                })</span><br><span class="line">            } <span class="keyword">else</span> { <span class="comment">/*æ‰§è¡Œgetè¯·æ±‚*/</span></span><br><span class="line">                G[<span class="string">'_'</span> + method][pathname](req, res); <span class="comment">/*æ‰§è¡Œæ–¹æ³•*/</span></span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            res.end(<span class="string">'no router'</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸‹é¢çš„éƒ½æ˜¯ä¸ºäº†åšæ³¨å†Œçš„æ“ä½œ</span></span><br><span class="line">    app.get = function(string, callback) {</span><br><span class="line">        <span class="keyword">if</span> (!string.endsWith(<span class="string">'/'</span>)) {</span><br><span class="line">            string = string + <span class="string">'/'</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!string.startsWith(<span class="string">'/'</span>)) {</span><br><span class="line">            string = <span class="string">'/'</span> + string;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//    /login/</span></span><br><span class="line">        G._get[string] = callback;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    app.post = function(string, callback) {</span><br><span class="line">        <span class="keyword">if</span> (!string.endsWith(<span class="string">'/'</span>)) {</span><br><span class="line">            string = string + <span class="string">'/'</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (!string.startsWith(<span class="string">'/'</span>)) {</span><br><span class="line">            string = <span class="string">'/'</span> + string;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//    /login/</span></span><br><span class="line">        G._post[string] = callback;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//G._post['dologin']=function(req,res){</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">//}</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = Server();</span><br></pre></td></tr></tbody></table></figure></div><ul><li>å°è£…å<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = require(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">const</span> url = require(<span class="string">"url"</span>);</span><br><span class="line"><span class="comment">//å¼•å…¥è‡ªå®šä¹‰çš„è·¯ç”±æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> myApp = require(<span class="string">"./model/express-route.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨è‡ªå®šä¹‰çš„æ¨¡å—</span></span><br><span class="line">http.createServer(myApp).listen(<span class="number">9999</span>, () => {</span><br><span class="line">    console.log(<span class="string">'Running 9999'</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">myApp.get(<span class="string">"/express"</span>, (req, resp) => {</span><br><span class="line">    resp.send(<span class="string">"æ¨¡ä»¿Expresså°è£…è·¯ç”±"</span>);</span><br><span class="line">    console.log(req);</span><br><span class="line">});</span><br><span class="line">myApp.post(<span class="string">"/postExpress"</span>, (req, resp) => {</span><br><span class="line">    resp.send(<span class="string">"æ¨¡ä»¿Expresså°è£…è·¯ç”±"</span>);</span><br><span class="line">    console.log(req.myBody);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div></li></ul><hr><p>é€šè¿‡è¿™ä¸ªä½“ä¼šä¸‹Expressçš„å°è£…</p></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NodeJS </tag>
            
            <tag> ES6 </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaçˆ¬è™«å®æˆ˜(ä¸€) ï¼šçˆ¬å–æ–—å›¾ç¤¾æ‰€æœ‰gif</title>
      <link href="/2018/11/30/java-pa-chong-shi-zhan/"/>
      <url>/2018/11/30/java-pa-chong-shi-zhan/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="Javaçˆ¬è™«å®æˆ˜-ä¸€-ï¼šçˆ¬å–æ–—å›¾ç¤¾æ‰€æœ‰gif"><a href="#Javaçˆ¬è™«å®æˆ˜-ä¸€-ï¼šçˆ¬å–æ–—å›¾ç¤¾æ‰€æœ‰gif" class="headerlink" title="Javaçˆ¬è™«å®æˆ˜(ä¸€) ï¼šçˆ¬å–æ–—å›¾ç¤¾æ‰€æœ‰gif"></a>Javaçˆ¬è™«å®æˆ˜(ä¸€) ï¼šçˆ¬å–æ–—å›¾ç¤¾æ‰€æœ‰gif</h2><p>æœ€è¿‘å¼€å§‹ç©çˆ¬è™« , è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ , è™½ç„¶å†™çˆ¬è™«ä¸€èˆ¬éƒ½æ˜¯ç”¨Pythonæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å¿…è¦ä¸ºäº†å†™çˆ¬è™«å†å­¦ä¸€é—¨è¯­è¨€ ,è™½ç„¶ä¹ŸæŒºç®€å•ï¼Œä½†æ˜¯è¿˜æ˜¯å¯¹Javaæ¯”è¾ƒä¹ æƒ¯ï¼Œåé¢å¯èƒ½ä¼šå­¦Pythonä½†æ˜¯ç›®å‰è¿˜æ˜¯å…ˆç”¨javaå†™ç€ç©ç©ã€‚</p><p><strong>ç›®æ ‡</strong><br><a href="https://doutushe.com/" target="_blank" rel="noopener">æ–—å›¾ç¤¾ </a>  ä¸Šæ‰€æœ‰çš„å›¾ç‰‡ã€‚<br><img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/%408Q0%601FQB2A2E4D%5D9M8%40VW8.png" src="/img/loading.gif" class="lazyload"></p><p><strong>æŠ€æœ¯é€‰æ‹©</strong><br>Jsoupï¼Œæœ€å¼€å§‹çœ‹è§è¿™ä¸ªæˆ‘çœ‹æˆäº†Jsonpã€‚ã€‚ã€‚æˆ‘å¯»æ€ç€ä¸æ˜¯è§£å†³è·¨åŸŸçš„é‚£ä¸ªä¹ˆ?è¿˜èƒ½æçˆ¬è™«?è¿™ä¹ˆç‰›æ°çš„ä¹ˆğŸ˜„<br>å…³äºJsoupç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ–‡æ¡£ <a href="http://www.open-open.com/jsoup/" target="_blank" rel="noopener">å‚è€ƒèµ„æ–™</a><br>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æŠ€æœ¯æ¯”å¦‚ httpclient+Xpath è¿˜æœ‰htmlunit è¿˜æœ‰ selenium ç­‰ç­‰ï¼Œç­‰ä»¥åå­¦äº†åå†æ¥ç§€ä¸€ç§€ ğŸ˜</p><hr><p>å…¶å®æˆ‘å†™çš„ç¬¬ä¸€ä¸ªçˆ¬è™«æ˜¯copyçš„åˆ«äººçš„åšå®¢ä¸Šçš„ï¼Œä¸è¿‡å®ƒçˆ¬å–çš„æ˜¯äº¬ä¸œçš„ï¼Œæˆ‘çˆ¬çš„æ˜¯æ·˜å®çš„<br>æˆ‘ä¹Ÿåªæ˜¯æƒ³å‚è€ƒä¸‹ä»–çš„ç»“æ„ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰ä»–çš„æœ‰äº›ç±»æ²¡ä»€ä¹ˆå®é™…æ„ä¹‰ã€‚ã€‚ç„¶åæˆ‘å°±ç›´æ¥è‡ªå·±å†™äº†ã€‚<br>ç»“æ„å¦‚ä¸‹ï¼š</p><ul><li>boot ï¼šçˆ¬è™«çš„å…¥å£</li><li>dao  ï¼šdao</li><li>handle ï¼šå°è£…çš„å¤„ç†æŸ¥è¯¢ç»“æœé›†çš„ç±»ï¼ˆè¿™é‡Œæ²¡ç”¨ï¼‰</li><li>model ï¼šçˆ¬å–çš„æ•°æ®çš„æ¨¡å‹</li><li>parse  ï¼š è§£æhtmlçš„ç±»</li><li>util     ï¼š Jsoupå·¥å…·ç±»å’Œdaoçš„å·¥å…·ç±»å’ŒDBæ¨¡æ¿ç±»</li></ul><p>é¦–å…ˆå»ºç«‹æ•°æ®æ¨¡å‹DoutuModel</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoutuModel</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String topic;</span><br><span class="line">    <span class="keyword">private</span> String imgUrl;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ•°æ®åº“idè‡ªå¢</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DoutuModel</span><span class="params">(String topic, String imgUrl, String title)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.topic = topic;</span><br><span class="line">        <span class="keyword">this</span>.imgUrl = imgUrl;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTopic</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> topic;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTopic</span><span class="params">(String topic)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.topic = topic;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImgUrl</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> imgUrl;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImgUrl</span><span class="params">(String imgUrl)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.imgUrl = imgUrl;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p><strong>ä¸»è¦è®°å½•ä¸‹parseç±»</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List<doutumodel> <span class="title">getData2</span><span class="params">(String url)</span> <span class="keyword">throws</span> Exception </doutumodel></span>{</span><br><span class="line">        <span class="comment">//è·å–çš„æ•°æ®ï¼Œå­˜æ”¾åœ¨é›†åˆä¸­</span></span><br><span class="line">        List<doutumodel> data = <span class="keyword">new</span> ArrayList();</doutumodel></span><br><span class="line">        <span class="comment">//é‡‡ç”¨Jsoupè§£æ</span></span><br><span class="line">        <span class="comment">//String url="https://doutushe.com/portal/article/index/id/5gK";</span></span><br><span class="line">        String preurl = <span class="string">"https://doutushe.com"</span>;</span><br><span class="line">        <span class="comment">//å–åˆ°å½“å‰é¡µçš„document</span></span><br><span class="line">        <span class="comment">//å–åˆ°å†…å®¹é¡µçš„æ‰€æœ‰å›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">int</span> page = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            Document doc = JsoupUtils.getHtmlDocument(url);</span><br><span class="line">            Elements imgList = doc.select(<span class="string">"div[class=col-xs-12 col-sm-8 col-lg-9]"</span>).select(<span class="string">"img.lazy"</span>);</span><br><span class="line">            String topic = doc.select(<span class="string">"blockquote>p"</span>).text();</span><br><span class="line">            <span class="keyword">for</span> (Element imgelement : imgList) {</span><br><span class="line">                <span class="comment">//å¼‚æ­¥çš„åå¤„ä½“ç°å‡ºæ¥äº†,è¿™ä¸ªæ˜æ˜¾æ˜¯æ‡’åŠ è½½,è¦æ‰¾å°±æ‰¾æ•°æ®æº,ç›´æ¥è·å–srcè·å–ä¸åˆ°</span></span><br><span class="line">                <span class="comment">//String imgUrl= imgelement.attr("src");</span></span><br><span class="line">                String imgUrl = imgelement.attr(<span class="string">"data-original"</span>);</span><br><span class="line">                String title = imgelement.attr(<span class="string">"title"</span>);</span><br><span class="line">                data.add(<span class="keyword">new</span> DoutuModel(topic, imgUrl, title));</span><br><span class="line">                <span class="comment">//System.out.println(topic + ":" + imgUrl + ":" + title);</span></span><br><span class="line">            }</span><br><span class="line">            Elements pageUrls = doc.select(<span class="string">"ul.pager"</span>).select(<span class="string">"a"</span>);</span><br><span class="line">            <span class="comment">//çˆ¬ä¸€é¡µä¼‘æ¯1ç§’</span></span><br><span class="line">            <span class="keyword">if</span> (page % <span class="number">10</span> == <span class="number">0</span>) {</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(<span class="string">"ç¬¬"</span> + (page/<span class="number">10</span>) + <span class="string">"é¡µé‡‡é›†å®Œ , æš‚åœ-------"</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//æœ€åä¸€é¡µä¹Ÿæœ‰ä¸¤ä¸ªæŒ‰é’®ã€‚ã€‚ã€‚çœ‹æ¥è¦å¤šè§‚å¯Ÿé¡µé¢</span></span><br><span class="line">            <span class="comment">/*if (pageUrls.size() < 2) {</span></span><br><span class="line"><span class="comment">                //è¯´æ˜åˆ°æœ€åä¸€é¡µäº†</span></span><br><span class="line"><span class="comment">                break;</span></span><br><span class="line"><span class="comment">            }*/</span></span><br><span class="line">            url = preurl + pageUrls.get(<span class="number">1</span>).attr(<span class="string">"href"</span>);</span><br><span class="line">            <span class="keyword">if</span> (!url.matches(preurl + <span class="string">"/portal/article/index/id/[a-zA-Z0-9_]*"</span>)) {</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            page++;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//è¿”å›æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®ä¸€å¼€å§‹å†™çš„ä¸€ä¸ªç‰ˆæœ¬æ˜¯ä»ä¸»é¡µé¢çˆ¬çš„å…ˆè·å–æ¯ä¸€é¡µçš„é“¾æ¥ï¼Œå†è·å–æ¯ä¸€é¡µçš„ä¸»é¢˜çš„é“¾æ¥ï¼Œå†è·å–æ¯ä¸ªä¸»é¢˜ä¸‹çš„å›¾ç‰‡é“¾æ¥ï¼Œä¸€ä¸ªä¸‰é‡forå¾ªç¯ï¼Œé€Ÿåº¦ç¡®å®æ¯”è¾ƒæ…¢ã€‚ã€‚ã€‚</p><p>åæ¥å‘ç°æ¯ä¸€é¡µéƒ½æœ‰ä¸‹ä¸€é¡µçš„é“¾æ¥ã€‚ã€‚ã€‚ç„¶åå°±å¯ä»¥ç›´æ¥ä»é¡µé¢ä¸Šçˆ¬ï¼Œä¸¤ä¸ªå¾ªç¯å°±å¯ä»¥äº†ï¼Œä½†æ˜¯ä¸€å¼€å§‹æˆ‘åˆ¤æ–­è¾¹ç•Œçš„æ—¶å€™ç”¨çš„æ˜¯åœ¨ä¸‹é¢çš„é“¾æ¥çš„æ•°é‡å°äº2ä½†æ˜¯ä¸€å¼€å§‹çˆ¬äº†å¥½é•¿æ—¶é—´ç»“æœæŠ¥é”™äº†ã€‚ã€‚  ç„¶åæˆ‘å»çœ‹äº†ä¸‹æœ€åä¸€é¡µå‘ç°ä¹Ÿæœ‰ä¸¤ä¸ªé“¾æ¥åé¢ä¸€ä¸ªæ˜¯å…¨éƒ¨çš„é“¾æ¥ã€‚ã€‚ ã€‚</p><p> <img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/AT5%7BUKZN%24M%5B59V%5B1OU0S%5B7N.png" src="/img/loading.gif" class="lazyload"><br>è€Œä¸”å’Œä¸Šé¢çš„cssæ˜¯ä¸€æ ·çš„ä½†æ˜¯å’Œå‰é¢çš„æ¯ä¸€é¡µçš„é“¾æ¥çš„åç¼€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å°±ç›´æ¥ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…urlçš„åç¼€æ˜¯å¦åŒ¹é…<br>Regex ï¼š<a href="https://doutushe.com/portal/article/index/id/[a-zA-Z0-9_]" target="_blank" rel="noopener">https://doutushe.com/portal/article/index/id/[a-zA-Z0-9_]</a>*  åé¢çš„å°±æ˜¯ç›´æ¥åŒ¹é…ä»»æ„è§†é¢‘<br>è€Œæœ€åä¸€é¡µçš„å…¨éƒ¨é“¾æ¥æ˜¯ ï¼š <a href="https://doutushe.com/portal/index/index" target="_blank" rel="noopener">https://doutushe.com/portal/index/index</a> æ‰€ä»¥å°±åŒ¹é…ä¸ä¸Šç›´æ¥break</p><p><strong>çˆ¬å›¾ç‰‡çš„å°ç»†èŠ‚</strong> , ä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œä»–è¿™ä¸ªå›¾ç‰‡æ˜¯æ‡’åŠ è½½çš„ï¼Œä¹Ÿå°±æ˜¯éšç€é¡µé¢ç”¨jsåŠ è½½çš„ï¼Œ ç›´æ¥srcè·å–è‚¯å®šè·å–ä¸åˆ°çš„ï¼Œå› ä¸ºjsoupæ˜¯ä¸æ”¯æŒå¼‚æ­¥çš„ï¼Œç”¨jsæ“ä½œçš„ä¸œè¥¿è‚¯å®šçˆ¬ä¸åˆ°ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡ data-orginal è·å–ã€‚</p><p>github  <a href="https://github.com/imlgw/javaSpiders" target="_blank" rel="noopener">ä»“åº“åœ°å€</a></p><hr><p><strong>ç»“æœ</strong><br><img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/X%28%7B%60H6YKH2LIW%24%25F2K4U53M.jpg" src="/img/loading.gif" class="lazyload"><br>4243å¼ å›¾ç‰‡ï¼Œåé¢å¯ä»¥è‡ªå·±å†™ä¸ªè„šæœ¬æŠŠå›¾ç‰‡å…¨éƒ¨ä¸‹è½½åˆ°æœ¬åœ°æˆ–è€…ç”¨è¿…é›·ä¹‹ç±»çš„ä¸‹è½½å·¥å…·ã€‚</p><hr><p>åé¢ä¼šå°è¯•ä¸‹æ›´å¤šçˆ¬è™«æŠ€æœ¯åƒ htmlunitè¿™ç§æ”¯æŒå¼‚æ­¥çš„æˆ–è€… selenium è¿™ç§ç›´æ¥æ“ä½œæµè§ˆå™¨çš„å·¥å…·</p></body></html>]]></content>
      
      
      <categories>
          
          <category> çˆ¬è™« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çˆ¬è™« </tag>
            
            <tag> Java </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-Securityé‡åˆ°çš„å°é—®é¢˜</title>
      <link href="/2018/11/26/springsecurity-pei-zhi-de-ji-ge-xiao-wen-ti/"/>
      <url>/2018/11/26/springsecurity-pei-zhi-de-ji-ge-xiao-wen-ti/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="Spring-Security-é…ç½®-intercept-url-çš„å°é—®é¢˜"><a href="#Spring-Security-é…ç½®-intercept-url-çš„å°é—®é¢˜" class="headerlink" title="Spring Security é…ç½® intercept-url çš„å°é—®é¢˜"></a>Spring Security é…ç½® intercept-url çš„å°é—®é¢˜</h2><p>æ–‡æ¡£ï¼š <a href="http://www.fengfly.com/document/springsecurity3/core-web-filters.html" target="_blank" rel="noopener">http://www.fengfly.com/document/springsecurity3/core-web-filters.html</a></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><bean id="<span" class="string">"filterInvocationInterceptor"</bean></span><br><span class="line">     <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.intercept.web.FilterSecurityInterceptor"</span>></span><br><span class="line">  <property name="<span" class="string">"authenticationManager"</property></span> ref=<span class="string">"authenticationManager"</span>/><br><span class="line">  <property name="<span" class="string">"accessDecisionManager"</property></span> ref=<span class="string">"accessDecisionManager"</span>/><br><span class="line">  <property name="<span" class="string">"runAsManager"</property></span> ref=<span class="string">"runAsManager"</span>/><br><span class="line">  <property name="<span" class="string">"securityMetadataSource"</property></span>><br><span class="line">    <security:filter-security-metadata-source path-type="<span" class="string">"regex"</security:filter-security-metadata-source></span>><br><span class="line">      <security:intercept-url pattern="<span" class="string">"\A/secure/super/.*\Z"</security:intercept-url></span> access=<span class="string">"ROLE_WE_DONT_HAVE"</span>/><br><span class="line">      <security:intercept-url pattern="<span" class="string">"\A/secure/.*\" access="</security:intercept-url></span>ROLE_SUPERVISOR,ROLE_TELLER<span class="string">"/></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></tbody></table></figure></div><p>æ¨¡å¼æ€»æ˜¯æ ¹æ®ä»–ä»¬å®šä¹‰çš„é¡ºåºè¿›è¡Œæ‰§è¡Œã€‚å› æ­¤å¾ˆé‡è¦çš„æ˜¯ï¼ŒæŠŠæ›´ç¡®å®šçš„æ¨¡å¼å®šä¹‰åˆ°åˆ—è¡¨çš„ä¸Šé¢ã€‚ è¿™ä¼šåæ˜ åœ¨ä½ ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ›´ç¡®å®šçš„/secure/super/æ¨¡å¼æ”¾åœ¨æ²¡é‚£ä¹ˆç¡®å®šçš„ /secure/æ¨¡å¼çš„ä¸Šé¢ã€‚å¦‚æœå®ƒä»¬è¢«åè½¬äº†ã€‚/secure/ä¼šä¸€ç›´<br> è¢«åŒ¹é…ï¼Œ/secure/super/å°±æ°¸è¿œä¹Ÿä¸ä¼šæ‰§è¡Œã€‚</p><hr><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><http use-expressions="<span" class="string">"false"</http></span> entry-point-ref=<span class="string">"casProcessingFilterEntryPoint"</span>><br><span class="line"><intercept-url pattern="<span" class="string">"/**"</intercept-url></span> access=<span class="string">"ROLE_USER"</span>/><br><span class="line">        <!--ç»è¿‡SpringSecurityçš„ç¯å¢ƒä¸Šä¸‹æ–‡ï¼Œå¶ç„¶å‘ç°ä¸€ä¸ªå°å‘--></span><br><span class="line">        <intercept-url pattern="<span" class="string">"/cart/*.do"</intercept-url></span> access=<span class="string">"IS_AUTHENTICATED_ANONYMOUSLY"</span>/><br><span class="line">        <csrf disabled="<span" class="string">"true"</csrf></span>/><br><span class="line">        <!-- custom-filterä¸ºè¿‡æ»¤å™¨ï¼Œ position è¡¨ç¤ºå°†è¿‡æ»¤å™¨æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šï¼Œbeforeè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šä½ç½®ä¹‹å‰  ï¼Œafterè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¹‹å  --></span><br><span class="line">        <custom-filter ref="<span" class="string">"casAuthenticationFilter"</custom-filter></span>  position=<span class="string">"CAS_FILTER"</span> /><br><span class="line">        <custom-filter ref="<span" class="string">"requestSingleLogoutFilter"</custom-filter></span> before=<span class="string">"LOGOUT_FILTER"</span>/><br><span class="line">        <custom-filter ref="<span" class="string">"singleLogoutFilter"</custom-filter></span> before=<span class="string">"CAS_FILTER"</span>/><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯å¤§èŒƒå›´åœ¨å‰é¢ä¼šè¦†ç›–åé¢çš„å°èŒƒå›´æ‰€ä»¥åƒæˆ‘ä¸Šé¢é‚£ä¹ˆå†™/cart/*.do å°±ä¸ä¼šæ‰§è¡Œç›¸å½“äºæ²¡å†™ï¼Œèµ·ä¸åˆ°ä½œç”¨ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> è¸©å‘è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bug </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CASå•ç‚¹ç™»é™†ç³»ç»ŸDemo</title>
      <link href="/2018/11/17/cas-dan-dian-deng-lu-xi-tong-ru-men/"/>
      <url>/2018/11/17/cas-dan-dian-deng-lu-xi-tong-ru-men/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="å•ç‚¹ç™»é™†ç³»ç»Ÿ-â€“CAS"><a href="#å•ç‚¹ç™»é™†ç³»ç»Ÿ-â€“CAS" class="headerlink" title="å•ç‚¹ç™»é™†ç³»ç»Ÿ â€“CAS"></a>å•ç‚¹ç™»é™†ç³»ç»Ÿ â€“CAS</h2><ul><li>å…³äºCASçš„ä»‹ç»ç½‘ä¸Šéƒ½æœ‰ã€‚è¿™é‡Œä¸»è¦è®°å½•å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚ä½•é…ç½®å’Œé›†æˆä¸€äº›æ¡†æ¶ã€‚</li><li>CASæ¶æ„å›¾<br><img alt="OSS" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/CAS.PNG" src="/img/loading.gif" class="lazyload"><br>CAS çš„ SSO å®ç°æ–¹å¼å¯ç®€åŒ–ç†è§£ä¸ºï¼š 1 ä¸ª Cookie å’Œ N ä¸ª Session ã€‚ CAS Server åˆ›å»º cookieï¼Œåœ¨æ‰€æœ‰åº”ç”¨è®¤è¯æ—¶ä½¿ç”¨ï¼Œå„åº”ç”¨é€šè¿‡åˆ›å»ºå„è‡ªçš„ Session æ¥æ ‡è¯†ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ã€‚<br>ç”¨ æˆ·åœ¨ä¸€ä¸ªåº”ç”¨éªŒè¯é€šè¿‡åï¼Œä»¥åç”¨æˆ·åœ¨åŒä¸€æµè§ˆå™¨é‡Œè®¿é—®æ­¤åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ä¸­çš„è¿‡æ»¤å™¨ä¼šåœ¨ session é‡Œè¯»å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥å°±ä¸ä¼šå» CAS Server è®¤è¯ã€‚å¦‚æœåœ¨æ­¤æµè§ˆå™¨é‡Œè®¿é—®åˆ«çš„ web åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ä¸­çš„è¿‡æ»¤å™¨åœ¨ session é‡Œè¯»å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ä¼šå» CAS Server çš„ login æ¥å£è®¤è¯ï¼Œä½†è¿™æ—¶CAS Server ä¼šè¯»å–åˆ°æµè§ˆå™¨ä¼ æ¥çš„ cookie ï¼ˆ TGC ï¼‰ï¼Œæ‰€ä»¥ CAS Server ä¸ä¼šè¦æ±‚ç”¨æˆ·å»ç™»å½•é¡µé¢ç™»å½•ï¼Œåªæ˜¯ä¼šæ ¹æ® service å‚æ•°ç”Ÿæˆä¸€ä¸ª Ticket ï¼Œç„¶åå†å’Œ web åº”ç”¨åšä¸€ä¸ªéªŒ è¯ ticket çš„äº¤äº’è€Œå·²ã€‚</li></ul><h3 id="1-é…ç½®CASæœåŠ¡ç«¯"><a href="#1-é…ç½®CASæœåŠ¡ç«¯" class="headerlink" title="1. é…ç½®CASæœåŠ¡ç«¯"></a>1. é…ç½®CASæœåŠ¡ç«¯</h3><p>ä»ä¸Šé¢çš„æ¶æ„å›¾ä¹Ÿå¯ä»¥å¤§æ¦‚çŸ¥é“CASè¿ä½œçš„æ–¹å¼,é¦–å…ˆé…ç½®å¥½CASçš„Serverç«¯ï¼Œç›´æ¥å°†CASçš„waråŒ…æ‹·åˆ°tomcatçš„webappç›®å½•ä¸‹ç„¶åå¯åŠ¨tomcatè‡ªåŠ¨è§£å‹å°±å¯ä»¥äº†ï¼Œè¿™é‡Œæˆ‘è®¾ç½®çš„tomcatçš„ç«¯å£æ˜¯8888ï¼Œåœ°å€æ è¾“å…¥localhost:8888/casèƒ½çœ‹åˆ°CASçš„ç™»é™†ç•Œé¢è¯´æ˜éƒ¨ç½²æˆåŠŸ</p><ul><li><p>å»é™¤https<br> CASé»˜è®¤ä½¿ç”¨çš„æ˜¯HTTPSåè®®ï¼Œå¦‚æœä½¿ç”¨HTTPSåè®®éœ€è¦SSLå®‰å…¨è¯ä¹¦ï¼ˆéœ€å‘ç‰¹å®šçš„æœºæ„ç”³è¯·å’Œè´­ä¹°ï¼‰ ã€‚å¦‚æœå¯¹å®‰å…¨è¦æ±‚ä¸é«˜æˆ–æ˜¯åœ¨å¼€å‘æµ‹è¯•é˜¶æ®µï¼Œå¯ä½¿ç”¨HTTPåè®®ã€‚æˆ‘ä»¬è¿™é‡Œè®²è§£é€šè¿‡ä¿®æ”¹é…ç½®ï¼Œè®©CASä½¿ç”¨HTTPåè®®ã€‚</p><ul><li><p>ä¿®æ”¹casçš„WEB-INF/deployerConfigContext.xmlæ‰¾åˆ°ä¸‹é¢çš„é…ç½®<br><bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler" p:httpclient-ref="httpClient"><br>è¿™é‡Œéœ€è¦å¢åŠ å‚æ•°p:requireSecure=â€falseâ€ï¼ŒrequireSecureå±æ€§æ„æ€ä¸ºæ˜¯å¦éœ€è¦å®‰å…¨éªŒè¯ï¼Œå³HTTPSï¼Œfalseä¸ºä¸é‡‡ç”¨</bean></p><ul><li><p>ä¿®æ”¹casçš„/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml<br>æ‰¾åˆ°ä¸‹é¢é…ç½®<br><bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator" p:cookiesecure="true" p:cookiemaxage="-1" p:cookiename="CASTGC" p:cookiepath="/cas"></bean></p></li><li><p>å‚æ•°p:cookieSecure=â€trueâ€ï¼ŒåŒç†ä¸ºHTTPSéªŒè¯ç›¸å…³ï¼ŒTRUEä¸ºé‡‡ç”¨HTTPSéªŒè¯ï¼ŒFALSEä¸ºä¸é‡‡ç”¨httpséªŒè¯ã€‚<br>å‚æ•°p:cookieMaxAge=â€-1â€ï¼Œæ˜¯COOKIEçš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œ-1ä¸ºæ— ç”Ÿå‘½å‘¨æœŸï¼Œå³åªåœ¨å½“å‰æ‰“å¼€çš„çª—å£æœ‰æ•ˆï¼Œå…³é—­æˆ–é‡æ–°æ‰“å¼€å…¶å®ƒçª—å£ï¼Œä»ä¼šè¦æ±‚éªŒè¯ã€‚å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ä¸ºå¤§äº0çš„æ•°å­—ï¼Œæ¯”å¦‚3600ç­‰ï¼Œæ„æ€æ˜¯åœ¨3600ç§’å†…ï¼Œæ‰“å¼€ä»»æ„çª—å£ï¼Œéƒ½ä¸éœ€è¦éªŒè¯ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œå°†cookieSecureæ”¹ä¸ºfalse , cookieMaxAge æ”¹ä¸º3600</p></li></ul></li></ul><ul><li>ä¿®æ”¹casçš„WEB-INF/spring-configuration/warnCookieGenerator.xml<br>   <bean id="warnCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator" p:cookiesecure="true" p:cookiemaxage="-1" p:cookiename="CASPRIVACY" p:cookiepath="/cas"><br>æˆ‘ä»¬è¿™é‡Œå°†cookieSecureæ”¹ä¸ºfalse , cookieMaxAge æ”¹ä¸º3600</bean></li></ul></li></ul><ul><li><p>é…ç½®æ•°æ®æº</p><ul><li><p>casæœ‰é»˜è®¤çš„å¯†ç ä½†æ˜¯å®é™…ä¸­è‚¯å®šæ˜¯è¦ä»æ•°æ®åº“ä¸­æŸ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½®ä¸‹æ•°æ®æº</p></li><li><p>ä¿®æ”¹casæœåŠ¡ç«¯ä¸­web-infä¸‹deployerConfigContext.xml ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®</p>   <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><bean id="<span" class="string">"dataSource"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> <br><span class="line"> p:driverClass=<span class="string">"com.mysql.jdbc.Driver"</span></span><br><span class="line"> p:jdbcUrl=<span class="string">"jdbc:mysql://127.0.0.1:3306/pinyougoudb?characterEncoding=utf8"</span></span><br><span class="line"> p:user=<span class="string">"root"</span></span><br><span class="line"> p:password=<span class="string">"123456"</span> /></span><br><span class="line"><bean id="<span" class="string">"passwordEncoder"</bean></span><br><span class="line"><span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.authentication.handler.DefaultPasswordEncoder"</span> </span><br><span class="line"> c:encodingAlgorithm=<span class="string">"MD5"</span></span><br><span class="line"> p:characterEncoding=<span class="string">"UTF-8"</span> /></span><br><span class="line"><bean id="<span" class="string">"dbAuthHandler"</bean></span> <br><span class="line"> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"</span></span><br><span class="line"> p:dataSource-ref=<span class="string">"dataSource"</span></span><br><span class="line"> p:sql=<span class="string">"select password from tb_user where username = ?"</span></span><br><span class="line"> p:passwordEncoder-ref=<span class="string">"passwordEncoder"</span>/></span><br></pre></td></tr></tbody></table></figure></div><ul><li>ç„¶ååœ¨é…ç½®æ–‡ä»¶å¼€å§‹éƒ¨åˆ†æ‰¾åˆ°å¦‚ä¸‹é…ç½®</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"> <bean id="<span" class="string">"authenticationManager"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.authentication.PolicyBasedAuthenticationManager"</span>><br><span class="line">        <constructor-arg></constructor-arg></span><br><span class="line">            <map>               </map></span><br><span class="line">                <entry key-ref="<span" class="string">"proxyAuthenticationHandler"</entry></span> value-ref=<span class="string">"proxyPrincipalResolver"</span> /><br><span class="line">                <entry key-ref="<span" class="string">"primaryAuthenticationHandler"</entry></span> value-ref=<span class="string">"primaryPrincipalResolver"</span> /><br><span class="line">            </span><br><span class="line">              </span><br><span class="line">        <property name="<span" class="string">"authenticationPolicy"</property></span>><br><span class="line">            <bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"org.jasig.cas.authentication.AnyAuthenticationPolicy"</span> /><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p>å…¶ä¸­ <entry key-ref="primaryAuthenticationHandler" value-ref="primaryPrincipalResolver">ä¸€å¥æ˜¯ä½¿ç”¨å›ºå®šçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªbean ,å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“è®¤è¯ç”¨æˆ·åå’Œå¯†ç ï¼Œéœ€è¦å°†è¿™å¥æ³¨é‡Šæ‰ã€‚<br>æ·»åŠ ä¸‹é¢è¿™ä¸€å¥é…ç½®</entry></p><entry key-ref="dbAuthHandler" value-ref="primaryPrincipalResolver">- å°†ä¸‰ä¸ªjaråŒ…åŠ å…¥åˆ°casçš„libç›®å½•ä¸‹![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/casjar.PNG)ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œä¸­é—´çš„é‚£ä¸ªæ˜¯caså¯¹jdbcçš„æ”¯æŒåŒ…</entry></li></ul></li></ul><hr><h3 id="2-æ™®é€šçš„webé¡¹ç›®é›†æˆCAS"><a href="#2-æ™®é€šçš„webé¡¹ç›®é›†æˆCAS" class="headerlink" title="2. æ™®é€šçš„webé¡¹ç›®é›†æˆCAS"></a>2. æ™®é€šçš„webé¡¹ç›®é›†æˆCAS</h3><p> æ™®é€šçš„webé¡¹ç›®ä¹Ÿå°±æ˜¯æ²¡æœ‰ä½¿ç”¨Springä¹‹ç±»çš„æ¡†æ¶è€Œé‡‡ç”¨web.xmlé…ç½®çš„æ™®é€šé¡¹ç›®</p><ul><li>2.1 ä¸ºäº†æ–¹ä¾¿æˆ‘è¿™é‡Œé‡‡ç”¨mavené…ç½®ï¼Œå…ˆæ·»åŠ ç›¸åº”çš„ä¾èµ–</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!-- cas --></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>org.jasig.cas.client</groupid></span><br><span class="line">    <artifactid>cas-client-core</artifactid></span><br><span class="line">    <version>3.3.3</version></span><br><span class="line"></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>javax.servlet</groupid></span><br><span class="line">    <artifactid>servlet-api</artifactid></span><br><span class="line">    <version>2.5</version></span><br><span class="line">    <scope>provided</scope></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€ä¸ªæ˜¯caså®¢æˆ·ç«¯çš„æ ¸å¿ƒåŒ…ï¼Œä¸€ä¸ªæ˜¯servletçš„åŒ…ï¼Œå› ä¸ºåé¢ä¼šå†™ä¸€äº›jsp<br>ç„¶åæ·»åŠ tomcatæ’ä»¶æˆ‘è®¾ç½®çš„ç«¯å£ä¸º9002</p><ul><li><p>2.2 å› ä¸ºæ˜¯æ™®é€šçš„webé¡¹ç›®æ‰€ä»¥é…ç½®çš„æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡web.xmlæ¥é…ç½®ï¼Œç›´æ¥ä¸Šé…ç½®</p>  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><!--?xml version=<span class="string"-->"1.0"</span> encoding=<span class="string">"UTF-8"</span>?><br><span class="line"><web-app xmlns:xsi="<span" class="string">"http://www.w3.org/2001/XMLSchema-instance"</web-app></span><br><span class="line">         xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span><br><span class="line">         version=<span class="string">"2.5"</span>></span><br><span class="line">    <!-- ç”¨äºå•ç‚¹é€€å‡ºï¼Œè¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½® --></span><br><span class="line">    <listener></listener></span><br><span class="line">        <listener-<span class="class"><span class="keyword">class</span>><span class="title">org</span>.<span class="title">jasig</span>.<span class="title">cas</span>.<span class="title">client</span>.<span class="title">session</span>.<span class="title">SingleSignOutHttpSessionListener</span><!--<span class="title"-->listener</listener-<span></span>-<span class="title">class</span>><br><span class="line"><span class="class">    <!--<span class="title"-->listener</span>></span><br><span class="line"><span class="class">    <!-- è¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½®ã€‚ --></span></span><br><span class="line"><span class="class">    <<span class="title">filter</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">CAS</span> <span class="title">Single</span> <span class="title">Sign</span> <span class="title">Out</span> <span class="title">Filter</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">class</span>><span class="title">org</span>.<span class="title">jasig</span>.<span class="title">cas</span>.<span class="title">client</span>.<span class="title">session</span>.<span class="title">SingleSignOutFilter</span><!--<span class="title"-->filter</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>></span><br><span class="line"><span class="class">    <<span class="title">filter</span>-<span class="title">mapping</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">CAS</span> <span class="title">Single</span> <span class="title">Sign</span> <span class="title">Out</span> <span class="title">Filter</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">url</span>-<span class="title">pattern</span>>/* <!--<span class="title"-->url</span>-<span class="title">pattern</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>-<span class="title">mapping</span>></span><br><span class="line"><span class="class">    <!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£ç”¨æˆ·çš„è®¤è¯å·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ --></span></span><br><span class="line"><span class="class">    <<span class="title">filter</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">CASFilter</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">class</span>><span class="title">org</span>.<span class="title">jasig</span>.<span class="title">cas</span>.<span class="title">client</span>.<span class="title">authentication</span>.<span class="title">AuthenticationFilter</span><!--<span class="title"-->filter</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">        <<span class="title">init</span>-<span class="title">param</span>></span></span><br><span class="line"><span class="class">            <<span class="title">param</span>-<span class="title">name</span>><span class="title">casServerLoginUrl</span><!--<span class="title"-->param</span>-<span class="title">name</span>></span><br><span class="line">            <param-value>http://localhost:8888/cas/login</param-value></span><br><span class="line">            <!--è¿™é‡Œçš„serveræ˜¯æœåŠ¡ç«¯çš„IP --></span><br><span class="line">        </span><br><span class="line">        <init-param></init-param></span><br><span class="line">            <param-name>serverName</param-name></span><br><span class="line">            <param-value>http:<span class="comment">//localhost:9002</span></param-value></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <filter-mapping></filter-mapping></span><br><span class="line">        <filter-name>CASFilter</filter-name></span><br><span class="line">        <url-pattern><span class="comment">/*</span></url-pattern></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£å¯¹Ticketçš„æ ¡éªŒå·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ --></span></span><br><span class="line"><span class="comment">    <filter></filter></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Validation Filter</filter-name></span></span><br><span class="line"><span class="comment">        <filter-class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class></span></span><br><span class="line"><span class="comment">        <init-param></init-param></span></span><br><span class="line"><span class="comment">            <param-name>casServerUrlPrefix</param-name></span></span><br><span class="line"><span class="comment">            <param-value>http://localhost:8888/cas</param-value></span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        <init-param></init-param></span></span><br><span class="line"><span class="comment">            <param-name>serverName</param-name></span></span><br><span class="line"><span class="comment">            <param-value>http://localhost:9002</param-value></span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <filter-mapping></filter-mapping></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Validation Filter</filter-name></span></span><br><span class="line"><span class="comment">        <url-pattern>/*</url-pattern></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£å®ç°HttpServletRequestè¯·æ±‚çš„åŒ…è£¹ï¼Œ æ¯”å¦‚å…è®¸å¼€å‘è€…é€šè¿‡HttpServletRequestçš„getRemoteUser()æ–¹æ³•è·å¾—SSOç™»å½•ç”¨æˆ·çš„ç™»å½•åï¼Œå¯é€‰é…ç½®ã€‚ --></span></span><br><span class="line"><span class="comment">    <filter></filter></span></span><br><span class="line"><span class="comment">        <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name></span></span><br><span class="line"><span class="comment">        <filter-class></filter-class></span></span><br><span class="line"><span class="comment">            org.jasig.cas.client.util.*</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <filter-mapping></filter-mapping></span></span><br><span class="line"><span class="comment">        <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name></span></span><br><span class="line"><span class="comment">        <url-pattern>/*</url-pattern></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <!-- è¯¥è¿‡æ»¤å™¨ä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡org.jasig.cas.client.util.AssertionHolderæ¥è·å–ç”¨æˆ·çš„ç™»å½•åã€‚ æ¯”å¦‚AssertionHolder.getAssertion().getPrincipal().getName()ã€‚ --></span></span><br><span class="line"><span class="comment">    <filter></filter></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Assertion Thread Local Filter</filter-name></span></span><br><span class="line"><span class="comment">        <filter-class>org.jasig.cas.client.util.AssertionThreadLocalFilter</filter-class></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    <filter-mapping></filter-mapping></span></span><br><span class="line"><span class="comment">        <filter-name>CAS Assertion Thread Local Filter</filter-name></span></span><br><span class="line"><span class="comment">        <url-pattern>/*</url-pattern></span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></tbody></table></figure></div><ul><li>ç”¨æˆ·è®¤è¯è¿‡æ»¤å™¨(å¿…é€‰)<strong>AuthenticationFilter</strong>åœ¨ä¸Šé¢çš„é…ç½®ä¸­éœ€è¦ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯casServerLoginUrlé¡¾åæ€ä¹‰å°±æ˜¯CASserverç™»é™†çš„åœ°å€ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯<a href="http://localhost:8888/cas/login" target="_blank" rel="noopener">http://localhost:8888/cas/login</a> ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<strong>serverName</strong> ,å› ä¸ºç™»é™†æˆåŠŸåè¿˜æ˜¯è¦è¿”å›ä½ å½“å‰çš„åº”ç”¨æ‰€ä»¥éœ€è¦å°†ä½ å½“å‰çš„åº”ç”¨çš„åœ°å€ä¼ é€’ç»™CASserveræ¯”å¦‚æˆ‘çš„å½“å‰åº”ç”¨ <a href="http://localhost:9002/" target="_blank" rel="noopener">http://localhost:9002/</a></li><li>Ticketçš„æ ¡éªŒè¿‡æ»¤å™¨(å¿…é€‰)<strong>Cas20ProxyReceivingTicketValidationFilter</strong> ä¸ä¸Šé¢çš„è¿‡æ»¤å™¨ç±»ä¼¼ä¹Ÿéœ€è¦é‚£ä¸¤ä¸ªå‚æ•°ï¼Œ                              é…ç½®äº†è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨CASå°±èƒ½æ­£å¸¸è¿è¡Œäº†</li><li>å•ç‚¹ç™»å‡ºè¿‡æ»¤å™¨ <strong>SingleSignOutFilter</strong>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç”¨äºå•ç‚¹ç™»å‡º  </li><li>å¦å¤–è¿˜æœ‰ä¸¤ä¸ªè¿‡æ»¤å™¨éƒ½æ˜¯ä¸ºäº†è·å–ç™»é™†åé…ç½®çš„è¿‡æ»¤å™¨ï¼Œé…ç½®ä¸€ä¸ªå°±è¡Œã€‚<br>#</li></ul></li><li><p>2.3 ç¼–å†™index.jsp(tomcaté»˜è®¤æ‰“å¼€çš„é¡µé¢)</p>  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span></span><br><span class="line">         pageEncoding=<span class="string">"utf-8"</span>%></span><br><span class="line">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <meta http-equiv="<span" class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span>><br><span class="line">    <title>ä¸€å“ä¼˜è´­</title></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> é‡‡ç”¨web.xmlé…ç½®çš„æ™®é€šçš„webæ¨¡å—</span><br><span class="line"><%=request.getRemoteUser()%></span><br><span class="line"> <a href="http://localhost:8888/cas/logout?service=http://www.imlgw.top">é€€å‡ºç™»å½•</a>></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p>   å¦‚æœæƒ³è®©casé€€å‡ºåè·³è½¬åˆ°æŒ‡å®šçš„é¡µé¢è€Œä¸æ˜¯CASé»˜è®¤çš„é¡µé¢ä¹Ÿéœ€è¦ä¿®æ”¹é…ç½®<br>   ä¿®æ”¹casç³»ç»Ÿçš„é…ç½®æ–‡ä»¶cas-servlet.xml<br>   <bean id="logoutAction" class="org.jasig.cas.web.flow.LogoutAction" p:servicesmanager-ref="servicesManager" p:followserviceredirects="${cas.logout.followServiceRedirects:true}"><br>  å°†cas.logout.followServiceRedirectsæ”¹ä¸ºtrueåï¼Œå¯ä»¥åœ¨é€€å‡ºæ—¶è·³è½¬é¡µé¢åˆ°ç›®æ ‡é¡µé¢<br> ç„¶åå°±å¯ä»¥å¯åŠ¨caså’Œä½ çš„åº”ç”¨æ¥æµ‹è¯•äº†ã€‚</bean></p></li><li><p>2.4 æœåŠ¡ç«¯ç•Œé¢æ”¹é€ <br> ä¸Šé¢æµ‹è¯•æˆåŠŸï¼Œä½†æ˜¯çœŸå®çš„æƒ…å†µè‚¯å®šä¸ä¼šç”¨casé»˜è®¤çš„é‚£ä¸ªé¡µé¢åšç™»é™†éœ€è¦æ”¹æˆä½ è‡ªå·±çš„ç™»é™†ç•Œé¢ï¼Œç„¶åä½ å½“å‰åº”ç”¨çš„ç™»é™†é¡µé¢å°±æ²¡ç”¨äº†ã€‚</p>  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><%@ page pageEncoding=<span class="string">"UTF-8"</span> %></span><br><span class="line"><%@ page contentType=<span class="string">"text/html; charset=UTF-8"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"spring"</span> uri=<span class="string">"http://www.springframework.org/tags"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"form"</span> uri=<span class="string">"http://www.springframework.org/tags/form"</span> %></span><br><span class="line"><%@ taglib prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><meta charset="<span" class="string">"UTF-8"</span> /><br><span class="line"><title>Login</title></span><br><span class="line"><link rel="<span" class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">'bs/css/bootstrap.min.css'</span> /><br><span class="line"><script type="text/javascript" src="js/jquery.min.js"></script></span><br><span class="line"><script type="text/javascript" src="bs/js/bootstrap.min.js"></script></span><br><span class="line"><style></span><br><span class="line">img {</span><br><span class="line">height: <span class="number">200</span>px;</span><br><span class="line">border-radius: <span class="number">200</span>px;</span><br><span class="line">}</span><br><span class="line">.panel-title{</span><br><span class="line">text-align: center;</span><br><span class="line">}</span><br><span class="line">.login {</span><br><span class="line">width: <span class="number">500</span>px;</span><br><span class="line">height: <span class="number">400</span>px;</span><br><span class="line">position: absolute;</span><br><span class="line">top: <span class="number">20</span>%;</span><br><span class="line">left: <span class="number">50</span>%;</span><br><span class="line">margin-left: -<span class="number">250</span>px;</span><br><span class="line">}</span><br><span class="line">.sub{</span><br><span class="line">text-align: center;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></style></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"panel panel-primary login"</span>><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"panel-heading"</span>><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"panel-title"</span>><br><span class="line"><img class="string lazyload" data-src="<span" src="/img/loading.gif">"images/login.jpg"</span> /><br><span class="line"></span></div></span><br><span class="line"></span></div></span><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"panel-body"</span>><br><span class="line"><!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">1</span> --></span><br><span class="line"><form:form method="<span" class="string">"post"</form:form></span> id=<span class="string">"fm1"</span> commandName=<span class="string">"${commandName}"</span> htmlEscape=<span class="string">"true"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"sui-form"</span>><br><span class="line"></span><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"form-group"</span>><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"input-group"</span>><br><span class="line"><span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-user"></span></span></span><br><span class="line"><!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">2</span> --></span><br><span class="line"><form:input <span class="class"><span class="keyword">class</span></form:input></span>=<span class="string">"form-control"</span> aria-describedby=<span class="string">"basic-addon1"</span> placeholder=<span class="string">"Username"</span>  id=<span class="string">"username"</span> size=<span class="string">"25"</span> tabindex=<span class="string">"1"</span> accesskey=<span class="string">"${userNameAccessKey}"</span> path=<span class="string">"username"</span> autocomplete=<span class="string">"off"</span> htmlEscape=<span class="string">"true"</span> /><br><span class="line"></span></div></span><br><span class="line"></span></div></span><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"form-group"</span>><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"input-group"</span>><br><span class="line"><span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-lock"></span></span></span><br><span class="line"><!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">3</span> --></span><br><span class="line"><form:password <span class="class"><span class="keyword">class</span></form:password></span>=<span class="string">"form-control"</span> placeholder=<span class="string">"password"</span> aria-describedby=<span class="string">"basic-addon1"</span> id=<span class="string">"password"</span> size=<span class="string">"25"</span> tabindex=<span class="string">"2"</span> path=<span class="string">"password"</span>  accesskey=<span class="string">"${passwordAccessKey}"</span> htmlEscape=<span class="string">"true"</span> autocomplete=<span class="string">"off"</span> /><br><span class="line"></span></div></span><br><span class="line"></span></div></span><br><span class="line"><div <span class="class"><span class="keyword">class</span>=<span class="string">"form-group sub"</span>><br><span class="line"><!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">4</span> ç™»é™†æ¡† --></span><br><span class="line"><input type="<span" class="string">"hidden"</span> name=<span class="string">"lt"</span> value=<span class="string">"${loginTicket}"</span> /><br><span class="line">      <input type="<span" class="string">"hidden"</span> name=<span class="string">"execution"</span> value=<span class="string">"${flowExecutionKey}"</span> /><br><span class="line">      <input type="<span" class="string">"hidden"</span> name=<span class="string">"_eventId"</span> value=<span class="string">"submit"</span> /><br><span class="line">      <input <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn btn-primary btn-lg"</span> name=<span class="string">"submit"</span> accesskey=<span class="string">"l"</span> value=<span class="string">"ç™»é™†"</span> type=<span class="string">"submit"</span> /><br><span class="line">      <!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ <span class="number">4</span> é”™è¯¯æç¤ºæ¡† --></span><br><span class="line">      <form:errors path="<span" class="string">"*"</form:errors></span> id=<span class="string">"msg"</span> cssClass=<span class="string">"errors"</span> element=<span class="string">"div"</span> htmlEscape=<span class="string">"false"</span> /><br><span class="line"></span></div></span><br><span class="line"></span><br><span class="line"></span></div></span><br><span class="line"></span></div></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p>  å¯ä»¥ç›´æ¥å°†ç™»é™†çš„é¡µé¢æ‹·è¿‡æ¥ç„¶ååŠ ä¸ŠæŒ‡ä»¤å†æ ¹æ®casçš„ç™»é™†é¡µé¢ç¨åŠ ä¿®æ”¹å°±å¯ä»¥äº†</p></li></ul><hr><h3 id="3-Springé¡¹ç›®é›†æˆCASå’ŒSpring-security"><a href="#3-Springé¡¹ç›®é›†æˆCASå’ŒSpring-security" class="headerlink" title="3. Springé¡¹ç›®é›†æˆCASå’ŒSpring-security"></a>3. Springé¡¹ç›®é›†æˆCASå’ŒSpring-security</h3><ul><li><p>pomä¾èµ–</p>  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><properties></properties></span><br><span class="line">        <spring.version>4.2.0.RELEASE</spring.version></span><br><span class="line">    </span><br><span class="line">    <dependencies></dependencies></span><br><span class="line">        <!-- Spring --></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-context</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-beans</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-webmvc</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-jdbc</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-aspects</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-jms</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework</groupid></span><br><span class="line">            <artifactid>spring-context-support</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <!--spring-security--></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework.security</groupid></span><br><span class="line">            <artifactid>spring-security-web</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework.security</groupid></span><br><span class="line">            <artifactid>spring-security-config</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>javax.servlet</groupid></span><br><span class="line">            <artifactid>javax.servlet-api</artifactid></span><br><span class="line">            <version>3.1.0</version></span><br><span class="line">            <scope>provided</scope></span><br><span class="line">        </span><br><span class="line">        <!--é›†æˆåŒ…--></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.springframework.security</groupid></span><br><span class="line">            <artifactid>spring-security-cas</artifactid></span><br><span class="line">            <version>${spring.version}</version></span><br><span class="line">        </span><br><span class="line">        <!--cas--></span><br><span class="line">        <dependency></dependency></span><br><span class="line">            <groupid>org.jasig.cas.client</groupid></span><br><span class="line">            <artifactid>cas-client-core</artifactid></span><br><span class="line">            <version>3.3.3</version></span><br><span class="line">            <exclusions></exclusions></span><br><span class="line">                <exclusion></exclusion></span><br><span class="line">                    <groupid>org.slf4j</groupid></span><br><span class="line">                    <artifactid>log4j-over-slf4j</artifactid></span><br><span class="line">                </span><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure></div><p>  æ·»åŠ tomcatæ’ä»¶æŒ‡å®šç«¯å£ä¸º9001</p></li><li><p>web.xmlé…ç½®</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><!--?xml version=<span class="string"-->"1.0"</span> encoding=<span class="string">"UTF-8"</span>?><br><span class="line"><web-app xmlns:xsi="<span" class="string">"http://www.w3.org/2001/XMLSchema-instance"</web-app></span><br><span class="line">         xmlns=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span><br><span class="line">         version=<span class="string">"2.5"</span>></span><br><span class="line"></span><br><span class="line">    <context-param></context-param></span><br><span class="line">        <param-name>contextConfigLocation</param-name></span><br><span class="line">        <param-value>classpath:spring/spring-*.xml</param-value></span><br><span class="line">    </span><br><span class="line">    <listener></listener></span><br><span class="line">        <listener-<span class="class"><span class="keyword">class</span>></listener-<span></span><br><span class="line"><span class="class">            <span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">context</span>.<span class="title">ContextLoaderListener</span></span></span><br><span class="line"><span class="class">        <!--<span class="title"-->listener</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->listener</span>></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <<span class="title">filter</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">springSecurityFilterChain</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">class</span>><span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">filter</span>.<span class="title">DelegatingFilterProxy</span><!--<span class="title"-->filter</span>-<span class="title">class</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>></span><br><span class="line"><span class="class">    <<span class="title">filter</span>-<span class="title">mapping</span>></span></span><br><span class="line"><span class="class">        <<span class="title">filter</span>-<span class="title">name</span>><span class="title">springSecurityFilterChain</span><!--<span class="title"-->filter</span>-<span class="title">name</span>></span><br><span class="line"><span class="class">        <<span class="title">url</span>-<span class="title">pattern</span>>/*<!--<span class="title"-->url</span>-<span class="title">pattern</span>></span><br><span class="line"><span class="class">    <!--<span class="title"-->filter</span>-<span class="title">mapping</span>></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><!--<span class="title"-->web</span>-<span class="title">app</span>></span><br></pre></td></tr></tbody></table></figure></div><p>ä¸»è¦é…ç½®Springå®¹å™¨å’ŒSpring-securityçš„è¿‡æ»¤å™¨</p></li></ul><ul><li>spring-security.xmlé…ç½®<br>å…¶å®å°±æ˜¯æŠŠä¹‹å‰é…ç½®åœ¨web.xmlé‡Œé¢çš„è¿‡æ»¤å™¨é‡‡ç”¨Springçš„æ–¹å¼é…ç½®å‡ºæ¥</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!--?xml version=<span class="string"-->"1.0"</span> encoding=<span class="string">"UTF-8"</span>?><br><span class="line"><beans:beans xmlns="<span" class="string">"http://www.springframework.org/schema/security"</beans:beans></span><br><span class="line">             xmlns:beans=<span class="string">"http://www.springframework.org/schema/beans"</span> xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">             xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd"</span>></span><br><span class="line"></span><br><span class="line">    <http pattern="/out.html" security="none"></http></span><br><span class="line">    <!--   entry-point-ref  å…¥å£ç‚¹å¼•ç”¨ å› ä¸ºç™»é™†äº¤ç»™casæˆ–è€…å…¶ä»–çš„ç™»é™†ç³»ç»Ÿ,å°±ä¸ä¼šåœ¨æœ¬ç³»ç»Ÿåšç™»é™†éœ€è¦æŒ‡å®šç™»é™†ç‚¹--></span><br><span class="line">    <http use-expressions="<span" class="string">"false"</http></span> entry-point-ref=<span class="string">"casProcessingFilterEntryPoint"</span>><br><span class="line">        <intercept-url pattern="<span" class="string">"/**"</intercept-url></span> access=<span class="string">"ROLE_USER"</span>/><br><span class="line">        <csrf disabled="<span" class="string">"true"</csrf></span>/><br><span class="line">        <!-- custom-filterä¸ºè¿‡æ»¤å™¨ï¼Œ position è¡¨ç¤ºå°†è¿‡æ»¤å™¨æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šï¼Œbeforeè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šä½ç½®ä¹‹å‰  ï¼Œafterè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¹‹å  --></span><br><span class="line">        <custom-filter ref="<span" class="string">"casAuthenticationFilter"</custom-filter></span>  position=<span class="string">"CAS_FILTER"</span> /><br><span class="line">        <custom-filter ref="<span" class="string">"requestSingleLogoutFilter"</custom-filter></span> before=<span class="string">"LOGOUT_FILTER"</span>/><br><span class="line">        <custom-filter ref="<span" class="string">"singleLogoutFilter"</custom-filter></span> before=<span class="string">"CAS_FILTER"</span>/><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <!-- CASå…¥å£ç‚¹ å¼€å§‹ --></span><br><span class="line">    <beans:bean id="<span" class="string">"casProcessingFilterEntryPoint"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.web.CasAuthenticationEntryPoint"</span>><br><span class="line">        <!-- å•ç‚¹ç™»å½•æœåŠ¡å™¨ç™»å½•URL --></span><br><span class="line">        <beans:property name="<span" class="string">"loginUrl"</beans:property></span> value=<span class="string">"http://localhost:8888/cas/login"</span>/><br><span class="line">        <beans:property name="<span" class="string">"serviceProperties"</beans:property></span> ref=<span class="string">"serviceProperties"</span>/><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <beans:bean id="<span" class="string">"serviceProperties"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.ServiceProperties"</span>><br><span class="line">        <!--service é…ç½®è‡ªèº«å·¥ç¨‹çš„æ ¹åœ°å€+/login/cas   --></span><br><span class="line">        <beans:property name="<span" class="string">"service"</beans:property></span> value=<span class="string">"http://localhost:9001/login/cas"</span>/><br><span class="line">    </span><br><span class="line">    <!-- CASå…¥å£ç‚¹ ç»“æŸ --></span><br><span class="line">    <!-- è®¤è¯è¿‡æ»¤å™¨ å¼€å§‹ --></span><br><span class="line">    <beans:bean id="<span" class="string">"casAuthenticationFilter"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.web.CasAuthenticationFilter"</span>><br><span class="line">        <beans:property name="<span" class="string">"authenticationManager"</beans:property></span> ref=<span class="string">"authenticationManager"</span>/><br><span class="line">    </span><br><span class="line">    <!-- è®¤è¯ç®¡ç†å™¨ --></span><br><span class="line">    <authentication-manager alias="<span" class="string">"authenticationManager"</authentication-manager></span>><br><span class="line">        <authentication-provider ref="<span" class="string">"casAuthenticationProvider"</authentication-provider></span>><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <!-- è®¤è¯æä¾›è€… --></span><br><span class="line">    <beans:bean id="<span" class="string">"casAuthenticationProvider"</beans:bean></span>     <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.cas.authentication.CasAuthenticationProvider"</span>><br><span class="line">        <beans:property name="<span" class="string">"authenticationUserDetailsService"</beans:property></span>><br><span class="line">            <beans:bean <span class="class"><span class="keyword">class</span></beans:bean></span>=<span class="string">"org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper"</span>><br><span class="line">                <beans:constructor-arg ref="<span" class="string">"userDetailsService"</beans:constructor-arg></span> /><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">        <beans:property name="<span" class="string">"serviceProperties"</beans:property></span> ref=<span class="string">"serviceProperties"</span>/><br><span class="line">        <!-- ticketValidator ä¸ºç¥¨æ®éªŒè¯å™¨ --></span><br><span class="line">        <beans:property name="<span" class="string">"ticketValidator"</beans:property></span>><br><span class="line">            <beans:bean <span class="class"><span class="keyword">class</span></beans:bean></span>=<span class="string">"org.jasig.cas.client.validation.Cas20ServiceTicketValidator"</span>><br><span class="line">                <beans:constructor-arg index="<span" class="string">"0"</beans:constructor-arg></span> value=<span class="string">"http://localhost:8888/cas"</span>/><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">        <beans:property name="<span" class="string">"key"</beans:property></span> value=<span class="string">"an_id_for_this_auth_provider_only"</span>/><br><span class="line">    </span><br><span class="line">    <!-- è®¤è¯ç±» --></span><br><span class="line">    <beans:bean id="<span" class="string">"userDetailsService"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"top.imlgw.demo.UserDetailServiceImpl"</span>/><br><span class="line"></span><br><span class="line">    <!-- è®¤è¯è¿‡æ»¤å™¨ ç»“æŸ --></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <!-- å•ç‚¹ç™»å‡º  å¼€å§‹  --></span><br><span class="line">    <beans:bean id="<span" class="string">"singleLogoutFilter"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.jasig.cas.client.session.SingleSignOutFilter"</span>/><br><span class="line">    <!--å…³è”ä¸¤ä¸ªåœ°å€ï¼Œç›¸å½“äºå°è£…äº†å‰é¢çš„åœ°å€--></span><br><span class="line">    <beans:bean id="<span" class="string">"requestSingleLogoutFilter"</beans:bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.security.web.authentication.logout.LogoutFilter"</span>><br><span class="line">        <beans:constructor-arg value="<span" class="string">"http://localhost:8888/cas/logout?service=http://localhost:9001/out.html"</beans:constructor-arg></span>/><br><span class="line">        <beans:constructor-arg></beans:constructor-arg></span><br><span class="line">            <beans:bean <span class="class"><span class="keyword">class</span></beans:bean></span>=<span class="string">"org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler"</span>/><br><span class="line">        </span><br><span class="line">        <beans:property name="<span" class="string">"filterProcessesUrl"</beans:property></span> value=<span class="string">"/logout/cas"</span>/><br><span class="line">    </span><br><span class="line">    <!-- å•ç‚¹ç™»å‡º  ç»“æŸ --></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><ul><li><p>userDetailsServiceç¼–å†™<br>è¿™æ˜¯ä¸€ä¸ªè®¤è¯ç±»æ˜¯å±äºSpring-securityçš„ï¼Œå¦‚æœä¸ä½¿ç”¨CASé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯ç”¨æ¥éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®æ˜¯å¦æ”¾è¡Œçš„ã€‚ä½†æ˜¯æ•´åˆäº†CASåå°±ä¸ç”¨åœ¨é‡Œé¢åšè®¤è¯äº†ï¼Œåªæ˜¯ä¸ºäº†è¿”å›åé¢çš„è§’è‰²é›†åˆã€‚</p>  <div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.imlgw.demo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDetailServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>{</span><br><span class="line">        System.out.println(<span class="string">"ç»è¿‡è®¤è¯ç±»"</span>);</span><br><span class="line">        List<grantedauthority> authorities=<span class="keyword">new</span> ArrayList();</grantedauthority></span><br><span class="line">        <span class="comment">//æœ€å¼€å§‹æŠŠè¿™é‡Œçš„roleå†™é”™äº†ï¼Œç„¶åcasç™»é™†æˆåŠŸåä¹Ÿä¸€ç›´è¢«403 forbidï¼Œå› ä¸ºSpringSecurityè®¤è¯æ²¡é€šè¿‡ï¼Œä¸€ç›´æ²¡æ”¾è¡Œ</span></span><br><span class="line">        authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">"ROLE_USER"</span>));</span><br><span class="line">        <span class="comment">//ä¸é€šè¿‡æœ¬é¡¹ç›®åšç™»é™† æ‰€ä»¥å¯†ç æ— æ‰€è°“ï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™å°±å·²ç»ç™»é™†æˆåŠŸäº†</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(username,<span class="string">""</span>,authorities);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></li></ul><hr><h3 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4. æµ‹è¯•"></a>4. æµ‹è¯•</h3><p>å¯åŠ¨æ­å»ºå¥½çš„ä¸¤ä¸ªæœåŠ¡å™¨ï¼Œå’ŒcasServerï¼Œç„¶åæµ‹è¯•åœ¨ä¸€ä¸ªåº”ç”¨ç™»é™†åå¦ä¸€ä¸ªèƒ½å¦è¿›å…¥indexé¡µé¢ â€¦..</p><hr><p>SpringBooté›†æˆCASå’ŒSpring-securityçš„åé¢å†è¡¥å……ï¼Œå› ä¸ºSpringBootè¿˜ä¸å¤ªç†Ÿæ‚‰ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CAS </tag>
            
            <tag> SSO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€é“LeetCodeå¼•å‘çš„æƒ¨æ¡ˆ</title>
      <link href="/2018/10/31/yi-dao-leetcode-yin-fa-de-can-an/"/>
      <url>/2018/10/31/yi-dao-leetcode-yin-fa-de-can-an/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="ä¸€é“LeetCodeæœç´¢é¢˜å¼•å‘çš„æƒ¨æ¡ˆ"><a href="#ä¸€é“LeetCodeæœç´¢é¢˜å¼•å‘çš„æƒ¨æ¡ˆ" class="headerlink" title="ä¸€é“LeetCodeæœç´¢é¢˜å¼•å‘çš„æƒ¨æ¡ˆ"></a>ä¸€é“LeetCodeæœç´¢é¢˜å¼•å‘çš„æƒ¨æ¡ˆ</h2><h3 id="1-å…ˆä¸Š-é¢˜ç›®"><a href="#1-å…ˆä¸Š-é¢˜ç›®" class="headerlink" title="1.å…ˆä¸Š é¢˜ç›®"></a>1.å…ˆä¸Š <a href="https://leetcode-cn.com/problems/word-ladder/" target="_blank" rel="noopener">é¢˜ç›®</a></h3><p>ç»™å®šä¸¤ä¸ªå•è¯ï¼ˆ<em>beginWord _å’Œ _endWord_ï¼‰å’Œä¸€ä¸ªå­—å…¸ï¼Œæ‰¾åˆ°ä» _beginWord</em> åˆ° <em>endWord</em> çš„æœ€çŸ­è½¬æ¢åºåˆ—çš„é•¿åº¦ã€‚è½¬æ¢éœ€éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š</p><ol><li>æ¯æ¬¡è½¬æ¢åªèƒ½æ”¹å˜ä¸€ä¸ªå­—æ¯ã€‚</li><li>è½¬æ¢è¿‡ç¨‹ä¸­çš„ä¸­é—´å•è¯å¿…é¡»æ˜¯å­—å…¸ä¸­çš„å•è¯ã€‚<br><a href="https://leetcode-cn.com/problems/word-ladder/" target="_blank" rel="noopener">åŸé¢˜é“¾æ¥</a><br><img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/3V6EQ77R_%28%292SCR%248R%5B%245F7.png" src="/img/loading.gif" class="lazyload">)å…¶å®è¿™é¢˜æ˜æ˜¾æ˜¯BFS(å¹¿æœ) é¢˜ç›®ç±»å‹ä¹Ÿè¯´äº†æ˜¯å¹¿æœï¼Œä½†æ˜¯æˆ‘ä¸ä¿¡é‚ªå†™äº†DFS(æ¯•ç«Ÿä»£ç æ¯”è¾ƒå¥½å†™)ï¼Œç„¶åæƒ¨æ¡ˆå°±å‘ç”Ÿäº†ã€‚</li></ol><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="comment">// æ ‡è®°æ•°ç»„</span></span><br><span class="line"><span class="comment">// é»˜è®¤éƒ½æ˜¯0</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] mark;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">ladderLength</span><span class="params">(String beginWord, String endWord, List<string> wordList)</string></span> </span>{</span><br><span class="line"><span class="comment">// ä¸å­˜åœ¨</span></span><br><span class="line">mark = <span class="keyword">new</span> <span class="keyword">int</span>[wordList.size() + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!wordList.contains(endWord)) {</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// dfså¼€å§‹</span></span><br><span class="line">dfs(beginWord, endWord, wordList);</span><br><span class="line"><span class="comment">// æ— æ³•è½¬æ¢</span></span><br><span class="line"><span class="keyword">if</span> (min == Integer.MAX_VALUE) {</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> min + <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> min = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dfs</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(String beginWord, String endWord, List<string> wordList)</string></span> </span>{</span><br><span class="line"><span class="comment">//å½“ç›¸ç­‰çš„æ—¶å€™</span></span><br><span class="line"><span class="keyword">if</span> (beginWord.equals(endWord)) {</span><br><span class="line"><span class="keyword">int</span> step = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < mark.length; i++) {</span><br><span class="line"><span class="keyword">if</span> (mark[i] == <span class="number">1</span>) {</span><br><span class="line">step++;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="comment">//æ›´æ–°æœ€å°å€¼</span></span><br><span class="line">min = step < min ? step : min;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < wordList.size(); i++) {</span><br><span class="line"><span class="keyword">if</span> (mark[i] == <span class="number">0</span> && cmp(beginWord, wordList.get(i))) {</span><br><span class="line">mark[i] = <span class="number">1</span>;</span><br><span class="line">dfs(wordList.get(i), endWord, wordList);</span><br><span class="line">mark[i] = <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">cmp</span><span class="params">(String s1, String s2)</span> </span>{</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < s1.length(); i++) {</span><br><span class="line"><span class="keyword">if</span> (s1.charAt(i) != s2.charAt(i)) {</span><br><span class="line">count++;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> count == <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç»“æœç›´æ¥TLEäº†ï¼Œåæ¥æƒ³äº†æƒ³DFSæ¯æ¬¡éƒ½ä¼š<strong>å°è¯•</strong>æ‰€æœ‰æƒ…å†µï¼Œè€Œç»™çš„ä¾‹å­åé¢çš„æ•°æ®é‡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œè€Œä¸”è¿™é¢˜æ˜¯è¦ç»Ÿè®¡æœ€çŸ­è·¯å¾„ï¼Œè¦å…¨éƒ¨é€’å½’å®Œæ‰èƒ½ç¡®å®šæœ€å°å€¼ï¼Œæˆ‘æŠŠæ•°æ®æ‹¿æ¥è‡ªå·±æµ‹è¯•è·‘äº†å¥½é•¿æ—¶é—´éƒ½æ²¡è·‘å‡ºæ¥ï¼Œè€ŒBFSæ²¡æœ‰é€’å½’åªæ˜¯ä¼šè€—è´¹çš„ç©ºé—´ä¼šæ¯”è¾ƒå¤§ã€‚ä»è¿™é‡Œä¹Ÿå¯ä»¥æ€»ç»“å‡ºæ¥DFSè·Ÿé€‚åˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ˜¯å¦å¯è¾¾ä¹‹ç±»çš„é—®é¢˜ï¼ŒBFSæ›´é€‚åˆåšæ‰¾æœ€çŸ­æœ€å°ä¹‹ç±»çš„é—®é¢˜ã€‚ä¸ŠBFSä»£ç </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ ‡è®°æ•°ç»„</span></span><br><span class="line"><span class="comment">// é»˜è®¤éƒ½æ˜¯0</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] mark;</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿé˜Ÿåˆ—</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Que</span> </span>{</span><br><span class="line">String word;</span><br><span class="line"><span class="keyword">int</span> step;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//BFS</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">ladderLengthBFS</span><span class="params">(String beginWord, String endWord, List<string> wordList)</string></span></span>{</span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨</span></span><br><span class="line">mark = <span class="keyword">new</span> <span class="keyword">int</span>[wordList.size() + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!wordList.contains(endWord)) {</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// BFS</span></span><br><span class="line"><span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é˜Ÿåˆ—</span></span><br><span class="line">Que[] que = <span class="keyword">new</span> Que[wordList.size() + <span class="number">1</span>];</span><br><span class="line"><span class="comment">// å¾ªç¯ä¿ƒä½¿è¯è¿°ç¥–</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < que.length; i++) {</span><br><span class="line">que[i] = <span class="keyword">new</span> Que();</span><br><span class="line">}</span><br><span class="line">que[tail].word = beginWord;</span><br><span class="line">que[tail].word = beginWord;</span><br><span class="line">que[tail].step = <span class="number">1</span>;</span><br><span class="line">tail++;</span><br><span class="line"><span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (head < tail) {</span><br><span class="line"><span class="comment">// éå†å­—å…¸</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < wordList.size(); i++) {</span><br><span class="line"><span class="keyword">if</span> (mark[i] == <span class="number">0</span> && cmp(wordList.get(i), que[head].word)) {</span><br><span class="line">que[tail].word = wordList.get(i);</span><br><span class="line"><span class="comment">//è¿™é‡Œæ˜¯ä»headå¼€å§‹çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯headçš„æ­¥æ•°+1</span></span><br><span class="line">que[tail].step=que[head].step+<span class="number">1</span>;</span><br><span class="line"><span class="comment">// æ ‡è®°ä¸ºå·²ç»èµ°è¿‡</span></span><br><span class="line">mark[i] = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">if</span> (que[tail].word.equals(endWord)) {</span><br><span class="line"><span class="comment">//åˆ°è¿™é‡Œè¯´æ˜å·²ç»åˆ°ç»ˆç‚¹äº†ï¼Œè€Œä¸”æ˜¯æœ€çŸ­çš„ï¼Œä¹‹åçš„æœ€å¤šå°±æ˜¯ç›¸ç­‰</span></span><br><span class="line"><span class="comment">//è·³å‡ºå¾ªç¯</span></span><br><span class="line">                       flag=<span class="number">1</span>;</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">                    tail++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line">            <span class="keyword">if</span>(flag==<span class="number">1</span>){</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"><span class="comment">// æ¯æ¬¡æ£€æŸ¥å®Œä¸€ä¸ªå•è¯å°±å°†å…¶å‡ºé˜Ÿåˆ—</span></span><br><span class="line">head++;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> que[tail].step;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ²¡åƒæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">cmp</span><span class="params">(String s1, String s2)</span> </span>{</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < s1.length(); i++) {</span><br><span class="line"><span class="keyword">if</span> (s1.charAt(i) != s2.charAt(i)) {</span><br><span class="line">count++;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> count == <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>PSï¼šåˆšåˆšä¿®æ”¹äº†ä¸‹ä»£ç ï¼Œæˆ‘ä¹Ÿä½©æœè‡ªå·±BFSéƒ½è¿˜æ²¡ææ¸…æ¥šå°±ç›´æ¥ä¸Šäº†ä»£ç ï¼Œç„¶åç»“æœå±…ç„¶è¿˜æ˜¯å¯¹çš„ï¼Œä¹‹å‰åœ¨ifåˆ¤æ–­é˜Ÿå°¾å…ƒç´ æ˜¯ä¸æ˜¯å’ŒendWordç›¸ç­‰åè¿˜ç»´æŠ¤äº†ä¸€ä¸ªæœ€å°å€¼minï¼Œåæ¥æƒ³äº†æƒ³ä¸å¯¹ï¼Œæœ€åä¸€ä¸ªå’ŒendWordç›¸ç­‰çš„å…ƒç´ å·²ç»è¿›æ ˆäº†ï¼Œå·²ç»æ˜¯æœ€çŸ­çš„äº†ï¼Œåé¢çš„å³ä½¿å¯ä»¥è½¬æ¢åˆ°ä¹Ÿæœ€å¤šåªèƒ½å’Œå½“å‰çš„ç›¸ç­‰äº†ã€‚ å¦‚æœåªæ˜¯ä¸ºäº†ç»Ÿè®¡æœ€å°å€¼å°±å¯ä»¥ç›´æ¥breakäº†ã€‚é‚£å¦‚æœä¸ä»…ä»…è¦ç»Ÿè®¡æœ€å°å€¼è¿˜è¦è®°å½•è·¯å¾„è¦æ€ä¹ˆæï¼Ÿ</p><h3 id="2-åŠ å¼ºç‰ˆ-å•è¯æ¥é¾™-2"><a href="#2-åŠ å¼ºç‰ˆ-å•è¯æ¥é¾™-2" class="headerlink" title="2. åŠ å¼ºç‰ˆ å•è¯æ¥é¾™ 2"></a>2. <a href="https://leetcode-cn.com/problems/word-ladder-ii/" target="_blank" rel="noopener">åŠ å¼ºç‰ˆ</a> å•è¯æ¥é¾™ 2</h3><p>æ˜¯ä¸€é“å›°éš¾ç­‰çº§çš„é¢˜ï¼Œéœ€è¦åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šæ‰¾å‡ºæ‰€æœ‰çš„æœ€çŸ­çš„è·¯å¾„ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// å†…éƒ¨ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Que</span> </span>{</span><br><span class="line">String word;</span><br><span class="line"><span class="keyword">int</span> step;</span><br><span class="line">Que prev;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>{</span><br><span class="line"><span class="keyword">return</span> (word + <span class="string">":"</span> + step);</span><br><span class="line">} </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">private</span>  List<list<string>> res=<span class="keyword">new</span> ArrayList<>();</list<string></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//BFS</span></span><br><span class="line"><span class="keyword">public</span> List<list<string>> ladderLengthBFS(String beginWord, String endWord, List<string> wordList){</string></list<string></span><br><span class="line">        <span class="comment">//è¿”å›å€¼</span></span><br><span class="line"><span class="comment">//List<list<string>> res=new ArrayList<>();</list<string></span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨</span></span><br><span class="line">mark = <span class="keyword">new</span> <span class="keyword">int</span>[wordList.size() + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!wordList.contains(endWord)) {</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// BFS</span></span><br><span class="line"><span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é˜Ÿåˆ—</span></span><br><span class="line">Que[] que = <span class="keyword">new</span> Que[wordList.size() + <span class="number">1</span>];</span><br><span class="line"><span class="comment">// å¾ªç¯ä¿ƒä½¿è¯è¿°ç¥–</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < que.length; i++) {</span><br><span class="line">que[i] = <span class="keyword">new</span> Que();</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å…ˆæŠŠç¬¬ä¸€ä¸ªå•è¯æ”¾è¿›å»</span></span><br><span class="line">que[tail].word = beginWord;</span><br><span class="line">que[tail].word = beginWord;</span><br><span class="line">que[tail].step = <span class="number">1</span>;</span><br><span class="line">tail++;</span><br><span class="line">List<que> quelist=<span class="keyword">new</span> ArrayList<>();</que></span><br><span class="line"><span class="keyword">while</span> (head < tail) {</span><br><span class="line"><span class="comment">// éå†å­—å…¸</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < wordList.size(); i++) {</span><br><span class="line"><span class="keyword">if</span> (mark[i] == <span class="number">0</span> && cmp(wordList.get(i), que[head].word)) {</span><br><span class="line">que[tail].word = wordList.get(i);</span><br><span class="line"><span class="comment">//è¿™é‡Œæ˜¯ä»headå¼€å§‹çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯headçš„æ­¥æ•°+1</span></span><br><span class="line">que[tail].step=que[head].step+<span class="number">1</span>;</span><br><span class="line"><span class="comment">//que[head].next=que[tail];</span></span><br><span class="line"><span class="comment">// æ ‡è®°ä¸ºå·²ç»èµ°è¿‡</span></span><br><span class="line">mark[i] = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">if</span> (que[tail].word.equals(endWord)) {</span><br><span class="line">   <span class="comment">//è®°å½•æœ€å°å€¼</span></span><br><span class="line">   min=que[tail].step;</span><br><span class="line">   <span class="comment">//åˆ°è¿™é‡Œé˜Ÿåˆ—åé¢å°±ä¸ç”¨å†æ’å…¥å…ƒç´ äº†</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//2.æŠŠä¹‹å‰èµ°è¿‡çš„è·¯åœ¨ä¸‹ä¸€ä¸ªhead</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//å°†é˜Ÿåˆ—å˜æˆlist</span></span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j<=tail;j++){</span><br><span class="line">   quelist.add(que[j]);</span><br><span class="line">   }</span><br><span class="line">   markDfs= <span class="keyword">new</span> <span class="keyword">int</span>[wordList.size() + <span class="number">1</span>]; </span><br><span class="line">   <span class="comment">// 1. ç”¨DFSè¯•ä¸€ä¸‹</span></span><br><span class="line">   dfsBfs(que[<span class="number">0</span>],endWord,quelist);</span><br><span class="line">    }</span><br><span class="line">                    tail++;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="comment">// æ¯æ¬¡æ£€æŸ¥å®Œä¸€ä¸ªå•è¯å°±å°†å…¶å‡ºé˜Ÿåˆ—</span></span><br><span class="line">head++;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dfsBfs</span><span class="params">(Que beginWord,String endWord,List<que> ques)</que></span></span>{</span><br><span class="line">    <span class="keyword">int</span> step = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < markDfs.length; i++) {</span><br><span class="line"><span class="keyword">if</span> (markDfs[i] == <span class="number">1</span>) {</span><br><span class="line">step++;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span>(step>=min) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span>(step+<span class="number">1</span>==min&&endWord.equals(beginWord.word)){</span><br><span class="line">List<string> list=<span class="keyword">new</span> ArrayList<>();</string></span><br><span class="line">Stack<string> stack=<span class="keyword">new</span> Stack<>();</string></span><br><span class="line">System.out.println(beginWord.word+<span class="string">":"</span>+step);</span><br><span class="line">Que temp=beginWord;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°ä¸€æ¡</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<min;i++){< span><br><span class="line">stack.push(temp.word);</span><br><span class="line">System.out.print(temp.word+<span class="string">"<--"</span>);</span><br><span class="line">temp=temp.prev;</span><br><span class="line">}</span><br><span class="line">System.out.println();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i<min;i++){< span><br><span class="line">list.add(stack.pop());</span><br><span class="line">}</span><br><span class="line">res.add(list);</span><br><span class="line">System.out.println(res);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < ques.size(); i++) {</span><br><span class="line"><span class="keyword">if</span> (markDfs[i] == <span class="number">0</span> && cmp(beginWord.word,ques.get(i).word)){</span><br><span class="line">markDfs[i] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//beginWord.next=ques.get(i);</span></span><br><span class="line">ques.get(i).prev=beginWord;</span><br><span class="line">dfsBfs(ques.get(i), endWord, ques);</span><br><span class="line">markDfs[i] = <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">// private int step = 0;</span></span><br><span class="line"><span class="keyword">int</span> min = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ²¡åƒæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">cmp</span><span class="params">(String s1, String s2)</span> </span>{</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < s1.length(); i++) {</span><br><span class="line"><span class="keyword">if</span> (s1.charAt(i) != s2.charAt(i)) {</span><br><span class="line">count++;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> count == <span class="number">1</span>;</span><br><span class="line">}</span><br></min;i++){<></span></min;i++){<></span></pre></td></tr></tbody></table></figure></div><p>æ•´ä½“ä¸Šåœ¨Queä¸Šå¢åŠ äº†ä¸€ä¸ªprevçš„æŒ‡é’ˆï¼Œéå†è·¯å¾„ï¼Œä¸€å¼€å§‹æ˜¯ç”¨çš„BFSä¸è¿‡æˆ‘æƒ³çš„å¤ªç®€å•äº†ï¼Œæˆ‘åªæ˜¯æŠŠæœ€åä¸€ä¸ªèŠ‚ç‚¹å‡ºé˜Ÿåˆ—ç„¶åå†BFSï¼Œåæ¥å‘ç°ä¸è¡Œ(å±…ç„¶è¿˜è·‘è¿‡äº†24ä¸ªæµ‹è¯•æ¡ˆä¾‹)ï¼Œå®é™…ä¸Šè¿™é¢˜æˆ‘è¿˜æ˜¯æ²¡æœ‰åšå‡ºæ¥ï¼Œä½†æ˜¯ä¸Šé¢çš„æ–¹æ³•åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„å°±æ˜¯ä¼šTLEğŸ˜­ï¼Œå¤§æ¦‚æ€è·¯å°±æ˜¯å…ˆBFSç¼©çŸ­DFSéœ€è¦éå†çš„å­—å…¸ç„¶åæ§åˆ¶æ¯æ¬¡é€’å½’çš„èº«ä½“ä¸èƒ½è¶…è¿‡BFSçš„åˆ°çš„æœ€çŸ­è·¯å¾„<br><img alt="img9" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/blog.PNG" src="/img/loading.gif" class="lazyload">ä¸€å¼€å§‹åªèƒ½è·‘å‡ ä¸ªæ•°æ®çš„ï¼Œä¼˜åŒ–ä¸‹èƒ½è·‘å‡ åä¸ªçš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œæ¯•ç«Ÿæ˜¯ä¸€é“éš¾é¢˜ç­‰ä»¥åå­¦äº†ç›¸å…³çš„ä¸œè¥¿å†æ¥è¯•è¯•çœ‹èƒ½ä¸èƒ½åšå‡ºæ¥å§.</p><hr><p>ç®—æ³•ï¼Œå­¦ç€æŒºæœ‰æ„æ€ï¼Œå°±æ˜¯å¤´æœ‰ç‚¹å‡‰ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æœç´¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ æœ‰FreeBugä¹ˆ? ---&gt;Spring-solr</title>
      <link href="/2018/10/05/solr-ni-you-freebug-me/"/>
      <url>/2018/10/05/solr-ni-you-freebug-me/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="FreeBug-å“å‘¦ï¼Œä¸é”™å–”ã€‚"><a href="#FreeBug-å“å‘¦ï¼Œä¸é”™å–”ã€‚" class="headerlink" title="FreeBug ? å“å‘¦ï¼Œä¸é”™å–”ã€‚"></a>FreeBug ? å“å‘¦ï¼Œä¸é”™å–”ã€‚</h2><p> æ˜¨å¤©ä»ä¸Šåˆ10ç‚¹å¼€å§‹ä¸€ç›´åˆ°æ™šä¸Š 11ï¼š58æ‰æŠŠé‚£å‡ ä¸ªBugç»™è§£å†³äº†ï¼Œå‰ä¸¤ä¸ªBugç¡®å®è›®å¥‡æ€ªçš„ï¼Œç‰¹åˆ«æ˜¯ç¬¬ä¸€ä¸ªBug ,æœ€åä¸€ä¸ªBugâ€¦.çº¯å±æ™ºéšœã€‚æŠŠè¿™å‡ ä¸ªBugè®°å½•ä¸‹â”—|ï½€Oâ€²|â”› </p><h3 id="Bug1"><a href="#Bug1" class="headerlink" title="Bug1:"></a><strong><em>Bug1</em></strong>:</h3><p><img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/9642SBM2%60QFX4AMO1C%5D~A%5BM.png" src="/img/loading.gif" class="lazyload"><br>æ„æ€æ˜¯æ²¡æ‰¾åˆ°TbItemMapperçš„selectæ–¹æ³•è¿˜æœ‰è¿™ä¸ªç±»çš„å…¶ä»–æ–¹æ³•ã€‚<br>ä¼°è®¡æ˜¯xmlæ–‡ä»¶æ²¡æœ‰åŠ è½½åˆ°classesè·¯å¾„ä¸‹ï¼Œä¹‹å‰ä¸€ç›´å¥½å¥½çš„ç„¶åæ˜¨å¤©çªç„¶æŠ½é£äº†ï¼Œç™¾åº¦äº†ä¸‹å«æˆ‘æŠŠxmlæ–‡ä»¶éšä¾¿çš„æ”¹åŠ¨ä¸‹åœ¨é‡Œé¢åŠ ä¸ªç©ºæ ¼æ¢è¡Œä¹‹ç±»çš„ï¼Œç„¶åå°±å¥½äº†ã€‚ã€‚ã€‚ã€‚</p><h3 id="Bug2"><a href="#Bug2" class="headerlink" title="Bug2:"></a><strong><em>Bug2</em></strong>:</h3><p><img alt="img9" data-src="https://p4.cdn.img9.top/ipfs/Qmcg5dscbhYgod9vdN2SHaxywdaCPVgY28jX4imd53TH6J?4.png" src="/img/loading.gif" class="lazyload"><br>çœ‹ç€è¿™äº›ä¸ªBugçœŸçš„æ˜¯ä¸€è„¸æ‡µï¼Œå†™mainæ–¹æ³•æ‰§è¡Œå°±ä¸€ç‚¹é—®é¢˜æ²¡æœ‰ï¼Œé¦–å…ˆæ˜¯ä¸€æ³¢ç™¾åº¦ï¼Œè¯´æ˜¯jaråŒ…å†²çªäº†ä¸»è¦æ˜¯HttpClientçš„å†²çªï¼Œç„¶åæˆ‘å°±å°è¯•äº†ä¸‹ideaçš„mavenä¾èµ–è§†å›¾<br><img alt="img9" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/DJQYP%604SGOCL_VP%28LGN%7B_TN.png" src="/img/loading.gif" class="lazyload"><br>ç„¶åå‘ç°dubboå’Œspring-data-solréƒ½æœ‰httpclientåŒ…å’Œhttpcoreè€Œä¸”ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œç„¶åæœæ–­çš„æŠŠdubboé‡Œé¢çš„httpclientå’Œhttpcoreç»™exclusionäº†ï¼Œä¸çœ‹ä¸çŸ¥é“ï¼Œæ•´ä¸ªé¡¹ç›®çš„mavenä¾èµ–å¥½ä¹±ï¼Œæœ‰å¥½å¤šä¾èµ–å†²çªï¼Œä¸è¿‡æ²¡å½±å“ä½¿ç”¨æˆ‘å°±æ²¡æœ‰å»æ”¹ï¼Œæ€•å†æ”¹å‡ºä»€ä¹ˆé—®é¢˜ã€‚ä½ ä»¥ä¸ºæ”¹å®Œä¹‹åbugå°±ç»“æŸäº†ï¼Ÿ</p><h3 id="Bug3"><a href="#Bug3" class="headerlink" title="Bug3:"></a><strong><em>Bug3</em></strong>:</h3><p><img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/%60Z3GBQ~K%29%7D%60DX%60P%60Q%257%25%7B%25S.png" src="/img/loading.gif" class="lazyload">)åœ¨controllerå±‚ç–¯ç‹‚æŠ¥é”™ï¼Œserviceå±‚ä¸€ç‚¹é—®é¢˜æ²¡æœ‰<img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/NLKUXAM~LPOZ7K%60%28%29D52%40VD.png" src="/img/loading.gif" class="lazyload">å¯ä»¥ï¼Œåˆä¸€ä¸ªFreeBugï¼Œåœ¨çº ç»“äº†å‡ ä¸ªå°æ—¶åçœ‹äº†ä¸€çœ¼ä»£ç å‘ç°<br><img alt="oss" data-src="https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/L20FMBQ%28XNRQV6Y6%24ITFEYA.png" src="/img/loading.gif" class="lazyload">åŸæ¥è¿™é‡Œå†™æ‰äº†ä¸œè¥¿ï¼Œè¿”å›äº†ä¸€ä¸ªsolrçš„ç»“æœé›†ä¹Ÿæ²¡æœ‰å®ç°åºåˆ—åŒ–è¿”å›å‡ºå»äº†å‰å°ä¹Ÿæ ¹æœ¬å°±è§£æä¸äº†éš¾æ€ªä¼šå†å‰å°æŠ¥é”™ã€‚ã€‚ã€‚</p><p>ps: ä¹‹å‰ä¸€ç›´ç”¨çš„img9.topçš„æ— é™å›¾åºŠï¼Œå‰å‡ å¤©çªç„¶å´©æºƒäº†åšå®¢çš„å›¾ç‰‡éƒ½å¤±æ•ˆäº†ï¼Œä¹‹å‰ä¹Ÿæœ‰ä¸€ä¸ªé€çš„é˜¿é‡Œäº‘çš„ossçš„åŒ…æ‰€ä»¥å°±æƒ³æ‹¿é‚£ä¸ªå½“å›¾åºŠï¼Œè¿™ç¯‡æ–‡ç« é‡Œé¢çš„å›¾ç‰‡ä¹Ÿéƒ½æ˜¯åœ¨ossä¸Šçš„ï¼Œimg9è™½ç„¶ä¹Ÿè¿˜å¯ä»¥ä½†æ˜¯æ˜¯ä¸ªå»ä¸­å¿ƒåŒ–çš„å›¾åºŠä¸å¥½ç®¡ç†ç¡®å®éš¾æï¼Œç­‰æœ‰æ—¶é—´å°±ç”¨javaå†™ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å›¾åºŠå·¥å…·ç©ç©ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> è¸©å‘è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bug </tag>
            
            <tag> Solr </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯ä»¥è·å–æœ€å°å€¼çš„æ ˆ</title>
      <link href="/2018/09/27/ke-yi-huo-qu-zui-xiao-zhi-de-zhan/"/>
      <url>/2018/09/27/ke-yi-huo-qu-zui-xiao-zhi-de-zhan/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="å¦‚ä½•å®ç°å¯ä»¥è·å–æœ€å°å€¼çš„æ ˆï¼Ÿ"><a href="#å¦‚ä½•å®ç°å¯ä»¥è·å–æœ€å°å€¼çš„æ ˆï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°å¯ä»¥è·å–æœ€å°å€¼çš„æ ˆï¼Ÿ"></a>å¦‚ä½•å®ç°å¯ä»¥è·å–æœ€å°å€¼çš„æ ˆï¼Ÿ</h2><p>è¿™ä¸ªé—®é¢˜æ˜¯å¾ˆä¹…ä¹‹å‰åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šçœ‹è§çš„ä¸€ä¸ªé—®é¢˜ï¼Œçªç„¶æƒ³èµ·æ¥å°±æ¥æ“ä½œä¸€ä¸‹ã€‚<br>å¼€å‘ç¯å¢ƒ   : sublime+MinGW<br>å…ˆé™„ä¸Šæˆ‘è‡ªå·±å®ç°çš„æ ˆçš„ç»“æ„</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰é“¾æ ˆçš„èŠ‚ç‚¹çš„ç»“æ„ä½“ </span></span><br><span class="line">typedef struct  StackNode</span><br><span class="line">{</span><br><span class="line"><span class="keyword">int</span> data;</span><br><span class="line">struct StackNode *next;</span><br><span class="line">}StackNode,*LinkStackPtr;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é“¾æ ˆçš„ç»“æ„ä½“</span></span><br><span class="line">typedef struct LinkStack</span><br><span class="line">{</span><br><span class="line"><span class="comment">//æ ˆé¡¶</span></span><br><span class="line">LinkStackPtr top;</span><br><span class="line"><span class="comment">//æ€»æ•°é‡</span></span><br><span class="line"><span class="keyword">int</span> count;</span><br><span class="line">}LinkStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–æ ˆ</span></span><br><span class="line">LinkStack *init(){</span><br><span class="line">LinkStack *stack=(LinkStack*)malloc(sizeof(LinkStack));</span><br><span class="line"><span class="keyword">if</span> (stack==NULL)</span><br><span class="line">{</span><br><span class="line">printf(<span class="string">"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥"</span>);</span><br><span class="line">}<span class="keyword">else</span></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ç©ºæ ˆ</span></span><br><span class="line">stack->top=NULL;</span><br><span class="line">stack->count=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> stack;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="function">LinkStackPtr  <span class="title">creatNode</span><span class="params">()</span></span>{</span><br><span class="line">LinkStackPtr stack;</span><br><span class="line"><span class="comment">//å¼€è¾Ÿç©ºé—´</span></span><br><span class="line">stack =(LinkStackPtr)malloc(sizeof(StackNode));</span><br><span class="line"><span class="keyword">if</span>(stack==NULL){</span><br><span class="line">printf(<span class="string">"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥"</span>);</span><br><span class="line">}</span><br><span class="line">scanf(<span class="string">"%d"</span>,&(stack->data));</span><br><span class="line">stack->next=NULL;</span><br><span class="line"><span class="keyword">return</span> stack;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‹æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(LinkStack * s)</span></span>{</span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line">LinkStackPtr newStack= creatNode();</span><br><span class="line"><span class="comment">//ä¿å­˜å½“å‰çš„èŠ‚ç‚¹</span></span><br><span class="line">LinkStackPtr currentTopStack=s->top;</span><br><span class="line"><span class="comment">//æ ˆé¡¶å˜ä¸ºåˆšè¿›æ ˆçš„å…ƒç´ </span></span><br><span class="line">s->top=newStack;</span><br><span class="line"><span class="comment">//è¿æ¥</span></span><br><span class="line">newStack->next=currentTopStack;</span><br><span class="line"><span class="comment">//æ•°ç›®åŠ ä¸€</span></span><br><span class="line">s->count++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼¹æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(LinkStack *s)</span></span>{</span><br><span class="line"><span class="comment">//å°†æ ˆé¡¶å¼¹å‡º</span></span><br><span class="line">LinkStackPtr topStack=s->top;</span><br><span class="line">s->top=topStack->next;</span><br><span class="line">s->count--;</span><br><span class="line">free(topStack);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Solution-1ï¼š"><a href="#Solution-1ï¼š" class="headerlink" title="Solution 1ï¼š"></a><strong>Solution 1</strong>ï¼š</h3><p>åœ¨è¿›æ ˆçš„æ—¶å€™ç”¨ä¸€ä¸ªå˜é‡ä¿å­˜å½“å‰çš„æœ€å°å€¼æ¯æ¬¡è¿›æ ˆå°±ä¼šå’Œæœ€å°å€¼æ¯”è¾ƒå¦‚æœæ¯”æœ€å°å€¼è¦å°å°±ä¼šæ›´æ–°è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå‡ºæ ˆçš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœæœ€å°å€¼è¢«å¼¹å‡ºå»äº†å°±éœ€è¦éå†æ•´ä¸ªæ ˆæ¥è·å–æœ€å°å€¼ã€‚</p><ul><li>Implementï¼š</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">typedef struct  StackNode</span><br><span class="line">{</span><br><span class="line"><span class="keyword">int</span> data;</span><br><span class="line">struct StackNode *next;</span><br><span class="line">}StackNode,*LinkStackPtr;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é“¾æ ˆçš„ç»“æ„ä½“</span></span><br><span class="line">typedef struct LinkStack</span><br><span class="line">{</span><br><span class="line"><span class="comment">//æ ˆé¡¶</span></span><br><span class="line">LinkStackPtr top;</span><br><span class="line"><span class="comment">//æ€»æ•°é‡</span></span><br><span class="line"><span class="keyword">int</span> count;</span><br><span class="line"><span class="comment">//æœ€å°å€¼</span></span><br><span class="line"><span class="keyword">int</span> min;</span><br><span class="line">}LinkStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿›æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(LinkStack * s)</span></span>{</span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line">LinkStackPtr newStack= creatNode();</span><br><span class="line"><span class="comment">//**********************************</span></span><br><span class="line"><span class="keyword">if</span>(s->count==<span class="number">0</span>){</span><br><span class="line">s->min=newStack->data;</span><br><span class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(s->min>newStack->data){</span><br><span class="line">s->min=newStack->data;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//*********************************</span></span><br><span class="line"><span class="comment">//ä¿å­˜å½“å‰çš„èŠ‚ç‚¹</span></span><br><span class="line">LinkStackPtr currentTopStack=s->top;</span><br><span class="line"><span class="comment">//æ ˆé¡¶å˜ä¸ºåˆšè¿›æ ˆçš„å…ƒç´ </span></span><br><span class="line">s->top=newStack;</span><br><span class="line"><span class="comment">//è¿æ¥</span></span><br><span class="line">newStack->next=currentTopStack;</span><br><span class="line"><span class="comment">//æ•°ç›®åŠ ä¸€</span></span><br><span class="line">s->count++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼¹æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(LinkStack *s)</span></span>{</span><br><span class="line"><span class="comment">//å°†æ ˆé¡¶å¼¹å‡º</span></span><br><span class="line">LinkStackPtr topStack=s->top;</span><br><span class="line"><span class="comment">//ä»ç¬¬äºŒä¸ªå¼€å§‹æ¯”è¾ƒ</span></span><br><span class="line">LinkStackPtr stackNode=topStack->next;</span><br><span class="line"><span class="comment">//å¼¹å‡ºå»çš„é‚£ä¸ªèŠ‚ç‚¹çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">int</span> min=topStack->data;</span><br><span class="line">s->top=topStack->next;</span><br><span class="line">s->count--;</span><br><span class="line">free(topStack);</span><br><span class="line"><span class="comment">//å¦‚æœå¼¹å‡ºçš„æ˜¯æœ€å°å€¼å°±éœ€è¦ä»å½“å‰æ ˆé¡¶éå†æ•°ç»„è·å–æœ€å°å€¼</span></span><br><span class="line"><span class="keyword">if</span>(min==s->min){</span><br><span class="line">min=stackNode->data;</span><br><span class="line">  <span class="keyword">do</span>{</span><br><span class="line">  <span class="keyword">if</span>(min>stackNode->data){</span><br><span class="line">  min=stackNode->data;</span><br><span class="line">  }</span><br><span class="line">stackNode=stackNode->next;</span><br><span class="line">   }<span class="keyword">while</span>(stackNode!=NULL);</span><br><span class="line">}</span><br><span class="line">s->min=min;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™ç§æ–¹æ³•è¿›æ ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(1),ä½†æ˜¯å‡ºæ ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(n).æ˜¾ç„¶ä¸æ˜¯å¾ˆä¼˜é›…ã€‚</p><h3 id="Solution-2ï¼š"><a href="#Solution-2ï¼š" class="headerlink" title="Solution 2ï¼š"></a><strong>Solution 2</strong>ï¼š</h3><p>ç©ºé—´æ¢æ—¶é—´åˆ©ç”¨ä¸€ä¸ªè¾…åŠ©æ ˆï¼Œè¾…åŠ©æ ˆé‡Œé¢å­˜æ”¾æœ€å°å€¼ï¼Œè¾…åŠ©æ ˆè¿›æ ˆæ—¶åˆ¤æ–­è¿›æ ˆçš„å…ƒç´ å’Œå½“å‰æ ˆé¡¶çš„å…ƒç´ å¤§å°è·Ÿå°å°±å¯ä»¥è¿›æ ˆã€‚æ‰€ä»¥æœ€å°å€¼å°±æ˜¯è¾…åŠ©æ ˆçš„æ ˆé¡¶å…ƒç´ ï¼Œå‡ºæ ˆæ—¶å¦‚æœå‡ºæ ˆçš„å…ƒç´ æ˜¯æœ€å°å€¼èŠ‚ç‚¹é‚£è¾…åŠ©æ ˆä¹ŸåŒæ—¶å¼¹æ ˆ å†å–æ ˆé¡¶å…ƒç´ ã€‚</p><ul><li>Implementï¼š</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">#include <stdio.h></stdio.h></span><br><span class="line">#include <stdlib.h></stdlib.h></span><br><span class="line">#include <string.h></string.h></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰é“¾æ ˆçš„èŠ‚ç‚¹çš„ç»“æ„ä½“ </span></span><br><span class="line">typedef struct  StackNode</span><br><span class="line">{</span><br><span class="line"><span class="keyword">int</span> data;</span><br><span class="line">struct StackNode *next;</span><br><span class="line">}StackNode,*LinkStackPtr;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é“¾æ ˆçš„ç»“æ„ä½“</span></span><br><span class="line">typedef struct LinkStack</span><br><span class="line">{</span><br><span class="line"><span class="comment">//æ ˆé¡¶</span></span><br><span class="line">LinkStackPtr top;</span><br><span class="line"><span class="comment">//æ€»æ•°é‡</span></span><br><span class="line"><span class="keyword">int</span> count;</span><br><span class="line"><span class="comment">//è¾…åŠ©æ ˆ</span></span><br><span class="line">struct LinkStack *mins;</span><br><span class="line">}LinkStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–æ ˆ</span></span><br><span class="line">LinkStack *init(){</span><br><span class="line">LinkStack *stack=(LinkStack*)malloc(sizeof(LinkStack));</span><br><span class="line"><span class="keyword">if</span> (stack==NULL)</span><br><span class="line">{</span><br><span class="line">printf(<span class="string">"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥"</span>);</span><br><span class="line">}<span class="keyword">else</span></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ç©ºæ ˆ</span></span><br><span class="line">stack->top=NULL;</span><br><span class="line">stack->count=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> stack;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="function">LinkStackPtr  <span class="title">creatNode</span><span class="params">()</span></span>{</span><br><span class="line">LinkStackPtr stack;</span><br><span class="line"><span class="comment">//å¼€è¾Ÿç©ºé—´</span></span><br><span class="line">stack =(LinkStackPtr)malloc(sizeof(StackNode));</span><br><span class="line"><span class="keyword">if</span>(stack==NULL){</span><br><span class="line">printf(<span class="string">"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥"</span>);</span><br><span class="line">}</span><br><span class="line">scanf(<span class="string">"%d"</span>,&(stack->data));</span><br><span class="line">stack->next=NULL;</span><br><span class="line"><span class="keyword">return</span> stack;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿›æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(LinkStack * s)</span></span>{</span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line">LinkStackPtr newStack= creatNode();</span><br><span class="line"><span class="comment">//ä¿å­˜å½“å‰çš„èŠ‚ç‚¹</span></span><br><span class="line">LinkStackPtr currentTopStack=s->top;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€è¾Ÿç©ºé—´ ç”¨äºæ·»åŠ åˆ°è¾…åŠ©æ ˆä¸­ï¼Œä¹‹å‰ç›´æ¥æ“ä½œnewStackï¼ŒæŒ‡é’ˆåœ°å€å¯¼è‡´åé¢è¾…åŠ©æ ˆå’Œä¸»æ ˆæ··åˆåˆ°äº†ä¸€èµ·ï¼Œï¼Œï¼Œï¼Œ</span></span><br><span class="line">LinkStackPtr minStackNode =(LinkStackPtr)malloc(sizeof(StackNode));</span><br><span class="line"><span class="keyword">if</span>(minStackNode==NULL){</span><br><span class="line">printf(<span class="string">"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥"</span>);</span><br><span class="line">}</span><br><span class="line">minStackNode->data=newStack->data;</span><br><span class="line">minStackNode->next=NULL;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ˆé¡¶å˜ä¸ºåˆšè¿›æ ˆçš„å…ƒç´ </span></span><br><span class="line">s->top=newStack;</span><br><span class="line"><span class="comment">//è¾…åŠ©æ ˆ</span></span><br><span class="line">LinkStack *mins=s->mins;</span><br><span class="line"><span class="comment">//ä¿å­˜è¾…åŠ©æ ˆå½“å‰æ ˆé¡¶</span></span><br><span class="line">LinkStackPtr  currentMinsTop=mins->top;</span><br><span class="line"><span class="keyword">if</span>(s->count==<span class="number">0</span>){</span><br><span class="line">   mins->top=newStack;</span><br><span class="line">   newStack->next=NULL;</span><br><span class="line">    }<span class="keyword">else</span></span><br><span class="line">    <span class="comment">//å¦‚æœè¿›æ ˆçš„å…ƒç´ æ¯”å½“å‰è¾…åŠ©æ ˆçš„æ ˆé¡¶å°</span></span><br><span class="line">    <span class="comment">//ç›¸ç­‰çš„è¦è¿›æ ˆ</span></span><br><span class="line">    <span class="keyword">if</span>(newStack->data<=mins->top->data){</span><br><span class="line">    mins->top=minStackNode;</span><br><span class="line">    <span class="comment">//è¿æ¥</span></span><br><span class="line">    mins->top->next=currentMinsTop;</span><br><span class="line">    mins->count++;</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//è¿æ¥</span></span><br><span class="line">s->top->next=currentTopStack;</span><br><span class="line"><span class="comment">//æ•°ç›®åŠ ä¸€</span></span><br><span class="line">s->count++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼¹æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(LinkStack *s)</span></span>{</span><br><span class="line"><span class="comment">//å°†æ ˆé¡¶å¼¹å‡º</span></span><br><span class="line">LinkStackPtr topStack=s->top;</span><br><span class="line">    <span class="comment">//è¾…åŠ©æ ˆ</span></span><br><span class="line">LinkStack * mins=s->mins;</span><br><span class="line"><span class="comment">//ä¿å­˜è¾…åŠ©æ ˆæ ˆé¡¶å…ƒç´ ä¾¿äºé”€æ¯</span></span><br><span class="line">LinkStackPtr minsTopStack=mins->top;</span><br><span class="line">s->top=topStack->next;</span><br><span class="line">s->count--;</span><br><span class="line"><span class="comment">//å¼¹å‡ºçš„å…ƒç´ æ˜¯æœ€å°å€¼</span></span><br><span class="line"><span class="keyword">if</span> (topStack->data==mins->top->data)</span><br><span class="line">{</span><br><span class="line"><span class="comment">//è¾…åŠ©æ ˆåŒæ—¶å¼¹æ ˆ</span></span><br><span class="line">mins->top=minsTopStack->next;</span><br><span class="line">mins->count--;</span><br><span class="line">free(minsTopStack);</span><br><span class="line">}</span><br><span class="line">free(topStack);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†æ ˆï¼ˆæ ˆé¡¶åˆ°æ ˆåº•ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printStack</span><span class="params">(LinkStack *stack)</span></span>{</span><br><span class="line"><span class="comment">//å½“å‰æ ˆé¡¶</span></span><br><span class="line">LinkStackPtr stackNode=stack->top;</span><br><span class="line"><span class="keyword">do</span>{</span><br><span class="line">printf(<span class="string">"%d\n"</span>,stackNode->data);</span><br><span class="line">stackNode=stackNode->next;</span><br><span class="line">}<span class="keyword">while</span>(stackNode!=NULL);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="comment">//ç”³æ˜å¹¶åˆå§‹åŒ–æ ˆç»“æ„</span></span><br><span class="line">LinkStack *stack=init();</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–è¿™ä¸ªé“¾æ ˆçš„è¾…åŠ©ï¼ˆCè¯­è¨€å­¦çš„ä¸å¥½åŸè°…è¿™äº›å¾ˆå¥‡æ€ªçš„æ“ä½œï¼‰</span></span><br><span class="line">stack->mins=init();</span><br><span class="line">push(stack);</span><br><span class="line">push(stack);</span><br><span class="line">push(stack);</span><br><span class="line">push(stack);</span><br><span class="line">printf(<span class="string">"*******è¿›æ ˆ******\n"</span>);</span><br><span class="line">printStack(stack);</span><br><span class="line">printf(<span class="string">"*********è¾…åŠ©æ ˆ*******\n"</span>);</span><br><span class="line">printStack(stack->mins);</span><br><span class="line">printf(<span class="string">"*******æœ€å°å€¼******\n"</span>);</span><br><span class="line">printf(<span class="string">"%d\n"</span>, stack->mins->top->data);</span><br><span class="line">pop(stack);</span><br><span class="line">printf(<span class="string">"*******å‡ºæ ˆ******\n"</span>);</span><br><span class="line">printStack(stack);</span><br><span class="line">printf(<span class="string">"*******æœ€å°å€¼******\n"</span>);</span><br><span class="line">printf(<span class="string">"%d\n"</span>, stack->mins->top->data);</span><br><span class="line">printf(<span class="string">"*********è¾…åŠ©æ ˆ*******\n"</span>);</span><br><span class="line">printStack(stack->mins);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æ˜æ˜¾è¿™ä¸ªæ–¹æ³•è¿›æ ˆå‡ºæ ˆæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼Œç©ºé—´å¤æ‚åº¦ç›¸å¯¹ä¼šé«˜ä¸€ç‚¹ï¼Œå…¶å®ç©ºé—´å¤æ‚åº¦è¿˜å¯ä»¥ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨è¾…åŠ©æ ˆé‡Œé¢å­˜ç´¢å¼•ï¼Œè¿™æ ·è¿›æ ˆæ—¶ä¼šé¿å…å­˜å…¥ç›¸åŒçš„æœ€å°å€¼ï¼Œå¦‚  2 1 1 1 1 1 å­˜åˆ°è¾…åŠ©æ ˆå°±æ˜¯  2 1 1 1 1 1 åé¢çš„1éƒ½æ˜¯é‡å¤çš„ï¼Œå¦‚æœå­˜ç´¢å¼•å°±æ˜¯ 0 1 è¿›æ ˆæ—¶è·Ÿä¹‹å‰ä¸€æ ·,å‡ºæ ˆæ—¶åˆ¤æ–­ç´¢å¼•æ˜¯å¦å’Œè¾…åŠ©æ ˆå­˜çš„ç´¢å¼•ä¸€è‡´ï¼Œä¸ä¸€è‡´å°±ä¸åŠ¨ã€‚è¿™é‡Œå› ä¸ºè¿™ä¸ªæ˜¯ä¸ªé“¾æ ˆ ,è¦æ ¹æ®ç´¢å¼•å–å€¼å¹¶ä¸æ–¹ä¾¿æ‰€ä»¥å°±ä¸å®ç°äº†.</p><p>è¿™é‡Œæˆ‘æŠŠä»£ç å…¨éƒ¨è´´ä¸Šæ¥äº†ï¼ŒCè¯­è¨€ç¡®å®å­¦çš„ä¸æ€ä¹ˆæ ·ï¼Œæ‰€ä»¥é‡Œé¢ä¼šæœ‰ä¸€äº›å¥‡æ€ªçš„æ“ä½œï¼Œè¿™ä¸ªç®—æ³•æœ¬èº«å¾ˆç®€å•ä½†æ˜¯ç”¨Cè¯­è¨€ä¸€å®ç°å°±ä¼šæœ‰ä¸€å †é—®é¢˜ï¼Œæ˜¨å¤©è¿›æ ˆçš„æ—¶å€™ä¸€ä¸ªæŒ‡é’ˆæŠŠè¾…åŠ©æ ˆå’Œä¸»æ ˆææ··äº†ä¸€ç›´æœ‰bug, ä»Šå¤©æ—©ä¸Šä¸Šè¯¾æ‰æƒ³èµ·æ¥ï¼Œæ¯•ç«ŸCè¯­è¨€å†™çš„å°‘hahahaha,  æ‰€ä»¥åé¢æˆ‘æ‰“ç®—ä»¥åä¼šåŒæ—¶ç”¨Cè¯­è¨€å’ŒJavaéƒ½å®ç°ä¸€éã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-Redisé‡åˆ°çš„bug</title>
      <link href="/2018/09/24/spring-redis-yu-dao-de-bug/"/>
      <url>/2018/09/24/spring-redis-yu-dao-de-bug/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="ä¸¤ä¸ªå°bugè®°å½•ä¸€ä¸‹"><a href="#ä¸¤ä¸ªå°bugè®°å½•ä¸€ä¸‹" class="headerlink" title="ä¸¤ä¸ªå°bugè®°å½•ä¸€ä¸‹"></a>ä¸¤ä¸ªå°bugè®°å½•ä¸€ä¸‹</h2><ol><li><p>Spring-data-rediså’Œjedisæ•´åˆçš„ç‰ˆæœ¬é—®é¢˜æŠ¥é”™å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ä¸¥é‡: Exception sending context initialized event to listener instance of <span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">context</span>.<span class="title">ContextLoaderListener</span></span></span><br><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'redisTemplate' defined in URL [jar:file:/E:/repository/com/pyg/pyg-common/0.0.1-SNAPSHOT/pyg-common-0.0.1-SNAPSHOT.jar!/spring/applicationContext-redis.xml]: Invocation of init method failed; nested exception is java.lang.NoSuchMethodError: org.springframework.core.serializer.support.DeserializingConverter.<init>(Ljava/lang/ClassLoader;)V</init></span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:<span class="number">1578</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:<span class="number">545</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:<span class="number">482</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractBeanFactory$<span class="number">1</span>.getObject(AbstractBeanFactory.java:<span class="number">305</span>)</span><br><span class="line">at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:<span class="number">230</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:<span class="number">301</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:<span class="number">196</span>)</span><br><span class="line">at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:<span class="number">772</span>)</span><br><span class="line">at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:<span class="number">834</span>)</span><br><span class="line">at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:<span class="number">537</span>)</span><br><span class="line">at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:<span class="number">446</span>)</span><br><span class="line">at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:<span class="number">328</span>)</span><br><span class="line">at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:<span class="number">107</span>)</span><br><span class="line">at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:<span class="number">4939</span>)</span><br><span class="line">at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:<span class="number">5434</span>)</span><br><span class="line">at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:<span class="number">150</span>)</span><br><span class="line">at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:<span class="number">1559</span>)</span><br><span class="line">at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:<span class="number">1549</span>)</span><br><span class="line">at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">266</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line">Caused by: java.lang.NoSuchMethodError: org.springframework.core.serializer.support.DeserializingConverter.<init>(Ljava/lang/ClassLoader;)V</init></span><br><span class="line">at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.<init>(JdkSerializationRedisSerializer.java:<span class="number">53</span>)</init></span><br><span class="line">at org.springframework.data.redis.core.RedisTemplate.afterPropertiesSet(RedisTemplate.java:<span class="number">117</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:<span class="number">1637</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:<span class="number">1574</span>)</span><br><span class="line">... <span class="number">21</span> more</span><br></pre></td></tr></tbody></table></figure></div><p>æŠ¥é”™åŸå› ï¼šSpring-data-reids å’Œ jedisçš„ç‰ˆæœ¬å†²çªï¼ˆåº”è¯¥ä¹Ÿå’ŒSpringçš„ç‰ˆæœ¬æœ‰å…³ç³»,åˆ«äººè·Ÿæˆ‘ä¸€æ ·çš„åŒ…éƒ½å¯ä»¥è¿è¡Œï¼‰ã€‚<br>æˆ‘æµ‹è¯•æˆåŠŸçš„ç‰ˆæœ¬ï¼š<br><jedis.version>2.6.2</jedis.version><br><spring.version>4.2.0.RELEASE</spring.version><br><spring-data-redis.version>1.4.2.RELEASE</spring-data-redis.version></p></li><li><p>SpringåŠ è½½é…ç½®æ–‡ä»¶çš„é—®é¢˜<br>å› ä¸ºåŒæ—¶é…ç½®äº†MySqlå’ŒRedisçš„é…ç½®æ–‡ä»¶è€Œä¸”ä¸æ˜¯åŒä¸€ä¸ªå·¥ç¨‹æ‰€ä»¥ä¸æ˜¯åŒæ—¶åˆå§‹åŒ–ç„¶åå‡ºç°äº†ä»¥ä¸‹çš„é—®é¢˜ã€‚<br>åŒä¸ªæ¨¡å—ä¸­å¦‚æœå‡ºç°å¤šä¸ªcontext:property-placeholder ï¼Œlocation propertiesæ–‡ä»¶åï¼Œ è¿è¡Œæ—¶å‡ºç°Could not resolve placeholder â€˜keyâ€™ in string value${key}ã€‚åŸå› æ˜¯åœ¨åŠ è½½ç¬¬ä¸€ä¸ªcontext:property-placeholderæ—¶ ä¼šæ‰«ææ‰€æœ‰çš„beanï¼Œè€Œæœ‰çš„beané‡Œé¢å‡ºç°ç¬¬äºŒä¸ª context:property-placeholderå¼•å…¥çš„propertiesçš„å ä½ç¬¦${key}ï¼Œ æ­¤æ—¶è¿˜æ²¡æœ‰åŠ è½½ç¬¬äºŒä¸ªproperty-placeholderï¼Œæ‰€ä»¥è§£æä¸äº†${key}ã€‚<br>è§£å†³åŠæ³•ä¸€ï¼Œå¯ä»¥å°†é€šè¿‡æ¨¡å—çš„å¤šä¸ªproperty-placeholderåˆå¹¶ä¸ºä¸€ä¸ªï¼Œå°†åˆå§‹åŒ–æ”¾åœ¨ä¸€èµ·ã€‚<br>æ–¹æ³•äºŒï¼Œæ·»åŠ ignore-unresolvable=â€true â€œï¼Œè¿™æ ·å¯ä»¥åœ¨åŠ è½½ç¬¬ä¸€ä¸ªproperty-placeholderæ—¶å‡ºç°è§£æä¸äº†çš„å ä½ç¬¦è¿›è¡Œå¿½ç•¥æ‰</p></li></ol><p>psï¼šç›®å‰çš„è®¡åˆ’æ˜¯å…ˆæŠŠå“ä¼˜è´­è¿™ä¸ªé¡¹ç›®åšå®Œï¼Œç„¶åæä¸€æå¾®ä¿¡å°ç¨‹åºä¹‹ç±»çš„å¼€å‘ï¼Œç„¶åå¼€å§‹ç€æ‰‹ç ”ç©¶æºç ï¼Œå¯¹Springçš„æºç éå¸¸å¥½å¥‡æœ‰ç§ç‰¹åˆ«æƒ³äº†è§£å¥¹çš„æ¬²æœ›hahahahahahaâ€¦.  çœ‹æºç è‚¯å®šä¼šæ¶‰åŠåˆ°è®¾è®¡æ¨¡å¼ä¹Ÿé¡ºä¾¿å­¦ä¸€å­¦ï¼Œå†å°±æ˜¯æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿™å­¦æœŸä¹Ÿæ­£åœ¨å­¦ä¹Ÿä¸ç”¨ç€æ€¥è·Ÿç€è€å¸ˆçš„è¿›åº¦å†åŠ è‡ªå·±çš„è‡ªå­¦è¡¥å……ï¼Œè¿™ä¸ªä¸œè¥¿ä¹Ÿä¸æ˜¯è¯´ä»Šå¤©å­¦å®Œäº†å°±ä¼šäº†çš„ä¸œè¥¿ï¼Œå¤§äºŒä¸Šå­¦æœŸä¸»è¦çš„æ‰“ç®—å°±æ˜¯è¿™ä¸ªäº†ï¼Œè¿˜æœ‰å°±æ˜¯ä¸èƒ½æŒ‚ç§‘ï¼ï¼ï¼ï¼,å†å¾€åå°±æ˜¯æ‰“ç®—å­¦ä¸‹å®‰å“å’Œå®‰å“é€†å‘ï¼Œä¸è¿‡æš‚æ—¶åªæ˜¯ä¸ªæ‰“ç®—ğŸ˜„ã€‚å†å¾€åå°±æ˜¯å¤§ä¸‰äº†ï¼Œè¿˜æ²¡æ‰“ç®—åˆ°é‚£ä¸ªæ—¶å€™ï¼Œæƒ³æƒ³è¿˜çœŸå¿«ï¼Œä¸çŸ¥ä¸è§‰å°±ä¸€å¹´è¿‡å»äº†ã€‚Come on , add oil ! ! ! @imlgw</p></body></html>]]></content>
      
      
      <categories>
          
          <category> è¸©å‘è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Bug </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KMPç®—æ³•åŠä¼˜åŒ–</title>
      <link href="/2018/09/06/kmp-suan-fa-ji-you-hua/"/>
      <url>/2018/09/06/kmp-suan-fa-ji-you-hua/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="KMPç®—æ³•åŠä¼˜åŒ–"><a href="#KMPç®—æ³•åŠä¼˜åŒ–" class="headerlink" title="KMPç®—æ³•åŠä¼˜åŒ–"></a>KMPç®—æ³•åŠä¼˜åŒ–</h2><p>   KMPç®—æ³•æ˜¯ä¸€ç§æ”¹è¿›çš„<a href="https://baike.so.com/doc/9018958-9348545.html" target="_blank" rel="noopener">å­—ç¬¦ä¸²åŒ¹é…</a>ç®—æ³•ï¼Œç”±D.E.Knuthï¼ŒJ.H.Morriså’ŒV.R.PrattåŒæ—¶å‘ç°ï¼Œå› æ­¤äººä»¬ç§°å®ƒä¸ºå…‹åŠªç‰¹â€“è«é‡Œæ–¯â€“æ™®æ‹‰ç‰¹æ“ä½œ(ç®€ç§°KMPç®—æ³•)ã€‚KMPç®—æ³•çš„å…³é”®æ˜¯åˆ©ç”¨åŒ¹é…å¤±è´¥åçš„ä¿¡æ¯ï¼Œå°½é‡å‡å°‘æ¨¡å¼ä¸²ä¸ä¸»ä¸²çš„åŒ¹é…æ¬¡æ•°ä»¥è¾¾åˆ°å¿«é€ŸåŒ¹é…çš„ç›®çš„ã€‚å…·ä½“å®ç°å°±æ˜¯å®ç°ä¸€ä¸ªnext()å‡½æ•°ï¼Œå‡½æ•°æœ¬èº«åŒ…å«äº†æ¨¡å¼ä¸²çš„å±€éƒ¨åŒ¹é…ä¿¡æ¯ã€‚æ—¶é—´å¤æ‚åº¦O(m+n)ã€‚<br> å¼€å‘ç¯å¢ƒ   : sublime+MinGW </p><ul><li>æš´åŠ›åŒ¹é…æ³•</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æš´åŠ›åŒ¹é…   </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BruteForce</span><span class="params">(<span class="keyword">String</span> S, <span class="keyword">String</span> T,<span class="keyword">int</span> <span class="built_in">begin</span>)</span></span>{ </span><br><span class="line"><span class="keyword">int</span> i=<span class="built_in">begin</span>,j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(i<s.length&&j<t.length){< span><br><span class="line"><span class="keyword">if</span>(S.str[i]==T.str[j]){</span><br><span class="line">j++;</span><br><span class="line">i++;</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line"><span class="comment">//æ¯ä¸²çš„å½“å‰ä½ç½®+1å‘åç§»åŠ¨</span></span><br><span class="line">i=i-j+<span class="number">1</span>;</span><br><span class="line"><span class="comment">//å­ä¸²ä»0å¼€å§‹</span></span><br><span class="line">j=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (i<s(s.length-t.length))< span><br><span class="line"><span class="keyword">return</span> i-j-<span class="built_in">begin</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;  <span class="comment">//æ²¡æ‰¾åˆ°</span></span><br><span class="line">}</span><br></s(s.length-t.length))<></span></s.length&&j<t.length){<></span></pre></td></tr></tbody></table></figure></div><p>æš´åŠ›åŒ¹é…æ¯”è¾ƒç®€å•ç²—æš´ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ªçš„æ¯”å¯¹å¦‚æœä¸å¯¹æ¯ä¸²å°±å›æº¯ç›´åˆ°é…æˆåŠŸã€‚<br>è¿™ä¸ªç®—æ³•æ— ç–‘æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œæœ€ç³Ÿç³•æƒ…å†µä¸º O(m*n);è€Œè¿™ä¸ªç®—æ³•çš„ç¼ºé™·å°±åœ¨äºæ¯æ¬¡æ¯ä¸²çš„ä¸å¿…è¦çš„å›æº¯ï¼Œäºæ˜¯KMPç®—æ³•å‡ºç°äº†</p><ul><li>KMPç®—æ³•</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNext</span><span class="params">(<span class="keyword">String</span> S,<span class="keyword">int</span> next[])</span></span>{</span><br><span class="line"><span class="comment">//è‡ªå·±å’Œè‡ªå·±åŒ¹é…å…¶å®å’Œkmpæ˜¯ä¸€ä¸ªé“ç†</span></span><br><span class="line"><span class="keyword">int</span> i=<span class="number">1</span>,j=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//å’Œæ ‡å‡†çš„KMPä¸å°ä¸€æ ·,æ ‡å‡†çš„KMPæ˜¯ä»1å¼€å§‹çš„å…¶å®åŸç†ä¹Ÿä¸€æ ·ï¼Œè¿™æ ·æ›´ä¹ æƒ¯</span></span><br><span class="line">next[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">next[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//å¾ªç¯ n-2 æ¬¡</span></span><br><span class="line"><span class="keyword">while</span>(i<s.length<span class="number">-1</s.length<span></span>){<br><span class="line"><span class="keyword">if</span>(S.str[i]==S.str[j]){</span><br><span class="line">++j;</span><br><span class="line">++i;</span><br><span class="line">next[i]=j;</span><br><span class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(j==<span class="number">0</span>){</span><br><span class="line"><span class="comment">//å¦‚æœå’Œå‰ç¼€ç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸ç­‰ï¼Œiåç§»ä¸‹ä¸€ä¸ªä½ç½®çš„nextä¸º0</span></span><br><span class="line">++i;</span><br><span class="line">next[i]=<span class="number">0</span>;</span><br><span class="line">}<span class="keyword">else</span></span><br><span class="line">    <span class="comment">//jå›é€€åˆ°ä¹‹å‰çš„ä½ç½®</span></span><br><span class="line">j=next[j];</span><br><span class="line">}</span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">KMP</span><span class="params">(<span class="keyword">String</span> S,<span class="keyword">String</span> T,<span class="keyword">int</span> <span class="built_in">begin</span>)</span></span>{</span><br><span class="line"><span class="keyword">int</span> i=<span class="built_in">begin</span>,j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> next[<span class="number">100</span>];</span><br><span class="line">getNext(T,next);</span><br><span class="line"><span class="keyword">while</span>(i<s.length&&j<t.length){< span><br><span class="line"><span class="keyword">if</span>(S.str[i]==T.str[j]){</span><br><span class="line">++i;</span><br><span class="line">++j;</span><br><span class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(j==<span class="number">0</span>){</span><br><span class="line">i++;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line"> j=next[j];</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (i<s(s.length-t.length))< span><br><span class="line"><span class="keyword">return</span> i-j-<span class="built_in">begin</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;   <span class="comment">//æ²¡æ‰¾åˆ°</span></span><br><span class="line">}</span><br></s(s.length-t.length))<></span></s.length&&j<t.length){<></span></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªç®—æ³•çš„åŸç†å…¶å®å¾ˆå¥½ç†è§£ ,æ¯ä¸²ä¸å›æº¯ï¼Œå¦‚æœä¸ç›¸ç­‰å­—ä¸²å°±ä¼šè·³åˆ°å¯¹åº”çš„ä½ç½®ç»§ç»­æ¯”å¯¹</p><h1 id="a-b-a-b-c"><a href="#a-b-a-b-c" class="headerlink" title="a b a b c"></a>a b a b c</h1><h1 id="a-b-c"><a href="#a-b-c" class="headerlink" title="a b c"></a>a b c</h1><p>æ¯”å¦‚ä¸Šé¢è¿™ç§ï¼Œcå’Œaä¸ç›¸ç­‰ ï¼Œå¦‚æœæ˜¯æš´åŠ›åŒ¹é…é‚£æ¯ä¸²å°±ä¼šå›æº¯åˆ°ç¬¬äºŒä¸ªå­—ç¬¦bçš„ä½ç½®ç»§ç»­æ¯”å¯¹ï¼Œä½†æ˜¯è¿™å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå­ä¸²çš„å­—ç¬¦éƒ½ä¸ç›¸ç­‰ï¼Œæ­£ç¡®çš„åšæ³•è‚¯å®šæ˜¯ç›´æ¥å°†å­—ä¸²å³æ»‘ï¼Œæˆ–è€…è¯´å°†å­ä¸²å›æº¯ï¼Œå›æº¯åˆ°açš„ä½ç½®ï¼Œç„¶åè®¡è¾ƒæ¯ä¸²çš„ç¬¬ä¸‰ä¸ªå­—ç¬¦å’Œå­ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦â€¦â€¦ åˆ†æä¸€ä¸‹å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªç®—æ³•æœ€åæ—¶é—´å¤æ‚åº¦ä¸ºO(n+m)<br>é‚£ä¹ˆé—®é¢˜æ¥äº†å›æº¯çš„ä½ç½®å¦‚ä½•ç¡®å®šï¼Ÿè¿™ä¹Ÿæ˜¯è¿™ä¸ªç®—æ³•çš„å…³é”®ä¹‹å¤„ã€‚è¦å¾—åˆ°ä¸€ä¸ªå¯¹åº”æ¯ä¸ªä½ç½®çš„nextæ•°ç»„å‚¨å­˜å½“å¤±é…æ—¶å›æº¯çš„ä½ç½®ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¡®å®šåªå’Œå­ä¸²æœ¬èº«çš„ç»“æ„æœ‰å…³å…¶ä»£è¡¨çš„æ—¶æœ€é•¿çš„å…¬å…±å‰åç¼€çš„é•¿åº¦ï¼Œå…³äºnextæ•°ç»„çš„æ±‚æ³•å°±ä¸è¯´äº†ï¼Œäººçœ¼åŸºæœ¬ä¸Šä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ã€‚</p><ul><li>nextæ•°ç»„ç¼–ç¨‹å®ç°</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNext</span><span class="params">(<span class="keyword">String</span> S,<span class="keyword">int</span> next[])</span></span>{</span><br><span class="line"><span class="comment">//è‡ªå·±å’Œè‡ªå·±åŒ¹é…å…¶å®å’Œkmpæ˜¯ä¸€ä¸ªé“ç†</span></span><br><span class="line"><span class="keyword">int</span> i=<span class="number">1</span>,j=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//å’Œæ ‡å‡†çš„KMPä¸å°ä¸€æ ·,æ ‡å‡†çš„KMPæ˜¯ä»1å¼€å§‹çš„å…¶å®åŸç†ä¹Ÿä¸€æ ·ï¼Œè¿™æ ·æ›´ä¹ æƒ¯</span></span><br><span class="line">next[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">next[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//å¾ªç¯ n-2 æ¬¡</span></span><br><span class="line"><span class="keyword">while</span>(i<s.length<span class="number">-1</s.length<span></span>){<br><span class="line"><span class="keyword">if</span>(S.str[i]==S.str[j]){</span><br><span class="line">++j;</span><br><span class="line">++i;</span><br><span class="line">next[i]=j;</span><br><span class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(j==<span class="number">0</span>){</span><br><span class="line"><span class="comment">//å¦‚æœå’Œå‰ç¼€ç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸ç­‰ï¼Œiåç§»ä¸‹ä¸€ä¸ªä½ç½®çš„nextä¸º0</span></span><br><span class="line">++i;</span><br><span class="line">next[i]=<span class="number">0</span>;</span><br><span class="line">}<span class="keyword">else</span></span><br><span class="line">    <span class="comment">//jå›é€€åˆ°ä¹‹å‰çš„ä½ç½®</span></span><br><span class="line">j=next[j];</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ä¸€å¼€å§‹çœ‹åˆ°è¿™ä¸ªæˆ‘æ˜¯æ¯”è¾ƒæ‡µçš„æ€ä¹ˆè¿™ä¹ˆçŸ­ï¼Ÿä»”ç»†çœ‹äº†ä¸‹è¿™å‡ è¡Œä»£ç å‰é¢çš„å…¶å®éƒ½è¿˜å¥½ç†è§£,ç›¸å½“äºè‡ªå·±å’Œè‡ªå·±åŒ¹é…</p><h1 id="ï¼ï¼ï¼å…³é”®æ˜¯åé¢çš„ä¸ç›¸ç­‰çš„æƒ…å†µ"><a href="#ï¼ï¼ï¼å…³é”®æ˜¯åé¢çš„ä¸ç›¸ç­‰çš„æƒ…å†µ" class="headerlink" title="ï¼ï¼ï¼å…³é”®æ˜¯åé¢çš„ä¸ç›¸ç­‰çš„æƒ…å†µ"></a>ï¼ï¼ï¼å…³é”®æ˜¯åé¢çš„ä¸ç›¸ç­‰çš„æƒ…å†µ</h1><p>è¿™é‡Œæˆ‘ä¹Ÿçº ç»“äº†å°åŠå¤©éšååœ¨ç½‘ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªå›¾è®²è§£è¿™ä¸ªçš„ç¬é—´å°±å¼€æœ—äº†è¿™é‡Œå°±ç›´æ¥æ¬è¿‡æ¥äº†ï¼ˆå¯¹<a href="https://blog.csdn.net/qq_30974369/article/details/74276186" target="_blank" rel="noopener">åŸæ–‡</a>åŠ äº†ä¸€ç‚¹è‡ªå·±çš„ç›´è§‚ç†è§£å¹¶å¦å¤–åŠ ä¸Šäº†å‚è€ƒã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹é‡Œé¢çš„å¯¹äºKMPç®—æ³•çš„ä¼˜åŒ–ï¼‰</p><h1 id="a-b-a-c-f-g-a-b-a-b-h"><a href="#a-b-a-c-f-g-a-b-a-b-h" class="headerlink" title="a b  a  c  f  g a  b a b h"></a>a b  a  c  f  g a  b a b h</h1><p><img alt="image" data-src="https://p1.cdn.img9.top/ipfs/QmQLpe9fWukFT9is6XnAmmAyBdTCVYSeV6oj7mn5yGVsy8?1.png" src="/img/loading.gif" class="lazyload"></p><h1 id="a-b-a-c-f-g-a-b-a-b-h-1"><a href="#a-b-a-c-f-g-a-b-a-b-h-1" class="headerlink" title="a b  a  c  f  g a  b a b  h"></a><strong>a b  a</strong>  c  f  g <strong>a  b a</strong> <em>b</em>  h</h1><p>çº¢è‰²çš„æ˜¯å½“å‰åŒ¹é…ä¸Šçš„æœ€é•¿çš„å‰åç¼€ï¼Œè“è‰²ä¸ºå½“å‰åŒ¹é…ä½ç½®ï¼Œä¹Ÿå°±æ˜¯<em>i</em> çš„ä½ç½® ä¸ä¸Šé¢å¯¹åº”çš„å°±æ˜¯b çš„ä½ç½®äº†<br><img alt="image2" data-src="https://p3.cdn.img9.top/ipfs/QmaFp1PaEY5Ednc4wUdLatsuJ7e4fibKv7jXwroGGb8rXN?3.png" src="/img/loading.gif" class="lazyload"></p><h1 id="a-b-a-c-f-g-a-b-a-b-h-2"><a href="#a-b-a-c-f-g-a-b-a-b-h-2" class="headerlink" title="a b  a  c  f  g a  b  a b  h"></a><strong>a b  a</strong>  <em>c</em>  f  g <strong>a  b  a</strong> <em>b</em>  h</h1><p>ç»¿è‰²ä¸ºå½“å‰åŒ¹é…åˆ°çš„æœ€é•¿å‰ç¼€çš„åä¸€ä½ä¹Ÿå°±æ˜¯ <em>j</em>  çš„ä½ç½® å¯¹åº” c çš„ä½ç½®<br>æ˜¾ç„¶c bä¸ç›¸ç­‰  å¦‚æœä¸ç›¸ç­‰é‚£å°±ä¸èƒ½ç»§ç»­å¾€åæ‰¾äº† é‚£åƒ aba è¿™ä¹ˆé•¿çš„å…¬å…±å‰åç¼€å°±ç”¨ä¸äº†äº†ï¼Œä¹Ÿå°±æ˜¯ä½ çš„nextæ•°ç»„ä¼šå˜å°ï¼Œå‰åç¼€ç›¸ä¼¼åº¦ä¼šå‡å°ã€‚<br><img alt="image3" data-src="https://p1.cdn.img9.top/ipfs/QmURa6y33pwvpWjoBZ6eSiyZzraBd9QPWSBF13gq2xdPnT?1.png" src="/img/loading.gif" class="lazyload"><br><img alt="image4" data-src="https://p2.cdn.img9.top/ipfs/QmVfW9VQ2JYhNigxskotFVRtgAYcEhksBBEKzSztKn3p9b?2.png" src="/img/loading.gif" class="lazyload"></p><h1 id="a-b-a-c-f-g-a-b-a-b-h-3"><a href="#a-b-a-c-f-g-a-b-a-b-h-3" class="headerlink" title="a  b  a  c  f  g  a  b  a b  h"></a><strong>a</strong>  <em>b</em>  <strong>a</strong>  c  f  g  <strong>a</strong>  b  <strong>a</strong> b  h</h1><p>å¦‚å›¾å››å—ç°è‰²åŒºåŸŸå®Œå…¨ç›¸ç­‰ï¼Œå…³é”®æ­¥éª¤ j=next[j];ä¹‹å‰çš„jåœ¨ç»¿è‰²åŒºåŸŸ ç°åœ¨çš„ j å›æº¯åˆ°äº†ç´«è‰²åŒºåŸŸ ä¹Ÿå°±æ˜¯å¯¹åº”bçš„ä½ç½®<br><img alt="image5" data-src="https://p1.cdn.img9.top/ipfs/QmYo2cscPKdCL9tGGn2frfrn6p4WuGXuma6W6yQSEw4bdx?1.png" src="/img/loading.gif" class="lazyload"><br>ç›¸ä¿¡åˆ°è¿™é‡Œåº”è¯¥å°±çœ‹æ˜ç™½äº†,å››å—åŒºåŸŸç›¸ç­‰ï¼Œå¦‚æœè“è‰²éƒ¨åˆ†å’Œç´«è‰²ç›¸ç­‰æ˜¯ä¸æ˜¯å°±åˆæœ‰äº†å…¬å…±çš„å‰åç¼€äº†å‘¢ï¼Ÿé‚£å¦‚æœä¸åŒå°±ä¼šç»§ç»­é€’æ¨ã€‚</p><ul><li>KMPä¼˜åŒ–<br>ä»€ä¹ˆï¼Ÿè¿™ä¹ˆåŠçš„ç®—æ³•è¿˜å¯ä»¥ä¼˜åŒ–ï¼Ÿçš„ç¡®ï¼ŒKMPè¿˜å¯ä»¥ä¼˜åŒ–ï¼Œè¿™é‡Œç›´æ¥æ‹¿ã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹é‡Œé¢çš„ä¾‹å­æ¥è¯´æ˜ (ps : è¿™é‡Œå¤§è¯æ•°æ®ç»“æ„å’ŒKMPåŸå§‹çš„æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯nextæ˜¯ä»1å¼€å§‹çš„ï¼Œæˆ‘æ˜¯ä»0å¼€å§‹çš„)<br><img alt="image6" data-src="https://p0.cdn.img9.top/ipfs/QmSum26wHswwEgRmR79oM75o8afbAMCy2ZMQcremrXpfka?0.png" src="/img/loading.gif" class="lazyload">    <ul><li>nextä¼˜åŒ–</li></ul></li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNexval</span><span class="params">(<span class="keyword">String</span> S,<span class="keyword">int</span> next[])</span></span>{</span><br><span class="line"><span class="comment">//è‡ªå·±å’Œè‡ªå·±åŒ¹é…å…¶å®å’Œkmpæ˜¯ä¸€ä¸ªé“ç†</span></span><br><span class="line"><span class="keyword">int</span> i=<span class="number">1</span>,j=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//å’Œæ ‡å‡†çš„KMPä¸å°ä¸€æ ·,æ ‡å‡†çš„KMPæ˜¯ä»1å¼€å§‹çš„å…¶å®åŸç†ä¹Ÿä¸€æ ·ï¼Œè¿™æ ·æ›´ä¹ æƒ¯</span></span><br><span class="line">next[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">next[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//å¾ªç¯n-2æ¬¡</span></span><br><span class="line"><span class="keyword">while</span>(i<s.length<span class="number">-1</s.length<span></span>){<br><span class="line"><span class="keyword">if</span>(S.str[i]==S.str[j]){</span><br><span class="line">++j;</span><br><span class="line">++i;</span><br><span class="line"><span class="comment">//ä¸‹ä¸€å¯¹å¯¹åº”çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯æ­£åœ¨æ±‚nextå€¼çš„ä½ç½®ï¼‰</span></span><br><span class="line"><span class="keyword">if</span>(S.str[j]==S.str[i]){</span><br><span class="line"><span class="comment">//è¿™ä¸€æ­¥å®é™…ä¸Šæ˜¯è·³è¿‡äº†é‡å¤çš„éƒ¨åˆ† å¦‚æœå’Œè¿™ä¸ªä½ç½®çš„nextå€¼çš„å­—ç¬¦ç›¸åŒå°±å¯ä»¥å°†è¿™ä¸ªä½ç½®çš„nextå­—ç¬¦è®¾ç½®ä¸ºnextä½ç½®å­—ç¬¦çš„nextå€¼</span></span><br><span class="line">next[i]=next[j];</span><br><span class="line">}<span class="keyword">else</span></span><br><span class="line">next[i]=j;</span><br><span class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(j==<span class="number">0</span>){</span><br><span class="line"><span class="comment">//å¦‚æœå’Œå‰ç¼€ç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸ç­‰ï¼Œiåç§»ä¸‹ä¸€ä¸ªä½ç½®çš„nextä¸º0</span></span><br><span class="line">++i;</span><br><span class="line">next[i]=<span class="number">0</span>;</span><br><span class="line">}<span class="keyword">else</span></span><br><span class="line">    <span class="comment">//jå›é€€åˆ°ä¹‹å‰çš„ä½ç½®</span></span><br><span class="line">j=next[j];</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>å…¶å®ä¼˜åŒ–çš„ç†ç”±å°±æ˜¯åœ¨è¿›è¡Œå’Œå­ä¸²åŒ¹é…çš„æ—¶å€™å¦‚æœå¤±é…ï¼Œåœ¨å­ä¸²å›æº¯æ—¶å›æº¯åˆ°çš„é‚£ä¸ªå€¼å’Œå½“å‰çš„å€¼ç›¸åŒé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥å›æº¯åˆ° é‚£ä¸ªå›æº¯å€¼çš„å›æº¯å€¼ï¼Œå¯èƒ½æœ‰ç‚¹ç»•ä½†æ˜¯ä»”ç»†æƒ³æƒ³å°±æ˜ç™½äº†ã€‚</p><h1 id="a-b-a-b-a-a-a-b-a"><a href="#a-b-a-b-a-a-a-b-a" class="headerlink" title="a b a b a a a b a"></a><strong>a b a b a a a b a</strong></h1><p>è¿™ä¸ªå­—ç¬¦ä¸²çš„nextåº”è¯¥æ˜¯ next=[-1,0,0,1,2,3,1,1,2]<br>nextval=[-1,0,0,0,0,3,1,0,0] ï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œé‚£å°±æ˜¯å‰ä¸¤ä½æ˜¯ä¸ç”¨è€ƒè™‘çš„ï¼Œæ°¸è¿œæ˜¯-1 0ï¼Œæ‰€ä»¥å¦‚æœæŒ‰ç…§ä¸Šé¢çš„è¯´æ³•å¯èƒ½ä¼šè®¤ä¸ºç¬¬ä¸‰ä¸ªæ˜¯-1ï¼Œå…¶å®ä¸æ˜¯çš„å…·ä½“çš„å¯ä»¥çœ‹ä»£ç ï¼Œå¦‚æœæ—¶å®˜æ–¹çš„é‚£ç§ä»1å¼€å§‹å°±æ²¡æœ‰è¿™ç§é¡¾è™‘ï¼‰ã€‚<br>æ‹¿è¿™ä¸ªå®é™…çš„æ¥è¯´ ,  <strong>a b a b a a a b a</strong>å½“æ¯”å¯¹åˆ°è¯¥å­ä¸²æœ€åä¸€ä¸ªaæ—¶ ä¸ç›¸ç­‰ ï¼ŒæŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•å›æº¯ï¼Œå›æº¯åˆ°index=2çš„aä½ç½®ï¼Œå‘ç°è¿™è´§ä¹Ÿæ˜¯aé‚£è‚¯å®šä¹Ÿä¸ç›¸ç­‰ï¼Œç„¶ååˆå›æº¯å›æº¯åˆ°ç¬¬ä¸€ä¸ªaï¼Œè¿™ä¸­é—´ä¸å°±å¤šå›æº¯äº†ä¸€æ¬¡ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¸ä¸€æ¬¡åˆ°ä½å‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åˆ¤æ–­å°†è¦å›æº¯çš„å€¼å’Œå½“å‰å€¼æ˜¯ä¸æ˜¯ç›¸ç­‰ï¼Œç›¸ç­‰å°±æŠŠå°†è¦å›æº¯çš„å€¼çš„å›æº¯å€¼èµ‹ç»™å½“å‰å€¼ã€‚</p></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒå‘å¾ªç¯é“¾è¡¨</title>
      <link href="/2018/08/18/shuang-xiang-xun-huan-lian-biao-c-shi-xian/"/>
      <url>/2018/08/18/shuang-xiang-xun-huan-lian-biao-c-shi-xian/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="Cå®ç°çš„åŒå‘å¾ªç¯é“¾è¡¨"><a href="#Cå®ç°çš„åŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="Cå®ç°çš„åŒå‘å¾ªç¯é“¾è¡¨"></a>Cå®ç°çš„åŒå‘å¾ªç¯é“¾è¡¨</h2><p>å¾ˆä¹…æ²¡æœ‰ç”¨Cäº†ï¼Œéƒ½å¿˜äº†ï¼Œæ˜¨å¤©ä¸‹åˆåˆå¤ä¹ äº†ä¸€ä¸‹ç„¶åå®ç°äº†è¿™ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ï¼Œåé¢æ¯ç§æ•°æ®ç»“æ„éƒ½ä¼šåœ¨è¿™é‡Œå®ç°è®°å½•ä¸‹æ¥ã€‚<br>å¼€å‘ç¯å¢ƒ   : sublime+MinGW </p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">#include <stdio.h></stdio.h></span><br><span class="line">#include <stdlib.h></stdlib.h></span><br><span class="line"><span class="comment">//å®šä¹‰ç»“æ„ä½“</span></span><br><span class="line">typedef struct Node</span><br><span class="line">{</span><br><span class="line"><span class="keyword">int</span> data;</span><br><span class="line">struct Node *perv;</span><br><span class="line">struct Node *next;</span><br><span class="line">}Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> length;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–èŠ‚ç‚¹</span></span><br><span class="line">Node* createNode(){</span><br><span class="line">Node * node;</span><br><span class="line"><span class="comment">//å¼€è¾Ÿç©ºé—´</span></span><br><span class="line">node =(Node*)malloc(sizeof(Node));</span><br><span class="line"><span class="keyword">if</span>(node==NULL){</span><br><span class="line">printf(<span class="string">"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥"</span>);</span><br><span class="line">}</span><br><span class="line">scanf(<span class="string">"%d"</span>,&(node->data));</span><br><span class="line">node->perv=NULL;</span><br><span class="line">node->next=NULL;</span><br><span class="line"><span class="keyword">return</span> node;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–é“¾è¡¨ </span></span><br><span class="line">Node* createList(<span class="keyword">int</span> n)</span><br><span class="line">{</span><br><span class="line">    Node *tail,*p,*head;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–å¤´ç»“ç‚¹ (è¿™ä¸ªèŠ‚ç‚¹åªæ˜¯ä¸ªæ ‡å¿—ï¼Œæ ‡å¿—é“¾è¡¨çš„å¤´å¹¶ä¸å­˜å‚¨æ•°æ®,åªæ˜¯ä¸ºäº†æ“ä½œçš„ç»Ÿä¸€æ€§)</span></span><br><span class="line">    head=(Node*)malloc(sizeof(Node));</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">if</span>(n >= <span class="number">1</span>)   <span class="comment">//ç»“ç‚¹çš„ä¸ªæ•° >= 1 çš„æ—¶å€™</span></span><br><span class="line">    {</span><br><span class="line">        p = createNode();</span><br><span class="line">        head->next = p;</span><br><span class="line">        p->perv=head;</span><br><span class="line">        tail = p;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">2</span>;i <= n;i++)    <span class="comment">//ç”Ÿæˆç¬¬ä¸€ä¸ªç»“ç‚¹ä»¥åçš„ç»“ç‚¹ï¼Œå¹¶å»ºç«‹åŒå‘é“¾è¡¨çš„å…³ç³» </span></span><br><span class="line">    {</span><br><span class="line">        p = createNode();</span><br><span class="line">        tail->next = p;</span><br><span class="line">        p->perv = tail;</span><br><span class="line">        <span class="comment">//å°¾æŒ‡é’ˆåç§»</span></span><br><span class="line">        tail = p;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//è¿æ¥å¤´å°¾</span></span><br><span class="line">    head->perv=tail;</span><br><span class="line">    tail->next=head;</span><br><span class="line">    <span class="comment">//é“¾è¡¨çš„é•¿åº¦</span></span><br><span class="line">    length = n;</span><br><span class="line">    <span class="keyword">if</span>(n >= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> (head);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;    </span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨å¤´å°¾æ’å…¥èŠ‚ç‚¹   ï¼ˆå®é™…ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¸‹é¢çš„insAnywhereå®Œæˆï¼Œä¸»è¦ä¸ºäº†æ•ˆç‡,å¦‚æœæ˜¯å°¾ç»“ç‚¹æ’å…¥getEle()æ—¶é—´å¤æ‚åº¦è¿‡é«˜ï¼‰</span></span><br><span class="line"><span class="comment">//insAnywhere(head,0);</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insHead</span><span class="params">(Node* head)</span></span>{</span><br><span class="line">Node *p=createNode();</span><br><span class="line">Node *q;</span><br><span class="line"><span class="comment">//ä¿å­˜ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">q=head->next;</span><br><span class="line"><span class="comment">//è¿æ¥å¤´ç»“ç‚¹</span></span><br><span class="line">head->next=p;</span><br><span class="line">p->perv=head;</span><br><span class="line"><span class="comment">//è¿æ¥ä¹‹å‰çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">p->next=q;</span><br><span class="line">q->perv=p;</span><br><span class="line">++length;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//insAnywhere(head,length);</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insTail</span><span class="params">(Node* head)</span></span>{</span><br><span class="line">Node *p=createNode();</span><br><span class="line"><span class="comment">//å…ˆä¿å­˜ä¸‹ä¹‹å‰çš„å°¾æŒ‡é’ˆ</span></span><br><span class="line">Node *tail=head->perv;</span><br><span class="line"><span class="comment">//è¿æ¥å¤´å°¾</span></span><br><span class="line">head->perv=p;</span><br><span class="line">p->next=head;</span><br><span class="line"><span class="comment">//è¿æ¥ä¹‹å‰çš„å°¾æŒ‡é’ˆ</span></span><br><span class="line">tail->next=p;</span><br><span class="line">p->perv=tail;</span><br><span class="line">++length;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//å–å¾—æŸä¸€ä½ç½®çš„èŠ‚ç‚¹  æ—¶é—´å¤æ‚åº¦ä¸º O(n)</span></span><br><span class="line">Node * getEle(Node* head,<span class="keyword">int</span> n){</span><br><span class="line"><span class="comment">//å°†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹èµ‹å€¼ç»™p</span></span><br><span class="line">Node *p=head;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < n; ++i)</span><br><span class="line">{</span><br><span class="line">p=p->next;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–é“¾è¡¨çš„é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLength</span><span class="params">()</span></span>{</span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»»æ„ä½ç½®æ’å…¥ï¼Œå› ä¸ºè®¾ç½®äº†å¤´èŠ‚ç‚¹æ‰€ä»¥æ’å…¥çš„æ“ä½œå…·æœ‰ä¸€è‡´æ€§</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insAnywhere</span><span class="params">(Node *head,<span class="keyword">int</span> n)</span></span>{</span><br><span class="line">Node *newNode=createNode();</span><br><span class="line"><span class="comment">//å–å¾—å¯¹åº”ä½ç½®çš„å€¼</span></span><br><span class="line">Node *currentNode=getEle(head,n);</span><br><span class="line"><span class="comment">//ä¿å­˜å½“å‰ä½ç½®çš„ä¸‹ä¸€ä¸ª</span></span><br><span class="line">Node *nextNode;</span><br><span class="line"><span class="comment">//ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">nextNode=currentNode->next;</span><br><span class="line"><span class="comment">//è¿æ¥å½“å‰ç»“ç‚¹</span></span><br><span class="line">currentNode->next=newNode;</span><br><span class="line">newNode->perv=currentNode;</span><br><span class="line"><span class="comment">//è¿æ¥ä¹‹å‰çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">newNode->next=nextNode;</span><br><span class="line">nextNode->perv=newNode;</span><br><span class="line">++length;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»»æ„ä½ç½®çš„åˆ é™¤</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delNode</span><span class="params">(Node *head,<span class="keyword">int</span> n)</span></span>{</span><br><span class="line">Node *delNode=getEle(head,n);</span><br><span class="line"><span class="comment">/*printf("%d\n", delNode->data);</span></span><br><span class="line"><span class="comment">printf("--------------\n");*/</span></span><br><span class="line"><span class="comment">//å…ˆä¿å­˜å½“å‰èŠ‚ç‚¹çš„åä¸€èŠ‚ç‚¹</span></span><br><span class="line">Node *nextNode=delNode->next;</span><br><span class="line"><span class="comment">//å°†åä¸€ä¸ªèŠ‚ç‚¹æ¥åœ¨å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªçš„åé¢</span></span><br><span class="line">delNode->perv->next=nextNode;</span><br><span class="line">nextNode->perv=delNode->perv;</span><br><span class="line"><span class="comment">//freeè¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">free(delNode);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†é“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printlnAll</span><span class="params">(Node *head)</span></span>{</span><br><span class="line">Node *p=head->next;</span><br><span class="line">   <span class="keyword">do</span>{</span><br><span class="line">     printf(<span class="string">"%d\n"</span>, p->data);</span><br><span class="line">     p=p->next;</span><br><span class="line">   }<span class="keyword">while</span>(p!=head);</span><br><span class="line"><span class="comment">// while(p->next!=head){</span></span><br><span class="line"><span class="comment">// printf("%d\n", p->data);</span></span><br><span class="line"><span class="comment">// //æŒ‡é’ˆåç§»</span></span><br><span class="line"><span class="comment">// p=p->next;</span></span><br><span class="line"><span class="comment">// }</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line">Node* createList(<span class="keyword">int</span> n);</span><br><span class="line">Node* createNode();</span><br><span class="line"></span><br><span class="line">Node *head=createList(<span class="number">3</span>);</span><br><span class="line">printf(<span class="string">"éå†é“¾è¡¨\n"</span>);</span><br><span class="line">printlnAll(head);</span><br><span class="line"></span><br><span class="line">insHead(head);</span><br><span class="line"><span class="comment">//insAnywhere(head,0);</span></span><br><span class="line">printf(<span class="string">"åœ¨å¤´æ’å…¥èŠ‚ç‚¹å\n"</span>);</span><br><span class="line">printlnAll(head);</span><br><span class="line"></span><br><span class="line">insTail(head);    <span class="comment">//ä¸‹é¢çš„ä¹Ÿå¯ä»¥ä½†æ˜¯æ•ˆç‡æ¯”è¾ƒä½</span></span><br><span class="line"><span class="comment">//insAnywhere(head,getLength());</span></span><br><span class="line">printf(<span class="string">"åœ¨å°¾æ’å…¥èŠ‚ç‚¹å\n"</span>);</span><br><span class="line">printlnAll(head);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ åé¢æ’å…¥å…ƒç´ </span></span><br><span class="line">printf(<span class="string">"---------åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ åé¢æ’å…¥å…ƒç´ -----\n"</span>);</span><br><span class="line">insAnywhere(head,<span class="number">1</span>);</span><br><span class="line">printlnAll(head);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤æœ€åé¢çš„èŠ‚ç‚¹</span></span><br><span class="line">printf(<span class="string">"---------åˆ é™¤æœ€åé¢çš„èŠ‚ç‚¹-------\n"</span>);</span><br><span class="line">delNode(head,<span class="number">6</span>);</span><br><span class="line">printlnAll(head);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤ç¬¬ä¸€ä¸ªåé¢çš„èŠ‚ç‚¹</span></span><br><span class="line">printf(<span class="string">"-------åˆ é™¤ç¬¬ä¸€ä¸ªåé¢çš„èŠ‚ç‚¹---------\n"</span>);</span><br><span class="line">delNode(head,<span class="number">2</span>);</span><br><span class="line"><span class="comment">//printf("%d\n", head->next->data);</span></span><br><span class="line">printlnAll(head);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><ul><li>çº¿æ€§è¡¨<br><img alt="image" data-src="http://p0.cdn.img9.top/ipfs/QmUS62kkfTx4trGRmMukDCFuJNxrKDR2P2DdoERRqf1pcr?0.png" src="/img/loading.gif" class="lazyload"><br>è¿™é‡Œé¢çš„é“¾å¼å­˜å‚¨ç»“æ„é‡Œé¢çš„ <em>é™æ€é“¾è¡¨</em> æŒºæœ‰æ„æ€çš„ï¼Œä¸ç”¨æŒ‡é’ˆå®ç°é“¾å¼ç»“æ„ã€‚<br>çº¿æ€§è¡¨çš„è¿™ä¸¤ç§ç»“æ„å®é™…ä¸Šæ˜¯åé¢å…¶ä»–æ•°æ®ç»“æ„çš„åŸºç¡€ï¼Œé¡ºåºå‚¨å­˜ç»“æ„å’Œé“¾å¼å‚¨å­˜ç»“æ„ä¹Ÿå„æœ‰ä¼˜åŠ£ã€‚<br><img alt="image" data-src="http://p1.cdn.img9.top/ipfs/QmUWbnXLv86uwuCrWkp2ft6fax7TgZ1kryaCPKrWTGidsy?1.PNG" src="/img/loading.gif" class="lazyload"></li></ul><p>æ³¨ï¼šä»£ç ä¸­çš„Stringæ˜¯æˆ‘è‡ªå®šä¹‰çš„ã€‚</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">typedef struct{</span><br><span class="line"><span class="comment">//é•¿åº¦</span></span><br><span class="line"><span class="keyword">int</span> length;</span><br><span class="line"><span class="comment">//å†…å®¹</span></span><br><span class="line"><span class="keyword">char</span> *str;</span><br><span class="line"><span class="comment">//æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">int</span> maxLength;</span><br><span class="line">}String;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(String *s,<span class="keyword">int</span> max,<span class="keyword">char</span> * string)</span></span>{</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">s->maxLength=max;</span><br><span class="line">s->length=strlen(string);</span><br><span class="line"><span class="comment">//å¼€è¾Ÿç©ºé—´</span></span><br><span class="line">s->str=(<span class="keyword">char</span>*)malloc(sizeof(<span class="keyword">char</span>)*max);</span><br><span class="line"><span class="comment">//èµ‹å€¼</span></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i<s->length;i++){</s-></span><br><span class="line">s->str[i]=string[i];</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></body></html>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ·»åŠ å…¶ä»–çš„è¯„è®ºç³»ç»Ÿ</title>
      <link href="/2018/07/01/hexo-tian-jia-ping-lun-xi-tong/"/>
      <url>/2018/07/01/hexo-tian-jia-ping-lun-xi-tong/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="æœ€è¿‘æ¢äº†ä¸€ä¸ªHexoçš„ä¸»é¢˜ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„è¿™æ¬¾ï¼Œä½†æ˜¯æ”¯æŒçš„è¯„è®ºç³»ç»Ÿä¸¤ä¸ªå·²ç»å…³äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªä¼šè¢«å¢™ã€‚æ‰€ä»¥å°±è‡ªå·±æ¥åŠ äº†ä¸€ä¸ª"><a href="#æœ€è¿‘æ¢äº†ä¸€ä¸ªHexoçš„ä¸»é¢˜ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„è¿™æ¬¾ï¼Œä½†æ˜¯æ”¯æŒçš„è¯„è®ºç³»ç»Ÿä¸¤ä¸ªå·²ç»å…³äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªä¼šè¢«å¢™ã€‚æ‰€ä»¥å°±è‡ªå·±æ¥åŠ äº†ä¸€ä¸ª" class="headerlink" title="æœ€è¿‘æ¢äº†ä¸€ä¸ªHexoçš„ä¸»é¢˜ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„è¿™æ¬¾ï¼Œä½†æ˜¯æ”¯æŒçš„è¯„è®ºç³»ç»Ÿä¸¤ä¸ªå·²ç»å…³äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªä¼šè¢«å¢™ã€‚æ‰€ä»¥å°±è‡ªå·±æ¥åŠ äº†ä¸€ä¸ª"></a>æœ€è¿‘æ¢äº†ä¸€ä¸ªHexoçš„ä¸»é¢˜ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„è¿™æ¬¾ï¼Œä½†æ˜¯æ”¯æŒçš„è¯„è®ºç³»ç»Ÿä¸¤ä¸ªå·²ç»å…³äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªä¼šè¢«å¢™ã€‚æ‰€ä»¥å°±è‡ªå·±æ¥åŠ äº†ä¸€ä¸ª</h2><h3 id="é¦–å…ˆæ³¨å†Œå¹¶ç™»å½•LiveRe"><a href="#é¦–å…ˆæ³¨å†Œå¹¶ç™»å½•LiveRe" class="headerlink" title="é¦–å…ˆæ³¨å†Œå¹¶ç™»å½•LiveRe"></a>é¦–å…ˆæ³¨å†Œå¹¶ç™»å½•LiveRe</h3><p>ç™»é™†æ³¨å†Œè¿‡ç¨‹å°±ä¸å¤šè¯´äº†<br>   é€‰æ‹©cityç‰ˆçš„å®‰è£…ï¼Œä¼šå¾—åˆ°ä¸€æ®µä»£ç  </p><h3 id="åœ¨ä¸ªäººåšå®¢ä¸­åŠ å…¥LiveReä»£ç "><a href="#åœ¨ä¸ªäººåšå®¢ä¸­åŠ å…¥LiveReä»£ç " class="headerlink" title="åœ¨ä¸ªäººåšå®¢ä¸­åŠ å…¥LiveReä»£ç "></a>åœ¨ä¸ªäººåšå®¢ä¸­åŠ å…¥LiveReä»£ç </h3><p>é¦–å…ˆå»å¦‚è·¯å¾„ï¼šhexo_bolg/themes/your-theme/layout/_partial/postä¸‹åˆ›å»ºlivere.ejsä»£ç ã€‚livere.ejsçš„å†…å®¹å°±æ˜¯ä¸Šä¸€æ­¥ä¸­è·å–çš„ä»£ç ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line"><!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  --></span><br><span class="line"><div id="lv-container" data-id="city" data-uid="MTAyMC8zMzM5MC85OTQ2"><br><span class="line">    <script type="text/javascript"></span><br><span class="line">   (function(d, s) {</span><br><span class="line">       var j, e = d.getElementsByTagName(s)[0];</span><br><span class="line"></span><br><span class="line">       if (typeof LivereTower === 'function') { return; }</span><br><span class="line"></span><br><span class="line">       j = d.createElement(s);</span><br><span class="line">       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';</span><br><span class="line">       j.async = true;</span><br><span class="line"></span><br><span class="line">       e.parentNode.insertBefore(j, e);</span><br><span class="line">   })(document, 'script');</span><br><span class="line">    </script></span><br><span class="line"><noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript></span><br><span class="line"></span></div></span><br><span class="line"><!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ --></span><br></pre></td></tr></tbody></table></figure></div><p>ç„¶åä¿®æ”¹è·¯å¾„ï¼šhexo_bolg/themes/your-theme/layout/_partialä¸‹çš„article.ejsæ–‡ä»¶ï¼Œåœ¨<code><% if (!index && post.comments){ %></code> ä»£ç å—ä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line"><% if (!index){ %></span><br><span class="line">  <% if (post.comments){ %></span><br><span class="line">  <%- partial('post/livere') %></span><br><span class="line">  <% } else { %></span><br><span class="line">    <div class="lv-container"></div></span><br><span class="line">  <% } %></span><br><span class="line"><% } %></span><br></pre></td></tr></tbody></table></figure></div><p><img alt data-src="http://p0.cdn.img9.top/ipfs/QmWwSjQj5zqz5mAgEtYjgTBRXRqBapvZMaEzArt8xRqQm2?0.jpg" src="/img/loading.gif" class="lazyload"></p><p><del>æ­¤æ—¶LiveReå·²ç»æ·»åŠ OKäº†ï¼Œé‡æ–°éƒ¨ç½²ä½ çš„åšå®¢ç„¶ååˆ·æ–°é¡µé¢å°±å¯ä»¥çœ‹åˆ°åšå®¢ä¸­æ·»åŠ å¥½äº†LiveReè¯„è®º</del><br>æ¢äº† Valine</p></body></html>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nmapå­¦ä¹ </title>
      <link href="/2018/06/17/nmap-xue-xi/"/>
      <url>/2018/06/17/nmap-xue-xi/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="Nmapç®€ä»‹"><a href="#Nmapç®€ä»‹" class="headerlink" title="Nmapç®€ä»‹"></a>Nmapç®€ä»‹</h2><p>   Nmapæ˜¯ä¸€ä¸ªå¼€æºå…è´¹çš„ç½‘ç»œå‘ç°å’Œå®‰å…¨å®¡è®¡å·¥å…· ï¼Œ å…¨ç§°æ˜¯NetWork  Mapper , é‡‡ç”¨c++è¯­è¨€ç¼–å†™ã€‚çº¯å‘½ä»¤è¡Œç•Œé¢ï¼ŒNmapå®˜æ–¹æä¾›äº†ä¸€ä¸ªZenmapçš„å›¾å½¢ç•Œé¢ã€‚</p><ul><li>å…³äºç«¯å£<br>  Â·    é»˜è®¤æƒ…å†µä¸‹ï¼ŒNampä¼šæ‰«æ1000ä¸ªæœ€æœ‰å¯èƒ½å¼€æ”¾çš„TCPç«¯å£<br>Â·   openï¼šå¼€æ”¾<br>Â·   closedï¼šå…³é—­<br>Â·   filteredï¼šè¢«å±è”½<br>Â·   unfilteredï¼šæ²¡æœ‰å±è”½è¿˜éœ€è¦ç¡®è®¤<br>Â·   open | filtered : å¼€æ”¾æˆ–è€…å±è”½<br>Â·   close | filtered : å…³é—­æˆ–å±è”½<h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><ul><li>ä¸»æœºæ‰«æ</li></ul><ol><li>nmap  192.168.1.100 ç›´æ¥æ‰«æï¼Œä¼šæ‰«æå¸¸ç”¨å‰1000ä¸ªç«¯å£ æ‰«ææˆ‘çš„å®¿ä¸»æœº</li></ol></li></ul><ol start="2"><li>nmap -F 192.168.1.100  å¿«é€Ÿæ‰«æï¼Œä¼šæ‰«æå¸¸ç”¨çš„å‰100ä¸ªç«¯å£</li><li>-v  æ˜¾ç¤ºæ‰«æè¿‡ç¨‹<br>root@kali:~# nmap -v -F  192.168.1.100<br>Starting Nmap 7.70 ( <a href="https://nmap.org" target="_blank" rel="noopener">https://nmap.org</a> ) at 2018-06-17 00:55 EDT<br>Initiating Ping Scan at 00:55<br>Scanning 192.168.1.100 [4 ports]<br>Completed Ping Scan at 00:55, 0.05s elapsed (1 total hosts)<br>Initiating Parallel DNS resolution of 1 host. at 00:55<br>Completed Parallel DNS resolution of 1 host. at 00:55, 0.01s elapsed<br>Initiating SYN Stealth Scan at 00:55<br>Scanning 192.168.1.100 [100 ports]<br>Discovered open port 135/tcp on 192.168.1.100<br>Discovered open port 139/tcp on 192.168.1.100<br>Discovered open port 445/tcp on 192.168.1.100<br>Discovered open port 3306/tcp on 192.168.1.100<br>Discovered open port 443/tcp on 192.168.1.100<br>Increasing send delay for 192.168.1.100 from 0 to 5 due to 43 out of 142 dropped probes since last increase.<br>Completed SYN Stealth Scan at 00:55, 7.68s elapsed (100 total ports)<br>Nmap scan report for 192.168.1.100<br>Host is up (1.8s latency).<br>Not shown: 94 closed ports<br>PORT     STATE    SERVICE<br>135/tcp  open     msrpc<br>139/tcp  open     netbios-ssn<br>443/tcp  open     https<br>445/tcp  open     microsoft-ds<br>514/tcp  filtered shell<br>3306/tcp open     mysql<br>Read data files from: /usr/bin/../share/nmap<br>Nmap done: 1 IP address (1 host up) scanned in 7.88 seconds<br>Raw packets sent: 166 (7.280KB) | Rcvd: 163 (6.688KB)</li><li>-sV  è¿”å›ç«¯å£å¯¹åº”çš„æœåŠ¡ä¿¡æ¯ï¼ˆå¥½æ…¢ï¼‰</li><li>-O  è¿”å›å¯¹åº”æœåŠ¡çš„ç³»ç»Ÿä¿¡æ¯</li></ol><ul><li>ä¸»æœºå‘ç°<br>  æˆ‘ä»¬å¯ä»¥é€šè¿‡nampæ¥å—…æ¢æ•´ä¸ªå±€åŸŸç½‘ï¼Œæ‰«æå‡ºå±€åŸŸç½‘ä¸­åœ¨çº¿çš„ä¸»æœºï¼Œé€šè¿‡ICMP ECHOæ‰«æå‡ºåœ¨çº¿çš„ä¸»æœº ï¼ˆpingçš„åº•å±‚åŸç†ï¼‰ <ol><li>nmap -sS 192.168.1.100 éšè”½æ‰«æ -sS ï¼Œä¹Ÿå°±æ˜¯SYNæ‰«æï¼Œåªç®¡å‘é€æ•°æ®åŒ…</li><li>æŸ¥çœ‹å­˜æ´»ä¸»æœº<br>nmap -sP 192.168.239.* æˆ–è€… 192.168.239.0/24</li><li>æ‰«æä¸»æœºçš„æ‰€æœ‰ç«¯å£<br>nmap -p 1-65535 192.168.239.133</li><li>æ‰«æä¸»æœºçš„æ“ä½œç³»ç»Ÿ<br>nmap -O 192.168.239.133</li><li>æŸ¥çœ‹ä¸»æœºä¸ªæœåŠ¡çš„ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯<br>nmap -sV 192.168.239.133</li></ol></li><li>å¸¸è§çš„Nmapæ‰«æç±»å‹å‚æ•°<br>-sT :TCP connectæ‰«æ ï¼Œç±»ä¼¼Metasploitä¸­çš„tcpæ‰«æ<br>-sS : TCP SYNæ‰«æï¼Œç±»ä¼¼äºMetasploit ä¸­çš„synæ‰«ææ¨¡å—<br>-sF/-sX/-sN : è¿™äº›æ‰«æé€šè¿‡å‘é€ä¸€äº›ç‰¹æ®Šçš„æ ‡å¿—ä½ä»¥é¿å¼€è®¾å¤‡æˆ–è½¯ä»¶çš„ç›‘æµ‹<br>-sP :é€šè¿‡å‘é€ICMP echo è¯·æ±‚æ¢æµ‹ä¸»æœºæ˜¯å¦å­˜è´§åŸç†åŒPing.<br>-sU :æ¢æµ‹ä¸»æœºå¼€æ”¾äº†é‚£äº›UDPç«¯å£ã€‚<br>-sA : TCP ACK æ‰«æï¼Œç±»ä¼¼ä¸Metasploité‡Œçš„ackæ‰«ææ¨¡å—<ul><li>å¸¸è§çš„Nmapæ‰«æé€‰é¡¹</li></ul></li><li>Pn : åœ¨æ‰«æä¹‹å‰ä¸å‘é€ICMP echoè¯·æ±‚æµ‹è¯•ç›®æ ‡æ˜¯å¦æ´»è·ƒ</li><li>O ï¼šå¯ç”¨å¯¹äºTCP/IP åè®®æ ˆçš„ç‰¹å¾æ‰«æä»¥è·å–è¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿ</li><li>F ï¼šå¿«é€Ÿæ‰«æ</li><li>p ï¼šç«¯å£èŒƒå›´</li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kali </tag>
            
            <tag> Nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisé›†ç¾¤æ­å»º</title>
      <link href="/2018/05/27/redis-ji-qun-da-jian/"/>
      <url>/2018/05/27/redis-ji-qun-da-jian/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="Redisé›†ç¾¤æ­å»º"><a href="#Redisé›†ç¾¤æ­å»º" class="headerlink" title="Redisé›†ç¾¤æ­å»º"></a>Redisé›†ç¾¤æ­å»º</h1><h1 id="ä¸€ã€Redisç®€ä»‹"><a href="#ä¸€ã€Redisç®€ä»‹" class="headerlink" title="ä¸€ã€Redisç®€ä»‹"></a>ä¸€ã€Redisç®€ä»‹</h1><h3 id="1ï¼å…³äºå…³ç³»å‹æ•°æ®åº“å’Œnosqlæ•°æ®åº“"><a href="#1ï¼å…³äºå…³ç³»å‹æ•°æ®åº“å’Œnosqlæ•°æ®åº“" class="headerlink" title="1ï¼å…³äºå…³ç³»å‹æ•°æ®åº“å’Œnosqlæ•°æ®åº“"></a>1ï¼å…³äºå…³ç³»å‹æ•°æ®åº“å’Œnosqlæ•°æ®åº“</h3><p>   å…³ç³»å‹æ•°æ®åº“æ˜¯åŸºäºå…³ç³»è¡¨çš„æ•°æ®åº“ï¼Œæœ€ç»ˆä¼šå°†æ•°æ®æŒä¹…åŒ–åˆ°<a href>ç£ç›˜</a>ä¸Šï¼Œè€Œnosqlæ•°æ®  åº“æ˜¯åŸºäºç‰¹æ®Šçš„ç»“æ„ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åˆ°<a href>å†…å­˜</a>çš„æ•°æ®åº“ã€‚ä»æ€§èƒ½ä¸Šè€Œè¨€ï¼Œnosqlæ•°æ®åº“  è¦ä¼˜äºå…³ç³»å‹æ•°æ®åº“ï¼Œä»å®‰å…¨æ€§ä¸Šè€Œè¨€å…³ç³»å‹æ•°æ®åº“è¦ä¼˜äºnosqlæ•°æ®åº“ï¼Œæ‰€ä»¥åœ¨å®  é™…å¼€å‘ä¸­ä¸€ä¸ªé¡¹ç›®ä¸­nosqlå’Œå…³ç³»å‹æ•°æ®åº“ä¼šä¸€èµ·ä½¿ç”¨ï¼Œè¾¾åˆ°æ€§èƒ½å’Œå®‰å…¨æ€§çš„åŒä¿è¯</p><h3 id="2-Redisçš„å®‰è£…"><a href="#2-Redisçš„å®‰è£…" class="headerlink" title="2 . Redisçš„å®‰è£…"></a>2 . Redisçš„å®‰è£…</h3><p>è¿™é‡Œå…³äºRedisçš„å®‰è£…ä¸æƒ³å¤šè¯´ï¼Œå®é™…ç”Ÿäº§ä¸­éƒ½æ˜¯å°†Reidså®‰è£…åœ¨Linuxä¸Šçš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯è¯´é›†ç¾¤çš„æ­å»ºã€‚</p><h3 id="3-Redisçš„ä½¿ç”¨"><a href="#3-Redisçš„ä½¿ç”¨" class="headerlink" title="3. Redisçš„ä½¿ç”¨"></a>3. Redisçš„ä½¿ç”¨</h3><p>   æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦Redisï¼Œä½¿ç”¨å…¶å®ä¹Ÿæ²¡ä»€ä¹ˆè¯´çš„ <a href="http://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener">èœé¸Ÿæ•™ç¨‹</a>ä¸Šéƒ½æœ‰ï¼ŒæŒºç®€å•çš„ã€‚</p><h3 id="3-é›†ç¾¤çš„æ­å»º"><a href="#3-é›†ç¾¤çš„æ­å»º" class="headerlink" title="3. é›†ç¾¤çš„æ­å»º"></a>3. é›†ç¾¤çš„æ­å»º</h3><p>Redisè¦åšé›†ç¾¤å¿…é¡»è¦æœ‰è‡³å°‘ä¸‰ä¸ªèŠ‚ç‚¹å¦åˆ™ä»–çš„æŠ•ç¥¨æœºåˆ¶æ— æ³•è¿è¡Œ<br>å¿…é¡»è¦æœ‰è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½è®¤ä¸ºæŸä¸€å°Redisæœºå™¨æŒ‚æ‰äº†æ‰ä¼šè®¤ä¸ºé›†ç¾¤æŒ‚æ‰äº†<br><img alt="Redis" data-src="http://p3.cdn.img9.top/ipfs/QmX5E7BViadysS6bZLs7Eeu1VSkvCHEEcUrkSVgWBjwNCx?3.png" src="/img/loading.gif" class="lazyload"></p><p>è¿™é‡Œå†çœ‹çœ‹Redisé›†ç¾¤çš„æ¶æ„å›¾<img alt="Redis" data-src="http://p3.cdn.img9.top/ipfs/QmZ6PpYPozPHppvXGRBMY5LgnrsjAqDaT2s1NoUCT8EFuD?3.png" src="/img/loading.gif" class="lazyload"><br>æ¶æ„ç»†èŠ‚:</p><p>(1)æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½.</p><p>(2)èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ.</p><p>(3)å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯</p><p>(4)redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Š,cluster è´Ÿè´£ç»´æŠ¤node<->slot<->value<br>Redis é›†ç¾¤ä¸­å†…ç½®äº† 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œredis å…ˆå¯¹ key ä½¿ç”¨ crc16 ç®—æ³•ç®—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œredis ä¼šæ ¹æ®èŠ‚ç‚¹æ•°é‡å¤§è‡´å‡ç­‰çš„å°†å“ˆå¸Œæ§½æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥RedisèŠ‚ç‚¹æœ€å¤šä¹Ÿå°±16384ä¸ªèŠ‚ç‚¹æœ€å°‘3ä¸ªèŠ‚ç‚¹ã€‚</p><ul><li>å¼€å§‹æ­å»º<br>è¿™é‡Œæ­å»ºçš„æ˜¯æœ‰3ä¸ªèŠ‚ç‚¹çš„æœ€å°çš„é›†ç¾¤ä¸ºä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€å°å¤‡ä»½æœºä¸€å…±éœ€è¦6å°æœåŠ¡å™¨ï¼Œå°±éœ€è¦å¼€6ä¸ªè™šæ‹Ÿæœºè¿™é‡Œå…¶å®åšæµ‹è¯•æ²¡é‚£ä¸ªå¿…è¦ï¼Œæ­å»ºä¸€ä¸ªä¼ªåˆ†å¸ƒå¼çš„å°±å¯ä»¥äº†ï¼Œåœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šæ­å»º6ä¸ªRediså®ä¾‹</li><li>é›†ç¾¤æ­å»ºç¯å¢ƒ<br>1ã€ä½¿ç”¨rubyè„šæœ¬æ­å»ºé›†ç¾¤ã€‚éœ€è¦rubyçš„è¿è¡Œç¯å¢ƒã€‚<br>å®‰è£…ruby<br>yum install ruby<br>yum install rubygems<br>(æˆ‘è™šæ‹Ÿæœºyumçš„æ—¶å€™ä¸€ç›´æŠ¥é”™æ— æ³•è§£æï¼Œç„¶ååŠ äº†DNSåæŠ¥404å¾ˆå¥‡æ€ª ç„¶åyum makecacheåå°±å¥½äº†)<br>2ã€å®‰è£…rubyè„šæœ¬è¿è¡Œä½¿ç”¨çš„åŒ…<a href="https://pan.baidu.com/s/1bW6EUyeEevR5h1cT-g51mQ" target="_blank" rel="noopener">redis-3.0.0.gem</a>ã€‚<br>gem install redis-3.0.0.gem<br>è¿™ä¸ªè„šæœ¬åœ¨ä½ Redisæºä»£ç çš„srcç›®å½•ä¸‹redis-trib.rbè¿™ä¸ªè„šæœ¬<br>3ã€åˆ›å»º6ä¸ªRediså®ä¾‹<br>ç›´æ¥copy5ä»½ç¼–è¯‘åçš„Redisæ–‡ä»¶ç„¶åæ”¹ä¸‹ç«¯å£ æŠŠredis.conf(åœ¨Redisæºä»£ç ä¸‹copyè¿‡æ¥)é‡Œ cluster-enabled yeså‰æ³¨é‡Šå»æ‰<br>3 ã€å¯åŠ¨6ä¸ªRedisè¿™é‡Œå¯ä»¥å†™ä¸€ä¸ªshell<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">cd redis01</span><br><span class="line">./redis-server redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd redis02</span><br><span class="line">./redis-server redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd redis03</span><br><span class="line">./redis-server redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd redis04</span><br><span class="line">./redis-server redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd redis05</span><br><span class="line">./redis-server redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd redis06</span><br><span class="line">./redis-server redis.conf</span><br><span class="line">cd ..</span><br></pre></td></tr></tbody></table></figure></div>4ã€ç”¨Rubyæ­å»ºé›†ç¾¤ åªéœ€è¦è¿™æ¡å‘½ä»¤é›†ç¾¤å°±æ­å»ºå®Œæ¯•äº†<br>./redis-trib.rb create â€“replicas 1 192.168.25.3:7001 192.168.25.3:7002 192.168.25.3:7003 192.168.25.3:7004 192.168.25.3:7005 192.168.25.3:7006<br>è¡¥ ï¼šè¿™é‡Œçš„ipä¸è¦å†™127.0.0.1 ä¸ç„¶è¿æ¥é›†ç¾¤çš„æ—¶å€™å°±ä¼šæŠ¥Too many Cluster redirections?é”™è¯¯ äº²æµ‹ã€‚ã€‚ã€‚æˆ‘ä¸æ˜¯å†™çš„127.0.0.1æˆ‘æ˜¯å› ä¸ºåæ¥è™šæ‹Ÿæœºipå˜äº†ç„¶å<br>replicasåé¢å‚æ•°1ä»£è¡¨æ¯ä¸ªèŠ‚ç‚¹ä¼šæœ‰ä¸€å°å¤‡ä»½æœºæ‰€ä»¥åé¢çš„ipå’Œç«¯å£å·å¿…é¡»æ˜¯å¶æ•°<h3 id="4-é›†ç¾¤çš„ä½¿ç”¨"><a href="#4-é›†ç¾¤çš„ä½¿ç”¨" class="headerlink" title="4. é›†ç¾¤çš„ä½¿ç”¨"></a>4. é›†ç¾¤çš„ä½¿ç”¨</h3>  redis01/redis-cli -p 7002 -c<br>åé¢çš„cä»£è¡¨è¿æ¥çš„æ˜¯é›†ç¾¤ å¦‚æœä¸åŠ cå°±æ˜¯å•æœºçš„ å¦‚æœå­˜å…¥æ•°æ®çš„æ§½ä½ä¸å¯¹åº”å°±ä¼šæŠ¥é”™å½“ç„¶è¿™æ˜¯åœ¨å‘½ä»¤è¡Œä¸‹çš„ä½¿ç”¨ï¼Œwindowsä¸‹ä¹Ÿæœ‰ä¸€äº›Redisçš„å®¢æˆ·ç«¯ã€‚è¿™é‡Œä¸»è¦è®²ç”¨Javaä»£ç è¿æ¥Redisè¿™å°±è¦ç”¨åˆ°Jedisäº†è·ŸJDBCé‚£ä¸€å¥—å·®ä¸å¤š è¿™é‡Œç›´æ¥è®²åœ¨æ·˜æ·˜ä¸­å®é™…æ˜¯æ€ä¹ˆç”¨çš„å§<br>è¿™é‡Œæœ‰ä¸¤ä¸ªç‰ˆæœ¬é›†ç¾¤ç‰ˆå’Œå•æœºç‰ˆ å¹³å¸¸æµ‹è¯•å°±ç”¨å•æœºç‰ˆæ‰€ä»¥å¯ä»¥å…ˆå†™ä¸€ä¸ªæ¥å£ï¼ŒæŠ½å–ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> redis;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JedisClient</span> </span>{</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">set</span><span class="params">(String key, String value)</span></span>;</span><br><span class="line"><span class="function">String <span class="title">get</span><span class="params">(String key)</span></span>;</span><br><span class="line"><span class="function">Boolean <span class="title">exists</span><span class="params">(String key)</span></span>;</span><br><span class="line"><span class="function">Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> seconds)</span></span>;</span><br><span class="line"><span class="function">Long <span class="title">ttl</span><span class="params">(String key)</span></span>;</span><br><span class="line"><span class="function">Long <span class="title">incr</span><span class="params">(String key)</span></span>;</span><br><span class="line"><span class="function">Long <span class="title">hset</span><span class="params">(String key, String field, String value)</span></span>;</span><br><span class="line"><span class="function">String <span class="title">hget</span><span class="params">(String key, String field)</span></span>;</span><br><span class="line"><span class="function">Long <span class="title">hdel</span><span class="params">(String key, String... field)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>ç„¶åå†™å„è‡ªçš„å®ç°ç±»</p><ul><li>å•æœºç‰ˆ</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> redis;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientPool</span> <span class="keyword">implements</span> <span class="title">JedisClient</span> </span>{</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">String result = jedis.set(key, value);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">String result = jedis.get(key);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">exists</span><span class="params">(String key)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">Boolean result = jedis.exists(key);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> seconds)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">Long result = jedis.expire(key, seconds);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">Long result = jedis.ttl(key);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">Long result = jedis.incr(key);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String field, String value)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">Long result = jedis.hset(key, field, value);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String field)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">String result = jedis.hget(key, field);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">hdel</span><span class="params">(String key, String... field)</span> </span>{</span><br><span class="line">Jedis jedis = jedisPool.getResource();</span><br><span class="line">Long result = jedis.hdel(key, field);</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><ul><li>é›†ç¾¤ç‰ˆ</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> redis;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientCluster</span> <span class="keyword">implements</span> <span class="title">JedisClient</span> </span>{</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> JedisCluster jedisCluster;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.set(key, value);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.get(key);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">exists</span><span class="params">(String key)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.exists(key);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> seconds)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.expire(key, seconds);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.ttl(key);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.incr(key);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String field, String value)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.hset(key, field, value);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String field)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.hget(key, field);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">hdel</span><span class="params">(String key, String... field)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> jedisCluster.hdel(key, field);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><ul><li>ä½¿ç”¨<br> ä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥å†™ä¸ªbeanç„¶ååœ¨éœ€è¦çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥æ³¨å…¥äº†</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!--?xml version=<span class="string"-->"1.0"</span> encoding=<span class="string">"UTF-8"</span>?><br><span class="line"><beans xmlns="<span" class="string">"http://www.springframework.org/schema/beans"</beans></span><br><span class="line">xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">xmlns:p=<span class="string">"http://www.springframework.org/schema/p"</span></span><br><span class="line">xmlns:aop=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">xmlns:tx=<span class="string">"http://www.springframework.org/schema/tx"</span></span><br><span class="line">xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">xmlns:mybatis-spring=<span class="string">"http://mybatis.org/schema/mybatis-spring"</span></span><br><span class="line">xsi:schemaLocation=<span class="string">"http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.2.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.2.xsd"</span>></span><br><span class="line"><!--å•æœºç‰ˆ--></span><br><span class="line">    <!-- <bean id=<span class="string">"jedisClientPool"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"redis.JedisClientPool"</span>></span><br><span class="line"><property name=<span class="string">"jedisPool"</span> ref=<span class="string">"jedisPool"</span> /></span><br><span class="line"></bean></span><br><span class="line"><bean id=<span class="string">"jedisPool"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"redis.clients.jedis.JedisPool"</span>></span><br><span class="line"><constructor-arg name=<span class="string">"host"</span> value=<span class="string">"192.168.25.4"</span>/></span><br><span class="line"><constructor-arg name=<span class="string">"port"</span> value=<span class="string">"6379"</span>/></span><br><span class="line"></bean> --></span><br><span class="line"><!--é›†ç¾¤ç‰ˆ--></span><br><span class="line"><bean id="<span" class="string">"jedisClientCluster"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"redis.JedisClientCluster"</span>><br><span class="line"><property name="<span" class="string">"jedisCluster"</property></span> ref=<span class="string">"jedisCluster"</span>/><br><span class="line"></span><br><span class="line"></span><br><span class="line"><bean id="<span" class="string">"jedisCluster"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"redis.clients.jedis.JedisCluster"</span>><br><span class="line"><constructor-arg name="<span" class="string">"nodes"</constructor-arg></span>><br><span class="line"><set></set></span><br><span class="line"><bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>><br><span class="line"><constructor-arg name="<span" class="string">"host"</constructor-arg></span> value=<span class="string">"192.168.25.4"</span>/><br><span class="line"><constructor-arg name="<span" class="string">"port"</constructor-arg></span> value=<span class="string">"7001"</span>/><br><span class="line"></span><br><span class="line"><bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>><br><span class="line"><constructor-arg name="<span" class="string">"host"</constructor-arg></span> value=<span class="string">"192.168.25.4"</span>/><br><span class="line"><constructor-arg name="<span" class="string">"port"</constructor-arg></span> value=<span class="string">"7002"</span>/><br><span class="line"></span><br><span class="line"><bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>><br><span class="line"><constructor-arg name="<span" class="string">"host"</constructor-arg></span> value=<span class="string">"192.168.25.4"</span>/><br><span class="line"><constructor-arg name="<span" class="string">"port"</constructor-arg></span> value=<span class="string">"7003"</span>/><br><span class="line"></span><br><span class="line"><bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>><br><span class="line"><constructor-arg name="<span" class="string">"host"</constructor-arg></span> value=<span class="string">"192.168.25.4"</span>/><br><span class="line"><constructor-arg name="<span" class="string">"port"</constructor-arg></span> value=<span class="string">"7004"</span>/><br><span class="line"></span><br><span class="line"><bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>><br><span class="line"><constructor-arg name="<span" class="string">"host"</constructor-arg></span> value=<span class="string">"192.168.25.4"</span>/><br><span class="line"><constructor-arg name="<span" class="string">"port"</constructor-arg></span> value=<span class="string">"7005"</span>/><br><span class="line"></span><br><span class="line"><bean <span class="class"><span class="keyword">class</span></bean></span>=<span class="string">"redis.clients.jedis.HostAndPort"</span>><br><span class="line"><constructor-arg name="<span" class="string">"host"</constructor-arg></span> value=<span class="string">"192.168.25.4"</span>/><br><span class="line"><constructor-arg name="<span" class="string">"port"</constructor-arg></span> value=<span class="string">"7006"</span>/><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œåœ¨é›†ç¾¤çš„æ—¶å€™é‡åˆ°äº†é—®é¢˜å°±æ˜¯æˆ‘ä¸Šé¢æåˆ°çš„ipçš„é—®é¢˜ä¸è¦å†™127.0.0.1è¦å†™å®é™…çš„å†…ç½‘ipä»¥åå¦‚æœipå˜äº†å°±åªèƒ½é‡æ–°æ¥ä¸€æ¬¡äº†ï¼Œé‚£ä¸ªå‘½ä»¤æˆ‘è¯•äº†ä¸‹æ‰§è¡Œç¬¬äºŒæ¬¡ï¼ŒæŠ¥é”™è¯´æˆ‘é‚£ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œ<strong>ä¹Ÿè®¸</strong>æŠŠæ•°æ®æ¸…ç©ºäº†å°±å¯ä»¥äº†ã€‚</p><ul><li>æµ‹è¯•<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRedis</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–Springå®¹å™¨</span></span><br><span class="line">ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:spring/applicationContext-redis.xml"</span>);</span><br><span class="line"><span class="comment">//ä»å®¹å™¨ä¸­è·å–jedisClientå¯¹è±¡ (å•æœºç‰ˆ) </span></span><br><span class="line">JedisClient jedisClient=applicationContext.getBean(JedisClient<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">jedisClient.set(<span class="string">"testRedis"</span>, <span class="string">"Hello World"</span>);</span><br><span class="line">System.out.println(jedisClient.get(<span class="string">"testRedis"</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·˜æ·˜å•†åŸ </tag>
            
            <tag> Redis </tag>
            
            <tag> é›†ç¾¤æ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatisé€†å‘å·¥ç¨‹å¯¹textçš„ç‰¹æ®Šå¤„ç†</title>
      <link href="/2018/05/23/mybatis-ni-xiang-gong-cheng-dui-text-de-te-shu-chu-li/"/>
      <url>/2018/05/23/mybatis-ni-xiang-gong-cheng-dui-text-de-te-shu-chu-li/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="Mybatiså¯¹Mysqlä¸­textç±»å‹çš„ç‰¹æ®Šå¤„ç†"><a href="#Mybatiså¯¹Mysqlä¸­textç±»å‹çš„ç‰¹æ®Šå¤„ç†" class="headerlink" title="Mybatiså¯¹Mysqlä¸­textç±»å‹çš„ç‰¹æ®Šå¤„ç†"></a>Mybatiså¯¹Mysqlä¸­textç±»å‹çš„ç‰¹æ®Šå¤„ç†</h1><ul><li>æ˜¨å¤©æ™šä¸Šåœ¨åšcmsçš„crudçš„æ—¶å€™é‡åˆ°çš„é—®é¢˜ï¼Œç¼–è¾‘çš„æ—¶å€™ä¸å›æ˜¾å†…å®¹ï¼Œç„¶åf12çœ‹äº†ä¸‹å“åº”çš„jsoné‡Œé¢contentä¹Ÿä¸ºnullï¼Œç„¶åå»serviceé‡Œé¢æŠŠé‚£ä¸ªpojoåŠ äº†toStringæŠŠå‡ æ¡æ•°æ®ç›´æ¥æ‰“å°å‡ºæ¥ å› ä¸ºç”¨äº†åˆ†é¡µç„¶åæ‰“å°å‡ºæ¥çš„ä¹Ÿå¹¶ä¸æ˜¯æ•°æ®</li></ul><p>ï¼ˆä¸‹æ¬¡å†æ¥æ¢ç©¶åˆ†é¡µæ’ä»¶ï¼‰ ç„¶åæ³¨é‡Šæ‰åœ¨æ‰“å°å‘ç°è¿˜æ˜¯æ²¡æœ‰ç„¶åæˆ‘è¯•äº†ä¸‹å•ç‹¬æŸ¥è¯¢ï¼Œæ ¹æ®ä¸»é”®æŸ¥è¯¢æŸ¥å‡ºæ¥çš„å±…ç„¶ç”¨æœ‰ï¼ï¼ï¼è¿™å°±å¾ˆå¥‡æ€ªäº†ã€‚ã€‚ã€‚æˆ‘å½“æ—¶å°±ä»¥ä¸ºæ˜¯byexampleçš„mapperæœ‰é—®é¢˜ å“ˆå“ˆå“ˆ~~ å…¶å®è¿˜æ˜¯è‡ªå·±æ¡†æ¶å­¦çš„ä¸å¥½çš„é—®é¢˜</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> EasyUIJsonResult <span class="title">listContent</span><span class="params">(<span class="keyword">long</span> categoryId,<span class="keyword">int</span> page,<span class="keyword">int</span> rows)</span> </span>{</span><br><span class="line">EasyUIJsonResult result=<span class="keyword">new</span> EasyUIJsonResult();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°PageHelperçš„ä¸€äº›é—®é¢˜ ç­‰ä¸‹å†æ¥ç ”ç©¶</span></span><br><span class="line"><span class="comment">//PageHelper.startPage(page, rows);</span></span><br><span class="line">TbContentExample example =<span class="keyword">new</span> TbContentExample();</span><br><span class="line">example.createCriteria().andCategoryIdEqualTo(categoryId);</span><br><span class="line">List<tbcontent> contents = dao.selectByExample(example);</tbcontent></span><br><span class="line">PageInfo<tbcontent> info=<span class="keyword">new</span> PageInfo<>(contents);</tbcontent></span><br><span class="line"></span><br><span class="line"><span class="comment">//åŠ ä¸ŠPageHelperåè¿™é‡Œæ‰“å°å‡ºæ¥çš„å°±ä¸æ˜¯contentså¯¹è±¡äº†å°±æ˜¯Pageå¯¹è±¡</span></span><br><span class="line"><span class="comment">//è€Œä¸”æŸ¥å‡ºæ¥çš„æ•°æ®é‡Œé¢contentä¸ºnull (æ•°æ®åº“ä¸­æœ‰ çŒœæƒ³å¯èƒ½æ˜¯é€†å‘å·¥ç¨‹æœ‰é—®é¢˜);</span></span><br><span class="line">System.out.println(contents);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•ä¸‹å•ç‹¬æŸ¥è¯¢ ä¸»é”®æŸ¥è¯¢æ²¡é—®é¢˜ å–çš„åˆ°content</span></span><br><span class="line">System.out.println(dao.selectByPrimaryKey((<span class="keyword">long</span>)<span class="number">42</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//å•ç‹¬æµ‹è¯•ä¸‹åªæŸ¥ä¸€ä¸ª    ä¹Ÿæ²¡æœ‰</span></span><br><span class="line">TbContentExample example2 =<span class="keyword">new</span> TbContentExample();</span><br><span class="line">Criteria criteria2 = example2.createCriteria();</span><br><span class="line">criteria2.andCategoryIdEqualTo((<span class="keyword">long</span>)<span class="number">90</span>);</span><br><span class="line">System.out.println(dao.selectByExample(example2 ));</span><br><span class="line"></span><br><span class="line">result.setTotal(info.getTotal());</span><br><span class="line">result.setRows(contents);</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><ul><li>ç„¶åå°±é¢å‘ç™¾åº¦äº†ä¸€æ³¢ï¼Œè¿˜çœŸå°±æŸ¥åˆ°äº†é‡åˆ°è·Ÿæˆ‘ä¸€æ ·çš„é—®é¢˜<a href="https://ask.csdn.net/questions/205320" target="_blank" rel="noopener">åŒé“ä¸­äºº</a><br>selectByExampleWithBLOBsç”¨è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥äº† çœ‹åå­—å°±çŸ¥é“æ›´è¿™ä¸ªæœ‰å…³å“ˆå“ˆå“ˆ<br>ç„¶åå°±æ„‰å¿«çš„è§£å†³äº†<img alt="image" data-src="http://p1.cdn.img9.top/ipfs/QmVhiMUQoFbiHc8BJxFtSzCUxVrZffnj9vYD7yM5YmCjGL?1.png" src="/img/loading.gif" class="lazyload"></li><li>ä¸ä»…ä»…æ˜¯select updateä¹Ÿæœ‰è¿™ä¸ªæ–¹æ³•<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TbContentMapper</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countByExample</span><span class="params">(TbContentExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByExample</span><span class="params">(TbContentExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(TbContent record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(TbContent record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<tbcontent> <span class="title">selectByExampleWithBLOBs</span><span class="params">(TbContentExample example)</span></tbcontent></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List<tbcontent> <span class="title">selectByExample</span><span class="params">(TbContentExample example)</span></tbcontent></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">TbContent <span class="title">selectByPrimaryKey</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByExampleSelective</span><span class="params">(@Param(<span class="string">"record"</span>)</span> TbContent record, @<span class="title">Param</span><span class="params">(<span class="string">"example"</span>)</span> TbContentExample example)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByExampleWithBLOBs</span><span class="params">(@Param(<span class="string">"record"</span>)</span> TbContent record, @<span class="title">Param</span><span class="params">(<span class="string">"example"</span>)</span> TbContentExample example)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByExample</span><span class="params">(@Param(<span class="string">"record"</span>)</span> TbContent record, @<span class="title">Param</span><span class="params">(<span class="string">"example"</span>)</span> TbContentExample example)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(TbContent record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeyWithBLOBs</span><span class="params">(TbContent record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(TbContent record)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯ </tag>
            
            <tag> æ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC - å¤„ç†é™æ€èµ„æº (è½¬)</title>
      <link href="/2018/05/21/springmvc-chu-li-jing-tai-zi-yuan/"/>
      <url>/2018/05/21/springmvc-chu-li-jing-tai-zi-yuan/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="ã€1ã€‘ç¬¬ä¸€ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"><a href="#ã€1ã€‘ç¬¬ä¸€ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•" class="headerlink" title="ã€1ã€‘ç¬¬ä¸€ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"></a><strong>ã€1ã€‘ç¬¬ä¸€ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•</strong></h2><p>å°†DispatcherServletè¯·æ±‚æ˜ å°„è®¾ç½®ä¸º / ï¼Œå°†ä¼šæ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ã€‚ä¸èƒ½è®¿é—®é™æ€èµ„æºã€‚</p><p><strong>è§£å†³åŠæ³•ï¼š</strong></p><p>åœ¨SpringMVCçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹æ ‡ç­¾è§£å†³</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><mvc:<span class="keyword">default</mvc:<span></span>-servlet-handler/><br></pre></td></tr></tbody></table></figure></div><p>å…¶XSDæ–‡æ¡£è¯´æ˜å¦‚ä¸‹:</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*é…ç½®ä¸€ä¸ªhandleré€šè¿‡è½¬å‘è¯·æ±‚åˆ°servletå®¹å™¨çš„é»˜è®¤servletæ¥å¤„ç†é™æ€èµ„æº*/</span></span><br><span class="line">Configures a handler <span class="keyword">for</span> serving <span class="keyword">static</span> resources by forwarding to the Servlet container<span class="string">'s default Servlet.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*ä½¿ç”¨è¯¥handlerå°†ä¼šå…è®¸DispatcherServlet çš„url-patternä¸º'</span>/<span class="string">';åŒæ—¶ä½¿ç”¨servletå®¹å™¨çš„é»˜è®¤servletå¤„ç†é™æ€èµ„æº*/</span></span><br><span class="line"><span class="string">Use of this handler allows using a "/" mapping with the DispatcherServlet </span></span><br><span class="line"><span class="string">while still utilizing the Servlet container to serve static resources. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*è¯¥handlerå°†ä¼šè½¬å‘æ‰€æœ‰è¯·æ±‚åˆ°é»˜è®¤servlet*/</span></span><br><span class="line"><span class="string">This handler will forward all requests to the default Servlet. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*å› æ­¤å°†è¯¥handlerçš„æ‰§è¡Œé¡ºåºæ”¾åˆ°æ‰€æœ‰è¯·æ±‚å¤„ç†çš„æœ€åæ˜¯éå¸¸é‡è¦çš„ï¼ï¼ï¼*/</span></span><br><span class="line"><span class="string">Therefore it is important that it remains last in the order of all other URL HandlerMappings. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*ä½¿ç”¨<mvc:annotation-driven>æ ‡ç­¾æˆ–è€…è®¾ç½®HandlerMapping instanceçš„orderæ¥ç¡®ä¿DefaultServletHttpRequestHandlerçš„orderæœ€å¤§ã€‚*/</mvc:annotation-driven></span></span><br><span class="line"><span class="string">That will be the case if you use the "annotation-driven" element </span></span><br><span class="line"><span class="string">or alternatively if you are setting up your customized HandlerMapping instance </span></span><br><span class="line"><span class="string">be sure to set its "order" property to a value lower than </span></span><br><span class="line"><span class="string">that of the DefaultServletHttpRequestHandler, which is Integer.MAX_VALUE.</span></span><br></pre></td></tr></tbody></table></figure></div><p><img alt="image" data-src="https://img-blog.csdn.net/20170914152551033?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" src="/img/loading.gif" class="lazyload"></p><p><strong>è§£é‡Šå¦‚ä¸‹ï¼š</strong></p><p><code><mvc:default-servlet-handler></mvc:default-servlet-handler></code>å°†åœ¨SpringMVCçš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸€ä¸ªDefaultServletHttpRequestHandleræ¥å¤„ç†é™æ€èµ„æº(å…¶å®å°±æ˜¯å°†è¯·æ±‚è½¬å‘ç»™é»˜è®¤çš„servlet)ã€‚</p><p>ä¸€èˆ¬WEBæœåŠ¡å™¨é»˜è®¤çš„servletçš„åç§°ä¸ºdefaultã€‚è‹¥æ‰€ä½¿ç”¨çš„WEBæœåŠ¡å™¨é»˜è®¤çš„Servletåç§°ä¸æ˜¯defaultï¼Œåˆ™éœ€è¦é€šè¿‡default-servlet-name å±æ€§æŒ‡å®šï¼</p><p><img alt="image" data-src="https://img-blog.csdn.net/20170224143539025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" src="/img/loading.gif" class="lazyload"></p><hr><p><strong>ä¸åŒæœåŠ¡å™¨ä¸‹é»˜è®¤servletåå­—å¯¹åº”å¦‚ä¸‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Tomcat, Jetty, JBoss, and GlassFish  é»˜è®¤ Servletçš„åå­— -- <span class="string">"default"</span></span><br><span class="line">Google App Engine é»˜è®¤ Servletçš„åå­— -- <span class="string">"_ah_default"</span></span><br><span class="line">Resin é»˜è®¤ Servletçš„åå­— -- <span class="string">"resin-file"</span></span><br><span class="line">WebLogic é»˜è®¤ Servletçš„åå­—  -- <span class="string">"FileServlet"</span></span><br><span class="line">WebSphere  é»˜è®¤ Servletçš„åå­— -- <span class="string">"SimpleFileServlet"</span></span><br></pre></td></tr></tbody></table></figure></div><p><img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" data-src="https://img-blog.csdn.net/20170914154653746?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" src="/img/loading.gif" class="lazyload"></p><hr><p><strong>ã€Tipsï¼šã€‘</strong></p><p>ä½¿ç”¨ä¸Šè¿°é…ç½®ï¼Œä½ ä¼šå‘ç°æ­£å¸¸çš„Controllerè·³è½¬å¤±æ•ˆäº†ï¼</p><p>XSDè¯´æ˜æœ€åä¸€æ®µè¯å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*ä½¿ç”¨<mvc:annotation-driven>æ ‡ç­¾æˆ–è€…è®¾ç½®HandlerMapping instanceçš„orderæ¥ç¡®ä¿DefaultServletHttpRequestHandlerçš„orderæœ€å¤§ã€‚*/</mvc:annotation-driven></span></span><br><span class="line">That will be the <span class="keyword">case</span> <span class="keyword">if</span> you use the <span class="string">"annotation-driven"</span> element </span><br><span class="line">or alternatively <span class="keyword">if</span> you are setting up your customized HandlerMapping instance </span><br><span class="line">be sure to set its <span class="string">"order"</span> property to a value lower than </span><br><span class="line">that of the DefaultServletHttpRequestHandler, which is Integer.MAX_VALUE.</span><br></pre></td></tr></tbody></table></figure></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆé…ç½®<code><mvc:annotation-driven></mvc:annotation-driven></code>æ ‡ç­¾ï¼Œè¦ä¹ˆæ‰‹åŠ¨æ³¨å†Œè¯·æ±‚æ˜ å°„å¤„ç†beanäºxmlä¸­ï¼Œå¹¶è®¾ç½®orderå±æ€§å€¼ï¼Œä»¥å…¶å®ç°æ¡†æ¶ä¸­å¤„ç†è¯·æ±‚æ˜ å°„çš„beançš„orderå€¼å°äºDefaultServletHttpRequestHandlerçš„orderå±æ€§å€¼ï¼ï¼ï¼</p><p>å¸¸ç”¨çš„è§£å†³æ–¹å¼ä¸ºé…ç½®<code><mvc:annotation-driven></mvc:annotation-driven></code>æ ‡ç­¾ï¼Œè¯¦æƒ…ç‚¹å‡»æŸ¥çœ‹<a href="http://blog.csdn.net/j080624/article/details/66969987" target="_blank" rel="noopener">è¯·æ±‚æ˜ å°„å¤±æ•ˆ</a>ã€‚</p><p>ç‚¹å‡»æŸ¥çœ‹<a href="http://blog.csdn.net/J080624/article/details/66969987" target="_blank" rel="noopener">controlleræ˜ å°„å¤±æ•ˆ</a></p><hr><h2 id="ã€2ã€‘ç¬¬äºŒç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"><a href="#ã€2ã€‘ç¬¬äºŒç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•" class="headerlink" title="ã€2ã€‘ç¬¬äºŒç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"></a><strong>ã€2ã€‘ç¬¬äºŒç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•</strong></h2><p>è§£å†³é™æ€èµ„æºçš„æ€è·¯æ˜¯ï¼Œåœ¨SpringMVC.xmlä¸­ï¼Œæ‹¦æˆªè®¾ç½®ä¸ºâ€*.doâ€ï¼Œè€Œä¸æ˜¯â€/â€ã€‚</p><p>è¿™æ ·å°±ä¸ä¼šæ‹¦æˆªé™æ€èµ„æºçš„è¯·æ±‚ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé¡¹ç›®ä¸­ç”¨åˆ°äº†shiroæˆ–è€…å…¶ä»–æƒé™æ¡†æ¶ã€‚é‚£ä¹ˆéœ€è¦æ³¨æ„ä½ çš„shiro.xmlé…ç½®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><bean id="<span" class="string">"shiroFilter"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>><br><span class="line">      <!-- Shiroçš„æ ¸å¿ƒå®‰å…¨æ¥å£,è¿™ä¸ªå±æ€§æ˜¯å¿…é¡»çš„ --></span><br><span class="line">      <property name="<span" class="string">"securityManager"</property></span> ref=<span class="string">"securityManager"</span>/><br><span class="line">      <!-- loginUrlè®¤è¯æäº¤åœ°å€ï¼Œå¦‚æœæ²¡æœ‰è®¤è¯å°†ä¼šè¯·æ±‚æ­¤åœ°å€è¿›è¡Œè®¤è¯ï¼Œè¯·æ±‚æ­¤åœ°å€å°†ç”±formAuthenticationFilterè¿›è¡Œè¡¨å•è®¤è¯ --></span><br><span class="line">      <property name="<span" class="string">"loginUrl"</property></span> value=<span class="string">"/login"</span>/><br><span class="line"></span><br><span class="line">      <!-- Shiroè¿æ¥çº¦æŸé…ç½®,å³è¿‡æ»¤é“¾çš„å®šä¹‰ --></span><br><span class="line">      <property name="<span" class="string">"filterChainDefinitions"</property></span>><br><span class="line">          <value></value></span><br><span class="line">              <!-- <span class="comment">/** = anonæ‰€æœ‰urléƒ½å¯ä»¥åŒ¿åè®¿é—® --></span><br><span class="line"><span class="comment">              <!-- å¯¹é™æ€èµ„æºè®¾ç½®åŒ¿åè®¿é—® --></span></span><br><span class="line"><span class="comment">              /images/** = anon</span></span><br><span class="line"><span class="comment">              /js/** = anon</span></span><br><span class="line"><span class="comment">              /styles/** = anon</span></span><br><span class="line"><span class="comment">              <!-- éªŒè¯ç ï¼Œå¯åŒ¿åè®¿é—® --></span></span><br><span class="line"><span class="comment">              /validateCode = anon  <!--éªŒè¯ç --></span></span><br><span class="line"><span class="comment">              /doLogin = anon</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">              <!-- /** = authc æ‰€æœ‰urléƒ½å¿…é¡»è®¤è¯é€šè¿‡æ‰å¯ä»¥è®¿é—® --></span></span><br><span class="line"><span class="comment">              /**=authc</span></span><br><span class="line"><span class="comment">              <!--è¯·æ±‚logoutï¼Œshrioæ“¦é™¤sssion--></span></span><br><span class="line"><span class="comment">              /logout=logout</span></span><br><span class="line"><span class="comment">          </span></span><br><span class="line"><span class="comment">      </span></span><br><span class="line"><span class="comment">  </span></span><br></pre></td></tr></tbody></table></figure></div><p>éœ€è¦æ³¨æ„çš„æ˜¯è™½ç„¶SpringMVCæ‹¦æˆªçš„æ˜¯.doï¼Œä½†æ˜¯ç”±äºä½¿ç”¨äº†shiro(æˆ–è€…ä½ çš„å…¶ä»–æƒé™æ¡†æ¶)ï¼Œé‚£ä¹ˆæœªç™»å½•æƒ…å†µä¸‹æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®é™¤shiroé…ç½®æ–‡ä»¶é‡Œé¢å…è®¸åŒ¿åè®¿é—®çš„è·¯å¾„ä¹‹å¤–çš„é™æ€èµ„æºæ–‡ä»¶ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ æŠŠé™æ€èµ„æºæ–‡ä»¶æ”¾åœ¨äº†é¡¹ç›®æ ¹ç›®å½•ï¼Œä½†æ˜¯å‚è€ƒä¸Šé¢é…ç½®æ–‡ä»¶ï¼Œæ˜¾ç„¶ä¸åœ¨åŒ¿åè®¿é—®è·¯å¾„åˆ—è¡¨ä¹‹å†…ï¼Œæ‰€ä»¥ä¼šæç¤ºä½ å…ˆç™»å½•ï¼Œç™»å½•ä¹‹åæ‰å¯è®¿é—®é¡¹ç›®æ ¹ç›®å½•çš„é™æ€èµ„æºæ–‡ä»¶ã€‚</p><ul><li>æœªç™»å½•å‰è®¿é—®é¡¹ç›®æ ¹ç›®å½•ä¸‹1.jpg , è·³åˆ°ç™»å½•é¡µé¢ï¼š</li></ul><p><img alt="image" data-src="https://img-blog.csdn.net/20170518094647021?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" src="/img/loading.gif" class="lazyload"></p><ul><li>ç™»å½•åè®¿é—®é¡¹ç›®æ ¹ç›®å½•ä¸‹1.jpg :</li></ul><p><img alt="image" data-src="https://img-blog.csdn.net/20170518094717006?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" src="/img/loading.gif" class="lazyload"></p><p>å¦å¤–ï¼Œå»ºè®®æœ€å¥½å‚è€ƒshiroé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚1.jpgæ”¾åˆ°imagesæ–‡ä»¶å¤¹ä¸‹ï¼Œé‚£ä¹ˆä¸ç”¨ç™»å½•å°±å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p><p><img alt="image" data-src="https://img-blog.csdn.net/20170518094833869?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" src="/img/loading.gif" class="lazyload"></p><hr><h2 id="ã€3ã€‘ç¬¬ä¸‰ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"><a href="#ã€3ã€‘ç¬¬ä¸‰ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•" class="headerlink" title="ã€3ã€‘ç¬¬ä¸‰ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"></a><strong>ã€3ã€‘ç¬¬ä¸‰ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•</strong></h2><p><strong>é€šè¿‡é…ç½®ï¼Œé¿å…é™æ€èµ„æºè¢«æ‹¦æˆªï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><!-- é™æ€èµ„æºè®¿é—®ï¼ˆä¸æ‹¦æˆªæ­¤ç›®å½•ä¸‹çš„ä¸œè¥¿çš„è®¿é—®ï¼‰ --></span><br><span class="line">   <mvc:resources location="<span" class="string">"/js/"</mvc:resources></span> mapping=<span class="string">"/js/**"</span>/><br><span class="line">   <mvc:resources location="<span" class="string">"/css/"</mvc:resources></span> mapping=<span class="string">"/css/**"</span>/><br><span class="line">   <mvc:resources location="<span" class="string">"/images/"</mvc:resources></span> mapping=<span class="string">"/images/**"</span>/><br><span class="line">   <mvc:resources location="<span" class="string">"/bootstrap/"</mvc:resources></span> mapping=<span class="string">"/bootstrap/**"</span>/><br></pre></td></tr></tbody></table></figure></div><p>è¯¥æ ‡ç­¾çš„xsdè¯´æ˜æ–‡æ¡£å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">/*é…ç½®handlerä¸ºé™æ€èµ„æºï¼Œå¦‚imagesï¼Œjså’ŒCSSæ–‡ä»¶å¹¶è¿›è¡Œç¼“å­˜å¤´ä¼˜åŒ–ï¼Œä»¥ä¾¿åœ¨Webæµè§ˆå™¨ä¸­é«˜æ•ˆåŠ è½½ã€‚*/</span><br><span class="line">Configures a handler for serving static resources such as </span><br><span class="line">images, js, and, css files with cache headers optimized for efficient loading in a web browser. </span><br><span class="line">/*å…è®¸ä¸ºä»»ä½•å¯ä»¥é€šè¿‡springå¤„ç†çš„è·¯å¾„èµ„æºæä¾›æœåŠ¡*/</span><br><span class="line">Allows resources to be served out of any path that is reachable via Spring's Resource handling.</span><br></pre></td></tr></tbody></table></figure></div><p>æ³¨å†Œçš„handlerå¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">org.springframework.web.servlet.resource.ResourceHttpRequestHandler</span><br></pre></td></tr></tbody></table></figure></div><p><strong>å³ï¼Œè¯¥æ ‡ç­¾æ³¨å†ŒResourceHttpRequestHandlerä¸ºé™æ€èµ„æºçš„è®¿é—®æä¾›æœåŠ¡ã€‚</strong></p><p>è¯¥handlerçš„javadocå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">{<span class="meta">@code</span> HttpRequestHandler} that serves <span class="keyword">static</span> resources in an optimized way according to the guidelines of Page Speed, YSlow, etc.</span><br><span class="line"></span><br><span class="line"> * <p>The {@linkplain #setLocations "locations"} property takes a list of Spring<br><span class="line"> * {<span class="meta">@link</span> Resource} locations from which <span class="keyword">static</span> resources are allowed to</span><br><span class="line"> * be served by <span class="keyword">this</span> handler. Resources could be served from a classpath location,</span><br><span class="line"> * e.g. <span class="string">"classpath:/META-INF/public-web-resources/"</span>, allowing convenient packaging</span><br><span class="line"> * and serving of resources such as .js, .css, and others in jar files.</span><br></p></span></pre></td></tr></tbody></table></figure></div><hr><h2 id="ã€4ã€‘ç¬¬å››ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"><a href="#ã€4ã€‘ç¬¬å››ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•" class="headerlink" title="ã€4ã€‘ç¬¬å››ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•"></a><strong>ã€4ã€‘ç¬¬å››ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•</strong></h2><p>ç¡®åˆ‡è¯´è¿™é‡Œåªè§£å†³ä¸é€šè¿‡controllerè€Œç›´æ¥è®¿é—®jspçš„é—®é¢˜ã€‚</p><p><code><mvc:view-controller></mvc:view-controller></code>ç›´æ¥è®¿é—®view-nameå¯¹åº”çš„jsp</p><ul><li>jspè·¯å¾„ä¾æ®è§†å›¾è§£æå™¨é…ç½®ã€‚</li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><!-- mvc:view-controllerå¯ä½¿å…¶ç›´æ¥è®¿é—®è·¯å¾„ -->  </span><br><span class="line"><mvc:view-controller path="<span" class="string">"/i18n"</mvc:view-controller></span> view-name=<span class="string">"i18n"</span>/><br><span class="line"></span><br><span class="line"><mvc:view-controller path="<span" class="string">"/i18n2"</mvc:view-controller></span> view-name=<span class="string">"i18n2"</span>/><br></pre></td></tr></tbody></table></figure></div></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯ </tag>
            
            <tag> Spring </tag>
            
            <tag> è½¬è½½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dubbo+zookeeperç®€å•å®ç°åˆ†å¸ƒå¼</title>
      <link href="/2018/05/20/dubbo-zookeeper-jian-dan-shi-xian-fen-bu-shi/"/>
      <url>/2018/05/20/dubbo-zookeeper-jian-dan-shi-xian-fen-bu-shi/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h1><ul><li>å…¶å®æˆ‘ä¹Ÿæ˜¯åœ¨åšæ·˜æ·˜çš„æ—¶å€™æ‰æ¥è§¦åˆ°åˆ†å¸ƒå¼ï¼Œä¹Ÿåªæ˜¯ç®€å•çš„äº†è§£äº†ä¸‹ï¼Œå…³äºåˆ†å¸ƒå¼çš„å¥½å¤„ä¹Ÿä¸å¤šè¯´äº†.</li><li>å®é™…åº”ç”¨<br>è¿™é‡Œå®é™…åº”ç”¨å°±æ˜¯æ·˜æ·˜å•†åŸ ç”±äºæ·˜æ·˜å•†åŸæ˜¯åŸºäºsoa(é¢å‘æœåŠ¡)çš„æ¶æ„ï¼Œè¡¨ç°å±‚å’ŒæœåŠ¡å±‚æ˜¯ä¸åŒçš„å·¥ç¨‹ã€‚æ‰€ä»¥è¦å®ç°å•†å“åˆ—è¡¨æŸ¥è¯¢éœ€è¦ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚<br>ps: åœ¨æ·˜æ·˜é‡Œé¢ç”¨çš„æ˜¯dubbo+zookeeperè¿™åªæ˜¯è¿œç¨‹é€šä¿¡çš„ä¸€ç§æ–¹å¼å¸¸è§çš„æœ‰ä¸‰ç§<br>1.Webserviceï¼šæ•ˆç‡ä¸é«˜åŸºäºsoapåè®®ã€‚é¡¹ç›®ä¸­ä¸æ¨èä½¿ç”¨ã€‚<br>2.ä½¿ç”¨restfulå½¢å¼çš„æœåŠ¡ï¼šhttp+jsonã€‚å¾ˆå¤šé¡¹ç›®ä¸­åº”ç”¨ã€‚å¦‚æœæœåŠ¡å¤ªå¤šï¼ŒæœåŠ¡ä¹‹é—´è°ƒç”¨å…³ç³»æ··ä¹±ï¼Œéœ€è¦æ²»ç–—æœåŠ¡ã€‚<br>3.ä½¿ç”¨dubboã€‚ä½¿ç”¨rpcåè®®è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œç›´æ¥ä½¿ç”¨socketé€šä¿¡ã€‚ä¼ è¾“æ•ˆç‡é«˜ï¼Œå¹¶ä¸”å¯ä»¥ç»Ÿè®¡å‡ºç³»ç»Ÿä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€è°ƒç”¨æ¬¡æ•°ã€‚</li><li>dubbo<br>Dubboå°±æ˜¯<strong>èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ</strong>çš„ç®¡ç†å·¥å…·ã€‚<br>dubboçš„æ¶æ„<br><img alt="image" data-src="http://p0.cdn.img9.top/ipfs/QmNt5aeNWC6PSPY6Dak7p39H1tHY6y9u6ppxhNFoh8PUFn?0.png" src="/img/loading.gif" class="lazyload"></li></ul><p><strong>èŠ‚ç‚¹è§’è‰²è¯´æ˜ï¼š</strong></p><p>  <strong>Provider:</strong> æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ã€‚</p><p>  <strong>Consumer:</strong> è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ã€‚</p><p>  <strong>Registry:</strong> æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒã€‚</p><p>  <strong>Monitor:</strong> ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡è°ƒå’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒã€‚</p><p>  <strong>Container:</strong> æœåŠ¡è¿è¡Œå®¹å™¨<br><strong>æµç¨‹åˆ†æï¼š</strong><br>  0. æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚</p><p>  1. æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚</p><p>  2. æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚</p><p>  3. æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚</p><p>  4. æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</p><p>  5. æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚<br><strong>å¦‚ä½•ä½¿ç”¨</strong><br> Dubboé‡‡ç”¨å…¨Springé…ç½®æ–¹å¼ï¼Œé€æ˜åŒ–æ¥å…¥åº”ç”¨ï¼Œå¯¹åº”ç”¨æ²¡æœ‰ä»»ä½•APIä¾µå…¥ï¼Œåªéœ€ç”¨SpringåŠ è½½Dubboçš„é…ç½®å³å¯ï¼ŒDubboåŸºäºSpringçš„Schemaæ‰©å±•è¿›è¡ŒåŠ è½½ã€‚</p><p>  <strong>å•ä¸€å·¥ç¨‹ä¸­springçš„é…ç½®</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><bean id="<span" class="string">"xxxService"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.xxx.XxxServiceImpl"</span> /><br><span class="line"> <bean id="<span" class="string">"xxxAction"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.xxx.XxxAction"</span>><br><span class="line"> <property name="<span" class="string">"xxxService"</property></span> ref=<span class="string">"xxxService"</span> /><br><span class="line"> </span><br></pre></td></tr></tbody></table></figure></div><p><strong>è¿œç¨‹æœåŠ¡ï¼š</strong></p><p>  åœ¨æœ¬åœ°æœåŠ¡çš„åŸºç¡€ä¸Šï¼Œåªéœ€åšç®€å•é…ç½®ï¼Œå³å¯å®Œæˆè¿œç¨‹åŒ–ï¼š<br>  å°†ä¸Šé¢çš„local.xmlé…ç½®æ‹†åˆ†æˆä¸¤ä»½ï¼Œå°†æœåŠ¡å®šä¹‰éƒ¨åˆ†æ”¾åœ¨æœåŠ¡æä¾›æ–¹remote-provider.xmlï¼Œå°†æœåŠ¡å¼•ç”¨éƒ¨    åˆ†æ”¾åœ¨æœåŠ¡æ¶ˆè´¹æ–¹remote-consumer.xmlã€‚<br>  å¹¶åœ¨æä¾›æ–¹å¢åŠ æš´éœ²æœåŠ¡é…ç½®<a href="dubbo:service">dubbo:service</a>ï¼Œåœ¨æ¶ˆè´¹æ–¹å¢åŠ å¼•ç”¨æœåŠ¡é…ç½®<a href="dubbo:reference">dubbo:reference</a>ã€‚</p><p>  å‘å¸ƒæœåŠ¡ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!-- å’Œæœ¬åœ°æœåŠ¡ä¸€æ ·å®ç°è¿œç¨‹æœåŠ¡ --></span><br><span class="line"></span><br><span class="line">  <bean id="<span" class="string">"xxxService"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.xxx.XxxServiceImpl"</span> /><br><span class="line"></span><br><span class="line">  <!-- å¢åŠ æš´éœ²è¿œç¨‹æœåŠ¡é…ç½® --></span><br><span class="line"></span><br><span class="line">  <dubbo:service <span class="class"><span class="keyword">interface</span></dubbo:service></span>=<span class="string">"com.xxx.XxxService"</span> ref=<span class="string">"xxxService"</span> /><br><span class="line"></span><br><span class="line">   è°ƒç”¨æœåŠ¡ï¼š</span><br><span class="line"><!-- å¢åŠ å¼•ç”¨è¿œç¨‹æœåŠ¡é…ç½® --></span><br><span class="line"></span><br><span class="line">  <dubbo:reference id="<span" class="string">"xxxService"</dubbo:reference></span> <span class="class"><span class="keyword">interface</span></span>=<span class="string">"com.xxx.XxxService"</span> /><br><span class="line"></span><br><span class="line">  <!-- å’Œæœ¬åœ°æœåŠ¡ä¸€æ ·ä½¿ç”¨è¿œç¨‹æœåŠ¡ --></span><br><span class="line">  <bean id="<span" class="string">"xxxAction"</bean></span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.xxx.XxxAction"</span>><br><span class="line">  <property name="<span" class="string">"xxxService"</property></span> ref=<span class="string">"xxxService"</span> /><br><span class="line">  </span><br></pre></td></tr></tbody></table></figure></div><ul><li>æ·˜æ·˜ä¸­çš„dubbo<br><img alt="image" data-src="http://p1.cdn.img9.top/ipfs/QmRPvtoW2JoEZKuXFExYrusKhDt7kM5iSk4JWeXHBLfMVA?1.png" src="/img/loading.gif" class="lazyload"><br>ç®€å•è§£é‡Šä¸‹<br> ä¸Šé¢çš„springmvcæ˜¯webå±‚çš„é…ç½®ä¸‹é¢çš„serviceæ˜¯æœåŠ¡å±‚çš„é…ç½®</li></ul><p><strong>serviceå±‚å‘å¸ƒæœåŠ¡</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><dubbo:registry protocol="<span" class="string">"zookeeper"</dubbo:registry></span> address=<span class="string">"127.0.0.1:2181"</span> /><br></pre></td></tr></tbody></table></figure></div><p>è¿™ä¸ªæ˜¯æ³¨å†Œä¸­å¿ƒ æ·˜æ·˜é‡‡ç”¨çš„æ˜¯zookeeper addresså°±æ˜¯zookeeperçš„åœ°å€æˆ‘çš„zookeperå®‰è£…åœ¨æœ¬æœºä¸Šæ‰€ä»¥å°±æ˜¯127.0.0.1åé¢çš„æ˜¯zookeperæš´éœ²çš„ç«¯å£å·é»˜è®¤2181  é¦–å…ˆåœ¨serviceå±‚å‘å¸ƒæœåŠ¡å‘å¸ƒçš„æ—¶å€™æŒ‡æ˜æ¥å£ç±»å’Œ å®ç°ç±» è¿™é‡Œ<em>å®ç°ç±»çš„é¦–å­—æ¯è¦å°å†™*æˆ–è€…ä½ ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªbeanç„¶åæŒ‡å®šid<br>*<!-- å£°æ˜éœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£ --><br>    <dubbo:service interface="â€com.taoshop.service.ItemServiceâ€<br">        ref=â€itemServiceImplâ€ /></dubbo:service></em><br>*<!-- ç”¨dubboåè®®åœ¨20880ç«¯å£æš´éœ²æœåŠ¡ --><br>    <dubbo:protocol name="â€dubboâ€" port="â€20880â€">*<br>è¿™ä¸ªå°±æ˜¯æš´éœ²ç«¯å£çš„æœåŠ¡ è¿™é‡Œè¿˜è¦æ³¨æ„ä¸€ç‚¹å°±æ˜¯æœ‰å¤šä¸ªåº”ç”¨å‘å¸ƒæœåŠ¡è¿™é‡Œç«¯å£éœ€è¦æ”¹ã€‚<br><strong>æœåŠ¡å‘å¸ƒwebå±‚å¼•ç”¨æœåŠ¡</strong></dubbo:protocol></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><dubbo:reference <span class="class"><span class="keyword">interface</span></dubbo:reference></span>=<span class="string">"com.taoshop.service.ItemService"</span> id=<span class="string">"itemService"</span> /><br></pre></td></tr></tbody></table></figure></div><p>è¿™æ ·å°±å®Œæˆäº†æœåŠ¡çš„å‘å¸ƒå’Œå¼•ç”¨ç„¶åå°±å¯ä»¥å¯åŠ¨é¡¹ç›®æµ‹è¯•äº† è¿™é‡Œè¿˜è¦æ³¨æ„å¯åŠ¨çš„é¡ºåº<br>å…ˆå¯åŠ¨zookeeper â€“> å†å¯åŠ¨serviceå±‚ â€“>å†å¯åŠ¨web å±‚ ä¸»è¦æ˜¯è¦å…ˆå¯åŠ¨zookeepe</p><ul><li>æœ€åè´´ä¸€ä¸‹mavenä¾èµ–å§<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><!--Dubbo --></span><br><span class="line"><dependency></dependency></span><br><span class="line"><groupid>com.alibaba</groupid></span><br><span class="line"><artifactid>dubbo</artifactid></span><br><span class="line"><exclusions></exclusions></span><br><span class="line"><exclusion></exclusion></span><br><span class="line"><groupid>org.springframework</groupid></span><br><span class="line"><artifactid>spring</artifactid></span><br><span class="line"></span><br><span class="line"><exclusion></exclusion></span><br><span class="line"><groupid>org.jboss.netty</groupid></span><br><span class="line"><artifactid>netty</artifactid></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><dependency></dependency></span><br><span class="line"><groupid>org.apache.zookeeper</groupid></span><br><span class="line"><artifactid>zookeeper</artifactid></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div></li><li>å…³äºåˆ†å¸ƒå¼ç¡®å®è¿˜äº†è§£çš„ä¸å¤Ÿï¼Œè¿œç¨‹é€šè®¯webserviceä¹Ÿè¿˜æ²¡å­¦åé¢è¦æ…¢æ…¢èŠ±ç‚¹æ—¶é—´æ¥å­¦ä¹ ä¸‹ è¿˜æ˜¯æŒºæœ‰æ„æ€çš„</li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·˜æ·˜å•†åŸ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springè¯·æ±‚å‚æ•°è·å–çš„å‡ ç§æ–¹å¼ï¼ˆè½¬ï¼‰</title>
      <link href="/2018/05/17/spring-qing-qiu-can-shu-huo-qu/"/>
      <url>/2018/05/17/spring-qing-qiu-can-shu-huo-qu/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="springmvcè¯·æ±‚å‚æ•°è·å–çš„å‡ ç§æ–¹æ³•"><a href="#springmvcè¯·æ±‚å‚æ•°è·å–çš„å‡ ç§æ–¹æ³•" class="headerlink" title="springmvcè¯·æ±‚å‚æ•°è·å–çš„å‡ ç§æ–¹æ³•"></a><a href="http://www.cnblogs.com/xiaoxi/p/5695783.html" target="_blank" rel="noopener">springmvcè¯·æ±‚å‚æ•°è·å–çš„å‡ ç§æ–¹æ³•</a></h1><p><strong>1ã€ç›´æ¥æŠŠè¡¨å•çš„å‚æ•°å†™åœ¨Controllerç›¸åº”çš„æ–¹æ³•çš„å½¢å‚ä¸­ï¼Œé€‚ç”¨äºgetæ–¹å¼æäº¤ï¼Œä¸é€‚ç”¨äºpostæ–¹å¼æäº¤ã€‚</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/** * 1.ç›´æ¥æŠŠè¡¨å•çš„å‚æ•°å†™åœ¨Controllerç›¸åº”çš„æ–¹æ³•çš„å½¢å‚ä¸­</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span> <span class="meta">@RequestMapping</span>(<span class="string">"/addUser1"</span>) <span class="function"><span class="keyword">public</span> String <span class="title">addUser1</span><span class="params">(String username,String password)</span> </span>{</span><br><span class="line">    System.out.println(<span class="string">"username is:"</span>+username);</span><br><span class="line">    System.out.println(<span class="string">"password is:"</span>+password); <span class="keyword">return</span> <span class="string">"demo/index"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><a id="more"></a>urlå½¢å¼ï¼š[http://localhost/SSMDemo/demo/addUser1?username=lixiaoxi&password=111111](http://localhost/SSMDemo/demo/addUser1?username=lixiaoxi&password=111111) æäº¤çš„å‚æ•°éœ€è¦å’ŒControlleræ–¹æ³•ä¸­çš„å…¥å‚åç§°ä¸€è‡´ã€‚<p><strong>2ã€é€šè¿‡HttpServletRequestæ¥æ”¶ï¼Œpostæ–¹å¼å’Œgetæ–¹å¼éƒ½å¯ä»¥ã€‚</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/** 2ã€é€šè¿‡HttpServletRequestæ¥æ”¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span> <span class="meta">@RequestMapping</span>(<span class="string">"/addUser2"</span>) <span class="function"><span class="keyword">public</span> String <span class="title">addUser2</span><span class="params">(HttpServletRequest request)</span> </span>{</span><br><span class="line">     String username=request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">     String password=request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">     System.out.println(<span class="string">"username is:"</span>+username);</span><br><span class="line">     System.out.println(<span class="string">"password is:"</span>+password); <span class="keyword">return</span> <span class="string">"demo/index"</span>;</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure></div><p><strong>3ã€é€šè¿‡ä¸€ä¸ªbeanæ¥æ¥æ”¶,postæ–¹å¼å’Œgetæ–¹å¼éƒ½å¯ä»¥ã€‚</strong><br>(1)å»ºç«‹ä¸€ä¸ªå’Œè¡¨å•ä¸­å‚æ•°å¯¹åº”çš„bean</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> demo.model; <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserModel</span> </span>{ <span class="keyword">private</span> String username; <span class="keyword">private</span> String password; <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>{ <span class="keyword">return</span> username;</span><br><span class="line">    } <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>{ <span class="keyword">this</span>.username = username;</span><br><span class="line">    } <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>{ <span class="keyword">return</span> password;</span><br><span class="line">    } <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>{ <span class="keyword">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>(2)ç”¨è¿™ä¸ªbeanæ¥å°è£…æ¥æ”¶çš„å‚æ•°</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/** * 3ã€é€šè¿‡ä¸€ä¸ªbeanæ¥æ¥æ”¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span> <span class="meta">@RequestMapping</span>(<span class="string">"/addUser3"</span>) <span class="function"><span class="keyword">public</span> String <span class="title">addUser3</span><span class="params">(UserModel user)</span> </span>{</span><br><span class="line">       System.out.println(<span class="string">"username is:"</span>+user.getUsername());</span><br><span class="line">       System.out.println(<span class="string">"password is:"</span>+user.getPassword()); <span class="keyword">return</span> <span class="string">"demo/index"</span>;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure></div><p><strong>4ã€é€šè¿‡@PathVariableè·å–è·¯å¾„ä¸­çš„å‚æ•°</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/*** 4ã€é€šè¿‡<span class="doctag">@PathVariable</span>è·å–è·¯å¾„ä¸­çš„å‚æ•°</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span> <span class="meta">@RequestMapping</span>(value=<span class="string">"/addUser4/{username}/{password}"</span>,method=RequestMethod.GET) <span class="function"><span class="keyword">public</span> String <span class="title">addUser4</span><span class="params">(@PathVariable String username,@PathVariable String password)</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"username is:"</span>+username);</span><br><span class="line">        System.out.println(<span class="string">"password is:"</span>+password); <span class="keyword">return</span> <span class="string">"demo/index"</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div><p>ä¾‹å¦‚ï¼Œè®¿é—®<a href="http://localhost/SSMDemo/demo/addUser4/lixiaoxi/111111" target="_blank" rel="noopener">http://localhost/SSMDemo/demo/addUser4/lixiaoxi/111111</a> è·¯å¾„æ—¶ï¼Œåˆ™è‡ªåŠ¨å°†URLä¸­æ¨¡æ¿å˜é‡{username}å’Œ{password}ç»‘å®šåˆ°é€šè¿‡@PathVariableæ³¨è§£çš„åŒåå‚æ•°ä¸Šï¼Œå³å…¥å‚åusername=lixiaoxiã€password=111111ã€‚<br><strong>5ã€ä½¿ç”¨@ModelAttributeæ³¨è§£è·å–POSTè¯·æ±‚çš„FORMè¡¨å•æ•°æ®</strong><br>Jspè¡¨å•å¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line"><form action="<span" class="string">"<%=request.getContextPath()%>/demo/addUser5" method=<span class="string">"post"</span>> ç”¨æˆ·å:Â <input type="<span" class="string">"text" name=<span class="string">"username"</span>/><br> å¯†Â Â ç :Â <input type="<span" class="string">"password" name=<span class="string">"password"</span>/><br><br><span class="line">     <input type="<span" class="string">"submit"</span> value=<span class="string">"æäº¤"</span>/> <br><span class="line">     <input type="<span" class="string">"reset"</span> value=<span class="string">"é‡ç½®"</span>/> <br><span class="line"></span></form><br></span></pre></td></tr></tbody></table></figure></div><p>Java Controllerå¦‚ä¸‹ï¼š</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/** * 5ã€ä½¿ç”¨<span class="doctag">@ModelAttribute</span>æ³¨è§£è·å–POSTè¯·æ±‚çš„FORMè¡¨å•æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span> <span class="meta">@RequestMapping</span>(value=<span class="string">"/addUser5"</span>,method=RequestMethod.POST) <span class="function"><span class="keyword">public</span> String <span class="title">addUser5</span><span class="params">(@ModelAttribute(<span class="string">"user"</span>)</span> UserModel user) </span>{</span><br><span class="line">        System.out.println(<span class="string">"username is:"</span>+user.getUsername());</span><br><span class="line">        System.out.println(<span class="string">"password is:"</span>+user.getPassword()); <span class="keyword">return</span> <span class="string">"demo/index"</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div><p><strong>6ã€ç”¨æ³¨è§£@RequestParamç»‘å®šè¯·æ±‚å‚æ•°åˆ°æ–¹æ³•å…¥å‚</strong><br>å½“è¯·æ±‚å‚æ•°usernameä¸å­˜åœ¨æ—¶ä¼šæœ‰å¼‚å¸¸å‘ç”Ÿ,å¯ä»¥é€šè¿‡è®¾ç½®å±æ€§required=falseè§£å†³,ä¾‹å¦‚: @RequestParam(value=â€usernameâ€, required=false)</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/** * 6ã€ç”¨æ³¨è§£<span class="doctag">@RequestParam</span>ç»‘å®šè¯·æ±‚å‚æ•°åˆ°æ–¹æ³•å…¥å‚</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span> <span class="meta">@RequestMapping</span>(value=<span class="string">"/addUser6"</span>,method=RequestMethod.GET) <span class="function"><span class="keyword">public</span> String <span class="title">addUser6</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username,@<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password) </span>{</span><br><span class="line">        System.out.println(<span class="string">"username is:"</span>+username);</span><br><span class="line">        System.out.println(<span class="string">"password is:"</span>+password); <span class="keyword">return</span> <span class="string">"demo/index"</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> è½¬è½½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastDFSå­¦ä¹ </title>
      <link href="/2018/05/16/fastdfs/"/>
      <url>/2018/05/16/fastdfs/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="FastDFSå­¦ä¹ ç¬”è®°"><a href="#FastDFSå­¦ä¹ ç¬”è®°" class="headerlink" title="FastDFSå­¦ä¹ ç¬”è®°"></a>FastDFSå­¦ä¹ ç¬”è®°</h1><ul><li>FastDFSç®€ä»‹<br>  FastDFSæœåŠ¡ç«¯æœ‰ä¸¤ä¸ªè§’è‰²ï¼šè·Ÿè¸ªå™¨ï¼ˆtrackerï¼‰å’Œå­˜å‚¨<a href="https://baike.baidu.com/item/%E8%8A%82%E7%82%B9" target="_blank" rel="noopener">èŠ‚ç‚¹</a>ï¼ˆstorageï¼‰ã€‚è·Ÿè¸ªå™¨ä¸»è¦åšè°ƒåº¦å·¥ä½œï¼Œåœ¨è®¿é—®ä¸Šèµ·è´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚<br>å­˜å‚¨èŠ‚ç‚¹å­˜å‚¨æ–‡ä»¶ï¼Œå®Œæˆæ–‡ä»¶ç®¡ç†çš„æ‰€æœ‰åŠŸèƒ½ï¼šå°±æ˜¯è¿™æ ·çš„å­˜å‚¨ã€åŒæ­¥å’Œæä¾›å­˜å–æ¥å£ï¼ŒFastDFSåŒæ—¶å¯¹æ–‡ä»¶çš„metadataè¿›è¡Œç®¡ç†ã€‚æ‰€è°“æ–‡ä»¶çš„meta dataå°±æ˜¯æ–‡ä»¶çš„ç›¸å…³å±æ€§ï¼Œä»¥é”®å€¼å¯¹ï¼ˆkey valueï¼‰æ–¹å¼è¡¨ç¤ºï¼Œå¦‚ï¼šwidth=1024ï¼Œå…¶ä¸­çš„keyä¸ºwidthï¼Œvalueä¸º1024ã€‚æ–‡ä»¶metadataæ˜¯<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7" target="_blank" rel="noopener">æ–‡ä»¶å±æ€§</a>åˆ—è¡¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹ã€‚<br>è·Ÿè¸ªå™¨å’Œå­˜å‚¨èŠ‚ç‚¹éƒ½å¯ä»¥ç”±ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨æ„æˆã€‚è·Ÿè¸ªå™¨å’Œå­˜å‚¨èŠ‚ç‚¹ä¸­çš„æœåŠ¡å™¨å‡å¯ä»¥éšæ—¶å¢åŠ æˆ–ä¸‹çº¿è€Œä¸ä¼šå½±å“çº¿ä¸ŠæœåŠ¡ã€‚å…¶ä¸­è·Ÿè¸ªå™¨ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯å¯¹ç­‰çš„ï¼Œå¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„å‹åŠ›æƒ…å†µéšæ—¶å¢åŠ æˆ–å‡å°‘ã€‚<br>ä¸ºäº†æ”¯æŒå¤§å®¹é‡ï¼Œå­˜å‚¨<a href="https://baike.baidu.com/item/%E8%8A%82%E7%82%B9" target="_blank" rel="noopener">èŠ‚ç‚¹</a>ï¼ˆæœåŠ¡å™¨ï¼‰é‡‡ç”¨äº†åˆ†å·ï¼ˆæˆ–åˆ†ç»„ï¼‰çš„ç»„ç»‡æ–¹å¼ã€‚<a href="https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener">å­˜å‚¨ç³»ç»Ÿ</a>ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå·ç»„æˆï¼Œå·ä¸å·ä¹‹é—´çš„æ–‡ä»¶æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€æœ‰å·çš„æ–‡ä»¶å®¹é‡ç´¯åŠ å°±æ˜¯æ•´ä¸ªå­˜å‚¨ç³»ç»Ÿä¸­çš„æ–‡ä»¶å®¹é‡ã€‚ä¸€ä¸ªå·å¯ä»¥ç”±ä¸€å°æˆ–å¤šå°<a href="https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">å­˜å‚¨æœåŠ¡å™¨</a>ç»„æˆï¼Œä¸€ä¸ªå·ä¸‹çš„å­˜å‚¨æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå·ä¸­çš„å¤šå°å­˜å‚¨æœåŠ¡å™¨èµ·åˆ°äº†<a href="https://baike.baidu.com/item/%E5%86%97%E4%BD%99%E5%A4%87%E4%BB%BD" target="_blank" rel="noopener">å†—ä½™å¤‡ä»½</a>å’Œè´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚<br>åœ¨å·ä¸­å¢åŠ æœåŠ¡å™¨æ—¶ï¼ŒåŒæ­¥å·²æœ‰çš„æ–‡ä»¶ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼ŒåŒæ­¥å®Œæˆåï¼Œç³»ç»Ÿè‡ªåŠ¨å°†æ–°å¢æœåŠ¡å™¨åˆ‡æ¢åˆ°çº¿ä¸Šæä¾›æœåŠ¡ã€‚<br>å½“å­˜å‚¨ç©ºé—´ä¸è¶³æˆ–å³å°†è€—å°½æ—¶ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å·ã€‚åªéœ€è¦å¢åŠ ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ï¼Œå¹¶å°†å®ƒä»¬é…ç½®ä¸ºä¸€ä¸ªæ–°çš„å·ï¼Œè¿™æ ·å°±æ‰©å¤§äº†<a href="https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener">å­˜å‚¨ç³»ç»Ÿ</a>çš„å®¹é‡ã€‚<br>FastDFSä¸­çš„æ–‡ä»¶æ ‡è¯†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå·åå’Œæ–‡ä»¶åï¼ŒäºŒè€…ç¼ºä¸€ä¸å¯ã€‚</li><li>å¤§èƒ†åˆ†æ<br>è¿™é‡Œåœ¨æ·˜æ·˜çš„åå°ä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™ç”¨åˆ°äº†,ç¡®å®å¥½ç”¨ä¹Ÿæ˜¯cè¯­è¨€å¼€å‘çš„ æ­é…<em>Nginx</em>è´¼æ–¹ä¾¿,ç¡®å®ä½©æœé‚£äº›æ<strong>C</strong>çš„å¤§ä½¬ï¼Œä¸Šé¢çš„è¯´æ³•ä¸å¤Ÿç›´ç™½æ–‡å­—æ€»æ˜¯è‹ç™½çš„(ï¿£â–½ï¿£)~<em>è®©æˆ‘æ¥å¼ºè¡Œè§£é‡Šä¸€æ³¢<img alt="image" data-src="http://p1.so.qhmsg.com/bdr/_240_/t0183119f547ca0bbc6.png" src="/img/loading.gif" class="lazyload"><br>ä¸Šé¢è¯´åˆ°äº†*</em>FastDFS**ä¸»è¦æœ‰ä¸¤ä¸ªèŠ‚ç‚¹<ol><li>å‚¨å­˜èŠ‚ç‚¹Storage<br>é¡¾åæ€ä¹‰å°±æ˜¯ç”¨æ¥å‚¨å­˜æ–‡ä»¶çš„æœåŠ¡å™¨è¿™ä¸ªå›¾ä¸­çš„æ˜¯æ¯”è¾ƒå¤æ‚çš„æƒ…å†µè¿™é‡Œæœ‰ä¸€ä¸ªstroage ç¾¤é‡Œåˆåˆ†äº†å¾ˆå¤šç»„æ¯ä¸ªç»„é‡Œåˆæœ‰å¾ˆå¤šæœåŠ¡å™¨ï¼ˆè¿™é‡Œçš„æœåŠ¡å™¨é‡Œé¢å‚¨å­˜çš„æ–‡ä»¶æ˜¯ä¸€æ ·çš„ ä¼šè‡ªåŠ¨åŒæ­¥ æ–¹ä¾¿åŠ æœºå™¨ï¼‰</li><li>ç›‘æ§èŠ‚ç‚¹Tracker<br>è¿™ä¸ªå°±è·Ÿ<a href="http://www.so.com/link?m=a0NGOfhwBC5nSFnUTBxpX2uhRysff5w5UsQFEqgCBRrJbwZpybFckcSRdwhuJdbgSApcIIqhL0gq5D6eIbBJ5pN22O2Z0k6ENTFGSjrRpsgETp2Dl" target="_blank" rel="noopener">zookeper</a>ä½œç”¨æœ‰ç‚¹åƒå…ˆä¸Šå›¾<br><img alt="image" data-src="http://p0.cdn.img9.top/ipfs/QmZynH9DgJJbePkn35LjhRTc6xyyWL64jNT6QU6jyBnrXE?0.png" src="/img/loading.gif" class="lazyload"><br>è¿™ä¸ªæ˜¯ä¸Šä¼ çš„è¿‡ç¨‹å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯è¦ä¸Šä¼ å›¾ç‰‡éƒ½æ˜¯é€šè¿‡Trackerçš„è€Œå‚¨å­˜èŠ‚ç‚¹ä¹Ÿä¼šå®šæ—¶å‘Trackerå‘é€çŠ¶æ€çš„ä¿¡æ¯ç›‘æ§Storageçš„çŠ¶æ€<br><code>å¯ä»¥çœ‹å‡ºä¸Šé¢Clientåœ¨ä¸Šä¼ å›¾ç‰‡æˆåŠŸåStorageè¿”å›äº†ä¸€ä¸ªfile_idç„¶åå®¢æˆ·ç«¯å°±ä¼šå‚¨å­˜è¿™ä¸ªidé‚£å®¢æˆ·ç«¯æ˜¯å¦‚ä½•é€šè¿‡è¿™ä¸ªidè®¿é—®åˆ°è¿™ä¸ªå›¾ç‰‡çš„å‘¢ï¼Ÿ ---æ²¡é”™å°±æ˜¯Nginx ç”¨Nginxæ¥å¤„ç†è¿™äº›é™æ€èµ„æºå†å¥½ä¸è¿‡äº†</code></li></ol></li><li>ä½¿ç”¨<br>è¯´äº†è¿™ä¹ˆå¤šæ¥å®é™…ç”¨ç”¨çœ‹å§  <ol><li>é¦–å…ˆæˆ‘ä»¬è¦åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…FastDFSå¹¶é…ç½®Nginxè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ä¹Ÿä¸æ˜¯æˆ‘ä»¬é‡ç‚¹å…³å¿ƒçš„é—®é¢˜æ˜¯è¿ç»´åº”è¯¥å…³å¿ƒçš„é—®é¢˜è¿™é‡Œæœ‰ä¸€ä¸ªæ­å»ºå¥½çš„æœ€ç®€å•çš„<a href="https://pan.baidu.com/s/1u5FLtQu71CueAJwq63ji6A" target="_blank" rel="noopener">FastDFSæœåŠ¡å™¨</a>å¼€æœºå°±å¯ä»¥ç›´æ¥ç”¨æœåŠ¡éƒ½æ˜¯å¼€æœºè‡ªå¯åŠ¨çš„  <ol start="2"><li>ç„¶åæˆ‘ä»¬è¦æœ‰å®¢æˆ·ç«¯è¿™é‡ŒFastDFSä½œè€…å·²ç»å†™å¥½äº†JAVAçš„å®¢æˆ·ç«¯æˆ‘ä»¬ç›´æ¥æ‹¿æ¥ç”¨å°±å¥½äº†<a href="https://pan.baidu.com/s/1KY5BKUr6f1PlCRR7hyhRSA" target="_blank" rel="noopener">fastdfs_clientçš„jaråŒ…</a></li><li>å¼€å§‹ä½¿ç”¨å§  </li></ol></li></ol></li></ul><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line"><span class="comment">//1ã€åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å°±æ˜¯trackeræœåŠ¡çš„åœ°å€ã€‚</span></span><br><span class="line"><span class="comment">//é…ç½®æ–‡ä»¶å†…å®¹ï¼štracker_server=192.168.25.133:22122</span></span><br><span class="line">ClientGlobal.init(<span class="string">"D:\\JavaDemo\\taoshop-web\\src\\main\\resources\\conf\\client.conf"</span>);</span><br><span class="line"><span class="comment">//2ã€åˆ›å»ºä¸€ä¸ªTrackerClientå¯¹è±¡ã€‚ç›´æ¥newä¸€ä¸ªã€‚</span></span><br><span class="line">TrackerClient trackerClient =<span class="keyword">new</span> TrackerClient();</span><br><span class="line"><span class="comment">//3ã€ä½¿ç”¨TrackerClientå¯¹è±¡åˆ›å»ºè¿æ¥ï¼Œè·å¾—ä¸€ä¸ªTrackerServerå¯¹è±¡ã€‚</span></span><br><span class="line">TrackerServer trackerServer = trackerClient.getConnection();</span><br><span class="line"><span class="comment">//4ã€åˆ›å»ºä¸€ä¸ªStorageServerçš„å¼•ç”¨ï¼Œå€¼ä¸ºnull</span></span><br><span class="line">StorageServer storageServer =<span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//5ã€åˆ›å»ºä¸€ä¸ªStorageClientå¯¹è±¡ï¼Œéœ€è¦ä¸¤ä¸ªå‚æ•°TrackerServerå¯¹è±¡ã€StorageServerçš„å¼•ç”¨</span></span><br><span class="line">StorageClient storageCilent =<span class="keyword">new</span> StorageClient(trackerServer,storageServer);</span><br><span class="line"><span class="comment">//6ã€ä½¿ç”¨StorageCilentä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">String[] strings = storageCilent.upload_file(<span class="string">"C:\\Users\\Administrator\\Desktop\\image\\222.jpg"</span>,<span class="string">"jpg"</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">for</span> (String string : strings) {</span><br><span class="line">System.out.println(string);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>è¿™é‡Œæœ€åä¹Ÿå°±æ˜¯ä¸ºäº†çš„åˆ°StorageServerå¯¹è±¡ æˆ‘ä»¬å¯ä»¥å†™ä¸ªå·¥å…·ç±»æ–¹ä¾¿æˆ‘ä»¬ä¸Šä¼ ï¼Œå°†å¾—åˆ°çš„fileä¿¡æ¯ç›´æ¥æ”¾åœ¨è™šæ‹Ÿæœºip/åé¢<br><img alt="image" data-src="http://p3.so.qhimgs1.com/bdr/_240_/t0151a407cda74a2153.png" src="/img/loading.gif" class="lazyload">æˆåŠŸè®¿é—®åˆ°äº†è¿™å¼ å›¾ç‰‡ï¼è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚</p><ul><li><p>åœ¨æ·˜æ·˜å•†åŸä¸­çš„è¿ç”¨<br> åœ¨æ·˜æ·˜ä¸­ä¸»è¦æ˜¯ç”¨åœ¨åå°çš„å›¾ç‰‡ä¸Šä¼ ä¸Šçš„ è¿™é‡Œç”¨çš„æ˜¯ssmçš„ç»„åˆSpringMVCä¸Šä¼ å›¾ç‰‡é¦–å…ˆè¦æœ‰commons.ioå’Œfileuploadçš„jaråŒ…è¿˜æœ‰é…ç½®å¤šåª’ä½“è§£æå™¨<br>åœ¨è¿™é‡Œæˆ‘ä¹Ÿé‡åˆ°äº†ä¸€ä¸ªå°é—®é¢˜ ä»–åœ¨è¿™é‡Œç”¨çš„æ˜¯<em>KingEditor</em> ä¸Šä¼ å›¾ç‰‡æ—¶è¦æ±‚è¿”å›çš„æ ¼å¼æ˜¯</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="comment">//æˆåŠŸæ—¶</span></span><br><span class="line">  { </span><br><span class="line">        <span class="string">"error"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="string">"url"</span> : <span class="string">"http://www.example.com/path/to/file.ext"</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">//å¤±è´¥æ—¶</span></span><br><span class="line">{</span><br><span class="line">        <span class="string">"error"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="string">"message"</span> : <span class="string">"é”™è¯¯ä¿¡æ¯"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>æˆ‘ç›´æ¥è¿”å›çš„ä¸€ä¸ªmapç„¶åå‰å°è§£æä¸å‡ºæ¥å‡ºç°äº†é—®é¢˜åæ¥ç”¨fastJsonæŠŠmapè½¬æˆjsonåå°±å¥½äº†ä½†æ˜¯å…¶å®ä¼ è¿˜æ˜¯ä¼ åˆ°äº†å›¾ç‰‡æœåŠ¡å™¨ä¸Šå»äº†</p></li><li><p>åœ¨åšè¿™ä¸ªçš„æ—¶å€™è¿˜é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„é—®é¢˜å°±æ˜¯å¦‚æœä¿®æ”¹ä»£ç åé©¬ä¸Šé‡æ–°å¯åŠ¨é¡¹ç›®ä¼šæŠ¥é”™cleanä¸€ä¸‹å°±å¥½äº†ã€‚</p></li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…¥é—¨ </tag>
            
            <tag> FastDFS </tag>
            
            <tag> æ·˜æ·˜å•†åŸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå­¦ä¹ </title>
      <link href="/2018/05/13/nginx-xue-xi/"/>
      <url>/2018/05/13/nginx-xue-xi/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="Nginxå­¦ä¹ ç¬”è®°"><a href="#Nginxå­¦ä¹ ç¬”è®°" class="headerlink" title="Nginxå­¦ä¹ ç¬”è®°"></a>Nginxå­¦ä¹ ç¬”è®°</h1><ul><li><p>Nginxç®€ä»‹<br><em>Nginx</em> (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<a href="https://baike.so.com/doc/5366073-5601774.html" target="_blank" rel="noopener">HTTP</a>å’Œ<a href="https://baike.so.com/doc/5345781-5581226.html" target="_blank" rel="noopener">åå‘ä»£ç†</a>æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªIMAP/POP3/SMTP<a href="https://baike.so.com/doc/4487696-4696885.html" target="_blank" rel="noopener">æœåŠ¡å™¨</a>ã€‚Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹(ä¿„æ–‡:Ğ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€)å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚<br>å…¶å°†æºä»£ç ä»¥ç±»BSDè®¸å¯è¯çš„å½¢å¼å‘å¸ƒï¼Œå› å®ƒçš„ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç¤ºä¾‹é…ç½®æ–‡ä»¶å’Œä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—è€Œé—»åã€‚2011å¹´6æœˆ1æ—¥ï¼Œnginx 1.0.4å‘å¸ƒã€‚<br>Nginxæ˜¯ä¸€æ¬¾<a href="https://baike.so.com/doc/585215-619452.html" target="_blank" rel="noopener">è½»é‡çº§</a>çš„<a href="https://baike.so.com/doc/4230501-4432285.html" target="_blank" rel="noopener">Web</a> æœåŠ¡å™¨/<a href="https://baike.so.com/doc/5345781-5581226.html" target="_blank" rel="noopener">åå‘ä»£ç†</a>æœåŠ¡å™¨åŠ<a href="https://baike.so.com/doc/928072-980969.html" target="_blank" rel="noopener">ç”µå­é‚®ä»¶</a>(IMAP/POP3)ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸€ä¸ªBSD-like åè®®ä¸‹å‘è¡Œã€‚å…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œ<a href="https://baike.so.com/doc/6916691-7138566.html" target="_blank" rel="noopener">å¹¶å‘</a>èƒ½åŠ›å¼ºï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›ç¡®å®åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸­å›½å¤§é™†ä½¿ç”¨nginxç½‘ç«™ç”¨æˆ·æœ‰:ç™¾åº¦ã€äº¬ä¸œã€<a href="https://baike.so.com/doc/2204905-2333035.html" target="_blank" rel="noopener">æ–°æµª</a>ã€ç½‘æ˜“ã€<a href="https://baike.so.com/doc/1038695-1098608.html" target="_blank" rel="noopener">è…¾è®¯</a>ã€æ·˜å®ç­‰ã€‚</p></li><li><p>Nginxä¸»è¦ä½œç”¨</p></li></ul><ol><li>(HttpæœåŠ¡å™¨)å¤„ç†é™æ€æ–‡ä»¶<br><img alt="image" data-src="http://p0.cdn.img9.top/ipfs/QmdiKx1JUr7y9TabUQNNqu5dP8AwdsHSHe9QMwa487rsaS?0.png" src="/img/loading.gif" class="lazyload"><br>åƒè¿™æ ·é…ç½®çš„è¯å½“è®¿é—® <em>localhost:80</em> æ—¶å°±ä¼šè®¿é—®åˆ°ç›¸å¯¹å½“å‰è·¯å¾„ä¸‹çš„ htmlæ–‡ä»¶å¤¹ä¸‹çš„index.html æˆ–è€…index.htm</li><li>åå‘ä»£ç†<br> <strong>åå‘ä»£ç†</strong> ä¹Ÿæ˜¯nginxç”¨çš„æœ€å¤šçš„åœ°æ–¹ï¼Œæ—¢ç„¶æœ‰åå‘ä»£ç†é‚£å°±è‚¯å®šæœ‰ <strong>æ­£å‘ä»£ç†</strong> å…ˆæ¥ç†è§£ä¸‹æ­£å‘ä»£ç†<img alt="image" data-src="https://gss0.baidu.com/7LsWdDW5_xN3otqbppnN2DJv/zhidao/pic/item/a2cc7cd98d1001e96d753f76b10e7bec54e79779.jpg" src="/img/loading.gif" class="lazyload"><br>æ­£å‘ä»£ç†å…¶å®å°±æ˜¯ä»£ç†ä¸Šç½‘ï¼Œ<strong>å®¢æˆ·ç«¯</strong>å‘é€è¯·æ±‚åˆ°ä»£ç†æœåŠ¡å™¨ç„¶åä»£ç†æœåŠ¡å™¨è½¬äº¤è¯·æ±‚ç»™<strong>ç›®æ ‡æœåŠ¡å™¨</strong>ç›®æ ‡æœåŠ¡å™¨å“åº”ç»™ä»£ç†æœåŠ¡å™¨ä»£ç†æœåŠ¡å™¨å†å“åº”ç»™<strong>å®¢æˆ·ç«¯</strong>ä¹Ÿå°±èµ·åˆ°äº†ä»£ç†çš„ä½œç”¨<br>é‚£åå‘ä»£ç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br><img alt="image" data-src="https://gss0.baidu.com/7LsWdDW5_xN3otqbppnN2DJv/zhidao/pic/item/a8014c086e061d95f3f21c4172f40ad162d9ca17.jpg" src="/img/loading.gif" class="lazyload"><br>æ­£å‘ä»£ç†é’ˆå¯¹çš„æ˜¯<strong>å®¢æˆ·ç«¯</strong>è€Œåå‘ä»£ç†æ­£å¯¹çš„æ˜¯<strong>æœåŠ¡ç«¯</strong><br>å½“ç”¨æˆ·å‘é€ä¸€ä¸ªè¯·æ±‚ç»™ServerBç„¶åServerBåˆ¤æ–­ç”¨æˆ·æ˜¯ä»€ä¹ˆè¯·æ±‚<br>æ˜¯è¯·æ±‚Server1å°±è½¬å‘ç»™Server1â€¦ åœ¨ç”Ÿäº§ä¸­å‰ç«¯ç”¨ä¸€ä¸ªNginxå¤„ç†ç”¨æˆ·çš„è¯·æ±‚å†åˆ†å‘åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚</li></ol><p><strong>é…ç½®</strong></p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">upstream sina{</span><br><span class="line">server <span class="number">192.168</span><span class="number">.125</span><span class="number">.3</span>:<span class="number">8080</span>;</span><br><span class="line">    }</span><br><span class="line">    server {</span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name  www.sina.com.cn;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / {</span><br><span class="line">            proxy_pass   http:<span class="comment">//sina;</span></span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">     upstream sohu{</span><br><span class="line">server <span class="number">192.168</span><span class="number">.125</span><span class="number">.3</span>:<span class="number">8081</span>;</span><br><span class="line">    }</span><br><span class="line">    server {</span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name  www.sohu.com;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / {</span><br><span class="line">#äº¤ç»™è°ä»£ç†</span><br><span class="line">            proxy_pass   http:<span class="comment">//sohu;</span></span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div><p>åƒè¿™æ ·é…ç½®å®¢æˆ·ç«¯è®¿é—®é€šè¿‡ä¸€ä¸ªå…¬ç½‘ipå…¥å£å…ˆåˆ°è¾¾Nginxç„¶åè½¬å‘ç»™å¯¹åº”çš„æœåŠ¡å™¨å½“ç”¨æˆ·è®¿é—®<em><a href="http://www.sohu.com*æ—¶å°±ä¼šè½¬å‘ç»™http://sohu" target="_blank" rel="noopener">www.sohu.com*æ—¶å°±ä¼šè½¬å‘ç»™http://sohu</a> è¿™ä¸ªå°±æ˜¯ä¸Šé¢çš„upstream sohu{â€¦} äº¤ç»™å®ƒå¤„ç†<br>3. è´Ÿè½½å‡è¡¡å’Œå®¹é”™<br>    è´Ÿè½½å‡è¡¡å°±æ˜¯åœ¨åå‘ä»£ç†çš„ä¸­é—´åŠ ä¸Šçš„ å°±æ˜¯åœ¨upstream é‡Œé¢åŠ ä¸€ä¸ªserverï¼Œæœ€ç®€å•çš„è´Ÿè½½å‡è¡¡å°±æ˜¯è½®è¯¢ä¸€äººä¸€æ¬¡åˆ·æ–°å°±æ¢(*é»˜è®¤çš„å°±æ˜¯è½®è¯¢</em>) å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®æœåŠ¡å™¨æ€§èƒ½é…ç½®æƒé‡æƒé‡è¶Šå¤§è®¿é—®åˆ°çš„æœºä¼šè¶Šå¤§</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">upstream sina{</span><br><span class="line">server <span class="number">192.168</span><span class="number">.125</span><span class="number">.3</span>:<span class="number">8080</span>;</span><br><span class="line">#weigthæ˜¯æƒé‡</span><br><span class="line">server <span class="number">192.168</span><span class="number">.25</span><span class="number">.148</span>:<span class="number">8082</span> weight=<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    server {</span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        server_name  www.sina.com.cn;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / {</span><br><span class="line">            proxy_pass   http:<span class="comment">//sina;</span></span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">         }</span><br><span class="line">       }</span><br></pre></td></tr></tbody></table></figure></div><p>ç”±äºNginxæ˜¯æˆ‘ä»¬ç½‘ç«™çš„å…¥å£å¦‚æœNginxæŒ‚æ‰åé¢çš„æœåŠ¡å°±éƒ½å¤±æ•ˆäº†è¿™æ—¶å€™å°±å¯ä»¥åŠ å¤‡ç”¨NginxæœåŠ¡å™¨ç”¨ keepalive+Nginxå®ç°ä¸»å¤‡<img alt="image" data-src="http://p0.cdn.img9.top/ipfs/Qmc3nC82Xsh1QANbUfAdDGUmTL2KJ2bQzoYzge7VHvRRWu?0.png" src="/img/loading.gif" class="lazyload"></p></body></html>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoç¬¬ä¸€ç¯‡åšå®¢</title>
      <link href="/2018/05/10/hexo-de-di-yi-pian-bo-ke/"/>
      <url>/2018/05/10/hexo-de-di-yi-pian-bo-ke/</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="ç¬¬ä¸€ç¯‡Hexoåšå®¢"><a href="#ç¬¬ä¸€ç¯‡Hexoåšå®¢" class="headerlink" title="ç¬¬ä¸€ç¯‡Hexoåšå®¢"></a>ç¬¬ä¸€ç¯‡Hexoåšå®¢</h1><ul><li>æ‰å¼€å§‹æ¥è§¦<em>markdown</em>ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸è¿‡æ„Ÿè§‰è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ ğŸ˜‚  </li></ul><p><img alt="image" data-src="http://p4.cdn.img9.top/ipfs/QmcPovxCWmXZdSB7GYz1RJUp1twhrnHEeZMDnidv4S5kvB?4.jpg" src="/img/loading.gif" class="lazyload"></p><ul><li>æœ¬æ¥æ˜¯æƒ³æŠŠè¿™ä¸ªåšå®¢æ”¾åˆ°æˆ‘çš„é˜¿é‡Œäº‘ä¸Šçš„ï¼Œä½†æ˜¯æ„Ÿè§‰æ—¥å¸¸å†™å†™åšå®¢ä¹Ÿå¤Ÿäº†ï¼Œç§»è¿‡å»å¯ä»¥è‡ªå·±å†™å†™åå°ä½†æ„Ÿè§‰æœ‰ç‚¹éº»çƒ¦ï¼Œç­‰åˆ°ä»¥åæœ‰æ—¶é—´äº†å†æ¥æŠ˜è…¾ï¼Œæ—¥å¸¸ç”¨ç”¨è¿™ä¸ªé™æ€çš„å°±å¤Ÿäº† ç”¨äº†cdnåŠ é€Ÿè®¿é—®é€Ÿåº¦è¿˜å¯ä»¥ğŸ˜‰</li><li>å…¶å®ä¹‹å‰è‡ªå·±ä¹Ÿè‡ªå·±åšäº†ä¸€ä¸ªåšå®¢ å‰å°åå°éƒ½æ˜¯è‡ªå·±å†™çš„ å‰ç«¯ä¸å¤ªç†Ÿæ‚‰ç”¨çš„bsï¼Œåå°æ˜¯ssmçš„ æœ¬æ¥æƒ³ä¸Šçº¿çš„ ä½†æ˜¯æ„Ÿè§‰å¤ªä¸‘äº†äº†è€Œä¸”åå°çš„ä»£ç ä¹Ÿè¿˜æœ‰é—®é¢˜ğŸ˜‚æ”¾å¼ å›¾å¯¹æ¯”ä¸‹<br><img alt="image" data-src="http://p1.cdn.img9.top/ipfs/Qmc73XD1sHrvpEM2Wn8DMSXZcvRGjSW2x7GJPuzhjJa68c?1.jpg" src="/img/loading.gif" class="lazyload"> å°±è¿™ä¸ªç”»é£ å“åº”å¼ä¹Ÿè¢«æˆ‘ç¦ç”¨äº† å®åœ¨æ˜¯å“åº”çš„å¤ªè¯¡å¼‚äº† å†çœ‹çœ‹<em>material</em><br><code>Hexoçš„ä¸€æ¬¾ä¸»é¢˜</code><br><img alt="image" data-src="http://p1.cdn.img9.top/ipfs/QmcghHet9V1iE2CXxYnUh9VbwQq6STX3ZpsZqs6ruy657h?1.png" src="/img/loading.gif" class="lazyload"></li></ul><hr><p> <img alt="mark" data-src="http://static.imlgw.top///20190127/0ddQkCXFDNyh.png?imageslim" src="/img/loading.gif" class="lazyload"> ç¬¬2ä¸ªä¸»é¢˜</p><hr><p>ç›®å‰çš„æ˜¯ç¬¬ä¸‰ä¸ª</p><ul><li>è®¤è®¤çœŸçœŸçš„å†™åšå®¢äº†ã€‚</li></ul></body></html>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…¥é—¨ </tag>
            
            <tag> Hexo </tag>
            
            <tag> ä½“éªŒ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>ç•™è¨€æ¿</title>
      <link href="/board/index.html"/>
      <url>/board/index.html</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h2 id="Dj-drop-the-beat-à¸‡-â€¢-â€¢-à¸‡"><a href="#Dj-drop-the-beat-à¸‡-â€¢-â€¢-à¸‡" class="headerlink" title="Dj drop the beat(à¸‡ â€¢_â€¢)à¸‡"></a>Dj drop the beat(à¸‡ â€¢_â€¢)à¸‡</h2>        <div id="aplayer-XtMUlQLL" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>  <script>  var options = {"narrow":false,"autoplay":true,"showlrc":3,"mode":"random","mutex":true,"theme":"#e6d0b2","preload":"metadata","listmaxheight":"513px","volume":"0.4","music":[{"title":"è² ã‘ãªã„ã§","author":"ZARD","url":"http://static.imlgw.top/ZARD%20-%20%E8%B2%A0%E3%81%91%E3%81%AA%E3%81%84%E3%81%A7.mp3","pic":"http://static.imlgw.top/image/20190712/8732e58f48a6243e538a1331928d6d8f_hd.jpg"},{"title":"æˆ‘è¦ä½ ","author":"ä»»ç´ æ±","url":"http://static.imlgw.top/%E4%BB%BB%E7%B4%A0%E6%B1%90%20-%20%E6%88%91%E8%A6%81%E4%BD%A0.mp3","pic":"http://p1.music.126.net/s059kMtY8NRM2HHIErbIAw==/19201871067699838.jpg?param=130y130"},{"title":"å†™ç»™çˆ¶äº²","author":"å¢æ’å®‡ / æå§æ´","url":"http://static.imlgw.top/%E5%8D%A2%E6%81%92%E5%AE%87%20-%20%E5%86%99%E7%BB%99%E7%88%B6%E4%BA%B2.mp3","pic":"http://p2.music.126.net/RDQy2q05vy6SArA9W2LZ-Q==/3295236350128133.jpg?param=130y130"},{"title":"å˜²ç¬‘å£°","author":"Big Daddy","url":"http://static.imlgw.top/Big%C2%A0Daddy%20-%20%E5%98%B2%E7%AC%91%E5%A3%B0.mp3","pic":"http://p2.music.126.net/ok_2pydxVx8o6iXcC_w-xg==/109951164035285206.jpg?param=130y130"},{"title":"ç¬¬äºŒå±¥å†","author":"Big Daddy","url":"http://static.imlgw.top/Am%20-%20%E7%AC%AC%E4%BA%8C%E5%B1%A5%E5%8E%86.mp3","pic":"https://p1.music.126.net/EwinkxB_RdScQyO5yKvGSQ==/109951163680107440.jpg?param=90y90"},{"title":"é‹å‘½ã®ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆå»»ã—ã¦","author":"ZARD","url":"http://static.imlgw.top/ZARD%20-%20%E9%81%8B%E5%91%BD%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AC%E3%83%83%E3%83%88%E5%BB%BB%E3%81%97%E3%81%A6.mp3","pic":"http://static.imlgw.top/image/20190712/8732e58f48a6243e538a1331928d6d8f_hd.jpg"}]};  options.element = document.getElementById("aplayer-XtMUlQLL");  var ap = new APlayer(options);    window.aplayers || (window.aplayers = []);  window.aplayers.push(ap);  </script></body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºæˆ‘</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body><h1 id="åšä¸»ç®€ä»‹"><a href="#åšä¸»ç®€ä»‹" class="headerlink" title="åšä¸»ç®€ä»‹"></a>åšä¸»ç®€ä»‹</h1><blockquote><p>å¤§æ‚²æ— æ³ªï¼Œå¤§æ‚Ÿæ— è¨€ï¼Œå¤§ç¬‘æ— å£°ã€‚</p></blockquote><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String []nickName={<span class="string">"åŠå²›é“ç›’"</span>,<span class="string">"iMlGw0"</span>,<span class="string">"Resolmi"</span>,...};</span><br><span class="line"><span class="keyword">boolean</span> isMale=<span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">int</span> age=<span class="number">19</span>;</span><br><span class="line">String []skills={<span class="string">"Java"</span>,<span class="string">"Web"</span>,<span class="string">"Sql"</span>,<span class="string">"Linux"</span>,...};</span><br><span class="line">String address=<span class="string">"Hubei"</span>;</span><br><span class="line">String weChat=<span class="string">"ZnFeMn"</span>;</span><br></pre></td></tr></tbody></table></figure></div><p><img alt="å§å§" data-src="http://static.imlgw.top/image/20190712/a17c8f3c1a5449ea19996c40ff14d0e3_hd.jpg" src="/img/loading.gif" class="lazyload"></p></body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†ç±»</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body></body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>friends</title>
      <link href="/friends/index.html"/>
      <url>/friends/index.html</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body></body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§ä½¬ä»¬</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body></body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>Search</title>
      <link href="/search/index.html"/>
      <url>/search/index.html</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body></body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ç« æ ‡ç­¾</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[<html><head><link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script></head><body></body></html>]]></content>
      
    </entry>
    
    
  
</search>
