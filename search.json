[{"title":"è®°ä¸¤é“å¹¶æŸ¥é›†çš„é¢˜","url":"/2021/01/18/ji-liang-dao-bing-cha-ji-de-ti/","content":"\n> LeetCodeæœ€è¿‘æ¯æ—¥ä¸€é¢˜å‡ºäº†å¥½å‡ é“å¹¶æŸ¥é›†çš„é¢˜ï¼Œæœ‰å‡ é“æŒºæœ‰æ„æ€çš„ï¼Œè®°å½•ä¸€ä¸‹\n## [947. ç§»é™¤æœ€å¤šçš„åŒè¡Œæˆ–åŒåˆ—çŸ³å¤´](https://leetcode-cn.com/problems/most-stones-removed-with-same-row-or-column/)\n\nDifficulty: **ä¸­ç­‰**\n\n\n`n` å—çŸ³å¤´æ”¾ç½®åœ¨äºŒç»´å¹³é¢ä¸­çš„ä¸€äº›æ•´æ•°åæ ‡ç‚¹ä¸Šã€‚æ¯ä¸ªåæ ‡ç‚¹ä¸Šæœ€å¤šåªèƒ½æœ‰ä¸€å—çŸ³å¤´ã€‚\n\nå¦‚æœä¸€å—çŸ³å¤´çš„ **åŒè¡Œæˆ–è€…åŒåˆ—** ä¸Šæœ‰å…¶ä»–çŸ³å¤´å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç§»é™¤è¿™å—çŸ³å¤´ã€‚\n\nç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•°ç»„ `stones` ï¼Œå…¶ä¸­ stones[i] = [x<sub style=\"display: inline;\">i</sub>, y<sub style=\"display: inline;\">i</sub>] è¡¨ç¤ºç¬¬ `i` å—çŸ³å¤´çš„ä½ç½®ï¼Œè¿”å› **å¯ä»¥ç§»é™¤çš„çŸ³å­** çš„æœ€å¤§æ•°é‡ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šstones = [[0,0],[0,1],[1,0],[1,2],[2,1],[2,2]]\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šä¸€ç§ç§»é™¤ 5 å—çŸ³å¤´çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š\n1. ç§»é™¤çŸ³å¤´ [2,2] ï¼Œå› ä¸ºå®ƒå’Œ [2,1] åŒè¡Œã€‚\n2. ç§»é™¤çŸ³å¤´ [2,1] ï¼Œå› ä¸ºå®ƒå’Œ [0,1] åŒåˆ—ã€‚\n3. ç§»é™¤çŸ³å¤´ [1,2] ï¼Œå› ä¸ºå®ƒå’Œ [1,0] åŒè¡Œã€‚\n4. ç§»é™¤çŸ³å¤´ [1,0] ï¼Œå› ä¸ºå®ƒå’Œ [0,0] åŒåˆ—ã€‚\n5. ç§»é™¤çŸ³å¤´ [0,1] ï¼Œå› ä¸ºå®ƒå’Œ [0,0] åŒè¡Œã€‚\nçŸ³å¤´ [0,0] ä¸èƒ½ç§»é™¤ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä¸å¦ä¸€å—çŸ³å¤´åŒè¡Œ/åˆ—ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šstones = [[0,0],[0,2],[1,1],[2,0],[2,2]]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šä¸€ç§ç§»é™¤ 3 å—çŸ³å¤´çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š\n1. ç§»é™¤çŸ³å¤´ [2,2] ï¼Œå› ä¸ºå®ƒå’Œ [2,0] åŒè¡Œã€‚\n2. ç§»é™¤çŸ³å¤´ [2,0] ï¼Œå› ä¸ºå®ƒå’Œ [0,0] åŒåˆ—ã€‚\n3. ç§»é™¤çŸ³å¤´ [0,2] ï¼Œå› ä¸ºå®ƒå’Œ [0,0] åŒè¡Œã€‚\nçŸ³å¤´ [0,0] å’Œ [1,1] ä¸èƒ½ç§»é™¤ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ä¸å¦ä¸€å—çŸ³å¤´åŒè¡Œ/åˆ—ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼šstones = [[0,0]]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼š[0,0] æ˜¯å¹³é¢ä¸Šå”¯ä¸€ä¸€å—çŸ³å¤´ï¼Œæ‰€ä»¥ä¸å¯ä»¥ç§»é™¤å®ƒã€‚\n```\n\n**æç¤ºï¼š**\n\n*   1 <= stones.length <= 1000\n*   0 <= x<sub style=\"display: inline;\">i</sub>, y<sub style=\"display: inline;\">i</sub> <= 10<sup>4</sup>\n*   ä¸ä¼šæœ‰ä¸¤å—çŸ³å¤´æ”¾åœ¨åŒä¸€ä¸ªåæ ‡ç‚¹ä¸Š\n\n\n### è§£æ³•ä¸€\n\nç®€å•çš„æƒ³æ³•è‚¯å®šæ˜¯ç›´æ¥åŒé‡å¾ªç¯æšä¸¾æ‰€æœ‰çš„ç‚¹å¯¹ï¼Œå¦‚æœä¸¤ä¸ªç‚¹æ¨ªçºµåæ ‡æœ‰ä¸€æ ·çš„å°±åˆå¹¶ï¼Œæœ€åç»Ÿè®¡ä¸‹å°±è¡Œäº†ï¼Œä½†æ˜¯è¿™æ ·æ—¶é—´å¤æ‚åº¦å°±æ¯”è¾ƒé«˜äº†ã€‚\n\nè¿™é‡Œæˆ‘ä»¬æ¢ä¸€ä¸ªæ€è·¯æ¥åˆå¹¶ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸å…³å¿ƒå„ä¸ªç‚¹æ˜¯å¦‚ä½•è”é€šçš„ï¼Œåªè¦å„ä¸ªç‚¹åœ¨åŒä¸€è¡Œæˆ–è€…åŒä¸€åˆ—é‚£ä¹ˆä»–ä»¬å°±æ˜¯è¿é€šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†æ¯ä¸ªç‚¹çš„è¡Œåˆ—åæ ‡è¿›è¡Œåˆå¹¶ï¼Œä¹Ÿå°±ç›¸å½“äºæˆ‘ä»¬å°† **è¯¥è¡Œä»¥åŠè¯¥åˆ—çš„æ‰€æœ‰å…ƒç´ ** ä¸ **å½“å‰çš„å…ƒç´ ** åˆå¹¶èµ·æ¥ï¼Œæœ€åç”¨çŸ³å¤´æ•°é‡å‡å»è¿é€šåˆ†é‡çš„ä¸ªæ•°å°±è¡Œäº†ã€‚éœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯æˆ‘ä»¬éœ€è¦åŒºåˆ†æ¨ªçºµåæ ‡ï¼Œé¿å…æ··æ·†ã€‚æ¯”å¦‚ï¼ˆ1ï¼Œ2ï¼‰å’Œï¼ˆ2ï¼Œ4ï¼‰ä¸æ˜¯åŒä¸€è¡Œåˆ—ï¼Œå¦‚æœä¸åŠ åŒºåˆ†å°±ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªè¿é€šåˆ†é‡ï¼Œè¿™é‡Œé¢˜ç›®ç»™äº†è¡Œåˆ—çš„èŒƒå›´ï¼Œæˆ‘ä»¬ç›´æ¥åŠ ä¸Šä¸€ä¸ª10001å°±è¡Œäº†\n\n```python\nclass Solution(object):\n    def removeStones(self, stones: List[List[int]]) -> int:\n        n = len(stones)\n        parent = {}\n        count = 0\n\n        def union(a, b):\n            nonlocal count\n            pa = find(a)\n            pb = find(b)\n            if pa == pb:\n                return\n            count -= 1\n            parent[pa] = pb\n\n        def find(a):\n            nonlocal count\n            if a not in parent:\n                count += 1\n                parent[a] = a\n                return a\n            if a == parent[a]:\n                return a\n            parent[a] = find(parent.get(a))\n            return parent.get(a)\n\n        for s in stones:\n            union(s[0]+10001, s[1])\n        return n - count\n```\n\n## [803. æ‰“ç –å—](https://leetcode-cn.com/problems/bricks-falling-when-hit/)\n\nDifficulty: **å›°éš¾**\n\n\næœ‰ä¸€ä¸ª `m x n` çš„äºŒå…ƒç½‘æ ¼ï¼Œå…¶ä¸­ `1` è¡¨ç¤ºç –å—ï¼Œ`0` è¡¨ç¤ºç©ºç™½ã€‚ç –å— **ç¨³å®š**ï¼ˆä¸ä¼šæ‰è½ï¼‰çš„å‰ææ˜¯ï¼š\n\n*   ä¸€å—ç –ç›´æ¥è¿æ¥åˆ°ç½‘æ ¼çš„é¡¶éƒ¨ï¼Œæˆ–è€…\n*   è‡³å°‘æœ‰ä¸€å—ç›¸é‚»ï¼ˆ4Â ä¸ªæ–¹å‘ä¹‹ä¸€ï¼‰ç –å— **ç¨³å®š** ä¸ä¼šæ‰è½æ—¶\n\nç»™ä½ ä¸€ä¸ªæ•°ç»„ `hits` ï¼Œè¿™æ˜¯éœ€è¦ä¾æ¬¡æ¶ˆé™¤ç –å—çš„ä½ç½®ã€‚æ¯å½“æ¶ˆé™¤Â `hits[i] = (rowi, coli)` ä½ç½®ä¸Šçš„ç –å—æ—¶ï¼Œå¯¹åº”ä½ç½®çš„ç –å—ï¼ˆè‹¥å­˜åœ¨ï¼‰ä¼šæ¶ˆå¤±ï¼Œç„¶åå…¶ä»–çš„ç –å—å¯èƒ½å› ä¸ºè¿™ä¸€æ¶ˆé™¤æ“ä½œè€Œæ‰è½ã€‚ä¸€æ—¦ç –å—æ‰è½ï¼Œå®ƒä¼šç«‹å³ä»ç½‘æ ¼ä¸­æ¶ˆå¤±ï¼ˆå³ï¼Œå®ƒä¸ä¼šè½åœ¨å…¶ä»–ç¨³å®šçš„ç –å—ä¸Šï¼‰ã€‚\n\nè¿”å›ä¸€ä¸ªæ•°ç»„ `result` ï¼Œå…¶ä¸­ `result[i]` è¡¨ç¤ºç¬¬ `i` æ¬¡æ¶ˆé™¤æ“ä½œå¯¹åº”æ‰è½çš„ç –å—æ•°ç›®ã€‚\n\n**æ³¨æ„**ï¼Œæ¶ˆé™¤å¯èƒ½æŒ‡å‘æ˜¯æ²¡æœ‰ç –å—çš„ç©ºç™½ä½ç½®ï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œåˆ™æ²¡æœ‰ç –å—æ‰è½ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šgrid = [[1,0,0,0],[1,1,1,0]], hits = [[1,0]]\nè¾“å‡ºï¼š[2]\nè§£é‡Šï¼š\nç½‘æ ¼å¼€å§‹ä¸ºï¼š\n[[1,0,0,0]ï¼Œ\n [1,1,1,0]]\næ¶ˆé™¤ (1,0) å¤„åŠ ç²—çš„ç –å—ï¼Œå¾—åˆ°ç½‘æ ¼ï¼š\n[[1,0,0,0]\n [0,1,1,0]]\nä¸¤ä¸ªåŠ ç²—çš„ç –ä¸å†ç¨³å®šï¼Œå› ä¸ºå®ƒä»¬ä¸å†ä¸é¡¶éƒ¨ç›¸è¿ï¼Œä¹Ÿä¸å†ä¸å¦ä¸€ä¸ªç¨³å®šçš„ç –ç›¸é‚»ï¼Œå› æ­¤å®ƒä»¬å°†æ‰è½ã€‚å¾—åˆ°ç½‘æ ¼ï¼š\n[[1,0,0,0],\n [0,0,0,0]]\nå› æ­¤ï¼Œç»“æœä¸º [2] ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šgrid = [[1,0,0,0],[1,1,0,0]], hits = [[1,1],[1,0]]\nè¾“å‡ºï¼š[0,0]\nè§£é‡Šï¼š\nç½‘æ ¼å¼€å§‹ä¸ºï¼š\n[[1,0,0,0],\n [1,1,0,0]]\næ¶ˆé™¤ (1,1) å¤„åŠ ç²—çš„ç –å—ï¼Œå¾—åˆ°ç½‘æ ¼ï¼š\n[[1,0,0,0],\n [1,0,0,0]]\nå‰©ä¸‹çš„ç –éƒ½å¾ˆç¨³å®šï¼Œæ‰€ä»¥ä¸ä¼šæ‰è½ã€‚ç½‘æ ¼ä¿æŒä¸å˜ï¼š\n[[1,0,0,0], \n [1,0,0,0]]\næ¥ä¸‹æ¥æ¶ˆé™¤ (1,0) å¤„åŠ ç²—çš„ç –å—ï¼Œå¾—åˆ°ç½‘æ ¼ï¼š\n[[1,0,0,0],\n [0,0,0,0]]\nå‰©ä¸‹çš„ç –å—ä»ç„¶æ˜¯ç¨³å®šçš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ç –å—æ‰è½ã€‚\nå› æ­¤ï¼Œç»“æœä¸º [0,0] ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   m == grid.length\n*   n == grid[i].length\n*   1 <= m, n <= 200\n*   grid[i][j] ä¸º `0` æˆ– `1`\n*   1 <= hits.length <= 4 * 10<sup>4</sup>\n*   hits[i].length == 2\n*   0 <= x<sub style=\"display: inline;\">iÂ </sub><= m - 1\n*   0 <=Â y<sub style=\"display: inline;\">i</sub> <= n - 1\n*   æ‰€æœ‰ (x<sub style=\"display: inline;\">i</sub>, y<sub style=\"display: inline;\">i</sub>) äº’ä¸ç›¸åŒ\n\n\n### è§£æ³•ä¸€\n\nä¹Ÿæ˜¯ä¸€é“å¾ˆæœ‰æ„æ€çš„å¹¶æŸ¥é›†çš„é¢˜ã€‚å¸¸è§„æ„ä¹‰ä¸Šçš„å¹¶æŸ¥é›†åªèƒ½å¤„ç†è¿é€šå—çš„åˆå¹¶ï¼Œè€Œè¿™é¢˜æ‰“æ‰ä¸€ä¸ªç –å—æ„å‘³ç€è¿é€šåˆ†é‡çš„æ‹†åˆ†ï¼Œé‚£æˆ‘ä»¬åº”è¯¥å¦‚ä½•åˆ©ç”¨å¹¶æŸ¥é›†å‘¢ï¼Ÿ\n\nè¿™é‡Œçš„è§£æ³•å¾ˆå·§å¦™çš„é‡‡ç”¨äº† **é€†å‘æ€ç»´**ï¼Œæ—¢ç„¶æ‰“æ‰ç –å—æ— æ³•æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åè¿‡æ¥è¡¥ç –å—ï¼Œå…ˆå°†åŸæœ¬å¾…æ‰“å‡»çš„åœ°æ–¹ç½®ä¸º0ï¼Œç„¶åé€†å‘çš„çš„è¡¥ä¸Šå»ï¼Œè€Œè¡¥çš„æ“ä½œå°±ä»£è¡¨ç€è¿é€šå—çš„åˆå¹¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿é€šå—æ•°é‡çš„å˜åŒ–ç»Ÿè®¡æ‰è½çš„ç –å—ï¼Œæ•´ä½“çš„æ€è·¯éå¸¸å·§å¦™ã€‚\n\nå…·ä½“çš„ç®—æ³•å®ç°è¿˜æ˜¯æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œéƒ½æ³¨é‡Šåœ¨ä»£ç ä¸­äº†\n\n```java\nimport java.util.*;\nimport java.io.*;\n \nclass Solution {\n\n    int[] parent;\n    int[] size;\n\n    public int find(int a) {\n        if (parent[a] == a) return a;\n        return parent[a] = find(parent[a]);\n    }\n\n    public void union(int a, int b) {\n        int pa = find(a);\n        int pb = find(b);\n        if (pa == pb) return;\n        if (size[pa] > size[pb]) {\n            parent[pb] = pa;\n            size[pa] += size[pb]; \n        } else {\n            parent[pa] = pb;\n            size[pb] += size[pa];\n        }\n    }\n\n    public int[] hitBricks(int[][] grid, int[][] hits) {\n        int n = grid.length, m = grid[0].length;\n        int hlen = hits.length;\n        //è®°å½•å½“å‰hitså¯¹åº”çš„ä½ç½®æœ‰æ²¡æœ‰ç –å—\n        int[] exist = new int[hlen];\n        for (int i = 0; i < hlen; i++) {\n            int x = hits[i][0], y = hits[i][1];\n            exist[i] = grid[x][y]&1;\n            grid[x][y] = 0;\n        }\n        parent = new int[m*n+1];\n        size = new int[m*n+1];\n        //æŠ½è±¡çš„å±‹é¡¶èŠ‚ç‚¹\n        int ROOT = m*n;\n        for (int i = 0; i <= m*n; i++) {\n            parent[i] = i;\n            size[i] = 1;\n        }\n        //å’Œå±‹é¡¶æœ‰å…³è”çš„å…ˆåˆå¹¶ä¸‹\n        for (int j = 0; j < m; j++) {\n            if (grid[0][j] == 1) {\n                union(ROOT, j);\n            }\n        }\n        for (int i = 1; i < n; i++) {\n            for (int j = 0; j < m; j++) {\n                if (grid[i][j]==1) {\n                    //ä¸å·¦è¾¹å’Œä¸Šè¾¹æ–¹å—åˆå¹¶\n                    if (j-1 >= 0 && grid[i][j-1] == 1) {\n                        union(m*i+j, m*i+j-1);\n                    }\n                    if (/*i-1 >= 0 &&*/ grid[i-1][j] == 1) {\n                        union(m*i+j, m*(i-1)+j);\n                    }\n                }\n            }\n        }\n        int[] res = new int[hlen];\n        int[] dir = {1, 0, -1, 0, 1};\n        for (int i = hlen-1; i >= 0; i--) {\n            int last = size[find(ROOT)];\n            int x = hits[i][0], y = hits[i][1];\n            //WA_2: è¿˜åŸé”™è¯¯ï¼ŒhitåŸæœ¬å¯èƒ½æ²¡æœ‰ç –å—ï¼Œä¸€å¼€å§‹ç›´æ¥è¿˜åŸæˆ1äº†\n            grid[x][y] = exist[i]&1;\n            if (grid[x][y] == 0) continue;\n            //WA_1: è¿˜åŸåå’ŒROOTè¿æ¥çš„åˆ«å¿˜äº†åˆå¹¶\n            if (x == 0) union(ROOT, x*m+y);\n            //ä¸å‘¨å›´4ä¸ªæ–¹å‘çš„æ–¹å—åˆå¹¶\n            for (int k = 0; k < 4; k++) {\n                int nx = x + dir[k], ny = y + dir[k+1];\n                if (nx < 0 || ny < 0 || nx >= n || ny >= m || grid[nx][ny] != 1) {\n                    continue;\n                }\n                union(x*m+y, nx*m+ny);\n            }\n            res[i] = Math.max(0, size[find(ROOT)]-last-1);\n        }\n        return res;\n    }\n}\n```\n\n## [721. è´¦æˆ·åˆå¹¶](https://leetcode-cn.com/problems/accounts-merge/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªåˆ—è¡¨ `accounts`ï¼Œæ¯ä¸ªå…ƒç´  `accounts[i]`Â æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´  `accounts[i][0]`Â æ˜¯Â åç§° (name)ï¼Œå…¶ä½™å…ƒç´ æ˜¯ emails è¡¨ç¤ºè¯¥è´¦æˆ·çš„é‚®ç®±åœ°å€ã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬æƒ³åˆå¹¶è¿™äº›è´¦æˆ·ã€‚å¦‚æœä¸¤ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€äº›å…±åŒçš„é‚®ç®±åœ°å€ï¼Œåˆ™ä¸¤ä¸ªè´¦æˆ·å¿…å®šå±äºåŒä¸€ä¸ªäººã€‚è¯·æ³¨æ„ï¼Œå³ä½¿ä¸¤ä¸ªè´¦æˆ·å…·æœ‰ç›¸åŒçš„åç§°ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½å±äºä¸åŒçš„äººï¼Œå› ä¸ºäººä»¬å¯èƒ½å…·æœ‰ç›¸åŒçš„åç§°ã€‚ä¸€ä¸ªäººæœ€åˆå¯ä»¥æ‹¥æœ‰ä»»æ„æ•°é‡çš„è´¦æˆ·ï¼Œä½†å…¶æ‰€æœ‰è´¦æˆ·éƒ½å…·æœ‰ç›¸åŒçš„åç§°ã€‚\n\nåˆå¹¶è´¦æˆ·åï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼è¿”å›è´¦æˆ·ï¼šæ¯ä¸ªè´¦æˆ·çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯åç§°ï¼Œå…¶ä½™å…ƒç´ æ˜¯æŒ‰å­—ç¬¦ ASCII é¡ºåºæ’åˆ—çš„é‚®ç®±åœ°å€ã€‚è´¦æˆ·æœ¬èº«å¯ä»¥ä»¥ä»»æ„é¡ºåºè¿”å›ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼š\naccounts = [[\"John\", \"johnsmith@mail.com\", \"john00@mail.com\"], [\"John\", \"johnnybravo@mail.com\"], [\"John\", \"johnsmith@mail.com\", \"john_newyork@mail.com\"], [\"Mary\", \"mary@mail.com\"]]\nè¾“å‡ºï¼š\n[[\"John\", 'john00@mail.com', 'john_newyork@mail.com', 'johnsmith@mail.com'],  [\"John\", \"johnnybravo@mail.com\"], [\"Mary\", \"mary@mail.com\"]]\nè§£é‡Šï¼š\nç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ª John æ˜¯åŒä¸€ä¸ªäººï¼Œå› ä¸ºä»–ä»¬æœ‰å…±åŒçš„é‚®ç®±åœ°å€ \"johnsmith@mail.com\"ã€‚ \nç¬¬äºŒä¸ª John å’Œ Mary æ˜¯ä¸åŒçš„äººï¼Œå› ä¸ºä»–ä»¬çš„é‚®ç®±åœ°å€æ²¡æœ‰è¢«å…¶ä»–å¸æˆ·ä½¿ç”¨ã€‚\nå¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›è¿™äº›åˆ—è¡¨ï¼Œä¾‹å¦‚ç­”æ¡ˆ [['Mary'ï¼Œ'mary@mail.com']ï¼Œ['John'ï¼Œ'johnnybravo@mail.com']ï¼Œ\n['John'ï¼Œ'john00@mail.com'ï¼Œ'john_newyork@mail.com'ï¼Œ'johnsmith@mail.com']] ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `accounts`çš„é•¿åº¦å°†åœ¨`[1ï¼Œ1000]`çš„èŒƒå›´å†…ã€‚\n*   `accounts[i]`çš„é•¿åº¦å°†åœ¨`[1ï¼Œ10]`çš„èŒƒå›´å†…ã€‚\n*   `accounts[i][j]`çš„é•¿åº¦å°†åœ¨`[1ï¼Œ30]`çš„èŒƒå›´å†…ã€‚\n\n\n### è§£æ³•ä¸€\n\n>æ²¡é”™ï¼Œè¿™æ˜¯ç¬¬äºŒé“ï¼Œä¸Šé¢çš„æ˜¯ç¬¬0é“å’Œç¬¬1é“ğŸ˜\n\næœ¬æ¥ä¸æƒ³è®°è¿™é“é¢˜çš„ï¼Œæ²¡å•¥æ„æ€ï¼Œä¸šåŠ¡é¢˜ï¼Œä½†æ˜¯å†™éƒ½å†™äº†ï¼Œè¿˜æ˜¯è®°ä¸€ä¸‹ï¼Œéš¾å€’æ˜¯ä¸éš¾ï¼Œå°±æ˜¯è¦ç†æ¸…æ¥šæ€è·¯ï¼Œæˆ‘æ„Ÿè§‰å¾ˆéº»çƒ¦ç›´æ¥çœ‹äº†é¢˜è§£ğŸ˜‚ï¼Œä¸è¿‡é¢˜è§£ä¹Ÿæœ‰ç‚¹å°ç‘•ç–µï¼Œé‚®ä»¶æ˜ å°„å§“åçš„æ—¶å€™å¯ä»¥ç”¨é‚®ä»¶çš„ç¼–å·ç›´æ¥æ˜ å°„çš„ï¼Œé¢˜è§£ä¾ç„¶ç”¨çš„å­—ç¬¦ä¸²ã€‚è¿™ç§é¢˜å…¶å®åªæƒ³ç†æ¸…æ¥šå…ˆå¹²å˜›åå¹²å˜›å°±å¥½åšäº†ï¼Œåˆ«è€æƒ³ç€ä¸€æ­¥éƒ½æ±‚å‡ºæ¥ï¼Œå…ˆåˆ†æ­¥ï¼Œåé¢èƒ½åˆå¹¶å†åˆå¹¶ã€‚\n\n```java\nâ€‹import java.util.*;\nimport java.io.*;\n\nclass Solution {\n    \n    int[] parent;\n\n    public void union(int a, int b) {\n        parent[find(a)] = find(b);\n    }\n\n    public int find(int a) {\n        if (parent[a] == a) return a;\n        return parent[a] = find(parent[a]);\n    }\n\n    // æ¯”è¾ƒç¹çï¼Œæƒ³æ¸…æ¥šäº†å†™å°±å¾ˆç®€å•ï¼Œæ²¡å•¥æ„æ€\n    public List<List<String>> accountsMerge(List<List<String>> acc) {\n        //email : idx\n        HashMap<String, Integer> e2i = new HashMap<>();\n        //idx : name\n        HashMap<Integer, String> i2n = new HashMap<>();\n        int cnt = 0;\n        for (int i = 0; i < acc.size(); i++) {\n            String name = acc.get(i).get(0);\n            for (int j = 1; j < acc.get(i).size(); j++) {\n                String email = acc.get(i).get(j);\n                if (!e2i.containsKey(email)) {\n                    e2i.put(email, cnt);\n                    i2n.put(cnt++, name);\n                }\n            }\n        }\n        parent = new int[cnt];\n        for (int i = 0; i < cnt; i++) {\n            parent[i] = i;\n        }\n        for (int i = 0; i < acc.size(); i++) {\n            int first = e2i.get(acc.get(i).get(1));\n            for (int j = 2; j < acc.get(i).size(); j++) {\n                union(first, e2i.get(acc.get(i).get(j)));\n            }\n        }\n        // idx : emails\n        HashMap<Integer, List<String>> map = new HashMap<>();\n        for (String email : e2i.keySet()) {\n            map.computeIfAbsent(find(e2i.get(email)), k->new LinkedList<>()).add(email);\n        }\n        List<List<String>> res = new ArrayList<>();\n        for (Integer idx : map.keySet()) {\n            String name = i2n.get(idx);\n            List<String> emails = map.get(idx);\n            Collections.sort(emails);\n            emails.add(0, name);\n            res.add(emails);\n        }\n        return res;\n    }\n}\n```","tags":["ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"è´ªå¿ƒï¼šç»å¯¹å€¼ä¸ç­‰å¼","url":"/2021/01/17/tan-xin-jue-dui-zhi-bu-deng-shi/","content":"\n## [104. è´§ä»“é€‰å€](https://www.acwing.com/problem/content/description/106/)\n\nåœ¨ä¸€æ¡æ•°è½´ä¸Šæœ‰$N$å®¶å•†åº—ï¼Œå®ƒä»¬çš„åæ ‡åˆ†åˆ«ä¸º $A_1$ ~ $A_N$ã€‚\n\nç°åœ¨éœ€è¦åœ¨æ•°è½´ä¸Šå»ºç«‹ä¸€å®¶è´§ä»“ï¼Œæ¯å¤©æ¸…æ™¨ï¼Œä»è´§ä»“åˆ°æ¯å®¶å•†åº—éƒ½è¦è¿é€ä¸€è½¦å•†å“ã€‚\n\nä¸ºäº†æé«˜æ•ˆç‡ï¼Œæ±‚æŠŠè´§ä»“å»ºåœ¨ä½•å¤„ï¼Œå¯ä»¥ä½¿å¾—è´§ä»“åˆ°æ¯å®¶å•†åº—çš„è·ç¦»ä¹‹å’Œæœ€å°ã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•°$N$ã€‚\n\nç¬¬äºŒè¡ŒNä¸ªæ•´æ•°$A_1$ ~ $A_N$ã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè·ç¦»ä¹‹å’Œçš„æœ€å°å€¼ã€‚\n\n**æ•°æ®èŒƒå›´**ï¼š $1 â‰¤ N â‰¤ 100000$\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n4\n6 2 9 1\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```c\n12\n```\n### è§£æ³•ä¸€\n\n![mark](http://static.imlgw.top/blog/20210117/Tt7g9UupN0RX.png?imageslim)\nè´§ä»“ä½ç½®ä¸º$A_i$ï¼Œä¿®å»ºç‚¹ä¸º$x$ï¼Œé‚£ä¹ˆè´§ä»“åˆ°$x$ç‚¹çš„è·ç¦»ä¹‹å’Œä¸ºï¼š\n$$\n\\begin{aligned}\nf(x) &= \\sum_{i=0}^{n-1}|A_i-x| \\\\\\\\ &= |A_0-x|+|A_1-x|+...+|A_{n-2}-x|+|A_{n-1}-x| \\\\\\\\ &= (|A_0-x|+|A_{n-1}-x|) + (|A_1-x|+|A_{n-2}-x|) + ... + (|A_{mid-1}-x|+|A_{mid+1}-x|) \\\\\\\\ &\\geq(A_{n-1}-A_0) + (A_{n-2}-A_1) +...+ (A_{mid+1}-A_{mid-1})\n\\end{aligned}\n$$\n\nå½“ä¸”ä»…å½“$X$å–åœ¨$A_n$å’Œ$A_1$ä¸­é—´ï¼Œ$A_{n-2}$å’Œ$A_2$ä¸­é—´...ä»¥åŠ$A_{mid+1}$å’Œ$A_{mid-1}$ä¸­é—´æ—¶ï¼Œä¸ç­‰å¼å–å¾—æœ€å°å€¼ï¼Œå³$X$ä¸º$A_i$ä¸­ä½æ•°æ—¶ï¼ˆå¥‡å¶åŒç†ï¼‰\n```java\nimport java.util.*;\nimport java.io.*;\n\nclass Main {\n\n    public static void main(String... args) throws Exception {\n        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));\n        // BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(\"./input.txt\")));\n        int N = Integer.parseInt(br.readLine());\n        int[] A = read(br);\n        Arrays.sort(A);\n        int mid = A[(N-1)/2];  // ä¸‹å–æ•´\n        int res = 0;\n        for (int i = 0; i < N; i++) {\n            res += Math.abs(A[i]-mid);\n        }\n        System.out.println(res);\n    }\n\n    public static int[] read(BufferedReader br) throws Exception {\n        return Arrays.stream(br.readLine().split(\" \")).mapToInt(Integer::parseInt).toArray();\n    }\n}\n```\n\n## [462. æœ€å°‘ç§»åŠ¨æ¬¡æ•°ä½¿æ•°ç»„å…ƒç´ ç›¸ç­‰ II](https://leetcode-cn.com/problems/minimum-moves-to-equal-array-elements-ii/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°ä½¿æ‰€æœ‰æ•°ç»„å…ƒç´ ç›¸ç­‰æ‰€éœ€çš„æœ€å°ç§»åŠ¨æ•°ï¼Œå…¶ä¸­æ¯æ¬¡ç§»åŠ¨å¯å°†é€‰å®šçš„ä¸€ä¸ªå…ƒç´ åŠ 1æˆ–å‡1ã€‚ æ‚¨å¯ä»¥å‡è®¾æ•°ç»„çš„é•¿åº¦æœ€å¤šä¸º10000ã€‚\n\n**ä¾‹å¦‚:**\n\n```c\nè¾“å…¥:\n[1,2,3]\n\nè¾“å‡º:\n2\n\nè¯´æ˜ï¼š\nåªæœ‰ä¸¤ä¸ªåŠ¨ä½œæ˜¯å¿…è¦çš„ï¼ˆè®°å¾—æ¯ä¸€æ­¥ä»…å¯ä½¿å…¶ä¸­ä¸€ä¸ªå…ƒç´ åŠ 1æˆ–å‡1ï¼‰ï¼š \n\n[1,2,3]  =>  [2,2,3]  =>  [2,2,2]\n```\n\n\n### è§£æ³•ä¸€\nåŒä¸Šï¼Œä¸å¤šè§£é‡Š\n```java\nâ€‹class Solution {\n    public int minMoves2(int[] nums) {\n        int n = nums.length;\n        Arrays.sort(nums);\n        int res = 0;\n        for (int i = 0; i < n; i++) {\n            res += Math.abs(nums[i]-nums[n>>1]);\n        }\n        return res;\n    }\n}\n```\n\n## [912. æœ€ä½³è§é¢åœ°ç‚¹](https://www.lintcode.com/problem/best-meeting-point/description)\n\næœ‰ä¸€ç¾¤ä½åœ¨ä¸åŒåœ°æ–¹çš„æœ‹å‹ï¼ˆä¸¤ä¸ªæˆ–ä»¥ä¸Šï¼‰æƒ³è¦åœ¨æŸåœ°è§é¢ï¼Œè¦æ±‚ä»–ä»¬å»å¾€ç›®çš„åœ°çš„è·¯ç¨‹å’Œæœ€çŸ­ã€‚ç°åœ¨ç»™ä¸€ä¸ª0ã€1ç»„æˆçš„äºŒç»´æ•°ç»„ï¼Œ1è¡¨ç¤ºæ­¤åœ°æœ‰ä¸€ä¸ªäººå±…ä½ã€‚ä½¿ç”¨æ›¼å“ˆé¡¿è·ç¦»ä½œä¸ºè®¡ç®—æ€»è·ç¦»ï¼Œå…¬å¼ä¸ºï¼š$(p1, p2) = |p2.x - p1.x| + |p2.y - p1.y|$\n\n\n**æ ·ä¾‹ 1:**\n```c\nè¾“å…¥: \n[[1,0,0,0,1],[0,0,0,0,0],[0,0,1,0,0]]\nè¾“å‡º:\n6\nè§£é‡Š:\nç‚¹(0, 2)æ˜¯æœ€ä½³è§é¢åœ°ç‚¹ï¼Œæœ€å°çš„è·¯ç¨‹æ€»å’Œä¸º2+2+2=6ï¼Œè¿”å›6ã€‚\n```\n\n**æ ·ä¾‹ 2:**\n```c\nè¾“å…¥:\n[[1,1,0,0,1],[1,0,1,0,0],[0,0,1,0,1]]\nè¾“å‡º:\n14\n```\n\n### è§£æ³•ä¸€\nå’Œå‰é¢ä¸€æ ·\n$$\nf(n) = \\sum_{i=0}^{n-1}(|x_i-x| + |y_i-y|) = \\sum_{i=0}^{n-1}|x_i-x| + \\sum_{i=0}^{n-1}|y_i-y|)  \n$$\næ‰€ä»¥æˆ‘ä»¬åˆ†åˆ«å–$x_i$å’Œ$y_i$ä¸­ç‚¹å°±è¡Œäº†\n```java\nimport java.util.*;\nimport java.io.*;\n\nclass Solution {\n    /**\n     * @param grid: a 2D grid\n     * @return: the minimize travel distance\n     */\n    public int minTotalDistance(int[][] grid) {\n        // Write your code here\n        int n = grid.length;\n        int m = grid[0].length;\n        List<Integer> xlis = new ArrayList<>();\n        List<Integer> ylis = new ArrayList<>();\n        for (int i = 0; i < n; i++) {\n            for (int j = 0; j < m; j++) {\n                if (grid[i][j] == 1) {\n                    xlis.add(i);\n                    ylis.add(j);\n                }\n            }\n        }\n        Collections.sort(xlis);\n        Collections.sort(ylis);\n        int xmid = xlis.get(xlis.size()>>1);\n        int ymid = ylis.get(ylis.size()>>1);\n        int res = 0;\n        for (int i = 0; i < n; i++) {\n            for (int j = 0; j < m; j++) {\n                if (grid[i][j] == 1) {\n                    res += Math.abs(i-xmid) + Math.abs(j-ymid);      \n                }\n            }\n        }\n        return res;\n    }\n}\n```\n\n## [1703. å¾—åˆ°è¿ç»­Kä¸ª1çš„æœ€å°‘ç›¸é‚»äº¤æ¢æ¬¡æ•°](https://leetcode-cn.com/problems/minimum-adjacent-swaps-for-k-consecutive-ones/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â `nums`Â å’Œä¸€ä¸ªæ•´æ•°Â `k`Â ã€‚Â `nums` ä»…åŒ…å«Â `0`Â å’ŒÂ `1`Â ã€‚æ¯ä¸€æ¬¡ç§»åŠ¨ï¼Œä½ å¯ä»¥é€‰æ‹© **ç›¸é‚»**Â ä¸¤ä¸ªæ•°å­—å¹¶å°†å®ƒä»¬äº¤æ¢ã€‚\n\nè¯·ä½ è¿”å›ä½¿Â `nums`Â ä¸­åŒ…å«Â `k`Â ä¸ªè¿ç»­Â `1`Â çš„æœ€å°‘äº¤æ¢æ¬¡æ•°ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,0,0,1,0,1], k = 2\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šåœ¨ç¬¬ä¸€æ¬¡æ“ä½œæ—¶ï¼Œnums å¯ä»¥å˜æˆ [1,0,0,0,1,1] å¾—åˆ°è¿ç»­ä¸¤ä¸ª 1 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,0,0,0,0,0,1,1], k = 3\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šé€šè¿‡ 5 æ¬¡æ“ä½œï¼Œæœ€å·¦è¾¹çš„ 1 å¯ä»¥ç§»åˆ°å³è¾¹ç›´åˆ° nums å˜ä¸º [0,0,0,0,0,1,1,1] ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,1,0,1], k = 2\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šnums å·²ç»æœ‰è¿ç»­ 2 ä¸ª 1 äº†ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   1 <= nums.length <= 10<sup>5</sup>\n*   `nums[i]` è¦ä¹ˆæ˜¯Â `0`Â ï¼Œè¦ä¹ˆæ˜¯Â `1`Â ã€‚\n*   1 <= k <= sum(nums)\n\n\n### è§£æ³•ä¸€\n42thåŒå‘¨èµ›T4ï¼Œç›¸æ¯”ä¸Šé¢çš„é¢˜å°±æœ‰äº†ä¸€äº›æ€ç»´çš„è½¬æ¢ã€‚\n\næˆ‘ä»¬è¦æŠŠ$k$ä¸ª1èšæ‹¢åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬è®¾å®šåŸå§‹ä½ç½®ä¸º$A_0$ ~ $A_k-1$ï¼Œèšé›†åçš„ä½ç½®ä¸º $X, X+1, X+2...., X+k-1$ã€‚æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\näº¤æ¢æ¬¡æ•°ä¸ºï¼š\n$$f(k) = \\sum_{i=0}^{k-1}|A_i-(X+i)|$$\nè¦æ±‚è¿™ä¸ªå¼å­çš„æœ€å°å€¼ï¼Œå°†å¼å­è½¬æ¢ä¸€ä¸‹ï¼Œè®¾$A_i=B_i+i$ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¼å­å°±å˜æˆäº†\n$$f(k) = \\sum_{i=0}^{k-1}|B_i-X|$$\næ ¹æ®æˆ‘ä»¬[ä¸Šé¢çš„ç»“è®º](#104-è´§ä»“é€‰å€)ï¼Œè¿™ä¸ªå¼å­å½“$X$å–åœ¨$B_i$ä¸­ä½æ•°çš„æ—¶å€™ï¼Œå–å¾—æœ€å°å€¼ã€‚æ­¤æ—¶$X=B_{mid}$ (å¥‡å¶åŒç†)\n$$\n\\begin{aligned}\n    f(k) &= \\sum_{i=l}^r|B_i-B_{mid}| \\\\\\\\\n         &= \\sum_{i=l}^{mid}(B_{mid}-B_i) + \\sum_{i = mid+1}^{r}(B_i-B_{mid}) \\\\\\\\\n         &= B_{mid}  (2mid-l-r+1) - \\sum_{i = l}^{mid}B_i  +  \\sum_{i = mid+1}^{r}B_i\n\\end{aligned}\n$$\nå‰åŠéƒ¨åˆ†å¯ä»¥ç›´æ¥è®¡ç®—å¾—åˆ°ï¼ŒååŠéƒ¨åˆ†å¯ä»¥é€šè¿‡é¢„å¤„ç†å‰ç¼€å’Œå¿«é€Ÿæ±‚å¾—ï¼Œå¦‚æ­¤æˆ‘ä»¬å°±å¯ä»¥åœ¨$O(1)$çš„æ—¶é—´å†…æ»‘çª—æ±‚å‡ºçª—å£å†…1éœ€è¦äº¤æ¢çš„æ¬¡æ•°ï¼Œæ»‘åŠ¨è¿‡ç¨‹ä¸­ç»Ÿè®¡å‡ºæœ€å°å€¼å°±okäº†\n```java\nimport java.util.*;\nimport java.io.*;\n\n/*\n1.    å¾—åˆ°è¿ç»­ K ä¸ª 1 çš„æœ€å°‘ç›¸é‚»äº¤æ¢æ¬¡æ•°\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ã€‚ nums ä»…åŒ…å« 0 å’Œ 1 ã€‚æ¯ä¸€æ¬¡ç§»åŠ¨ä½ å¯ä»¥é€‰æ‹© ç›¸é‚» ä¸¤ä¸ªæ•°å­—å¹¶å°†å®ƒä»¬äº¤æ¢ã€‚\nè¯·ä½ è¿”å›ä½¿ nums ä¸­åŒ…å« k ä¸ª è¿ç»­ 1 çš„ æœ€å°‘ äº¤æ¢æ¬¡æ•°ã€‚\n */\n\nclass Solution {\n    public int minMoves(int[] nums, int k) {\n        int n = nums.length;\n        // int[] w = new int[k];\n        List<Integer> lis = new ArrayList<>();\n        int x = 0;\n        for (int i = 0; i < n; i++) {\n            if (nums[i]==1) {\n                lis.add(i-x);\n                x++;\n            }\n        }\n        int[] w = lis.stream().mapToInt(Integer::valueOf).toArray();\n        int m = w.length;\n        int[] sum = new int[m+1];\n        for (int i = 1; i <= m; i++) {\n            sum[i] = sum[i-1] + w[i-1];\n        }\n        //sum[i]: [0,i-1]\n        int res = Integer.MAX_VALUE;\n        int left = 0;\n        for (int right = k-1; right < m; right++) {\n            int mid = left+(right-left)/2; //å·¦ä¸­ä½æ•°\n            res = Math.min(res, w[mid]*(2*mid-left-right+1)-(sum[mid+1]-sum[left])+(sum[right+1]-sum[mid+1]));\n            left++;\n        }\n        return res;\n    }\n}\n```\nè¿™é‡Œå…¶å®æœ‰ä¸€ä¸ª[å°çš„é—®é¢˜](https://leetcode-cn.com/problems/minimum-adjacent-swaps-for-k-consecutive-ones/solution/de-dao-lian-xu-k-ge-1-de-zui-shao-xiang-lpa9i/724362)ã€‚æ¯”å¦‚çª—å£ç¬¬ä¸€æ¬¡å‘å³æ»‘åŠ¨æ—¶ï¼Œä»$[A_0ï¼ŒA_1-1ï¼Œ...ï¼ŒA_{k-1}-{k-1}]$ï¼Œæ»‘åŠ¨åˆ°$[A_1-1ï¼Œ...ï¼ŒA_{k-1}-{k-1}ï¼ŒA_{k}-k]$ä½†æ˜¯å®é™…ä¸ŠæŒ‰ç…§æˆ‘ä»¬å‰é¢çš„æ¨å¯¼ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦çš„åº”è¯¥æ˜¯$[A_1ï¼ŒA_2-1ï¼ŒA_3-2ï¼Œ...ï¼ŒA_n-n]$ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦é‡æ–°è®¡ç®—å—ï¼Ÿ\n\næ˜¾ç„¶å¹¶ä¸éœ€è¦ï¼Œè¿™é‡Œä¸¤ä¸ªçª—å£ä¹‹é—´å·®è·ä»…ä»…åªæ˜¯åœ¨åæ ‡è½´ä¸Š**æ•´ä½“çš„**ç§»åŠ¨äº†ä¸€æ­¥ï¼Œè€Œæˆ‘ä»¬æ±‚çš„æ˜¯çª—å£å†…å…ƒç´ å’Œä¸­ä½æ•°å·®å€¼çš„å’Œï¼Œå¯¹ç»“æœçš„è®¡ç®—å¹¶æ²¡æœ‰å½±å“ã€‚\n\n## [LCP 24. æ•°å­—æ¸¸æˆ](https://leetcode-cn.com/problems/5TxKeK/)\n\nå°æ‰£åœ¨ç§‹æ—¥å¸‚é›†å…¥å£å¤„å‘ç°äº†ä¸€ä¸ªæ•°å­—æ¸¸æˆã€‚ä¸»åŠæ–¹å…±æœ‰ N ä¸ªè®¡æ•°å™¨ï¼Œè®¡æ•°å™¨ç¼–å·ä¸º 0 ~ N-1ã€‚æ¯ä¸ªè®¡æ•°å™¨ä¸Šåˆ†åˆ«æ˜¾ç¤ºäº†ä¸€ä¸ªæ•°å­—ï¼Œå°æ‰£æŒ‰è®¡æ•°å™¨ç¼–å·å‡åºå°†æ‰€æ˜¾ç¤ºçš„æ•°å­—è®°äºæ•°ç»„ numsã€‚æ¯ä¸ªè®¡æ•°å™¨ä¸Šæœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«å¯ä»¥å®ç°å°†æ˜¾ç¤ºæ•°å­—åŠ ä¸€æˆ–å‡ä¸€ã€‚å°æ‰£æ¯ä¸€æ¬¡æ“ä½œå¯ä»¥é€‰æ‹©ä¸€ä¸ªè®¡æ•°å™¨ï¼ŒæŒ‰ä¸‹åŠ ä¸€æˆ–å‡ä¸€æŒ‰é’®ã€‚\n\nä¸»åŠæ–¹è¯·å°æ‰£å›ç­”å‡ºä¸€ä¸ªé•¿åº¦ä¸º N çš„æ•°ç»„ï¼Œç¬¬ i ä¸ªå…ƒç´ (0 <= i < N)è¡¨ç¤ºå°† 0~i å·è®¡æ•°å™¨ åˆå§‹ æ‰€ç¤ºæ•°å­—æ“ä½œæˆæ»¡è¶³æ‰€æœ‰æ¡ä»¶ nums[a]+1 == nums[a+1],(0 <= a < i) çš„æœ€å°æ“ä½œæ•°ã€‚å›ç­”æ­£ç¡®æ–¹å¯è¿›å…¥ç§‹æ—¥å¸‚é›†ã€‚\n\nç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·å°†æ¯ä¸ªæœ€å°æ“ä½œæ•°å¯¹ 1,000,000,007 å–ä½™ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [3,4,5,1,6,7]\n\nè¾“å‡ºï¼š[0,0,0,5,6,7]\n\nè§£é‡Šï¼š\ni = 0ï¼Œ[3] æ— éœ€æ“ä½œ\ni = 1ï¼Œ[3,4] æ— éœ€æ“ä½œï¼›\ni = 2ï¼Œ[3,4,5] æ— éœ€æ“ä½œï¼›\ni = 3ï¼Œå°† [3,4,5,1] æ“ä½œæˆ [3,4,5,6], æœ€å°‘ 5 æ¬¡æ“ä½œï¼›\ni = 4ï¼Œå°† [3,4,5,1,6] æ“ä½œæˆ [3,4,5,6,7], æœ€å°‘ 6 æ¬¡æ“ä½œï¼›\ni = 5ï¼Œå°† [3,4,5,1,6,7] æ“ä½œæˆ [3,4,5,6,7,8]ï¼Œæœ€å°‘ 7 æ¬¡æ“ä½œï¼›\nè¿”å› [0,0,0,5,6,7]ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,2,3,4,5]\n\nè¾“å‡ºï¼š[0,0,0,0,0]\n\nè§£é‡Šï¼šå¯¹äºä»»æ„è®¡æ•°å™¨ç¼–å· i éƒ½æ— éœ€æ“ä½œã€‚\n```\n**ç¤ºä¾‹ 3ï¼š**\n```c\nè¾“å…¥ï¼šnums = [1,1,1,2,3,4]\n\nè¾“å‡ºï¼š[0,1,2,3,3,3]\n\nè§£é‡Šï¼š\ni = 0ï¼Œæ— éœ€æ“ä½œï¼›\ni = 1ï¼Œå°† [1,1] æ“ä½œæˆ [1,2] æˆ– [0,1] æœ€å°‘ 1 æ¬¡æ“ä½œï¼›\ni = 2ï¼Œå°† [1,1,1] æ“ä½œæˆ [1,2,3] æˆ– [0,1,2]ï¼Œæœ€å°‘ 2 æ¬¡æ“ä½œï¼›\ni = 3ï¼Œå°† [1,1,1,2] æ“ä½œæˆ [1,2,3,4] æˆ– [0,1,2,3]ï¼Œæœ€å°‘ 3 æ¬¡æ“ä½œï¼›\ni = 4ï¼Œå°† [1,1,1,2,3] æ“ä½œæˆ [-1,0,1,2,3]ï¼Œæœ€å°‘ 3 æ¬¡æ“ä½œï¼›\ni = 5ï¼Œå°† [1,1,1,2,3,4] æ“ä½œæˆ [-1,0,1,2,3,4]ï¼Œæœ€å°‘ 3 æ¬¡æ“ä½œï¼›\nè¿”å› [0,1,2,3,3,3]ã€‚\n```\n\n**æç¤ºï¼š**\n\n- 1 <= nums.length <= 10^5\n- 1 <= nums[i] <= 10^3\n\n### è§£æ³•ä¸€\nåœ¨è¡¥ä¸Šé¢çš„é¢˜çš„æ—¶å€™çœ‹è§æœ‰äººæåˆ°å’Œè¿™é¢˜ä¸€æ ·ï¼Œæ‰€ä»¥é¡ºä¾¿ä¸€èµ·å†™ä¸€ä¸‹è¿™é¢˜ï¼Œå› ä¸ºå·²ç»çŸ¥é“äº†å’Œä¸Šé¢å“ªé¢˜å·®ä¸å¤šï¼Œæ‰€ä»¥è¿™é‡Œå¾ˆå¿«å°±è½¬æ¢æˆå’Œä¸Šé¢ç±»ä¼¼çš„é—®é¢˜äº†ï¼Œè®¾åŸæ¥çš„æ•°ç»„ä¸º$A_i$æ•°ç»„ï¼Œè½¬æ¢åæ–°æ•°ç»„ä»¥$X$å¼€å¤´ï¼Œåˆ™ä»0~nçš„è½¬æ¢æ¬¡æ•°ä¸ºï¼š\n$$f(n) = \\sum_{i=0}^{n-1}|A_i-(X+i)|$$\næˆ‘ä»¬è¦æ±‚çš„å°±æ˜¯è¿™ä¸ªå¼å­çš„æœ€å°å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å¼å­è½¬æ¢ä¸€ä¸‹ï¼Œè®¾$A_i=B_i+i$ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¼å­å°±å˜æˆäº†\n$$f(n) = \\sum_{i=0}^{n-1}|B_i-X|$$\næ ¹æ®å‰é¢çš„[ç»“è®º](#104-è´§ä»“é€‰å€)ï¼Œå¾ˆæ˜¾ç„¶$X$å–$B_i$çš„ä¸­ä½æ•°æ—¶è¯¥å¼å¾—åˆ°æœ€å°å€¼ã€‚é‚£ä¹ˆé—®é¢˜å°±è½¬æ¢æˆäº†å¦‚ä½•åŠ¨æ€çš„æ±‚åŒºé—´çš„ä¸­ä½æ•°ï¼Œ[ä¸Šä¸€é¢˜](#1703-å¾—åˆ°è¿ç»­Kä¸ª1çš„æœ€å°‘ç›¸é‚»äº¤æ¢æ¬¡æ•°)å› ä¸ºå˜åŒ–çš„å€¼æ˜¯ä¸‹æ ‡ï¼Œçª—å£å†…çš„ä¸‹æ ‡è‚¯å®šæ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡å·¦å³ç«¯ç‚¹å°±å¯ä»¥è®¡ç®—å¾—åˆ°ä¸­ä½æ•°ï¼Œä½†æ˜¯è¿™é¢˜æˆ‘ä»¬å˜åŒ–çš„æ˜¯æ•°ç»„çš„å€¼ï¼Œå¹¶ä¸”æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€äº›å…¶ä»–çš„ç»“æ„ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨**åŒå †**çš„åšæ³•åŠ¨æ€çš„ç»´æŠ¤ä¸­ä½æ•°ï¼Œè¯¦è§[æ•°æ®æµçš„ä¸­ä½æ•°](http://imlgw.top/2019/05/04/leetcode-shu-zu/#295-%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0)\n\næœ‰äº†ä¸­ä½æ•°åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ»‘åŠ¨çš„è¿‡ç¨‹ä¸­å¿«é€Ÿçš„æ±‚å‡ºä¸Šé¢çš„å¼å­çš„å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬å†æŠŠä¸Šé¢çš„å¼å­æ‹†åˆ†ä¸€ä¸‹å°±å˜æˆ\n\n$$f(n) = \\sum_{B_i \\leq B_{mid}}(B_{mid}-B_{i}) + \\sum_{B_i > B_{mid}}(B_i-B_{mid})\n$$\nå·¦å³ä¸¤éƒ¨åˆ†å…¶å®å°±å¯¹åº”äº†å°äºç­‰äº$B_{mid}$çš„å…ƒç´ ä»¥åŠå¤§äº$B_{mid}$çš„å…ƒç´ ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç»´æŠ¤åŒå †çš„åŒæ—¶ï¼Œç»´æŠ¤ä¸€ä¸‹å„ä¸ªå †çš„å…ƒç´ å’Œä»¥åŠå…ƒç´ ä¸ªæ•°å°±å¯ä»¥å¿«é€Ÿçš„æ±‚å‡ºä¸Šé¢å¼å­çš„å€¼ï¼Œæ—¶é—´å¤æ‚åº¦å¤§æ¦‚$O(NlogN)$çš„æ ·å­\n\n```java\nimport java.util.*;\nimport java.io.*;\n\nclass Solution {\n\n\n    int[] w;\n    //å°æ ¹å †å’Œå¤§æ ¹å †çš„å’Œ\n    long minSum = 0l, maxSum = 0l;\n    //å­˜å1/2å°çš„å…ƒç´ \n    PriorityQueue<Integer> max = new PriorityQueue<>((a, b)->w[b]-w[a]);\n    //å­˜å‰1/2å¤§çš„å…ƒç´ \n    PriorityQueue<Integer> min = new PriorityQueue<>((a, b)->w[a]-w[b]);\n\n    //n = 10^5\n    public int[] numsGame(int[] nums) {\n        int MOD = (int)1e9+7;\n        int n = nums.length;\n        w = new int[n];\n        for (int i = 0; i < n; i++) {\n            w[i] = nums[i]-i;\n        }\n        int[] res = new int[n];\n        for (int i = 0; i < n; i++) {\n            add(i);\n            int mid = find();\n            //è¿™é‡Œå–æ¨¡WAäº†ä¸¤å‘...intåé¢æ²¡æ‰“æ‹¬å·ï¼Œç»™å¼ºè½¬äº†\n            //å°æ ¹å †çš„ä¸ªæ•°ä»¥åŠsumä»£è¡¨çš„å®é™…æ˜¯å¤§äºmidçš„å…ƒç´ éƒ¨åˆ†ï¼Œå¤§æ ¹å †åŒç†\n            res[i] = (int)(((long)w[mid]*(max.size()-min.size()) - maxSum + minSum) % MOD);\n        }\n        return res;\n    }\n\n    //ç»´æŠ¤å¤§æ ¹å †ä»¥åŠå°æ ¹å †\n    public void add(int x) {\n        min.add(x);\n        minSum += w[x];\n        minSum -= w[min.peek()]; maxSum += w[min.peek()];\n        max.add(min.poll());\n        if (min.size() < max.size()) {\n            minSum += w[max.peek()]; maxSum -= w[max.peek()];\n            min.add(max.poll());\n        }\n    }\n\n    public int find() {\n        return min.peek();\n    }\n\n}\n\npublic class LeetCode_LCP24æ•°å­—æ¸¸æˆ {\n    public static void main(String[] args) {\n        Arrays.stream(new Solution().numsGame(new int[]{3,4,5,1,6,7})).forEach(System.out::println);\n    }\n}\n```","tags":["ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"åŠ›æ‰£42thåŒå‘¨èµ›","url":"/2021/01/06/li-kou-42th-shuang-zhou-sai/","content":"\n## [1702. ä¿®æ”¹åçš„æœ€å¤§äºŒè¿›åˆ¶å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/maximum-binary-string-after-change/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²Â `binary`Â ï¼Œå®ƒä»…æœ‰Â `0`Â æˆ–è€…Â `1`Â ç»„æˆã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ“ä½œä»»æ„æ¬¡å¯¹å®ƒè¿›è¡Œä¿®æ”¹ï¼š\n\n*   æ“ä½œ 1 ï¼šå¦‚æœäºŒè¿›åˆ¶ä¸²åŒ…å«å­å­—ç¬¦ä¸²Â \"00\"Â ï¼Œä½ å¯ä»¥ç”¨Â \"10\"Â å°†å…¶æ›¿æ¢ã€‚\n    *   æ¯”æ–¹è¯´ï¼ŒÂ \"00010\" -> \"10010\"\n*   æ“ä½œ 2 ï¼šå¦‚æœäºŒè¿›åˆ¶ä¸²åŒ…å«å­å­—ç¬¦ä¸²Â \"10\"Â ï¼Œä½ å¯ä»¥ç”¨Â \"01\"Â å°†å…¶æ›¿æ¢ã€‚\n    *   æ¯”æ–¹è¯´ï¼ŒÂ \"00010\" -> \"00001\"\n\nè¯·ä½ è¿”å›æ‰§è¡Œä¸Šè¿°æ“ä½œä»»æ„æ¬¡ä»¥åèƒ½å¾—åˆ°çš„ **æœ€å¤§äºŒè¿›åˆ¶å­—ç¬¦ä¸²**Â ã€‚å¦‚æœäºŒè¿›åˆ¶å­—ç¬¦ä¸² `x`Â å¯¹åº”çš„åè¿›åˆ¶æ•°å­—å¤§äºäºŒè¿›åˆ¶å­—ç¬¦ä¸² `y`Â å¯¹åº”çš„åè¿›åˆ¶æ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°äºŒè¿›åˆ¶å­—ç¬¦ä¸²`x`å¤§äºäºŒè¿›åˆ¶å­—ç¬¦ä¸²`y`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šbinary = \"000110\"\nè¾“å‡ºï¼š\"111011\"\nè§£é‡Šï¼šä¸€ä¸ªå¯è¡Œçš„è½¬æ¢ä¸ºï¼š\n\"000110\" -> \"000101\" \n\"000101\" -> \"100101\" \n\"100101\" -> \"110101\" \n\"110101\" -> \"110011\" \n\"110011\" -> \"111011\"\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šbinary = \"01\"\nè¾“å‡ºï¼š\"01\"\nè§£é‡Šï¼š\"01\" æ²¡åŠæ³•è¿›è¡Œä»»ä½•è½¬æ¢ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   1 <= binary.length <= 10<sup>5</sup>\n*   `binary` ä»…åŒ…å«Â '0' å’ŒÂ '1' ã€‚\n\n\n### è§£æ³•ä¸€\n\nå› ä¸ºæ˜¯è¡¥é¢˜ï¼Œä¹‹å‰åœ¨ç¾¤é‡Œæœ‰çœ‹è§è®¨è®ºï¼Œå¤§è‡´çš„æåˆ°äº†ä¸€äº›ï¼Œæ‰€ä»¥è¿™é‡Œå¾ˆå¿«å°±æƒ³åˆ°äº†è´ªå¿ƒçš„æ€è·¯ã€‚é¦–å…ˆ01æ˜¯æ— æ³•ç»§ç»­å˜åŒ–çš„ï¼Œ10æ˜¯å¯ä»¥å˜æˆ01çš„ï¼Œè€Œå¼€å¤´è¿ç»­çš„1è‚¯å®šæ˜¯ä¸éœ€è¦å†å˜åŒ–çš„ï¼Œå˜åŒ–åªä¼šä½¿å¾—ç»“æœå˜å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†é™¤äº†å¼€å¤´è¿ç»­çš„1ä»¥å¤–çš„æ‰€æœ‰çš„1éƒ½è½¬æ¢åˆ°æœ€åï¼ˆä¸€å®šæ˜¯å¯ä»¥çš„ï¼Œå› ä¸º10å¯ä»¥å˜æˆ01ï¼‰ï¼Œç„¶åå†å°†ä¸­é—´çš„00éƒ½è½¬æ¢æˆ10æœ€åå‰©ä¸‹çš„å°±åªæœ‰ä¸­é—´çš„ä¸€ä¸ª0ï¼Œè¿™æ ·å°±ä½¿å¾—ç»“æœæœ€å¤§äº†ã€‚æœ€ç»ˆçš„ç»“æœå°±æ˜¯1111...0...111ç±»ä¼¼çš„å½¢å¼\n```java\nâ€‹public class MaximumBinaryString {\n    //100101100 --> 100000111 --> 111110111\n1   //1100 --> 1110\n    public String maximumBinaryString(String binary) {\n        int n = binary.length();\n        int cnt = 0;\n        int i = 0;\n        while (i < n && binary.charAt(i) == '1') i++;\n        if (i==n) return binary;\n        while (i < n) {\n            if (binary.charAt(i) == '1') cnt++;\n            i++;\n        }\n        StringBuilder sb = new StringBuilder();\n        for (int j = 0; j < n-cnt-1; j++) {\n            sb.append(\"1\");\n        }\n        sb.append(\"0\");\n        for (int j = 0; j < cnt; j++) {\n            sb.append(\"1\");\n        }\n        return sb.toString();\n    }\n}\n```\n\n## [1703. å¾—åˆ°è¿ç»­Kä¸ª1çš„æœ€å°‘ç›¸é‚»äº¤æ¢æ¬¡æ•°](https://leetcode-cn.com/problems/minimum-adjacent-swaps-for-k-consecutive-ones/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â `nums`Â å’Œä¸€ä¸ªæ•´æ•°Â `k`Â ã€‚Â `nums` ä»…åŒ…å«Â `0`Â å’ŒÂ `1`Â ã€‚æ¯ä¸€æ¬¡ç§»åŠ¨ï¼Œä½ å¯ä»¥é€‰æ‹© **ç›¸é‚»**Â ä¸¤ä¸ªæ•°å­—å¹¶å°†å®ƒä»¬äº¤æ¢ã€‚\n\nè¯·ä½ è¿”å›ä½¿Â `nums`Â ä¸­åŒ…å«Â `k`Â ä¸ªè¿ç»­Â `1`Â çš„æœ€å°‘äº¤æ¢æ¬¡æ•°ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,0,0,1,0,1], k = 2\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šåœ¨ç¬¬ä¸€æ¬¡æ“ä½œæ—¶ï¼Œnums å¯ä»¥å˜æˆ [1,0,0,0,1,1] å¾—åˆ°è¿ç»­ä¸¤ä¸ª 1 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,0,0,0,0,0,1,1], k = 3\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šé€šè¿‡ 5 æ¬¡æ“ä½œï¼Œæœ€å·¦è¾¹çš„ 1 å¯ä»¥ç§»åˆ°å³è¾¹ç›´åˆ° nums å˜ä¸º [0,0,0,0,0,1,1,1] ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,1,0,1], k = 2\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šnums å·²ç»æœ‰è¿ç»­ 2 ä¸ª 1 äº†ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   1 <= nums.length <= 10<sup>5</sup>\n*   `nums[i]` è¦ä¹ˆæ˜¯Â `0`Â ï¼Œè¦ä¹ˆæ˜¯Â `1`Â ã€‚\n*   1 <= k <= sum(nums)\n\n\n### è§£æ³•ä¸€\n\nå•ç‹¬å†™äº†ä¸€ç¯‡æ–‡ç« æ•´ç†ç±»ä¼¼çš„é¢˜ï¼Œ[è¯¦è§](http://imlgw.top/2021/01/17/tan-xin-jue-dui-zhi-bu-deng-shi/#1703-%E5%BE%97%E5%88%B0%E8%BF%9E%E7%BB%ADK%E4%B8%AA1%E7%9A%84%E6%9C%80%E5%B0%91%E7%9B%B8%E9%82%BB%E4%BA%A4%E6%8D%A2%E6%AC%A1%E6%95%B0)","tags":["LeetCode","åŠ¨æ€è§„åˆ’"],"categories":["ç®—æ³•"]},{"title":"åŠ›æ‰£220thå‘¨èµ›","url":"/2020/12/29/li-kou-220th-zhou-sai/","content":"\n> å¥½ä¹…æ²¡å†™LeetCodeçš„é¢˜äº†ï¼Œæ¥è¡¥ä¸€ä¸‹[220å‘¨èµ›](https://leetcode-cn.com/contest/weekly-contest-220/)çš„T3å’ŒT4\n## [1696. è·³è·ƒæ¸¸æˆ VI](https://leetcode-cn.com/problems/jump-game-vi/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» **0** å¼€å§‹çš„æ•´æ•°æ•°ç»„ `nums`Â å’Œä¸€ä¸ªæ•´æ•° `k`Â ã€‚\n\nä¸€å¼€å§‹ä½ åœ¨ä¸‹æ ‡Â `0`Â å¤„ã€‚æ¯ä¸€æ­¥ï¼Œä½ æœ€å¤šå¯ä»¥å¾€å‰è·³Â `k`Â æ­¥ï¼Œä½†ä½ ä¸èƒ½è·³å‡ºæ•°ç»„çš„è¾¹ç•Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ä»ä¸‹æ ‡Â `i`Â è·³åˆ°Â `[i + 1ï¼Œ min(n - 1, i + k)]`Â **åŒ…å«** ä¸¤ä¸ªç«¯ç‚¹çš„ä»»æ„ä½ç½®ã€‚\n\nä½ çš„ç›®æ ‡æ˜¯åˆ°è¾¾æ•°ç»„æœ€åä¸€ä¸ªä½ç½®ï¼ˆä¸‹æ ‡ä¸º `n - 1`Â ï¼‰ï¼Œä½ çš„ **å¾—åˆ†**Â ä¸ºç»è¿‡çš„æ‰€æœ‰æ•°å­—ä¹‹å’Œã€‚\n\nè¯·ä½ è¿”å›ä½ èƒ½å¾—åˆ°çš„ **æœ€å¤§å¾—åˆ†**Â ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,-1,-2,4,-7,3], k = 2\nè¾“å‡ºï¼š7\nè§£é‡Šï¼šä½ å¯ä»¥é€‰æ‹©å­åºåˆ— [1,-1,4,3] ï¼ˆä¸Šé¢åŠ ç²—çš„æ•°å­—ï¼‰ï¼Œå’Œä¸º 7 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [10,-5,-2,4,0,3], k = 3\nè¾“å‡ºï¼š17\nè§£é‡Šï¼šä½ å¯ä»¥é€‰æ‹©å­åºåˆ— [10,4,3] ï¼ˆä¸Šé¢åŠ ç²—æ•°å­—ï¼‰ï¼Œå’Œä¸º 17 ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,-5,-20,4,-1,3,-6,-3], k = 2\nè¾“å‡ºï¼š0\n```\n\n**æç¤ºï¼š**\n\n*   1 <= nums.length, k <= 10<sup>5</sup>\n*   -10<sup>4</sup>Â <= nums[i]Â <= 10<sup>4</sup>\n\n\n### è§£æ³•ä¸€\né€’æ¨å…¬å¼å¾ˆå®¹æ˜“å¾—åˆ°ï¼Œå…ˆæ¥ä¸€å‘æš´åŠ›è§£æ³•ï¼Œä¸å‡ºæ„æ–™çš„Täº†\n```java\n//1 2 3 4 5 k=2\npublic int maxResult(int[] nums, int k) {\n    int n = nums.length;\n    int[] dp = new int[n];\n    dp[0] = nums[0];\n    for (int i = 1; i < n; i++) {\n        dp[i] = -0x3f3f3f3f;\n        for (int j = i-1; i-j <= k && j >= 0; j--) {\n            dp[i] = Math.max(dp[j]+nums[i], dp[i]);\n        }\n    }\n    return dp[n-1];\n}\n```\n\n### è§£æ³•äºŒ\nå…¶å®è¿™é¢˜æƒ³äº†æŒºä¹…çš„ï¼Œä¸»è¦æ˜¯æ²¡æƒ³åˆ°T3ä¼šç”¨åˆ°å•è°ƒé˜Ÿåˆ—å»ä¼˜åŒ–dpï¼Œå¾ˆå·§çš„æ˜¯è¿™ä¸ªå•è°ƒé˜Ÿåˆ—ä¼˜åŒ–è¿™ä¸ªçŸ¥è¯†ç‚¹æˆ‘åˆšåˆšåœ¨yxcé‚£è¾¹å­¦äº†ä¸€ç‚¹ï¼Œé‚£ä¸ªé¢˜ç›®ç›¸å¯¹è¿™é¢˜ä¼šå¤æ‚å¾ˆå¤šï¼Œæ˜¯å¤šé‡èƒŒåŒ…çš„é—®é¢˜ã€‚ç„¶åæˆ‘å°±æ„Ÿè§‰è¿™ä¸ªé¢˜å¥½åƒä¹Ÿå¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—æ¥ä¼˜åŒ–ï¼Œç„¶åå°±è¯•äº†ä¸€å‘ï¼Œç„¶åå°±ACäº†ğŸ˜\n> è¿™é‡Œä¹Ÿå¯ä»¥å€ŸåŠ©å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚çº¿æ®µæ ‘ï¼Œstè¡¨ï¼Œä¼˜å…ˆé˜Ÿåˆ—ä»€ä¹ˆçš„å»ç»´æŠ¤è¿ç»­çš„å¤§å°ä¸ºkçš„åŒºé—´çš„æœ€å¤§å€¼ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†™äº†\n```java\n//1 2 3 4 5 k=2\npublic int maxResult(int[] nums, int k) {\n    int n = nums.length;\n    int[] dp = new int[n];\n    dp[0] = nums[0];\n    //dp[i]   = Max(       dp[i-1], dp[i-2], dp[i-3],... dp[i-k+1], dp[i-k])\n    //dp[i+1] = Max(dp[i], dp[i-1], dp[i-2], dp[i-3],... dp[i-k+1])\n    //dp[i] --> dp[i+1] æ»‘åŠ¨çª—å£æœ€å¤§å€¼\n    LinkedList<int[]> queue = new LinkedList<>();\n    for (int i = 1; i < n; i++) {\n        while (!queue.isEmpty() && dp[i-1] > queue.getLast()[0]) {\n            queue.removeLast();\n        }\n        if (!queue.isEmpty() && i-queue.getFirst()[1] >= k) {\n            queue.removeFirst();\n        }\n        //è¿™é‡Œä¹Ÿå¯ä»¥åœ¨é˜Ÿåˆ—ä¸­åªå­˜dpå€¼çš„åæ ‡ï¼Œç®€åŒ–ä»£ç \n        queue.addLast(new int[]{dp[i-1], i});\n        dp[i] = queue.getFirst()[0]+nums[i];\n    }\n    return dp[n-1];\n}\n```\n\n## [1697. æ£€æŸ¥è¾¹é•¿åº¦é™åˆ¶çš„è·¯å¾„æ˜¯å¦å­˜åœ¨](https://leetcode-cn.com/problems/checking-existence-of-edge-length-limited-paths/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™ä½ ä¸€ä¸ª `n`Â ä¸ªç‚¹ç»„æˆçš„æ— å‘å›¾è¾¹é›†Â `edgeList`Â ï¼Œå…¶ä¸­edgeList[i] = [u<sub style=\"display: inline;\">i</sub>, v<sub style=\"display: inline;\">i</sub>, dis<sub style=\"display: inline;\">i</sub>]Â è¡¨ç¤ºç‚¹Â u<sub style=\"display: inline;\">i</sub>` å’Œç‚¹Â `v<sub style=\"display: inline;\">i</sub>Â ä¹‹é—´æœ‰ä¸€æ¡é•¿åº¦ä¸ºÂ dis<sub style=\"display: inline;\">i</sub>Â çš„è¾¹ã€‚è¯·æ³¨æ„ï¼Œä¸¤ä¸ªç‚¹ä¹‹é—´å¯èƒ½æœ‰è¶…è¿‡ä¸€æ¡è¾¹ã€‚\n\nç»™ä½ ä¸€ä¸ªæŸ¥è¯¢æ•°ç»„`queries`Â ï¼Œå…¶ä¸­Â queries[j] = [p<sub style=\"display: inline;\">j</sub>, q<sub style=\"display: inline;\">j</sub>, limit<sub style=\"display: inline;\">j</sub>]Â ï¼Œä½ çš„ä»»åŠ¡æ˜¯å¯¹äºæ¯ä¸ªæŸ¥è¯¢Â queries[j]Â ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä»Â p<sub style=\"display: inline;\">j</sub>Â åˆ°Â q<sub style=\"display: inline;\">j</sub>çš„è·¯å¾„ï¼Œä¸”è¿™æ¡è·¯å¾„ä¸Šçš„æ¯ä¸€æ¡è¾¹éƒ½ **ä¸¥æ ¼å°äº** limit<sub style=\"display: inline;\">j</sub>ã€‚\n\nè¯·ä½ è¿”å›ä¸€ä¸ª **å¸ƒå°”æ•°ç»„**`answer`ï¼Œå…¶ä¸­`answer.length == queries.length`Â ï¼Œå½“Â `queries[j]`Â çš„æŸ¥è¯¢ç»“æœä¸ºÂ `true`Â æ—¶ï¼ŒÂ `answer` ç¬¬`j`Â ä¸ªå€¼ä¸º`true`ï¼Œå¦åˆ™ä¸ºÂ `false`Â ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![](https://i.loli.net/2020/12/30/WiZjdPCsFca4JlE.png)\n\n```c\nè¾“å…¥ï¼šn = 3, edgeList = [[0,1,2],[1,2,4],[2,0,8],[1,0,16]], queries = [[0,1,2],[0,2,5]]\nè¾“å‡ºï¼š[false,true]\nè§£é‡Šï¼šä¸Šå›¾ä¸ºç»™å®šçš„è¾“å…¥æ•°æ®ã€‚æ³¨æ„åˆ° 0 å’Œ 1 ä¹‹é—´æœ‰ä¸¤æ¡é‡è¾¹ï¼Œåˆ†åˆ«ä¸º 2 å’Œ 16 ã€‚\nå¯¹äºç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼Œ0 å’Œ 1 ä¹‹é—´æ²¡æœ‰å°äº 2 çš„è¾¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿”å› false ã€‚\nå¯¹äºç¬¬äºŒä¸ªæŸ¥è¯¢ï¼Œæœ‰ä¸€æ¡è·¯å¾„ï¼ˆ0 -> 1 -> 2ï¼‰ä¸¤æ¡è¾¹éƒ½å°äº 5 ï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢æˆ‘ä»¬è¿”å› true ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![](https://i.loli.net/2020/12/30/TRQdGcei1S8UX9k.png)\n\n```c\nè¾“å…¥ï¼šn = 5, edgeList = [[0,1,10],[1,2,5],[2,3,9],[3,4,13]], queries = [[0,4,14],[1,4,13]]\nè¾“å‡ºï¼š[true,false]\nè§£é‡Šï¼šä¸Šå›¾ä¸ºç»™å®šæ•°æ®ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   2 <= n <= 10<sup>5</sup>\n*   1 <= edgeList.length, queries.length <= 10<sup>5</sup>\n*   edgeList[i].length == 3\n*   queries[j].length == 3\n*   0 <= u<sub style=\"display: inline;\">i</sub>, v<sub style=\"display: inline;\">i</sub>, p<sub style=\"display: inline;\">j</sub>, q<sub style=\"display: inline;\">j</sub> <= n - 1\n*   u<sub style=\"display: inline;\">i</sub> != v<sub style=\"display: inline;\">i</sub>\n*   p<sub style=\"display: inline;\">j</sub> != q<sub style=\"display: inline;\">j</sub>\n*   1 <= dis<sub style=\"display: inline;\">i</sub>, limit<sub style=\"display: inline;\">j</sub> <= 10<sup>9</sup>\n*   ä¸¤ä¸ªç‚¹ä¹‹é—´å¯èƒ½æœ‰ **å¤šæ¡**Â è¾¹ã€‚\n\n\n### è§£æ³•ä¸€\n\nçœ‹åˆ°äº†è¯„è®ºåŒºçš„ä¸€å¥æç¤ºç„¶åå†™å‡ºäº†ä¸‹é¢çš„è§£æ³•ï¼Œåæ¥çœ‹é¢˜è§£åŒºå¤§ä½¬ç§‘æ™®è¿™ç§ç±»å‹çš„é¢˜ç›®å±äº[ç¦»çº¿ç®—æ³•](https://leetcode-cn.com/problems/checking-existence-of-edge-length-limited-paths/solution/jie-zhe-ge-wen-ti-ke-pu-yi-xia-shi-yao-j-pn1b/)ï¼Œå…¶å®æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯ï¼Œå¯¹æŸ¥è¯¢çš„limitå’Œè¾¹æƒå€¼è¿›è¡Œæ’åºï¼Œç„¶åä»å°queryçš„limitå¼€å§‹ï¼Œå°†edgeæƒå€¼ä¸å¤§äºlimitçš„éƒ½ä¸¢åˆ°å¹¶æŸ¥é›†é‡Œé¢ï¼Œç„¶åæŸ¥è¯¢ä¸€ä¸‹å°±è¡Œäº†\n```java\nint[] parent;\n\npublic int find(int a) {\n    if (parent[a] == a) {\n        return a;\n    }\n    return parent[a] = find(parent[a]);\n}\n\npublic void union(int a,int b) {\n    int pa = find(a);\n    int pb = find(b);\n    if (pa == pb) return;\n    parent[pa] = pb; \n}\n\nclass Pair {\n    int p, q;\n    int limit;\n    int idx;\n    public Pair(int p, int q, int limit, int idx) {\n        this.p = p;\n        this.q = q;\n        this.limit = limit;\n        this.idx = idx;\n    }\n}\n\npublic boolean[] distanceLimitedPathsExist(int n, int[][] edge, int[][] q) {\n    parent = new int[n];\n    for (int i = 0; i < n; i++) parent[i] = i;\n    boolean[] res = new boolean[q.length];\n    Pair[] query = new Pair[q.length];\n    for (int i = 0; i < q.length; i++) {\n        query[i] = new Pair(q[i][0], q[i][1], q[i][2], i);\n    }\n    Arrays.sort(edge, (e1, e2)->e1[2]-e2[2]);\n    Arrays.sort(query, (q1, q2)->q1.limit-q2.limit);\n    int j = 0;\n    for (int i = 0; i < query.length; i++) {\n        while (j < edge.length && edge[j][2] < query[i].limit) {\n            union(edge[j][0], edge[j][1]);\n            j++;\n        }\n        res[query[i].idx] = find(query[i].p) == find(query[i].q);\n    }\n    return res;\n}\n```\nçœ‹äº†å¤§ä½¬ä»¬çš„ä»£ç åç¨å¾®åšäº†ä¸‹ç‚¹ç®€åŒ–\n```java\nint[] parent;\n\npublic int find(int a) {\n    if (parent[a] == a) return a;\n    return parent[a] = find(parent[a]);\n}\n\npublic void union(int a,int b) {\n    int pa = find(a);\n    int pb = find(b);\n    if (pa == pb) return;\n    parent[pa] = pb; \n}\n\npublic boolean[] distanceLimitedPathsExist(int n, int[][] edge, int[][] q) {\n    parent = new int[n];\n    int qlen = q.length;\n    for (int i = 0; i < n; i++) parent[i] = i;\n    boolean[] res = new boolean[qlen];\n    //è®°å½•queryæ’åºåçš„id\n    Integer[] qid = new Integer[qlen];\n    for (int i = 0; i < qlen; i++) qid[i] = i;\n    Arrays.sort(edge, (e1, e2)->e1[2]-e2[2]);\n    Arrays.sort(qid, (i1, i2)->q[i1][2]-q[i2][2]);\n    int j = 0;\n    for (int i = 0; i < qlen; i++) {\n        while (j < edge.length && edge[j][2] < q[qid[i]][2]) {\n            union(edge[j][0], edge[j][1]);\n            j++;\n        }\n        res[qid[i]] = find(q[qid[i]][0]) == find(q[qid[i]][1]);\n    }\n    return res;\n}\n```","tags":["LeetCode","åŠ¨æ€è§„åˆ’"],"categories":["ç®—æ³•"]},{"title":"Lc1621.å¤§å°ä¸ºKçš„ä¸é‡å çº¿æ®µçš„æ•°ç›®","url":"/2020/11/24/lc1621-da-xiao-wei-k-de-bu-chong-die-xian-duan-de-shu-mu/","content":"\n## [1621. å¤§å°ä¸º K çš„ä¸é‡å çº¿æ®µçš„æ•°ç›®](https://leetcode-cn.com/problems/number-of-sets-of-k-non-overlapping-line-segments/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ç»´ç©ºé—´çš„Â `n`Â ä¸ªç‚¹ï¼Œå…¶ä¸­ç¬¬Â `i`Â ä¸ªç‚¹ï¼ˆç¼–å·ä»Â `0` åˆ°Â `n-1`ï¼‰ä½äºÂ `x = i`Â å¤„ï¼Œè¯·ä½ æ‰¾åˆ°Â **æ°å¥½**Â `k`Â **ä¸ªä¸é‡å **Â çº¿æ®µä¸”æ¯ä¸ªçº¿æ®µè‡³å°‘è¦†ç›–ä¸¤ä¸ªç‚¹çš„æ–¹æ¡ˆæ•°ã€‚çº¿æ®µçš„ä¸¤ä¸ªç«¯ç‚¹å¿…é¡»éƒ½æ˜¯Â **æ•´æ•°åæ ‡**Â ã€‚è¿™Â `k`Â ä¸ªçº¿æ®µä¸éœ€è¦å…¨éƒ¨è¦†ç›–å…¨éƒ¨Â `n`Â ä¸ªç‚¹ï¼Œä¸”å®ƒä»¬çš„ç«¯ç‚¹å¯ä»¥é‡åˆã€‚\nè¯·ä½ è¿”å› `k`Â ä¸ªä¸é‡å çº¿æ®µçš„æ–¹æ¡ˆæ•°ã€‚ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·å°†ç»“æœå¯¹Â `1e9+7`Â **å–ä½™** åè¿”å›ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![](https://i.loli.net/2020/11/24/CO2b9MBa5WFTNnU.png)\n\n```c\nè¾“å…¥ï¼šn = 4, k = 2\nè¾“å‡ºï¼š5\nè§£é‡Šï¼š\nå¦‚å›¾æ‰€ç¤ºï¼Œä¸¤ä¸ªçº¿æ®µåˆ†åˆ«ç”¨çº¢è‰²å’Œè“è‰²æ ‡å‡ºã€‚\nä¸Šå›¾å±•ç¤ºäº† 5 ç§ä¸åŒçš„æ–¹æ¡ˆ {(0,2),(2,3)}ï¼Œ{(0,1),(1,3)}ï¼Œ{(0,1),(2,3)}ï¼Œ{(1,2),(2,3)}ï¼Œ{(0,1),(1,2)} ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šn = 3, k = 1\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šæ€»å…±æœ‰ 3 ç§ä¸åŒçš„æ–¹æ¡ˆ {(0,1)}, {(0,2)}, {(1,2)} ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼šn = 30, k = 7\nè¾“å‡ºï¼š796297179\nè§£é‡Šï¼šç”» 7 æ¡çº¿æ®µçš„æ€»æ–¹æ¡ˆæ•°ä¸º 3796297200 ç§ã€‚å°†è¿™ä¸ªæ•°å¯¹ 109 + 7 å–ä½™å¾—åˆ° 796297179 ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```c\nè¾“å…¥ï¼šn = 5, k = 3\nè¾“å‡ºï¼š7\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```c\nè¾“å…¥ï¼šn = 3, k = 2\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n*   `2 <= n <= 1000`\n*   `1 <= k <= n-1`\n\n### è§£æ³•ä¸€\n\nè¿™é¢˜é¢˜æƒ³äº†å¥½ä¹…ï¼Œæœ€ç»ˆè¿˜æ˜¯å¦¥åäº†ï¼Œçœ‹äº†é¢˜è§£ï¼Œå‘ç°æœ‰æš´æœ+è®°å¿†åŒ–çš„è§£æ³•ï¼Œè¯•äº†ä¸‹ï¼ŒTäº†\n```java\nint MOD = (int)1e9+7;\n\n//å†™ä¸ªæš´æœè¯•è¯•ï¼ˆTäº†ï¼‰\npublic int numberOfSets2(int n, int k) {\n    Long[][] dp = new Long[n+1][k+1];\n    return dfs(n, k, dp);\n}\n\n//nä¸ªç‚¹æ”¾kæ¡çº¿æ®µçš„æ–¹æ¡ˆæ•°\npublic int dfs(int n, int k, Long[][] dp) {\n    if (dp[n][k] != null) {\n        return dp[n][k].intValue();\n    }\n    if (k == 0) {\n        return 1;\n    }\n    if (k == 1) {\n        return (n-1)*n/2;\n    }\n    long res = 0;\n    for (int i = 1; n-i >= k-2; i++) {\n        //å‰(i+1)ä¸ªç‚¹æ”¾ä¸€æ¡çº¿æ®µæœ‰iç§æ–¹æ¡ˆï¼ˆåˆ¨å¼€ä¹‹å‰çš„æ–¹æ¡ˆï¼‰\n        res += 1l * i * dfs(n-i, k-1, dp);\n        res = (res + MOD) % MOD;\n    }\n    dp[n][k] = res;\n    return (int)res;\n}\n```\n\n### è§£æ³•äºŒ\n\nN^3dpï¼Œ`dp[i][j]`ä»£è¡¨é•¿åº¦ä¸ºiçš„èŠ‚ç‚¹æ”¾ç½®jæ¡çº¿æ®µæœ‰å‡ ç§æ–¹æ¡ˆï¼ŒçŠ¶æ€çš„è½¬ç§»åˆ†ä¸¤ç§æƒ…å†µ\n1. æœ€åä¸€æ¡çº¿æ®µä¸è¦†ç›–å³ç«¯ç‚¹ï¼Œé‚£ä¹ˆé€’æ¨å°±ç›´æ¥`dp[i][j] = dp[i-1][j]`\n2. æœ€åä¸€æ¡çº¿æ®µè¦†ç›–å³ç«¯ç‚¹ï¼Œæšä¸¾æœ€åä¸€æ¡çº¿æ®µçš„é•¿åº¦æ‰€å¯¹åº”çš„`dp[i-len][j-1]`ç´¯åŠ èµ·æ¥\n\n```java\npublic int numberOfSets(int n, int k) {\n    int MOD = (int)1e9+7;\n    long[][] dp = new long[n+1][k+1];\n    for (int i = 0; i <= n; i++) {\n        dp[i][0] = 1;\n    }\n    for (int i = 2; i <= n; i++) {\n        for (int j = 1; j <= Math.min(i-1, k); j++) {\n            //jæ²¡æœ‰è¦†ç›–å³ç«¯ç‚¹çš„æƒ…å†µ\n            dp[i][j] = dp[i-1][j];\n            //æšä¸¾jè¦†ç›–åŒºé—´å³ç«¯ç‚¹çš„æ‰€æœ‰æƒ…å†µï¼Œæ³¨æ„ä»1å¼€å§‹\n            for (int s = 1; s < i; s++) {\n                dp[i][j] = (dp[i][j] + dp[s][j-1]) % MOD;\n            }\n        }\n    }\n    return (int) dp[n][k];\n}\n```\nè¿™é‡Œæ•°æ®èŒƒå›´æ˜¯1e3ï¼Œæ˜¾ç„¶N^3æ˜¯è¿‡ä¸äº†çš„ï¼Œæ‰€ä»¥éœ€è¦ä¼˜åŒ–ï¼Œä¸‰é‡å¾ªç¯ç§æ±‚çš„å…¶å®æ˜¯å‰é¢å·²ç»è®¡ç®—è¿‡çš„ç´¯è®¡çš„å‰ç¼€å’Œï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å‰ç¼€å’Œä¼˜åŒ–æˆN^2\n```java\npublic int numberOfSets(int n, int k) {\n    int MOD = (int)1e9+7;\n    long[][] dp = new long[n+1][k+1];\n    long[][] sum = new long[n+1][k+1];\n    for (int i = 1; i <= n; i++) {\n        dp[i][0] = 1;\n        sum[i][0] = sum[i-1][0] + 1; \n    }\n    for (int i = 2; i <= n; i++) {\n        for (int j = 1; j <= Math.min(i-1, k); j++) {\n            //jæ²¡æœ‰è¦†ç›–å³ç«¯ç‚¹çš„æƒ…å†µ\n            dp[i][j] = dp[i-1][j];\n            //æšä¸¾jè¦†ç›–åŒºé—´å³ç«¯ç‚¹çš„æ‰€æœ‰æƒ…å†µï¼Œæ³¨æ„ä»1å¼€å§‹\n            // for (int s = 1; s < i; s++) {\n            //     dp[i][j] = (dp[i][j] + dp[s][j-1]) % MOD;\n            // }\n            dp[i][j] = (dp[i][j] + sum[i-1][j-1]) % MOD;\n            sum[i][j] = sum[i-1][j] + dp[i][j];\n        }\n    }\n    return (int) dp[n][k];\n}\n```\n\n### è§£æ³•ä¸‰\n\nè¿™ç§DPçš„æ–¹å¼æ›´å¥½ç†è§£\n- `dp[i][j][0]`: å‰iä¸ªç‚¹æ”¾jæ¡çº¿æ®µï¼Œç¬¬jæ¡çº¿æ®µæ²¡æœ‰è¦†ç›–å³ç«¯ç‚¹ï¼Œæ‰€ä»¥æ˜¾ç„¶`dp[i][j][0] = dp[i-1][j][0] + dp[i-1][j][1]`\n- `dp[i][j][1]`: å‰iä¸ªç‚¹æ”¾jæ¡çº¿æ®µï¼Œç¬¬jæ¡çº¿æ®µè¦†ç›–å³ç«¯ç‚¹ï¼ˆå¯ä»¥å»¶é•¿ï¼‰ï¼Œé¦–å…ˆjä½ç½®å•ç‹¬æˆä¸€æ¡çº¿æ®µï¼ˆ`dp[i-1][j-1][0] + dp[i-1][j-1][1]`ï¼‰ï¼Œç„¶åå°±æ˜¯jä½ç½®å’Œå‰é¢çš„è¿æˆä¸€æ¡çº¿æ®µçš„ï¼ˆ`dp[i-1][j]`ï¼‰\n\n```java\npublic int numberOfSets(int n, int k) {\n    int MOD = (int)1e9+7;\n    //dp[i][j][0]: å‰iä¸ªç‚¹æ”¾jæ¡çº¿æ®µï¼Œç¬¬jæ¡çº¿æ®µæ²¡æœ‰è¦†ç›–å³ç«¯ç‚¹\n    //dp[i][j][1]: å‰iä¸ªç‚¹æ”¾jæ¡çº¿æ®µï¼Œç¬¬jæ¡çº¿æ®µè¦†ç›–å³ç«¯ç‚¹ï¼ˆå¯ä»¥å»¶é•¿ï¼‰\n    long[][][] dp = new long[n+1][k+1][2];\n    for (int i = 0; i <= n; i++) {\n        dp[i][0][0] = 1;\n    }\n    for (int i = 2; i <= n; i++) {\n        for (int j = 1; j <= Math.min(i-1, k); j++) {\n            dp[i][j][0] = dp[i-1][j][0] + dp[i-1][j][1];\n            dp[i][j][1] = dp[i-1][j-1][0] + dp[i-1][j-1][1] + dp[i-1][j][1];\n            dp[i][j][0] = (dp[i][j][0] + MOD) % MOD;\n            dp[i][j][1] = (dp[i][j][1] + MOD) % MOD;\n        }\n    }\n    return (int)(dp[n][k][0] + dp[n][k][1] + MOD) % MOD;\n}\n```\n### è§£æ³•å››\n\nå…¶å®æ˜¯ä¸Šé¢è§£æ³•çš„ä¼˜åŒ–é€’æ¨ï¼Œçœå»äº†å‰ç¼€å’Œçš„ç©ºé—´ï¼Œç›´æ¥ä»çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸Šè¿›è¡Œä¼˜åŒ–\n![mark](http://static.imlgw.top/blog/20201126/RxHR7Ushje0p.png?imageslim)\nåˆ—å‡ºé€’æ¨ä¸­çš„è¿ç»­ä¸¤é¡¹ï¼Œç„¶åè¿›è¡Œåˆå¹¶ä¼˜åŒ–ï¼Œç›´æ¥å¾—åˆ°é€’æ¨å…¬å¼\n```java\n//æœ‰ä¸€ç‚¹æŠ€å·§æ€§çš„é€’æ¨\npublic int numberOfSets(int n, int k) {\n    int MOD = (int)1e9+7;\n    //nä¸ªç‚¹ï¼Œæ”¾kä¸ªçº¿æ®µï¼Œä¸é‡å çš„æ–¹æ¡ˆæ•°\n    long[][] dp = new long[n+1][k+1];\n    for (int i = 0; i <= n; i++) {\n        dp[i][0] = 1;\n    }\n    \n    for (int i = 2; i <= n; i++) {\n        for (int j = 1; j <= i-1 && j <= k; j++) {\n            //dp[2][1] = 2*dp[1][1] - dp[0][1] + dp[1][0]\n            dp[i][j] = 2*dp[i-1][j] - dp[i-2][j] + dp[i-1][j-1];\n            dp[i][j] = (dp[i][j] + MOD) % MOD;\n        }\n    }\n    return (int)dp[n][k];\n}\n```\n\n### è§£æ³•äº”\n\næ•°å­¦æ³•ï¼Œçœ‹ä¸æ‡‚ï¼Œæ±‚C(n+k-1, 2k)","tags":["LeetCode","åŠ¨æ€è§„åˆ’"],"categories":["ç®—æ³•"]},{"title":"PCç«¯è½¯ä»¶æ¨è","url":"/2020/11/19/pc-duan-ruan-jian-tui-jian/","content":"\n# è´¾è€æ¿ä¸“å±é“¾æ¥\n\n## è¿œç¨‹æ¡Œé¢è½¯ä»¶\n\n### Teamviewer\nä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢è¿™ä¸ªè½¯ä»¶ï¼Œç°åœ¨è¦ç”¨è¿™ä¸ªè½¯ä»¶å¿…é¡»è¦æ³¨å†Œäº†ï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œå¸‚é¢ä¸Šå¯¹ä¸ªäººå…è´¹çš„ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«çš„ä¹Ÿå°±æ˜¯å®ƒäº†ï¼Œå…¶ä»–çš„è¦ä¹ˆå¡çš„è¦æ­»ï¼Œè¦ä¹ˆè´µçš„è¦æ­»ï¼ˆå¾®è½¯è‡ªå¸¦çš„æœ‰ä¸€ä¸ªè¿œç¨‹æ¡Œé¢ï¼Œä½†æ˜¯åªæœ‰ä¸“ä¸šç‰ˆæ‰æœ‰ï¼Œå®¶åº­ç‰ˆè¦ç”¨æŒºéº»çƒ¦çš„ï¼Œè€Œä¸”å¾—æœ‰å…¬ç½‘IPï¼Œæ‡’å¾—æŠ˜è…¾ï¼‰\n\nå¹³å¸¸ç”µè„‘è¦æ˜¯æœ‰å•¥é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥å¼€è¿™ä¸ªï¼Œç„¶åæŠŠè´¦å·å¯†ç æˆªå›¾ç»™æˆ‘ï¼Œæˆ‘é¼“æ£é¼“æ£å…´è®¸å°±ç»™é¼“æ£å¥½äº†ğŸ˜\n> QQè¿œç¨‹æ¯”è¾ƒå¡ï¼Œè€Œä¸”å¾ˆå¤šæ ¸å¿ƒçš„ç³»ç»Ÿè®¾ç½®QQè¿œç¨‹æ— æ³•ä¿®æ”¹\n\næ¨èæŒ‡æ•°â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://www.teamviewer.cn/cn/)\n\n## å®‰å…¨æ–¹é¢\næ¨èå°±ä½¿ç”¨**ç”µè„‘è‡ªå¸¦**çš„å®‰å…¨ç®¡å®¶ï¼Œæ¯”å¦‚**æˆ´å°”ç”µè„‘ç®¡å®¶**ä¹‹ç±»çš„ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å»ºè®®ç›´æ¥è£¸å¥”ï¼ˆwin10è‡ªå¸¦çš„æœ‰ä¸€ä¸ªwindows defenderï¼‰ï¼Œåªè¦ä¸ä¹±ç‚¹å¥‡æ€ªçš„é“¾æ¥ï¼Œä¸‹è½½æˆ–è€…å¯åŠ¨å¥‡æ€ªçš„ç¨‹åºå°±è¡Œäº†ï¼Œå¦‚æœå®åœ¨æ˜¯ä¸æ”¾å¿ƒå¯ä»¥ä¸‹è½½ä¸€ä¸ª [ç«ç»’](https://www.huorong.cn/)ï¼Œæ²¡æœ‰å¹¿å‘Šå¼¹çª—ä»€ä¹ˆçš„ï¼Œä½“ç§¯ä¹Ÿæ¯”è¾ƒå°\n\n![](https://i.loli.net/2020/11/18/sy7Z5vQRHemuCBX.png)\n\n> ä¸æ¨èè£…ä»€ä¹ˆ360ï¼Œè…¾è®¯ä¹‹ç±»çš„å®‰å…¨ç®¡å®¶ï¼Œè£…ä¸€ä¸ªå°±ä¼šè¿å¸¦è£…ä¸€äº›å…¨å®¶æ¡¶ï¼ŒæŒºæ¶å¿ƒäººçš„ï¼Œå¦‚æœå·²ç»è£…äº†ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘ä¸‹é¢æ¨èçš„å¸è½½å·¥å…·å¸è½½æ‰\n\n## å¸è½½ & æ¸…ç†\n\n### Geek\n\nç»¿è‰²è½¯ä»¶ï¼ˆæŒ‡ä¸ç”¨å®‰è£…çš„è½¯ä»¶ï¼‰ï¼Œä¸‹è½½ååŒå‡»å¯åŠ¨å°±è¡Œäº†ï¼Œå¯ä»¥ç”¨æ¥å¸è½½ç¬¬ä¸‰æ–¹çš„ä¸€äº›è½¯ä»¶ï¼Œä¹Ÿå¯ä»¥å¸è½½ä¸€äº›uwpåº”ç”¨ï¼ˆå¾®è½¯åº”ç”¨å•†åº—å®‰è£…çš„è½¯ä»¶ï¼‰ã€‚æ²¡æœ‰å¹¿å‘Šï¼Œä½“ç§¯å°ï¼Œæ¨èæŒ‡æ•°â­â­â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://wws.lanzous.com/iXFAZiiuq9g)\n\n### CClean\n\nåƒåœ¾æ¸…ç†è½¯ä»¶ï¼Œæ¸…æ³¨å†Œè¡¨è´¼èˆ’æœæ“ä½œæ¯”è¾ƒç®€å•ï¼Œæ‹’ç»è¾£é¸¡è½¯ä»¶æ®‹ç•™ï¼ˆä¹Ÿæ˜¯ç»¿è½¯ï¼‰ã€‚æ¨èæŒ‡æ•°â­â­â­â­\n> æˆ‘è¿™ä¸ªæ˜¯ç ´è§£ç‰ˆï¼Œæ‰“å¼€åä¼šæç¤ºä½ æ›´æ–°ï¼Œxæ‰å°±è¡Œ\n\nä¸‹è½½åœ°å€ [click](https://wws.lanzous.com/i9Zrejswysb)\n\n### Dism++\n\nè·Ÿä¸Šé¢çš„ä¸€æ ·ä¹Ÿæ˜¯åƒåœ¾æ¸…ç†è½¯ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªä¸èƒ½çæï¼Œæœ‰äº›ä¸œè¥¿ä¸èƒ½ä¹±æ¸…ç†\næ¨èæŒ‡æ•°â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://www.chuyu.me/zh-Hans/index.html)\n\n## è¾“å…¥æ³•\næ¨èå°±ä½¿ç”¨å¾®è½¯è‡ªå¸¦çš„è¾“å…¥æ³•ï¼Œæ²¡æœ‰å¼¹çª—ï¼Œæ²¡æœ‰å¹¿å‘Šï¼Œç®€æ´å¹²å‡€ï¼Œä¹Ÿæœ‰å¾ˆå¤šè¡¨æƒ…ï¼ˆwin + . è§¦å‘ï¼‰ï¼Œæœç‹—ä»€ä¹ˆçš„ï¼Œæ„Ÿè§‰ä¸å¤ªé è°±ï¼Œä¹‹å‰åœ¨å¾®è½¯ç¤¾åŒºçœ‹åˆ°æœ‰äººæ›´æ–°win10å› ä¸ºæœç‹—è€Œå´©æºƒäº†ï¼Œ[ä¼ é€é—¨](https://answers.microsoft.com/zh-hans/windows/forum/windows_10-update/systemserviceexception%E8%93%9D%E5%B1%8F/e5c0a131-a155-4cc0-a871-b6089d474313?rtAction=1553553854556)\n\næ¨èæŒ‡æ•°â­â­â­â­â­\n## æµè§ˆå™¨\n### Google Chrome\né¦–å…ˆè‚¯å®šæ˜¯æ— è„‘è¿™ä¸ªï¼ŒPCç«¯æœ€å¥½ç”¨çš„æµè§ˆå™¨ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼Œä½†æ˜¯Chromeåœ¨æŸ¥çœ‹ä¸€äº›è€çš„è§†é¢‘ç½‘ç«™ï¼Œæˆ–è€…ä¸€äº›éœ€è¦ä½¿ç”¨flashçš„ç½‘é¡µæ—¶ï¼Œä¼šæœ‰ç‚¹éº»çƒ¦ï¼ŒChromeé»˜è®¤ä¼šç¦ç”¨flashï¼ˆflashè¿™é¡¹æŠ€æœ¯ä¸å®‰å…¨ï¼Œæ¼æ´å¤ªå¤šï¼Œç›®å‰å·²ç»è¢«æ·˜æ±°ï¼Œä½†æ˜¯æŸäº›ç½‘ç«™ä»åœ¨ä½¿ç”¨ï¼Œæ¯”å¦‚4399ğŸ˜ï¼‰\næ¨èæŒ‡æ•°â­â­â­â­â­\n### 360æé€Ÿæµè§ˆå™¨\næ³¨æ„æ˜¯**360æé€Ÿæµè§ˆå™¨**ï¼Œè¿™ä¸ªä¸ä¼šæœ‰æ†ç»‘ï¼Œæˆ‘åœ¨æ²¡æ¢ç”µè„‘ä¹‹å‰ä¹Ÿç”¨äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„è¿™ä¸ªæµè§ˆå™¨ï¼Œè¿™ä¸ªç”¨çš„æ˜¯Chromeçš„å†…æ ¸ã€‚è¿™ä¸ªæµè§ˆå™¨æ˜¯å¯ä»¥ç›´æ¥æ’­æ”¾flashçš„ï¼Œä¸éœ€è¦è®¾ç½®ï¼Œä½†æ˜¯è¿™ä¸ªæµè§ˆå™¨å¯åŠ¨è´¼æ…¢ï¼Œå†·å¯åŠ¨è¦6ï¼Œ7ç§’ï¼Œç¦»è°±çš„å¾ˆ\næ¨èæŒ‡æ•°â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://browser.360.cn/ee/)\n### Edge\nä¹Ÿå°±æ˜¯ä½ ç°åœ¨ç”µè„‘ä¸Šè‡ªå¸¦çš„å“ªä¸ªï¼ŒåŸæœ¬è‡ªå¸¦çš„æ˜¯ieï¼Œä½†æ˜¯ç°åœ¨æ–°ç‰ˆçš„win10å·²ç»éƒ½æ¢æˆè¿™ä¸ªäº†ï¼Œè¿™ä¸ªç”¨çš„ä¹Ÿæ˜¯Chromeçš„å†…æ ¸ï¼Œä¹ŸæŒºå¥½ç”¨çš„\næ¨èæŒ‡æ•°â­â­â­â­\n## è§†é¢‘æ’­æ”¾å™¨\n\n### PotPlayer\nå…¶å®win10è‡ªå¸¦çš„æœ‰ä¸€ä¸ªæ’­æ”¾å™¨ï¼Œä½†æ˜¯æ”¯æŒçš„è§†é¢‘æ ¼å¼ä¸æ˜¯å¾ˆå¤šï¼Œè€Œä¸”åŠŸèƒ½æ¯”è¾ƒå°‘ï¼ˆä¸èƒ½å€æ•°ï¼Œä¸èƒ½é€å¸§...ï¼‰ï¼Œè¿™ä¸ªPotPlayeræ¯”è¾ƒå¥½ç”¨ï¼Œæ²¡æœ‰å¹¿å‘Šï¼Œé¡µé¢ç®€æ´ï¼Œæ”¯æŒå¸‚é¢ä¸Šå¤§å¤šæ•°è§†é¢‘æ ¼å¼ã€‚æ¨èæŒ‡æ•°â­â­â­â­â­\nä¸‹è½½åœ°å€ [click](https://daumpotplayer.com/wp-content/uploads/2020/10/PotPlayerSetup64.exe)\n\n## PDFé˜…è¯»å™¨\n\n### PDFread\n\nå¹³å¸¸çœ‹ä¸€äº›pdfæ–‡ä»¶ï¼ˆç”µå­ä¹¦ï¼‰æ—¶å¯ä»¥ç”¨è¿™ä¸ªï¼ˆæµè§ˆå™¨ä¹Ÿå¯ä»¥ç›´æ¥æ‰“å¼€pdfæŸ¥çœ‹ï¼Œä½†æ˜¯ä¸èƒ½ä¿å­˜é˜…è¯»è®°å½•ï¼Œæ¯æ¬¡è¦é‡æ–°æ‰“å¼€ï¼‰\n![](https://i.loli.net/2020/11/18/yhOdHpzFXQTet1W.png)\nä¹Ÿæ˜¯ç»¿è‰²è½¯ä»¶ï¼Œæ‰“å¼€å³ç”¨ï¼Œæ— éœ€å®‰è£…ã€‚\næ¨èæŒ‡æ•°â­â­â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://wws.lanzous.com/i8uZ6iivtij)\n\n## è§£å‹ & å‹ç¼©\n\n### Bandzip\nç®€æ´å¥½ç”¨ï¼Œæœ€è¿‘åœ¨å…è´¹ç‰ˆæœ¬ä¸­å³ä¸‹è§’åŠ å…¥äº†ä¸€ç‚¹å¹¿å‘Šï¼Œä½†æ˜¯åªæœ‰ä½ ä¸»åŠ¨å»å¯åŠ¨å‹ç¼©è½¯ä»¶æ‰ä¼šå‡ºç°ï¼Œæ­£å¸¸äººåº”è¯¥ä¸ä¼šä¸»åŠ¨å»ç‚¹å‡»å‹ç¼©è½¯ä»¶ï¼Œå¹³å¸¸å³é”®å‹ç¼©è§£å‹æ˜¯çœ‹ä¸è§å¹¿å‘Šçš„ï¼Œè¿˜ç®—æ˜¯æ¯”è¾ƒå…‹åˆ¶ï¼Œç›®å‰è¿˜æ²¡æœ‰å½±å“æˆ‘ä½¿ç”¨ä½“éªŒï¼ˆå›½å†…æŸæ•°å­—å‹ç¼©è½¯ä»¶ä¸€è¾¹å‡‰å¿«å»å§ï¼‰ã€‚æ¨èæŒ‡æ•°â­â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://www.bandisoft.com/bandizip/)\n### 7-zip\n\nè¿™ä¸ªæ˜¯å®Œå…¨å…è´¹çš„ç»¿è‰²è½¯ä»¶ï¼Œä½†æ˜¯æ„Ÿè§‰ç•Œé¢æ¯”è¾ƒç®€é™‹ï¼Œæœ‰ä¸€ç‚¹å­¦ä¹ æˆæœ¬\næ¨èæŒ‡æ•°â­â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://www.7-zip.org/a/7z1900-x64.exe)\n\n## æ–‡ä»¶æœç´¢\n\n### Everything\n\næ–‡ä»¶æ£€ç´¢çš„å·¥å…·ï¼Œç¬¬ä¸€æ¬¡åˆå§‹åŒ–ä¼šæœ‰ç‚¹æ…¢ï¼Œåç»­æœç´¢ä¼šéå¸¸è¿…é€Ÿï¼Œä½“ç§¯å°ï¼Œç»¿è‰²è½¯ä»¶ï¼Œæ— éœ€å®‰è£…\næ¨èæŒ‡æ•°â­â­â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://www.voidtools.com/Everything-1.4.1.992.x64.zip)\n\n## æ¡Œé¢æ•´ç†\n### DeskGo\nè…¾è®¯æ¡Œé¢æ•´ç†ï¼Œtxéš¾å¾—çš„è‰¯å¿ƒè½¯ä»¶ï¼Œæœ¬æ¥æ˜¯QQå®‰å…¨ç®¡å®¶é‡Œé¢é™„å¸¦çš„ï¼Œåæ¥è¢«å•ç‹¬æå–å‡ºæ¥äº†ï¼Œæ²¡å¹¿å‘Šï¼Œæ²¡æ†ç»‘ï¼Œå ç”¨å°ï¼ˆå‡ åMï¼‰ã€‚ç”¨èµ·æ¥å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­\n![mark](http://static.imlgw.top///20190414/Ch6k6LNP3CU2.png?imageslim)\nå¯ä»¥æ•´ç†ä¹±ç³Ÿç³Ÿçš„æ¡Œé¢ï¼ŒæŠŠåº”ç”¨ç¨‹åºï¼Œæ–‡ä»¶å•¥çš„åˆ†ç±»ä¹‹åæ‘†æ”¾çš„æ•´æ•´é½é½ï¼ˆå¼ºè¿«ç—‡å¿…å¤‡ğŸ˜‚ï¼‰æ¨èæŒ‡æ•°â­â­â­â­â­\n\n> å®é™…ä¸Šæˆ‘ç°åœ¨å·²ç»ä¸ç”¨è¿™ä¸ªæ¡Œé¢æ•´ç†çš„è½¯ä»¶äº†ï¼Œæˆ‘æ¡Œé¢ä¸Šå•¥éƒ½æ²¡æœ‰ï¼ˆè¿™æ ·å°±ä¸ç”¨æ•´ç†äº†ğŸ¤£ï¼‰\n> ![](https://i.loli.net/2020/11/18/UFA2gaJ4lxCWbyN.png)\n\n\nä¸‹è½½åœ°å€ [click](https://dl.softmgr.qq.com/original/Office/DeskGo_3_1_1427_127_lite.exe)\n\n## æµè§ˆå™¨æ’ä»¶\nè¿™ä¸€å—å¯èƒ½ä¼šæœ‰ä¸€ç‚¹éº»çƒ¦ï¼Œéœ€è¦å…ˆæŠŠæ¢¯å­å¼„å¥½\næµè§ˆå™¨æ’ä»¶æœ‰å¾ˆå¤šæŒºæœ‰ç”¨çš„åŠŸèƒ½ï¼Œå¾ˆå¤šéªšæ“ä½œï¼Œå¯ä»¥è‡ªå·±ç ”ç©¶ç ”ç©¶\n1. æ— é™åˆ¶å¤åˆ¶ç²˜è´´ï¼ˆæŸåº¦æ–‡åº“ä¸è®©å¤åˆ¶ï¼‰\n2. ä¸€äº›å½±è§†ç½‘ç«™ï¼ˆaiqiyi, tencent...ï¼‰ç›´æ¥è§£æåˆ°ç›—ç‰ˆç½‘ç«™åœ¨çº¿è§‚çœ‹\n3. å¹¿å‘Šæ‹¦æˆªï¼ˆADBlockï¼Œéå¸¸å¼ºåŠ›ï¼‰\n4. Bç«™ | çŸ¥ä¹ | youtube | ...è§†é¢‘ä¸‹è½½\n5. åˆ’è¯ç¿»è¯‘\n6. lastpassï¼Œä¹‹å‰ç»™ä½ ä»‹ç»çš„å¯†ç ç®¡ç†è½¯ä»¶çš„æµè§ˆå™¨æ’ä»¶ç‰ˆæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨å¡«å……å¯†ç ï¼Œä¿å­˜å¯†ç ï¼Œéšæœºå¯†ç \n7. ....\n\n## OCR\n### å¤©è‹¥OCR\nç»¿è‰²è½¯ä»¶ï¼Œä½“ç§¯å¾ˆå°ï¼Œæ— éœ€å®‰è£…ï¼Œæ‰«æä¹Ÿå¾ˆå‡†ç¡®ï¼ˆæ›¾ç»ç”¨è¿™ä¸ªæ‰«æåˆ«äººæ‰‹å†™çš„ä½œä¸šï¼Œç„¶åcopyğŸ˜ï¼‰æ¨èæŒ‡æ•°â­â­â­â­\n\nä¸‹è½½åœ°å€ [click](https://wws.lanzous.com/iF9Wjiiz4af)\n## åœ¨çº¿ç”»æµç¨‹å›¾ç½‘ç«™\n[draw.io](https://app.diagrams.net/)\nåœ¨çº¿ç”»å›¾å·¥å…·ï¼Œè°ç”¨è°çŸ¥é“ï¼Œç°åœ¨ä¹Ÿæœ‰æ¡Œé¢ç‰ˆæœ¬çš„äº†\n![](https://i.loli.net/2020/11/18/lxbAdeE8knGtQBg.png)\n\n## æ¢¯å­\nç›´æ¥çœ‹å®˜æ–¹ç»™çš„æ•™ç¨‹å°±okäº†\n\nhttps://xcat.us/user/tutorial_v2ray\n\n## å¸¸ç”¨çš„ç½‘ç«™\n\n- http://imlgw.top/ ä¸å¤šè¯´ï¼Œèµ¶å¿«æ”¶è—ç½®é¡¶\n- https://www.deepl.com/translator ä¸“ä¸šç¿»è¯‘\n- https://www.gaitubao.com/ åœ¨çº¿æ”¹å›¾ï¼Œå‹å›¾ï¼Œä¿®æ”¹æ ¼å¼ï¼Œå¾ˆå¥½ç”¨\n- https://wallhaven.cc/ é«˜æ¸…å£çº¸ï¼Œå›¾ç‰‡ï¼ˆå¾ˆå¤šæ¯”è¾ƒå¤§çš„å›¾ä¸‹è½½åéœ€è¦æ‰‹åŠ¨çš„æ”¹å›¾ï¼Œæ”¹æˆ1080æ‰èƒ½é€‚é…ï¼‰\n- https://wall.alphacoders.com/ ä¹Ÿæ˜¯å£çº¸å›¾ç‰‡ç´ æç½‘ç«™ï¼Œè¿™ä¸ªå¯ä»¥åœ¨çº¿çš„æ”¹å›¾çš„åˆ†è¾¨ç‡ï¼Œæ”¹æˆ1080å°±å¯ä»¥ç›´æ¥æ‹¿æ¥åšå£çº¸äº†\n- https://www.lanzou.com/ è¿™ä¸ªç”¨æ¥åšå°æ–‡ä»¶ï¼ˆå°äº100Mï¼‰åˆ†äº«å¾ˆå¥½ç”¨ï¼Œå…è´¹ï¼Œä¸é™é€Ÿï¼Œä¸éœ€è¦ä¸‹è½½å®¢æˆ·ç«¯ï¼Œï¼ˆæŸåº¦äº‘æˆ‘åŸºæœ¬å·²ç»æŠ›å¼ƒäº†ï¼Œå¤§æ–‡ä»¶ä¸‹è½½é™é€Ÿé™åˆ°æ­»ï¼Œå°æ–‡ä»¶ä¸‹è½½è¿˜å¾—ä¸‹å®¢æˆ·ç«¯ï¼Œæˆ‘è¦é‚£ä¹ˆå¤§çš„ç©ºé—´æœ‰æ¯›ç”¨ï¼Œä¸‹éƒ½ä¸‹ä¸æ¥ï¼‰","tags":["è½¯ä»¶æ¨è"],"categories":["æ‚é¡¹"]},{"title":"DPï¼šæœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹","url":"/2020/11/14/dp-zui-chang-shang-sheng-zi-xu-lie-mo-xing/","content":"\n> ç°åœ¨æ‰“ç®—å†™ä¸€äº›çŸ­ç‚¹çš„æ–‡ç« äº†ï¼ŒLeetCodeç³»åˆ—ä¸ä¼šå†appendäº†ï¼Œå¦‚æœå†™lcé¢˜ä¼šå•ç‹¬å¼€ä¸€ç¯‡æ–‡ç« ï¼Œç„¶åå†™é¢˜è§£\n\n## æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹\n\n[300. æœ€é•¿ä¸Šå‡å­åºåˆ—](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#300-%E6%9C%80%E9%95%BF%E4%B8%8A%E5%8D%87%E5%AD%90%E5%BA%8F%E5%88%97)\n\n[673. æœ€é•¿é€’å¢å­åºåˆ—çš„ä¸ªæ•°](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#673-%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97%E7%9A%84%E4%B8%AA%E6%95%B0)\n\n[1016. ä½¿åºåˆ—é€’å¢çš„æœ€å°äº¤æ¢æ¬¡æ•°ï¼ˆLintCodeï¼‰](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#1016-%E4%BD%BF%E5%BA%8F%E5%88%97%E9%80%92%E5%A2%9E%E7%9A%84%E6%9C%80%E5%B0%8F%E4%BA%A4%E6%8D%A2%E6%AC%A1%E6%95%B0%EF%BC%88LintCode%EF%BC%89)\n\n[354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°é—®é¢˜](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#354-%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98)\n\nLISæœ‰N^2çš„DPè§£æ³•ï¼Œä¹Ÿæœ‰NlogNçš„è´ªå¿ƒçš„è§£æ³•ï¼Œå…·ä½“ç”¨é‚£ç§å–å†³äºæ•°æ®èŒƒå›´\n\n## [1017. æ€ªç›—åŸºå¾·çš„æ»‘ç¿”ç¿¼](https://www.acwing.com/problem/content/1019/)\n\næ€ªç›—åŸºå¾·æ˜¯ä¸€ä¸ªå……æ»¡ä¼ å¥‡è‰²å½©çš„æ€ªç›—ï¼Œä¸“é—¨ä»¥ç å®ä¸ºç›®æ ‡çš„è¶…çº§ç›—çªƒçŠ¯ã€‚\n\nè€Œä»–æœ€ä¸ºçªå‡ºçš„åœ°æ–¹ï¼Œå°±æ˜¯ä»–æ¯æ¬¡éƒ½èƒ½é€ƒè„±ä¸­æ‘è­¦éƒ¨çš„é‡é‡å›´å µï¼Œè€Œè¿™ä¹Ÿå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å¤šäºäº†ä»–éšèº«æºå¸¦çš„ä¾¿äºæ“ä½œçš„æ»‘ç¿”ç¿¼ã€‚\n\næœ‰ä¸€å¤©ï¼Œæ€ªç›—åŸºå¾·åƒå¾€å¸¸ä¸€æ ·å·èµ°äº†ä¸€é¢—çè´µçš„é’»çŸ³ï¼Œä¸æ–™å´è¢«æŸ¯å—å°æœ‹å‹è¯†ç ´äº†ä¼ªè£…ï¼Œè€Œä»–çš„æ»‘ç¿”ç¿¼çš„åŠ¨åŠ›è£…ç½®ä¹Ÿè¢«æŸ¯å—è¸¢å‡ºçš„è¶³çƒç ´åäº†ã€‚\n\nä¸å¾—å·²ï¼Œæ€ªç›—åŸºå¾·åªèƒ½æ“ä½œå—æŸçš„æ»‘ç¿”ç¿¼é€ƒè„±ã€‚\n\nå‡è®¾åŸå¸‚ä¸­ä¸€å…±æœ‰Nå¹¢å»ºç­‘æ’æˆä¸€æ¡çº¿ï¼Œæ¯å¹¢å»ºç­‘çš„é«˜åº¦å„ä¸ç›¸åŒã€‚\n\nåˆå§‹æ—¶ï¼Œæ€ªç›—åŸºå¾·å¯ä»¥åœ¨ä»»ä½•ä¸€å¹¢å»ºç­‘çš„é¡¶ç«¯ã€‚\n\nä»–å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ–¹å‘é€ƒè·‘ï¼Œä½†æ˜¯ä¸èƒ½ä¸­é€”æ”¹å˜æ–¹å‘ï¼ˆå› ä¸ºä¸­æ£®è­¦éƒ¨ä¼šåœ¨åé¢è¿½å‡»ï¼‰ã€‚\n\nå› ä¸ºæ»‘ç¿”ç¿¼åŠ¨åŠ›è£…ç½®å—æŸï¼Œä»–åªèƒ½å¾€ä¸‹æ»‘è¡Œï¼ˆå³ï¼šåªèƒ½ä»è¾ƒé«˜çš„å»ºç­‘æ»‘ç¿”åˆ°è¾ƒä½çš„å»ºç­‘ï¼‰ã€‚\n\nä»–å¸Œæœ›å°½å¯èƒ½å¤šåœ°ç»è¿‡ä¸åŒå»ºç­‘çš„é¡¶éƒ¨ï¼Œè¿™æ ·å¯ä»¥å‡ç¼“ä¸‹é™æ—¶çš„å†²å‡»åŠ›ï¼Œå‡å°‘å—ä¼¤çš„å¯èƒ½æ€§ã€‚\n\nè¯·é—®ï¼Œä»–æœ€å¤šå¯ä»¥ç»è¿‡å¤šå°‘å¹¢ä¸åŒå»ºç­‘çš„é¡¶éƒ¨(åŒ…å«åˆå§‹æ—¶çš„å»ºç­‘)ï¼Ÿ\n\n**è¾“å…¥æ ¼å¼**\n\nè¾“å…¥æ•°æ®ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•°Kï¼Œä»£è¡¨æœ‰Kç»„æµ‹è¯•æ•°æ®ã€‚\n\næ¯ç»„æµ‹è¯•æ•°æ®åŒ…å«ä¸¤è¡Œï¼šç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•°Nï¼Œä»£è¡¨æœ‰Nå¹¢å»ºç­‘ã€‚ç¬¬äºŒè¡ŒåŒ…å«Nä¸ªä¸åŒçš„æ•´æ•°ï¼Œæ¯ä¸€ä¸ªå¯¹åº”ä¸€å¹¢å»ºç­‘çš„é«˜åº¦hï¼ŒæŒ‰ç…§å»ºç­‘çš„æ’åˆ—é¡ºåºç»™å‡ºã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nå¯¹äºæ¯ä¸€ç»„æµ‹è¯•æ•°æ®ï¼Œè¾“å‡ºä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨æ€ªç›—åŸºå¾·æœ€å¤šå¯ä»¥ç»è¿‡çš„å»ºç­‘æ•°é‡ã€‚\n\n**æ•°æ®èŒƒå›´**\n\n1â‰¤Kâ‰¤100, 1â‰¤Nâ‰¤100, 0<h<10000\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n3\n8\n300 207 155 299 298 170 158 65\n8\n65 158 170 298 299 155 207 300\n10\n2 1 3 4 5 6 7 8 9 10\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```c\n6\n6\n9\n```\n\n### è§£æ³•ä¸€\n\nå¸¸è§„N^2åŠ¨æ€è§„åˆ’çš„æ–¹å¼ & NlogNè´ªå¿ƒè§£æ³•ï¼ˆNlogNçš„è§£æ³•å›å¿†äº†ä¸€ä¼šå„¿æ‰æ¨å‡ºæ¥ï¼Œå¦‚æœæ•°æ®èŒƒå›´ä¸æ˜¯å¾ˆå¤§è¿˜æ˜¯N^2çš„dpå¥½å†™ï¼‰\n```java\nimport java.io.*;\nimport java.util.*;\n//AcWing 1017. æ€ªç›—åŸºå¾·çš„æ»‘ç¿”ç¿¼ https://www.acwing.com/problem/content/1019/\nclass Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        int T = sc.nextInt();\n        while (T-- > 0) {\n            int n = sc.nextInt();\n            int[] w = new int[n];\n            for (int i = 0; i < n; i++) {\n                w[i] = sc.nextInt(); \n            }\n            System.out.println(Math.max(solve(w, n), solve(reverse(w), n))); \n        }\n    }\n\n    //DP(N^2)çš„è§£æ³•\n    public static int solve(int[] w, int n) {\n        int[] dp = new int[n];\n        Arrays.fill(dp, 1);\n        int res = 1;\n        for (int i = 0; i < n; i++) {\n            for (int j = 0; j < i; j++) {\n                if (w[j] > w[i]) {\n                    dp[i] = Math.max(dp[j]+1, dp[i]);  \n                }\n            }\n            res = Math.max(res, dp[i]);\n        }\n        return res; \n    }\n\n    //tail[i]: é•¿åº¦ä¸ºiçš„é€’å‡å­åºåˆ—æœ€å¤§ç»“å°¾\n    public static int solve2(int[] w, int n) {\n        int[] tail = new int[n];\n        int len = 0;\n        for (int i = 0; i < n; i++) {\n            int idx = search(tail, len, w[i]);\n            if (idx == -1) {\n                tail[len++] = w[i];\n            } else {\n                tail[idx] = w[i];\n            }\n        }\n        return len;\n    }\n\n    //ä»å·¦åˆ°å³æ‰¾ç¬¬ä¸€ä¸ªå°äºtargetçš„å…ƒç´ ä¸‹æ ‡ï¼Œæ›¿æ¢å®ƒï¼Œä½¿å¾—ç»“å°¾æ›´å¤§ï¼Œé•¿åº¦æ›´é•¿\n    public static int search(int[] tail, int len, int target){\n        int left = 0, right = len-1;\n        int res = -1;\n        while (left <= right) {\n            int mid = left + (right - left)/2;\n            if (tail[mid] <= target) {\n                res = mid;\n                right = mid - 1;\n            } else {\n                left = mid + 1;\n            }\n        }\n        return res;\n    }\n\n    public static int[] reverse(int[] w) {\n        for (int i = 0, j = w.length-1; i < j; i++, j--) {\n            int temp = w[i];\n            w[i] = w[j];\n            w[j] = temp;\n        }\n        return w;\n    }\n}\n```\n\n## [1014. ç™»å±±](https://www.acwing.com/problem/content/1016/)\n\näº”ä¸€åˆ°äº†ï¼ŒACMé˜Ÿç»„ç»‡å¤§å®¶å»ç™»å±±è§‚å…‰ï¼Œé˜Ÿå‘˜ä»¬å‘ç°å±±ä¸Šä¸€ä¸ªæœ‰Nä¸ªæ™¯ç‚¹ï¼Œå¹¶ä¸”å†³å®šæŒ‰ç…§é¡ºåºæ¥æµè§ˆè¿™äº›æ™¯ç‚¹ï¼Œå³æ¯æ¬¡æ‰€æµè§ˆæ™¯ç‚¹çš„ç¼–å·éƒ½è¦å¤§äºå‰ä¸€ä¸ªæµè§ˆæ™¯ç‚¹çš„ç¼–å·ã€‚\n\nåŒæ—¶é˜Ÿå‘˜ä»¬è¿˜æœ‰å¦ä¸€ä¸ªç™»å±±ä¹ æƒ¯ï¼Œå°±æ˜¯ä¸è¿ç»­æµè§ˆæµ·æ‹”ç›¸åŒçš„ä¸¤ä¸ªæ™¯ç‚¹ï¼Œå¹¶ä¸”ä¸€æ—¦å¼€å§‹ä¸‹å±±ï¼Œå°±ä¸å†å‘ä¸Šèµ°äº†ã€‚\n\né˜Ÿå‘˜ä»¬å¸Œæœ›åœ¨æ»¡è¶³ä¸Šé¢æ¡ä»¶çš„åŒæ—¶ï¼Œå°½å¯èƒ½å¤šçš„æµè§ˆæ™¯ç‚¹ï¼Œä½ èƒ½å¸®ä»–ä»¬æ‰¾å‡ºæœ€å¤šå¯èƒ½æµè§ˆçš„æ™¯ç‚¹æ•°ä¹ˆï¼Ÿ\n\n**è¾“å…¥æ ¼å¼**\n\nç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•°Nï¼Œè¡¨ç¤ºæ™¯ç‚¹æ•°é‡ã€‚\n\nç¬¬äºŒè¡ŒåŒ…å«Nä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ¯ä¸ªæ™¯ç‚¹çš„æµ·æ‹”ã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤šèƒ½æµè§ˆçš„æ™¯ç‚¹æ•°ã€‚\n\n**æ•°æ®èŒƒå›´**\n2â‰¤Nâ‰¤1000\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n8\n186 186 150 200 160 130 197 220\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```c\n4\n```\n\n### è§£æ³•ä¸€\n\nLISè½¬æ¢äº†ä¸€ä¸‹è€Œå·²ï¼Œæ±‚æ¯ä¸ªç‚¹ä»**å·¦åˆ°å³** å’Œ ä»**å³åˆ°å·¦**çš„æœ€é•¿ä¸Šå‡å­åºåˆ—æœ€å¤§å’Œå°±okäº†\n```java\nimport java.util.*;\nimport java.io.*;\nclass Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        int N = sc.nextInt();\n        int[] w = new int[N];\n        for (int i = 0; i < N; i++) {\n            w[i] = sc.nextInt();\n        }\n        System.out.println(solve(w, N));\n    }\n\n    //186 186 150 200 160 130 197 220  := 4\n    public static int solve(int[] w, int N) {\n        int[] dp1 = new int[N];\n        int[] dp2 = new int[N];\n        Arrays.fill(dp1, 1);\n        Arrays.fill(dp2, 1);\n        int res = 1;\n        for (int i = 0; i < N; i++) {\n            for (int j = 0; j < i; j++) {\n                if (w[j] < w[i]) {\n                    dp1[i] = Math.max(dp1[j]+1, dp1[i]);          \n                }\n            }\n        }\n        for (int i = N-1; i >= 0; i--) {\n            for (int j = N-1; j > i; j--) {\n                if (w[j] < w[i]) {\n                    dp2[i] = Math.max(dp2[j]+1, dp2[i]);          \n                }\n            }\n            res = Math.max(res, dp1[i]+dp2[i]-1);\n        }\n        return res;\n    }\n}\n```\n> [482. åˆå”±é˜Ÿå½¢](https://www.acwing.com/problem/content/484/)å’Œè¿™ä¸€é¢˜ä¸€æ ·ï¼Œä¸é‡å¤å†™äº†\n\n## [1012. å‹å¥½åŸå¸‚](https://www.acwing.com/problem/content/1014/)\n\nPalmiaå›½æœ‰ä¸€æ¡æ¨ªè´¯ä¸œè¥¿çš„å¤§æ²³ï¼Œæ²³æœ‰ç¬”ç›´çš„å—åŒ—ä¸¤å²¸ï¼Œå²¸ä¸Šå„æœ‰ä½ç½®å„ä¸ç›¸åŒçš„Nä¸ªåŸå¸‚ã€‚\n\nåŒ—å²¸çš„æ¯ä¸ªåŸå¸‚æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå‹å¥½åŸå¸‚åœ¨å—å²¸ï¼Œè€Œä¸”ä¸åŒåŸå¸‚çš„å‹å¥½åŸå¸‚ä¸ç›¸åŒã€‚\n\næ¯å¯¹å‹å¥½åŸå¸‚éƒ½å‘æ”¿åºœç”³è¯·åœ¨æ²³ä¸Šå¼€è¾Ÿä¸€æ¡ç›´çº¿èˆªé“è¿æ¥ä¸¤ä¸ªåŸå¸‚ï¼Œä½†æ˜¯ç”±äºæ²³ä¸Šé›¾å¤ªå¤§ï¼Œæ”¿åºœå†³å®šé¿å…ä»»æ„ä¸¤æ¡èˆªé“äº¤å‰ï¼Œä»¥é¿å…äº‹æ•…ã€‚\n\nç¼–ç¨‹å¸®åŠ©æ”¿åºœåšå‡ºä¸€äº›æ‰¹å‡†å’Œæ‹’ç»ç”³è¯·çš„å†³å®šï¼Œä½¿å¾—åœ¨ä¿è¯ä»»æ„ä¸¤æ¡èˆªçº¿ä¸ç›¸äº¤çš„æƒ…å†µä¸‹ï¼Œè¢«æ‰¹å‡†çš„ç”³è¯·å°½é‡å¤šã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nç¬¬1è¡Œï¼Œä¸€ä¸ªæ•´æ•°Nï¼Œè¡¨ç¤ºåŸå¸‚æ•°ã€‚\n\nç¬¬2è¡Œåˆ°ç¬¬n+1è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œä¸­é—´ç”¨1ä¸ªç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºå—å²¸å’ŒåŒ—å²¸çš„ä¸€å¯¹å‹å¥½åŸå¸‚çš„åæ ‡ã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nä»…ä¸€è¡Œï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ”¿åºœæ‰€èƒ½æ‰¹å‡†çš„æœ€å¤šç”³è¯·æ•°ã€‚\n\n**æ•°æ®èŒƒå›´**\n\n1â‰¤Nâ‰¤5000,\n0â‰¤xiâ‰¤10000\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n7\n22 4\n2 6\n10 3\n15 12\n9 8\n17 17\n4 2\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```c\n4\n```\n\n### è§£æ³•ä¸€\n\nå’Œä¹‹å‰çš„[354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°é—®é¢˜](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#354-%E4%BF%84%E7%BD%97%E6%96%AF%E5%A5%97%E5%A8%83%E4%BF%A1%E5%B0%81%E9%97%AE%E9%A2%98)ä¸€æ ·ï¼Œè¿˜ç®€å•ä¸€ç‚¹ï¼Œåæ ‡éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¸éœ€è¦è€ƒè™‘åæ ‡é‡åˆçš„é—®é¢˜ï¼Œå…·ä½“å¯ä»¥å»çœ‹çœ‹ä¿„ç½—æ–¯å¥—å¨ƒçš„è¿™ä¸ªé¢˜\n\n```java\nimport java.util.*;\nimport java.io.*;\nclass Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        int N = sc.nextInt();\n        int[][] w = new int[N][2];\n        for (int i = 0; i < N; i++) {\n            w[i][0] = sc.nextInt();\n            w[i][1] = sc.nextInt();\n        }\n        System.out.println(solve2(w, N));\n    }\n\n    //5000 * 5000 = 2500 0000ï¼Œèƒ½è¿‡ä½†æ˜¯æœ‰ç‚¹æ…¢\n    public static int solve(int[][] w, int N) {\n        Arrays.sort(w, (w1, w2)->w1[0]-w2[0]);\n        int res = 1;\n        int[] dp = new int[N];\n        for (int i = 0; i < N; i++) {\n            dp[i] = 1;\n            for (int j = 0; j < i; j++) {\n                if (w[j][0] < w[i][0] && w[j][1] < w[i][1]) {\n                    dp[i] = Math.max(dp[j]+1, dp[i]);\n                }\n            }\n            res = Math.max(res, dp[i]);\n        }\n        return res;\n    }\n\n    //NlogNè´ªå¿ƒäºŒåˆ†çš„åšæ³•\n    public static int solve2(int[][] w, int N) {\n        Arrays.sort(w, (w1, w2)->w1[0]-w2[0]);\n        int[] tail = new int[N];\n        int len = 0;\n        for (int i = 0; i < N; i++) {\n            int idx = search(tail, len, w[i][1]);\n            if (idx == -1) {\n                tail[len++] = w[i][1];\n            } else {\n                tail[idx] = w[i][1];\n            }\n        }\n        return len;\n    }\n\n    //ä»å·¦åˆ°å³æ‰¾ç¬¬ä¸€ä¸ªå¤§äºtargetçš„ï¼Œåé¢æ›¿æ¢å®ƒï¼Œä½¿å¾—ç»“å°¾æ›´å°\n    public static int search(int[] tail, int len, int target) {\n        int left = 0, right = len-1;\n        int res = -1;\n        while (left <= right) {\n            int mid = left + (right - left)/2;\n            if (tail[mid] > target) {\n                res = mid;\n                right = mid - 1;\n            } else {\n                left = mid + 1;\n            }\n        }\n        return res;\n    }\n}\n```\n\n## [1016. æœ€å¤§ä¸Šå‡å­åºåˆ—å’Œ](https://www.acwing.com/problem/content/1018/)\n\nä¸€ä¸ªæ•°çš„åºåˆ— biï¼Œå½“ b1<b2<â€¦<bS çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªåºåˆ—æ˜¯ä¸Šå‡çš„ã€‚\n\nå¯¹äºç»™å®šçš„ä¸€ä¸ªåºåˆ—(a1,a2,â€¦,aN)ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›ä¸Šå‡çš„å­åºåˆ—(ai1,ai2,â€¦,aiK)ï¼Œè¿™é‡Œ1â‰¤i1<i2<â€¦<iKâ‰¤Nã€‚\n\næ¯”å¦‚ï¼Œå¯¹äºåºåˆ—(1,7,3,5,9,4,8)ï¼Œæœ‰å®ƒçš„ä¸€äº›ä¸Šå‡å­åºåˆ—ï¼Œå¦‚(1,7),(3,4,8)ç­‰ç­‰ã€‚\n\nè¿™äº›å­åºåˆ—ä¸­å’Œæœ€å¤§ä¸º18ï¼Œä¸ºå­åºåˆ—(1,3,5,9)çš„å’Œã€‚\n\nä½ çš„ä»»åŠ¡ï¼Œå°±æ˜¯å¯¹äºç»™å®šçš„åºåˆ—ï¼Œæ±‚å‡ºæœ€å¤§ä¸Šå‡å­åºåˆ—å’Œã€‚\n\næ³¨æ„ï¼Œæœ€é•¿çš„ä¸Šå‡å­åºåˆ—çš„å’Œä¸ä¸€å®šæ˜¯æœ€å¤§çš„ï¼Œæ¯”å¦‚åºåˆ—(100,1,2,3)çš„æœ€å¤§ä¸Šå‡å­åºåˆ—å’Œä¸º100ï¼Œè€Œæœ€é•¿ä¸Šå‡å­åºåˆ—ä¸º(1,2,3)ã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nè¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯åºåˆ—çš„é•¿åº¦Nã€‚\n\nç¬¬äºŒè¡Œç»™å‡ºåºåˆ—ä¸­çš„Nä¸ªæ•´æ•°ï¼Œè¿™äº›æ•´æ•°çš„å–å€¼èŒƒå›´éƒ½åœ¨0åˆ°10000(å¯èƒ½é‡å¤)ã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§ä¸Šå‡å­åºåˆ—å’Œã€‚\n\n**æ•°æ®èŒƒå›´**\n\n1â‰¤Nâ‰¤1000\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n7\n1 7 3 5 9 4 8\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```\n18\n```\n\n### è§£æ³•ä¸€\n\næ²¡å•¥å¥½è¯´çš„ï¼Œæ¯”è¾ƒç®€å•\n```java\nimport java.util.*;\nimport java.io.*;\nclass Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        int N = sc.nextInt();\n        int[] w = new int[N];\n        for (int i = 0; i < N; i++) {\n            w[i] = sc.nextInt();\n        }\n        System.out.println(solve(w, N));\n    }\n\n    public static int solve(int[] w, int N) {\n        int[] dp = new int[N];\n        int res = 0;\n        for (int i = 0; i < N; i++) {\n            dp[i] = w[i];\n            for (int j = 0; j < i; j++) {\n                if (w[j] < w[i]) {\n                    dp[i] = Math.max(dp[i], dp[j]+w[i]);\n                }\n            }\n            res = Math.max(res, dp[i]);\n        }\n        return res;\n    }\n}\n```\n## [1010. æ‹¦æˆªå¯¼å¼¹](https://www.acwing.com/problem/content/description/1012/)\n\næŸå›½ä¸ºäº†é˜²å¾¡æ•Œå›½çš„å¯¼å¼¹è¢­å‡»ï¼Œå‘å±•å‡ºä¸€ç§å¯¼å¼¹æ‹¦æˆªç³»ç»Ÿã€‚\n\nä½†æ˜¯è¿™ç§å¯¼å¼¹æ‹¦æˆªç³»ç»Ÿæœ‰ä¸€ä¸ªç¼ºé™·ï¼šè™½ç„¶å®ƒçš„ç¬¬ä¸€å‘ç‚®å¼¹èƒ½å¤Ÿåˆ°è¾¾ä»»æ„çš„é«˜åº¦ï¼Œä½†æ˜¯ä»¥åæ¯ä¸€å‘ç‚®å¼¹éƒ½ä¸èƒ½é«˜äºå‰ä¸€å‘çš„é«˜åº¦ã€‚\n\næŸå¤©ï¼Œé›·è¾¾æ•æ‰åˆ°æ•Œå›½çš„å¯¼å¼¹æ¥è¢­ã€‚\n\nç”±äºè¯¥ç³»ç»Ÿè¿˜åœ¨è¯•ç”¨é˜¶æ®µï¼Œæ‰€ä»¥åªæœ‰ä¸€å¥—ç³»ç»Ÿï¼Œå› æ­¤æœ‰å¯èƒ½ä¸èƒ½æ‹¦æˆªæ‰€æœ‰çš„å¯¼å¼¹ã€‚\n\nè¾“å…¥å¯¼å¼¹ä¾æ¬¡é£æ¥çš„é«˜åº¦ï¼ˆé›·è¾¾ç»™å‡ºçš„é«˜åº¦æ•°æ®æ˜¯ä¸å¤§äº30000çš„æ­£æ•´æ•°ï¼Œå¯¼å¼¹æ•°ä¸è¶…è¿‡1000ï¼‰ï¼Œè®¡ç®—è¿™å¥—ç³»ç»Ÿæœ€å¤šèƒ½æ‹¦æˆªå¤šå°‘å¯¼å¼¹ï¼Œå¦‚æœè¦æ‹¦æˆªæ‰€æœ‰å¯¼å¼¹æœ€å°‘è¦é…å¤‡å¤šå°‘å¥—è¿™ç§å¯¼å¼¹æ‹¦æˆªç³»ç»Ÿã€‚\n\n**è¾“å…¥æ ¼å¼**: \n\nå…±ä¸€è¡Œï¼Œè¾“å…¥å¯¼å¼¹ä¾æ¬¡é£æ¥çš„é«˜åº¦ã€‚\n\n**è¾“å‡ºæ ¼å¼**: \n\nç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤šèƒ½æ‹¦æˆªçš„å¯¼å¼¹æ•°ã€‚\n\nç¬¬äºŒè¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦æ‹¦æˆªæ‰€æœ‰å¯¼å¼¹æœ€å°‘è¦é…å¤‡çš„ç³»ç»Ÿæ•°ã€‚\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n389 207 155 300 299 170 158 65\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```c\n6\n2\n```\n\n### è§£æ³•ä¸€\n\nDilworthå®šç†ï¼ŒåŒDPè§£æ³•\n```java\n//300 250 275 252 200 138 245 := 5,2\n//æœ€å¤šå‡»è½å¤šå°‘å°±ä¸å¤šè¯´äº†\n//æœ€å°‘éœ€è¦çš„ç³»ç»Ÿæ•°é‡å®é™…ä¸Šå°±æ˜¯æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸ªæ•°ï¼Œè¿™é‡Œæ¶‰åŠåˆ°Dilworthå®šç†\npublic static int[] solve(int[] w, int N){\n    int[] down = new int[N];\n    int[] up = new int[N];\n    int max = 0, count = 1;\n    for (int i = 0; i < N; i++) {\n        up[i] = down[i] = 1;\n        for (int j = 0; j < i; j++) {\n            if (w[j] >= w[i]) {\n                down[i] = Math.max(down[j]+1, down[i]);\n            } else {\n                up[i] = Math.max(up[j]+1, up[i]);\n            }\n        }\n        max = Math.max(max, down[i]);\n        count = Math.max(count, up[i]);\n    }\n    return new int[]{max, count};\n}\n```\n\næœ€å¤šå‡»è½å¤šå°‘å°±ä¸å¤šè¯´äº†ï¼Œ~~æœ€å°‘éœ€è¦çš„ç³»ç»Ÿæ•°å…¶å®å°±æ˜¯æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼Œå› ä¸ºè¿™ä¸ªå­åºåˆ—æ˜¯**å¿…ä¸å¯èƒ½åœ¨åŒä¸€å¥—ç³»ç»Ÿä¸­è¢«å‡»è½**ï¼Œå½“é‡åˆ°è¿™ä¸ªå­åºåˆ—ä¸­çš„å…ƒç´ çš„æ—¶å€™ï¼Œå°±éœ€è¦å¢åŠ ä¸€å¥—ç³»ç»Ÿï¼Œæ‰€ä»¥æœ€å°‘å°±æ˜¯è¿™ä¸ªå­åºåˆ—çš„é•¿åº¦~~\n\næœ€å°‘éœ€è¦çš„ç³»ç»Ÿæ•°é‡ï¼ˆæœ€å°‘çš„è¦†ç›–æ•´ä¸ªåºåˆ—çš„ä¸ä¸Šå‡åºåˆ—ä¸ªæ•°ï¼‰å°±æ˜¯æœ€é•¿çš„ä¸Šå‡å­åºåˆ—é•¿åº¦ï¼Œæ¶‰åŠåˆ°Dilworthå®šç†ï¼ˆ[å¯¼å¼¹æ‹¦æˆªé—®é¢˜ä¸Dilworthå®šç†](https://www.cnblogs.com/flipped/p/5009943.html)ï¼‰ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»äº†è§£ä¸‹ï¼Œå®šç†çš„å®šä¹‰ä¸ºï¼š_å¯¹äºä»»æ„æœ‰é™ååºé›†ï¼Œå…¶æœ€å¤§åé“¾ä¸­å…ƒç´ çš„æ•°ç›®å¿…ç­‰äºæœ€å°é“¾åˆ’åˆ†ä¸­é“¾çš„æ•°ç›®_ \n\næœ¬é¢˜ä¸­ï¼Œæœ€å°‘éœ€è¦çš„å¯¼å¼¹ç³»ç»Ÿæ•°é‡å°±æ˜¯**æœ€å°é“¾åˆ’åˆ†ä¸­é“¾çš„æ•°é‡**ï¼Œå…¶æœ€å¤§åé“¾å°±æ˜¯**æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦**ï¼Œæ‰€ä»¥ç›´æ¥æ±‚æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦å°±okäº†\n\n### è§£æ³•äºŒ\n\nåŒè´ªå¿ƒè§£æ³•ã€‚\n\nâ‘ æ±‚LISçš„è´ªå¿ƒåšæ³•ï¼Œ`tail[j]`è¡¨ç¤ºé•¿åº¦ä¸º`j`çš„ä¸‹é™åºåˆ—ï¼Œæ¯ä¸ª`w[i]`ä½œä¸ºç»“å°¾çš„æ—¶å€™ä¼˜å…ˆé€‰æ‹©å¤§äº`w[i]`çš„æœ€å°çš„`tail[j]`ï¼ˆä¹Ÿå°±æ˜¯ä»å·¦åˆ°å³æœ€ç¬¬ä¸€ä¸ªå¤§äºw[i]çš„ï¼‰ï¼Œç„¶åæ¥åœ¨å®ƒåé¢ï¼Œè¿™æ ·è®©é•¿åº¦ä¸ºjçš„ä¸‹é™åºåˆ—ç»“å°¾å˜å°ï¼Œåé¢å¯ä»¥æ¥ä¸Šæ›´å¤šçš„å…ƒç´ ï¼Œä½¿å¾—åºåˆ—å¯ä»¥æ›´é•¿ï¼Œå¹¶ä¸”è¿™æ ·ä¸ä¼šå½±å“ä¹‹å‰å·²æœ‰çš„åºåˆ—å…³ç³»ï¼Œæœ€ç»ˆtailçš„é•¿åº¦å°±æ˜¯æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦\n\nâ‘¡æ±‚æœ€å°‘çš„è¦†ç›–å…¨åºåˆ—çš„ä¸‹é™å­åºåˆ—ä¸ªæ•°ï¼Œ`tail[j]`è¡¨ç¤ºç›®å‰ä¸ºæ­¢ç¬¬`j`ä¸ªç³»ç»Ÿçš„æœ€å¤§ç»“å°¾å…ƒç´ ï¼Œæ¯ä¸ª`w[i]`è¢«éå†åˆ°çš„æ—¶å€™éƒ½æ˜¯ä½œä¸ºæŸä¸€ä¸ªç³»ç»Ÿçš„ç»“å°¾ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šé¢ä¸´é€‰æ‹©ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è´ªå¿ƒçš„å°†å…¶æ”¾ç½®åˆ°**å¤§äº`w[i]`çš„æœ€å°çš„tailåé¢**ï¼Œè¿™æ ·é¿å…æµªè´¹å…¶ä»–è¾ƒå¤§çš„ç»“å°¾ï¼ˆç»“å°¾è¶Šå¤§ï¼Œåé¢å¯ä»¥æ¥çš„å¯¼å¼¹è¶Šå¤šï¼‰ï¼Œé€‰æ‹©æ¶ˆè€—ä¸€ä¸ªæœ€å°çš„ç»“å°¾ï¼Œå¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œä¸¾ä¸ªä¾‹å­å°±æ˜ç™½äº†\n![](https://i.loli.net/2020/11/23/VY6nU9oFuaB3GkO.png)\n\nè¿™é‡Œ1å°±é¢ä¸´ä¸¤ä¸ªé€‰æ‹©ï¼Œè¦ä¹ˆæ¥åœ¨2åé¢ï¼Œè¦ä¹ˆæ¥åœ¨4åé¢ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œåº”è¯¥æ¥åœ¨2åé¢ï¼Œå¦‚æœæ¥åœ¨3åé¢é‚£ä¹ˆåé¢çš„3å°±åªèƒ½æ–°å»ºä¸€ä¸ªç³»ç»Ÿï¼Œä¼šå¢åŠ ç³»ç»Ÿæ•°é‡\n\nå…·ä½“çš„è¯æ˜å¯ä»¥é‡‡ç”¨å¾®è°ƒæ³•ï¼Œè¯æ˜è´ªå¿ƒè§£æ˜¯å°äºç­‰äºæœ€ä¼˜è§£çš„ï¼Œè¿™é‡Œä¸å†å±•å¼€\n```java\n//9 8 7 9 8 7 9 8 7 55 66 99 88 77 88 963 365 4561\n//åŒè´ªå¿ƒå†™æ³•\npublic static int[] solve2(int[] w, int N){\n    int[] res = new int[2];\n    //é•¿åº¦ä¸ºiçš„æœ€é•¿ä¸‹é™å­åºåˆ—çš„æœ€å°ç»“å°¾\n    int[] tail = new int[N];\n    int len = 0;\n    //æœ€é•¿ä¸‹é™å­åºåˆ—ï¼ˆä¸ä¸¥æ ¼ï¼‰\n    for (int i = 0; i < w.length; i++) {\n        //æ‰¾tailä¸­ç¬¬ä¸€ä¸ªå°äºw[i]çš„æ›¿æ¢æ‰ï¼Œè¿™æ ·åé¢å¯ä»¥æ¥æ›´å¤šçš„æ•°\n        //å¯ä»¥äºŒåˆ†ä¼˜åŒ–ä¸‹ï¼Œè¿™é‡Œå°±ä¸å†™äº†\n        int idx;\n        for (idx = 0; idx < len; idx++) {\n            if (tail[idx] < w[i]) {\n                break;\n            }\n        }\n        tail[idx] = w[i];\n        len += (idx == len) ? 1 : 0;\n    }\n    res[0] = len;\n    tail = new int[N];\n    len = 0;\n    //æœ€å°‘è¦†ç›–å…¨åºåˆ—çš„ä¸‹é™å­åºåˆ—ä¸ªæ•°\n    for (int i = 0; i < w.length; i++) {\n        //æ‰¾tailä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºw[i]çš„æ›¿æ¢æ‰\n        //å¯ä»¥äºŒåˆ†ä¼˜åŒ–ä¸‹ï¼Œè¿™é‡Œå°±ä¸å†™äº†\n        int idx;\n        for (idx = 0; idx < len; idx++) {\n            if (tail[idx] >= w[i]) {\n                break;\n            }\n        }\n        tail[idx] = w[i];\n        len += (idx == len) ? 1 : 0;\n    }\n    res[1] = len;\n    return res;\n}\n```\n\n## [187. å¯¼å¼¹é˜²å¾¡ç³»ç»Ÿ](https://www.acwing.com/problem/content/189/)\n\nä¸ºäº†å¯¹æŠ—é™„è¿‘æ¶æ„å›½å®¶çš„å¨èƒï¼ŒRå›½æ›´æ–°äº†ä»–ä»¬çš„å¯¼å¼¹é˜²å¾¡ç³»ç»Ÿã€‚\n\nä¸€å¥—é˜²å¾¡ç³»ç»Ÿçš„å¯¼å¼¹æ‹¦æˆªé«˜åº¦è¦ä¹ˆä¸€ç›´ ä¸¥æ ¼å•è°ƒ ä¸Šå‡è¦ä¹ˆä¸€ç›´ ä¸¥æ ¼å•è°ƒ ä¸‹é™ã€‚\n\nä¾‹å¦‚ï¼Œä¸€å¥—ç³»ç»Ÿå…ˆåæ‹¦æˆªäº†é«˜åº¦ä¸º3å’Œé«˜åº¦ä¸º4çš„ä¸¤å‘å¯¼å¼¹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¯¥ç³»ç»Ÿå°±åªèƒ½æ‹¦æˆªé«˜åº¦å¤§äº4çš„å¯¼å¼¹ã€‚\n\nç»™å®šå³å°†è¢­æ¥çš„ä¸€ç³»åˆ—å¯¼å¼¹çš„é«˜åº¦ï¼Œè¯·ä½ æ±‚å‡ºè‡³å°‘éœ€è¦å¤šå°‘å¥—é˜²å¾¡ç³»ç»Ÿï¼Œå°±å¯ä»¥å°†å®ƒä»¬å…¨éƒ¨å‡»è½ã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nè¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚\n\nå¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•°nï¼Œè¡¨ç¤ºæ¥è¢­å¯¼å¼¹æ•°é‡ã€‚\n\nç¬¬äºŒè¡ŒåŒ…å«nä¸ªä¸åŒçš„æ•´æ•°ï¼Œè¡¨ç¤ºæ¯ä¸ªå¯¼å¼¹çš„é«˜åº¦ã€‚\n\nå½“è¾“å…¥æµ‹è¯•ç”¨ä¾‹n=0æ—¶ï¼Œè¡¨ç¤ºè¾“å…¥ç»ˆæ­¢ï¼Œä¸”è¯¥ç”¨ä¾‹æ— éœ€å¤„ç†ã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nå¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¾“å‡ºä¸€ä¸ªå æ®ä¸€è¡Œçš„æ•´æ•°ï¼Œè¡¨ç¤ºæ‰€éœ€çš„é˜²å¾¡ç³»ç»Ÿæ•°é‡ã€‚\n\n**æ•°æ®èŒƒå›´**ï¼š 1â‰¤nâ‰¤50\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```java\n5\n3 5 2 4 1\n0 \n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n\n```java\n2\næ ·ä¾‹è§£é‡Š\nå¯¹äºç»™å‡ºæ ·ä¾‹ï¼Œæœ€å°‘éœ€è¦ä¸¤å¥—é˜²å¾¡ç³»ç»Ÿã€‚\n\nä¸€å¥—å‡»è½é«˜åº¦ä¸º3,4çš„å¯¼å¼¹ï¼Œå¦ä¸€å¥—å‡»è½é«˜åº¦ä¸º5,2,1çš„å¯¼å¼¹ã€‚\n```\n\n### è§£æ³•ä¸€\n\næœç´¢ + è´ªå¿ƒå‰ªæï¼Œæœç´¢çš„å¤æ‚åº¦æ˜¯O(N*2^N)ï¼Œæ¯ä¸ªä½ç½®æœ‰ä¸¤ç§é€‰æ‹©ï¼Œæ¯æ¬¡é€‰æ‹©éƒ½éœ€è¦éå†upæˆ–è€…downï¼Œè™½ç„¶æ—¶é—´å¤æ‚åº¦å¾ˆé«˜ï¼Œä½†æ˜¯æ•´ä½“çš„ç»“æœæ¯”è¾ƒå°ï¼Œæ‰€ä»¥å¾ˆå¤šæƒ…å†µéƒ½è¢«å‰ªæ‰äº†ï¼Œæ•´ä½“é€Ÿåº¦è¿˜ä¸é”™\n```java\nimport java.util.*;\nimport java.io.*;\n//1. è€ƒè™‘æ¯ä¸ªç‚¹æ˜¯åœ¨ä¸Šå‡åºåˆ—ä¸­è¿˜æ˜¯ä¸‹é™åºåˆ—ä¸­\n//2. è€ƒè™‘æ˜¯å¦éœ€è¦æ–°å»ºä¸€ä¸ªå•ç‹¬çš„åºåˆ—\nclass Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        while (sc.hasNext()) {\n            int N = sc.nextInt();\n            if (N == 0) return;\n            int[] w = new int[N];\n            up = new int[N];\n            down = new int[N];\n            res = Integer.MAX_VALUE;\n            for (int i = 0; i < N; i++) {\n                w[i] = sc.nextInt();\n            }\n            dfs(w, 0, 0, 0);\n            System.out.println(res);\n        }\n    }\n\n    static int[] up = null;\n    static int[] down = null;\n    static int res;\n\n    public static void dfs(int[] w, int c, int ul, int dl) {\n        //å…³é”®çš„å‰ªæ\n        if (ul+dl >= res) return;\n        if (c == w.length) {\n            res = Math.min(ul+dl, res);\n            return;\n        }\n        //å°†cæ”¾åœ¨ä¸Šå‡åºåˆ—ä¸­\n        boolean flag = false;\n        for (int i = 0; i < ul; i++) {\n            if (up[i] > w[c]) {\n                flag = true;\n                int temp = up[i];\n                up[i] = w[c];\n                dfs(w, c+1, ul, dl);\n                up[i] = temp;\n                break;\n            }\n        }\n        if (!flag) {\n            up[ul] = w[c];\n            dfs(w, c+1, ul+1, dl);\n            up[ul] = 0;\n        }\n        flag = false;\n        for (int i = 0; i < dl; i++) {\n            if (down[i] < w[c]) {\n                flag = true;\n                int temp = down[i];\n                down[i] = w[c];\n                dfs(w, c+1, ul, dl);\n                down[i] = temp;\n                break;\n            }\n        }\n        if (!flag) {\n            down[dl] = w[c];\n            dfs(w, c+1, ul, dl+1);\n            down[dl] = 0;\n        }\n    }\n}\n```\n\n### è§£æ³•äºŒ\n\nè¿­ä»£åŠ æ·±æœç´¢ï¼Œä»£ç ç®€åŒ–ï¼Œåœ¨è§£æ¯”è¾ƒå°çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¿™ç§æœç´¢æ–¹å¼æ‰¾æœ€å°å€¼ï¼Œç»“åˆäº†DFSå’ŒBFSçš„ä¼˜ç‚¹\n\n```java\npublic static void main(String[] args) {\n    Scanner sc = new Scanner(System.in);\n    while (sc.hasNext()) {\n        int N = sc.nextInt();\n        if (N == 0) return;\n        int[] w = new int[N];\n        up = new int[N];\n        down = new int[N];\n        res = Integer.MAX_VALUE;\n        for (int i = 0; i < N; i++) {\n            w[i] = sc.nextInt();\n        }\n        //dfs(w, 0, 0, 0);\n        int depth = 0;\n        while (!dfs(w, depth, 0, 0, 0)) {\n            depth++;\n        }\n        System.out.println(depth);\n    }\n}\n\nstatic int[] up = null;\nstatic int[] down = null;\n//è¿­ä»£åŠ æ·±ï¼ŒBFSç‰ˆçš„DFS\npublic static boolean dfs(int[] w, int depth, int c, int ul, int dl) {\n    if (ul+dl > depth) return false;\n    if (c == w.length) {\n        return true;\n    }\n    //å°†cæ”¾åœ¨ä¸Šå‡åºåˆ—ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°å°äºw[i]çš„æœ€å¤§çš„tail\n    int i = 0;\n    for (i = 0; i < ul; i++) {\n        if (up[i] < w[c]) break;\n    }\n    int temp = up[i];\n    up[i] = w[c];\n    if (i == ul) {\n        if (dfs(w, depth, c+1, ul+1, dl)) {\n            return true;      \n        }\n    } else if (dfs(w, depth, c+1, ul, dl)) {\n        return true;\n    }\n    up[i] = temp;\n    //å°†cæ”¾åœ¨ä¸‹é™åºåˆ—ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°å¤§äºw[i]çš„æœ€å°çš„tail\n    for (i = 0; i < dl; i++) {\n        if (down[i] > w[c]) break;\n    }\n    temp = down[i];\n    down[i] = w[c];\n    if (i == dl) {\n        if (dfs(w, depth, c+1, ul, dl+1)) {\n            return true;\n        }\n    } else {\n        if (dfs(w, depth, c+1, ul, dl)) {\n            return true;\n        }\n    }\n    down[i] = temp;\n    return false;\n}\n```\n\n## [272. æœ€é•¿å…¬å…±ä¸Šå‡å­åºåˆ—](https://www.acwing.com/problem/content/description/274/)\n\nç†Šå¤§å¦ˆçš„å¥¶ç‰›åœ¨å°æ²æ²çš„ç†é™¶ä¸‹å¼€å§‹ç ”ç©¶ä¿¡æ¯é¢˜ç›®ã€‚\n\nå°æ²æ²å…ˆè®©å¥¶ç‰›ç ”ç©¶äº†æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼Œå†è®©ä»–ä»¬ç ”ç©¶äº†æœ€é•¿å…¬å…±å­åºåˆ—ï¼Œç°åœ¨åˆè®©ä»–ä»¬ç ”ç©¶æœ€é•¿å…¬å…±ä¸Šå‡å­åºåˆ—äº†ã€‚\n\nå°æ²æ²è¯´ï¼Œå¯¹äºä¸¤ä¸ªæ•°åˆ—Aå’ŒBï¼Œå¦‚æœå®ƒä»¬éƒ½åŒ…å«ä¸€æ®µä½ç½®ä¸ä¸€å®šè¿ç»­çš„æ•°ï¼Œä¸”æ•°å€¼æ˜¯ä¸¥æ ¼é€’å¢çš„ï¼Œé‚£ä¹ˆç§°è¿™ä¸€æ®µæ•°æ˜¯ä¸¤ä¸ªæ•°åˆ—çš„å…¬å…±ä¸Šå‡å­åºåˆ—ï¼Œè€Œæ‰€æœ‰çš„å…¬å…±ä¸Šå‡å­åºåˆ—ä¸­æœ€é•¿çš„å°±æ˜¯æœ€é•¿å…¬å…±ä¸Šå‡å­åºåˆ—äº†ã€‚\n\nå¥¶ç‰›åŠæ‡‚ä¸æ‡‚ï¼Œå°æ²æ²è¦ä½ æ¥å‘Šè¯‰å¥¶ç‰›ä»€ä¹ˆæ˜¯æœ€é•¿å…¬å…±ä¸Šå‡å­åºåˆ—ã€‚\n\nä¸è¿‡ï¼Œåªè¦å‘Šè¯‰å¥¶ç‰›å®ƒçš„é•¿åº¦å°±å¯ä»¥äº†ã€‚\n\næ•°åˆ—Aå’ŒBçš„é•¿åº¦å‡ä¸è¶…è¿‡3000ã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°Nï¼Œè¡¨ç¤ºæ•°åˆ—Aï¼ŒBçš„é•¿åº¦ã€‚\n\nç¬¬äºŒè¡ŒåŒ…å«Nä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•°åˆ—Aã€‚\n\nç¬¬ä¸‰è¡ŒåŒ…å«Nä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•°åˆ—Bã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€é•¿å…¬å…±ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚\n\n**æ•°æ®èŒƒå›´**\n\n1â‰¤Nâ‰¤3000, åºåˆ—ä¸­çš„æ•°å­—å‡ä¸è¶…è¿‡2^31âˆ’1\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```go\n4\n2 2 1 3\n2 1 2 3\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```go\n2\n```\n\n### è§£æ³•ä¸€\n\næœ´ç´ çš„è§£æ³•åº”è¯¥è‡ªå·±æƒ³å‡ºæ¥çš„ï¼Œå¯æƒœï¼Œæ²¡æƒ³å‡ºæ¥ï¼Œçœ‹äº†è§£ç­”æ‰ç†è§£ï¼Œè¿™é‡Œ`dp[i][j]` æ˜¯æŒ‡**Aåºåˆ—çš„å‰iä¸ªå­—ç¬¦å’ŒBçš„å‰jä¸ªå­—ç¬¦ç»„æˆçš„ï¼Œä»¥`B[j]`ç»“å°¾çš„æœ€é•¿å…¬å…±ä¸Šå‡å­åºåˆ—é•¿åº¦**ï¼Œå®é™…ä¸Šæ˜¯lcsä¸ªlisçš„å®Œç¾ç»“åˆï¼Œå› ä¸ºçŠ¶æ€å®šä¹‰æŒ‡å®šäº†`B[j]`æ˜¯ä¸€å®šè¦åŒ…å«çš„ï¼Œæ‰€ä»¥ç›¸æ¯”LCSçš„å››ç§æƒ…å†µï¼Œè¿™é‡Œåªæœ‰ä¸¤ç§æƒ…å†µï¼ŒåŒ…å«æˆ–è€…ä¸åŒ…å«`A[i]`\n- ä¸åŒ…å«A[i]é‚£ä¹ˆçŠ¶æ€å°±æ˜¯`dp[i-1][j]`; \n- å¦‚æœè¦åŒ…å«A[i]ï¼Œé‚£ä¹ˆ`A[i]`å¿…é¡»ç­‰äº`B[j]`ï¼Œå¦åˆ™å°±æ²¡æœ‰è€ƒè™‘çš„æ„ä¹‰ï¼Œç„¶åæˆ‘ä»¬æŒ‰ç…§LISçš„æ–¹æ³•å»æ‰¾ä¸€ä¸ªæœ€å¤§å€¼å°±okäº†\n\næ—¶é—´å¤æ‚åº¦N^3ï¼Œè¿™é‡ŒæŒ‰é“ç†æ˜¯ä¼šè¢«å¡æ‰çš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰...\n\n```java\nimport java.util.*;\nimport java.io.*;\nclass Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        int N = sc.nextInt();\n        int[] A = new int[N];\n        int[] B = new int[N];\n        for (int i = 0; i < N; i++) {\n            A[i] = sc.nextInt();\n        }\n        for (int i = 0; i < N; i++) {\n            B[i] = sc.nextInt();\n        }\n        System.out.println(solve(A, B, N));\n    }\n\n    public static int solve(int[] A, int[] B, int N){\n        //Aå‰iä¸ªå­—ç¬¦å’ŒBå‰jä¸ªå­—ç¬¦å¹¶ä¸”ä»¥B[j]ç»“å°¾çš„æœ€é•¿LCIS\n        int[][] dp = new int[N+1][N+1];\n        int res = 0;\n        for (int i = 1; i <= N; i++) {\n            for (int j = 1; j <= N; j++) {\n                dp[i][j] = dp[i-1][j];\n                if (A[i-1] == B[j-1]) {\n                    dp[i][j] = Math.max(dp[i][j], 1);\n                    for (int k = 1; k < j; k++) {\n                        if (B[j-1] > B[k-1]) {\n                            dp[i][j] = Math.max(dp[i][k]+1, dp[i][j]);\n                        }\n                    }\n                }\n                res = Math.max(res, dp[i][j]);\n            }\n        }\n        return res;\n    }\n}\n```\n\n### è§£æ³•äºŒ\nå¯¹ä¸Šé¢çš„è§£æ³•åšäº†ç­‰ä»·å˜å½¢ï¼Œé¦–å…ˆä¸Šé¢è§£æ³•å†…å¾ªç¯æ˜¯æ‰¾`[1,j-1]`åŒºé—´å†…`B[k]<B[j]`çš„æœ€å¤§å€¼ï¼ŒåŒæ—¶æ­¤æ—¶çš„`B[j]==A[i]`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€æ³¢ç­‰ä»·å˜å½¢ï¼ŒåŠ¨æ€çš„è®¡ç®—è¿™ä¸ªæœ€å¤§å€¼ï¼Œä»è€Œä¼˜åŒ–æ‰ä¸€å±‚å¾ªç¯ï¼Œè¿˜æ˜¯å¾ˆå·§å¦™çš„\n\n```java\n//ä»£ç ç­‰ä»·å˜å½¢ï¼Œæ—¶é—´å¤æ‚åº¦N^2\npublic static int solveOpt(int[] A, int[] B, int N){\n    //Aå‰iä¸ªå­—ç¬¦å’ŒBå‰jä¸ªå­—ç¬¦å¹¶ä¸”ä»¥B[j]ç»“å°¾çš„æœ€é•¿LCIS\n    int[][] dp = new int[N+1][N+1];\n    int res = 0;\n    for (int i = 1; i <= N; i++) {\n        int maxv = 1;\n        for (int j = 1; j <= N; j++) {\n            dp[i][j] = dp[i-1][j];\n            if (A[i-1] == B[j-1]) {\n                dp[i][j] = Math.max(dp[i][j], maxv);\n            }\n            if (B[j-1] < A[i-1]) {\n                maxv = Math.max(maxv, dp[i][j]+1);\n            }\n            res = Math.max(res, dp[i][j]);\n        }\n    }\n    return res;\n}\n```","tags":["ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"DPï¼šæ•°å­—ä¸‰è§’å½¢æ¨¡å‹","url":"/2020/11/09/dp-shu-zi-san-jiao-xing-mo-xing/","content":"\n\n> ç°åœ¨æ‰“ç®—å†™ä¸€äº›çŸ­ç‚¹çš„æ–‡ç« äº†ï¼ŒLeetCodeç³»åˆ—ä¸ä¼šå†appendäº†ï¼Œå¦‚æœå†™lcé¢˜ä¼šå•ç‹¬å¼€ä¸€ç¯‡æ–‡ç« ï¼Œç„¶åå†™é¢˜è§£\n\n## æ•°å­—ä¸‰è§’å½¢æ¨¡å‹\n\n[120. ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#120-%E4%B8%89%E8%A7%92%E5%BD%A2%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E5%92%8C)\n\n[64. æœ€å°è·¯å¾„å’Œ](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#64-%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E5%92%8C)\n\n[Path sum: three ways](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#Path-sum-three-ways)\n\nä¹‹å‰å†™è¿‡é¢˜è§£çš„å°±ä¸é‡å¤å†™äº†ï¼Œè¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„é¢˜å°±ä¸ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥äº†ï¼Œè¯¦è§[LeetCodeåŠ¨æ€è§„åˆ’](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/)\n\n> åç»­å¦‚æœè¿˜æœ‰ç±»ä¼¼çš„é¢˜ä¼šappendè¿›æ¥\n## [1027. æ–¹æ ¼å–æ•°](https://www.acwing.com/problem/content/1029/)\n\nè®¾æœ‰ NÃ—N çš„æ–¹æ ¼å›¾ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­çš„æŸäº›æ–¹æ ¼ä¸­å¡«å…¥æ­£æ•´æ•°ï¼Œè€Œå…¶å®ƒçš„æ–¹æ ¼ä¸­åˆ™æ”¾å…¥æ•°å­—0ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![](https://files.catbox.moe/hhonhx.png)\n\næŸäººä»å›¾ä¸­çš„å·¦ä¸Šè§’ A å‡ºå‘ï¼Œå¯ä»¥å‘ä¸‹è¡Œèµ°ï¼Œä¹Ÿå¯ä»¥å‘å³è¡Œèµ°ï¼Œç›´åˆ°åˆ°è¾¾å³ä¸‹è§’çš„ B ç‚¹ã€‚\n\nåœ¨èµ°è¿‡çš„è·¯ä¸Šï¼Œä»–å¯ä»¥å–èµ°æ–¹æ ¼ä¸­çš„æ•°ï¼ˆå–èµ°åçš„æ–¹æ ¼ä¸­å°†å˜ä¸ºæ•°å­—0ï¼‰ã€‚\n\næ­¤äººä» A ç‚¹åˆ° B ç‚¹å…±èµ°äº†ä¸¤æ¬¡ï¼Œè¯•æ‰¾å‡ºä¸¤æ¡è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å–å¾—çš„æ•°å­—å’Œä¸ºæœ€å¤§ã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ•´æ•°Nï¼Œè¡¨ç¤º NÃ—N çš„æ–¹æ ¼å›¾ã€‚\n\næ¥ä¸‹æ¥çš„æ¯è¡Œæœ‰ä¸‰ä¸ªæ•´æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºè¡Œå·æ•°ï¼Œç¬¬äºŒä¸ªä¸ºåˆ—å·æ•°ï¼Œç¬¬ä¸‰ä¸ªä¸ºåœ¨è¯¥è¡Œã€è¯¥åˆ—ä¸Šæ‰€æ”¾çš„æ•°ã€‚\n\nè¡Œå’Œåˆ—ç¼–å·ä» 1 å¼€å§‹ã€‚\n\nä¸€è¡Œâ€œ0 0 0â€è¡¨ç¤ºç»“æŸã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸¤æ¡è·¯å¾„ä¸Šå–å¾—çš„æœ€å¤§çš„å’Œã€‚\n\n**æ•°æ®èŒƒå›´**\n\nNâ‰¤10\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n8\n2 3 13\n2 6 6\n3 5 7\n4 4 14\n5 2 21\n5 6 4\n6 3 15\n7 2 14\n0 0 0\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```c\n67\n```\n**éš¾åº¦ï¼š** ç®€å•\n\n**æ¥æºï¼š**ã€Šä¿¡æ¯å­¦å¥¥èµ›ä¸€æœ¬é€šã€‹ , NOIP2000æé«˜ç»„\n\n### è§£æ³•ä¸€\n\nä¸€å¼€å§‹ç¡®å®æ²¡æƒ³å‡ºæ¥ï¼Œä¸»è¦æ˜¯çœ‹ç€èŒƒå›´å¥½å°ï¼Œç„¶åä¸ç¡®å®šå¤æ‚åº¦ï¼Œä»¥ä¸ºå¯ä»¥æœç´¢çš„ï¼Œçœ‹äº†yæ€»è®²è§£äº†ä¸€ç‚¹ï¼Œç„¶åæƒ³è¿‡æ¥äº†ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªN^4çš„è§£æ³•\n```java\n//input outputçœç•¥\n//N^4 dp\npublic static int slove(int[][] w, int N) {\n    int[][][][] dp = new int[N+1][N+1][N+1][N+1];\n    for (int i1 = 1; i1 <= N; i1++) {\n        for (int j1 = 1; j1 <= N; j1++) {\n            for (int i2 = 1; i2 <= N; i2++) {\n                for (int j2 = 1; j2 <= N; j2++) {\n                    int temp = dp[i1][j1][i2][j2];\n                    temp = Math.max(temp, dp[i1-1][j1][i2-1][j2]);\n                    temp = Math.max(temp, dp[i1-1][j1][i2][j2-1]);\n                    temp = Math.max(temp, dp[i1][j1-1][i2-1][j2]);\n                    temp = Math.max(temp, dp[i1][j1-1][i2][j2-1]);\n                    dp[i1][j1][i2][j2] = temp + ((i1==i2&&j1==j2) ? w[i1-1][j1-1] : (w[i1-1][j1-1] + w[i2-1][j2-1])); \n                }\n            }\n        }\n    }\n    return dp[N][N][N][N];\n}\n```\nå…¶å®å¦‚æœæ˜¯åªæœ‰ä¸€æ¡è·¯å¾„å°±å¾ˆç®€å•ï¼Œçº¿æ€§DPå°±è¡Œäº†ï¼Œ`dp[i][j] = Max(dp[i-1][j], dp[i][j-1])`ï¼Œä½†æ˜¯è¿™é¢˜æ¶‰åŠåˆ°äº†ä¸¤æ¡è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€å®šä¹‰ä¸º`dp[i1][j1][i2][j2]`ï¼Œå«ä¹‰ä¸ºä»ï¼ˆ1ï¼Œ1ï¼‰åˆ°ï¼ˆi1ï¼Œj1ï¼‰,(i2ï¼Œj2)è¿™ä¸¤ä¸ªç‚¹çš„æœ€å¤§å’Œï¼Œåˆ°æ¯ä¸ªç‚¹æœ‰ä¸¤ç§èµ°æ³•ï¼Œ2*2ä¸€å…±4ç§å­çŠ¶æ€ï¼Œå–Maxå°±è¡Œäº†\n\nä½†æ˜¯è¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæŸä¸ªç‚¹çš„valè¢«å–èµ°ä¹‹åå°±ä¸èƒ½å†è¢«å–äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸¤æ¡è·¯å¾„å¯èƒ½ä¼šæœ‰äº¤ç‚¹ï¼Œè¿™ç§æƒ…å†µéœ€è¦é¢å¤–å¤„ç†ï¼Œè€Œç›¸äº¤çš„æƒ…å†µå®é™…ä¸Šä¹Ÿå°±æ˜¯`i1==i2 && j1 == j2`çš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µäº¤ç‚¹çš„å€¼å°±åªèƒ½ç®—ä¸€æ¬¡\n\n### è§£æ³•äºŒ\n\nyæ€»è®²çš„è§£æ³•ï¼Œä¼˜åŒ–äº†ä¸€ç»´çŠ¶æ€ï¼ŒN^3çš„è§£æ³•ï¼Œéå¸¸çš„å·§å¦™ï¼Œå› ä¸ºåªèƒ½å‘ä¸‹å’Œå‘å³èµ°ï¼Œæ‰€ä»¥ä»ï¼ˆ1ï¼Œ1ï¼‰åˆ°ï¼ˆN-1ï¼ŒN-1ï¼‰ï¼Œèµ°çš„æ€»æ­¥æ•°ä¸€å®šæ˜¯`2*N`ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ­¥æ•°Kè®¡ç®—å‡ºå¦ä¸€ä¸ªåæ ‡ï¼Œä»è€Œçœå»ä¸€ç»´çŠ¶æ€\n\n```java\n//N^3ä¼˜åŒ–ï¼Œæ ¹æ®èµ°çš„æ€»æ­¥æ•°è®¡ç®—å¦ä¸€ä¸ªåæ ‡ä½ç½®\npublic static int slove2(int[][] w, int N) {\n    int[][][] dp = new int[2*N+1][N+1][N+1];\n    for (int k = 2; k <= 2*N; k++) {\n        for (int i1 = 1; i1 <= N; i1++) {\n            for (int i2 = 1; i2 <= N; i2++) {\n                int j1 = k-i1, j2 = k-i2;\n                if (1 <= j1 && j1 <= N && 1 <= j2 && j2 <= N) {\n                    int temp = dp[k][i1][i2]; \n                    temp = Math.max(temp, dp[k-1][i1-1][i2-1]);\n                    temp = Math.max(temp, dp[k-1][i1-1][i2]);\n                    temp = Math.max(temp, dp[k-1][i1][i2-1]);\n                    temp = Math.max(temp, dp[k-1][i1][i2]);\n                    dp[k][i1][i2] = temp + ((i1==i2&&j1==j2) ? w[i1-1][j1-1] : (w[i1-1][j1-1] + w[i2-1][j2-1]));     \n                }\n            }\n        }\n    }\n    return dp[2*N][N][N];\n}\n```\n## [275. ä¼ çº¸æ¡](https://www.acwing.com/problem/content/277/)\n\nå°æ¸Šå’Œå°è½©æ˜¯å¥½æœ‹å‹ä¹Ÿæ˜¯åŒç­åŒå­¦ï¼Œä»–ä»¬åœ¨ä¸€èµ·æ€»æœ‰è°ˆä¸å®Œçš„è¯é¢˜ã€‚\n\nä¸€æ¬¡ç´ è´¨æ‹“å±•æ´»åŠ¨ä¸­ï¼Œç­ä¸ŠåŒå­¦å®‰æ’åæˆä¸€ä¸ª m è¡Œ n åˆ—çš„çŸ©é˜µï¼Œè€Œå°æ¸Šå’Œå°è½©è¢«å®‰æ’åœ¨çŸ©é˜µå¯¹è§’çº¿çš„ä¸¤ç«¯ï¼Œå› æ­¤ï¼Œä»–ä»¬å°±æ— æ³•ç›´æ¥äº¤è°ˆäº†ã€‚\n\nå¹¸è¿çš„æ˜¯ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡ä¼ çº¸æ¡æ¥è¿›è¡Œäº¤æµã€‚\n\nçº¸æ¡è¦ç»ç”±è®¸å¤šåŒå­¦ä¼ åˆ°å¯¹æ–¹æ‰‹é‡Œï¼Œå°æ¸Šååœ¨çŸ©é˜µçš„å·¦ä¸Šè§’ï¼Œåæ ‡(1,1)ï¼Œå°è½©ååœ¨çŸ©é˜µçš„å³ä¸‹è§’ï¼Œåæ ‡(m,n)ã€‚\n\nä»å°æ¸Šä¼ åˆ°å°è½©çš„çº¸æ¡åªå¯ä»¥å‘ä¸‹æˆ–è€…å‘å³ä¼ é€’ï¼Œä»å°è½©ä¼ ç»™å°æ¸Šçš„çº¸æ¡åªå¯ä»¥å‘ä¸Šæˆ–è€…å‘å·¦ä¼ é€’ã€‚â€‚\n\nåœ¨æ´»åŠ¨è¿›è¡Œä¸­ï¼Œå°æ¸Šå¸Œæœ›ç»™å°è½©ä¼ é€’ä¸€å¼ çº¸æ¡ï¼ŒåŒæ—¶å¸Œæœ›å°è½©ç»™ä»–å›å¤ã€‚\n\nç­é‡Œæ¯ä¸ªåŒå­¦éƒ½å¯ä»¥å¸®ä»–ä»¬ä¼ é€’ï¼Œä½†åªä¼šå¸®ä»–ä»¬ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ­¤äººåœ¨å°æ¸Šé€’ç»™å°è½©çº¸æ¡çš„æ—¶å€™å¸®å¿™ï¼Œé‚£ä¹ˆåœ¨å°è½©é€’ç»™å°æ¸Šçš„æ—¶å€™å°±ä¸ä¼šå†å¸®å¿™ï¼Œåä¹‹äº¦ç„¶ã€‚â€‚\n\nè¿˜æœ‰ä¸€ä»¶äº‹æƒ…éœ€è¦æ³¨æ„ï¼Œå…¨ç­æ¯ä¸ªåŒå­¦æ„¿æ„å¸®å¿™çš„å¥½æ„Ÿåº¦æœ‰é«˜æœ‰ä½ï¼ˆæ³¨æ„ï¼šå°æ¸Šå’Œå°è½©çš„å¥½å¿ƒç¨‹åº¦æ²¡æœ‰å®šä¹‰ï¼Œè¾“å…¥æ—¶ç”¨0è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥ç”¨ä¸€ä¸ª0-100çš„è‡ªç„¶æ•°æ¥è¡¨ç¤ºï¼Œæ•°è¶Šå¤§è¡¨ç¤ºè¶Šå¥½å¿ƒã€‚\n\nå°æ¸Šå’Œå°è½©å¸Œæœ›å°½å¯èƒ½æ‰¾å¥½å¿ƒç¨‹åº¦é«˜çš„åŒå­¦æ¥å¸®å¿™ä¼ çº¸æ¡ï¼Œå³æ‰¾åˆ°æ¥å›ä¸¤æ¡ä¼ é€’è·¯å¾„ï¼Œä½¿å¾—è¿™ä¸¤æ¡è·¯å¾„ä¸ŠåŒå­¦çš„å¥½å¿ƒç¨‹åº¦ä¹‹å’Œæœ€å¤§ã€‚\n\nç°åœ¨ï¼Œè¯·ä½ å¸®åŠ©å°æ¸Šå’Œå°è½©æ‰¾åˆ°è¿™æ ·çš„ä¸¤æ¡è·¯å¾„ã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nç¬¬ä¸€è¡Œæœ‰2ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ•´æ•° m å’Œ nï¼Œè¡¨ç¤ºå­¦ç”ŸçŸ©é˜µæœ‰ m è¡Œ n åˆ—ã€‚\n\næ¥ä¸‹æ¥çš„ m è¡Œæ˜¯ä¸€ä¸ª mâˆ—n çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­ç¬¬ i è¡Œ j åˆ—çš„æ•´æ•°è¡¨ç¤ºååœ¨ç¬¬ i è¡Œ j åˆ—çš„å­¦ç”Ÿçš„å¥½å¿ƒç¨‹åº¦ï¼Œæ¯è¡Œçš„ n ä¸ªæ•´æ•°ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ¥å›ä¸¤æ¡è·¯ä¸Šå‚ä¸ä¼ é€’çº¸æ¡çš„å­¦ç”Ÿçš„å¥½å¿ƒç¨‹åº¦ä¹‹å’Œçš„æœ€å¤§å€¼ã€‚\n\n**æ•°æ®èŒƒå›´:**\n\n1â‰¤n,mâ‰¤50\n\n**è¾“å…¥æ ·ä¾‹ï¼š**\n```c\n3 3\n0 3 9\n2 8 5\n5 7 0\n```\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n```c\n34\n```\n### è§£æ³•ä¸€\n\nå’Œä¸Šé¢ä¸€é¢˜ä¸€æ ·ï¼Œè™½ç„¶é¢˜ç›®è¯´çš„æ˜¯ä¸€ä¸ªä»å·¦ä¸Šå‘å³ä¸‹ï¼Œä¸€ä¸ªæ˜¯ä»å³ä¸‹åˆ°å·¦ä¸Šï¼Œä½†æ˜¯å®é™…ä¸Šä¾ç„¶æ˜¯è¦æ±‚ä¸¤æ¡è·¯å¾„è¿æ¥å·¦ä¸Šåˆ°å³ä¸‹ï¼Œä½¿å¾—å’Œæœ€å¤§ï¼Œæ‰€ä»¥å®é™…ä¸Šç›´æ¥ç…§æ¬ä¸Šé¢çš„ä»£ç å°±okäº†\n\n```java\n//N^3\npublic static int solve(int[][] w, int m, int n){\n    int[][][] dp = new int[m+n+1][m+1][m+1];\n    for (int k = 2; k <= m+n; k++) {\n        for (int i1 = 1; i1 <= m; i1++) {\n            for (int i2 = 1; i2 <= m; i2++) {\n                int j1 = k - i1, j2 = k - i2;\n                if (j1 < 1 || j1 > n || j2 < 1 || j2 > n) continue;\n                int temp = dp[k][i1][i2]; \n                temp = Math.max(temp, dp[k-1][i1-1][i2]);\n                temp = Math.max(temp, dp[k-1][i1][i2-1]);\n                temp = Math.max(temp, dp[k-1][i1][i2]);\n                temp = Math.max(temp, dp[k-1][i1-1][i2-1]);\n                dp[k][i1][i2] = temp + (i1==i2 ? w[i1-1][j1-1] : (w[i1-1][j1-1] + w[i2-1][j2-1]));\n            }\n        }\n    }\n    return dp[m+n][m][m];\n}\n```\n\n## [1463. æ‘˜æ¨±æ¡ƒ II](https://leetcode-cn.com/problems/cherry-pickup-ii/)\n\nDifficulty: **å›°éš¾**\n\nç»™ä½ ä¸€ä¸ªÂ `rows x cols` çš„çŸ©é˜µÂ `grid`Â æ¥è¡¨ç¤ºä¸€å—æ¨±æ¡ƒåœ°ã€‚ `grid`Â ä¸­æ¯ä¸ªæ ¼å­çš„æ•°å­—è¡¨ç¤ºä½ èƒ½è·å¾—çš„æ¨±æ¡ƒæ•°ç›®ã€‚\n\nä½ æœ‰ä¸¤ä¸ªæœºå™¨äººå¸®ä½ æ”¶é›†æ¨±æ¡ƒï¼Œæœºå™¨äºº 1 ä»å·¦ä¸Šè§’æ ¼å­ `(0,0)` å‡ºå‘ï¼Œæœºå™¨äºº 2 ä»å³ä¸Šè§’æ ¼å­ `(0, cols-1)` å‡ºå‘ã€‚\n\nè¯·ä½ æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ï¼Œè¿”å›ä¸¤ä¸ªæœºå™¨äººèƒ½æ”¶é›†çš„æœ€å¤šæ¨±æ¡ƒæ•°ç›®ï¼š\n\n*   ä»æ ¼å­Â `(i,j)` å‡ºå‘ï¼Œæœºå™¨äººå¯ä»¥ç§»åŠ¨åˆ°æ ¼å­Â `(i+1, j-1)`ï¼Œ`(i+1, j)` æˆ–è€…Â `(i+1, j+1)`Â ã€‚\n*   å½“ä¸€ä¸ªæœºå™¨äººç»è¿‡æŸä¸ªæ ¼å­æ—¶ï¼Œå®ƒä¼šæŠŠè¯¥æ ¼å­å†…æ‰€æœ‰çš„æ¨±æ¡ƒéƒ½æ‘˜èµ°ï¼Œç„¶åè¿™ä¸ªä½ç½®ä¼šå˜æˆç©ºæ ¼å­ï¼Œå³æ²¡æœ‰æ¨±æ¡ƒçš„æ ¼å­ã€‚\n*   å½“ä¸¤ä¸ªæœºå™¨äººåŒæ—¶åˆ°è¾¾åŒä¸€ä¸ªæ ¼å­æ—¶ï¼Œå®ƒä»¬ä¸­åªæœ‰ä¸€ä¸ªå¯ä»¥æ‘˜åˆ°æ¨±æ¡ƒã€‚\n*   ä¸¤ä¸ªæœºå™¨äººåœ¨ä»»æ„æ—¶åˆ»éƒ½ä¸èƒ½ç§»åŠ¨åˆ° `grid`Â å¤–é¢ã€‚\n*   ä¸¤ä¸ªæœºå™¨äººæœ€åéƒ½è¦åˆ°è¾¾Â `grid`Â æœ€åº•ä¸‹ä¸€è¡Œã€‚\n\n\nç»™ä½ ä¸€ä¸ªÂ rows x cols çš„çŸ©é˜µÂ gridÂ æ¥è¡¨ç¤ºä¸€å—æ¨±æ¡ƒåœ°ã€‚ gridÂ ä¸­æ¯ä¸ªæ ¼å­çš„æ•°å­—è¡¨ç¤ºä½ èƒ½è·å¾—çš„æ¨±æ¡ƒæ•°ç›®ã€‚\n\nä½ æœ‰ä¸¤ä¸ªæœºå™¨äººå¸®ä½ æ”¶é›†æ¨±æ¡ƒï¼Œæœºå™¨äºº 1 ä»å·¦ä¸Šè§’æ ¼å­ (0,0) å‡ºå‘ï¼Œæœºå™¨äºº 2 ä»å³ä¸Šè§’æ ¼å­ (0, cols-1) å‡ºå‘ã€‚\n\nè¯·ä½ æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ï¼Œè¿”å›ä¸¤ä¸ªæœºå™¨äººèƒ½æ”¶é›†çš„æœ€å¤šæ¨±æ¡ƒæ•°ç›®ï¼š\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![](https://files.catbox.moe/da5rxh.png)\n```java\nè¾“å…¥ï¼šgrid = [[3,1,1],[2,5,1],[1,5,5],[2,1,1]]\nè¾“å‡ºï¼š24\nè§£é‡Šï¼šæœºå™¨äºº 1 å’Œæœºå™¨äºº 2 çš„è·¯å¾„åœ¨ä¸Šå›¾ä¸­åˆ†åˆ«ç”¨ç»¿è‰²å’Œè“è‰²è¡¨ç¤ºã€‚\næœºå™¨äºº 1 æ‘˜çš„æ¨±æ¡ƒæ•°ç›®ä¸º (3 + 2 + 5 + 2) = 12 ã€‚\næœºå™¨äºº 2 æ‘˜çš„æ¨±æ¡ƒæ•°ç›®ä¸º (1 + 5 + 5 + 1) = 12 ã€‚\næ¨±æ¡ƒæ€»æ•°ä¸ºï¼š 12 + 12 = 24 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![](https://i.loli.net/2020/11/10/aSykAceXPH1snjM.png)\n```java\nè¾“å…¥ï¼šgrid = [[1,0,0,0,0,0,1],[2,0,0,0,0,3,0],[2,0,9,0,0,0,0],[0,3,0,5,4,0,0],[1,0,2,3,0,0,6]]\nè¾“å‡ºï¼š28\nè§£é‡Šï¼šæœºå™¨äºº 1 å’Œæœºå™¨äºº 2 çš„è·¯å¾„åœ¨ä¸Šå›¾ä¸­åˆ†åˆ«ç”¨ç»¿è‰²å’Œè“è‰²è¡¨ç¤ºã€‚\næœºå™¨äºº 1 æ‘˜çš„æ¨±æ¡ƒæ•°ç›®ä¸º (1 + 9 + 5 + 2) = 17 ã€‚\næœºå™¨äºº 2 æ‘˜çš„æ¨±æ¡ƒæ•°ç›®ä¸º (1 + 3 + 4 + 3) = 11 ã€‚\næ¨±æ¡ƒæ€»æ•°ä¸ºï¼š 17 + 11 = 28 ã€‚\n```\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šgrid = [[1,0,0,3],[0,0,0,3],[0,0,3,3],[9,0,3,3]]\nè¾“å‡ºï¼š22\n```\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šgrid = [[1,1],[1,1]]\nè¾“å‡ºï¼š4\n```\n\n**æç¤ºï¼š**\n\n- rows == grid.length\n- cols == grid[i].length\n- 2 <= rows, cols <= 70\n- 0 <= grid[i][j] <= 100Â \n\n\n### è§£æ³•ä¸€\n\næœ¬æ¥åªå†™äº†å‰ä¸¤é¢˜å°±æ‰“ç®—pushçš„ï¼Œyæ€»ä¹Ÿåªè®²äº†è¿™å‡ é“é¢˜ï¼Œä½†æ˜¯çªç„¶æƒ³èµ·æ¥å¾ˆä¹…ä¹‹å‰çš„ä¸€é“å‘¨èµ›é¢˜ï¼ˆ27thåŒå‘¨èµ›T4ï¼‰ï¼Œå¤§æ¦‚åŠå¹´å‰äº†ï¼Œæ²¡æƒ³åˆ°å±…ç„¶èƒ½æƒ³èµ·æ¥ğŸ˜„ï¼Œçœ‹äº†ä¸‹ï¼Œå’Œä¸Šé¢ä¸¤é¢˜æ˜¯ä¸€æ ·çš„ï¼Œéšæ‰‹å†™äº†ä¸‹ï¼Œä¸€å¼€å§‹å†™çš„æœ‰bugï¼Œè°ƒè¯•äº†å¥½ä¸€ä¼šå„¿ï¼Œæœ€åæŠŠçŠ¶æ€æ‰“å‡ºæ¥æ‰‹æ¨äº†ä¸‹ï¼Œå‘ç°æœ‰äº›çŠ¶æ€æ²¡æœ‰åˆå§‹åŒ–å¥½ï¼Œå¯¼è‡´é€’æ¨çš„æ—¶å€™ä½¿ç”¨äº†éæ³•çš„çŠ¶æ€\n\nå…ˆä¸Šæš´åŠ›N^4çš„è§£æ³•ï¼Œè¿™é¢˜èŒƒå›´ä¸å¤§ï¼ŒN^4å‹‰å¼ºèƒ½æ‰›è¿‡å»\n```java\n//æš´åŠ›N^4è§£æ³•\npublic int cherryPickup2(int[][] grid) {\n    int m = grid.length, n = grid[0].length;\n    int[][][][] dp = new int[m+1][n+2][m+1][n+2];\n    int INF = -0x3f3f3f3f;\n    for (int i1 = 0; i1 <= m; i1++) {\n        for (int j1 = 0; j1 <= n+1; j1++) {\n            for (int i2 = 0; i2 <= m; i2++) {\n                Arrays.fill(dp[i1][j1][i2], INF);\n            }\n        }\n    }\n    dp[1][1][1][n] = grid[0][0]+grid[0][n-1];\n    for (int i1 = 2; i1 <= m; i1++) {\n        for (int j1 = 1; j1 <= n; j1++) {\n            for (int i2 = 2; i2 <= m; i2++) {\n                for (int j2 = 1; j2 <= n; j2++) {\n                    int temp = INF;\n                    temp = Math.max(temp, dp[i1-1][j1][i2-1][j2]);\n                    temp = Math.max(temp, dp[i1-1][j1][i2-1][j2+1]);\n                    temp = Math.max(temp, dp[i1-1][j1][i2-1][j2-1]);\n                    \n                    temp = Math.max(temp, dp[i1-1][j1+1][i2-1][j2]);\n                    temp = Math.max(temp, dp[i1-1][j1+1][i2-1][j2+1]);\n                    temp = Math.max(temp, dp[i1-1][j1+1][i2-1][j2-1]);   \n                    \n                    temp = Math.max(temp, dp[i1-1][j1-1][i2-1][j2]);\n                    temp = Math.max(temp, dp[i1-1][j1-1][i2-1][j2+1]);   \n                    temp = Math.max(temp, dp[i1-1][j1-1][i2-1][j2-1]);\n                    dp[i1][j1][i2][j2] = temp + ((i1==i2&&j1==j2) ? grid[i1-1][j1-1] : (grid[i1-1][j1-1] + grid[i2-1][j2-1]));\n                }\n            }\n        }\n    }\n    int res = 0;\n    for (int j1 = 0; j1 <= n; j1++) {\n        for (int j2 = 0; j2 <= n; j2++) {\n            res = Math.max(res, dp[m][j1][m][j2]);   \n        }\n    }\n    return res;\n}\n```\n\n### è§£æ³•äºŒ\n\nå’Œä¸Šé¢ä¸¤é¢˜ä¸€æ ·ï¼Œä¸¤ä¸ªæœºå™¨äººèµ°çš„å±‚æ•°æ˜¯å›ºå®šçš„ï¼Œéƒ½æ˜¯må±‚ï¼Œæ‰€ä»¥å¯ä»¥ä¼˜åŒ–æ‰ä¸€ç»´çš„çŠ¶æ€ï¼ŒåŒæ—¶ä¸Šé¢çš„å†™æ³•çœ‹èµ·æ¥ä¹Ÿå¾ˆuglyï¼Œå¯ä»¥ç”¨æ–¹å‘å˜é‡ç®€åŒ–å†™æ³•\n\n```java\n//N^3è§£æ³•ï¼Œä¼˜åŒ–ä»£ç å†™æ³•ï¼Œç®€åŒ–ä»£ç \npublic int cherryPickup(int[][] grid) {\n    int[] dir = {1, -1, 0};\n    int m = grid.length, n = grid[0].length;\n    //è¿™é¢˜æ±‚æœ€å¤§å€¼ï¼Œåœ¨dpæ•°ç»„ä¸Šè¾¹å’Œå·¦å³ä¸¤è¾¹å„åŠ ä¸€è¡Œä½œä¸ºè¾¹ç•Œ\n    //è¿™é‡Œä¹Ÿå¯ä»¥ç”¨æ»šåŠ¨æ•°ç»„ä¼˜åŒ–ä¸‹ç©ºé—´\n    int[][][] dp = new int[m+1][n+2][n+2];\n    int INF = -0x3f3f3f3f;\n    //å…¨éƒ¨åˆå§‹åŒ–ä¸ºINFï¼ˆå®é™…ä¸Šåˆå§‹åŒ–ä¸¤è¾¹å’Œæœ€ä¸Šé¢çš„å°±okäº†ï¼‰\n    for (int r = 0; r <= m; r++) {\n        for (int j1 = 0; j1 <= n+1; j1++) {\n            Arrays.fill(dp[r][j1], INF);\n        }\n    }\n    dp[1][1][n] = grid[0][0] + grid[0][n-1];\n    for (int r = 2; r <= m; r++) {\n        for (int j1 = 1; j1 <= n; j1++) {\n            for (int j2 = 1; j2 <= n; j2++) {\n                //æ–¹å‘å‘é‡ï¼Œç®€åŒ–å†™æ³•\n                for (int d1 = 0; d1 < 3; d1++) {\n                    for (int d2 = 0; d2 < 3; d2++) {\n                        dp[r][j1][j2] = Math.max(dp[r][j1][j2], dp[r-1][j1+dir[d1]][j2+dir[d2]]);\n                    }\n                }\n                dp[r][j1][j2] += (j1==j2 ? grid[r-1][j1-1] : (grid[r-1][j1-1] + grid[r-1][j2-1]));\n            }\n        }\n    }\n    int res = 0;\n    for (int j1 = 0; j1 <= n; j1++) {\n        for (int j2 = 0; j2 <= n; j2++) {\n            res = Math.max(res, dp[m][j1][j2]);   \n        }\n    }\n    return res;\n}\n```","tags":["ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"Fucké¢è¯•","url":"/2020/09/04/fuck-mian-shi/","content":"\n# è‡ªæˆ‘ä»‹ç»\né¢è¯•å®˜æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ¹–åŒ—å¸ˆèŒƒå¤§å­¦17çº§åº”å±Šæœ¬ç§‘ç”Ÿæå›½å¨ï¼Œå¤§å­¦æ‰€å­¦ä¸“ä¸šæ˜¯è®¡ç®—æœºï¼Œä»å…¥æ ¡å°±å¼€å§‹è‡ªå­¦ç¼–ç¨‹ï¼Œå¤§äºŒåŠ å…¥äº†å­¦æ ¡çš„Jpluså®éªŒå®¤ï¼Œå‚ä¸äº†**æ•™å¸ˆå·¥ä½œé‡ç»Ÿè®¡ç³»ç»Ÿ**çš„å¼€å‘ä»¥åŠæ–°äººåŸ¹è®­å·¥ä½œï¼Œåé¢åˆè‡ªå­¦äº†Goè¯­è¨€ï¼Œç”¨Goè¯­è¨€å†™äº†ä¸¤ä¸ªç»ƒæ‰‹é¡¹ç›®ï¼Œä¸€ä¸ªæ˜¯æ¨¡ä»¿Googleå¼€æºçš„GroupCacheå®ç°çš„ä¸€ä¸ª**åˆ†å¸ƒå¼ç¼“å­˜åº“**ï¼Œå¹¶ä¸”å¯¹åŸé¡¹ç›®çƒ­å¤‡åŠŸèƒ½åšäº†å¢å¼ºï¼Œä»£ç å¼€æºåœ¨Githubå¹³å°ï¼Œå¦ä¸€ä¸ªæ˜¯**åˆ†å¸ƒå¼çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ**ï¼Œé€šè¿‡åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œä»»åŠ¡ä¿å­˜åœ¨etcdé›†ç¾¤ä¸­ï¼Œå¹¶å‘çš„è°ƒåº¦cronå®šæ—¶ä»»åŠ¡ï¼Œæé«˜æ•´ä½“çš„è°ƒåº¦æ€§èƒ½ï¼Œä»£ç ä¹Ÿå¼€æºåœ¨Githubå¹³å°ä¸Š\n\nåŒæ—¶æˆ‘ä¹Ÿæœ‰ä¸€ä¸ªä»å¤§ä¸€å°±å¼€å§‹ç»´æŠ¤çš„ä¸ªäººåšå®¢ï¼Œå¹³æ—¶ä¹Ÿä¼šå°†å­¦ä¹ çš„è¿‡ç¨‹è®°å½•åœ¨åšå®¢ä¸Šä¸ä»–äººåˆ†äº«\n\næ­¤æ¬¡é¢è¯•æƒ³åº”è˜è´µå…¬å¸çš„ åç«¯å¼€å‘å²—ä½\n# é¡¹ç›®\n## æ¹–å¸ˆæ•™å¸ˆå·¥ä½œé‡ç»Ÿè®¡ç³»ç»Ÿ\næ•™åŠ¡å¤„å§”æ‰˜æˆ‘ä»¬å®éªŒå®¤å®ç°çš„ï¼Œä¸ºäº†æ–¹ä¾¿å…¨æ ¡æ•™å¸ˆç»Ÿè®¡å·¥ä½œé‡ä»¥åŠæ•™åŠ¡å¤„å®¡æ ¸ï¼Œé¡¹ç›®é‡‡ç”¨Java SpringBootä»¥åŠMyBatisç¼–å†™ï¼Œæˆ‘ä¸»è¦è´Ÿè´£é¡¹ç›®çš„ç™»å½•æ¨¡å—å’Œæœ¬ç§‘ç”Ÿå®è·µæ•™å­¦å·¥ä½œé‡ç»Ÿè®¡æ¨¡å—\n\né¡¹ç›®æœ¬èº«æ²¡ä»€ä¹ˆéš¾åº¦ï¼Œä½†æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„bugï¼Œåœ¨ç™»å½•çš„è¿‡ç¨‹ä¸­ä¼šå¶å°”å¡æ­»ï¼Œèµ·åˆæˆ‘ä»¥ä¸ºæ˜¯ç½‘ç»œçš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯æˆ‘çš„äº‘æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“ï¼Œä½†æ˜¯å½“æˆ‘æŸ¥çœ‹äº†æ§åˆ¶å°çš„è¾“å‡ºå‘ç°è¯·æ±‚æ ¹æœ¬å°±æ²¡æœ‰åˆ°è¾¾daoå±‚ï¼Œåœ¨å‰ç«¯controlerå±‚å°±hangä½äº†ï¼Œä½†æ˜¯ç”±äºä»–ä»¬æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°è¿™ä¸ªbugåå°±ç›´æ¥é‡å¯æœåŠ¡äº†ï¼Œå¯¼è‡´æˆ‘è¿‡å»çš„æ—¶å€™bugä»¥åŠæ¶ˆå¤±äº†ï¼ï¼ï¼æ‰€ä»¥æˆ‘ä»¬å½“æ—¶åœ¨æœºæˆ¿æäº†å‡ å°æ—¶æ‰å¤ç°å‡ºbugï¼Œç„¶åæˆ‘é©¬ä¸Šç”¨jvisualvmç›´æ¥dumpé™¤äº†çº¿ç¨‹å †æ ˆï¼Œç„¶åå‘ç°æœ‰ä¸€æ¡çº¿ç¨‹BLOCKåœ¨äº†println()çš„ä¸€æ¡è¯­å¥ä¸Šï¼Œprintln()æ˜¯åŠ äº†é”synchronizedï¼Œé”çš„æ˜¯å½“å‰çš„å®ä¾‹PrintStreamçš„å®ä¾‹ï¼Œç„¶åæˆ‘ç»§ç»­æŸ¥çœ‹å †æ ˆä¿¡æ¯å‘ç°å æœ‰è¯¥é”çš„ä¸€ä¸ªtomcatçš„httpçº¿ç¨‹æ­£åœ¨RUNNINGï¼Œä½†æ˜¯å®ƒä¹Ÿå¹¶æ²¡æœ‰è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Œæœ€åå»ç½‘ä¸Šæ ¹æ®å·²æœ‰çš„å…³é”®å­—æŸ¥äº†ä¸€ä¸‹ï¼Œç„¶åå‘ç°è¿™é‡Œå…¶å®windowsçš„cmdçª—å£çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯åŠ¨åæœ‰äººç‚¹äº†ä¸€ä¸‹cmdçª—å£ï¼Œå¯¼è‡´cmdçš„è¾“å‡ºè¢«ä¸­æ–­ï¼Œä¸å†å…è®¸å†™å…¥ï¼Œè¿™å°±å¯¼è‡´è¿™äº›writeçº¿ç¨‹hangä½ï¼Œè¿™ä¸ªé—®é¢˜è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œæ¢æˆLinuxå¹³å°å°±å¯ä»¥äº†ï¼Œ**æ•´ä»¶äº‹ç»™æˆ‘çš„æ”¶è·å°±æ˜¯çº¿ä¸Šé‡åˆ°è¿™ç§bugä¸è¦æ€¥ç€é‡å¯æœåŠ¡ï¼Œè‡³å°‘å¾—å…ˆæŠŠçº¿ç¨‹å †æ ˆdumpä¸‹æ¥å†è¯´ï¼Œä¸ç„¶æˆ‘ä»¬ä¹Ÿä¸è‡³äºåé¢å¤ç°æè¿™ä¹ˆé•¿æ—¶é—´**\n\n## Gacacheç¼“å­˜åº“\n\næ¨¡ä»¿Googleå¼€æºçš„GroupCacheå®ç°çš„åˆ†å¸ƒå¼ç¼“å­˜åº“ï¼Œé¡¹ç›®çš„ç‰¹ç‚¹å°±æ˜¯åªæ”¯æŒgetæ“ä½œï¼Œä¸æ”¯æŒupdate/delete/ttlï¼Œå½“å†…å­˜æ»¡çš„æ—¶å€™åªèƒ½é€šè¿‡lruï¼ˆLRU-Kä¼˜åŒ–ï¼‰å»æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å®ƒé€‚ç”¨çš„åœºæ™¯å°±æ˜¯å­˜å‚¨é•¿æœŸä¸ä¼šæ”¹å˜çš„æ•°æ®\n\nåŒæ—¶æ­£æ˜¯å› ä¸ºèˆå¼ƒäº†updateï¼Œdeleteç­‰åŠŸèƒ½ï¼Œæ‰€ä»¥cacheå¯ä»¥æ”¯æŒçƒ­ç‚¹äº’å¤‡çš„åŠŸèƒ½ï¼Œåˆ†å¸ƒå¼çš„å®ç°ä¹Ÿæ›´åŠ å®¹æ˜“ï¼Œä¸ç”¨è€ƒè™‘å¹¶å‘è¯»å†™çš„é—®é¢˜\n\nå…·ä½“é¡¹ç›®çš„å®ç°ï¼Œé¦–å…ˆè¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¼“å­˜åº“ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘æ•°æ®åˆ†ç‰‡çš„é—®é¢˜ï¼Œå¸¸è§„çš„åšæ³•å¯ä»¥é‡‡ç”¨å–æ¨¡çš„æ–¹æ³•ï¼Œå°†keyçš„hashå€¼ä¸èŠ‚ç‚¹æ•°é‡è¿›è¡Œå–æ¨¡å¾—åˆ°keyæ˜ å°„çš„èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿å¾—æ•°æ®çš„åˆ†é…æ›´åŠ å‡åŒ€ï¼Œä½†æ˜¯è¿™æ ·åšçš„é—®é¢˜æ˜¯ï¼Œå¦‚æœèŠ‚ç‚¹çš„æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„keyéƒ½éœ€è¦é‡æ–°æ˜ å°„ï¼Œæ‰©å±•æ€§è¾ƒå·®ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨äº†ä¸€è‡´æ€§Hashç®—æ³•è¿›è¡Œæ•°æ®åˆ†ç‰‡å’ŒèŠ‚ç‚¹çš„é€‰å–ï¼Œå°†æ‰€æœ‰çš„æ•´æ•°èŒƒå›´ï¼ˆ2^32-1ï¼‰å†…çš„hashå€¼æ„æˆä¸€ä¸ªç¯ï¼Œç„¶åå°†èŠ‚ç‚¹æ ¹æ®ipå’Œç«¯å£ä¿¡æ¯hashåæœ‰åºçš„æ”¾å…¥ç¯ä¸­ï¼ŒåŒæ—¶ä¸ºäº†é¿å…æ•°æ®å€¾æ–œçš„é—®é¢˜ï¼Œæˆ‘ä»¬åŒæ—¶ç”Ÿæˆå¤šä¸ªè¯¥èŠ‚ç‚¹çš„hashå€¼ï¼Œä½œä¸ºè™šæ‹ŸèŠ‚ç‚¹ï¼ŒåŒæ—¶è®°å½•è™šæ‹ŸèŠ‚ç‚¹å’ŒçœŸå®èŠ‚ç‚¹çš„å¯¹åº”å…³ç³»ï¼Œç„¶åå½“æˆ‘è®¡ç®—æŸä¸ªkeyçš„æ˜ å°„æ—¶ï¼Œå°†keyçš„hashè®¡ç®—å‡ºæ¥ï¼Œç„¶åç›´æ¥åœ¨ç¯ä¸­å®šä½ï¼Œé¡ºæ—¶é’ˆæ‰¾åˆ°ç¦»ä»–æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œç„¶åè¿”å›å…¶å¯¹åº”çš„çœŸå®èŠ‚ç‚¹å°±æ˜¯è¯¥keyçš„æ˜ å°„ï¼Œè¿™æ ·å½“èŠ‚ç‚¹æ•°é‡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå°±åªæœ‰å°‘é‡çš„æ•°æ®éœ€è¦åšè¿ç§»\n\nå„ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šè¿‡Httpé€šä¿¡ï¼Œå¹¶ä¸”ä½¿ç”¨Protobufåºåˆ—åŒ–æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ—¢æ˜¯å®¢æˆ·ç«¯ä¹Ÿæ˜¯æœåŠ¡ç«¯ï¼Œå½“è¯·æ±‚éšæœºè½åœ¨æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ—¶ï¼Œé¦–å…ˆä¼šåˆ¤æ–­æœ¬åœ°æœ‰æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šé€šè¿‡ä¸€è‡´æ€§hashå»é€‰æ‹©èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹æ˜¯è‡ªå·±å°±ä¼šç›´æ¥ä»DBä¸­æ‹‰å–æ•°æ®ç„¶åç¼“å­˜åœ¨å½“å‰èŠ‚ç‚¹ä¸Šï¼Œå¦åˆ™å»ä¸€è‡´æ€§hashæ‰€é€‰æ‹©çš„å…¶ä»–èŠ‚ç‚¹å»è¯·æ±‚æ•°æ®ï¼Œæœ€åè¿”å›ç»™è°ƒç”¨è€…\n\nä½œä¸ºä¸€ä¸ªç¼“å­˜åº“å…¶å®è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªçƒ­ç‚¹keyçªç„¶è¿‡æœŸï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥æ‰“åˆ°DBå±‚å‹å®DBï¼Œè€Œå¸¸è§„çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š\n1. ç¼“å­˜æ°¸ä¸è¿‡æœŸï¼Œç±»ä¼¼[Redisä¸­çš„æƒ°æ€§åˆ é™¤](#å†…å­˜å›æ”¶ç­–ç•¥)ï¼Œä»…ä»…è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å½“è®¿é—®ä¸€ä¸ªè¿‡æœŸçš„keyæ—¶ï¼Œè¯·æ±‚ä¸ä¼šç›´æ¥æ‰“åˆ°DBï¼Œç„¶åæˆ‘ä»¬é€šè¿‡åå°å¼‚æ­¥çº¿ç¨‹å»æ›´æ–°ç¼“å­˜ï¼Œè¿™æ ·åšç”¨æˆ·å»¶è¿Ÿæ˜¯æœ€ä½çš„ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰æ•°æ®çš„ä¸ä¸€è‡´ï¼Œæœ‰çš„çº¿ç¨‹è¯»å–çš„ä»ç„¶æ˜¯è€æ•°æ®\n2. äº’æ–¥é”ï¼Œå½“å¤šä¸ªè¯·æ±‚åŒæ—¶å»getçƒ­ç‚¹æ•°æ®çš„æ—¶å€™ï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚æ•°æ®çš„æ—¶å€™è¿›è¡ŒåŠ é”ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°æ•°æ®åè¿›è¡Œçƒ­ç‚¹keyé‡å»ºç„¶åé‡Šæ”¾é”ï¼Œå…¶ä»–è¯·æ±‚å°±ç›´æ¥ä»ç¼“å­˜ä¸­getæ•°æ®ï¼Œä¸ç”¨å†å»DBè¯·æ±‚æ•°æ®\n\næˆ‘é‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆï¼Œå› ä¸ºæˆ‘çš„è¿™ä¸ªcacheæ˜¯ä¸æ”¯æŒä¸»åŠ¨çš„åˆ é™¤æ“ä½œçš„ï¼Œæ‰€ä»¥ä½ æ— æ³•æ§åˆ¶keyä½•æ—¶ä¼šè¢«åˆ é™¤ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•ä¿æŠ¤DB\n\né™¤æ­¤ä¹‹å¤–æˆ‘é’ˆå¯¹åŸé¡¹ç›®çš„çƒ­ç‚¹äº’å¤‡åŠŸèƒ½ä¹Ÿè¿›è¡Œäº†ç®€å•çš„å¢å¼ºï¼Œçƒ­ç‚¹äº’å¤‡è¿™é‡Œä¸»è¦é’ˆå¯¹å°±æ˜¯**å‘æŸä¸ªèŠ‚ç‚¹è¯·æ±‚è¯¥èŠ‚ç‚¹ä¸Šæ²¡æœ‰çš„æ•°æ®**ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å°±ä¼šé¢‘ç¹çš„é€šè¿‡httpå»å‘å…¶ä»–çš„èŠ‚ç‚¹å»è¯·æ±‚æ•°æ®ï¼Œè€Œç½‘ç»œè¯·æ±‚æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œè¿™æ ·å°±å¯èƒ½ä½¿å¾—èŠ‚ç‚¹çš„ç½‘å¡æˆä¸ºçƒ­ç‚¹keyçš„ç“¶é¢ˆï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œ**çƒ­ç‚¹äº’å¤‡**ï¼Œå°†è¿™äº›keyç›´æ¥å¤‡ä»½åœ¨å½“å‰èŠ‚ç‚¹ä¸Š\n\nä½†æ˜¯åœ¨GroupCacheçš„å®ç°ä¸­ï¼Œè¿™é‡Œæ˜¯é‡‡ç”¨çš„éšæœºçš„åšæ³•ï¼Œéœ€è¦ä»å…¶ä»–èŠ‚ç‚¹è·å–çš„keyæœ‰1/10çš„æœºä¼šè¢«ç¼“å­˜åœ¨å½“å‰èŠ‚ç‚¹ä¸Šï¼Œä»å¤§æ ·æœ¬çš„è§’åº¦ä¸Šæ¥è®²ç¡®å®ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ³¨æ„åˆ°è¿™è¡Œä»£ç ä¸Šæœ‰ä¸€ä¸ªtodoçš„æ ‡ç­¾ï¼Œå¹¶ä¸”æ³¨é‡Šä¸­æœ‰å†™åˆ°ï¼Œå¯ä»¥åˆ©ç”¨QPSå»åˆ¤æ–­çƒ­ç‚¹ï¼Œæ‰€ä»¥æˆ‘æŒ‰ç…§è¿™ä¸ªæ€è·¯åšäº†ä¸€äº›æ”¹åŠ¨ï¼Œé¦–å…ˆå°è£…äº†ä¸€ä¸ªKeyStatçš„ç»“æ„ï¼ŒåŒ…å«äº†ä¸€ä¸ªé¦–æ¬¡è¯·æ±‚æ—¶é—´ï¼Œä»¥åŠä¸€ä¸ªç”¨è®¿é—®æ¬¡æ•°ï¼Œå¹¶ä¸”ç”¨AtomicåŒ…å®ç°äº†åŸå­æ›´æ–°æ“ä½œï¼Œå½“ç¬¬ä¸€æ¬¡è·å–çš„æ—¶å€™æ„å»ºå‡ºKeyStatsï¼Œè®°å½•ä¸‹å½“å‰æ—¶é—´ï¼Œåé¢å†è¯·æ±‚è¯¥keyçš„æ—¶å€™å°±åˆ©ç”¨åŸå­åŒ…å¯¹è®¿é—®æ¬¡æ•°åš++ï¼Œå½“è¾¾åˆ°æˆ‘ä»¬é¢„è®¾çš„QPSé˜ˆå€¼åå°±ä¼šè¢«ç›´æ¥å­˜å…¥å½“å‰èŠ‚ç‚¹ï¼Œç„¶åå°†å¯¹åº”çš„KeyStatsåˆ é™¤ï¼Œç»è¿‡æˆ‘è‡ªå·±çš„æµ‹è¯•ä¹Ÿç¡®å®è¾¾åˆ°äº†æˆ‘æƒ³è¦çš„æ•ˆæœ\n\n## é«˜æ€§èƒ½ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ\nåˆ†å¸ƒå¼çš„cronå®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œä»»åŠ¡ä¿å­˜etcdé›†ç¾¤ä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹å¯ä»¥å¹¶å‘çš„è°ƒåº¦å…¶ä¸­çš„å®šæ—¶ä»»åŠ¡ï¼Œæ•´ä¸ªç³»ç»Ÿåˆ’åˆ†ä¸ºä¸¤ç±»èŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¸ºMasterèŠ‚ç‚¹ï¼Œå’ŒWorkerèŠ‚ç‚¹\n\nå…¶ä¸­MasterèŠ‚ç‚¹åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦å°±æ˜¯è´Ÿè´£å’ŒEtcdäº¤äº’ï¼Œå¯¹ä»»åŠ¡è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œä»DBæ‹‰å–ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼Œå¹¶ä¸”å®ç°ä¸€ä¸ªWebç•Œé¢æ–¹ä¾¿ç”¨æˆ·æ“ä½œ\n\nWorkerèŠ‚ç‚¹å°±è´Ÿè´£å…·ä½“çš„è°ƒåº¦å’Œæ‰§è¡Œä»»åŠ¡ï¼Œä¸»è¦åˆ†ä¸ºå‡ ä¸ªæ¨¡å—ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ª**JobManagerä»»åŠ¡ç®¡ç†å™¨**ï¼Œè¿™ä¸ªæ¨¡å—å†…ä¼šæœ‰ä¸“é—¨çš„åç¨‹å»è´Ÿè´£ç›‘å¬etcdå¯¹åº”ç›®å½•çš„è¾©æŠ¤ï¼Œæ¯”å¦‚saveç›®å½•å‘ç”Ÿäº†PUTäº‹ä»¶ï¼Œå°±è¯´æ˜æœ‰æ–°å¢åŠ çš„ä»»åŠ¡ï¼Œå°±ä¼šå°†æ–°çš„ä»»åŠ¡å°è£…æˆä¸€ä¸ªEventç„¶åé€šè¿‡channelä¼ é€’åˆ° **Scheduleè°ƒåº¦å™¨** æ¨¡å—ï¼Œè°ƒåº¦å™¨ä¼šç›‘å¬å¯¹åº”channelä¸­çš„æ¶ˆæ¯ï¼Œç„¶åæ ¹æ®Eventçš„ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚å¦‚æœæ˜¯PUTäº‹ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šå°†ä»»åŠ¡ **åŒ…è£…åï¼ˆè¿™é‡Œå°±ç”¨åˆ°äº†cronexpråº“å¯¹cronè¡¨è¾¾å¼è¿›è¡Œè§£æï¼Œå®ç°ç²¾ç»†çš„ç§’çº§è°ƒåº¦ï¼‰** æ·»åŠ åˆ° **ä»»åŠ¡æ‰§è¡Œè®¡åˆ’è¡¨** ä¸­ï¼Œå¹¶ä¸”éå†ä»»åŠ¡è®¡åˆ’è¡¨ï¼Œæ‰§è¡Œåˆ°æœŸçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ç»Ÿè®¡ä¸‹ä¸€æ¬¡å°†è¦è¿‡æœŸçš„ä»»åŠ¡çš„å€’è®¡æ—¶æ—¶é—´ï¼Œç„¶åè®¾ç½®å®šæ—¶å™¨ï¼Œè¿›è¡Œç²¾ç¡®çš„è¶…æ—¶ç­‰å¾…ï¼Œ**é¿å…é¢‘ç¹çš„éå†ä»»åŠ¡è¡¨æ¶ˆè€—CPU**ã€‚å½“ä»»åŠ¡åˆ°æœŸæ—¶ï¼Œè°ƒåº¦å™¨é¦–å…ˆä¼šå¯¹ä»»åŠ¡åˆ¤é‡ï¼Œä¸ä¹‹å¯¹åº”çš„æœ‰ä¸€ä¸ª **ä»»åŠ¡æ‰§è¡Œè¡¨**ï¼Œå¦‚æœå½“å‰ä»»åŠ¡æ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‚£ä¹ˆå°±ä¼šè·³è¿‡æœ¬æ¬¡è°ƒåº¦ï¼ŒåŸç”Ÿçš„Linux Crontabå°±æ²¡æœ‰åˆ¤æ–­é‡å¤çš„è¿‡ç¨‹ï¼Œå¦‚æœå®šæ—¶é—´éš”å°äºå®é™…æ‰§è¡Œæ—¶æœºå°±ä¼šå¯¼è‡´ä»»åŠ¡é‡å¤æ‰§è¡Œï¼Œå°±å¯èƒ½ä¼šé€ æˆä¸€äº›é—®é¢˜\n\nå½“ç¡®å®šä»»åŠ¡å¹¶æ²¡æœ‰æ­£åœ¨æ‰§è¡Œå°±ä¼šå°†ä»»åŠ¡äº¤ç»™ **Executoræ‰§è¡Œå™¨** æ¨¡å—ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€ä¸ªä»»åŠ¡å¹¶å‘æŠ¢å çš„é—®é¢˜ï¼Œä¼šå¤šä¸ªèŠ‚ç‚¹åŒæ—¶å»æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œå€ŸåŠ©äº†Etcdæ‰‹åŠ¨å®ç°äº†åˆ†å¸ƒå¼é”ï¼Œå…¶å®è¿™é‡Œæœ‰ä¸€ä¸ªå°çš„è€ƒè™‘ï¼Œæœ¬æ¥æ˜¯æ‰“ç®—ç›´æ¥ä½¿ç”¨EtcdV3å®¢æˆ·ç«¯ConcurrencyåŒ…æä¾›çš„ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯åœ¨çœ‹äº†å®ƒçš„å®ç°åå‘ç°å¹¶ä¸é€‚åˆæˆ‘çš„ä¸šåŠ¡\n\nå®˜æ–¹çš„åˆ†å¸ƒå¼é”æ˜¯é‡‡ç”¨çš„ä¸€ç§ **å…¬å¹³ç­‰å¾…** çš„æ¨¡å¼ï¼Œåˆ›å»ºé”çš„æ—¶å€™æŒ‡å®šä¸€ä¸ªå…¬å…±çš„å‰ç¼€ï¼Œç„¶åæ‹¼æ¥ä¸Šå½“å‰èŠ‚ç‚¹çš„ä¿¡æ¯ä½œä¸ºkeyæ’å…¥etcdä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹æ’å…¥çš„keyä¼šæŒ‰ç…§revisionæ’é˜Ÿï¼Œå…ˆæ¥ååˆ°ï¼Œæ’åœ¨å‰é¢çš„èŠ‚ç‚¹ä¼šå…ˆè·å–é”ï¼Œå…¶ä»–çš„åªèƒ½å…ˆç­‰å¾…ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ä¸€ä¸ª **å…¬å¹³é”** çš„æ•ˆæœï¼ŒåŒæ—¶æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ç›‘å¬ä»–çš„ä¸Šä¸€ä¸ªrevisionæ˜¯å¦è¢«åˆ é™¤å°±è¡Œäº†ï¼Œå¦‚æœè¢«åˆ é™¤å°±è¯´æ˜ä¸Šä¸€ä¸ªèŠ‚ç‚¹å·²ç»é‡Šæ”¾é”äº†ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±ä¼šç»“æŸé˜»å¡è·å–åˆ°é”ï¼Œè¿™æ ·é¿å…äº†  **æƒŠç¾¤æ•ˆåº”**ï¼Œå…¶å®æˆ‘æ„Ÿè§‰è¿™ä¸ªå’Œ**CLHé”**çš„å®æƒ³æ˜¯ä¸€è‡´çš„ï¼ˆåˆ†å¸ƒå¼çš„CLHé”ï¼‰ï¼Œä¹Ÿå°±æ˜¯Javaä¸­AQSåº•å±‚çš„å®ç°æœºåˆ¶ï¼Œå°†ç«äº‰åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Š\n\nä½†æ˜¯è¿™æ ·çš„æ–¹å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹è·å–ä¸åˆ°é”ä¼šç­‰å¾…å‰ä¸€ä¸ªèŠ‚ç‚¹é‡Šæ”¾é”ï¼Œè€Œåœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹äº‰æŠ¢çš„å…¶å®æ˜¯ **æŸä¸ªä»»åŠ¡ï¼ŒæŸä¸ªæ—¶åˆ»çš„æ‰§è¡Œæƒ** ï¼Œå½“è¯¥æ—¶åˆ»è¿‡å»çš„æ—¶å€™è¿™æŠŠé”å…¶å®å°±æ²¡æ„ä¹‰äº†ï¼Œå…¶ä»–çš„èŠ‚ç‚¹æ­¤æ—¶ä¸åº”è¯¥ç»§ç»­ç­‰å¾…ï¼Œè€Œæ˜¯åº”è¯¥è½¬å‘æŒ‡å‘å…¶ä»–çš„ä»»åŠ¡ï¼Œè¿™æ ·æ‰èƒ½å……åˆ†åˆ©ç”¨åˆ†å¸ƒå¼çš„ä¼˜ç‚¹ï¼Œå¹¶å‘çš„è°ƒåº¦ä»»åŠ¡ï¼Œè€Œä¸æ˜¯åœ¨è¿™ä¸€æ£µæ ‘ä¸ŠåŠæ­»ï¼Œæ‰€ä»¥åœ¨æˆ‘åé¢åˆ©ç”¨etcdçš„ **ç§Ÿçº¦å’Œäº‹åŠ¡** æœºåˆ¶ä»¥lockå‰ç¼€ä»¥åŠä»»åŠ¡åå­—ï¼Œå®ç°çš„åˆ†å¸ƒå¼é”ä¸­æªé”å¤±è´¥ä¼šç›´æ¥è¿”å›ï¼Œä¸å†äº‰æŠ¢é”ï¼ˆåå‘çš„é—®é¢˜ï¼Œå¦‚æœé—®ä¼˜åŒ–å¯ä»¥è¯´è¯´ï¼‰\n\nåé¢å†å®ç°ä»»åŠ¡å¼ºæ€çš„è¿‡ç¨‹ä¸­è¿˜å‘ç°äº†ä¸€ä¸ªæœ‰æ„æ€çš„bugï¼Œå°±æ˜¯æˆ‘çš„ä»»åŠ¡å¼ºæ€åä»»åŠ¡å¹¶ä¸ä¼šå‘ç”Ÿè¿”å›ï¼Œä»ç„¶ä¼šç»§ç»­æŒ‡å‘ï¼Œç›´åˆ°ä»»åŠ¡ç»“æŸï¼Œç„¶åæˆ‘å†™äº†ä¸ªç±»ä¼¼çš„æœ€å°Demoï¼Œåˆ©ç”¨contextå–æ¶ˆä»»åŠ¡ï¼Œå¤ç°äº†bugï¼Œèµ·åˆä»¥ä¸ºæ˜¯å¹³å°çš„é—®é¢˜ï¼Œåˆ‡æ¢åˆ°Linuxå¹³å°ä¸Šå‘ç°é—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œç„¶åæˆ‘pstreeæŸ¥çœ‹äº†è¿›ç¨‹æ ‘ï¼Œå‘ç°åœ¨æˆ‘å¼ºæ€åæˆ‘çš„shellè¿›ç¨‹ç¡®å®è¢«killäº†ï¼Œä½†æ˜¯æˆ‘çš„ä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™shellåˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™ä¸ªå­è¿›ç¨‹å¹¶æ²¡æœ‰è¢«æ€æ­»ï¼Œè€Œæ˜¯æˆä¸ºäº†å­¤å„¿è¿›ç¨‹ï¼Œè¢«initè¿›ç¨‹æ”¶å…»äº†ï¼Œå…¶å®è¿™ä¸ªæ—¶å€™æˆ‘å°±æ„è¯†åˆ°è¿™åº”è¯¥ä¸æ˜¯æˆ‘çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯Goæœ¬èº«çš„é—®é¢˜ï¼Œç„¶åæˆ‘çœ‹äº†goä¸‹æºç ï¼Œå‘ç°åœ¨goè¯­è¨€åœ¨è¿™é‡Œçš„å®ç°ä¸­ï¼Œä¼šåˆ›å»ºä¸€äº›pipeç”¨äºå’Œshellè¿›ç¨‹é€šä¿¡ï¼Œè¿”å›outï¼Œerrä¸€äº›ä¿¡æ¯ï¼Œ **è€Œshellè¿›ç¨‹åœ¨forkå­è¿›ç¨‹çš„æ—¶å€™ä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨** ï¼Œæ‰€ä»¥pipeçš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¼šè¢«å­è¿›ç¨‹æŒæœ‰ï¼Œæ‰€ä»¥å½“killçˆ¶è¿›ç¨‹åï¼Œpipeä»ç„¶å­˜åœ¨ï¼Œå†™å…¥ç«¯å¹¶æ²¡æœ‰å…³é—­ï¼Œè€ŒGolangçš„å®ç°ä¸­å¯¹åº”çš„goroutineä¹Ÿä¼šä¸€ç›´ç­‰å¾…pipeå†™å…¥ç«¯çš„ä¿¡æ¯æˆ–è€…pipeå…³é—­ï¼Œè¿›è€Œäº†å¯¼è‡´æ— æ³•killä»»åŠ¡çš„æƒ…å†µ\n\nè§£å†³çš„æ–¹æ¡ˆä¹Ÿå¾ˆç›´æ¥ï¼Œå½“å¼ºæ€ä»»åŠ¡çš„æ—¶å€™ï¼Œè¿åŒshellè¿›ç¨‹å’Œæ‰€æœ‰å­è¿›ç¨‹ä¸€èµ·å½“ä½œä¸€ä¸ªè¿›ç¨‹ç»„è®¾ç½®pgidï¼Œç„¶ååˆ©ç”¨systemcallï¼Œkillæ•´ä¸ªè¿›ç¨‹ç»„ï¼Œæœ€ç»ˆè§£å†³äº†bugï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆä»…ä»…é€‚ç”¨äºLinuxå¹³å°ï¼ŒWindowså¹³å°ä¸Šæš‚æ—¶æ²¡æ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ¡ˆ\n\næˆ‘åœ¨å®˜æ–¹çš„gihubä¸Šæœäº†ä¸‹ï¼Œä¹Ÿæœç´¢åˆ°äº†ç›¸å…³çš„issueï¼Œè¿™ä¸ªé—®é¢˜å·²ç»å­˜åœ¨å¾ˆä¹…äº†ï¼Œå¯èƒ½ä¼šåœ¨Go2.0çš„æ—¶å€™ä¿®å¤\n\n# MySQL\n## Innodb vs MyISAM \n- MyISAM ä¸æ”¯æŒäº‹åŠ¡\n- MyISAM åªæœ‰è¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”\n- MyISAM ä¸æ”¯æŒå¤–é”®\n- MyISAM æ•°æ®å’Œç´¢å¼•åˆ†ç¦»ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å…·ä½“çš„æ•°æ®å—\n## äº‹åŠ¡\näº‹åŠ¡å››å¤§ç‰¹æ€§ï¼šACIDï¼ˆAtomicityã€Consistencyã€Isolationã€Durabilityï¼Œå³åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰\n\n**åŸå­æ€§**ï¼šäº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›\n\n**éš”ç¦»æ€§**ï¼šå¤šä¸ªäº‹åŠ¡å¹¶å‘çš„æ“ä½œçš„æ—¶å€™ï¼Œå„ä¸ªäº‹åŠ¡ä¹‹é—´çš„çŠ¶æ€ä¸ä¼šç›¸äº’å½±å“ï¼Œæ•°æ®ä¿æŒç‹¬ç«‹\n\n**æŒä¹…æ€§**ï¼šäº‹åŠ¡æäº¤åå¯¹äºæ•°æ®åº“çš„æ”¹å˜æ˜¯æ°¸ä¹…çš„ï¼Œåº”è¯¥ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸å½±å“\n\n**ä¸€è‡´æ€§**ï¼šä¿è¯äº‹åŠ¡ä»ä¸€ä¸ªæœ‰æ•ˆçš„çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªæœ‰æ•ˆçš„çŠ¶æ€ï¼Œè€Œæœ‰æ•ˆæŒ‡çš„å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­é¢„å…ˆå®šä¹‰çš„è§„åˆ™ï¼Œæ¯”å¦‚ä½™é¢ä¸èƒ½æ‰£å‡ä¸ºè´Ÿæ•°ç­‰ï¼Œè€Œï¼Œä¸€è‡´ä¾èµ–AIDï¼Œå®é™…ä¸Šä¸€è‡´æ€§çš„ä¿éšœæ›´ä¾èµ–äºåº”ç”¨å±‚ä¹Ÿå°±æ˜¯ç¨‹åºå‘˜\n### éš”ç¦»æ€§ & éš”ç¦»çº§åˆ«\néš”ç¦»çº§åˆ«å®é™…ä¸Šå°±æ˜¯ä¸ºäº†åº”å¯¹å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ‰€å¯èƒ½äº§ç”Ÿçš„é—®é¢˜ï¼Œå½“æ•°æ®åº“ä¸Šæœ‰å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°è„è¯»ï¼ˆdirty readï¼‰ã€ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼‰ã€å¹»è¯»ï¼ˆphantom readï¼‰çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå°±æœ‰äº†â€œéš”ç¦»çº§åˆ«â€çš„æ¦‚å¿µã€‚\n> ä¸å¯é‡å¤è¯»å–ä¾§é‡updateï¼Œè€Œå¹»è¯»ä¾§é‡insert\n\n1. **è¯»æœªæäº¤ï¼ˆRUï¼‰**ï¼šä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚\n2. **è¯»æäº¤æ˜¯æŒ‡ï¼ˆRCï¼‰**ï¼šä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚\n3. **å¯é‡å¤è¯»æ˜¯æŒ‡ï¼ˆRRï¼‰**ï¼šä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚\n4. **ä¸²è¡ŒåŒ–ï¼ˆSERIALIZABLEï¼‰**ï¼šï¼Œé¡¾åæ€ä¹‰æ˜¯å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚\n\n\n## redo log \nMySQLä¸­çš„WALï¼ˆwtite-ahead loggingï¼‰æŠ€æœ¯çš„å®ç°ï¼Œç”¨æ¥ä¿éšœäº‹åŠ¡çš„**æŒä¹…æ€§**ï¼Œå…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—å†å†™ç£ç›˜ï¼Œæ‰€æœ‰çš„ä¿®æ”¹æ“ä½œåœ¨æäº¤ä¹‹å‰éƒ½éœ€è¦å…ˆå†™å…¥logä¸­ï¼Œé¿å…äº‹åŠ¡æäº¤åè½ç›˜æ—¶å‘ç”Ÿæ•…éšœï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¿™æ ·åœ¨æ•°æ®åº“å¼‚å¸¸é‡å¯åä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼ˆcrash-safeï¼‰\n> åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­WALé€šå¸¸è¢«ç§°ä¸ºï¼šæ—¥å¿—å¼æ–‡ä»¶ç³»ç»Ÿï¼ˆjournaling ï¼‰Ext3,4éƒ½æ”¯æŒ\n\n**ä¸ºä»€ä¹ˆä¸åœ¨äº‹åŠ¡æäº¤å‰å°†ä¿®æ”¹çš„æ‰€æœ‰é¡µé¢ç›´æ¥åˆ·æ–°åˆ°ç£ç›˜ï¼Ÿ**\n1. MySQLæ˜¯ä»¥é¡µä¸ºå•ä½è¿›è¡Œç£ç›˜IOçš„ï¼Œå¯èƒ½åªä¿®æ”¹äº†ä¸€æ¡æ•°æ®ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦åˆ·æ–°æ•´ä¸ªæ•°æ®é¡µåˆ°ç£ç›˜ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œè€Œredo logåªéœ€è¦è®°å½•ä¿®æ”¹äº†é‚£äº›ä¸œè¥¿ï¼ˆç‰©ç†æ—¥å¿—: å°†ç¬¬0å·è¡¨ç©ºé—´çš„100å·é¡µé¢çš„åç§»é‡ä¸º1000å¤„çš„å€¼æ›´æ–°ä¸º2ï¼‰\n2. åˆ·æ–°åˆ°ç£ç›˜æ˜¯éšæœºIOï¼Œæ•ˆç‡æ¯”è¾ƒä½ï¼Œredo logæ˜¯æŒ‰ç…§é¡ºåºå†™å…¥ç£ç›˜çš„ï¼Œå¹¶ä¸”å¯ä»¥åˆ†ç»„æäº¤ï¼ŒåŒæ—¶è¿˜æœ‰`redo log buffer`çš„å­˜åœ¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç¼“è§£ç£ç›˜IOç¼“æ…¢çš„é—®é¢˜ï¼ˆlog bufferä¸­çš„æ•°æ®ä¼šåœ¨äº‹åŠ¡æäº¤å‰åˆ·ç›˜ï¼‰\n## undo Log\nä¿è¯**åŸå­æ€§**ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°å„ç§é”™è¯¯ï¼Œæ¯”å¦‚æœåŠ¡å™¨çªç„¶å®•æœºç­‰ï¼Œåˆæˆ–è€…ç¨‹åºå‘˜éœ€è¦åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤„ç†å¼‚å¸¸æƒ…å†µéœ€è¦æ‰‹åŠ¨`ROLLBACK`ï¼Œè¿™äº›ä¼šå¯¼è‡´äº‹åŠ¡æ‰§è¡Œä¸€åŠå°±ç»“æŸï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæˆ‘ä»¬éœ€è¦**å›æ»š**æ•°æ®åˆ°äº‹åŠ¡æ‰§è¡Œå‰ï¼Œè®©äº‹åŠ¡çœ‹èµ·æ¥ä»€ä¹ˆéƒ½æ²¡åš\n> æ€»ç»“æ¥çœ‹å…¶å®redo logæ˜¯ä¿è¯äº‹åŠ¡æäº¤åçš„**æŒä¹…æ€§**ï¼Œè€Œundo logæ˜¯ä¿è¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„**åŸå­æ€§**ï¼Œæ‰€ä»¥äº‹åŠ¡æäº¤åundo logå°±æ²¡ç”¨äº†å›è¢«ç³»ç»Ÿå›æ”¶\n## binlog\nredo log æ˜¯ InnoDB å¼•æ“ï¼ˆå¼•æ“å±‚æ¬¡ï¼‰ç‰¹æœ‰çš„æ—¥å¿—ï¼Œè€Œ Server å±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—ï¼Œç§°ä¸º binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚\n\nMySQL çš„äºŒè¿›åˆ¶æ—¥å¿— binlog å¯ä»¥è¯´æ˜¯ MySQL æœ€é‡è¦çš„æ—¥å¿—ï¼Œå®ƒè®°å½•äº†æ‰€æœ‰çš„ DDL å’Œ DML è¯­å¥ï¼ˆé™¤äº†æ•°æ®æŸ¥è¯¢è¯­å¥selectã€showç­‰ï¼‰ï¼Œä»¥äº‹ä»¶å½¢å¼è®°å½•ï¼Œè¿˜åŒ…å«è¯­å¥æ‰€æ‰§è¡Œçš„æ¶ˆè€—çš„æ—¶é—´ï¼ŒMySQLçš„äºŒè¿›åˆ¶æ—¥å¿—æ˜¯äº‹åŠ¡å®‰å…¨å‹çš„ã€‚binlog çš„ä¸»è¦ç›®çš„æ˜¯**å¤åˆ¶**å’Œ**æ¢å¤**ã€‚\n\n> statement æ ¼å¼ä¸‹ï¼Œè®°å½•åˆ° binlog é‡Œçš„æ˜¯è¯­å¥åŸæ–‡ã€‚rowæ ¼å¼ä¸‹ï¼Œè®°å½•é‚£ä¸€æ¡è®°å½•è¢«ä¿®æ”¹äº†ï¼Œä¿®æ”¹æˆä»€ä¹ˆæ ·äº†ï¼Œæ‰€ä»¥rowå›æ›´å ç©ºé—´ï¼Œä½†æ˜¯ä¸»ä»å¤åˆ¶çš„æ—¶å€™ä¸å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œmixæ ¼å¼å°±å‰ä¸¤è€…çš„æ··åˆ\n### ä¸¤é˜¶æ®µæäº¤\nç”±äºå­˜åœ¨redo log å’Œ binlog ï¼Œè€Œä»–ä»¬ä¸¤æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è€Œäº‹åŠ¡æäº¤å¿…é¡»ç¡®ä¿ä¸¤è€…åŒæ—¶æœ‰æ•ˆã€‚ä¸ç„¶ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å½¢ã€‚\n![image.png](https://i.loli.net/2020/09/08/Ht3dPQTDylJqEpI.png)\nå°† redo log çš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼šprepare å’Œ commitï¼Œè¿™å°±æ˜¯\"ä¸¤é˜¶æ®µæäº¤\"ã€‚\n\n**ä¸€é˜¶æ®µ**ï¼šInnoDB redo log å†™ç›˜ï¼ŒInnoDB äº‹åŠ¡è¿›å…¥ prepare çŠ¶æ€\n\n**äºŒé˜¶æ®µ**ï¼šå¦‚æœå‰é¢prepareæˆåŠŸï¼Œbinlog å†™ç›˜ï¼Œé‚£ä¹ˆå†ç»§ç»­å°†äº‹åŠ¡æ—¥å¿—æŒä¹…åŒ–åˆ°binlogï¼Œå¦‚æœæŒä¹…åŒ–æˆåŠŸï¼Œé‚£ä¹ˆInnoDBäº‹åŠ¡åˆ™è¿›å…¥ commit çŠ¶æ€(å®é™…æ˜¯åœ¨redo logé‡Œé¢å†™ä¸Šä¸€ä¸ªcommitè®°å½•)\n### ä¸»ä»å¤åˆ¶ï¼š\n1. Masterå°†æ•°æ®æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(binary log)ä¸­\n2. Slaveä¸­çš„IOè¿›ç¨‹è¿æ¥ä¸ŠMasterï¼Œå¹¶è¯·æ±‚ä»æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æŒ‡å®šä½ç½®ä¹‹åçš„æ—¥å¿—å†…å®¹\n3. Masteræ¥æ”¶åˆ°æ¥è‡ªSlaveçš„IOè¿›ç¨‹çš„è¯·æ±‚åï¼Œè´Ÿè´£å¤åˆ¶çš„IOè¿›ç¨‹ä¼šæ ¹æ®è¯·æ±‚ä¿¡æ¯è¯»å–æ—¥å¿—æŒ‡å®šä½ç½®ä¹‹åçš„æ—¥å¿—ä¿¡æ¯ï¼Œè¿”å›ç»™Slaveçš„IOè¿›ç¨‹ã€‚è¿”å›ä¿¡æ¯ä¸­é™¤äº†æ—¥å¿—æ‰€åŒ…å«çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬æœ¬æ¬¡è¿”å›çš„ä¿¡æ¯å·²ç»åˆ°Masterç«¯çš„bin-logæ–‡ä»¶çš„åç§°ä»¥åŠbin-logçš„ä½ç½®\n4. Slaveçš„ **IOè¿›ç¨‹** æ¥æ”¶åˆ°ä¿¡æ¯åï¼Œå°†æ¥æ”¶åˆ°çš„æ—¥å¿—å†…å®¹ä¾æ¬¡æ·»åŠ åˆ°Slaveç«¯çš„`relay-log`æ–‡ä»¶çš„æœ€æœ«ç«¯å¹¶å°†è¯»å–åˆ°çš„Masterç«¯çš„ bin-logçš„æ–‡ä»¶åå’Œä½ç½®è®°å½•åˆ°`master-info`æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡è¯»å–çš„æ—¶å€™èƒ½å¤Ÿæ¸…æ¥šçš„å‘Šè¯‰Masterä»æŸä¸ªbin-logçš„å“ªä¸ªä½ç½®å¼€å§‹å¾€åçš„æ—¥å¿—å†…å®¹\n5. Slaveçš„ **Sqlè¿›ç¨‹** æ£€æµ‹åˆ°relay-logä¸­æ–°å¢åŠ äº†å†…å®¹åï¼Œä¼šé©¬ä¸Šè§£ærelay-logçš„å†…å®¹æˆä¸ºåœ¨Masterç«¯çœŸå®æ‰§è¡Œæ—¶å€™çš„é‚£äº›å¯æ‰§è¡Œçš„å†…å®¹ï¼Œå¹¶åœ¨è‡ªèº«æ‰§è¡Œ\n### å’ŒredologåŒºåˆ«\n1. redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼›binlog æ˜¯ MySQL çš„ Server å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚\n2. redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlog æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1 â€ã€‚\n3. redo log æ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlogæ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚\n## MVCC\nMVCCï¼ˆMulti-Version Concurrency Control ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼Œä½¿å¾—åœ¨RCå’ŒRRä¸¤ç§éš”ç¦»çº§åˆ«ä¸‹ä½¿å¾—ä¸åŒäº‹åŠ¡çš„**è¯»å†™æ“ä½œå¯ä»¥å¹¶å‘æ‰§è¡Œ**ä»è€Œæå‡æ€§èƒ½\n> è¿™é‡ŒæŒ‡çš„è¯»æ˜¯ **å¿«ç…§è¯»**ï¼Œä¹Ÿå°±æ˜¯æ™®é€šçš„selectè¯­å¥ï¼Œå¦‚æœæ˜¯updateä¹‹ç±»çš„ä¾ç„¶æ˜¯è¦åŠ é”çš„ **å½“å‰è¯»**\n\nMySQLä¸­æ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šè®°å½•ä¸€æ¡undo logï¼Œè¿™äº›undo logä¼šé€šè¿‡roll_pointeræˆä¸€ä¸ªå•é“¾è¡¨ï¼Œç§°ä¹‹ä¸º**ç‰ˆæœ¬é“¾**ï¼Œæ¯æ¡undo logä¼šè®°å½•å½“å‰åˆ›å»ºè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡id\n\nåœ¨RCå’ŒRRçº§åˆ«ä¸‹ï¼ŒæŸ¥è¯¢éœ€è¦ç”¨åˆ°`ReadView`è§†å›¾ï¼Œå…¶ä¸­åŒ…å«äº†ï¼š**å½“å‰æ´»è·ƒçš„äº‹åŠ¡m_ids**ï¼Œ**æ´»è·ƒäº‹åŠ¡idä¸­æœ€å°çš„min_trx_id**ï¼Œä»¥åŠ**ä¸‹ä¸€ä¸ªåˆ†é…çš„äº‹åŠ¡idï¼ˆmax_trx_idï¼‰å¯ä»¥ç†è§£æˆæœ€å¤§äº‹åŠ¡id**ï¼Œç„¶åå»**ç‰ˆæœ¬é“¾**ä¸­ä¾æ¬¡æ‰¾ï¼Œå¦‚æœ\n1. æŸä¸ªç‰ˆæœ¬ï¼ˆundo logï¼‰çš„äº‹åŠ¡idå°äº`Readview`ä¸­çš„æœ€å°äº‹åŠ¡idï¼ˆ`min_trx_id`ï¼‰ï¼Œè¯´æ˜è¯¥ç‰ˆæœ¬äº‹åŠ¡å·²ç»æäº¤äº†ï¼Œå¯ä»¥è®¿é—®ã€‚\n2. äº‹åŠ¡idå¤§äºæœ€å¤§idï¼ˆ`max_trx_id`ï¼‰ï¼Œè¯´æ˜è¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨`ReadView`ä¹‹åæ‰åˆ›å»ºï¼Œæ‰€ä»¥ä¸èƒ½è®¿é—®\n3. äº‹åŠ¡idåœ¨`ReadView`è®°å½•çš„å½“å‰æ´»è·ƒäº‹åŠ¡idsä¸­ï¼Œè¯´æ˜åˆ›å»ºæ”¹ç‰ˆæœ¬çš„äº‹åŠ¡ä»ç„¶æ´»è·ƒï¼Œä¸èƒ½è®¿é—®ï¼Œå¦åˆ™è¯´æ˜å·²ç»æäº¤äº†ï¼Œå¯ä»¥è®¿é—®\n\nè€ŒRUå’ŒRCçš„åŒºåˆ«å°±æ˜¯ç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼ŒRCåœ¨äº‹åŠ¡ä¸­æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šåˆ›å»ºReadViewï¼Œæ‰€ä»¥RCçº§åˆ«å¯ä»¥è¯»å–åˆ°å…¶ä»–äº‹åŠ¡æäº¤åçš„ç‰ˆæœ¬ï¼ˆæäº¤åå†æŸ¥è¯¢ï¼Œé‡æ–°ç”ŸæˆReadViewå°±æ²¡æœ‰ä¹‹å‰æäº¤äº†çš„äº‹åŠ¡IDäº†ï¼‰\n\nè€ŒRRåªåœ¨äº‹åŠ¡å¼€å¯çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªReadViewï¼Œæ‰€ä»¥æ— è®ºå…¶ä»–äº‹åŠ¡åšä»€ä¹ˆæ”¹åŠ¨å½“å‰äº‹åŠ¡éƒ½è¯»å–ä¸åˆ°ï¼ˆå…¶ä»–äº‹åŠ¡idè¦ä¹ˆåœ¨m_idsä¸­è¦ä¹ˆå°±å¤§äºmax_trx_idï¼‰\n### RRçº§åˆ«èƒ½è§£å†³å¹»è¯»é—®é¢˜ä¹ˆï¼Ÿ\né¦–å…ˆRRèƒ½è§£å†³**å¯é‡å¤è¯»**ï¼Œä½†æ˜¯å¹»è¯»å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å…¶å®æ¯ä¸ªäººçœ‹æ³•éƒ½ä¸åŒ\n## ç´¢å¼•\n### ç´¢å¼•åˆ†ç±»\n**ä»æ•°æ®ç»“æ„åˆ’åˆ†**\n1. B+ Tree ç´¢å¼•ï¼šå†…èŠ‚ç‚¹å­˜æ”¾ç›®å½•é¡¹ï¼Œå¶å­èŠ‚ç‚¹å­˜æ”¾æ•°æ®ï¼Œå„ä¸ªé¡µä¹‹é—´ä»¥åŒå‘é“¾è¡¨é“¾æ¥ï¼Œé¡µå†…æ•°æ®ä»¥å•é“¾è¡¨è¿æ¥ï¼Œæ•´ä¸ªå¶å­èŠ‚ç‚¹æ•°æ®éƒ½æ˜¯æŒ‰ç…§**ç´¢å¼•key**æœ‰åºå­˜æ”¾çš„ï¼ŒåŒæ—¶æ¯ä¸ªé¡µè¿˜æœ‰**é¡µç›®å½•**ï¼Œå¯ä»¥é€šè¿‡é¡µç›®å½•äºŒåˆ†æœç´¢å¿«é€Ÿå®šä½è®°å½•\n   \n   ï¼ˆBæ ‘ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œè€ŒB+æ ‘å¶å­èŠ‚ç‚¹å†…æ•°æ®æ˜¯ç”±é“¾è¡¨ä¸²èµ·æ¥çš„ï¼ŒèŒƒå›´æŸ¥è¯¢è¾ƒæ–¹ä¾¿ï¼Œè€Œavlæˆ–è€…RBTreeå±äºäºŒå‰æœç´¢æ ‘ï¼Œå¤šåœ¨å†…å­˜ä¸­ä½¿ç”¨ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸­ç”±äºæ·±åº¦è¿‡é«˜ï¼Œä¼šå¯¼è‡´IOæ•ˆç‡ä½ä¸‹ï¼‰\n2. Hash ç´¢å¼•ï¼ˆHashç´¢å¼•å¿«ä½†æ˜¯ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿä¸æ”¯æŒæ’åºï¼‰\n3. FULLTEXT ç´¢å¼•\n\n**ä»ç‰©ç†å­˜å‚¨åˆ’åˆ†**\n1. èšé›†ç´¢å¼•\n2. éèšé›†ç´¢å¼•\n>èšé›†ç´¢å¼•çš„å¶èŠ‚ç‚¹å°±æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œè€Œéèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä»ç„¶æ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯¹åº”çš„æ•°æ®å—ã€‚MySIAMçš„ç´¢å¼•å®ç°å°±æ˜¯éèšé›†çš„ï¼Œç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œè€ŒInnodbçš„ç´¢å¼•å³æ•°æ®ï¼ŒInnodbä¼šè‡ªåŠ¨åˆ©ç”¨ä¸»é”®å¸®æˆ‘ä»¬åˆ›å»ºèšé›†ç´¢å¼•ï¼Œä¸€å¼ è¡¨èšé›†ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªï¼Œå…¶ä»–çš„éƒ½æ˜¯äºŒçº§ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰\n\n**ä»é€»è¾‘è§’åº¦**\n1. ä¸»é”®ç´¢å¼•\n2. æ™®é€šç´¢å¼•ï¼ˆå•åˆ—ç´¢å¼•ï¼‰\n3. å¤šåˆ—ç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰\n4. å”¯ä¸€ç´¢å¼• & éå”¯ä¸€ç´¢å¼•\n### ç´¢å¼•ä¼˜åŒ–\n1. **ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½**ï¼šé¦–å…ˆç©ºé—´ä¸Šæ¯ä¸ªç´¢å¼•éƒ½ä¼šå»ºç«‹ä¸€é¢—B+Treeï¼Œç©ºé—´æ¶ˆè€—ä¸å®¹å¿½è§†ï¼Œå…¶æ¬¡æ—¶é—´ä¸Šæ¥è¯´ï¼Œç´¢å¼•å¤ªå¤šå½“æˆ‘åšä¿®æ”¹æ“ä½œçš„æ—¶å€™è®¾è®¡åˆ°çš„B+Treeä¹Ÿå°±æ›´å¤šï¼Œæ¯ä¸ªç›¸å…³çš„B+Treeéƒ½éœ€è¦ç»´æŠ¤ï¼Œæ•ˆç‡å¯æƒ³è€ŒçŸ¥\n2. **å…¨å€¼åŒ¹é…**ï¼šæœç´¢æ¡ä»¶å’Œç´¢å¼•åˆ—å®Œå…¨ä¸€è‡´ï¼ˆé¡ºåºä¸ä¸€è‡´ä¹Ÿå¯ä»¥ï¼Œä¼šæœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨è°ƒæ•´ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦è¿™æ ·åšï¼Œæ²¡æœ‰æ„ä¹‰ï¼‰\n3. **åŒ¹é…å·¦è¾¹çš„åˆ—**ï¼šæœç´¢æ¡ä»¶å’Œç´¢å¼•åˆ—å·¦è¾¹éƒ¨åˆ†ä¸€è‡´ï¼ˆé¡ºåºä¹Ÿè¦ä¸€è‡´ï¼‰\n4. **åŒ¹é…åˆ—å‰ç¼€**ï¼šå¯¹äºä¸€äº›å­—ç¬¦ç±»å‹çš„ç´¢å¼•åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åªåŒ¹é…å‰ç¼€å°±èƒ½ç”¨åˆ°ç´¢å¼•ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰¾æ‰€æœ‰åå­—ABå¼€å¤´çš„äºº `SELECT * FROM stu WHERE name LIKE \"AB%\"`è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥ç”¨åˆ°ç´¢å¼•çš„ï¼Œå› ä¸ºå­—ç¬¦çš„æ’åºæœ¬èº«å°±æ˜¯é€šè¿‡å‰ç¼€ä¸€ä¸€å¯¹æ¯”çš„\n5. **åŒ¹é…èŒƒå›´å€¼**ï¼šå¦‚æœå¯¹å¤šä¸ªåˆ—åŒæ—¶è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œåªæœ‰å¯¹ç´¢å¼•æœ€å·¦è¾¹çš„é‚£ä¸ªåˆ—è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™æ‰èƒ½ç”¨åˆ°B+æ ‘ç´¢å¼•ï¼Œå› ä¸ºé€šè¿‡å‰é¢åˆ—èŒƒå›´æŸ¥è¯¢çš„ç»“æœä¸ä¸€å®šæ˜¯æŒ‰ç…§åé¢åˆ—çš„é¡ºåºæ¥çš„\n6. **ç”¨äºæ’åº**ï¼šå½“ä½¿ç”¨è”åˆç´¢å¼•æ—¶éœ€è¦æ³¨æ„é¡ºåºè¦ä¸€è‡´\n7. **ç”¨äºåˆ†ç»„**\n\n**å»ºç«‹ç´¢å¼•çš„è€ƒè™‘ï¼š**\n1. åªä¸ºç”¨äºæœç´¢ï¼Œæ’åºæˆ–è€…åˆ†ç»„çš„åˆ—å»ºç«‹ç´¢å¼•\n2. ä¸ºåˆ—çš„åŸºæ•°å¤§çš„åŠæ¡ˆä¾‹ç´¢å¼•ï¼ˆåŸºæ•°æŒ‡åˆ—ä¸é‡å¤æ•°æ®ä¸ªæ•°ï¼Œä¸€ä¸ªåˆ—åªæœ‰ä¸¤ç§å€¼0ï¼Œ1å°±æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„å¿…è¦ï¼‰\n3. ç´¢å¼•åˆ—çš„ç±»å‹å°½å¯èƒ½å°\n4. è®©ä¸»é”®å…·æœ‰`AUTO_INCREMENT`ï¼Œè®©å­˜å‚¨å¼•æ“è‡ªå·±ä¸ºè¡¨ç”Ÿæˆä¸»é”®ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ’å…¥ï¼Œå› ä¸ºB+Treeæ˜¯æŒ‰ç…§ç´¢å¼•åˆ—é¡ºåºæ’å…¥çš„ï¼Œå¦‚æœæ•°æ®å¾ˆä¹±çš„è¯å°±ä¼šå¯¼è‡´å‰é¢ä¸€ä¸ªï¼Œåé¢ä¸€ä¸ªï¼Œé€ æˆé¡µåˆ†è£‚è®°å½•ç§»ä½ï¼ŒæŸè€—æ€§èƒ½\n\n\n### ç´¢å¼•ä¸‹æ¨ï¼ˆICPï¼šindex condition pushdownï¼‰\nMySQL5.6å¼•å…¥çš„ä¼˜åŒ–ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥è™½ç„¶å‡ºç°äº†ç´¢å¼•ä½†æ˜¯ç¡®æ— æ³•å®Œå…¨åˆ©ç”¨ç´¢å¼•\n`SELECT * FROM s1 WHERE key1 > 'z' AND key1 LIKE '%a';`\næ¯”å¦‚è¿™æ¡è¯­å¥ï¼Œå°±åªæœ‰ç¬¬ä¸€ä¸ªæ¡ä»¶`key1 > 'z'`èƒ½ç”¨åˆ°ç´¢å¼•ï¼Œåé¢çš„æ¡ä»¶å°±éœ€è¦**å›è¡¨**å»åˆ¤æ–­äº†ï¼Œå›è¡¨å°±éœ€è¦å»ä¸»é”®ç´¢å¼•é‡æ–°æ‰¾ï¼Œå¹¶ä¸”æ˜¯éšæœºIOï¼Œæ•ˆç‡ç›¸å¯¹ä½ï¼Œè¿™é‡ŒMySQLåšäº†ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨ç´¢å¼•éå†çš„æ—¶å€™å°±å¯¹ç´¢å¼•åˆ—è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œæ‰€ä»¥ä¸‹æ¨å®é™…ä¸Šæ˜¯æŒ‡å°†Serverå±‚çš„å·¥ä½œä¸‹æ¨åˆ°å¼•æ“å±‚å¤„ç†äº†\n- ICP åªèƒ½ç”¨äºäºŒçº§ç´¢å¼•ï¼Œä¸èƒ½ç”¨äºä¸»ç´¢å¼•ï¼›\n- ä¹Ÿä¸æ˜¯å…¨éƒ¨ where æ¡ä»¶éƒ½å¯ä»¥ç”¨ ICP ç­›é€‰ï¼Œå¦‚æœæŸ where æ¡ä»¶çš„å­—æ®µä¸åœ¨ç´¢å¼•ä¸­ï¼Œå½“ç„¶è¿˜æ˜¯è¦è¯»å–æ•´æ¡è®°å½•åšç­›é€‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»ç„¶è¦åˆ° server ç«¯åš where ç­›é€‰ï¼›\n### éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ\nå‚è€ƒ[MySQLæ–‡æ¡£](https://dev.mysql.com/doc/refman/5.6/en/type-conversion.html)\n\nå½“æ“ä½œç¬¦å·¦å³ä¸¤è¾¹çš„æ•°æ®ç±»å‹ä¸ä¸€è‡´æ—¶ï¼Œä¼šå‘ç”Ÿéšå¼è½¬æ¢ã€‚\n\n1. å½“whereæŸ¥è¯¢æ“ä½œç¬¦**å·¦è¾¹ä¸ºæ•°å€¼ç±»å‹**æ—¶å‘ç”Ÿäº†éšå¼è½¬æ¢ï¼Œé‚£ä¹ˆå¯¹æ•ˆç‡å½±å“ä¸å¤§ï¼Œä½†è¿˜æ˜¯ä¸æ¨èè¿™ä¹ˆåšã€‚\n`select* from test1 where int_column= '10000'`ï¼Œå¯¹äºè¿™æ¡sql `int_column`å­—æ®µæ˜¯æ•´å‹ï¼Œå·¦è¾¹ä¸ºintç±»å‹10000ï¼Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°è¿˜æ˜¯10000ï¼Œå³è¾¹å­—ç¬¦ä¸²ç±»å‹â€™10000â€™ï¼Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ä¹Ÿæ˜¯10000ã€‚ä¸¤è¾¹çš„è½¬æ¢ç»“æœéƒ½æ˜¯å”¯ä¸€ç¡®å®šçš„ï¼Œæ‰€ä»¥ä¸å½±å“ä½¿ç”¨ç´¢å¼•ã€‚\n\n2. å½“whereæŸ¥è¯¢æ“ä½œç¬¦å·¦è¾¹ä¸ºå­—ç¬¦ç±»å‹æ—¶å‘ç”Ÿäº†éšå¼è½¬æ¢ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œé€ æˆå…¨è¡¨æ‰«ææ•ˆç‡æä½ã€‚\n`select* from test1 where str_column= 10000`,å¯¹äºè¿™æ¡sql `str_column`æ˜¯å­—ç¬¦å‹ï¼Œå·¦è¾¹æ˜¯å­—ç¬¦ä¸²ç±»å‹â€™10000â€™ï¼Œè½¬æµ®ç‚¹æ•°ä¸º10000æ˜¯å”¯ä¸€çš„ï¼Œå³è¾¹intç±»å‹10000è½¬æ¢ç»“æœä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚ä½†æ˜¯ï¼Œå› ä¸ºå·¦è¾¹æ˜¯æ£€ç´¢æ¡ä»¶ï¼Œ'10000â€™è½¬åˆ°10000è™½ç„¶æ˜¯å”¯ä¸€ï¼Œä½†æ˜¯å…¶ä»–å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è½¬æ¢ä¸º10000ï¼Œæ¯”å¦‚â€™10000aâ€™ï¼Œâ€˜010000â€™ï¼Œ'10000â€™ç­‰ç­‰éƒ½èƒ½è½¬ä¸ºæµ®ç‚¹æ•°10000ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸èƒ½ç”¨åˆ°ç´¢å¼•çš„\n> å·¦è¾¹ä¸ºæ•°å€¼ç±»å‹å½±å“ä¸å¤§ï¼Œå› ä¸ºå³è¾¹è½¬æ¢ç»“æœæ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯å¦‚æœå·¦è¾¹æ˜¯å­—ç¬¦ç±»å‹ï¼Œé‚£ä¹ˆå³è¾¹çš„å€¼å°±ä¸ç¡®å®šäº†ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ç´¢å¼•\n## é”\n### å…¨å±€é”\nMySQL æä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯ Flush tables with read lock (FTWRL)ï¼ŒåŠ ä¸Šä¹‹åæ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½ä¼šé˜»å¡ï¼Œå¯ä»¥ç”¨äºå…¨åº“é€»è¾‘å¤‡ä»½ã€‚ä¹Ÿå°±æ˜¯æŠŠæ•´åº“æ¯ä¸ªè¡¨éƒ½ select å‡ºæ¥å­˜æˆæ–‡æœ¬ã€‚\n### è¡¨çº§é”\n- è¡¨é”çš„è¯­æ³•æ˜¯ lock tables â€¦ read/write\n- å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯ MDLï¼ˆmetadata lock)ã€‚MDL ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§\n\n### è¡Œé”\né¡¾åæ€ä¹‰å°±æ˜¯é”å®šæŸä¸€è¡Œï¼Œæ¯”å¦‚\n`select * from t where id=1 for update;` å°±ä¼šé”å®šid=1çš„è¿™ä¸€è¡Œæ•°\n\n**ä¸¤é˜¶æ®µé”**: åœ¨ InnoDB äº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ **ä¸¤é˜¶æ®µé”åè®®**ã€‚\nå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ï¼ˆçƒ­ç‚¹æ•°æ®ï¼‰ã€‚\n\n### é—´éš™é”\nRRçº§åˆ«ä¸‹ä¸ºäº†ç¦æ­¢å¹»è¯»è€Œäº§ç”Ÿçš„ï¼Œé”çš„æ˜¯è®°å½•ä¹‹é—´çš„é—´éš™ï¼Œé—´éš™é”ä¹‹é—´æ˜¯ä¸äº’æ–¥çš„ï¼Œäº’æ–¥çš„æ˜¯**å¾€é—´éš™ä¸­æ’å…¥è®°å½•**çš„æ“ä½œï¼Œæ‰€ä»¥RRçº§åˆ«ä¸‹ï¼ŒåŠ é”å°±ä¸åªæ˜¯åŠ è¡Œé”ï¼Œè¿˜å›åŠ é—´éš™é”ï¼Œå…±åŒå½¢æˆäº†`next_key_lock`\n\n**é—´éš™é”é€ æˆæ­»é”æ¡ˆä¾‹**\n```sql\nbegin;\nselect * from t where id=N for update;\n/*å¦‚æœè¡Œä¸å­˜åœ¨*/\ninsert into t values(N,N,N); \ncommit;\n```\n![wd3VzQ.png](https://s1.ax1x.com/2020/09/12/wd3VzQ.png)\n### æ­»é”å’Œæ­»é”æ£€æµ‹\n\n![wUwb4I.png](https://s1.ax1x.com/2020/09/12/wUwb4I.png)\n\nå¦‚ä¸Šå›¾ï¼Œäº‹åŠ¡AæŠ¢å äº†id=1è¿™ä¸€è¡Œçš„è¡Œé”ï¼Œè€Œäº‹åŠ¡BæŠ¢å äº†id=2è¿™ä¸€è¡Œçš„è¡Œé”ï¼Œæ¥ä¸‹æ¥å°±é™·å…¥äº†å¾ªç¯ç­‰å¾…ï¼Œä¸¤ä¸ªäº‹åŠ¡ä¼šç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œæ˜¾ç„¶æ•°æ®åº“æ˜¯ä¸èƒ½å…è®¸è¿™ç§æƒ…å†µå‘ç”Ÿçš„ï¼Œæ‰€ä»¥æ­¤æ—¶æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ\n1. ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼Œè¿™é‡Œæ˜¯é€šè¿‡innodbçš„`innodb_lock_wait_timeout`æ¥æ§åˆ¶çš„ï¼Œè¿™ä¸ªå€¼é»˜è®¤æ˜¯50sï¼Œæ˜¾ç„¶åœ¨çº¿ä¸ŠæœåŠ¡ï¼Œè¿™æ ·çš„ç­‰å¾…æ˜¯ä¸èƒ½æ¥æ”¶çš„\n2. å‘èµ·**æ­»é”æ£€æµ‹**ï¼Œå‘ç°æ­»é”åä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼ˆä¸€èˆ¬æ˜¯æ¯”è¾ƒå°çš„äº‹åŠ¡ï¼‰ï¼Œä½†æ˜¯æ­»é”æ£€æµ‹æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼ˆæœ‰å‘å›¾ç¯è·¯æ£€æµ‹ï¼Ÿï¼‰ï¼Œ\n\né™¤äº†ä¸Šé¢çš„æ–¹æ¡ˆï¼Œå…¶å®ä¹Ÿæœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚ ä¿®æ”¹MySQLçš„æºç åœ¨è¿›å…¥å¼•æ“ä¹‹å‰ä½¿ç›¸åŒè¡Œçš„æ›´æ–°æ“ä½œæ’é˜Ÿï¼Œæˆ–è€…é€šè¿‡ä¸­é—´ä»¶çš„å½¢å¼ä¹Ÿè¡Œã€‚æˆ–è€…å¯ä»¥é€šè¿‡**åˆ†æ•£ç«äº‰**çš„æ–¹å¼æ¥å‡å°‘é”å†²çªï¼Œå°†çƒ­ç‚¹æ•°æ®æ‰“æ•£ï¼Œç±»ä¼¼`LongAdder`çš„æ€æƒ³ï¼Œè¿™æ ·ç«äº‰å°±ä¼šå°å¾ˆå¤§\n# Redis\n## ä¸ºä»€ä¹ˆå¿«ï¼Ÿ\nRedisæ‰€æœ‰æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿæ˜¯Redisé€Ÿåº¦å¿«çš„ä¸»è¦åŸå› ã€‚[IOå¤šè·¯å¤ç”¨](#å¤šè·¯å¤ç”¨)ç›‘å¬å¤šä¸ªäº‹ä»¶ï¼Œåœ¨å†…å­˜ä¸­å¿«é€Ÿå“åº”\n## æ•°æ®ç±»å‹\n1. å­—ç¬¦ä¸²ï¼šåº•å±‚å°è£…äº†ä¸€ä¸ªSDSç»“æ„ï¼Œå¯¹æ¯”Cè¯­è¨€å­—ç¬¦ä¸²ï¼Œè®°å½•äº†å­—ç¬¦çš„é•¿åº¦ï¼Œå¯ä»¥O(1)è·å–é•¿åº¦ã€‚ä¸»åŠ¨æ‰©å®¹ï¼Œé¿å…ç¼“å†²åŒºæº¢å‡ºã€‚ç©ºé—´é¢„åˆ†é…ä»¥åŠæƒ°æ€§åˆ é™¤å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°\n2. å“ˆå¸Œï¼ˆå†…éƒ¨ç¼–ç ï¼šå°äºé˜ˆå€¼ziplistï¼Œå¦åˆ™hashtableï¼‰\n3. åˆ—è¡¨ï¼ˆå†…éƒ¨ç¼–ç ï¼šziplistï¼Œlinkedlistï¼Œquicklistï¼‰\n4. é›†åˆï¼ˆå†…éƒ¨ç¼–ç ï¼šå°äºé˜ˆå€¼intsetï¼Œå¦åˆ™hashtableï¼‰\n5. æœ‰åºé›†åˆï¼ˆå†…éƒ¨ç¼–ç ï¼šziplistæˆ–skiplistï¼Œå…ƒç´ ä¸ªæ•°å°äºé˜ˆå€¼å°±æ˜¯ziplistï¼Œå¦åˆ™å°±æ˜¯skiplistï¼‰\n\n**ziplist**: å†…éƒ¨è¡¨ç°ä¸ºæ’åˆ—ç´§å‡‘çš„ä¸€å—è¿ç»­å†…å­˜æ•°ç»„ï¼Œæ–°å¢å’Œåˆ é™¤ä¼šæ¶‰åŠå†…å­˜çš„é‡æ–°åˆ†é…å’Œé‡Šæ”¾ï¼Œè¯»å†™æ“ä½œæ¶‰åŠå¤æ‚çš„æŒ‡é’ˆç§»åŠ¨å¤æ‚åº¦è¾ƒé«˜å¯ä»¥ä½œä¸ºhashï¼Œlistï¼Œzsetå°æ•°æ®é‡çš„ç»“æ„\n\n**intset**ï¼šé›†åˆsetç±»å‹ç¼–ç çš„ä¸€ç§ï¼Œå†…éƒ¨ä¸ºå­˜å‚¨æœ‰åºï¼Œä¸é‡å¤çš„æ•´æ•°é›†åˆåº•å±‚ç»“æ„ä¸ºæ•°ç»„\n\n## æŒä¹…åŒ–\n### RDBï¼ˆå¿«ç…§ï¼‰\næŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹ï¼Œï¼ˆä¹Ÿå¯ä»¥ä½œä¸ºä¸»ä»å¤åˆ¶çš„åª’ä»‹ï¼‰\n\n**save**ï¼š ä¼šé˜»å¡å½“å‰RedisæœåŠ¡ï¼Œç›´åˆ°RDBè¿‡ç¨‹å®Œæˆï¼Œå¯¹äºå†…å­˜è¾ƒå¤§çš„å®ä¾‹ï¼Œå½±å“ä¼šæ¯”è¾ƒå¤§ï¼Œçº¿ä¸Šä¸æ¨èä½¿ç”¨\n\n**bgsave**ï¼šRedisè¿›ç¨‹forkå‡ºå­è¿›ç¨‹ï¼Œç”±äºforkä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼ˆå¹¶ä¸ä¼šå¤åˆ¶å†…å­˜ï¼Œè€Œæ˜¯é‡‡ç”¨COWï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿå¤§é‡æ‹·è´æ¶ˆè€—ï¼‰ï¼Œæ‰€ä»¥å­è¿›ç¨‹å¯ä»¥å…±äº«çˆ¶è¿›ç¨‹çš„å†…å­˜æ•°æ®ï¼Œè¿›è€Œåœ¨åå°è¿›è¡ŒæŒä¹…åŒ–ç”ŸæˆRDB\n\n**è§¦å‘æ—¶æœº**\n\n- æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤è§¦å‘\n- ä½¿ç”¨saveç›¸å…³é…ç½®ï¼Œå¦‚save m n è¡¨ç¤ºåœ¨mç§’å†…å­˜åœ¨næ¬¡ä¿®æ”¹è‡ªåŠ¨è§¦å‘bgsaveï¼ˆå¹¶ä¸å¥½ï¼Œå¹¶å‘é‡ä¸å¥½é¢„ä¼°ï¼Œä¸æ°å½“çš„è®¾ç½®ä¼šå¯¼è‡´RDBè¿‡å¤šï¼‰\n- æ‰§è¡Œdebug reload é‡å†™åŠ è½½Redisçš„æ—¶å€™\n- ä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œbgsaveç”ŸæˆRDBæ–‡ä»¶å¹¶å‘é€ç»™ä»èŠ‚ç‚¹\n- é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œshutdownçš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯AOFä¹Ÿä¼šè‡ªåŠ¨æ‰§è¡Œbgsave\n\n**ä¼˜ç‚¹**\n\n- RDBæ˜¯ä¸€ä¸ªç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»£è¡¨RedisæŸä¸€ä¸ªæ—¶åˆ»çš„æ•°æ®å¿«ç…§ï¼Œéå¸¸é€‚åˆç”¨äºå¤‡ä»½ï¼Œå¤åˆ¶\n- RedisåŠ è½½RDBæ¢å¤çš„æ•°æ®ä¼šæ¯”AOFå¿«\n\n**ç¼ºç‚¹**\n\n- RDBæ— æ³•åšåˆ° **å®æ—¶/å¦™çº§** æŒä¹…åŒ–ï¼ŒRDBéœ€è¦ä¿å­˜æ•´ä¸ªå†…å­˜çš„æ•°æ®ï¼Œé¢‘ç¹çš„æ‰§è¡ŒRDBæ“ä½œæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå¤§\n\n### AOFï¼ˆæ—¥å¿—ï¼‰\nä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œé‡å¯çš„æ—¶å€™å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„\n\næ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šè¿½åŠ åˆ°`aof_buf`ç¼“å†²åŒºä¸­ï¼Œç¼“å†²åŒºä¼šæ ¹æ®ä¸€å®šçš„ **åŒæ­¥ç­–ç•¥** è¿›è¡Œ`fsync`åˆ·ç›˜ï¼Œéšç€AOFæ–‡ä»¶çš„ä¸æ–­å¢å¤§ï¼Œéœ€è¦å®šæœŸè¿›è¡Œ **AOFé‡å†™** ï¼Œæ¸…é™¤è¿›ç¨‹å†…è¿‡æœŸçš„æ•°æ®ï¼Œè¯»å–è¿›ç¨‹æ•°æ®åªä¿ç•™æœ€ç»ˆæ•°æ®å†™å…¥å‘½ä»¤ï¼Œåˆå¹¶å¤šæ¡å‘½ä»¤ï¼Œä»¥è¾¾åˆ°å‹ç¼©ç©ºé—´çš„ç›®çš„\n\n**åŒæ­¥ç­–ç•¥**\n\n1. **always** : å‘½ä»¤å†™å…¥`aof_buf`åç«‹é©¬`fsync`åˆ·ç›˜ï¼Œå½“åˆ·ç›˜å®Œæˆåè¿”å›ï¼Œæ˜¾ç„¶è¿™ç§æ–¹å¼æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯IOçš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œé¢‘ç¹çš„å†™å…¥ä¼šå¾ˆå½±å“æ€§èƒ½\n2. **everysec** : å‘½ä»¤å†™å…¥`aof_buf`åè°ƒç”¨`write`ï¼Œåå°çº¿ç¨‹ä¼šæ¯ç§’æ‰§è¡Œä¸€æ¬¡`fsync`ï¼Œæ¨èçš„ç­–ç•¥ï¼Œå³ä½¿æ˜¯å®•æœºä¹Ÿåªä¼šä¸¢å¤±1sçš„æ•°æ®\n3. **no** ï¼šå‘½ä»¤å†™å…¥`aof_buf`åè°ƒç”¨`write`ç„¶åæ—§ä¸ç®¡äº†ï¼ŒåŒæ­¥æ“ä½œäº¤ç»™OSï¼Œä¸æ¨èï¼Œä¸å¤ªå¯é \n\n> `write`åªæ˜¯å°†æ•°æ®å†™å…¥é¡µç¼“å­˜åŒºï¼ŒåŒæ­¥ç£ç›˜çš„æ“ä½œä¼šäº¤ç»™OSè°ƒåº¦ï¼Œå¦‚æœåœ¨åŒæ­¥ä¹‹å‰å®•æœºï¼Œé‚£ä¹ˆæ•°å°±ä¼šä¸¢å¤±\n\n\n**AOFé‡å†™**\n\n1. ä¸»è¿›ç¨‹forkä»å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹è¿›è¡ŒAOFçš„é‡å†™\n2. ä¸»è¿›ç¨‹ç»§ç»­å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¿™éƒ¨åˆ†æ•°æ®ä¹Ÿä¸èƒ½å°±è¿™æ ·ä¸¢æ‰ï¼Œæ­¤æ—¶äº§ç”Ÿçš„AOFæ—¥å¿—ä¼šå†™å…¥ **AOFé‡å†™ç¼“å†²åŒº**\n3. å­è¿›ç¨‹å®Œæˆåï¼Œçˆ¶è¿›ç¨‹å°†AOFé‡å†™ç¼“å†²åŒºçš„æ•°æ®å†™å…¥æ–°çš„AOFæ–‡ä»¶ï¼Œç„¶åæ›¿æ¢æ—§çš„AOFæ–‡ä»¶\n\n## å†…å­˜å›æ”¶ç­–ç•¥\n\n### åˆ é™¤åˆ°è¾¾è¿‡æœŸæ—¶é—´çš„é”®å¯¹è±¡\n- **æƒ°æ€§åˆ é™¤**ï¼šå½“å®¢æˆ·ç«¯è¯»å–åˆ°å·²ç»è¶…æ—¶çš„é”®ï¼Œå°±æ‰§è¡Œåˆ é™¤æ“ä½œå¹¶è¿”å›ç©ºï¼Œè¿™ç­–ç•¥æ˜¯ä¸ºäº†èŠ‚çº¦CPUèµ„æºï¼Œä¸éœ€è¦å•ç‹¬ç»´æŠ¤TTLé“¾è¡¨æ¥å¤„ç†è¿‡æœŸé”®çš„åˆ é™¤ã€‚å•ç‹¬ä½¿ç”¨è¿™ç§æ–¹å¼å­˜åœ¨å†…å‡ºæ³„éœ²çš„é—®é¢˜ï¼Œå½“è¿‡æœŸé”®ä¸€ç›´æ²¡æœ‰è¢«è®¿é—®å°†æ— æ³•å¾—åˆ°å³æ—¶åˆ é™¤ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ— æ³•çš„å³æ—¶é‡Šæ”¾\n- **å®šæ—¶ä»»åŠ¡åˆ é™¤**ï¼šRediså†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œé»˜è®¤æ¯ç§’è¿è¡Œ10æ¬¡ï¼Œå®šæ—¶ä»»åŠ¡ä¸­åˆ é™¤è¿‡æœŸé”®é‡‡ç”¨äº†è‡ªé€‚åº”ç®—æ³•ï¼Œæ ¹æ®è¿‡æœŸé”®çš„æ¯”ä¾‹é‡‡ç”¨å¿«æ¨¡å¼æˆ–è€…æ…¢æ¨¡å¼ï¼Œæ¯ä¸ªæ•°æ®åº“ç©ºé—´æŠ½å–20ä¸ªé”®ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¶…è¿‡25%çš„é”®è¿‡æœŸï¼Œå¦‚æœè¶…è¿‡å°±ä¼šä¸€ç›´å¾ªç¯ç›´åˆ°å°äº25%æˆ–è€…è¶…æ—¶\n\n### å†…å­˜è¾¾åˆ°max_memoryçš„é€‚åˆè§¦å‘å†…å­˜æº¢å‡ºæ§åˆ¶\n\n- novicationï¼šä¸åˆ é™¤ä»»åŠ¡æ•°æ®ï¼Œæ‹’ç»ä»»ä½•å†™å…¥æ“ä½œï¼Œå¹¶ä¸”è¿”å›å®¢æˆ·ç«¯OOM\n- volatile-lruï¼šæ ¹æ®lruç­–ç•¥ä»è®¾ç½®äº†è¶…æ—¶æ—¶é—´çš„é”®ä¸­å‰”é™¤\n- volatile-randomï¼šéšæœºä»è®¾ç½®äº†è¶…æ—¶æ—¶é—´çš„é”®ä¸­å‰”é™¤\n- volatile-ttlï¼šä»è®¾ç½®äº†è¶…æ—¶æ—¶é—´çš„é”®ä¸­ï¼Œé€‰æ‹©æœ€æ—©è¿‡æœŸçš„å‰”é™¤\n- allkeys-randomï¼šä»æ‰€æœ‰é”®ä¸­éšæœºå‰”é™¤\n- allkeys-lruï¼šä»æ‰€æœ‰é”®ä¸­æŒ‰ç…§lruè§„åˆ™å‰”é™¤\n\n## ç¼“å­˜ç©¿é€\næŒ‡æ¶æ„æ”»å‡»æˆ–è€…çˆ¬è™«ï¼Œæ¶æ„æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œå› ä¸ºä¸å­˜åœ¨åˆ™ä¸ä¼šå†™åˆ°ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šå»è¯·æ±‚ DBï¼Œå¦‚æœç¬é—´æµé‡è¿‡å¤§ï¼Œç©¿é€åˆ° DBå°±ä¼šå¯¼è‡´å®•æœº\n\n**è§£å†³æ–¹æ¡ˆ**\n1. **ç¼“å­˜ç©ºå¯¹è±¡**ï¼Œå°†DBæŸ¥è¯¢ä¸ºç©ºçš„keyä¹Ÿå­˜åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åè®¾ç½®ä¸€æ®µè¿‡æœŸæ—¶é—´ï¼Œåé¢ç›¸åŒçš„keyå°±å¯ä»¥é€šè¿‡ç¼“å­˜è·å–ï¼Œä¸ç”¨æŸ¥DBï¼Œç¡®å®šä¹Ÿæ˜¾è€Œæ˜“è§ï¼Œå¦‚æœåŒæ—¶æ„é€ å¤šä¸ªä¸åŒçš„keyä¾ç„¶ä¼šå¯¼è‡´ç©¿é€\n2. **å¸ƒéš†è¿‡æ»¤å™¨**ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„HashMapï¼Œå¸ƒéš†è¿‡æ»¤å™¨æ›´çœå†…å­˜æŸ¥è¯¢ä¹Ÿæ›´å¿«ï¼Œåº•å±‚æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½å›¾ï¼Œå’Œä¸€äº›Hashå‡½æ•°ï¼Œå½“å‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­å­˜å…¥ä¸€äº›keyçš„æ—¶å€™ï¼Œé¦–å…ˆå¯¹keyè¿›è¡Œkæ¬¡hashï¼Œç„¶åå°†bitmapä¸­å¯¹åº”ä½ç½®è®¾ç½®ä¸º1ï¼Œå½“åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦åœ¨é›†åˆä¸­çš„æ—¶å€™ï¼Œåªéœ€è¦å°†keyå†æ¬¡hashï¼Œå¹¶åˆ¤æ–­æ‰€æœ‰å¯¹åº”çš„ä½ç½®æ˜¯å¦ä¸º1ï¼Œå¦‚æœéƒ½ä¸º1ï¼Œè¯´æ˜è¿™ä¸ªkey**æœ‰å¾ˆå¤§å¯èƒ½åœ¨é›†åˆä¸­**ï¼Œåä¹‹ï¼Œå¦‚æœå¹¶ä¸æ˜¯æ‰€æœ‰ä½ç½®éƒ½ä¸º1ï¼Œå°±è¯´æ˜è¿™ä¸ªkey**ä¸€å®šä¸åœ¨é›†åˆä¸­**ï¼Œæ•´ä½“çš„è¯¯åˆ¤ç‡å’Œæ’å…¥å…ƒç´ çš„ä¸ªæ•°ï¼Œä»¥åŠå“ˆå¸Œçš„æ¬¡æ•°ï¼Œè¿˜æœ‰ä½å›¾çš„é•¿åº¦éƒ½æœ‰å…³ ï¼Œå¦å¤–å¸ƒéš†è¿‡æ»¤å™¨ä¹Ÿä¸æ”¯æŒåˆ é™¤æ“ä½œ\n![wTW711.png](https://s1.ax1x.com/2020/09/20/wTW711.png)\n## ç¼“å­˜å‡»ç©¿\nå¦‚æœä¸€ä¸ªçƒ­ç‚¹keyçªç„¶è¿‡æœŸï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥æ‰“åˆ°DBå±‚å‹å®DBï¼Œè€Œå¸¸è§„çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š\n1. ç¼“å­˜æ°¸ä¸è¿‡æœŸï¼Œç±»ä¼¼[Redisä¸­çš„æƒ°æ€§åˆ é™¤](#å†…å­˜å›æ”¶ç­–ç•¥)ï¼Œä»…ä»…è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å½“è®¿é—®ä¸€ä¸ªè¿‡æœŸçš„keyæ—¶ï¼Œè¯·æ±‚ä¸ä¼šç›´æ¥æ‰“åˆ°DBï¼Œç„¶åæˆ‘ä»¬é€šè¿‡åå°å¼‚æ­¥çº¿ç¨‹å»æ›´æ–°ç¼“å­˜ï¼Œè¿™æ ·åšç”¨æˆ·å»¶è¿Ÿæ˜¯æœ€ä½çš„ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰æ•°æ®çš„ä¸ä¸€è‡´ï¼Œæœ‰çš„çº¿ç¨‹è¯»å–çš„ä»ç„¶æ˜¯è€æ•°æ®\n2. äº’æ–¥é”ï¼Œå½“å¤šä¸ªè¯·æ±‚åŒæ—¶å»getçƒ­ç‚¹æ•°æ®çš„æ—¶å€™ï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚æ•°æ®çš„æ—¶å€™è¿›è¡ŒåŠ é”ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°æ•°æ®åè¿›è¡Œçƒ­ç‚¹keyé‡å»ºç„¶åé‡Šæ”¾é”ï¼Œå…¶ä»–è¯·æ±‚å°±ç›´æ¥ä»ç¼“å­˜ä¸­getæ•°æ®ï¼Œä¸ç”¨å†å»DBè¯·æ±‚æ•°æ®\n\n## ä¸»ä»å¤åˆ¶\nå¯ä»¥ç”¨äºé…åˆ **è¯»å†™åˆ†ç¦»** åš **è´Ÿè½½å‡è¡¡** ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ•…éšœæ¢å¤ï¼Œæ•°æ®å†—ä½™\n1. slaveå¯åŠ¨åä¼šå…ˆmasterå‘é€SYNCçš„åŒæ­¥å‘½ä»¤\n2. Masteræ”¶åˆ°åä¼šä½¿ç”¨bgsaveåå°ç”ŸæˆRDBæ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†ä¸»çº¿ç¨‹å½“å‰è¿›è¡Œçš„å‘½ä»¤ä¹Ÿä¿å­˜åˆ°ç¼“å†²åŒº\n3. Masterå°†RDBå’ŒBufferä¸­çš„éƒ½å‘é€ç»™Slave\n4. Slaveå°†æ¥æ”¶åˆ°çš„æ•°æ®æ¢å¤åˆ°å†…å­˜ä¸­\n\n**ç¼ºç‚¹**\n1. æ•°æ®ä¸€è‡´æ€§é—®é¢˜\n2. ä¸»èŠ‚ç‚¹æŒ‚æ‰åéœ€è¦äººå·¥å¹²é¢„ï¼Œä¸èƒ½è‡ªåŠ¨æ¢å¤\n> **éƒ¨åˆ†å¤åˆ¶** æ ¹æ®èŠ‚ç‚¹idå’Œoffsetï¼Œå¤åˆ¶ç¼“å†²åŒº\n## å“¨å…µæ¨¡å¼\nå“¨å…µæ˜¯ä¸»ä»çš„å‡çº§ç‰ˆï¼Œéƒ¨ç½²sentinelç›‘æ§ä¸»ä»çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœå‘ç°å¼‚å¸¸å°±ä¼šå‘å‡ºè­¦å‘Šï¼Œç„¶åå¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œå½“Masterå‡ºç°æ•…éšœçš„æ—¶å€™ä¼šè‡ªåŠ¨é€‰ä¸¾ä¸€ä¸ªslaveä½œä¸ºmasteré¡¶ä¸Šå»\n\n**Masterä¸‹çº¿**\n\nå½“sentinelå¯åŠ¨çš„æ—¶å€™ä¼šå’Œmasterå»ºç«‹è¿æ¥ï¼Œè®¢é˜…masterçš„é¢‘é“ï¼Œç„¶åå®šæœŸï¼ˆ10sï¼‰å‘Masterå’ŒSlaveå‘é€`INFO`æˆ–è€…`PING`æ¶ˆæ¯ï¼Œç”¨äºå“¨å…µå’Œå“¨å…µï¼Œå“¨å…µå’ŒMasteré€šä¿¡ï¼Œå¦‚æœå“¨å…µå‘é€çš„`PING`åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œå‘é€çš„å“¨å…µå°±ä¼šè®¤ä¸ºè¯¥Master **ä¸»è§‚ä¸‹çº¿**ï¼ŒåŒæ—¶è¯¢é—®å…¶ä»–å“¨å…µæ˜¯å¦ä¹Ÿè®¤ä¸ºä¸‹çº¿ï¼Œå¦‚æœè¾¾åˆ°ä¸€å®šæ•°é‡ï¼ˆquorumï¼‰å°±ä¼šè®¤ä¸ºè¯¥èŠ‚ç‚¹ **å®¢è§‚ä¸‹çº¿**\n\nç„¶åä¼šåœ¨å“¨å…µä¸­é€‰å–ä¸€ä¸ªLeaderå“¨å…µï¼Œç”±å®ƒæ¥è¿›è¡Œæ•…éšœæ¢å¤ï¼Œä»æ‰€æœ‰çš„slaveä¸­é€‰å–ä¸€ä¸ªä¼˜å…ˆçº§æœ€å¤§çš„ï¼Œå¦‚æœä¼˜å…ˆçº§ç›¸åŒå°±ä¼šé€‰æ‹©åç§»é‡å¤§ï¼Œåç§»é‡å¤§æ„å‘³ç€æ•°æ®æ›´åŠ å®Œæ•´\n\n## Clusterï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰\n\nå‰é¢å“¨å…µå¯ä»¥è§£å†³ä¸»ä»ä¸èƒ½è‡ªåŠ¨æ¢å¤çš„é—®é¢˜ï¼Œä½†æ˜¯ä»ç„¶ä¼šå­˜åœ¨éš¾ä»¥æ‰©å®¹ä»¥åŠè¯»å†™ç“¶é¢ˆé—®é¢˜ï¼Œä¸”ä¸»ä»å¤åˆ¶å„ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æ˜¯æ•°æ®å†—ä½™æ¶ˆè€—å¤§é‡å­˜å‚¨ç©ºé—´\n\nredis cluster æœ‰å›ºå®šçš„ 16384 ä¸ª hash slotï¼Œæ¯ä¸ªMasterèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†slotï¼Œå¯¹keyè®¡ç®—cyc16å€¼ç„¶åå¯¹16348å–æ¨¡ï¼Œè·å–keyå¯¹åº”çš„hash slotï¼Œç„¶åå­˜å‚¨åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼Œå°† **æ•°æ®å’ŒèŠ‚ç‚¹è§£è€¦**ï¼Œå¹¶ä¸ç”¨å…³ç³»æ•°æ®åœ¨é‚£ä¸ªèŠ‚ç‚¹ï¼Œä»…ä»…å…³å¿ƒæ•°æ®çš„æ§½åœ¨å“ªé‡Œå°±è¡Œäº†\n\n>æ— ä¸­å¿ƒçš„æ¶æ„æ¨¡å¼ï¼Œæœ€ç»ˆä¸€è‡´æ€§\n\n## å¯¹æ¯”Memcached\n- Redisæ”¯æŒçš„æ•°æ®ç±»å‹æ›´å¤šï¼Œæ¯”å¦‚Hashï¼ŒSetï¼ŒSortSetç­‰ï¼Œè€ŒMemcacheåªæ”¯æŒç®€å•çš„k-vç»“æ„ï¼Œå¤æ‚çš„å¯¹è±¡éœ€è¦å®¢æˆ·ç«¯æ‰‹åŠ¨åºåˆ—åŒ–ï¼Œ100kä»¥ä¸Šçš„å¯¹è±¡ï¼ŒMemcachedæ€§èƒ½ä¼šæ›´å¥½\n- Redisæ”¯æŒ[æ•°æ®æŒä¹…åŒ–](#æŒä¹…åŒ–)ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œè€ŒMemcacheä¸æ”¯æŒ\n- MemcachedæœåŠ¡å™¨æœ¬èº«ä¸æ”¯æŒé›†ç¾¤ï¼Œéœ€è¦å®¢æˆ·ç«¯è¿›è¡Œä¸€è‡´æ€§Hashæˆ–è€…ä»£ç†ä¸­é—´ä»¶æ”¯æŒé›†ç¾¤ï¼Œè€ŒRedisæœåŠ¡å™¨æœ¬èº«æ”¯æŒé›†ç¾¤\n- Redisæ˜¯çš„æ ¸å¿ƒæ•°æ®æäº¤æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä¿è¯äº†æ•°æ®æŒ‰é¡ºåºæäº¤ï¼ŒMemcachedä½¿ç”¨CASç¡®ä¿å¹¶å‘çš„ä¸€è‡´æ€§\n- åŸºäºä¸Šä¸€ç‚¹ï¼ŒRedisåªèƒ½åˆ©ç”¨å•æ ¸ï¼Œè€ŒMemcachedå¯ä»¥åˆ©ç”¨å¤šæ ¸ï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šå¯èƒ½ä¼šå¥½ä¸€ç‚¹\n\n# åˆ†å¸ƒå¼\n## Zookeeperä¿è¯CP\n\nå½“å‘æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢æœåŠ¡åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®¹å¿æ³¨å†Œä¸­å¿ƒè¿”å›çš„æ˜¯å‡ åˆ†é’Ÿä»¥å‰çš„æ³¨å†Œä¿¡æ¯ï¼Œä½†ä¸èƒ½æ¥å—æœåŠ¡ç›´æ¥downæ‰ä¸å¯ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡æ³¨å†ŒåŠŸèƒ½å¯¹å¯ç”¨æ€§çš„è¦æ±‚è¦é«˜äºä¸€è‡´æ€§ã€‚ä½†æ˜¯zkä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå½“masterèŠ‚ç‚¹å› ä¸ºç½‘ç»œæ•…éšœä¸å…¶ä»–èŠ‚ç‚¹å¤±å»è”ç³»æ—¶ï¼Œå‰©ä½™èŠ‚ç‚¹ä¼šé‡æ–°è¿›è¡Œleaderé€‰ä¸¾ã€‚é—®é¢˜åœ¨äºï¼Œé€‰ä¸¾leaderçš„æ—¶é—´å¤ªé•¿ï¼Œ30 ~ 120s, ä¸”é€‰ä¸¾æœŸé—´æ•´ä¸ªzké›†ç¾¤éƒ½æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™å°±å¯¼è‡´åœ¨é€‰ä¸¾æœŸé—´æ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚åœ¨äº‘éƒ¨ç½²çš„ç¯å¢ƒä¸‹ï¼Œå› ç½‘ç»œé—®é¢˜ä½¿å¾—zké›†ç¾¤å¤±å»masterèŠ‚ç‚¹æ˜¯è¾ƒå¤§æ¦‚ç‡ä¼šå‘ç”Ÿçš„äº‹ï¼Œè™½ç„¶æœåŠ¡èƒ½å¤Ÿæœ€ç»ˆæ¢å¤ï¼Œä½†æ˜¯æ¼«é•¿çš„é€‰ä¸¾æ—¶é—´å¯¼è‡´çš„æ³¨å†Œé•¿æœŸä¸å¯ç”¨æ˜¯ä¸èƒ½å®¹å¿çš„ã€‚\n\n## Eurekaä¿è¯AP\n\nEurekaçœ‹æ˜ç™½äº†è¿™ä¸€ç‚¹ï¼Œå› æ­¤åœ¨è®¾è®¡æ—¶å°±ä¼˜å…ˆä¿è¯å¯ç”¨æ€§ã€‚Eurekaå„ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œå‡ ä¸ªèŠ‚ç‚¹æŒ‚æ‰ä¸ä¼šå½±å“æ­£å¸¸èŠ‚ç‚¹çš„å·¥ä½œï¼Œå‰©ä½™çš„èŠ‚ç‚¹ä¾ç„¶å¯ä»¥æä¾›æ³¨å†Œå’ŒæŸ¥è¯¢æœåŠ¡ã€‚è€ŒEurekaçš„å®¢æˆ·ç«¯åœ¨å‘æŸä¸ªEurekaæ³¨å†Œæˆ–æ—¶å¦‚æœå‘ç°è¿æ¥å¤±è´¥ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ‡æ¢è‡³å…¶å®ƒèŠ‚ç‚¹ï¼Œåªè¦æœ‰ä¸€å°Eurekaè¿˜åœ¨ï¼Œå°±èƒ½ä¿è¯æ³¨å†ŒæœåŠ¡å¯ç”¨(ä¿è¯å¯ç”¨æ€§)ï¼Œåªä¸è¿‡æŸ¥åˆ°çš„ä¿¡æ¯å¯èƒ½ä¸æ˜¯æœ€æ–°çš„(ä¸ä¿è¯å¼ºä¸€è‡´æ€§)ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒEurekaè¿˜æœ‰ä¸€ç§è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œå¦‚æœåœ¨15åˆ†é’Ÿå†…è¶…è¿‡85%çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰æ­£å¸¸çš„å¿ƒè·³ï¼Œé‚£ä¹ˆEurekaå°±è®¤ä¸ºå®¢æˆ·ç«¯ä¸æ³¨å†Œä¸­å¿ƒå‡ºç°äº†ç½‘ç»œæ•…éšœï¼Œæ­¤æ—¶ä¼šå‡ºç°ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š\n1. Eurekaä¸å†ä»æ³¨å†Œåˆ—è¡¨ä¸­ç§»é™¤å› ä¸ºé•¿æ—¶é—´æ²¡æ”¶åˆ°å¿ƒè·³è€Œåº”è¯¥è¿‡æœŸçš„æœåŠ¡\n2. Eurekaä»ç„¶èƒ½å¤Ÿæ¥å—æ–°æœåŠ¡çš„æ³¨å†Œå’ŒæŸ¥è¯¢è¯·æ±‚ï¼Œä½†æ˜¯ä¸ä¼šè¢«åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸Š(å³ä¿è¯å½“å‰èŠ‚ç‚¹ä¾ç„¶å¯ç”¨)\n3. å½“ç½‘ç»œç¨³å®šæ—¶ï¼Œå½“å‰å®ä¾‹æ–°çš„æ³¨å†Œä¿¡æ¯ä¼šè¢«åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸­\n\nå› æ­¤ï¼Œ Eurekaå¯ä»¥å¾ˆå¥½çš„åº”å¯¹å› ç½‘ç»œæ•…éšœå¯¼è‡´éƒ¨åˆ†èŠ‚ç‚¹å¤±å»è”ç³»çš„æƒ…å†µï¼Œè€Œä¸ä¼šåƒzookeeperé‚£æ ·ä½¿æ•´ä¸ªæ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚\n\n# Java\n## JVM & GC\n\n### å†…å­˜åŒºåŸŸåˆ’åˆ†\n1. ç¨‹åºè®¡æ•°å™¨ï¼šçº¿ç¨‹ç§æœ‰ï¼ŒæŒ‡ä»¤æ‰§è¡Œçš„è¡Œå·æŒ‡ç¤ºå™¨\n2. Javaè™šæ‹Ÿæœºæ ˆï¼šæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ª **æ ˆå¸§** å»å­˜å‚¨å±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼Œç­‰ä¿¡æ¯ï¼Œè€ŒJavaè™šæ‹Ÿæœºæ ˆå°±æ˜¯çº¿ç¨‹å†…ç”¨äºå­˜æ”¾æ ˆå¸§çš„åŒºåŸŸï¼Œæ–¹æ³•æ‰§è¡Œç»“æŸå°±å¯¹åº”ç€è¿›æ ˆå‡ºæ ˆï¼Œå¯ä»¥é€šè¿‡-Xssè®¾ç½®æ ˆå¤§å°\n3. å †ï¼šJVMä¸­æœ€å¤§çš„ä¸€å—åŒºåŸŸï¼Œæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½ä¼šåˆ†é…åœ¨è¿™é‡Œï¼ŒåŒæ—¶ä¹Ÿæ˜¯GCæœ€ä¸»è¦çš„åŒºåŸŸ\n4. æ–¹æ³•åŒºï¼šå­˜æ”¾å·²ç»åŠ è½½çš„ç±»ä¿¡æ¯ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä»¥åŠé™æ€å˜é‡\n5. ç›´æ¥å†…å­˜ï¼šä½¿ç”¨æœ¬åœ°ä»£ç ç›´æ¥åˆ†é…çš„å †å¤–å†…å­˜\n\n### å¯¹è±¡åˆ›å»ºè¿‡ç¨‹\n1. ç±»åŠ è½½æ£€æŸ¥ï¼Œæ£€æŸ¥å¸¸é‡æ± Classæ˜¯å¦è¢«åŠ è½½\n2. åˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨ï¼Œå†…å­˜è§„æ•´çš„è¯å°±é‡‡ç”¨æŒ‡é’ˆç¢°æ’ï¼Œå¦åˆ™å°±é‡‡ç”¨ç©ºé—²åˆ—è¡¨\n3. åˆå§‹åŒ–é›¶å€¼ï¼Œå°†å†…å­˜ç©ºé—´è®¾ç½®ä¸ºé›¶å€¼ï¼Œæ‰€ä»¥å¯¹è±¡ä¸­çš„å±æ€§ä¸æ‰‹åŠ¨åˆå§‹åŒ–ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„\n4. è®¾ç½®å¯¹è±¡å¤´ï¼Œæ‰§è¡Œ`init`æ–¹æ³•ï¼ˆæ„é€ å™¨ï¼‰\n\n### å †ç»“æ„åˆ†ä»£\n1. æ–°ç”Ÿä»£ï¼šæ–°ç”Ÿæˆçš„å¯¹è±¡ä¼˜å…ˆæ”¾åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ–°ç”Ÿä»£å¯¹è±¡æœå‡å¤•æ­»ï¼Œå­˜æ´»ç‡å¾ˆä½ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ï¼ŒGCå›æ”¶æ•ˆç‡å¾ˆé«˜\n2. è€å¹´ä»£ï¼šåœ¨æ–°ç”Ÿä»£ç»å†äº†å¤šæ¬¡GCï¼ˆå…·ä½“æ¬¡æ•°è¦çœ‹jvmçš„é…ç½®ï¼‰ä»ç„¶å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å°±ä¼šè¿›å…¥è€å¹´ä»£ï¼Œå­˜æ´»ç‡é«˜ï¼Œå¤§å¯¹è±¡å’Œé•¿æœŸå­˜æ´»çš„å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£\n> è¿™æ ·åˆ†ä»£å°±å¯ä»¥è®©åƒåœ¾æ”¶é›†å™¨æœ‰é’ˆå¯¹æ€§çš„è¿›è¡ŒGCï¼Œé¿å…å…¨å †æ‰«æï¼Œå¯¹ä¸åŒçš„åŒºåŸŸé‡‡ç”¨ä¸åŒçš„å›æ”¶ç­–ç•¥ï¼Œæ¯”å¦‚æ–°ç”Ÿä»£å°±é‡‡ç”¨ **å¤åˆ¶ç®—æ³•**ï¼Œè€å¹´ä»£åˆ™é‡‡ç”¨ **æ ‡è®°æ¸…é™¤**ï¼Œ**æ ‡è®°æ•´ç†**\n\n### åˆ¤æ–­å¯¹è±¡æ­»äº¡\n1. å¼•ç”¨è®¡æ•°ï¼Œæ¯å½“å¯¹è±¡è¢«å¼•ç”¨ï¼Œå¯¹åº”çš„å¼•ç”¨è®¡æ•°å°±+1ï¼Œå¦‚æœå¼•ç”¨å¤±æ•ˆå°±-1ï¼Œè®¡æ•°å™¨ä¸º0å°±è¯´æ˜ä¸ä¼šå†è¢«ä½¿ç”¨äº†ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¯èƒ½ä¼šé€ æˆå¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä¸»æµçš„JVMéƒ½ä¸æ˜¯é‡‡ç”¨çš„è¿™ç§æ–¹å¼ï¼ˆpyä¼¼ä¹æ˜¯è¿™ç§æ–¹å¼\n2. å¯è¾¾æ€§åˆ†æï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„GC ROOTä¸ºèµ·ç‚¹å‘ä¸‹æœç´¢ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å’ŒGC ROOTæ²¡æœ‰å¼•ç”¨é“¾çš„è¯è¯¥å¯¹è±¡å°±ä¸å¯ç”¨äº†äº†\n\n### å¼ºè½¯å¼±è™š\n1. å¼ºå¼•ç”¨ï¼šå‘é€GCä¹Ÿä¸ä¼šè¢«æ¸…ç†\n2. è½¯å¼•ç”¨ï¼šå‘é€GCä¸”å†…å­˜ä¸è¶³å°±ä¼šè¢«æ¸…ç†\n3. å¼±å¼•ç”¨ï¼šå‘ç”ŸGCçš„æ—¶å€™ä¸è¿‡å†…å­˜æ˜¯å¦è¶³å¤Ÿéƒ½ä¼šè¢«æ¸…ç†\n4. è™šå¼•ç”¨ï¼šå¯¹å¯¹è±¡çš„GCæ²¡æœ‰å½±å“ï¼Œç”¨äºåœ¨GCçš„æ—¶å€™æ”¶åˆ°é€šçŸ¥\n\n### åƒåœ¾æ”¶é›†ç®—æ³•\n1. **æ ‡è®°-æ¸…é™¤**ï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰ **éœ€è¦å›æ”¶** çš„å¯¹è±¡ï¼Œæ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œ**æ•ˆç‡è¾ƒä½**ï¼Œè€Œä¸”ä¼šäº§ç”Ÿ **å†…å­˜ç¢ç‰‡**\n2. **æ ‡è®°-æ•´ç†**ï¼šå’Œæ ‡è®°æ¸…é™¤ç±»ä¼¼ï¼Œä¸è¿‡åœ¨æ¸…é™¤é˜¶æ®µä¼šå°†å­˜æ´»å¯¹è±¡éƒ½ç§»åŠ¨åˆ°ä¸€è¾¹ï¼Œç„¶åç›´æ¥æ¸…é™¤å¦ä¸€è¾¹ï¼Œ**ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡**ï¼Œä½†æ˜¯éœ€è¦å¯èƒ½ **è¦ç§»åŠ¨å¤§é‡å¯¹è±¡** æ•ˆç‡ä»ç„¶ä¸é«˜ï¼Œé€‚ç”¨äº **å­˜æ´»ç‡é«˜è€å¹´ä»£**\n3. **å¤åˆ¶ç®—æ³•**ï¼šå°†å†…å­˜åˆ’åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå½“å…¶ä¸­ä¸€å—ä½¿ç”¨å®Œåå°±å°† **å­˜æ´»çš„å¯¹è±¡** ç§»åŠ¨å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå°†ä½¿ç”¨è¿‡çš„ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ï¼Œé€‚ç”¨äº **å­˜æ´»ç‡è¾ƒä½çš„æ–°ç”Ÿä»£**ï¼Œé—®é¢˜æ˜¯ç©ºé—´çš„åˆ©ç”¨ç‡å˜ä½ï¼Œæ‰€ä»¥ä¸€èˆ¬jvmçš„å®ç°éƒ½å¹¶ä¸æ˜¯åˆ’åˆ†ä¸º1/2ï¼Œè€Œæ˜¯åˆ†æˆä¸€å—è¾ƒå¤§çš„`Eden`åŒºï¼Œå’Œä¸¤å—è¾ƒå°çš„`Survivor`åŒºï¼Œæ¯”ä¾‹é»˜è®¤æ˜¯8ï¼š1ï¼Œæ¯æ¬¡åªä½¿ç”¨edenåŒºå’Œå…¶ä¸­ä¸€å—SurvivoråŒºï¼Œå›æ”¶æ—¶å°†Edenå’ŒSurvivoråŒºç§»åŠ¨åˆ°å¦ä¸€å—Survivorï¼Œç„¶åæ¸…ç†Edenå’ŒSurvivor\n   > å¦‚æœå­˜æ´»å¯¹è±¡å¤ªå¤šäº†ï¼Œä¸€ä¸ªSuriviorå­˜ä¸ä¸‹ï¼Œé‚£ä¹ˆå°±ä¼šä¾èµ–**è€å¹´ä»£**çš„ç©ºé—´æ‹…ä¿ï¼Œå€Ÿç”¨è€å¹´ä»£ç©ºé—´å­˜å‚¨å­˜ä¸ä¸‹çš„å¯¹è±¡\n4. **åˆ†ä»£æ”¶é›†**ï¼šé¡¾åæ€ä¹‰ï¼Œå¯¹ä¸åŒçš„ä»£é‡‡ç”¨ä¸åŒçš„æ”¶é›†ç®—æ³•\n\n### åƒåœ¾æ”¶é›†å™¨\n1. Serialæ”¶é›†å™¨ï¼šä¸²è¡Œï¼Œå•çº¿ç¨‹ï¼ŒGCæ—¶å€™ä¼šSTW\n2. Serial Oldæ”¶é›†å™¨ï¼šSerialæ”¶é›†è€å¹´ä»£\n3. ParNewæ”¶é›†å™¨ï¼šå¤šçº¿ç¨‹ï¼ŒGCæ—¶ä¹Ÿä¼šSTWï¼Œåªæ˜¯ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ”¶é›†\n4. Parallel Scavengeæ”¶é›†å™¨ï¼šå’ŒParNewç±»ä¼¼ï¼Œä¸è¿‡ **æ›´å¼ºè°ƒååé‡ï¼ˆåƒåœ¾æ”¶é›†æ—¶é—´å°½å¯èƒ½çŸ­ï¼‰**\n5. Parallel Oldæ”¶é›†å™¨ï¼šParallel Scavengeè€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†\n6. CMSæ”¶é›†å™¨ï¼šå¼ºè°ƒ **ä½åœé¡¿**ï¼ŒGCçº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹å¹¶è¡Œï¼Œä½¿ç”¨ **æ ‡è®°æ¸…é™¤** çš„è€å¹´ä»£æ”¶é›†å™¨ã€‚â‘ åˆå§‹æ ‡è®°ï¼ˆåœé¡¿ï¼‰â‘¡å¹¶å‘æ ‡è®°â‘¢é‡æ–°æ ‡è®°ï¼ˆåœé¡¿ï¼‰â‘£å¹¶å‘æ¸…é™¤\n7. G1æ”¶é›†å™¨ï¼šå®ç°äº†å¯é¢„æµ‹é¢åœé¡¿æ—¶é—´ï¼Œå°†å†…å­˜åˆ’åˆ†ä¸ºRegionï¼Œç„¶åæŒ‰ç…§å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶ç©ºé—´ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ—¶é—´å›æ”¶ä»·å€¼æœ€å¤§çš„Region â‘ åˆå§‹æ ‡è®°ï¼ˆåœé¡¿ï¼‰â‘¡å¹¶å‘æ ‡è®°â‘¢æœ€ç»ˆæ ‡è®°ï¼ˆåœé¡¿ï¼‰â‘£ç­›é€‰å›æ”¶\n\n### FULL GCè§¦å‘\n> **Minor GC**ï¼šæ–°ç”Ÿä»£å‘ç”Ÿçš„GCï¼ŒEdenåŒºåŸŸå¿«æ»¡çš„æ—¶å€™ä¼šå°±ä¼šè§¦å‘ï¼ŒMinor GCä¸€èˆ¬å‘ç”Ÿæ¯”è¾ƒé¢‘ç¹ï¼Œæ•ˆç‡è¾ƒé«˜\n> \n> **FULL GC**: æ”¶é›†æ•´ä¸ªå †ï¼Œæ•ˆç‡å¾ˆä½\n1. System.gc()ï¼Œå»ºè®®jvmæ‰§è¡ŒFull GC\n2. è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œå¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£\n3. è€å¹´ä»£ç©ºé—´æ‹…ä¿å¤±è´¥ï¼ŒMinor GCå¤åˆ¶æ—¶åˆ¤æ–­å­˜æ´»çš„å¯¹è±¡èƒ½å¦æ”¾è¿›è€å¹´ä»£\n## ç±»åŠ è½½\n1. åŠ è½½ï¼ˆ`loadCalss`æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–è¯¥æ–¹æ³•å®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼‰ï¼Œé€šè¿‡ç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©æ˜¯ä½äºå †ä¸­çš„Classå¯¹è±¡\n2. è¿æ¥ï¼ˆéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼‰\n3. åˆå§‹åŒ–ï¼Œæ‰§è¡Œ **ç±»æ„é€ å™¨clinit** ï¼Œç±»å˜é‡çš„èµ‹å€¼ï¼Œé™æ€è¯­å¥å—æ‰§è¡Œï¼Œè™šæ‹Ÿæœºä¼šä¿è¯`clinit`æ–¹æ³•çš„çº¿ç¨‹å®‰å…¨ï¼ˆå¯¹åº”å‰æ–‡[å¯¹è±¡çš„initæ–¹æ³•](#å¯¹è±¡åˆ›å»ºè¿‡ç¨‹)ï¼‰\n\n### åŒäº²å§”æ´¾\nç³»ç»Ÿåœ¨åŠ è½½ç±»çš„æ—¶å€™ä¼šé¦–å…ˆåˆ¤æ–­è¯¥ç±»æ˜¯å¦ä»¥åŠè¢«åŠ è½½äº†ï¼Œå¦‚æœè¢«åŠ è½½å°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™å°±å°è¯•åŠ è½½ï¼Œåœ¨åŠ è½½æ—¶å€™ä¼šé¦–å…ˆå§”æ‰˜çˆ¶ç±»å»åŠ è½½ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½ä¸äº†ï¼Œå°±ä¼šå°è¯•è‡ªå·±åŠ è½½ï¼Œç±»ä¼¼Javaå†…éƒ¨æ ¸å¿ƒç±»å°±éƒ½ä¼šäº¤ç»™BootStrapClassLoaderå»åŠ è½½ï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿå®‰å…¨æ€§ï¼Œä¹Ÿèƒ½é¿å…ç±»é‡å¤åŠ è½½\n### çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨(TCCL)\n## HashMap\n### å¯¹æ¯”HashTable\n1. HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒHashTableå†…æ–¹æ³•éƒ½åŠ äº†é”ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ•ˆç‡ä¼šä½å¾ˆå¤š\n2. HashMapåˆå§‹å®¹é‡ä¸æŒ‡å®šå°±æ˜¯16ï¼Œä¹‹åæ¯æ¬¡æ‰©å®¹éƒ½ä¼šå˜æˆä¹‹å‰çš„2å€ï¼Œå¦‚æœç»™å®šäº†åˆå§‹å€¼ä½†æ˜¯å¹¶ä¸æ˜¯2çš„å¹‚æ¬¡ï¼Œå°±è‡ªåŠ¨è½¬æ¢æˆæœ€æ¥è¿‘çš„2çš„å¹‚æ¬¡ã€‚è€ŒHashTableåˆå§‹å®¹é‡ä¸º11ï¼Œæ¯æ¬¡æ‰©å®¹å˜æˆåŸæ¥çš„2n+1\n3. JDK8ä¹‹åHashMapåº•å±‚é“¾è¡¨é•¿åº¦å¦‚æœå¤§äº8å°±ä¼šè½¬æ¢æˆçº¢é»‘æ ‘\n> 2çš„å¹‚æ¬¡æ˜¯ä¸ºäº†é¿å…ä½¿ç”¨%æ“ä½œï¼Œå½“lengthæ˜¯2çš„å¹‚çš„æ—¶å€™ï¼Œhash%length = hash & (length-1) è€Œ&æ“ä½œç›¸æ¯”%ä¼šé«˜æ•ˆå¾ˆå¤š \n> 9 % 4 = 1001 & 0011 = 0001\n### equalså’ŒhashCode\nå½“å‘HashMapä¸­æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œä¼šæ ¹æ®keyè®¡ç®—å¾—åˆ°çš„hashå€¼ï¼Œè½¬æ¢æˆtableæ•°ç»„çš„ç´¢å¼•ï¼Œç„¶ååˆ¤æ–­`table[i]`æ˜¯ä¸æ˜¯nullï¼Œå¦‚æœæ˜¯nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œé€šè¿‡`hashCode`å’Œ`equals`åˆ¤æ–­ä¸¤ä¸ªkeyæ˜¯å¦ç›¸åŒï¼ˆå…ˆåˆ¤æ–­hashcodeï¼ŒhashCodeä¸åŒä¸€å®šä¸åŒï¼Œå†æ ¹æ®equalsï¼‰ï¼Œç›¸åŒå°±ç›´æ¥è¦†ç›–ï¼Œå¦åˆ™å°±ç”¨æ‹‰é“¾æ³•è§£å†³å†²çª\n\n### ConcurrentHashMap\nJDK1.7ä¹‹å‰é‡‡ç”¨ **åˆ†æ®µé”**ï¼Œé‡‡ç”¨Segmentåˆ†æ®µçš„ç®¡ç†é”®å€¼å¯¹ï¼Œå½“çº¿ç¨‹è®¿é—®æŸä¸€ä¸ªSegmentçš„æ—¶å€™ä¸å½±å“å…¶ä»–çš„Segmentï¼Œè¿™æ ·å¯ä»¥åˆ†æ•£ç«äº‰å¤§å¤§æé«˜HashMapçš„å¹¶å‘åº¦ã€‚\n> å¯ä»¥å¼•å‡ºLongAdderçš„åˆ†æ®µé”\n\nputçš„æ—¶å€™å…ˆå°†keyç»è¿‡hashåå®šä½åˆ°å…·ä½“çš„Segmentï¼Œç„¶åå†Segmentä¸­åŠ é”è¿›è¡Œputï¼ˆæ‹‰é“¾æ³•ï¼‰ï¼ŒGetæ“ä½œç±»ä¼¼å…ˆå®šä½åˆ°Segmentï¼Œç„¶åå†å®šä½åˆ°å…·ä½“çš„å…ƒç´ ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸ç”¨åŠ é”\n\nJDK1.8ä¹‹åæŠ›å¼ƒäº†åŸæœ‰çš„åˆ†æ®µé”ï¼Œé‡‡ç”¨äº†CAS+synchronizedï¼ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†çº¢é»‘æ ‘ï¼Œå½“æ²¡æœ‰å†²çªçš„æ—¶å€™ä¼šé€šè¿‡CASå†™å…¥ï¼Œå¦‚æœå‘ç”Ÿhashå†²çªæˆ–è€…éœ€è¦æ‰©å®¹æ‰ä¼šåŠ é”ï¼Œå¹¶ä¸”synchronizedåœ¨1.8ä¹‹åä¹Ÿä¼˜åŒ–çš„å¾ˆå¥½\n## JMM\nJavaå†…å­˜æ¨¡å‹ä¸»è¦æ˜¯å®šä¹‰äº†ä¸€ç§è§„èŒƒï¼Œå°±æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œå†…å­˜ï¼Œæ‰€æœ‰å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†éœ€è¦ä½¿ç”¨çš„å˜é‡çš„å‰¯æœ¬ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ”¹å˜éƒ½æ˜¯åœ¨å·¥ä½œå†…å­˜ä¸­ä¿®æ”¹ï¼Œä¿®æ”¹å®Œäº†ä¹‹åå†åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œçº¿ç¨‹ä¸èƒ½ç›´æ¥å¯¹ä¸»å†…å­˜çš„å˜é‡è¿›è¡Œä¿®æ”¹ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹çš„å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œåªèƒ½é€šè¿‡ä¸»å†…å­˜ä¼ é€’\n\n### synchnorized\nå¯ä»¥ä¿è¯å¹¶å‘çš„ä¸‰è¦ç´ ï¼ŒåŸå­æ€§ï¼Œå¯è§æ€§ï¼Œæœ‰åºæ€§ï¼Œæ—©æœŸä¸€ç›´è¢«æˆä¸ºé‡é‡çº§é”ï¼Œä¾èµ–åº•å±‚çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ¶ˆè€—è¾ƒå¤§\n\nåœ¨JDK6ä¹‹åï¼Œå¯¹å…¶è¿›è¡Œäº†å¤§é‡çš„ä¼˜åŒ–\n1. **åå‘é”** ï¼šå½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«è·å–çš„æ—¶å€™ï¼Œä¼šæŠŠå¯¹è±¡å¤´çš„é”æ ‡å¿—ä½è®¾ç½®ä½åå‘æ¨¡å¼ï¼Œç„¶ååˆ©ç”¨CASå°†çº¿ç¨‹IDå†™å…¥å¯¹è±¡å¤´ï¼Œåç»­è¯¥çº¿ç¨‹ä¸‹ä¸€æ¬¡è¿›å…¥åŒæ­¥å—çš„æ—¶å€™å°±ä¸ä¼šè¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œï¼ˆé”æ¶ˆé™¤ï¼‰ï¼Œå¦‚æœæœ‰å¦ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”å¯¹è±¡åå‘æ¨¡å¼å°±ä¼šå¤±æ•ˆï¼Œå‡çº§ä¸ºè½»é‡çº§é”\n2. **è½»é‡çº§é”** ï¼šå°†é”å¯¹è±¡çš„MarkWordå¤åˆ¶åˆ°æœ¬åœ°çº¿ç¨‹ç©ºé—´ï¼Œç„¶åå°†å¯¹è±¡å¤´çš„MarkWordåˆ©ç”¨CASæ›´æ–°ä¸ºæ‰§è¡Œçº¿ç¨‹æ ˆçš„å¤åˆ¶çš„MarkWordï¼ŒæˆåŠŸåå°±æ‹¥æœ‰è¯¥å¯¹è±¡çš„é”äº†ï¼Œæ›´æ–°å¤±è´¥å°±è¯´æ˜æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶ç«äº‰è¯¥å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™è½»é‡çº§é”å°±å¤±æ•ˆäº†ï¼Œä¼šè†¨èƒ€æˆé‡é‡çº§é”ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼åœ¨å¤šä¸ªçº¿ç¨‹äº¤æ›¿ä½¿ç”¨é”ï¼Œä¸å­˜åœ¨ç«äº‰çš„æ—¶å€™æ€§èƒ½ä¼šå¾ˆé«˜\n3. **è‡ªæ—‹é”å’Œè‡ªé€‚åº”é”**ï¼šåœ¨é‡é‡çº§é”æŠ¢é”å¤±è´¥åå¹¶ä¸é©¬ä¸Šé˜»å¡æŒ‚èµ·ï¼Œè€Œæ˜¯çŸ­æš‚çš„è‡ªæ—‹ï¼Œé¿å…çº¿ç¨‹åˆ‡æ¢ï¼Œå¦‚æœé”å ç”¨çš„æ—¶é—´å¾ˆçŸ­ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„æ•ˆæœå°±ä¼šå¾ˆå¥½ï¼Œå¦åˆ™é•¿æ—¶é—´è‡ªæ—‹ä¼šæµªè´¹CPUï¼Œæ‰€ä»¥åé¢å¼•å…¥äº† **è‡ªé€‚åº”é”**ï¼Œä¸å†å›ºå®šè‡ªæ—‹æ—¶é—´ï¼Œè€Œæ˜¯ç”±å‰ä¸€ä¸ªé”çš„çŠ¶æ€å†³å®š\n4. **é”æ¶ˆé™¤** & **é”ç²—åŒ–**ï¼šé”æ¶ˆé™¤æ˜¯æŒ‡JITå¯¹äºä¸€äº›ä»£ç ä¸Šè¦æ±‚åŒæ­¥ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸ä¼šäº§ç”Ÿå…±äº«æ•°æ®ç«äº‰çš„é”è¿›è¡Œæ¶ˆé™¤ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°é€ƒé€¸åˆ†æï¼Œè€Œé”ç²—åŒ–å°±æ˜¯å°†ä¸€äº›è¿ç»­çš„å¯¹ **åŒä¸€ä¸ªé”å¯¹è±¡** çš„åŠ é”è§£é”æ“ä½œåˆå¹¶ç²—åŒ–ï¼Œå°†é”çš„èŒƒå›´å˜å¤§ï¼Œé¿å…é¢‘ç¹çš„åŠ é”è§£é”\n### Volatile\n1. ä¿è¯å†…å­˜å¯è§æ€§ï¼Œå¯¹å˜é‡çš„ä¿®æ”¹èƒ½é©¬ä¸ŠåŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œå¹¶ä¸”è¯»å–ä¸€ä¸ªvolatileå˜é‡ä¹Ÿå¿…é¡»ä»ä¸»å†…å­˜è¯»å–\n2. ä¿è¯æœ‰åºæ€§ï¼Œjvmå¯èƒ½ä¼šå¯¹æˆ‘ä»¬ç¼–å†™çš„ä»£ç è¿›è¡Œé‡æ’åºä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œç»å…¸çš„ä¾‹å­å°±æ˜¯DCLå•ä¾‹çš„ä¾‹å­äº†ï¼ŒDCLå•ä¾‹ä¹‹æ‰€ä»¥è¦åœ¨å•ä¾‹ä¸ŠåŠ volatileå°±æ˜¯ä¸ºäº†æ”¾åœ¨jvmå¯¹æŒ‡ä»¤çš„é‡æ’åºï¼Œnew Objectçš„æ“ä½œä¼šåˆ†ä¸ºå¥½å‡ æ­¥éª¤ï¼Œå¯èƒ½æŠŠå†…å­˜åˆ†é…é‡æ’å‰é¢ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯\n> å¯ä»¥ä¿è¯Long/Doubleå†™å…¥çš„åŸå­æ€§ï¼Œæ—©æœŸå†™å…¥è¿™äº›64ä½çš„æ•°æ®å¯èƒ½æ˜¯åˆ†æ®µå†™çš„\n\n### CAS\nCPUæ”¯æŒçš„ä¸€ç§å¹¶å‘åŸè¯­æŒ‡ä»¤ï¼Œä¸€èˆ¬æœ‰3ä¸ªå‚æ•°ï¼Œå†…å­˜ä¸­çš„å€¼Mï¼ŒæœŸæœ›çš„å€¼Eï¼Œä»¥åŠæ›´æ–°çš„å€¼Uï¼Œå¦‚æœæ‰§è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼ŒM==Eï¼Œé‚£ä¹ˆå°±ä¼šå°†Mæ”¹æˆUï¼Œè¿™ä¸€ç³»åˆ—çš„æ“ä½œè¢«CPUå°è£…ä¸ºä¸€ä¸ªç³»ç»ŸåŸè¯­ï¼Œå€Ÿæ­¤å¯ä»¥å®ç°éé˜»å¡çš„è½»é‡çº§çš„ä¹è§‚é”\n\n**ç¼ºç‚¹**\n\n1. CASè‡ªæ—‹æ¶ˆè€—CPUèµ„æº\n2. ABAé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨AtomicStampedReferenceçš„ç‰ˆæœ¬å˜é‡æœºåˆ¶è§£å†³\n\n## JUC\n1. **CountDownLatch**ï¼ŒæŒ‡å®šä¸€ä¸ªè®¡æ•°countï¼Œå½“è°ƒç”¨`countdown()`çš„æ—¶å€™è®¡æ•°å™¨å‡ä¸€ï¼Œ`await()`ä¼šé˜»å¡ï¼ŒçŸ¥é“è®¡æ•°å™¨å‡ä¸º0ï¼Œï¼ˆGolangä¸­çš„WaitGroupå’Œè¿™ä¸ªç±»ä¼¼ï¼‰\n2. **CyclicBarrier**ï¼Œæ§åˆ¶å¤šä¸ªçº¿ç¨‹åˆ°è¾¾æŸä¸ªç‚¹éƒ½å†ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œç±»ä¼¼çˆ¬å±±ï¼Œå¤§å®¶éƒ½åˆ°è¾¾æŸä¸ªç‚¹ä¹‹ååœ¨ä¸€å¹¶å‰è¿›\n3. **Semaphore**ï¼Œä¿¡å·é‡ï¼ŒPVæ“ä½œï¼Œè®¾ç½®åˆå§‹å‡­è¯ï¼Œé‡Šæ”¾å‡­è¯ï¼Œè·å–å‡­è¯ï¼Œä¸å¤Ÿå°±ä¼šé˜»å¡\n4. **ReentrantLock**ï¼Œå¯é‡å…¥æ˜¾ç¤ºé”ï¼ˆJavaä¸­ä¸å¯é‡å…¥çš„ä¼¼ä¹å°±æ˜¯çº¿ç¨‹æ± ä¸­çš„é‚£ä¸ªWorkerï¼‰ï¼Œå¯¹æ¯”å†…éƒ¨é”ï¼š\n   1. æ˜¾ç¤ºé”æ”¯æŒå…¬å¹³é” \n   2. æ˜¾ç¤ºé”æ”¯æŒéé˜»å¡trylockä»¥åŠå¸¦è¶…æ—¶çš„tryLock(long timeout, TimeUnit unit)\n   3. æ˜¾ç¤ºé”å¯ä»¥ä¸­æ–­è¯·æ±‚lockInterruptibly\n   4. æ˜¾ç¤ºé”éœ€è¦æ‰‹åŠ¨çš„releaseï¼Œsyncè‡ªåŠ¨release \n   5. syncåœ¨ä¼˜åŒ–åæ€§èƒ½å’Œlockå·®ä¸å¤š\n5. **Condition**ï¼Œæ˜¾ç¤ºé”çš„çº¿ç¨‹é€šä¿¡æ–¹å¼ï¼Œå¯¹åº”syncçš„waitå’Œnotifyï¼Œä½†æ˜¯conditionå¯ä»¥è§£å†³ **è¿‡æ—©å”¤é†’** çš„é—®é¢˜ï¼Œä¸ºä¸€ä¸ªé”åˆ›å»ºå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œæ¯”å¦‚å…¸å‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…éƒ½åˆ›å»ºä¸€ä¸ªconditionï¼Œè®©ç”Ÿäº§è€…åªä¼šå”¤é†’æ¶ˆè´¹è€…ï¼Œè€Œæ¶ˆè´¹è€…åªä¼šç¼“å­˜ç”Ÿäº§è€…\n6. **ReadWriteLock**ï¼Œè¯»å†™é”ï¼Œè¯»è¯»å¯å¹¶å‘\n7. **Atomicç±»**ï¼ŒCAS + Volatile\n8. **LongAdder**ï¼ŒCAS Cell[]æ•°ç»„ åˆ†æ®µé”ï¼Œåˆ†æ•£ç«äº‰ï¼Œsumä¸åŠ é”ï¼Œæœ€ç»ˆä¸€è‡´æ€§ï¼Œæ€§èƒ½é«˜äºAtomic\n### é˜»å¡é˜Ÿåˆ—\n1. **ArrayBlockingQueue**ï¼Œæ•°ç»„å®ç°çš„ **æœ‰ç•Œ** é˜»å¡é˜Ÿåˆ—ï¼Œé»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œåº•å±‚å®ç°æ˜¯ReentrantLock\n2. **LinkedBlockingQueue**ï¼Œé“¾è¡¨å®ç°çš„é˜»å¡é˜Ÿåˆ—ï¼Œå¦‚æœä¸è®¾ç½®å®¹é‡ï¼Œå®¹é‡å°±ä¼šè®¾ç½®ä¸º`INT_MAX`å˜æˆæ— ç•Œé˜Ÿåˆ—\n3. **SynchronousQueue**ï¼Œä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªå®¹é‡ä¸º0çš„é˜»å¡é˜Ÿåˆ—ï¼Œputå’Œtakeæˆå¯¹çš„æ—¶å€™æ‰ä¸ä¼šé˜»å¡ï¼Œå’ŒGolangä¸­æ— ç¼“å†²çš„channelç±»ä¼¼ï¼Œå‘é€æ–¹éœ€è¦ç­‰å¾…æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹éœ€è¦ç­‰å¾…å‘é€æ–¹\n4. **DelayQueue**ï¼Œå»¶æ—¶è·å–é˜Ÿåˆ—ï¼Œå­˜å…¥å…ƒç´ åç­‰å¾…ä¸€å®šçš„æ—¶é—´åæ‰èƒ½è·å–\n\n### ThreadLocal\næ¯ä¸ªçº¿ç¨‹Threadå†…éƒ¨éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„ThreadLoaclMapï¼Œä»¥threadLocalå¯¹è±¡ä½œä¸ºkeyï¼Œè€Œå¯¹åº”ç§æœ‰å˜é‡åˆ™æ˜¯valï¼Œæ‰€ä»¥å„ä¸ªçº¿ç¨‹é€šè¿‡åŒä¸€ä¸ªthreadlocalæŸ¥åˆ°çš„keyéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¹¶ä¸”ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å…³è”å¤šä¸ªthreadLocalå˜é‡\n\n**å†…å­˜æ³„æ¼é—®é¢˜**ï¼šçº¿ç¨‹å†…éƒ¨çš„ThreadLocalMapçš„keyæ˜¯threadlocalå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå½“å‘é€GCçš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨æ¸…é™¤ï¼Œä½†æ˜¯valueæ˜¯å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥å°±ä¼šäº§ç”Ÿkeyä¸ºnullçš„Entryï¼Œvalueæ°¸è¿œæ— æ³•è¢«GCå›æ”¶ï¼Œå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œåœ¨ThreadLocalå®ç°ä¸­get,setçš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨æ¸…ç†keyä¸ºnullçš„entryï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯æ¯æ¬¡ä½¿ç”¨å®Œéƒ½æ‰‹åŠ¨çš„remove()\n\n### çº¿ç¨‹æ± \n**ä¼˜ç‚¹**\n\n1. å‡ä½çº¿ç¨‹èµ„æºæ¶ˆè€—ï¼Œé‡å¤åˆ©ç”¨å·²ç»åˆ›å»ºçš„çº¿ç¨‹ï¼Œé¿å…é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹\n2. æé«˜å“åº”é€Ÿåº¦ï¼Œä¸ç”¨ç­‰å¾…çº¿ç¨‹åˆ›å»º\n3. æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼Œæ§åˆ¶å¹¶å‘çš„æ•°é‡\n\n**å¤§è‡´æµç¨‹**\n\n1. æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± \n2. çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œç›´æ¥åˆ›å»ºçº¿ç¨‹æ‰§è¡Œï¼Œå¦åˆ™å°±æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­\n3. å¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡äº†å°±åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å°äºæœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œå¦‚æœæ˜¯å°±ç»§ç»­åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå¦åˆ™å°±ç›´æ¥é‡‡ç”¨æ‹’ç»ç­–ç•¥æ‹’ç»ä»»åŠ¡\n\n**å¤§è‡´åŸç†**\n\nå°è£…äº†ä¸€ä¸ªWorkerç±»ï¼Œç»§æ‰¿AQSå®ç°äº†ä¸€ä¸ªä¸å¯é‡å…¥çš„ç‹¬å é”ï¼Œç„¶åæœ‰ä¸€ä¸ªrunWorkerçš„æ–¹æ³•\n1. whileå¾ªç¯ä¸æ–­ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ \n2. è·å–ä»»åŠ¡æˆåŠŸå°±ä¼šåŠ ä¸Šå†…éƒ¨å®ç°çš„é”ï¼ˆç”¨äºshutdownçš„æ—¶å€™åˆ¤æ–­æ˜¯å¦æ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼‰ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡\n3. å¦‚æœè·å–ä»»åŠ¡è¿”å›nullï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±ä¼šè·³å‡ºå¾ªç¯ï¼Œç»“æŸç”Ÿå‘½å‘¨æœŸç­‰å¾…GC\n4. è·å–ä»»åŠ¡è¿”å›nullçš„æƒ…å†µæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ â‘ çº¿ç¨‹æ± å…³é—­äº†â‘¡çº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º â‘¢å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶ï¼Œå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º...\n\n**æ ¸å¿ƒå‚æ•°**\n1. **corePoolSize**ï¼šæ ¸å¿ƒçº¿ç¨‹æ± å¤§å°ï¼Œä»»åŠ¡æ•°é‡è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ± ä¹‹åä»»åŠ¡å°±ä¼šè¢«æ”¾åˆ°é˜»å¡é˜Ÿåˆ—\n2. **maximumPoolSize**ï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹æ± ä¸­æœ€å¤šåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹\n3. **keepAliveTime**ï¼šè¿™ä¸ªå‚æ•°æœ€ç»ˆæ˜¯ä½œç”¨åœ¨é˜»å¡é˜Ÿåˆ—ä¸Šï¼Œå½“æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™ **é™¤æ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹** æœ€å¤šé—²ç½®å¤šé•¿æ—¶é—´å°±ä¼šè¢«å›æ”¶ï¼Œå¦‚æœè®¾ç½®äº†allowCoreThreadTimeOuté‚£ä¹ˆæ ¸å¿ƒçº¿ç¨‹ä¹Ÿä¼šè¶…æ—¶ï¼Œä¸ä¹‹å¯¹åº”çš„è¿˜æœ‰ä¸€ä¸ªå‚æ•°æ˜¯`TimeUnit`ï¼Œä¹Ÿå°±æ˜¯keepAliveçš„æ—¶é—´å•ä½\n4. **workerQueue**ï¼šçº¿ç¨‹æ± ä½¿ç”¨çš„é˜»å¡é˜Ÿåˆ—\n5. **threadFactory**ï¼šçº¿ç¨‹å·¥å‚ï¼Œæ ¹æ®ä¼ è¿›æ¥çš„Runnableåˆ›å»ºçº¿ç¨‹\n6. **handler**ï¼šæ‹’ç»ç­–ç•¥ï¼Œâ‘ ä¸¢å¼ƒä»»åŠ¡ï¼ŒæŠ›å¼‚å¸¸â‘¡ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸æŠ›å¼‚å¸¸â‘¢ä¸¢å¼ƒæœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åå†æ¬¡æ‰§è¡Œï¼ŒçŸ¥é“å¯ä»¥æ¥æ”¶â‘£ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡\n\n**å·¥å‚æ–¹æ³•**\n- newCachedThreadPool()ï¼šä¸ç¼“å­˜ä»»åŠ¡ï¼Œcoreä¸º0ï¼Œæœ€å¤§çº¿ç¨‹æ•°INT_MAXï¼Œé˜»å¡é˜Ÿåˆ—ä½¿ç”¨SynchronousQueueä¸ç¼“å­˜ä»»åŠ¡ï¼Œçº¿ç¨‹æ•°å¯èƒ½OOM\n- newFixedThreadPool()ï¼šæ ¸å¿ƒçº¿ç¨‹å’Œæœ€å¤§çº¿ç¨‹ç›¸åŒï¼Œä¸å…è®¸æ‰©å®¹ï¼Œé˜»å¡é˜Ÿåˆ—æ— ç•Œå¯èƒ½ä¼šOOM\n- newSingleThreadExecutor()ï¼šå•ä¾‹çº¿ç¨‹æ± ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—æ— ç•Œå¯èƒ½ä¼šOOM\n\n### AQS\nAQSåº•å±‚æ˜¯åŸºäºCLHé”çš„ï¼Œå½“å‰å…±äº«èµ„æºç©ºé—²çš„æ—¶å€™ï¼Œçº¿ç¨‹å¯ä»¥ç›´æ¥è·å–ï¼Œå¦‚æœè¯·æ±‚çš„èµ„æºè¢«å ç”¨äº†ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±ä¼šè¢«å°è£…æˆé“¾è¡¨çš„èŠ‚ç‚¹ï¼Œç„¶åè¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿé˜»å¡ï¼Œç­‰å¾…å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œå®Œæˆåå”¤é†’ï¼Œè¿™æ ·å°±å¯ä»¥åˆ†æ•£ç«äº‰ï¼Œå°†æ‰€æœ‰çº¿ç¨‹å¯¹åŒä¸€ä¸ªèµ„æºçš„ç«äº‰åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº† **æƒŠç¾¤æ•ˆåº”** ï¼ˆetcdå’Œzkå®ç°çš„åˆ†å¸ƒå¼é”ä¹Ÿæ˜¯å’Œè¿™ä¸ªæ€è·¯ä¸€æ ·çš„ï¼‰\n\nAQSä¸­éå…¬å¹³é”ï¼Œç‰¹å¾å…¶å®ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œå…¶å®ä»ç„¶éœ€è¦æ’é˜Ÿï¼Œåªä¸è¿‡åœ¨åˆšå¼€å§‹è·å–é”çš„æ—¶å€™å¯ä»¥æ’ä¸€æ¬¡é˜Ÿåˆ—ï¼Œç„¶åè¿›å…¥é˜Ÿåˆ—çš„æ—¶å€™ä¸åˆ¤æ–­å‰é¢æœ‰æ²¡æœ‰çº¿ç¨‹ï¼Œä¹Ÿä¼šå°è¯•è·å–ä¸€æ¬¡ï¼Œå¦‚æœä¸¤æ¬¡éƒ½å¤±è´¥äº†é‚£ä¹ˆå°±å’Œå…¬å¹³é”æ— å¼‚ï¼Œè€è€å®å®è¿›é˜Ÿåˆ—æ’é˜Ÿç­‰å¾…å”¤é†’\n# Go\n\n## CSP\n- CSPè¿›ç¨‹é€šå¸¸æ˜¯åŒæ­¥çš„(å³ä»»åŠ¡è¢«æ¨é€è¿›Channelå°±ç«‹å³æ‰§è¡Œï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œçš„çº¿ç¨‹æ­£å¿™ï¼Œåˆ™å‘é€è€…å°±æš‚æ—¶æ— æ³•æ¨é€æ–°ä»»åŠ¡)ï¼ŒActorè¿›ç¨‹é€šå¸¸æ˜¯å¼‚æ­¥çš„(æ¶ˆæ¯ä¼ é€’ç»™Actoråå¹¶ä¸ä¸€å®šé©¬ä¸Šæ‰§è¡Œ)ã€‚\n- CSPä¸­çš„Channelé€šå¸¸æ˜¯åŒ¿åçš„, å³ä»»åŠ¡æ”¾è¿›Channelä¹‹åä½ å¹¶ä¸éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªChannelåœ¨æ‰§è¡Œä»»åŠ¡ï¼Œè€ŒActoræ˜¯æœ‰â€œèº«ä»½â€çš„ï¼Œä½ å¯ä»¥æ˜ç¡®çš„çŸ¥é“å“ªä¸ªActoråœ¨æ‰§è¡Œä»»åŠ¡ã€‚\n- åœ¨CSPä¸­ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡Channelåœ¨ä»»åŠ¡é—´ä¼ é€’æ¶ˆæ¯, åœ¨Actorä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥ä»ä¸€ä¸ªActorå¾€å¦ä¸€ä¸ªActorä¼ è¾“æ•°æ®ã€‚\n## åƒåœ¾å›æ”¶\n## å¯¹æ¯”Javaçš„åƒåœ¾å›æ”¶\n1. æ— åˆ†ä»£ï¼Œåˆ†ä»£GCæ‰€å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ˆå­˜æ´»æ—¶é—´çŸ­ï¼Œæœç”Ÿå¤•æ­»ï¼‰ï¼Œé¿å…é¢‘ç¹çš„æ£€æŸ¥æ•´ä¸ªå †ï¼Œä½†æ˜¯Goçš„ç¼–è¯‘å™¨ä¼šé€šè¿‡ **é€ƒé€¸åˆ†æ** å°†å¤§éƒ¨åˆ†çš„æ–°ç”Ÿå¯¹è±¡åˆ›å»ºåœ¨æ ˆä¸Šï¼ˆæ ˆä½¿ç”¨å®Œåä¼šç›´æ¥å›æ”¶ï¼Œä¸éœ€è¦GCå‚ä¸ï¼‰ï¼Œåªæœ‰éœ€è¦é•¿æœŸå­˜åœ¨çš„å¯¹è±¡æ‰ä¼šæ”¾åˆ°éœ€è¦GCçš„å †ä¸­ï¼Œæ‰€ä»¥åˆ†ä»£å¯¹Goæ¥è¯´æ„ä¹‰ä¸å¤§\n2. æ— æ•´ç†ï¼Œå¯¹è±¡æ•´ç†æ˜¯ä¸ºäº†è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œè€ŒGoè¯­è¨€é‡‡ç”¨çš„æ˜¯[tcmalloc](https://zhuanlan.zhihu.com/p/29216091)åŸºæœ¬ä¸Šæ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼Œå¹¶ä¸”é¡ºåºå†…å­˜åˆ†é…å™¨åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹å¹¶ä¸é€‚ç”¨ï¼Œå¯¹è±¡æ•´ç†å¯¹Goæ¥è¯´æ€§èƒ½æå‡ä¸å¤§\n## QA\n1. Goè¯­è¨€ä¸­æ•°ç»„æ˜¯å…·æœ‰å›ºå®šé•¿åº¦è€Œä¸”æ‹¥æœ‰é›¶ä¸ªæˆ–è€…å¤šä¸ªç›¸åŒæˆ–ç›¸åŒæ•°æ®ç±»å‹å…ƒç´ çš„åºåˆ—ã€‚ç”±äºæ•°ç»„é•¿åº¦å›ºå®šï¼Œæ‰€ä»¥åœ¨Goè¯­è¨€æ¯”è¾ƒå°‘ç›´æ¥ä½¿ç”¨\n\nGo1.3ä¹‹å‰ä¸»è¦æ˜¯ **æ ‡è®°æ¸…é™¤** ç®—æ³•ï¼Œæ ‡è®°éœ€è¦æ‰«ææ•´ä¸ªå †ï¼Œéœ€è¦STWï¼Œä¹Ÿä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡\n>GC ROOTï¼š 1. å…¨å±€å˜é‡ 2.æ‰§è¡Œæ ˆ 3.å¯„å­˜å™¨\n### ä¸‰è‰²æ ‡è®°æ³•\n1. å°†æ‰€æœ‰èŠ‚ç‚¹æ”¾å…¥ **ç™½è‰²é›†åˆ**\n2. é¦–å…ˆä»æ ¹èŠ‚ç‚¹å‡ºå‘BFSèµ°ä¸€è½®ï¼Œå°†éå†åˆ°çš„èŠ‚ç‚¹ç§»å…¥ **ç°è‰²é›†åˆ**\n3. éå†æ‰€æœ‰çš„ç°è‰²é›†åˆï¼Œå°†ç°è‰²é›†åˆèƒ½BFSä¸€è½®ï¼Œè®¿é—®åˆ°çš„èŠ‚ç‚¹åŠ å…¥ç°è‰²é›†åˆï¼Œç„¶åå°†åŸæœ¬çš„ **ç°è‰²å¯¹è±¡** åŠ å…¥ **é»‘è‰²é›†åˆ**\n4. é‡å¤ä¸Šä¸€æ­¥ï¼Œç›´åˆ° **ç°è‰²é›†åˆä¸­æ²¡æœ‰å¯¹è±¡**\n5. æ¸…é™¤æ‰€æœ‰çš„ **ç™½è‰²é›†åˆ** ä¸­çš„å¯¹è±¡\n\nä¸Šé¢çš„åšæ³•çœ‹ä¼¼æ²¡æ¯›ç—…ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨é—®é¢˜ï¼Œæ— æ³•å’Œç”¨æˆ·ç¨‹åºå¹¶è¡Œï¼Œå¦‚æœç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ â‘ **ç°è‰²å¯¹è±¡ä¸¢å¤±äº†ç™½è‰²å¯¹è±¡** â‘¡**é»‘è‰²å¯¹è±¡å¼•ç”¨äº†ç™½è‰²å¯¹è±¡**ã€‚è¿™ä¸ªæ—¶å€™è¯¥ **ç™½è‰²å¯¹è±¡** å› ä¸ºå¤±å»äº† **ç°è‰²å¯¹è±¡** çš„å¼•ç”¨æ‰€ä»¥å®ƒå°±ä¸ä¼šå˜æˆç°è‰²ï¼Œæ¸…ç†çš„æ—¶å€™å°±ä¼šå°†å…¶æ¸…é™¤ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªå¯¹è±¡å·²ç»è¢«ä¸€ä¸ªé»‘è‰²å¯¹è±¡å¼•ç”¨äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´è¯¯æ€\n\n**è§£å†³åŠæ³•**ï¼šè¯»å†™å±éšœï¼Œåœ¨èµ‹å€¼æˆ–è€…è¯»å–æ“ä½œå‰ååšä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œå°†ç›®æ ‡å¯¹è±¡ä¿å­˜èµ·æ¥ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šè¢«ä½œä¸ºç°è‰²å¯¹è±¡æ‰«æï¼Œå°±ä¸ä¼šæ¼æ ‡\n\n\n## GPM\nGoçš„ç”¨æˆ·çº§çº¿ç¨‹ï¼ˆåç¨‹ï¼‰çš„å®ç°æ˜¯N:Mï¼Œå†…æ ¸åˆ›å»ºå‡ºNä¸ªå†…æ ¸çº¿ç¨‹ï¼ŒMä¸ªç”¨æˆ·çº¿ç¨‹ä¼šå¯¹åº”è¿™Nä¸ªçº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹å®Œå…¨ç”±ç”¨æˆ·æ¥è°ƒåº¦ï¼Œè€Œå†…æ ¸çº¿ç¨‹ç”±å†…æ ¸å»è°ƒåº¦\n\n### è€çš„GMæ¨¡å‹\n\n**M:** ä»£è¡¨çº¿ç¨‹ï¼Œä»–è¦è¿è¡Œgoroutine\n\n**G Queue:** Golbal G Queueï¼Œæ‰€æœ‰çš„goroutineéƒ½ä¿å­˜åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸­\n> Mè¦æ‰§è¡Œgoroutineæˆ–è€…æ”¾å›éƒ½éœ€è¦è®¿é—®GQueueï¼Œè€ŒMæœ‰å¤šä¸ªï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åŠ é”ä¿è¯äº’æ–¥ï¼Œå¯¼è‡´æ€§èƒ½è¾ƒä½\n\n### GPMæ¨¡å‹\n\n**G:** ä»£è¡¨goroutineï¼Œé‡Œé¢å­˜å‚¨äº†goroutineçš„æ‰§è¡Œstackä¿¡æ¯ï¼ŒgoroutineçŠ¶æ€ä»¥åŠä»»åŠ¡å‡½æ•°ç­‰\n\n**P:** é€»è¾‘Processï¼ŒPçš„æ•°é‡å†³å®šäº†ç³»ç»Ÿçš„æœ€å¤§å¹¶å‘åº¦ï¼ˆä¸è¶…è¿‡CPUæ ¸æ•°çš„å‰æä¸‹ï¼ŒGOMAXPROCSå¯è®¾ç½®Pçš„æ•°é‡ï¼‰ï¼Œæ²¡æœ‰æ•°æ®ç«äº‰ï¼Œä¸ç”¨åŠ é”\n\n**M:** ç³»ç»Ÿçš„è®¡ç®—èµ„æºï¼Œä¹Ÿå°±æ˜¯ **å†…æ ¸çº¿ç¨‹**\n\n> æ¯ä¸ªGæƒ³è¦æ‰§è¡Œé¦–å…ˆéœ€è¦åˆ†é…ä¸€ä¸ªPï¼Œåªæœ‰å°†På’ŒMç»‘å®šæ‰æœ‰æœºä¼šæ‰§è¡ŒPçš„é˜Ÿåˆ—ä¸­çš„G\n### ç‰¹ç‚¹\n1. **å¤ç”¨çº¿ç¨‹**ï¼Œåç¨‹æœ¬èº«æ˜¯è¿è¡Œåœ¨ä¸€ç»„çº¿ç¨‹ç»„ä¹‹ä¸Šï¼Œä¸ç”¨é¢‘ç¹çš„åˆ›å»ºé”€æ¯çº¿ç¨‹ï¼Œé™¤æ­¤ä¹‹å¤– â‘  `working stealing`ï¼Œå½“å‰Mæ²¡æœ‰å¯ä»¥çš„Gå°±ä¼šä»å…¶ä»–Mç»‘å®šçš„Pä¸­å·å–ä»»åŠ¡Gï¼Œè€Œä¸æ˜¯æ¶ˆè€—çº¿ç¨‹ â‘¡`hang offf`ï¼Œå½“å‘ç”Ÿé˜»å¡çš„æ—¶å€™ï¼Œä¼šå°†å½“å‰Mç»‘å®šçš„Pé‡Šæ”¾ï¼Œäº¤ç»™å…¶ä»–ç©ºé—²çš„Må»æ‰§è¡Œ\n2. **æŠ¢å **ï¼Œåœ¨coroutineä¸­è¦ç­‰å¾…ä¸€ä¸ªåç¨‹ä¸»åŠ¨è®©å‡ºCPUæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šé€ æˆçº¿ç¨‹é¥¥é¥¿ï¼Œè€ŒGoä¸­ä¸€ä¸ªgoroutineæœ€å¤šå ç”¨10msï¼Œé˜²æ­¢å…¶ä»–åç¨‹é¥¿æ­»ï¼Œè¿™ä¹Ÿæ˜¯å’Œä¼ ç»Ÿåç¨‹ä¸åŒçš„åœ°æ–¹\n3. **å…¨å±€Gé˜Ÿåˆ—**ï¼Œæ–°çš„è°ƒåº¦å™¨æ¨¡å‹ä¸­ä»ç„¶æœ‰å…¨å±€Gé˜Ÿåˆ—ï¼Œå½“Mä»å…¶ä»–På·å–ä¸åˆ°ä»»åŠ¡æ—¶å€™ä¹Ÿä¼šä»G Queueå·å–ä»»åŠ¡\n\n# ç½‘ç»œ\n## URL->æ˜¾ç¤ºä¸»é¡µ\n1. DNSè§£æ\n2. TCPè¿æ¥\n3. å‘é€HTTPè¯·æ±‚\n4. æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡\n5. æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢\nè¿æ¥ç»“æŸ\n## GETå’ŒPOSTåŒºåˆ«\n1. Getæ–¹æ³•ä¸»è¦ç”¨äºè¯·æ±‚ï¼Œè¯·æ±‚æœåŠ¡ç«¯è¿”å›èµ„æºï¼Œè€ŒPOSTä¸»è¦ç”¨äºformè¡¨å•çš„æäº¤ï¼Œç›¸å½“äºæŠŠä¿¡æ¯æäº¤åˆ°æœåŠ¡å™¨ï¼Œç­‰å¾…æœåŠ¡å™¨åšå‡ºå“åº”ã€‚\n2. GETè¯·æ±‚æ˜¯ä¸å®‰å…¨çš„ï¼Œå‘é€è¯·æ±‚çš„æ—¶å€™å‚æ•°ä¼šæ‹¼æ¥åœ¨urlåé¢\n3. GETè¯·æ±‚çš„URLé•¿åº¦æœ‰é™åˆ¶ï¼ˆæµè§ˆå™¨å’ŒæœåŠ¡å™¨çš„é™åˆ¶ï¼‰ï¼ŒPOSTæ•°æ®æ”¾åœ¨bodyä¸­ä¸€èˆ¬æ²¡æœ‰é™åˆ¶\n4. GETè¯·æ±‚ä¼šè¢«æµè§ˆå™¨ä¸»åŠ¨ç¼“å†²ï¼Œè€ŒPOSTä¸ä¼š\n## TCP\n### ä¸‰æ¬¡æ¡æ‰‹ & å››æ¬¡æŒ¥æ‰‹\n**ä¸‰æ¬¡æ¡æ‰‹**ï¼š\n1. å®¢æˆ·ç«¯å‘é€SYNåŒæ­¥ä¿¡å·ï¼Œä»¥åŠåˆå§‹åºåˆ—åŒ– SEQ = ISN(c)\n2. æœåŠ¡ç«¯è¿”å›ACK = ISN(c)+1 ä¿¡å·ä»¥åŠSYNåŒæ­¥ä¿¡å·ï¼Œä»¥åŠåˆå§‹åºåˆ—åŒ–SEQ = ISN(s) ï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰\n3. å®¢æˆ·ç«¯å›å¤ACK = ISN(s)+1 ä¿¡å·ï¼ˆå…¨è¿æ¥é˜Ÿåˆ—ï¼‰\n> ç¡®è®¤åŒå‘æ”¶å‘åŠŸèƒ½æ­£å¸¸ï¼Œäº¤æ¢ISNåºåˆ—å·\n\n**SYN flood**\n\né»‘å®¢ä¼ªé€ æœ¬åœ°IPåœ°å€ï¼Œç„¶åæƒ³ç›®æ ‡IPå‘é€å¤§é‡çš„SYNæŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯å›å¤çš„ACK+SYNè¢«å‘é€åˆ°ä¸€ä¸ªæœªçŸ¥çš„åœ°å€ï¼Œè¿›è€Œé€ æˆåŠè¿æ¥é˜Ÿåˆ—æ»¡è½½ï¼Œæ— æ³•å¤„ç†æ­£å¸¸è¯·æ±‚ã€‚ SYN Cookieå°±æ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹çš„æœ€åé˜¶æ®µæ‰åˆ†é…è¿æ¥èµ„æºï¼Œæ”¶åˆ°SYNåŒ…åé¦–å…ˆè®¡ç®—Cookieï¼Œåœ¨æ”¶åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹ACKçš„æ—¶å€™éªŒè¯Cookieï¼ŒéªŒè¯æˆåŠŸå†åˆ†é…èµ„æº\n\n**å››æ¬¡æŒ¥æ‰‹**ï¼š\n1. å®¢æˆ·ç«¯å‘é€FINæŠ¥æ–‡ï¼ŒClientï¼šFIN-WAIT-1\n2. æœåŠ¡ç«¯å“åº”ACKä¿¡å·ï¼ŒServer: CLOSE-WAITï¼ŒClient: FIN-WAIT-2\n3. æœåŠ¡ç«¯å‘é€FINæŠ¥æ–‡ï¼ŒServer: LAST-ACK\n4. å®¢æˆ·ç«¯å“åº”ACKæŠ¥æ–‡ï¼ŒClientï¼šTIME-WAIT\n\n**TIME-WAIT**\n\n1. ä¸€æ–¹é¢ç¡®ä¿é€šä¿¡è¿‡ç¨‹ä¸­å»¶è¿Ÿçš„é‡å¤åŒ…èƒ½åœ¨è¿æ¥ç»“æŸåè‡ªåŠ¨çš„æ¶ˆäº¡ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆé”™ä¹±\n2. ç¡®ä¿ä¸»åŠ¨å…³é—­æ–¹çš„æœ€åçš„ACKèƒ½åˆ°è¾¾å¯¹ç«¯ï¼ŒåŒæ—¶ä¹Ÿç¡®ä¿ACKä¸¢å¤±åï¼Œè¢«åŠ¨å…³é—­ç«¯é‡å‘çš„FINèƒ½é¡ºåˆ©åˆ°è¾¾ï¼Œä¸€æ¥ä¸€å›2MSLï¼ˆmslæŒ‡çš„æ˜¯æŠ¥æ–‡åœ¨ç½‘ç»œä¸­æœ€é•¿çš„ç”Ÿå­˜æ—¶é—´ï¼‰\n\n> å¤§é‡TIME-WAITä¼šé€ æˆä¸€äº›æµªè´¹ï¼Œä¼šå ç”¨TCPç«¯å£ï¼Œæ— æ³•å¤ç”¨ï¼Œå¯ä»¥é€šè¿‡Linuxçš„ä¸€äº›è®¾ç½®å»ä¼˜åŒ–ï¼ˆnet.ipv4.tcp_tw_reuseï¼Œtcp_tw_recycleï¼‰\n\n### TCPå¯é æ€§ä¿è¯\n#### é‡ä¼ æœºåˆ¶\n1. **è¶…æ—¶é‡ä¼ **ï¼Œæ ¹æ®RTOçš„å€¼é‡ä¼ ä¸¢å¤±çš„æ•°æ®ï¼ŒRTOçš„å€¼åº”è¯¥ç•¥å¤§äºRTTï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€å€¼ï¼Œä¼šæ ¹æ®ä¹‹å‰çš„RTTè¿›è¡Œé‡‡æ ·ï¼Œç„¶ååŠ¨æ€å˜åŒ–\n2. **å¿«é€Ÿé‡ä¼ **ï¼Œä¸ä»¥æ—¶é—´ä¸ºé©±åŠ¨ï¼Œè€Œæ˜¯ä»¥æ•°æ®ä¸ºé©±åŠ¨ï¼Œå½“æ”¶åˆ°3ä¸ªé‡å¤çš„ACKä¿¡å·çš„æ—¶å€™å°±ä¼šè§¦å‘é‡ä¼ ï¼Œå¯èƒ½ä¼šé‡ä¼ æ‰€æœ‰çš„æ•°æ®\n3. **SACK**ï¼Œå¿«é‡ä¼ çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œæ¥æ”¶æ–¹é€šè¿‡SACKä¿¡å·å‘ŠçŸ¥å‘é€ç«¯ä¸¢å¤±çš„æ•°æ®æ®µï¼Œè¿™æ ·å‘é€ç«¯å°±å¯ä»¥å‡†ç¡®çš„é‡ä¼ ä¸¢å¤±çš„æ•°æ®\n4. D-SACKï¼Œå¯ä»¥è®©ã€Œå‘é€æ–¹ã€çŸ¥é“ï¼Œæ˜¯å‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œè¿˜æ˜¯æ¥æ”¶æ–¹å›åº”çš„ ACK åŒ…ä¸¢äº†ï¼Œå¯ä»¥çŸ¥é“æ˜¯ä¸æ˜¯ã€Œå‘é€æ–¹ã€çš„æ•°æ®åŒ…è¢«ç½‘ç»œå»¶è¿Ÿäº†ï¼Œå¯ä»¥çŸ¥é“ç½‘ç»œä¸­æ˜¯ä¸æ˜¯æŠŠã€Œå‘é€æ–¹ã€çš„æ•°æ®åŒ…ç»™å¤åˆ¶äº†\n\n#### æµé‡æ§åˆ¶ & æ»‘åŠ¨çª—å£\nçª—å£å®é™…ä¸Šæ˜¯å‘é€æ–¹åœ¨OSä¸­å¼€è¾Ÿçš„ä¸€å—ç¼“å†²åŒºï¼Œåœ¨æ”¶åˆ°å¯¹æ–¹çš„åº”ç­”ä¹‹å‰ï¼Œæ•°æ®ä¼šè¢«ç¼“å­˜åœ¨çª—å£å†…\n\nå·²å‘é€å¹¶æ”¶åˆ°ACK || å·²å‘é€æœªACK || **æœªå‘é€ä¸”å¤§å°åœ¨çª—å£å†…** || æœªå‘é€ä¸”è¶…å‡ºçª—å£\n\nè¿™æ ·ä¸€æ¥ï¼Œå‘é€æ–¹å°±å¯ä»¥åœ¨ä¸ç­‰å¾…ACKçš„æƒ…å†µä¸‹å‘é€å¤šä¸ªåŒ…ï¼ˆä¸è¶…è¿‡çª—å£å¤§å°ï¼‰ï¼Œæ¥æ”¶æ–¹è¿›è¡Œ **ç´¯ç§¯ç¡®è®¤ï¼ˆç´¯è®¡åº”ç­”ï¼‰**ï¼Œå½“çª—å£è€—å°½ï¼Œåˆ™æ— æ³•å‘é€æ•°æ®ï¼Œæ¥æ”¶æ–¹ACKæ•°æ®åï¼Œçª—å£å³ç§»ï¼Œå¯ç”¨çª—å£å¢å¤§\n\n>é€šå¸¸å‘é€æ–¹çš„çª—å£æ˜¯ç”±æ¥å—æ–¹çš„çª—å£å¤§å°å†³å®šçš„ï¼Œé¿å…æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥\n\n#### æ‹¥å¡æ§åˆ¶\nå½“ç½‘ç»œå‡ºç°æ‹¥å µï¼Œå¦‚æœç»§ç»­å‘é€å¤§é‡çš„æ•°æ®åŒ…ï¼Œä¼šå¯¼è‡´æ•°æ®åŒ…å»¶è¿Ÿï¼Œä¸¢å¤±ï¼Œè¿›è€Œå¯¼è‡´é‡ä¼ ï¼Œè¿›ä¸€æ­¥åŠ å¤§é˜»å¡ç¨‹åº¦ï¼Œå½¢æˆæ¶æ€§å¾ªç¯\n\n**æ‹¥å¡çª—å£ï¼ˆcwndï¼‰**\n\nå‘é€æ–¹ç»´æŠ¤çš„ä¸€ä¸ªå˜é‡ï¼Œæ ¹æ®ç½‘ç»œæ‹¥å¡ç¨‹åº¦åŠ¨æ€çš„å˜åŒ–ï¼Œ`swnd=Min(rwnd,cwnd)`ï¼Œåªè¦å‘ç”Ÿäº†è¶…æ—¶é‡ä¼ å…¶å®å°±è¯´æ˜ç½‘ç»œå¼€å§‹æ‹¥å µäº†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ç®—æ³•\n1. æ…¢å¯åŠ¨ï¼Œå‘é€æ–¹æ¯æ¥æ”¶ä¸€ä¸ªACKï¼Œæ‹¥å¡çª—å£cwndçš„å¤§å°å°±ä¼š+1ï¼Œç›´è‡³ssthresh\n2. æ‹¥å¡é¿å…ï¼Œæ¯å½“æ”¶åˆ°ä¸€ä¸ª ACK æ—¶ï¼Œcwnd å¢åŠ  1/cwndã€‚\n3. æ‹¥å¡å‘ç”Ÿ\n   1. è¶…æ—¶é‡ä¼ ï¼›ssthresh è®¾ä¸º cwnd/2ï¼Œcwnd é‡ç½®ä¸º 1ï¼Œé‡æ–°å¼€å§‹æ…¢å¯åŠ¨ï¼Œååº”å¤ªå‰§çƒˆï¼Œçªç„¶åˆ¹è½¦\n   2. å¿«é€Ÿé‡ä¼ ï¼šssthresh = cwndï¼Œcwnd = cwnd/2\n4. å¿«é€Ÿæ¢å¤\n\n### ç²˜åŒ…è§£å†³æ–¹æ¡ˆï¼š\n1. å›ºå®šé•¿åº¦\n2. åˆ†å‰²ç¬¦å·ï¼Œæ–‡æœ¬ä¸­å¯èƒ½æœ‰åˆ†å‰²ç¬¦ï¼Œéœ€è¦æ‰«ææ–‡æœ¬è½¬ä¹‰\n3. æ·»åŠ é•¿åº¦å­—æ®µï¼Œå…ˆè¯»å–é•¿åº¦å­—æ®µï¼Œå†è¯»å–å†…å®¹\n\n### TCPå’ŒUDPåŒºåˆ«\n1. TCPä¼ è¾“å‰éœ€è¦å»ºç«‹è¿æ¥ï¼ŒUDPæ— è¿æ¥\n2. TCPé¢å‘æµï¼Œå°†æ•°æ®çœ‹åšUDPåˆ™æ˜¯é¢å‘æŠ¥æ–‡\n3. TCPæä¾›å¯é çš„æœåŠ¡ï¼Œæœ‰è¶…æ—¶é‡ä¼ ï¼Œå·®é”™æ ¡éªŒï¼Œæ»‘åŠ¨çª—å£ï¼Œæ‹¥å¡æ§åˆ¶ç­‰æœºåˆ¶ç¡®ä¿å¯é æ€§èƒ½\n4. TCPåªæ”¯æŒç‚¹å¯¹ç‚¹çš„é€šä¿¡ï¼Œè€ŒUDPæ”¯æŒä¸€å¯¹ä¸€ï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡\n5. TCPå¤´éƒ¨20-60å­—èŠ‚ï¼ŒUDPå¤´éƒ¨8å­—èŠ‚\n### å¦‚ä½•è®¾è®¡å¯é çš„UDP\n1. æ·»åŠ seq/ackæœºåˆ¶ï¼Œç¡®ä¿æ•°æ®å‘é€åˆ°å¯¹ç«¯\n2. æ·»åŠ å‘é€å’Œæ¥æ”¶ç¼“å†²åŒºï¼Œä¸»è¦æ˜¯ç”¨æˆ·è¶…æ—¶é‡ä¼ ã€‚\n3. æ·»åŠ è¶…æ—¶é‡ä¼ æœºåˆ¶ã€‚\n\n\n## HTTP 1.0ï¼Œ1.1\n1. é•¿è¿æ¥ï¼ŒConnection: keep-aliveï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­å‘é€å¤šä¸ªè¯·æ±‚\n2. é”™è¯¯çŠ¶æ€å“åº”ç  :åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚\n3. ç¼“å­˜å¤„ç† :åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tagï¼ŒIf-Unmodified-Since, If-Match, If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚\n## HTTPS\nHTTPSæ˜¯è¿è¡Œåœ¨SSL/TLSä¹‹ä¸Šçš„HTTPåè®®ï¼ŒSSL/TLS è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨ **å¯¹ç§°åŠ å¯†** ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥è¯´ï¼ŒHTTPå®‰å…¨æ€§æ²¡æœ‰ HTTPSé«˜ï¼Œä½†æ˜¯ HTTPS æ¯”HTTPè€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚\nhttps://zhuanlan.zhihu.com/p/57142784\n## TCP/IPç½‘ç»œæ¨¡å‹\n\n1. **åº”ç”¨å±‚**ï¼Œï¼ˆOSIç»†åˆ†ä¸ºï¼šåº”ç”¨å±‚ï¼Œè¡¨ç¤ºå±‚ï¼Œä¼šè¯å±‚ï¼‰é¢å‘ç”¨æˆ·ï¼Œä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼Œå¸¸è§åè®®æœ‰HTTPï¼ŒFTPï¼ŒDNS\n2. **ä¼ è¾“å±‚**ï¼Œä¸ºåº”ç”¨å±‚æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¸»è¦æœ‰TCPå’ŒUDPä¸¤ç§åè®®\n3. **ç½‘ç»œå±‚**ï¼Œæä¾›è·¯ç”±å’Œå¯»å€çš„åŠŸèƒ½ï¼Œç¡®ä¿ä¸¤è¾¹çš„ç³»ç»Ÿèƒ½äº’è”ï¼Œå¹¶é€‰æ‹©æœ€ä½³è·¯å¾„ï¼Œç½‘ç»œå±‚ä¸æä¾›é€šä¿¡æœåŠ¡ï¼Œä¸”ç½‘ç»œå±‚åªå¯¹æŠ¥æ–‡å¤´éƒ¨è¿›è¡Œå·®é”™æ ¡éªŒï¼Œåè®®æœ‰IPï¼ŒICMPï¼ŒARPï¼ˆè·¯ç”±å™¨ï¼‰\n4. **é“¾è·¯å±‚**ï¼Œå°†ç½‘ç»œå±‚çš„æ•°æ®å°è£…æˆå¸§ï¼Œç„¶è¿›è¡Œä¼ è¾“ï¼Œå¹¶è¿›è¡Œä¸€äº›å·®é”™æ§åˆ¶ï¼ŒPPPï¼ŒHDLCï¼ŒMACï¼ˆç½‘æ¡¥ï¼Œäº¤æ¢æœºï¼‰\n5. **ç‰©ç†å±‚**ï¼Œåˆ©ç”¨ä¸€äº›ä¼ è¾“ä»‹è´¨ï¼Œä¸ºæ•°æ®é“¾è·¯å±‚æä¾›ç‰©ç†è¿æ¥ï¼Œæ—¶é—´bitæµçš„ä¼ è¾“ï¼ˆé›†çº¿å™¨ï¼‰\n\n# æ“ä½œç³»ç»Ÿ\n\nç®¡ç†è®¡ç®—æœºèµ„æºï¼ŒåŒ…æ‹¬CPUï¼Œå†…å­˜ï¼Œç£ç›˜ç­‰ï¼Œæä¾›ä¸€äº›æ¥å£æœåŠ¡ä¸ä¸€äº›ç¬¬3æ–¹çš„è½¯ä»¶\n\n## è¿›ç¨‹ & çº¿ç¨‹ & åç¨‹\n**è¿›ç¨‹5æ€æ¨¡å‹ï¼š** 1.æ–°å»ºï¼ˆforkï¼‰ 2.å°±ç»ª 3.è¿è¡Œ 4.ç­‰å¾… 5.ç»ˆæ­¢\n\nè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿ**èµ„æºåˆ†é…**çš„åŸºæœ¬å•ä½ï¼Œå½“æ‰§è¡Œä¸€ä¸ªç¨‹åºæ—¶å€™ç³»ç»Ÿå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ†é…ç»™è¿™ä¸ªè¿›ç¨‹ä¸€äº›æ‰§è¡Œæ‰€éœ€è¦çš„èµ„æºï¼ŒåŒ…æ‹¬æ‰“å¼€çš„æ–‡ä»¶ï¼Œè™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´ç­‰\n> **å­¤å„¿è¿›ç¨‹**ï¼šçˆ¶è¿›ç¨‹è¢«killäº†ï¼Œè€Œå­è¿›ç¨‹ä»ç„¶å­˜åœ¨å°±ä¼šå˜æˆå­¤å„¿è¿›ç¨‹ï¼Œè¢«initè¿›ç¨‹æ”¶å…»\n> \n> **åƒµå°¸è¿›ç¨‹**ï¼šçˆ¶è¿›ç¨‹æ²¡æœ‰wait()å­è¿›ç¨‹ï¼Œè¿›ç¨‹é€€å‡ºçš„æ—¶å€™ä¼šé‡Šæ”¾æ‰€å ç”¨çš„èµ„æºï¼Œä½†æ˜¯ä¸ä¼šé‡Šæ”¾task_structé‡Œä¸€äº›ç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯çˆ¶è¿›ç¨‹å¯èƒ½ä¼šæ¯”è¾ƒå…³å¿ƒï¼Œçˆ¶è¿›ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨waitç›¸å…³æ–¹æ³•å»è·å–å­è¿›ç¨‹çš„è¿™äº›ä¿¡æ¯ï¼Œä¹‹åç³»ç»Ÿä¾¿æ‰ä¼šå®Œå…¨å›æ”¶å­è¿›ç¨‹ï¼Œæ‰€ä»¥å¦‚æœçˆ¶è¿›ç¨‹ä¸è°ƒç”¨waitå°±ä¼šå¯¼è‡´å­è¿›ç¨‹å˜æˆåƒµå°¸è¿›ç¨‹ï¼Œå ç”¨è¿›ç¨‹å·\n\n\nçº¿ç¨‹å°±æ˜¯è¿›ç¨‹ä¸­èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œçš„å®ä½“ï¼Œä¸€ä¸ªè¿›ç¨‹å†…è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ˜¯è¿›ç¨‹çš„ç»„æˆéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å¤„ç†å™¨**è°ƒåº¦æ‰§è¡Œ**çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹å†…ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºï¼Œå…±åŒå®Œæˆä»»åŠ¡\n\n> **Javaçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼š** 1.æ–°å»ºï¼ˆnewï¼‰ 2.è¿è¡Œ 3.é˜»å¡ 4.ç­‰å¾… 5.é™æ—¶ç­‰å¾… 6.ç»ˆæ­¢\n\nåç¨‹ï¼Œè‹±æ–‡Coroutinesï¼Œæ˜¯ä¸€ç§æ¯”çº¿ç¨‹æ›´åŠ è½»é‡çº§çš„å­˜åœ¨ï¼Œåç¨‹ä¸æ˜¯è¢«æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€ç®¡ç†ï¼Œè€Œå®Œå…¨æ˜¯ç”±ç¨‹åºæ‰€æ§åˆ¶ï¼ŒéæŠ¢å å¼çš„è°ƒåº¦ï¼Œåˆ›å»ºæˆæœ¬æ›´ä½ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä½ï¼Œå½“å‘ç”ŸIOé˜»å¡çš„æ—¶å€™è°ƒåº¦å™¨å¯ä»¥è®°å½•ä¸Šä¸‹æ–‡ç„¶åä¸»åŠ¨çš„è®©å‡ºCPUæ‰§è¡Œæƒï¼Œå®ç°ååŒå¼è°ƒåº¦\n## æ­»é”\n1. **äº’æ–¥æ¡ä»¶**ï¼šè¯¥èµ„æºä»»æ„æ—¶åˆ»åªç”±ä¸€ä¸ªçº¿ç¨‹å ç”¨\n2. **è¯·æ±‚ä¸ä¿æŒæ¡ä»¶**ï¼šä¸€ä¸ªçº¿ç¨‹å› ä¸ºè¯·æ±‚èµ„æºè€Œé˜»å¡ï¼Œå…¶ä»–çº¿ç¨‹è·å–èµ„æºä¿æŒä¸å˜\n3. **ä¸å‰¥å¤ºæ¡ä»¶**ï¼šçº¿ç¨‹å·²ç»è·å–çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæˆä¹‹å‰ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¼ºè¡Œå‰¥å¤º\n4. **å¾ªç¯ç­‰å¾…**ï¼šè‹¥å¹²çº¿ç¨‹ä¹‹å‰å½¢æˆçš„ä¸€ç›´å¾ªç¯çš„ä¾èµ–ï¼Œæ¯”è¾ƒå®¹æ˜“æ‰“ç ´çš„å°±æ˜¯å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œåªè¦æŒ‰ç…§é¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾åˆ™ååºå°±èƒ½æ‰“ç ´ä¾èµ–\n## å­˜å‚¨ç®¡ç†\nè¿ç»­åˆ†é…ä¼šäº§ç”Ÿå¤§é‡å†…å­˜ç¢ç‰‡ï¼Œå¯ä»¥é€šè¿‡ç§»åŠ¨æ¥åˆå¹¶ä½†æ˜¯æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å‡ºç°äº†ç¦»æ•£å¼çš„åˆ†é…æ–¹å¼ï¼Œå°†è¿›ç¨‹æ•°æ®åˆ†æ•£çš„è£…å…¥ä¸ç›¸é‚»çš„å†…å­˜åˆ†åŒºä¸­\n### é¡µå¼\nå°†é€»è¾‘ç©ºé—´ç­‰åˆ†ä¸ºé¡µï¼Œç„¶åå°†ç‰©ç†å†…å­˜ç©ºé—´ç­‰åˆ†ä¸ºå—ï¼Œä¸é¡µé¢å¤§å°ç›¸åŒï¼Œåˆ†é…å†…å­˜æ—¶å°†è¿›ç¨‹æ•°æ®ä»¥å—ä¸ºå•ä½ï¼Œå­˜æ”¾åˆ°ç¦»æ•£çš„ç‰©ç†å†…å­˜ä¸­ï¼Œé¡µçš„å¤§å°å›ºå®šï¼Œ**ä¸ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡**ï¼Œåªä¼šäº§ç”Ÿå°‘é‡å†…éƒ¨ç¢ç‰‡ï¼Œç”¨æˆ·ä¸å¯è§ï¼Œç”±**æ“ä½œç³»ç»Ÿç®¡ç†**\n### æ®µå¼\næŒ‰ç…§ç¨‹åºè‡ªèº«çš„é€»è¾‘å…³ç³»åˆ’åˆ†ä¸ºå‡ ä¸ªæ®µï¼Œä»¥æ®µä¸ºå•ä½åˆ†é…å†…å­˜ï¼Œæ¯ä¸ªæ®µåœ¨å†…å­˜ä¸­å è¿ç»­ç©ºé—´ï¼Œä½†æ˜¯å„ä¸ªæ®µä¹‹é—´å¯ä»¥ä¸ç›¸é‚»ï¼Œåˆ†æ®µæ›´å®¹æ˜“å®ç° **ä¿¡æ¯çš„å…±äº«å’Œä¿æŠ¤**ï¼Œæ®µçš„é•¿åº¦ä¸å›ºå®šï¼Œåˆ†é…è¾ƒå¤§çš„æ®µ**ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡**ï¼Œå¯¹ç”¨æˆ·å¯è§ï¼Œç”¨æˆ·ç¼–ç¨‹éœ€è¦æ˜¾å¼çš„ç»™å‡ºæ®µå\n### æ®µé¡µå¼\nå…ˆåˆ†æ®µï¼Œåœ¨æ¯ä¸€æ®µå†…å†åšåˆ†é¡µï¼Œå­˜å‚¨ä¾ç„¶é‡‡ç”¨é¡µå¼å­˜å‚¨ï¼Œå¢åŠ äº†ç¡¬ä»¶æˆæœ¬ï¼Œç³»ç»Ÿå¤æ‚åº¦å¤§\n## è¿›ç¨‹é€šä¿¡\n1. ç®¡é“ï¼ˆpipeï¼‰\n2. ä¿¡å·ï¼ˆsignalï¼‰\n3. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageï¼‰\n4. å…±äº«å†…å­˜(share memory)\n5. ä¿¡å·é‡(semaphore)\n\n## è°ƒåº¦ç®—æ³•\n### è¿›ç¨‹è°ƒåº¦\n1. **å…ˆæ¥å…ˆæœåŠ¡**ï¼ˆFirst Come First Severdï¼ŒFCFSï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå¯¹é•¿ä½œä¸šå‹å¥½ï¼ŒçŸ­ä½œä¸šä¸å‹å¥½ï¼Œå¯èƒ½é•¿æœŸå¾—ä¸åˆ°æ‰§è¡Œ\n2. **æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦**ï¼ˆShort Job Firstï¼ŒSJFï¼‰ï¼Œä¼˜å…ˆé€‰æ‹©çŸ­ä½œä¸šè¿è¡Œï¼Œå¯¹çŸ­ä½œä¸šæœ‰åˆ©ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´é•¿ä½œä¸šé¥¥é¥¿\n3. **é«˜å“åº”æ¯”ä¼˜å…ˆ**ï¼ˆHighest Response Ratio Nextï¼ŒHRRNï¼‰ï¼Œä¼˜å…ˆæ‰§è¡Œå“åº”æ¯”ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œ**å“åº”æ¯” = (ç­‰å¾…æ—¶é—´+è¦æ±‚æœåŠ¡æ—¶é—´)/è¦æ±‚æœåŠ¡æ—¶é—´**ï¼Œè¿™æ ·é¦–å…ˆè¦æ±‚æœåŠ¡æ—¶é—´çŸ­çš„çŸ­ä½œä¸šä¼šæ›´å®¹æ˜“è¢«é€‰ä¸­ï¼ŒåŒæ—¶é•¿ä½œä¸šç­‰å¾…æ—¶é—´è¶Šé•¿ï¼Œç›¸åº”æ¯”ä¹Ÿä¼šè¶Šé«˜ï¼Œå…¼é¡¾é•¿çŸ­ä½œä¸š\n4. **æ—¶é—´ç‰‡è½®è½¬**ï¼ˆRound Robinï¼ŒRRï¼‰æ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œå¦‚æœæ—¶é—´ç‰‡ç”¨å®Œï¼Œä»ç„¶åœ¨æ‰§è¡Œå°±ä¼šä¸­æ–­è¯¥è¿›ç¨‹ï¼Œåˆ‡æ¢ä¸ºå…¶ä»–è¿›ç¨‹ï¼Œå¦‚æœå‘ç”Ÿäº†é˜»å¡åæå‰ç»“æŸä¹Ÿä¼šè¿›è¡Œåˆ‡æ¢ã€‚æ—¶é—´ç‰‡è®¾ç½®å¤ªçŸ­ä¼šå¯¼è‡´å¤§é‡çš„çº¿ç¨‹åˆ‡æ¢ï¼Œå¦‚æœè®¾ç½®å¤ªé•¿å°±ä¼šå¯¼è‡´çŸ­ä½œä¸šé¥¥é¥¿ï¼Œä¸€èˆ¬è®¾ç½®20ms-50ms\n5. **æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦**ï¼ˆHighest Priority Firstï¼ŒHPFï¼‰ï¼Œä¼˜å…ˆçº§å¯åˆ†ä¸º **é™æ€ä¼˜å…ˆçº§** å’Œ **åŠ¨æ€ä¼˜å…ˆçº§**ï¼ŒåŒæ—¶æœ‰ä¸¤ç§è°ƒåº¦æ–¹æ³•ï¼Œ **æŠ¢å å¼** å’Œ **éæŠ¢å å¼**ï¼ˆå‡ºç°ä¼˜å…ˆçº§æ›´é«˜çš„ï¼Œç«‹é©¬æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œæ‰§è¡Œä¼˜å…ˆçº§æ›´é«˜çš„ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ä¼˜å…ˆçº§çš„æ°¸è¿œä¸ä¼šæ‰§è¡Œ\n6. **å¤šçº§åé¦ˆé˜Ÿåˆ—**ï¼Œç»“åˆäº†4å’Œ5\n\n### å†…å­˜é¡µé¢è°ƒåº¦\nä¹Ÿå°±æ˜¯åœ¨äº§ç”Ÿç¼ºé¡µä¸­æ–­çš„æ—¶å€™ï¼ŒæŠŠç£ç›˜ä¸­ç¼ºå¤±çš„é¡µé¢è°ƒåº¦è¿›è™šæ‹Ÿåœ°å€æ˜ å°„çš„ç‰©ç†å†…å­˜ä¸­æ—¶ï¼Œç”±äºç‰©ç†å†…å­˜ç©ºé—´ä¸è¶³æ‰€ä»¥éœ€è¦é€‰æ‹©ä¸€ä¸ªç‰©ç†é¡µè¿›è¡Œæ›¿æ¢\n\n1. **æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•**ï¼ˆOPTï¼‰ï¼Œç½®æ¢ **æœªæ¥** æœ€é•¿æ—¶é—´ä¸è®¿é—®çš„é¡µé¢ï¼Œæ— æ³•å®ç°ï¼Œä»…ä»…æ˜¯ç†è®ºæ–¹æ³•\n2. **å…ˆè¿›å…ˆå‡ºç½®æ¢**ï¼ˆFIFOï¼‰ï¼Œç›´æ¥é€‰æ‹©å†…å­˜ä¸­é©»ç•™æœ€ä¹…çš„é¡µé¢è¿›è¡Œæ·˜æ±°\n3. **æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨**ï¼ˆLRUï¼‰ï¼Œé€‰æ‹© **è¿‡å»** æœ€é•¿æ—¶é—´æœªè®¿é—®çš„é¡µé¢è¿›è¡Œç½®æ¢\n4. **æ—¶é’Ÿé¡µé¢ç½®æ¢**ï¼ˆLOCKï¼‰ï¼Œå°†é¡µé¢ä¿å­˜åœ¨ä¸€ä¸ªç¯å½¢é“¾è¡¨ä¸­ï¼Œä¸€ä¸ªè¡¨é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢ï¼Œå½“å‘ç”Ÿç¼ºé¡µä¸­æ–­çš„æ—¶å€™ï¼Œæ£€æŸ¥æŒ‡é’ˆæŒ‡å‘çš„é¡µé¢çŠ¶æ€æ˜¯å¦ä¸º0ï¼Œä¸º0å°±æ·˜æ±°è¯¥é¡µé¢ï¼Œå¹¶æ’å…¥è¿™ä¸ªä½ç½®ï¼Œç„¶åæŠŠè¡¨é’ˆåç§»ï¼Œå¦‚æœæ˜¯1ï¼Œå°±æ¸…é™¤çŠ¶æ€ä½ä¸º0ï¼Œç„¶åç»§ç»­å‘å‰æ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ°0\n5. **æœ€ä¸å¸¸ç”¨ç½®æ¢ç®—æ³•**ï¼ˆLFUï¼‰,æ ¹æ® **è¿‡å»** é¡µé¢çš„è®¿é—®æ¬¡æ•°ï¼Œé€‰æ‹©è®¿é—®æ¬¡æ•°æœ€å°‘çš„é¡µé¢æ·˜æ±°ï¼Œç»™æ¯ä¸ªé¡µé¢å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç„¶åç”¨é“¾è¡¨æŒ‰ç…§å¤§å°ä¸²èµ·æ¥ã€‚å®ç°èµ·æ¥å…¶å®æ¶ˆè€—ä¼šæ¯”è¾ƒå¤§ï¼Œæˆæœ¬æ¯”è¾ƒé«˜\n\n## DMA\nDMAï¼Œç›´æ¥å†…å­˜è®¿é—®ï¼Œä½¿å¾—IOæ¨¡å—åœ¨ä¸æ¶‰åŠåˆ°CPUçš„æƒ…å†µä¸‹ï¼Œè¯»å–æˆ–è€…å†™å…¥å†…å­˜ï¼Œæé«˜æ•ˆç‡\n\n## è™šæ‹Ÿå†…å­˜\nè™šæ‹Ÿå†…å­˜å®é™…ä¸Šæ˜¯å¯¹ä¸»å­˜çš„ä¸€ç§æŠ½è±¡ï¼Œè®©æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½ **ç‹¬å ** å†…å­˜ï¼Œå®é™…ä¸Šè¿›ç¨‹å‘å‡ºçš„åœ°å€éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼Œé€šè¿‡è™šæ‹Ÿå¯»å€æ¥é—´æ¥çš„å¼•ç”¨ä¸»å­˜ï¼Œcpuäº§ç”Ÿçš„è™šæ‹Ÿåœ°å€å°†é€šè¿‡ **MMU** åˆ©ç”¨ **é¡µè¡¨ï¼ˆPTEï¼ˆPage Table Entryï¼‰é›†åˆï¼‰**  ç¿»è¯‘æˆä¸»å­˜çš„ç‰©ç†åœ°å€ï¼ŒåŒæ—¶CPUè¿˜ä¸ºé¡µè¡¨å¯»å€æä¾›äº†ç¼“å­˜ç­–ç•¥ **TLBï¼ˆTranslation Lookaside Bufferï¼‰** æé«˜ç¿»è¯‘é€Ÿåº¦\n\nè™šæ‹Ÿåœ°å€è¢«åˆ†ä¸º: **è™šæ‹Ÿé¡µå·ï¼ˆVPNï¼‰**ï¼ˆé«˜ä½ï¼‰+ **åç§»é‡ï¼ˆVPOï¼‰**ï¼ˆä½ä½ï¼‰\né€šè¿‡è™šæ‹Ÿé¡µå·å®šä½é¡µè¡¨ä¸­çš„`PTE`ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆï¼Œæœ‰æ•ˆå°±æ‹¼æ¥é¡µè¡¨ä¸­çš„**ç‰©ç†åœ°å€ï¼ˆPPNï¼‰** å’Œè™šæ‹Ÿåœ°å€çš„ **åç§»é‡** æ„æˆç‰©ç†åœ°å€ï¼Œå¦‚æœæ— æ•ˆå°±å‘ç”Ÿ **ç¼ºé¡µä¸­æ–­** ï¼Œè¿™é‡Œä¸­æ–­é¡µåˆ†ä¸ºè½¯ä¸­æ–­å’Œç¡¬ä¸­æ–­ï¼Œè½¯ä¸­æ–­å°±æ˜¯æŒ‡é¡µé¢å·²ç»åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œåªæ˜¯é¡µè¡¨ä¸­æ²¡æœ‰ï¼Œè¿™æ—¶åªè¦é‡æ–°æ˜ å°„ä¸€ä¸‹å°±è¡Œäº†ï¼Œè€Œç¡¬ä¸­æ–­å°±æ˜¯ç‰©ç†å†…å­˜ä¸­æ²¡æœ‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä»ç£ç›˜ä¸­åŠ è½½é¡µåˆ°ç‰©ç†å†…å­˜ä¸­ï¼ˆ**æŒ‰éœ€åˆ†é¡µ**ï¼‰\n\n> fork()å…¶å®å°±æ˜¯å¤åˆ¶é¡µè¡¨ï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ‰€æœ‰æ•°æ®ï¼Œä½†æ˜¯å½“æŸä¸€æ–¹æ‰§è¡Œäº†**å†™å…¥**æ“ä½œå°±ä¼šè§¦å‘COWï¼Œç³»ç»Ÿå›ä¸ºè¯¥è¿›ç¨‹ç”³è¯·æ–°çš„å†…å­˜ï¼Œå°†è¦ä¿®æ”¹æ•°æ®æ‹·è´åˆ°æ–°çš„åŒºåŸŸï¼Œå†è¿›è¡Œè¯»å†™\n### å¥½å¤„\n1. è™šæ‹Ÿå†…å­˜åˆ©ç”¨ä¸»å­˜èµ·åˆ°ç¼“å­˜çš„ä½œç”¨ï¼Œæé«˜è¿›ç¨‹è®¿é—®ç£ç›˜çš„æ•ˆç‡\n2. è™šæ‹Ÿå†…å­˜å¯ä»¥æ§åˆ¶è¿›ç¨‹å¯¹ç‰©ç†å†…å­˜çš„è®¿é—®ï¼Œéš”ç¦»ä¸åŒè¿›ç¨‹çš„è®¿é—®æƒé™ï¼Œæé«˜å®‰å…¨æ€§èƒ½ï¼ˆé¡µè¡¨ä¸­åŠ å…¥ä¿æŠ¤ä½ï¼‰\n3. ä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›äº†ä¸€è‡´çš„åœ°å€ç©ºé—´ï¼Œç®€åŒ–å†…å­˜ç®¡ç†ï¼Œå†…å­˜åˆ†é…ï¼Œå¯ä»¥ä¸€æ¬¡åˆ†é…å¤šä¸ªè¿ç»­çš„è™šæ‹Ÿåœ°å€ï¼Œä½†æ˜¯åœ¨ç‰©ç†ä¸Šä¸è¿ç»­ï¼Œç®€åŒ–å†…å­˜å…±äº«\n### mmapå†…å­˜æ˜ å°„\nå°†æ–‡ä»¶çš„ç‰©ç†åœ°å€å’Œè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€è¿›è¡Œæ˜ å°„ï¼ˆæ­¤æ—¶ä»…ä»…æ˜¯è¿›è¡Œäº†æ˜ å°„ï¼Œæ²¡æœ‰æ‹·è´ï¼‰ï¼Œç„¶åå½“è¿›ç¨‹å‘èµ·å¯¹è¿™å—è™šæ‹Ÿå†…å­˜çš„è®¿é—®çš„æ—¶å€™å°±ä¼šå‘ç”Ÿ**ç¼ºé¡µ**ï¼Œå†…æ ¸å°±ä¼šå°†æ–‡ä»¶ä»ç£ç›˜æ‹·è´åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œç„¶åè¿›ç¨‹å°±å¯ä»¥ç›´æ¥å¯¹è¿™å—å†…å­˜è¿›è¡Œè¯»å†™ï¼Œç³»ç»Ÿåå°ä¼šè‡ªåŠ¨åˆ·æ–°è„é¡µåˆ°ç£ç›˜ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡`fsync`å¼ºåˆ¶åˆ·ç›˜ï¼‰\n\nå¸¸è§„çš„æ–‡ä»¶è¯»å†™ä¸ºäº†ä¿è¯è¯»å†™çš„æ•ˆç‡å’Œä¿æŠ¤ç£ç›˜ï¼Œæä¾›äº† **é¡µç¼“å­˜ï¼ˆå†…æ ¸ç¼“å†²åŒºï¼‰** ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¯»å†™æŸä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ä¼šå…ˆå°†æ–‡ä»¶é¡µä»ç£ç›˜æ‹·è´åˆ° **é¡µç¼“å­˜** ï¼Œä½†æ˜¯ç”±äºé¡µç¼“å­˜ä¾ç„¶ä½äºå†…æ ¸æ€ï¼Œç”¨æˆ·è¿›ç¨‹æ— æ³•å¯»å€ï¼Œæ‰€ä»¥è¿˜éœ€è¦å°†æ•°æ®ä» **é¡µç¼“å­˜** æ‹·è´åˆ°ç”¨æˆ·çš„è¿›ç¨‹ç©ºé—´ï¼Œç„¶åæ‰èƒ½æ“ä½œï¼Œç›¸æ¯”mmapçš„æ–¹æ³•å¤šäº†ä¸€æ¬¡æ‹·è´æ“ä½œ\n## äº”ç§IOæ¨¡å‹\n1. é˜»å¡IOï¼Œè°ƒç”¨è€…ä¸€ç›´é˜»å¡ï¼ŒçŸ¥é“å†…æ ¸å°†æ•°æ®å‡†å¤‡å¥½ï¼Œç„¶åå°†æ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€\n2. éé˜»å¡IOï¼Œå†…æ ¸æ²¡å‡†å¤‡å¥½å°±ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ç ï¼Œè°ƒç”¨è€…ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ä¸æ–­çš„è½®è¯¢ï¼Œè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å¥½\n3. å¤šè·¯å¤ç”¨IOï¼Œç±»ä¼¼éé˜»å¡ï¼Œåªä¸è¿‡è½®è¯¢äº¤ç»™å†…æ ¸ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ä¼šå°†è¿›ç¨‹åŠ å…¥åˆ°å¯¹åº”äº‹ä»¶çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå¾…äº‹ä»¶å°±ç»ªæ—¶å€™å”¤é†’è¿›ç¨‹ï¼Œé¿å…ç©ºè½®è¯¢\n4. å¼‚æ­¥IOï¼Œå®Œå…¨çš„éé˜»å¡çš„IOæ–¹å¼ï¼Œå½“æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ä¼šé€šè¿‡å›è°ƒå‡½æ•°æ¥å¤„ç†\n5. ä¿¡å·é©±åŠ¨IOï¼Œå†…æ ¸åœ¨æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ä½¿ç”¨ä¿¡å·å¤„ç†ç¨‹åºæ¥è¿›è¡Œé€šçŸ¥\n\n## æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œæ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œç´¢å¼•èŠ‚ç‚¹è¡¨\n**æ–‡ä»¶æè¿°ç¬¦è¡¨**ï¼šè¿›ç¨‹åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šåœ¨å†…å­˜ä¸­å¼€è¾Ÿtask_structç»“æ„ä½“ï¼Œåˆå«è¿›ç¨‹è¡¨ï¼Œç”¨äºå­˜æ”¾è¿›ç¨‹è¿è¡ŒæœŸé—´çš„ä¸€äº›ç›¸å…³ä¿¡æ¯\n\n**æ–‡ä»¶æè¿°ç¬¦è¡¨**ï¼šè®°å½•è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ **å†…æ ¸ä¸­çš„æ–‡ä»¶è¡¨** \n\n**æ‰“å¼€æ–‡ä»¶è¡¨ï¼ˆåˆå«åšç³»ç»Ÿçº§çš„æè¿°ç¬¦è¡¨ï¼‰**ï¼šæ‰€æœ‰è¿›ç¨‹å…±äº«è¿™å¼ è¡¨ï¼Œè®°å½•äº†å½“å‰æ–‡ä»¶çš„åç§»é‡ï¼Œå¼•ç”¨è®¡æ•°ï¼Œä»¥åŠæŒ‡å‘`i-node`è¡¨çš„æŒ‡é’ˆï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º0å†…æ ¸å°±ä¼šåˆ é™¤è¿™ä¸ªè¡¨é¡¹\n\n**i-nodeè¡¨**ï¼šè®°å½•æ–‡ä»¶å¯¹åº”çš„inodeå·ï¼Œä»¥åŠå¯¹åº”çš„block\n## è½¯é“¾æ¥ & ç¡¬é“¾æ¥\n\n**ç¡¬é“¾æ¥ ï¼ˆlnï¼‰:** å®é™…ä¸Šæ˜¯ç»™æ–‡ä»¶åˆ›å»ºäº†ä¸€ä¸ªåˆ«åï¼Œé“¾æ¥æ–‡ä»¶å’ŒåŸæ–‡ä»¶æŒ‡å‘çš„å…¶å®æ˜¯åŒä¸€ä¸ªinodeï¼Œåˆ›å»ºä¸€ä¸ªç¡¬è¿æ¥å®é™…ä¸Šå¯¹åº”æ–‡ä»¶è¡¨ä¸­çš„å¼•ç”¨è®¡æ•°+1ï¼Œåˆ é™¤ä»»æ„ä¸€ä¸ªåªæ˜¯æ–‡ä»¶è¡¨çš„å¼•ç”¨è®¡æ•°å‡ä¸€ï¼Œå¹¶ä¸ä¼šå½±å“å¦ä¸€ä¸ªæ–‡ä»¶\n\n**è½¯è¿æ¥ï¼ˆln -sï¼‰** è½¯è¿æ¥å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œè½¯è¿æ¥æ–‡ä»¶çš„inodeä¼šæŒ‡å‘åŸæ–‡ä»¶æœ¬èº«çš„inodeï¼Œå¦‚æœåˆ é™¤äº†åŸæ–‡ä»¶è½¯è¿æ¥å°±å¤±æ•ˆäº†\n\n## å¤šè·¯å¤ç”¨\næåˆ°å¤šè·¯å¤ç”¨å°±ä¸å¾—ä¸è¯´ä¸€ä¸‹é˜»å¡IOï¼Œé˜»å¡IOå°±æ˜¯è¯´å½“IOæ“ä½œå‘èµ·åä¼šè¢«é˜»å¡ç›´åˆ°æ”¶åˆ°æ•°æ®æ‰è¿”å›ï¼Œå› æ­¤å½“ä½¿ç”¨é˜»å¡IOçš„æ—¶å€™é€šå¸¸ä¼šåˆ›å»ºå¤šä¸ªçº¿ç¨‹å»ç›‘å¬æè¿°ç¬¦ï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸€æ¥åˆ‡æ¢æˆæœ¬é«˜ï¼ŒåŒæ—¶å¤šçº¿ç¨‹çš„å†…å­˜å¼€é”€ä¹Ÿä¼šæ¯”è¾ƒå¤§\n\næ‰€ä»¥åé¢å¼•å…¥äº†éé˜»å¡IOï¼Œéé˜»å¡IOä¸ä¼šæŒ‚èµ·çº¿ç¨‹ï¼Œè°ƒç”¨åç«‹å³è¿”å›ç»“æœï¼Œæ‰€ä»¥å¯ä»¥åœ¨**ä¸€ä¸ªçº¿ç¨‹ä¸­è½®è¯¢å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å‡†å¤‡å°±ç»ª**ï¼Œä½†æ˜¯éé˜»å¡IOæ¯æ¬¡å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼ˆ`syscall`ï¼‰éƒ½åªèƒ½æ£€æµ‹ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªï¼Œç³»ç»Ÿè°ƒç”¨æˆæœ¬å¾ˆé«˜ï¼Œå¦‚æœæ–‡ä»¶æè¿°ç¬¦å¾ˆå¤šï¼Œæ€§èƒ½å¼€é”€å°±ä¼šå¾ˆå¤§ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¸åœçš„å»éå†æ‰€æœ‰çš„FDï¼ŒåŒ…æ‹¬æ²¡æœ‰å‘ç”Ÿè¯»å†™äº‹ä»¶çš„FDï¼Œè¿™æ ·ä¼šå¯¼è‡´CPUçš„æ¶ˆè€—éå¸¸å¤§\n\nè€ŒIOå¤šè·¯å¤ç”¨åˆ™å¯ä»¥é€šè¿‡**ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ª**ï¼ŒåŒæ—¶ä¹Ÿä¸ç”¨åƒ **éé˜»å¡IO** ä¸€æ ·ä¸€ç›´è½®è¯¢æ‰€æœ‰çš„FDï¼Œè€Œæ˜¯ç”±äº‹ä»¶é©±åŠ¨ï¼Œå½“æœ‰ç›‘å¬çš„FDå‡†å¤‡å°±ç»ªæ—¶å€™é€šçŸ¥è¿›ç¨‹è¿”å›å¤„ç†ï¼Œå¦åˆ™å°±ä¼šæŒ‚èµ·è¿›ç¨‹åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œé¿å…CPUç©ºè½¬\n### select\n```c\n// Linux\nint select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);\n//ä½å›¾ç»“æ„\n#define __FD_SETSIZE    1024\ntypedef __kernel_fd_set     fd_set;\ntypedef struct {\n    unsigned long fds_bits[__FD_SETSIZE / (8 * sizeof(long))];\n} __kernel_fd_set;\n\nFD_SET(int fd, fd_set *set); // Add fd to the set\nFD_CLR(int fd, fd_set *set); // Remove fd from the set\nFD_ISSET(int fd, fd_set *set); // Return true if fd is in the set\nFD_ZERO(fd_set *set); // Clear all entries from the set\n```\n#### ç‰¹ç‚¹\n\n1. è¾“å…¥è¾“å‡ºéƒ½æ˜¯ç›¸åŒçš„fd_setï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½éœ€è¦é‡æ–°è®¾ç½®fd\n2. å°†fd_setä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œæ€§èƒ½æŸè€—å¤§\n3. å†…éƒ¨æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½æ˜¯æ— å·®åˆ«è½®è¯¢ï¼Œå½“æè¿°ç¬¦å¾ˆå¤šçš„æ—¶å€™æ¶ˆè€—è¾ƒå¤§\n4. fd_setå¤§å°æœ‰é™ï¼Œæœ€å¤š1024ï¼ˆfd_setä¸ºé•¿åº¦ä¸º32çš„é•¿æ•´å‹æ•°ç»„ï¼Œä½å›¾è¡¨ç¤ºä¸€ä¸ªbitå°±æ˜¯ä¸€ä¸ªfdï¼Œæ‰€ä»¥èƒ½è¡¨ç¤º32*32=1024ä¸ªFDï¼‰\n5. ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœæ­£åœ¨ä½¿ç”¨çš„fdè¢«å…¶ä»–è¿›ç¨‹å…³é—­çš„è¯ç»“æœå°±æœªçŸ¥äº†\n\n#### å®ä¾‹\n> æœ‰ç©ºå†æ¥å†™\n\n### poll\n```c\n#include <poll.h>\nint poll ( struct pollfd * fds, unsigned int nfds, int timeout);\n\nstruct pollfd {\n    int fd;               /* æ–‡ä»¶æè¿°ç¬¦ */\n    short events;         /* ç­‰å¾…çš„äº‹ä»¶ */\n    short revents;        /* å®é™…å‘ç”Ÿäº†çš„äº‹ä»¶ */\n} ; \n```\n#### ç‰¹ç‚¹\n1. poll_fdæ•°ç»„åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œé€šè¿‡eventså’Œreventsæ ‡è¯†å…³æ³¨çš„äº‹ä»¶å’Œå‘ç”Ÿçš„äº‹ä»¶\n2. pollä½¿ç”¨é“¾è¡¨æ¥å®ç°ï¼Œæ²¡æœ‰æœ€å¤§fdçš„é™åˆ¶\n3. ä½†æ˜¯å’Œselectä¸€æ ·éœ€è¦é¢‘ç¹çš„å°†pollfdä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€\n4. pollè¿”å›åï¼Œä»ç„¶éœ€è¦å¯¹pollfdä¸­çš„æ¯ä¸ªå…ƒç´ æ£€æŸ¥å…¶reventså€¼ï¼Œæ¥åˆ¤æ–­äº‹ä»¶æ˜¯å¦å‘ç”Ÿ\n5. æ°´å¹³è§¦å‘ï¼Œå½“æŠ¥å‘Šäº†æŸä¸ªfdåå¦‚æœæ²¡æœ‰è¢«å¤„ç†ï¼Œä¸‹æ¬¡è¿˜ä¼šç»§ç»­æŠ¥å‘Šè¯¥fd\n#### å®ä¾‹\n> æœ‰ç©ºå†æ¥å†™\n### epoll\n\n```c\n#include <sys/epoll.h>\n//åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§\nint epoll_create(int size);\n//epollçš„äº‹ä»¶æ³¨å†Œå‡½æ•°\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);\n//ç­‰å¾…äº‹ä»¶çš„äº§ç”Ÿï¼Œç±»ä¼¼äºselect()è°ƒç”¨ã€‚\nint epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);\n```\n#### ç‰¹ç‚¹\n1. åœ¨é«˜é€Ÿç¼“å­˜cacheä¸­ç”¨çº¢é»‘æ ‘ä¿å­˜è¦ç›‘å¬çš„äº‹ä»¶ï¼ŒåŒæ—¶ä½¿ç”¨äº†ä¸€ä¸ªlisté“¾è¡¨è®°å½•å‡†å¤‡å°±ç»ªçš„äº‹ä»¶ï¼Œå½“`epoll_wait`è¿”å›çš„æ—¶å€™åªéœ€è¦æŸ¥çœ‹listä¸­åˆæ²¡æœ‰æ•°æ®å°±è¡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä»å†…æ ¸æ€æ‹·è´å…¨éƒ¨çš„æè¿°ç¬¦åˆ°ç”¨æˆ·æ€ï¼Œåªéœ€è¦æ‹·è´å°‘é‡çš„å°±ç»ªfdå°±å¯ä»¥äº†ï¼Œå¹¶ä¸”è°ƒç”¨`epoll_wait`çš„æ—¶å€™å¹¶ä¸ç”¨æ‹·è´æè¿°ç¬¦åˆ°å†…æ ¸æ€ï¼Œå› ä¸ºå‰é¢`epoll_ctl`å·²ç»æ‹·è´äº†ï¼Œç›¸æ¯”ä¹‹å‰selecl/pollæ•ˆç‡å¾ˆå¤§æå‡\n\n#### å·¥ä½œæ¨¡å¼\n **LTæ¨¡å¼** ï¼šå½“epoll_ waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºæ²¡æœ‰ä¸€æ¬¡æ€§æŠŠæ•°æ®è¯»/å†™å®Œã€‚ä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚\n \n **ETæ¨¡å¼**ï¼šå½“epoll_ waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚\n\nETæ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†epolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯”LTæ¨¡å¼é«˜ã€‚**epollå·¥ä½œåœ¨ETæ¨¡å¼çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡IO**ï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚\n> ETæ¨¡å¼ä¸‹é˜»å¡IOéœ€è¦ä¸€æ¬¡æ€§æŠŠæ•°æ®å…¨éƒ¨è¯»å®Œï¼Œä½†æ˜¯å®é™…ä¸Šepollè¿”å›å¯è¯»ï¼Œåˆ°çœŸæ­£è¯»å–æ˜¯ç”±ç©ºçª—æœŸçš„ï¼Œå¯èƒ½ä½ è¯»å–çš„æ—¶å€™æ•°æ®è¢«å…¶ä»–è¿›ç¨‹å–èµ°äº†ï¼Œå¦‚æœé‡‡ç”¨é˜»å¡è¯»å–å°±ä¼šå¯¼è‡´è¿›ç¨‹ä¸€ç›´é˜»å¡\n> \n> man 2 select ã€ŒBUGSã€èŠ‚ï¼š      \n> Under Linux, select() may report a socket file descriptor as \"ready for reading\", while nevertheless a subsequent read blocks.  This could for example happen when  data has arrived but upon examination has wrong checksum and is discarded.  There may be other circumstances in which a file descriptor is spuriously reported  as  ready.  Thus it may be safer to use O_NONBLOCK on sockets that should not block.\n\n#### å®ä¾‹\n> æœ‰ç©ºå†æ¥å†™\n\n# Linuxå¸¸ç”¨å‘½ä»¤\n## ps\n-A åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹ -au æ˜¾ç¤ºè¯¦ç»†\n\n# æµ·é‡æ•°æ®å¤„ç†\n## å¦‚ä½•ä»å¤§é‡çš„ URL ä¸­æ‰¾å‡ºç›¸åŒçš„ URLï¼Ÿ\n1. ç»™å®š aã€b ä¸¤ä¸ªæ–‡ä»¶ï¼Œå„å­˜æ”¾ 50 äº¿ä¸ª URLï¼Œæ¯ä¸ª URL å„å  64Bï¼Œå†…å­˜é™åˆ¶æ˜¯ 4Gã€‚è¯·æ‰¾å‡º aã€b ä¸¤ä¸ªæ–‡ä»¶å…±åŒçš„ URLã€‚\n    \n    64byte * 50 * 10^8 = 3000 * 10^8 byte = 300m\n    hashåˆ†æ²»ï¼Œå°†a,bä¸­çš„urlåˆ†åˆ«hashåæ¨¡1000ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨a(1,2,3,4..),b(1,2,3,4..)æ–‡ä»¶ä¸­ï¼Œç„¶åå°†a,bæ–‡ä»¶ç›´æ¥åŠ è½½åˆ°å†…å­˜ä¸­ç»Ÿè®¡å°±è¡Œäº†\n2. å¦‚ä½•ä»å¤§é‡æ•°æ®ä¸­æ‰¾å‡ºé«˜é¢‘è¯ï¼Ÿ\n\n    hashåˆ†æ²»ï¼Œå°†æ‰€æœ‰çš„æ•°æ®hashåå–æ¨¡ï¼Œåˆ†æ•£åˆ°ä¸åŒçš„å°æ–‡ä»¶ä¸­ï¼Œç„¶åç»Ÿè®¡å„ä¸ªå°æ–‡ä»¶çš„è¯é¢‘ï¼Œç„¶åç”¨å°æ ¹å †ç»Ÿè®¡TopK\n\n3. å¦‚ä½•åœ¨å¤§é‡çš„æ•°æ®ä¸­åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦å­˜åœ¨ï¼Ÿ\n\n    40 äº¿ä¸ªä¸é‡å¤æ•´æ•°ï¼Œæˆ‘ä»¬ç”¨ 40 äº¿ä¸ª bit æ¥è¡¨ç¤ºï¼Œåˆå§‹ä½å‡ä¸º 0ï¼Œé‚£ä¹ˆæ€»å…±éœ€è¦å†…å­˜ï¼š4, 000, 000, 000bâ‰ˆ512Mã€‚æˆ‘ä»¬è¯»å–è¿™ 40 äº¿ä¸ªæ•´æ•°ï¼Œå°†å¯¹åº”çš„ bit è®¾ç½®ä¸º 1ã€‚æ¥ç€è¯»å–è¦æŸ¥è¯¢çš„æ•°ï¼ŒæŸ¥çœ‹ç›¸åº”ä½æ˜¯å¦ä¸º 1ï¼Œå¦‚æœä¸º 1 è¡¨ç¤ºå­˜åœ¨ï¼Œå¦‚æœä¸º 0 è¡¨ç¤ºä¸å­˜åœ¨ã€‚\n\n    \n\n# RAFT\nhttps://juejin.im/post/6844903602918522888 è¿™ä¸ªè®²çš„ä¸é”™ï¼Œåé¢æœ‰æ—¶é—´æ ¹æ®è¿™ä¸ªå†æ•´ç†ä¸‹\n## leaderé€‰ä¸¾\nLeaderé€‰ä¸¾éœ€è¦æŸä¸ªèŠ‚ç‚¹é¦–å…ˆå‘èµ·æŠ•ç¥¨è¯·æ±‚ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªéšæœºçš„election timeoutï¼Œå½“è¶…è¿‡è¿™ä¸ªæ—¶é—´æ²¡æœ‰æ”¶åˆ°Leaderçš„å¿ƒè·³æ¶ˆæ¯å°±è®¤ä¸ºLeaderæŒ‚æ‰äº†ï¼Œå°±å›å°†è‡ªå·±çš„term+1ç„¶åå‘èµ·æŠ•ç¥¨è¯·æ±‚ï¼Œæˆä¸ºCandidateï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°è¯·æ±‚åå¦‚æœæŠ•ç¥¨ç»™è¯¥èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±ä¼šæˆä¸ºLeaderï¼ŒLeaderä¼šæ¯é—´éš”HeartbeatTimeoutå‘æ‰€æœ‰çš„Followerå‘é€å¿ƒè·³åŒ…\n## æ—¥å¿—å¤åˆ¶\nå½“ä¸€ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸ºä¸»èŠ‚ç‚¹åï¼Œå®ƒå°±å¼€å§‹å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œä¸»èŠ‚ç‚¹ä¼šå…ˆå°†æ•°æ®åŠ å…¥è‡ªå·±çš„æ—¥å¿—ä¸­ï¼Œç„¶åå¹¶è¡Œçš„å‘å…¶ä»–FollowerèŠ‚ç‚¹å‘é€æ¶ˆæ¯ï¼Œå¦‚æœæœ‰å¤§å¤šæ•°èŠ‚ç‚¹æˆåŠŸçš„å†™å…¥äº†è¿™æ¡æ—¥å¿—ï¼Œé‚£ä¹ˆLeaderèŠ‚ç‚¹çš„è¿™æ¡æ—¥å¿—çŠ¶æ€å°±ä¼šæ›´æ–°ä¸ºcommittedçŠ¶æ€ï¼Œæäº¤è¯¥æ¡ç›®ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†ä¹‹å‰ä»»æœŸçš„æ¡ç›®ï¼Œå¹¶ä¸”é€šè¿‡å¿ƒè·³åŒ…å‘ŠçŸ¥å…¶ä»–èŠ‚ç‚¹åŒæ­¥ä¸»èŠ‚ç‚¹çš„æ—¥å¿—\n## å®‰å…¨æ€§\n1. é€‰ä¸»çš„é™åˆ¶ï¼Œåªæœ‰åŒ…å«äº†æ‰€æœ‰æäº¤æ—¥å¿—çš„èŠ‚ç‚¹æ‰æœ‰æœºä¼šæˆä¸ºä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨é€‰ä¸¾çš„æ—¶å€™ï¼Œå¦‚æœå‘èµ·æŠ•ç¥¨èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªlogçš„ä»»æœŸæ¯”è‡ªå·±å°ï¼Œé‚£ä¹ˆå°±æ‹’ç»ä¸ºè¯¥èŠ‚ç‚¹æŠ•ç¥¨ï¼Œè¿™æ ·é€‰å‡ºçš„èŠ‚ç‚¹çš„logè‡³å°‘æ¯”åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹è¦æ–°\n2. Raft åªå¯¹è‡ªå·±ä»»æœŸå†…çš„æ—¥å¿—è®¡æ•°å¹¶åœ¨å¤åˆ¶åˆ°å¤šæ•°èŠ‚ç‚¹æ—¶è¿›è¡Œæäº¤ï¼Œä¸”åœ¨æäº¤è¿™æ¡æ—¥å¿—çš„åŒæ—¶æäº¤ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—\n### éå¯¹ç§°ç½‘ç»œåˆ†åŒº\nå¦‚æœä¸åšç‰¹æ®Šå¤„ç†ï¼Œä¼šåå¤å‡ºç°æ–°çš„é€‰ä¸¾ï¼Œæ‰“æ–­æ­£å¸¸çš„ IOï¼Œé€ æˆï¼Œå¯ç”¨æ€§é™ä½çš„é—®é¢˜ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ pre-vote è§£å†³ï¼Œä¾‹å¦‚ï¼Œæ¯æ¬¡å‘èµ·é€‰ä¸¾ä¹‹å‰ï¼Œå…ˆå‘èµ· pre-vote å¦‚æœè·å¾—å¤§å¤šæ•° pre-vote é€‰ç¥¨ï¼Œå†å¢å¤§ term å‘èµ·é€‰ä¸¾ vote æŠ•ç¥¨ã€‚ä¸ºäº†é¿å…é—®é¢˜æè¿°çš„æƒ…å†µï¼Œå…¶ä»–èŠ‚ç‚¹åªéœ€è¦åœ¨æ”¶åˆ° pre-vote è¯·æ±‚æ—¶ï¼Œåˆ¤æ–­ä¸€ä¸‹ leader æ˜¯å¦è¿˜åœ¨ï¼Œä¸€èˆ¬å®ç°ä¸Šï¼Œåˆ¤æ–­æœ€è¿‘å’Œ leader æ˜¯å¦æ­£å¸¸é€šä¿¡ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆè¯´æ˜ leader æ­£å¸¸åœ¨çº¿ï¼Œç›´æ¥æ‹’ç» pre-vote å³å¯ã€‚\n# ç½‘ç»œå®‰å…¨\n## SQLæ³¨å…¥\nå¯¹ç”¨æˆ·çš„è¾“å…¥æ§åˆ¶ä¸ä¸¥ï¼Œå¯¼è‡´é»‘å®¢å¯ä»¥é€šè¿‡æ‹¼æ¥SQLçš„æ–¹å¼è¿›è¡Œæ”»å‡»\n\n```sql\n\"SELECT * FROM user WHERE username = \" + uname + \"ADN password = \" + pwd\n```\n\nç±»ä¼¼è¿™ç§å¦‚æœæˆ‘ä¼ å…¥username = \" **resolmi'#** \"ï¼Œè¿™æ ·SQLè¯­å¥å°±å˜æˆäº†\n\n```sql\nSELECT * FROM user WHERE username = 'resolmi' #ADN password = ''\n```\n#åæŠŠåé¢çš„passwordæ³¨é‡Šæ‰ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ç”¨å¯†ç ç›´æ¥è·å–åˆ°resolmiçš„ä¿¡æ¯\n\nè§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸¥æ ¼è¿‡æ»¤ç”¨æˆ·è¾“å…¥ï¼Œä½†æ˜¯è¿™æ ·ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œç›®å‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡DBçš„é¢„ç¼–è¯‘åŠŸèƒ½ï¼Œé€šè¿‡å ä½ç¬¦å ä½ï¼ŒMySQLç¼–è¯‘çš„æ—¶å€™å°±ä¼šå°†å‚æ•°è½¬ä¹‰åå¡«å……åˆ°å ä½ç¬¦ä¸­\n> MyBatisä¸­ # å’Œ $ åŒºåˆ«ï¼š#{}æ˜¯é¢„ç¼–è¯‘çš„æ–¹å¼ï¼Œèƒ½é˜²æ­¢SQLæ³¨å…¥ï¼Œ${}æ˜¯å­—ç¬¦æ‹¼æ¥çš„æ–¹å¼ï¼Œä¼šæœ‰SQLæ³¨å…¥çš„é—®é¢˜\n## CSRF\nCross-site request forgeryï¼Œä¸­æ–‡åï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ \n\nCSRFæ”»å‡»è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶\n1. ç™»å½•äº†å—ä¿¡ä»»çš„ç½‘ç«™Aï¼Œæ¯”å¦‚tb\n2. åœ¨ä¸ç™»å‡ºtbçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™B\n\nç”±äº**åŒæºç­–ç•¥**å®é™…ä¸Šæ˜¯é™åˆ¶ä¸€ä¸ªåŸŸåçš„jsï¼Œåœ¨æœªç»å…è®¸çš„æƒ…å†µä¸‹ä¸èƒ½è¯»å–å¦ä¸€ä¸ªåŸŸåçš„å†…å®¹ï¼Œæ‰€ä»¥ajaxæäº¤æ˜¯ä¸èƒ½è·¨åŸŸçš„ï¼Œå› ä¸ºajaxæ˜¯å¯ä»¥è¯»å–å“åº”çš„ï¼Œè€ŒFormè¡¨å•æäº¤åˆ™æ²¡æœ‰è·¨åŸŸçš„é—®é¢˜ï¼Œå› ä¸ºFormæäº¤åï¼ŒåŸé¡µé¢æ˜¯æ— æ³•è·å–æ–°é¡µé¢çš„å†…å®¹çš„ï¼ŒåŒç†GETè¯·æ±‚ä¹Ÿæ˜¯å…è®¸è·¨åŸŸçš„\n> åŒæºï¼šipï¼Œåè®®ï¼Œç«¯å£ä¸€è‡´\n> \n> Ajaxè·¨åŸŸè¯·æ±‚å®é™…ä¸ŠæœåŠ¡ç«¯æ˜¯ä¼šæ”¶åˆ°è¯·æ±‚çš„ï¼Œä½†æ˜¯æµè§ˆå™¨å¦‚æœæ¥æ”¶åˆ°æœåŠ¡ç«¯çš„è¿”å›å€¼æ²¡æœ‰`Access-Control-Allow-origin`è¯´æ˜ä¸å…è®¸è·¨åŸŸå°±ä¸ä¼šå¤„ç†è¿™æ¡è¿”å›ä¿¡æ¯\n\næ‰€ä»¥å½“è®¿é—®æ¶æ„ç½‘ç«™çš„æ—¶å€™ï¼Œæ¶æ„ç½‘ç«™ä¼šå‘å®‰å…¨ç½‘ç«™tbå‘èµ·ä¸€ä¸ªæ¶æ„çš„get/postè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚å°±ä¼šæºå¸¦tbçš„cookieå»æ‰§è¡Œè¯¥æ“ä½œï¼Œè¿›è€Œè¾¾æˆè·¨ç«™è¯·æ±‚æ”»å‡»\n\n**è§£å†³æ–¹æ¡ˆ**\n\n1. Http refererï¼šæ ¹æ®è¯·æ±‚çš„æ¥æºåˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œä½†æ˜¯è¿™ä¸ªRefereræ˜¯æµè§ˆå™¨æä¾›çš„ï¼Œæ˜¯å¯ä»¥ä¿®æ”¹çš„\n2. csrftokenï¼š\n   å¯¹äºGET/POSTè¯·æ±‚å¯ä»¥åœ¨cookieä¸­åŠ ä¸€ä¸ªcsrftokenå­—æ®µï¼Œå½“å‘èµ·è¯·æ±‚çš„æ—¶å€™å°†csrftokenåŠ å…¥urlæˆ–è€…bodyä¸­ï¼Œå› ä¸ºåŒæºç­–ç•¥ï¼Œå±é™©Bç½‘ç«™æ˜¯æ— æ³•è®¿é—®tbçš„cookieçš„ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ³•ä¼ªé€ csrftokenï¼ŒæœåŠ¡ç«¯æ¥æ”¶åéªŒè¯ä¸‹cookieå’Œurlä¸­çš„æ˜¯å¦ä¸€è‡´å°±okäº†ã€‚\n\n    ä½†æ˜¯å¦‚æœè¯¥ç«™ç‚¹å­˜åœ¨XSSï¼Œé»‘å®¢å¯ä»¥é€šè¿‡XSSæ³¨å…¥cookieï¼Œé‚£ä¹ˆå°±å¤±æ•ˆäº†ã€‚æ‰€ä»¥æ¯”è¾ƒä¿é™©çš„æ–¹å¼æ˜¯ä½¿ç”¨sessionï¼Œåœ¨ç”¨æˆ·è®¿é—®é¡µé¢çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªTokenï¼Œå­˜æ”¾åˆ°æœåŠ¡ç«¯sessionä¸­ï¼Œå½“å‘èµ·è¯·æ±‚çš„æ—¶å€™å°†tokenåŠ åˆ°urlæˆ–è€…bodyä¸­ï¼ˆæ³¨æ„ä¸èƒ½æ”¾åˆ°cookieä¸­ï¼‰ï¼Œè¿™æ ·é»‘å®¢å°±æ— æ³•ä¼ªé€ tokenäº†\n3. éªŒè¯ç ï¼šæ‰§è¡Œå…³é”®æ“ä½œæ—¶å€™éœ€è¦è¾“å…¥éªŒè¯ç ï¼Œè¿™æ ·é»‘å®¢åŒæ ·æ— æ³•ä¼ªé€ \n## XSS\nCross Site Scriptingï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯å¯¹ç”¨æˆ·çš„è¾“å…¥è¿‡æ»¤ä¸ä¸¥æ ¼ï¼Œå¯¼è‡´é»‘å®¢å¯ä»¥å‘ç½‘é¡µæ’å…¥æ¶æ„çš„jsè„šæœ¬ï¼Œå½“å…¶ä»–ç”¨æˆ·è®¿é—®åˆ°è¯¥é¡µé¢è„šæœ¬å°±ä¼šæ‰§è¡Œï¼Œçªƒå–ç”¨æˆ·ä¿¡æ¯ï¼Œç¬”è€…ä¹‹å‰å¹´è½»ä¸æ‡‚äº‹çš„æ—¶å€™è¿˜æ›¾ç»æŒ–è¿‡å‡ ä¸ªå°ç½‘ç«™çš„xssæ¼æ´ï¼ˆéƒ½åé¦ˆç»™ç›¸å…³äººå‘˜äº†ï¼Œä¸è¿‡æœ‰çš„ä¹Ÿæ²¡ç†æˆ‘å°±æ˜¯äº†ğŸ˜‚ï¼‰\n\n**è§£å†³æ–¹æ¡ˆ**\n1. è¾“å…¥è¿‡æ»¤ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è§£å†³ï¼Œè¿™ç§æ–¹æ¡ˆæ•´ä½“è¿˜æ˜¯ä¸å¤ªå¯è¡Œï¼Œç¬”è€…ä¹‹å‰æŒ–è¿‡çš„ä¸€ä¸ªç½‘ç«™å°±æ˜¯ä½¿ç”¨è¾“å…¥è¿‡æ»¤ï¼Œä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯è¢«æˆ‘ç»•è¿‡äº†\n2. å¯¹HTMLè¿›è¡Œè½¬ä¹‰ï¼Œå¾ˆå¤šæ¨¡æ¿å¼•æ“éƒ½è‡ªå¸¦è½¬ä¹‰åŠŸèƒ½\n3. Http-only Cookieï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰é˜»æ­¢XSSï¼Œåªæ˜¯é˜²æ­¢çªƒå–cookie\n\n## HTTPè¯·æ±‚ç¯¡æ”¹\n1. é‡‡ç”¨HTTPS\n2. è¯·æ±‚å‚æ•°ç­¾å\n3. å®¢æˆ·ç«¯IPé»‘/ç™½åå•\n# å¥—è·¯CODE\n## ç”Ÿäº§è€…æ¶ˆè´¹è€…\n```java\nimport java.util.*;\nimport java.util.stream.*;\n\npublic class ProducerConsumer1{\n    /*\n    å¤šç”Ÿäº§è€…æ¶ˆè´¹è€…\n    signal/awaitæ¨¡å‹\n    */\n\n    //ç¼“å­˜åŒº\n    private static List<Integer> buffer=new ArrayList<>();\n\n    //ç¼“å†²åŒºçš„æœ€å¤§å€¼\n    private static int MAX=3;\n\n    //å½“å‰çš„ç¼“å†²åŒºå¤§å°,éœ€è¦åŠ volatileä¿è¯å¯è§æ€§\n    private static volatile int size=0;\n\n    //é”\n    private static final Object LOCK = new Object();\n\n    //æ¨¡æ‹Ÿproduceæ•°æ®\n    private static int data=0;\n\n    public static void main(String[] args) {\n        Stream.of(\"Produce1\",\"Produce2\",\"Produce3\",\"Produce4\",\"Produce5\").forEach(name->{\n            new Thread(()->{\n                try{\n                    produce();\n                }catch(Exception e){\n                    e.printStackTrace();\n                }\n            },name).start();\n        });\n        Stream.of(\"Consumer1\",\"Consumer2\",\"Consumer3\",\"Consumer4\",\"Consumer5\").forEach(name->{\n            new Thread(()->{\n                try{\n                    consumer();\n                }catch(Exception e){\n                    e.printStackTrace();\n                }\n            },name).start();\n        });\n    }\n\n    public static void produce()throws InterruptedException{\n        while(true){\n            synchronized(LOCK){\n                while(size>=MAX){\n                    LOCK.wait();\n                }\n                buffer.add(++data);\n                size++;//è¿™é‡Œä¸ç”¨åŠ é”,å•çº¿ç¨‹\n                System.out.println(Thread.currentThread().getName()+\" produce \"+ data);\n                Thread.sleep(1000);\n                LOCK.notifyAll();\n            }\n        }\n    }\n\n    public static void consumer () throws InterruptedException{\n        while(true){\n            synchronized(LOCK){\n                while(size==0){\n                    LOCK.wait();\n                }\n                int temp=buffer.remove(0);\n                size--;\n                System.out.println(Thread.currentThread().getName()+\" consumer \"+ temp);\n                Thread.sleep(1000);\n                LOCK.notifyAll();\n            }\n        }\n    }\n}\n```\n## æ­»é”\n```java\npublic class DeadLock{\n\n    private static Object resourceA = new Object();\n\n    private static Object resourceB = new Object();\n\n    public static void main(String[] args) {\n        Thread A=new Thread(()->{\n            synchronized(resourceA){\n                System.out.println(\"Thread A acquire resourceA\");\n                try{\n                    TimeUnit.SECONDS.sleep(2);\n                }catch(InterruptedException e){}\n                synchronized(resourceB){\n                    System.out.println(\"Thread A acquire resourceB\");\n                    System.out.println(\"A do some thing\");\n                }\n            }\n        });\n        \n        Thread B=new Thread(()->{\n            synchronized(resourceB){\n                System.out.println(\"Thread B acquire resourceB\");\n                try{\n                    TimeUnit.SECONDS.sleep(2);\n                }catch(InterruptedException e){}\n                synchronized(resourceA){\n                    System.out.println(\"Thread B acquire resourceA\");\n                    System.out.println(\"B do some thing\");\n                }\n            }\n        });\n        A.start();\n        B.start();\n    }\n}\n```\n## å•ä¾‹\n### DCL\n```java\npublic class SingleTonDCL{\n    \n    private static volatile SingleTonDCL instance=null;\n\n    //ç§æœ‰åŒ–æ„é€ å™¨\n    private SingleTonDCL(){\n        if (instance !=null){\n            throw new RuntimeException(\"å®ä¾‹å·²ç»å­˜åœ¨ï¼Œè¯·é€šè¿‡ getInstance()æ–¹æ³•è·å–\");\n        }\n    }\n    \n    //æ‡’æ±‰å¼\n    public static SingleTonDCL getInstance(){\n        if(instance==null){\n            synchronized(SingleTonDCL.class){\n                if(instance==null){\n                    //è¿™é‡Œä¼šæœ‰é‡æ’åºçš„é—®é¢˜,instanceè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆå°±è¿”å›äº†\n                    //æ‰€ä»¥éœ€è¦åŠ volatile\n                    instance=new SingleTonDCL(); \n                }\n            }\n        }\n        return instance;\n    }\n}\n```\n### æšä¸¾\n```java\n//1ã€é™¤æšä¸¾æ–¹å¼å¤–, å…¶ä»–æ–¹æ³•éƒ½ä¼šé€šè¿‡åå°„æˆ–è€…åºåˆ—åŒ–çš„æ–¹å¼ç ´åå•ä¾‹\npublic enum SingleTonEnum{\n    INSTANCE;\n}\n```\n### é¥¿æ±‰\n```java\npublic class SingleTonHungry{\n    /*\n    çº¿ç¨‹å®‰å…¨,ä½†æ˜¯æ¶ˆè€—æ¯”è¾ƒå¤§,åœ¨ç±»ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™å°±ä¼šåˆå§‹åŒ–\n    ä½†æ˜¯ä¹Ÿä¸ä¸€å®šé©¬ä¸Šä¼šç”¨,ä¸€èˆ¬æˆ‘ä»¬å¸Œæœ›ç”¨çš„æ—¶å€™å†åˆ›å»º\n     */\n    private static final SingleTonHungry instance=new SingleTonHungry();\n\n    //ç§æœ‰åŒ–æ„é€ å™¨\n    private SingleTonHungry(){\n        if (instance !=null){\n            throw new RuntimeException(\"å®ä¾‹å·²ç»å­˜åœ¨ï¼Œè¯·é€šè¿‡ getInstance()æ–¹æ³•è·å–\");\n        }\n    }\n\n    public static SingleTonHungry getInstance(){\n        return instance;\n    }\n}\n```\n### å†…éƒ¨ç±»\n```java\npublic class SingleTonInnerClass{\n\n    //ç§æœ‰åŒ–æ„é€ å™¨\n    private SingleTonInnerClass(){}\n\n    private static class SingleTonHolder{\n        static{\n            //å½“getInctanceé™æ€æ–¹æ³• è®¿é—®SingleTonHolderçš„é™æ€å˜é‡\n            //çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–å†…éƒ¨ç±»,æ‰€ä»¥ä¹Ÿæ˜¯å±äºæ‡’æ±‰å¼,å¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„\n            System.out.println(\"Inner class\");\n        }\n        private static SingleTonInnerClass instance=new SingleTonInnerClass();\n    }\n\n    static{\n        //å…ˆåˆå§‹åŒ–å¤–éƒ¨ç±»\n        System.out.println(\"SingleTon Outer class\");\n    }\n\n    public static SingleTonInnerClass getInstance(){\n        return SingleTonHolder.instance;\n    }\n}\n```\n## LRU\n\n```java\nclass LRUCache {\n    \n    HashMap<Integer, Node> map = null;\n        \n    int capacity = 0;\n    \n    Node head = null;\n    \n    Node tail = null;\n    \n    public LRUCache(int capacity) {\n        this.capacity = capacity;\n        map = new HashMap<>();\n        head = new Node(-1, -1);\n        tail = new Node(-1, -1);\n        head.next = tail;\n        tail.prev = head;\n    }\n    \n    public int get(int key) {\n        Node node = map.get(key);\n        if (node == null) {\n            return -1;\n        }\n        removeNode(node);\n        insert2head(node);\n        return node.val;\n    }\n    \n    public void put(int key, int value) {\n        Node node = map.get(key);\n        if (node == null) {\n            node = new Node(key, value);\n            insert2head(node);\n            map.put(key, node);\n        } else {\n            removeNode(node);\n            node.val = value;\n            insert2head(node);\n        }\n        if (map.size() > capacity) {\n            map.remove(tail.prev.key);\n            removeNode(tail.prev);\n        }\n    }\n    \n    public void insert2head(Node node) {\n        node.next = head.next;\n        node.prev = head;\n        head.next.prev = node;\n        head.next = node;\n    }\n    \n    //ç§»é™¤NodeèŠ‚ç‚¹\n    public void removeNode(Node node) {\n        node.prev.next = node.next;\n        node.next.prev = node.prev;\n        node.next = null;\n        node.prev = null;\n    }\n    \n    class Node {\n        Node prev, next;\n        int key, val;\n        public Node (int key, int val) {\n            this.key = key;\n            this.val = val;\n        }\n    }\n}\n\n/**\n * Your LRUCache object will be instantiated and called as such:\n * LRUCache obj = new LRUCache(capacity);\n * int param_1 = obj.get(key);\n * obj.put(key,value);\n */\n```\n# P & NP\n1. Pï¼ˆpolynominalï¼‰é—®é¢˜ï¼šæœ‰å¤šé¡¹å¼æ—¶é—´ç®—æ³•ï¼Œç®—å¾—å¾ˆå¿«çš„é—®é¢˜ã€‚\n2. NPï¼ˆNondeterministic polynominalï¼‰é—®é¢˜ï¼šç®—èµ·æ¥ä¸ç¡®å®šå¿«ä¸å¿«çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ **å¿«é€ŸéªŒè¯** è¿™ä¸ªé—®é¢˜çš„è§£ã€‚\n3. NP-hardé—®é¢˜ï¼šæ¯”NPé—®é¢˜éƒ½è¦éš¾çš„é—®é¢˜ã€‚\n4. NP-completeé—®é¢˜ï¼šå±äºNPé—®é¢˜ï¼Œä¸”å±äºNP-hardé—®é¢˜ã€‚\n5. NPCç±»é—®é¢˜ï¼šé¦–å…ˆï¼Œå®ƒå¾—æ˜¯ä¸€ä¸ªNPé—®é¢˜ï¼›ç„¶åï¼Œæ‰€æœ‰çš„NPé—®é¢˜éƒ½å¯ä»¥çº¦åŒ–åˆ°å®ƒã€‚\n6. NPéš¾é—®é¢˜ï¼šå³æ‰€æœ‰çš„NPé—®é¢˜éƒ½èƒ½çº¦åŒ–åˆ°å®ƒï¼Œä½†æ˜¯å®ƒä¸ä¸€å®šæ˜¯ä¸€ä¸ªNPé—®é¢˜ã€‚NP-Hardé—®é¢˜è¦æ¯” NPCé—®é¢˜çš„èŒƒå›´å¹¿ï¼ŒNP-Hardé—®é¢˜æ²¡æœ‰é™å®šå±äºNP","tags":["é¢è¯•"],"categories":["è¸©å‘è®°å½•"]},{"title":"LeetCodeå•è°ƒæ ˆ","url":"/2020/08/28/leetcode-dan-diao-zhan/","content":"\n> ä»[æ ˆ&é˜Ÿåˆ—ä¸“é¢˜](http://imlgw.top/2019/10/01/leetcode-zhan-dui-lie/)ä¸­æŠ½å–å‡ºæ¥\n## [496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I](https://leetcode-cn.com/problems/next-greater-element-i/)\n\nç»™å®šä¸¤ä¸ª**æ²¡æœ‰é‡å¤å…ƒç´ **çš„æ•°ç»„ nums1 å’Œ nums2 ï¼Œå…¶ä¸­nums1 æ˜¯ nums2 çš„å­é›†ã€‚æ‰¾åˆ° nums1 ä¸­æ¯ä¸ªå…ƒç´ åœ¨ nums2 ä¸­çš„ä¸‹ä¸€ä¸ªæ¯”å…¶å¤§çš„å€¼ã€‚\n\nnums1 ä¸­æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯æŒ‡ x åœ¨ nums2 ä¸­å¯¹åº”ä½ç½®çš„å³è¾¹çš„ç¬¬ä¸€ä¸ªæ¯” x å¤§çš„å…ƒç´ ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå¯¹åº”ä½ç½®è¾“å‡º-1ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums1 = [4,1,2], nums2 = [1,3,4,2].\nè¾“å‡º: [-1,3,-1]\nè§£é‡Š:\n    å¯¹äºnum1ä¸­çš„æ•°å­—4ï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒä¸ªæ•°ç»„ä¸­æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -1ã€‚\n    å¯¹äºnum1ä¸­çš„æ•°å­—1ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ•°å­—1å³è¾¹çš„ä¸‹ä¸€ä¸ªè¾ƒå¤§æ•°å­—æ˜¯ 3ã€‚\n    å¯¹äºnum1ä¸­çš„æ•°å­—2ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -1ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums1 = [2,4], nums2 = [1,2,3,4].\nè¾“å‡º: [3,-1]\nè§£é‡Š:\n    å¯¹äºnum1ä¸­çš„æ•°å­—2ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªè¾ƒå¤§æ•°å­—æ˜¯3ã€‚\n    å¯¹äºnum1ä¸­çš„æ•°å­—4ï¼Œç¬¬äºŒä¸ªæ•°ç»„ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°å­—ï¼Œå› æ­¤è¾“å‡º -1ã€‚\n```\n\n**æ³¨æ„:**\n\n1. `nums1`å’Œ`nums2`ä¸­æ‰€æœ‰å…ƒç´ æ˜¯å”¯ä¸€çš„ã€‚\n2. `nums1`å’Œ`nums2` çš„æ•°ç»„å¤§å°éƒ½ä¸è¶…è¿‡1000ã€‚\n\n**è§£æ³•ä¸€**\n\nå•è°ƒæ ˆï¼Œå¾ˆå°±ä¹‹å‰åœ¨é“¾è¡¨ä¸“é¢˜ä¸­åšè¿‡ä¸€æ¬¡ [é“¾è¡¨çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹](http://imlgw.top/2019/02/27/leetcode-lian-biao/#1019-%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A4%A7%E8%8A%82%E7%82%B9) ä½†æ˜¯æ²¡æƒ³èµ·æ¥ï¼Œå¯èƒ½å½“æ—¶ä¹Ÿæ²¡ç•™ä¸‹å½±å“\n\nè¿™é¢˜å…¶å®è¿˜æ¯”åŸå§‹çš„é¢˜åŠ äº†ä¸€ç‚¹éš¾åº¦ï¼ŒåŸå§‹çš„é¢˜å°±æ˜¯ num1==nums2çš„æƒ…å†µï¼Œé‚£æ ·å°±ä¸éœ€è¦HashMapè®°å½•äº†\n\n```java\npublic int[] nextGreaterElement(int[] nums1, int[] nums2) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    Stack<Integer> stack=new Stack<>();\n    for (int i=0;i<nums2.length;i++) {\n        while(!stack.isEmpty() && nums2[stack.peek()]<nums2[i]){\n            map.put(nums2[stack.pop()],nums2[i]);\n        }\n        stack.add(i);\n    }\n    int[] res=new int[nums1.length];\n    for (int i=0;i<nums1.length;i++) {\n        res[i]=map.getOrDefault(nums1[i],-1);\n    }\n    return res;\n}\n```\n## [503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II](https://leetcode-cn.com/problems/next-greater-element-ii/)\n\nç»™å®šä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¾“å‡ºæ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€‚æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ æ˜¯æŒ‰æ•°ç»„éå†é¡ºåºï¼Œè¿™ä¸ªæ•°å­—ä¹‹åçš„ç¬¬ä¸€ä¸ªæ¯”å®ƒæ›´å¤§çš„æ•°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥å¾ªç¯åœ°æœç´¢å®ƒçš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º -1ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,1]\nè¾“å‡º: [2,-1,2]\nè§£é‡Š: ç¬¬ä¸€ä¸ª 1 çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°æ˜¯ 2ï¼›\næ•°å­— 2 æ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ï¼› \nç¬¬äºŒä¸ª 1 çš„ä¸‹ä¸€ä¸ªæœ€å¤§çš„æ•°éœ€è¦å¾ªç¯æœç´¢ï¼Œç»“æœä¹Ÿæ˜¯ 2ã€‚\n```\n\n**æ³¨æ„:** è¾“å…¥æ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 10000ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic static int[] nextGreaterElements(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return new int[]{};\n    }\n    Stack<Integer> stack=new Stack<>();\n    stack.push(0);\n    int[] res=new int[nums.length];\n    Arrays.fill(res,-1);\n    int index=1;\n    for (int i=1;i<nums.length*2;i++) {\n        index=i>=nums.length?i%nums.length:i;\n        while(!stack.isEmpty()&&nums[stack.peek()]<nums[index]) {\n            res[stack.pop()]=nums[index];\n        }\n        stack.push(index);\n    }\n    return res;\n}\n```\nå’Œä¸Šé¢ä¸€æ ·ï¼Œåªä¸è¿‡éœ€è¦å¾ªç¯éå†ä¸€éï¼Œæˆ‘æœ€å¼€å§‹çš„åšæ³•ç›¸å½“æ†¨æ†¨ï¼Œcopyäº†ä¸€ä¸ªä¸¤å€çš„æ•°ç»„ã€‚ã€‚ã€‚è¿˜éœ€è¦æ³¨æ„çš„å°±æ˜¯ `-1`çš„å¤„ç†\n\n## [739. æ¯æ—¥æ¸©åº¦](https://leetcode-cn.com/problems/daily-temperatures/)\n\næ ¹æ®æ¯æ—¥ æ°”æ¸© åˆ—è¡¨ï¼Œè¯·é‡æ–°ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ï¼Œå¯¹åº”ä½ç½®çš„è¾“å…¥æ˜¯ä½ éœ€è¦å†ç­‰å¾…å¤šä¹…æ¸©åº¦æ‰ä¼šå‡é«˜è¶…è¿‡è¯¥æ—¥çš„å¤©æ•°ã€‚å¦‚æœä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿ã€‚\n\nä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåˆ—è¡¨ temperatures = [73, 74, 75, 71, 69, 72, 76, 73]ï¼Œä½ çš„è¾“å‡ºåº”è¯¥æ˜¯ [1, 1, 4, 2, 1, 1, 0, 0]ã€‚\n\næç¤ºï¼šæ°”æ¸© åˆ—è¡¨é•¿åº¦çš„èŒƒå›´æ˜¯ [1, 30000]ã€‚æ¯ä¸ªæ°”æ¸©çš„å€¼çš„å‡ä¸ºåæ°åº¦ï¼Œéƒ½æ˜¯åœ¨ [30, 100] èŒƒå›´å†…çš„æ•´æ•°ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic int[] dailyTemperatures(int[] T) {\n    int[] res=new int[T.length];\n    if(T==null || T.length<=0) return res;\n    Stack<Integer> stack=new Stack<>();\n    stack.push(0);\n    for (int i=1;i<T.length;i++) {\n        while(!stack.isEmpty()&&T[stack.peek()]<T[i]){\n            int temp=stack.pop();\n            res[temp]=i-temp;\n        }\n        stack.push(i);\n    }\n    return res;\n}\n```\nå’Œä¸Šé¢ä¸¤é¢˜ä¸€æ ·ï¼Œå•è°ƒæ ˆçš„è§£æ³•ï¼Œä¸è¿‡è¿™é¢˜å¥½åƒå¯ä»¥ä¸ç”¨å•è°ƒæ ˆï¼Œå¯ä»¥ä»åå‘å‰é€’æ¨\n\n## [901. è‚¡ç¥¨ä»·æ ¼è·¨åº¦](https://leetcode-cn.com/problems/online-stock-span/)\n\nç¼–å†™ä¸€ä¸ª StockSpanner ç±»ï¼Œå®ƒæ”¶é›†æŸäº›è‚¡ç¥¨çš„æ¯æ—¥æŠ¥ä»·ï¼Œå¹¶è¿”å›è¯¥è‚¡ç¥¨å½“æ—¥ä»·æ ¼çš„è·¨åº¦ã€‚\n\nä»Šå¤©è‚¡ç¥¨ä»·æ ¼çš„è·¨åº¦è¢«å®šä¹‰ä¸ºè‚¡ç¥¨ä»·æ ¼å°äºæˆ–ç­‰äºä»Šå¤©ä»·æ ¼çš„æœ€å¤§è¿ç»­æ—¥æ•°ï¼ˆä»ä»Šå¤©å¼€å§‹å¾€å›æ•°ï¼ŒåŒ…æ‹¬ä»Šå¤©ï¼‰ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœæœªæ¥7å¤©è‚¡ç¥¨çš„ä»·æ ¼æ˜¯ [100, 80, 60, 70, 60, 75, 85]ï¼Œé‚£ä¹ˆè‚¡ç¥¨è·¨åº¦å°†æ˜¯ [1, 1, 1, 2, 1, 4, 6]ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š[\"StockSpanner\",\"next\",\"next\",\"next\",\"next\",\"next\",\"next\",\"next\"], [[],[100],[80],[60],[70],[60],[75],[85]]\nè¾“å‡ºï¼š[null,1,1,1,2,1,4,6]\nè§£é‡Šï¼š\né¦–å…ˆï¼Œåˆå§‹åŒ– S = StockSpanner()ï¼Œç„¶åï¼š\nS.next(100) è¢«è°ƒç”¨å¹¶è¿”å› 1ï¼Œ\nS.next(80) è¢«è°ƒç”¨å¹¶è¿”å› 1ï¼Œ\nS.next(60) è¢«è°ƒç”¨å¹¶è¿”å› 1ï¼Œ\nS.next(70) è¢«è°ƒç”¨å¹¶è¿”å› 2ï¼Œ\nS.next(60) è¢«è°ƒç”¨å¹¶è¿”å› 1ï¼Œ\nS.next(75) è¢«è°ƒç”¨å¹¶è¿”å› 4ï¼Œ\nS.next(85) è¢«è°ƒç”¨å¹¶è¿”å› 6ã€‚\n\næ³¨æ„ (ä¾‹å¦‚) S.next(75) è¿”å› 4ï¼Œå› ä¸ºæˆªè‡³ä»Šå¤©çš„æœ€å 4 ä¸ªä»·æ ¼\n(åŒ…æ‹¬ä»Šå¤©çš„ä»·æ ¼ 75) å°äºæˆ–ç­‰äºä»Šå¤©çš„ä»·æ ¼ã€‚\n```\n\n**æç¤ºï¼š**\n\n- è°ƒç”¨ StockSpanner.next(int price) æ—¶ï¼Œå°†æœ‰ 1 <= price <= 10^5\n- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æœ€å¤šå¯ä»¥è°ƒç”¨  10000 æ¬¡ StockSpanner.next\n- åœ¨æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæœ€å¤šè°ƒç”¨ 150000 æ¬¡ StockSpanner.next\n- æ­¤é—®é¢˜çš„æ€»æ—¶é—´é™åˆ¶å‡å°‘äº† 50%\n\n**è§£æ³•ä¸€**\n\næˆ‘èµ·äº†ï¼Œä¸€æªç§’äº†ï¼Œæœ‰ä»€ä¹ˆå¥½è¯´çš„\n\n```java\nclass StockSpanner {\n\n    Deque<int[]> stack=new ArrayDeque<>();\n\n    public StockSpanner() {}\n    \n    public int next(int price) {\n        int res=1;\n        while(!stack.isEmpty() && price>=stack.peek()[0]){\n            res+=stack.pop()[1];\n        }\n        stack.push(new int[]{price,res});\n        return res;\n    }\n}\n```\n\n## [84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/)\n\nç»™å®š *n* ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1 ã€‚\n\næ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚\n\n![leetCode](https://i.loli.net/2019/12/12/a7pVfNcYuIKFgwA.png)\n\nä»¥ä¸Šæ˜¯æŸ±çŠ¶å›¾çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªæŸ±å­çš„å®½åº¦ä¸º 1ï¼Œç»™å®šçš„é«˜åº¦ä¸º `[2,1,5,6,2,3]`ã€‚\n\n![leetCode](https://i.loli.net/2019/12/12/FAvMk3zWf4RheDi.png)\n\nå›¾ä¸­é˜´å½±éƒ¨åˆ†ä¸ºæ‰€èƒ½å‹¾å‹’å‡ºçš„æœ€å¤§çŸ©å½¢é¢ç§¯ï¼Œå…¶é¢ç§¯ä¸º `10` ä¸ªå•ä½ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [2,1,5,6,2,3]\nè¾“å‡º: 10\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢å‡ é“é¢˜ä¸€æ ·ï¼Œå•è°ƒæ ˆçš„è§£æ³•ï¼Œè¿™é‡Œæ˜¯å•è°ƒé€’å¢æ ˆï¼Œ20msï¼Œ87%\n\n```java\npublic int largestRectangleArea(int[] heights) {\n    if (heights==null || heights.length<=0) {\n        return 0;\n    }\n    Stack<Integer> stack=new Stack<>();\n    int maxArea= Integer.MIN_VALUE;\n    for (int i=0;i<heights.length;i++) {\n        while(!stack.isEmpty() && heights[i]<=heights[stack.peek()]){\n            //å½“å‰çš„æŸ±å­å°äºæ ˆé¡¶,è¯´æ˜å½“å‰æ ˆé¡¶æœ€å¤šå‘å³æ‰©å±•åˆ° i-1\n            int cur=stack.pop();\n            //ä¸ºç©ºè¯´æ˜å‘å·¦æ— æ³•æ‰©å±•,æ ‡ä¸º-1ä¸å½±å“ç»“æœï¼ˆå¯ä»¥æå‰å°†-1å‹æ ˆï¼‰\n            int left=stack.isEmpty()?-1:stack.peek();\n            //è¿™é‡Œå…¶å®æ˜¯ (i-1)-(left+1)+1\n            maxArea=Math.max(maxArea,(i-left-1)*heights[cur]);\n        }\n        stack.push(i);\n    }\n    //å¤„ç†æ ˆä¸­å‰©ä¸‹çš„å…ƒç´ ,å³è¾¹æ˜¯è¾¹ç•Œï¼Œå‰©ä½™æ ˆä¸­æ‰€æœ‰çš„å…ƒç´ å®é™…ä¸Šéƒ½å¯ä»¥æ‰©å±•åˆ° heights.length-1\n    //æ‰€ä»¥ä¸ºäº†è®©æ‰€æœ‰çš„å…ƒç´ éƒ½èƒ½å‡ºæ ˆ,æˆ‘ä»¬å¯ä»¥å†æ•°ç»„çš„åé¢æƒ³è±¡æ·»åŠ ä¸€ä¸ª0(ä¹Ÿå¯ä»¥ç›´æ¥åœ¨åŸæ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ª0)\n    while(!stack.isEmpty()){ \n        int cur=stack.pop();\n        int left=stack.isEmpty()?-1:stack.peek();\n        //è¿™ä¸€æ­¥å¾ˆç§€,åœ¨æ•°ç»„åé¢å†æƒ³è±¡ä¸€ä¸ª0å‡ºæ¥\n        //è®©æ ˆä¸­å…ƒç´ å‘å³æ‰©å¼ (heights.length-1)-(left+1)+1\n        maxArea=Math.max(maxArea,(heights.length-left-1)*heights[cur]);\n    }\n    return maxArea;\n}\n```\nå…¶å®å°±æ˜¯åˆ©ç”¨å•è°ƒæ ˆéå†æ¯ä¸€ä¸ªæŸ±å­ï¼Œ**æ‰¾åˆ°æ¯ä¸€ä¸ªæŸ±å­å·¦è¾¹å’Œå³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„å…ƒç´ ï¼Œæ¯”å¦‚å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å½“å‰æŸ±å­å°çš„æ˜¯iï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶i+1è‚¯å®šæ˜¯å¤§äºç­‰äºå½“å‰æŸ±å­çš„ï¼Œå¹¶ä¸”i+1æ˜¯å·¦è¾¹è¿ç»­å¤§äºå½“å‰æŸ±å­çš„æœ€åä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯å½“å‰æŸ±å­èƒ½æƒ³å·¦æ‰©å±•çš„è¾¹ç•Œä½ç½®ï¼Œå³è¾¹åŒç†ï¼Œæ—¢ç„¶æ˜¯è¦æ±‚å·¦å³æ¯”å½“å‰æŸ±å­å°çš„ç¬¬ä¸€ä¸ªï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾å°±è¦ç”¨å•è°ƒé€’å¢æ ˆ**ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥æ ¹æ®è¿™ä¸¤ä¸ªæ•°æ®è®¡ç®—å®Œå…¨åŒ…å«å½“å‰æŸ±å­çš„æœ€å¤§çš„çŸ©å½¢çš„é¢ç§¯ã€‚\n\nä¾‹å¦‚: `3 4 5 4 3 6` \n\né¦–å…ˆ`3 4 5`éƒ½é¡ºåˆ©çš„å­˜å…¥æ ˆä¸­ï¼Œæ­¤æ—¶æ ˆä¸­å…ƒç´ ä¸º`ã€0ï¼Œ1ï¼Œ2ã€‘` ï¼Œå½“æƒ³å­˜å…¥ä¸‹ä¸€ä¸ªå…ƒç´ `i=3,h[i]=4`çš„æ—¶å€™ï¼Œå‘ç°4æ¯”å½“å‰æ ˆé¡¶å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è®¡ç®—**å®Œå…¨åŒ…å«æ ˆä¸­æ¯ä¸ªæŸ±å­**çš„æœ€å¤§çŸ©å½¢çš„é¢ç§¯\n\n1. ç”±äºå½“å‰`i` ä½ç½®çš„å…ƒç´ æ˜¯æ¯”æ ˆé¡¶å°ï¼Œé‚£ä¹ˆå°±è¯´æ˜ `i-1` ä½ç½®çš„å…ƒç´ ä¸€å®šæ¯”å½“å‰æ ˆé¡¶å…ƒç´ å¤§ï¼ä¹Ÿå°±æ˜¯å‘å³è¾¹æœ€å¤šæ‰©å±•åˆ°`i-1`ä½ç½®\n\n2. ç”±äºå•è°ƒæ ˆçš„ç»“æ„ï¼Œå½“å‰æ ˆé¡¶çš„ä¸‹ä¸€ä¸ªæ ˆä¸­å…ƒç´ `left`ï¼Œå…¶å®å°±æ˜¯å½“å‰æ ˆé¡¶çš„å·¦è¾¹æœ€è¿‘çš„æ¯”å®ƒå°çš„å…ƒç´ ï¼Œæ‰€ä»¥`left+1`ä½ç½®çš„å…ƒç´ ä¸€å®šæ˜¯æ¯”å½“å‰æ ˆé¡¶å…ƒç´ å¤§(ä¹Ÿæœ‰å¯èƒ½ç›¸ç­‰)ï¼ï¼Œæ‰€ä»¥å‘å·¦è¾¹æœ€å¤šæ‰©å±•åˆ° `left+1` ä½ç½®\n\n3. ä¸Šé¢å…¶å®è¿˜åˆ†ææ¼äº†ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯æ ˆé¡¶å’Œ`i` ä½ç½®å…ƒç´ ç›¸ç­‰çš„æƒ…å†µï¼Œç¬¬ä¸€ç‚¹ä¸­æåˆ°çš„å…¶å®æ˜¯ `i` ä½ç½®å…ƒç´ å°äºæ ˆé¡¶çš„æƒ…å†µï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå‘å³èƒ½æ‰©å±•åˆ°çš„ä½ç½®è¿˜ä¼šæ˜¯`i-1`ä¹ˆï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œè‡³å°‘åº”è¯¥æ˜¯`i`ç”šè‡³æ›´å¤§ï¼Œé‚£æˆ‘ä»¬è¿™é‡Œè®¡ç®—çš„å³è¾¹ç•Œä¸å°±æ˜¯é”™è¯¯çš„ï¼Ÿé‚£æˆ‘ä»¬å°† `=` å»æ‰å¯ä»¥ä¹ˆï¼Ÿå»æ‰ä¹‹åå•è°ƒæ ˆå°±ä¸å†æ˜¯ä¸¥æ ¼å•è°ƒäº†ï¼Œè¿™æ ·çš„åˆ°çš„å³è¾¹ç•Œç¡®å®å‡†ç¡®äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å·¦è¾¹ç•Œç”±äºæ ˆä¸­å­˜åœ¨ç›¸ç­‰çš„å…ƒç´ ï¼Œå°±å˜çš„ä¸å†å‡†ç¡®äº†ï¼\n\n4. é‚£æˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿå…¶å®æ ¹æœ¬å°±ä¸ç”¨å¤„ç†ï¼Œæ—¢ç„¶æ ˆé¡¶èƒ½**å‘å³**æ‰©å±•åˆ° `i-1` é‚£ä¹ˆåè¿‡æ¥ï¼Œ`i-1` ä¸€æ ·å¯ä»¥**å‘å·¦**æ‰©å±•åˆ°**æ ˆé¡¶** ä½ç½®ï¼Œè¿›è€Œè¿˜å¯ä»¥æ‰©å±•åˆ°`left+1`ä½ç½®ï¼Œè€Œå‘å·¦æ‰©å±•çš„`left+1`æ˜¯å‡†ç¡®çš„ï¼Œä¸ä¼šæœ‰è¯¯å·®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç­‰å¾…`i-1`ä½ç½®çš„å…ƒç´ å¼¹å‡ºï¼Œç„¶åå°±å¯ä»¥é‡æ–°è®¡ç®—å¾—åˆ°æœ€å¤§å€¼ï¼Œè¿™ä¸ªæœ€å¤§å€¼è‚¯å®šæ˜¯åŒ…å«ä¹‹å‰çš„å“ªä¸ªæœ€å¤§å½“ç„¶è¿™é‡Œå…¶å®é‚£ä¸ª `heights[i]<=heights[stack.peek()]` ä¸­çš„ç­‰å·ä¹Ÿå¯ä»¥å»æ‰ï¼Œè¿™æ ·æ ˆå°±ä¸æ˜¯ä¸¥æ ¼å•è°ƒçš„äº†ï¼Œ`left+1`ä¹Ÿä¸å†å‡†ç¡®ï¼Œä½†æ˜¯æ­¤æ—¶ `i-1` å°±å‡†ç¡®äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç­‰å¾…`left+1` å¼¹æ ˆä¹‹åå†é‡æ–°è®¡ç®—ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ç›¸ç­‰çš„æƒ…å†µæ˜¯ä¸ç”¨åšé¢å¤–çš„å¤„ç†\n\n   ![mark](http://static.imlgw.top/blog/20200129/gJPOkfEPDxwg.png?imageslim)\n\n   å¯ä»¥çœ‹åˆ°æŒ‰ç…§ä»£ç ä¸­çš„é€»è¾‘åœ¨è®¡ç®—å®Œå…¨åŒ…å«å½“å‰ç»¿è‰²çš„æ ˆé¡¶å…ƒç´ çš„æœ€å¤§çŸ©å½¢çš„æ—¶å€™å…¶å®åªè®¡ç®—åˆ°ä¸€éƒ¨åˆ†ï¼Œå½“è®¡ç®—åˆ°åé¢çš„ç›¸ç­‰çš„æŸ±å­çš„æ—¶å€™ä¼šå®Œå…¨åŒ…å«ä¹‹å‰çš„æŸ±å­çš„å€¼ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰é—®é¢˜\n\nâ€‹       \n\nç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œä»£ç å°±å¥½å†™å¤šäº†ï¼Œä¸è¿‡è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å€¼å¾—æ³¨æ„ï¼Œå°±æ˜¯å¤„ç†æ ˆä¸­å‰©ä½™çš„å…ƒç´ ï¼Œå…¶å®æ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯åœ¨æ•°ç»„çš„æœ«å°¾åŠ ä¸€ä¸ª0ï¼Œè¿™æ ·ç¡®ä¿æ ˆä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½å¯ä»¥å‡ºæ ˆï¼Œä¸ç”¨é¢å¤–çš„å¤„ç†ï¼Œjavaä¸­æ²¡æ³•ç›´æ¥å‘æ•°ç»„ä¸­pushå…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æƒ³è±¡æœ«å°¾æœ‰ä¸€ä¸ª0ï¼Œé‚£ä¹ˆæ‰€æœ‰å…ƒç´ å‘å·¦èƒ½æ‰©å±•åˆ°çš„æœ€è¿œä½ç½®å°±æ˜¯ `heights.length-1`\n\n**è§£æ³•äºŒ**\n\nåˆ†æ²»ï¼Œ480msï¼Œ27%\n\n```java\n//åˆ†æ²» 480ms\npublic int largestRectangleArea(int[] heights) {\n    if (heights==null || heights.length<=0) {\n        return 0;\n    }\n    largestRectangleArea(heights,0,heights.length-1);\n    return maxArea;\n}\n\nprivate int maxArea=Integer.MIN_VALUE;\n\npublic void largestRectangleArea(int[] heights,int left,int right) {\n    if (left>right) {\n        return;\n    }\n    int minIndex=left;\n    for (int i=left;i<=right;i++) {\n        minIndex=heights[i]<heights[minIndex]?i:minIndex;\n    }\n    maxArea=Math.max(heights[minIndex]*(right-left+1),maxArea);\n    largestRectangleArea(heights,left,minIndex-1);\n    largestRectangleArea(heights,minIndex+1,right);\n}\n```\nå°†æ•°ç»„åŒºé—´ä»¥`minIndex`ä¸ºåˆ†ç•Œçº¿ï¼Œåˆ†åˆ«æ±‚å·¦è¾¹å’Œå³è¾¹çš„æœ€å¤§é¢ç§¯ï¼Œæ—¶é—´å¤æ‚åº¦`O(NlogN)`\n\n**è§£æ³•ä¸‰**\n\nä¼˜åŒ–çš„åˆ†æ²» 1msï¼Œ100%ï¼Œæ²¡æƒ³åˆ°æ¯”å•è°ƒæ ˆè¿˜å¿«ã€‚ã€‚\n\n```java\npublic int largestRectangleArea(int[] heights) {\n    if (heights==null || heights.length<=0) {\n        return 0;\n    }\n    return largestRectangleArea(heights,0,heights.length-1);\n}\n\npublic int largestRectangleArea(int[] heights,int left,int right) {\n    if (left>right) {\n        return 0;\n    }\n    int minIndex=left;\n    boolean up=true;\n    boolean down=true;\n    for (int i=left+1;i<=right;i++) {\n        if (heights[i]<heights[i-1]) {\n            up=false;\n        }\n        if (heights[i]>heights[i-1]) {\n            down=false;\n        }\n        minIndex=heights[i]<heights[minIndex]?i:minIndex;\n    }\n    if (up) {\n        int maxArea=-1;\n        for (int i=left;i<=right;i++) {\n            maxArea=Math.max(maxArea,(right-i+1)*heights[i]);\n        }\n        return maxArea;\n    }\n    if (down) {\n        int maxArea=-1;\n        for (int i=right;i>=left;i--) {\n            maxArea=Math.max(maxArea,(i-left+1)*heights[i]);\n        }\n        return maxArea;\n    }\n    return Math.max(heights[minIndex]*(right-left+1),Math.max(largestRectangleArea(heights,minIndex+1,right),largestRectangleArea(heights,left,minIndex-1)));\n}\n```\nå…¶å®ç›¸æ¯”äºä¸Šé¢çš„åˆ†æ²»ï¼Œå°±æ˜¯å¤šäº†ä¸€æ­¥åˆ¤æ–­å½“å‰åŒºé—´æ˜¯å¦æœ‰åºï¼Œå› ä¸ºæœ‰åºçš„è¯å°±å¯ä»¥ç›´æ¥éå†å¾—åˆ°åŒºé—´çš„æœ€å¤§çŸ©å½¢ï¼Œä¸ç”¨å†é€’å½’åšåˆ†æ²»ï¼Œæˆ‘è¿™é‡Œåšäº†ä¸¤ä¸ªæœ‰åºçš„åˆ¤æ–­ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æœ‰çš„å¤šä½™ï¼Œæˆ‘çœ‹çš„è¯„è®ºéƒ½åªæœ‰ä¸€ä¸ª\n\n## [85. æœ€å¤§çŸ©å½¢](https://leetcode-cn.com/problems/maximal-rectangle/)\n\nç»™å®šä¸€ä¸ªä»…åŒ…å« 0 å’Œ 1 çš„äºŒç»´äºŒè¿›åˆ¶çŸ©é˜µï¼Œæ‰¾å‡ºåªåŒ…å« 1 çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥:\n[\n  [\"1\",\"0\",\"1\",\"0\",\"0\"],\n  [\"1\",\"0\",\"1\",\"1\",\"1\"],\n  [\"1\",\"1\",\"1\",\"1\",\"1\"],\n  [\"1\",\"0\",\"0\",\"1\",\"0\"]\n]\nè¾“å‡º: 6\n```\n\n**è§£æ³•ä¸€**\n\nç‰¹æ„åœ¨åšäº†ä¸Šé¢ä¸€é¢˜åæ²¡æœ‰é©¬ä¸Šåšè¿™ä¸€é¢˜ï¼Œä¸‹é¢çš„æ˜¯ç¬¬äºŒå¤©ä¸‹åˆåšçš„ï¼Œè¿˜è¡Œï¼Œæ²¡å¿˜è®°ğŸ˜‚ï¼Œå°±æ˜¯å†™çš„æœ‰ç‚¹éš¾çœ‹\n\n```java\n//update: 2020.4.12\npublic int maximalRectangle(char[][] matrix) {\n    if(matrix==null || matrix.length<=0) return 0;\n    int M=matrix.length,N=matrix[0].length;\n    int[][] height=new int[M][N+1]; //æ¯ä¸€å±‚å¤šåŠ ä¸€ä¸ª0,æ–¹ä¾¿åé¢å‡ºæ ˆ\n    int res=0;\n    for(int i=0;i<M;i++){\n        for(int j=0;j<N;j++){\n            if(matrix[i][j]=='1'){\n                height[i][j]=i-1>=0?height[i-1][j]+1:1;\n            }\n        }\n        res=Math.max(maxRectangle(height[i]),res);\n    }\n    return res;\n}\n\npublic int maxRectangle(int[] height){\n    Deque<Integer> stack=new ArrayDeque<>();\n    int max=0;\n    for(int i=0;i<height.length;i++){\n        while(!stack.isEmpty() && height[i]<height[stack.peek()]){\n            int cur=stack.pop();\n            //æ ˆä¸ºç©ºçš„æ—¶å€™è¯´æ˜å·¦è¾¹çš„å…¨éƒ¨æ˜¯æ¯”å½“å‰æ ˆé¡¶å¤§çš„å…ƒç´ ,å¯ä»¥ç›´æ¥æ‰©å±•åˆ°0,æ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯-1\n            int left=stack.isEmpty()?-1:stack.peek();\n            //left+1 ~ i-1 = i-1-left\n            max=Math.max((i-1-left)*height[cur],max);\n        }\n        stack.push(i);\n    }\n    return max;\n}\n```\n\nå…¶å®è®¡ç®—heightæœ‰ä¸€ç‚¹åŠ¨æ€è§„åˆ’çš„æ„æ€ï¼Œæˆ‘ä¸Šé¢ç›¸å½“äºå†™äº†ä¸ªäºŒç»´çš„åŠ¨æ€è§„åˆ’\n\n> 2020.4.12é‡å†™äº†ä¸€éï¼Œç„¶åæ›´æ–°äº†ä»£ç ï¼Œä¹‹å‰çš„ä»£ç ä¸å¤Ÿç®€æ´\n\n**è§£æ³•äºŒ**\n\n```java\npublic int maximalRectangle(char[][] matrix) {\n    if (matrix==null || matrix.length<=0) {\n        return 0;\n    }\n    //åˆå§‹åŒ–heightæ•°ç»„,åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ (é»˜è®¤0)è®©æ‰€æœ‰å…ƒç´ å¯ä»¥å‡ºæ ˆ\n    int[] height=new int[matrix[0].length+1];\n    int max=0;\n    //è®°å½•æ¯ä¸€å±‚çš„height\n    for (int i=0;i<matrix.length;i++) {\n        for (int j=0;j<matrix[0].length;j++) {\n            height[j]=matrix[i][j]=='1'?height[j]+1:0;\n        }\n        max=Math.max(max,maxArea(height));\n    }\n    return max;\n}\n```\n\n`maxArea`å¯ä»¥ç›´æ¥é‡‡ç”¨ä¸Šé¢84é¢˜çš„åˆ†æ²»\n\n## [581. æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„](https://leetcode-cn.com/problems/shortest-unsorted-continuous-subarray/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œä½ éœ€è¦å¯»æ‰¾ä¸€ä¸ª**è¿ç»­çš„å­æ•°ç»„**ï¼Œå¦‚æœå¯¹è¿™ä¸ªå­æ•°ç»„è¿›è¡Œå‡åºæ’åºï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°ç»„éƒ½ä¼šå˜ä¸ºå‡åºæ’åºã€‚\n\nä½ æ‰¾åˆ°çš„å­æ•°ç»„åº”æ˜¯**æœ€çŸ­**çš„ï¼Œè¯·è¾“å‡ºå®ƒçš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [2, 6, 4, 8, 10, 9, 15]\nè¾“å‡º: 5\nè§£é‡Š: ä½ åªéœ€è¦å¯¹ [6, 4, 8, 10, 9] è¿›è¡Œå‡åºæ’åºï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨éƒ½ä¼šå˜ä¸ºå‡åºæ’åºã€‚\n```\n\n**è¯´æ˜ :**\n\n1. è¾“å…¥çš„æ•°ç»„é•¿åº¦èŒƒå›´åœ¨ [1, 10,000]ã€‚\n2. è¾“å…¥çš„æ•°ç»„å¯èƒ½åŒ…å«**é‡å¤**å…ƒç´  ï¼Œæ‰€ä»¥**å‡åº**çš„æ„æ€æ˜¯**<=ã€‚**\n\n**è§£æ³•ä¸€**\n\n~~å•è°ƒæ ˆçš„è§£æ³•æ˜å¤©å†å†™~~\n\né¸½äº†æŒºé•¿æ—¶é—´ï¼Œå•è°ƒæ ˆçš„è§£æ³•è¿˜æ˜¯æŒºå¥½çš„\n\n```java\npublic int findUnsortedSubarray(int[] nums) {\n    Stack<Integer> stack=new Stack<>();\n    int left=Integer.MAX_VALUE,right=Integer.MIN_VALUE;\n    for (int i=0;i<nums.length;i++) {\n        while(!stack.isEmpty() && nums[stack.peek()]>nums[i]){\n            left=Math.min(stack.pop(),left); //å·¦è¾¹ç•Œæ­£ç¡®ä½ç½®(æœ€å°å€¼)\n        }\n        stack.push(i);\n    }\n    stack.clear();\n    for (int i=nums.length-1;i>=0;i--) {\n        while(!stack.isEmpty() && nums[stack.peek()]<nums[i]){\n            right=Math.max(stack.pop(),right); //å³è¾¹ç•Œæ­£ç¡®ä½ç½®(æœ€å¤§å€¼)\n        }\n        stack.push(i);\n    }\n    return left>right?0:right-left+1;\n}\n```\n\nç¬¬ä¸€ä¸ªå•è°ƒæ ˆä¸­å­˜çš„æ˜¯ä»å·¦åˆ°å³é€’å¢çš„åºåˆ—ï¼Œå½“é‡åˆ°`nums[i]`å°äºæ ˆé¡¶æ—¶ï¼Œè¯´æ˜è¿™ä¸ªä½ç½®æ˜¯é”™ä½çš„ï¼Œæ­£ç¡®çš„ä½ç½®åº”è¯¥æ˜¯**æ ˆé¡¶çš„å…ƒç´ **çš„ä½ç½®ï¼Œæˆ‘ä»¬è¿™é‡Œæ±‚çš„å°±æ˜¯ä¸€ä¸ª**æœ€å°çš„é”™ä½çš„ç´¢å¼•**\n\nç¬¬äºŒä¸ªå•è°ƒæ ˆä¸­å­˜çš„æ˜¯ä»å³å‘å·¦é€’å‡çš„åºåˆ—ï¼Œå½“é‡åˆ°`nums[i]`å¤§äºæ ˆé¡¶æ—¶ï¼Œè¯´æ˜è¿™ä¸ªä½ç½®æ˜¯é”™ä½çš„ï¼Œæ­£ç¡®çš„ä½ç½®åº”è¯¥æ˜¯**æ ˆé¡¶çš„å…ƒç´ **ï¼Œè¿™é‡Œæ±‚çš„å°±æ˜¯ä¸€ä¸ª**æœ€å¤§çš„é”™ä½çš„ç´¢å¼•** ï¼Œä¸¤è€…ä¹‹é—´çš„è·ç¦»å…¶å®å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦æ±‚çš„æœ€çŸ­æ— åºå­æ•°ç»„é•¿åº¦\n\n**è§£æ³•äºŒ**\n\nå…¶å®å’Œä¸Šé¢çš„å•è°ƒæ ˆçš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æ‰¾ç¬¬ä¸€ä¸ªï¼ˆæœ€å°ï¼‰å’Œæœ€åä¸€ä¸ªï¼ˆæœ€å¤§ï¼‰é”™ä½çš„å…ƒç´ ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬æ±‚å‡ºé”™ä½çš„å…ƒç´ åè¿˜éœ€è¦å†éå†æ‰¾åˆ°åŸæœ¬æ­£ç¡®çš„ä½ç½®ï¼Œ\n\n```java\n//O(1)ç©ºé—´çš„è§£æ³•\npublic int findUnsortedSubarray(int[] nums) {\n    if (nums[0]>nums[nums.length-1]) {\n        return nums.length;\n    }\n    int max=Integer.MIN_VALUE,min=Integer.MAX_VALUE;\n    for (int i=1;i<nums.length;i++) {\n        if (nums[i]<nums[i-1]) {\n            min=Math.min(min,nums[i]); //æ— åºåºåˆ—ä¸­çš„æœ€å°å€¼\n        }\n    }\n\n    for (int i=nums.length-1;i>0;i--) {\n        if (nums[i]<nums[i-1]) {\n            max=Math.max(max,nums[i-1]); //æ— åºåºåˆ—ä¸­çš„æœ€å¤§å€¼\n        }\n    }\n    int left=0,right=nums.length-1;\n    while(left<nums.length){\n        if (nums[left]>min) {\n            break;\n        }\n        left++; //å·¦è¾¹ç•Œæ­£ç¡®ä½ç½®\n    }\n    while(right>=0){\n        if (nums[right]<max) {\n            break;\n        }\n        right--; //å³è¾¹ç•Œæ­£ç¡®ä½ç½®\n    }\n    return right<left?0:right-left+1;\n}\n```\n\n## [42. æ¥é›¨æ°´](https://leetcode-cn.com/problems/trapping-rain-water/)\n\nç»™å®š *n* ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚\n\n![rainwatertrap.png](https://i.loli.net/2019/05/14/5cda71129045d93180.png)\n\n\n\n\nä¸Šé¢æ˜¯ç”±æ•°ç»„ `[0,1,0,2,1,0,1,3,2,1,2,1]` è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [0,1,0,2,1,0,1,3,2,1,2,1]\nè¾“å‡º: 6\n```\n\n**è§£æ³•ä¸‰**\n\nå•è°ƒæ ˆè§£æ³•ï¼ŒåŒæŒ‡é’ˆçš„è§£æ³•æ”¾åœ¨[æ•°ç»„ä¸“é¢˜](http://imlgw.top/2019/05/04/leetcode-shu-zu/#42-%E6%8E%A5%E9%9B%A8%E6%B0%B4)ä¸­ï¼Œå…¶å®æˆ‘æ„Ÿè§‰ç†Ÿæ‚‰å•è°ƒæ ˆçš„è¯ï¼Œå•è°ƒæ ˆçš„è§£æ³•ä¼šæ¯”å…¶ä»–æ–¹æ³•æ›´å¥½ç†è§£\n\n```java\npublic static int trap6(int[] height) {\n    if (height == null || height.length == 0) return 0;\n    Deque<Integer> stack = new ArrayDeque<>(); //æ ˆé‡Œé¢ç»´æŠ¤ä¸€ä¸ªé€’å‡åºåˆ—\n    int res = 0;\n    for (int i = 0; i < height.length; i++){\n        while ( ! stack.isEmpty() && height[stack.peek()] < height[i]) { //å½“éå†çš„å…ƒç´ å¤§äºæ ˆé¡¶å…ƒç´ \n            int tmp = stack.pop(); //æ ˆé¡¶å¼¹å‡ºæ¥\n            if (stack.isEmpty()) break;\n            res += (Math.min(height[i],height[stack.peek()]) - height[tmp]) * (i - stack.peek() - 1);\n        }\n        //ç»´æŠ¤é€’å‡åºåˆ—\n        stack.push(i);\n    }\n    return res;\n}\n```\n\nå•è°ƒé€’å‡æ ˆï¼Œæ ˆä¸­å­˜æŸ±å­çš„ç´¢å¼•ï¼Œå½“é‡åˆ°å¤§äºæ ˆé¡¶çš„å…ƒç´ çš„æ—¶å€™å°±å¼€å§‹å¼¹æ ˆï¼Œè®¡ç®—**æ ˆé¡¶å…ƒç´ å’Œå·¦å³é¦–ä¸ªå¤§äºæ ˆé¡¶å…ƒç´ çš„æ‰€èƒ½æ„æˆçš„é‚£ä¸€å±‚çš„æ¥æ°´é‡**ï¼Œå¯¹åº”ä¸‹é¢çš„å›¾ç†è§£å°±æ˜¯\n\n**`(Math.min(height[i],height[stack.peek()])-curTop) * (i-stack.peek()-1)`**\n\n![mark](http://static.imlgw.top/blog/20200129/f0b4lo2Xk5Q3.png?imageslim)\n\nä¾æ¬¡è®¡ç®—â‘ â‘¡â‘¢ä½ç½®çš„é¢ç§¯ï¼Œè¿™æ ·çš„æ€è·¯æ„Ÿè§‰ä¼šæ›´åŠ çš„è‡ªç„¶\n\n## [é¢è¯•é¢˜33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—](https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/)\n\nè¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­è¯¥æ•°ç»„æ˜¯ä¸æ˜¯æŸäºŒå‰æœç´¢æ ‘çš„ååºéå†ç»“æœã€‚å¦‚æœæ˜¯åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚å‡è®¾è¾“å…¥çš„æ•°ç»„çš„ä»»æ„ä¸¤ä¸ªæ•°å­—éƒ½äº’ä¸ç›¸åŒã€‚\n\nå‚è€ƒä»¥ä¸‹è¿™é¢—äºŒå‰æœç´¢æ ‘ï¼š\n\n```java\n     5\n    / \\\n   2   6\n  / \\\n 1   3\n```\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: [1,6,3,2,5]\nè¾“å‡º: false\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: [1,3,2,6,5]\nè¾“å‡º: true\n```\n\n**æç¤ºï¼š**\n\n1. `æ•°ç»„é•¿åº¦ <= 1000`\n\n**è§£æ³•ä¸€**\n\nå•è°ƒæ ˆçš„è§£æ³•\n\n```java\npublic boolean verifyPostorder(int[] postorder) {\n    if(postorder==null || postorder.length<=0) return true;\n    Deque<Integer> stack=new ArrayDeque<>();\n    //1 2 | 4 5 | 3\n    int curRoot=Integer.MAX_VALUE;\n    for(int i=postorder.length-1;i>=0;i--){\n        if(postorder[i]>curRoot){\n            return false;\n        }\n        while(!stack.isEmpty() && postorder[i]<postorder[stack.peek()]){\n            curRoot=postorder[stack.pop()];\n        }\n        stack.push(i);\n    }\n    return true;\n}\n```\n\né€†åºéå†è¿™ä¸ªåºåˆ—ï¼Œå°±æ˜¯ `root -- root.right -- root.left` ï¼Œç”¨ä¸€ä¸ªå•è°ƒé€’å¢æ ˆï¼Œå½“é‡åˆ°å‡å°çš„å€¼å°±è¯´æ˜è¿›å…¥äº†å·¦å­æ ‘ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™é¢—æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸åœå‡ºæ ˆï¼Œç›´åˆ°æ‰¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œç„¶åç»§ç»­å‘ååˆ¤æ–­å·¦å­æ ‘æ˜¯ä¸æ˜¯éƒ½å°äºè¿™ä¸ªæ ¹èŠ‚ç‚¹çš„\n\n## [é¢è¯•é¢˜59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼](https://leetcode-cn.com/problems/dui-lie-de-zui-da-zhi-lcof/)\n\nè¯·å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—å¹¶å®ç°å‡½æ•° max_value å¾—åˆ°é˜Ÿåˆ—é‡Œçš„æœ€å¤§å€¼ï¼Œè¦æ±‚å‡½æ•°max_valueã€push_back å’Œ pop_front çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚\n\nè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œ`pop_front` å’Œ `max_value` éœ€è¦è¿”å› -1\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: \n[\"MaxQueue\",\"push_back\",\"push_back\",\"max_value\",\"pop_front\",\"max_value\"]\n[[],[1],[2],[],[],[]]\nè¾“å‡º: [null,null,null,2,1,2]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: \n[\"MaxQueue\",\"pop_front\",\"max_value\"]\n[[],[],[]]\nè¾“å‡º: [null,-1,-1]\n```\n\n**é™åˆ¶ï¼š**\n\n- `1 <= push_back,pop_front,max_valueçš„æ€»æ“ä½œæ•° <= 10000`\n- `1 <= value <= 10^5`\n\n**è§£æ³•ä¸€**\n\n```java\npublic MaxQueue() {\n\n}\n\nDeque<Integer> queue=new LinkedList<>();\n\nDeque<Integer> maxQueue=new ArrayDeque<>();\n\npublic int max_value() {\n    return maxQueue.isEmpty()?-1:maxQueue.getFirst();\n}\n\npublic void push_back(int value) {\n    queue.addLast(value);\n    while(!maxQueue.isEmpty() && value>maxQueue.getLast()){\n        maxQueue.removeLast();\n    }\n    maxQueue.addLast(value);\n}\n\npublic int pop_front() {\n    if(queue.isEmpty()) return -1;\n    int temp=queue.removeFirst();\n    if(temp==maxQueue.getFirst()){\n        maxQueue.removeFirst();\n    }\n    return temp;\n}\n```\n\nä¸€ç›´ä»¥ä¸ºæ˜¯å’Œæœ€å°æ ˆä¸€æ ·ï¼Œç»“æœWAäº†ä¸¤å‘æ‰æ„è¯†åˆ°æé”™äº†ã€‚ã€‚ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿›å‡ºæ–¹å‘æ˜¯ä¸ä¸€æ ·çš„\n\nå…¶å®è¿™é¢˜å’Œä¹‹å‰çš„ä¸€é“ [æ»‘åŠ¨çª—å£æœ€å¤§å€¼](http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou/#239-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC) ä¸€æ ·ï¼Œç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„å•è°ƒæ ˆç„¶åç»´æŠ¤è¿™ä¸ªå•è°ƒæ ˆå°±è¡Œäº†\n\n## [5402. ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­å­æ•°ç»„](https://leetcode-cn.com/problems/longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit/) \n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œå’Œä¸€ä¸ªè¡¨ç¤ºé™åˆ¶çš„æ•´æ•° `limit`ï¼Œè¯·ä½ è¿”å›æœ€é•¿è¿ç»­å­æ•°ç»„çš„é•¿åº¦ï¼Œè¯¥å­æ•°ç»„ä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„ç»å¯¹å·®å¿…é¡»å°äºæˆ–è€…ç­‰äº `limit` *ã€‚*\n\nå¦‚æœä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ï¼Œåˆ™è¿”å› `0` ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [8,2,4,7], limit = 4\nè¾“å‡ºï¼š2 \nè§£é‡Šï¼šæ‰€æœ‰å­æ•°ç»„å¦‚ä¸‹ï¼š\n[8] æœ€å¤§ç»å¯¹å·® |8-8| = 0 <= 4.\n[8,2] æœ€å¤§ç»å¯¹å·® |8-2| = 6 > 4. \n[8,2,4] æœ€å¤§ç»å¯¹å·® |8-2| = 6 > 4.\n[8,2,4,7] æœ€å¤§ç»å¯¹å·® |8-2| = 6 > 4.\n[2] æœ€å¤§ç»å¯¹å·® |2-2| = 0 <= 4.\n[2,4] æœ€å¤§ç»å¯¹å·® |2-4| = 2 <= 4.\n[2,4,7] æœ€å¤§ç»å¯¹å·® |2-7| = 5 > 4.\n[4] æœ€å¤§ç»å¯¹å·® |4-4| = 0 <= 4.\n[4,7] æœ€å¤§ç»å¯¹å·® |4-7| = 3 <= 4.\n[7] æœ€å¤§ç»å¯¹å·® |7-7| = 0 <= 4. \nå› æ­¤ï¼Œæ»¡è¶³é¢˜æ„çš„æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ä¸º 2 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [10,1,2,4,7,2], limit = 5\nè¾“å‡ºï¼š4 \nè§£é‡Šï¼šæ»¡è¶³é¢˜æ„çš„æœ€é•¿å­æ•°ç»„æ˜¯ [2,4,7,2]ï¼Œå…¶æœ€å¤§ç»å¯¹å·® |2-7| = 5 <= 5 ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [4,2,2,2,4,4,2,2], limit = 0\nè¾“å‡ºï¼š3\n```\n\n**æç¤ºï¼š**\n\n- `1 <= nums.length <= 10^5`\n- `1 <= nums[i] <= 10^9`\n- `0 <= limit <= 10^9`\n\n187thå‘¨èµ›t3ï¼Œæ—¶éš”è¿™ä¹ˆä¹…åˆå›å¤´æ‰“ä¸€æ¬¡å‘¨èµ›ï¼Œå¯æƒœï¼Œåˆåªåšäº†ä¸¤é¢˜ï¼Œå‰ä¸¤é¢˜10åˆ†é’Ÿä¸åˆ°å°±å†™å®Œäº†ï¼Œå¿ƒæƒ³è¿™å›æ€ä¹ˆè¯´ä¹Ÿå¾—åšä¸ª3é¢˜ï¼Œç»“æœã€‚ã€‚ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic int longestSubarray2(int[] nums, int limit) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int left=0,right=0;\n    int min=0,max=0;\n    int res=1;\n    PriorityQueue<Integer> minpq=new PriorityQueue<>();\n    minpq.add(nums[0]);\n    PriorityQueue<Integer> maxpq=new PriorityQueue<>((a,b)->b-a);\n    maxpq.add(nums[0]);\n    //7 2\n    while(left<=right && right<nums.length){\n        while (right< nums.length && maxpq.peek()-minpq.peek()<=limit) {\n            res=Math.max(right-left+1,res);\n            right++;\n            if (right<nums.length) {\n                maxpq.add(nums[right]);\n                minpq.add(nums[right]);   \n            }\n        }\n        maxpq.remove(nums[left]);\n        minpq.remove(nums[left]);\n        left++;\n    }\n    return res;\n}\n```\nè¿™ä¸ªæ˜¯å½“æ—¶æ¯”èµ›è°ƒäº†åŠå¤©æ²¡è°ƒå‡ºæ¥ï¼Œç»“æŸä¹‹åè°ƒå‡ºæ¥çš„ä»£ç ï¼Œç”¨ä¸¤ä¼˜å…ˆé˜Ÿåˆ—ç»´æŠ¤åŒºé—´æœ€å€¼ï¼Œç„¶åæ»‘çª—å°±è¡Œäº†ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯è°ƒæ»‘çª—çš„æ—¶å€™è°ƒäº†åŠå¤©ï¼Œä¹‹å‰å†™æ»‘çª—å°±æ˜¯ä¹±å†™çš„ï¼Œæ²¡ä»€ä¹ˆç« æ³•ï¼Œè¾¹WAè¾¹æ”¹ï¼Œçœ‹æ¥æœ€è¿‘å¾—å¥½å¥½æ€»ç»“ä¸‹æ»‘çª—çš„é¢˜äº†ï¼Œå¾—æä¸ªæ¿å­å‡ºæ¥\n\n**è§£æ³•äºŒ**\n\næœ€ä¼˜è§£ï¼ŒO(N)å•è°ƒé˜Ÿåˆ—\n```java\n//UPDATE: 2020/6/29 æ”¹æˆæœ€è¿‘æ€»ç»“çš„for-whileæ»‘çª—æ¨¡æ¿\n//ä¸Šé¢çš„è§£æ³•ä¸€çš„æ»‘çª—ä¹Ÿå†™çš„ä¸å¥½ï¼Œæœ‰æ—¶é—´æ”¹æ”¹\npublic int longestSubarray(int[] nums, int limit) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int left=0;\n    int min=0,max=0;\n    int res=1;\n    //å•è°ƒé˜Ÿåˆ—è®°å½•åŒºé—´æœ€å€¼ç´¢å¼•\n    LinkedList<Integer> maxQue=new LinkedList<>();\n    LinkedList<Integer> minQue=new LinkedList<>();\n    for(int right=0;right<nums.length;right++){\n        while(!maxQue.isEmpty() && nums[maxQue.getLast()]<nums[right]){\n            maxQue.removeLast();\n        }\n        maxQue.addLast(right);\n        while(!minQue.isEmpty() && nums[minQue.getLast()]>nums[right]){\n            minQue.removeLast();\n        }\n        minQue.addLast(right);\n        while(nums[maxQue.getFirst()]-nums[minQue.getFirst()]>limit) {\n            //ä¸ç¬¦åˆè¦æ±‚ï¼Œå·¦è¾¹ç•Œå·¦ç§»ï¼Œå½“å·¦è¾¹ç•Œæ˜¯æœ€å€¼çš„æ—¶å€™queå¼¹å‡º\n            if (left==maxQue.getFirst()) maxQue.removeFirst();\n            if (left==minQue.getFirst()) minQue.removeFirst();\n            left++;\n        }\n        res=Math.max(res,right-left+1);\n    }\n    return res;\n}\n```\nå…¶å®å½“æ—¶æˆ‘ç¡®å®ä¹Ÿå°è¯•å»ç”¨ä¸¤ä¸ªå•è°ƒé˜Ÿåˆ—ç»´æŠ¤æœ€å€¼ï¼Œä½†æ˜¯ï¼ï¼ï¼è¿˜æ˜¯è¢«æ»‘çª—çš„è¾¹ç•Œç»™æå¾—ä¸çŸ¥é“è¿™ä¹ˆå†™äº†ï¼Œç„¶åå°±æ²¡åˆç„¶åäº†ï¼Œä¸Šé¢çš„ä»£ç ä¹Ÿæ˜¯æ¯”èµ›å®Œä¹‹åè‡ªå·±å†™å‡ºæ¥çš„ï¼Œè¯´åˆ°åº•è¿˜æ˜¯èœå•Šï¼ğŸ˜­\n\n## [962. æœ€å¤§å®½åº¦å¡](https://leetcode-cn.com/problems/maximum-width-ramp/) \n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `A`ï¼Œ*å¡*æ˜¯å…ƒç»„ `(i, j)`ï¼Œå…¶ä¸­  `i < j` ä¸” `A[i] <= A[j]`ã€‚è¿™æ ·çš„å¡çš„å®½åº¦ä¸º `j - i`ã€‚\n\næ‰¾å‡º `A` ä¸­çš„å¡çš„æœ€å¤§å®½åº¦ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å› 0 ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[6,0,8,2,1,5]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼š\næœ€å¤§å®½åº¦çš„å¡ä¸º (i, j) = (1, 5): A[1] = 0 ä¸” A[5] = 5.\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[9,8,1,0,1,9,4,0,4,1]\nè¾“å‡ºï¼š7\nè§£é‡Šï¼š\næœ€å¤§å®½åº¦çš„å¡ä¸º (i, j) = (2, 9): A[2] = 1 ä¸” A[9] = 1.\n```\n\n**æç¤ºï¼š**\n\n1. `2 <= A.length <= 50000`\n2. `0 <= A[i] <= 50000`\n\n**è§£æ³•ä¸€**\n\næƒ³ä¸åˆ°ï¼Œç€å®æƒ³ä¸åˆ°ï¼Œè¿™ä¸ªå•è°ƒæ ˆçš„ç”¨æ³•ç¡®å®æ²¡è§è¿‡\n\n```java\npublic int maxWidthRamp(int[] A) {\n    Deque<Integer> stack=new ArrayDeque<>();\n    int res=0;\n    for(int i=0;i<A.length;i++){\n        if(stack.isEmpty() || A[stack.peek()]>A[i]){\n            stack.push(i);\n        }\n    }\n    for(int i=A.length-1;i>=0;i--){\n        while(!stack.isEmpty() && A[stack.peek()]<=A[i]){\n            int cur=stack.pop();\n            res=Math.max(res,i-cur);\n        }\n    }\n    return res;\n}\n```\n\né¦–å…ˆæŠŠAæ•°ç»„ä¸­çš„ä»¥`A[0]`å¼€å¤´çš„é€’å‡åºåˆ—æŠ½å–å‡ºæ¥ï¼Œæˆ‘ä»¬æœ€åè¦æ±‚çš„æœ€å¤§çš„å®½åº¦å¡ä¸€å®šæ˜¯ä»¥è¿™ä¸ªåºåˆ—ä¸­çš„æŸä¸€ä¸ª`i`ä¸º**å¡åº•**çš„ï¼Œæˆ‘ä»¬åè¯ä¸€ä¸‹\n\nå‡è®¾å­˜åœ¨æŸä¸ªå…ƒç´ ä½ç½®`k`ä¸å­˜åœ¨äºä¸Šé¢çš„é€’å‡åºåˆ—ä¸­ï¼Œä¸”æœ‰æœ€å¤§å®½åº¦`j-k`ï¼Œè¿™ä¹Ÿå°±è¯´æ˜`k`ä½ç½®çš„å…ƒç´ **ä¸€å®šæ˜¯å°äºç­‰äºkå‰é¢æ‰€æœ‰çš„å…ƒç´ çš„**ï¼Œå¦åˆ™å°±ä¼šæœ‰æ›´é•¿çš„å®½åº¦ï¼Œä½†æ˜¯æ—¢ç„¶`k`å°äºç­‰äºå‰é¢æ‰€æœ‰çš„å…ƒç´ ï¼Œé‚£ä¹ˆkå°±ä¸€å®šä¼šè¢«åŠ å…¥åˆ°åºåˆ—ä¸­ï¼Œä¸å‡è®¾çŸ›ç›¾ï¼Œæ‰€ä»¥ä¸å­˜åœ¨kï¼Œè§£ä¸€å®šå­˜åœ¨é€’å‡åºåˆ—ä¸­\n\nè¿™æ ·çš„è¯æˆ‘ä»¬å¯ä»¥é€†å‘éå†æ•°ç»„ï¼Œæ¯æ¬¡é‡åˆ°å…ƒç´ å¤§äºæ ˆé¡¶çš„å°±å¯ä»¥è®¡ç®—å®½åº¦ï¼Œç„¶åå°†æ ˆé¡¶å¼¹å‡ºï¼Œå› ä¸ºæ˜¯é€†åºéå†çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå®½åº¦ä¸€å®šæ˜¯æ ˆé¡¶è¿™ä¸ª**å¡åº•i**èƒ½å½¢æˆçš„æœ€å¤§å®½åº¦äº†ï¼Œ é€†åºéå†å†å¾€å‰çš„è¯å³ä½¿å¤§äºè¿™ä¸ªæ ˆé¡¶ï¼Œå½¢æˆçš„å®½åº¦ä¹Ÿåªä¼šå‡å°ï¼Œæ‰€ä»¥è¿™ä¸ªæ ˆé¡¶æ˜¯å¯ä»¥ç›´æ¥`pop`å‡ºå»çš„ï¼Œæˆ‘ä»¬éå†æ‰€æœ‰çš„å¡åº•æ±‚æœ€å¤§å€¼å°±è¡Œäº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(N)`\n\n**è§£æ³•äºŒ**\n\näºŒåˆ†çš„æ€è·¯ï¼Œå’Œä¸Šé¢ä¸€æ ·ï¼Œå…ˆæ„å»ºä¸€ä¸ªä»¥`A[0]`å¼€å¤´çš„é€’å‡åºåˆ—ï¼Œè¿™é‡Œé¢å°±æ˜¯æˆ‘ä»¬æ‰€æœ‰çš„å¡åº•ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥éå†æ‰€æœ‰çš„å…ƒç´ ï¼Œç„¶ååœ¨è¿™ä¸ªå•è°ƒåºåˆ—ä¸­å¯»æ‰¾ç¬¬ä¸€ä¸ªå°äºç­‰äºå½“å‰å…ƒç´ çš„`index`ï¼Œè¿™ä¸¤ä¸ªæ„æˆçš„å®½åº¦å°±æ˜¯**å½“å‰å…ƒç´ **æ‰€èƒ½å½¢æˆçš„æœ€å¤§å®½åº¦ï¼Œæˆ‘ä»¬æ±‚å‡ºæ‰€æœ‰çš„æœ€å¤§å®½åº¦å–ä¸€ä¸ªæœ€å€¼å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(NlogN)`\n\n```go\nfunc maxWidthRamp(A []int) int {\n    var order [][]int\n    order = append(order, []int{0, A[0]})\n    //æ„å»ºé€’å‡åºåˆ—\n    for i := 1; i < len(A); i++ {\n        if A[i] < order[len(order)-1][1] {\n            order = append(order, []int{i, A[i]})\n        }\n    }\n    res := 0\n    for j, target := range A {\n        i := binarySearch(order, target)\n        res = Max(res, j-i)\n    }\n    return res\n}\n\n//æ‰¾ç¬¬ä¸€ä¸ªå°äºç­‰äºtargetçš„å€¼\nfunc binarySearch(num [][]int, target int) int {\n    left := 0\n    right := len(num) - 1\n    for left < right {\n        mid := left + (right-left)/2\n        if num[mid][1] > target {\n            left = mid + 1 //æ³¨æ„æ˜¯é€’å‡åºåˆ—\n        } else {\n            right = mid\n        }\n    }\n    return num[left][0]\n}\n\nfunc Max(a, b int) int {\n    if a > b {\n        return a\n    }\n    return b\n}\n```\n\n> åœ¨lcå†™çš„ [é¢˜è§£](https://leetcode-cn.com/problems/maximum-width-ramp/solution/java-dan-diao-zhan-er-fen-jie-fa-chang-shi-jie-shi/)æ¬¢è¿å‰æ¥çº é”™\n\n## [1124. è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ](https://leetcode-cn.com/problems/longest-well-performing-interval/)\n\nç»™ä½ ä¸€ä»½å·¥ä½œæ—¶é—´è¡¨ `hours`ï¼Œä¸Šé¢è®°å½•ç€æŸä¸€ä½å‘˜å·¥æ¯å¤©çš„å·¥ä½œå°æ—¶æ•°ã€‚\n\næˆ‘ä»¬è®¤ä¸ºå½“å‘˜å·¥ä¸€å¤©ä¸­çš„å·¥ä½œå°æ—¶æ•°å¤§äº `8` å°æ—¶çš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸€å¤©å°±æ˜¯ã€Œ**åŠ³ç´¯çš„ä¸€å¤©**ã€ã€‚\n\næ‰€è°“ã€Œè¡¨ç°è‰¯å¥½çš„æ—¶é—´æ®µã€ï¼Œæ„å‘³åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œã€ŒåŠ³ç´¯çš„å¤©æ•°ã€æ˜¯ä¸¥æ ¼ **å¤§äº**ã€Œä¸åŠ³ç´¯çš„å¤©æ•°ã€ã€‚\n\nè¯·ä½ è¿”å›ã€Œè¡¨ç°è‰¯å¥½æ—¶é—´æ®µã€çš„æœ€å¤§é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šhours = [9,9,6,0,6,6,9]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šæœ€é•¿çš„è¡¨ç°è‰¯å¥½æ—¶é—´æ®µæ˜¯ [9,9,6]ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= hours.length <= 10000`\n- `0 <= hours[i] <= 16`\n\n**è§£æ³•ä¸€**\n\næƒ­æ„§ï¼Œè¿™é¢˜è¿˜æ˜¯çœ‹çš„é¢˜è§£ï¼Œè¿™é¢˜è¿˜æ˜¯æŒºå·§å¦™çš„ï¼Œæˆ‘ä»¬æŠŠå¤§äº8å°æ—¶çš„æ—¶é—´æ®µçœ‹ä½œ`+1`ï¼Œå°äº8å°æ—¶çš„çœ‹ä½œ`-1`ï¼Œè¿™æ ·é—®é¢˜å°±è½¬æ¢æˆäº†æ±‚**åŒºé—´å’Œå¤§äº0çš„æœ€é•¿é•¿åº¦**ï¼Œè€ŒåŒºé—´å’Œæˆ‘ä»¬åˆå¯ä»¥è”æƒ³åˆ°ç”¨å‰ç¼€å’Œï¼Œè¿™æ ·æˆ‘ä»¬å°†é¢˜ç›®çš„ä¾‹å­è½¬æ¢ä¸€ä¸‹å°±å˜æˆäº†\n\n```java\nhours:    9 9  6  0  6  6  9\nhours:  0 1 1 -1 -1 -1 -1  1\n  pre:  0 1 2  1  0 -1 -2 -1\n```\n\nåªè¦`pre`ä¸­ä¸¤ç‚¹çš„å‰ç¼€`pre[j]-pre[i]>0`å°±è¯´æ˜åŒºé—´`[i+1ï¼Œj]`æ˜¯æ»¡è¶³æ¡ä»¶çš„ï¼Œæˆ‘ä»¬è¦æ±‚çš„å°±æ˜¯æ»¡è¶³æ¡ä»¶çš„æœ€é•¿å®½åº¦ï¼Œè¿™æ ·ä¸€æ¥é—®é¢˜å…¶å®å°±è½¬æ¢æˆäº†å’Œä¸Šé¢[962.æœ€å¤§å®½åº¦å¡](#962-æœ€å¤§å®½åº¦å¡)ä¸€æ ·äº†ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ±‚è§£å°±okäº†\n\n```java\npublic int longestWPI(int[] hours) {\n    int[] pre=new int[hours.length+1];\n    for(int i=1;i<=hours.length;i++){\n        pre[i]=pre[i-1]+(hours[i-1]>8?1:-1);\n    }\n    Deque<Integer> stack=new ArrayDeque<>();\n    for(int i=0;i<pre.length;i++){\n        if(stack.isEmpty() || pre[i]<pre[stack.peek()]){\n            stack.push(i);\n        }\n    }\n    int res=0;\n    for(int i=pre.length-1;i>=0;i--){\n        while(!stack.isEmpty() && pre[i]-pre[stack.peek()]>0){\n            res=Math.max(res,i-stack.pop()); //ä¸ç”¨+1\n        }\n    }\n    return res;\n}\n```\n\n## [907. å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ](https://leetcode-cn.com/problems/sum-of-subarray-minimums/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `A`ï¼Œæ‰¾åˆ° `min(B)` çš„æ€»å’Œï¼Œå…¶ä¸­ `B` çš„èŒƒå›´ä¸º `A` çš„æ¯ä¸ªï¼ˆè¿ç»­ï¼‰å­æ•°ç»„ã€‚\n\nç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œå› æ­¤**è¿”å›ç­”æ¡ˆæ¨¡ 10^9 + 7**ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š[3,1,2,4]\nè¾“å‡ºï¼š17\nè§£é‡Šï¼š\nå­æ•°ç»„ä¸º [3]ï¼Œ[1]ï¼Œ[2]ï¼Œ[4]ï¼Œ[3,1]ï¼Œ[1,2]ï¼Œ[2,4]ï¼Œ[3,1,2]ï¼Œ[1,2,4]ï¼Œ[3,1,2,4]ã€‚ \næœ€å°å€¼ä¸º 3ï¼Œ1ï¼Œ2ï¼Œ4ï¼Œ1ï¼Œ1ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œå’Œä¸º 17ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= A <= 30000`\n2. `1 <= A[i] <= 30000`\n\n**è§£æ³•ä¸€**\n\nè™½ç„¶èŠ±äº†æŒºé•¿æ—¶é—´å¥½æ­¹è¿˜æ˜¯è‡ªå·±åšå‡ºæ¥äº†ï¼Œå¼€å¿ƒğŸ˜\n\n```java\npublic int sumSubarrayMins(int[] A) {\n    Deque<Integer> stack=new ArrayDeque<>();\n    int N=A.length;\n    int mod=(int)1e9+7;\n    int res=0;\n    int[] temp=new int[N+1];\n    System.arraycopy(A,0,temp,0,N);\n    //æœ«å°¾åŠ 0ä½¿æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥å‡ºæ ˆ\n    temp[N]=0;A=temp; \n    for(int i=0;i<N+1;i++){\n        while(!stack.isEmpty() && A[stack.peek()]>A[i]){\n            int cur=stack.pop();\n            int left=stack.isEmpty()?-1:stack.peek();\n            //å³è¾¹å¤§äºcurçš„ä¸ªæ•°(iä¹‹å‰)ï¼š i-cur-1      \n            //å·¦è¾¹å¤§äºcurçš„ä¸ªæ•°(leftä¹‹å)ï¼š cur-(left+1) \n            //res=(res+A[cur]*((i-cur-1)*(cur-left-1)+i-1-left))%mod;\n            //(a+1)*(b+1)=ab+a+b+1\n            res=(res+A[cur]*(i-cur)*(cur-left))%mod;\n        }\n        stack.push(i);\n    }\n    return res;\n}\n```\n\næ ¸å¿ƒæ€æƒ³å°±æ˜¯ç»´æŠ¤å•è°ƒé€’å¢æ ˆï¼Œåœ¨æ¯ä¸ªå…ƒç´ å‡ºæ ˆçš„æ—¶å€™è€ƒè™‘å¦‚ä½•è®¡ç®—**ä»¥è¯¥å…ƒç´ ä¸ºåŒºé—´æœ€å°å€¼**çš„åŒºé—´ä¸ªæ•°\n\n æ¯”å¦‚`[9,8,7,6,1,5,3,4,2]`è¿™ä¸ªåŒºé—´ï¼Œæˆ‘ä»¬è¦æ±‚ä»¥`1`ä¸ºåŒºé—´æœ€å°å€¼çš„åŒºé—´ä¸ªæ•°ã€‚\n\næˆ‘ä»¬åˆ†å¼€æ¥æ±‚ï¼Œå…ˆæ±‚å·¦å³ä¸¤è¾¹çš„ï¼Œå¾ˆæ˜æ˜¾ä»…åŒ…å«`1`å·¦è¾¹æˆ–å³è¾¹å…ƒç´ çš„å­åŒºé—´ä¸ªæ•°æ˜¯4+4=8ä¸ªï¼Œä¹Ÿå°±æ˜¯[6,1] , [7,6,1] ...å’Œ[1,5], [1,5,3]....è¿™äº›åŒºé—´\n\nç„¶åå†çœ‹åŒæ—¶åŒ…å«`1`å·¦å³ä¸¤è¾¹çš„å…ƒç´ çš„å­åŒºé—´ï¼Œä¸€è¾¹é€‰ä¸€ä¸ªåŒºé—´å’Œå¦ä¸€è¾¹éƒ½ä¼šæœ‰4ç§ç»„åˆï¼Œæ‰€ä»¥å°±æ˜¯4*4=16ç§\n\næœ€åå†åŠ ä¸Š`1`æœ¬èº«å°±è¡Œäº†ï¼Œæ‰€ä»¥ä»¥`1`ä¸ºåŒºé—´æœ€å°å€¼çš„åŒºé—´ä¸ªæ•°å°±æ˜¯8+16+1=25\n\n> åœ¨çœ‹äº†å¤§ä½¬çš„åšæ³•åå‘ç°ä¸Šé¢çš„æ˜¯å¯ä»¥åŒ–ç®€çš„ï¼š`a*b+a+b+1=(a+1)*(b+1)`\n\n\n## [5454. ç»Ÿè®¡å…¨ 1 å­çŸ©å½¢](https://leetcode-cn.com/problems/count-submatrices-with-all-ones/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªåªåŒ…å« 0 å’Œ 1 çš„Â `rows * columns`Â çŸ©é˜µÂ `mat`Â ï¼Œè¯·ä½ è¿”å›æœ‰å¤šå°‘ä¸ªÂ **å­çŸ©å½¢**Â çš„å…ƒç´ å…¨éƒ¨éƒ½æ˜¯ 1 ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```\nè¾“å…¥ï¼šmat = [[1,0,1],\nÂ            [1,1,0],\nÂ            [1,1,0]]\nè¾“å‡ºï¼š13\nè§£é‡Šï¼š\næœ‰ 6Â ä¸ª 1x1 çš„çŸ©å½¢ã€‚\næœ‰ 2 ä¸ª 1x2 çš„çŸ©å½¢ã€‚\næœ‰ 3 ä¸ª 2x1 çš„çŸ©å½¢ã€‚\næœ‰ 1 ä¸ª 2x2 çš„çŸ©å½¢ã€‚\næœ‰ 1 ä¸ª 3x1 çš„çŸ©å½¢ã€‚\nçŸ©å½¢æ•°ç›®æ€»å…± = 6 + 2 + 3 + 1 + 1 = 13Â ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```\nè¾“å…¥ï¼šmat = [[0,1,1,0],\nÂ            [0,1,1,1],\nÂ            [1,1,1,0]]\nè¾“å‡ºï¼š24\nè§£é‡Šï¼š\næœ‰ 8 ä¸ª 1x1 çš„å­çŸ©å½¢ã€‚\næœ‰ 5 ä¸ª 1x2 çš„å­çŸ©å½¢ã€‚\næœ‰ 2 ä¸ª 1x3 çš„å­çŸ©å½¢ã€‚\næœ‰ 4 ä¸ª 2x1 çš„å­çŸ©å½¢ã€‚\næœ‰ 2 ä¸ª 2x2 çš„å­çŸ©å½¢ã€‚\næœ‰ 2 ä¸ª 3x1 çš„å­çŸ©å½¢ã€‚\næœ‰ 1 ä¸ª 3x2 çš„å­çŸ©å½¢ã€‚\nçŸ©å½¢æ•°ç›®æ€»å…± = 8 + 5 + 2 + 4 + 2 + 2 + 1 = 24 ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šmat = [[1,1,1,1,1,1]]\nè¾“å‡ºï¼š21\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šmat = [[1,0,1],[0,1,0],[1,0,1]]\nè¾“å‡ºï¼š5\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= rowsÂ <= 150`\n*   `1 <= columnsÂ <= 150`\n*   `0 <= mat[i][j] <= 1`\n\n**è§£æ³•ä¸€**\n\n196å‘¨èµ›T3ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºéš¾çš„ï¼Œä¸è¿‡æ•°æ®é‡æ¯”è¾ƒå°ï¼Œåªæœ‰150ï¼Œæ‰€ä»¥æš´åŠ›å…¶å®å°±å¯ä»¥\n\n```java\n//è§£æ³•ä¸€: N3\npublic int numSubmat(int[][] mat) {\n    int m = mat.length;\n    int n = mat[0].length;\n    //é¢„å¤„ç†mat[i][j]ä¸Šè¾¹æœ‰å¤šå°‘ä¸ªè¿ç»­çš„1\n    int[][] upCnt= new int[m][n];\n    for (int i = 0; i < m; i++) {\n        for (int j = 0; j < n; j++) {\n            if(mat[i][j] == 1){\n                upCnt[i][j] = i==0 ? mat[i][j]&1 : upCnt[i-1][j]+1;\n            }\n        }\n    }\n    int res = 0;\n    for (int i = 0; i < m; i++) {\n        for (int j = 0; j < n; j++) {\n            if(mat[i][j] == 1){\n                int k = j;\n                int rowCnt = upCnt[i][j];\n                while(k>=0){\n                    rowCnt = Math.min(rowCnt, upCnt[i][k]);\n                    res += rowCnt;\n                    k--;\n                }\n            }\n        }\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\nå•è°ƒæ ˆï¼Œå‚è€ƒäº†ç½‘ä¸Šçš„é¢˜è§£ï¼Œè™½ç„¶è‡ªå·±ææ‡‚äº†ï¼Œä½†æ˜¯æƒ³å†™é¢˜è§£çš„æ—¶å€™æ„Ÿè§‰æœ‰ç‚¹ä¸å¥½æè¿°å•Šï¼Œè¦å†™å¥½å¤šä¸œè¥¿ï¼Œæœ‰ç‚¹æŠ½è±¡ï¼Œä½†æ˜¯æ€è·¯è¿˜æ˜¯éå¸¸å¥½çš„ï¼Œä¹Ÿæ˜¯ä¸ªå¾ˆç»å…¸çš„é¢˜äº†\n```java\npublic int numSubmat(int[][] mat) {\n    int m = mat.length;\n    int n = mat[0].length;\n    //é¢„å¤„ç†mat[i][j]ä¸Šè¾¹æœ‰å¤šå°‘ä¸ªè¿ç»­çš„1\n    int[][] upCnt= new int[m][n];\n    for (int i = 0; i < m; i++) {\n        for (int j = 0; j < n; j++) {\n            if(mat[i][j] == 1){\n                upCnt[i][j] = i==0 ? mat[i][j]&1 : upCnt[i-1][j]+1;\n            }\n        }\n    }\n    //å•è°ƒé€’å¢æ ˆç»´æŠ¤åˆ—çš„é•¿åº¦\n    Deque<Integer> stack = new ArrayDeque<>();\n    int res = 0;\n    for (int i = 0; i < m; i++) {\n        stack.clear();\n        int ijCnt = 0; //ä»¥i,jä¸ºå³ä¸‹è§’çš„çŸ©å½¢çš„cnt\n        for (int j = 0; j < n; j++) {\n            ijCnt += upCnt[i][j];\n            while(!stack.isEmpty() && upCnt[i][stack.peek()] > upCnt[i][j]){\n                int cur = stack.pop();\n                //æ ˆä¸­çš„ç´¢å¼•æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¦‚æœæ ˆä¸ºç©ºï¼Œleftåº”è¯¥ä¸º-1\n                int left = stack.isEmpty() ? -1 : stack.peek();\n                //å‡å»å¤šçš„éƒ¨åˆ†\n                ijCnt -= (cur-left) * (upCnt[i][cur] - upCnt[i][j]);\n            }\n            stack.push(j);\n            res += ijCnt;\n        }\n    }\n    return res;\n}\n```\nä¸ºäº†æ–¹ä¾¿å›é¡¾ï¼Œç®€å•çš„ç”»äº†ä¸ªå›¾\n![mark](http://static.imlgw.top/blog/20200705/BDIQmVW7vEuT.png?imageslim)\n> è¿™é¢˜å¥½åƒæ˜¯ä¸ªå¾ˆç»å…¸çš„é¢˜ï¼Œæˆ‘åœ¨ç½‘ä¸Šæœç´¢çš„çš„æ—¶å€™å‘ç°å’Œ[ICPCçš„ä¸€é“é¢˜](https://blog.csdn.net/qq_40774175/article/details/82354072)ä¸€æ ·\n\n**è§£æ³•ä¸‰**\n\nåœ¨åˆ·äº†å‡ éè¯„è®ºåŒºï¼Œçœ‹è§äº†å¤§ä½¬ä»¬å†™çš„æ¯”è¾ƒå¥½è§£æ³•ï¼Œå‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£çš„å•è°ƒæ ˆçš„æ€è·¯\n\nï¼ˆ1ï¼‰ç¬¬ä¸€æ­¥é¢„å¤„ç†å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‘ä¸Šå»¶ç”³çš„æœ€å¤§å€¼\nï¼ˆ2ï¼‰ç„¶åæˆ‘ä»¬åŒæ ·ä½¿ç”¨å•è°ƒé€’å¢æ ˆç»´æŠ¤è¿™ä¸ªé«˜åº¦ï¼Œä½†æ˜¯åŒæ—¶æˆ‘ä»¬é¢å¤–çš„ç»´æŠ¤å¦ä¸€ä¸ªå€¼ï¼š**ä»¥å½“å‰`mat[i][j]`ä¸ºå³ä¸‹è§’æ‰€å½¢æˆçš„çŸ©å½¢ä¸ªæ•°ä¹Ÿå­˜å…¥å•è°ƒæ ˆ** ï¼Œç„¶åæˆ‘ä»¬åœ¨æ¯ä¸ªå…ƒç´ è¿›æ ˆçš„æ—¶å€™ç»Ÿè®¡ä¸ªæ•°ï¼Œç»Ÿè®¡ä¸€å…±åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š\n\n![mark](http://static.imlgw.top/blog/20200828/x8M127uqudmS.png?imageslim)\nï¼ˆ2020.8.28æ›´æ–°äº†ä¸€ä¸‹ï¼Œä¹‹å‰çš„å›¾æœ‰ç‚¹æŠ½è±¡ï¼‰\n\n```java\npublic int numSubmat(int[][] mat) {\n    int m = mat.length;\n    int n = mat[0].length;\n    //é¢„å¤„ç†mat[i][j]ä¸Šè¾¹æœ‰å¤šå°‘ä¸ªè¿ç»­çš„1\n    int[][] upCnt= new int[m][n];\n    for (int i = 0; i < m; i++) {\n        for (int j = 0; j < n; j++) {\n            if(mat[i][j] == 1){\n                upCnt[i][j] = i==0 ? mat[i][j]&1 : upCnt[i-1][j]+1;\n            }\n        }\n    }\n    //å•è°ƒé€’å¢æ ˆç»´æŠ¤åˆ—çš„é•¿åº¦\n    Deque<int[]> stack = new ArrayDeque<>();\n    int res = 0;\n    for(int i = 0;i < m; i++){\n        stack.clear();\n        for (int j = 0; j < n; j++) {\n            while(!stack.isEmpty() && upCnt[i][stack.peek()[0]] > upCnt[i][j]){\n                stack.pop();\n            }\n            int[] pair = stack.isEmpty() ? new int[]{-1,0} : stack.peek();\n            //ä»¥å½“å‰æ ˆé¡¶å…ƒç´ mat[i][pair[0]]ä¸ºå³ä¸‹è§’èƒ½å½¢æˆçŸ©å½¢ä¸ªæ•°\n            int cur = (j-pair[0]) * upCnt[i][j] + pair[1];\n            res += cur;\n            //å°†mat[i][j]çš„ç´¢å¼•jå’Œä»¥å…¶ä¸ºå³ä¸‹è§’å½¢æˆçš„çŸ©é˜µä¸ªæ•°curä¹Ÿå­˜å…¥å•è°ƒæ ˆ\n            stack.push(new int[]{j, cur});\n        }\n    }\n    return res;\n}\n```\nè¿™ä¸ªæ€è·¯æ¯”ä¸Šé¢è¦å®¹æ˜“ç†è§£å¤šäº†\n\n## [é¢è¯•é¢˜ 03.05. æ ˆæ’åº](https://leetcode-cn.com/problems/sort-of-stacks-lcci/)\n\nDifficulty: **ä¸­ç­‰**\n\næ ˆæ’åºã€‚ ç¼–å†™ç¨‹åºï¼Œå¯¹æ ˆè¿›è¡Œæ’åºä½¿æœ€å°å…ƒç´ ä½äºæ ˆé¡¶ã€‚æœ€å¤šåªèƒ½ä½¿ç”¨ä¸€ä¸ªå…¶ä»–çš„ä¸´æ—¶æ ˆå­˜æ”¾æ•°æ®ï¼Œä½†ä¸å¾—å°†å…ƒç´ å¤åˆ¶åˆ°åˆ«çš„æ•°æ®ç»“æ„ï¼ˆå¦‚æ•°ç»„ï¼‰ä¸­ã€‚è¯¥æ ˆæ”¯æŒå¦‚ä¸‹æ“ä½œï¼š`push`ã€`pop`ã€`peek` å’Œ `isEmpty`ã€‚å½“æ ˆä¸ºç©ºæ—¶ï¼Œ`peek`Â è¿”å› -1ã€‚\n\n**ç¤ºä¾‹1:**\n\n```go\n è¾“å…¥ï¼š\n[\"SortedStack\", \"push\", \"push\", \"peek\", \"pop\", \"peek\"]\n[[], [1], [2], [], [], []]\n è¾“å‡ºï¼š\n[null,null,null,1,null,2]\n```\n\n**ç¤ºä¾‹2:**\n\n```go\n è¾“å…¥ï¼š \n[\"SortedStack\", \"pop\", \"pop\", \"push\", \"pop\", \"isEmpty\"]\n[[], [], [], [1], [], []]\n è¾“å‡ºï¼š\n[null,null,null,null,null,true]\n```\n\n**è¯´æ˜:**\n\n1.  æ ˆä¸­çš„å…ƒç´ æ•°ç›®åœ¨[0, 5000]èŒƒå›´å†…ã€‚\n\n\n**è§£æ³•ä¸€**\n\nä¹‹å‰åœ¨ä¹¦ä¸Šçœ‹åˆ°è¿‡è¿™ä¸€é¢˜ï¼Œä½†æ˜¯æ—¶é—´ä¹…äº†å¿˜äº†å’‹åšäº†ï¼Œåªè®°å¾—æ˜¯å•è°ƒæ ˆï¼Œæ€è€ƒäº†ä¸‹è¿˜æ˜¯å†™å‡ºæ¥äº†\n\nå•è°ƒæ ˆï¼Œä¸»æ ˆå•è°ƒé€’å‡ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰ï¼Œå½“é‡åˆ°å¤§äºæ ˆé¡¶çš„å…ƒç´ å°±å¼¹æ ˆï¼Œå¹¶å°†å¼¹å‡ºçš„å…ƒç´ ç”¨è¾…åŠ©æ ˆæ¥æ”¶ï¼Œå®Œäº‹äº†å†å°†å…ƒç´ pushè¿›å»ï¼Œæœ€åå°†è¾…åŠ©æ ˆä¸­çš„å…ƒç´ å†å€’å›å»å°±okäº†ï¼Œæ—¶é—´å¤æ‚åº¦N^2\n```java\nclass SortedStack {\n Â  Â \n Â  Â Deque<Integer> stack = null;\n Â  Â \n Â  Â Deque<Integer> help = null;\n Â  Â //å•è°ƒæ ˆæ’åº\n Â  Â //4 3 2 1 3 4 2\n Â  Â public SortedStack() {\n Â  Â  Â  Â stack = new ArrayDeque<>();\n Â  Â  Â  Â help = new ArrayDeque<>();\n Â   }\n Â  Â \n Â  Â public void push(int val) {\n Â  Â  Â  Â //ä¸€å¼€å§‹å†™æˆpopäº†æ‰¾åŠå¤©çš„é”™\n Â  Â  Â  Â while(!stack.isEmpty() && stack.peek() < val) {\n Â  Â  Â  Â  Â  Â help.push(stack.pop());\n Â  Â  Â   }\n Â  Â  Â  Â stack.push(val);\n Â  Â  Â  Â //å†è£…å›å»\n Â  Â  Â  Â while(!help.isEmpty()) {\n Â  Â  Â  Â  Â  Â stack.push(help.pop());\n Â  Â  Â   }\n Â   }\n Â  Â \n Â  Â public void pop() {\n Â  Â  Â  Â if (!stack.isEmpty()) {\n Â  Â  Â  Â  Â  Â stack.pop();\n Â  Â  Â   }\n Â   }\n Â  Â \n Â  Â public int peek() {\n Â  Â  Â  Â if (stack.isEmpty()) {\n Â  Â  Â  Â  Â  Â return -1;\n Â  Â  Â   }\n Â  Â  Â  Â return stack.peek();\n Â   }\n Â  Â \n Â  Â public boolean isEmpty() {\n Â  Â  Â  Â return stack.isEmpty();\n Â   }\n}\n```\n## [NC580. æŠ¢æ‰“å‡ºå¤´é¸Ÿ](https://www.nowcoder.com/practice/1504075c856248748ca444c8c093d638)\nç°åœ¨æœ‰nä¸ªäººç«™æˆä¸€åˆ—ï¼Œç¬¬iä¸ªäººçš„èº«é«˜ä¸º`a[i]`ä»–ä»¬äººæ‰‹ä¸€æŠŠç©å…·æªï¼Œå¹¶ä¸”ä»–ä»¬å–œæ¬¢æŠŠæªä¸¾åœ¨å¤´é¡¶ä¸Šã€‚\næ¯ä¸€æ¬¡ç»ƒä¹ å°„å‡»ï¼Œä»–ä»¬éƒ½ä¼šæœæ­£å‰æ–¹å‘å°„ä¸€å‘æ°´å¼¹ã€‚\nè¿™ä¸ªæ—¶å€™ï¼Œç¬¬iä¸ªäººå°„å‡»çš„æ°´å¼¹ï¼Œå°±ä¼šå‡»ä¸­åœ¨ä»–å‰é¢ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„äººã€‚\nç‰›ç‰›è®¤ä¸ºè¿™æ ·çš„ç»ƒä¹ ååˆ†çš„è’å”ï¼Œå®Œå…¨å°±æ˜¯å¯¹é•¿å¾—é«˜çš„äººçš„ä¼¤å®³ã€‚\näºæ˜¯å®ƒå®šä¹‰äº†ä¸€ä¸ªè’å”åº¦ï¼Œåˆå§‹ä¸º0ã€‚\nå¯¹äºç¬¬iä¸ªäººï¼Œå¦‚ä¸­ä»–å‡»ä¸­äº†ç¬¬jä¸ªäººï¼Œåˆ™è’å”åº¦åŠ jï¼Œå¦‚æœæ²¡æœ‰å‡»ä¸­ä»»ä½•äººï¼Œåˆ™è’å”åº¦åŠ 0.\nç‰›ç‰›æƒ³é—®ä½ ï¼Œä½ èƒ½è®¡ç®—å‡ºè’å”åº¦æ˜¯å¤šå°‘å—ï¼Ÿ\n\n**è¾“å…¥**\n\nä¸€ä¸ªæ•´æ•°nï¼ˆ1 â‰¤ n â‰¤ 10^7ï¼‰ï¼Œä¸€ä¸ªæ•°ç»„a (1 â‰¤ a[i] â‰¤ 10^7)\naä¸‹æ ‡ä»0å¼€å§‹ï¼Œ`a[i]` ä»£è¡¨ç¬¬iä¸ªäººèº«é«˜\n\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥: 5,[1,2,3,4,5]\nè¾“å‡º: 0\nè¯´æ˜: æ²¡æœ‰ä¸€ä¸ªäººå‡»ä¸­ä»»ä½•ä¸€ä¸ªäºº\n```\n**ç¤ºä¾‹2**\n```go\nè¾“å…¥: 5,[5,4,3,2,1]\nè¾“å‡º: 10\nè¯´æ˜: ç¬¬äºŒä¸ªäººå‡»ä¸­ç¬¬ä¸€ä¸ªäººï¼Œç¬¬ä¸‰ä¸ªäººå‡»ä¸­ç¬¬äºŒä¸ªäººï¼Œç¬¬å››ä¸ªäººå‡»ä¸­ç¬¬ä¸‰ä¸ªäººï¼Œç¬¬äº”ä¸ªäººå‡»ä¸­ç¬¬å››ä¸ªäººï¼› 1+2+3+4=10\n```\n\n**è§£æ³•ä¸€**\n\nå¾ˆç›´ç™½çš„å•è°ƒæ ˆï¼Œä½†æ˜¯ä¸€å¼€å§‹è¢«é¢˜ç›®çš„caseè¯¯å¯¼äº†ä¸‹ï¼Œæäº†ä¸€ä¸ªå•è°ƒé€’å¢æ ˆï¼Œè¿™é‡Œå¾ˆå¾ˆæ˜æ˜¾åº”è¯¥æ˜¯é€’å‡æ ˆï¼Œé€’å¢æ ˆä¼šæŠŠåŸæœ¬å¤§çš„å€¼ç»™popå‡ºå»\n```java\n//5 4 3 4 1\n//ä¸€å¼€å§‹è¢«ä¾‹å­ç»™è¯¯å¯¼äº†ï¼Œæäº†ä¸€æ‰‹å•è°ƒé€’å¢æ ˆ....\npublic long solve (int n, int[] a) {\n    Deque<Integer> stack = new ArrayDeque<>();\n    long res = 0l;\n    for (int i = 0; i < n; i++) {\n        while (!stack.isEmpty() && a[stack.peek()] <= a[i]) {\n            stack.pop();\n        }\n        if (!stack.isEmpty()) {\n            res += stack.peek()+1;\n        }\n        stack.push(i);\n    }\n    return res;\n}\n```","tags":["LeetCode"],"categories":["ç®—æ³•"]},{"title":"Golangè¸©å‘ï¼šexecå–æ¶ˆåä¸é€€å‡º","url":"/2020/08/25/golang-cai-keng-exec-qu-xiao-bu-tui-chu/","content":"\n## èƒŒæ™¯\nåœ¨åš[Scheduleré¡¹ç›®](https://github.com/imlgw/scheduler)çš„è¿‡ç¨‹ä¸­åˆ©ç”¨os/execåŒ…æ‰§è¡Œä¸€äº›shellè„šæœ¬ï¼Œè°ƒè¯•è¿‡ç¨‹ä¸­å‘ç°æˆ‘å–æ¶ˆäº†contextågoè¿›ç¨‹ä»ç„¶é˜»å¡ä¸é€€å‡º\n## åˆ†æ\n> go version go1.13.6 linux/amd64\n\nåœ¨å®ç°killå¼ºæ€åŠŸèƒ½æ—¶å€™å‘ç°çš„é—®é¢˜ï¼Œæ— æ³•æ€æ­»ä»»åŠ¡ï¼Œå³ä½¿killäº†è¿˜æ˜¯ä¼šç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šè¿”å›ï¼Œåœ¨æŸ¥èµ„æ–™çš„è¿‡ç¨‹ä¸­å‘ç°è¿™åº”è¯¥ä¹Ÿç®—æ˜¯golangæœ¬èº«çš„ä¸€ä¸ªå‘äº†ï¼Œå‚è€ƒ[issue23019](https://github.com/golang/go/issues/23019)\n\nä¸€å¼€å§‹æ˜¯åœ¨Windowså¹³å°ä¸Šè¿è¡Œæµ‹è¯•çš„ï¼Œä»¥ä¸ºæ˜¯å¹³å°çš„åŸå› ä½†æ˜¯åœ¨åˆ‡æ¢äº†Linuxåé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œå¦‚ä¸‹pocæ—¢å¯å¤ç°\n\n```golang\npackage main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc main() {\n    ctx, cancelFn := context.WithTimeout(context.Background(), time.Second*5)\n    defer cancelFn()\n    cmd := exec.CommandContext(ctx, \"/bin/bash\", \"-c\", \"sleep 120; echo hello\")\n    output, err := cmd.CombinedOutput()\n    fmt.Printf(\"outputï¼šã€%sã€‘err:ã€%sã€‘\", string(output), err)\n}\n```\nåœ¨linuxå¹³å°ä¸Šé€šè¿‡go runæ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œç„¶å`pstree -p`æŸ¥çœ‹è¿›ç¨‹æ ‘\n```golang\n//ç”±äºè¿›ç¨‹æ ‘æ¯”è¾ƒåºå¤§ï¼Œæ‰€ä»¥çœç•¥äº†ä¸€äº›æ— å…³çš„éƒ¨åˆ†\nsystemd(1)â”€â”¬â”€...\n           â”œâ”€sshd(17395)â”€â”¬â”€sshd(18450)â”€â”€â”€sftp-server(18453)\n           â”‚             â”œâ”€sshd(28684)â”€â”€â”€zsh(28687)â”€â”€â”€go(2661)â”€â”¬â”€demo3_cmdPit(2680)â”€â”¬â”€bash(2683)â”€â”€â”€sleep(2684)\n           â”‚             â”‚                                     â”‚                    â”œâ”€{demo3_cmdPit}(2681)\n           â”‚             â”‚                                     â”‚                    â”œâ”€{demo3_cmdPit}(2682)\n           â”‚             â”‚                                     â”‚                    â””â”€{demo3_cmdPit}(2686)\n           â”‚             â”‚                                     â”œâ”€{go}(2662)\n           â”‚             â”‚                                     â”œâ”€{go}(2663)\n           â”‚             â”‚                                     â”œâ”€{go}(2664)\n           â”‚             â”‚                                     â”œâ”€{go}(2665)\n           â”‚             â”‚                                     â”œâ”€{go}(2672)\n           â”‚             â”‚                                     â”œâ”€{go}(2679)\n           â”‚             â”‚                                     â””â”€{go}(2685)\n           â”‚             â””â”€sshd(29042)â”€â”€â”€zsh(29044)â”€â”€â”€pstree(2688)\n```\nå¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬çš„goè¿›ç¨‹`demo3_cmdPit(2680)`åˆ›å»ºäº†`bash(2683)`è¿›ç¨‹å»æ‰§è¡Œå…·ä½“çš„shellæŒ‡ä»¤ï¼Œä½†æ˜¯è¿™é‡Œç”±äºæˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤æ˜¯ã€`sleep 50; echo hello`ã€‘å±äºä¸€ç»„å¤šæ¡å‘½ä»¤ï¼Œæ‰€ä»¥è¿™é‡Œshellä¼šforkå‡ºå­è¿›ç¨‹å»æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œæ‰€ä»¥ä¸Šé¢æ˜¾ç¤º`sleep(2684)`æ˜¯`bash(2683)`çš„å­è¿›ç¨‹\n>è¡¥å……ï¼šé™¤äº†å¤šæ¡å‘½ä»¤ä¼šäº§ç”Ÿå­è¿›ç¨‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æƒ…å†µä¼šäº§ç”Ÿå­è¿›ç¨‹ï¼Œæ¯”å¦‚`&`åå°è¿è¡Œï¼Œ`pipe`ç®¡é“ï¼Œå¤–éƒ¨shellè„šæœ¬ç­‰ç­‰ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« [å­shellä»¥åŠä»€ä¹ˆæ—¶å€™è¿›å…¥å­shell](https://www.cnblogs.com/f-ck-need-u/p/7446194.html)\n\nç„¶åå†5såctxåˆ°æœŸcancelåæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹è¿›ç¨‹æ ‘\n```golang\nsystemd(1)â”€â”¬â”€...\n           â”œâ”€sleep(2684)\n           â”œâ”€sshd(17395)â”€â”¬â”€sshd(18450)â”€â”€â”€sftp-server(18453)\n           â”‚             â”œâ”€sshd(28684)â”€â”€â”€zsh(28687)â”€â”€â”€go(2661)â”€â”¬â”€demo3_cmdPit(2680)â”€â”¬â”€{demo3_cmdPit}(2681)\n           â”‚             â”‚                                     â”‚                    â”œâ”€{demo3_cmdPit}(2682)\n           â”‚             â”‚                                     â”‚                    â””â”€{demo3_cmdPit}(2686)\n           â”‚             â”‚                                     â”œâ”€{go}(2662)\n           â”‚             â”‚                                     â”œâ”€{go}(2663)\n           â”‚             â”‚                                     â”œâ”€{go}(2664)\n           â”‚             â”‚                                     â”œâ”€{go}(2665)\n           â”‚             â”‚                                     â”œâ”€{go}(2672)\n           â”‚             â”‚                                     â”œâ”€{go}(2679)\n           â”‚             â”‚                                     â””â”€{go}(2685)\n           â”‚             â””â”€sshd(29042)â”€â”€â”€zsh(29044)â”€â”€â”€pstree(2708)\n```\nå¯ä»¥çœ‹åˆ°`bash(2683)`è¿›ç¨‹ç¡®å®è¢«killäº†ï¼Œä½†æ˜¯å®ƒçš„å­è¿›ç¨‹ç¡®å¹¶æ²¡æœ‰ç»“æŸï¼Œè€Œæ˜¯å˜æˆäº†**å­¤å„¿è¿›ç¨‹**ï¼Œè¢«`init 1(systemd)`æ”¶å…»ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°è¿™æ—¶è¿›ç¨‹`demo3_cmdPit(2680)`è¿˜æ²¡æœ‰é€€å‡ºï¼Œç¬¦åˆä¹‹å‰çš„é¢„æµ‹ï¼Œè¿™é‡Œè¯¥è¿›ç¨‹ä»ç„¶è¿˜æœ‰3æ¡çº¿ç¨‹ï¼ˆåç¨‹ï¼‰æ²¡æœ‰é€€å‡ºï¼Œç›´åˆ°sleepå‘½ä»¤æ‰§è¡Œå®Œæ‰ä¼šè¿”å›ï¼Œè¿™é‡Œé€šè¿‡pstackæ˜¯æ— æ³•æŸ¥çœ‹è¿™å‡ æ¡çº¿ç¨‹çš„å †æ ˆçš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå¹¶ä¸è®¤è¯†åç¨‹ï¼Œè€Œä¸”Gä¼šåœ¨Pä¸Šåˆ‡æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶ä¹Ÿä¸çŸ¥é“è¿™å‡ æ¡çº¿ç¨‹åœ¨å¹²å˜›\n\n>å­¤å„¿è¿›ç¨‹ï¼šçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚\n>\n>åƒµå°¸è¿›ç¨‹ï¼šçˆ¶è¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨`wait`æˆ–`waitpid`è·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµæ­»è¿›ç¨‹ã€‚\n\nå½“sleepæ‰§è¡Œå®Œæˆåï¼Œç¨‹åºä¼šæ­£å¸¸è¿”å›å¦‚ä¸‹ä¿¡æ¯\n```go\noutputï¼šã€ã€‘err:ã€signal: killedã€‘#\n```\nå› ä¸ºæ˜¯åœ¨Linuxç¯å¢ƒä¸‹æ²¡æœ‰IDEè€Œä¸”ä¸å¤ªç†Ÿæ‚‰`gdb`æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç”¨`pprof`æŸ¥çœ‹äº†ä¸€ä¸‹å †æ ˆ\n```golang\nimport (\n    \"context\"\n    \"fmt\"\n    \"net/http\"\n    _ \"net/http/pprof\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc main() {\n    go func() {\n        err := http.ListenAndServe(\":6060\", nil)\n        if err != nil {\n            fmt.Printf(\"failed to start pprof monitor:%s\", err)\n        }\n    }()\n    ctx, cancelFn := context.WithTimeout(context.Background(), time.Second*5)\n    defer cancelFn()\n    cmd := exec.CommandContext(ctx, \"/bin/bash\", \"-c\", \"sleep 50; echo hello\")\n    output, err := cmd.CombinedOutput()\n    fmt.Printf(\"outputï¼šã€%sã€‘err:ã€%sã€‘\", string(output), err)\n}\n```\n> åé¢äº†è§£åˆ°å…¶å®ç›´æ¥å‘é€`SIGQUIT`ä¿¡å·ä¹Ÿå¯ä»¥çœ‹åˆ°å †æ ˆï¼Œå¦‚ `kill -SIGQUIT <pid>`ï¼Œgoçš„å·¥å…·é“¾è¿˜æ˜¯éå¸¸å®Œå–„çš„ï¼Œé™¤äº†è¿™äº›è¿˜æœ‰å¾ˆå¤šæ–¹æ³•çœ‹å †æ ˆ\n\n\n```go\ncurl http://127.0.0.1:6060/debug/pprof/goroutine\\?debug\\=2\n...\ngoroutine 1 [chan receive]:\nos/exec.(*Cmd).Wait(0xc000098580, 0x0, 0x0)\n        /usr/lib/golang/src/os/exec/exec.go:509 +0x125\nos/exec.(*Cmd).Run(0xc000098580, 0xc00006d710, 0xc000098580)\n        /usr/lib/golang/src/os/exec/exec.go:341 +0x5c\nos/exec.(*Cmd).CombinedOutput(0xc000098580, 0x9, 0xc0000bff30, 0x2, 0x2, 0xc000098580)\n        /usr/lib/golang/src/os/exec/exec.go:561 +0x91\nmain.main()\n\t\t/usr/local/gotest/cmd/demo3_cmdPit/main.go:22 +0x176\n...\ngoroutine 9 [IO wait]:\ninternal/poll.runtime_pollWait(0x7fa96a0f5f08, 0x72, 0xffffffffffffffff)\n        /usr/lib/golang/src/runtime/netpoll.go:184 +0x55\ninternal/poll.(*pollDesc).wait(0xc000058678, 0x72, 0x201, 0x200, 0xffffffffffffffff)\n        /usr/lib/golang/src/internal/poll/fd_poll_runtime.go:87 +0x45\ninternal/poll.(*pollDesc).waitRead(...)\n        /usr/lib/golang/src/internal/poll/fd_poll_runtime.go:92\ninternal/poll.(*FD).Read(0xc000058660, 0xc0000e2000, 0x200, 0x200, 0x0, 0x0, 0x0)\n        /usr/lib/golang/src/internal/poll/fd_unix.go:169 +0x1cf\nos.(*File).read(...)\n        /usr/lib/golang/src/os/file_unix.go:259\nos.(*File).Read(0xc000010088, 0xc0000e2000, 0x200, 0x200, 0x7fa96a0f5ff8, 0x0, 0xc000039ea0)\n        /usr/lib/golang/src/os/file.go:116 +0x71\nbytes.(*Buffer).ReadFrom(0xc00006d710, 0x8b6120, 0xc000010088, 0x7fa96a0f5ff8, 0xc00006d710, 0x1)\n        /usr/lib/golang/src/bytes/buffer.go:204 +0xb4\nio.copyBuffer(0x8b5a20, 0xc00006d710, 0x8b6120, 0xc000010088, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n        /usr/lib/golang/src/io/io.go:388 +0x2ed\nio.Copy(...)\n        /usr/lib/golang/src/io/io.go:364\nos/exec.(*Cmd).writerDescriptor.func1(0x0, 0x0)\n        /usr/lib/golang/src/os/exec/exec.go:311 +0x63\nos/exec.(*Cmd).Start.func1(0xc000098580, 0xc00000e3a0)\n        /usr/lib/golang/src/os/exec/exec.go:435 +0x27\ncreated by os/exec.(*Cmd).Start\n        /usr/lib/golang/src/os/exec/exec.go:434 +0x608\n```\nè¿™é‡Œæˆ‘å¿½ç•¥äº†ä¸€äº›æ— å…³çš„åç¨‹ï¼Œç•™ä¸‹äº†è¿™ä¸¤æ¡çš„å †æ ˆä¿¡æ¯\n\né¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ç¬¬ä¸€æ¡çš„å †æ ˆä¿¡æ¯ï¼Œå¾ˆæ˜æ˜¾è¿™æ¡å°±æ˜¯æˆ‘ä»¬çš„ä¸»`goroutine`ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ­£å¤„äº`[chan receive]`çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯åœ¨ç­‰å¾…æŸä¸ªchanä¼ é€’ä¿¡æ¯ï¼Œæ ¹æ®å †æ ˆä¿¡æ¯å¯ä»¥çœ‹åˆ°é—®é¢˜å‡ºåœ¨\n\n `/usr/lib/golang/src/os/exec/exec.go:509`\n\næˆ‘ä»¬å»çœ‹ä¸€ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ\n\n![mark](http://static.imlgw.top/blog/20200821/l2wEHHBXyTTh.png?imageslim)\næœç„¶è¿™é‡Œåœ¨ç­‰å¾…`c.errch`ï¼Œé‚£ä¹ˆè¿™ä¸ªerrchæ˜¯è°è´Ÿè´£æ¨é€çš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬å†æ¥çœ‹çœ‹å¦ä¸€æ¡`goroutine`ï¼Œè¿™æ¡`goroutine`å¤„äº`ã€IO waitã€‘`çŠ¶æ€ï¼Œè¯´æ˜IOå‘ç”Ÿé˜»å¡äº†ï¼Œæˆ‘ä»¬ä»ä¸‹å¾€ä¸Šçœ‹å †æ ˆï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹æ˜¯åœ¨å“ªé‡Œå¯åŠ¨äº†è¿™ä¸ªåç¨‹\n```go\ncreated by os/exec.(*Cmd).Start\n        /usr/lib/golang/src/os/exec/exec.go:434 +0x608\n```\n![mark](http://static.imlgw.top/blog/20200822/sh8qmlcDeD64.png?imageslim)\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªåç¨‹çš„ä½œç”¨å°±æ˜¯å‘æˆ‘ä»¬ä¸Šé¢çš„ä¸»`goroutine`åœ¨ç­‰å¾…çš„`c.errch`æ¨é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™é‡Œ`fn()`ä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›å‘¢ï¼Ÿè¿™ä¸ªfnæ˜¯åœ¨å¹²å˜›ï¼Ÿç»§ç»­ç¿»ä¸€ç¿»æºç ï¼Œå‘ç°è¿™äº›å‡½æ•°`fn()`æ˜¯åœ¨cmd.Startçš„æ—¶å€™åˆ›å»ºçš„ï¼Œç”¨äºå¤„ç†shellçš„æ ‡å‡†è¾“å…¥ï¼Œè¾“å‡ºå’Œé”™è¯¯è¾“å‡ºï¼Œè€Œæˆ‘ä»¬çš„ç¨‹åºå°±æ˜¯å¡åœ¨äº†è¿™é‡Œï¼Œç»§ç»­è·Ÿè¿›ä¸Šé¢çš„å †æ ˆä¿¡æ¯\n```go\nos/exec.(*Cmd).writerDescriptor.func1(0x0, 0x0)\n        /usr/lib/golang/src/os/exec/exec.go:311 +0x63\n```\n![mark](http://static.imlgw.top/blog/20200826/Boqz6oWej6HA.png?imageslim)\nå¯ä»¥çœ‹åˆ°è¿™é‡Œå°±æ˜¯å…·ä½“åç¨‹æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªIOæ“ä½œï¼Œå¯æƒ³è€ŒçŸ¥ç¨‹åºå°±æ˜¯é˜»å¡åœ¨äº†è¿™é‡Œï¼Œå†å¾€ä¸‹åˆ†æå°±æ˜¯å†…éƒ¨epollçš„ä»£ç äº†ï¼Œå°±ä¸å¾€ä¸‹äº†ï¼Œæˆ‘ä»¬åˆ†æä¸‹è¿™æ®µä»£ç çš„æ„ä¹‰ï¼Œé¦–å…ˆåˆ›å»ºäº†ç®¡é“`Pipe`ï¼Œç„¶ååœ¨åç¨‹ä¸­å°†è¯»ç«¯`pr`çš„æ•°æ®copyåˆ°`w`ä¸­ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œå°±æ˜¯`goroutine`é€šè¿‡pipeè¯»å–å­è¿›ç¨‹çš„è¾“å‡ºï¼Œä½†æ˜¯ç”±äºæŸäº›åŸå› `Pipe`é˜»å¡äº†ï¼Œæ— æ³•ä»è¯»ç«¯è·å–æ•°æ®\n\næˆ‘ä»¬ç”¨`lsof -p`çœ‹ä¸€ä¸‹è¯¥è¿›ç¨‹æ‰“å¼€çš„èµ„æº\n```go\n$ lsof -p 27301\nCOMMAND   PID USER   FD      TYPE    DEVICE SIZE/OFF      NODE NAME\nmain    27301 root  cwd       DIR     253,1     4096   1323417 /usr/local/gotest/cmd/demo3_cmdPit\nmain    27301 root  rtd       DIR     253,1     4096         2 /\nmain    27301 root  txt       REG     253,1  7647232    401334 /tmp/go-build043247660/b001/exe/main\nmain    27301 root  mem       REG     253,1  2151672   1050229 /usr/lib64/libc-2.17.so\nmain    27301 root  mem       REG     253,1   141968   1050255 /usr/lib64/libpthread-2.17.so\nmain    27301 root  mem       REG     253,1   163400   1050214 /usr/lib64/ld-2.17.so\nmain    27301 root    0u      CHR     136,0      0t0         3 /dev/pts/0\nmain    27301 root    1u      CHR     136,0      0t0         3 /dev/pts/0\nmain    27301 root    2u      CHR     136,0      0t0         3 /dev/pts/0\nmain    27301 root    3u     IPv6 170355813      0t0       TCP *:6060 (LISTEN)\nmain    27301 root    4u  a_inode      0,10        0      5074 [eventpoll]\nmain    27301 root    5r     FIFO       0,9      0t0 170355794 pipe\n```\nå¯ä»¥çœ‹åˆ°ç¡®å®æ‰“å¼€äº†ä¸€ä¸ªinodeä¸º170355794çš„ç®¡é“ï¼Œç»“åˆå‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬çš„shellåœ¨æ‰§è¡Œçš„æ—¶å€™`fork()`åˆ›å»ºäº†å­è¿›ç¨‹ï¼Œä½†æ˜¯killçš„æ—¶å€™åªkilläº†shellè¿›ç¨‹ï¼Œè€Œåœ¨`fork()`çš„æ—¶å€™ä¼šåŒæ—¶å°†å½“å‰è¿›ç¨‹çš„`pipe`çš„`fd[2]`æè¿°ç¬¦ä¹Ÿå¤åˆ¶è¿‡å»ï¼Œè¿™å°±é€ æˆäº†`pipe`çš„å†™å…¥ç«¯`fd[1]`è¢«å­è¿›ç¨‹ç»§ç»­æŒæœ‰ï¼ˆæ–‡ä»¶è¡¨å¼•ç”¨è®¡æ•°ä¸ä¸º0ï¼‰ï¼Œè€Œ`goroutine`ä¹Ÿä¼šç»§ç»­ç­‰å¾…pipeå†™å…¥ç«¯å†™å…¥æˆ–è€…å…³é—­ï¼Œç›´åˆ°`sleep 50`æ‰§è¡Œå®Œåæ‰è¿”å›\n## åŸå› æ€»ç»“\n`golang`çš„`os/exec`åŒ…åœ¨å’Œshellåšäº¤äº’çš„æ—¶å€™ä¼šå’Œshellä¹‹é—´å»ºç«‹pipeï¼Œç”¨äºè¾“å…¥è¾“å‡ºï¼Œè·å–shellè¿”å›å€¼ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„shellä¼šforkå‡ºå­è¿›ç¨‹å»æ‰§è¡Œå‘½ä»¤ï¼Œæ¯”å¦‚å¤šæ¡è¯­å¥ï¼Œ&åå°æ‰§è¡Œï¼Œshè„šæœ¬ç­‰ï¼Œç„¶è€Œè¿™é‡Œctxè¿‡æœŸåï¼Œä»…ä»…killäº†shellè¿›ç¨‹ï¼Œå¹¶æ²¡æœ‰killå®ƒæ‰€åˆ›å»ºçš„å­è¿›ç¨‹ï¼Œè¿™å°±å¯¼è‡´äº†pipeçš„fdä»ç„¶è¢«å­è¿›ç¨‹æŒæœ‰æ— æ³•å…³é—­ï¼Œè€Œåœ¨`os/exec`çš„å®ç°ä¸­`goroutine`ä¼šä¸€ç›´ç­‰å¾…pipeå…³é—­åæ‰è¿”å›ï¼Œè¿›è€Œå¯¼è‡´äº†è¯¥é—®é¢˜çš„äº§ç”Ÿ\n## è§£å†³æ–¹æ¡ˆ\né—®é¢˜ææ¸…æ¥šäº†ï¼Œå°±å¥½è§£å†³äº†ã€‚åœ¨goçš„å®ç°ä¸­åªkilläº†shellè¿›ç¨‹ï¼Œå¹¶ä¸ä¼škillå­è¿›ç¨‹ï¼Œè¿›è€Œå¼•å‘äº†ä¸Šé¢çš„é—®é¢˜\n```golang\n// Kill causes the Process to exit immediately. Kill does not wait until\n// the Process has actually exited. This only kills the Process itself,\n// not any other processes it may have started.\nfunc (p *Process) Kill() error {\n\treturn p.kill()\n}\n```\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡kill`è¿›ç¨‹ç»„`çš„æ–¹å¼æ¥è§£å†³ï¼Œæ‰€è°“è¿›ç¨‹ç»„ä¹Ÿå°±æ˜¯çˆ¶è¿›ç¨‹å’Œå…¶åˆ›å»ºçš„å­è¿›ç¨‹çš„é›†åˆï¼Œ`PGID`å°±æ˜¯è¿›ç¨‹ç»„çš„IDï¼Œæ¯ä¸ªè¿›ç¨‹ç»„éƒ½æœ‰è¿›ç¨‹ç»„IDï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`ps -axjf`å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹\n```go\nPPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND\n17395 20937 20937 20937 ?           -1 Ss       0   0:00  \\_ sshd: root@pts/0\n20937 20939 20939 20939 pts/0    25879 Ss       0   0:00  |   \\_ -zsh\n20939 25879 25879 20939 pts/0    25879 Sl+      0   0:00  |       \\_ go run main.go\n25879 25902 25879 20939 pts/0    25879 Sl+      0   0:00  |           \\_ /tmp/go-build486839449/b001/exe/main\n25902 25906 25879 20939 pts/0    25879 S+       0   0:00  |               \\_ /bin/bash -c sleep 50; echo hello\n25906 25907 25879 20939 pts/0    25879 S+       0   0:00  |                   \\_ sleep 50\n```\nåœ¨çŸ¥é“`PGID`åå¯ä»¥æ ¹æ®è¿™ä¸ªIDç›´æ¥Killæ‰æ‰€æœ‰ç›¸å…³çš„è¿›ç¨‹ï¼Œä½†æ˜¯è¿™é‡Œæ³¨æ„çœ‹ä¸Šé¢ï¼Œæˆ‘ä»¬çš„`Shell`è¿›ç¨‹å’Œå®ƒçš„å­è¿›ç¨‹ï¼Œä»¥åŠæˆ‘ä»¬`goè¿›ç¨‹`éƒ½æ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹ç»„å†…çš„ï¼Œç›´æ¥killä¼šæŠŠæˆ‘ä»¬çš„goè¿›ç¨‹ä¹Ÿæ€æ­»ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦è®©`Shell`è¿›ç¨‹å’Œå®ƒçš„å­è¿›ç¨‹é¢å¤–å¼€è¾Ÿä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»„ï¼Œç„¶åå†kill\n\n> ä¸‹é¢çš„ä»£ç ä¸­ä½¿ç”¨åˆ°äº†ä¸€äº›`syscall`åŒ…çš„æ–¹æ³•ï¼Œè¿™ä¸ªåŒ…çš„å®ç°å¹³å°ä¹‹é—´æ˜¯æœ‰å·®å¼‚çš„ï¼Œä¸‹é¢çš„ä»£ç åªé€‚ç”¨äºLinuxç¯å¢ƒä¸‹\n\n```golang\nfunc RunCmd(ctx context.Context, cmd *exec.Cmd) ([]byte, error) {\n    var (\n        b   bytes.Buffer\n        err error\n    )\n    //å¼€è¾Ÿæ–°çš„çº¿ç¨‹ç»„ï¼ˆLinuxå¹³å°ç‰¹æœ‰çš„å±æ€§ï¼‰\n    cmd.SysProcAttr = &syscall.SysProcAttr{\n        Setpgid: true, //ä½¿å¾—Shellè¿›ç¨‹å¼€è¾Ÿæ–°çš„PGID,å³Shellè¿›ç¨‹çš„PID,å®ƒåé¢åˆ›å»ºçš„æ‰€æœ‰å­è¿›ç¨‹éƒ½å±äºè¯¥è¿›ç¨‹ç»„\n    }\n    cmd.Stdout = &b\n    cmd.Stderr = &b\n    if err = cmd.Start(); err != nil {\n        return nil, err\n    }\n    var finish = make(chan struct{})\n    defer close(finish)\n    go func() {\n        select {\n        case <-ctx.Done(): //è¶…æ—¶/è¢«cancel ç»“æŸ\n            //kill -(-PGID)æ€æ­»æ•´ä¸ªè¿›ç¨‹ç»„\n            syscall.Kill(-cmd.Process.Pid, syscall.SIGKILL)\n        case <-finish: //æ­£å¸¸ç»“æŸ\n        }\n    }()\n    //waitç­‰å¾…goroutineæ‰§è¡Œå®Œï¼Œç„¶åé‡Šæ”¾FDèµ„æº\n    //è¿™ä¸ªæ—¶å€™å†killæ‰shellè¿›ç¨‹å°±ä¸ä¼šå†ç­‰å¾…äº†ï¼Œä¼šç›´æ¥è¿”å›\n    if err = cmd.Wait(); err != nil {\n        return nil, err\n    }\n    return b.Bytes(), err\n}\n```\n**æ•ˆæœæ¼”ç¤º**\n![mark](http://static.imlgw.top/blog/20200825/gfz2xQ7nnKKg.gif)","tags":["å¼€æºé¡¹ç›®","Golang"],"categories":["è¸©å‘è®°å½•"]},{"title":"LeetCodeä½è¿ç®—","url":"/2020/07/03/leetcode-wei-yun-suan/","content":"\n> ä»[æ•°ç»„ä¸“é¢˜](http://imlgw.top/2019/05/04/leetcode-shu-zu/)æŠ½ç¦»å‡ºæ¥çš„ï¼Œæ—¶é—´å°±ä¸åšçŸ«æ­£äº†ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å•¥æ—¶å€™å¼€å§‹åšçš„\n\n##  _LeetCodeäºŒè¿›åˆ¶_\n\n## [136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—](https://leetcode-cn.com/problems/single-number/)\n\nç»™å®šä¸€ä¸ª**éç©ºæ•´æ•°**æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œ**å…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡**ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚\n\n**è¯´æ˜ï¼š**\n\nä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [2,2,1]\nè¾“å‡º: 1\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [4,1,2,1,2]\nè¾“å‡º: 4\n```\n\n**è§£æ³•ä¸€**\n\nå¾ˆå¯æƒœï¼Œæƒ³åˆ°äº†ä½è¿ç®—ï¼Œä½†æ˜¯æ²¡è¯•ï¼Œç„äº†ä¸€çœ¼è¯„è®ºåŒºï¼Œçœ‹è§å¼‚æˆ–ä¸¤ä¸ªå­—é©¬ä¸Šå°±æ»šå›æ¥å†™äº†è¿™ä¸ªğŸ˜‚\n\n```java\npublic int singleNumber(int[] nums) {\n    for(int i=1;i<nums.length;i++){\n        nums[i]^=nums[i-1];\n    }\n    return nums[nums.length-1];\n}\n```\n## [260. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— III](https://leetcode-cn.com/problems/single-number-iii/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œå…¶ä¸­æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚ æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„é‚£ä¸¤ä¸ªå…ƒç´ ã€‚\n\n**ç¤ºä¾‹ :**\n\n```java\nè¾“å…¥: [1,2,1,3,2,5]\nè¾“å‡º: [3,5]\n```\n\n\n**æ³¨æ„ï¼š**\n\n1. ç»“æœè¾“å‡ºçš„é¡ºåºå¹¶ä¸é‡è¦ï¼Œå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œ [5, 3] ä¹Ÿæ˜¯æ­£ç¡®ç­”æ¡ˆã€‚\n2. ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ä½ èƒ½å¦ä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´å¤æ‚åº¦æ¥å®ç°ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\næ ¹æ®å¼‚æˆ–çš„ç»“æœ`xor`ï¼Œè®²æ•´ä¸ªæ•°ç»„åˆ’åˆ†ä¸ºä¸¤ç»„ï¼Œåˆ†åˆ«åŒ…å«aï¼Œbè¿™ä¸¤ä¸ªå”¯ä¸€çš„å…ƒç´ \n\n```java\npublic int[] singleNumber(int[] nums) {\n    if(nums==null || nums.length<=0) return new int[0];\n    int xor=nums[0];\n    for (int i=1;i<nums.length;i++) {\n        xor^=nums[i];\n    }\n    int index=0; //abäºŒè¿›åˆ¶ä¸åŒçš„index\n    while((xor&1)==0){\n        xor>>>=1;\n        index++;\n    }\n    //a,båœ¨indexä½ç½®çš„äºŒè¿›åˆ¶ä½ä¸åŒï¼Œå¼‚æˆ–ç»“æœä¸º1ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è¿™ä¸ªä¸åŒç‚¹ï¼Œå°†æ•´ä¸ªæ•°ç»„æŒ‰ç…§è¿™ä¸ªåˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†\n    //è¿™æ ·ç›¸åŒçš„æ•°è‚¯å®šä¼šè¢«åˆ†é…åˆ°åŒä¸€ç»„ï¼Œé—®é¢˜å°±è½¬æ¢æˆäº†136ï¼Œè¿™æ ·æˆ‘ä»¬å†åˆ†åˆ«å¼‚æˆ–å°±èƒ½å¾—åˆ°æœ€ç»ˆçš„a,b\n    int a=0,b=0;\n    for (int i=0;i<nums.length;i++) {\n        if(((nums[i]>>>index)&1)==1){ //æ ¹æ®indexä½ç½®çš„å…ƒç´ 0ï¼Œ1æ¥åˆ’åˆ†ä¸ºä¸¤ä¸ªæ•°ç»„\n            a^=nums[i];\n        }else{\n            b^=nums[i];\n        }\n    }\n    return new int[]{a,b};\n}\n```\n> ä¸ºå•¥æ²¡æœ‰ åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—â…¡ï¼Ÿ åˆ«é—®ï¼Œé—®å°±æ˜¯ä¸ä¼šğŸ¤£\n>\n\n## [268. ç¼ºå¤±æ•°å­—](https://leetcode-cn.com/problems/missing-number/)\n\nç»™å®šä¸€ä¸ªåŒ…å« 0, 1, 2, ..., n ä¸­ n ä¸ªæ•°çš„åºåˆ—ï¼Œæ‰¾å‡º 0 .. n ä¸­æ²¡æœ‰å‡ºç°åœ¨åºåˆ—ä¸­çš„é‚£ä¸ªæ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [3,0,1]\nè¾“å‡º: 2\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [9,6,4,2,3,5,7,0,1]\nè¾“å‡º: 8\n```\n\n**è¯´æ˜:**\nä½ çš„ç®—æ³•åº”å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ä½ èƒ½å¦ä»…ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´æ¥å®ç°?\n\n**è§£æ³•ä¸€**\n\næ¯”è¾ƒç›´æ¥çš„æ€è·¯ï¼Œæ±‚å…¨åºåˆ—çš„å’Œç„¶åç›¸å‡å°±ok\n\n```java\npublic int missingNumber(int[] nums) {\n    int N=nums.length;\n    int sum=0;\n    for (int i=0;i<N;i++) {\n        sum+=nums[i];\n    }\n    return N*(N+1)/2-sum; //å¯èƒ½ä¼šæº¢å‡º\n}\n```\n**è§£æ³•äºŒ**\n\nä½è¿ç®—ï¼Œå¼‚æˆ–ï¼Œå’Œä¸Šé¢ä¸€æ ·çš„æ€è·¯\n\n```java\npublic int missingNumber(int[] nums) {\n    int res=0;\n    //3 0 1 \n    for (int i=0;i<nums.length;i++) {\n        res^=nums[i];\n        res^=i;\n    }\n    //3^0^1^0^1^2^3=2\n    return res^nums.length;\n}\n```\nå¼‚æˆ–æ¯ä¸ªæ•°å’Œä¸‹æ ‡ç´¢å¼•ï¼Œç»“æœå°±æ˜¯ç¼ºå¤±çš„æ•°ï¼Œå› ä¸ºç¼ºå¤±çš„åªæœ‰ä¸€ä¸ªï¼Œè¿™æ ·å°±å’Œä¸Šé¢é‚£ä¸€é¢˜ä¸€æ ·äº†\n\n## [461. æ±‰æ˜è·ç¦»](https://leetcode-cn.com/problems/hamming-distance/)\n\nä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„æ±‰æ˜è·ç¦»æŒ‡çš„æ˜¯è¿™ä¸¤ä¸ªæ•°å­—å¯¹åº”äºŒè¿›åˆ¶ä½ä¸åŒçš„ä½ç½®çš„æ•°ç›®ã€‚\n\nç»™å‡ºä¸¤ä¸ªæ•´æ•° x å’Œ yï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„æ±‰æ˜è·ç¦»ã€‚\n\n**æ³¨æ„ï¼š**\n`0 â‰¤ x, y < 2^31.`\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: x = 1, y = 4\n\nè¾“å‡º: 2\n\nè§£é‡Š:\n1   (0 0 0 1)\n4   (0 1 0 0)\n       â†‘   â†‘\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic int hammingDistance(int x, int y) {\n    int i=x^y;\n    int count=0;\n    while(i!=0){\n        if ((i&1)==1) { //æ‹¬å·ä¸èƒ½æ‰\n            count++;\n        }\n        i=i>>1;\n    }\n    return count;\n}\n```\n\nä¸€è¡Œ`Integer.bitCount(x^y)`\n\n## [191. ä½1çš„ä¸ªæ•°](https://leetcode-cn.com/problems/number-of-1-bits/)\n\nç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œè¿”å›å…¶äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­æ•°å­—ä½æ•°ä¸º â€˜1â€™ çš„ä¸ªæ•°ï¼ˆä¹Ÿè¢«ç§°ä¸ºæ±‰æ˜é‡é‡ï¼‰\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š00000000000000000000000000001011\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000000001011 ä¸­ï¼Œå…±æœ‰ä¸‰ä½ä¸º '1'ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š00000000000000000000000010000000\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000010000000 ä¸­ï¼Œå…±æœ‰ä¸€ä½ä¸º '1'ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š11111111111111111111111111111101\nè¾“å‡ºï¼š31\nè§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 11111111111111111111111111111101 ä¸­ï¼Œå…±æœ‰ 31 ä½ä¸º '1'ã€‚\n```\n\n**æç¤ºï¼š**\n\n- è¯·æ³¨æ„ï¼Œåœ¨æŸäº›è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ä¸­ï¼Œæ²¡æœ‰æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½å°†è¢«æŒ‡å®šä¸ºæœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå¹¶ä¸”ä¸åº”å½±å“æ‚¨çš„å®ç°ï¼Œå› ä¸ºæ— è®ºæ•´æ•°æ˜¯æœ‰ç¬¦å·çš„è¿˜æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶å†…éƒ¨çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼éƒ½æ˜¯ç›¸åŒçš„ã€‚\n- åœ¨ Java ä¸­ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç è®°æ³•æ¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ ç¤ºä¾‹ 3 ä¸­ï¼Œè¾“å…¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•° -3ã€‚\n\n**è¿›é˜¶:**\nå¦‚æœå¤šæ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ \n\n**è§£æ³•ä¸€**\n\næ¯”è¾ƒç²¾å¦™çš„è§£æ³•ï¼Œ`n&(n-1)` å°±æ˜¯å°†äºŒè¿›åˆ¶æœ€å³è¾¹çš„1å˜ä¸º0ï¼Œè¿™æ ·é€æ­¥çš„&æœ€åæ•°ç»„å°±ä¼šå˜ä¸º0ï¼Œæˆ‘ä»¬ç»Ÿè®¡ä¸‹æ¬¡æ•°å°±æ˜¯1çš„æ•°é‡\n\n```java\npublic int hammingWeight(int n) {\n    int count=0;\n    while(n!=0){\n        //while(n>0){\n        n&=(n-1);\n        count++;\n    }\n    return count;\n}\n```\n\n**è§£æ³•äºŒ**\n\nç§»ä½æ“ä½œï¼Œç›¸æ¯”ä¸Šé¢ä¼šæ…¢ä¸€äº›ï¼Œæ²¡æœ‰é‚£ä¹ˆç²¾å¦™\n\n```java\npublic int hammingWeight(int n) {\n    int count=0;\n    while(n!=0){\n        if((n&1)==1)//åˆ¤æ–­æœ«ä½æ˜¯ä¸æ˜¯1\n            count++;\n        n>>>=1; //æ— ç¬¦å·å³ç§»,é¿å…æ·»é«˜ä½æ·»1æ­»å¾ªç¯\n    }\n    return count;\n}\n```\n\n> æ³¨æ„å³ç§»çš„æ“ä½œï¼Œéƒ½éœ€è¦ä½¿ç”¨æ— ç¬¦å·å³ç§»ï¼Œä¸ç„¶è´Ÿæ•°å³ç§»é«˜ä½è¡¥1åå°±é”™äº†\n\n## [338. æ¯”ç‰¹ä½è®¡æ•°](https://leetcode-cn.com/problems/counting-bits/)\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numã€‚å¯¹äº 0 â‰¤ i â‰¤ num èŒƒå›´ä¸­çš„æ¯ä¸ªæ•°å­— i ï¼Œè®¡ç®—å…¶äºŒè¿›åˆ¶æ•°ä¸­çš„ 1 çš„æ•°ç›®å¹¶å°†å®ƒä»¬ä½œä¸ºæ•°ç»„è¿”å›ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 2\nè¾“å‡º: [0,1,1]\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 5\nè¾“å‡º: [0,1,1,2,1,2]\n```\n\n\n**è¿›é˜¶:**\n\n- ç»™å‡ºæ—¶é—´å¤æ‚åº¦ä¸ºO(n*sizeof(integer))çš„è§£ç­”éå¸¸å®¹æ˜“ã€‚ä½†ä½ å¯ä»¥åœ¨çº¿æ€§æ—¶é—´O(n)å†…ç”¨ä¸€è¶Ÿæ‰«æåšåˆ°å—ï¼Ÿ\n- è¦æ±‚ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ä¸ºO(n)ã€‚\n- ä½ èƒ½è¿›ä¸€æ­¥å®Œå–„è§£æ³•å—ï¼Ÿè¦æ±‚åœ¨C++æˆ–ä»»ä½•å…¶ä»–è¯­è¨€ä¸­ä¸ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°ï¼ˆå¦‚ C++ ä¸­çš„ __builtin_popcountï¼‰æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚ \n\n**è§£æ³•ä¸€**\n\nè¿™æ ·çš„é¢˜è‚¯å®šæ˜¯ç›´æ¥ä¸Šè¿›é˜¶çš„å•¦ï¼Œæœ‰åŠ¨æ€è§„åˆ’çš„æ„æ€\n\n```java\npublic int[] countBits(int num) {\n    int[] res=new int[num+1];\n    for (int i=1;i<=num;i++) {\n        //å¦‚æœiäºŒè¿›åˆ¶ä»¥0ç»“å°¾,é‚£ä¹ˆi>>1çš„countBitå’Œiä¸€æ ·,i&1=0ï¼ˆ>>1å°±æ˜¯/2ï¼‰\n        //åä¹‹,é‚£ä¹ˆi>>1çš„æ¯”iä¼šå°‘1ä¸ª,i&1=1\n        res[i]=res[i>>1]+(i&1); //æ³¨æ„æ‹¬å·\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\nå’Œä¸Šé¢ç±»ä¼¼ï¼Œä¸è¿‡æ‰‹æ³•æœ‰ç‚¹ä¸ä¸€æ ·\n\n```java\npublic int[] countBits(int num) {\n    int[] res=new int[num+1];\n    for (int i=1;i<=num;i++) {\n        //i&(i-1)ä¼šå»æ‰æœ€å³è¾¹çš„1\n        res[i]=res[i&(i-1)]+1;\n    }\n    return res;\n}\n```\n\n## [231. 2çš„å¹‚](https://leetcode-cn.com/problems/power-of-two/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 1\nè¾“å‡º: true\nè§£é‡Š: 20 = 1\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 16\nè¾“å‡º: true\nè§£é‡Š: 24 = 16\n```\n\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: 218\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\nåº”è¯¥æ˜¯æœ€å¿«ACçš„é¢˜å§hahaha\n\n```java\npublic boolean isPowerOfTwo(int n) {\n    return n>0 && (n&(n-1))==0;\n}\n```\n\n## [458. å¯æ€œçš„å°çŒª](https://leetcode-cn.com/problems/poor-pigs/)\n\næœ‰ 1000 åªæ°´æ¡¶ï¼Œå…¶ä¸­æœ‰ä¸”åªæœ‰ä¸€æ¡¶è£…çš„å«æœ‰æ¯’è¯ï¼Œå…¶ä½™è£…çš„éƒ½æ˜¯æ°´ã€‚å®ƒä»¬ä»å¤–è§‚çœ‹èµ·æ¥éƒ½ä¸€æ ·ã€‚å¦‚æœå°çŒªå–äº†æ¯’è¯ï¼Œå®ƒä¼šåœ¨ 15 åˆ†é’Ÿå†…æ­»å»ã€‚\n\né—®é¢˜æ¥äº†ï¼Œå¦‚æœéœ€è¦ä½ åœ¨ä¸€å°æ—¶å†…ï¼Œå¼„æ¸…æ¥šå“ªåªæ°´æ¡¶å«æœ‰æ¯’è¯ï¼Œä½ æœ€å°‘éœ€è¦å¤šå°‘åªçŒªï¼Ÿ\n\nå›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸ºä¸‹åˆ—çš„è¿›é˜¶é—®é¢˜ç¼–å†™ä¸€ä¸ªé€šç”¨ç®—æ³•ã€‚\n\n**è¿›é˜¶:**\n\nå‡è®¾æœ‰ `n` åªæ°´æ¡¶ï¼ŒçŒªé¥®æ°´ä¸­æ¯’åä¼šåœ¨ `m` åˆ†é’Ÿå†…æ­»äº¡ï¼Œä½ éœ€è¦å¤šå°‘çŒªï¼ˆ`x`ï¼‰å°±èƒ½åœ¨ `p` åˆ†é’Ÿå†…æ‰¾å‡º â€œ**æœ‰æ¯’**â€ æ°´æ¡¶ï¼Ÿè¿™ `n` åªæ°´æ¡¶é‡Œæœ‰ä¸”ä»…æœ‰ä¸€åªæœ‰æ¯’çš„æ¡¶ã€‚\n\n**æç¤ºï¼š**\n\n1. å¯ä»¥å…è®¸å°çŒªåŒæ—¶é¥®ç”¨ä»»æ„æ•°é‡çš„æ¡¶ä¸­çš„æ°´ï¼Œå¹¶ä¸”è¯¥è¿‡ç¨‹ä¸éœ€è¦æ—¶é—´ã€‚\n2. å°çŒªå–å®Œæ°´åï¼Œå¿…é¡»æœ‰ *m* åˆ†é’Ÿçš„**å†·å´æ—¶é—´**ã€‚åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œåªå…è®¸è§‚å¯Ÿï¼Œè€Œä¸å…è®¸ç»§ç»­é¥®æ°´ã€‚\n3. ä»»ä½•ç»™å®šçš„æ¡¶éƒ½å¯ä»¥æ— é™æ¬¡é‡‡æ ·ï¼ˆæ— é™æ•°é‡çš„çŒªï¼‰ã€‚\n\n**è§£æ³•ä¸€**\n\n[å‚è€ƒé¢˜è§£åŒº](https://leetcode-cn.com/problems/poor-pigs/solution/hua-jie-suan-fa-458-ke-lian-de-xiao-zhu-by-guanpen/) æˆ‘å°±ä¸æ¬è¿äº†ï¼Œç®€å•æ¥è¯´å°±æ˜¯çœ‹æ¯ä¸ªå°çŒªèƒ½è¡¨ç¤ºå‡ è¿›åˆ¶çš„çŠ¶æ€ï¼Œæ¯”å¦‚é¢˜ç›®ä¸­è¯´çš„æ˜¯15åˆ†é’Ÿæ­»äº¡ï¼Œä¸€ä¸ªå°æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆæ¯åªå°çŒªå¯ä»¥åƒ4æ¬¡è¯ï¼Œå¯ä»¥æ£€æµ‹å‡º5ç“¶è¯ï¼Œæ‰€ä»¥`x`åªçŒªå°±èƒ½æ£€æµ‹`state^x`ä¸ªæ¡¶\n\n```java\npublic int poorPigs(int buckets, int minutesToDie, int minutesToTest) {\n    int state=minutesToTest/minutesToDie+1;\n    return (int)Math.ceil(Math.log(buckets)/Math.log(state));\n}\n```\n\nå…·ä½“çš„åšæ³•ï¼šxåªğŸ–ï¼Œæ¯åªğŸ–éƒ½å’Œå¯¹åº”......\n\n> ä¸¤åªçŒªäºŒç»´çš„è¡¨æ ¼å¯ä»¥è§£å†³ï¼Œä¸‰åªçŒªä¸‰ç»´çš„åæ ‡å¯ä»¥è§£å†³ï¼Œå¦‚æœæ˜¯4åªçŒªï¼Œ5åªçŒªå‘¢ï¼Ÿå…·ä½“çš„å¦‚ä½•æµ‹é‡ï¼Œè¿™é‡Œæˆ‘è¿˜æ²¡æœ‰ç‚¹æ²¡æƒ³æ¸…æ¥šğŸ˜\n\n## [371. ä¸¤æ•´æ•°ä¹‹å’Œ](https://leetcode-cn.com/problems/sum-of-two-integers/)\n\n**ä¸ä½¿ç”¨**è¿ç®—ç¬¦ `+` å’Œ `-` ï¼Œè®¡ç®—ä¸¤æ•´æ•° `a` ã€`b` ä¹‹å’Œã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: a = 1, b = 2\nè¾“å‡º: 3\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: a = -2, b = 3\nè¾“å‡º: 1\n```\n\n**è§£æ³•ä¸€**\n\nä¸¤æ•°ä¹‹å’Œ = ä¸¤æ•°ä¸è¿›ä½å’Œ+ä¸¤æ•°è¿›ä½å’Œ ï¼Œä¸€å¼€å§‹ä¹Ÿæ²¡ææ‡‚è¿™ä¸ªå¼å­ï¼Œåæ¥åœ¨10è¿›åˆ¶ä¸Šæƒ³äº†ä¸‹å°±æ˜ç™½äº†\n\næ¯”å¦‚ 998 + 99 = 987+110 = 97 + 1000 = 1097 ï¼Œå…¶å®å°±æ˜¯æŠŠåŠ æ³•æ‹†å¼€æ¥çœ‹ï¼ŒæŠŠè¿›ä½çš„æ•°å’Œå¯¹åº”çš„æ•°ä½å’Œåˆ†å¼€è®¡ç®—ï¼Œè€Œè¿›ä½çš„æ•°å’Œä¸¤æ•°çš„ä¸è¿›ä½å’Œéƒ½å¯ä»¥é€šè¿‡ä½è¿ç®—ç®—å‡ºæ¥ï¼Œè¿›è€Œä¸ä½¿ç”¨`+/-`è®¡ç®—ä¸¤æ•°ä¹‹å’Œ\n\n```go\nfunc getSum(a int, b int) int {\n    if b==0{\n        return a\n    }\n    //a^b:ä¸è¿›ä½å’Œ a&b<<1: è¿›ä½æ•°å’Œ(è¿›ä½æ˜¯è¿›åˆ°å‰ä¸€ä½ï¼Œæ‰€ä»¥éœ€è¦å·¦ç§»ï¼Œç±»æ¯”åè¿›åˆ¶å°±æ¸…æ¥šäº†)\n    return getSum(a^b,(a&b)<<1) \n}\n```\n\n## [190. é¢ å€’äºŒè¿›åˆ¶ä½](https://leetcode-cn.com/problems/reverse-bits/)\n\nDifficulty: **ç®€å•**\n\n\né¢ å€’ç»™å®šçš„ 32 ä½æ— ç¬¦å·æ•´æ•°çš„äºŒè¿›åˆ¶ä½ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```\nè¾“å…¥: 00000010100101000001111010011100\nè¾“å‡º: 00111001011110000010100101000000\nè§£é‡Š: è¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000010100101000001111010011100 è¡¨ç¤ºæ— ç¬¦å·æ•´æ•° 43261596ï¼Œ\n     å› æ­¤è¿”å› 964176192ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼ä¸º 00111001011110000010100101000000ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```\nè¾“å…¥ï¼š11111111111111111111111111111101\nè¾“å‡ºï¼š10111111111111111111111111111111\nè§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 11111111111111111111111111111101 è¡¨ç¤ºæ— ç¬¦å·æ•´æ•° 4294967293ï¼Œ\nÂ     å› æ­¤è¿”å› 3221225471 å…¶äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼ä¸º 10111111111111111111111111111111 ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   è¯·æ³¨æ„ï¼Œåœ¨æŸäº›è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ä¸­ï¼Œæ²¡æœ‰æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½å°†è¢«æŒ‡å®šä¸ºæœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå¹¶ä¸”ä¸åº”å½±å“æ‚¨çš„å®ç°ï¼Œå› ä¸ºæ— è®ºæ•´æ•°æ˜¯æœ‰ç¬¦å·çš„è¿˜æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶å†…éƒ¨çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼éƒ½æ˜¯ç›¸åŒçš„ã€‚\n*   åœ¨ Java ä¸­ï¼Œç¼–è¯‘å™¨ä½¿ç”¨è®°æ³•æ¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„Â **ç¤ºä¾‹ 2**Â ä¸­ï¼Œè¾“å…¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•° `-3`ï¼Œè¾“å‡ºè¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•° `-1073741825`ã€‚\n\n**è¿›é˜¶**:  \nå¦‚æœå¤šæ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ\n\n\n**è§£æ³•ä¸€**\n\nåˆ©ç”¨ç§»ä½è¿ç®—ä»åå¾€å‰è®¡ç®—äºŒè¿›åˆ¶çš„å€¼å°±å¯ä»¥äº†\n```java\npublic int reverseBits(int n) {\n    int res = 0;\n    int count = 32;\n    while(n != 0){ //Javaä¸­æ²¡æœ‰æ— ç¬¦å·æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½å†™å¤§äº0\n        //Javaç§»ä½è¿ç®—ä¼˜å…ˆçº§ä½äº+-\n        res = (res << 1) + (n & 1);\n        n >>>= 1; //æ— ç¬¦å·å³ç§»ï¼Œé¿å…é«˜ä½è¡¥1\n        count--;\n    }\n    while(count > 0){\n        res <<= 1;\n        count--;\n    }\n    return res;\n}\n```\nä¸Šé¢çš„è§£æ³•è¿˜æ˜¯ä¸å¤Ÿç®€æ´ï¼Œç¬¬äºŒä¸ªå¾ªç¯æ²¡æœ‰å¿…è¦ï¼Œä¸è¿‡ä¸­é—´æœ‰å‡ ä¸ªå°çŸ¥è¯†ç‚¹æŒºæœ‰æ„æ€çš„ï¼Œå›é¡¾äº†ä¸‹\n\n**è§£æ³•äºŒ**\n\nç®€æ´çš„è§£æ³•\n```golang\nfunc reverseBits(num uint32) uint32 {\n    var res uint32 = 0\n    for i := 32; i > 0; i-- {\n        //goä¸­ç§»ä½è¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äºäº+-\n        res = (res << 1) + (num & 1)\n        num >>= 1\n    }\n    return res\n}\n```\n> golangå’Œjavaçš„ä½è¿ç®—ä¼˜å…ˆçº§å±…ç„¶ä¸ä¸€æ ·ï¼Œä¸€å¼€å§‹å†™çš„goï¼Œè¯¥æˆjavaçš„æ—¶å€™å‘ç°ä¸å¯¹ï¼Œè°ƒè¯•äº†ä¸‹æ‰å‘ç°ğŸ˜‚ï¼Œæ‰€ä»¥ä»»ä½•æ—¶å€™èƒ½åŠ æ‹¬å·çš„å°½é‡åŠ æ‹¬å·ï¼Œå³ä½¿ä½ çŸ¥é“ä¸åŠ ä¹Ÿå¯ä»¥ï¼Œæœ€å¥½è¿˜æ˜¯è¦åŠ ä¸Šæ‹¬å·ï¼ï¼ï¼\n\n## [201. æ•°å­—èŒƒå›´æŒ‰ä½ä¸](https://leetcode-cn.com/problems/bitwise-and-of-numbers-range/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šèŒƒå›´ [m, n]ï¼Œå…¶ä¸­ 0 <= m <= n <= 2147483647ï¼Œè¿”å›æ­¤èŒƒå›´å†…æ‰€æœ‰æ•°å­—çš„æŒ‰ä½ä¸ï¼ˆåŒ…å« m, n ä¸¤ç«¯ç‚¹ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```golang\nè¾“å…¥: [5,7]\nè¾“å‡º: 4\n```\n\n**ç¤ºä¾‹ 2:**\n\n```golang\nè¾“å…¥: [0,1]\nè¾“å‡º: 0\n```\n\n**è§£æ³•ä¸€**\næœ€é•¿å…¬å…±å‰ç¼€\n```golang\n//æœ€é•¿å…¬å…±å‰ç¼€\n//1011 011 m\n//1011 100\n//1011 101\n//1011 110 n\nfunc rangeBitwiseAnd(m int, n int) int {\n    var tlen = 0\n    for m != n {\n        m >>= 1\n        n >>= 1\n        tlen++\n    }\n    return m << tlen\n}\n```\n**è§£æ³•äºŒ**\n```golang\nfunc rangeBitwiseAnd(m int, n int) int {\n    for n > m {\n        n &= (n-1)\n    }\n    return n\n}\n```\n\n## [1018. å¯è¢« 5 æ•´é™¤çš„äºŒè¿›åˆ¶å‰ç¼€](https://leetcode-cn.com/problems/binary-prefix-divisible-by-5/)\n\nDifficulty: **ç®€å•**\n\n\nç»™å®šç”±è‹¥å¹²Â `0`Â å’ŒÂ `1`Â ç»„æˆçš„æ•°ç»„ `A`ã€‚æˆ‘ä»¬å®šä¹‰Â `N_i`ï¼šä»Â `A[0]` åˆ°Â `A[i]`Â çš„ç¬¬ `i`Â ä¸ªå­æ•°ç»„è¢«è§£é‡Šä¸ºä¸€ä¸ªäºŒè¿›åˆ¶æ•°ï¼ˆä»æœ€é«˜æœ‰æ•ˆä½åˆ°æœ€ä½æœ‰æ•ˆä½ï¼‰ã€‚\n\nè¿”å›å¸ƒå°”å€¼åˆ—è¡¨Â `answer`ï¼Œåªæœ‰å½“Â `N_i`Â å¯ä»¥è¢« `5`Â æ•´é™¤æ—¶ï¼Œç­”æ¡ˆÂ `answer[i]` ä¸ºÂ `true`ï¼Œå¦åˆ™ä¸º `false`ã€‚\n\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼š[0,1,1]\nè¾“å‡ºï¼š[true,false,false]\nè§£é‡Šï¼š\nè¾“å…¥æ•°å­—ä¸º 0, 01, 011ï¼›ä¹Ÿå°±æ˜¯åè¿›åˆ¶ä¸­çš„ 0, 1, 3 ã€‚åªæœ‰ç¬¬ä¸€ä¸ªæ•°å¯ä»¥è¢« 5 æ•´é™¤ï¼Œå› æ­¤ answer[0] ä¸ºçœŸã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼š[1,1,1]\nè¾“å‡ºï¼š[false,false,false]\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼š[0,1,1,1,1,1]\nè¾“å‡ºï¼š[true,false,false,false,true,false]\n```\n\n**ç¤ºä¾‹Â 4ï¼š**\n\n```c\nè¾“å…¥ï¼š[1,1,1,0,1]\nè¾“å‡ºï¼š[false,false,false,false,false]\n```\n\n**æç¤ºï¼š**\n\n1.  1 <= A.length <= 30000\n2.  `A[i]` ä¸ºÂ `0`Â æˆ–Â `1`\n\n\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹æ²¡è€ƒè™‘æº¢å‡ºçš„é—®é¢˜ï¼Œç”¨çš„æ˜¯pyæ‰€ä»¥ä¹Ÿæ²¡æŠ¥é”™ï¼Œçœ‹äº†è¯„è®ºåŒºæ‰æ„è¯†åˆ°ä¼šæœ‰æº¢å‡ºçš„é—®é¢˜ï¼Œä¸è¿‡è¿™é‡Œä¹Ÿå¾ˆå¥½å¤„ç†ï¼Œå› ä¸ºæˆ‘ä»¬æ¯æ¬¡éƒ½åªéœ€è¦çŸ¥é“è¿™ä¸ªå€¼æ¨¡5çš„å€¼å°±è¡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿ç•™å½“å‰å€¼æ¨¡5çš„ä½™æ•°å°±è¡Œäº†\n$$\n(a * b+c) \\bmod \\ p=((\\underbrace{(a \\bmod \\ p)} * (b \\bmod \\ p))+(c \\bmod p))\\bmod p\n$$\nè¿™é‡Œçš„$a$å°±æ˜¯ä¸Šæ¬¡è®¡ç®—çš„ç»“æœï¼Œæ ¹æ®å–æ¨¡è¿ç®—çš„æ€§è´¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿å­˜ä¸Šæ¬¡è®¡ç®—çš„ç»“æœæ¨¡5åçš„å€¼å°±è¡Œäº†ï¼Œè¿™æ ·å°±èƒ½é¿å…æº¢å‡ºçš„é—®é¢˜\n```python\nâ€‹class Solution:\n    def prefixesDivBy5(self, A: List[int]) -> List[bool]:\n        res = []\n        v = 0\n        # 1110(14) --> 11101 (29)\n        for i in range(0, len(A)):\n            v = (v*2 + A[i]) % 5\n            res.append(v==0)\n        return res\n```","tags":["LeetCode","ä½è¿ç®—"],"categories":["ç®—æ³•"]},{"title":"Rabin-Karpç®—æ³•","url":"/2020/07/01/rabinkarp-suan-fa/","content":" > è§åˆ°å¥½å‡ æ¬¡äº†ï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆéš¾ï¼Œå­¦ä¸€æ‰‹ï¼Œæœ¬æ¥æƒ³è¯¦ç»†çš„å†™ä¸€ä¸‹å®Œæ•´çš„Rabin-Karpè§£æçš„ï¼Œä½†æ˜¯ç›®å‰ç¡®å®æ—¶é—´æœ‰ç‚¹ç´§ï¼ŒåŠ ä¸Šè‡ªå·±ä¹Ÿæ²¡åšå‡ é¢˜ï¼Œç†è§£çš„å¯èƒ½è¿˜ä¸åˆ°ä½ï¼Œç­‰åé¢æœ‰æ—¶é—´å†æ¥è¡¥å§\n ## [1044. æœ€é•¿é‡å¤å­ä¸²](https://leetcode-cn.com/problems/longest-duplicate-substring/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™å‡ºä¸€ä¸ªå­—ç¬¦ä¸²Â `S`ï¼Œè€ƒè™‘å…¶æ‰€æœ‰**é‡å¤å­ä¸²**ï¼ˆ`S` çš„è¿ç»­å­ä¸²ï¼Œå‡ºç°ä¸¤æ¬¡æˆ–å¤šæ¬¡ï¼Œå¯èƒ½ä¼šæœ‰é‡å ï¼‰ã€‚\n\nè¿”å›**ä»»ä½•**å…·æœ‰æœ€é•¿å¯èƒ½é•¿åº¦çš„é‡å¤å­ä¸²ã€‚ï¼ˆå¦‚æœ `S`Â ä¸å«é‡å¤å­ä¸²ï¼Œé‚£ä¹ˆç­”æ¡ˆä¸ºÂ `\"\"`ã€‚ï¼‰\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```\nè¾“å…¥ï¼š\"banana\"\nè¾“å‡ºï¼š\"ana\"\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```\nè¾“å…¥ï¼š\"abcd\"\nè¾“å‡ºï¼š\"\"\n```\n\n**æç¤ºï¼š**\n\n1.  `2 <= S.length <= 10^5`\n2.  `S` ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆã€‚\n\n\n**è§£æ³•ä¸€**\n\nçœ‹é¢˜è§£åŒºå­¦ä¹ äº†ä¸€ä¸‹ï¼Œæ•´ä½“çš„æ€è·¯å€’æ˜¯ä¸éš¾ï¼Œä¸»è¦å°±æ˜¯ä¸€ä¸ª`rolling hash`çš„è¿‡ç¨‹ï¼Œç„¶åå°±æ˜¯å…³äºMODçš„é€‰å–ï¼Œåˆ°ç°åœ¨ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šæ€ä¹ˆé€‰MODã€‚ã€‚ã€‚\n```java\npublic String longestDupSubstring(String S) {\n    int n = S.length();\n    int [] nums =new int[n];\n    for (int i = 0; i < S.length(); i++) {\n        nums[i] =  S.charAt(i) - 'a';\n    }\n    long MOD =  1L<<32;\n    int B = 26; \n    int left = 1;\n    int right = n - 1;\n    int start = -1, mlen = 0;\n    while (left <= right){\n        int mid = left + (right - left)/2;\n        int temp = RabinKarp(mid, B, nums, MOD);\n        if (temp != -1){\n            if (mid > mlen){\n                mlen = mid;\n                start = temp;\n            }\n            left = mid + 1;\n        }else{\n            right = mid - 1;\n        }\n    }\n    return start == -1 ? \"\" : S.substring(start, start + mlen);\n}\n\npublic int RabinKarp(int len, int B, int[] nums, long MOD){\n    //hash(S) = s[0] * B^(len-1) + s[1] * B^(len-2) + ... + s[n-1] *1\n    //B^(len-1) (ç§»é™¤å·¦ç«¯ç‚¹æ—¶éœ€è¦çš„å€¼)\n    long BL = 1;\n    for (int i = 0; i < len - 1; i++){\n        BL = (BL * B) % MOD;\n    }\n    //[0,len-1]çš„hashå€¼\n    long h = 0;\n    for (int i = 0; i < len; i++){\n        h = (h * B + nums[i]) % MOD;\n    }\n    HashSet<Long> set = new HashSet<>();\n    set.add(h);\n    //rolling hash\n    for (int i = 1; i <= nums.length - len; i++){\n        //+MODæ˜¯ä¸ºäº†è´Ÿæ•°å–æ¨¡\n        h = (h - nums[i - 1] * BL % MOD + MOD) % MOD;\n        h = (h * B + nums[i + len - 1]) % MOD;\n        if (set.contains(h)){\n            return i;\n        }\n        set.add(h);\n    }\n    return -1;\n}\n```\n\n**è§£æ³•äºŒ**\n\nè¡¥å……ä¸€ä¸‹å†²çªæ£€æµ‹ï¼ŒçŒœmodä¹Ÿå¤ªç„å­¦äº†ğŸ˜‚\n> è¿™ä¸ªå†²çªæ£€æµ‹çš„æ–¹æ³•æœ‰é—®é¢˜ï¼Œç•™ä¸‹åšä¸ªå°è¯ï¼Œæ­£ç¡®çš„æ£€æµ‹è¯·ç›´æ¥çœ‹ è§£æ³•ä¸‰\n\n```java\n//å†™ä¸€æ³¢æ£€æµ‹å†²çªçš„\npublic String longestDupSubstring(String S) {\n    int n = S.length();\n    long MOD = (long) 1e9+7;\n    int B = 26; \n    int left = 1;\n    int right = n - 1;\n    int start = -1, mlen = 0;\n    while (left <= right){\n        int mid = left + (right - left)/2;\n        int temp = RabinKarp(mid, B, S, MOD);\n        if (temp != -1){\n            if (mid > mlen){\n                mlen = mid;\n                start = temp;\n            }\n            left = mid + 1;\n        }else{\n            right = mid - 1;\n        }\n    }\n    return start == -1 ? \"\" : S.substring(start, start + mlen);\n}\n\npublic int RabinKarp(int len, int B, String S, long MOD){\n    //hash(S) = s[0] * B^(len-1) + s[1] * B^(len-2) + ... + s[n-1] *1\n    //B^(len-1) (ç§»é™¤å·¦ç«¯ç‚¹æ—¶éœ€è¦çš„å€¼)\n    long BL = 1;\n    for (int i = 0; i < len - 1; i++){\n        BL = (BL * B) % MOD;\n    }\n    //[0,len-1]çš„hashå€¼\n    long h = 0;\n    for (int i = 0; i < len; i++){\n        h = (h * B + S.charAt(i) - 'a') % MOD;\n    }\n    //è¿™é‡Œè‚¯å®šä¸èƒ½ç›´æ¥å­˜å­—ç¬¦ä¸²åšå†²çªæ£€æµ‹ï¼Œå¤ªå¤§äº†ä¼šMLE\n    //å­˜ä¸€ä¸ªèµ·å§‹åœ°å€å°±å¯ä»¥äº†lenå·²çŸ¥\n    HashMap<Long,Integer> map = new HashMap<>();\n    map.put(h, 0);\n    //rolling hash\n    for (int i = 1; i <= S.length() - len; i++){\n        //+MODæ˜¯ä¸ºäº†è´Ÿæ•°å–æ¨¡\n        h = (h - (S.charAt(i-1) - 'a') * BL % MOD + MOD) % MOD;\n        h = (h * B + (S.charAt(len + i -1) - 'a')) % MOD;\n        Integer start = map.get(h);\n        if (start != null && S.substring(start, start + len).equals(S.substring(i, i + len))){\n            return i;\n        }\n        map.put(h, i);\n    }\n    return -1;\n}\n```\n\n> å…³äºè¿™ä¸ªå†²çªæ£€æµ‹æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œæˆ‘å°è¯•å‡å°äº†`MOD`çš„å¤§å°ï¼Œæ¯”å¦‚101ï¼Œè¿™æ ·è®¡ç®—å‡ºæ¥çš„ç»“æœåœ¨æ•°æ®é‡è¾ƒå¤§çš„å°±ä¸å¯¹äº†ï¼Œå¾—åˆ°çš„å­—ç¬¦è™½ç„¶ç¡®å®æ˜¯é‡å¤äº†ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æœ€é•¿çš„ï¼ŒæŒ‰é“ç†å†™äº†å†²çªæ£€æµ‹åå³ä½¿æˆ‘MODå–1åº”è¯¥éƒ½æ˜¯å¯ä»¥æ‰¾å‡ºæ¥çš„å•Šï¼Ÿ======>\n> åœ¨å†™ä¸Šé¢è¿™æ®µè¯çš„æ—¶å€™çªç„¶æƒ³æ˜ç™½äº†ï¼Œå› ä¸º`MOD`å–çš„å¤ªå°ï¼Œå¯¼è‡´å†²çªçš„æ¦‚ç‡å¤§å¤§å¢åŠ ï¼Œè€Œè¿™é‡Œæˆ‘åšå†²çªæ£€æµ‹çš„æ—¶å€™åªä¿å­˜äº†ä¸€ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰å¾ˆå¤šå€¼è¢«èˆå¼ƒæ‰ï¼Œä¹Ÿè®¸ä½ èˆå¼ƒçš„å€¼å¯èƒ½æ°å¥½å°±æ˜¯æœ€åçš„ç­”æ¡ˆï¼Œå­—ç¬¦è¶Šé•¿ï¼Œå‘ç”Ÿè¿™ç§æƒ…å†µçš„æ¦‚ç‡å°±è¶Šé«˜ï¼Œæ‰€ä»¥è¯´æˆ‘è¿™é‡Œå†²çªæ£€æµ‹åšçš„å¹¶ä¸å®Œå…¨ï¼Œèƒ½è¿‡ä¹Ÿçº¯å±è¿æ°”ï¼Œæ­£ç¡®çš„å†²çªæ£€æµ‹åº”è¯¥ä¿å­˜ä¸€ä¸ª`List`é“¾è¡¨ï¼Œç„¶ååœ¨å‘ç”Ÿå†²çªçš„æ—¶å€™åœ¨Listä¸­æ‰¾æœ‰æ²¡æœ‰å’Œå½“å‰å­—ç¬¦ç›¸ç­‰çš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ—¶é—´å¤æ‚åº¦å°±ä¼šä¸Šå»ï¼ˆå…¶å®è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è®¾è®¡Hashè¡¨çš„è¿‡ç¨‹ï¼Œé“¾åœ°å€æ³•è§£å†³å†²çªï¼‰\n\n**è§£æ³•ä¸‰**\n\nä¸‹é¢çš„åº”è¯¥å°±æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œé“¾åœ°å€æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šå¢å¤§ï¼Œè€—æ—¶å¢åŠ åˆ°äº†500ms+ï¼Œä½†æ˜¯ç¡®ä¿äº†100%çš„æ­£ç¡®ç‡ï¼Œè¿™æ˜¯å€¼å¾—çš„ï¼Œè¿™æ¬¡æŠŠmodè°ƒå°ä¹Ÿä¸ä¼šå‡ºé”™äº†ï¼ˆä½†æ˜¯å¯èƒ½ä¼šTLEï¼Œå†²çªå˜å¤§äº†ï¼‰ï¼Œæ€»ä½“æ¥è¯´ï¼Œè¿™å‡ ç•ªæŠ˜è…¾æ”¶è·è¿˜æ˜¯æŒºå¤§çš„ï¼Œå¥½äº‹è¿˜æ˜¯è¦å¤šç£¨å•Š\n```java\n//å†å†™ä¸€æ³¢æ£€æµ‹å†²çªã€‚ã€‚ã€‚\n//ä¸Šé¢çš„å†™çš„æœ‰é—®é¢˜ï¼Œæ£€æµ‹ä¸å®Œå…¨\npublic String longestDupSubstring(String S) {\n    int n = S.length();\n    long MOD = (long) 1e9+7;\n    int B = 26; \n    int left = 1;\n    int right = n - 1;\n    int start = -1, mlen = 0;\n    while (left <= right){\n        int mid = left + (right - left)/2;\n        int temp = RabinKarp(mid, B, S, MOD);\n        if (temp != -1){\n            if (mid > mlen){\n                mlen = mid;\n                start = temp;\n            }\n            left = mid + 1;\n        }else{\n            right = mid - 1;\n        }\n    }\n    return start == -1 ? \"\" : S.substring(start, start + mlen);\n}\n\npublic int RabinKarp(int len, int B, String S, long MOD){\n    //hash(S) = s[0] * B^(len-1) + s[1] * B^(len-2) + ... + s[n-1] *1\n    //B^(len-1) (ç§»é™¤å·¦ç«¯ç‚¹æ—¶éœ€è¦çš„å€¼)\n    long BL = 1;\n    for (int i = 0; i < len - 1; i++){\n        BL = (BL * B) % MOD;\n    }\n    //[0,len-1]çš„hashå€¼\n    long h = 0;\n    for (int i = 0; i < len; i++){\n        h = (h * B + S.charAt(i) - 'a') % MOD;\n    }\n    //è¿™é‡Œè‚¯å®šä¸èƒ½ç›´æ¥å­˜å­—ç¬¦ä¸²åšå†²çªæ£€æµ‹ï¼Œå¤ªå¤§äº†ä¼šMLE\n    //å­˜ä¸€ä¸ªèµ·å§‹åœ°å€å°±å¯ä»¥äº†lenå·²çŸ¥\n    HashMap<Long,List<Integer>> map = new HashMap<>();\n    map.put(h, new ArrayList(){{add(0);}});\n    //rolling hash\n    for (int i = 1; i <= S.length() - len; i++){\n        //+MODæ˜¯ä¸ºäº†è´Ÿæ•°å–æ¨¡\n        h = (h - (S.charAt(i-1) - 'a') * BL % MOD + MOD) % MOD;\n        h = (h * B + (S.charAt(len + i -1) - 'a')) % MOD;\n        List<Integer> starts = map.get(h);\n        if (check(starts, i, S, len)){\n            return i;\n        }\n        if (starts == null){\n            List<Integer> lis = new ArrayList<>();\n            lis.add(i);\n            map.put(h, lis);\n        }else{\n            starts.add(i);\n        }\n    }\n    return -1;\n}\n\npublic boolean check(List<Integer> starts, int i, String s, int len){\n    if(starts == null || starts.size() <= 0){\n        return false;\n    }\n    for (int left : starts) {\n        if(s.substring(left, left + len).equals(s.substring(i, i + len))){\n            return true;\n        }\n    }\n    return false;\n}\n```\n\n\n## [718. æœ€é•¿é‡å¤å­æ•°ç»„](https://leetcode-cn.com/problems/maximum-length-of-repeated-subarray/)\n\nç»™ä¸¤ä¸ªæ•´æ•°æ•°ç»„ `A` å’Œ `B` ï¼Œè¿”å›ä¸¤ä¸ªæ•°ç»„ä¸­å…¬å…±çš„ã€é•¿åº¦æœ€é•¿çš„å­æ•°ç»„çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\nA: [1,2,3,2,1]\nB: [3,2,1,4,7]\nè¾“å‡º: 3\nè§£é‡Š: \né•¿åº¦æœ€é•¿çš„å…¬å…±å­æ•°ç»„æ˜¯ [3, 2, 1]ã€‚\n```\n\n**è¯´æ˜:**\n\n1. 1 <= len(A), len(B) <= 1000\n2. 0 <= A[i], B[i] < 100\n\n**è§£æ³•ä¸€**\n\ndpçš„è§£æ³•æ˜¯O(N^2)çš„ï¼Œç•¥æ˜¾æš´åŠ›ï¼ŒåŠ¨æ€è§„åˆ’çš„è§£æ³•æ”¾åœ¨[dpä¸“é¢˜](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#718-%E6%9C%80%E9%95%BF%E9%87%8D%E5%A4%8D%E5%AD%90%E6%95%B0%E7%BB%84)ä¸­ï¼Œè¿™é‡Œè¦ä»‹ç»çš„æ˜¯äºŒåˆ†+å­—ç¬¦ä¸²Hashçš„`O(NlogN)`çš„è§£æ³•\n\nè¿™é‡Œç›´æ¥è½è¿‡äº†ï¼Œä¸”æ•ˆç‡æé«˜ï¼ˆ16msï¼‰ï¼Œå°±ä¸å†™å†²çªæ£€æµ‹äº†\n```java\npublic int findLength(int[] A, int[] B) {\n    int lenA = A.length, lenB = B.length;\n    int left = 1;\n    int right = Math.min(lenA, lenB);\n    int res = 0;\n    while (left <= right){\n        int mid = left +(right - left) / 2;\n        if(RabinKarp(A, B, mid)){\n            res = Math.max(res, mid);\n            left = mid + 1;\n        }else{\n            right = mid - 1;\n        }\n    }\n    return res;\n}\n\npublic boolean RabinKarp(int[] A,int[] B, int L){\n    int MOD = (int) 1e9+7, BASE = 101;\n    long BL = 1;\n    for(int i = 0; i < L-1; i++){\n        BL = (BL * BASE) % MOD;\n    }\n    //hash(A[0,L-1]),hash(B[0,L-1])\n    long hA = 0, hB = 0;\n    for(int i = 0; i < L; i++){\n        hA = (hA * BASE + A[i]) % MOD;\n        hB = (hB * BASE + B[i]) % MOD;\n    }\n    HashSet<Long> set =new HashSet<>();\n    set.add(hA);\n    //rolling hash A\n    for(int i = 1; i <= A.length - L; i++){\n        hA = (hA - A[i-1] * BL % MOD + MOD) % MOD;\n        hA = (hA * BASE + A[L + i -1]) % MOD;\n        set.add(hA);\n    }\n    if(set.contains(hB)) return true;\n    //rolling hash B\n    for(int i = 1; i <= B.length - L; i++){\n        hB = (hB - B[i-1] * BL % MOD + MOD) % MOD;\n        hB = (hB * BASE + B[L + i -1]) % MOD;\n        //è¿™é‡Œè¿˜å¯ä»¥åšä¸€ä¸‹å†²çªæ£€æµ‹ï¼Œsetä¸­éœ€è¦å¤šå­˜ä¸€äº›ä¿¡æ¯\n        if(set.contains(hB)){\n            return true;\n        }\n    }\n    return false;\n}\n```\n\n## [é¢è¯•é¢˜ 17.13. æ¢å¤ç©ºæ ¼](https://leetcode-cn.com/problems/re-space-lcci/)\n\nDifficulty: **ä¸­ç­‰**\n\nå“¦ï¼Œä¸ï¼ä½ ä¸å°å¿ƒæŠŠä¸€ä¸ªé•¿ç¯‡æ–‡ç« ä¸­çš„ç©ºæ ¼ã€æ ‡ç‚¹éƒ½åˆ æ‰äº†ï¼Œå¹¶ä¸”å¤§å†™ä¹Ÿå¼„æˆäº†å°å†™ã€‚åƒå¥å­`\"I reset the computer. It still didnâ€™t boot!\"`å·²ç»å˜æˆäº†`\"iresetthecomputeritstilldidntboot\"`ã€‚åœ¨å¤„ç†æ ‡ç‚¹ç¬¦å·å’Œå¤§å°å†™ä¹‹å‰ï¼Œä½ å¾—å…ˆæŠŠå®ƒæ–­æˆè¯è¯­ã€‚å½“ç„¶äº†ï¼Œä½ æœ‰ä¸€æœ¬åšåšçš„è¯å…¸`dictionary`ï¼Œä¸è¿‡ï¼Œæœ‰äº›è¯æ²¡åœ¨è¯å…¸é‡Œã€‚å‡è®¾æ–‡ç« ç”¨`sentence`è¡¨ç¤ºï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼ŒæŠŠæ–‡ç« æ–­å¼€ï¼Œè¦æ±‚æœªè¯†åˆ«çš„å­—ç¬¦æœ€å°‘ï¼Œè¿”å›æœªè¯†åˆ«çš„å­—ç¬¦æ•°ã€‚\n\n**æ³¨æ„:** æœ¬é¢˜ç›¸å¯¹åŸé¢˜ç¨ä½œæ”¹åŠ¨ï¼Œåªéœ€è¿”å›æœªè¯†åˆ«çš„å­—ç¬¦æ•°\n\n**ç¤ºä¾‹ï¼š**\n\n```go\nè¾“å…¥ï¼š\ndictionary = [\"looked\",\"just\",\"like\",\"her\",\"brother\"]\nsentence = \"jesslookedjustliketimherbrother\"\nè¾“å‡ºï¼š 7\nè§£é‡Šï¼š æ–­å¥åä¸º\"jess looked just like tim her brother\"ï¼Œå…±7ä¸ªæœªè¯†åˆ«å­—ç¬¦ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `0 <= len(sentence) <= 1000`\n*   `dictionary`ä¸­æ€»å­—ç¬¦æ•°ä¸è¶…è¿‡ 150000ã€‚\n*   ä½ å¯ä»¥è®¤ä¸º`dictionary`å’Œ`sentence`ä¸­åªåŒ…å«å°å†™å­—æ¯ã€‚\n\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’å’ŒTrieçš„è§£æ³•å·¦è½¬[åŠ¨æ€è§„åˆ’](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/)ä¸“é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸‹å­—ç¬¦ä¸²Hashçš„åšæ³•ï¼Œå…¶å®å­—ç¬¦ä¸²Hashçš„åšæ³•ç›¸æ¯”å­—å…¸æ ‘çš„åšæ³•ä¼šæ…¢ä¸€ç‚¹ç‚¹ï¼Œä¸è¿‡æ€è·¯è¿˜æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„\n\nè¿™é‡Œçœ‹å®˜æ–¹é¢˜è§£åˆå­¦åˆ°äº†ä¸€ç‚¹ä¸œè¥¿ï¼Œè¿™é‡Œåœ¨è®¡ç®—hashçš„æ—¶å€™åŠ äº†ä¸€ä¸ª1ï¼Œè¿™æ ·æˆ‘çŒœæµ‹å°±æ˜¯ä¸ºäº†é¿å…0çš„å‡ºç°ï¼Œä½¿å¾—åé¢çš„baseå¤±æ•ˆï¼Œä½¿å¾—å†²çªçš„æ¦‚ç‡å˜å¤§ï¼Œæ¯”å¦‚`aba`å’Œ`ba`å¯èƒ½å°±ä¼šè¢«åˆ¤æˆä¸€æ ·çš„å­—ç¬¦ï¼Œæˆ‘ä¸‹é¢çš„åšæ³•æ²¡æœ‰åšå‡`a`çš„æ“ä½œï¼Œè€Œæ˜¯å–äº†æ›´å¤§çš„BASEï¼Œè¿™é‡Œå°±ä¸å†™å†²çªæ£€æµ‹äº†ï¼Œå¯ä»¥ç›´æ¥è½è¿‡ï¼Œä¸Šé¢çš„ç¬¬ä¸€é¢˜ç¡®å®å¤ªç¦»è°±äº†ï¼Œä¸æŒ‰ç…§å®˜æ–¹é¢˜è§£çš„æ•°æ®æ¥å°±è¿‡ä¸äº†\n```java\npublic int respace(String[] dictionary, String s) {\n    int BASE = 131;\n    long MOD = Integer.MAX_VALUE;\n    HashSet<Long> set = new HashSet<>();\n    for (String word : dictionary ) {\n        set.add(hash(word, BASE, MOD));\n    }\n    int n = s.length();\n    int[] dp = new int[n+1];\n    for (int i = 1; i <=n ; i++) {\n        dp[i] = dp[i-1] + 1;\n        long rollhash = 0;\n        for (int j = i; j >= 1; j--) {\n            rollhash = (rollhash * BASE + s.charAt(j-1)) % MOD;\n            if(set.contains(rollhash)){\n                //æ³¨æ„è¿™é‡Œæ˜¯dp[j-1]ï¼Œå¯¹åº”s.charAt(j-1)çš„å‰ä¸€ä¸ªå­—ç¬¦\n                dp[i] = Math.min(dp[i], dp[j-1]);\n            }\n            if(dp[i] == 0){\n                break;\n            }\n        }\n    }\n    return dp[n];\n}\n\n//æ³¨æ„éœ€è¦é€†å‘hashï¼Œä¸Šé¢è®¡ç®—çš„æ—¶å€™æ˜¯j--ï¼Œæ˜¯é€†å‘çš„\npublic long hash(String s, int BASE, long MOD){\n    long h = 0;\n    for (int i = s.length()-1; i >=0 ; i--) {\n        h = (h * BASE + s.charAt(i)) % MOD;\n    }\n    return h;\n}\n```\n> è¿™ä¸ªè§£æ³•ä¹Ÿç”¨åˆ°äº†Hashè¡¨ï¼Œä½†æ˜¯ç›¸æ¯”ç”¨Hashè¡¨å­˜å­—ç¬¦ï¼Œå­˜æ•°å­—çš„æ—¶é—´å¤æ‚åº¦ä¼šä½å¾ˆå¤šï¼Œå…¶å®å­—ç¬¦ä¸²Hashä¹Ÿå°±æ˜¯ä¸ºäº†é¿å…åœ¨Hashè¡¨ä¸­å­˜å¤§é‡çš„å­—ç¬¦ï¼Œä¸€æ¥ç©ºé—´å ç”¨ä¼šéå¸¸å¤§ï¼ŒäºŒæ¥å¯¹äºå­—ç¬¦ä¸²æ¥è¯´è®¡ç®—å­—ç¬¦çš„`hashCode()`çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(N)ä¸å¯å¿½ç•¥çš„ï¼Œè€Œæ•°å­—é•¿åº¦å›ºå®šï¼Œ`hashCode()`ç›´æ¥è¿”å›å€¼å°±è¡Œäº†\n\n## [1316. ä¸åŒçš„å¾ªç¯å­å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/distinct-echo-substrings/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²Â `text` ï¼Œè¯·ä½ è¿”å›æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„Â **ä¸åŒ** éç©ºå­å­—ç¬¦ä¸²çš„æ•°ç›®ï¼š\n\n*   å¯ä»¥å†™æˆæŸä¸ªå­—ç¬¦ä¸²ä¸å…¶è‡ªèº«ç›¸è¿æ¥çš„å½¢å¼ï¼ˆå³ï¼Œå¯ä»¥å†™ä¸º `aÂ + a`ï¼Œå…¶ä¸­ `a` æ˜¯æŸä¸ªå­—ç¬¦ä¸²ï¼‰ã€‚\n\nä¾‹å¦‚ï¼Œ`abcabc`Â å°±æ˜¯Â `abc`Â å’Œå®ƒè‡ªèº«è¿æ¥å½¢æˆçš„ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼štext = \"abcabcabc\"\nè¾“å‡ºï¼š3\nè§£é‡Šï¼š3 ä¸ªå­å­—ç¬¦ä¸²åˆ†åˆ«ä¸º \"abcabc\"ï¼Œ\"bcabca\" å’Œ \"cabcab\" ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼štext = \"leetcodeleetcode\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š2 ä¸ªå­å­—ç¬¦ä¸²ä¸º \"ee\" å’Œ \"leetcodeleetcode\" ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= text.length <= 2000`\n*   `text`Â åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚\n\n\n**è§£æ³•ä¸€**\n\nå“­äº†ï¼Œçœ‹ç€KMPçš„tagè¿›æ¥çš„ï¼Œç»“æœå‘ç°KMPçš„ä¸å¤ªä¼šå†™ï¼Œå­¦ä¹ äº†é¢˜è§£çš„å‰ç¼€å’ŒHashçš„æ€è·¯ï¼Œè¿˜æ˜¯æœ‰ç‚¹æ”¶è·\n```java\nint BASE = 131;\n\nlong MOD = (long)1e9+7;\n\npublic int distinctEchoSubstrings(String s) {\n    int n = s.length();\n    //å‰ç¼€hashå’Œ(å‰iä¸ªå…ƒç´ çš„hashå€¼)\n    long[] hashSum = new long[n+1];\n    //BASEçš„æ‰€æœ‰å¹‚ä¹˜\n    long[] pow = new long[n+1];\n    pow[0] = 1;\n    hashSum[0] = 0;\n    for (int i = 1; i <= n; i++) {\n        hashSum[i] = (hashSum[i-1]*BASE + s.charAt(i-1)) % MOD;\n        pow[i] = (pow[i-1]*BASE) % MOD;\n    }\n    HashSet<Long> set = new HashSet<>();\n    //æšä¸¾æ‰€æœ‰å¶æ•°é•¿åº¦çš„å­ä¸²\n    for (int len = 2; len <= n; len+=2) {\n        for (int i = 0 ; i+len-1 < n; i++) {\n            int j = i + len - 1; //å³è¾¹ç•Œ\n            int mid = i + (j-i)/2; //ä¸­ç‚¹\n            //0,3\n            long hleft = getHash(hashSum, pow, s, i, mid);\n            long hright = getHash(hashSum, pow, s, mid+1, j);\n            if(hleft == hright && !set.contains(hleft)){\n                set.add(hleft);\n            }\n        }\n    }\n    return set.size();\n}\n\n// æ±‚s[i,j]åŒºé—´çš„å“ˆå¸Œå€¼: s[i]*B^j-i + s[i+1]*B^j-i-1 + ... + s[j]\n// \n// hashSum[i] = s[0]*B^i-1 + s[1]*B^i-2 +...+ s[i-1]\n// hashSum[j+1] = s[0]*B^j + s[1]*B^j-1 +...+ s[j]\n// hashSum[i]*B^j-i+1 = s[0]*B^j + s[1]*B^j-1 +...+ s[i-1]*B^j-i+1\n// hash[i,j] = hashSum[j+1] - hashSum[i] * B^j-i+1\n//           = s[i]*B^j-i + s[i+1]*B^j-i-1 +...+s[j]\npublic long getHash(long[] hashSum, long[] pow, String s, int i, int j){\n    //j-i+1æ˜¯[i,j]åŒºé—´çš„é•¿åº¦ï¼ŒåŒ…å«iå’Œjï¼Œè€ŒhashSum[k]æ˜¯ä¸åŒ…å«kçš„\n    //æ‰€ä»¥è¿™é‡Œéœ€è¦è½¬æ¢ä¸‹ï¼Œjéœ€è¦+1ä½¿å¾—hashSumåŒ…å«j\n    return (hashSum[j+1] - (hashSum[i] * pow[j-i+1]) % MOD + MOD) % MOD;\n}\n```\n\n**è§£æ³•äºŒ**\n\nKMPçš„åšæ³•è‚¯å®šå°±æ˜¯å‚è€ƒKMPçš„[459. é‡å¤çš„å­å­—ç¬¦ä¸²](http://imlgw.top/2020/05/13/kmp-suan-fa/#459-%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2)çš„åšæ³•ï¼Œæˆ‘çœ‹äº†å¤–ç½‘çš„discussï¼Œåªçœ‹è§äº†ä¸€ä¸ªè¿™æ ·å†™çš„ï¼Œè€Œä¸”çœ‹ä¸å¤ªæ‡‚ï¼Œæˆ‘è‡ªå·±å°è¯•äº†ä¸‹ï¼Œæ„Ÿè§‰å¥½å¤šåœ°æ–¹éƒ½ä¼šæœ‰å‘ï¼Œä¸»è¦å°±æ˜¯å»é‡å¾ˆéº»çƒ¦ï¼Œä»£ç å¦‚ä¸‹\n\nä¸‹é¢ä¸ºé”™è¯¯è§£æ³•ï¼Œæ— æ³•é€šè¿‡OJï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ„Ÿè§‰ä¸æ˜¯ä¸ªå¾ˆå¥½çš„åšæ³•\n```java\n//KMPçš„åšæ³•\npublic int distinctEchoSubstrings(String s) {\n    for (int i = 0; i < s.length(); i++) {\n        getNext(s.substring(i));\n    }\n    return set.size();\n}\n\nHashSet<String> set = new HashSet<>();\n\npublic void getNext(String s){\n    if(s.length() < 2){\n        return;\n    }\n    int n = s.length();\n    int[] next = new int[n+1];\n    next[0] = -1;\n    next[1] = 0;\n    int left = 0, right = 2;\n    while(right <= n){\n        if(s.charAt(left) == s.charAt(right-1)){\n            left++;\n            next[right] = left;\n            int replen = right-next[right];\n            String rs = s.substring(0,replen);\n            if (right%2==0 && replen!=right && right%replen==0 && !set.contains(rs)) {\n                set.add(rs);\n            }\n            right++;\n        }else if(next[left] == -1){\n            right++;\n        }else{\n            left = next[left];\n        }\n    }\n}\n```","tags":["æ•°æ®ç»“æ„","ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"Linuxç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿ","url":"/2020/06/20/linux-ci-pan-yu-wen-jian-xi-tong/","content":"\n> è¦ç‚¹æ‘˜æŠ„ï¼Œå…¨æ–‡æ‘˜æŠ„è‡ªã€Šé¸Ÿå”çš„Linuxç§æˆ¿èœã€‹ï¼Œå¯¹å°éƒ¨åˆ†è¯è¯­è¿›è¡Œè½¬æ¢ï¼Œå¯¹éƒ¨åˆ†å†…å®¹è¿›è¡Œæ‰¹æ³¨ï¼Œæ–¹ä¾¿ä»¥åæŸ¥é˜…\n\n## Linuxç£ç›˜ä¸æ–‡ä»¶ç³»ç»Ÿ\n- ä¸€ä¸ªå¯ä»¥è¢«æŒ‚è½½çš„æ•°æ®é€šå¸¸ç§°ä¸º â€œ æ–‡ä»¶ç³»ç»Ÿ , filesystemâ€ è€Œä¸æ˜¯åˆ†åŒº ï¼ˆ partition ï¼‰ \n- åŸºæœ¬ä¸Š `Linux` çš„ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸º Ext2 ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿå†…çš„ä¿¡æ¯ä¸»è¦æœ‰ï¼š\n  - `superblock` ï¼šè®°å½•æ­¤ filesystem çš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ inode/block çš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ï¼Œ ä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ä¸ç›¸å…³ä¿¡æ¯ç­‰ï¼›\n  - `inode` ï¼šè®°å½•æ–‡ä»¶çš„å±æ€§ï¼Œä¸€ä¸ªæ–‡ä»¶å ç”¨ä¸€ä¸ª inode ï¼ŒåŒæ—¶è®°å½•æ­¤æ–‡ä»¶çš„æ•°æ®æ‰€åœ¨çš„ block å·ç ï¼›\n  - `block` ï¼šå®é™…è®°å½•æ–‡ä»¶çš„å†…å®¹ï¼Œè‹¥æ–‡ä»¶å¤ªå¤§æ—¶ï¼Œä¼šå ç”¨å¤šä¸ª block ã€‚\n- `Ext2` æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®å­˜å–ä¸º**ç´¢å¼•å¼æ–‡ä»¶ç³»ç»Ÿ**ï¼ˆ `indexed allocation` ï¼‰æ¯ä¸ªæ–‡ä»¶ç”±ä¸€ä¸ªinodeå’Œå¤šä¸ªblockç»„æˆï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯FATï¼ŒFATè¿™ç§æ ¼å¼çš„æ–‡ä»¶ç³»ç»Ÿå¹¶æ²¡æœ‰ inode å­˜åœ¨ï¼Œæ‰€ä»¥ FAT æ²¡æœ‰åŠæ³•å°†è¿™ä¸ªæ–‡ä»¶çš„æ‰€æœ‰ block åœ¨ä¸€å¼€å§‹å°±è¯»å–å‡ºæ¥ã€‚æ¯ä¸ª block å·ç éƒ½è®°å½•åœ¨å‰ä¸€ä¸ª block å½“ä¸­ï¼Œæ˜¯ä¸€ç§é“¾è¡¨çš„ç»“æ„ï¼Œç£ç›˜é‡ç»„ä¹Ÿä¸»è¦æ˜¯é’ˆå¯¹çš„è¿™ç§æ–‡ä»¶ç³»ç»Ÿ\n- éœ€è¦**ç£ç›˜é‡ç»„**çš„åŸå› å°±æ˜¯æ–‡ä»¶å†™å…¥çš„ block å¤ªè¿‡äºç¦»æ•£äº†ï¼Œæˆ‘ä»¬çš„ç£å¤´å°†æ— æ³•åœ¨ç£ç›˜è½¬ä¸€åœˆå°±è¯»åˆ°æ‰€æœ‰çš„æ•°æ®ï¼Œå› æ­¤ç£ç›˜å°±ä¼šå¤šè½¬å¥½å‡ åœˆæ‰èƒ½å®Œæ•´çš„è¯»å–åˆ°è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ­¤æ—¶æ–‡ä»¶è¯»å–çš„æ€§èƒ½å°†ä¼šå˜çš„å¾ˆå·®æ‰€è‡´ã€‚ è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡ç£ç›˜é‡ç»„å°†åŒä¸€ä¸ªæ–‡ä»¶æ‰€å±çš„ blocks æ±‡æ•´åœ¨ä¸€èµ·ã€‚\n- Ext2 æ–‡ä»¶ç³»ç»Ÿä¸»è¦æœ‰ï¼š boot sector, superblock, `inode bitmap`, `block bitmap`, `inode table`,`data block `ç­‰å…­å¤§éƒ¨åˆ†ã€‚\n- data block æ˜¯ç”¨æ¥æ”¾ç½®æ–‡ä»¶å†…å®¹æ•°æ®åœ°æ–¹ï¼Œåœ¨ Ext2 æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æ”¯æŒçš„ block å¤§å°æœ‰ 1K, 2K åŠ 4K ä¸‰ç§è€Œå·²\n- inode è®°å½•æ–‡ä»¶çš„å±æ€§ / æƒé™ç­‰æ•°æ®ï¼Œå…¶ä»–é‡è¦é¡¹ç›®ä¸ºï¼š æ¯ä¸ª inode å¤§å°å‡ä¸ºå›ºå®šï¼Œæœ‰ 128/256Bytes ä¸¤ç§åŸºæœ¬å®¹é‡ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½ä»…ä¼šå ç”¨\n  ä¸€ä¸ª inode è€Œå·²ï¼› å› æ­¤æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿåˆ›å»ºçš„æ–‡ä»¶æ•°é‡ä¸ inode çš„æ•°é‡æœ‰å…³ï¼›\n  ![NMhIY9.png](https://s1.ax1x.com/2020/06/20/NMhIY9.png)\n  > inode è¦è®°å½•çš„æ•°æ®éå¸¸å¤šï¼Œä½†åååˆåªæœ‰ 128Bytes è€Œå·²ï¼Œ è€Œinode è®°å½•ä¸€ä¸ª block å·ç è¦èŠ±æ‰ 4Byte ï¼Œå‡è®¾æˆ‘ä¸€ä¸ªæ–‡ä»¶æœ‰ 400MB ä¸”æ¯ä¸ª block ä¸º 4K æ—¶ï¼Œ é‚£ä¹ˆè‡³å°‘ä¹Ÿè¦åä¸‡ç¬” block å·ç çš„è®°å½• inodeå“ªæœ‰è¿™ä¹ˆå¤šå¯è®°å½•çš„ä¿¡æ¯ï¼Ÿä¸ºæ­¤æˆ‘ä»¬çš„ç³»ç»Ÿå¾ˆèªæ˜çš„å°† inode è®°å½• block å·ç çš„åŒºåŸŸå®šä¹‰ä¸º 12 ä¸ªç›´æ¥ï¼Œä¸€ä¸ªé—´æ¥ , ä¸€ä¸ªåŒé—´æ¥ä¸ä¸€ä¸ªä¸‰é—´æ¥è®°å½•åŒºã€‚ï¼ˆåŒé—´æ¥ï¼Œä¸‰é—´æ¥å…¶å®å°±æ˜¯å¤šçº§æŒ‡é’ˆï¼ŒinodeæŒ‡å‘blockï¼ŒblockåˆæŒ‡å‘å¦ä¸€ä¸ªblockï¼‰\n- æ–‡ä»¶çš„ block åœ¨è®°å½•æ–‡ä»¶çš„å®é™…æ•°æ®ï¼Œç›®å½•çš„ block åˆ™åœ¨è®°å½•è¯¥ç›®å½•ä¸‹é¢æ–‡ä»¶åä¸å…¶ inode å·ç çš„å¯¹ç…§è¡¨ï¼›\n- æ—¥å¿—å¼æ–‡ä»¶ç³»ç»Ÿ ï¼ˆ `journal` ï¼‰ ä¼šå¤šå‡ºä¸€å—è®°å½•åŒºï¼Œéšæ—¶è®°è½½æ–‡ä»¶ç³»ç»Ÿçš„ä¸»è¦æ´»åŠ¨ï¼Œå¯åŠ å¿«ç³»ç»Ÿå¤åŸæ—¶é—´ï¼›ï¼ˆext2ä¹‹åçš„ext3,4æ”¯æŒï¼‰\n    1. é¢„å¤‡ï¼šå½“ç³»ç»Ÿè¦å†™å…¥ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä¼šå…ˆåœ¨æ—¥å¿—è®°å½•åŒºå—ä¸­çºªå½•æŸä¸ªæ–‡ä»¶å‡†å¤‡è¦å†™å…¥çš„ä¿¡æ¯ï¼›\n    2. å®é™…å†™å…¥ï¼šå¼€å§‹å†™å…¥æ–‡ä»¶çš„æƒé™ä¸æ•°æ®ï¼›å¼€å§‹æ›´æ–° metadata çš„æ•°æ®ï¼›\n    3. ç»“æŸï¼šå®Œæˆæ•°æ®ä¸ metadata çš„æ›´æ–°åï¼Œåœ¨æ—¥å¿—è®°å½•åŒºå—å½“ä¸­å®Œæˆè¯¥æ–‡ä»¶çš„çºªå½•ã€‚\n  > è¿™ç§æ–¹å¼åœ¨å¾ˆå¤šçš„åº”ç”¨è½¯ä»¶ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä½“ç°ï¼Œæ¯”å¦‚`mysql`çš„`redo log`ï¼Œ`redis`çš„`aof`\n- Linux æ–‡ä»¶ç³»ç»Ÿä¸ºå¢åŠ æ€§èƒ½ï¼Œä¼šè®©å†…å­˜ä½œä¸ºå¤§é‡çš„ç£ç›˜é«˜é€Ÿç¼“å­˜ï¼›ï¼ˆè¿™é‡Œçœ‹äº†åŸæ–‡ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œè¿™é‡Œæ„æ€åº”è¯¥æ˜¯è®©å†…å­˜ä½œä¸ºç£ç›˜çš„ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸ç›´æ¥å†™å…¥ç£ç›˜ï¼Œå…ˆå†™å…¥å†…å­˜ï¼Œå†åŒæ­¥åˆ°ç£ç›˜ï¼‰\n  - ç³»ç»Ÿä¼šå°†å¸¸ç”¨çš„æ–‡ä»¶æ•°æ®æ”¾ç½®åˆ°å†…å­˜çš„ç¼“å†²åŒºï¼Œä»¥åŠ é€Ÿæ–‡ä»¶ç³»ç»Ÿçš„è¯» / å†™ï¼›\n  - æ‰¿ä¸Šï¼Œå› æ­¤ Linux çš„å®ä½“å†…å­˜æœ€åéƒ½ä¼šè¢«ç”¨å…‰ï¼è¿™æ˜¯æ­£å¸¸çš„æƒ…å†µï¼å¯åŠ é€Ÿç³»ç»Ÿæ€§èƒ½ï¼›\n  - ä½ å¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ `sync` æ¥å¼ºè¿«å†…å­˜ä¸­è®¾ç½®ä¸º Dirty çš„æ–‡ä»¶å›å†™åˆ°ç£ç›˜ä¸­ï¼›\n  - è‹¥æ­£å¸¸å…³æœºæ—¶ï¼Œå…³æœºæŒ‡ä»¤ä¼šä¸»åŠ¨è°ƒç”¨ `sync` æ¥å°†å†…å­˜çš„æ•°æ®å›å†™å…¥ç£ç›˜å†…ï¼›\n  - ä½†è‹¥ä¸æ­£å¸¸å…³æœºï¼ˆå¦‚è·³ç”µã€æ­»æœºæˆ–å…¶ä»–ä¸æ˜åŸå› ï¼‰ï¼Œç”±äºæ•°æ®å°šæœªå›å†™åˆ°ç£ç›˜å†…ï¼Œ å› æ­¤é‡æ–°å¼€æœºåå¯èƒ½ä¼šèŠ±å¾ˆå¤šæ—¶é—´åœ¨è¿›è¡Œç£ç›˜æ£€éªŒï¼Œç”šè‡³å¯èƒ½å¯¼è‡´æ–‡ä»¶ç³»ç»Ÿçš„æŸæ¯ï¼ˆéç£ç›˜æŸæ¯ï¼‰ã€‚\n- å®ä½“é“¾æ¥åªæ˜¯å¤šäº†ä¸€ä¸ªæ–‡ä»¶åå¯¹è¯¥ `inode` å·ç çš„é“¾æ¥è€Œå·²(ln)\n  ![UTOOLS1592753917172.png](https://upload.cc/i1/2020/06/21/xuFwlq.png)\n- ç¬¦å·é“¾æ¥å°±ç±»ä¼¼ Windows çš„æ·å¾„åŠŸèƒ½ã€‚(ln -s)\n  ![UTOOLS1592753775172.png](https://upload.cc/i1/2020/06/21/qmB46s.png)\n- ç£ç›˜çš„ä½¿ç”¨å¿…éœ€è¦ç»è¿‡ï¼šåˆ†åŒºã€æ ¼å¼åŒ–ä¸æŒ‚è½½ï¼Œåˆ†åˆ«æƒ¯ç”¨çš„æŒ‡ä»¤ä¸ºï¼š gdisk, mkfs, mount ä¸‰ä¸ªæŒ‡ä»¤\n- åˆ†åŒºæ—¶ï¼Œåº”ä½¿ç”¨ parted æ£€æŸ¥åˆ†åŒºè¡¨æ ¼å¼ï¼Œå†åˆ¤æ–­ä½¿ç”¨ fdisk/gdisk æ¥åˆ†åŒºï¼Œæˆ–ç›´æ¥ä½¿ç”¨ parted åˆ†åŒº\n- ä¸ºäº†è€ƒè™‘æ€§èƒ½ï¼Œ XFS æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–æ—¶ï¼Œå¯ä»¥è€ƒè™‘åŠ ä¸Š agcount/su/sw/extsize ç­‰å‚æ•°è¾ƒä½³\n- å¦‚æœç£ç›˜å·²æ— æœªåˆ†åŒºçš„å®¹é‡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤§å‹æ–‡ä»¶å–ä»£ç£ç›˜è®¾å¤‡çš„å¤„ç†æ–¹å¼ï¼Œé€šè¿‡ dd ä¸æ ¼å¼åŒ–åŠŸèƒ½ã€‚\n- æŒ‚è½½ç‚¹çš„æ„ä¹‰ï¼šæ¯ä¸ª filesystem éƒ½æœ‰ç‹¬ç«‹çš„ inode / block / superblock ç­‰ä¿¡æ¯ï¼Œè¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿè¦èƒ½å¤Ÿé“¾æ¥åˆ°ç›®å½•æ ‘æ‰èƒ½è¢«æˆ‘ä»¬ä½¿ç”¨ã€‚ å°†æ–‡ä»¶ç³»ç»Ÿä¸ç›®å½•æ ‘ç»“åˆçš„åŠ¨ä½œæˆ‘ä»¬ç§°ä¸º â€œ æŒ‚è½½ â€ ã€‚ é‡ç‚¹æ˜¯ï¼šæŒ‚è½½ç‚¹ä¸€å®šæ˜¯ç›®å½•ï¼Œè¯¥ç›®å½•ä¸ºè¿›å…¥è¯¥æ–‡ä»¶ç³»ç»Ÿçš„å…¥å£ã€‚å› æ­¤å¹¶ä¸æ˜¯ä½ æœ‰ä»»ä½•æ–‡ä»¶ç³»ç»Ÿéƒ½èƒ½ä½¿ç”¨ï¼Œå¿…é¡»è¦ â€œ æŒ‚è½½ â€ åˆ°ç›®å½•æ ‘çš„æŸä¸ªç›®å½•åï¼Œæ‰èƒ½å¤Ÿä½¿ç”¨è¯¥æ–‡ä»¶ç³»ç»Ÿçš„ã€‚\n  - å•ä¸€æ–‡ä»¶ç³»ç»Ÿä¸åº”è¯¥è¢«é‡å¤æŒ‚è½½åœ¨ä¸åŒçš„æŒ‚è½½ç‚¹ï¼ˆç›®å½•ï¼‰ä¸­ï¼›\n  - å•ä¸€ç›®å½•ä¸åº”è¯¥é‡å¤æŒ‚è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼›\n  - è¦ä½œä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ï¼Œç†è®ºä¸Šåº”è¯¥éƒ½æ˜¯ç©ºç›®å½•æ‰æ˜¯ã€‚\n  - æŒ‚è½½äº†æ–‡ä»¶ç³»ç»Ÿä¹‹åï¼ŒåŸç›®å½•ä¸‹çš„ä¸œè¥¿å°±ä¼šæš‚æ—¶çš„æ¶ˆå¤±\n- å¼€æœºè‡ªåŠ¨æŒ‚è½½å¯å‚è€ƒ /etc/fstab ä¹‹è®¾ç½®ï¼Œè®¾ç½®å®Œæ¯•åŠ¡å¿…ä½¿ç”¨ mount -a æµ‹è¯•è¯­æ³•æ­£ç¡®å¦ï¼›","tags":["Linux","æ“ä½œç³»ç»Ÿ","è¯»ä¹¦ç¬”è®°"],"categories":["Linux"]},{"title":"Gacacheåˆ†å¸ƒå¼ç¼“å­˜","url":"/2020/06/02/gacache-fen-bu-shi-huan-cun/","content":"\n## TOC\n\n\n- [TOC](#toc)\n- [ç®€ä»‹](#ç®€ä»‹)\n- [æ•´ä½“æµç¨‹](#æ•´ä½“æµç¨‹)\n- [LRUé˜Ÿåˆ—](#lrué˜Ÿåˆ—)\n- [å¹¶å‘æ§åˆ¶](#å¹¶å‘æ§åˆ¶)\n- [ä¸€è‡´æ€§Hash](#ä¸€è‡´æ€§hash)\n  - [å®ç°](#å®ç°)\n- [åˆ†å¸ƒå¼èŠ‚ç‚¹é€šä¿¡](#åˆ†å¸ƒå¼èŠ‚ç‚¹é€šä¿¡)\n  - [Clientç«¯](#clientç«¯)\n  - [Serverç«¯](#serverç«¯)\n- [ç¼“å­˜å‡»ç©¿](#ç¼“å­˜å‡»ç©¿)\n  - [å¤ç°](#å¤ç°)\n  - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)\n  - [æµ‹è¯•](#æµ‹è¯•)\n- [çƒ­ç‚¹äº’å¤‡](#çƒ­ç‚¹äº’å¤‡)\n  - [æ€è·¯](#æ€è·¯)\n  - [æµ‹è¯•](#æµ‹è¯•-1)\n- [ç¼“å­˜ç©¿é€](#ç¼“å­˜ç©¿é€)\n  - [å¤ç°](#å¤ç°-1)\n  - [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ-1)\n- [TODO](#todo)\n\n\n## ç®€ä»‹\n\næœ¬é¡¹ç›®æ˜¯æ¨¡ä»¿[groupcache](https://github.com/golang/groupcache)å®ç°çš„ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜åº“ï¼Œå…¶å¯ä»¥ä½œä¸ºå•ç‹¬æœåŠ¡éƒ¨ç½²ï¼Œäº¦å¯ä»¥ä½œä¸ºä¸€ä¸ª`lib`æ¥ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§Hashè¿›è¡ŒèŠ‚ç‚¹çš„é€‰å–å’Œæ•°æ®çš„åˆ†ç‰‡ï¼ŒèŠ‚ç‚¹ä¹‹é—´é‡‡ç”¨httpåè®®è¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨[Protobuf](https://github.com/protocolbuffers/protobuf)åºåˆ—åŒ–æ•°æ®è¿›è¡Œä¼ è¾“ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ï¼ŒèŠ‚ç‚¹ä¹‹é—´æ”¯æŒçƒ­ç‚¹æ•°æ®äº’å¤‡ï¼Œå‡å°‘ç½‘ç»œå¼€é”€ï¼ŒåŒæ—¶è¿˜å®ç°äº†å¹¶å‘è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿ï¼Œç›¸æ¯”äºåŸé¡¹ç›®ï¼Œå¯¹çƒ­ç‚¹äº’å¤‡çš„åŠŸèƒ½è¿›è¡Œäº†å¢å¼º\n\n> æœ¬é¡¹ç›®ä¸ºç»ƒæ‰‹é¡¹ç›®ï¼Œä¸å¯ç”¨äºç”Ÿäº§\n\n## æ•´ä½“æµç¨‹\n\n![mark](http://static.imlgw.top/blog/20200602/Glc7aMrySiqF.png?imageslim)\n\n## LRUé˜Ÿåˆ—\n\nå› ä¸ºç¼“å­˜çš„æ•°æ®éƒ½æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œå†…å­˜èµ„æºæ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ç§åˆé€‚çš„ç­–ç•¥ï¼Œåœ¨å†…å­˜å¿«è¦æ»¡çš„æ—¶å€™å‰”é™¤éƒ¨åˆ†æ•°æ®ï¼Œè¿™é‡Œé€‰æ‹©äº†è¾ƒä¸ºå¹³è¡¡ä¸”å®ç°ç®€å•çš„æ–¹æ¡ˆLRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸€ç¯‡åšæ–‡ [LRUé˜Ÿåˆ—çš„å®ç°ï¼ˆJavaï¼‰](http://imlgw.top/2019/11/16/lrucache/) è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œä»¥åŠé¿å…é‡å¤é€ è½®å­ï¼Œç›´æ¥ä½¿ç”¨`container` åŒ…ä¸­çš„`List`åŒå‘é“¾è¡¨å’Œ`map`æ¥å®ç°ï¼Œå…·ä½“ä»£ç è§ [gacache/lru/lru.go](https://github.com/imlgw/gacache/blob/master/gacache/lru/lru.go)\n\n## å¹¶å‘æ§åˆ¶\n\ngolangä¸­çš„mapå¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„å®¹å™¨ï¼Œå¹¶å‘çš„è®¿é—®å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åŠ é”æ¥æ§åˆ¶å¹¶å‘çš„è¯»å†™\n\n```go\ntype cache struct {\n    mu         sync.Mutex //äº’æ–¥é”\n    lru        *lru.Cache\n    cacheBytes int64\n}\n\nfunc (c *cache) put(key string, value ByteView) {\n    c.mu.Lock()\n    defer c.mu.Unlock()\n    if c.lru == nil { //å°šæœªåˆå§‹åŒ–,lazyinit\n        c.lru = lru.New(c.cacheBytes, nil)\n    }\n    c.lru.Put(key, value)\n}\n\nfunc (c *cache) get(key string) (value ByteView, ok bool) {\n    c.mu.Lock()\n    defer c.mu.Unlock()\n    if c.lru == nil {\n        return\n    }\n    if v, ok := c.lru.Get(key); ok {\n        return v.(ByteView), ok\n    }\n    return\n}\n```\n\n## ä¸€è‡´æ€§Hash\n\nå¯¹äºä¸€ä¸ª**åˆ†å¸ƒå¼ç¼“å­˜**æ¥è®²ï¼Œå®¢æˆ·ç«¯åœ¨å‘æŸä¸€ä¸ªèŠ‚ç‚¹è¯·æ±‚æ•°æ®çš„æ—¶å€™ï¼Œè¯¥èŠ‚ç‚¹åº”è¯¥å¦‚ä½•å»è·å–æ•°æ®å‘¢ï¼Ÿæ˜¯è‡ªå·±æ‹¿ï¼Œè¿˜æ˜¯å»å…¶ä»–èŠ‚ç‚¹æ‹¿ï¼Ÿå¦‚æœè¿™é‡Œä¸åšå¤„ç†ï¼Œè®©å½“å‰èŠ‚ç‚¹è‡ªå·±å»æ•°æ®æºå–æ•°æ®ï¼Œé‚£ä¹ˆæœ€ç»ˆå¯èƒ½æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šç¼“å­˜ä¸€ä»½æ•°æ®æºçš„æ•°æ®ï¼Œè¿™æ ·ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼ˆéœ€è¦å’ŒDBäº¤äº’ï¼‰ï¼Œè€Œä¸”æµªè´¹äº†å¾ˆå¤šç©ºé—´ï¼Œä¸¥æ ¼æ¥è¯´è¿™å°±ç§°ä¸ä¸Šæ˜¯**åˆ†å¸ƒå¼ç¼“å­˜**äº†ï¼Œåªèƒ½ç§°ä¹‹ä¸º**ç¼“å­˜é›†ç¾¤**\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ¡ˆèƒ½å¤Ÿå°†`key`å’ŒèŠ‚ç‚¹å¯¹åº”èµ·æ¥ï¼Œæœ‰ä¸€ç§æ¯”è¾ƒç®€å•çš„æ–¹æ¡ˆå°±æ˜¯å°†`key`å“ˆå¸Œåå¯¹èŠ‚ç‚¹æ•°é‡å–ä½™ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰“åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯è¿™æ ·çš„æ–¹æ¡ˆæ‰©å±•æ€§å’Œå®¹é”™æ€§æ¯”è¾ƒå·®ï¼Œå¦‚æœèŠ‚ç‚¹çš„æ•°é‡å‘ç”Ÿå˜åŒ–å¯èƒ½ä¼šå¯¼è‡´å¤§é‡ç¼“å­˜çš„è¿ç§»ï¼Œä¸€ç¬é—´å¤§é‡ç¼“å­˜éƒ½å¤±æ•ˆäº†ï¼Œè¿™å°±å¯èƒ½å¯¼è‡´ç¼“å­˜é›ªå´©ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘é‡‡ç”¨**ä¸€è‡´æ€§Hashç®—æ³•**\n\n### å®ç°\n\n- æ„é€ ä¸€ä¸ª `0 ~ 2^32-1` å¤§å°çš„ç¯\n- æœåŠ¡èŠ‚ç‚¹ç»è¿‡ hash ä¹‹åå°†å®šä½åˆ°ç¯ä¸­\n- å°†`key`å“ˆå¸Œä¹‹åä¹Ÿå®šä½åˆ°è¿™ä¸ªç¯ä¸­\n- é¡ºæ—¶é’ˆæ‰¾åˆ°ç¦»`hash(key)`æœ€è¿‘çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆé€‰æ‹©çš„ç¼“å­˜èŠ‚ç‚¹\n- è€ƒè™‘åˆ°æœåŠ¡èŠ‚ç‚¹çš„ä¸ªæ•°ä»¥åŠ hash ç®—æ³•çš„é—®é¢˜å¯¼è‡´ç¯ä¸­çš„æ•°æ®åˆ†å¸ƒä¸å‡åŒ€æ—¶å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹\n\n**ä¸€è‡´æ€§Hashçš„Map**\n\n```go\ntype Map struct {\n    hash     Hash           //hashå‡½æ•°\n    replicas int            //è™šæ‹ŸèŠ‚ç‚¹å€æ•°\n    keys     []int          //èŠ‚ç‚¹çš„åœ°å€,å®Œæ•´çš„åè®®/ip/port [eg. http://localhost:8001]\n    hashMap  map[int]string //è™šæ‹ŸèŠ‚ç‚¹å’ŒçœŸå®èŠ‚ç‚¹æ˜ å°„å…³ç³»\n}\n```\n\n**æ·»åŠ æœºå™¨/èŠ‚ç‚¹çš„æ–¹æ³•**\n\n```go\n//æ·»åŠ æœºå™¨/èŠ‚ç‚¹\nfunc (m *Map) Add(keys ...string) {\n    //hashMap := make(map[string][]int, len(keys))\n    for _, key := range keys {\n        //æ¯å°æœºå™¨copyæŒ‡å®šå€æ•°çš„è™šæ‹ŸèŠ‚ç‚¹\n        for i := 0; i < m.replicas; i++ {\n            //è®¡ç®—è™šæ‹ŸèŠ‚ç‚¹çš„ hashå€¼\n            hash := int(m.hash([]byte(strconv.Itoa(i) + key)))\n            //æ·»åŠ åˆ°ç¯ä¸Š\n            m.keys = append(m.keys, hash)\n            //hashMap[key] = append(hashMap[key], hash)\n            //è®°å½•æ˜ å°„å…³ç³»\n            m.hashMap[hash] = key\n        }\n    }\n    //fmt.Println(hashMap)\n    //ç¯ä¸Šhashå€¼è¿›è¡Œæ’åº\n    sort.Ints(m.keys)\n}\n```\n\n**Getè·å–èŠ‚ç‚¹**\n\nå› ä¸ºæ•´ä¸ªç¯æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€šè¿‡äºŒåˆ†å»æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äº`hash(key)`çš„èŠ‚ç‚¹\n\n```go\nfunc (m *Map) Get(key string) string {\n    if len(m.keys) == 0 {\n        return \"\"\n    }\n    hash := int(m.hash([]byte(key)))\n    //äºŒåˆ†æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºhashçš„èŠ‚ç‚¹idx\n    idx := sort.Search(len(m.keys), func(i int) bool {\n        return m.keys[i] >= hash\n    })\n    return m.hashMap[m.keys[idx%len(m.keys)]]\n}\n```\n\n## åˆ†å¸ƒå¼èŠ‚ç‚¹é€šä¿¡\n\né›†ç¾¤ä¹‹é—´çš„é€šä¿¡é€šè¿‡Httpåè®®ï¼ŒåŒæ—¶é‡‡ç”¨[Protobuf](https://github.com/protocolbuffers/protobuf)åºåˆ—åŒ–æ•°æ®æé«˜ä¼ è¾“æ•ˆç‡\n\n### Clientç«¯\n\né€šè¿‡èŠ‚ç‚¹åœ°å€å’Œ`groupName`ä»¥åŠ`key`æ„æˆçš„åœ°å€è¯·æ±‚æ•°æ®ï¼Œé€šè¿‡`protobuf`è§£ç æ•°æ®\n\n```go\nfunc (h *httpGetter) Get(in *pb.Request, out *pb.Response) error {\n    u := fmt.Sprintf(\n        \"%v%v/%v\",\n        h.baseURL,\n        url.QueryEscape(in.GetGroup()),\n        url.QueryEscape(in.GetKey()),\n    )\n    //é€šè¿‡httpè¯·æ±‚è¿œç¨‹èŠ‚ç‚¹çš„æ•°æ®\n    res, err := http.Get(u)\n    if err != nil {\n        return err\n    }\n    defer res.Body.Close()\n    if res.StatusCode != http.StatusOK {\n        return fmt.Errorf(\"server returned: %v\", res.Status)\n    }\n    //è½¬æ¢æˆ[]byte\n    bytes, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        return fmt.Errorf(\"reading response body: %v\", err)\n    }\n    //è§£ç protoå¹¶å°†ç»“æœå­˜åˆ°outä¸­\n    if err != proto.Unmarshal(bytes, out) {\n        return fmt.Errorf(\"decoding response body : %v\", err)\n    }\n    return nil\n}\n```\n\n### Serverç«¯\n\nå®ç°`http.Handler`æ¥å£ï¼Œå¯¹ç¼“å­˜ä¸­å…¶ä»–èŠ‚ç‚¹æš´éœ²åœ°å€ï¼Œæä¾›æœåŠ¡\n\n```go\nfunc (p *HTTPPool) ServeHTTP(w http.ResponseWriter, req *http.Request) {\n    if !strings.HasPrefix(req.URL.Path, p.basePath) {\n        panic(\"HTTPPool serving unexpect path\")\n    }\n    p.Log(\"%s %s\", req.Method, req.URL.Path)\n    // basePath/groupName/key\n    // ä»¥â€˜/â€™ä¸ºç•Œé™å°†groupNameå’Œkeyåˆ’åˆ†ä¸º2ä¸ªpart\n    parts := strings.SplitN(req.URL.Path[len(p.basePath):], \"/\", 2)\n    if len(parts) != 2 {\n        http.Error(w, \"bad request\", http.StatusBadRequest)\n        return\n    }\n    groupName := parts[0]\n    key := parts[1]\n    group := GetGroup(groupName)\n    if group == nil {\n        http.Error(w, \"no such group: \"+groupName, http.StatusNotFound)\n        return\n    }\n    view, err := group.Get(key)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    //ä½¿ç”¨protoç¼–ç Httpå“åº”\n    body, err := proto.Marshal(&pb.Response{Value: view.ByteSlice()})\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    w.Header().Set(\"Content-Type\", \"application/octet-stream\")\n    w.Write(body)\n}\n```\n\n## ç¼“å­˜å‡»ç©¿\n\nä¸€ä¸ªå­˜åœ¨çš„`key`çªç„¶å¤±æ•ˆï¼Œåœ¨å¤±æ•ˆçš„åŒæ—¶æœ‰å¤§é‡çš„è¯·æ±‚æ¥è¯·æ±‚è¿™ä¸ª`key`ï¼Œè¿™ä¸ªæ—¶å€™å¤§é‡è¯·æ±‚å°±ä¼šç›´æ¥æ‰“åˆ°DBï¼Œå¯¼è‡´DBå‹åŠ›å˜å¤§ï¼Œç”šè‡³å®•æœº\n\n### å¤ç°\n\nè¿™é‡Œç®€å•çš„æ¼”ç¤ºç¼“å­˜å‡»ç©¿çš„æ•ˆæœï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢çš„è„šæœ¬å¯åŠ¨4ä¸ª`cache server` å¹¶ä¸”åœ¨ç«¯å£å·ä¸º`8004`çš„`server`ä¸Šå¯åŠ¨ä¸€ä¸ªå‰ç«¯æœåŠ¡ï¼Œç”¨äºå’Œå®¢æˆ·ç«¯äº¤äº’\n\n```bash\nstart go run .  -port=8001\nstart go run .  -port=8002\nstart go run .  -port=8003\nstart go run .  -port=8004 -api=1\n```\n\n(windowså¹³å°çš„batï¼Œå…¶ä»–å¹³å°å¯ä»¥ç”¨è¿™ä¸ª [test.sh](https://github.com/imlgw/gacache/blob/master/test.sh))\n\nå°è¯•äº†ç”¨windowçš„æ‰¹å¤„ç†å†™å¹¶å‘è®¿é—®çš„è„šæœ¬ï¼Œä½†æ˜¯æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥ç›´æ¥ç”¨`go`å†™äº†ä¸ªå°è„šæœ¬æµ‹è¯•å¹¶å‘è¯·æ±‚\n\n```go\nfunc main() {\n    for i := 0; i < 5; i++ {\n        wg.Add(1)\n        go curl(\"resolmi\")\n    }\n    wg.Wait()\n    fmt.Println(\"Done!\")\n}\n\nfunc curl(key string) {\n    res, _ := http.Get(\"http://localhost:9999/api?key=\" + key)\n    bytes, _ := ioutil.ReadAll(res.Body)\n    fmt.Println(string(bytes))\n    wg.Done()\n}\n```\n\nå¼€å¯5ä¸ª`goroutine`ï¼Œå¹¶å‘çš„å»è¯·æ±‚`resolmi`ï¼Œæ­¤æ—¶`cache`è‚¯å®šæ˜¯æ²¡æœ‰è¿™ä¸ªkeyçš„ï¼Œæ‰€ä»¥éœ€è¦åˆ°DBä¸­å»å–\n\nç„¶åå°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æƒ…å†µï¼š\n\n![mark](http://static.imlgw.top/blog/20200529/pU2omvLdDqyQ.png?imageslim)\n\nå‰å°`Server`æ”¶åˆ°äº†Get \"resolmi\"è¯·æ±‚ï¼Œé€šè¿‡ä¸€è‡´æ€§Hashé€‰æ‹©äº†è¿œç¨‹èŠ‚ç‚¹`port:8003`\n\n![mark](http://static.imlgw.top/blog/20200529/uovtpKufQME4.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°ï¼Œ5æ¬¡è¯·æ±‚å…¨éƒ¨æ‰“åˆ°äº†`SlowDB`ä¸­ï¼ï¼è¿™å°±è¯´æ˜å‘ç”Ÿäº†ç¼“å­˜ç©¿é€ï¼è¯·æ±‚ç©¿è¿‡äº†ç¼“å­˜å±‚ï¼Œæ‰“åˆ°DB\n\n> è¿™é‡Œå¦‚æœæ•ˆæœä¸æ˜æ˜¾å¯ä»¥å°è¯•åœ¨`load`å‡½æ•°æ‰§è¡Œå‰åŠ ä¸Šä¸€ä¸ª`time.Sleep`ï¼Œè¿™æ ·å¹¶å‘ç¼“å­˜å‡»ç©¿æ•ˆæœä¼šæ›´æ˜æ˜¾\n\n### è§£å†³æ–¹æ¡ˆ\n\nå…¶å®å¸¸è§çš„æ–¹æ¡ˆå°±ä¸¤ç§ï¼š\n\n**1. ç¼“å­˜æ°¸ä¸è¿‡æœŸ**\n\nç¼“å­˜å€¼ä¸è®¾ç½®`ttl`ï¼Œè€Œæ˜¯åœ¨`value`ä¸­æ·»åŠ ä¸€ä¸ªé€»è¾‘çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·è¯·æ±‚å°±ä¸ä¼šç›´æ¥ç©¿é€åˆ°DBï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡å½“å‰æ—¶é—´åˆ¤æ–­è¯¥keyæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸäº†å°±å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹å»æ›´æ–°ç¼“å­˜ï¼Œè¿™ç§æ–¹å¼ç”¨æˆ·å»¶è¿Ÿæ˜¯æœ€ä½çš„ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆç¼“å­˜çš„ä¸ä¸€è‡´\n\n**2. äº’æ–¥é”**\n\nåœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚è·å–æ•°æ®çš„æ—¶å€™è®¾ç½®ä¸€ä¸ª`mutex`äº’æ–¥é”ï¼Œè®©å…¶ä»–è¯·æ±‚é˜»å¡ï¼Œå½“å‰ç¬¬ä¸€ä¸ªè¯·æ±‚è¯·æ±‚åˆ°æ•°æ®è¿”å›ä¹‹åé‡Šæ”¾`mutex`é”ï¼Œå…¶ä»–è¯·æ±‚åœæ­¢é˜»å¡ï¼Œç„¶åç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®\n\nå› ä¸ºæˆ‘ä»¬çš„é¡¹ç›®æœ¬èº«æ˜¯ä¸æ”¯æŒ`ttl`å’Œåˆ é™¤æ“ä½œçš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ç§æ–¹æ¡ˆä¸å¤ªé€‚åˆï¼Œæ‰€ä»¥é‡‡ç”¨ç¬¬äºŒç§äº’æ–¥é”çš„æ–¹æ¡ˆï¼Œå®ç°äº†ä¸€ä¸ª`singleflight`ç»“æ„æ¥å¤„ç†ç¼“å­˜å‡»ç©¿\n\n**å°è£…è¯·æ±‚call**\n\n```go\n//å°è£…æ¯ä¸ªè¯·æ±‚/è°ƒç”¨\ntype call struct {\n    wg  sync.WaitGroup\n    val interface{} //è¯·æ±‚çš„å€¼\n    err error       //err\n}\n\n//singleflightæ ¸å¿ƒç»“æ„\ntype Group struct {\n    mu sync.Mutex\n    m  map[string]*call //keyä¸callçš„æ˜ å°„\n}\n```\n\n**å¹¶å‘æ§åˆ¶æ ¸å¿ƒä»£ç **\n\n```go\n//å¹¶å‘è¯·æ±‚æ§åˆ¶\nfunc (g *Group) Do(key string, fn func() (interface{}, error)) (interface{}, error) {\n    g.mu.Lock()\n    if g.m == nil {\n        g.m = make(map[string]*call)\n    }\n    if c, ok := g.m[key]; ok {\n        g.mu.Unlock() //é‡Šæ”¾é”,æŒ‰é¡ºåºè¿›æ¥\n        c.wg.Wait()   //ç­‰ç€,ç­‰ç¬¬ä¸€ä¸ªè¯·æ±‚å®Œæˆ\n        return c.val, c.err\n    }\n    c := new(call)\n    c.wg.Add(1)\n    g.m[key] = c\n    g.mu.Unlock()       //è¿™é‡Œé‡Šæ”¾é”ï¼Œè®©å…¶ä»–è¯·æ±‚è¿›å…¥ä¸Šé¢çš„åˆ†æ”¯ä¸­wait(å…¶å®åªæœ‰å¹¶å‘é‡å¤§çš„æ—¶å€™æ‰ä¼šè¿›å…¥ä¸Šé¢çš„åˆ†æ”¯)\n    c.val, c.err = fn() //è¯·æ±‚æ•°æ®\n    c.wg.Done()         //è·å–åˆ°å€¼,ç¬¬ä¸€ä¸ªè¯·æ±‚ç»“æŸ,å…¶ä»–è¯·æ±‚å¯ä»¥è·å–åˆ°å€¼äº†\n    //åˆ é™¤mä¸­çš„key,é¿å…keyå‘ç”Ÿå˜åŒ–,è€Œå–åˆ°çš„è¿˜æ˜¯æ—§å€¼\n    g.mu.Lock()\n    delete(g.m, key)\n    g.mu.Unlock()\n    return c.val, c.err\n}\n```\n\nå½“å¤šä¸ªå¹¶å‘çš„è¯·æ±‚æ¥è¯·æ±‚åŒä¸€ä¸ª`key`çš„æ—¶å€™ï¼Œåªæœ‰**ç¬¬ä¸€ä¸ªè¯·æ±‚**èƒ½æ‹¿åˆ°é”å»DBä¸­å–æ•°æ®ï¼Œå…¶ä»–çš„è¯·æ±‚å°±åªèƒ½åœ¨æ–¹æ³•å¤–é˜»å¡ï¼Œå½“ç¬¬ä¸€ä¸ªè¯·æ±‚æ„é€ å¥½`call`å°±é‡Šæ”¾é”ï¼Œè¿™ä¸ªæ—¶å€™å…¶ä»–å¹¶å‘çš„è¯·æ±‚è·å–é”ï¼Œè¿›å…¥é˜»å¡çš„åˆ†æ”¯é‡Šæ”¾é”ï¼Œç„¶åå†æ¬¡é˜»å¡ï¼Œç­‰å¾…**ç¬¬ä¸€ä¸ªè¯·æ±‚**è·å–åˆ°æ•°æ®å¹¶å°è£…è¿›ä¸`key`å¯¹åº”çš„`call`ä¸­ï¼Œç„¶åç›´æ¥è¿”å›ï¼Œä¸å†å‘æ•°æ®åº“è¯·æ±‚ï¼Œä»è€Œé¿å…äº†ç¼“å­˜å‡»ç©¿\n\n### æµ‹è¯•\nç”¨`singleFlight`åŒ…è£…ä¸€ä¸‹æˆ‘ä»¬çš„`load`æ–¹æ³•\n\n```go\nview, err := g.loader.Do(key, func() (interface{}, error) {\n    if g.peers != nil {\n        //æ ¹æ®ä¸€è‡´æ€§Hashé€‰æ‹©èŠ‚ç‚¹Peer\n        if peer, ok := g.peers.PickPeer(key); ok {\n            //ä»ä¸Šé¢çš„Peerä¸­è·å–æ•°æ®\n            if value, err = g.getFromPeer(peer, key); err == nil {\n                return value, nil\n            }\n            log.Println(\"[Gacache] Fail to get from remote peer!!!\", err)\n        }\n    }\n    return g.getLocally(key)\n})\n```\n\nå†æ¬¡ä½¿ç”¨ä¸Šé¢åŒæ ·çš„è„šæœ¬è¿›è¡Œæµ‹è¯•\n\n![mark](http://static.imlgw.top/blog/20200530/OThgxtFJrFIG.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°5ä¸ªè¯·æ±‚éƒ½æˆåŠŸäº†ï¼Œæˆ‘ä»¬å†çœ‹çœ‹`log`\n\n![mark](http://static.imlgw.top/blog/20200530/fsgxPPXNeVoo.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘è¯·æ±‚äº†5æ¬¡ï¼Œä½†æ˜¯å®é™…ä¸Š`getFromPeer`ä»è¿œç¨‹èŠ‚ç‚¹å–æ•°æ®åªæ‰§è¡Œäº†ä¸€æ¬¡\n\n![mark](http://static.imlgw.top/blog/20200530/ChE0FxjwlYbl.png?imageslim)\n\nä»`SlowDB`çš„æŸ¥è¯¢ä¹Ÿåªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œè¯´æ˜æˆ‘ä»¬çš„`singleFlight`å¹¶å‘æ§åˆ¶ç”Ÿæ•ˆäº†ï¼\n\n## çƒ­ç‚¹äº’å¤‡\n\nçƒ­ç‚¹äº’å¤‡ä¹Ÿæ˜¯`groupcache`çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼Œåœ¨æºç æ³¨é‡Šä¸­å†™åˆ°\n\n> hotCache contains keys/values for which this peer is not authoritative (otherwise they would be in **mainCache**), but are popular enough to warrant mirroring in this process to avoid going over the network to fetch from a peer.  Having a hotCache avoids network hotspotting, where a peer's network card could become the bottleneck on a popular key. This cache is used sparingly to maximize the total number of key/value pairs that can be stored globally.\n\nå¤§è‡´æ„æ€å°±æ˜¯ï¼Œ`hotCache`ä¸­å­˜å‚¨çš„ä¸»è¦æ˜¯è¯¥èŠ‚ç‚¹æ²¡æœ‰çš„é”®å€¼å¯¹ï¼ˆå¦åˆ™å°±åœ¨`mainCache`ä¸­äº†ï¼‰ï¼Œä½†æ˜¯è¿™äº›é”®å€¼å¯¹è¯·æ±‚çš„éå¸¸é¢‘ç¹ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯åœ¨æ­¤è¿‡ç¨‹ä¸­è¿›è¡Œçƒ­ç‚¹å¤‡ä»½ï¼Œé¿å…é€šè¿‡ç½‘ç»œä»è¿œç¨‹èŠ‚ç‚¹å»è·å–ï¼Œ`hotCache`é¿å…äº†ç½‘ç»œçƒ­ç‚¹ï¼Œä½¿èŠ‚ç‚¹çš„ç½‘å¡æˆä¸ºçƒ­ç‚¹`key`çš„ç“¶é¢ˆ\n\nä½†æ˜¯åœ¨`groupcache`ä¸­å¯¹`hotCache`çš„å¤„ç†åªæ˜¯éšæœºçš„å­˜å‚¨ï¼Œæ¯æ¬¡ä»è¿œç¨‹èŠ‚ç‚¹è·å–æ•°æ®çš„æ—¶å€™æœ‰1/10çš„æ¦‚ç‡å­˜å‚¨åˆ°`hotCache`ä¸­ï¼ˆ[code](https://github.com/golang/groupcache/blob/master/groupcache.go#L318)ï¼‰\n\n![mark](http://static.imlgw.top/blog/20200601/A0oPStJGqht3.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªTODOï¼Œæ³¨é‡Šä¸­ä¹Ÿæåˆ°äº†å¯ä»¥ä½¿ç”¨QPSæ¥åˆ¤æ–­æ˜¯å¦æ˜¯çƒ­ç‚¹`key`ï¼Œæ‰€ä»¥æˆ‘æŒ‰ç…§è¿™ä¸ªæƒ³æ³•å†™äº†ä¸€ä¸ªç®€å•çš„ç»Ÿè®¡\n\n### æ€è·¯\n\né¦–å…ˆæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª`hotCache`çš„ç»“æ„ï¼Œè¿™ä¸ªcacheå’Œ`mainCache`ä¸€æ ·ï¼Œéƒ½æ˜¯å¹¶å‘å®‰å…¨çš„`lru`é˜Ÿåˆ—ï¼Œç„¶åæˆ‘ä»¬åœ¨å‘æŸä¸ªèŠ‚ç‚¹è¯·æ±‚æ•°æ®çš„æ—¶å€™å°±å¯ä»¥å…ˆä»`mainCache`ä¸­è¯·æ±‚å¦‚æœæ²¡æœ‰å°±ä»`hotCache`ä¸­è¯·æ±‚ ï¼Œå¦‚ä¸‹\n\n```go\nfunc (g *Group) Get(key string) (ByteView, error) {\n    if key == \"\" {\n        return ByteView{}, fmt.Errorf(\"key nil\")\n    }\n    if v, ok := g.mainCache.get(key); ok {\n        log.Printf(\"[GaCache (mainCache)] hit\")\n        return v, nil\n    }\n    //add: hotCache\n    if v, ok := g.hotCache.get(key); ok {\n        log.Printf(\"[GaCache (hotCache)] hit\")\n        return v, nil\n    }\n    //å½“å‰èŠ‚ç‚¹æ²¡æœ‰æ•°æ®,å»å…¶ä»–åœ°æ–¹åŠ è½½\n    return g.load(key)\n}\n```\n\nç„¶åå°è£…äº†ä¸€ä¸ª`KeyStats`çš„ç»“æ„ï¼Œç”¨äºç»Ÿè®¡`key`çš„è¯·æ±‚ä¿¡æ¯\n\n```go\n//Keyçš„ç»Ÿè®¡ä¿¡æ¯\ntype KeyStats struct {\n    firstGetTime time.Time //ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´\n    remoteCnt    AtomicInt //è¯·æ±‚çš„æ¬¡æ•°ï¼ˆåˆ©ç”¨atomicåŒ…å°è£…çš„åŸå­ç±»ï¼‰\n}\n```\n\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†`key`å’Œ`KeyStats`å¯¹åº”ï¼Œæ‰€ä»¥éœ€è¦åœ¨cacheçš„æ ¸å¿ƒç»“æ„`Group`ä¸­åŠ å…¥æ˜ å°„å…³ç³»\n\n```go\ntype Group struct {\n    //...\n    keys map[string]*KeyStats\n}\n```\n\nç„¶ååœ¨èŠ‚ç‚¹è¯·æ±‚è¿œç¨‹èŠ‚ç‚¹çš„æ—¶å€™ç»Ÿè®¡è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯`getFromPeer`å‡½æ•°ä¸­\n\n```go\n//ä»è¿œç¨‹èŠ‚ç‚¹è·å–æ•°æ®\nfunc (g *Group) getFromPeer(peer PeerGetter, key string) (ByteView, error) {\n    //æ„å»ºprotoçš„message\n    req := &pb.Request{\n        Group: g.name,\n        Key:   key,\n    }\n    res := &pb.Response{}\n    err := peer.Get(req, res)\n\n    fmt.Println(\"getFromPeer\", key)\n    if err != nil {\n        return ByteView{}, err\n    }\n    //è¿œç¨‹è·å–cnt++\n    if stat, ok := g.keys[key]; ok {\n        stat.remoteCnt.Add(1)\n        //è®¡ç®—QPS\n        interval := float64(time.Now().Unix()-stat.firstGetTime.Unix()) / 60\n        qps := stat.remoteCnt.Get() / int64(math.Max(1, math.Round(interval)))\n        if qps >= maxMinuteRemoteQPS {\n            //å­˜å…¥hotCache\n            g.populateCache(key, ByteView{b: res.Value}, &g.hotCache)\n            //åˆ é™¤æ˜ å°„å…³ç³»,èŠ‚çœå†…å­˜\n            mu.Lock()\n            delete(g.keys, key)\n            mu.Unlock()\n        }\n    } else {\n        //ç¬¬ä¸€æ¬¡è·å–\n        g.keys[key] = &KeyStats{\n            firstGetTime: time.Now(),\n            remoteCnt:    1,\n        }\n    }\n    return ByteView{b: res.Value}, nil\n}\n```\n\n`maxMinuteRemoteQPS`æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œæ¯ä¸ªkeyæ¯åˆ†é’Ÿè¿œç¨‹è¯·æ±‚æœ€å¤§çš„QPSï¼Œæ¯æ¬¡å‘è¿œç¨‹èŠ‚ç‚¹è¯·æ±‚æ•°æ®çš„æ—¶å€™è®¡ç®—å½“å‰`key`ç¬¬ä¸€æ¬¡è·å–çš„æ—¶é—´åˆ°ç›®å‰ä¸ºæ­¢çš„QPSï¼Œå¦‚æœå¤§äºé˜ˆå€¼`maxMinuteRemoteQPS`ï¼Œå°±ä¼šå°†å…¶å­˜å…¥`hotCache`ä¸­ï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥ä»`hotCache`ä¸­è·å–æ•°æ®ï¼Œè€Œä¸ç”¨åœ¨é€šè¿‡ç½‘ç»œå»è·å–\n\n### æµ‹è¯•\n\nåŒæ ·ä½¿ç”¨å‰é¢çš„goè„šæœ¬æ¥æµ‹è¯•\n\n```go\nfunc main() {\n    for i := 0; i < 20; i++ {\n        wg.Add(1)\n        //go curl(\"resolmi\")\n        //i not exist\n        //go curl(strconv.Itoa(i))\n        time.Sleep(500 * time.Millisecond)\n        curl(\"resolmi\")\n    }\n    wg.Wait()\n    fmt.Println(\"Done!\")\n}\n\nfunc curl(key string) {\n    res, _ := http.Get(\"http://localhost:9999/api?key=\" + key)\n    bytes, _ := ioutil.ReadAll(res.Body)\n    fmt.Println(string(bytes))\n    wg.Done()\n}\n```\n\n> æ³¨æ„è¿™é‡Œè¯·æ±‚ä¸è¦è¯·æ±‚å¤ªå¿«ï¼Œå¦‚æœä¸€ä¸ªkeyè¯·æ±‚çš„å¤ªå¿«ä¼šè¢«`singleFlight`å¹¶å‘æ§åˆ¶ç»„ä»¶æ‹¦æˆªï¼Œå¤šæ•°è¯·æ±‚ä¸ä¼šèµ°ç½‘ç»œï¼ˆè¿™ä¸ªç»„ä»¶ä½œç”¨è¿˜æ˜¯æŒºå¤§çš„ï¼‰ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä½¿ç”¨`goroutine`ï¼Œè€Œæ˜¯æ­£å¸¸çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¸­é—´åœé¡¿0.5s\n\nè¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¨¡æ‹Ÿï¼Œæˆ‘è®¾ç½®äº† `maxMinuteRemoteQPS = 10` ï¼Œä¸Šé¢çš„è„šæœ¬ä¸€åˆ†é’Ÿä¹‹å†…ä¼šè¯·æ±‚`â€œresolmiâ€` 20æ¬¡ï¼Œè¿™ä¸ª`key`çš„åˆ†ç‰‡å·²çŸ¥æ˜¯è¿œç¨‹èŠ‚ç‚¹ï¼ˆ8003ï¼‰çš„ï¼Œæ‰€ä»¥ä¼šåœ¨ç¬¬10æ¬¡çš„æ—¶å€™è§¦å‘`hotCache`ï¼Œå°†æ•°æ®å­˜å…¥å½“å‰èŠ‚ç‚¹ï¼ˆ8004ï¼‰çš„`hotCache`ä¸­ï¼Œåç»­çš„è¯·æ±‚å°±ä¼šç›´æ¥ä»`hotCache`ä¸­å–ï¼Œå¦‚ä¸‹å›¾æ‰€æ¼”ç¤º\n\n![mark](http://static.imlgw.top/blog/20200602/hKH8u6E1gpcA.gif)\n\nå¯ä»¥çœ‹åˆ°æ•ˆæœç¡®å®è¾¾åˆ°äº†ï¼Œä½†æ˜¯è¿™æ ·åšæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç¼ºç‚¹å°±æ˜¯å†…å­˜è€—è´¹ä¼šæ¯”åŸæ¥å¤§ï¼Œéœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªmapï¼Œä¸è¿‡è¿™éƒ¨åˆ†ä¿¡æ¯å¹¶ä¸å¤§ï¼Œä»…ä»…éœ€è¦å­˜å‚¨`key`å’Œå¯¹åº”`keyStats` ï¼Œkeyçš„é•¿åº¦ä¸€èˆ¬ä¸ä¼šå¾ˆé•¿ï¼Œ`keyStats` çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œä¸€ä¸ª`time`å’Œä¸€ä¸ª`int64`ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šè¿˜æ˜¯å¯è¡Œçš„ã€‚\n\n> è¿™ç§æ–¹æ¡ˆåªæ˜¯æˆ‘èƒ½æƒ³åˆ°çš„ä¸€ç§æ¯”è¾ƒç®€å•çš„å¤„ç†æ–¹æ³•ï¼Œè‚¯å®šä¼šæœ‰æ›´å¥½çš„å¤„ç†æ–¹å¼ã€‚ä½†æ˜¯æˆªè‡³ç›®å‰ï¼ˆ2020.6.2ï¼‰`groupcache`ä¸­æ²¡æœ‰å¯¹è¿™é‡Œè¿›è¡Œæ”¹è¿›ï¼Œå¦‚æœä»¥åæœ‰æ›´æ–°å¯ä»¥å†å­¦ä¹ ä¸‹\n\n## ç¼“å­˜ç©¿é€\n\næŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œå› ä¸ºä¸å­˜åœ¨åˆ™ä¸ä¼šå†™åˆ°ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šå»è¯·æ±‚ DBï¼Œå¦‚æœç¬é—´æµé‡è¿‡å¤§ï¼Œç©¿é€åˆ° DBå°±ä¼šå¯¼è‡´å®•æœº\n\n### å¤ç°\n\nä½¿ç”¨ä¸Šé¢çš„è„šæœ¬å†æ¬¡å¯åŠ¨`Cache Server`ï¼Œç„¶åç”¨ä¸‹é¢çš„goä»£ç æµ‹è¯•\n\n```go\nfunc main() {\n    for i := 0; i < 5; i++ {\n        wg.Add(1)\n        //go curl(\"resolmi\")\n        //i not exist\n        go  curl(strconv.Itoa(i))\n    }\n    wg.Wait()\n    fmt.Println(\"Done!\")\n}\n\nfunc curl(key string) {\n    res, _ := http.Get(\"http://localhost:9999/api?key=\" + key)\n    bytes, _ := ioutil.ReadAll(res.Body)\n    fmt.Println(string(bytes))\n    wg.Done()\n}\n```\n\n> æ³¨æ„è¿™é‡Œéœ€è¦æ„é€ ä¸åŒçš„keyï¼Œç›¸åŒçš„keyä¼šè¢«å‰é¢çš„`singleFlight`ç»„ä»¶æ‹¦æˆª\n\nç»“æœå¦‚ä¸‹ï¼š\n\n```go\n[ `go run .` | done: 1.8734423s ]\n  1 not exist\n  2 not exist\n  0 not exist\n  4 not exist\n  3 not exist\n  Done!\n```\n\nç„¶åæˆ‘ä»¬çœ‹çœ‹`Server`çš„æƒ…å†µ\n\n![mark](http://static.imlgw.top/blog/20200531/kV5ojfIeddm4.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°ï¼Œ5ä¸ª`key`é€šè¿‡ä¸€è‡´æ€§Hashåˆ†æ•£åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œä½†æ˜¯ç”±äº`DB`ä¸­æ ¹æœ¬å°±æ²¡æœ‰è¿™äº›æ•°æ®ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®å¹¶ä¸ä¼šç¼“å­˜ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šåˆ°`DB`ä¸­å»é‡æ–°æŸ¥è¯¢ï¼Œå¦‚æœçŸ­æ—¶é—´å†…æœ‰å¤§é‡è¯·æ±‚æŸ¥è¯¢è¿™äº›æ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›è¯·æ±‚éƒ½ä¼šç›´æ¥æ‰“åˆ°DBå±‚ï¼Œå°†DBå±‚å‹å®ï¼\n\n### è§£å†³æ–¹æ¡ˆ\n\n**1.ç¼“å­˜ç©ºå¯¹è±¡**\n\nä¹‹æ‰€ä»¥å‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œæ˜¯å› ä¸ºç¼“å­˜ä¸­æ²¡æœ‰å­˜å‚¨è¿™äº›ç©ºæ•°æ®çš„keyï¼Œå¯¼è‡´è¿™äº›è¯·æ±‚å…¨éƒ½æ‰“åˆ°æ•°æ®åº“ä¸Šã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä¸šåŠ¡å±‚çš„ä»£ç ï¼Œå°†æ•°æ®åº“æŸ¥è¯¢ç»“æœä¸ºç©ºçš„keyä¹Ÿå­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚å½“åç»­åˆå‡ºç°è¯¥keyçš„æŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œç¼“å­˜ç›´æ¥è¿”å›nullï¼Œè€Œæ— éœ€æŸ¥è¯¢æ•°æ®åº“ã€‚\n\n**2.å¸ƒéš†è¿‡æ»¤å™¨**\n\nå½“ä¸šåŠ¡å±‚æœ‰æŸ¥è¯¢è¯·æ±‚çš„æ—¶å€™ï¼Œé¦–å…ˆå»`BloomFilter`ä¸­æŸ¥è¯¢è¯¥keyæ˜¯å¦å­˜åœ¨ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨è¯¥æ•°æ®ï¼Œå› æ­¤ç¼“å­˜éƒ½ä¸è¦æŸ¥äº†ï¼Œç›´æ¥è¿”å›nullã€‚è‹¥å­˜åœ¨ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­çš„æµç¨‹ï¼Œå…ˆå‰å¾€ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œç¼“å­˜ä¸­æ²¡æœ‰çš„è¯å†å‰å¾€æ•°æ®åº“ä¸­çš„æŸ¥è¯¢ã€‚\n\nè¿™é‡Œç¬¬ä¸€ä¸ªç§æ–¹æ¡ˆå¯ä»¥ç›´æ¥æ’é™¤ï¼Œä¸€æ–¹é¢å› ä¸ºæˆ‘ä»¬è¿™ä¸ªcacheæ˜¯ä¸èƒ½åˆ é™¤æ•°æ®çš„ï¼Œåªèƒ½è¢«åŠ¨çš„æ·˜æ±°æ•°æ®ï¼Œç¼“å­˜å¤§é‡çš„ç©ºå¯¹è±¡ä¸”å¾—ä¸åˆ°åŠæ—¶çš„åˆ é™¤ä¼šæµªè´¹å¤§é‡å†…å­˜ï¼Œå¦ä¸€æ–¹é¢ï¼Œç¼“å­˜ç©ºå¯¹è±¡çš„åšæ³•ï¼Œå¦‚æœæ¯æ¬¡æŸ¥è¯¢çš„ä¸å­˜åœ¨çš„`key`éƒ½ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ¡ˆä¹Ÿå°±èµ·ä¸åˆ°ä½œç”¨äº†\n\nè‡³äºç¬¬äºŒç§æ–¹æ¡ˆï¼Œå¯è¡Œï¼Œä½†æ˜¯ä¸åº”è¯¥åœ¨ç¼“å­˜å±‚æ¥åšï¼Œåº”è¯¥åœ¨ä¸šåŠ¡å±‚å¤„ç†ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸Šå±‚å¤„ç†ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¼“å­˜ç»„ä»¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œç”¨å¸ƒéš†è¿‡æ»¤å™¨ä½ åªèƒ½åˆ¤æ–­åœ¨**å½“å‰èŠ‚ç‚¹**æœ‰æ²¡æœ‰ï¼Œæ— æ³•åˆ¤æ–­**è¿œç¨‹èŠ‚ç‚¹**æœ‰æ²¡æœ‰ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±è¦å°†æ‰€æœ‰æ•°æ®é¢„çƒ­åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä½†æ˜¯è¿™æ ·æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šéœ€è¦ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ï¼Œè¿™æ ·åšæ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œæ‰€ä»¥ç¼“å­˜ç©¿é€çš„é—®é¢˜åº”è¯¥æ”¾åˆ°åº”ç”¨å±‚å»å¤„ç†\n\n## TODO\n\n- [x] åˆ†å¸ƒå¼èŠ‚ç‚¹é€šä¿¡\n- [x] ä¸€è‡´æ€§Hash\n- [x] ç¼“å­˜å‡»ç©¿\n- [x] çƒ­ç‚¹äº’å¤‡\n- [ ] é…ç½®è§£è€¦\n- [ ] é›†ç¾¤ç®¡ç†","tags":["å¼€æºé¡¹ç›®","Gacache"],"categories":["Web"]},{"title":"Linuxæ–‡ä»¶æƒé™å’Œç›®å½•é…ç½®","url":"/2020/05/27/linux-de-wen-jian-quan-xian-yu-mu-lu-pei-zhi/","content":"\n> æœ¬æ–‡å…¨æ–‡æ‘˜æŠ„è‡ªã€Šé¸Ÿå”çš„LInuxç§æˆ¿èœã€‹ï¼Œå¯¹éƒ¨åˆ†ç”¨è¯åšäº†è½¬æ¢ï¼Œä»…ä¿ç•™äº†æˆ‘æ„Ÿå…´è¶£çš„éƒ¨åˆ†ï¼Œä¾¿äºä»¥åæŸ¥æ‰¾\n\n## Linuxæ–‡ä»¶å±æ€§\n\n`ls -alï¼š` ls æ˜¯ â€œlistâ€ çš„æ„æ€ï¼Œé‡ç‚¹åœ¨æ˜¾ç¤ºæ–‡ä»¶çš„æ–‡ä»¶åä¸ç›¸å…³å±æ€§ã€‚è€Œé€‰é¡¹ â€œ-alâ€ åˆ™è¡¨ç¤ºåˆ—å‡ºæ‰€æœ‰çš„æ–‡ä»¶è¯¦ç»†çš„æƒé™ä¸å±æ€§ ï¼ˆåŒ…å«éšè—æ–‡ä»¶ï¼Œå°±æ˜¯æ–‡ä»¶åç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º â€œ . â€ çš„æ–‡ä»¶ï¼‰\n\n![YIhreU.png](https://s1.ax1x.com/2020/05/19/YIhreU.png)\n\n- ç¬¬ä¸€æ ä»£è¡¨è¿™ä¸ªæ–‡ä»¶çš„ç±»å‹ä¸æƒé™ï¼ˆ permission ï¼‰\n    - ç¬¬ä¸€ä¸ªå­—ç¬¦ä»£è¡¨è¿™ä¸ªæ–‡ä»¶æ˜¯ â€œ ç›®å½•ã€æ–‡ä»¶æˆ–é“¾æ¥æ–‡ä»¶ç­‰ç­‰ â€ ï¼š\n      - å½“ä¸º `[ d ]` åˆ™æ˜¯ç›®å½•ï¼Œä¾‹å¦‚ä¸Šè¡¨æ–‡ä»¶åä¸º â€œbootâ€ çš„é‚£ä¸€è¡Œï¼›\n      - å½“ä¸º `[ - ]` åˆ™æ˜¯æ–‡ä»¶ï¼Œä¾‹å¦‚ä¸Šè¡¨æ–‡ä»¶åä¸º â€œ.autorelabelâ€ é‚£ä¸€è¡Œï¼›\n      - è‹¥æ˜¯ `[ l ]` åˆ™è¡¨ç¤ºä¸ºé“¾æ¥æ–‡ä»¶ï¼ˆ link file ï¼‰ï¼›\n      - è‹¥æ˜¯ `[ b ]` åˆ™è¡¨ç¤ºä¸ºè®¾å¤‡æ–‡ä»¶é‡Œé¢çš„å¯ä¾›å‚¨å­˜çš„å‘¨è¾¹è®¾å¤‡ï¼ˆå¯éšæœºå­˜å–è®¾å¤‡ï¼‰ï¼›\n      - è‹¥æ˜¯ `[ c ]` åˆ™è¡¨ç¤ºä¸ºè®¾å¤‡æ–‡ä»¶é‡Œé¢çš„åºåˆ—åŸ è®¾å¤‡ï¼Œä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡ï¼ˆä¸€æ¬¡æ€§è¯»å–è®¾å¤‡ï¼‰ã€‚\n\n    - æ¥ä¸‹æ¥çš„å­—ç¬¦ä¸­ï¼Œä»¥ä¸‰ä¸ªä¸ºä¸€ç»„ï¼Œä¸”å‡ä¸º â€œ`rwx`â€ çš„ä¸‰ä¸ªå‚æ•°çš„ç»„åˆã€‚å…¶ä¸­ï¼Œ [ r ] ä»£è¡¨å¯è¯»ï¼ˆ read ï¼‰ã€ [ w ] ä»£è¡¨å¯å†™ï¼ˆ write ï¼‰ã€ [ x ] ä»£è¡¨å¯æ‰§è¡Œï¼ˆ execute ï¼‰ã€‚ è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸‰ä¸ªæƒé™çš„ä½ç½®ä¸ä¼šæ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œå°±ä¼šå‡ºç°å‡å· [ - ] è€Œå·²ã€‚\n\n      - ç¬¬ä¸€ç»„ä¸º â€œ æ–‡ä»¶æ‹¥æœ‰è€…å¯å…·å¤‡çš„æƒé™ â€ ï¼Œä»¥ â€œ.autorelabelâ€ é‚£ä¸ªæ–‡ä»¶ä¸ºä¾‹ï¼Œ è¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…å¯ä»¥è¯»-\n\n        å†™ï¼Œä½†ä¸å¯æ‰§è¡Œï¼›\n\n      - ç¬¬äºŒç»„ä¸º â€œ åŠ å…¥æ­¤ç¾¤ç»„ä¹‹åå¸å·çš„æƒé™ â€ ï¼›\n\n      - ç¬¬ä¸‰ç»„ä¸º â€œ éæœ¬äººä¸”æ²¡æœ‰åŠ å…¥æœ¬ç¾¤ç»„ä¹‹å…¶ä»–å¸å·çš„æƒé™ â€ ã€‚\n\n- ç¬¬äºŒæ è¡¨ç¤ºæœ‰å¤šå°‘æ–‡ä»¶åé“¾æ¥åˆ°æ­¤èŠ‚ç‚¹ï¼ˆ i-node ï¼‰\n\n- ç¬¬ä¸‰æ è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„ â€œ æ‹¥æœ‰è€…å¸å· â€\n\n- ç¬¬å››æ è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶çš„æ‰€å±ç¾¤ç»„\n\n- ç¬¬äº”æ ä¸ºè¿™ä¸ªæ–‡ä»¶çš„å®¹é‡å¤§å°ï¼Œé»˜è®¤å•ä½ä¸º Bytes \n\n- ç¬¬å…­æ ä¸ºè¿™ä¸ªæ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸæˆ–è€…æ˜¯æœ€è¿‘çš„ä¿®æ”¹æ—¥æœŸï¼š\n\n    > æœ‰çš„å¹´ä»£è¿‡äºä¹…è¿œçš„å¯èƒ½åªä¼šæ˜¾ç¤ºå¹´ä»½ï¼Œå¦‚æœæƒ³è¦æ˜¾ç¤ºå®Œæ•´çš„æ—¶é—´æ ¼å¼ï¼Œå¯ä»¥åˆ©ç”¨ ls çš„é€‰é¡¹ï¼Œäº¦å³ï¼š â€œls -l --full-timeâ€ å°±èƒ½å¤Ÿæ˜¾ç¤ºå‡ºå®Œæ•´çš„æ—¶é—´æ ¼å¼äº†ï¼åŒ…æ‹¬å¹´ã€æœˆã€æ—¥ã€æ—¶é—´\n\n- ç¬¬ä¸ƒæ ä¸ºè¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å\n\n  è¿™ä¸ªå­—æ®µå°±æ˜¯æ–‡ä»¶åäº†ã€‚æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼šå¦‚æœæ–‡ä»¶åä¹‹å‰å¤šä¸€ä¸ª â€œ . â€ ï¼Œåˆ™ä»£è¡¨è¿™ä¸ªæ–‡ä»¶ä¸º â€œ éšè—æ–‡ä»¶ â€ ï¼Œä¾‹å¦‚ä¸Šè¡¨ä¸­çš„ .autorelabelé‚£ä¸€è¡Œï¼Œè¯¥æ–‡ä»¶å°±æ˜¯éšè—æ–‡ä»¶ï¼Œä½¿ç”¨ `-a`å¯ä»¥æŸ¥çœ‹åˆ°\n\n### æ”¹å˜æ–‡ä»¶å±æ€§\n\n#### æ”¹å˜æ‰€å±ç¾¤ç»„ , chgrp\n\næ”¹å˜ä¸€ä¸ªæ–‡ä»¶çš„ç¾¤ç»„çœŸæ˜¯å¾ˆç®€å•çš„ï¼Œç›´æ¥ä»¥ chgrp æ¥æ”¹å˜å³å¯ï¼Œå’¦ï¼è¿™ä¸ªæŒ‡ä»¤å°±æ˜¯ change group çš„ç¼©å†™å˜›ï¼è¿™æ ·å°±å¾ˆå¥½è®°äº†å§ï¼ ^_^ ã€‚ä¸è¿‡ï¼Œè¯·è®°å¾—ï¼Œè¦è¢«æ”¹å˜çš„ç¾¤ç»„åç§°å¿…é¡»è¦åœ¨ /etc/group æ–‡ä»¶å†…å­˜åœ¨æ‰è¡Œï¼Œå¦åˆ™å°±ä¼šæ˜¾ç¤ºé”™è¯¯ï¼Œ -Rå¯ä»¥é€’å½’æ›´æ”¹æƒé™\n\n#### æ”¹å˜æ–‡ä»¶æ‹¥æœ‰è€… , chown\n\nå¦‚ä½•æ”¹å˜ä¸€ä¸ªæ–‡ä»¶çš„æ‹¥æœ‰è€…å‘¢ï¼Ÿå¾ˆç®€å•å‘€ï¼æ—¢ç„¶æ”¹å˜ç¾¤ç»„æ˜¯ change group ï¼Œé‚£ä¹ˆæ”¹å˜æ‹¥æœ‰è€…å°±æ˜¯ change owner å•°ï¼ BINGO ï¼é‚£å°±æ˜¯chown è¿™ä¸ªæŒ‡ä»¤çš„ç”¨é€”ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œ ä½¿ç”¨è€…å¿…é¡»æ˜¯å·²ç»å­˜åœ¨ç³»ç»Ÿä¸­çš„å¸å·ï¼Œä¹Ÿå°±æ˜¯åœ¨ /etc/passwd è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰çºªå½•çš„ä½¿ç”¨è€…åç§°æ‰èƒ½æ”¹å˜ã€‚-Rå¯ä»¥é€’å½’æ›´æ”¹æƒé™\n\nchown è¿˜å¯ä»¥é¡ºä¾¿ç›´æ¥ä¿®æ”¹ç¾¤ç»„çš„åç§° ï¼šâ€œ `chown user.group file`â€ï¼Œäº¦å³åœ¨æ‹¥æœ‰è€…ä¸ç¾¤ç»„é—´åŠ ä¸Šå°æ•°ç‚¹\n\n> çŸ¥é“å¦‚ä½•æ”¹å˜æ–‡ä»¶çš„ç¾¤ç»„ä¸æ‹¥æœ‰è€…äº†ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™è¦ä½¿ç”¨ chown æˆ– chgrp å‘¢ï¼Ÿæˆ–è®¸ä½ ä¼šè§‰å¾—å¥‡æ€ªå§ï¼Ÿ æ˜¯çš„ï¼Œç¡®å®æœ‰æ—¶å€™éœ€è¦å˜æ›´æ–‡ä»¶çš„æ‹¥æœ‰è€…çš„ï¼Œæœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯åœ¨å¤åˆ¶æ–‡ä»¶ç»™ä½ ä¹‹å¤–çš„å…¶ä»–äººæ—¶ï¼Œcpå¤åˆ¶äº†æ–‡ä»¶ä½†æ˜¯å±æ€§å¹¶æ²¡æœ‰å˜ï¼Œè¿™ä¸ªæ—¶å€™åˆ«äººä»ç„¶çœ‹ä¸è§ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹æ–‡ä»¶å±æ€§\n\n#### æ”¹å˜æƒé™ , chmod\n\n- æ•°å­—ç±»å‹æ”¹å˜æ–‡ä»¶æƒé™\n\n  Linux æ–‡ä»¶çš„åŸºæœ¬æƒé™å°±æœ‰ä¹ä¸ªï¼Œåˆ†åˆ«æ˜¯ owner/group/others ä¸‰ç§èº«ä»½å„æœ‰è‡ªå·±çš„ read/write/execute æƒé™ï¼Œ å…ˆå¤ä¹ ä¸€ä¸‹åˆšåˆšä¸Šé¢æåˆ°çš„æ•°æ®ï¼šæ–‡ä»¶çš„æƒé™å­—ç¬¦ä¸ºï¼š â€œ-rwxrwxrwxâ€ ï¼Œ è¿™ä¹ä¸ªæƒé™æ˜¯ä¸‰ä¸ªä¸‰ä¸ªä¸€ç»„çš„ï¼å…¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°å­—æ¥ä»£è¡¨å„ä¸ªæƒé™ï¼Œå„æƒé™çš„åˆ†æ•°å¯¹ç…§è¡¨å¦‚ä¸‹ï¼š\n\n  | r    | 4    |\n  | ---- | ---- |\n  | w    | 2    |\n  | x    | 1    |\n\n  æ¯ç§èº«ä»½ï¼ˆ owner/group/others ï¼‰å„è‡ªçš„ä¸‰ä¸ªæƒé™ï¼ˆ r/w/x ï¼‰åˆ†æ•°æ˜¯éœ€è¦ç´¯åŠ çš„ï¼Œä¾‹å¦‚å½“æƒé™ä¸ºï¼š [-rwxrwx---] åˆ†æ•°åˆ™æ˜¯ï¼š\n  owner = rwx = 4+2+1 = 7\n  group = rwx = 4+2+1 = 7\n  others= --- = 0+0+0 = 0\n  æ‰€ä»¥ç­‰ä¸€ä¸‹æˆ‘ä»¬è®¾ç½®æƒé™çš„å˜æ›´æ—¶ï¼Œè¯¥æ–‡ä»¶çš„æƒé™æ•°å­—å°±æ˜¯ 770 å•¦\n\n  å‘½ä»¤ï¼š`chmod [-R] xyz æ–‡ä»¶æˆ–ç›®å½•`\n\n- ç¬¦å·ç±»å‹æ”¹å˜æ–‡ä»¶æƒé™\n\n  è¿˜æœ‰ä¸€ä¸ªæ”¹å˜æƒé™çš„æ–¹æ³•å‘¦ï¼ä»ä¹‹å‰çš„ä»‹ç»ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒåŸºæœ¬ä¸Šå°±ä¹ä¸ªæƒé™åˆ†åˆ«æ˜¯ï¼ˆ 1 ï¼‰ user ï¼ˆ 2 ï¼‰ group ï¼ˆ 3 ï¼‰ others ä¸‰ç§èº«ä»½å•¦ï¼é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å€Ÿç”± u, g, o æ¥ä»£è¡¨ä¸‰ç§èº«ä»½çš„æƒé™ï¼æ­¤å¤–ï¼Œ a åˆ™ä»£è¡¨ all äº¦å³å…¨éƒ¨çš„èº«ä»½ï¼é‚£ä¹ˆè¯»å†™çš„æƒé™å°±å¯ä»¥å†™æˆ r, w, x å•°ï¼+ (åŠ å…¥)ï¼Œ-(é™¤å») ï¼Œ=(è®¾ç½®)\n\n  > '+'ä¸'â€“'çš„çŠ¶æ€ä¸‹ï¼Œåªè¦æ˜¯æ²¡æœ‰æŒ‡å®šåˆ°çš„é¡¹ç›®ï¼Œåˆ™è¯¥æƒé™ â€œ ä¸ä¼šè¢«å˜åŠ¨ â€ ï¼Œè€Œ=æ˜¯ç›´æ¥è®¾ç½®\n\n  å‘½ä»¤ï¼š`chmod u+x file` ï¼Œ`chmod u=x,g=rw file`\n\n#### æƒé™çš„æ„ä¹‰\n\n**æ–‡ä»¶çš„æƒé™**\n\n- r ï¼ˆ read ï¼‰ï¼šå¯è¯»å–æ­¤ä¸€æ–‡ä»¶çš„å®é™…å†…å®¹ï¼Œå¦‚è¯»å–æ–‡æœ¬æ–‡ä»¶çš„æ–‡å­—å†…å®¹ç­‰\n- w ï¼ˆ write ï¼‰ï¼šå¯ä»¥ç¼–è¾‘ã€æ–°å¢æˆ–è€…æ˜¯ä¿®æ”¹è¯¥æ–‡ä»¶çš„å†…å®¹ï¼ˆ**ä½†ä¸å«åˆ é™¤è¯¥æ–‡ä»¶**ï¼‰\n- x ï¼ˆ execute ï¼‰ï¼šè¯¥æ–‡ä»¶å…·æœ‰å¯ä»¥è¢«ç³»ç»Ÿæ‰§è¡Œçš„æƒé™\n\n**ç›®å½•çš„æƒé™**\n\n- r ï¼ˆ read contents in directory ï¼‰ï¼šè¡¨ç¤ºå…·æœ‰è¯»å–ç›®å½•ç»“æ„æ¸…å•çš„æƒé™ï¼Œæ‰€ä»¥å½“ä½ å…·æœ‰è¯»å–ï¼ˆ r ï¼‰ä¸€ä¸ªç›®å½•çš„æƒé™æ—¶ï¼Œè¡¨ç¤ºä½ å¯ä»¥æŸ¥è¯¢è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶åæ•°æ®ã€‚ æ‰€ä»¥ä½ å°±å¯ä»¥åˆ©ç”¨ ls è¿™ä¸ªæŒ‡ä»¤å°†è¯¥ç›®å½•çš„å†…å®¹åˆ—è¡¨æ˜¾ç¤ºå‡ºæ¥\n\n- w ï¼ˆ modify contents of directory ï¼‰ï¼šè¿™ä¸ªå¯å†™å…¥çš„æƒé™å¯¹ç›®å½•æ¥è¯´ï¼Œæ˜¯å¾ˆäº†ä¸èµ·çš„ï¼ å› ä¸ºä»–è¡¨ç¤ºä½ å…·æœ‰æ”¹å˜è¯¥ç›®å½•ç»“æ„çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™äº›æƒé™ï¼šåˆ›å»ºæ–°çš„æ–‡ä»¶ä¸ç›®å½•ï¼›**åˆ é™¤å·²ç»å­˜åœ¨çš„æ–‡ä»¶ä¸ç›®å½•**ï¼ˆä¸è®ºè¯¥æ–‡ä»¶çš„æƒé™ä¸ºä½•ï¼ï¼‰å°†å·²å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œæ›´åï¼›æ¬ç§»è¯¥ç›®å½•å†…çš„æ–‡ä»¶ã€ç›®å½•ä½ç½®ã€‚æ€»ä¹‹ï¼Œç›®å½•çš„ w æƒé™å°±ä¸è¯¥ç›®å½•ä¸‹é¢çš„æ–‡ä»¶åæ”¹å˜æœ‰å…³å°±å¯¹äº†å•¦ï¼\n\n  > è‡ªå·±æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå¼€äº†wè¿˜æ˜¯ä¸èƒ½åˆ ä¹Ÿä¸èƒ½åŠ ä¹Ÿä¸èƒ½æ”¹ï¼Œå®é™…ä¸Šè¿™é‡Œä¹¦ä¸Šæ²¡æœ‰ä»‹ç»æ¸…æ¥šï¼Œè¿™ä¸ªwæƒé™åªæœ‰åœ¨xæƒé™æ‰“å¼€ä¹‹åæ‰æœ‰ç”¨ï¼ˆå…¶å®æƒ³ä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œå¦‚æœwæœ‰è¿™ä¹ˆå¤šæƒé™ï¼Œé‚£è¿˜è¦xå¹²å˜›ï¼‰\n\n- x ï¼ˆ access directory ï¼‰ï¼šèƒ½å¦è¿›å…¥ç›®å½•ï¼ˆcdï¼‰\n\n## FHS\n\n### æ ¹ç›®å½• ï¼ˆ / ï¼‰ çš„æ„ä¹‰ä¸å†…å®¹ï¼š\n\nå› æ­¤ FHS å®šä¹‰å‡ºæ ¹ç›®å½•ï¼ˆ / ï¼‰ä¸‹é¢åº”è¯¥è¦æœ‰ä¸‹é¢è¿™äº›æ¬¡ç›®å½•çš„å­˜åœ¨æ‰å¥½ï¼Œå³ä½¿æ²¡æœ‰å®ä½“ç›®å½•ï¼Œ FHS ä¹Ÿå¸Œæœ›è‡³å°‘æœ‰é“¾æ¥æ–‡ä»¶å­˜åœ¨æ‰å¥½\n**FHS è¦æ±‚å¿…é¡»è¦å­˜åœ¨çš„ç›®å½•**\n\n- `/bin:` ç³»ç»Ÿæœ‰å¾ˆå¤šæ”¾ç½®å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•ï¼Œä½† /bin æ¯”è¾ƒç‰¹æ®Šã€‚å› ä¸º /bin æ”¾ç½®çš„æ˜¯åœ¨å•äººç»´æŠ¤æ¨¡å¼ä¸‹è¿˜èƒ½å¤Ÿè¢«æ“ä½œçš„æŒ‡ä»¤ã€‚ åœ¨ /bin ä¸‹é¢çš„æŒ‡ä»¤å¯ä»¥è¢« root ä¸ä¸€èˆ¬å¸å·æ‰€ä½¿ç”¨ï¼Œä¸»è¦æœ‰ï¼š cat, chmod, chown, date, mv, mkdir, cp, bash ç­‰ç­‰å¸¸ç”¨çš„æŒ‡ä»¤ã€‚\n- `/boot:` è¿™ä¸ªç›®å½•ä¸»è¦åœ¨æ”¾ç½®å¼€æœºä¼šä½¿ç”¨åˆ°çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ Linux æ ¸å¿ƒæ–‡ä»¶ä»¥åŠå¼€æœºèœå•ä¸å¼€æœºæ‰€éœ€é…ç½®æ–‡ä»¶ç­‰ç­‰ã€‚ Linux kernel å¸¸ç”¨çš„æ–‡ä»¶åä¸ºï¼š vmlinuz ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ grub2 è¿™ä¸ªå¼€æœºç®¡ç†ç¨‹åºï¼Œ åˆ™è¿˜ä¼šå­˜åœ¨ /boot/grub2/ è¿™ä¸ªç›®å½•\n- `/dev:` åœ¨ Linux ç³»ç»Ÿä¸Šï¼Œä»»ä½•è®¾å¤‡ä¸å‘¨è¾¹è®¾å¤‡éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å‹æ€å­˜åœ¨äºè¿™ä¸ªç›®å½•å½“ä¸­çš„ã€‚ ä½ åªè¦é€šè¿‡å­˜å–è¿™ä¸ªç›®å½•ä¸‹é¢çš„æŸä¸ªæ–‡ä»¶ï¼Œå°±ç­‰äºå­˜å–æŸä¸ªè®¾å¤‡å•°ï½ æ¯”è¦é‡è¦çš„æ–‡ä»¶æœ‰ /dev/null, /dev/zero, /dev/tty, /dev/loop, /dev/sd ç­‰ç­‰\n- `/etc:` ç³»ç»Ÿä¸»è¦çš„é…ç½®æ–‡ä»¶å‡ ä¹éƒ½æ”¾ç½®åœ¨è¿™ä¸ªç›®å½•å†…ï¼Œä¾‹å¦‚äººå‘˜çš„å¸å·å¯†ç ã€ å„ç§æœåŠ¡çš„é…ç½®ç­‰ç­‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„å„æ–‡ä»¶å±æ€§æ˜¯å¯ä»¥è®©ä¸€èˆ¬ä½¿ç”¨è€…æŸ¥é˜…çš„ï¼Œ ä½†æ˜¯åªæœ‰ root æœ‰æƒåŠ›ä¿®æ”¹ã€‚ FHS å»ºè®®ä¸è¦æ”¾ç½®å¯å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ binary ï¼‰åœ¨è¿™ä¸ªç›®å½•ä¸­å–”ã€‚æ¯”è¾ƒé‡è¦çš„æ–‡ä»¶æœ‰ï¼š /etc/modprobe.d/, /etc/passwd, /etc/fstabç­‰ç­‰\n- `/lib:`ç³»ç»Ÿçš„å‡½æ•°åº“éå¸¸çš„å¤šï¼Œè€Œ /lib æ”¾ç½®çš„åˆ™æ˜¯åœ¨å¼€æœºæ—¶ä¼šç”¨åˆ°çš„å‡½æ•°åº“ï¼Œ ä»¥åŠåœ¨ /bin æˆ– /sbin ä¸‹é¢çš„æŒ‡ä»¤ä¼šè°ƒç”¨çš„å‡½æ•°åº“è€Œå·²ã€‚ä»€ä¹ˆæ˜¯å‡½æ•°åº“å‘¢ï¼Ÿä½ å¯ä»¥å°†ä»–æƒ³æˆæ˜¯ â€œ å¤–æŒ‚ â€ ï¼ŒæŸäº›æŒ‡ä»¤å¿…é¡»è¦æœ‰è¿™äº› â€œ å¤–æŒ‚ â€ æ‰èƒ½å¤Ÿé¡ºåˆ©å®Œæˆç¨‹åºçš„æ‰§è¡Œä¹‹æ„ã€‚ å¦å¤– FSH è¿˜è¦æ±‚ä¸‹é¢çš„ç›®å½•å¿…é¡»è¦å­˜åœ¨ï¼š/lib/modules/ ï¼šè¿™ä¸ªç›®å½•ä¸»è¦æ”¾ç½®å¯æŠ½æ¢å¼çš„æ ¸å¿ƒç›¸å…³æ¨¡å—ï¼ˆé©±åŠ¨ç¨‹åºï¼‰å–”ï¼\n- `/media: `media æ˜¯ â€œ åª’ä½“ â€ çš„è‹±æ–‡ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ª /media ä¸‹é¢æ”¾ç½®çš„å°±æ˜¯å¯ç§»é™¤çš„è®¾å¤‡å•¦ï¼ åŒ…æ‹¬è½¯ç›˜ã€å…‰ç›˜ã€ DVD ç­‰ç­‰è®¾å¤‡éƒ½æš‚æ—¶æŒ‚è½½äºæ­¤ã€‚å¸¸è§çš„æ–‡ä»¶åæœ‰ï¼š /media/floppy, /media/cdrom ç­‰ç­‰ã€‚\n- `/mnt:` å¦‚æœä½ æƒ³è¦æš‚æ—¶æŒ‚è½½æŸäº›é¢å¤–çš„è®¾å¤‡ï¼Œä¸€èˆ¬å»ºè®®ä½ å¯ä»¥æ”¾ç½®åˆ°è¿™ä¸ªç›®å½•ä¸­ã€‚ åœ¨å¤æ—©æ—¶å€™ï¼Œè¿™ä¸ªç›®å½•çš„ç”¨é€”ä¸ /media ç›¸åŒï¼Œåªæ˜¯æœ‰äº† /media ä¹‹åï¼Œè¿™ä¸ªç›®å½•å°±ç”¨æ¥æš‚æ—¶æŒ‚è½½ç”¨äº†\n- `/opt:` è¿™ä¸ªæ˜¯ç»™ç¬¬ä¸‰æ–¹è½¯ä»¶æ”¾ç½®çš„ç›®å½•ã€‚ä»€ä¹ˆæ˜¯ç¬¬ä¸‰æ–¹è½¯ä»¶å•Šï¼Ÿ ä¸¾ä¾‹æ¥è¯´ï¼Œ KDE è¿™ä¸ªæ¡Œé¢ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è½¯ä»¶ï¼Œä¸è¿‡ä»–å¯ä»¥å®‰è£…åˆ° Linux ç³»ç»Ÿä¸­ï¼Œå› æ­¤ KDE çš„è½¯ä»¶å°±å»ºè®®æ”¾ç½®åˆ°æ­¤ç›®å½•ä¸‹äº†ã€‚ å¦å¤–ï¼Œå¦‚æœä½ æƒ³è¦è‡ªè¡Œå®‰è£…é¢å¤–çš„è½¯ä»¶ï¼ˆéåŸæœ¬çš„ distribution æä¾›çš„ï¼‰ï¼Œé‚£ä¹ˆä¹Ÿèƒ½å¤Ÿå°†ä½ çš„è½¯ä»¶å®‰è£…åˆ°è¿™é‡Œæ¥ã€‚ ä¸è¿‡ï¼Œä»¥å‰çš„ Linux ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¹ æƒ¯æ”¾ç½®åœ¨ /usr/local ç›®å½•ä¸‹\n- `/run:`æ—©æœŸçš„ FHS è§„å®šç³»ç»Ÿå¼€æœºåæ‰€äº§ç”Ÿçš„å„é¡¹ä¿¡æ¯åº”è¯¥è¦æ”¾ç½®åˆ° /var/run ç›®å½•ä¸‹ï¼Œæ–°ç‰ˆçš„ FHS åˆ™è§„èŒƒåˆ° /run ä¸‹é¢ã€‚ ç”±äº /run å¯ä»¥ä½¿ç”¨å†…å­˜æ¥ä»¿çœŸï¼Œå› æ­¤æ€§èƒ½ä¸Šä¼šå¥½å¾ˆå¤šï¼\n- `/sbin:` Linux æœ‰éå¸¸å¤šæŒ‡ä»¤æ˜¯ç”¨æ¥è®¾ç½®ç³»ç»Ÿç¯å¢ƒçš„ï¼Œè¿™äº›æŒ‡ä»¤åªæœ‰ root æ‰èƒ½å¤Ÿåˆ©ç”¨æ¥ â€œ è®¾ç½® â€ ç³»ç»Ÿï¼Œå…¶ä»–ä½¿ç”¨è€…æœ€å¤šåªèƒ½ç”¨æ¥ â€œ æŸ¥è¯¢ â€ è€Œå·²ã€‚ æ”¾åœ¨ /sbin ä¸‹é¢çš„ä¸ºå¼€æœºè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„ï¼Œé‡Œé¢åŒ…æ‹¬äº†å¼€æœºã€ä¿®å¤ã€è¿˜åŸç³»ç»Ÿæ‰€éœ€è¦çš„æŒ‡ä»¤ã€‚ è‡³äºæŸäº›æœåŠ¡å™¨è½¯ä»¶ç¨‹åºï¼Œä¸€èˆ¬åˆ™æ”¾ç½®åˆ° /usr/sbin/ å½“ä¸­ã€‚è‡³äºæœ¬æœºè‡ªè¡Œå®‰è£…çš„è½¯ä»¶æ‰€äº§ç”Ÿçš„ç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ system binary ï¼‰ï¼Œ åˆ™æ”¾ç½®åˆ° /usr/local/sbin/ å½“ä¸­äº†ã€‚å¸¸è§çš„æŒ‡ä»¤åŒ…æ‹¬ï¼š fdisk, fsck, ifconfig, mkfs ç­‰ç­‰ã€‚\n- `/srv:` srv å¯ä»¥è§†ä¸º â€œserviceâ€ çš„ç¼©å†™ï¼Œæ˜¯ä¸€äº›ç½‘ç»œæœåŠ¡å¯åŠ¨ä¹‹åï¼Œè¿™äº›æœåŠ¡æ‰€éœ€è¦å–ç”¨çš„æ•°æ®ç›®å½•ã€‚ å¸¸è§çš„æœåŠ¡ä¾‹å¦‚ WWW, FTP ç­‰ç­‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ WWW æœåŠ¡å™¨éœ€è¦çš„ç½‘é¡µæ•°æ®å°±å¯ä»¥æ”¾ç½®åœ¨ /srv/www/ é‡Œé¢ã€‚ ä¸è¿‡ï¼Œç³»ç»Ÿçš„æœåŠ¡æ•°æ®å¦‚æœå°šæœªè¦æä¾›ç»™ç½‘é™…ç½‘ç»œä»»ä½•äººæµè§ˆçš„è¯ï¼Œé»˜è®¤è¿˜æ˜¯å»ºè®®æ”¾ç½®åˆ° /var/lib ä¸‹é¢å³å¯ã€‚\n- `/tmp:` è¿™æ˜¯è®©ä¸€èˆ¬ä½¿ç”¨è€…æˆ–è€…æ˜¯æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºæš‚æ—¶æ”¾ç½®æ–‡ä»¶çš„åœ°æ–¹ã€‚ è¿™ä¸ªç›®å½•æ˜¯ä»»ä½•äººéƒ½èƒ½å¤Ÿå­˜å–çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦å®šæœŸçš„æ¸…ç†ä¸€ä¸‹ã€‚å½“ç„¶ï¼Œé‡è¦æ•°æ®ä¸å¯æ”¾ç½®åœ¨æ­¤ç›®å½•å•Šï¼ å› ä¸º FHS ç”šè‡³å»ºè®®åœ¨å¼€æœºæ—¶ï¼Œåº”è¯¥è¦å°† /tmp ä¸‹çš„æ•°æ®éƒ½åˆ é™¤\n\n**FHS å»ºè®®å¯ä»¥å­˜åœ¨çš„ç›®å½•**\n\n- `/home:`è¿™æ˜¯ç³»ç»Ÿé»˜è®¤çš„ä½¿ç”¨è€…ä¸»æ–‡ä»¶å¤¹ï¼ˆ home directory ï¼‰ã€‚åœ¨ä½ æ–°å¢ä¸€ä¸ªä¸€èˆ¬ä½¿ç”¨è€…å¸å·æ—¶ï¼Œ é»˜è®¤çš„ä½¿ç”¨è€…ä¸»æ–‡ä»¶å¤¹éƒ½ä¼šè§„èŒƒåˆ°è¿™é‡Œæ¥ã€‚æ¯”è¾ƒé‡è¦çš„æ˜¯ï¼Œä¸»æ–‡ä»¶å¤¹æœ‰ä¸¤ç§ä»£å·å–”ï¼š\n  ~ ï¼šä»£è¡¨ç›®å‰è¿™ä¸ªä½¿ç”¨è€…çš„ä¸»æ–‡ä»¶å¤¹\n  ~dmtsai ï¼šåˆ™ä»£è¡¨ dmtsai çš„ä¸»æ–‡ä»¶å¤¹ï¼\n- `/root:`ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆ root ï¼‰çš„ä¸»æ–‡ä»¶å¤¹ã€‚ä¹‹æ‰€ä»¥æ”¾åœ¨è¿™é‡Œï¼Œæ˜¯å› ä¸ºå¦‚æœè¿›å…¥å•äººç»´æŠ¤æ¨¡å¼è€Œä»…æŒ‚è½½æ ¹ç›®å½•æ—¶ï¼Œ è¯¥ç›®å½•å°±èƒ½å¤Ÿæ‹¥æœ‰root çš„ä¸»æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå¸Œæœ› root çš„ä¸»æ–‡ä»¶å¤¹ä¸æ ¹ç›®å½•æ”¾ç½®åœ¨åŒä¸€ä¸ªåˆ†åŒºä¸­ã€‚\n  äº‹å®ä¸Š FHS é’ˆå¯¹æ ¹ç›®å½•æ‰€å®šä¹‰çš„æ ‡å‡†å°±ä»…æœ‰ä¸Šé¢çš„ï¼Œä¸è¿‡æˆ‘ä»¬çš„ Linux ä¸‹é¢è¿˜æœ‰è®¸å¤šç›®å½•ä½ ä¹Ÿéœ€è¦äº†è§£ä¸€ä¸‹\n- `/lost+found:` è¿™ä¸ªç›®å½•æ˜¯ä½¿ç”¨æ ‡å‡†çš„ ext2/ext3/ext4 æ–‡ä»¶ç³»ç»Ÿæ ¼å¼æ‰ä¼šäº§ç”Ÿçš„ä¸€ä¸ªç›®å½•ï¼Œç›®çš„åœ¨äºå½“æ–‡ä»¶ç³»ç»Ÿå‘ç”Ÿé”™è¯¯æ—¶ï¼Œ å°†ä¸€äº›é—å¤±çš„ç‰‡æ®µæ”¾ç½®åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚ä¸è¿‡å¦‚æœä½¿ç”¨çš„æ˜¯ xfs æ–‡ä»¶ç³»ç»Ÿçš„è¯ï¼Œå°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªç›®å½•äº†ï¼\n- `/proc:` è¿™ä¸ªç›®å½•æœ¬èº«æ˜¯ä¸€ä¸ª â€œ è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆ virtual filesystem ï¼‰ â€ å–”ï¼ä»–æ”¾ç½®çš„æ•°æ®éƒ½æ˜¯åœ¨å†…å­˜å½“ä¸­ï¼Œ ä¾‹å¦‚ç³»ç»Ÿæ ¸å¿ƒã€è¡Œç¨‹ä¿¡æ¯ï¼ˆ process ï¼‰ã€å‘¨è¾¹è®¾å¤‡çš„çŠ¶æ€åŠç½‘ç»œçŠ¶æ€ç­‰ç­‰ã€‚å› ä¸ºè¿™ä¸ªç›®å½•ä¸‹çš„æ•°æ®éƒ½æ˜¯åœ¨å†…å­˜å½“ä¸­ï¼Œ æ‰€ä»¥æœ¬èº«ä¸å ä»»ä½•ç¡¬ç›˜ç©ºé—´å•Šï¼\n  æ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ä¾‹å¦‚ï¼š /proc/cpuinfo, /proc/dma, /proc/interrupts, /proc/ioports, /proc/net/* ç­‰ç­‰ã€‚\n- `/sys:` è¿™ä¸ªç›®å½•å…¶å®è·Ÿ /proc éå¸¸ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸»è¦ä¹Ÿæ˜¯è®°å½•æ ¸å¿ƒä¸ç³»ç»Ÿç¡¬ä»¶ä¿¡æ¯è¾ƒç›¸å…³çš„ä¿¡æ¯ã€‚ åŒ…æ‹¬ç›®å‰å·²è½½å…¥çš„æ ¸å¿ƒæ¨¡å—ä¸æ ¸å¿ƒä¾¦æµ‹åˆ°çš„ç¡¬ä»¶è®¾å¤‡ä¿¡æ¯ç­‰ç­‰ã€‚è¿™ä¸ªç›®å½•åŒæ ·ä¸å ç¡¬ç›˜å®¹é‡å–”ï¼\n\næ—©æœŸ Linux åœ¨è®¾è®¡çš„æ—¶å€™ï¼Œè‹¥å‘ç”Ÿé—®é¢˜æ—¶ï¼Œæ•‘æ´æ¨¡å¼é€šå¸¸ä»…æŒ‚è½½æ ¹ç›®å½•è€Œå·²ï¼Œå› æ­¤æœ‰äº”ä¸ªé‡è¦çš„ç›®å½•è¢«è¦æ±‚ä¸€å®šè¦ä¸æ ¹ç›®å½•æ”¾ç½®åœ¨ä¸€èµ·ï¼Œ é‚£å°±æ˜¯ `/etc`, `/bin`, `/dev`, `/lib`, `/sbin` è¿™äº”ä¸ªé‡è¦ç›®å½•ã€‚ç°åœ¨è®¸å¤šçš„ Linux distributions ç”±äºå·²ç»å°†è®¸å¤šéå¿…è¦çš„æ–‡ä»¶ç§»å‡º /usr ä¹‹å¤–äº†ï¼Œ æ‰€ä»¥ /usr ä¹Ÿæ˜¯è¶Šæ¥è¶Šç²¾ç®€ï¼ŒåŒæ—¶å› ä¸º /usr è¢«å»ºè®®ä¸º â€œ å³ä½¿æŒ‚è½½æˆä¸ºåªè¯»ï¼Œç³»ç»Ÿè¿˜æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œ â€ çš„æ¨¡æ ·ï¼Œæ‰€ä»¥æ•‘æ´æ¨¡å¼ä¹Ÿèƒ½åŒæ—¶æŒ‚è½½ /usr å–”ï¼ ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„è¿™ä¸ª CentOS 7.x ç‰ˆæœ¬åœ¨æ•‘æ´æ¨¡å¼çš„æƒ…å†µä¸‹å°±æ˜¯è¿™æ ·ã€‚å› æ­¤é‚£ä¸ªäº”å¤§ç›®å½•çš„é™åˆ¶å·²ç»è¢«æ‰“ç ´äº†å‘¦ï¼ä¾‹å¦‚ CentOS 7.x å°±å·²ç»å°† /sbin, /bin,  /lib é€šé€šç§»åŠ¨åˆ° /usr ä¸‹é¢äº†\n\n### /usr çš„æ„ä¹‰ä¸å†…å®¹ï¼š\n\nâ€‹\tä¾æ® FHS çš„åŸºæœ¬å®šä¹‰ï¼Œ /usr é‡Œé¢æ”¾ç½®çš„æ•°æ®å±äºå¯åˆ†äº«çš„ä¸ä¸å¯å˜åŠ¨çš„ï¼ˆ shareable, static ï¼‰ï¼Œ å¦‚æœä½ çŸ¥é“å¦‚ä½•é€šè¿‡ç½‘ç»œè¿›è¡Œåˆ†åŒºçš„æŒ‚è½½ï¼ˆä¾‹å¦‚åœ¨æœåŠ¡å™¨ç¯‡ä¼šè°ˆåˆ°çš„ NFS æœåŠ¡å™¨ï¼‰ï¼Œé‚£ä¹ˆ /usr ç¡®å®å¯ä»¥åˆ†äº«ç»™åŒºåŸŸç½‘ç»œå†…çš„å…¶ä»–ä¸»æœºæ¥ä½¿ç”¨\nâ€‹\tå¾ˆå¤šè¯»è€…éƒ½ä¼šè¯¯ä¼š /usr ä¸º user çš„ç¼©å†™ï¼Œå…¶å® usr æ˜¯ Unix Software Resource çš„ç¼©å†™ï¼Œ ä¹Ÿå°±æ˜¯ â€œUnix æ“ä½œç³»ç»Ÿè½¯ä»¶èµ„æº â€ æ‰€æ”¾ç½®çš„ç›®å½•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è€…çš„æ•°æ®ï¼Œè¿™ç‚¹è¦æ³¨æ„ã€‚ FHS å»ºè®®æ‰€æœ‰è½¯ä»¶å¼€å‘è€…ï¼Œåº”è¯¥å°†ä»–ä»¬çš„æ•°æ®åˆç†çš„åˆ†åˆ«æ”¾ç½®åˆ°è¿™ä¸ªç›®å½•ä¸‹çš„æ¬¡ç›®å½•ï¼Œè€Œä¸è¦è‡ªè¡Œåˆ›å»ºè¯¥è½¯ä»¶è‡ªå·±ç‹¬ç«‹çš„ç›®å½•ã€‚\nå› ä¸ºæ˜¯æ‰€æœ‰ç³»ç»Ÿé»˜è®¤çš„è½¯ä»¶ï¼ˆ distribution å‘å¸ƒè€…æä¾›çš„è½¯ä»¶ï¼‰éƒ½ä¼šæ”¾ç½®åˆ° /usr ä¸‹é¢ï¼Œå› æ­¤è¿™ä¸ªç›®å½•æœ‰ç‚¹ç±»ä¼¼ Windows ç³»ç»Ÿçš„ â€œC:\\Windows\\ ï¼ˆå½“ä¸­çš„ä¸€éƒ¨ä»½ï¼‰ + C:\\Program files\\â€ è¿™ä¸¤ä¸ªç›®å½•çš„ç»¼åˆä½“ï¼Œç³»ç»Ÿåˆšå®‰è£…å®Œæ¯•æ—¶ï¼Œè¿™ä¸ªç›®å½•ä¼šå ç”¨æœ€å¤šçš„ç¡¬ç›˜å®¹é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ /usr çš„æ¬¡ç›®å½•å»ºè®®æœ‰ä¸‹é¢è¿™äº›ï¼š\n\n **FHS è¦æ±‚å¿…é¡»è¦å­˜åœ¨çš„ç›®å½•**\n\n- `/usr/bin/:`æ‰€æœ‰ä¸€èˆ¬ç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨çš„æŒ‡ä»¤éƒ½æ”¾åœ¨è¿™é‡Œï¼ç›®å‰æ–°çš„ CentOS 7 å·²ç»å°†å…¨éƒ¨çš„ä½¿ç”¨è€…æŒ‡ä»¤æ”¾ç½®äºæ­¤ï¼Œè€Œä½¿ç”¨é“¾æ¥æ–‡ä»¶çš„æ–¹å¼å°† /bin é“¾æ¥è‡³æ­¤ï¼ ä¹Ÿå°±æ˜¯è¯´ï¼Œ /usr/bin ä¸ /bin æ˜¯ä¸€æ¨¡ä¸€æ ·äº†ï¼å¦å¤–ï¼Œ FHS è¦æ±‚åœ¨æ­¤ç›®å½•ä¸‹ä¸åº”è¯¥æœ‰å­ç›®å½•ï¼\n- `/usr/lib/:`  åŸºæœ¬ä¸Šï¼Œä¸ /lib åŠŸèƒ½ç›¸åŒï¼Œæ‰€ä»¥ /lib å°±æ˜¯é“¾æ¥åˆ°æ­¤ç›®å½•ä¸­çš„ï¼/usr/local/\n  ç³»ç»Ÿç®¡ç†å‘˜åœ¨æœ¬æœºè‡ªè¡Œå®‰è£…è‡ªå·±ä¸‹è½½çš„è½¯ä»¶ï¼ˆé distribution é»˜è®¤æä¾›è€…ï¼‰ï¼Œå»ºè®®å®‰è£…åˆ°æ­¤ç›®å½•ï¼Œ è¿™æ ·ä¼šæ¯”è¾ƒä¾¿äºç®¡ç†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä½ çš„ distribution æä¾›çš„è½¯ä»¶è¾ƒæ—§ï¼Œä½ æƒ³å®‰è£…è¾ƒæ–°çš„è½¯ä»¶ä½†åˆä¸æƒ³ç§»é™¤æ—§ç‰ˆï¼Œ æ­¤æ—¶ä½ å¯ä»¥å°†æ–°ç‰ˆè½¯ä»¶å®‰è£…äº /usr/local/ ç›®å½•ä¸‹ï¼Œå¯ä¸åŸå…ˆçš„æ—§ç‰ˆè½¯ä»¶æœ‰åˆ†åˆ«å•¦ï¼ ä½ å¯ä»¥è‡ªè¡Œåˆ° /usr/local å»çœ‹çœ‹ï¼Œè¯¥ç›®å½•ä¸‹ä¹Ÿæ˜¯å…·æœ‰ bin, etc, include,lib... çš„æ¬¡ç›®å½•å–”ï¼\n- `/usr/sbin/:` éç³»ç»Ÿæ­£å¸¸è¿è¡Œæ‰€éœ€è¦çš„ç³»ç»ŸæŒ‡ä»¤ã€‚æœ€å¸¸è§çš„å°±æ˜¯æŸäº›ç½‘ç»œæœåŠ¡å™¨è½¯ä»¶çš„æœåŠ¡æŒ‡ä»¤ï¼ˆ daemon ï¼‰å•°ï¼ä¸è¿‡åŸºæœ¬åŠŸèƒ½ä¸ /sbinä¹Ÿå·®ä¸å¤šï¼Œ å› æ­¤ç›®å‰ /sbin å°±æ˜¯é“¾æ¥åˆ°æ­¤ç›®å½•ä¸­çš„ã€‚\n- `/usr/share/:`ä¸»è¦æ”¾ç½®åªè¯»æ¶æ„çš„æ•°æ®æ–‡ä»¶ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å…±äº«æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸‹æ”¾ç½®çš„æ•°æ®å‡ ä¹æ˜¯ä¸åˆ†ç¡¬ä»¶æ¶æ„å‡å¯è¯»å–çš„æ•°æ®ï¼Œå› ä¸ºå‡ ä¹éƒ½æ˜¯æ–‡å­—æ–‡ä»¶\n\n**FHS å»ºè®®å¯ä»¥å­˜åœ¨çš„ç›®å½•**\n\n- `/usr/games/:` ä¸æ¸¸æˆæ¯”è¾ƒç›¸å…³çš„æ•°æ®æ”¾ç½®å¤„\n- `/usr/include/:` c/c++ ç­‰ç¨‹åºè¯­è¨€çš„æ–‡ä»¶å¼€å§‹ï¼ˆ header ï¼‰ä¸åŒ…å«æ¡£ï¼ˆ include ï¼‰æ”¾ç½®å¤„ï¼Œå½“æˆ‘ä»¬ä»¥ tarball æ–¹å¼ ï¼ˆ *.tar.gz çš„æ–¹å¼å®‰è£…è½¯ä»¶ï¼‰å®‰è£…æŸäº›æ•°æ®æ—¶ï¼Œä¼šä½¿ç”¨åˆ°é‡Œå¤´çš„è®¸å¤šåŒ…å«æ¡£å–”ï¼\n- `/usr/libexec/:` æŸäº›ä¸è¢«ä¸€èˆ¬ä½¿ç”¨è€…æƒ¯ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–è„šæœ¬ï¼ˆ script ï¼‰ç­‰ç­‰ï¼Œéƒ½ä¼šæ”¾ç½®åœ¨æ­¤ç›®å½•ä¸­ã€‚ä¾‹å¦‚å¤§éƒ¨åˆ†çš„ X çª—å£ä¸‹é¢çš„æ“ä½œæŒ‡ä»¤ï¼Œ å¾ˆå¤šéƒ½æ˜¯æ”¾åœ¨æ­¤ç›®å½•ä¸‹çš„ã€‚\n- `/usr/lib<qual>/` ä¸ `/lib<qual>/` åŠŸèƒ½ç›¸åŒï¼Œå› æ­¤ç›®å‰ `/lib<qual>` å°±æ˜¯é“¾æ¥åˆ°æ­¤ç›®å½•ä¸­\n- `/usr/src/:`  ä¸€èˆ¬æºä»£ç å»ºè®®æ”¾ç½®åˆ°è¿™é‡Œï¼Œ src æœ‰ source çš„æ„æ€ã€‚è‡³äºæ ¸å¿ƒæºä»£ç åˆ™å»ºè®®æ”¾ç½®åˆ° /usr/src/linux/ ç›®å½•ä¸‹\n\n### /var çš„æ„ä¹‰ä¸å†…å®¹ï¼š\n\nå¦‚æœ /usr æ˜¯å®‰è£…æ—¶ä¼šå ç”¨è¾ƒå¤§ç¡¬ç›˜å®¹é‡çš„ç›®å½•ï¼Œé‚£ä¹ˆ /var å°±æ˜¯åœ¨ç³»ç»Ÿè¿è¡Œåæ‰ä¼šæ¸æ¸å ç”¨ç¡¬ç›˜å®¹é‡çš„ç›®å½•ã€‚ å› ä¸º /var ç›®å½•ä¸»è¦é’ˆå¯¹å¸¸æ€æ€§å˜åŠ¨çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬é«˜é€Ÿç¼“å­˜ï¼ˆ cache ï¼‰ã€ç™»å½•æ–‡ä»¶ï¼ˆ log file ï¼‰ä»¥åŠæŸäº›è½¯ä»¶è¿è¡Œæ‰€äº§ç”Ÿçš„æ–‡ä»¶ï¼Œ åŒ…æ‹¬ç¨‹åºæ–‡ä»¶ï¼ˆ lock file, run file ï¼‰ï¼Œæˆ–è€…ä¾‹å¦‚MySQL æ•°æ®åº“çš„æ–‡ä»¶ç­‰ç­‰ã€‚å¸¸è§çš„æ¬¡ç›®å½•æœ‰ï¼š\n\n **FHS è¦æ±‚å¿…é¡»è¦å­˜åœ¨çš„ç›®å½•**\n\n- `/var/cache/:` åº”ç”¨ç¨‹åºæœ¬èº«è¿è¡Œè¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿçš„ä¸€äº›æš‚å­˜ç›˜ï¼›\n- `/var/lib/:` ç¨‹åºæœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½¿ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶æ”¾ç½®çš„ç›®å½•ã€‚åœ¨æ­¤ç›®å½•ä¸‹å„è‡ªçš„è½¯ä»¶åº”è¯¥è¦æœ‰å„è‡ªçš„ç›®å½•ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œ MySQL çš„æ•°æ®åº“æ”¾ç½®åˆ° /var/lib/mysql/ è€Œ rpm çš„æ•°æ®åº“åˆ™æ”¾åˆ° /var/lib/rpm å»ï¼\n- `/var/lock/:` æŸäº›è®¾å¤‡æˆ–è€…æ˜¯æ–‡ä»¶èµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨ï¼Œå¦‚æœåŒæ—¶æœ‰ä¸¤ä¸ªç¨‹åºä½¿ç”¨è¯¥è®¾å¤‡æ—¶ï¼Œ å°±å¯èƒ½äº§ç”Ÿä¸€äº›é”™è¯¯çš„çŠ¶å†µï¼Œå› æ­¤å°±å¾—è¦å°†è¯¥è®¾å¤‡ä¸Šé”ï¼ˆ lock ï¼‰ï¼Œä»¥ç¡®ä¿è¯¥è®¾å¤‡åªä¼šç»™å•ä¸€è½¯ä»¶æ‰€ä½¿ç”¨ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œçƒ§å½•æœºæ­£åœ¨çƒ§å½•ä¸€å—å…‰ç›˜ï¼Œä½ æƒ³ä¸€ä¸‹ï¼Œä¼šä¸ä¼šæœ‰ä¸¤ä¸ªäººåŒæ—¶åœ¨ä½¿ç”¨ä¸€ä¸ªçƒ§å½•æœºçƒ§ç‰‡ï¼Ÿ å¦‚æœä¸¤ä¸ªäººåŒæ—¶çƒ§å½•ï¼Œé‚£ç‰‡å­å†™å…¥çš„æ˜¯è°çš„æ•°æ®ï¼Ÿæ‰€ä»¥å½“ç¬¬ä¸€ä¸ªäººåœ¨\n  çƒ§å½•æ—¶è¯¥çƒ§å½•æœºå°±ä¼šè¢«ä¸Šé”ï¼Œ ç¬¬äºŒä¸ªäººå°±å¾—è¦è¯¥è®¾å¤‡è¢«è§£é™¤é”å®šï¼ˆå°±æ˜¯å‰ä¸€ä¸ªäººç”¨å®Œäº†ï¼‰æ‰èƒ½å¤Ÿç»§ç»­ä½¿ç”¨å•°ã€‚ç›®å‰æ­¤ç›®å½•ä¹Ÿå·²ç»æŒªåˆ° /run/lock ä¸­ï¼\n- `/var/log/:` é‡è¦åˆ°ä¸è¡Œï¼è¿™æ˜¯ç™»å½•æ–‡ä»¶æ”¾ç½®çš„ç›®å½•ï¼é‡Œé¢æ¯”è¾ƒé‡è¦çš„æ–‡ä»¶å¦‚ /var/log/messages, /var/log/wtmp ï¼ˆè®°å½•ç™»é™†è€…çš„ä¿¡æ¯ï¼‰ç­‰ã€‚\n- `/var/mail/:` æ”¾ç½®ä¸ªäººç”µå­é‚®ä»¶ä¿¡ç®±çš„ç›®å½•ï¼Œä¸è¿‡è¿™ä¸ªç›®å½•ä¹Ÿè¢«æ”¾ç½®åˆ° /var/spool/mail/ ç›®å½•ä¸­ï¼ é€šå¸¸è¿™ä¸¤ä¸ªç›®å½•æ˜¯äº’ä¸ºé“¾æ¥æ–‡ä»¶å•¦ï¼\n- `/var/run/:`æŸäº›ç¨‹åºæˆ–è€…æ˜¯æœåŠ¡å¯åŠ¨åï¼Œä¼šå°†ä»–ä»¬çš„ PID æ”¾ç½®åœ¨è¿™ä¸ªç›®å½•ä¸‹å–”ï¼è‡³äº PID çš„æ„ä¹‰æˆ‘ä»¬ä¼šåœ¨åç»­ç« èŠ‚æåˆ°çš„ã€‚ ä¸ /run ç›¸åŒï¼Œè¿™ä¸ªç›®å½•é“¾æ¥åˆ° /run å»äº†ï¼\n- `/var/spool/:` è¿™ä¸ªç›®å½•é€šå¸¸æ”¾ç½®ä¸€äº›é˜Ÿåˆ—æ•°æ®ï¼Œæ‰€è°“çš„ â€œ é˜Ÿåˆ— â€ å°±æ˜¯æ’é˜Ÿç­‰å¾…å…¶ä»–ç¨‹åºä½¿ç”¨çš„æ•°æ®å•¦ï¼ è¿™äº›æ•°æ®è¢«ä½¿ç”¨åé€šå¸¸éƒ½ä¼šè¢«åˆ é™¤ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œç³»ç»Ÿæ”¶åˆ°æ–°ä¿¡ä¼šæ”¾ç½®åˆ° /var/spool/mail/ ä¸­ï¼Œ ä½†ä½¿ç”¨è€…æ”¶ä¸‹è¯¥ä¿¡ä»¶åè¯¥å°ä¿¡åŸåˆ™ä¸Šå°±ä¼šè¢«åˆ é™¤ã€‚ä¿¡ä»¶å¦‚æœæš‚æ—¶å¯„ä¸å‡ºå»ä¼šè¢«æ”¾åˆ° /var/spool/mqueue/ ä¸­ï¼Œ ç­‰åˆ°è¢«é€å‡ºåå°±è¢«åˆ é™¤ã€‚å¦‚æœæ˜¯å·¥ä½œè°ƒåº¦æ•°æ®ï¼ˆ crontab ï¼‰ï¼Œå°±ä¼šè¢«æ”¾ç½®\n  åˆ° /var/spool/cron/ ç›®å½•ä¸­ï¼\n\n## å‚è€ƒ\n\n[FHS3.0](https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.pdf)\n\n","tags":["Linux"],"categories":["Linux"]},{"title":"KMPç®—æ³•","url":"/2020/05/13/kmp-suan-fa/","content":"\n## å‰è¨€\n\nä¹‹å‰å¤§ä¸€çš„æ—¶å€™å†™è¿‡ä¸€ç¯‡å…³äºKMPçš„åšå®¢ï¼Œå†™çš„ä¹Ÿæ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œè‡ªå·±çœ‹ç€éƒ½è´¹åŠ²ï¼Œæœ€è¿‘çœ‹å·¦ç¥çš„ä¹¦ã€Šç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—ã€‹æœ‰è®²ï¼Œé‡æ–°å­¦äº†ä¸€éï¼Œæ„Ÿè§‰å†™çš„è¿˜æ˜¯æŒºå¥½çš„ï¼Œè¿™ç¯‡å°±ä¸ä»0å¼€å§‹è®²è§£`KMP`äº†ï¼Œç®€å•è¯´ä¸€äº›è¦ç‚¹ï¼Œæ–¹ä¾¿ä»¥åå›é¡¾\n\n> æˆ‘è®°å¾—å¤§ä¸€ä¸ºäº†ææ‡‚kmpå¥½åƒèŠ±äº†æŒºé•¿æ—¶é—´çš„ï¼Œç½‘ä¸Šç¿»å„ç§åšå®¢ï¼Œæäº†å¤§åŠå¤©å§ï¼Œç»“æœè¿˜æ˜¯æ²¡å’‹ææ¸…æ¥šï¼Œå‰å‡ å¤©çœ‹ä¹¦å¤§æ¦‚åªèŠ±äº†ä¸€ä¸ªå°æ—¶å·¦å³å°±éƒ½ææ¸…æ¥šäº†ï¼Œå¯èƒ½æ˜¯å·¦ç¥å†™çš„æ¯”è¾ƒå¥½å§ğŸ˜‚\n\n## nextæ•°ç»„æ˜¯ä»€ä¹ˆï¼Ÿ\n\n`kmp`æœ€å…³é”®çš„åœ°æ–¹å°±æ˜¯è¿™ä¸ª`next`æ•°ç»„äº†ï¼Œ`next`æ•°ç»„å°±æ˜¯å„ä¸ªå­ä¸²çš„å‰ç¼€åç¼€æœ€å¤§åŒ¹é…ï¼ˆç›¸ç­‰ï¼‰é•¿åº¦ï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯`next[i]`ä»£è¡¨çš„å°±æ˜¯å­ä¸²`i`ä½ç½®å‰å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬`i`ä½ç½®ï¼‰çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦\n\nä¸¾ä¸ªä¾‹å­ï¼š å­ä¸²`abababc`  \n\nnext[3] = \"aba\" çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦ = 1 (å¼€å¤´çš„aå’Œç»“å°¾çš„aåŒ¹é…)\n\nnext[6]= \"ababab\" çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦ = 4 ï¼ˆå¼€å¤´çš„ababå’Œç»“å°¾çš„ababåŒ¹é…ï¼‰\n\n## nextæ•°ç»„çš„ä½œç”¨ï¼Ÿ\n\nä»–çš„ä½œç”¨å…¶å®å°±æ˜¯åœ¨ä¸¤ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒå¤±é…çš„æ—¶å€™é¿å…ç›®æ ‡ä¸²å›æº¯ï¼Œå¸¸è§„çš„æš´åŠ›åŒ¹é…åœ¨å­—ç¬¦å¤±é…çš„æ—¶å€™å°±ä¼šå›é€€åˆ°é¦–å­—ç¬¦é‡æ–°åŒ¹é…ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦å°±æ˜¯`O(m*n)`ï¼Œè€Œnextæ•°ç»„å°±æ˜¯ä¸ºäº†é¿å…å›é€€ï¼Œç®€å•ä¸¾ä¸€ä¸ªä¾‹å­\n\n![mark](http://static.imlgw.top/blog/20200513/ugvgLhmyaeBr.png?imageslim)\n\nç”¨PPTç®€å•çš„ç”»äº†ä¸ªå›¾ï¼ˆPPTçœŸå¥½ç”¨ï¼‰ï¼Œå½“åŒ¹é…åˆ°**æ¯ä¸²å’Œå­ä¸²**`index=6`çš„ä½ç½®æ—¶ï¼Œå‘ç°ä¸¤è€…çš„å­—ç¬¦ä¸ç›¸åŒï¼ŒæŒ‰ç…§æš´åŠ›åŒ¹é…ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ¯ä¸²å›æº¯åˆ°`index=1`ä¹Ÿå°±æ˜¯bå­—ç¬¦ä½ç½®ï¼Œå­ä¸²å›æº¯åˆ°é¦–å­—ç¬¦ï¼Œé‡æ–°å¼€å§‹åŒ¹é…ï¼Œç›´åˆ°åŒ¹é…åˆ°å­ä¸²ï¼Œæˆ–è€…åŒ¹é…å®Œæ¯ä¸²æ‰€æœ‰å­ä¸²ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æœ‰äº†`next`æ•°ç»„ï¼Œæˆ‘ä»¬çš„æ¯ä¸²å°±ä¸å¿…å†å›é€€äº†ï¼Œè€Œå­ä¸²ä¹Ÿä¸å¿…å†å›é€€åˆ°é¦–å­—ç¬¦äº†ï¼Œå›¾ä¸­çš„é»„è‰²ä¸‹åˆ’çº¿å’Œç»¿è‰²ä¸‹åˆ’çº¿ä»£è¡¨çš„å°±æ˜¯**å­ä¸²index=6**ä½ç½®å‰çš„æœ€é•¿å‰åç¼€åŒ¹é…é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯`ababab`çš„**æœ€é•¿å‰åç¼€åŒ¹é…å­—ç¬¦**ï¼Œå½“å­ä¸²index=6ä½ç½®çš„å­—ç¬¦åŒ¹é…ä¸ä¸Šçš„æ—¶å€™æˆ‘ä»¬æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†`index`è·³åˆ°`next[6]`ï¼Œä¹Ÿå°±æ˜¯å°†å­ä¸²ç´¢å¼•ç§»åŠ¨åˆ°index=4çš„ä½ç½®ï¼Œå°±å˜æˆä¸‹é¢è¿™æ ·\n\n![mark](http://static.imlgw.top/blog/20200513/6sBvml0hXrr6.png?imageslim)\n\næ¯ä¸²å¹¶æ²¡æœ‰å›é€€ï¼Œç»§ç»­åŒ¹é…`æ¯ä¸²index=6`å’Œå­ä¸²`index=4`ä½ç½®çš„å…ƒç´ ï¼Œç„¶åé‡å¤ä¸Šé¢çš„è¿‡ç¨‹\n\n## ä¸ºä»€ä¹ˆå­ä¸²å¯ä»¥ç›´æ¥æ»‘åŠ¨next[i]æ­¥ï¼Ÿ\n\nå‰é¢æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨`next`æ•°ç»„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå­ä¸²å¯ä»¥ä¸€ä¸‹å­ä»æ»‘åŠ¨åˆ°`next[i]`ä½ç½®å‘¢ï¼Ÿä¸‡ä¸€ä¸­é—´æœ‰èƒ½åŒ¹é…çš„å­—ç¬¦ä¸å°±æ»‘è¿‡äº†ä¹ˆï¼Ÿ\n\næˆ‘ä»¬å‡è®¾åœ¨æ¯ä¸²ä¸­é—´å­˜åœ¨æŸä¸€ä¸ªä½ç½®èƒ½åŒ¹é…å‡ºå­ä¸²ï¼Œä¸”è¯¥ä½ç½®åœ¨**å­ä¸²æœ€é•¿åŒ¹é…åç¼€ä¹‹å‰**ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™éƒ¨åˆ†**æ¯”å½“å‰çš„æœ€é•¿å‰åç¼€åŒ¹é…é•¿åº¦è¿˜è¦é•¿**å¯¹åº”åˆ°ä¸‹å›¾å°±æ˜¯é»‘è‰²è™šçº¿æ¡†æ¡†å‡ºæ¥çš„éƒ¨åˆ†\n\n![mark](http://static.imlgw.top/blog/20200513/EbC0E1JvbkHh.png?imageslim)\n\næ—¢ç„¶èƒ½ä»è¿™ä¸ªä½ç½®åŒ¹é…å‡ºå­ä¸²ï¼Œé‚£ä¹ˆè¯´æ˜æˆ‘çš„**å­ä¸²çš„å‰ç¼€**å’Œè¿™ä¸€éƒ¨åˆ†ç›¸ç­‰ï¼ŒåŒæ—¶ï¼Œç”±äºå¤±é…å‰å­ä¸²å’Œæ¯ä¸²æ˜¯å®Œå…¨åŒ¹é…çš„ï¼Œæ‰€ä»¥æˆ‘**å­ä¸²çš„åç¼€**å’Œè¿™ä¸€éƒ¨åˆ†è‚¯å®šä¹Ÿæ˜¯ç›¸ç­‰çš„ï¼Œè¯¶ï¼Ÿæˆ‘å­ä¸²å‰åç¼€éƒ½å’Œè¿™éƒ¨åˆ†ç›¸ç­‰ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘çš„åŒ¹é…å‰åç¼€å•Šï¼Œä½†æ˜¯è¿™éƒ¨åˆ†åˆæ¯”æˆ‘çš„æœ€é•¿å‰åç¼€é•¿åº¦è¦é•¿ï¼Œæ˜¯ä¸æ˜¯çŸ›ç›¾äº†ï¼Ÿæ‰€ä»¥åŸå‡è®¾æ˜¯ä¸æˆç«‹çš„ï¼Œä¸å­˜åœ¨è¿™æ ·çš„ä½ç½®ï¼æ‰€ä»¥å­ä¸²å¯ä»¥æ”¾å¿ƒçš„æ»‘åˆ°`next[i]`ä½ç½®\n\n## nextæ•°ç»„å¦‚ä½•æ±‚ï¼Ÿ\n\nè¯´äº†è¿™ä¹ˆå¤šnextæ•°ç»„ï¼Œé‚£ä¹ˆnextæ•°ç»„ç©¶ç«Ÿæ€ä¹ˆæ±‚å‘¢ï¼Ÿå…¶å®æ•´ä¸ªçš„æ±‚è§£è¿‡ç¨‹æœ‰ç‚¹åƒåŠ¨æ€è§„åˆ’ï¼Œæœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ä¸‹\n\n> æƒ³èµ·æ¥äº†å†å†™\n\n## æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯çº¿æ€§çš„ï¼Ÿ\n\n> æƒ³èµ·æ¥äº†å†å†™\n\n## ä¾‹é¢˜\n\n### [28. å®ç° strStr()](https://leetcode-cn.com/problems/implement-strstr/)\n\nå®ç° [strStr()](https://baike.baidu.com/item/strstr/811469) å‡½æ•°ã€‚\n\nç»™å®šä¸€ä¸ª haystack å­—ç¬¦ä¸²å’Œä¸€ä¸ª needle å­—ç¬¦ä¸²ï¼Œåœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® (ä»0å¼€å§‹)ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  **-1**ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: haystack = \"hello\", needle = \"ll\"\nè¾“å‡º: 2\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: haystack = \"aaaaa\", needle = \"bba\"\nè¾“å‡º: -1\n```\n\n**è¯´æ˜:**\n\nå½“ `needle` æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚\n\nå¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ `needle` æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸Cè¯­è¨€çš„ [strstr()](https://baike.baidu.com/item/strstr/811469) ä»¥åŠ Javaçš„ [indexOf()](https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#indexOf(java.lang.String)) å®šä¹‰ç›¸ç¬¦ã€‚\n\n**è§£æ³•ä¸€**\n\næ ‡æ³¨çš„æ˜¯ç®€å•ï¼Œå¾ˆå¤šäººéƒ½æ˜¯ç›´æ¥è°ƒçš„APIï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰æ²¡å•¥æ„ä¹‰ï¼Œæ‰€ä»¥è¿™é¢˜åº”è¯¥ç›´æ¥ä¸Škmp\n\n```java\npublic int strStr(String haystack, String needle) {\n    if(needle==null || needle.length()<=0) return 0;\n    if(haystack==null ||haystack.length()<=0) return -1;\n    int[] next=getNext(needle);\n    int tidx=0,sidx=0;\n    while (sidx<haystack.length() && tidx<needle.length()) {\n        if(needle.charAt(tidx) == haystack.charAt(sidx)){\n            tidx++;sidx++;\n            if(tidx==needle.length()){\n                return sidx-tidx;\n            }\n        }else if(next[tidx]==-1){\n            //å®Œå…¨å¤±é…sidxéœ€è¦åç§»\n            sidx++;\n        }else{\n            tidx=next[tidx];\n        }\n    }\n    return -1;\n}\n\n//æ±‚tçš„next\n//abadabac\n//ac\npublic int[] getNext(String t){\n    int[] next= new int[t.length()];\n    next[0]=-1;\n    if(t.length()<=1) return next;\n    next[1]=0;\n    int left=0,right=2;\n    while(right<t.length()){\n        if(t.charAt(left)==t.charAt(right-1)){\n            left++;\n            next[right++]=left;\n        }else if(next[left]==-1){ //æ— æ³•åŒ¹é…äº†\n            right++; //next[right]=0\n        }else{\n            left=next[left];\n        }\n    }\n    return next;\n}\n```\næ²¡å•¥å¥½è¯´çš„ï¼Œè£¸kmp\n\n### [459. é‡å¤çš„å­å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/repeated-substring-pattern/)\n\nç»™å®šä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦å¯ä»¥ç”±å®ƒçš„ä¸€ä¸ªå­ä¸²é‡å¤å¤šæ¬¡æ„æˆã€‚ç»™å®šçš„å­—ç¬¦ä¸²åªå«æœ‰å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”é•¿åº¦ä¸è¶…è¿‡10000ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"abab\"\n\nè¾“å‡º: True\n\nè§£é‡Š: å¯ç”±å­å­—ç¬¦ä¸² \"ab\" é‡å¤ä¸¤æ¬¡æ„æˆã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"aba\"\n\nè¾“å‡º: False\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: \"abcabcabcabc\"\n\nè¾“å‡º: True\n\nè§£é‡Š: å¯ç”±å­å­—ç¬¦ä¸² \"abc\" é‡å¤å››æ¬¡æ„æˆã€‚ (æˆ–è€…å­å­—ç¬¦ä¸² \"abcabc\" é‡å¤ä¸¤æ¬¡æ„æˆã€‚)\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜æ ‡æ³¨çš„ä¹Ÿæ˜¯ç®€å•ï¼Œç¡®å®æš´åŠ›çš„è§£æ³•ä¸éš¾æƒ³åˆ°ï¼Œä½†æ˜¯å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥å°±ç›´æ¥ä¸Škmp\n\n```java\n//20msï¼Œåšå¤æ‚äº†ï¼Œæ„é€ äº†ä¸€ä¸ªs+sç„¶åå»æ‰å¤´ï¼Œå†åœ¨é‡Œé¢kmpæ‰¾\npublic boolean repeatedSubstringPattern(String s) {\n    if(s==null || s.length()<=0) return false;\n    String t=s+s;\n    int[] next=getNext(s);\n    int i=0,j=1; //å»æ‰å¤´\n    while(i<s.length() && j<t.length()){\n        if(s.charAt(i)==t.charAt(j)){\n            i++;j++;\n        }else if(next[i]==-1){\n            j++;\n        }else{\n            i=next[i];\n        }\n    }\n    return j-i!=s.length();\n}\n\npublic int[] getNext(String s){\n    if(s.length()==1){\n        return new int[]{-1};\n    }\n    int[] next=new int[s.length()];\n    next[0]=-1;\n    next[1]=0;\n    int left=0,right=2; \n    while(right<s.length()){\n        if(s.charAt(left)==s.charAt(right-1)){\n            next[right++]=++left;\n        }else if(next[left]==-1){\n            next[right++]=0;\n        }else{\n            left=next[left];\n        }\n    }\n    return next;\n}\n```\nè¿™ä¸ªè§£æ³•å…¶å®æ„é€ äº†ä¸€ä¸ª`s+s`çš„å­—ç¬¦`t`ï¼Œç„¶åå»æ‰å¤´ï¼Œåœ¨`t[1:]`ä¸­æ‰¾åŸ`s`ï¼Œæœ€åæ‰¾åˆ°çš„ä½ç½®åªè¦ä¸æ˜¯`s+s`è¿æ¥å¤„ï¼Œä¹Ÿå°±æ˜¯`s.length()`ä½ç½®ï¼Œé‚£ä¹ˆå°±è‚¯å®šæ˜¯é‡å¤çš„æœ‰å¾ªç¯çš„ï¼Œå…¶å®è¿™ä¸ªç»“è®ºåœ¨å†™çš„æ—¶å€™å¹¶æ²¡æœ‰è¯æ˜ï¼Œå®Œå…¨æ˜¯çŒœçš„ğŸ˜‚ï¼Œç®€å•è¯æ˜ä¸‹ï¼Œä¸€å›¾èƒœå‰è¨€\n\n![mark](http://static.imlgw.top/blog/20200513/O4Nmz343e9Li.png?imageslim)\n\n**è§£æ³•äºŒ**\n\nå…¶å®åªéœ€è¦æ„é€ nextæ•°ç»„ï¼Œæ ¹æ®nextæ•°ç»„å°±å¯ä»¥åˆ¤æ–­æ˜¯ä¸æ˜¯é‡å¤çš„ï¼Œæˆ‘ä»¬çœ‹å‡ ç»„æ•°æ®\n\n```java\n   s:  a b c a b c a b c a b c \\0\nnext: -1 0 0 0 1 2 3 4 5 6 7 8  9\n   s:  a a b a b d \\0\nnext: -1 0 1 0 1 0  0\n   s:  a b c d a b \\0\nnext: -1 0 0 0 0 1 2 \n```\n\nç›¸æ¯”å¸¸è§„çš„KMPç®—æ³•ï¼Œæˆ‘ä»¬åœ¨å­—ç¬¦æœ€åæœ€åä¹ŸåŠ äº†`next`ä½ï¼Œå…¶å®æ˜¯ä¸ºäº†åŒºåˆ«ä¸‹é¢çš„æƒ…å†µ\n\n```\n   s:  a b a b \\0\nnext: -1 0 0 1 2\n   s:  a b a c \\0\nnext: -1 0 0 1 0\n```\n\nç„¶åæˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œnextæ•°ç»„åœ¨è¿‡äº†ä¸€å®šçš„èŒƒå›´åå°±å¼€å§‹é€æ¸é€’å¢äº†ï¼Œè€Œè¿™ä¸ªé€’å¢çš„æ‹ç‚¹å°±æ˜¯åœ¨ç¬¬ä¸€ä¸ªå¾ªç¯èŠ‚ç»“æŸçš„æ—¶å€™ï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘å°±ä¸è¯¦ç»†è¯æ˜äº†ï¼Œå…¶å®ä¹Ÿå¾ˆå¥½æƒ³å› ä¸ºè¿‡äº†å¾ªç¯èŠ‚ï¼Œåé¢çš„éƒ½æ˜¯å’Œå‰é¢é‡å¤çš„ï¼Œæ‰€ä»¥æ¯å¤šä¸€ä¸ªå­—ç¬¦`next[i]=next[i-1]+1`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å­—ç¬¦çš„é•¿åº¦å‡å»`next[slen]`å°±å¯ä»¥å¾—åˆ°å¾ªç¯ç»“çš„é•¿åº¦ï¼Œæˆ‘ä»¬åªéœ€è¦éªŒè¯è¿™ä¸ªå¾ªç¯èŠ‚èƒ½å¦è¢«`s`å­—ç¬¦ä¸²é•¿åº¦æ•´é™¤å°±å¯ä»¥äº†ï¼ŒåŒæ—¶éœ€è¦é˜²æ­¢å¾ªç¯èŠ‚é•¿åº¦ç­‰äºå­—ç¬¦ä¸²é•¿åº¦çš„æƒ…å†µ\n\n```java\npublic boolean repeatedSubstringPattern(String s) {\n    if(s==null || s.length()<=1) return false;\n    int[] next=getNext(s);\n    int replen=s.length()-next[s.length()];\n    //å¾ªç¯ç»“é•¿åº¦ç­‰äºå­—ç¬¦é•¿åº¦\n    return replen!=s.length() && s.length()%replen==0;\n}\n\npublic int[] getNext(String s){\n    if(s.length()==1){\n        return new int[]{-1};\n    }\n    int[] next=new int[s.length()+1];\n    next[0]=-1;\n    next[1]=0;\n    int left=0,right=2; \n    while(right<=s.length()){\n        if(s.charAt(left)==s.charAt(right-1)){\n            next[right++]=++left;\n        }else if(next[left]==-1){\n            next[right++]=0;\n        }else{\n            left=next[left];\n        }\n    }\n    return next;\n}\n```\n\nå®åœ¨ä¸è¡ŒæŠŠè¿™ä¸ªè®°ä½å°±è¡Œäº†ï¼Œåæ­£æˆ‘æ˜¯è®°ä½äº†ğŸ˜‚ï¼ˆè¿‡å‡ å¤©å°±å¿˜äº†\n\n### [214. æœ€çŸ­å›æ–‡ä¸²](https://leetcode-cn.com/problems/shortest-palindrome/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² ***s***ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨å­—ç¬¦ä¸²å‰é¢æ·»åŠ å­—ç¬¦å°†å…¶è½¬æ¢ä¸ºå›æ–‡ä¸²ã€‚æ‰¾åˆ°å¹¶è¿”å›å¯ä»¥ç”¨è¿™ç§æ–¹å¼è½¬æ¢çš„æœ€çŸ­å›æ–‡ä¸²ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"aacecaaa\"\nè¾“å‡º: \"aaacecaaa\"\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"abcd\"\nè¾“å‡º: \"dcbabcd\"\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å¾ˆå…³é”®çš„ä¸€ä¸ªç‚¹å°±æ˜¯æœ€çŸ­å›æ–‡ä¸²å…¶å®å°±æ˜¯åŸå­—ç¬¦`s`ï¼Œå‡å»`s[0]`å¼€å¤´çš„æœ€é•¿å›æ–‡ä¸²ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å†æ”¾åˆ°`s`å‰ï¼Œè¿™å°±æ˜¯æœ€çŸ­å›æ–‡ä¸²\n\næ‰€ä»¥é—®é¢˜å°±å˜æˆäº†å¦‚ä½•æ±‚`s[0]`å¼€å¤´çš„æœ€é•¿å›æ–‡ä¸²ï¼Œæœ´ç´ çš„æ€è·¯å¯ä»¥ä½¿ç”¨ä¸­å¿ƒæ‰©æ•£æ³•ï¼Œæšä¸¾æ‰€æœ‰çš„å­—ç¬¦å’Œé—´éš™ï¼Œæˆ–è€…ä½¿ç”¨\"é©¬æ‹‰è½¦\"ï¼Œç­‰é«˜æ•ˆç®—æ³•ï¼Œè¿™é‡Œä¸å¤šä»‹ç»ï¼Œä¸»è¦ä»‹ç»kmpçš„åšæ³•\n\næˆ‘ä»¬æŠŠ`s`ä¸²ç¿»è½¬å˜æˆ`rs`ï¼Œç„¶åå°†ä¸¤éƒ¨åˆ†æ‹¼æ¥èµ·æ¥å˜ä¸º`s+rs`ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦æ±‚`s[0]`å¼€å¤´çš„æœ€é•¿å›æ–‡å­ä¸²ï¼Œå®é™…ä¸Šå°±å˜æˆäº†æ±‚`s+rs`çš„æœ€é•¿å…¬å…±å‰åç¼€\n\n![mark](http://static.imlgw.top/blog/20200518/CtFIYht31mIL.png?imageslim)\n\nè¿™é‡Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯`s+rs`çš„ä¸­é—´åº”è¯¥åŠ åˆ†éš”ç¬¦ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å…¬å…±å‰åç¼€è¿‡é•¿ï¼Œç”šè‡³æ¯”åŸå­—ç¬¦`s`è¿˜è¦é•¿ï¼Œè¿™è‚¯å®šæ˜¯ä¸å¯¹çš„ï¼Œå°±æ¯”å¦‚`aaaaaaa`è¿™æ ·çš„caseï¼ŒåŠ äº†åˆ†å‰²ç¬¦ä¹‹åæœ€é•¿çš„å‰åç¼€å°±ä¸ä¼šè¶…è¿‡`s`äº†ï¼Œ\n\n```java\npublic String shortestPalindrome(String s) {\n    String rs=new StringBuilder(s).reverse().toString();\n    //#æ˜¯ä¸ºäº†é¿å…å‰åç¼€è¿‡é•¿è¶…è¿‡åŸå­—ç¬¦sçš„é•¿åº¦ï¼Œæ¯”å¦‚aaaaaaaè¿™ç§\n    String t=s+\"#\"+rs; \n    int[] next=new int[t.length()+1];\n    next[0]=-1;\n    next[1]=0;\n    int left=0;\n    int i=2;\n    while(i<=t.length()){\n        if(t.charAt(i-1)==t.charAt(left)){\n            next[i++]=++left;\n        }else if(next[left]==-1){\n            next[i++]=0;\n        }else{\n            left=next[left];\n        }\n    }\n    //System.out.println(next[t.length()]);\n    return rs.substring(0,s.length()-next[t.length()])+s;\n}\n```\n\n### [1392. æœ€é•¿å¿«ä¹å‰ç¼€](https://leetcode-cn.com/problems/longest-happy-prefix/)\n\nã€Œå¿«ä¹å‰ç¼€ã€æ˜¯åœ¨åŸå­—ç¬¦ä¸²ä¸­æ—¢æ˜¯Â éç©º å‰ç¼€ä¹Ÿæ˜¯åç¼€ï¼ˆä¸åŒ…æ‹¬åŸå­—ç¬¦ä¸²è‡ªèº«ï¼‰çš„å­—ç¬¦ä¸²ã€‚\n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¯·ä½ è¿”å›å®ƒçš„**æœ€é•¿å¿«ä¹å‰ç¼€**ã€‚\n\nå¦‚æœä¸å­˜åœ¨æ»¡è¶³é¢˜æ„çš„å‰ç¼€ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"level\"\nè¾“å‡ºï¼š\"l\"\nè§£é‡Šï¼šä¸åŒ…æ‹¬ s è‡ªå·±ï¼Œä¸€å…±æœ‰ 4 ä¸ªå‰ç¼€ï¼ˆ\"l\", \"le\", \"lev\", \"leve\"ï¼‰å’Œ 4 ä¸ªåç¼€ï¼ˆ\"l\", \"el\", \"vel\", \"evel\"ï¼‰ã€‚æœ€é•¿çš„æ—¢æ˜¯å‰ç¼€ä¹Ÿæ˜¯åç¼€çš„å­—ç¬¦ä¸²æ˜¯ \"l\" ã€‚\n\n```\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"ababab\"\nè¾“å‡ºï¼š\"abab\"\nè§£é‡Šï¼š\"abab\" æ˜¯æœ€é•¿çš„æ—¢æ˜¯å‰ç¼€ä¹Ÿæ˜¯åç¼€çš„å­—ç¬¦ä¸²ã€‚é¢˜ç›®å…è®¸å‰åç¼€åœ¨åŸå­—ç¬¦ä¸²ä¸­é‡å ã€‚\n```\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"leetcodeleet\"\nè¾“å‡ºï¼š\"leet\"\n```\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"a\"\nè¾“å‡ºï¼š\"\"\n```\n\n**æç¤ºï¼š**\n- 1 <= s.length <= 10^5\n- s åªå«æœ‰å°å†™è‹±æ–‡å­—æ¯\n\n**è§£æ³•ä¸€**\n\næœ€è¿‘æŸæ¬¡å‘¨èµ›çš„T4ï¼Œæ²¡å‚åŠ ï¼Œä»Šå¤©çœ‹è§ç¾¤é‡Œæœ‰äººæåˆ°äº†ï¼Œçœ‹äº†ä¸‹å‘ç°æ˜¯è£¸KMP...æ­£å¥½å¤ä¹ ä¸‹ï¼Œç»“æœå†™å‡ºbugäº†ã€‚ã€‚ã€‚\n\n```golang\nfunc longestPrefix(s string) string {\n    if len(s) == 1 {\n        return \"\"\n    }\n    //è£¸KMP\n    next := make([]int, len(s)+1)\n    next[0] = -1\n    next[1] = 0\n    var left = 0\n    var i = 2\n    for i <= len(s) {\n        if s[i-1] == s[left] {\n            left++\n            next[i] = left\n            i++\n        } else if next[left] == -1 {\n            i++\n        } else {\n            left = next[left]\n        }\n    }\n    return s[0:next[len(s)]]\n}\n```\nç¡®å®ä¹Ÿé•¿æ—¶é—´æ²¡æœ‰å¤ä¹ kmpäº†ï¼Œkmpçš„ç»†èŠ‚å‡ ä¹éƒ½å¿˜äº†ï¼Œä¸Šé¢çš„éƒ½æ˜¯å‡­å€Ÿç€ä¸€ç‚¹ç†è§£å’Œè®°å¿†å†™çš„\n> æ£€æŸ¥äº†å‰é¢kmpçš„å†™æ³•ï¼Œç¨å¾®æ”¹è¿›äº†ä¸€ä¸‹ï¼Œç›®å‰ç»Ÿä¸€äº†å†™æ³•\n\n### [796.æ—‹è½¬å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/rotate-string/)\n\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸², `A`Â å’ŒÂ `B`ã€‚\n\n`A`Â çš„æ—‹è½¬æ“ä½œå°±æ˜¯å°†Â `A` æœ€å·¦è¾¹çš„å­—ç¬¦ç§»åŠ¨åˆ°æœ€å³è¾¹ã€‚Â ä¾‹å¦‚, è‹¥Â `A = 'abcde'`ï¼Œåœ¨ç§»åŠ¨ä¸€æ¬¡ä¹‹åç»“æœå°±æ˜¯`'bcdea'`Â ã€‚å¦‚æœåœ¨è‹¥å¹²æ¬¡æ—‹è½¬æ“ä½œä¹‹åï¼Œ`A`Â èƒ½å˜æˆ`B`ï¼Œé‚£ä¹ˆè¿”å›`True`ã€‚\n\n```java\nç¤ºä¾‹ 1:\nè¾“å…¥: A = 'abcde', B = 'cdeab'\nè¾“å‡º: true\n```\n```java\nç¤ºä¾‹ 2:\nè¾“å…¥: A = 'abcde', B = 'abced'\nè¾“å‡º: false\n```\n\n**æ³¨æ„ï¼š**\n\n*   `A` å’ŒÂ `B`Â é•¿åº¦ä¸è¶…è¿‡Â `100`ã€‚\n\n**è§£æ³•ä¸€**\n\nç»å…¸easyé¢˜å½“hardåšï¼Œè¿™ä¸ªé¢˜æ•°æ®é‡å¾ˆå°ï¼Œç›´æ¥æš´åŠ›å°±è¡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦è¿½æ±‚æ›´å¥½çš„è§£æ³•\n\nä¸€å¼€å§‹æ˜¯åœ¨ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°äº†è¿™ä¸ªé¢˜ï¼Œé‡Œé¢è¯´äº†è¿™ä¸ªé¢˜æ˜¯kmpï¼Œæˆ‘çœ‹äº†ä¸‹æ²¡æƒ³åˆ°ä»€ä¹ˆå¥½çš„æ€è·¯ï¼Œåªæƒ³åˆ°äº†ä¸€ä¸ªNlogNçš„åšæ³•ï¼ŒäºŒåˆ†+kmpæ‰¾æ—‹è½¬ç‚¹ï¼Œç„¶åkmpåˆ¤æ–­æ—‹è½¬ç‚¹åæ—¶å€™ä¹Ÿå­˜åœ¨äºAå­—ç¬¦ä¸­ï¼ˆç±»ä¼¼äºŒåˆ†ç­”æ¡ˆï¼‰\n```golang\n//ä¸å¤Ÿèªæ˜çš„åšæ³•: äºŒåˆ†+KMP æ—¶é—´å¤æ‚åº¦O(NlogN)\nfunc rotateString(A string, B string) bool {\n    if len(A) != len(B) {\n        return false\n    }\n    if A == B {\n        return true\n    }\n    var left = 0\n    var right = len(B) - 1\n    var rotate = -1\n    //äºŒåˆ†æ‰¾æ—‹è½¬ç‚¹\n    for left <= right {\n        mid := left + (right-left)/2\n        if kmp(A, B[:mid+1]) != -1 {\n            rotate = mid\n            left++\n        } else {\n            right--\n        }\n    }\n    if rotate == -1 {\n        return false\n    }\n    return kmp(A, B[rotate+1:]) != -1\n}\n\nfunc kmp(A string, t string) int {\n    var next = getNext(t)\n    var Ai = 0\n    var ti = 0\n    for Ai < len(A) && ti < len(t) {\n        if A[Ai] == t[ti] {\n            Ai++\n            ti++\n        } else if next[ti] == -1 {\n            Ai++\n        } else {\n            ti = next[ti]\n        }\n    }\n    if ti == len(t) {\n        return Ai - 1\n    }\n    return -1\n}\n\nfunc getNext(t string) []int {\n    if len(t) < 2 {\n        return []int{-1}\n    }\n    var next = make([]int, len(t))\n    var left = 0\n    next[0] = -1\n    next[1] = 0\n    var i = 2\n    for i < len(t) {\n        if t[left] == t[i-1] {\n            left++\n            next[i] = left\n            i++\n        } else if next[left] == -1 {\n            i++\n        } else {\n            left = next[left]\n        }\n    }\n    return next\n}\n```\n\n**è§£æ³•äºŒ**\n\nçœ‹äº†è¯„è®ºåŒºçš„å¤§ä½¬çš„åšæ³•ï¼Œå®é™…ä¸Š`A+A`å°±åŒ…å«äº†æ‰€æœ‰çš„æ—‹è½¬`A`çš„ç»“æœå­ä¸²ï¼Œ`A+A`å°±ç›¸å½“äºé¦–ä½ç›¸è¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨`A+A`ä¸­kmpæ‰¾`B`å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(N)`\n\n```golang\n//èªæ˜çš„è§£æ³•: A+AåŒ…å«äº†æ‰€æœ‰å¯èƒ½çš„æ—‹è½¬æƒ…å†µï¼Œç›´æ¥å¯¹A+Aå’ŒBåškmpå°±è¡Œäº†\n//abcdeabcde\nfunc rotateString(A string, B string) bool {\n    if len(A) != len(B) {\n        return false\n    }\n    if A == B {\n        return true\n    }\n    return kmp(A+A, B) != -1\n}\n```","tags":["æ•°æ®ç»“æ„","ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"å¹¶æŸ¥é›†","url":"/2020/02/02/bing-cha-ji/","content":"\n## å¹¶æŸ¥é›†\n\nåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå¹¶æŸ¥é›†æ˜¯ä¸€ç§æ ‘å‹çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå¤„ç†ä¸€äº›ä¸äº¤é›†ï¼ˆDisjoint Setsï¼‰çš„åˆå¹¶åŠæŸ¥è¯¢é—®é¢˜ã€‚æœ‰ä¸€ä¸ªè”åˆ-æŸ¥æ‰¾ç®—æ³•ï¼ˆUnion-find Algorithmï¼‰å®šä¹‰äº†ä¸¤ä¸ªç”¨äºæ­¤æ•°æ®ç»“æ„çš„æ“ä½œï¼š\n\n### UFæ¥å£\n\n```java\npublic interface UF{\n    int getSize(); //è·å–å¹¶æŸ¥é›†çš„å¤§å°\n    boolean isConnected(int p,int q); //æ˜¯å¦è¿æ¥\n    void unionElement(int p,int q); //åˆå¹¶ä¸¤ä¸ªé›†åˆ\n}\n```\n\n### UnionFind1-QuickFind\n\næŒ‰ç…§æœ´ç´ çš„æ€è·¯å†™å‡ºçš„å¹¶æŸ¥é›†\n\n```java\npublic class UnionFind1 implements UF{\n\n    private int[] id; //é›†åˆids\n\n    public UnionFind1(int size){\n        id=new int[size];\n        for (int i=0;i<size;i++) {\n            id[i]=i;\n        }\n    }\n\n    public int getSize(){\n        return id.length;\n    }\n\n    //pæ‰€å±çš„é›†åˆID\n    private int find(int p){\n        if (p<0 && p>=id.length) {\n            throw new IllegalArgumentException(\"p is out....\");\n        }\n        return id[p];\n    }\n    \n    //åˆ¤æ–­é›†åˆIDæ˜¯ä¸æ˜¯ä¸€æ ·çš„\n    public boolean isConnected(int p,int q){\n        return find(q)==find(p);\n    }\n\n    public void unionElement(int p,int q){\n        int pID=find(p);\n        int qID=find(q);\n        if (qID==pID) {\n            return;\n        }\n        for (int i=0;i<id.length;i++) {\n            if (id[i]==qID) {\n                id[i]=pID;\n            }\n        }\n    }\n}\n```\n\nåˆå§‹åŒ–çš„æ—¶å€™æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸åŒçš„é›†åˆID\n\n`find`æ“ä½œä¼šè¿”å›ä»–ä»¬æ‰€å±é›†åˆIDï¼Œæ—¶é—´å¤æ‚åº¦`O(1)`\n\n`isConnected`ä¼šåˆ¤æ–­ä¸¤ä¸ªå…ƒç´ çš„é›†åˆIDæ˜¯ä¸æ˜¯ç›¸åŒçš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯`O(1)`\n\nè€Œ`unionElement` åˆå¹¶æ“ä½œå°±æ˜¯éå†æ•´ä¸ªé›†åˆï¼Œå°†é›†åˆIDç­‰äºå…¶ä¸­ä¸€ä¸ªçš„æ”¹æˆå¦ä¸€ä¸ªï¼Œæ—¶é—´å¤æ‚åº¦`O(N)`\n\n> è¿™ç§æ–¹å¼å±äºå¿«é€ŸæŸ¥æ‰¾ï¼Œä½†æ˜¯åˆå¹¶çš„æ•ˆç‡å¤ªä½äº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ä¸‹\n\n### UnionFind2-QuickUnion\n\nè¿™ä¸€æ¬¡æˆ‘ä»¬ä¸è®°å½•æ¯ä¸ªå…ƒç´ æ‰€å±çš„é›†åˆIDï¼Œæˆ‘ä»¬è®°å½•æ¯ä¸ªå…ƒç´ çš„çˆ¶å…ƒç´ çš„IDï¼Œæ ¹èŠ‚ç‚¹ä¸€æ ·çš„å…ƒç´ å°±æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€é¢—å¥‡æ€ªçš„æ ‘ï¼Œç”±å­èŠ‚ç‚¹æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„æ ‘ï¼ˆæ£®æ—ï¼‰\n\n```java\npublic class UnionFind2 implements UF{\n\n    private int[] parent; //çˆ¶ID\n\n    public UnionFind2(int size){\n        parent=new int[size];\n        for (int i=0;i<size;i++) {\n            parent[i]=i;\n        }\n    }\n\n    public int getSize(){\n        return parent.length;\n    }\n\n    //pæ‰€å±çš„é›†åˆID\n    private int find(int index){\n        if (index<0 && index>=parent.length) {\n            throw new IllegalArgumentException(\"index is out....\");\n        }\n        while(parent[index]!=index){\n            index=parent[index];\n        }\n        return index;\n    }\n    \n    //åˆ¤æ–­é›†åˆIDæ˜¯ä¸æ˜¯ä¸€æ ·çš„\n    public boolean isConnected(int p,int q){\n        return find(q)==find(p);\n    }\n\n    public void unionElement(int p,int q){\n        int pID=find(p);\n        int qID=find(q);\n        if (qID==pID) {\n            return;\n        }\n        parent[pID]=qID;\n    }\n}\n```\n\nåˆå§‹åŒ–çš„æ—¶å€™æ¯ä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹éƒ½æŒ‡å‘è‡ªå·±\n\n`find`æ“ä½œçš„æ—¶å€™å°±ä¸åœçš„å‘ä¸Šçˆ¬ï¼Œæ‰¾åˆ°æ¯ä¸ªå…ƒç´ çš„æ ¹èŠ‚ç‚¹ï¼Œå°±æ˜¯å®ƒçš„é›†åˆIDï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯`O(h)` hæ˜¯æ ‘çš„é«˜åº¦ï¼Œæ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯`logN`ï¼Œå› ä¸ºè¿™è¯¾æ ‘å¹¶ä¸€å®šæ˜¯ä¸€æ£µäºŒå‰æ ‘\n\n`isConnected` å’Œä¸Šé¢ä¸€æ ·ï¼Œåˆ¤æ–­ä¸¤ä¸ªå…ƒç´ çš„æ ¹èŠ‚ç‚¹æ—¶å€™ä¸€æ ·å°±ok\n\n`unionElement` åˆå¹¶ä¸¤ä¸ªå…ƒç´ çš„é›†åˆï¼Œæˆ‘ä»¬åªéœ€è¦å°†å…¶ä¸­ä¸€ä¸ª`parentID`å˜ä¸ºå¦ä¸€ä¸ªçš„`parentID`å°±Okäº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(hq)+O(hp)` (hpï¼Œhqä»£è¡¨på’Œqå½¢æˆçš„æ ‘çš„é«˜åº¦)\n\n> ç›¸æ¯”ä¸Šé¢çš„`UnionFInd1`æˆ‘ä»¬ç‰ºç‰²äº†ä¸€ç‚¹æŸ¥æ‰¾çš„æ•ˆç‡è·å¾—äº†æ›´é«˜çš„åˆå¹¶æ•ˆç‡ï¼Œä½†æ˜¯ä»ç„¶è¿˜æœ‰å¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œåœ¨åˆå¹¶ä¸¤ä¸ªé›†åˆçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘ä¸¤é¢—æ ‘çš„å½¢çŠ¶ï¼Œç›´æ¥å°†ä¸€é¢—æ ‘åŠ åœ¨äº†å¦ä¸€é¢—çš„åé¢ï¼Œè€Œè¿™æ ·å¾ˆæœ‰å¯èƒ½ä¼šå¢åŠ åˆå¹¶åçš„æ ‘çš„é«˜åº¦ï¼Œç”šè‡³å¯èƒ½ä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨çš„ç»“æ„ï¼Œè¿™å°†æå¤§çš„å½±å“æˆ‘ä»¬çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ›´å¥½çš„åˆå¹¶æ–¹å¼\n>\n> ![mark](http://static.imlgw.top/blog/20200101/ifSkJmMWNB2U.png?imageslim)\n\n\n\n### UnionFind3-sizeä¼˜åŒ–\n\nè¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªszæ•°ç»„ç”¨æ¥è®°å½•æ¯ä¸ªé›†åˆçš„å…ƒç´ ä¸ªæ•°\n\n```java\npublic class UnionFind3 implements UF{\n\n    private int[] parent; //çˆ¶ID\n\n    private int[] sz; //è®°å½•æ¯é¢—æ ‘çš„èŠ‚ç‚¹æ•°é‡\n\n    public UnionFind3(int size){\n        parent=new int[size];\n        sz=new int[size];\n        for (int i=0;i<size;i++) {\n            parent[i]=i;\n            sz[i]=1;\n        }\n    }\n\n    public int getSize(){\n        return parent.length;\n    }\n\n    //pæ‰€å±çš„é›†åˆID\n    private int find(int index){\n        if (index<0 && index>=parent.length) {\n            throw new IllegalArgumentException(\"index is out....\");\n        }\n        while(parent[index]!=index){\n            index=parent[index];\n        }\n        return index;\n    }\n    \n    //åˆ¤æ–­é›†åˆIDæ˜¯ä¸æ˜¯ä¸€æ ·çš„\n    public boolean isConnected(int p,int q){\n        return find(q)==find(p);\n    }\n\n    public void unionElement(int p,int q){\n        int pID=find(p);\n        int qID=find(q);\n        if (qID==pID) {\n            return;\n        }\n        if (sz[pID]>sz[qID]) {\n            parent[qID]=pID;\n            sz[pID]+=sz[qID];    \n        }else{\n            parent[pID]=qID;\n            sz[qID]+=sz[pID];\n        }\n    }\n}\n```\n\nåˆå§‹åŒ–çš„æ—¶å€™é¢å¤–çš„å°†æ¯ä¸ªå…ƒç´ çš„szç½®ä¸º1\n\n`find`æ“ä½œå’Œ`isConnected`æ²¡æœ‰å˜åŒ–\n\n`unionElement` çš„æ—¶å€™æˆ‘ä»¬ä¸åœ¨æ˜¯ç›²ç›®çš„éšæ„åˆå¹¶ï¼Œè€Œæ˜¯å°†sizeå°çš„é›†åˆåŠ åœ¨sizeå¤§çš„é›†åˆä¸‹\n\n![mark](http://static.imlgw.top/blog/20200101/ifSkJmMWNB2U.png?imageslim)\n\nç±»ä¼¼è¿™æ ·çš„æƒ…å†µä¸‹å°±ä¸ä¼šå°†1æ¥åœ¨5ä¸‹é¢ï¼Œè€Œæ˜¯å°†5æ¥åœ¨1ä¸‹é¢ï¼Œè¿™æ ·åˆå¹¶åçš„é›†åˆçš„é«˜åº¦å°±ä¸ä¼šå¢å¤§\n\n> ä½†æ˜¯æ ¹æ®sizeåˆ¤æ–­ä¸€å®šèƒ½å‡†ç¡®åˆ¤æ–­ä¹ˆï¼Ÿå¾ˆæ˜¾ç„¶æ˜¯ä¸è¡Œçš„\n\n![mark](http://static.imlgw.top/blog/20200101/SdfeawuEf9Qz.png?imageslim)\n\nç±»ä¼¼è¿™æ ·çš„ï¼Œå¦‚æœæŒ‰ç…§ä¹‹å‰çš„æŒ‰ç…§sizeåˆå¹¶çš„æ–¹æ¡ˆå¯èƒ½åè€Œä¼šå¯¼è‡´æ ‘çš„é«˜åº¦å¢åŠ ï¼Œæ‰€ä»¥æ›´åŠ åˆç†çš„æ–¹æ¡ˆåº”è¯¥æ˜¯æ ¹æ®æ ‘çš„é«˜åº¦æ¥åˆå¹¶\n\n### UnionFind4-hightä¼˜åŒ–\n\n```java\npublic class UnionFind4 implements UF{\n\n    private int[] parent; //çˆ¶ID\n\n    private int[] hight; //æ¯ä¸ªé›†åˆå½¢æˆçš„æ ‘çš„é«˜åº¦\n\n    public UnionFind4(int size){\n        parent=new int[size];\n        hight=new int[size];\n        for (int i=0;i<size;i++) {\n            parent[i]=i;\n            hight[i]=1;\n        }\n    }\n\n    public int getSize(){\n        return parent.length;\n    }\n\n    //pæ‰€å±çš„é›†åˆID\n    private int find(int index){\n        if (index<0 && index>=parent.length) {\n            throw new IllegalArgumentException(\"index is out....\");\n        }\n        while(parent[index]!=index){\n            index=parent[index];\n        }\n        return index;\n    }\n    \n    //åˆ¤æ–­é›†åˆIDæ˜¯ä¸æ˜¯ä¸€æ ·çš„\n    public boolean isConnected(int p,int q){\n        return find(q)==find(p);\n    }\n\n    public void unionElement(int p,int q){\n        int pID=find(p);\n        int qID=find(q);\n        if (qID==pID) {\n            return;\n        }\n        if (hight[pID]>hight[qID]) {\n            parent[qID]=pID;    \n        }else if(hight[pID]<hight[qID]){\n            parent[pID]=qID;\n        }else{ //é«˜åº¦ç›¸ç­‰æƒ…å†µ,æ‰ä¼šå¢å¤§æ ‘çš„é«˜åº¦\n            parent[pID]=qID; \n            hight[qID]++;\n        }\n    }\n}\n```\n\nåˆå§‹åŒ–çš„æ—¶å€™ä»ç„¶å°†æ¯ä¸ªå…ƒç´ çš„é«˜åº¦è®¾ç½®ä¸º1\n\nåˆå¹¶çš„æ—¶å€™æˆ‘ä»¬æ ¹æ®æ ‘çš„é«˜åº¦æ¥åˆå¹¶ï¼Œå°†é«˜åº¦å°çš„é›†åˆæ·»åŠ åˆ°é«˜åº¦å¤§çš„é›†åˆä¸Šï¼Œè¿™æ ·æ•´ä½“çš„é«˜åº¦å¹¶ä¸ä¼šå˜åŒ–ï¼Œä»ç„¶æ˜¯é«˜åº¦è¾ƒå¤§çš„é›†åˆçš„é«˜åº¦ï¼Œåªæœ‰åœ¨ä¸¤é¢—æ ‘çš„é«˜åº¦ç›¸åŒçš„æ—¶å€™æ‰ä¼šä½¿é›†åˆé«˜åº¦å¢åŠ ï¼Œè¿™ä¸ªæ—¶å€™å°±æ— æ‰€è°“è°æ·»åŠ åˆ°è°ä¸Šäº†\n\n> å›å¤´æƒ³ä¸€æƒ³ï¼Œå…¶å®æˆ‘ä»¬æŸ¥æ‰¾æˆ–è€…åˆå¹¶çš„æ—¶å€™å¹¶ä¸ä¼šå»å…³ç³»æ¯ä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹åˆæˆ–è€…çˆ·èŠ‚ç‚¹æ˜¯å•¥ï¼Œæˆ‘ä»¬åªå…³å¿ƒçš„æ˜¯è¿™ä¸ªå…ƒç´ çš„ç¥–å®—èŠ‚ç‚¹æ˜¯å•¥ï¼Œä¹Ÿå°±æ˜¯æ ¹èŠ‚ç‚¹æ˜¯å•¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸Œæœ›æ¯ä¸ªé›†åˆçš„é«˜åº¦è¶Šå°è¶Šå¥½\n\n![mark](http://static.imlgw.top/blog/20200101/D84lWwYGlVag.png?imageslim)\n\n### UnionFind5-è·¯å¾„å‹ç¼©\n\nåœ¨findè¿‡ç¨‹ä¸­å¢åŠ äº†è·¯å¾„å‹ç¼©çš„åŠŸèƒ½\n\n```java\npublic class UnionFind5 implements UF{\n\n    private int[] parent; //çˆ¶ID\n\n    private int[] rank;\n\n    public UnionFind5(int size){\n        parent=new int[size];\n        rank=new int[size];\n        for (int i=0;i<size;i++) {\n            parent[i]=i;\n            rank[i]=1;\n        }\n    }\n\n    public int getSize(){\n        return parent.length;\n    }\n\n    //pæ‰€å±çš„é›†åˆID\n    private int find(int index){\n        if (index<0 && index>=parent.length) {\n            throw new IllegalArgumentException(\"index is out....\");\n        }\n        while(parent[index]!=index){\n            parent[index]=parent[parent[index]]; //è·¯å¾„å‹ç¼©\n            index=parent[index];\n        }\n        return index;\n    }\n\t\n    //é€’å½’çš„æ–¹å¼è¿›è¡Œè·¯å¾„å‹ç¼©ï¼Œå¯ä»¥å‹å¾—æ›´ä½\n    private int find2(int index){\n        if (index<0 && index>=parent.length) {\n            throw new IllegalArgumentException(\"index is out....\");\n        }\n        if(parent[index]!=index){\n            parent[index]=find2(parent[index]);\n        }\n        return parent[index];\n    }\n    \n    //åˆ¤æ–­é›†åˆIDæ˜¯ä¸æ˜¯ä¸€æ ·çš„\n    public boolean isConnected(int p,int q){\n        return find(q)==find(p);\n    }\n\n    public void unionElement(int p,int q){\n        int pID=find(p);\n        int qID=find(q);\n        if (qID==pID) {\n            return;\n        }\n        if (rank[pID]>rank[qID]) {\n            parent[qID]=pID;    \n        }else if(rank[pID]<rank[qID]){\n            parent[pID]=qID;\n        }else{ //é«˜åº¦ç›¸ç­‰æƒ…å†µ,æ‰ä¼šå¢å¤§æ ‘çš„Rank\n            parent[pID]=qID; \n            rank[qID]++;\n        }\n    }\n}\n```\n\nfindæ“ä½œæœ¬èº«å°±æ˜¯ä¸€ä¸ªå‘ä¸Šéå†çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å†findå¾—è¿‡ç¨‹ä¸­å»è¿›è¡Œè·¯å¾„çš„å‹ç¼©\n\næ ¸å¿ƒçš„è¯­å¥å°±æ˜¯ `parent[index]=parent[parent[index]];`\n\nå¦‚æœçˆ¶èŠ‚ç‚¹ä¸æ˜¯è¦æ‰¾çš„æ ¹èŠ‚ç‚¹å°±å°†çˆ¶èŠ‚ç‚¹è®¾ç½®ä¸ºçˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹\n\nå½“ç„¶è¿™é‡Œè¿˜æœ‰ä¸€ç§å‹ç¼©çš„æ–¹å¼ï¼Œå¯ä»¥å°†æ ‘å‹ç¼©çš„æ›´çŸ­ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„`find2`ï¼Œæ ¸å¿ƒè¯­å¥å°±æ˜¯\n\n `parent[index]=find2(parent[index])` \n\n![mark](http://static.imlgw.top/blog/20200101/D84lWwYGlVag.png?imageslim)\n\nå¦‚æœæ˜¯è¿™æ ·çš„æ ‘æ‰§è¡Œ `find2(5)` å¯ä»¥ç›´æ¥å°†æ ‘å‹ç¼©æˆå·¦è¾¹çš„æ ·å­ï¼Œè€Œ`find1(5)` å¹¶ä¸èƒ½ä¸€æ¬¡å°±å‹ç¼©æˆè¿™æ ·ï¼Œä¸¤è€…å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œè¿™é‡Œä¸è¿‡å¤šé˜è¿°\n\n> ç»†å¿ƒçš„æœ‹å‹è‚¯å®šå‘ç°äº†ï¼Œæˆ‘è¿™é‡Œå°†`hight`æ”¹æˆäº†`rank`ï¼Œä¸ºä»€ä¹ˆè¦æ”¹æˆrank?\n>\n> å…¶å®åŸå› å¾ˆç®€å•ï¼Œåœ¨åŠ å…¥äº†è·¯å¾„å‹ç¼©åï¼Œè¿™é‡Œçš„hightä¸å†èƒ½è¡¨ç¤ºé«˜åº¦çš„å«ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹æˆäº†Rank\n>\n> é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç»§ç»­ç»´æŠ¤è¿™ä¸ªé«˜åº¦äº†ï¼Ÿè¿™æ ·ä¸æ˜¯å°±æ— æ³•å‡†ç¡®çš„åˆ¤æ–­å¦‚ä½•åˆå¹¶äº†å˜›ï¼Ÿ\n>\n> å…¶å®è¿™é‡Œå¦‚æœæƒ³è¦ç»§ç»­ç»´æŠ¤è¿™ä¸ªæ ‘çš„é«˜åº¦æ˜¯ä¸€ç§ä¸å¤ªæ˜æ™ºçš„é€‰æ‹©ï¼Œæˆæœ¬å¤ªå¤§äº†ï¼Œéš¾ä»¥ç»´æŠ¤ï¼Œå¹¶ä¸æ˜¯ç®€å•çš„`--` å°±å¯ä»¥å®Œæˆçš„ï¼Œä¼šæœ‰å¾ˆå¤šçš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬ç´¢æ€§ç›´æ¥å°†å…¶æ”¹æˆRankä½œä¸ºä¸€ä¸ªå‚è€ƒé‡ï¼Œè¡¨ç¤ºè¿™ä¸ªé›†åˆçš„æ’åï¼Œå…¶å®ä»”ç»†æƒ³ä¸€æƒ³ï¼Œæˆ‘ä»¬è¿›è¡Œè·¯å¾„å‹ç¼©å¸¦æ¥çš„ä¼˜åŒ–æ˜æ˜¾ä¼šå¤§äºç»´æŠ¤hightå¸¦æ¥çš„ä¼˜åŒ–\n\n### æ—¶é—´å¤æ‚åº¦\n\nè¿™é‡Œç»è¿‡ç§‘å­¦å®¶ä»¬çš„è®¡ç®—è¯æ˜å¾—åˆ°æœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦æ˜¯ `O(log*N)`æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å¬è¯´è¿™ä¸ªå¤æ‚åº¦ï¼Œ\n\n![mark](http://static.imlgw.top/blog/20200101/iXPijTwciz0b.png?imageslim)\n\n**è¿­ä»£å¯¹æ•°**\n\n| n                | lg* n |\n| ---------------- | ----- |\n| (âˆ’âˆ, 1]          | 0     |\n| (1, 2]           | 1     |\n| (2, 4]           | 2     |\n| (4, 16]          | 3     |\n| (16, 65536]      | 4     |\n| (65536, 2^65536] | 5     |\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ç›¸å½“ä½ï¼Œå¯ä»¥è¿‘ä¼¼çš„è®¤ä¸ºå°±æ˜¯ä¸€ä¸ª`O(1)` å¸¸æ•°çš„å¤æ‚åº¦\n\n## ç»ƒæ‰‹ä¾‹é¢˜\n\n### [547. æœ‹å‹åœˆ](https://leetcode-cn.com/problems/friend-circles/)\n\nç­ä¸Šæœ‰ N åå­¦ç”Ÿã€‚å…¶ä¸­æœ‰äº›äººæ˜¯æœ‹å‹ï¼Œæœ‰äº›åˆ™ä¸æ˜¯ã€‚ä»–ä»¬çš„å‹è°Šå…·æœ‰æ˜¯ä¼ é€’æ€§ã€‚å¦‚æœå·²çŸ¥ A æ˜¯ B çš„æœ‹å‹ï¼ŒB æ˜¯ C çš„æœ‹å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¤ä¸º A ä¹Ÿæ˜¯ C çš„æœ‹å‹ã€‚æ‰€è°“çš„æœ‹å‹åœˆï¼Œæ˜¯æŒ‡æ‰€æœ‰æœ‹å‹çš„é›†åˆã€‚\n\nç»™å®šä¸€ä¸ª N * N çš„çŸ©é˜µ Mï¼Œè¡¨ç¤ºç­çº§ä¸­å­¦ç”Ÿä¹‹é—´çš„æœ‹å‹å…³ç³»ã€‚å¦‚æœ`M[i][j] = 1`ï¼Œè¡¨ç¤ºå·²çŸ¥ç¬¬ i ä¸ªå’Œ j ä¸ªå­¦ç”Ÿäº’ä¸ºæœ‹å‹å…³ç³»ï¼Œå¦åˆ™ä¸ºä¸çŸ¥é“ã€‚ä½ å¿…é¡»è¾“å‡ºæ‰€æœ‰å­¦ç”Ÿä¸­çš„å·²çŸ¥çš„æœ‹å‹åœˆæ€»æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \n[[1,1,0],\n [1,1,0],\n [0,0,1]]\nè¾“å‡º: 2 \nè¯´æ˜ï¼šå·²çŸ¥å­¦ç”Ÿ0å’Œå­¦ç”Ÿ1äº’ä¸ºæœ‹å‹ï¼Œä»–ä»¬åœ¨ä¸€ä¸ªæœ‹å‹åœˆã€‚\nç¬¬2ä¸ªå­¦ç”Ÿè‡ªå·±åœ¨ä¸€ä¸ªæœ‹å‹åœˆã€‚æ‰€ä»¥è¿”å›2ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \n[[1,1,0],\n [1,1,1],\n [0,1,1]]\nè¾“å‡º: 1\nè¯´æ˜ï¼šå·²çŸ¥å­¦ç”Ÿ0å’Œå­¦ç”Ÿ1äº’ä¸ºæœ‹å‹ï¼Œå­¦ç”Ÿ1å’Œå­¦ç”Ÿ2äº’ä¸ºæœ‹å‹ï¼Œæ‰€ä»¥å­¦ç”Ÿ0å’Œå­¦ç”Ÿ2ä¹Ÿæ˜¯æœ‹å‹ï¼Œæ‰€ä»¥ä»–ä»¬ä¸‰ä¸ªåœ¨ä¸€ä¸ªæœ‹å‹åœˆï¼Œè¿”å›1ã€‚\n```\n\n**æ³¨æ„ï¼š**\n\n1. N åœ¨`[1,200]`çš„èŒƒå›´å†…ã€‚\n2. å¯¹äºæ‰€æœ‰å­¦ç”Ÿï¼Œæœ‰`M[i][i] = 1`ã€‚\n3. å¦‚æœæœ‰`M[i][j] = 1`ï¼Œåˆ™æœ‰`M[j][i] = 1`ã€‚\n\n**è§£æ³•äºŒ**\n\nè¿™é¢˜å¾ˆä¹…ä¹‹å‰åšè¿‡ [LeetCodeå›æº¯&é€’å½’](http://imlgw.top/2019/10/10/leetcode-hui-su/#547-%E6%9C%8B%E5%8F%8B%E5%9C%88) å½“æ—¶DFSåšçš„ï¼Œå…¶å®è¿™é¢˜åº”è¯¥å±äºæœ€ç»å…¸çš„å¹¶æŸ¥é›†çš„é¢˜ç›®äº†\n\n```java\nprivate int[] parent; //çˆ¶ID\n\nprivate int[] rank;\n\n//pæ‰€å±çš„é›†åˆID\nprivate int find(int index){\n    if (index<0 && index>=parent.length) {\n        throw new IllegalArgumentException(\"index is out....\");\n    }\n    while(parent[index]!=index){\n        parent[index]=parent[parent[index]];\n        index=parent[index];\n    }\n    return index;\n}\n\npublic void unionElement(int p,int q){\n    int pID=find(p);\n    int qID=find(q);\n    if (qID==pID) {\n        return;\n    }\n    if (rank[pID]>rank[qID]) {\n        parent[qID]=pID;    \n    }else if(rank[pID]<rank[qID]){\n        parent[pID]=qID;\n    }else{ //é«˜åº¦ç›¸ç­‰æƒ…å†µ,æ‰ä¼šå¢å¤§æ ‘çš„é«˜åº¦\n        parent[pID]=qID; \n        rank[qID]++;\n    }\n}\n\npublic int findCircleNum(int[][] M) {\n    parent=new int[M.length];\n    rank=new int[M.length];\n    //åˆå§‹åŒ–\n    for (int i=0;i<M.length;i++) {\n        parent[i]=i;\n        rank[i]=1;\n    }\n    //union\n    for (int i=0;i<M.length;i++) {\n        for (int j=0;j<M.length;j++) {\n            if (M[i][j]==1) {\n                unionElement(i,j);\n            }\n        }\n    }\n    int res=0;\n    for (int i=0;i<parent.length;i++) {\n        if (parent[i]==i) {\n            res++;\n        }\n    }\n    return res;\n}\n```\n\nä»£ç è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œåˆå¹¶ä¹‹åç»Ÿè®¡ä¸€ä¸‹æ•°é‡å°±okäº†\n\n### [128. æœ€é•¿è¿ç»­åºåˆ—](https://leetcode-cn.com/problems/longest-consecutive-sequence/)\n\nç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºæœ€é•¿è¿ç»­åºåˆ—çš„é•¿åº¦ã€‚\n\nè¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [100, 4, 200, 1, 3, 2]\nè¾“å‡º: 4\nè§£é‡Š: æœ€é•¿è¿ç»­åºåˆ—æ˜¯ [1, 2, 3, 4]ã€‚å®ƒçš„é•¿åº¦ä¸º 4ã€‚\n```\n\n**å¹¶æŸ¥é›†è§£æ³•**\n\n```java\n//å¹¶æŸ¥é›†\nHashMap<Integer,Integer> parent;\n\nHashMap<Integer,Integer> size;\n\nint max=1;\n\npublic int find(int index){\n    while(parent.get(index)!=index){\n        //parent[index]=parent[parent[index]];\n        parent.put(index,parent.get(index));\n        index=parent.get(index);\n    }\n    return index;\n}\n\npublic void union(int p,int q){\n    int pID=find(p);\n    int qID=find(q);\n    if (pID==qID) {\n        return;\n    }\n    int pSize=size.get(pID);\n    int qSize=size.get(qID);\n    if (pSize > qSize) {\n        //parent[qID]=pID;\n        parent.put(qID,pID);\n        //size[pID]+=size[qID];\n        size.put(pID,pSize+qSize);\n    }else{\n        //parent[pID]=qID;\n        parent.put(pID,qID);\n        //size[qID]+=size[pID];\n        size.put(qID,pSize+qSize);\n    }\n    max=Math.max(max,pSize+qSize); //ç»Ÿè®¡æœ€å¤§å€¼\n}\n\npublic void initUnionFind(int[]nums){\n    parent=new HashMap<>();\n    size=new HashMap<>();\n    for (int i=0;i<nums.length;i++) {\n        parent.put(nums[i],nums[i]);\n        size.put(nums[i],1);\n    }\n}\n\npublic int longestConsecutive(int[] nums) {\n    if (nums ==null || nums.length<=0) {\n        return 0;\n    }\n    HashSet<Integer> set=new HashSet();\n    for (int i=0;i<nums.length;i++) {\n        set.add(nums[i]);\n    }\n    initUnionFind(nums);\n    for (int i=0;i<nums.length;i++) {\n        if (set.contains(nums[i]-1)) { //åˆ¤æ–­-1æˆ–è€…+1éƒ½å¯ä»¥\n            union(nums[i],nums[i]-1);\n        }\n    }\n    return max;\n}\n```\n\nè¿™é‡Œç”¨å¹¶æŸ¥é›†å…¶å®å¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œç›´æ¥å¾ªç¯ç”¨HashSetæ„Ÿè§‰ä¼šæ›´å¥½æ›´ç®€æ´  [è¯¦è§ LeetCodeæŸ¥æ‰¾](http://imlgw.top/2019/09/15/leetcode-cha-zhao/) ä¸è¿‡ç†Ÿæ‚‰ä¸€ä¸‹å¹¶æŸ¥é›†è¿˜æ˜¯ä¸é”™çš„ï¼Œè¿™é‡Œå› ä¸ºæ˜¯æ ¹æ®numçš„æ•°å€¼åˆ¤æ–­çš„ï¼Œcodeæ‰€ä»¥ç”¨æ•°ç»„ç´¢å¼•åˆå¹¶æ˜¯è¡Œä¸é€šçš„ï¼Œéœ€è¦æ”¹æˆHashè¡¨\n\n### [1319. è¿é€šç½‘ç»œçš„æ“ä½œæ¬¡æ•°](https://leetcode-cn.com/problems/number-of-operations-to-make-network-connected/)\n\nç”¨ä»¥å¤ªç½‘çº¿ç¼†å°† n å°è®¡ç®—æœºè¿æ¥æˆä¸€ä¸ªç½‘ç»œï¼Œè®¡ç®—æœºçš„ç¼–å·ä» 0 åˆ° n-1ã€‚çº¿ç¼†ç”¨ connections è¡¨ç¤ºï¼Œå…¶ä¸­ connections[i] = [a, b] è¿æ¥äº†è®¡ç®—æœº a å’Œ bã€‚\n\nç½‘ç»œä¸­çš„ä»»ä½•ä¸€å°è®¡ç®—æœºéƒ½å¯ä»¥é€šè¿‡ç½‘ç»œç›´æ¥æˆ–è€…é—´æ¥è®¿é—®åŒä¸€ä¸ªç½‘ç»œä¸­å…¶ä»–ä»»æ„ä¸€å°è®¡ç®—æœºã€‚\n\nç»™ä½ è¿™ä¸ªè®¡ç®—æœºç½‘ç»œçš„åˆå§‹å¸ƒçº¿ connectionsï¼Œä½ å¯ä»¥æ‹”å¼€ä»»æ„ä¸¤å°ç›´è¿è®¡ç®—æœºä¹‹é—´çš„çº¿ç¼†ï¼Œå¹¶ç”¨å®ƒè¿æ¥ä¸€å¯¹æœªç›´è¿çš„è®¡ç®—æœºã€‚è¯·ä½ è®¡ç®—å¹¶è¿”å›ä½¿æ‰€æœ‰è®¡ç®—æœºéƒ½è¿é€šæ‰€éœ€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚å¦‚æœä¸å¯èƒ½ï¼Œåˆ™è¿”å› -1 ã€‚ \n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/02/01/4HfDievqKpbswNh.png)\n\n```java\nè¾“å…¥ï¼šn = 4, connections = [[0,1],[0,2],[1,2]]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šæ‹”ä¸‹è®¡ç®—æœº 1 å’Œ 2 ä¹‹é—´çš„çº¿ç¼†ï¼Œå¹¶å°†å®ƒæ’åˆ°è®¡ç®—æœº 1 å’Œ 3 ä¸Š\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![image.png](https://i.loli.net/2020/02/01/mDjJCSHwOrZoa9g.png)\n\n```java\nè¾“å…¥ï¼šn = 6, connections = [[0,1],[0,2],[0,3],[1,2],[1,3]]\nè¾“å‡ºï¼š2\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 6, connections = [[0,1],[0,2],[0,3],[1,2]]\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼šçº¿ç¼†æ•°é‡ä¸è¶³ã€‚\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 5, connections = [[0,1],[0,2],[3,4],[2,3]]\nè¾“å‡ºï¼š0\n```\n\n**æç¤ºï¼š**\n\n- 1 <= n <= 10^5\n- 1 <= connections.length <= min(n*(n-1)/2, 10^5)\n- connections[i].length == 2\n- 0 <= connections[i][0], connections[i][1] < n\n- connections[i][0] != connections[i][1]\n- æ²¡æœ‰é‡å¤çš„è¿æ¥ã€‚\n- ä¸¤å°è®¡ç®—æœºä¸ä¼šé€šè¿‡å¤šæ¡çº¿ç¼†è¿æ¥ã€‚\n\n**è§£æ³•ä¸€**\n\n1.12å‘¨èµ›çš„ç¬¬ä¸‰é¢˜ï¼ŒæŒºæœ‰æ„æ€çš„ï¼Œå½“æ—¶æƒ³äº†ä¸€ä¼šå„¿ï¼Œç„¶åå°±ç›´æ¥æƒ³åˆ°äº†å¹¶æŸ¥é›†\n\n```java\nprivate int[] parent; //çˆ¶ID\n\nprivate int[] rank;\n\n//pæ‰€å±çš„é›†åˆID\nprivate int find(int index){\n    if (index<0 && index>=parent.length) {\n        throw new IllegalArgumentException(\"index is out....\");\n    }\n    while(parent[index]!=index){\n        parent[index]=parent[parent[index]];\n        index=parent[index];\n    }\n    return index;\n}\n\npublic void union(int p,int q){\n    int pID=find(p);\n    int qID=find(q);\n    if (qID==pID) {\n        return;\n    }\n    if (rank[pID]>rank[qID]) {\n        parent[qID]=pID;    \n    }else if(rank[pID]<rank[qID]){\n        parent[pID]=qID;\n    }else{ //é«˜åº¦ç›¸ç­‰æƒ…å†µ,æ‰ä¼šå¢å¤§æ ‘çš„é«˜åº¦\n        parent[pID]=qID; \n        rank[qID]++;\n    }\n}\n\n//åˆ¤æ–­é›†åˆIDæ˜¯ä¸æ˜¯ä¸€æ ·çš„\npublic boolean isConnected(int p,int q){\n    return find(q)==find(p);\n}\n\npublic void initUF(int n){\n    parent=new int[n];\n    rank=new int[n];\n    for (int i=0;i<n;i++) {\n        parent[i]=i;\n        rank[i]=1;\n    }\n}\n\npublic int makeConnected(int n, int[][] connections) {\n    initUF(n);\n    int more=0;\n    for (int i=0;i<connections.length;i++) {\n        if (isConnected(connections[i][0],connections[i][1])) {\n            more++; //å¤šå‡ºæ¥çš„è¾¹ä¸ªæ•°\n        }else{\n            union(connections[i][0],connections[i][1]);\n        }\n    }\n    int count=0;\n    for (int i=0;i<n;i++) {\n        if (parent[i]==i) {\n            count++; //é›†åˆä¸ªæ•°\n        }\n    }\n    return count-1<=more?count-1:-1;\n}\n```\n\næ ¸å¿ƒæ€è·¯å°±æ˜¯å°†å…ƒç´ åˆå¹¶ï¼Œç„¶åä¸­é—´æ±‚å‡ºå¤šå‡ºçš„è¾¹ï¼Œæœ€ååˆ¤æ–­å¤šå‡ºæ¥çš„è¾¹èƒ½ä¸èƒ½å°†æ‰€æœ‰çš„é›†åˆèšåˆæˆä¸€ä¸ªå¤§é›†åˆï¼Œä¹Ÿå°±æ˜¯`count-1<=more`çš„æ—¶å€™æ‰å¯ä»¥è”é€šï¼Œå¦åˆ™å°±æ— æ³•è”é€š\n\n### [399. é™¤æ³•æ±‚å€¼](https://leetcode-cn.com/problems/evaluate-division/)\n\nç»™å‡ºæ–¹ç¨‹å¼ A / B = k, å…¶ä¸­ A å’Œ B å‡ä¸ºä»£è¡¨å­—ç¬¦ä¸²çš„å˜é‡ï¼Œ k æ˜¯ä¸€ä¸ªæµ®ç‚¹å‹æ•°å­—ã€‚æ ¹æ®å·²çŸ¥æ–¹ç¨‹å¼æ±‚è§£é—®é¢˜ï¼Œå¹¶è¿”å›è®¡ç®—ç»“æœã€‚å¦‚æœç»“æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1.0ã€‚\n\nç¤ºä¾‹ :\n\n```java\nç»™å®š a / b = 2.0, b / c = 3.0\né—®é¢˜: a / c = ?, b / a = ?, a / e = ?, a / a = ?, x / x = ? \nè¿”å› [6.0, 0.5, -1.0, 1.0, -1.0 ]\n```\n\nè¾“å…¥ä¸º: `vector<pair<string, string>> equations, vector<double>& values, vector<pair<string, string>> queries(æ–¹ç¨‹å¼ï¼Œæ–¹ç¨‹å¼ç»“æœï¼Œé—®é¢˜æ–¹ç¨‹å¼)`ï¼Œ å…¶ä¸­ `equations.size() == values.size()`ï¼Œå³æ–¹ç¨‹å¼çš„é•¿åº¦ä¸æ–¹ç¨‹å¼ç»“æœé•¿åº¦ç›¸ç­‰ï¼ˆç¨‹å¼ä¸ç»“æœä¸€ä¸€å¯¹åº”ï¼‰ï¼Œå¹¶ä¸”ç»“æœå€¼å‡ä¸ºæ­£æ•°ã€‚ä»¥ä¸Šä¸ºæ–¹ç¨‹å¼çš„æè¿°ã€‚ è¿”å›`vector<double>`ç±»å‹ã€‚\n\nåŸºäºä¸Šè¿°ä¾‹å­ï¼Œè¾“å…¥å¦‚ä¸‹ï¼š\n\n```java\nequations(æ–¹ç¨‹å¼) = [ [\"a\", \"b\"], [\"b\", \"c\"] ],\nvalues(æ–¹ç¨‹å¼ç»“æœ) = [2.0, 3.0],\nqueries(é—®é¢˜æ–¹ç¨‹å¼) = [ [\"a\", \"c\"], [\"b\", \"a\"], [\"a\", \"e\"], [\"a\", \"a\"], [\"x\", \"x\"] ]. \n```\n\n\nè¾“å…¥æ€»æ˜¯æœ‰æ•ˆçš„ã€‚ä½ å¯ä»¥å‡è®¾é™¤æ³•è¿ç®—ä¸­ä¸ä¼šå‡ºç°é™¤æ•°ä¸º0çš„æƒ…å†µï¼Œä¸”ä¸å­˜åœ¨ä»»ä½•çŸ›ç›¾çš„ç»“æœã€‚\n\n**è§£æ³•ä¸€**\n\né¦–å…ˆå¼„æ¸…æ¥šé¢˜ç›®çš„æ„æ€ï¼Œè¿™é¢˜LeetCodeä¸Šåªæ˜¯midï¼Œå…¶å®æˆ‘æ„Ÿè§‰å¦‚æœç”¨å¹¶æŸ¥é›†åšçš„è¯å°±ä¸æ˜¯midé¢˜äº†ï¼Œä»Šå¤©æäº†å¥½é•¿æ—¶é—´å¹¶æŸ¥é›†çš„è§£æ³•\n\né¦–å…ˆæ¥ä¸€ç‰ˆä¸å¸¦è·¯å¾„å‹ç¼©çš„\n\n```java\nprivate HashMap<String,String> parent=new HashMap<>();\n\nprivate HashMap<String,Double> quotient=new HashMap<>();\n\n//ä¸å¸¦è·¯å¾„å‹ç¼©\npublic String find(String p){\n    while (parent.get(p)!=p) {\n        p=parent.get(p);\n    }\n    return p;\n}\n\npublic void init(String s){\n    if (!parent.containsKey(s)) {\n        parent.put(s,s);\n        quotient.put(s,1.0);   \n    }\n}\n\npublic void merge(String a,String b,Double value){\n    init(a);init(b);\n    String fa=find(a); // a/fa=val[a], b/fb=val[b]\n    String fb=find(b);\n    if (fa.equals(fb)) {\n        return;\n    }\n    parent.put(fa,fb);\n    quotient.put(fa,value*(cal(b)/cal(a))); //cal(a)å’Œcal(b)ä»£è¡¨aå’Œbåˆ°æ ¹èŠ‚ç‚¹çš„æ€»å€¼\n}\n\npublic double[] calcEquation(List<List<String>> equations, double[] values, List<List<String>> queries) {\n    for (int i=0;i<equations.size();i++) {\n        List<String> equation=equations.get(i);\n        merge(equation.get(0),equation.get(1),values[i]);\n    }\n    double[] res=new double[queries.size()];\n    int index=0;\n    for (List<String> query:queries) {\n        String a=find(query.get(0));\n        String b=find(query.get(1));\n        System.out.println(a+\" \"+b);\n        if (!parent.containsKey(query.get(0)) || !parent.containsKey(query.get(1)) || !a.equals(b)) {\n            res[index++]=-1;\n        }else{\n            //æ²¡æœ‰è·¯åŠ²å‹ç¼©,éœ€è¦éå†æ•´ä¸ªè·¯åŠ²æ±‚ç§¯\n            res[index++]=cal(query.get(0))/cal(query.get(1));\n        }\n    }\n    return res;\n}\n\n\n//è®¡ç®—å½“å‰èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¹˜ç§¯\npublic double cal(String index){\n    double res=quotient.get(index);\n    while(parent.get(index)!=index){\n        index=parent.get(index);\n        res*=quotient.get(index);\n    }\n    return res;\n}\n```\n\nå…¶å®è¿™é¢˜æˆ‘å¼€å§‹æƒ³åˆ°å°±æ˜¯å»ºå›¾ç„¶åBFSï¼Œå¹¶æŸ¥é›†æˆ‘æ˜¯çœŸæ²¡æƒ³åˆ°ï¼Œçœ‹æ¥è¿˜æ˜¯ä¸å¤Ÿæ•é”ï¼Œä¸è¿‡æœ‰ä¸€è¯´ä¸€å¹¶æŸ¥é›†çš„æ–¹æ³•ç¡®å®æ¯”è¾ƒéº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯å¸¦äº†è·¯å¾„å‹ç¼©çš„ã€‚\n\nè¿™é‡Œæˆ‘çš„å¹¶æŸ¥é›†çš„æ–¹å‘æ˜¯\n\n```java\na/b=2 , b/c=3\n    \n        c  1\n        ^\n        |\n        b  3\n        ^\n        |\n        a  2\n```\n\n`quotient`ä»£è¡¨çš„æ˜¯**å½“å‰èŠ‚ç‚¹**æ˜¯**ç›´æ¥çˆ¶èŠ‚ç‚¹**çš„å¤šå°‘å€ï¼Œä¹Ÿå°±æ˜¯ `A/fatherA`  ï¼Œé‡ç‚¹å°±æ˜¯åˆå¹¶ä¸¤ä¸ªé›†åˆçš„æ—¶å€™éœ€è¦æ³¨æ„ï¼š\n\n```java\nå·²çŸ¥\na / fa = val[a]\nb / fb = val[b]\nç°åœ¨æˆ‘ä»¬è¦åˆå¹¶aï¼Œbä¸” a / b=value\næ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾ç½® parent[fa]=fb\nç”±äºfaçˆ¶èŠ‚ç‚¹å‘ç”Ÿäº†å˜åŒ–æ‰€ä»¥å®ƒçš„å€¼ä¹Ÿéœ€è¦å˜åŒ–,ä¹Ÿå°±æ˜¯è¦æ±‚ fa/fbçš„å€¼\nval[fa] = fa/fb = a/b * b/fb * fa/a = value * (val[b] / val[a])\n```\n\n**è§£æ³•äºŒ**\n\n```java\nprivate HashMap<String,String> parent=new HashMap<>();\n\nprivate HashMap<String,Double> quotient=new HashMap<>();\n\n//å¸¦è·¯å¾„å‹ç¼©çš„\npublic String find(String p){\n    if (parent.get(p)!=p) {\n        //éœ€è¦å…ˆä¿å­˜çˆ¶äº²çš„å€¼,å› ä¸ºåé¢å‹ç¼©åæ ‘åªæœ‰ä¸¤å±‚,åé¢*çš„å°±æ˜¯æ ¹èŠ‚ç‚¹çš„æƒå€¼1,æ˜¯ä¸å¯¹çš„\n        //è¿™é‡Œå¯ä»¥çœ‹çœ‹ä¸Šé¢çš„å¹¶èŒ¶å‡ çš„æ–¹å‘å’Œå€¼æ¥åˆ¤æ–­\n        String f=parent.get(p); \n        parent.put(p,find(f));\n        //è¿™æ ·å‹ç¼©åçš„å­èŠ‚ç‚¹æ‰æ˜¯æ­£ç¡®çš„\n        quotient.put(p,quotient.get(p)*quotient.get(f));\n    }\n    return parent.get(p);\n}\n\npublic void init(String s){\n    if (!parent.containsKey(s)) {\n        parent.put(s,s);\n        quotient.put(s,1.0);   \n    }\n}\n\npublic void merge(String a,String b,Double value){\n    init(a);init(b);\n    String fa=find(a); // fa/a=val[a], fb/b=val[b]\n    String fb=find(b);\n    if (fa.equals(fb)) {\n        return;\n    }\n    parent.put(fa,fb);\n    quotient.put(fa,value*(quotient.get(b)/quotient.get(a))); \n}\n\npublic double[] calcEquation(List<List<String>> equations, double[] values, List<List<String>> queries) {\n    for (int i=0;i<equations.size();i++) {\n        List<String> equation=equations.get(i);\n        merge(equation.get(0),equation.get(1),values[i]);\n    }\n    double[] res=new double[queries.size()];\n    int index=0;\n    for (List<String> query:queries) {\n        String a=query.get(0);\n        String b=query.get(1);\n        if (!parent.containsKey(a) || !parent.containsKey(b)) {\n            res[index++]=-1;\n        }else{\n            //å…ˆåšè·¯å¾„å‹ç¼©\n            res[index++]=find(a).equals(find(b))?quotient.get(a)/quotient.get(b):-1;\n        }\n    }\n    return res;\n}\n```\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°å·²ç»çœç•¥äº†`cal` å‡½æ•°è®¡ç®—ä»å½“å‰èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„æ€»æƒå€¼ç§¯ï¼Œå› ä¸ºè¿™é‡Œè·¯å¾„å‹ç¼©å·²ç»å°†æ ‘å‹ç¼©åˆ°åªæœ‰ä¸¤å±‚äº†ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦äº†ï¼Œæ—¢ç„¶è¦å‹ç¼©åˆ°åªæœ‰ä¸¤å±‚ï¼Œè¿™é‡Œå°±åªèƒ½ä½¿ç”¨é€’å½’æ¥å‹ç¼©ï¼Œå¾ªç¯çš„ç‰ˆæœ¬æ²¡åŠæ³•å‹åˆ°åªæœ‰ä¸¤å±‚ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„å‹ç¼©ä¸­å€¼çš„å˜åŒ–ã€‚\n\n**è§£æ³•ä¸‰**\n\nå›¾çš„è§£æ³•æ”¾åˆ°äº† [æ ˆå’Œé˜Ÿåˆ—ä¸“é¢˜](http://imlgw.top/2019/10/01/leetcode-zhan-dui-lie/) ä¸­äº†\n\n### [695. å²›å±¿çš„æœ€å¤§é¢ç§¯](https://leetcode-cn.com/problems/max-area-of-island/)\n\nç»™å®šä¸€ä¸ªåŒ…å«äº†ä¸€äº› 0 å’Œ 1çš„éç©ºäºŒç»´æ•°ç»„ grid , ä¸€ä¸ª å²›å±¿ æ˜¯ç”±å››ä¸ªæ–¹å‘ (æ°´å¹³æˆ–å‚ç›´) çš„ 1 (ä»£è¡¨åœŸåœ°) æ„æˆçš„ç»„åˆã€‚ä½ å¯ä»¥å‡è®¾äºŒç»´çŸ©é˜µçš„å››ä¸ªè¾¹ç¼˜éƒ½è¢«æ°´åŒ…å›´ç€ã€‚\n\næ‰¾åˆ°ç»™å®šçš„äºŒç»´æ•°ç»„ä¸­æœ€å¤§çš„å²›å±¿é¢ç§¯ã€‚(å¦‚æœæ²¡æœ‰å²›å±¿ï¼Œåˆ™è¿”å›é¢ç§¯ä¸º0ã€‚)\n\n**ç¤ºä¾‹ 1:**\n\n```java\n[[0,0,1,0,0,0,0,1,0,0,0,0,0],\n [0,0,0,0,0,0,0,1,1,1,0,0,0],\n [0,1,1,0,1,0,0,0,0,0,0,0,0],\n [0,1,0,0,1,1,0,0,1,0,1,0,0],\n [0,1,0,0,1,1,0,0,1,1,1,0,0],\n [0,0,0,0,0,0,0,0,0,0,1,0,0],\n [0,0,0,0,0,0,0,1,1,1,0,0,0],\n [0,0,0,0,0,0,0,1,1,0,0,0,0]]\n```\n\n\nå¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçŸ©é˜µåº”è¿”å› 6ã€‚æ³¨æ„ç­”æ¡ˆä¸åº”è¯¥æ˜¯11ï¼Œå› ä¸ºå²›å±¿åªèƒ½åŒ…å«æ°´å¹³æˆ–å‚ç›´çš„å››ä¸ªæ–¹å‘çš„â€˜1â€™ã€‚\n\n**ç¤ºä¾‹ 2:**\n\n```java\n[[0,0,0,0,0,0,0,0]]\n```\n\n\nå¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçš„çŸ©é˜µ, è¿”å› 0ã€‚\n\n**æ³¨æ„:** ç»™å®šçš„çŸ©é˜µgrid çš„é•¿åº¦å’Œå®½åº¦éƒ½ä¸è¶…è¿‡ 50\n\n**è§£æ³•ä¸€**\n\nlcæ‰“å¡é¢˜é€‰äº†è¿™é¢˜ï¼Œä¹‹å‰ç”¨çš„dfsï¼Œè¿™æ¬¡ç”¨å¹¶æŸ¥é›†å®ç°ä¸‹\n\n```java\n//è¡¥å……ä¸€ä¸ªå¹¶æŸ¥é›†çš„è§£æ³•\nint[] parent=null;\n\nint[] size=null;\n\nint max=0;\n\npublic void merge(int a,int b){\n    int fa=find(a);\n    int fb=find(b);\n    if(fa==fb) return;\n    if(size[fa]>size[fb]){\n        parent[fb]=fa;\n        size[fa]+=size[fb];\n        max=Math.max(max,size[fa]);\n    }else{\n        parent[fa]=fb;\n        size[fb]+=size[fa];\n        max=Math.max(max,size[fb]);\n    }\n}\n\npublic int find(int p){\n    if(parent[p]==p) return p;\n    parent[p]=find(parent[p]);\n    return parent[p];\n}\n\npublic int maxAreaOfIsland(int[][] grid) {\n    int m=grid.length;\n    int n=grid[0].length;\n    //init\n    parent=new int[m*n];\n    size=new int[m*n];\n    for (int i=0;i<m*n;i++){\n        parent[i]=i;\n        size[i]=1;\n    }\n    //1 1 1 1 \n    //1 1 1 1\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            if(grid[i][j]==1){\n                //ç‰¹åˆ¤ä¸€ä¸‹ hahaha~ æ„Ÿè§‰å¦‚æœä¸æ˜¯lcæœ‰wacaseæˆ‘è¿˜æŒºéš¾å‘ç°è¿™ä¸ª\n                max=Math.max(max,1);\n                //å’Œå‰é¢,ä¸Šé¢çš„åˆå¹¶\n                if(i>0 && grid[i-1][j]==1) merge(i*n+j,(i-1)*n+j);\n                if(j>0 && grid[i][j-1]==1) merge(i*n+j,i*n+j-1);  \n            }\n        }\n    }\n    return max;\n}\n```\n\n### [200. å²›å±¿æ•°é‡](https://leetcode-cn.com/problems/number-of-islands/)\n\nç»™ä½ ä¸€ä¸ªç”± '1'ï¼ˆé™†åœ°ï¼‰å’Œ '0'ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚\n\nå²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚\n\næ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n11110\n11010\n11000\n00000\nè¾“å‡º: 1\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\n11000\n11000\n00100\n00011\nè¾“å‡º: 3\nè§£é‡Š: æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥è€Œæˆã€‚\n```\n\n**è§£æ³•ä¸€**\n\nè¡¥å……ä¸€ä¸ªå¹¶æŸ¥é›†çš„å†™æ³•ï¼Œæ‰‹å†™å‡ºæ¥äº†ï¼Œä½†æ˜¯é€»è¾‘å‡ºäº†ä¸€ç‚¹å°é—®é¢˜ï¼Œå¡äº†ä¸€ä¼šå„¿\n\n```java\n//å¤ä¹ ä¸‹å¹¶æŸ¥é›†\nint[] rank=null;\n\nint[] parent=null;\n\npublic int find(int a){\n    if(parent[a]==a) return a;\n    return parent[a]=find(parent[a]);\n}\n\npublic void merge(int a,int b){\n    int fa=find(a);\n    int fb=find(b);\n    if(fa==fb) return;\n    if(rank[fa]>rank[fb]){\n        parent[fb]=fa;\n        rank[fa]+=rank[fb];\n    }else{\n        parent[fa]=fb;\n        rank[fb]+=rank[fa];\n    }\n}\n\npublic int numIslands2(char[][] grid) {\n    if(grid==null || grid.length<=0) return 0;\n    int m=grid.length,n=grid[0].length;\n    rank=new int[m*n];\n    parent=new int[m*n];\n    //init\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            if(grid[i][j]=='1'){\n                parent[i*n+j]=i*n+j;\n                rank[i*n+j]=1;\n            }\n        }\n    }\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            if(grid[i][j]=='1'){\n                //å’Œä¸Š/å·¦åˆå¹¶\n                if(i>0 && grid[i-1][j]=='1') merge(i*n+j,(i-1)*n+j);\n                if(j>0 && grid[i][j-1]=='1') merge(i*n+j,i*n+(j-1));\n            }\n        }\n    }\n    int res=0;\n    //ç›´æ¥å¾ªç¯parentä¼šæœ‰é—®é¢˜,è¿˜æ˜¯è€è€å®å®éå†çŸ©é˜µ\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            if(grid[i][j]=='1' && parent[i*n+j]==i*n+j){\n                res++;\n            }\n        }\n    }\n    return res;\n}\n```\n### [1020. é£åœ°çš„æ•°é‡](https://leetcode-cn.com/problems/number-of-enclaves/)\n\nç»™å‡ºä¸€ä¸ªäºŒç»´æ•°ç»„ `A`ï¼Œæ¯ä¸ªå•å…ƒæ ¼ä¸º 0ï¼ˆä»£è¡¨æµ·ï¼‰æˆ– 1ï¼ˆä»£è¡¨é™†åœ°ï¼‰ã€‚\n\nç§»åŠ¨æ˜¯æŒ‡åœ¨é™†åœ°ä¸Šä»ä¸€ä¸ªåœ°æ–¹èµ°åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼ˆæœå››ä¸ªæ–¹å‘ä¹‹ä¸€ï¼‰æˆ–ç¦»å¼€ç½‘æ ¼çš„è¾¹ç•Œã€‚\n\nè¿”å›ç½‘æ ¼ä¸­**æ— æ³•**åœ¨ä»»æ„æ¬¡æ•°çš„ç§»åŠ¨ä¸­ç¦»å¼€ç½‘æ ¼è¾¹ç•Œçš„é™†åœ°å•å…ƒæ ¼çš„æ•°é‡ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[[0,0,0,0],[1,0,1,0],[0,1,1,0],[0,0,0,0]]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼š \næœ‰ä¸‰ä¸ª 1 è¢« 0 åŒ…å›´ã€‚ä¸€ä¸ª 1 æ²¡æœ‰è¢«åŒ…å›´ï¼Œå› ä¸ºå®ƒåœ¨è¾¹ç•Œä¸Šã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼š\næ‰€æœ‰ 1 éƒ½åœ¨è¾¹ç•Œä¸Šæˆ–å¯ä»¥åˆ°è¾¾è¾¹ç•Œã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= A.length <= 500`\n2. `1 <= A[i].length <= 500`\n3. `0 <= A[i][j] <= 1`\n4. æ‰€æœ‰è¡Œçš„å¤§å°éƒ½ç›¸åŒ\n\n**è§£æ³•ä¸€**\n\n```java\n//å¹¶æŸ¥é›†\nint[] rank=null;\n\nint[] parent=null;\n\npublic int find(int a){\n    if(parent[a]==a) return a;\n    return parent[a]=find(parent[a]); //è·¯å¾„å‹ç¼©\n}\n\npublic void merge(int a,int b){\n    int fa=find(a);\n    int fb=find(b);\n    if(fa==fb) return;\n    if(rank[fa]>rank[fb]){\n        parent[fb]=fa;\n        rank[fa]+=rank[fb];\n    }else{\n        parent[fa]=fb;\n        rank[fb]+=rank[fa];\n    }\n}\n\npublic int numEnclaves2(int[][] A) {\n    if(A==null || A.length<=0) return 0;\n    int m=A.length,n=A[0].length;\n    rank=new int[m*n+1];\n    parent=new int[m*n+1];\n    //init\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            if(A[i][j]==1){\n                parent[i*n+j]=i*n+j;\n                rank[i*n+j]=1;\n            }\n        }\n    }\n    //å°†è¾¹ç•Œå’Œè™šæ‹ŸèŠ‚ç‚¹åˆå¹¶\n    int dummyNode=m*n;\n    parent[dummyNode]=dummyNode;\n    rank[dummyNode]=1;\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            if(A[i][j]==1){\n                if(i==0 || j==0 || i==m-1 || j==n-1){\n                    merge(dummyNode,i*n+j);\n                }else{ \n                    //å’Œå‘¨å›´èŠ‚ç‚¹åˆå¹¶(ä¸€å¼€å§‹å¤åˆ¶çš„ä¸Šé¢çš„ï¼Œåªå’Œå·¦ä¸Šçš„åˆå¹¶ï¼Œç»“æœå‡ºbugäº†hahaha\n                    if(A[i][j-1]==1) merge(i*n+j,i*n+j-1);\n                    if(A[i-1][j]==1) merge(i*n+j,(i-1)*n+j);\n                    if(A[i][j+1]==1) merge(i*n+j,i*n+j+1);\n                    if(A[i+1][j]==1) merge(i*n+j,(i+1)*n+j);\n                }\n            }\n        }\n    }\n    int res=0;\n    int dump=find(dummyNode);\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            //åˆ¤æ–­å’Œè™šèŠ‚ç‚¹æ˜¯å¦è¿æ¥\n            if(A[i][j]==1 && find(i*n+j)!=dump){\n                res++;\n            }\n        }\n    }\n    return res;\n}\n```\n\n### [990. ç­‰å¼æ–¹ç¨‹çš„å¯æ»¡è¶³æ€§](https://leetcode-cn.com/problems/satisfiability-of-equality-equations/)\n\nç»™å®šä¸€ä¸ªç”±è¡¨ç¤ºå˜é‡ä¹‹é—´å…³ç³»çš„å­—ç¬¦ä¸²æ–¹ç¨‹ç»„æˆçš„æ•°ç»„ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²æ–¹ç¨‹ `equations[i]` çš„é•¿åº¦ä¸º `4`ï¼Œå¹¶é‡‡ç”¨ä¸¤ç§ä¸åŒçš„å½¢å¼ä¹‹ä¸€ï¼š`\"a==b\"` æˆ– `\"a!=b\"`ã€‚åœ¨è¿™é‡Œï¼Œa å’Œ b æ˜¯å°å†™å­—æ¯ï¼ˆä¸ä¸€å®šä¸åŒï¼‰ï¼Œè¡¨ç¤ºå•å­—æ¯å˜é‡åã€‚\n\nåªæœ‰å½“å¯ä»¥å°†æ•´æ•°åˆ†é…ç»™å˜é‡åï¼Œä»¥ä¾¿æ»¡è¶³æ‰€æœ‰ç»™å®šçš„æ–¹ç¨‹æ—¶æ‰è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚ \n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[\"a==b\",\"b!=a\"]\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šå¦‚æœæˆ‘ä»¬æŒ‡å®šï¼Œa = 1 ä¸” b = 1ï¼Œé‚£ä¹ˆå¯ä»¥æ»¡è¶³ç¬¬ä¸€ä¸ªæ–¹ç¨‹ï¼Œä½†æ— æ³•æ»¡è¶³ç¬¬äºŒä¸ªæ–¹ç¨‹ã€‚æ²¡æœ‰åŠæ³•åˆ†é…å˜é‡åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ–¹ç¨‹ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å‡ºï¼š[\"b==a\",\"a==b\"]\nè¾“å…¥ï¼štrue\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æŒ‡å®š a = 1 ä¸” b = 1 ä»¥æ»¡è¶³æ»¡è¶³è¿™ä¸¤ä¸ªæ–¹ç¨‹ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[\"a==b\",\"b==c\",\"a==c\"]\nè¾“å‡ºï¼štrue\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼š[\"a==b\",\"b!=c\",\"c==a\"]\nè¾“å‡ºï¼šfalse\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼š[\"c==c\",\"b==d\",\"x!=z\"]\nè¾“å‡ºï¼štrue\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= equations.length <= 500`\n2. `equations[i].length == 4`\n3. `equations[i][0]` å’Œ `equations[i][3]` æ˜¯å°å†™å­—æ¯\n4. `equations[i][1]` è¦ä¹ˆæ˜¯ `'='`ï¼Œè¦ä¹ˆæ˜¯ `'!'`\n5. `equations[i][2]` æ˜¯ `'='`\n\n**è§£æ³•ä¸€**\n\n2020.6.8æ‰“å¡é¢˜ï¼Œåœ¨ç¾¤é‡Œçœ‹è§äº†è®¨è®ºè¯´å¹¶æŸ¥é›†ï¼Œæ‰€ä»¥ç›´æ¥å°±æƒ³åˆ°äº†å¹¶æŸ¥é›†çš„åšæ³•ï¼Œè‡ªå·±æƒ³çš„è¯emmmï¼Œæ„Ÿè§‰ä¹Ÿèƒ½æƒ³åˆ°ï¼Œä¹Ÿä¸æ˜¯å¾ˆå¤æ‚çš„å¹¶æŸ¥é›†\n\n```java\n//è·¯å¾„å‹ç¼©+æŒ‰ç§©åˆå¹¶\nint[] parent;\n\nint[] rank;\n\npublic int find(int p){\n    if(parent[p]==p) return p;\n    return parent[p]=find(parent[p]);\n}\n\npublic void merge(int a,int b){\n    int af=find(a);\n    int bf=find(b);\n    if(af==bf) return;\n    if(rank[af]>rank[bf]){\n        parent[bf]=af;\n    }else if(rank[af]<rank[bf]){\n        parent[af]=bf;\n    }else{\n        parent[af]=bf;\n        rank[bf]++;\n    }\n}\n\npublic boolean equationsPossible(String[] equations) {\n    parent=new int[128]; //-'a'å‡æ¥å‡å»å¤ªéº»çƒ¦äº†,ç›´æ¥è®¾ä¸ª128å®Œäº‹\n    rank=new int[128];\n    //æ’åºåå…ˆåˆå¹¶==,å†åˆ¤æ–­!= å·æ‡’çš„åšæ³•\n    //Arrays.sort(equations,(s1,s2)->s2.charAt(1)-s1.charAt(1));\n    for (String eq:equations) {\n        parent[eq.charAt(0)]=eq.charAt(0);\n        rank[eq.charAt(0)]=1;\n        parent[eq.charAt(3)]=eq.charAt(3);\n        rank[eq.charAt(3)]=1;\n    }\n    for (String eq:equations) {\n        if(eq.charAt(1)=='='){\n            merge(eq.charAt(0),eq.charAt(3));\n        }\n    }\n    for (String eq:equations) {\n        if(eq.charAt(1)=='!' && find(eq.charAt(0))==find(eq.charAt(3))){\n            return false;\n        }\n    }\n    return true;\n}\n```\n### [684. å†—ä½™è¿æ¥](https://leetcode-cn.com/problems/redundant-connection/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nåœ¨æœ¬é—®é¢˜ä¸­, æ ‘æŒ‡çš„æ˜¯ä¸€ä¸ªè¿é€šä¸”æ— ç¯çš„**æ— å‘**å›¾ã€‚\n\nè¾“å…¥ä¸€ä¸ªå›¾ï¼Œè¯¥å›¾ç”±ä¸€ä¸ªæœ‰ç€Nä¸ªèŠ‚ç‚¹ (èŠ‚ç‚¹å€¼ä¸é‡å¤1, 2, ..., N) çš„æ ‘åŠä¸€æ¡é™„åŠ çš„è¾¹æ„æˆã€‚é™„åŠ çš„è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹åŒ…å«åœ¨1åˆ°Nä¸­é—´ï¼Œè¿™æ¡é™„åŠ çš„è¾¹ä¸å±äºæ ‘ä¸­å·²å­˜åœ¨çš„è¾¹ã€‚\n\nç»“æœå›¾æ˜¯ä¸€ä¸ªä»¥`è¾¹`ç»„æˆçš„äºŒç»´æ•°ç»„ã€‚æ¯ä¸€ä¸ª`è¾¹`çš„å…ƒç´ æ˜¯ä¸€å¯¹`[u, v]`Â ï¼Œæ»¡è¶³Â `u < v`ï¼Œè¡¨ç¤ºè¿æ¥é¡¶ç‚¹`u`Â å’Œ`v`çš„**æ— å‘**å›¾çš„è¾¹ã€‚\n\nè¿”å›ä¸€æ¡å¯ä»¥åˆ å»çš„è¾¹ï¼Œä½¿å¾—ç»“æœå›¾æ˜¯ä¸€ä¸ªæœ‰ç€Nä¸ªèŠ‚ç‚¹çš„æ ‘ã€‚å¦‚æœæœ‰å¤šä¸ªç­”æ¡ˆï¼Œåˆ™è¿”å›äºŒç»´æ•°ç»„ä¸­æœ€åå‡ºç°çš„è¾¹ã€‚ç­”æ¡ˆè¾¹Â `[u, v]` åº”æ»¡è¶³ç›¸åŒçš„æ ¼å¼Â `u < v`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```\nè¾“å…¥: [[1,2], [1,3], [2,3]]\nè¾“å‡º: [2,3]\nè§£é‡Š: ç»™å®šçš„æ— å‘å›¾ä¸º:\n  1\n / \\\n2 - 3\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```\nè¾“å…¥: [[1,2], [2,3], [3,4], [1,4], [1,5]]\nè¾“å‡º: [1,4]\nè§£é‡Š: ç»™å®šçš„æ— å‘å›¾ä¸º:\n5 - 1 - 2\n    |   |\n    4 - 3\n```\n\n**æ³¨æ„:**\n\n*   è¾“å…¥çš„äºŒç»´æ•°ç»„å¤§å°åœ¨ 3 åˆ° 1000ã€‚\n*   äºŒç»´æ•°ç»„ä¸­çš„æ•´æ•°åœ¨1åˆ°Nä¹‹é—´ï¼Œå…¶ä¸­Næ˜¯è¾“å…¥æ•°ç»„çš„å¤§å°ã€‚\n\n**æ›´æ–°(2017-09-26):**  \næˆ‘ä»¬å·²ç»é‡æ–°æ£€æŸ¥äº†é—®é¢˜æè¿°åŠæµ‹è¯•ç”¨ä¾‹ï¼Œæ˜ç¡®å›¾æ˜¯_**æ— å‘Â **_å›¾ã€‚å¯¹äºæœ‰å‘å›¾è¯¦è§**ã€‚**å¯¹äºé€ æˆä»»ä½•ä¸ä¾¿ï¼Œæˆ‘ä»¬æ·±æ„Ÿæ­‰æ„ã€‚\n\n**è§£æ³•ä¸€**\n\næ²¡å•¥å¥½è¯´çš„ï¼Œé¢˜ç›®æ„æ€è¯»æ‡‚å°±è¡Œäº†\n```golang\nvar parent []int\nâ€‹\nfunc union(a int, b int) bool {\n Â  Â pa := find(a)\n Â  Â pb := find(b)\n Â  Â if pa == pb {\n Â  Â  Â  Â return false\n Â   }\n Â  Â parent[pa] = pb\n Â  Â return true\n}\nâ€‹\nfunc find(a int) int {\n Â  Â if parent[a] == a {\n Â  Â  Â  Â return a\n Â   }\n Â  Â parent[a] = find(parent[a])\n Â  Â return parent[a]\n}\nâ€‹\nfunc findRedundantConnection(edges [][]int) []int {\n Â  Â var n = len(edges)\n Â  Â parent = make([]int, n+1)\n Â  Â for i := 1; i <= n; i++ {\n Â  Â  Â  Â parent[i] = i\n Â   }\n Â  Â for i := 0; i < n; i++ {\n Â  Â  Â  Â if !union(edges[i][0], edges[i][1]) {\n Â  Â  Â  Â  Â  Â return edges[i]\n Â  Â  Â   }\n Â   }\n Â  Â return []int{}\n}\n```\n\n### [685. å†—ä½™è¿æ¥ II](https://leetcode-cn.com/problems/redundant-connection-ii/)\n\nDifficulty: **å›°éš¾**\n\n\nåœ¨æœ¬é—®é¢˜ä¸­ï¼Œæœ‰æ ¹æ ‘æŒ‡æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„**æœ‰å‘**å›¾ã€‚è¯¥æ ‘åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œæ‰€æœ‰å…¶ä»–èŠ‚ç‚¹éƒ½æ˜¯è¯¥æ ¹èŠ‚ç‚¹çš„åç»§ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œé™¤äº†æ ¹èŠ‚ç‚¹æ²¡æœ‰çˆ¶èŠ‚ç‚¹ã€‚\n\nè¾“å…¥ä¸€ä¸ªæœ‰å‘å›¾ï¼Œè¯¥å›¾ç”±ä¸€ä¸ªæœ‰ç€Nä¸ªèŠ‚ç‚¹ (èŠ‚ç‚¹å€¼ä¸é‡å¤1, 2, ..., N) çš„æ ‘åŠä¸€æ¡é™„åŠ çš„è¾¹æ„æˆã€‚é™„åŠ çš„è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹åŒ…å«åœ¨1åˆ°Nä¸­é—´ï¼Œè¿™æ¡é™„åŠ çš„è¾¹ä¸å±äºæ ‘ä¸­å·²å­˜åœ¨çš„è¾¹ã€‚\n\nç»“æœå›¾æ˜¯ä¸€ä¸ªä»¥`è¾¹`ç»„æˆçš„äºŒç»´æ•°ç»„ã€‚ æ¯ä¸€ä¸ª`è¾¹` çš„å…ƒç´ æ˜¯ä¸€å¯¹ `[u, v]`ï¼Œç”¨ä»¥è¡¨ç¤º**æœ‰å‘**å›¾ä¸­è¿æ¥é¡¶ç‚¹ `u` å’Œé¡¶ç‚¹ `v` çš„è¾¹ï¼Œå…¶ä¸­ `u` æ˜¯ `v` çš„ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ã€‚\n\nè¿”å›ä¸€æ¡èƒ½åˆ é™¤çš„è¾¹ï¼Œä½¿å¾—å‰©ä¸‹çš„å›¾æ˜¯æœ‰Nä¸ªèŠ‚ç‚¹çš„æœ‰æ ¹æ ‘ã€‚è‹¥æœ‰å¤šä¸ªç­”æ¡ˆï¼Œè¿”å›æœ€åå‡ºç°åœ¨ç»™å®šäºŒç»´æ•°ç»„çš„ç­”æ¡ˆã€‚\n\n**ç¤ºä¾‹Â 1:**\n\n```go\nè¾“å…¥: [[1,2], [1,3], [2,3]]\nè¾“å‡º: [2,3]\nè§£é‡Š: ç»™å®šçš„æœ‰å‘å›¾å¦‚ä¸‹:\n  1\n / \\\nv   v\n2-->3\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥: [[1,2], [2,3], [3,4], [4,1], [1,5]]\nè¾“å‡º: [4,1]\nè§£é‡Š: ç»™å®šçš„æœ‰å‘å›¾å¦‚ä¸‹:\n5 <- 1 -> 2\n     ^    |\n     |    v\n     4 <- 3\n```\n\n**æ³¨æ„:**\n\n*   äºŒç»´æ•°ç»„å¤§å°çš„åœ¨3åˆ°1000èŒƒå›´å†…ã€‚\n*   äºŒç»´æ•°ç»„ä¸­çš„æ¯ä¸ªæ•´æ•°åœ¨1åˆ°Nä¹‹é—´ï¼Œå…¶ä¸­ N æ˜¯äºŒç»´æ•°ç»„çš„å¤§å°ã€‚\n\n\n**è§£æ³•ä¸€**\n\næ²¡åšå‡ºæ¥ï¼Œçœ‹çš„é¢˜è§£ï¼Œæ„Ÿè§‰æ€ªæ€ªçš„\n\n```golang\nvar parent []int\n\nfunc union(a int, b int) bool {\n    pa := find(a)\n    pb := find(b)\n    if pa == pb {\n        return false\n    }\n    parent[pa] = pb\n    return true\n}\n\nfunc find(a int) int {\n    if parent[a] == a {\n        return a\n    }\n    parent[a] = find(parent[a])\n    return parent[a]\n}\n\nfunc judge(edges [][]int, k int) bool {\n    parent = make([]int, len(edges)+1)\n    for i := 1; i <= len(edges); i++ {\n        parent[i] = i\n    }\n    for i := 0; i < len(edges); i++ {\n        if i == k {\n            continue\n        }\n        if !union(edges[i][0], edges[i][1]) {\n            return false\n        }\n    }\n    return true\n}\n\nfunc findRedundantDirectedConnection(edges [][]int) []int {\n    var n = len(edges)\n    var indegree = make([]int, n+1)\n    for i := 1; i <= n; i++ {\n        indegree[edges[i-1][1]]++\n    }\n    for i := n-1; i >= 0; i-- {\n        if indegree[edges[i][1]] == 2 {\n            //åˆ é™¤è¯¥è¾¹\n            if judge(edges, i) {\n                return edges[i]\n            }\n        }\n    }\n    for i := n-1; i >= 0; i-- {\n        if indegree[edges[i][1]] == 1 {\n            if judge(edges, i) {\n                return edges[i]\n            }\n        }\n    }\n    return []int{}\n}\n```\n\n###  æœªå®Œå¾…ç»­\n\nå…¶å®ä¹‹å‰åšçš„ä¸€äº›é¢˜éƒ½å¯ä»¥ç”¨å¹¶æŸ¥é›†åšï¼Œåƒ[å²›å±¿æ•°é‡]()ï¼Œ[å²›å±¿æœ€å¤§é¢ç§¯]()å•¥çš„ï¼Œè¿™é‡Œå°±ä¸å¤šå†™äº†ï¼Œéƒ½å·®ä¸å¤š","tags":["æ•°æ®ç»“æ„","ç®—æ³•"],"categories":["æ•°æ®ç»“æ„"]},{"title":"LeetCodeè´ªå¿ƒ","url":"/2020/01/21/leetcode-tan-xin/","content":"\n\n## [455. åˆ†å‘é¥¼å¹²](https://leetcode-cn.com/problems/assign-cookies/)\n\nå‡è®¾ä½ æ˜¯ä¸€ä½å¾ˆæ£’çš„å®¶é•¿ï¼Œæƒ³è¦ç»™ä½ çš„å­©å­ä»¬ä¸€äº›å°é¥¼å¹²ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªå­©å­æœ€å¤šåªèƒ½ç»™ä¸€å—é¥¼å¹²ã€‚å¯¹æ¯ä¸ªå­©å­ i ï¼Œéƒ½æœ‰ä¸€ä¸ªèƒƒå£å€¼ gi ï¼Œè¿™æ˜¯èƒ½è®©å­©å­ä»¬æ»¡è¶³èƒƒå£çš„é¥¼å¹²çš„æœ€å°å°ºå¯¸ï¼›å¹¶ä¸”æ¯å—é¥¼å¹² j ï¼Œéƒ½æœ‰ä¸€ä¸ªå°ºå¯¸ sj ã€‚å¦‚æœ sj >= gi ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé¥¼å¹² j åˆ†é…ç»™å­©å­ i ï¼Œè¿™ä¸ªå­©å­ä¼šå¾—åˆ°æ»¡è¶³ã€‚ä½ çš„ç›®æ ‡æ˜¯å°½å¯èƒ½æ»¡è¶³è¶Šå¤šæ•°é‡çš„å­©å­ï¼Œå¹¶è¾“å‡ºè¿™ä¸ªæœ€å¤§æ•°å€¼ã€‚\n\n**æ³¨æ„ï¼š**\n\nä½ å¯ä»¥å‡è®¾èƒƒå£å€¼ä¸ºæ­£ã€‚\nä¸€ä¸ªå°æœ‹å‹æœ€å¤šåªèƒ½æ‹¥æœ‰ä¸€å—é¥¼å¹²\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3], [1,1]\n\nè¾“å‡º: 1\n\nè§£é‡Š: \nä½ æœ‰ä¸‰ä¸ªå­©å­å’Œä¸¤å—å°é¥¼å¹²ï¼Œ3ä¸ªå­©å­çš„èƒƒå£å€¼åˆ†åˆ«æ˜¯ï¼š1,2,3ã€‚\nè™½ç„¶ä½ æœ‰ä¸¤å—å°é¥¼å¹²ï¼Œç”±äºä»–ä»¬çš„å°ºå¯¸éƒ½æ˜¯1ï¼Œä½ åªèƒ½è®©èƒƒå£å€¼æ˜¯1çš„å­©å­æ»¡è¶³ã€‚\næ‰€ä»¥ä½ åº”è¯¥è¾“å‡º1ã€‚\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,2], [1,2,3]\n\nè¾“å‡º: 2\n\nè§£é‡Š: \nä½ æœ‰ä¸¤ä¸ªå­©å­å’Œä¸‰å—å°é¥¼å¹²ï¼Œ2ä¸ªå­©å­çš„èƒƒå£å€¼åˆ†åˆ«æ˜¯1,2ã€‚\nä½ æ‹¥æœ‰çš„é¥¼å¹²æ•°é‡å’Œå°ºå¯¸éƒ½è¶³ä»¥è®©æ‰€æœ‰å­©å­æ»¡è¶³ã€‚\næ‰€ä»¥ä½ åº”è¯¥è¾“å‡º2.\n```\n\n**è§£æ³•ä¸€**\n\nè´ªå°±å®Œäº‹å„¿äº†\n\n```java\npublic int findContentChildren(int[] g, int[] s) {\n    if (g==null || s==null) {\n        return 0;\n    }\n    Arrays.sort(g);\n    Arrays.sort(s);\n    int res=0,index=0;\n    for (int i=0;i<g.length;i++) {\n        while(index<s.length){\n            if (g[i]<=s[index]) {\n                res++;\n                index++;\n                break;\n            }\n            index++;\n        }\n    }\n    return res;\n}\n```\n\n## [274. HæŒ‡æ•°](https://leetcode-cn.com/problems/h-index/)\n\nç»™å®šä¸€ä½ç ”ç©¶è€…è®ºæ–‡è¢«å¼•ç”¨æ¬¡æ•°çš„æ•°ç»„ï¼ˆè¢«å¼•ç”¨æ¬¡æ•°æ˜¯éè´Ÿæ•´æ•°ï¼‰ã€‚ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè®¡ç®—å‡ºç ”ç©¶è€…çš„ h æŒ‡æ•°ã€‚\n\nh æŒ‡æ•°çš„å®šä¹‰: â€œh ä»£è¡¨â€œé«˜å¼•ç”¨æ¬¡æ•°â€ï¼ˆhigh citationsï¼‰ï¼Œä¸€åç§‘ç ”äººå‘˜çš„ h æŒ‡æ•°æ˜¯æŒ‡ä»–ï¼ˆå¥¹ï¼‰çš„ ï¼ˆN ç¯‡è®ºæ–‡ä¸­ï¼‰~~è‡³å¤š~~æœ‰ h ç¯‡è®ºæ–‡åˆ†åˆ«è¢«å¼•ç”¨äº†è‡³å°‘ h æ¬¡ã€‚ï¼ˆå…¶ä½™çš„ N - h ç¯‡è®ºæ–‡æ¯ç¯‡è¢«å¼•ç”¨æ¬¡æ•°ä¸å¤šäº h æ¬¡ã€‚ï¼‰â€\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: citations = [3,0,6,1,5]\nè¾“å‡º: 3 \nè§£é‡Š: ç»™å®šæ•°ç»„è¡¨ç¤ºç ”ç©¶è€…æ€»å…±æœ‰ 5 ç¯‡è®ºæ–‡ï¼Œæ¯ç¯‡è®ºæ–‡ç›¸åº”çš„è¢«å¼•ç”¨äº† 3, 0, 6, 1, 5 æ¬¡ã€‚\n     ç”±äºç ”ç©¶è€…æœ‰ 3 ç¯‡è®ºæ–‡æ¯ç¯‡è‡³å°‘è¢«å¼•ç”¨äº† 3 æ¬¡ï¼Œå…¶ä½™ä¸¤ç¯‡è®ºæ–‡æ¯ç¯‡è¢«å¼•ç”¨ä¸å¤šäº 3 æ¬¡ï¼Œæ‰€ä»¥å¥¹çš„ h æŒ‡æ•°æ˜¯ 3ã€‚\n```\n\n**è¯´æ˜:** å¦‚æœ h æœ‰å¤šç§å¯èƒ½çš„å€¼ï¼Œh æŒ‡æ•°æ˜¯å…¶ä¸­æœ€å¤§çš„é‚£ä¸ªã€‚\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®æ„æ€ææ‡‚å°±ok\n\n```java\npublic int hIndex(int[] citations) {\n    int len=citations.length;\n    Arrays.sort(citations);\n    int count=0;\n    for (int i=len-1;i>=0;i--) {\n        if (citations[i]<=len-(i+1)) {\n            return len-(i+1);\n        }\n    }\n    return len;\n}\n```\n\n## [392. åˆ¤æ–­å­åºåˆ—](https://leetcode-cn.com/problems/is-subsequence/)\n\nç»™å®šå­—ç¬¦ä¸² s å’Œ t ï¼Œåˆ¤æ–­ s æ˜¯å¦ä¸º t çš„å­åºåˆ—ã€‚\n\nä½ å¯ä»¥è®¤ä¸º s å’Œ t ä¸­ä»…åŒ…å«è‹±æ–‡å°å†™å­—æ¯ã€‚å­—ç¬¦ä¸² t å¯èƒ½ä¼šå¾ˆé•¿ï¼ˆé•¿åº¦ ~= 500,000ï¼‰ï¼Œè€Œ s æ˜¯ä¸ªçŸ­å­—ç¬¦ä¸²ï¼ˆé•¿åº¦ <=100ï¼‰ã€‚\n\nå­—ç¬¦ä¸²çš„ä¸€ä¸ªå­åºåˆ—æ˜¯åŸå§‹å­—ç¬¦ä¸²åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å­—ç¬¦è€Œä¸æ”¹å˜å‰©ä½™å­—ç¬¦ç›¸å¯¹ä½ç½®å½¢æˆçš„æ–°å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å¦‚ï¼Œ`\"ace\"`æ˜¯`\"abcde\"`çš„ä¸€ä¸ªå­åºåˆ—ï¼Œè€Œ`\"aec\"`ä¸æ˜¯ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\ns = \"abc\", t = \"ahbgdc\"\nè¿”å› true.\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\ns = \"axc\", t = \"ahbgdc\"\nè¿”å› false.\n```\n\n**åç»­æŒ‘æˆ˜ :**\n\nå¦‚æœæœ‰å¤§é‡è¾“å…¥çš„ Sï¼Œç§°ä½œS1, S2, ... , Sk å…¶ä¸­ k >= 10äº¿ï¼Œä½ éœ€è¦ä¾æ¬¡æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸º T çš„å­åºåˆ—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šæ€æ ·æ”¹å˜ä»£ç ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\n```java\npublic boolean isSubsequence(String s, String t) {\n    if (s==null || t==null) {\n        return false;\n    }\n    int sindex=0,tindex=0;\n    while(sindex<s.length()) {\n        while(tindex<t.length() && sindex<s.length()){\n            if (s.charAt(sindex)==t.charAt(tindex)) {\n                sindex++;\n            }\n            tindex++;\n        }\n        if (tindex==t.length()) {\n            break; \n        }\n    }\n    return sindex==s.length();\n}\n```\nå¯ä»¥æ”¹æˆé€’å½’ï¼ˆå¤šç»ƒä¹ é€’å½’ï¼‰\n\n```java\npublic boolean isSubsequence(String s,String t){\n    return subsequence(s,t,0,0);\n}\n\npublic boolean subsequence(String s,String t,int sindex,int tindex){\n    if (sindex == s.length()) {\n        return true;\n    }\n    //ä¸Šä¸‹ifä¸èƒ½äº¤æ¢,å¯èƒ½æœ€åä¸€ä¸ªæ‰ç›¸ç­‰\n    if (tindex == t.length()) {\n        return false;\n    }\n    return s.charAt(sindex)==t.charAt(tindex)?subsequence(s,t,sindex+1,tindex+1):subsequence(s,t,sindex,tindex+1);\n}\n```\n**è§£æ³•äºŒ**\n\n```java\n//å¤§é‡çš„så­—ç¬¦ä¸² å¤„ç†\npublic boolean isSubsequence3(String s, String t) {\n    //é¢„å¤„ç†\n    ArrayList<ArrayList<Integer>> hash=new ArrayList<>();\n    for (int i=0;i<26;i++) {\n        hash.add(new ArrayList());\n    }\n    for (int i=0;i<t.length();i++) {\n        hash.get(t.charAt(i)-'a').add(i);\n    }\n    //ç»è¿‡ä¸Šé¢çš„é¢„å¤„ç†,åé¢çš„å¤„ç†å°±ä¼šå¾ˆå¿«,ä¸ç”¨å†éå†tå­—ç¬¦ä¸²\n    int lastIndex=-1;\n    for (int i=0;i<s.length();i++) {\n        List<Integer> indexList=hash.get(s.charAt(i)-'a');\n        int temp=binarySearch(indexList,lastIndex);\n        if (temp==indexList.size()) {\n            return false;\n        }\n        lastIndex=indexList.get(temp);\n    }\n    return true;\n}\n\n//æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”targetå¤§çš„å…ƒç´ \npublic int binarySearch(List<Integer> list,int target){\n    int left=0,right=list.size()-1;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if (list.get(mid)>target) {\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return left;\n}\n```\n\n## [621. ä»»åŠ¡è°ƒåº¦å™¨](https://leetcode-cn.com/problems/task-scheduler/)\n\nç»™å®šä¸€ä¸ªç”¨å­—ç¬¦æ•°ç»„è¡¨ç¤ºçš„ CPU éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚å…¶ä¸­åŒ…å«ä½¿ç”¨å¤§å†™çš„ A - Z å­—æ¯è¡¨ç¤ºçš„26 ç§ä¸åŒç§ç±»çš„ä»»åŠ¡ã€‚ä»»åŠ¡å¯ä»¥ä»¥ä»»æ„é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥åœ¨ 1 ä¸ªå•ä½æ—¶é—´å†…æ‰§è¡Œå®Œã€‚CPU åœ¨ä»»ä½•ä¸€ä¸ªå•ä½æ—¶é—´å†…éƒ½å¯ä»¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæˆ–è€…åœ¨å¾…å‘½çŠ¶æ€ã€‚\n\nç„¶è€Œï¼Œä¸¤ä¸ª**ç›¸åŒç§ç±»**çš„ä»»åŠ¡ä¹‹é—´å¿…é¡»æœ‰é•¿åº¦ä¸º n çš„å†·å´æ—¶é—´ï¼Œå› æ­¤è‡³å°‘æœ‰è¿ç»­ n ä¸ªå•ä½æ—¶é—´å†… CPU åœ¨æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œæˆ–è€…åœ¨å¾…å‘½çŠ¶æ€ã€‚\n\nä½ éœ€è¦è®¡ç®—å®Œæˆæ‰€æœ‰ä»»åŠ¡æ‰€éœ€è¦çš„**æœ€çŸ­æ—¶é—´**\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: tasks = [\"A\",\"A\",\"A\",\"B\",\"B\",\"B\"], n = 2\nè¾“å‡º: 8\næ‰§è¡Œé¡ºåº: A -> B -> (å¾…å‘½) -> A -> B -> (å¾…å‘½) -> A -> B.\n```\n\n**æ³¨ï¼š**\n\n- ä»»åŠ¡çš„æ€»ä¸ªæ•°ä¸º `[1, 10000]`\n- n çš„å–å€¼èŒƒå›´ä¸º `[0, 100]`\n\n**è§£æ³•ä¸€**\n\n```java\npublic int leastInterval(char[] tasks, int n) {\n    int[] map=new int[26];\n    for (int i=0;i<tasks.length;i++) {\n        map[tasks[i]-'A']++;\n    }\n    //æ‰¾æœ€å¤§å€¼\n    int max=-1;\n    for (int i=0;i<map.length;i++) {\n        max=Math.max(map[i],max);\n    }\n    int maxCount=0;\n    for (int i=0;i<map.length;i++) {\n        if (map[i]==max) {\n            maxCount++;\n        }\n    }\n    //æ¯”å¦‚ a b c d e f g,n=1\n    return Math.max((n+1)*(max-1)+maxCount,tasks.length);\n}\n```\næ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†å‡ºç°æ¬¡æ•°æœ€å¤šçš„ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œå¹¶ä¸”å°½å¯èƒ½çš„åˆ†æ•£ï¼Œæ¯”å¦‚  `A A A B B C n=2` æœ€çŸ­çš„æ—¶é—´å°±æ˜¯`A X X A X X A` ï¼Œæœ€ç»ˆçš„æ—¶é—´å°±æ˜¯`(n+1)*(max-1)+1` ä¹Ÿå°±æ˜¯ `(2+1) *(3-1)+1=7`ï¼Œ ä½†æ˜¯å¯èƒ½ä¼šæœ‰å¤šä¸ªæœ€å¤šæ¬¡æ•°çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åŠ ä¸Šæœ€å¤šçš„ç›¸åŒçš„ä¸ªæ•°ï¼Œæœ€åå°±æ˜¯ `(n+1)*(max-1)+maxCount` ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿï¼Œè¿˜æ˜¯æœ‰å¯èƒ½ä¼šå‡ºç°ä»£ç ä¸­çš„ä¾‹å­ï¼Œä¹Ÿå°±æ˜¯æœ€åå¾—åˆ°çš„ç»“æœæ¯”æˆ‘ä»¬çš„ä»»åŠ¡åˆ—è¡¨è¿˜æœ‰çŸ­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å–ä¸€ä¸ªæœ€å¤§å€¼\n\n## [55. è·³è·ƒæ¸¸æˆ](https://leetcode-cn.com/problems/jump-game/)\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚\n\næ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚\n\nåˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [2,3,1,1,4]\nè¾“å‡º: true\nè§£é‡Š: æˆ‘ä»¬å¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä½ç½® 0 åˆ°è¾¾ ä½ç½® 1, ç„¶åå†ä»ä½ç½® 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [3,2,1,0,4]\nè¾“å‡º: false\nè§£é‡Š: æ— è®ºæ€æ ·ï¼Œä½ æ€»ä¼šåˆ°è¾¾ç´¢å¼•ä¸º 3 çš„ä½ç½®ã€‚ä½†è¯¥ä½ç½®çš„æœ€å¤§è·³è·ƒé•¿åº¦æ˜¯ 0 ï¼Œ æ‰€ä»¥ä½ æ°¸è¿œä¸å¯èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nå›æº¯ï¼Œå‹‰å¼ºèƒ½è¿‡ã€‚ã€‚ã€‚å¤ªè ¢äº†ï¼Œä¸ºå•¥æƒ³ä¸åˆ°ç®€å•çš„æ–¹æ³•ï¼Œå°±éå¾—å¾€å¤æ‚äº†æƒ³ï¼Ÿå°±è¿™ä¹ˆå‚»ä¹ˆï¼Ÿ\n\n```java\nBoolean[] cache=null;\n\npublic boolean canJump(int[] nums) {\n    if (nums==null || nums.length<=0) return false;\n    cache=new Boolean[nums.length];\n    return jump(nums,0);\n}\n\npublic boolean jump(int[] nums,int index) {\n    if (nums[index] >= nums.length-1 -index) {\n        return true;\n    }\n    if (cache[index]!=null) {\n        return cache[index];\n    }\n    for (int i=nums[index];i>=1;i--) {\n        if (index+i<nums.length && jump(nums,index+i)) {\n            return cache[index]=true;\n        }\n    }\n    return cache[index]=false;\n}\n```\n**è§£æ³•äºŒ**\n\nä¸ç”¨å¤šè¯´äº†ï¼Œéå†æ•°ç»„ï¼Œä¸æ–­æ›´æ–°èƒ½åˆ°è¾¾çš„æœ€è¿œè·ç¦»ï¼Œå¦‚æœ**æŸä¸ªä½ç½®çš„indexå¤§äºå½“å‰èƒ½åˆ°è¾¾çš„æœ€è¿œè·ç¦»å°±ç›´æ¥è¿”å›false**\n\n```java\n//MDZZ\npublic boolean canJump(int[] nums) {\n    int maxIndex=nums[0];\n    for (int i=1;i<nums.length-1;i++) {\n        if(maxIndex >= nums.length-1) return true;\n        if (i>maxIndex) {\n            return false;\n        }\n        maxIndex=Math.max(maxIndex,i+nums[i]);\n    }\n    return true;\n}\n```\n\n## [45. è·³è·ƒæ¸¸æˆ II](https://leetcode-cn.com/problems/jump-game-ii/)\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚\n\næ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚\n\nä½ çš„ç›®æ ‡æ˜¯ä½¿ç”¨æœ€å°‘çš„è·³è·ƒæ¬¡æ•°åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [2,3,1,1,4]\nè¾“å‡º: 2\nè§£é‡Š: è·³åˆ°æœ€åä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚\n     ä»ä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚\n```\n\n**è¯´æ˜:**\n\nå‡è®¾ä½ æ€»æ˜¯å¯ä»¥åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªä½ç½®ã€‚\n\n**è§£æ³•ä¸€**\n\nå…´è‡´å‹ƒå‹ƒå†™äº†ä¸ªdp\n\n```java\npublic int jump(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int[] dp=new int[nums.length];\n    for (int i=1;i<nums.length;i++) {\n        dp[i]=Integer.MAX_VALUE;\n        for (int j=0;j<i;j++) {\n            if (nums[j]>=i-j) {\n                dp[i]=Math.min(dp[j]+1,dp[i]);    \n            }\n        }\n    }\n    return dp[nums.length-1];\n}\n```\n\nå¦‚æœè¿™å°±è¿‡äº†é‚£ä½ ä¹Ÿå¤ªå°ç§è¿™é¢˜äº†ğŸ˜‚äººå®¶å¯æ˜¯hardé¢˜ï¼Œé‚£èƒ½è¿™ä¹ˆå®¹æ˜“å°±è®©ä½ è¿‡äº†ï¼Ÿ\n\næ²¡é”™ï¼Œè¿™é‡Œç›´æ¥TLEäº†ï¼Œæœ€åä¸€ä¸ªCASEè¿‡ä¸å»\n\n**è§£æ³•äºŒ**\n\nè´ªå¿ƒï¼Œæ ¸å¿ƒæ€æƒ³ä¸æ˜¯æ¯æ¬¡éƒ½è·³åˆ°æœ€è¿œçš„åœ°æ–¹ï¼Œ**è€Œæ˜¯è·³åˆ°å½“å‰ä½ç½®èƒ½è·³åˆ°çš„æœ€è¿œçš„ä½ç½®**\n\n```java\n//æ¯æ¬¡é€‰èƒ½è·³çš„ä½ç½®ä¸­è·³çš„æœ€è¿œçš„\npublic int jump(int[] nums){\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int max=0;//æœ€å¤§è¾¹ç•Œ\n    int step=0,curMaxIndex=0;\n    for (int i=0;i<nums.length-1;i++) {\n        curMaxIndex=Math.max(curMaxIndex,nums[i]+i); //ièƒ½è·³çš„ä½ç½®ä¸­,è·³çš„æœ€è¿œçš„\n        if (i==max) {//èµ°åˆ°è¾¹ç•Œå°±++\n            step++;\n            max=curMaxIndex;\n        }\n    }\n    return step;\n}\n```\n\nä»£ç éœ€è¦ç»†ç»†å“ï¼Œä¸€ä¸‹å¯èƒ½çœ‹ä¸å¤ªæ˜ç™½\n\n**è§£æ³•ä¸‰**\n\nå›é¡¾çš„æ—¶å€™è¿™é“é¢˜å§‹ç»ˆæ˜¯æ²¡ææ¸…æ¥šï¼Œ[çœ‹äº†ä¸€ä¸ªå¤§ä½¬çš„é¢˜è§£](https://leetcode-cn.com/problems/jump-game-ii/solution/xun-huan-bu-bian-shi-fen-xi-cban-by-huai-an-2/) ï¼ˆè¿™ä¸ªå¤§ä½¬å¥½åƒæ˜¯ä¸ªåˆä¸­çš„å¦¹å­ï¼‰åæ˜ç™½äº†\n\n```java\n//å‚è€ƒäº†ä¸€ä¸ªå¤§ä½¬å¾ªç¯ä¸å˜è¡¨è¾¾å¼çš„åˆ†æ\npublic int jump(int[] nums){\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    //å½“å‰è¿™ä¸€è·³èƒ½é€‰æ‹©çš„æœ€è¿œè·ç¦»\n    int left=0;\n    //ç›®å‰èƒ½è¾¾åˆ°çš„æœ€è¿œè·ç¦»\n    int right=0;\n    int ptr=0,step=0;\n    while (right<nums.length-1) {\n        left=right;\n        while(ptr<nums.length && ptr<=left) {\n            right=Math.max(right,nums[ptr]+ptr);\n            ptr++;\n        }\n        step++;\n    }\n    return step;\n}\n```\n## [56. åˆå¹¶åŒºé—´](https://leetcode-cn.com/problems/merge-intervals/)\n\nç»™å‡ºä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œè¯·åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [[1,3],[2,6],[8,10],[15,18]]\nè¾“å‡º: [[1,6],[8,10],[15,18]]\nè§£é‡Š: åŒºé—´ [1,3] å’Œ [2,6] é‡å , å°†å®ƒä»¬åˆå¹¶ä¸º [1,6].\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [[1,4],[4,5]]\nè¾“å‡º: [[1,5]]\nè§£é‡Š: åŒºé—´ [1,4] å’Œ [4,5] å¯è¢«è§†ä¸ºé‡å åŒºé—´ã€‚\n```\n\n**è§£æ³•ä¸€**\n\næ€è·¯ä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œç±»ä¼¼è´ªå¿ƒå§\n\n```java\npublic int[][] merge(int[][] intervals) {\n    if (intervals ==null || intervals.length<=0) {\n        return new int[][]{};\n    }\n    Arrays.sort(intervals,(a,b)->a[0]-b[0]);\n    LinkedList<int[]> list=new LinkedList<>();\n    for (int i=1;i<intervals.length;i++) {\n        if (intervals[i][0]<=intervals[i-1][1]) {\n            if (intervals[i][1]>intervals[i-1][1]) {\n                intervals[i][0]=intervals[i-1][0];   \n            }else{\n                intervals[i][0]=intervals[i-1][0];\n                intervals[i][1]=intervals[i-1][1];\n            }\n        }else{\n            list.add(intervals[i-1]);\n        }\n    }\n    list.add(intervals[intervals.length-1]);\n    /*  int[][] res=new int[list.size()][2];\n        for (int i=0;i<list.size();i++) {\n            res[i][0]=list.get(i)[0];\n            res[i][1]=list.get(i)[1];\n        }*/\n    return list.toArray(new int[0][0]); //é¢˜è§£å“ªé‡Œå­¦åˆ°ä¸€æ‹›\n}\n```\n\næœ€å¤§çš„æ”¶è·å°±æ˜¯å­¦åˆ°äº†ä¸€æ‹›listè½¬arrayçš„æ–¹æ³•ğŸ˜\n\nå¶ç„¶çœ‹åˆ°ï¼Œç®€åŒ–ä¸‹ä»£ç \n\n```java\n//updateï¼š2020.4.16\n//å¶ç„¶çœ‹åˆ°,ç®€åŒ–ä¸‹ä»£ç \npublic int[][] merge(int[][] intervals) {\n    if (intervals ==null || intervals.length<=0) {\n        return new int[][]{};\n    }\n    Arrays.sort(intervals,(a,b)->a[0]-b[0]);\n    LinkedList<int[]> list=new LinkedList<>();\n    for (int i=1;i<intervals.length;i++) {\n        if (intervals[i][0]<=intervals[i-1][1]) {\n            intervals[i][0]=intervals[i-1][0];\n            intervals[i][1]=Math.max(intervals[i-1][1],intervals[i][1]);\n        }else{\n            list.add(intervals[i-1]);\n        }\n    }\n    list.add(intervals[intervals.length-1]);\n    return list.toArray(new int[0][0]);\n}\n```\nä¸€å¼€å§‹è¿˜æ²¡æ³¨æ„è¿™ä¸ªè§£æ³•ï¼Œç°åœ¨å›å¤´çœ‹çœ‹è¿™ä¸ªæ–¹æ³•æŒºå¦™çš„ï¼Œå½“æ— æ³•è¦†ç›–çš„æ—¶å€™å°†`intervals[i-1]` å…¥æ ˆï¼Œå½“å¯ä»¥è¦†ç›–çš„æ—¶å€™ä¿®æ”¹å½“å‰å…ƒç´ å€¼ï¼Œåœ¨ä¸‹ä¸€è½®ç»§ç»­æ·»åŠ æˆ–è¦†ç›–ï¼Œå…¶å®è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹ä¸å¥½ç†è§£ï¼Œåˆšåˆšåˆé‡å†™äº†ä¸€ä¸ªï¼Œæ€è·¯å¾ˆç›´ç™½\n\n```java\npublic int[][] merge(int[][] intervals) {\n    if(intervals==null || intervals.length<=0) return intervals;\n    Arrays.sort(intervals,(a,b)->a[0]!=b[0]?a[0]-b[0]:a[1]-b[1]);\n    List<int[]> res=new ArrayList<>();\n    res.add(intervals[0]);\n    for(int i=1;i<intervals.length;i++){\n        int[] pre=res.get(res.size()-1);\n        if(intervals[i][0]<=pre[1]){\n            if(intervals[i][1]>=pre[1]){\n                pre[1]=intervals[i][1];\n            }\n        }else{\n            res.add(intervals[i]);\n        }\n    }\n    return res.toArray(new int[0][0]);\n}\n```\n## [763. åˆ’åˆ†å­—æ¯åŒºé—´](https://leetcode-cn.com/problems/partition-labels/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nå­—ç¬¦ä¸² `S` ç”±å°å†™å­—æ¯ç»„æˆã€‚æˆ‘ä»¬è¦æŠŠè¿™ä¸ªå­—ç¬¦ä¸²åˆ’åˆ†ä¸ºå°½å¯èƒ½å¤šçš„ç‰‡æ®µï¼ŒåŒä¸€ä¸ªå­—æ¯åªä¼šå‡ºç°åœ¨å…¶ä¸­çš„ä¸€ä¸ªç‰‡æ®µã€‚è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ¯ä¸ªå­—ç¬¦ä¸²ç‰‡æ®µçš„é•¿åº¦çš„åˆ—è¡¨ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šS = \"ababcbacadefegdehijhklij\"\nè¾“å‡ºï¼š[9,7,8]\nè§£é‡Šï¼š\nåˆ’åˆ†ç»“æœä¸º \"ababcbaca\", \"defegde\", \"hijhklij\"ã€‚\næ¯ä¸ªå­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ã€‚\nåƒ \"ababcbacadefegde\", \"hijhklij\" çš„åˆ’åˆ†æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºåˆ’åˆ†çš„ç‰‡æ®µæ•°è¾ƒå°‘ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `S`çš„é•¿åº¦åœ¨`[1, 500]`ä¹‹é—´ã€‚\n*   `S`åªåŒ…å«å°å†™å­—æ¯ `'a'` åˆ° `'z'` ã€‚\n\n\n**è§£æ³•ä¸€**\n\næˆ‘ä¸€å¼€å§‹çš„æƒ³æ³•å°±æ˜¯å…ˆç»Ÿè®¡å‡ºæ‰€æœ‰26ä¸ªå­—æ¯å‡ºç°çš„é¦–ä½ç½®å’Œæœ«ä½ç½®ï¼Œç„¶åé¢˜ç›®å°±å˜æˆäº†[åˆå¹¶åŒºé—´](#56-åˆå¹¶åŒºé—´)ï¼Œä½†æ˜¯å…¶å®ä¸éœ€è¦çœŸæ­£çš„åˆå¹¶ï¼Œè¿™é‡Œåªéœ€è¦æ±‚é•¿åº¦å°±è¡Œäº†\n```golang\nfunc partitionLabels(S string) []int {\n Â  Â var m = make(map[byte]int)\n Â  Â var Max = func(a, b int) int {if a>b{return a};return b}\n Â  Â for i := 0; i < len(S); i++ {\n Â  Â  Â  Â m[S[i]] = i\n Â   }\n Â  Â var start, end = 0, 0\n Â  Â var res []int\n Â  Â for i := 0; i < len(S); i++ {\n Â  Â  Â  Â //æ›´æ–°å½“å‰åŒºé—´ç»“å°¾æœ€å¤§å€¼\n Â  Â  Â  Â end = Max(end, m[S[i]])\n Â  Â  Â  Â //èµ°åˆ°å½“å‰åŒºé—´ç»“å°¾ï¼Œå½“å‰åŒºé—´ç»“æŸ\n Â  Â  Â  Â if i==end {\n Â  Â  Â  Â  Â  Â res = append(res, end-start+1)\n Â  Â  Â  Â  Â  Â start = i+1\n Â  Â  Â   }\n Â   }\n Â  Â return res\n}\n```\nä»£ç æ„æ€å¾ˆæ˜ç¡®ï¼Œå¤šçœ‹çœ‹å°±æ˜ç™½äº†\n\n## [435. æ— é‡å åŒºé—´](https://leetcode-cn.com/problems/non-overlapping-intervals/)\n\nç»™å®šä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œæ‰¾åˆ°éœ€è¦ç§»é™¤åŒºé—´çš„æœ€å°æ•°é‡ï¼Œä½¿å‰©ä½™åŒºé—´äº’ä¸é‡å ã€‚\n\næ³¨æ„:\n\n- å¯ä»¥è®¤ä¸ºåŒºé—´çš„ç»ˆç‚¹æ€»æ˜¯å¤§äºå®ƒçš„èµ·ç‚¹ã€‚\n- åŒºé—´ [1,2] å’Œ [2,3] çš„è¾¹ç•Œç›¸äº’â€œæ¥è§¦â€ï¼Œä½†æ²¡æœ‰ç›¸äº’é‡å ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [ [1,2], [2,3], [3,4], [1,3] ]\n\nè¾“å‡º: 1\n\nè§£é‡Š: ç§»é™¤ [1,3] åï¼Œå‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [ [1,2], [1,2], [1,2] ]\n\nè¾“å‡º: 2\n\nè§£é‡Š: ä½ éœ€è¦ç§»é™¤ä¸¤ä¸ª [1,2] æ¥ä½¿å‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [ [1,2], [2,3] ]\n\nè¾“å‡º: 0\n\nè§£é‡Š: ä½ ä¸éœ€è¦ç§»é™¤ä»»ä½•åŒºé—´ï¼Œå› ä¸ºå®ƒä»¬å·²ç»æ˜¯æ— é‡å çš„äº†ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’ï¼Œå…¶å®å’Œæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ä¸€æ ·çš„\n\n> å’Œ[æœ€é•¿æ•°å¯¹é“¾](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#646-%E6%9C%80%E9%95%BF%E6%95%B0%E5%AF%B9%E9%93%BE)ä¸€æ‘¸ä¸€æ ·\n\n```java\npublic int eraseOverlapIntervals(int[][] intervals) {\n    if (intervals==null || intervals.length<=0) {\n        return 0;\n    }\n    Arrays.sort(intervals,(a,b)->a[0]-b[0]);\n    int[]dp=new int[intervals.length];\n    int max=-1;\n    for (int i=0;i<intervals.length;i++) {\n        dp[i]=1;\n        for (int j=0;j<i;j++) {\n            if(intervals[i][0]>=intervals[j][1]){\n                dp[i]=Math.max(dp[j]+1,dp[i]);\n            }\n        }\n        max=Math.max(max,dp[i]);\n    }\n    return intervals.length-max;\n}\n```\nå…ˆæ ¹æ®å·¦è¾¹ç•Œæ’ä¸ªåºï¼Œä¿è¯åé¢çš„ä¸ä¼šè¦†ç›–å‰é¢çš„ï¼Œç„¶ååæ‰‹æ±‚ä¸€ä¸‹æœ€é•¿çš„æ— é‡å åŒºé—´é•¿åº¦ï¼Œå’Œæœ€é•¿é€’å¢å­åºåˆ—ä¸€æ ·ï¼Œæœ€åç”¨æ€»é•¿åº¦å‡å»è¿™ä¸ªæœ€é•¿çš„åŒºé—´é•¿åº¦ç»“æœå°±æ˜¯ç­”æ¡ˆ\n\n171msï¼Œ8%ï¼Œæ„Ÿè§‰å¿«è¦è¿‡ä¸äº†äº†ã€‚ã€‚ã€‚æœ¬æ¥æ˜¯æ˜¯å†™çš„è®°å¿†åŒ–é€’å½’çš„ï¼Œç»“æœè¿‡ä¸äº†ã€‚ã€‚ã€‚å¡åœ¨å€’æ•°ç¬¬äºŒä¸ªcaseä¸Š\n\n**è®°å¿†åŒ–é€’å½’å†™æ³•**\n\n```java\nHashMap<Pair,Integer> cache=new HashMap<>();//TLE\n\npublic int eraseOverlapIntervals2(int[][] intervals) {\n    Arrays.sort(intervals,(a,b)->a[0]-b[0]);\n    return intervals.length-dfs(intervals,0,Integer.MIN_VALUE);\n}\n\n//èƒŒåŒ…é—®é¢˜,è¿”å›æœ€å¤šå¯ä»¥ç•™ä¸‹çš„åŒºé—´\npublic int dfs(int[][] intervals,int index,int prev) {\n    if (index==intervals.length) {\n        return 0;\n    }\n    Pair key=new Pair(index,prev);\n    if (cache.containsKey(key)) {\n        return cache.get(key);\n    }\n    int res=dfs(intervals,index+1,prev);\n    if (intervals[index][0]>=prev) {\n        res=Math.max(res,dfs(intervals,index+1,intervals[index][1])+1);\n    }\n    cache.put(key,res);\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nè´ªå¿ƒï¼Œæ—¶é—´å¤æ‚åº¦é™ä½ä¸ºçº¿æ€§\n\n```java\npublic int eraseOverlapIntervals(int[][] intervals) {\n    if (intervals==null || intervals.length<=0) {\n        return 0;\n    }\n    //æŒ‰ç…§èµ·ç‚¹æ’åº,é‡å çš„æ—¶å€™é€‰æ‹©ä¿ç•™ç»“å°¾å°çš„é‚£ä¸€ä¸ª\n    //Arrays.sort(intervals,(a,b)->a[0]-b[0]); lambdaåˆå§‹åŒ–æ•ˆç‡ä¼šä½ä¸€ç‚¹\n    Arrays.sort(intervals,new Comparator<int[]>(){\n        @Override\n        public int compare(int[] a,int[] b){\n            return a[0]-b[0];\n        }\n    });\n    int res=1;\n    int prev=0;\n    for (int i=1;i<intervals.length;i++) {\n        if (intervals[i][0]>=intervals[prev][1]) {\n            res++;\n            prev=i;\n        }else if(intervals[i][1]<intervals[prev][1]){\n            prev=i; //é€‰æ‹©ç»“å°¾å°çš„é‚£ä¸€ä¸ª\n        }\n    }\n    return intervals.length-res;\n}\n```\næŒ‰ç…§èµ·ç‚¹æ’åºï¼Œåœ¨é‡å çš„æ—¶å€™ä¼˜å…ˆé€‰æ‹©ç»“å°¾å°çš„å“ªä¸€ä¸ªï¼Œè¿™æ ·å°±å¯èƒ½å¾—åˆ°æ›´å¤šçš„åŒºé—´ç»„åˆ\n\n## [1288. åˆ é™¤è¢«è¦†ç›–åŒºé—´](https://leetcode-cn.com/problems/remove-covered-intervals/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªåŒºé—´åˆ—è¡¨ï¼Œè¯·ä½ åˆ é™¤åˆ—è¡¨ä¸­è¢«å…¶ä»–åŒºé—´æ‰€è¦†ç›–çš„åŒºé—´ã€‚\n\nåªæœ‰å½“Â `c <= a`Â ä¸”Â `b <= d`Â æ—¶ï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºåŒºé—´Â `[a,b)` è¢«åŒºé—´Â `[c,d)` è¦†ç›–ã€‚\n\nåœ¨å®Œæˆæ‰€æœ‰åˆ é™¤æ“ä½œåï¼Œè¯·ä½ è¿”å›åˆ—è¡¨ä¸­å‰©ä½™åŒºé—´çš„æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```go\nè¾“å…¥ï¼šintervals = [[1,4],[3,6],[2,8]]\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šåŒºé—´ [3,6] è¢«åŒºé—´ [2,8] è¦†ç›–ï¼Œæ‰€ä»¥å®ƒè¢«åˆ é™¤äº†ã€‚\n```\n\n**æç¤ºï¼š**â€‹â€‹â€‹â€‹â€‹â€‹\n\n*   `1 <= intervals.length <= 1000`\n*   `0 <= intervals[i][0] <Â intervals[i][1] <= 10^5`\n*   å¯¹äºæ‰€æœ‰çš„Â `i != j`ï¼š`intervals[i] != intervals[j]`\n\n\n**è§£æ³•ä¸€**\n\næ€è·¯æ¯”è¾ƒç›´ç™½\n```golang\nfunc removeCoveredIntervals(intervals [][]int) int {\n Â  Â sort.Slice(intervals, func (i int, j int) bool {\n Â  Â  Â  Â if intervals[i][0] == intervals[j][0] {\n Â  Â  Â  Â  Â  Â return intervals[i][1] > intervals[j][1]\n Â  Â  Â   }\n Â  Â  Â  Â return intervals[i][0] < intervals[j][0]\n Â   })\n Â  Â var Max = func(a, b int) int {if a>b {return a};return b}\n Â  Â var count = 0\n Â  Â var maxRight = intervals[0][1]\n Â  Â for i := 1; i < len(intervals); i++ {\n Â  Â  Â  Â if intervals[i][1] <= maxRight {\n Â  Â  Â  Â  Â  Â count++\n Â  Â  Â   }\n Â  Â  Â  Â maxRight = Max(maxRight, intervals[i][1])\n Â   }\n Â  Â return len(intervals)-count\n}\n```\n\n## [452. ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒ](https://leetcode-cn.com/problems/minimum-number-of-arrows-to-burst-balloons/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nåœ¨äºŒç»´ç©ºé—´ä¸­æœ‰è®¸å¤šçƒå½¢çš„æ°”çƒã€‚å¯¹äºæ¯ä¸ªæ°”çƒï¼Œæä¾›çš„è¾“å…¥æ˜¯æ°´å¹³æ–¹å‘ä¸Šï¼Œæ°”çƒç›´å¾„çš„å¼€å§‹å’Œç»“æŸåæ ‡ã€‚ç”±äºå®ƒæ˜¯æ°´å¹³çš„ï¼Œæ‰€ä»¥yåæ ‡å¹¶ä¸é‡è¦ï¼Œå› æ­¤åªè¦çŸ¥é“å¼€å§‹å’Œç»“æŸçš„xåæ ‡å°±è¶³å¤Ÿäº†ã€‚å¼€å§‹åæ ‡æ€»æ˜¯å°äºç»“æŸåæ ‡ã€‚å¹³é¢å†…æœ€å¤šå­˜åœ¨10<sup>4</sup>ä¸ªæ°”çƒã€‚\n\nä¸€æ”¯å¼“ç®­å¯ä»¥æ²¿ç€xè½´ä»ä¸åŒç‚¹å®Œå…¨å‚ç›´åœ°å°„å‡ºã€‚åœ¨åæ ‡xå¤„å°„å‡ºä¸€æ”¯ç®­ï¼Œè‹¥æœ‰ä¸€ä¸ªæ°”çƒçš„ç›´å¾„çš„å¼€å§‹å’Œç»“æŸåæ ‡ä¸º x<sub style=\"display: inline;\">startï¼Œ</sub>x<sub style=\"display: inline;\">endï¼Œ</sub> ä¸”æ»¡è¶³ Â x<sub style=\"display: inline;\">start</sub>Â â‰¤ x â‰¤ x<sub style=\"display: inline;\">endï¼Œ</sub>åˆ™è¯¥æ°”çƒä¼šè¢«å¼•çˆ†<sub style=\"display: inline;\">ã€‚</sub>å¯ä»¥å°„å‡ºçš„å¼“ç®­çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚ å¼“ç®­ä¸€æ—¦è¢«å°„å‡ºä¹‹åï¼Œå¯ä»¥æ— é™åœ°å‰è¿›ã€‚æˆ‘ä»¬æƒ³æ‰¾åˆ°ä½¿å¾—æ‰€æœ‰æ°”çƒå…¨éƒ¨è¢«å¼•çˆ†ï¼Œæ‰€éœ€çš„å¼“ç®­çš„æœ€å°æ•°é‡ã€‚\n\n**Example:**\n\n```go\nè¾“å…¥:\n[[10,16], [2,8], [1,6], [7,12]]\n\nè¾“å‡º:\n2\n\nè§£é‡Š:\nå¯¹äºè¯¥æ ·ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨x = 6ï¼ˆå°„çˆ†[2,8],[1,6]ä¸¤ä¸ªæ°”çƒï¼‰å’Œ x = 11ï¼ˆå°„çˆ†å¦å¤–ä¸¤ä¸ªæ°”çƒï¼‰ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nå’Œå‰é¢å‡ é¢˜ä¸€æ ·ï¼ŒæŒ‰ç…§èµ·ç‚¹æ’åºï¼Œå‘ç”Ÿé‡å æ—¶è®°å½•å°çš„Xendï¼Œå®é™…ä¸Šendçš„å«ä¹‰å°±æ˜¯å½“å‰è¿™ä¸€ç®­èƒ½å°„ç©¿å‰é¢æ‰€æœ‰æ°”çƒçš„æœ€è¿œè·ç¦»ï¼Œåé¢çš„æ°”çƒå¦‚æœå¤§äºè¿™ä¸ªè·ç¦»å°±éœ€è¦åŠ ä¸€ç®­ï¼Œå¦åˆ™å°±å¯ä»¥ä¸€å¹¶å°„ç©¿\n```golang\nfunc findMinArrowShots(points [][]int) int {\n Â  Â if len(points) <= 0 {\n Â  Â  Â  Â return 0\n Â   }\n Â  Â sort.Slice(points, func(i int, j int) bool {\n Â  Â  Â  Â return points[i][0] < points[j][0]\n Â   })\n Â  Â var end = points[0][1]\n Â  Â var res = 1\n Â  Â for i := 1; i < len(points); i++ {\n Â  Â  Â  Â if points[i][0] > end {\n Â  Â  Â  Â  Â  Â res++\n Â  Â  Â  Â  Â  Â end = points[i][1]\n Â  Â  Â   }else{\n Â  Â  Â  Â  Â  Â end = Min(end, points[i][1])\n Â  Â  Â   }\n Â   }\n Â  Â return res\n}\nâ€‹\nfunc Min(a, b int) int {\n Â  Â if a > b {\n Â  Â  Â  Â return b\n Â   }\n Â  Â return a\n}\n```\n**è§£æ³•äºŒ**\n\næŒ‰ç…§ç»ˆç‚¹æ’åº\n```golang\nfunc findMinArrowShots(points [][]int) int {\n    if len(points) <= 0 {\n        return 0\n    }\n    sort.Slice(points, func(i int, j int) bool {\n        return points[i][1] < points[j][1]\n    })\n    var end = points[0][1]\n    var res = 1\n    for i := 1; i < len(points); i++ {\n        if points[i][0] > end {\n            res++\n            end = points[i][1]\n        }\n    }\n    return res\n}\n\nfunc Min(a, b int) int {\n    if a > b {\n        return b\n    }\n    return a\n}\n```\n\n## [1024. è§†é¢‘æ‹¼æ¥](https://leetcode-cn.com/problems/video-stitching/)\n\nä½ å°†ä¼šè·å¾—ä¸€ç³»åˆ—è§†é¢‘ç‰‡æ®µï¼Œè¿™äº›ç‰‡æ®µæ¥è‡ªäºä¸€é¡¹æŒç»­æ—¶é•¿ä¸º T ç§’çš„ä½“è‚²èµ›äº‹ã€‚è¿™äº›ç‰‡æ®µå¯èƒ½æœ‰æ‰€é‡å ï¼Œä¹Ÿå¯èƒ½é•¿åº¦ä¸ä¸€ã€‚\n\nè§†é¢‘ç‰‡æ®µ `clips[i]` éƒ½ç”¨åŒºé—´è¿›è¡Œè¡¨ç¤ºï¼šå¼€å§‹äº `clips[i][0]` å¹¶äº `clips[i][1]` ç»“æŸã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å¯¹è¿™äº›ç‰‡æ®µè‡ªç”±åœ°å†å‰ªè¾‘ï¼Œä¾‹å¦‚ç‰‡æ®µ [0, 7] å¯ä»¥å‰ªåˆ‡æˆ `[0, 1] + [1, 3] + [3, 7]` ä¸‰éƒ¨åˆ†ã€‚\n\næˆ‘ä»¬éœ€è¦å°†è¿™äº›ç‰‡æ®µè¿›è¡Œå†å‰ªè¾‘ï¼Œå¹¶å°†å‰ªè¾‘åçš„å†…å®¹æ‹¼æ¥æˆè¦†ç›–æ•´ä¸ªè¿åŠ¨è¿‡ç¨‹çš„ç‰‡æ®µï¼ˆ[0, T]ï¼‰ã€‚è¿”å›æ‰€éœ€ç‰‡æ®µçš„æœ€å°æ•°ç›®ï¼Œå¦‚æœæ— æ³•å®Œæˆè¯¥ä»»åŠ¡ï¼Œåˆ™è¿”å› -1 ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šclips = [[0,2],[4,6],[8,10],[1,9],[1,5],[5,9]], T = 10\nè¾“å‡ºï¼š3\nè§£é‡Šï¼š\næˆ‘ä»¬é€‰ä¸­ [0,2], [8,10], [1,9] è¿™ä¸‰ä¸ªç‰‡æ®µã€‚\nç„¶åï¼ŒæŒ‰ä¸‹é¢çš„æ–¹æ¡ˆé‡åˆ¶æ¯”èµ›ç‰‡æ®µï¼š\nå°† [1,9] å†å‰ªè¾‘ä¸º [1,2] + [2,8] + [8,9] ã€‚\nç°åœ¨æˆ‘ä»¬æ‰‹ä¸Šæœ‰ [0,2] + [2,8] + [8,10]ï¼Œè€Œè¿™äº›æ¶µç›–äº†æ•´åœºæ¯”èµ› [0, 10]ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šclips = [[0,1],[1,2]], T = 5\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼š\næˆ‘ä»¬æ— æ³•åªç”¨ [0,1] å’Œ [0,2] è¦†ç›– [0,5] çš„æ•´ä¸ªè¿‡ç¨‹ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šclips = [[0,1],[6,8],[0,2],[5,6],[0,4],[0,3],[6,7],[1,3],[4,7],[1,4],[2,5],[2,6],[3,4],[4,5],[5,7],[6,9]], T = 9\nè¾“å‡ºï¼š3\nè§£é‡Šï¼š \næˆ‘ä»¬é€‰å–ç‰‡æ®µ [0,4], [4,7] å’Œ [6,9] ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šclips = [[0,4],[2,8]], T = 5\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š\næ³¨æ„ï¼Œä½ å¯èƒ½å½•åˆ¶è¶…è¿‡æ¯”èµ›ç»“æŸæ—¶é—´çš„è§†é¢‘ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= clips.length <= 100`\n- `0 <= clips[i][0], clips[i][1] <= 100`\n- `0 <= T <= 100`\n\n**è§£æ³•ä¸€**\n\næ„Ÿè§‰è¿™ä¸ªè´ªå¿ƒè¿˜æ˜¯å¾ˆç»å…¸çš„ï¼Œå¾ˆå¤šé¢˜éƒ½æ˜¯è¿™ä¸ªæ€è·¯ï¼Œä¸Šé¢çš„ è·³è·ƒæ¸¸æˆ2ï¼ŒåŒ…æ‹¬172å‘¨èµ›çš„æœ€åä¸€é¢˜ï¼Œéƒ½æ˜¯è¿™ä¸ªç±»ä¼¼çš„åŒºé—´è¦†ç›–é—®é¢˜\n\n```java\npublic int videoStitching(int[][] clips, int T) {\n    Arrays.sort(clips,(a,b)->a[0]-b[0]);\n    int i=0,res=0,last=0;\n    while(i<clips.length) {\n        int temp=last;\n        while(i<clips.length&&clips[i][0]<=temp) {\n            last=Math.max(last,clips[i][1]);\n            i++;\n        }\n        if (last==temp) { //æ²¡æœ‰æ‰¾åˆ°èƒ½è¦†ç›–çš„\n            return -1;\n        }\n        res++;\n        if (last>=T) {\n            return res;\n        }\n    }\n    return -1;\n}\n```\n\né¦–å…ˆæŒ‰ç…§å·¦è¾¹ç•Œæ’åºï¼Œç„¶åæ‰¾çš„æ—¶å€™**æ¯æ¬¡éƒ½åœ¨åºåˆ—ä¸­æ‰¾èƒ½è¦†ç›–`overlap`ä¸Šä¸€æ¬¡å³è¾¹ç•Œçš„æœ€é•¿åŒºé—´** ï¼Œç¬¬ä¸€æ¬¡è¦†ç›–å…¶å®å°±æ˜¯æ‰¾çš„å·¦è¾¹ç•Œèƒ½è¦†ç›–0çš„æœ€é•¿çš„åŒºé—´ï¼Œç„¶åä¸‹ä¸€æ¬¡å°±è¦æ‰¾èƒ½è¦†ç›–è¿™ä¸ªåŒºé—´å³è¾¹ç•Œçš„æœ€é•¿çš„åŒºé—´ã€‚æœ€ç»ˆçš„ç»“æœå°±æ˜¯æœ€å°‘çš„åŒºé—´æ•°ç›®ï¼Œæ­£ç¡®æ€§è¿™é‡Œå…¶å®æ€è€ƒä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œæ¯æ¬¡éƒ½é€‰æ‹©æœ€ä¼˜åŒºé—´ï¼Œå¯¹åé¢çš„é€‰æ‹©æ²¡æœ‰è´Ÿé¢å½±å“ï¼Œå…·ä½“å¦‚ä½•è¯æ˜è¿˜æ˜¯ç•™ç»™å¤§ä½¬ä»¬å§\n\n## [406. æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—](https://leetcode-cn.com/problems/queue-reconstruction-by-height/)\n\nå‡è®¾æœ‰æ‰“ä¹±é¡ºåºçš„ä¸€ç¾¤äººç«™æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚ æ¯ä¸ªäººç”±ä¸€ä¸ªæ•´æ•°å¯¹` (h, k) `è¡¨ç¤ºï¼Œå…¶ä¸­hæ˜¯è¿™ä¸ªäººçš„èº«é«˜ï¼Œkæ˜¯æ’åœ¨è¿™ä¸ªäººå‰é¢ä¸”èº«é«˜å¤§äºæˆ–ç­‰äºhçš„äººæ•°ã€‚ ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥é‡å»ºè¿™ä¸ªé˜Ÿåˆ—ã€‚\n\næ³¨æ„ï¼š\næ€»äººæ•°å°‘äº1100äººã€‚\n\n**ç¤ºä¾‹**\n\n```java\nè¾“å…¥:\n[[7,0], [4,4], [7,1], [5,0], [6,1], [5,2]]\n\nè¾“å‡º:\n[[5,0], [7,0], [5,2], [6,1], [4,4], [7,1]]\n```\n\n**è§£æ³•ä¸€**\n\nè´ªå¿ƒï¼Œæ²¡æƒ³å‡ºæ¥\n\n```java\npublic int[][] reconstructQueue(int[][] people) {\n    if (people==null ||people.length<=0) {\n        return new int[0][0];\n    }\n    List<int[]> res=new LinkedList<>();\n    Arrays.sort(people,(p1,p2)->p1[0]!=p2[0]?p2[0]-p1[0]:p1[1]-p2[1]);\n    for (int i=0;i<people.length;i++) {\n        res.add(people[i][1],people[i]);\n    }\n    return res.toArray(new int[0][0]);\n}\n```\n\né¦–å…ˆå¯¹èº«é«˜hé™åºï¼Œkå‡åºè¿›è¡Œæ’åˆ—å¾—åˆ°ï¼Œç„¶åå°†å…ƒç´ `ï¼ˆhï¼Œkï¼‰`æ’å…¥å‰é¢æ¯”å®ƒå¤§çš„å…ƒç´ ä¸­çš„ç¬¬kä¸ªä½ç½®ï¼Œä¿è¯è¯¥å…ƒç´ å‰é¢æœ‰kä¸ªæ¯”å½“å‰å…ƒç´ å¤§çš„ï¼Œä½¿ä¹‹åˆæ³•ï¼Œ**åé¢çš„æ¯”å®ƒçŸ®çš„å…ƒç´ çš„ç§»åŠ¨å¯¹å‰é¢å…¶å®çš„æ²¡æœ‰ä»»ä½•å½±å“**ï¼Œè¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œèº«é«˜é«˜çš„äººæ˜¯çœ‹ä¸åˆ°èº«é«˜çŸ®çš„äººçš„~ï¼Œä¹Ÿå°±æ˜¯èº«é«˜çŸ®çš„äººåœ¨èº«é«˜é«˜çš„äººå‰æˆ–åå¯¹èº«é«˜é«˜çš„äººæ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„\n\n```java\n[7,0] [7,1] [6,1] [5,0] [5,2] [4,4]\n\n[]                (7,0) -> []\n0                 (7,1) -> [7,0]\n0 1               (6,1) -> [7,0] [7,1]\n0 1 2             (5,0) -> [7,0] [6,1] [7,1]\n0 1 2 3           (5,2) -> [5,0] [7,0] [6,1] [7,1]\n0 1 2 3 4         (4,4) -> [5,0] [7,0] [5,2] [6,1] [7,1]\n0 1 2 3 4 5                [5,0] [7,0] [5,2] [6,1] [4,4] [7,1]\n```\n\n## [1262. å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ](https://leetcode-cn.com/problems/greatest-sum-divisible-by-three/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›èƒ½è¢«ä¸‰æ•´é™¤çš„å…ƒç´ æœ€å¤§å’Œã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [3,6,5,1,8]\nè¾“å‡ºï¼š18\nè§£é‡Šï¼šé€‰å‡ºæ•°å­— 3, 6, 1 å’Œ 8ï¼Œå®ƒä»¬çš„å’Œæ˜¯ 18ï¼ˆå¯è¢« 3 æ•´é™¤çš„æœ€å¤§å’Œï¼‰ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [4]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼š4 ä¸èƒ½è¢« 3 æ•´é™¤ï¼Œæ‰€ä»¥æ— æ³•é€‰å‡ºæ•°å­—ï¼Œè¿”å› 0ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [1,2,3,4,4]\nè¾“å‡ºï¼š12\nè§£é‡Šï¼šé€‰å‡ºæ•°å­— 1, 3, 4 ä»¥åŠ 4ï¼Œå®ƒä»¬çš„å’Œæ˜¯ 12ï¼ˆå¯è¢« 3 æ•´é™¤çš„æœ€å¤§å’Œï¼‰ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= nums.length <= 4 * 10^4`\n- `1 <= nums[i] <= 10^4`\n\n**è§£æ³•ä¸‰**\n\nO(NlogN)è´ªå¿ƒï¼Œæœ€ä¼˜è§£æ³•åº”è¯¥æ˜¯dpï¼Œæ”¾åœ¨dp[ä¸“é¢˜ä¸­](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/)\n\n```java\npublic int maxSumDivThree3(int[] nums) {\n    int sum=0;\n    List<Integer> one=new ArrayList<>();\n    List<Integer> two=new ArrayList<>();\n    for (int n:nums) {\n        sum+=n;\n        if (n%3==1) one.add(n);\n        if (n%3==2) two.add(n);\n    }\n    Collections.sort(one);\n    Collections.sort(two);\n    if (sum%3==1) { //ç§»é™¤ä¸€ä¸ªä½™æ•°ä¸º1çš„ æˆ–è€…ä¸¤ä¸ªä½™æ•°ä¸º2çš„\n        return Math.max(one.size()>=1?sum-one.get(0):0,two.size()>=2?sum-two.get(0)-two.get(1):0);\n    }\n    if (sum%3==2) { //ç§»é™¤ä¸€ä¸ªä½™æ•°ä¸º2 æˆ–è€…ä¸¤ä¸ªä½™æ•°ä¸º1çš„\n        return Math.max(two.size()>=1?sum-two.get(0):0,one.size()>=2?sum-one.get(0)-one.get(1):0);   \n    }\n    return sum;\n}\n```\n\nå¦‚æœæ€»å’Œ%3=1æˆ‘ä»¬å°±å¯ä»¥ç§»é™¤æ•°ç»„ä¸­%3=1çš„æœ€å°é‚£ä¸ªæˆ–è€…ç§»é™¤ä¸¤ä¸ª%3=2çš„æœ€å°çš„ï¼ŒåŒç†ï¼Œæ€»å’Œ%3=2ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤ä¸€ä¸ªæœ€å°çš„%2=0çš„å…ƒç´ ï¼Œæˆ–è€…ç§»é™¤ä¸¤ä¸ª%2=1çš„æœ€å°å…ƒç´ \n\nè¿™é‡Œæˆ‘ä»¬éœ€è¦è®°å½•çš„ä»…ä»…æ˜¯æ•°ç»„ä¸­%3=1å’Œ%3=2çš„æœ€å°çš„4ä¸ªå€¼å°±okï¼Œå…¶å®ä¸ç”¨æ’åºå°±å¯ä»¥ï¼Œç›´æ¥O(N)éå†å°±è¡Œï¼Œå«Œéº»çƒ¦æ²¡æ”¹ï¼Œåé¢æœ‰æ—¶é—´æ¥æ”¹æ”¹\n\n**è§£æ³•äºŒ**\n\nå±¥è¡Œä¸Šé¢çš„æ‰¿è¯ºï¼Œæ”¹å¥½äº†ä¸€ç‰ˆO(N)çš„è´ªå¿ƒè§£æ³•\n\n```java\npublic int maxSumDivThree(int[] nums) {\n    int M=0x3f3f3f3f;\n    //ä½™1æœ€å°å€¼\n    int min1_0=M,min1_1=M;\n    //ä½™2æœ€å°å€¼\n    int min2_0=M,min2_1=M;\n    int sum=0;\n    for(int i=0;i<nums.length;i++){\n        sum+=nums[i];\n        if(nums[i]%3==1){\n            if(nums[i]<=min1_0){\n                min1_1=min1_0; //æ›´æ–°æ¬¡å°å€¼\n                min1_0=nums[i]; //æ›´æ–°æœ€å°å€¼\n            }else if(nums[i]<=min1_1){\n                min1_1=nums[i]; //æ›´æ–°æ¬¡å°å€¼\n            }\n        }\n        if(nums[i]%3==2){\n            if(nums[i]<=min2_0){\n                min2_1=min2_0;\n                min2_0=nums[i];\n            }else if(nums[i]<=min2_1){\n                min2_1=nums[i];\n            }\n        }\n    }\n    if(sum%3==1) return sum-Math.min(min2_0+min2_1,min1_0);\n    if(sum%3==2) return sum-Math.min(min1_0+min1_1,min2_0);\n    return sum;\n}\n```\n\n## [5172. å½¢æˆä¸‰çš„æœ€å¤§å€æ•°](https://leetcode-cn.com/problems/largest-multiple-of-three/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `digits`ï¼Œä½ å¯ä»¥é€šè¿‡æŒ‰ä»»æ„é¡ºåºè¿æ¥å…¶ä¸­æŸäº›æ•°å­—æ¥å½¢æˆ 3 çš„å€æ•°ï¼Œè¯·ä½ è¿”å›æ‰€èƒ½å¾—åˆ°çš„æœ€å¤§çš„ 3 çš„å€æ•°ã€‚\n\nç”±äºç­”æ¡ˆå¯èƒ½ä¸åœ¨æ•´æ•°æ•°æ®ç±»å‹èŒƒå›´å†…ï¼Œè¯·ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ç­”æ¡ˆã€‚\n\nå¦‚æœæ— æ³•å¾—åˆ°ç­”æ¡ˆï¼Œè¯·è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šdigits = [8,1,9]\nè¾“å‡ºï¼š\"981\"\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šdigits = [8,6,7,1,0]\nè¾“å‡ºï¼š\"8760\"\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šdigits = [1]\nè¾“å‡ºï¼š\"\"\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šdigits = [0,0,0,0,0,0]\nè¾“å‡ºï¼š\"0\"\n```\n\n**æç¤ºï¼š**\n\n- 1 <= digits.length <= 10^4\n- 0 <= digits[i] <= 9\n- è¿”å›çš„ç»“æœä¸åº”åŒ…å«ä¸å¿…è¦çš„å‰å¯¼é›¶ã€‚\n\n**è§£æ³•ä¸€**\n\n177å‘¨èµ›çš„T4ï¼Œæ—¶éš”å¤šæ—¥ï¼Œå‘¨èµ›åˆå‡ºäº†è¿™ä¸€é¢˜ï¼Œå’Œä¸Šé¢ä¸€æ ·ï¼Œæ€è·¯å·®ä¸å¤šçš„ï¼Œéœ€è¦ä¼˜å…ˆè€ƒè™‘åªåˆ é™¤ä¸€ä¸ªçš„æƒ…å†µ\n\n```java\npublic String largestMultipleOfThree(int[] digits) {\n    int sum=0;\n    int[] freq=new int[10];\n    for(int i=0;i<digits.length;i++) {\n        sum+=digits[i];\n        freq[digits[i]]++;\n    }\n    if(sum==0) return \"0\";\n    //åˆ é™¤ä¸€ä¸ªä½™1çš„æˆ–è€…ä¸¤ä¸ªä½™2çš„,ä¼˜å…ˆåˆ é™¤ä¸€ä¸ªä½™1çš„\n    //åˆ é™¤1ä¸ªå¾—åˆ°çš„ç»“æœè‚¯å®šæ¯”åˆ é™¤2ä¸ªå¤§\n    if(sum%3==1){ \n        if(!deleteMin(freq,1)){ \n            deleteMin(freq,2);\n            deleteMin(freq,2);\n        }\n    }\n    if(sum%3==2){ //åˆ é™¤ä¸€ä¸ªä½™2çš„æˆ–è€…ä¸¤ä¸ªä½™1çš„\n        if(!deleteMin(freq,2)){\n            deleteMin(freq,1);\n            deleteMin(freq,1);\n        }   \n    }\n    StringBuilder res=new StringBuilder();\n    //é€†åºæ„å»ºç»“æœ\n    for(int i=9;i>=0;i--){\n        int count=freq[i];\n        while(count-- >0){\n            res.append(i);\n        }\n    }\n    return res.toString();\n}\n\npublic boolean deleteMin(int[] freq,int y){\n    for (int i=y;i<9;i+=3) {\n        if (freq[i]!=0) {\n            freq[i]--;\n            return true;\n        }\n    }\n    return false;\n}\n```\n\n## [1111. æœ‰æ•ˆæ‹¬å·çš„åµŒå¥—æ·±åº¦](https://leetcode-cn.com/problems/maximum-nesting-depth-of-two-valid-parentheses-strings/)\n\nè¿·æƒ‘é¢˜ï¼Œä¸æƒ³ç²˜é¢˜ç›®äº†\n\n**è§£æ³•ä¸€**\n\næŒ‰ç…§æ·±åº¦çš„å¥‡å¶åˆ’åˆ†ä¸¤ä¸ªå­ä¸²ã€‚ã€‚ã€‚ã€‚\n\n```java\npublic int[] maxDepthAfterSplit(String seq) {\n    //Deque<Character> stack=new ArrayDeque<>();\n    int depth=0;\n    int[] res=new int[seq.length()];\n    for (int i=0;i<seq.length();i++) {\n        if(seq.charAt(i)=='('){\n            res[i]=depth++%2;\n        }else{\n            //æ ¹æ®å·¦æ‹¬å·å¥‡å¶åˆ¤æ–­\n            res[i]=--depth%2;\n        }\n    }\n    return res;\n}\n```\n\n## [1353. æœ€å¤šå¯ä»¥å‚åŠ çš„ä¼šè®®æ•°ç›®](https://leetcode-cn.com/problems/maximum-number-of-events-that-can-be-attended/) \n\nç»™ä½ ä¸€ä¸ªæ•°ç»„ eventsï¼Œå…¶ä¸­ events[i] = [startDayi, endDayi] ï¼Œè¡¨ç¤ºä¼šè®® i å¼€å§‹äº startDayi ï¼Œç»“æŸäº endDayi ã€‚\n\nä½ å¯ä»¥åœ¨æ»¡è¶³ startDayi <= d <= endDayi ä¸­çš„ä»»æ„ä¸€å¤© d å‚åŠ ä¼šè®® i ã€‚æ³¨æ„ï¼Œä¸€å¤©åªèƒ½å‚åŠ ä¸€ä¸ªä¼šè®®ã€‚\n\nè¯·ä½ è¿”å›ä½ å¯ä»¥å‚åŠ çš„ æœ€å¤§ ä¼šè®®æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![JELWN9.png](https://s1.ax1x.com/2020/04/17/JELWN9.png)\n\n```java\nè¾“å…¥ï¼ševents = [[1,2],[2,3],[3,4]]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šä½ å¯ä»¥å‚åŠ æ‰€æœ‰çš„ä¸‰ä¸ªä¼šè®®ã€‚\nå®‰æ’ä¼šè®®çš„ä¸€ç§æ–¹æ¡ˆå¦‚ä¸Šå›¾ã€‚\nç¬¬ 1 å¤©å‚åŠ ç¬¬ä¸€ä¸ªä¼šè®®ã€‚\nç¬¬ 2 å¤©å‚åŠ ç¬¬äºŒä¸ªä¼šè®®ã€‚\nç¬¬ 3 å¤©å‚åŠ ç¬¬ä¸‰ä¸ªä¼šè®®ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼ševents= [[1,2],[2,3],[3,4],[1,2]]\nè¾“å‡ºï¼š4\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼ševents = [[1,4],[4,4],[2,2],[3,4],[1,1]]\nè¾“å‡ºï¼š4\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼ševents = [[1,100000]]\nè¾“å‡ºï¼š1\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼ševents = [[1,1],[1,2],[1,3],[1,4],[1,5],[1,6],[1,7]]\nè¾“å‡ºï¼š7\n```\n\n**æç¤ºï¼š**\n\n- `1 <= events.length <= 10^5`\n- `events[i].length == 2`\n- `1 <= events[i][0] <= events[i][1] <= 10^5`\n\n**è§£æ³•ä¸€**\n\næš´åŠ›è´ªå¿ƒ\n\n```java\n//[[1,4],[4,4],[2,2],[3,4],[1,1]]\n// 1,1  2,2  1,4  3,4  4,4\n// æš´åŠ›è´ªå¿ƒï¼ŒæŒ‰ç»“æŸæ—¶é—´æ’åºï¼Œä¼˜å…ˆå®‰æ’ç»“æŸæ—¶é—´çŸ­çš„ï¼ŒO(N^2)\npublic int maxEvents(int[][] events) {\n    if(events==null || events.length<=0) return 0;\n    Arrays.sort(events,(e1,e2)->e1[1]-e2[1]);\n    //å½“å¤©æœ‰æ²¡æœ‰å®‰æ’ä¼šè®®\n    HashSet<Integer> set=new HashSet<>();\n    int count=0;\n    for(int i=0;i<events.length;i++){\n        int start=events[i][0];\n        int end=events[i][1];\n        for(int j=start;j<=end;j++){ //åœ¨å¯¹åº”æ—¶é—´æ®µå†…è¿›è¡Œå®‰æ’\n            if(!set.contains(j)){\n                set.add(j);\n                count++;\n                break;\n            }\n        }\n    }\n    return count;\n}\n```\n**è§£æ³•äºŒ**\n\n```java\n//ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–ï¼ŒNlogN\npublic int maxEvents(int[][] events) {\n    if(events==null || events.length<=0) return 0;\n    Arrays.sort(events,(e1,e2)->e1[0]-e2[0]);\n    //ç»“æŸæ—¶é—´æ„å»ºå°æ ¹å †\n    PriorityQueue<Integer> pq=new PriorityQueue<>();\n    int index=0,res=0,n=events.length;\n    int curDay=1;\n    while(index<n || !pq.isEmpty()){\n        //å°†å½“å¤©å¼€å§‹çš„ä¼šè®®çš„ç»“æŸæ—¶é—´åŠ å…¥å°æ ¹å †\n        while(index<n && curDay==events[index][0]){\n            pq.add(events[index++][1]);\n        }\n        //å°†è¿‡æœŸä¼šè®®çš„ç§»é™¤\n        while(!pq.isEmpty() && pq.peek()<curDay){\n            pq.poll();\n        }\n        //ä¼˜å…ˆé€‰æ‹©ç»“æŸæ—¶é—´æœ€çŸ­çš„\n        if(!pq.isEmpty()){\n            pq.poll();\n            res++;\n        }\n        curDay++; //å®‰æ’ä¸‹ä¸€å¤©\n    }\n    return res;\n}\n```\n\n## [134. åŠ æ²¹ç«™](https://leetcode-cn.com/problems/gas-station/)\n\nåœ¨ä¸€æ¡ç¯è·¯ä¸Šæœ‰ N ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ i ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ gas[i] å‡ã€‚\n\nä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»ç¬¬ i ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ i+1 ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ cost[i] å‡ã€‚ä½ ä»å…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚\n\nå¦‚æœä½ å¯ä»¥ç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›å‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å› -1ã€‚\n\n**è¯´æ˜:** \n\n- å¦‚æœé¢˜ç›®æœ‰è§£ï¼Œè¯¥ç­”æ¡ˆå³ä¸ºå”¯ä¸€ç­”æ¡ˆã€‚\n- è¾“å…¥æ•°ç»„å‡ä¸ºéç©ºæ•°ç»„ï¼Œä¸”é•¿åº¦ç›¸åŒã€‚\n- è¾“å…¥æ•°ç»„ä¸­çš„å…ƒç´ å‡ä¸ºéè´Ÿæ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \ngas  = [1,2,3,4,5]\ncost = [3,4,5,1,2]\n\nè¾“å‡º: 3\n\nè§£é‡Š:\nä» 3 å·åŠ æ²¹ç«™(ç´¢å¼•ä¸º 3 å¤„)å‡ºå‘ï¼Œå¯è·å¾— 4 å‡æ±½æ²¹ã€‚æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹\nå¼€å¾€ 4 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 1 + 5 = 8 å‡æ±½æ²¹\nå¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 8 - 2 + 1 = 7 å‡æ±½æ²¹\nå¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 7 - 3 + 2 = 6 å‡æ±½æ²¹\nå¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 6 - 4 + 3 = 5 å‡æ±½æ²¹\nå¼€å¾€ 3 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 5 å‡æ±½æ²¹ï¼Œæ­£å¥½è¶³å¤Ÿä½ è¿”å›åˆ° 3 å·åŠ æ²¹ç«™ã€‚\nå› æ­¤ï¼Œ3 å¯ä¸ºèµ·å§‹ç´¢å¼•ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \ngas  = [2,3,4]\ncost = [3,4,3]\n\nè¾“å‡º: -1\n\nè§£é‡Š:\nä½ ä¸èƒ½ä» 0 å·æˆ– 1 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„æ±½æ²¹å¯ä»¥è®©ä½ è¡Œé©¶åˆ°ä¸‹ä¸€ä¸ªåŠ æ²¹ç«™ã€‚\næˆ‘ä»¬ä» 2 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå¯ä»¥è·å¾— 4 å‡æ±½æ²¹ã€‚ æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹\nå¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 3 + 2 = 3 å‡æ±½æ²¹\nå¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 3 - 3 + 3 = 3 å‡æ±½æ²¹\nä½ æ— æ³•è¿”å› 2 å·åŠ æ²¹ç«™ï¼Œå› ä¸ºè¿”ç¨‹éœ€è¦æ¶ˆè€— 4 å‡æ±½æ²¹ï¼Œä½†æ˜¯ä½ çš„æ²¹ç®±åªæœ‰ 3 å‡æ±½æ²¹ã€‚\nå› æ­¤ï¼Œæ— è®ºæ€æ ·ï¼Œä½ éƒ½ä¸å¯èƒ½ç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n```go\nfunc canCompleteCircuit(gas []int, cost []int) int {\n    n:=len(gas)\n    curGas:=0 //å½“å‰æ²¹é‡\n    start:=0 //èµ·ç‚¹\n    total:=0 //gaså’Œcostä¹‹å·®,å°äº0çš„è¯è‚¯å®šæ— æ³•ç»•åœˆ\n    for i:=start;i<n;i++{\n        curGas+=(gas[i]-cost[i])\n        total+=(gas[i]-cost[i])\n        //æ²¹é‡ä¸å¤Ÿï¼Œiæ— æ³•ç»§ç»­å‰è¿›åˆ°i+1,è¯´æ˜ä»start~iæ— æ³•ç»•ç¯\n        if curGas<0{ \n            start=i+1\n            curGas=0\n        }\n    }\n    if total<0{\n        return -1\n    }\n    return start\n}\n```\n\n## [1046. æœ€åä¸€å—çŸ³å¤´çš„é‡é‡](https://leetcode-cn.com/problems/last-stone-weight/)\n\næœ‰ä¸€å †çŸ³å¤´ï¼Œæ¯å—çŸ³å¤´çš„é‡é‡éƒ½æ˜¯æ­£æ•´æ•°ã€‚\n\næ¯ä¸€å›åˆï¼Œä»ä¸­é€‰å‡ºä¸¤å— **æœ€é‡çš„** çŸ³å¤´ï¼Œç„¶åå°†å®ƒä»¬ä¸€èµ·ç²‰ç¢ã€‚å‡è®¾çŸ³å¤´çš„é‡é‡åˆ†åˆ«ä¸º `x` å’Œ `y`ï¼Œä¸” `x <= y`ã€‚é‚£ä¹ˆç²‰ç¢çš„å¯èƒ½ç»“æœå¦‚ä¸‹ï¼š\n\n- å¦‚æœ `x == y`ï¼Œé‚£ä¹ˆä¸¤å—çŸ³å¤´éƒ½ä¼šè¢«å®Œå…¨ç²‰ç¢ï¼›\n- å¦‚æœ `x != y`ï¼Œé‚£ä¹ˆé‡é‡ä¸º `x` çš„çŸ³å¤´å°†ä¼šå®Œå…¨ç²‰ç¢ï¼Œè€Œé‡é‡ä¸º `y` çš„çŸ³å¤´æ–°é‡é‡ä¸º `y-x`ã€‚\n\næœ€åï¼Œæœ€å¤šåªä¼šå‰©ä¸‹ä¸€å—çŸ³å¤´ã€‚è¿”å›æ­¤çŸ³å¤´çš„é‡é‡ã€‚å¦‚æœæ²¡æœ‰çŸ³å¤´å‰©ä¸‹ï¼Œå°±è¿”å› `0`ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š[2,7,4,1,8,1]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼š\nå…ˆé€‰å‡º 7 å’Œ 8ï¼Œå¾—åˆ° 1ï¼Œæ‰€ä»¥æ•°ç»„è½¬æ¢ä¸º [2,4,1,1,1]ï¼Œ\nå†é€‰å‡º 2 å’Œ 4ï¼Œå¾—åˆ° 2ï¼Œæ‰€ä»¥æ•°ç»„è½¬æ¢ä¸º [2,1,1,1]ï¼Œ\næ¥ç€æ˜¯ 2 å’Œ 1ï¼Œå¾—åˆ° 1ï¼Œæ‰€ä»¥æ•°ç»„è½¬æ¢ä¸º [1,1,1]ï¼Œ\næœ€åé€‰å‡º 1 å’Œ 1ï¼Œå¾—åˆ° 0ï¼Œæœ€ç»ˆæ•°ç»„è½¬æ¢ä¸º [1]ï¼Œè¿™å°±æ˜¯æœ€åå‰©ä¸‹é‚£å—çŸ³å¤´çš„é‡é‡ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= stones.length <= 30`\n2. `1 <= stones[i] <= 1000`\n\n**è§£æ³•ä¸€**\n\nè™½ç„¶tagæœ‰è´ªå¿ƒï¼Œä½†æ˜¯å¹¶ä¸æ˜¯è´ªå¿ƒã€‚ã€‚ã€‚ç›´æ¥æ¨¡æ‹Ÿå°±è¡Œäº†ï¼Œåè€Œæ˜¯è¿™é¢˜çš„[è¿›é˜¶ç‰ˆæœ¬](https://leetcode-cn.com/problems/last-stone-weight-ii/)ï¼Œæˆ‘ä»¥ä¸ºå¯ä»¥è¿™æ ·è´ªå¿ƒè¿‡ï¼Œç»“æœå‘ç°ä¸å¯¹\n\n```java\npublic int lastStoneWeight(int[] stones) {\n    if(stones==null ||stones.length<=0){\n        return 0;\n    }\n    PriorityQueue<Integer> pq=new PriorityQueue<>((a,b)->b-a);\n    for(int i=0;i<stones.length;i++){\n        pq.add(stones[i]);\n    }\n    //NlogN\n    while(pq.size()>1){\n        int y=pq.poll();\n        int x=pq.poll();\n        pq.add(y-x);\n    }\n    return pq.poll();\n}\n```\n## [920. ä¼šè®®å®¤(LintCode)](https://www.lintcode.com/problem/meeting-rooms/description)\n\nç»™å®šä¸€ç³»åˆ—çš„ä¼šè®®æ—¶é—´é—´éš”ï¼ŒåŒ…æ‹¬èµ·å§‹å’Œç»“æŸæ—¶é—´[[s1,e1]ï¼Œ[s2,e2]ï¼Œâ€¦(si < ei)ï¼Œç¡®å®šä¸€ä¸ªäººæ˜¯å¦å¯ä»¥å‚åŠ æ‰€æœ‰ä¼šè®®ã€‚\n- (0,8),(8,10)åœ¨8è¿™è¿™ä¸€æ—¶åˆ»ä¸å†²çª\n\n**æ ·ä¾‹1**\n\n```go\nè¾“å…¥: intervals = [(0,30),(5,10),(15,20)]\nè¾“å‡º: false\nè§£é‡Š:\n(0,30), (5,10) å’Œ (0,30),(15,20) è¿™ä¸¤å¯¹ä¼šè®®ä¼šå†²çª\n```\n**æ ·ä¾‹2**\n```go\nè¾“å…¥: intervals = [(5,8),(9,15)]\nè¾“å‡º: true\nè§£é‡Š:\nè¿™ä¸¤ä¸ªæ—¶é—´æ®µä¸ä¼šå†²çª\n```\n\n**è§£æ³•ä¸€**\n\nè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œæ’åºååˆ¤æ–­ç›¸é‚»çš„åŒºé—´æ˜¯å¦ä¼šè¦†ç›–å°±è¡Œäº†\n```golang\nimport \"sort\"\n\nfunc canAttendMeetings (intervals []*Interval) bool {\n    // Write your code here\n    sort.Slice(intervals, func(i int, j int) bool {\n        return intervals[i].Start < intervals[j].Start\n    })\n    for i := 1; i < len(intervals); i++ {\n        if intervals[i].Start < intervals[i-1].End {\n            return false\n        }\n    }\n    return true\n}\n```\n\n## [919. ä¼šè®®å®¤ II(LintCode)](https://www.lintcode.com/problem/meeting-rooms-ii/description)\n\nç»™å®šä¸€ç³»åˆ—çš„ä¼šè®®æ—¶é—´é—´éš”intervalsï¼ŒåŒ…æ‹¬èµ·å§‹å’Œç»“æŸæ—¶é—´[[s1,e1],[s2,e2],...] (si < ei)ï¼Œæ‰¾åˆ°æ‰€éœ€çš„æœ€å°çš„ä¼šè®®å®¤æ•°é‡ã€‚\n\n**æ ·ä¾‹1**\n```go\nè¾“å…¥: intervals = [(0,30),(5,10),(15,20)]\nè¾“å‡º: 2\nè§£é‡Š:\néœ€è¦ä¸¤ä¸ªä¼šè®®å®¤\nä¼šè®®å®¤1:(0,30)\nä¼šè®®å®¤2:(5,10),(15,20)\n```\n\n**æ ·ä¾‹2**\n```go\nè¾“å…¥: intervals = [(2,7)]\nè¾“å‡º: 1\nè§£é‡Š:\nåªéœ€è¦1ä¸ªä¼šè®®å®¤å°±å¤Ÿäº†\n```\n\n**è§£æ³•ä¸€**\n\næ‰«æçº¿çš„åšæ³•ï¼Œæ„Ÿè§‰æ¯”è¾ƒç®€å•ï¼Œä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼ˆè¿™åº”è¯¥å±äºæœ€ç®€å•çš„æ‰«æçº¿å§ï¼Œæˆ‘çœ‹äº†å…¶ä»–çš„ä¸€äº›æ‰«æçº¿å•¥çš„éƒ½æ˜¯acmé‡Œé¢çš„å†…å®¹ï¼‰\n![mark](http://static.imlgw.top/blog/20200810/nQveo3X6eKxI.png?imageslim)\nç±»ä¼¼å°±æ˜¯ä¸Šå›¾æ ·å­ï¼Œæ±‚ä¸€ä¸ªæœ€å¤§çš„æœ‰é‡åˆçš„åŒºé—´æ•°é‡ï¼Œå…ˆå°†èµ·ç‚¹ç»ˆç‚¹æ‰“æ•£åæ’åºï¼Œæ‰«æçš„æ—¶å€™å°±æŒ‰ç…§æ’åºåçš„èŠ‚ç‚¹æ¥ä¸€ä¸ªä¸ªæ‰«æï¼Œç„¶åæ ¹æ®èŠ‚ç‚¹çš„å±æ€§æ¥åˆ¤æ–­æ˜¯åº”è¯¥+1è¿˜æ˜¯-1ï¼Œå¦‚æœæ˜¯èµ·ç‚¹å°±+1ï¼Œå¦‚æœé‡åˆ°ç»ˆç‚¹å°±-1ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ä¸€æ¡çº¿ä»å·¦å¾€å³æ‰«æè¿‡å»ä¸€æ ·\n```golang\n/**\n * Definition of Interval:\n * type Interval struct {\n *     Start, End int\n * }\n */\n\n/**\n * @param intervals: an array of meeting time intervals\n * @return: the minimum number of conference rooms required\n */\nimport \"sort\"\n\ntype Pair struct{\n    time int\n    isEnd bool\n}\n\nfunc minMeetingRooms (intervals []*Interval) int {\n    var n = len(intervals)\n    var list []*Pair\n    var Max = func (a,b int) int {if a>b {return a};return b}\n    for i := 0; i < n; i++ {\n        list = append(list, &Pair{intervals[i].Start,false})\n        list = append(list, &Pair{intervals[i].End,true})\n    }\n    sort.Slice(list, func (i int, j int) bool {\n        return list[i].time < list[j].time\n    })\n    var res = 0\n    var count = 0\n    for _, p := range list {\n        if p.isEnd{\n            count--\n        }else{\n            count++\n        }\n        res = Max(count, res)\n    }\n    return res\n}\n```\n**è§£æ³•äºŒ**\n\næ’åº+å°æ ¹å †ï¼ŒæŒ‰èµ·ç‚¹æ’åºï¼Œç„¶åéå†æ‰€æœ‰åŒºé—´ï¼Œå¦‚æœæŸä¸ªåŒºé—´çš„startå¤§äºå †é¡¶çš„ç»“æŸæ—¶é—´ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªä¼šè®®å¯ä»¥å…¬ç”¨ä¸€ä¸ªä¼šè®®å®¤ï¼Œæ‰€ä»¥å°†å †é¡¶å¼¹å‡ºï¼Œç„¶åå°†å½“å‰ä¼šè®®åŠ å…¥å †ä¸­ï¼Œæ‰€ä»¥æœ€åå †çš„å¤§å°å°±æ˜¯ä¼šè®®å®¤çš„æ•°é‡\n```java\n//å°æ ¹å †çš„æ€è·¯\npublic int minMeetingRooms(List<Interval> intervals) {\n    // Write your code here\n    Collections.sort(intervals,(i1,i2)->i1.start-i2.start);\n    PriorityQueue<Integer> pq = new PriorityQueue<>();\n    pq.add(intervals.get(0).end);\n    for (int i = 1; i < intervals.size(); i++) {\n        if (intervals.get(i).start > pq.peek()) {\n            pq.poll();\n        }\n        pq.add(intervals.get(i).end);\n    }\n    return pq.size();\n}\n```\nä¸ªäººæ„Ÿè§‰è¿™ä¸ªæ€è·¯è¿˜æ˜¯æ²¡æœ‰ä¸Šé¢æ‰«æçº¿ç®€å•å¥½ç†è§£\n\n## [391. æ•°é£æœº(LintCode)](https://www.lintcode.com/problem/number-of-airplanes-in-the-sky/description)\n\nç»™å‡ºé£æœºçš„èµ·é£å’Œé™è½æ—¶é—´çš„åˆ—è¡¨ï¼Œç”¨åºåˆ— interval è¡¨ç¤º. è¯·è®¡ç®—å‡ºå¤©ä¸ŠåŒæ—¶æœ€å¤šæœ‰å¤šå°‘æ¶é£æœºï¼Ÿ\n\n**æ ·ä¾‹ 1:**\n```go\nè¾“å…¥: [(1, 10), (2, 3), (5, 8), (4, 7)]\nè¾“å‡º: 3\nè§£é‡Š: \nç¬¬ä¸€æ¶é£æœºåœ¨1æ—¶åˆ»èµ·é£, 10æ—¶åˆ»é™è½.\nç¬¬äºŒæ¶é£æœºåœ¨2æ—¶åˆ»èµ·é£, 3æ—¶åˆ»é™è½.\nç¬¬ä¸‰æ¶é£æœºåœ¨5æ—¶åˆ»èµ·é£, 8æ—¶åˆ»é™è½.\nç¬¬å››æ¶é£æœºåœ¨4æ—¶åˆ»èµ·é£, 7æ—¶åˆ»é™è½.\nåœ¨5æ—¶åˆ»åˆ°6æ—¶åˆ»ä¹‹é—´, å¤©ç©ºä¸­æœ‰ä¸‰æ¶é£æœº.\n```\n**æ ·ä¾‹ 2:**\n```go\nè¾“å…¥: [(1, 2), (2, 3), (3, 4)]\nè¾“å‡º: 1\nè§£é‡Š: é™è½ä¼˜å…ˆäºèµ·é£.\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¼šè®®å®¤ä¸€æ‘¸ä¸€æ ·ï¼Œä»£ç ç¨å¾®æ”¹åŠ¨ä¸€ç‚¹ï¼Œæ’åºè§„åˆ™éœ€è¦éµå¾ªé™è½æœ‰é™\n```golang\n/**\n * Definition of Interval:\n * type Interval struct {\n *     Start, End int\n * }\n */\n\n/**\n * @param airplanes: An interval array\n * @return: Count of airplanes are in the sky.\n */\nimport \"sort\"\n\ntype Pair struct {\n    time  int\n    isEnd bool\n}\n\nfunc countOfAirplanes(airplanes []*Interval) int {\n    var n = len(airplanes)\n    var list []*Pair\n    var Max = func(a, b int) int {\n        if a > b {\n            return a\n        }\n        return b\n    }\n    for i := 0; i < n; i++ {\n        list = append(list, &Pair{airplanes[i].Start, false})\n        list = append(list, &Pair{airplanes[i].End, true})\n    }\n    //[(1, 2), (2, 3), (3, 4)]\n    //éšæ„æ’åºï¼š 1 2start 2end 3start 3end 4 è¿™æ ·æœ€å¤§å€¼å°±æ˜¯2ï¼Œä¸å¯¹\n    //æ‰€ä»¥åº”è¯¥é™è½ä¼˜å…ˆï¼Œå°†é™è½æ—¶é—´ç‚¹çš„æ’åœ¨å‰é¢\n    sort.Slice(list, func(i int, j int) bool {\n        if list[i].time == list[j].time {\n            //å°†endæ”¾åœ¨å‰é¢\n            return list[i].isEnd\n        }\n        return list[i].time < list[j].time\n    })\n    var res = 0\n    var count = 0\n    for _, p := range list {\n        if p.isEnd {\n            count--\n        } else {\n            count++\n        }\n        res = Max(count, res)\n    }\n    return res\n}\n```\nå½“ç„¶åŒæ ·å¯ä»¥ä½¿ç”¨å †ï¼Œè¿™é‡Œå°±ä¸å¤šå†™äº†\n\n## [NC531.é€’å¢æ•°ç»„](https://www.nowcoder.com/practice/d0907f3982874b489edde5071c96754a)\n\nç‰›ç‰›æœ‰ä¸€ä¸ªæ•°ç»„arrayï¼Œç‰›ç‰›å¯ä»¥æ¯æ¬¡é€‰æ‹©ä¸€ä¸ªè¿ç»­çš„åŒºé—´ï¼Œè®©åŒºé—´çš„æ•°éƒ½åŠ 1ï¼Œä»–æƒ³çŸ¥é“æŠŠè¿™ä¸ªæ•°ç»„å˜ä¸ºä¸¥æ ¼å•è°ƒé€’å¢ï¼Œæœ€å°‘éœ€è¦æ“ä½œå¤šå°‘æ¬¡ï¼Ÿ\n- 1 <= array.size <= 2*10^5\n- 1 <= array[i] <= 1*10^9\n\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥: [1,2,1]\nè¾“å‡º: 2\nè¯´æ˜: æŠŠç¬¬ä¸‰ä¸ªæ•°å­—+2å¯ä»¥æ„æˆ1ï¼Œ2ï¼Œ3\n```\n**è§£æ³•ä¸€**\n\n```java\npublic long IncreasingArray (int[] array) {\n    // write code here\n    long res = 0;\n    for (int i = 1; i < array.length; i++){\n        if (array[i] <= array[i-1]) {\n            res += array[i-1]-array[i]+1;\n        }\n    }\n    return res;\n}\n```\nè™½ç„¶æ˜¯easyï¼Œè¿˜æ˜¯æƒ³äº†ä¸€ä¼šå„¿ï¼Œæˆ‘çš„æƒ³æ³•å°±æ˜¯å½“å¢åŠ ä¸€ä¸ªæ•°çš„æ—¶å€™å°±è¿åŒ**åé¢çš„æ‰€æœ‰æ•°**ä¸€èµ·å¢åŠ ï¼Œè€Œå¢åŠ ä¸€ä¸ªæ•°è‚¯å®šæ˜¯å¢åŠ åˆ°å‰ä¸€ä¸ªæ•°+1çš„æ¬¡æ•°æ˜¯æœ€å°‘çš„ï¼ˆå½“ç„¶æˆ‘ä»¬ä¹Ÿä¸ç”¨çœŸçš„å»åŠ ï¼Œå› ä¸ºåé¢çš„åŒºé—´æ˜¯æ•´ä½“++ï¼Œè€Œæˆ‘ä»¬è¦æ±‚çš„æ“ä½œæ¬¡æ•°åªæ˜¯ä¸ªå·®å€¼ï¼‰\nå…¶å®å¾ˆè¯¦ç»†çš„è¯æ˜æˆ‘ä¹Ÿç»™ä¸å‡ºæ¥ï¼Œæˆ‘åªè€ƒè™‘äº†å‡ ç§æƒ…å†µ\n1. `i`åé¢çš„éƒ¨åˆ†æ˜¯å•è°ƒé€’å¢çš„ 3 1(i)  2  3ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™é‡Œå’Œåé¢ä¸€èµ·å¢åŠ æ˜¯æœ€ä¼˜é€‰æ‹©\n2. `i`åé¢æ˜¯éƒ¨åˆ†æ˜¯å•è°ƒé€’å‡çš„ 3 3(i)  2  1ï¼Œé‚£ä¹ˆåŒæ ·ï¼Œå’Œåé¢çš„ä¸€èµ·å¢åŠ æ˜¯æœ€ä¼˜é€‰æ‹©ï¼Œå•ç‹¬é€‰æ‹©æŸä¸€ä¸ªåŒºé—´éƒ½ä¼šå¯¼è‡´æ•´ä½“çš„è½å·®å˜å¤§ï¼Œä½¿å¾—åé¢æ²¡å¢åŠ çš„éƒ¨åˆ†éœ€è¦å¢åŠ çš„æ¬¡æ•°å¢åŠ \n3. `i`åé¢å…ˆé€’å¢åé€’å‡ 3 1(i)  2  1 åŒä¸Š ç›¸å½“äº é€’å¢+é€’å‡ çœ‹åšä¸¤éƒ¨åˆ†ï¼Œï¼ˆ1 2ï¼‰åŒå¢ï¼Œé‚£ä¹ˆï¼ˆ2ï¼Œ1ï¼‰ä¹Ÿåº”è¯¥éšä¹‹åŒå¢\n4. `i`åé¢å…ˆé€’å‡åé€’å¢ 5 4(i) 3 5  é€’å‡+é€’å¢ ä¹Ÿåˆ†æˆä¸¤éƒ¨åˆ†\n\n## [738. å•è°ƒé€’å¢çš„æ•°å­—](https://leetcode-cn.com/problems/monotone-increasing-digits/)\n\nDifficulty: **ä¸­ç­‰**\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°&amp;nbsp;<code>N</code>ï¼Œæ‰¾å‡ºå°äºæˆ–ç­‰äº&amp;nbsp;<code>N</code>&amp;nbsp;çš„æœ€å¤§çš„æ•´æ•°ï¼ŒåŒæ—¶è¿™ä¸ªæ•´æ•°éœ€è¦æ»¡è¶³å…¶å„ä¸ªä½æ•°ä¸Šçš„æ•°å­—æ˜¯å•è°ƒé€’å¢ã€‚</p>\n\n<p>ï¼ˆå½“ä¸”ä»…å½“æ¯ä¸ªç›¸é‚»ä½æ•°ä¸Šçš„æ•°å­—&amp;nbsp;<code>x</code>&amp;nbsp;å’Œ&amp;nbsp;<code>y</code>&amp;nbsp;æ»¡è¶³&amp;nbsp;<code>x &amp;lt;= y</code>&amp;nbsp;æ—¶ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ•´æ•°æ˜¯å•è°ƒé€’å¢çš„ã€‚ï¼‰</p>\n\n<p>\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°Â `N`ï¼Œæ‰¾å‡ºå°äºæˆ–ç­‰äºÂ `N`Â çš„æœ€å¤§çš„æ•´æ•°ï¼ŒåŒæ—¶è¿™ä¸ªæ•´æ•°éœ€è¦æ»¡è¶³å…¶å„ä¸ªä½æ•°ä¸Šçš„æ•°å­—æ˜¯å•è°ƒé€’å¢ã€‚\n\nï¼ˆå½“ä¸”ä»…å½“æ¯ä¸ªç›¸é‚»ä½æ•°ä¸Šçš„æ•°å­—Â `x`Â å’ŒÂ `y`Â æ»¡è¶³Â `x <= y`Â æ—¶ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ•´æ•°æ˜¯å•è°ƒé€’å¢çš„ã€‚ï¼‰\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: N = 10\nè¾“å‡º: 9\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥: N = 1234\nè¾“å‡º: 1234\n```\n\n**ç¤ºä¾‹ 3:**\n\n```go\nè¾“å…¥: N = 332\nè¾“å‡º: 299\n```\n\n**è¯´æ˜:** `N`Â æ˜¯åœ¨Â `[0, 10^9]`Â èŒƒå›´å†…çš„ä¸€ä¸ªæ•´æ•°ã€‚\n\n<strong>ç¤ºä¾‹ 1:</strong></p>\n\n```go\nè¾“å…¥: N = 10\nè¾“å‡º: 9\n```\n\n<p><strong>ç¤ºä¾‹ 2:</strong></p>\n\n```go\nè¾“å…¥: N = 1234\nè¾“å‡º: 1234\n```\n\n<p><strong>ç¤ºä¾‹ 3:</strong></p>\n\n```go\nè¾“å…¥: N = 332\nè¾“å‡º: 299\n```\n\n<p><strong>è¯´æ˜:</strong> Næ˜¯åœ¨<code>[0, 10^9]</code>èŒƒå›´å†…çš„ä¸€ä¸ªæ•´æ•°ã€‚</p>\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å†™äº†å¥½å‡ ç‰ˆï¼Œæ€»æ„Ÿè§‰å¾ˆç®€å•ï¼Œä½†æ˜¯æ€»æ˜¯æœ‰caseèƒ½æŠŠæˆ‘å¡ä½ï¼Œæœ€ç»ˆçš„æ€è·¯å°±æ˜¯ï¼Œ**é€†å‘éå†**è¿™ä¸ªæ•°ï¼Œå¦‚æœæŸä¸ªæ•°å°äºå‰é¢ï¼ˆå·¦è¾¹ï¼‰çš„æ•°ï¼Œé‚£ä¹ˆå°†å‰é¢çš„æ•°å‡ä¸€ï¼Œç„¶åè®°å½•ä¸‹å½“å‰çš„ä¸‹æ ‡ï¼Œæœ€ç»ˆè¿™ä¸ªä¸‹æ ‡åé¢çš„æ•°éƒ½è¦å˜æˆ9\n```golang\n//322 -> 299\n//243 -> 239\n//3524 -> 499\n//332 -> 299\n//235854 235799\nfunc monotoneIncreasingDigits(N int) int {\n    var nums []int\n    //123\n    for N > 0 {\n        nums = append(nums, N%10)\n        N /= 10\n    }\n    var res = 0\n    var idx = -1\n    //213\n    for i := 0; i < len(nums)-1; i++ {\n        if nums[i] < nums[i+1] {\n            idx = i\n            nums[i+1]--\n        }\n    }\n    for i := len(nums) - 1; i >= 0; i-- {\n        if i <= idx {\n            res = res*10 + 9\n        } else {\n            res = res*10 + nums[i]\n        }\n    }\n    return res\n}\n```","tags":["LeetCode","è´ªå¿ƒ"],"categories":["ç®—æ³•"]},{"title":"å¸¸ç”¨çš„ä¸€äº›å·¥å…·å’Œç½‘ç«™","url":"/2019/12/23/wo-chang-yong-de-yi-xie-gong-ju-he-wang-zhan/","content":"\n> æ•´ç†ä¸‹æˆ‘å¸¸ç”¨çš„ä¸€äº›å·¥å…·å’Œç½‘ç«™\n\n## å·¥å…·\n\n### PDFread\n\nä¸€ä¸ªpdfé˜…è¯»å™¨ï¼Œç»¿è‰²è½¯ä»¶ä½“ç§¯å¾ˆå°åªæœ‰10Mï¼Œå¾ˆä¹…ä¹‹å‰åœ¨ä¸€ä¸ªå…¬å…±å·ä¸Šçœ‹è§çš„ï¼Œé“¾æ¥ï¼šhttps://pan.baidu.com/s/15MSlABLZkJHChako1GEGdA\næå–ç ï¼š7a5i \n\n### BandZip\n\nè§£å‹ç¼©çš„è½¯ä»¶ï¼Œæ¯”æŸ`æ•°å­—`å‹ç¼©è½¯ä»¶å¥½ç”¨ï¼Œæ¯”`7z`åŠŸèƒ½å¤šè€Œä¸”å¥½çœ‹(7zä¹Ÿä¸é”™)ï¼ŒæŒºè‰¯å¿ƒçš„ï¼Œè‡³å°‘æ²¡å¹¿å‘Š [å®˜ç½‘ä¸‹è½½åœ°å€](https://www.bandisoft.com/bandizip/)(å¯èƒ½è¢«Q)\n\n### MPic\n\n å›¾åºŠç¥å™¨ï¼Œè´¼æ–¹ä¾¿ï¼Œä¼šæ£€æµ‹å‰ªåˆ‡æ¿é‡Œçš„å›¾ç‰‡åŒ…æ‹¬QQæˆªå›¾ï¼Œè‡ªåŠ¨ä¸Šä¼ ä¸€é”®è·å–å¤–é“¾è´¼çˆ½ï¼Œä¸è¿‡`å¯æƒœ`åªèƒ½é…åˆä¸ƒç‰›äº‘ã€‚[å®˜ç½‘åœ°å€](http://mpic.lzhaofu.cn/)\n\n### Everything\n\næ–‡ä»¶æ£€ç´¢ç¥å™¨ï¼Œé€Ÿåº¦å¾ˆå¿«ä½“ç§¯å¾ˆå°ã€‚[ä¸‹è½½åœ°å€](https://www.voidtools.com/zh-cn/)\n\n### FSCaptrue\n\n æˆªå›¾å·¥å…·ï¼Œæˆªé•¿å±å¾ˆæ–¹ä¾¿ï¼Œä½“ç§¯å¾ˆå°ã€‚[ä¸‹è½½åœ°å€](https://www.appcgn.com/faststone-capture.html)\n\n### Typora\n\n ä¹Ÿæ˜¯æˆ‘ç°åœ¨ç¼–è¾‘è¿™ç¯‡æ–‡ç« ç”¨çš„ç¼–è¾‘å™¨ï¼Œæˆ‘ä¹Ÿæ¢äº†å¾ˆå¤šçš„`markdown`ç¼–è¾‘å™¨ï¼Œæœ€å¼€å§‹çš„_Yu writer_(ä¸€ç›´æ²¡æ›´æ–°ï¼ŒbugæŒºå¤šï¼Œæ›´æ–°åæ”¶è´¹äº†)ï¼Œç„¶å _markeditor_(è¿™ä¸ªè¿˜å¯ä»¥ï¼Œä½†æ˜¯åœ¨winä¸Šç•Œé¢æˆ‘æœ‰ç‚¹çœ‹ä¸ä¹ æƒ¯ã€‚ã€‚2.0ä¸æ”¯æŒwin,è€Œä¸”æ—¶ä¸æ—¶å¼¹çª—æˆæƒ)ï¼Œä¸­é—´è¿˜è¯•è¿‡å¾ˆå¤šåƒä»€ä¹ˆå°ä¹¦åŒ ï¼Œmarkpadï¼Œéƒ½æ˜¯è£…å®Œå°±å¸äº†ã€‚ã€‚ã€‚ç°åœ¨æ¢åˆ°Typora(ä¹‹å‰ä¹Ÿè¯•è¿‡)è¶Šç”¨è¶Šå–œæ¬¢ã€‚\n\n### CCleaner\n\nåƒåœ¾æ¸…ç†è½¯ä»¶ï¼Œæ¸…æ³¨å†Œè¡¨è´¼èˆ’æœæ“ä½œæ¯”è¾ƒç®€å•ï¼Œæ‹’ç»è¾£é¸¡è½¯ä»¶æ®‹ç•™ï¼ˆä¹Ÿæ˜¯ç»¿è½¯ï¼‰ã€‚é“¾æ¥ï¼šhttps://pan.baidu.com/s/1TrOYF2893FYHKjTlQbFykA æå–ç ï¼šql42 \n\n### Dism++\n\nè·Ÿä¸Šé¢çš„ä¸€æ ·ä¹Ÿæ˜¯åƒåœ¾æ¸…ç†è½¯ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªä¸èƒ½çæğŸ˜€  [ä¸‹è½½åœ°å€](https://www.chuyu.me/zh-Hans/index.html)\n\n### SwitchHosts\n\nå¿«é€Ÿä¿®æ”¹hostsæ–‡ä»¶ï¼Œæˆ‘ç”¨è¿™ä¸ªä¸»è¦æ˜¯åšå®¢åœ¨æœ¬åœ°è·‘çš„æ—¶å€™ï¼Œå› ä¸ºå›¾ç‰‡åŠ äº†é˜²ç›—é“¾åŠ è½½ä¸å‡ºæ¥ï¼Œç”¨è¿™ä¸ªæ”¹äº†hostsã€‚\n\n### TeamViewer\n\nè¿œç¨‹å¸®äººè°ƒè¯•ï¼Œæ”¹bugçš„æ—¶å€™ç”¨åˆ°ï¼Œæ¯”QQå¥½ç”¨çš„å¤šï¼ŒQQå¾ˆå¡è€Œä¸”ä¸€äº›å…³é”®æ“ä½œä¸å…è®¸ã€‚\n\n### å¤œç¥æ¨¡æ‹Ÿå™¨\n\nPCç«¯æ¨¡æ‹Ÿå®‰å“æ‰‹æœºï¼Œå¯ä»¥ç”¨æ¥è°ƒè¯•å®‰å“ã€‚\n\n### DeskGo : \n\n[è…¾è®¯æ¡Œé¢æ•´ç†](https://pc.qq.com/detail/5/detail_23125.html)ï¼Œtxéš¾å¾—çš„è‰¯å¿ƒè½¯ä»¶ï¼Œæœ¬æ¥æ˜¯QQå®‰å…¨ç®¡å®¶é‡Œé¢é™„å¸¦çš„ï¼Œåæ¥è¢«å•ç‹¬æå–å‡ºæ¥äº†ï¼Œæ²¡å¹¿å‘Šï¼Œæ²¡æ†ç»‘ï¼Œå ç”¨å°ï¼ˆå‡ åMï¼‰ã€‚\n\n![mark](http://static.imlgw.top///20190414/Ch6k6LNP3CU2.png?imageslim)\n\n### æ²¹çŒ´ï¼š \n\n`tampermonkey`è¿™ä¸ªæ˜¯è¦é…åˆæµè§ˆå™¨æ¥ä½¿ç”¨çš„(è°·æ­Œæˆ–è€…æé€Ÿ360å§)ï¼Œå¦‚æœå¯ä»¥ç§‘å­¦ä¸Šç½‘çš„è¯ç›´æ¥å¼•ç”¨å•†åŸå°±æœå¾—åˆ°\n\n![mark](http://static.imlgw.top///20190414/5ioOotVWEqJO.png?imageslim)\n\nå®ƒçš„éªšæ“ä½œå¯å¤ªå¤šäº†ï¼š) [å³è½¬biä¹](https://zhuanlan.zhihu.com/p/32155254)![mark](http://static.imlgw.top///20190414/QIORRorFVAah.png?imageslim)\n\n\n\næ²¡æ³•ç§‘å­¦ä¸Šç½‘å¯ä»¥å»[è¿™é‡Œ](http://chromecj.com/web-development/2018-07/1468/download.html)ä¸‹è½½\n\n###  å¤©è‹¥OCR\n\nä¹Ÿæ˜¯å¾ˆè‰¯å¿ƒçš„è½¯ä»¶ï¼Œæ²¡å¹¿å‘Šï¼Œç»¿è½¯ï¼Œä½“ç§¯å°ï¼Œ5Mï¼Œè¯†åˆ«å‡†ç¡®åº¦ä¹ŸæŒºå¥½çš„ã€‚\n\né“¾æ¥ï¼šhttps://pan.baidu.com/s/198PUMdtLU-huU5U1oN9tMw \næå–ç ï¼švces \n\n### å¾®è½¯è¾“å…¥æ³•\n\nwin10å¹³å°ä¸Šæœ€å¥½çš„è¾“å…¥æ³•æ²¡æœ‰ä¹‹ä¸€ï¼ˆGoogleè¾“å…¥æ³•å¥½åƒä¹Ÿå¯ä»¥ï¼‰ï¼Œåˆ«ç”¨åƒåœ¾sgï¼Œå‰å‡ å¤©[ç¤¾åŒº](https://answers.microsoft.com/zh-hans/windows/forum/windows_10-update/systemserviceexception%E8%93%9D%E5%B1%8F/e5c0a131-a155-4cc0-a871-b6089d474313?rtAction=1553553854556)çœ‹åˆ°æœ‰äººæ›´æ–°win10å› ä¸ºsgå´©æºƒäº†ã€‚æµæ°“è½¯ä»¶è´¼ä»–å¦ˆéš¾å¸è½½ï¼Œç»å†è¿‡çš„äººéƒ½çŸ¥é“ã€‚æƒ³ä¸é€šä¸ºå•¥ä¸ç”¨åŸç”Ÿçš„è¾“å…¥æ³•ï¼Ÿ\n\n### PotPlayer\n\næœ€å¥½ç”¨ï¼Œæ— å¹¿å‘Šï¼Œé¡µé¢ç®€æ´ï¼Œå¼ºå¤§çš„è§£ç å™¨ï¼Œèƒ½æ’­æ”¾æ‰€æœ‰è§†é¢‘çš„æ’­æ”¾å™¨ã€‚ï¼ˆå‰èº«æ˜¯KMPlayerï¼‰å ç”¨å°ï¼Œ(å¾®è½¯è‡ªå¸¦çš„é‚£ä¸ªä¸èƒ½å€æ•°æ’­æ”¾ã€‚ã€‚ã€‚ä¸ç„¶æˆ‘ä¹Ÿä¸ä¼šç”¨è¿™ä¸ª)\n\n### MobaXterm\n\n(19-5-2)ç‚’é¸¡å¥½ç”¨çš„SSHå®¢æˆ·ç«¯ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œç•Œé¢å¥½çœ‹ï¼Œä¹Ÿæ˜¯ä¸ªç»¿è½¯ï¼Œå†ä¹Ÿä¸ç”¨åˆ°å¤„æ‰¾Xshellçš„æ³¨å†Œç äº†ï¼ˆè€Œä¸”æˆ‘ä¹Ÿä¸å–œæ¬¢Xshellï¼Œæˆ‘ä¸€ç›´ç”¨çš„putty+winscpï¼Œç°åœ¨å‘ç°è¿™ä¸ªå¯ä»¥ç›´æ¥ç»“åˆputtyå’ŒsinscpğŸ‘ï¼‰\n\n![mark](http://static.imlgw.top///20190502/rKdNPEwUmstf.png?imageslim)\n\n### Multrin\n\ngithubä¸Šå¶ç„¶å‘ç°çš„ä¸€ä¸ª [å°é¡¹ç›®](https://github.com/sentialx/multrin) ï¼Œå°†æ‰€æœ‰çš„tabèšåˆåˆ°ä¸€èµ·è®©åæä¾›ä¸€ä¸ªå¿«æ·é”®å¿«é€Ÿåˆ‡æ¢ï¼ŒæŒºä¸é”™çš„ã€‚\n\nç›¸æ¯”**alt+tab**ï¼Œè¿™ä¸ªè½¯ä»¶çš„ä¼˜åŠ¿å°±æ˜¯ä¼šè®©æ¡Œé¢æ˜¾å¾—æ›´åŠ æ•´æ´\n\n### [UTools](https://u.tools/)\n\nä¹Ÿæ˜¯æŒºä¸é”™çš„ä¸€æ¬¾å·¥å…·ï¼Œä¸€å¼€å§‹æ„Ÿè§‰å ç”¨æ¯”è¾ƒå¤§ï¼Œåæ¥æƒ³æƒ³å…¶å®æ²¡å•¥å½±å“ï¼Œç„¶åç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰ä¸€ä¸ªå›¾åºŠçš„æ’ä»¶ç›¸å½“æ–¹ä¾¿å•Šï¼\n\n### Navicat\n\nä¸ç”¨å¤šè¯´äº†å§\n\né“¾æ¥ï¼šhttps://pan.baidu.com/s/1L7XgRnLAinUcAqx6oeNt0w \næå–ç ï¼š9z54 \n\n## ç½‘ç«™\n\n### [æ”¹å›¾å®](http://www.gaitubao.com/#) \n\næœ€å¼€å§‹æ—¶ä¸ºäº†è£å‰ªå›¾ç‰‡ï¼Œåæ¥å‘ç°è¿˜å¯ä»¥æŒ‰ç…§ æŒ‡å®šå¤§å°å‹ç¼©å›¾ç‰‡ï¼Œä¹Ÿæ˜¯ä¸ªç¥å™¨å•Š~\n\n### [CodeToImage](https://carbon.now.sh) \n\nå¯ä»¥æŠŠä»£ç ç¾åŒ–ä¸ºå¥½çœ‹çš„å›¾ç‰‡ç„¶åå¯¼å‡º\n\n![c](http://static.imlgw.top///20190407/sAP81lBQEv3Q.png?imageslim)\n\n### [draw.io](https://www.draw.io/) \n\nåœ¨çº¿ç”»å›¾å·¥å…·ï¼Œè°ç”¨è°çŸ¥é“ï¼Œç°åœ¨æœ‰ç¦»çº¿ç‰ˆæœ¬çš„äº†\n\n### [åœ¨çº¿å…è´¹æŠ å›¾](https://www.gaoding.com/koutu)\n\n å¾ˆæ–¹ä¾¿æ“ä½œä¹Ÿå¾ˆç®€å•\n\n### [é«˜æ¸…å›¾ç‰‡ç´ æ](https://alpha.wallhaven.cc/)\n\n  å…è´¹ï¼Œé«˜æ¸…ï¼Œç´ æå¤šï¼Œç”¨æ¥åšå£çº¸ä»€ä¹ˆçš„éƒ½æŒºä¸é”™\n\n### [unsplash](https://unsplash.com)\n\n ä¹Ÿæ˜¯å›¾ç‰‡ç´ æç«™\n\n### [img9æ— é™å›¾åºŠ](https://img9.top)\n\n  æˆ‘ç°åœ¨éƒ½æ˜¯ç”¨çš„ä¸ƒç‰›äº‘ï¼Œç¬¬ä¸‰æ–¹çš„è¿˜æ˜¯ä¸æ”¾å¿ƒï¼ˆç›®å‰è¿˜æ­£å¸¸ï¼Œæˆ‘åšå®¢çš„å‰å‡ ç¯‡éƒ½æ˜¯åœ¨è¿™ä¸ªä¸Šé¢ï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ `å¾®åš` ä¹Ÿæ˜¯ä¸ªå¥½å›¾åºŠï¼Œ\n\n### [SM.MS](https://sm.ms)\n\n ä¹Ÿæ˜¯å›¾åºŠï¼Œæ¯”ä¸Šé¢é‚£ä¸ªæ›´ä¸“ä¸šï¼Œæœ‰api\n\n> åç»­å¦‚æœè¿˜æœ‰å¥½çš„å·¥å…·å’Œç½‘ç«™ä¼šç»§ç»­æ·»åŠ è¿›æ¥ ğŸ˜€","tags":["å·¥å…·"],"categories":["å·¥å…·"]},{"title":"å­—å…¸æ ‘åˆæ¢","url":"/2019/12/17/zi-dian-shu/","content":"\n## å­—å…¸æ ‘\n\nåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ**trie**ï¼Œåˆç§°**å‰ç¼€æ ‘**æˆ–**å­—å…¸æ ‘**ï¼Œå­—å…¸æ ‘è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œæ‰€ä»¥æ•°æ®ç»“æ„æœ¬èº«æ¯”è¾ƒæ¶ˆè€—ç©ºé—´ã€‚ä½†å®ƒåˆ©ç”¨äº†å­—ç¬¦ä¸²çš„**å…±åŒå‰ç¼€ï¼ˆCommon Prefixï¼‰**ä½œä¸ºå­˜å‚¨ä¾æ®ï¼Œä»¥æ­¤æ¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå¹¶åŠ é€Ÿæœç´¢æ—¶é—´ã€‚Trie çš„å­—ç¬¦ä¸²æœç´¢æ—¶é—´å¤æ‚åº¦ä¸º **O(m)**ï¼Œm ä¸ºæœ€é•¿çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå…¶æŸ¥è¯¢æ€§èƒ½ä¸é›†åˆä¸­çš„å­—ç¬¦ä¸²çš„æ•°é‡æ— å…³ã€‚å…¶åœ¨æœç´¢å­—ç¬¦ä¸²æ—¶è¡¨ç°å‡ºçš„é«˜æ•ˆï¼Œä½¿å¾—ç‰¹åˆ«é€‚ç”¨äºæ„å»ºæ–‡æœ¬æœç´¢å’Œè¯é¢‘ç»Ÿè®¡ç­‰åº”ç”¨\n\n### æ€§è´¨\n\nä¸äºŒåˆ†æœç´¢æ ‘ä¸åŒï¼Œ**é”®ä¸æ˜¯ç›´æ¥ä¿å­˜åœ¨èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯ç”±èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®å†³å®š**ã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­å­™éƒ½æœ‰ç›¸åŒçš„å‰ç¼€ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè€Œæ ¹èŠ‚ç‚¹å¯¹åº”ç©ºå­—ç¬¦ä¸²ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„å€¼ï¼Œåªæœ‰**å¶å­èŠ‚ç‚¹**å’Œéƒ¨åˆ†å†…éƒ¨èŠ‚ç‚¹æ‰€å¯¹åº”çš„é”®æ‰æœ‰ç›¸å…³çš„å€¼\n\n## å®ç°\n\n### ä½¿ç”¨TreeMapå®ç°\n\n```java\nimport java.util.*;\npublic class Trie{\n    private class Node{\n        public boolean isWord; //æ˜¯å¦æ˜¯ä¸€ä¸ªå®Œæ•´å•è¯\n        public TreeMap<Character,Node> next;\n\n        public Node(boolean isWord){\n            this.isWord = isWord;\n            next = new TreeMap<>();\n        }\n\n        public Node(){\n            this(false);\n        }\n    }\n\n    private Node root;\n\n    private int size;\n\n    public Trie(){\n        root=new Node();\n        size=0;\n    }\n\n    public int getSize(){\n        return size;\n    }\n\n    //å‘Trieä¸­æ·»åŠ word\n    public void addLoop(String word){\n        Node cur=root;\n        for (int i=0;i<word.length();i++) {\n            char c=word.charAt(i);\n            if (cur.next.get(c)==null) {\n                cur.next.put(c,new Node());\n            }\n            cur=cur.next.get(c);\n        }\n        if (!cur.isWord) {\n            size++;\n            cur.isWord=true;\n        }\n    }\n\n    //é€’å½’çš„æ·»åŠ \n    public void add(String word){\n        add(root,word,0);\n    }\n\n    public void add(Node cur,String word,int index){\n        if (index==word.length()) {\n            if (!cur.isWord) {\n                size++;\n                cur.isWord=true;\n            }\n            return;\n        }\n        char c=word.charAt(index);\n        if (cur.next.get(c)==null) {\n            cur.next.put(c,new Node());\n        }\n        add(cur.next.get(c),word,index+1); //å°¾é€’å½’\n    }\n\n    //æŸ¥è¯¢wordæ˜¯å¦åœ¨Trieä¸­\n    public boolean contains(String word){\n        return contains(root,word,0);\n    }\n\n    public boolean contains(Node cur,String word,int index){\n        if (index==word.length()) {\n            return cur.isWord;\n        }\n        char c=word.charAt(index);\n        return cur.next.containsKey(c) && contains(cur.next.get(c),word,index+1);\n    }\n\n    //å¾ªç¯\n    public boolean containsLoop(String word){\n        Node cur=root;\n        for (int i=0;i<word.length();i++) {\n            Character c=word.charAt(i);\n            if (!cur.next.containsKey(c)) {\n                return false;   \n            }\n            cur=cur.next.get(c);\n        }\n        return cur.isWord;\n    }\n\n    //æ˜¯å¦æœ‰æŸä¸ªå‰ç¼€\n    public boolean hasPerfix(String perfix){\n        return hasPerfix(root,perfix,0);\n    }\n\n    public boolean hasPerfix(Node cur,String perfix,int index){\n        if (index==perfix.length()) {\n            return true;\n        }\n        char c=perfix.charAt(index);\n        return cur.next.containsKey(c) && hasPerfix(cur.next.get(c),perfix,index+1);\n    }\n\n    //æ‡’å¾—å†™å¾ªç¯äº†ã€‚ã€‚ã€‚\n}\n```\n\næ•´ä½“ä¸Šæ¥è¯´å…¶å®å¾ˆç®€å•ï¼Œè¿™é‡Œç”¨çš„æ˜¯TreeMapæ¥å­˜å‚¨å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€å±‚èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨Nodeä¸­å¹¶æ²¡æœ‰ç›´æ¥å­˜å‚¨æŸä¸ªå­—ç¬¦ï¼Œè€Œæ˜¯å¯¹åº”äº†TreeMapçš„Keyï¼Œä½†æ˜¯ç”±äºTreeMapåº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œå…¶å®åœ¨æ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™å¹¶æ²¡æœ‰ä¼˜åŠ¿ï¼Œæ‰€ä»¥åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨èŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸‹é¢è¿™é“é¢˜\n\n## LeetCodeç»ƒæ‰‹ä¾‹é¢˜\n\n### [208. å®ç° Trie (å‰ç¼€æ ‘)](https://leetcode-cn.com/problems/implement-trie-prefix-tree/)\n\nå®ç°ä¸€ä¸ª Trie (å‰ç¼€æ ‘)ï¼ŒåŒ…å« insert, search, å’Œ startsWith è¿™ä¸‰ä¸ªæ“ä½œã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nTrie trie = new Trie();\n\ntrie.insert(\"apple\");\ntrie.search(\"apple\");   // è¿”å› true\ntrie.search(\"app\");     // è¿”å› false\ntrie.startsWith(\"app\"); // è¿”å› true\ntrie.insert(\"app\");   \ntrie.search(\"app\");     // è¿”å› true\n```\n\n**è¯´æ˜:**\n\n- ä½ å¯ä»¥å‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯ç”±å°å†™å­—æ¯ a-z æ„æˆçš„ã€‚\n- ä¿è¯æ‰€æœ‰è¾“å…¥å‡ä¸ºéç©ºå­—ç¬¦ä¸²\n\n**è§£æ³•ä¸€**\n\n```java\nclass Trie {\n    private class Node{\n        public boolean isWord; //æ˜¯å¦æ˜¯ä¸€ä¸ªå®Œæ•´å•è¯\n        public Node[] next;\n\n        public Node(boolean isWord){\n            this.isWord = isWord;\n            next = new Node[26];\n        }\n\n        public Node(){\n            this(false);\n        }\n    }\n\n    private Node root;\n\n    /** Initialize your data structure here. */\n    public Trie() {\n        root=new Node();\n    }\n    \n    /** Inserts a word into the trie. */\n    public void insert(String word) {\n        insert(root,word,0);\n    }\n    \n    public void insert(Node cur,String word,int index){\n        if (index==word.length()) {\n            if (!cur.isWord) {\n                cur.isWord=true;\n            }\n            return;\n        }\n        char c=word.charAt(index);\n        if (cur.next[c-'a']==null) {\n            cur.next[c-'a']=new Node();\n        }\n        insert(cur.next[c-'a'],word,index+1); //å°¾é€’å½’\n    }\n\n    /** Returns if the word is in the trie. */\n    public boolean search(String word) {\n        return search(root,word,0);\n    }\n    \n    public boolean search(Node cur,String word,int index){\n        if (index==word.length()) {\n            return cur.isWord;\n        }\n        char c=word.charAt(index);\n        return cur.next[c-'a']!=null&& search(cur.next[c-'a'],word,index+1);\n    }\n    /** Returns if there is any word in the trie that starts with the given prefix. */\n    public boolean startsWith(String prefix) {\n        return startsWith(root,prefix,0);\n    }\n    \n    public boolean startsWith(Node cur,String prefix,int index){\n        if (index==prefix.length()) {\n            return true;\n        }\n        char c=prefix.charAt(index);\n        return cur.next[c-'a']!=null && startsWith(cur.next[c-'a'],prefix,index+1);\n    }\n}\n\n/**\n * Your Trie object will be instantiated and called as such:\n * Trie obj = new Trie();\n * obj.insert(word);\n * boolean param_2 = obj.search(word);\n * boolean param_3 = obj.startsWith(prefix);\n */\n```\n\nè¿™é‡Œé¢˜ç›®è¯´æ˜äº†æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯å°å†™å­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨å›ºå®šå¤§å°çš„Nodeæ•°ç»„æ¥å®ç°ï¼Œç›¸æ¯”äºä¸Šé¢çš„TreeMapæ—¶é—´ç©ºé—´ä¸Šéƒ½ä¼šæœ‰å¾ˆå¤§çš„æå‡\n\n### [211. æ·»åŠ ä¸æœç´¢å•è¯ - æ•°æ®ç»“æ„è®¾è®¡](https://leetcode-cn.com/problems/add-and-search-word-data-structure-design/)\n\nè®¾è®¡ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œçš„æ•°æ®ç»“æ„ï¼š\n\n```java\nvoid addWord(word)\nbool search(word)\n```\n\n`search(word)` å¯ä»¥æœç´¢æ–‡å­—æˆ–æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²åªåŒ…å«å­—æ¯ . æˆ– a-z ã€‚ `.` å¯ä»¥è¡¨ç¤ºä»»ä½•ä¸€ä¸ªå­—æ¯ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\naddWord(\"bad\")\naddWord(\"dad\")\naddWord(\"mad\")\nsearch(\"pad\") -> false\nsearch(\"bad\") -> true\nsearch(\".ad\") -> true\nsearch(\"b..\") -> true\n```\n\n\n**è¯´æ˜:**\n\nä½ å¯ä»¥å‡è®¾æ‰€æœ‰å•è¯éƒ½æ˜¯ç”±å°å†™å­—æ¯ `a-z` ç»„æˆçš„ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\nprivate class Node{\n    public boolean isWord; //æ˜¯å¦æ‰¾åˆ°äº†ä¸€ä¸ªå•è¯\n    public Node[] next;\n\n    public Node(boolean isWord){\n        this.isWord = isWord;\n        next = new Node[26];\n    }\n\n    public Node(){\n        this(false);\n    }\n}\n\nprivate Node root;\n\n/** Initialize your data structure here. */\npublic WordDictionary() {\n    root=new Node();\n}\n\n/** Adds a word into the data structure. */\npublic void addWord(String word) {\n    addWord(root,word,0);\n}\n\npublic void addWord(Node cur,String word,int index) {\n    if (index == word.length()) {\n        cur.isWord=true;\n        return;\n    }\n    char c=word.charAt(index);\n    if (cur.next[c-'a']==null) {\n        cur.next[c-'a']= new Node();\n    }\n    addWord(cur.next[c-'a'],word,index+1);\n}\n\n/** Returns if the word is in the data structure. A word could contain the dot character '.' to represent any one letter. */\npublic boolean search(String word) {\n    return search(root,word,0);\n}\n\npublic boolean search(Node cur,String word,int index) {\n    if (index == word.length()) {\n        return cur.isWord;\n    }\n    char c=word.charAt(index);\n    if (c=='.') {\n        for (int i=0;i<cur.next.length;i++) {\n            if(cur.next[i]!=null && search(cur.next[i],word,index+1)){\n                return true;\n            }\n        }\n        return false;\n    }\n    return cur.next[c-'a']!=null && search(cur.next[c-'a'],word,index+1);\n}\n```\næ²¡å•¥å¥½è¯´çš„ï¼Œé‡åˆ°ç‚¹å°±å¾ªç¯åˆ¤æ–­æ¯ä¸ªå­èŠ‚ç‚¹å°±ok\n\n### [677. é”®å€¼æ˜ å°„](https://leetcode-cn.com/problems/map-sum-pairs/)\n\nå®ç°ä¸€ä¸ª MapSum ç±»é‡Œçš„ä¸¤ä¸ªæ–¹æ³•ï¼Œ`insert` å’Œ `sum`ã€‚\n\nå¯¹äºæ–¹æ³• `insert`ï¼Œä½ å°†å¾—åˆ°ä¸€å¯¹ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•´æ•°ï¼‰çš„é”®å€¼å¯¹ã€‚å­—ç¬¦ä¸²è¡¨ç¤ºé”®ï¼Œæ•´æ•°è¡¨ç¤ºå€¼ã€‚å¦‚æœé”®å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆåŸæ¥çš„é”®å€¼å¯¹å°†è¢«æ›¿ä»£æˆæ–°çš„é”®å€¼å¯¹ã€‚\n\nå¯¹äºæ–¹æ³• sumï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºå‰ç¼€çš„å­—ç¬¦ä¸²ï¼Œä½ éœ€è¦è¿”å›æ‰€æœ‰ä»¥è¯¥å‰ç¼€å¼€å¤´çš„é”®çš„å€¼çš„æ€»å’Œã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: insert(\"apple\", 3), è¾“å‡º: Null\nè¾“å…¥: sum(\"ap\"), è¾“å‡º: 3\nè¾“å…¥: insert(\"app\", 2), è¾“å‡º: Null\nè¾“å…¥: sum(\"ap\"), è¾“å‡º: 5\n```\n\n**è§£æ³•ä¸€**\n\næœ‰äº†å‰é¢çš„é“ºå«ï¼Œå…¶å®è¿™ä¸ªä¹Ÿå¾ˆç®€å•\n\n```java\nclass MapSum {\n\n    private class Node{\n        public boolean isWord; //æ˜¯å¦æ‰¾åˆ°äº†ä¸€ä¸ªå•è¯\n        public Node[] next;\n        public int value;\n\n        public Node(boolean isWord,int value){\n            this.isWord = isWord;\n            this.value=value;\n            next = new Node[26];\n        }\n\n        public Node(int value){\n            this(false,value);\n        }\n    }\n    \n    private Node root;\n\n    public MapSum() {\n        root=new Node(0);\n    }\n    \n    public void insert(String key, int val) {\n        insert(root,key,val,0);\n    }\n\n    //a p p l e\n    public void insert(Node cur,String key, int val,int index) {\n        if (index==key.length()) {\n            cur.isWord=true;\n            cur.value=val;\n            return;\n        }\n        char c=key.charAt(index);\n        if (cur.next[c-'a']==null) {\n            cur.next[c-'a']=new Node(0);\n        }\n        insert(cur.next[c-'a'],key,val,index+1);\n    }\n    \n    public int sum(String prefix) {\n        return sum(root,prefix,0);\n    }\n\n    public int sum(Node cur,String prefix,int index) {\n        if (index == prefix.length()) {\n            return tireSum(cur);\n        }\n        char c=prefix.charAt(index);\n        if (cur.next[c-'a']==null) {\n        \treturn 0;\n        }\n        return sum(cur.next[c-'a'],prefix,index+1);\n    }\n\n    public int tireSum(Node cur){\n    \tint sum=0;\n    \tif (cur.isWord) {\n    \t\tsum+=cur.value;\n    \t}\n    \tfor (int i=0;i<26;i++) {\n    \t\tsum+=cur.next[i]!=null?tireSum(cur.next[i]):0;\n    \t}\n    \treturn sum;\n    }\n}\n```\n\nè¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·ï¼Œåˆ©ç”¨å‰ç¼€æ ‘ï¼Œä¸è¿‡è¦åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šåšä¸€äº›æ”¹åŠ¨æ·»åŠ ä¸€ä¸ªvalueå­—æ®µç”¨æ¥ä¿å­˜å€¼ï¼Œå…ˆåœ¨æ ‘ä¸­æ‰¾åˆ°è¦æ±‚çš„å‰ç¼€çš„æœ€åä¸€ä¸ªå•è¯æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œç„¶åå°±ç›´æ¥æ±‚è¿™ä¸ªèŠ‚ç‚¹æ‰€æœ‰çš„å­èŠ‚ç‚¹ä¸­isWordçš„å•è¯çš„valueç´¯åŠ å’Œå°±okäº†ï¼Œæˆ‘ä¸Šé¢çš„å®ç°å¹¶ä¸å¥½ï¼Œéƒ½æ˜¯å†™çš„é€’å½’ï¼Œè€Œä¸”æ˜¯å°¾é€’å½’ï¼Œå¾ˆé¸¡è‚‹å…¶å®\n\n### [820. å•è¯çš„å‹ç¼©ç¼–ç ](https://leetcode-cn.com/problems/short-encoding-of-words/)\n\nç»™å®šä¸€ä¸ªå•è¯åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªåˆ—è¡¨ç¼–ç æˆä¸€ä¸ªç´¢å¼•å­—ç¬¦ä¸² S ä¸ä¸€ä¸ªç´¢å¼•åˆ—è¡¨ Aã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœè¿™ä¸ªåˆ—è¡¨æ˜¯ `[\"time\", \"me\", \"bell\"]`ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶è¡¨ç¤ºä¸º S = `\"time#bell#\"` å’Œ `indexes = [0, 2, 5]`ã€‚\n\nå¯¹äºæ¯ä¸€ä¸ªç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»å­—ç¬¦ä¸² S ä¸­ç´¢å¼•çš„ä½ç½®å¼€å§‹è¯»å–å­—ç¬¦ä¸²ï¼Œç›´åˆ° \"#\" ç»“æŸï¼Œæ¥æ¢å¤æˆ‘ä»¬ä¹‹å‰çš„å•è¯åˆ—è¡¨ã€‚\n\né‚£ä¹ˆæˆåŠŸå¯¹ç»™å®šå•è¯åˆ—è¡¨è¿›è¡Œç¼–ç çš„æœ€å°å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥: words = [\"time\", \"me\", \"bell\"]\nè¾“å‡º: 10\nè¯´æ˜: S = \"time#bell#\" ï¼Œ indexes = [0, 2, 5] ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= words.length <= 2000`\n- `1 <= words[i].length <= 7`\n- æ¯ä¸ªå•è¯éƒ½æ˜¯å°å†™å­—æ¯ ã€‚\n\n**è§£æ³•ä¸€**\n\n`2020.3.28` æ‰“å¡é¢˜ï¼Œç®€å•å†™äº†ä¸ªTrieï¼Œçº ç»“äº†åŠå¤©è¦ä¸è¦æ’åº\n\n```java\npublic int res=0;\n\nprivate Node root;\n\npublic int minimumLengthEncoding(String[] words) {\n    root=new Node();\n    //çº ç»“äº†åŠå¤©è¦ä¸è¦æ’åº\n    Arrays.sort(words,(a,b)->b.length()-a.length());\n    for (int i=0;i<words.length;i++) {\n        if(!hasPrefix(words[i])){\n            add(words[i]);\n            res+=(words[i].length()+1);\n        }\n    }\n    return res;\n}\n\nprivate class Node{\n    \n    public Node[] next;\n    \n    public Node(){\n        next = new Node[26];\n    }\n}\n\n//é€’å½’çš„æ·»åŠ \npublic void add(String word){\n    //åç¼€æ ‘\n    add(root,word,word.length()-1);\n}\n\npublic void add(Node cur,String word,int index){\n    if (index==-1) {\n        return;\n    }\n    char c=word.charAt(index);\n    if (cur.next[c-'a']==null) {\n        cur.next[c-'a']=new Node();\n    }\n    add(cur.next[c-'a'],word,index-1); //å°¾é€’å½’\n}\n\npublic boolean hasPrefix(String word){\n    return hasPrefix(root,word,word.length()-1);\n}\n\npublic boolean hasPrefix(Node cur,String word,int index){\n    if(index==-1){\n        return true;\n    }\n    char c=word.charAt(index);\n    return cur.next[c-'a']!=null && hasPrefix(cur.next[c-'a'],word,index-1);\n}\n```\n\n**è§£æ³•äºŒ**\n\nç›´æ¥**é€†åº**åæŒ‰**å­—å…¸åº**æ’åºï¼Œè¿™æ ·å•è¯çš„å‰ç¼€åŒ…å«å…³ç³»å°±æ’å¥½äº†ï¼Œæ¯”å¦‚ time , me, bell, æœ€åå°±ä¼šå˜ä¸º em emit lleb\n\nç„¶åéå†æ‰€æœ‰å•è¯ï¼Œå¦‚æœå‰é¢çš„å•è¯æ˜¯åé¢çš„å‰ç¼€ï¼Œå°±æŠŠå‰é¢çš„å•è¯ä¸¢æ‰ï¼Œå¦åˆ™å°±éœ€è¦åŠ ä¸Šå½“å‰å­—ç¬¦é•¿åº¦ï¼Œä»£ç åé¢æœ‰æ—¶é—´å†è¡¥","tags":["æ•°æ®ç»“æ„","æ ‘"],"categories":["æ•°æ®ç»“æ„"]},{"title":"çº¿æ®µæ ‘åˆæ¢","url":"/2019/12/09/xian-duan-shu/","content":"\n## å‰è¨€\n\nçº¿æ®µæ ‘å…¶å®å±äºæ¯”è¾ƒé«˜çº§çš„æ•°æ®ç»“æ„äº†ï¼Œæœ¬äººå¹¶ä¸æ˜¯ç«èµ›é€‰æ‰‹ï¼Œè¿™é‡Œçš„ä»£ç ä¹Ÿæ˜¯å€Ÿé‰´çš„boboè€å¸ˆçš„è§†é¢‘è¯¾æ¥å®ç°çš„ï¼Œé¢è¯•ä»€ä¹ˆçš„ä¸€èˆ¬æ˜¯ä¸ä¼šè€ƒçš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯å‡ºäºå…´è¶£ç»ƒç»ƒæ‰‹\n\n## é—®é¢˜å¼•å…¥\n\n[307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode-cn.com/problems/range-sum-query-mutable/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„  numsï¼Œæ±‚å‡ºæ•°ç»„ä»ç´¢å¼• i åˆ° j  (i â‰¤ j) èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼ŒåŒ…å« i,  j ä¸¤ç‚¹ã€‚\n\nupdate(i, val) å‡½æ•°å¯ä»¥é€šè¿‡å°†ä¸‹æ ‡ä¸º i çš„æ•°å€¼æ›´æ–°ä¸º valï¼Œä»è€Œå¯¹æ•°åˆ—è¿›è¡Œä¿®æ”¹ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nGiven nums = [1, 3, 5]\n\nsumRange(0, 2) -> 9\nupdate(1, 2)\nsumRange(0, 2) -> 8\n```\n\n\n**è¯´æ˜:**\n\n1. æ•°ç»„ä»…å¯ä»¥åœ¨ update å‡½æ•°ä¸‹è¿›è¡Œä¿®æ”¹ã€‚\n2. ä½ å¯ä»¥å‡è®¾ update å‡½æ•°ä¸ sumRange å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°æ˜¯å‡åŒ€åˆ†å¸ƒçš„ã€‚\n\n> è¿™é¢˜å¦‚æœæ•°ç»„ä¸èƒ½ä¿®æ”¹çš„è¯å°±å¥½è¯´äº†ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨æ•°ç»„çš„å‰ç¼€å’Œï¼Œä½†æ˜¯è¿™é‡Œæ•°ç»„æ˜¯ä¼šå˜åŒ–çš„ï¼Œéš¾é“æ²¡æ›´æ–°ä¸€æ¬¡éƒ½è¦é‡æ–°éå†ä¹ˆï¼Ÿé‚£ä¹Ÿå¤ªæ…¢äº†å§ï¼Œæœ‰æ²¡æœ‰ä¸€ç§ç»“æ„èƒ½é«˜æ•ˆçš„æ’å…¥åŒæ—¶ä¹Ÿèƒ½é«˜æ•ˆçš„æŸ¥è¯¢ï¼Ÿ\n\n## çº¿æ®µæ ‘\n\nçº¿æ®µæ ‘ï¼Œå®ƒåœ¨å„ä¸ªèŠ‚ç‚¹ä¿å­˜ä¸€æ¡çº¿æ®µï¼ˆæ•°ç»„ä¸­çš„ä¸€æ®µå­æ•°ç»„ï¼‰ï¼Œä¸»è¦ç”¨äºé«˜æ•ˆè§£å†³è¿ç»­åŒºé—´çš„åŠ¨æ€æŸ¥è¯¢é—®é¢˜ï¼Œç”±äºäºŒå‰ç»“æ„çš„ç‰¹æ€§ï¼ˆå®ƒæ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘ï¼‰ï¼Œå®ƒåŸºæœ¬èƒ½ä¿æŒæ¯ä¸ªæ“ä½œçš„å¤æ‚åº¦ä¸º`O(logN)`\n\nçº¿æ®µæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªåŒºé—´ï¼Œçˆ¶åŒºé—´ä¸º`[a,b]` åˆ™å·¦å­åŒºé—´ä¸º`[a,(a+b)/2]`å³å­åŒºé—´ä¸º`[(a+b)/2+1,b]` æœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹å°±æ˜¯å¯¹åº”çš„ä¸€ä¸ªä¸ªå…·ä½“çš„å…ƒç´ å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ•°ç»„æ¥å®ç°çº¿æ®µæ ‘\n\n```java\nimport java.util.function.*;\npublic class SegmentTree<E>{\n    \n    private E[] data;\n\n    private E[] tree;\n\n    private BiFunction<E,E,E> function;\n\n    public SegmentTree(E[] arr,BiFunction<E,E,E> function){\n        data = (E[]) new Object[arr.length];\n        this.function=function;\n        System.arraycopy(arr,0,data,0,arr.length);\n        //å€¼å¾—æ€è€ƒä¸ºä»€ä¹ˆæ˜¯4n\n        tree = (E[]) new Object[4*arr.length];\n        buildSegmentTree(0,0,arr.length-1);\n    }\n\n    //æ ¹æ®ä¼ å…¥çš„BiFuctionæ„å»ºçº¿æ®µæ ‘\n    private void buildSegmentTree(int index,int left,int right){\n        if (left==right) {\n            tree[index] =data[right];\n            return;\n        }\n        int leftIndex=leftChild(index);\n        int rightIndex=rightChild(index);\n        int mid=left+(right-left)/2;\n        buildSegmentTree(leftIndex,left,mid);\n        buildSegmentTree(rightIndex,mid+1,right);\n        //æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¼ å…¥BiFunction\n        tree[index]=function.apply(tree[leftIndex],tree[rightIndex]);\n    }\n\n    //èŒƒå›´æœç´¢\n    public E searchRange(int left,int right){\n        return searchRange(0,0,data.length-1,left,right);\n    }\n\n    private E searchRange(int rootIndex,int left,int right,int targetLeft,int targetRight){\n        if (targetLeft == left && targetRight == right) {\n            return tree[rootIndex];\n        }\n        int mid=left+(right-left)/2;\n        if (targetLeft>mid) {\n            return searchRange(rightChild(rootIndex),mid+1,right,targetLeft,targetRight);\n        }\n        if (targetRight<=mid) {\n            return searchRange(leftChild(rootIndex),left,mid,targetLeft,targetRight);\n        }\n        return function.apply(searchRange(leftChild(rootIndex),left,mid,targetLeft,mid),searchRange(rightChild(rootIndex),mid+1,right,mid+1,targetRight));\n    }\n\n\n    public void update(int index,E e){\n        if (index<0 || index>=data.length) {\n            throw new IllegalArgumentException(\"index illegal\");\n        }\n        update(0,0,data.length-1,index,e);\n    }\n\n    public void update(int rootIndex,int left,int right,int targetIndex,E e){\n        if (left == right) {\n            tree[rootIndex]=e;\n            return;\n        }\n        int mid=left+(right-left)/2;\n        if (targetIndex<=mid) {\n            update(leftChild(rootIndex),left,mid,targetIndex,e);\n        }else{\n            update(rightChild(rootIndex),mid+1,right,targetIndex,e);\n        }\n        tree[rootIndex]=function.apply(tree[leftChild(rootIndex)],tree[rightChild(rootIndex)]);\n    }\n\n\n    public int getSize(){\n        return data.length;\n    }\n\n    public E get(int index){\n        if (index<0 || index>=data.length) {\n            throw new IllegalArgumentException(\"index is illegal!\");\n        }\n        return data[index];\n    }\n\n    //å·¦å­©å­\n    private int leftChild(int index){\n        return index*2+1;\n    }\n\n    //å³å­©å­\n    private int rightChild(int index){\n        return index*2+2;\n    }\n}\n```\n\næ²¡å•¥å¥½è¯´çš„ï¼Œæ•´ä½“è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä»£ç ä¸­ç”¨åˆ°äº†Java8çš„å‡½æ•°å¼æ¥å£ï¼Œç¡®å®æŒºæ–¹ä¾¿çš„\n\nå…¶å®æˆ‘è§‰å¾—æœ‰ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„ç‚¹å°±æ˜¯çº¿æ®µæ ‘éœ€è¦å¤šå¤§çš„æ•°ç»„ç©ºé—´ï¼Ÿ\n\né¦–å…ˆä¸€é¢—Hå±‚ï¼ˆHä»1å¼€å§‹ï¼‰çš„æ»¡äºŒå‰æ ‘ä¸€å…±æœ‰ `2^H-1`  ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¿½ç•¥é‚£ä¸€ä¸ªèŠ‚ç‚¹ï¼Œçº¦ä¸º`2^H`ä¸ªèŠ‚ç‚¹ï¼Œè€Œæœ€åä¸€å±‚ï¼ˆh-1å±‚ï¼‰æœ‰ `2^(h-1)`ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åä¸€å±‚çš„èŠ‚ç‚¹æ ‘å¤§è‡´ç­‰äºå‰é¢æ‰€æœ‰å±‚èŠ‚ç‚¹çš„å’Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œåœ¨çº¿æ®µæ ‘ä¸­å¦‚æœéœ€è¦è¡¨ç¤ºçš„åŒºé—´å¤§å°ä¸ºnï¼Œå¹¶ä¸”nåˆšå¥½ç­‰äº2çš„kæ¬¡å¹‚çš„è¯ï¼ˆä¹Ÿå°±æ˜¯æ”¾å¥½æ„æˆä¸€é¢—æ»¡äºŒå‰æ ‘ï¼‰ï¼Œé‚£ä¹ˆå°±åªéœ€è¦2nçš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œä½†æ˜¯å¦‚æœæ˜¯`n=2^k+c` é‚£ä¹ˆå½“å‰å±‚å°±å­˜ä¸ä¸‹è¿™nä¸ªå…ƒç´ ï¼Œéœ€è¦å­˜åˆ°ä¸‹ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯ç©ºé—´è¿˜éœ€è¦*2ï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬å°±éœ€è¦ 4n çš„ç©ºé—´å»å­˜å‚¨è¿™é¢—çº¿æ®µæ ‘ã€‚\n\nè¿™ä¸ªæ—¶å€™å†å›å¤´å»åšä¸Šé¢çš„é¢˜å°±ä¼šå¾ˆç®€å•äº†ğŸ˜\n\n> çº¿æ®µæ ‘å…¶å®è¿˜æœ‰å¾ˆå¤šçš„æ‰©å±•ï¼Œä¸Šé¢çš„æ˜¯æœ€æœ€æœ€åŸºæœ¬çš„æœ€ç®€å•çš„çº¿æ®µæ ‘ç»“æ„ï¼Œæˆ‘è¿˜æ ¹æœ¬å°±æ²¡æ‘¸åˆ°çº¿æ®µæ ‘çš„é—¨ğŸ˜‚ï¼Œåªæ˜¯çŸ¥é“äº†æœ‰è¿™ä¹ˆä¸ªç»“æ„\n>\n> ç”±äºæˆ‘å®åœ¨æ˜¯å¤ªèœäº†ï¼Œä¹Ÿæ²¡æœ‰æ—¶é—´å»äº†è§£é‚£äº›ç»“æ„äº†\n>\n> å½“ç„¶é¢è¯•çš„æ—¶å€™å¹¶ä¸ä¼šè€ƒçº¿æ®µæ ‘è¿™äº›ç©æ„å„¿ï¼Œæˆ‘ä¹Ÿåªæ˜¯ä¸ºäº†ç»ƒç»ƒæ‰‹ï¼ŒçœŸæ­£çš„ç«èµ›çš„é¢˜ç›®ä¹Ÿä¸ä¼šåƒä¸Šé¢é‚£ä¹ˆç®€å•ï¼Œäº†è§£å³å¯ğŸ˜…\n\n\n\n","tags":["æ•°æ®ç»“æ„","æ ‘"],"categories":["æ•°æ®ç»“æ„"]},{"title":"ç”±äºcmdå¼•å‘çš„è¡€æ¡ˆ","url":"/2019/12/08/you-yu-cmd-yin-fa-de-xie-an/","content":"\n## å‰è¨€\n\nç»™æ•™åŠ¡å¤„åšä¸€ä¸ªå·¥ä½œé‡å®¡æ ¸çš„webé¡¹ç›®ï¼Œå‰å‡ å¤©å®Œæˆåéƒ¨ç½²åœ¨æœºæˆ¿ç”µè„‘ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯æµ‹è¯•çš„æ—¶å€™å‡ºç°äº†Bugï¼Œä¼šå­˜åœ¨ä¸€ä¸ªç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œæ•´ä¸ªåº”ç”¨å¡æ­»ï¼Œæ‰€æœ‰äººéƒ½æ— æ³•ç™»é™†ï¼Œå› ä¸ºç™»é™†æ¨¡å—æ˜¯æˆ‘å†™çš„ï¼Œæˆ‘å½“æ—¶å°±æ…Œäº†ï¼ˆå¹¶ä¸ï¼‰ï¼Œç„¶åèµ¶ç´§å»æœºæˆ¿çœ‹çœ‹åˆ°åº•æ˜¯å•¥æƒ…å†µ\n\n## FixBug\n\nå…¶å®æˆ‘é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ç½‘ç»œæˆ–è€…æ•°æ®åº“çš„é—®é¢˜ï¼Œä½†æ˜¯çœ‹äº†æˆ‘æ§åˆ¶å°çš„è¾“å‡ºï¼Œå‘ç°ä»£ç å…¶å®æ ¹æœ¬å°±è¿˜æ²¡åˆ°æ•°æ®åº“å±‚ï¼æ‰€ä»¥å…ˆæ’é™¤äº†æ•°æ®åº“çš„é—®é¢˜\n\nç„¶åæˆ‘å°±æƒ³ä¼šä¸ä¼šæ˜¯GCçš„é—®é¢˜ï¼Œç„¶åæˆ‘æ‰“å¼€äº† `jvisualvm`ï¼Œå‡†å¤‡æŸ¥çœ‹å½“å‰çš„å †å ç”¨å’ŒGCæƒ…å†µï¼Œä½†æ˜¯ä»–ä»¬ä¹‹å‰é‡å¯äº†æœåŠ¡ï¼Œç°åœ¨æ˜¯æ­£å¸¸çš„ï¼Œçœ‹ä¸å‡ºæ¥ä»€ä¹ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤ç°è¿™ä¸ªBugï¼Œç»“æœæˆ‘ä»¬å‡ ä¸ªäººåœ¨å“ªé‡Œæäº†åŠå¤©æ­»æ´»å¤ç°ä¸äº†ğŸ˜‚\n\n> åœ¨ç»è¿‡æˆ‘ä»¬ä¸€ä¸ªå°æ—¶å¤šå°æ—¶åšæŒä¸æ‡ˆçš„å°è¯•ä¸‹ï¼Œç»ˆäºå¤ç°äº†ï¼\n\né¡µé¢hangä½ï¼Œæ‰€æœ‰äººéƒ½æ— æ³•ç™»é™†ï¼Œåå°ä¹Ÿå¹¶æ²¡æœ‰ä»»ä½•çš„é”™è¯¯ä¿¡æ¯ï¼Œç„¶åæˆ‘èµ¶ç´§å»çœ‹äº†ä¸‹ `jvisualvm` å‘ç°å †å¹¶æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼ŒGCä¹Ÿå¹¶æ²¡æœ‰å‘ç”Ÿï¼è€Œä¸”æ›´è¯¡å¼‚çš„æ˜¯å…¶ä»–çš„å·²ç»ç™»é™†çš„äººæ˜¯å¯ä»¥æ­£å¸¸çš„æ“ä½œçš„ï¼åªæ˜¯å¡ä½äº†ç™»é™†çš„äººï¼Œæ‰€ä»¥GCçš„é—®é¢˜ä¹Ÿæ’é™¤äº†\n\nåœ¨dumpå‡ºçº¿ç¨‹å¿«ç…§åç»ˆäºå‘ç°äº†é—®é¢˜æ‰€åœ¨\n\n![mark](http://static.imlgw.top/blog/20191208/XKUriuCE9nTb.png?imageslim)\n\nå›¾ä¸­çš„è¿™æ¡çº¿ç¨‹å¡åœ¨äº† `PrintStream.println()` ä¸Šï¼Œè€Œè¿™ä¸ªæ˜¯æˆ‘åœ¨Serviceæ‰“å°çš„logä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆä¼šåœ¨è¿™é‡Œå¡ä½ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸ç§‘å­¦å•Šï¼Œç„¶åæˆ‘çœ‹äº† å…¶ä»– tomcatçš„å·¥ä½œçº¿ç¨‹ï¼Œå‘ç°è¿˜æœ‰å¥½å‡ ä¸ªéƒ½æ˜¯`BLOCK` çŠ¶æ€ï¼Œéƒ½åœ¨ç­‰ `[0x0000004df8afd000]`è¿™æŠŠé”ï¼Œè¿™ä¸ªé”è¢«å¦ä¸€ä¸ªtomcatçš„å·¥ä½œçº¿ç¨‹ `http-bio-80-exec[2]` æ‰€æŒæœ‰ï¼Œè€Œä¸”å®ƒå¹¶ä¸æ˜¯`BLOCK`çŠ¶æ€ï¼Œè€Œæ˜¯ `RUNNABLE` çŠ¶æ€ï¼Œè¿™ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œ `java.io.FileOutputStream.writeBytes()` æ–¹æ³•ï¼Œæˆ‘ä»¬å»çœ‹çœ‹`println`çš„æºç \n\n```java\n/**\n * Prints a String and then terminate the line.  This method behaves as\n * though it invokes <code>{@link #print(String)}</code> and then\n * <code>{@link #println()}</code>.\n *\n * @param x  The <code>String</code> to be printed.\n */\npublic void println(String x) {\n    synchronized (this) {\n        print(x);\n        newLine();\n    }\n}\n```\n\nå¯ä»¥çœ‹å‡ºåœ¨printlnæ–¹æ³•ç¡®å®æ˜¯åŠ äº†é”çš„ï¼Œé”çš„å¯¹è±¡å°±æ˜¯å½“å‰çš„PrintStreamå®ä¾‹å¯¹è±¡ï¼Œè€Œå ç”¨è¿™ä¸ªé”çš„å¯¹è±¡çš„çº¿ç¨‹åˆ™æ­£åœ¨æ‰§è¡Œä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸ªæœ¬åœ°æ–¹æ³•æˆ‘ä»¬çœ‹ä¸åˆ°åº•å±‚çš„ç»†èŠ‚\n\n```java\n/**\n * Writes a sub array as a sequence of bytes.\n * @param b the data to be written\n * @param off the start offset in the data\n * @param len the number of bytes that are written\n * @param append {@code true} to first advance the position to the\n *     end of file\n * @exception IOException If an I/O error has occurred.\n */\nprivate native void writeBytes(byte b[], int off, int len, boolean append)\n    throws IOException;\n```\n\næ— å¥ˆï¼Œå€ŸåŠ©æœç´¢å¼•æ“ï¼Œæœç„¶æŸ¥åˆ°äº†åŒæ ·çš„é—®é¢˜ \n\n[ä¸€ä¸ªRUNNABLEçŠ¶æ€çš„çº¿ç¨‹hangåœ¨äº†java.io.FileOutputStream.writeBytesæ–¹æ³•ä¸Š](https://my.oschina.net/u/1030459/blog/908007)\n\nå½“ç„¶åŸé—®é¢˜æ˜¯æ¥è‡ª[StackOverflow](https://stackoverflow.com/questions/634102/log4j-is-hanging-my-application-what-am-i-doing-wrong) \n\né—®é¢˜çš„æ ¹æœ¬åŸå› ï¼šåœ¨CMDçª—å£ç‚¹å‡»äº†é»‘æ¡†ä¹‹åï¼Œæ§åˆ¶å°å°±ä¼šè¢«æš‚åœ![mark](http://static.imlgw.top/blog/20191208/1em5YGsoGyxT.png?imageslim)\n\nï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¹‹åå‘æ§åˆ¶å°çš„è¾“å…¥ç¼“å†²åŒºä¼šè¢«å¾ˆå¿«å¡«æ»¡ï¼Œç„¶åæ­£åœ¨è¾“å‡ºçš„çº¿ç¨‹å°±ä¼šhangä½ï¼Œä½†æ˜¯æ­£åœ¨è¾“å‡ºçš„çº¿ç¨‹ä¹Ÿå¹¶ä¸ä¼š`BLOCK`ï¼ŒçŠ¶æ€ä»ç„¶æ˜¯`RUNNABLE`æ‰€ä»¥å°±å¾ˆè¯¡å¼‚ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ‰€æè¿°çš„æƒ…å†µï¼Œå½“ä½ è¿™ä¸ªæ—¶å€™åœ¨CMDçŠ¶æ€ä¸‹æŒ‰ä¸€ä¸‹å›è½¦æˆ–è€…å…¶ä»–çš„é”®é‡Šæ”¾consoleï¼Œé€€å‡ºç¼–è¾‘æ¨¡å¼![mark](http://static.imlgw.top/blog/20191208/4RXkNizHfNsP.png?imageslim)\n\nè¿™ä¸ªçº¿ç¨‹åˆä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥è°ƒæ•´cmdçš„è®¾ç½®ï¼Œæˆ‘è¿™é‡Œå…¶å®æ— æ‰€è°“ï¼Œå› ä¸ºåé¢å¹¶ä¸ä¼šåœ¨winä¸Šè¿è¡Œ\n\nè‡³æ­¤é—®é¢˜å°±åŸºæœ¬è§£å†³äº†ï¼ˆå…¶å®éƒ½ä¸ç®—é—®é¢˜ï¼‰ï¼Œæ²¡æƒ³åˆ°è¿˜ä¼šè¢«cmdç»™å‘ä¸€æŠŠï¼Œä¸è¿‡å¢é•¿äº†ä¸€ç‚¹æ’æŸ¥é—®é¢˜çš„èƒ½åŠ›ä¹Ÿè¿˜æ˜¯ä¸é”™çš„ğŸ˜\n\n## æ€»ç»“\n\næœ€å¤§çš„æ”¶è·å°±æ˜¯ï¼š é‡åˆ°bugä¸è¦å…ˆæ€¥ç€é‡å¯é€ƒé¿é—®é¢˜ï¼Œå¾—é¢å¯¹å®ƒï¼Œå› ä¸ºæœ‰äº›bugå®Œå…¨å°±æ˜¯å¶ç„¶æ€§çš„ï¼Œä¸€æ—¦æ”¾è¿‡ï¼Œè¦æƒ³å¤ç°å¯èƒ½ä¼šæå…¶å›°éš¾ï¼Œè¿™æ¬¡è¿˜ç®—è¿æ°”å¥½ï¼Œæœ€ç»ˆå¤ç°äº†ï¼Œä¸è¿‡å½“æ—¶å¦‚æœä»–ä»¬ä¿æŠ¤äº†ç°åœºåé¢å°±ä¸ä¼šèŠ±å‡ ä¸ªå°æ—¶å»å¤ç°é—®é¢˜ï¼ˆç¡®å®å¤§å®¶ä¹Ÿéƒ½ç»éªŒä¸å¤ªè¶³ï¼‰ï¼Œä¹Ÿç®—æ˜¯åƒä¸€å ‘é•¿ä¸€æ™ºäº† hahaha ~~","tags":["Bug"],"categories":["è¸©å‘è®°å½•"]},{"title":"LeetCodeäºŒåˆ†æŸ¥æ‰¾","url":"/2019/12/06/leetcode-er-fen-cha-zhao/","content":"\n>  ä» [æ•°ç»„ä¸“é¢˜](http://imlgw.top/2019/05/04/leetcode-shu-zu/) ä¸­æŠ½å–å‡ºæ¥çš„ \n\n## _äºŒåˆ†æœç´¢_\n\n## [704. äºŒåˆ†æŸ¥æ‰¾](https://leetcode-cn.com/problems/binary-search/)\n\nç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target  ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums = [-1,0,3,5,9,12], target = 9\nè¾“å‡º: 4\nè§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums = [-1,0,3,5,9,12], target = 2\nè¾“å‡º: -1\nè§£é‡Š: 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1\n```\n\n**æç¤ºï¼š**\n\n- ä½ å¯ä»¥å‡è®¾ nums ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯ä¸é‡å¤çš„\n- n å°†åœ¨ [1, 10000]ä¹‹é—´\n- nums çš„æ¯ä¸ªå…ƒç´ éƒ½å°†åœ¨ [-9999, 9999]ä¹‹é—´\n\n**è§£æ³•ä¸€**\n\næ¯”è¾ƒç»å…¸çš„äºŒåˆ†\n\n```java\npublic int search(int[] nums, int target) {\n    int left=0,right=nums.length;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(nums[mid]<target){\n            left=mid+1;\n        }else if(nums[mid] > target){\n            right=mid;\n        }else{\n            return mid;\n        }\n    }\n    return -1;\n}\n```\n**è§£æ³•äºŒ**\n\næŒ‰ç…§æ¿å­æ¥çš„äºŒåˆ†ï¼Œæœ€åéœ€è¦åå¤„ç†ä¸€ä¸‹ä¸å­˜åœ¨çš„æƒ…å†µ\n\n```java\n//æ¨¡æ¿äºŒåˆ†\npublic int search(int[] nums, int target) {\n    int left=0,right=nums.length;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(nums[mid]<target){ //æ’é™¤mid\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    return left!=nums.length&&nums[left]==target?left:-1;\n}\n```\n## [69. x çš„å¹³æ–¹æ ¹](https://leetcode-cn.com/problems/sqrtx/)\n\nå®ç° `int sqrt(int x)` å‡½æ•°ã€‚\n\nè®¡ç®—å¹¶è¿”å› *x* çš„å¹³æ–¹æ ¹ï¼Œå…¶ä¸­ *x* æ˜¯éè´Ÿæ•´æ•°ã€‚\n\nç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™æ•´æ•°çš„éƒ¨åˆ†ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 4\nè¾“å‡º: 2\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 8\nè¾“å‡º: 2\nè¯´æ˜: 8 çš„å¹³æ–¹æ ¹æ˜¯ 2.82842..., \n     ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚\n```\n\n**è§£æ³•ä¸€**\n\näºŒåˆ†è§£æ³•\n\n```go\nfunc mySqrt(x int) int {\n    lx := int64(x)\n    var left int64 = 0\n    var right int64 = lx/2 + 1\n    for left < right {\n        mid := left + (right-left)/2\n        if mid*mid < lx {\n            left = mid + 1\n            //å‘ä¸‹å–æ•´çš„ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–åˆ¤æ–­æˆ–è€…å–å³ä¸­ä½æ•°\n            if left*left > lx {\n                return int(mid)\n            }\n        } else {\n            right = mid\n        }\n    }\n    return int(left)\n}\n```\n\nè¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¥½çš„è§£æ³•ï¼Œæ›´åŠ è´´åˆæ¨¡æ¿\n\n```go\n//è¿™ä¸ªå…¶å®æ›´èƒ½ä½“ç°æ¨¡æ¿çš„å¥½å¤„\nfunc mySqrt(x int) int {\n    lx := int64(x)\n    var left int64 = 0\n    var right int64 = lx/2 + 1\n    for left < right {\n        mid := left + (right-left)/2 + 1\n        //å¤§äºlxçš„ä¸€å®šä¸æ˜¯reså¯ä»¥æ’é™¤ï¼Œä½†æ˜¯å°äºçš„ä¸ä¸€å®šä¸æ˜¯ï¼Œé¢˜ç›®æ˜¯å‘ä¸‹å–æ•´çš„\n        if mid*mid > lx { \n            right = mid - 1\n        } else {\n            left = mid\n        }\n    }\n    return int(left)\n}\n```\n\n**è§£æ³•äºŒ**\n\n> ç‰›é¡¿è¿­ä»£æ³•ï¼Œè¿˜æ²¡æ—¶é—´ä»”ç»†å»ç ”ç©¶ï¼Œåé¢æœ‰æ—¶é—´å†çœ‹çœ‹\n\n## [35. æœç´¢æ’å…¥ä½ç½®](https://leetcode-cn.com/problems/search-insert-position/)\n\nç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚\n\nä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­æ— é‡å¤å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,3,5,6], 5\nè¾“å‡º: 2\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,3,5,6], 2\nè¾“å‡º: 1\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [1,3,5,6], 7\nè¾“å‡º: 4\n```\n\n**ç¤ºä¾‹ 4:**\n\n```java\nè¾“å…¥: [1,3,5,6], 0\nè¾“å‡º: 0\n```\n\n**è§£æ³•ä¸€**\n\nè·Ÿè°å­¦ç¬”è¯•ç°åœºå†™çš„ï¼Œä¸Šé¢çš„éƒ½æ˜¯ddï¼ˆåˆ é™¤äº†ä¹‹å‰çš„è§£æ³•ï¼‰\n\n```java\npublic int searchInsert(int[] nums, int target) {\n    int len=nums.length;\n    int lo=0,hi=len; //å’Œæ¨¡æ¿ä¸ä¸€æ ·ï¼Œå› ä¸ºè¿™é‡Œæ˜¯æœç´¢æ’å…¥ä½ç½®æ˜¯å¯ä»¥åˆ°è¾¾rightçš„\n    while(lo< hi){\n        int mid=lo+(hi-lo)/2;\n        if(nums[mid]<target){\n            lo=mid+1;\n        }else {\n            hi=mid;\n        }\n    }\n    return lo;\n}\n```\n**è§£æ³•äºŒ**\n\n```java\n//update: 2020.5.18\npublic int searchInsert(int[] nums, int target) {\n    int len=nums.length;\n    int lo=0,hi=len-1;\n    int res=hi;\n    while(lo<=hi){\n        int mid=lo+(hi-lo)/2;\n        if(nums[mid]>=target){\n            res=mid;\n            hi=mid-1;\n        }else {\n            lo=mid+1;\n        }\n    }\n    return nums[res]<target?len:res;\n}\n```\n\n## [153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼](https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/)\n\nå‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚\n\n( ä¾‹å¦‚ï¼Œæ•°ç»„ `[0,1,2,4,5,6,7]` å¯èƒ½å˜ä¸º `[4,5,6,7,0,1,2]` )ã€‚\n\nè¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚\n\nä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [3,4,5,1,2]\nè¾“å‡º: 1\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [4,5,6,7,0,1,2]\nè¾“å‡º: 0\n```\n\n**è§£æ³•ä¸€**\n\næŠŠæœ€å¼€å§‹å†™çš„æ‹‰è·¨è§£æ³•ä¹Ÿæ”¾ä¸Šæ¥å§\n\n```java\npublic int findMin(int[] nums) {\n    if (nums==null||nums.length<=0) {\n        return 0;\n    }\n    if (nums.length==1||nums[0]<nums[nums.length-1]) {\n        return nums[0];\n    }\n    int left=1,right=nums.length-1;\n    while(left<right){\n        int mid=left+(right-left)/2+1;\n        if (nums[mid]>nums[mid-1]) {\n            if (nums[mid]>nums[0]) {\n                left=mid;\n            }else{\n                right=mid-1;\n            }\n        }else{\n            return nums[mid];\n        }\n    }\n    return nums[left];\n}\n```\nè¯´å®è¯ï¼Œæˆ‘éƒ½ä¸çŸ¥é“å’‹å¯¹çš„ã€‚ã€‚ã€‚\n\n**è§£æ³•äºŒ**\n\næ¨¡æ¿è§£æ³•ï¼Œè¿˜æ˜¯æ¨¡æ¿å†™èµ·æ¥æ¸…æ™°èˆ’æœ\n> å»ºè®®ç›´æ¥çœ‹UPDATE\n```java\npublic int findMin(int[] nums) {\n    if (nums==null||nums.length<=0) {\n        return 0;\n    }\n    int left=0,right=nums.length-1;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if (nums[mid]>nums[right]) { //æ’é™¤midçš„åˆ†æ”¯\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    return nums[left];\n}\n```\néœ€è¦æ³¨æ„è¦å’Œå³è¾¹ç•Œæ¯”è¾ƒï¼Œå’Œå·¦è¾¹ç•Œæ¯”è¾ƒä¸ä¸€å®šæ­£ç¡®\n\næ¯”å¦‚ `1 2 3 4 5` å’Œ`2 3 4 5 1` ä¸¤ä¸ªçš„ä¸­ç‚¹éƒ½å¤§äºå·¦è¾¹ç•Œï¼Œä½†æ˜¯ä½ æ— æ³•ç¡®å®šæ­¤æ—¶åº”è¯¥å¦‚æœç¼©çŸ­åŒºé—´ï¼Œé™¤éåšç‰¹åˆ¤ï¼Œä½†æ˜¯é‚£æ ·å°±éº»çƒ¦äº†\n\n**UPDATE: 2020.7.22**\n\næœ€å°å€¼çš„ç‰¹ç‚¹å°±æ˜¯è‚¯å®šæ˜¯å°äºç­‰äºnumsçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¿™é‡Œæ²¡æœ‰é‡å¤çš„å…ƒç´ ï¼Œæ‰€ä»¥æœ€å°å€¼è‚¯å®šæ˜¯å°äºæœ€åä¸€ä¸ªå…ƒç´ çš„ï¼Œé™¤éæœ€åä¸€ä¸ªå°±æ˜¯æœ€å°çš„å…ƒç´ ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬è®¾ç½®ä¸ºresçš„åˆå§‹å€¼ï¼Œè¿™æ ·æˆ‘é‡å†™åæˆ‘æ„Ÿè§‰æ›´å¥½ç†è§£äº†ï¼Œè¿›é˜¶ç‰ˆçš„åªéœ€è¦åœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šç¨åŠ æ”¹åŠ¨å°±è¡Œäº†\n```golang\nfunc findMin(nums []int) int {\n    var n = len(nums)\n    var left, right = 0, n - 1\n    var res = right//å¯¹nums[n-1]å°±æ˜¯æœ€å°å€¼åšå…œåº•\n    for left <= right {\n        mid := left + (right-left)/2\n        if nums[mid] < nums[n-1] {\n            res = mid\n            right = mid - 1\n        } else {\n            left = mid + 1\n        }\n    }\n    return nums[res]\n}\n```\nåŒç†ä¹Ÿå¯ä»¥å’Œå·¦è¾¹ç•Œæ¯”è¾ƒï¼Œæœ€å°å€¼ä¸€å®šæ˜¯å°äºç­‰äºnums[0]çš„\n```golang\nfunc findMin(nums []int) int {\n    var n = len(nums)\n    var left, right = 0, n - 1\n    var res = left //å¯¹nums[0]å°±æ˜¯æœ€å°å€¼åšå…œåº•\n    for left <= right {\n        mid := left + (right-left)/2\n        if nums[mid] < nums[0] {\n            res = mid\n            right = mid - 1\n        } else {\n            left = mid + 1\n        }\n    }\n    return nums[res]\n}\n```\n\n## [154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II](https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/) \n\nå‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚\n\n( ä¾‹å¦‚ï¼Œæ•°ç»„ `[0,1,2,4,5,6,7]` å¯èƒ½å˜ä¸º `[4,5,6,7,0,1,2]` )ã€‚\n\nè¯·æ‰¾å‡ºå…¶ä¸­æœ€å°çš„å…ƒç´ ã€‚\n\næ³¨æ„æ•°ç»„ä¸­å¯èƒ½å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: [1,3,5]\nè¾“å‡º: 1\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: [2,2,2,0,1]\nè¾“å‡º: 0\n```\n\n\n**è¯´æ˜ï¼š**\n\n- è¿™é“é¢˜æ˜¯ å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ çš„å»¶ä¼¸é¢˜ç›®ã€‚\n- å…è®¸é‡å¤ä¼šå½±å“ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å—ï¼Ÿä¼šå¦‚ä½•å½±å“ï¼Œä¸ºä»€ä¹ˆï¼Ÿ  \n\n**è§£æ³•ä¸€**\n> å»ºè®®ç›´æ¥å‚è€ƒè§£æ³•2\n\nç›¸æ¯”ä¸Šä¸€é¢˜æœ‰äº†é‡å¤çš„å…ƒç´ ï¼Œåœ¨è·³è½¬çš„æ—¶å€™éœ€è¦åˆ†æ¸…æ¥šæƒ…å†µï¼Œåœ¨midå’Œä¸­ç‚¹ç›¸ç­‰çš„æ—¶å€™åªæ’é™¤å³è¾¹ç•Œä¸€ä¸ªå…ƒç´ \n\n```java\npublic int findMin(int[] nums) {\n    int left=0,right=nums.length-1;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(nums[mid] > nums[right]){\n            left=mid+1;\n        }else if(nums[mid] < nums[right]){\n            right=mid;\n        }else{\n            right--; //å’Œå³è¾¹ç•Œç›¸ç­‰,æ— æ³•åˆ¤æ–­,åªç¼©å‡ä¸€æ­¥\n        }\n    }\n    return nums[left];\n}\n```\n\n**è§£æ³•äºŒ**\n\n(UPDATE: 2020.7.22)\n\nç›¸æ¯”[å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼](#153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼)ï¼Œä»…ä»…åªæ˜¯åŠ äº†ä¸€ä¸ªå°¾éƒ¨å»é‡çš„æ“ä½œï¼Œå»é‡åå°±å’Œä¸Šé¢çš„æƒ…å†µä¸€æ ·äº†ï¼Œè¿™æ ·å°±æ¯”å‰é¢çš„è§£æ³•æ›´åŠ æ¸…æ™°äº†ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿè¿˜æ˜¯ä¸€æ ·çš„\n```golang\n//å…ˆå¯¹å°¾éƒ¨å»é‡ï¼Œå†äºŒåˆ†ä¼šæ¸…æ™°å¾ˆå¤š\nfunc minArray(numbers []int) int {\n    var n = len(numbers)\n    var left = 0\n    var right = n - 1\n    //å°¾éƒ¨å»é‡\n    for right >= 1 && numbers[right] == numbers[right-1] {\n        right--\n    }\n    //å…œåº•æœ€å°å€¼å°±æ˜¯æœ€åä¸€ä¸ªå…ƒç´ \n    var res = right\n    for left <= right {\n        mid := left + (right-left)/2\n        //å»é‡åminä¸€å®šæ˜¯å°äºnumbers[n-1]çš„\n        if numbers[mid] < numbers[n-1] {\n            res = mid\n            right = mid - 1\n        } else {\n            left = mid + 1\n        }\n    }\n    return numbers[res]\n}\n\n```\n\n## [33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„](https://leetcode-cn.com/problems/search-in-rotated-sorted-array/)\n\nå‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚\n\n( ä¾‹å¦‚ï¼Œæ•°ç»„ `[0,1,2,4,5,6,7]` å¯èƒ½å˜ä¸º `[4,5,6,7,0,1,2]` )ã€‚\n\næœç´¢ä¸€ä¸ªç»™å®šçš„ç›®æ ‡å€¼ï¼Œå¦‚æœæ•°ç»„ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ï¼Œåˆ™è¿”å›å®ƒçš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å› `-1` ã€‚\n\nä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚\n\nä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ *O*(log *n*) çº§åˆ«ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums = [4,5,6,7,0,1,2], target = 0\nè¾“å‡º: 4\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums = [4,5,6,7,0,1,2], target = 3\nè¾“å‡º: -1\n```\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®æ˜ç¡®è¦æ±‚äº†æ—¶é—´å¤æ‚åº¦O(logn)ï¼Œæ‰€ä»¥è‚¯å®šè¿˜æ˜¯è¦äºŒåˆ†ï¼Œå…ˆä¸Šä»£ç å§\n\n```java\npublic static int search2(int[] nums, int target) {\n    int len = nums.length;\n\n    if ((nums == null) || (len <= 0)) {\n        return -1;\n    }\n\n    int lo = 0;\n    int hi = len - 1;\n\n    while (lo <= hi) {\n        int mid = lo + ((hi - lo) / 2);\n        // å·¦, å³ æŒ‡çš„æ˜¯æ—‹è½¬ç‚¹å·¦å³\n        if (nums[mid] > target) { //é¦–å…ˆæ˜¯å¤§äºtargetçš„æƒ…å†µ\n\n            if (target < nums[lo]) {\n                //targetåœ¨å³è¾¹\n                //midæœªçŸ¥è¿˜éœ€è¦åˆ¤æ–­ä¸‹ ç”»ä¸€ä¸ªæŠ˜çº¿å›¾å°±å¾ˆæ¸…æ¥šäº†\n                if (nums[mid] <= nums[hi]) { //midä¹Ÿåœ¨å³è¾¹\n                    hi = mid - 1;\n                } else {\n                    //midåœ¨å·¦è¾¹\n                    lo = mid + 1;\n                }\n            } else if (target > nums[lo]) {\n                //è¯´æ˜midåœ¨å·¦è¾¹, targetä¹Ÿåœ¨å·¦è¾¹\n                hi = mid - 1;\n            } else {\n                return lo;\n            }\n        } else if (nums[mid] < target) { //å°äºtargetçš„æƒ…å†µ\n\n            if (target < nums[hi]) {\n                //midåœ¨å³è¾¹ï¼Œtargetåœ¨å³è¾¹\n                lo = mid + 1;\n            } else if (target > nums[hi]) {\n                //targetåœ¨å·¦è¾¹\n                //midæœªçŸ¥è¿˜éœ€è¦åˆ¤æ–­ä¸‹\n                if (nums[mid] > nums[hi]) { //midåœ¨å·¦è¾¹\n                    lo = mid + 1;\n                } else {\n                    hi = mid - 1;\n                }\n            } else {\n                return hi;\n            }\n        } else {\n            return mid;\n        }\n\n        /*if(hi>=0&&lo<len&&nums[lo]<nums[hi]){\n                   //åˆ‡æ¢æˆæœ‰åºçš„äºŒåˆ†\n                   while(lo<=hi){\n                         mid=lo+(hi-lo)/2;\n                         if(nums[mid]>target){\n                                    hi=mid-1;\n                         }else if(nums[mid]<target){\n                                    lo=mid+1;\n                       }else return mid;\n                   }\n            }*/\n    }\n    return -1;\n}\n\n```\n\n1msï¼Œ99% çº¯ifåˆ¤æ–­**target**å’Œ**mid**çš„ä½ç½®ï¼Œç„¶åé€‰æ‹©ç§»åŠ¨**lo**è¿˜æ˜¯**hi**ï¼Œä¸€å¼€å§‹æˆ‘éšä¾¿æ‰¾äº†å‡ ç»„æ•°ç„¶åå°±å¼€å§‹å†™ï¼Œå†™åˆ°åé¢å‘ç°éƒ½æ˜¯bugğŸ˜‚ï¼Œè¿™é‡Œç”»ä¸ªå›¾å¾ˆæ–¹ä¾¿\n\n![mark](http://static.imlgw.top///20190507/vQgFb8yle0FH.png?imageslim)\n\nåœ¨é‡Œé¢æ‰¾ç‚¹ä¼šå¾ˆæ¸…æ™°\n\n**è§£æ³•äºŒ**\n\nå½“ç„¶è¿˜æœ‰ä¸€ç§æ›´åŠ ç®€å•ä¹Ÿä¸ç”¨è¿™ä¹ˆå¤æ‚çš„æ–¹æ³•\n\n```java\npublic static int search(int[] nums, int target) {\n    int lo=0,hi=nums.length-1;\n    if(nums==null||nums.length<=0){\n        return  -1;\n    }\n    int index=-1;\n    while(lo<=hi){\n        int mid=lo+(hi-lo)/2;\n        if(nums[mid]>=nums[lo]){\n            //å·¦åŠéƒ¨åˆ†æœ‰åº\n            index=binarySearch(nums,target,lo,mid);\n            //å¯¹å³åŠéƒ¨åˆ†äºŒåˆ†\n            if(index==-1){\n                lo=mid+1;\n                //lo-->mid æ²¡æ‰¾åˆ°å°±å¯¹å³åŠéƒ¨åˆ†ç»§ç»­åˆ’åˆ†\n            } else return index;\n        } else if(nums[mid]<nums[lo]){\n            //å³åŠéƒ¨åˆ†æœ‰åº\n            index=binarySearch(nums,target,mid,hi);\n            if(index==-1){\n                hi=mid-1;\n            } else return index;\n        }\n    }\n    return  index;\n}\n\npublic static int binarySearch(int []nums,int target,int lo,int hi){\n    while(lo<=hi){\n        int mid=lo+(hi-lo)/2;\n        if(nums[mid]>target){\n            hi=mid-1;\n        } else if(nums[mid]<target){\n            lo=mid+1;\n        } else return mid;\n    }\n    return -1;\n}\n```\n\nè¿™ä¸ªåº”è¯¥æ¯”ä¸Šä¸€ä¸ªæ…¢ä¸€ç‚¹ï¼Œæœ€å¥½æƒ…å†µä¸‹æ˜¯_**O(logN)**_ç›´æ¥å°†**target**åˆ’åˆ†åˆ°æœ‰åºçš„é‚£ä¸€è¾¹ï¼Œå¦‚æœæ²¡åˆ’åˆ†åˆ°æœ‰åºçš„é‚£ä¸€è¾¹å°±ä¼šèŠ±è´¹æ—¶é—´å»äºŒåˆ†å°è¯•åˆ‡å‰²æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯`logN+log(N/2)+log(N/4)+...log(N/N)` æœ€åæ•´ä½“å¤æ‚åº¦åº”è¯¥æ˜¯`O(logN*logN)` ï¼Œè™½ç„¶æ¯” `logN` å¥½å¾ˆå¤šï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç®—æ³•\n\n**è§£æ³•ä¸‰**\n\nç›¸å½“å·§å¦™çš„è§£æ³•ï¼å‚è€ƒ [lcus](https://leetcode.com/problems/search-in-rotated-sorted-array/discuss/14435/Clever-idea-making-it-simple)ï¼Œé€šè¿‡åˆ¤æ–­ `target`å’Œ`mid`çš„ä½ç½®ï¼Œå¦‚æœ`target`å’Œ`mid`ä¸åœ¨åŒä¸€æ®µå°±å°† `ã€4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ0ï¼Œ1ï¼Œ2ã€‘ `è½¬æ¢æˆ `ã€4ï¼Œ5ï¼Œ6ï¼Œ7ï¼ŒINT_MAXï¼ŒINT_MAXï¼ŒINT_MAXã€‘`æˆ–è€…`ã€INT_MINï¼ŒINT_MINï¼ŒINT_MINï¼ŒINT_MINï¼Œ0ï¼Œ1ï¼Œ2ã€‘` ç„¶åå†è¿›è¡ŒäºŒåˆ†\n\n```java\nclass Solution {\n    public int search(int[] nums, int target) {\n        if(nums==null || nums.length<=0) return -1;\n        int left=0,right=nums.length-1;\n        while(left<right){\n            int mid=left+(right-left)/2;\n            //è¿™ä¸€æ­¥ (nums[mid]>=nums[0])==(target>=nums[0]) å¾ˆå·§ç§’ï¼Œå…¶å®ç”¨å¼‚æˆ–ä¹Ÿå¯ä»¥\n            int midNum=(nums[mid]>=nums[0])==(target>=nums[0])?nums[mid]:\n                        nums[mid]>=nums[0]?Integer.MIN_VALUE:Integer.MAX_VALUE;\n            if(midNum<target){\n                left=mid+1;\n            }else{\n                right=mid;\n            }\n        }\n        return nums[left]!=target?-1:left;\n    }\n}\n```\n\n`(nums[mid]>=nums[0])==(target>=nums[0])` è¿™ä¸€æ­¥å¾ˆå·§å¦™ï¼Œæ»¡è¶³è¿™ä¸ªå…³ç³»å°±è¯´æ˜midå’Œtargetåœ¨åŒä¸€æ®µï¼Œä¸ç”¨å˜åŒ–ï¼Œå¯ä»¥ç›´æ¥æ±‚ï¼Œå¦åˆ™å°±æ ¹æ®midçš„ä½ç½®è€ƒè™‘å¦‚ä½•å˜åŒ–\n\n## [81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II](https://leetcode-cn.com/problems/search-in-rotated-sorted-array-ii/)\n\nå‡è®¾æŒ‰ç…§å‡åºæ’åºçš„æ•°ç»„åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªç‚¹ä¸Šè¿›è¡Œäº†æ—‹è½¬ã€‚\n\n( ä¾‹å¦‚ï¼Œæ•°ç»„ `[0,0,1,2,2,5,6]` å¯èƒ½å˜ä¸º `[2,5,6,0,0,1,2]` )ã€‚\n\nç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ç»™å®šçš„ç›®æ ‡å€¼æ˜¯å¦å­˜åœ¨äºæ•°ç»„ä¸­ã€‚è‹¥å­˜åœ¨è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: nums = [2,5,6,0,0,1,2], target = 0\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥: nums = [2,5,6,0,0,1,2], target = 3\nè¾“å‡º: false\n```\n\n**è¿›é˜¶:**\n\n- è¿™æ˜¯ [æœç´¢æ—‹è½¬æ’åºæ•°ç»„](https://leetcode-cn.com/problems/search-in-rotated-sorted-array/description/) çš„å»¶ä¼¸é¢˜ç›®ï¼Œæœ¬é¢˜ä¸­çš„ `nums`  å¯èƒ½åŒ…å«é‡å¤å…ƒç´ ã€‚\n- è¿™ä¼šå½±å“åˆ°ç¨‹åºçš„æ—¶é—´å¤æ‚åº¦å—ï¼Ÿä¼šæœ‰æ€æ ·çš„å½±å“ï¼Œä¸ºä»€ä¹ˆï¼Ÿ\n\n**è§£æ³•ä¸€**\n\nWAå“­äº†ï¼Œå¥½éš¾æï¼Œè¦æ˜¯åœ¨å·¥ç¨‹ä¸Šæˆ‘è‚¯å®šç›´æ¥éå†äº†ï¼Œå¤ªç»†èŠ‚äº†è¿™æ³¢\n\n```go\nfunc search(nums []int, target int) bool {\n    n:=len(nums)\n    if n==0{\n        return false\n    }\n    left:=0\n    right:=n-1\n    for left<right {\n        mid:=left+(right-left)/2+1\n        if nums[mid]>nums[right] { //å·¦åŠè¾¹\n            //targetåœ¨[left,mid)çš„æœ‰åºåŒºé—´å†…\n            if nums[left]<=target && target<nums[mid]{\n                right=mid-1\n            }else{\n                left=mid\n            }\n        }else if nums[mid]<nums[right]{\n            //targetåœ¨[mid,right]\n            if nums[mid]<=target && target<=nums[right]{\n                left=mid\n            }else{\n                right=mid-1\n            }\n        }else{\n            //mid==rightçœ‹rightæ˜¯ä¸æ˜¯target\n            if nums[right]==target{\n                return true\n            }\n            right--\n        }\n    }\n    return nums[left]==target\n}\n```\n\nçœ‹ç€åˆ«äººçš„é¢˜è§£å†™éƒ½WAäº†5ï¼Œ6æ¬¡ã€‚ã€‚ã€‚ã€‚è¿™ä¸ªå…¶å®å°±ä¸èƒ½æŒ‰ç…§ä¸Šä¸€é¢˜çš„æ€è·¯æ¥äº†ï¼Œå› ä¸ºæœ‰é‡å¤çš„ï¼Œä¸å¥½åˆ¤æ–­midå’Œtargetæ˜¯ä¸æ˜¯åœ¨åŒä¸€è¾¹\n\n## [744. å¯»æ‰¾æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯](https://leetcode-cn.com/problems/find-smallest-letter-greater-than-target/)\n\nç»™ä½ ä¸€ä¸ªæ’åºåçš„å­—ç¬¦åˆ—è¡¨ `letters` ï¼Œåˆ—è¡¨ä¸­åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚å¦ç»™å‡ºä¸€ä¸ªç›®æ ‡å­—æ¯ `target`ï¼Œè¯·ä½ å¯»æ‰¾åœ¨è¿™ä¸€æœ‰åºåˆ—è¡¨é‡Œæ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯ã€‚\n\nåœ¨æ¯”è¾ƒæ—¶ï¼Œå­—æ¯æ˜¯ä¾åºå¾ªç¯å‡ºç°çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼š\n\n- å¦‚æœç›®æ ‡å­—æ¯ `target = 'z'` å¹¶ä¸”å­—ç¬¦åˆ—è¡¨ä¸º `letters = ['a', 'b']`ï¼Œåˆ™ç­”æ¡ˆè¿”å› `'a'`\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥:\nletters = [\"c\", \"f\", \"j\"]\ntarget = \"a\"\nè¾“å‡º: \"c\"\n\nè¾“å…¥:\nletters = [\"c\", \"f\", \"j\"]\ntarget = \"c\"\nè¾“å‡º: \"f\"\n\nè¾“å…¥:\nletters = [\"c\", \"f\", \"j\"]\ntarget = \"d\"\nè¾“å‡º: \"f\"\n\nè¾“å…¥:\nletters = [\"c\", \"f\", \"j\"]\ntarget = \"g\"\nè¾“å‡º: \"j\"\n\nè¾“å…¥:\nletters = [\"c\", \"f\", \"j\"]\ntarget = \"j\"\nè¾“å‡º: \"c\"\n\nè¾“å…¥:\nletters = [\"c\", \"f\", \"j\"]\ntarget = \"k\"\nè¾“å‡º: \"c\"\n```\n\n**æç¤ºï¼š**\n\n1. `letters`é•¿åº¦èŒƒå›´åœ¨`[2, 10000]`åŒºé—´å†…ã€‚\n2. `letters` ä»…ç”±å°å†™å­—æ¯ç»„æˆï¼Œæœ€å°‘åŒ…å«ä¸¤ä¸ªä¸åŒçš„å­—æ¯ã€‚\n3. ç›®æ ‡å­—æ¯`target` æ˜¯ä¸€ä¸ªå°å†™å­—æ¯ã€‚\n\n**è§£æ³•ä¸€**\n\næŒ‰ç…§æ–°æ¨¡æ¿å†™çš„ï¼Œé¢˜è§£åŒºå¾ˆå¤šäººè®¨è®º`['z'ï¼Œ'a'ï¼Œ'b']`è¿™æ ·çš„caseï¼Œå…¶å®æˆ‘è§‰å¾—æ²¡å¿…è¦ï¼Œçº ç»“è¿™æ²¡å•¥æ„ä¹‰ï¼Œå¯èƒ½è¿˜æ˜¯é¢˜ç›®æè¿°æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘ä»¬å°±ç›´æ¥å½“æ™®é€šäºŒåˆ†å†™å°±è¡Œäº†\n\n```java\npublic char nextGreatestLetter(char[] letters, char target) {\n    int left=0,right=letters.length-1;\n    int res=0; //æ³¨æ„æ‰¾ä¸åˆ°çš„æƒ…å†µ\n    while(left<=right){\n        int mid=(left+right)/2;\n        if(letters[mid]>target){\n            res=mid;\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return letters[res];\n}\n```\n\n## [34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®](https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/)\n\nç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ `nums`ï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ `target`ã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚\n\nä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ *O*(log *n*) çº§åˆ«ã€‚\n\nå¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ï¼Œè¿”å› `[-1, -1]`ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums = [5,7,7,8,8,10], target = 8\nè¾“å‡º: [3,4]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums = [5,7,7,8,8,10], target = 6\nè¾“å‡º: [-1,-1]\n```\n\n**è§£æ³•ä¸€**\n\næ—¶é—´å¤æ‚åº¦O(logN)ï¼Œè‚¯å®šè¿˜æ˜¯è¦äºŒåˆ†\n\n```java\n//ä¸¤æ¬¡äºŒåˆ†\npublic int[] searchRange(int[] nums, int target) {\n    if(nums.length<=0){\n        return new int[]{-1,-1};\n    }\n    return new int[]{left(nums,target,0,nums.length-1),right(nums,target,0,nums.length-1)};\n}\n\n//5,7,7,8,8,8,8,10,10\npublic int left(int []nums,int target,int lo,int hi){\n    while(lo<=hi){\n        int mid=lo+(hi-lo)/2;\n        //System.out.println(\"lo: \"+nums[lo]+\"mid: \"+nums[mid] +\"hi: \"+nums[hi]);\n        if(nums[mid]<target){\n            lo=mid+1;\n        }else if(nums[mid]>target){\n            hi=mid-1;\n        }else if(mid>0){ //nums[mid]=target\n            if(nums[mid-1]!=target){\n                return mid;\n            }else{\n                //æ§åˆ¶å‘å·¦æ‰¾\n                hi=mid-1;\n            }\n        }else{\n            return mid; //0\n        }\n    }\n    return -1;\n}\n\npublic int right(int []nums,int target,int lo,int hi){\n    while(lo<=hi){\n        int mid=lo+(hi-lo)/2;\n        if(nums[mid]<target){\n            lo=mid+1;\n        }else if(nums[mid]>target){\n            hi=mid-1;\n        }else if(mid<nums.length-1){\n            if(nums[mid+1]!=target){\n                return mid;\n            }else{\n                //æ§åˆ¶å‘å³æ‰¾\n                lo=mid+1;\n            }\n        }else{\n            return mid; //nums.length\n        }\n    }\n    return -1;\n}\n```\n\n1ms ï¼Œ99% æ ¸å¿ƒå°±æ˜¯ä¸¤æ¬¡äºŒåˆ†ï¼Œåˆ†åˆ«å‘å·¦å’Œå‘åäºŒåˆ†æ•´ä¸ªæ•°ç»„ï¼Œ åœ¨ç›¸ç­‰çš„æ—¶å€™å¹¶ä¸è¿”å›ï¼Œå¤šåˆ¤æ–­ä¸€ä¸‹ï¼Œå·¦è¾¹çš„å°±æ§åˆ¶hiå‘å·¦è¾¹ç»§ç»­æ‰¾ï¼Œå³è¾¹å°±æ§åˆ¶loå‘å³è¾¹ç»§ç»­æ‰¾ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªä¸ç­‰äºtargetå°±è¿”å›ï¼Œå’Œä¸Šé¢ä¸€é¢˜ä¸€æ ·éƒ½æ˜¯äºŒåˆ†çš„å˜ç§\n\n**è§£æ³•äºŒ**\n\nç»Ÿä¸€çš„è§£æ³•ï¼Œä¸Šé¢çš„åšæ³•è™½ç„¶ç›´ç™½ï¼Œä½†æ˜¯æ²¡æœ‰é€šç”¨æ€§ï¼Œè¿™é‡Œå€Ÿé‰´è¯„è®ºåŒºå¤§ä½¬ [liweiwei1419](https://www.liwei.party/)çš„[è®²è§£](https://leetcode-cn.com/problems/search-insert-position/solution/te-bie-hao-yong-de-er-fen-cha-fa-fa-mo-ban-python-/)å†™ä¸€ä¸ªé€šç”¨çš„è§£æ³•ï¼Œä¹‹å‰å†™äºŒåˆ†ä¸€ç›´éƒ½æ˜¯å‡­æ„Ÿè§‰ï¼Œä¸æ³¨æ„ç»†èŠ‚ï¼Œæœ‰é”™è¯¯å°±debugï¼Œä¸œæ”¹ä¸€æ”¹ï¼Œè¥¿æ”¹ä¸€æ”¹ï¼Œç„¶åå°±è¿‡äº†ã€‚ã€‚ã€‚æ¯«æ— ç« æ³•ï¼Œä»¥åè¦ç»Ÿä¸€å†™æ³•äº†\n\n```java\n//ä¸¤æ¬¡äºŒåˆ†\npublic int[] searchRange(int[] nums, int target) {\n    if(nums.length<=0){\n        return new int[]{-1,-1};\n    }\n    return new int[]{left(nums,target,0,nums.length-1),right(nums,target,0,nums.length-1)};\n}\n\n//æ‰¾å¤§äºç­‰äºtargetçš„ç¬¬ä¸€ä¸ªå…ƒç´ ,å°äºè‚¯å®šä¸ç¬¦åˆ\npublic int left(int []nums,int target,int lo,int hi){\n    while(lo<hi){\n        int mid=lo+(hi-lo)/2;\n        if(nums[mid]<target){ //æ’é™¤å°äºtargetçš„,å‰©ä¸‹ã€lo,hiã€‘éƒ½æ˜¯å¤§äºç­‰äºçš„\n            lo=mid+1;\n        }else{\n            hi=mid;\n        }\n    }\n    return nums[hi]==target?hi:-1;\n}\n\n//æ‰¾å°äºç­‰äºtargetçš„æœ€åä¸€ä¸ªå…ƒç´ ,å¤§äºè‚¯å®šä¸ç¬¦åˆ\npublic int right(int []nums,int target,int lo,int hi){\n    while(lo<hi){\n        //é€‰å–å³ä¸­å€¼\n        int mid=lo+(hi-lo)/2+1;\n        if(nums[mid]>target){ //æ’é™¤å¤§äºtarget,å‰©ä¸‹[lo,hi]éƒ½æ˜¯å°äºç­‰äºçš„\n            hi=mid-1;\n        }else{\n            //æ ¹æ®è¿™ä¸ªåˆ¤æ–­éœ€è¦é€‰å–å³ä¸­å€¼\n            lo=mid;\n        }\n    }\n    return nums[hi]==target?hi:-1;\n}\n```\n\n**æ–°æ¨¡æ¿**\n\næ–°æ¨¡æ¿æ¯”è¾ƒå¥½å†™\n\n```java\npublic int[] searchRange(int[] nums, int target) {\n    if(nums==null || nums.length<=0) return new int[]{-1,-1};\n    return new int[]{leftSearch(nums,target),rightSearch(nums,target)};\n}\n\npublic int leftSearch(int[] nums,int target){\n    int left=0,right=nums.length-1;\n    int res=right;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(nums[mid]>=target){\n            res=mid;\n            right=mid-1; \n        }else{\n            left=mid+1;\n        }\n    }\n    return nums[res]==target?res:-1;\n}\n\npublic int rightSearch(int[] nums,int target){\n    int left=0,right=nums.length-1;\n    int res=left;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(nums[mid]<=target){\n            res=mid;\n            left=mid+1; \n        }else{\n            right=mid-1;\n        }\n    }\n    return nums[res]==target?res:-1;\n}\n```\n\n\n\n## [é¢è¯•é¢˜53 - II. 0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—](https://leetcode-cn.com/problems/que-shi-de-shu-zi-lcof/)\n\nä¸€ä¸ªé•¿åº¦ä¸º ~~n-1~~ n çš„é€’å¢æ’åºæ•°ç»„ä¸­çš„æ‰€æœ‰æ•°å­—éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°å­—éƒ½åœ¨èŒƒå›´~~0ï½n-1~~ 0~n ä¹‹å†…ã€‚åœ¨èŒƒå›´~~0ï½n-1~~ 0~nå†…çš„~~n~~ n+1 ä¸ªæ•°å­—ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ•°å­—ä¸åœ¨è¯¥æ•°ç»„ä¸­ï¼Œè¯·æ‰¾å‡ºè¿™ä¸ªæ•°å­—ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [0,1,3]\nè¾“å‡º: 2\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [0,1,2,3,4,5,6,7,9]\nè¾“å‡º: 8\n```\n\n**é™åˆ¶ï¼š**\n\n`1 <= æ•°ç»„é•¿åº¦ <= 10000`\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜çš„é¢˜ç›®æè¿°æ„Ÿè§‰æœ‰ç‚¹é—®é¢˜æˆ‘ç¨å¾®æ”¹äº†ä¸‹\n\n```java\npublic int missingNumber(int[] nums) {\n    int left=0,right=nums.length-1;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(nums[mid]==mid){\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    if(nums[left]==left) return left+1; //åªæœ‰ä¸€ä¸ªæ•°\n    return left;\n}\n```\n\näºŒåˆ†æ‰¾é‚£ä¸ªç´¢å¼•ä¸å¯¹çš„å…ƒç´ å°±okäº†ï¼ŒæŒ‰ç…§æ¨¡æ¿å†™çš„ï¼Œæ’é™¤æ³•ï¼Œæ’é™¤ç›¸ç­‰çš„ï¼Œæœ€åè¿”å›çš„ç´¢å¼•`left`å°±æ˜¯ç¼ºå¤±çš„æ•°å­—\n\n\n\n## [852. å±±è„‰æ•°ç»„çš„å³°é¡¶ç´¢å¼•](https://leetcode-cn.com/problems/peak-index-in-a-mountain-array/)\n\næˆ‘ä»¬æŠŠç¬¦åˆä¸‹åˆ—å±æ€§çš„æ•°ç»„ A ç§°ä½œå±±è„‰ï¼š\n\n- A.length >= 3\n- å­˜åœ¨ 0 < i < A.length - 1 ä½¿å¾—A[0] < A[1] < ... A[i-1] < A[i] > A[i+1] > ... > A[A.length - 1]\n\n\nç»™å®šä¸€ä¸ªç¡®å®šä¸ºå±±è„‰çš„æ•°ç»„ï¼Œè¿”å›ä»»ä½•æ»¡è¶³ `A[0] < A[1] < ... A[i-1] < A[i] > A[i+1] > ... > A[A.length - 1]` çš„ i çš„å€¼ã€‚\n\n **ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[0,1,0]\nè¾“å‡ºï¼š1\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[0,2,1,0]\nè¾“å‡ºï¼š1\n```\n\n**è§£æ³•ä¸€**\n\nå…¶å®è¿˜æ˜¯ä¸Šé¢çš„æ¨¡æ¿ï¼Œåªä¸è¿‡åšäº†ä¸€ç‚¹ç‚¹æ”¹åŠ¨è€Œå·²ï¼Œå¾ˆå‚»é€¼çš„WAäº†ä¸€å‘ï¼Œæˆ‘ä¹Ÿæ˜¯æœäº†è‡ªå·±äº†\n\n```java\npublic static int peakIndexInMountainArray(int[] A) {\n    int left=0,right=A.length-1;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        //System.out.println(mid);\n        if (mid>0 && mid<A.length && A[mid] > A[mid-1] && A[mid]<A[mid+1]) {\n            left=mid+1;\n        }else if (mid>0 && mid<A.length && A[mid]< A[mid-1] && A[mid]>A[mid+1]){\n            right=mid-1;\n        }else{\n            return mid;\n        }\n    }\n    return left;\n}\n```\n\nä»£ç ä¼˜åŒ– `2020.4.9` ä¸çŸ¥é“ä¸ºå•¥ä¹‹å‰å†™æˆå“ªä¸ªé¬¼æ ·å­ã€‚ã€‚ã€‚\n\n```java\npublic static int peakIndexInMountainArray(int[] A) {\n    int left=0,right=A.length-1;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if (A[mid]<A[mid+1]) {\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    return left;\n}\n```\n\n## [1095. å±±è„‰æ•°ç»„ä¸­æŸ¥æ‰¾ç›®æ ‡å€¼](https://leetcode-cn.com/problems/find-in-mountain-array/)\n\nï¼ˆè¿™æ˜¯ä¸€ä¸ª **äº¤äº’å¼é—®é¢˜** ï¼‰\n\nç»™ä½ ä¸€ä¸ª **å±±è„‰æ•°ç»„** `mountainArr`ï¼Œè¯·ä½ è¿”å›èƒ½å¤Ÿä½¿å¾— `mountainArr.get(index)` **ç­‰äº** `target` **æœ€å°** çš„ä¸‹æ ‡ `index` å€¼ã€‚\n\nå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„ä¸‹æ ‡ `index`ï¼Œå°±è¯·è¿”å› `-1`ã€‚\n\nä½•ä¸ºå±±è„‰æ•°ç»„ï¼Ÿå¦‚æœæ•°ç»„ `A` æ˜¯ä¸€ä¸ªå±±è„‰æ•°ç»„çš„è¯ï¼Œé‚£å®ƒæ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\n\n**é¦–å…ˆ**ï¼Œ`A.length >= 3`\n\n**å…¶æ¬¡**ï¼Œåœ¨ `0 < i < A.length - 1` æ¡ä»¶ä¸‹ï¼Œå­˜åœ¨ `i` ä½¿å¾—ï¼š\n\n- `A[0] < A[1] < ... A[i-1] < A[i]`\n- `A[i] > A[i+1] > ... > A[A.length - 1]`\n\nä½ å°† **ä¸èƒ½ç›´æ¥è®¿é—®è¯¥å±±è„‰æ•°ç»„**ï¼Œå¿…é¡»é€šè¿‡ `MountainArray` æ¥å£æ¥è·å–æ•°æ®ï¼š\n\n- `MountainArray.get(k)` - ä¼šè¿”å›æ•°ç»„ä¸­ç´¢å¼•ä¸º`k` çš„å…ƒç´ ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰\n- `MountainArray.length()` - ä¼šè¿”å›è¯¥æ•°ç»„çš„é•¿åº¦\n\n**æ³¨æ„ï¼š**\n\nå¯¹ `MountainArray.get` å‘èµ·è¶…è¿‡ `100` æ¬¡è°ƒç”¨çš„æäº¤å°†è¢«è§†ä¸ºé”™è¯¯ç­”æ¡ˆã€‚æ­¤å¤–ï¼Œä»»ä½•è¯•å›¾è§„é¿åˆ¤é¢˜ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆéƒ½å°†ä¼šå¯¼è‡´æ¯”èµ›èµ„æ ¼è¢«å–æ¶ˆã€‚\n\nä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£äº¤äº’å¼é—®é¢˜ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªæ ·ä¾‹ â€œ**ç­”æ¡ˆ**â€ï¼š<https://leetcode-cn.com/playground/RKhe3ave>ï¼Œè¯·æ³¨æ„è¿™ **ä¸æ˜¯ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆ**ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šarray = [1,2,3,4,5,3,1], target = 3\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š3 åœ¨æ•°ç»„ä¸­å‡ºç°äº†ä¸¤æ¬¡ï¼Œä¸‹æ ‡åˆ†åˆ«ä¸º 2 å’Œ 5ï¼Œæˆ‘ä»¬è¿”å›æœ€å°çš„ä¸‹æ ‡ 2ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šarray = [0,1,2,4,2,1], target = 3\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼š3 åœ¨æ•°ç»„ä¸­æ²¡æœ‰å‡ºç°ï¼Œè¿”å› -1ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `3 <= mountain_arr.length() <= 10000`\n- `0 <= target <= 10^9`\n- `0 <= mountain_arr.get(index) <= 10^9`\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜ï¼Œï¼Œï¼Œå’‹è¯´å‘¢ï¼Œæ•°æ®å¤ªå¼±äº†ï¼Œé…ä¸ä¸Šhardé¢˜ï¼Œé¡¶å¤šç®—ä¸ªmidåç®€å•ï¼Œæ•°æ®å¤§çš„æ—¶å€™å¯ä»¥è€ƒè™‘åŠ ä¸Šç¼“å­˜ï¼Œè¿™æ ·å°±æ¯”è¾ƒæœ‰æ„æ€äº†ï¼Œè¿™é‡Œæˆ‘å°±æ‡’å¾—åŠ äº†ğŸ˜\n\n```go\nfunc findInMountainArray(target int, mountainArr *MountainArray) int {\n    n := mountainArr.length()\n    //å¯»æ‰¾å±±é¡¶\n    left := 0\n    right := n - 1\n    for left < right {\n        mid := left + (right-left)/2\n        //mid+1è‚¯å®šä¸ä¼šè¶Šç•Œ\n        if mountainArr.get(mid) < mountainArr.get(mid+1) {\n            left = mid + 1\n        } else {\n            right = mid\n        }\n    }\n    res := -1\n    res = binarySearchUp(mountainArr, target, 0, left)\n    if res == -1 {\n        res = binarySearchDown(mountainArr, target, left, n-1)\n    }\n    return res\n}\n\nfunc binarySearchUp(mountainArr *MountainArray, target, left, right int) int {\n    for left < right {\n        mid := left + (right-left)/2\n        if mountainArr.get(mid) < target {\n            left = mid + 1\n        } else {\n            right = mid\n        }\n    }\n    if mountainArr.get(left) == target {\n        return left\n    }\n    return -1\n}\n\nfunc binarySearchDown(mountainArr *MountainArray, target, left, right int) int {\n    for left < right {\n        mid := left + (right-left)/2\n        if mountainArr.get(mid) > target {\n            left = mid + 1\n        } else {\n            right = mid\n        }\n    }\n    if mountainArr.get(left) == target {\n        return left\n    }\n    return -1\n}\n```\n\nè¿™ä¸¤ä¸ªäºŒåˆ†æ˜¯å¯ä»¥åˆå¹¶çš„ï¼Œæ‡’å¾—åˆäº†ï¼ˆå¤ªæ‡’äº†å§ä½ ä¹ŸğŸ˜…ï¼‰\n\n**UPDATE: 2020.7.14**\n\nè‡ªå®šä¹‰å‡½æ•°ä¼ é€’ï¼Œç®€åŒ–ä»£ç \n```golang\nfunc findInMountainArray(target int, mA *MountainArray) int {\n    var n = mA.length()\n    var left = 0\n    var right = n-1\n    var maxIdx = right\n    for left <= right{\n        mid := left + (right-left)/2\n        //å·¦ä¸­ï¼Œæ‰€ä»¥mid+1ä¸ä¼šè¶Šç•Œ\n        if mA.get(mid) > mA.get(mid+1){\n            maxIdx = mid\n            right = mid - 1 \n        }else{\n            left = mid + 1\n        }\n    }\n    lr := search(mA, target, 0, maxIdx, func(i int, j int)bool{\n        return i <= j\n    })\n    if lr != -1{\n        return lr\n    }\n    return search(mA, target, maxIdx+1, n-1, func(i int, j int)bool{\n        return i >= j\n    })\n    \n}\n\nfunc search(mA *MountainArray, target int, left int, right int, less func(int, int)bool) int {\n    var res = left\n    for left <= right{\n        mid := left + (right-left)/2\n        if less(mA.get(mid), target){\n            res = mid\n            left = mid + 1\n        }else{\n            right = mid - 1\n        }\n    }\n    if mA.get(res) != target{\n        return -1\n    }\n    return res\n}\n```\n\n## [162. å¯»æ‰¾å³°å€¼](https://leetcode-cn.com/problems/find-peak-element/)\n\nå³°å€¼å…ƒç´ æ˜¯æŒ‡å…¶å€¼å¤§äºå·¦å³ç›¸é‚»å€¼çš„å…ƒç´ ã€‚\n\nç»™å®šä¸€ä¸ªè¾“å…¥æ•°ç»„ `nums`ï¼Œå…¶ä¸­ `nums[i] â‰  nums[i+1]`ï¼Œæ‰¾åˆ°å³°å€¼å…ƒç´ å¹¶è¿”å›å…¶ç´¢å¼•ã€‚\n\næ•°ç»„å¯èƒ½åŒ…å«å¤šä¸ªå³°å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›ä»»ä½•ä¸€ä¸ªå³°å€¼æ‰€åœ¨ä½ç½®å³å¯ã€‚\n\nä½ å¯ä»¥å‡è®¾ `nums[-1] = nums[n] = -âˆ`ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums = [1,2,3,1]\nè¾“å‡º: 2\nè§£é‡Š: 3 æ˜¯å³°å€¼å…ƒç´ ï¼Œä½ çš„å‡½æ•°åº”è¯¥è¿”å›å…¶ç´¢å¼• 2ã€‚\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums = [1,2,1,3,5,6,4]\nè¾“å‡º: 1 æˆ– 5 \nè§£é‡Š: ä½ çš„å‡½æ•°å¯ä»¥è¿”å›ç´¢å¼• 1ï¼Œå…¶å³°å€¼å…ƒç´ ä¸º 2ï¼›\n     æˆ–è€…è¿”å›ç´¢å¼• 5ï¼Œ å…¶å³°å€¼å…ƒç´ ä¸º 6ã€‚\n```\n\n\n**è¯´æ˜:**\n\nä½ çš„è§£æ³•åº”è¯¥æ˜¯ `O(logN)` æ—¶é—´å¤æ‚åº¦çš„ã€‚\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®æŒ‘æ˜äº†logNçš„å¤æ‚åº¦ï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯äºŒåˆ†äº†ï¼Œé‚£æ˜¯æ€ä¹ˆä¸ªäºŒåˆ†çš„æ€è·¯å‘¢ï¼Ÿé¢˜ç›®å…¶å®ä¹Ÿè¯´äº†å¾ˆæ¸…æ¥šäº†ï¼Œè¾¹ç•Œçš„å·¦å³ä¸¤è¾¹éƒ½æ˜¯`-âˆ` æ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŒ‰ç…§é€’å¢çš„å»æœï¼Œæœ€åè‚¯å®šèƒ½æœç´¢åˆ°å³°å€¼\n\n```java\npublic int findPeakElement(int[] nums) {\n    int left=0,right=nums.length-1;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(/*mid+1<nums.length &&*/nums[mid]<nums[mid+1]){\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    return left;\n}\n```\nliweiweiå¤§ä½¬çš„äºŒåˆ†æ¨¡æ¿çœŸå¥½ç”¨ï¼ï¼ï¼\n\n## [74. æœç´¢äºŒç»´çŸ©é˜µ](https://leetcode-cn.com/problems/search-a-2d-matrix/)\n\nç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥åˆ¤æ–­ `m x n` çŸ©é˜µä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å€¼ã€‚è¯¥çŸ©é˜µå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š\n\næ¯è¡Œä¸­çš„æ•´æ•°ä»å·¦åˆ°å³æŒ‰å‡åºæ’åˆ—ã€‚\næ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºå‰ä¸€è¡Œçš„æœ€åä¸€ä¸ªæ•´æ•°ã€‚\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\nmatrix = [\n  [1,   3,  5,  7],\n  [10, 11, 16, 20],\n  [23, 30, 34, 50]\n]\ntarget = 3\nè¾“å‡º: true\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\nmatrix = [\n  [1,   3,  5,  7],\n  [10, 11, 16, 20],\n  [23, 30, 34, 50]\n]\ntarget = 13\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic boolean searchMatrix(int[][] matrix, int target) {\n    if(matrix==null || matrix.length<=0 || matrix[0].length<=0){\n        return false;\n    }\n    int m=matrix.length;\n    int n=matrix[0].length;\n    int low=0,high=m-1;\n    if (target>matrix[m-1][n-1] || target < matrix[0][0]) {\n        return false;\n    }\n    while(low<=high){ //äºŒåˆ†ç¡®å®šåœ¨å“ªä¸€è¡Œ\n        int mid=low+(high-low)/2;\n        if (target == matrix[mid][0]) {\n            return true;\n        }else if(matrix[mid][0]<target){\n            low=mid+1;\n        }else{\n            high=mid-1;\n        }\n    }\n    int column=low!=0?low-1:low;\n    low=0;\n    high=n-1;\n    while(low<high){\n        int mid=low+(high-low)/2;\n        if (matrix[column][mid]==target) {\n            return true;\n        }else if(matrix[column][mid] < target){\n            low=mid+1; \n        }else{\n            high=mid-1;\n        }\n    }\n    return target==matrix[column][low];\n}\n```\n\nğŸ˜”ï¼Œè¿™é¢˜waäº†11æ¬¡ï¼Œæ˜¯çš„ï¼Œ11æ¬¡ï¼Œå¯æƒ³è€ŒçŸ¥æˆ‘æœ‰å¤šå½©ï¼Œæœ€åå†™å‡ºæ¥çš„è§£æ³•è¿˜æ˜¯å¦‚æ­¤çš„éš¾çœ‹ï¼Œä¸»è¦å°±æ˜¯åœ¨ç¡®å®šåœ¨å“ªä¸€è¡Œçš„æ—¶å€™å†™å‡ºäº†å¥½å¤šé—®é¢˜ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä¸Šä¸‹çš„ä¸¤ç§äºŒåˆ†æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰æœŸå°±æªç€ä¸€ç§å†™ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ¿å­å†™ï¼Œç»“æœå†™å‡ºäº†ä¸€å †bug... ä»¥åå†™äºŒåˆ†è¿˜æ˜¯è¦æ³¨æ„å•Šï¼Œ1sç¡®å®šæ€è·¯ï¼Œä»£ç å†™äº†3hã€‚ã€‚ã€‚ã€‚\n\n**è§£æ³•äºŒ**\n\nçœ‹äº†è¯„è®ºåŒºå†™å‡ºæ¥çš„ï¼Œåˆ©ç”¨å–æ¨¡å’Œé™¤å°†äºŒç»´æ•°ç»„æ‹‰æˆä¸€ç»´çš„ï¼Œç›¸å½“çš„ä¼˜ç§€ï¼Œä¹Ÿä¸ç”¨è€ƒè™‘é‚£äº›è¾¹ç•Œï¼Œæ—¶é—´å¤æ‚åº¦å’Œä¸Šé¢ä¸€æ ·`log(nm)` \n\n```java\npublic boolean searchMatrix(int[][] matrix, int target) {\n    if(matrix==null || matrix.length<=0 || matrix[0].length<=0){\n        return false;\n    }\n    int m=matrix.length;\n    int n=matrix[0].length;\n    int left=0,right=m*n-1;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(matrix[mid/n][mid%n]<target){\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    return matrix[left/n][left%n]==target;\n}\n```\n\n## [240. æœç´¢äºŒç»´çŸ©é˜µ II](https://leetcode-cn.com/problems/search-a-2d-matrix-ii/)\n\nç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥æœç´¢ m x n çŸ©é˜µ matrix ä¸­çš„ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯¥çŸ©é˜µå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\n\n- æ¯è¡Œçš„å…ƒç´ ä»å·¦åˆ°å³å‡åºæ’åˆ—ã€‚\n- æ¯åˆ—çš„å…ƒç´ ä»ä¸Šåˆ°ä¸‹å‡åºæ’åˆ—ã€‚\n\n**ç¤ºä¾‹:**\nç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š\n\n```java\n[\n  [1,   4,  7, 11, 15],\n  [2,   5,  8, 12, 19],\n  [3,   6,  9, 16, 22],\n  [10, 13, 14, 17, 24],\n  [18, 21, 23, 26, 30]\n]\n```\n\nç»™å®š target = `5`ï¼Œè¿”å› `true`ã€‚\n\nç»™å®š target = `20`ï¼Œè¿”å› `false`ã€‚\n\n**è§£æ³•ä¸€**\n\nçœ‹ä¸Šä¸€é¢˜ [240. æœç´¢äºŒç»´çŸ©é˜µ](https://leetcode-cn.com/problems/search-a-2d-matrix/)  çš„è¯„è®ºåŒºçš„æ—¶å€™çœ‹åˆ°äº†è¿™ç§è§£æ³•\n\n```java\npublic boolean searchMatrix(int[][] matrix, int target) {\n    if(matrix==null || matrix.length<=0 || matrix[0].length<=0){\n        return false;\n    }\n    int m=matrix.length;\n    int n=matrix[0].length;\n    int  column=0,row=m-1;\n    while(column<n && row>=0){\n        //System.out.println(row+\",\"+column);\n        if (matrix[row][column]==target) {\n            return true;\n        }\n        if (matrix[row][column] > target) {\n            row--;\n        }else{\n            column++;\n        }\n    }\n    return false;\n}\n```\næ•´ä¸ªçŸ©é˜µä»å·¦ä¸Šåˆ°å³ä¸‹ï¼Œå…¶å®å°±åˆ†ä¸ºäº†ä¸¤å—ï¼Œæ¯ä¸ªå…ƒç´ çš„å·¦ä¸Šä¸€å®šå°äºå½“å‰å…ƒç´ ï¼Œå³ä¸‹ä¸€å®šå¤§äºå½“å‰å…ƒç´ ï¼Œè¿™é¢˜ä¹Ÿå¯ä»¥äºŒåˆ†ï¼Œå°±åƒä¸‹é¢çš„[1351. ç»Ÿè®¡æœ‰åºçŸ©é˜µä¸­çš„è´Ÿæ•°](#1351-ç»Ÿè®¡æœ‰åºçŸ©é˜µä¸­çš„è´Ÿæ•°)ä¸€æ ·ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦ä¼šé«˜ä¸€äº›\n\n## [1351. ç»Ÿè®¡æœ‰åºçŸ©é˜µä¸­çš„è´Ÿæ•°](https://leetcode-cn.com/problems/count-negative-numbers-in-a-sorted-matrix/)\n\nDifficulty: **ç®€å•**\n\n\nç»™ä½ ä¸€ä¸ªÂ `mÂ * n`Â çš„çŸ©é˜µÂ `grid`ï¼ŒçŸ©é˜µä¸­çš„å…ƒç´ æ— è®ºæ˜¯æŒ‰è¡Œè¿˜æ˜¯æŒ‰åˆ—ï¼Œéƒ½ä»¥éé€’å¢é¡ºåºæ’åˆ—ã€‚Â \n\nè¯·ä½ ç»Ÿè®¡å¹¶è¿”å›Â `grid`Â ä¸­ **è´Ÿæ•°** çš„æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[4,3,2,-1],[3,2,1,-1],[1,1,-1,-2],[-1,-1,-2,-3]]\nè¾“å‡ºï¼š8\nè§£é‡Šï¼šçŸ©é˜µä¸­å…±æœ‰ 8 ä¸ªè´Ÿæ•°ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[3,2],[1,0]]\nè¾“å‡ºï¼š0\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[1,-1],[-1,-1]]\nè¾“å‡ºï¼š3\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[-1]]\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n*   `m == grid.length`\n*   `n == grid[i].length`\n*   `1 <= m, n <= 100`\n*   `-100 <= grid[i][j] <= 100`\n\n\n**è§£æ³•ä¸€**\n\næ²¡å•¥å¥½è¯´çš„ï¼Œå’Œä¸Šé¢çš„è§£æ³•ä¸€æ ·ï¼Œä»å·¦ä¸‹è§’å‘ä¸Šæœç´¢\n```golang\nfunc countNegatives(grid [][]int) int {\n Â  Â if len(grid) <= 0 {\n Â  Â  Â  Â return 0\n Â   }\n Â  Â var m, n = len(grid), len(grid[0])\n Â  Â var count = 0\n Â  Â var i, j = m-1, 0\n Â  Â for i >= 0 && j < n {\n Â  Â  Â  Â if grid[i][j] < 0 {\n Â  Â  Â  Â  Â  Â count += n - j\n Â  Â  Â  Â  Â  Â i--\n Â  Â  Â   }else{\n Â  Â  Â  Â  Â  Â j++\n Â  Â  Â   }\n Â   }\n Â  Â return count;\n}\n```\n\n**è§£æ³•äºŒ**\n\nO(mlogn)è§£æ³•\n\n```golang\n//O(mlogn) åªåˆ©ç”¨äº†è¡Œé€†åºçš„æ¡ä»¶\nfunc countNegatives(grid [][]int) int {\n    if len(grid) <= 0 {\n        return 0\n    }\n    var count = 0\n    var m = len(grid)\n    var n = len(grid[0])\n    for i := 0; i < m; i++ {\n        count += (n - search(grid[i]))\n    }\n    return count\n}\n\nfunc search(nums []int) int {\n    var left = 0\n    var right = len(nums)-1\n    var res = right+1\n    for left <= right {\n        mid := left + (right-left)/2\n        if nums[mid] < 0 {\n            res = mid\n            right = mid - 1\n        }else{\n            left = mid + 1\n        }\n    }\n    return res\n}\n```\n\n## [4. å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°](https://leetcode-cn.com/problems/median-of-two-sorted-arrays/)\n\nç»™å®šä¸¤ä¸ªå¤§å°ä¸º m å’Œ n çš„æœ‰åºæ•°ç»„ `nums1` å’Œ `nums2`ã€‚\n\nè¯·ä½ æ‰¾å‡ºè¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œå¹¶ä¸”è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(log(m + n))`ã€‚\n\nä½ å¯ä»¥å‡è®¾ `nums1` å’Œ `nums2` ä¸ä¼šåŒæ—¶ä¸ºç©ºã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nnums1 = [1, 3]\nnums2 = [2]\n\nåˆ™ä¸­ä½æ•°æ˜¯ 2.0\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nnums1 = [1, 2]\nnums2 = [3, 4]\n\nåˆ™ä¸­ä½æ•°æ˜¯ (2 + 3)/2 = 2.5\n```\n\n**è§£æ³•ä¸€**\n\nHardé¢˜ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯å½’å¹¶ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦ä¸ç¬¦åˆè¦æ±‚ï¼Œæœ€ä½è¦æ±‚ `O(log(m+n))`ï¼Œæƒ³äº†å¥½ä¸€ä¼šå„¿å®åœ¨æ˜¯æƒ³ä¸å‡ºæ¥ï¼ˆèœï¼‰ç„¶åçœ‹äº†è¯„è®ºåŒºçš„è§£æ³•\n\n```java\n//find nums1+nums2 /2 å¤§çš„æ•°\npublic double findMedianSortedArrays(int[] nums1, int[] nums2) {\n    int m=nums1.length;\n    int n=nums2.length;\n    int leftMid=(m+n+1)/2;\n    int rightMid=(m+n+2)/2;\n    return (findMedian(nums1,0,m-1,nums2,0,n-1,leftMid) + findMedian(nums1,0,m-1,nums2,0,n-1,rightMid)) * 0.5;\n}\n//    i\n//1 2 3 5\n//    j\n//1 2 4 6 7 8 9     k=6 find k/2=3\n//\n//        i\n//*1 2 3* 5\n//  j  \n//1 2 4 6 7 8 9     k=3 find k/2=1  res=4\npublic double findMedian(int[] nums1,int left1,int right1, int[] nums2,int left2,int right2,int k) {\n    int len1=right1-left1+1;\n    int len2=right2-left2+1;\n    if (len1==0) {\n        return nums2[left2+k-1];\n    }\n    if (len2==0) {\n        return nums1[left1+k-1];\n    }\n    if (k==1) {\n        return Math.min(nums1[left1],nums2[left2]);\n    }\n    int i=left1+Math.min(len1,k/2)-1;\n    int j=left2+Math.min(len2,k/2)-1;\n    if (nums1[i] < nums2[j]) {\n        return findMedian(nums1,i+1,right1,nums2,left2,right2,k-(i-left1+1));\n    }else{\n        return findMedian(nums1,left1,right1,nums2,j+1,right2,k-(j-left2+1));\n    }\n}\n```\nè¿™ç§è§£æ³•è¿˜æ˜¯æŒºå¦™çš„ï¼Œæ±‚ç¬¬kå°çš„æ€è·¯ï¼Œä¸¤ä¸ªæ•°ç»„éƒ½æ˜¯æœ‰åºçš„ï¼Œæˆ‘ä»¬è¦æ±‚ç¬¬kå°ï¼Œæˆ‘ä»¬å¯ä»¥å°†kä¸€åˆ†ä¸ºäºŒï¼Œçœ‹çœ‹ä¸¤ä¸ªæ•°ç»„çš„ `k/2` ä½ç½®çš„å…ƒç´ å“ªä¸ªå¤§å“ªä¸ªå°ï¼Œå°çš„å“ªä¸ªæ•°ç»„å‰ `k/2` ä¸ªå…ƒç´ å°±å¯ä»¥ç›´æ¥æ’é™¤æ‰ï¼Œå› ä¸ºä»–ä»¬å¿…ä¸å¯èƒ½æ˜¯ç¬¬kå°çš„å…ƒç´ ï¼Œä¸¾ä¸ªä¾‹å­å°±å¾ˆå®¹æ˜“ç†è§£\n\n```java\n1 2 3 5\n1 2 4 6 7 8 9  k=6\nk/2=3,åˆ†åˆ«åœ¨ä¸¤æ•°ç»„ä¸­æ‰¾ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œä¹Ÿå³æ˜¯3ï¼Œ4æ˜æ˜¾3æ¯”è¾ƒå°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥æ’é™¤ç¬¬ä¸€ä¸ªæ•°ç»„çš„1ï¼Œ2ï¼Œ3ä¸‰ä¸ªå…ƒç´ ï¼Œä»–ä»¬å¿…ä¸å¯èƒ½æ˜¯ç¬¬kå°çš„å…ƒç´ ï¼\n*1 2 3* 5\n1 2 4 6 7 8 9  k=3\n```\n\nç„¶åé‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œæ¯æ¬¡æ’é™¤`k/2` çš„å…ƒç´ ï¼Œæœ€ååœ¨`log(k)` çš„æ—¶é—´å¤æ‚åº¦ä¸‹å°±èƒ½æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„çš„midï¼Œè€Œè¿™é‡Œ`k=(m+n+1)/2` æ‰€ä»¥æ˜¯ç¬¦åˆé¢˜ç›®è¦æ±‚çš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¥‡æ•°å’Œå¶æ•°çš„æƒ…å†µï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åˆ†åˆ«è®¡ç®—ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ±‚ä¸€ä¸‹å·¦ä¸­ä½æ•°å’Œå³ä¸­ä½æ•°ï¼Œå¦‚æœæ˜¯å¥‡æ•°å·¦ä¸­å’Œå³ä¸­å°±æ˜¯åŒä¸€ä¸ª`(k)/2==(k+1)/2` ï¼Œå¶æ•°çš„è¯å°±æ˜¯`(k)/2`å’Œ`(k+1)/2`åˆ†åˆ«å°±æ˜¯å·¦ä¸­å’Œå³ä¸­ï¼Œç„¶åæˆ‘ä»¬ç›´æ¥/2å°±å¾—åˆ°äº†è§£\n\n## [658. æ‰¾åˆ° K ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ ](https://leetcode-cn.com/problems/find-k-closest-elements/)\n\nç»™å®šä¸€ä¸ªæ’åºå¥½çš„æ•°ç»„ï¼Œä¸¤ä¸ªæ•´æ•° `k` å’Œ `x`ï¼Œä»æ•°ç»„ä¸­æ‰¾åˆ°æœ€é è¿‘ `x`ï¼ˆä¸¤æ•°ä¹‹å·®æœ€å°ï¼‰çš„ `k` ä¸ªæ•°ã€‚è¿”å›çš„ç»“æœå¿…é¡»è¦æ˜¯æŒ‰å‡åºæ’å¥½çš„ã€‚å¦‚æœæœ‰ä¸¤ä¸ªæ•°ä¸ `x` çš„å·®å€¼ä¸€æ ·ï¼Œä¼˜å…ˆé€‰æ‹©æ•°å€¼è¾ƒå°çš„é‚£ä¸ªæ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3,4,5], k=4, x=3\nè¾“å‡º: [1,2,3,4]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,2,3,4,5], k=4, x=-1\nè¾“å‡º: [1,2,3,4]\n```\n\n**è¯´æ˜:**\n\n1. k çš„å€¼ä¸ºæ­£æ•°ï¼Œä¸”æ€»æ˜¯å°äºç»™å®šæ’åºæ•°ç»„çš„é•¿åº¦ã€‚\n2. æ•°ç»„ä¸ä¸ºç©ºï¼Œä¸”é•¿åº¦ä¸è¶…è¿‡ 104\n3. æ•°ç»„é‡Œçš„æ¯ä¸ªå…ƒç´ ä¸ x çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 104\n\n**è§£æ³•ä¸€**\n\nåŒæŒ‡é’ˆï¼Œå°‘ç‚¹å¥—è·¯ï¼Œå¤šç‚¹çœŸè¯š\n\n```java\npublic List<Integer> findClosestElements(int[] arr, int k, int x) {\n    int left=0,right=arr.length-1;\n    int count=0;\n    while(left<right){\n        if(Math.abs(arr[left]-x)<=Math.abs(arr[right]-x)){\n            right--;\n        }else{\n            left++;\n        }\n        count++;\n        if(count==arr.length-k) break;\n    }\n    List<Integer> res=new ArrayList<>();\n    for(int i=left;i<=right;i++) res.add(arr[i]);\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\näºŒåˆ†çš„è§£æ³•ï¼Œæœ‰ç‚¹trickï¼Œä¸å®¹æ˜“æƒ³åˆ°ï¼Œå‚è€ƒ[é¢˜è§£](https://leetcode-cn.com/problems/find-k-closest-elements/solution/pai-chu-fa-shuang-zhi-zhen-er-fen-fa-python-dai-ma/)\n\n```java\npublic List<Integer> findClosestElements(int[] arr, int k, int x) {\n    //å·¦è¾¹ç•Œçš„å–å€¼èŒƒå›´\n    int left=0,right=arr.length-k;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(x-arr[mid]>arr[mid+k]-x){\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    List<Integer> res=new ArrayList<>();\n    for(int i=left;i<left+k;i++) res.add(arr[i]);\n    return res;   \n}\n```\n## [367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°](https://leetcode-cn.com/problems/valid-perfect-square/)\n\nDifficulty: **ç®€å•**\n\n\nç»™å®šä¸€ä¸ªæ­£æ•´æ•° _num_ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœ _num_ æ˜¯ä¸€ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚\n\n**è¯´æ˜ï¼š**ä¸è¦ä½¿ç”¨ä»»ä½•å†…ç½®çš„åº“å‡½æ•°ï¼Œå¦‚Â  `sqrt`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š16\nè¾“å‡ºï¼šTrue\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š14\nè¾“å‡ºï¼šFalse\n```\n\n**è§£æ³•ä¸€**\n\näºŒåˆ†\n```golang\nfunc isPerfectSquare(num int) bool {\n    var left = 0\n    var right = num\n    var res = num + 1\n    for left <= right {\n        mid := left + (right-left)/2\n        if mid*mid >= num {\n            res = mid\n            right = mid - 1\n        } else {\n            left = mid + 1\n        }\n    }\n    return res*res == num\n}\n```\n\n**è§£æ³•äºŒ**\n\nå®Œå…¨å¹³æ–¹æ•°çš„æ€§è´¨\n```golang\n//å®Œå…¨å¹³æ–¹æ•°æ€§è´¨ n^2 = 1 + 3 + 5 +...+2n+1 (å‰nä¸ªå¥‡æ•°çš„å’Œ)\n//æ‰€ä»¥åªéœ€è¦åˆ¤æ–­numèƒ½ä¸èƒ½è¢«å¥‡æ•°å‡æˆ0å°±è¡Œäº†\nfunc isPerfectSquare(num int) bool {\n    var i = 1\n    for num > 0 {\n        num -= i\n        i += 2\n    }\n    return num == 0\n}\n```\n\n## [475. ä¾›æš–å™¨](https://leetcode-cn.com/problems/heaters/)\n\nDifficulty: **ç®€å•**\n\n\nå†¬å­£å·²ç»æ¥ä¸´ã€‚Â ä½ çš„ä»»åŠ¡æ˜¯è®¾è®¡ä¸€ä¸ªæœ‰å›ºå®šåŠ çƒ­åŠå¾„çš„ä¾›æš–å™¨å‘æ‰€æœ‰æˆ¿å±‹ä¾›æš–ã€‚\n\nç°åœ¨ï¼Œç»™å‡ºä½äºä¸€æ¡æ°´å¹³çº¿ä¸Šçš„æˆ¿å±‹å’Œä¾›æš–å™¨çš„ä½ç½®ï¼Œæ‰¾åˆ°å¯ä»¥è¦†ç›–æ‰€æœ‰æˆ¿å±‹çš„æœ€å°åŠ çƒ­åŠå¾„ã€‚\n\næ‰€ä»¥ï¼Œä½ çš„è¾“å…¥å°†ä¼šæ˜¯æˆ¿å±‹å’Œä¾›æš–å™¨çš„ä½ç½®ã€‚ä½ å°†è¾“å‡ºä¾›æš–å™¨çš„æœ€å°åŠ çƒ­åŠå¾„ã€‚\n\n**è¯´æ˜:**\n\n1.  ç»™å‡ºçš„æˆ¿å±‹å’Œä¾›æš–å™¨çš„æ•°ç›®æ˜¯éè´Ÿæ•°ä¸”ä¸ä¼šè¶…è¿‡ 25000ã€‚\n2.  ç»™å‡ºçš„æˆ¿å±‹å’Œä¾›æš–å™¨çš„ä½ç½®å‡æ˜¯éè´Ÿæ•°ä¸”ä¸ä¼šè¶…è¿‡10^9ã€‚\n3.  åªè¦æˆ¿å±‹ä½äºä¾›æš–å™¨çš„åŠå¾„å†…(åŒ…æ‹¬åœ¨è¾¹ç¼˜ä¸Š)ï¼Œå®ƒå°±å¯ä»¥å¾—åˆ°ä¾›æš–ã€‚\n4.  æ‰€æœ‰ä¾›æš–å™¨éƒ½éµå¾ªä½ çš„åŠå¾„æ ‡å‡†ï¼ŒåŠ çƒ­çš„åŠå¾„ä¹Ÿä¸€æ ·ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```golang\nè¾“å…¥: [1,2,3],[2]\nè¾“å‡º: 1\nè§£é‡Š: ä»…åœ¨ä½ç½®2ä¸Šæœ‰ä¸€ä¸ªä¾›æš–å™¨ã€‚å¦‚æœæˆ‘ä»¬å°†åŠ çƒ­åŠå¾„è®¾ä¸º1ï¼Œé‚£ä¹ˆæ‰€æœ‰æˆ¿å±‹å°±éƒ½èƒ½å¾—åˆ°ä¾›æš–ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```golang\nè¾“å…¥: [1,2,3,4],[1,4]\nè¾“å‡º: 1\nè§£é‡Š: åœ¨ä½ç½®1, 4ä¸Šæœ‰ä¸¤ä¸ªä¾›æš–å™¨ã€‚æˆ‘ä»¬éœ€è¦å°†åŠ çƒ­åŠå¾„è®¾ä¸º1ï¼Œè¿™æ ·æ‰€æœ‰æˆ¿å±‹å°±éƒ½èƒ½å¾—åˆ°ä¾›æš–ã€‚\n```\n\n\n**è§£æ³•ä¸€**\n\nè¿™ä¸ªé¢˜ç›®æ„Ÿè§‰ä¸æ˜¯easyå•Šï¼Œä¸€å¼€å§‹æƒ³åŠˆå‰äº†ï¼Œä»¥ä¸ºæ˜¯äºŒåˆ†ç­”æ¡ˆï¼Œå†™äº†åŠå¤©åæ¥WAåœ¨ä¸€ä¸ªå¾ˆå¤§çš„caseï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯æº¢å‡ºäº†ï¼Œæ”¹äº†åŠå¤©çš„bugæ²¡æ”¹å‡ºæ¥ã€‚ã€‚ã€‚åæ¥è‡ªå·±æŒ‰ç…§caseçš„è§„å¾‹æ„å»ºäº†ä¸€ä¸ªå°çš„caseï¼Œå‘ç°ä¹ŸWAäº†ï¼Œç„¶åæ‰æ„è¯†åˆ°æ˜¯æ–¹æ³•é”™äº†, (case: [4,9] [4,8])ï¼Œè¿™ä¸ªcaseæŒ‰ç…§äºŒåˆ†ç­”æ¡ˆçš„æ€è·¯å°±æ˜¯é”™çš„ï¼ŒäºŒåˆ†ç­”æ¡ˆæ˜¯æ€è·¯å°±æ˜¯éªŒè¯è¯¥åŠå¾„ä¸‹èƒ½å¦è¦†ç›–æ•´ä¸ªåŒºé—´ï¼Œå…¶å®ä¹Ÿæ˜¯é¢˜ç›®ç†è§£æœ‰ç‚¹é—®é¢˜ï¼Œé¢˜ç›®çš„è¦æ±‚æ˜¯**è¦†ç›–æ¯ä¸ªæˆ¿å­**ï¼Œè€Œ**ä¸æ˜¯è¦†ç›–æ•´ä¸ªåŒºé—´**ï¼Œæ‰€ä»¥åªéœ€è¦æ‰¾åˆ°æ¯ä¸ªæˆ¿å­æœ€è¿‘çš„ä¾›æš–å™¨å°±è¡Œäº†ï¼Œç„¶åç»Ÿè®¡è¿™äº›æœ€å°å€¼å¾—æœ€å¤§å€¼å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„åŠå¾„\n\n```golang\nfunc findRadius(houses []int, heaters []int) int {\n    //è¾¹ç•Œå¤„ç†\n Â  Â heaters = append(heaters, math.MaxInt32)\n Â  Â heaters = append(heaters, math.MinInt32)\n Â  Â sort.Ints(heaters)\n Â  Â var Min = func (a, b int) int { if a < b {return a}; return b}\n Â  Â var Max = func (a, b int) int { if a < b {return b}; return a}\n Â  Â var res = 0\n Â  Â for _, h := range houses{\n Â  Â  Â  Â left := search(heaters, h)\n Â  Â  Â  Â res = Max(res, Min(h-heaters[left], heaters[left+1]-h))\n Â   }\n Â  Â return res\n}\nâ€‹\n//targetå·¦è¾¹æœ€è¿‘çš„ä¸€ä¸ª\nfunc search(heaters []int, target int) int {\n Â  Â var left, right = 0, len(heaters)-1\n Â  Â var res = left //å·¦è¾¹æ²¡æœ‰ä¾›æš–å™¨\n Â  Â for left <= right {\n Â  Â  Â  Â mid := left + (right-left)/2\n Â  Â  Â  Â if heaters[mid] <= target{\n Â  Â  Â  Â  Â  Â res = mid\n Â  Â  Â  Â  Â  Â left = mid + 1\n Â  Â  Â   }else{\n Â  Â  Â  Â  Â  Â right = mid - 1\n Â  Â  Â   }\n Â   }\n Â  Â return res\n}\n```\nå¦ä¸€ç§å†™æ³•ï¼Œä¸é¢å¤–å¤„ç†è¾¹ç•Œï¼Œä¹Ÿæ˜¯ä¸€å¼€å§‹çš„å†™æ³•\n```golang\nfunc findRadius(houses []int, heaters []int) int {\n    sort.Ints(heaters)\n    var n = len(heaters)\n    var Min = func (a, b int) int { if a < b {return a}; return b}\n    var Max = func (a, b int) int { if a < b {return b}; return a}\n    var res = 0\n    for _, h := range houses{\n        left := search(heaters, h)\n        if left == -1{ //å…¨éƒ¨å¤§äºhourse,å–æœ€å°çš„é‚£ä¸ª\n            res = Max(res, heaters[0]-h)\n        }else if left+1 < n{\n            res = Max(res, Min(h-heaters[left], heaters[left+1]-h))\n        }else{\n            res = Max(res, h-heaters[left])\n        }\n    }\n    return res\n}\n\n//targetå·¦è¾¹æœ€è¿‘çš„ä¸€ä¸ª\nfunc search(heaters []int, target int) int {\n    var left, right = 0, len(heaters)-1\n    var res = -1 //å·¦è¾¹æ²¡æœ‰ä¾›æš–å™¨\n    for left <= right {\n        mid := left + (right-left)/2\n        if heaters[mid] <= target{\n            res = mid\n            left = mid + 1\n        }else{\n            right = mid - 1\n        }\n    }\n    return res\n}\n```\næ—¶é—´å¤æ‚åº¦ç»†çœ‹çš„è¯åº”è¯¥æ˜¯ `O(MlogM + MlogN)`ï¼ˆMï¼ŒNåˆ†åˆ«ä»£è¡¨houseså’Œheatersçš„é•¿åº¦ï¼‰\n\n**è§£æ³•äºŒ**\n\nåŒæŒ‡é’ˆï¼Œæ—¶é—´å¤æ‚åº¦å·®åˆ«ä¸å¤§\n```golang\nfunc findRadius(houses []int, heaters []int) int {\n    heaters = append(heaters, math.MaxInt32)\n    heaters = append(heaters, math.MinInt32)\n    sort.Ints(heaters)\n    sort.Ints(houses)\n    var n = len(heaters)\n    var Min = func (a, b int) int { if a < b {return a}; return b}\n    var Max = func (a, b int) int { if a < b {return b}; return a}\n    var res = 0\n    var left = 0\n    for _, h := range houses {\n        for left < n && heaters[left] < h {\n            left++\n        }\n        res = Max(res, Min(heaters[left]-h, h-heaters[left-1]))\n    }\n    return res\n}\n```\næ—¶é—´å¤æ‚åº¦ç»†çœ‹çš„è¯åº”è¯¥æ˜¯ `O(NlogN + MlogM + N + M)`ï¼ˆMï¼ŒNåˆ†åˆ«ä»£è¡¨houseså’Œheatersçš„é•¿åº¦ï¼‰ï¼Œå·®åˆ«ä¸å¤§ï¼Œä¸è¿‡å¾ˆæ˜æ˜¾åŒæŒ‡é’ˆçš„å¥½å†™å¾ˆå¤š\n\n## _äºŒåˆ†ç­”æ¡ˆ_\n\n## [1283. ä½¿ç»“æœä¸è¶…è¿‡é˜ˆå€¼çš„æœ€å°é™¤æ•°](https://leetcode-cn.com/problems/find-the-smallest-divisor-given-a-threshold/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ­£æ•´æ•° `threshold`  ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªæ­£æ•´æ•°ä½œä¸ºé™¤æ•°ï¼Œç„¶åå°†æ•°ç»„é‡Œæ¯ä¸ªæ•°éƒ½é™¤ä»¥å®ƒï¼Œå¹¶å¯¹é™¤æ³•ç»“æœæ±‚å’Œã€‚\n\nè¯·ä½ æ‰¾å‡ºèƒ½å¤Ÿä½¿ä¸Šè¿°ç»“æœå°äºç­‰äºé˜ˆå€¼ `threshold` çš„é™¤æ•°ä¸­ æœ€å° çš„é‚£ä¸ªã€‚\n\næ¯ä¸ªæ•°é™¤ä»¥é™¤æ•°åéƒ½å‘ä¸Šå–æ•´ï¼Œæ¯”æ–¹è¯´ 7/3 = 3 ï¼Œ 10/2 = 5 ã€‚\n\né¢˜ç›®ä¿è¯ä¸€å®šæœ‰è§£ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [1,2,5,9], threshold = 6\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šå¦‚æœé™¤æ•°ä¸º 1 ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å’Œä¸º 17 ï¼ˆ1+2+5+9ï¼‰ã€‚\nå¦‚æœé™¤æ•°ä¸º 4 ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å’Œä¸º 7 (1+1+2+3) ã€‚å¦‚æœé™¤æ•°ä¸º 5 ï¼Œå’Œä¸º 5 (1+1+1+2)ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [2,3,5,7,11], threshold = 11\nè¾“å‡ºï¼š3\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [19], threshold = 5\nè¾“å‡ºï¼š4\n```\n\n**æç¤ºï¼š**\n\n- `1 <= nums.length <= 5 * 10^4`\n- `1 <= nums[i] <= 10^6`\n- `nums.length <= threshold <= 10^6`\n\n**è§£æ³•ä¸€**\n\nå‘¨èµ›çš„é¢˜ï¼Œå¤ªè ¢äº†ï¼Œæ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚ã€‚\n\n```java\npublic int smallestDivisor(int[] nums, int threshold) {\n    int left=1,right=1000000;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        int sum=0;\n        for (int i=0;i<nums.length;i++) {\n            sum+=(nums[i]+mid-1)/mid; //å‘ä¸Šå–æ•´\n        }\n        if (sum>threshold) {\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    return left;\n}\n```\nå…¶å®åªè¦æ˜ç¡®ä¸€ç‚¹è¿™é¢˜å°±å¾ˆå®¹æ˜“æƒ³åˆ°äºŒåˆ†ï¼Œè§£ç©ºé—´ä¸ºï¼š`[1ï¼Œmax(nums[i])]` æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªåŒºé—´ä¹‹å†…åšäºŒåˆ†æœç´¢å°±okäº†ï¼Œå†ç„¶åå°±æ˜¯å‘ä¸Šå–æ•´çš„ä¸€ä¸ªå°æŠ€å·§\n\n## [287. å¯»æ‰¾é‡å¤æ•°](https://leetcode-cn.com/problems/find-the-duplicate-number/)\n\nç»™å®šä¸€ä¸ªåŒ…å« n + 1 ä¸ªæ•´æ•°çš„æ•°ç»„ `nums`ï¼Œå…¶æ•°å­—éƒ½åœ¨ 1 åˆ° n ä¹‹é—´ï¼ˆåŒ…æ‹¬ 1 å’Œ nï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚å‡è®¾åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•´æ•°ï¼Œæ‰¾å‡ºè¿™ä¸ªé‡å¤çš„æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,3,4,2,2]\nè¾“å‡º: 2\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [3,1,3,4,2]\nè¾“å‡º: 3\n```\n\n\n**è¯´æ˜ï¼š**\n\n- ä¸èƒ½æ›´æ”¹åŸæ•°ç»„ï¼ˆå‡è®¾æ•°ç»„æ˜¯åªè¯»çš„ï¼‰ã€‚\n- åªèƒ½ä½¿ç”¨é¢å¤–çš„ O(1) çš„ç©ºé—´ã€‚\n- æ—¶é—´å¤æ‚åº¦å°äº O(n2) ã€‚\n- æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªé‡å¤çš„æ•°å­—ï¼Œä½†å®ƒå¯èƒ½ä¸æ­¢é‡å¤å‡ºç°ä¸€æ¬¡ \n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œé¢˜ç›®è¦æ±‚äº†æ•°ç»„numsæ˜¯åªè¯»çš„ï¼Œä¸”ä¸èƒ½ä½¿ç”¨é¢å¤–çš„ç©ºé—´ï¼Œä¸”æ—¶é—´å¤æ‚åº¦è¿˜è¦å°äºO(N^2)ï¼Œå¦åˆ™çš„è¯å…¶å®å¯ä»¥æ’åºï¼Œæˆ–è€…ä½¿ç”¨Hashè¡¨æ¥åšï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äºŒåˆ†æ¥åš\n\n```java\n//update: 2020.5.26 å…¶å®ä¹Ÿå±äºäºŒåˆ†ç­”æ¡ˆ\npublic int findDuplicate(int[] nums){\n    int left=1,right=nums.length-1;\n    //è¿™é‡Œå®é™…ä¸Šæ˜¯å¯¹ã€1,2,3,4,...n-1ã€‘è¿™ä¸ªåŒºé—´è¿›è¡ŒäºŒåˆ†\n    //åœ¨è¿‡ç¨‹ä¸­å¯¹midæ£€æµ‹æ¯ä¸ªæ•°åœ¨numsæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°\n    //1 3 4 2 2å®é™…ä¸Šæ˜¯å¯¹ã€1,2,3,4ã€‘åŒºé—´è¿›è¡ŒäºŒåˆ†\n    while(left<right){\n        int mid=left+(right-left)/2+1;\n        //å°äºmidçš„æ•°å¤§äºmid,æ’é™¤mid\n        if(count(nums,mid)>=mid){ \n            right=mid-1;\n        }else{\n            left=mid;\n        }\n    }\n    return left;\n}\n\n//n-1ä¸ªæ•´æ•° , 1~næœ‰nä¸ªæ•°     \n//1 2 2 3 4     1~4ä¹‹é—´, 1 2 3 4\npublic int count(int[] nums,int n){\n    int res=0;\n    for (int i=0;i<nums.length;i++) {\n        if (nums[i]<n) {\n            res++;          \n        }\n    }\n    return res;\n}\n```\nè¿™æ ·çš„è§£æ³•è¿˜æ˜¯å¾ˆå·§å¦™çš„ï¼Œå¯¹numsæ•°ç»„çš„**å–å€¼èŒƒå›´**è¿›è¡ŒäºŒåˆ†ï¼ŒäºŒåˆ†çš„æ ¸å¿ƒå°±æ˜¯ï¼Œnumsæ•°ç»„ä¸­ï¼Œå°äºå–å€¼èŒƒå›´ä¸­midçš„å…ƒç´ åº”è¯¥å°äºç­‰äºmid\n\nä¸¾ä¸ªä¾‹å­ï¼š`[1 3 4 2 2]` å–å€¼èŒƒå›´æ˜¯`[1 2 3 4]` ï¼Œå–ä¸­ç‚¹2ï¼Œæ­£å¸¸æƒ…å†µä¸‹numsä¸­å°äºç­‰äº2çš„å…ƒç´ ï¼Œåº”è¯¥æœ€å¤šæœ‰2ä¸ªï¼Œä¹Ÿå°±æ˜¯`[1 2]`2ä¸ªï¼Œä½†æ˜¯è¿™é‡Œåœ¨numsä¸­ï¼Œæœ‰3ä¸ª`[1 2 2]` å¤§äº2äº†ï¼Œè¿™å°±è¯´æ˜ä¸€å®šæœ‰é‡å¤çš„å…ƒç´ ï¼Œè€Œä¸”ä¸€å®šæ˜¯å°äºä¸­ç‚¹2çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨å·¦åŠè¾¹ï¼Œä¸‹ä¸€æ­¥å°±åº”è¯¥èˆå¼ƒå³åŠè¾¹ï¼Œåœ¨`[1,2]`ä¸­ç»§ç»­æŸ¥æ‰¾ \n\nè¿™é‡ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„æ¨¡æ¿æ¥å†™ï¼Œå…ˆæ‰¾æ’é™¤midçš„æ¡ä»¶ï¼Œ**åœ¨numsä¸­å°äºmidçš„å…ƒç´ çš„æ•°é‡å°äºç­‰äºmidçš„æ—¶å€™ï¼ŒåŒ…æ‹¬midåœ¨å†…çš„å³è¾¹ç•Œéƒ½ä¼šè¢«æ’é™¤ï¼Œè‚¯å®šéƒ½ä¸æ˜¯é‡å¤çš„å…ƒç´ ** ï¼Œç„¶åå°±æŒ‰ç…§æ¨¡æ¿å†™å‡ºäºŒåˆ†å°±è¡Œäº†\n\n**è§£æ³•äºŒ**\n\nå¿«æ…¢æŒ‡é’ˆçš„åšæ³•ï¼ŒæŠ€å·§æ€§å¾ˆå¼ºï¼Œä¸€èˆ¬äººç¬¬ä¸€æ¬¡åšæ˜¯å¾ˆéš¾æƒ³åˆ°è¿™ç§åšæ³•çš„ï¼Œå…¶å®å’Œ [é“¾è¡¨ä¸“é¢˜](http://imlgw.top/2019/02/27/leetcode-lian-biao-tag/#141-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8) ä¸­çš„ç¯å½¢é“¾è¡¨æ˜¯ä¸€æ ·çš„åšæ³•ï¼Œç„¶åæŒ‰ç…§é‚£ä¸ªæ€è·¯èµ°å°±è¡Œäº†ï¼Œä¸æ¸…æ¥šåŸç†å¯ä»¥çœ‹çœ‹ä¸Šé¢ç¯å½¢é“¾è¡¨çš„è§£æ³•\n\n```java\npublic int findDuplicate(int[] nums){\n    int slow=0,fast=0;\n    boolean isMeet=false;\n    while(true){\n        fast=isMeet?nums[fast]:nums[nums[fast]];\n        slow=nums[slow];\n        if (fast==slow) {\n            if (isMeet) {\n                return slow;\n            }\n            fast=0;\n            isMeet=true;\n        }\n    }\n}\n```\nè¿™ç§è§£æ³•çš„å…³é”®æ˜¯å°†æ•°ç»„å€¼çœ‹ä½œç´¢å¼•ç„¶åå†æ•°ç»„åƒé“¾è¡¨ä¸€æ ·ç§»åŠ¨ï¼Œæ¯”å¦‚ `[1,2,3,4,5,6,7,8,9,5]`ç”¨å€¼ä½œä¸ºç´¢å¼•è¿æ¥èµ·æ¥å°±æ˜¯`1 2 3 4 [5 6 7 8 9] [5 6 7 8 9] ....` ï¼Œæ—¶é—´å¤æ‚åº¦`O(N)` æŠ€å·§æ€§æ¯”è¾ƒå¼ºï¼Œå¦‚æœé¢è¯•ç®¡ä¸è¿½é—®çš„è¯å…¶å®ç­”å‡ºä¸Šé¢çš„äºŒåˆ†å°±okäº†\n\n## [1011. åœ¨ D å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›](https://leetcode-cn.com/problems/capacity-to-ship-packages-within-d-days/)\n\nä¼ é€å¸¦ä¸Šçš„åŒ…è£¹å¿…é¡»åœ¨ D å¤©å†…ä»ä¸€ä¸ªæ¸¯å£è¿é€åˆ°å¦ä¸€ä¸ªæ¸¯å£ã€‚\n\nä¼ é€å¸¦ä¸Šçš„ç¬¬ `i` ä¸ªåŒ…è£¹çš„é‡é‡ä¸º `weights[i]`ã€‚æ¯ä¸€å¤©ï¼Œæˆ‘ä»¬éƒ½ä¼šæŒ‰ç»™å‡ºé‡é‡çš„é¡ºåºå¾€ä¼ é€å¸¦ä¸Šè£…è½½åŒ…è£¹ã€‚æˆ‘ä»¬è£…è½½çš„é‡é‡ä¸ä¼šè¶…è¿‡èˆ¹çš„æœ€å¤§è¿è½½é‡é‡ã€‚\n\nè¿”å›èƒ½åœ¨ `D` å¤©å†…å°†ä¼ é€å¸¦ä¸Šçš„æ‰€æœ‰åŒ…è£¹é€è¾¾çš„èˆ¹çš„æœ€ä½è¿è½½èƒ½åŠ›ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šweights = [1,2,3,4,5,6,7,8,9,10], D = 5\nè¾“å‡ºï¼š15\nè§£é‡Šï¼š\nèˆ¹èˆ¶æœ€ä½è½½é‡ 15 å°±èƒ½å¤Ÿåœ¨ 5 å¤©å†…é€è¾¾æ‰€æœ‰åŒ…è£¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nç¬¬ 1 å¤©ï¼š1, 2, 3, 4, 5\nç¬¬ 2 å¤©ï¼š6, 7\nç¬¬ 3 å¤©ï¼š8\nç¬¬ 4 å¤©ï¼š9\nç¬¬ 5 å¤©ï¼š10\n\nè¯·æ³¨æ„ï¼Œè´§ç‰©å¿…é¡»æŒ‰ç…§ç»™å®šçš„é¡ºåºè£…è¿ï¼Œå› æ­¤ä½¿ç”¨è½½é‡èƒ½åŠ›ä¸º 14 çš„èˆ¹èˆ¶å¹¶å°†åŒ…è£…åˆ†æˆ (2, 3, 4, 5), (1, 6, 7), (8), (9), (10) æ˜¯ä¸å…è®¸çš„ã€‚ \n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šweights = [3,2,2,4,1,4], D = 3\nè¾“å‡ºï¼š6\nè§£é‡Šï¼š\nèˆ¹èˆ¶æœ€ä½è½½é‡ 6 å°±èƒ½å¤Ÿåœ¨ 3 å¤©å†…é€è¾¾æ‰€æœ‰åŒ…è£¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nç¬¬ 1 å¤©ï¼š3, 2\nç¬¬ 2 å¤©ï¼š2, 4\nç¬¬ 3 å¤©ï¼š1, 4\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šweights = [1,2,3,1,1], D = 4\nè¾“å‡ºï¼š3\nè§£é‡Šï¼š\nç¬¬ 1 å¤©ï¼š1\nç¬¬ 2 å¤©ï¼š2\nç¬¬ 3 å¤©ï¼š3\nç¬¬ 4 å¤©ï¼š1, 1\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= D <= weights.length <= 50000`\n2. `1 <= weights[i] <= 500`\n\n**è§£æ³•ä¸€**\n\né—®é¢˜çš„è§£ç©ºé—´æ˜¯å•è°ƒçš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥äºŒåˆ†ç­”æ¡ˆï¼Œç„¶åéªŒè¯æ˜¯å¦æ»¡è¶³æ¡ä»¶å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(NlogN)`\n\n```java\npublic int shipWithinDays(int[] weights, int D) {\n    int sum=0,max=0;\n    for(int w:weights){\n        max=Math.max(w,max);\n        sum+=w;\n    }\n    int left=Math.max(sum/D,max),right=sum;\n    int res=0;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(check(weights,mid,D)){\n            res=mid;\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return res;\n}\n\n//æ¨¡æ‹Ÿåˆ¤æ–­\npublic boolean check(int[] weights,int load,int D){\n    int temp=0;\n    for(int w:weights){\n        if(temp+w>load){\n            temp=0;\n            D--;\n        }\n        temp+=w;\n    }\n    //return D>=0;\n    return D>0;\n}\n```\n\nä¸Šé¢æ˜¯ç”¨çš„ä¸€ä¸ª[å¤§ä½¬](https://www.bilibili.com/video/BV1YT4y137G4)çš„æ¨¡æ¿ï¼Œä¸æ˜¯ä¹‹å‰çš„æ¨¡æ¿ï¼Œä¹‹å‰çš„æ¨¡æ¿æˆ‘åˆšåˆšå†™äº†ä¸€å‘ï¼Œå†™é”™äº†ã€‚ã€‚ã€‚ã€‚\n\n```java\n//ä¹‹å‰çš„äºŒåˆ†æ¨¡æ¿\npublic int shipWithinDays(int[] weights, int D) {\n    int sum=0,max=0;\n    for(int w:weights){\n        max=Math.max(w,max);\n        sum+=w;\n    }\n    int left=Math.max(sum/D,max),right=sum;\n    while(left<right){ //è¿™é‡Œä¸€å¼€å§‹å†™æˆ<=äº†....\n        int mid=left+(right-left)/2;\n        if(check(weights,mid,D)){\n            right=mid;\n        }else{\n            left=mid+1;\n        }\n    }\n    return left;\n}\n```\n\nä¸¤ç§æ¨¡æ¿å„æœ‰ä¼˜ç‚¹å§ï¼Œè¿™ä¸ªå¤§ä½¬çš„æ¨¡æ¿ç›¸å¯¹æ›´ç®€å•ï¼Œä½†æ˜¯resçš„åˆå§‹å€¼éœ€è¦æ ¼å¤–æ³¨æ„ã€‚ã€‚ã€‚\n\n## [875. çˆ±åƒé¦™è•‰çš„ç‚ç‚](https://leetcode-cn.com/problems/koko-eating-bananas/)\n\nç‚ç‚å–œæ¬¢åƒé¦™è•‰ã€‚è¿™é‡Œæœ‰ `N` å †é¦™è•‰ï¼Œç¬¬ `i` å †ä¸­æœ‰ `piles[i]` æ ¹é¦™è•‰ã€‚è­¦å«å·²ç»ç¦»å¼€äº†ï¼Œå°†åœ¨ `H` å°æ—¶åå›æ¥ã€‚\n\nç‚ç‚å¯ä»¥å†³å®šå¥¹åƒé¦™è•‰çš„é€Ÿåº¦ `K` ï¼ˆå•ä½ï¼šæ ¹/å°æ—¶ï¼‰ã€‚æ¯ä¸ªå°æ—¶ï¼Œå¥¹å°†ä¼šé€‰æ‹©ä¸€å †é¦™è•‰ï¼Œä»ä¸­åƒæ‰ `K` æ ¹ã€‚å¦‚æœè¿™å †é¦™è•‰å°‘äº `K` æ ¹ï¼Œå¥¹å°†åƒæ‰è¿™å †çš„æ‰€æœ‰é¦™è•‰ï¼Œç„¶åè¿™ä¸€å°æ—¶å†…ä¸ä¼šå†åƒæ›´å¤šçš„é¦™è•‰ã€‚  \n\nç‚ç‚å–œæ¬¢æ…¢æ…¢åƒï¼Œä½†ä»ç„¶æƒ³åœ¨è­¦å«å›æ¥å‰åƒæ‰æ‰€æœ‰çš„é¦™è•‰ã€‚\n\nè¿”å›å¥¹å¯ä»¥åœ¨ `H` å°æ—¶å†…åƒæ‰æ‰€æœ‰é¦™è•‰çš„æœ€å°é€Ÿåº¦ `K`ï¼ˆ`K` ä¸ºæ•´æ•°ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: piles = [3,6,7,11], H = 8\nè¾“å‡º: 4\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: piles = [30,11,23,4,20], H = 5\nè¾“å‡º: 30\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥: piles = [30,11,23,4,20], H = 6\nè¾“å‡º: 23\n```\n\n**æç¤ºï¼š**\n\n- `1 <= piles.length <= 10^4`\n- `piles.length <= H <= 10^9`\n- `1 <= piles[i] <= 10^9`\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹æƒ³ç”¨`sum/H`å‘ä¸Šå–æ•´åšå·¦è¾¹ç•Œï¼Œç»“æœç›´æ¥çˆ†æ‰äº†ï¼Œcaseè¿˜æ˜¯å¾ˆç»™åŠ›å•Š\n\n```java\n//äºŒåˆ†ç­”æ¡ˆ\npublic int minEatingSpeed(int[] piles, int H) {\n    int max=0;\n    for(int p:piles) max=Math.max(max,p);\n    int left=1,right=max;\n    int res=right;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(check(piles,mid,H)){\n            res=mid;\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return res;\n}\n\npublic boolean check(int[] piles,int k,int H){\n    int count=0;\n    for(int p:piles) count+=(p-1)/k+1; //å‘ä¸Šå–æ•´\n    return count<=H;\n}\n```\n\n## [1292. å…ƒç´ å’Œå°äºç­‰äºé˜ˆå€¼çš„æ­£æ–¹å½¢çš„æœ€å¤§è¾¹é•¿](https://leetcode-cn.com/problems/maximum-side-length-of-a-square-with-sum-less-than-or-equal-to-threshold/) \n\nç»™ä½ ä¸€ä¸ªå¤§å°ä¸º `m x n` çš„çŸ©é˜µ `mat` å’Œä¸€ä¸ªæ•´æ•°é˜ˆå€¼ `threshold`ã€‚\n\nè¯·ä½ è¿”å›å…ƒç´ æ€»å’Œå°äºæˆ–ç­‰äºé˜ˆå€¼çš„æ­£æ–¹å½¢åŒºåŸŸçš„æœ€å¤§è¾¹é•¿ï¼›å¦‚æœæ²¡æœ‰è¿™æ ·çš„æ­£æ–¹å½¢åŒºåŸŸï¼Œåˆ™è¿”å› **0** ã€‚\n\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![Y2wPne.png](https://s1.ax1x.com/2020/05/17/Y2wPne.png)\n\n```java\nè¾“å…¥ï¼šmat = [[1,1,3,2,4,3,2],[1,1,3,2,4,3,2],[1,1,3,2,4,3,2]], threshold = 4\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šæ€»å’Œå°äº 4 çš„æ­£æ–¹å½¢çš„æœ€å¤§è¾¹é•¿ä¸º 2ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šmat = [[2,2,2,2,2],[2,2,2,2,2],[2,2,2,2,2],[2,2,2,2,2],[2,2,2,2,2]], threshold = 1\nè¾“å‡ºï¼š0\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šmat = [[1,1,1,1],[1,0,0,0],[1,0,0,0],[1,0,0,0]], threshold = 6\nè¾“å‡ºï¼š3\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šmat = [[18,70],[61,1],[25,85],[14,40],[11,96],[97,96],[63,45]], threshold = 40184\nè¾“å‡ºï¼š2\n```\n\n**æç¤ºï¼š**\n\n- `1 <= m, n <= 300`\n- `m == mat.length`\n- `n == mat[i].length`\n- `0 <= mat[i][j] <= 10000`\n- `0 <= threshold <= 10^5`\n\n**è§£æ³•ä¸€**\n\nè¿™ä¸ªé¢˜æ˜¯ä¸ªå¥½é¢˜å•Šï¼Œåˆå­¦åˆ°æ–°ä¸œè¥¿äº†ï¼š**äºŒç»´å‰ç¼€å’Œ**ï¼Œé¦–å…ˆçœ‹åˆ°è¿™é“é¢˜å°±æ„è¯†åˆ°äº†è¿™æ˜¯ä¸ªäºŒåˆ†ç­”æ¡ˆçš„é¢˜ï¼Œç›´æ¥äºŒåˆ†è¾¹é•¿å°±è¡Œäº†ï¼Œå·¦ç«¯ç‚¹`1`ï¼Œå³ç«¯ç‚¹`min(m,n)`ï¼ŒæŸä¸ªè¾¹é•¿`x`æ»¡è¶³çš„æ—¶å€™ï¼Œå¤§äº`x`çš„éƒ½æ»¡è¶³ï¼ŒæŸä¸ª`x`ä¸æ»¡è¶³çš„æ—¶å€™ï¼Œå°äº`x`çš„éƒ½ä¸æ»¡è¶³ï¼Œè§£ç©ºé—´å…·æœ‰å•è°ƒæ€§\n\næ‰€ä»¥å…³é”®é—®é¢˜å°±æ˜¯`check`æ€ä¹ˆå†™ï¼Œå¦‚æœç›´æ¥æš´åŠ›æšä¸¾æ‰€æœ‰çŸ©å½¢ç„¶åè®¡ç®—æ—¶é—´å¤æ‚åº¦ä¼šå¾ˆææ€–ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¼•å…¥**äºŒç»´å‰ç¼€å’Œ**ï¼Œæˆ‘å°±ä¸å…·ä½“è®²è§£äº†ï¼Œçœ‹çœ‹[å®˜æ–¹é¢˜è§£](https://leetcode-cn.com/problems/maximum-side-length-of-a-square-with-sum-less-than-or-equal-to-threshold/solution/yuan-su-he-xiao-yu-deng-yu-yu-zhi-de-zheng-fang-2/)å°±è¡Œäº†ï¼Œå†™çš„æŒºå¥½çš„\n\n```java\npublic int maxSideLength(int[][] mat, int threshold) {\n    int m=mat.length;\n    int n=mat[0].length;\n    int left=1,right=Math.min(m,n);\n    //æ ¸å¿ƒå…¬å¼\n    //sum([x1,y1]->[x2,y2])\n    //= P[x2][y2]-P[x2][y1-1]-P[x1-1][y2]+P[x1-1][y1-1]\n    //==> mat[i][j]=P[i][j]-P[i-1][j]-P[j-1][i]+P[i-1][j-1]\n    int[][] dp=new int[m+1][n+1];\n    for (int i=1;i<=m;i++) {\n        for (int j=1;j<=n;j++) {\n            dp[i][j]=mat[i-1][j-1]+dp[i-1][j]+dp[i][j-1]-dp[i-1][j-1];\n        }\n    }\n    int res=0;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(check(mat,mid,threshold,dp)){\n            res=mid;\n            left=mid+1;\n        }else{\n            right=mid-1;\n        }\n    }\n    return res;\n}\n\npublic boolean check(int[][] mat,int side,int threshold,int[][] dp){\n    //æšä¸¾æ‰€æœ‰çš„å·¦ç«¯ç‚¹\n    for (int i=1;i+side-1<=mat.length;i++) {\n        for (int j=1;j+side-1<=mat[0].length;j++) {\n            int ri=i+side-1,rj=j+side-1;\n            //System.out.println(ri+\",\"+rj+\" dp:\"+ dp[ri][rj]);\n            if(dp[ri][rj]-dp[i-1][rj]-dp[ri][j-1]+dp[i-1][j-1]<=threshold){\n                return true;\n            }\n        }\n    }\n    return false;\n}\n```\n\n## [1300. è½¬å˜æ•°ç»„åæœ€æ¥è¿‘ç›®æ ‡å€¼çš„æ•°ç»„å’Œ](https://leetcode-cn.com/problems/sum-of-mutated-array-closest-to-target/) \n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `arr` å’Œä¸€ä¸ªç›®æ ‡å€¼ `target` ï¼Œè¯·ä½ è¿”å›ä¸€ä¸ªæ•´æ•° `value` ï¼Œä½¿å¾—å°†æ•°ç»„ä¸­æ‰€æœ‰å¤§äº `value` çš„å€¼å˜æˆ `value` åï¼Œæ•°ç»„çš„å’Œæœ€æ¥è¿‘  `target` ï¼ˆæœ€æ¥è¿‘è¡¨ç¤ºä¸¤è€…ä¹‹å·®çš„ç»å¯¹å€¼æœ€å°ï¼‰ã€‚\n\nå¦‚æœæœ‰å¤šç§ä½¿å¾—å’Œæœ€æ¥è¿‘ `target` çš„æ–¹æ¡ˆï¼Œè¯·ä½ è¿”å›è¿™äº›æ•´æ•°ä¸­çš„æœ€å°å€¼ã€‚\n\nè¯·æ³¨æ„ï¼Œç­”æ¡ˆä¸ä¸€å®šæ˜¯ `arr` ä¸­çš„æ•°å­—ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [4,9,3], target = 10\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šå½“é€‰æ‹© value ä¸º 3 æ—¶ï¼Œæ•°ç»„ä¼šå˜æˆ [3, 3, 3]ï¼Œå’Œä¸º 9 ï¼Œè¿™æ˜¯æœ€æ¥è¿‘ target çš„æ–¹æ¡ˆã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [2,3,5], target = 10\nè¾“å‡ºï¼š5\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [60864,25176,27249,21296,20204], target = 56803\nè¾“å‡ºï¼š11361\n```\n\n**æç¤ºï¼š**\n\n- `1 <= arr.length <= 10^4`\n- `1 <= arr[i], target <= 10^5`\n\n**è§£æ³•ä¸€**\n\nè§£ç©ºé—´åœ¨`[0,max(arr)]`ä¸Šå•è°ƒï¼Œæ‰€ä»¥å¯ä»¥äºŒåˆ†ç­”æ¡ˆ\n\nä¸€å¼€å§‹å‚»å‚»çš„å†™äº†ä¸¤ä¸ªäºŒåˆ†ï¼Œä¸€ä¸ªæ‰¾ç¬¬ä¸€ä¸ªå°äºç­‰äºtargetçš„ï¼Œä¸€ä¸ªæ‰¾å¤§äºç­‰äºçš„ï¼Œå…¶å®æ ¹æœ¬å°±ä¸ç”¨ï¼Œè¿™ä¸¤ä¸ªå€¼è‚¯å®šæ˜¯è¿åœ¨ä¸€èµ·çš„ğŸ¤£\n\n```java\npublic int findBestValue(int[] arr, int target) {\n    int sum=0;\n    int left=0,right=Integer.MIN_VALUE;\n    for(int num:arr){\n        sum+=num;\n        right=Math.max(right,num);\n    }\n    if(sum<=target) return right;\n    int res=left;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(getSum(arr,mid)<=target){\n            res=mid;\n            left=mid+1;\n        }else{\n            right=mid-1;\n        }\n    }\n    //è¿™ä¸¤ä¸ªå€¼è‚¯å®šæ˜¯è¿åœ¨ä¸€èµ·çš„\n    if(target-getSum(arr,res)<=getSum(arr,res+1)-target){\n        return res;\n    }\n    return res+1;\n}\n\npublic int getSum(int[] arr,int mid){\n    int sum=0;\n    for(int a:arr){\n        sum+=a>mid?mid:a;\n    }\n    return sum;\n}\n```\n\n## [LCP 12. å°å¼ åˆ·é¢˜è®¡åˆ’](https://leetcode-cn.com/problems/xiao-zhang-shua-ti-ji-hua/)\n\nä¸ºäº†æé«˜è‡ªå·±çš„ä»£ç èƒ½åŠ›ï¼Œå°å¼ åˆ¶å®šäº† `LeetCode` åˆ·é¢˜è®¡åˆ’ï¼Œä»–é€‰ä¸­äº† `LeetCode` é¢˜åº“ä¸­çš„ `n` é“é¢˜ï¼Œç¼–å·ä» `0` åˆ° `n-1`ï¼Œå¹¶è®¡åˆ’åœ¨ `m` å¤©å†…**æŒ‰ç…§é¢˜ç›®ç¼–å·é¡ºåº**åˆ·å®Œæ‰€æœ‰çš„é¢˜ç›®ï¼ˆæ³¨æ„ï¼Œå°å¼ ä¸èƒ½ç”¨å¤šå¤©å®ŒæˆåŒä¸€é¢˜ï¼‰ã€‚\n\nåœ¨å°å¼ åˆ·é¢˜è®¡åˆ’ä¸­ï¼Œå°å¼ éœ€è¦ç”¨ `time[i]` çš„æ—¶é—´å®Œæˆç¼–å· `i` çš„é¢˜ç›®ã€‚æ­¤å¤–ï¼Œå°å¼ è¿˜å¯ä»¥ä½¿ç”¨åœºå¤–æ±‚åŠ©åŠŸèƒ½ï¼Œé€šè¿‡è¯¢é—®ä»–çš„å¥½æœ‹å‹å°æ¨é¢˜ç›®çš„è§£æ³•ï¼Œå¯ä»¥çœå»è¯¥é¢˜çš„åšé¢˜æ—¶é—´ã€‚ä¸ºäº†é˜²æ­¢â€œå°å¼ åˆ·é¢˜è®¡åˆ’â€å˜æˆâ€œå°æ¨åˆ·é¢˜è®¡åˆ’â€ï¼Œå°å¼ æ¯å¤©æœ€å¤šä½¿ç”¨ä¸€æ¬¡æ±‚åŠ©ã€‚\n\næˆ‘ä»¬å®šä¹‰ `m` å¤©ä¸­åšé¢˜æ—¶é—´æœ€å¤šçš„ä¸€å¤©è€—æ—¶ä¸º `T`ï¼ˆå°æ¨å®Œæˆçš„é¢˜ç›®ä¸è®¡å…¥åšé¢˜æ€»æ—¶é—´ï¼‰ã€‚è¯·ä½ å¸®å°å¼ æ±‚å‡ºæœ€å°çš„ `T`æ˜¯å¤šå°‘ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n> è¾“å…¥ï¼š`time = [1,2,3,3], m = 2`\n>\n> è¾“å‡ºï¼š`3`\n>\n> è§£é‡Šï¼šç¬¬ä¸€å¤©å°å¼ å®Œæˆå‰ä¸‰é¢˜ï¼Œå…¶ä¸­ç¬¬ä¸‰é¢˜æ‰¾å°æ¨å¸®å¿™ï¼›ç¬¬äºŒå¤©å®Œæˆç¬¬å››é¢˜ï¼Œå¹¶ä¸”æ‰¾å°æ¨å¸®å¿™ã€‚è¿™æ ·åšé¢˜æ—¶é—´æœ€å¤šçš„ä¸€å¤©èŠ±è´¹äº† 3 çš„æ—¶é—´ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼æ˜¯æœ€å°çš„ã€‚\n\n**ç¤ºä¾‹ 2ï¼š**\n\n> è¾“å…¥ï¼š`time = [999,999,999], m = 4`\n>\n> è¾“å‡ºï¼š`0`\n>\n> è§£é‡Šï¼šåœ¨å‰ä¸‰å¤©ä¸­ï¼Œå°å¼ æ¯å¤©æ±‚åŠ©å°æ¨ä¸€æ¬¡ï¼Œè¿™æ ·ä»–å¯ä»¥åœ¨ä¸‰å¤©å†…å®Œæˆæ‰€æœ‰çš„é¢˜ç›®å¹¶ä¸èŠ±ä»»ä½•æ—¶é—´ã€‚\n\n**é™åˆ¶ï¼š**\n\n- `1 <= time.length <= 10^5`\n- `1 <= time[i] <= 10000`\n- `1 <= m <= 1000`\n\n**è§£æ³•ä¸€**\n\nçŸ¥é“æ˜¯äºŒåˆ†ç­”æ¡ˆä½†æ˜¯checkå†™äº†å¥½ä¹…æ²¡å†™å‡ºæ¥ï¼ŒçœŸèœå•Š\n\n```java\npublic int minTime(int[] time, int m) {\n    int left=0,right=0;//ä¸Šç•Œæœ€å¤šsum(time)\n    for(int i=0;i<time.length;i++){\n        right+=time[i];\n    }\n    int res=right+1;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(check(time,mid,m)){\n            res=mid;\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    //å…¶å®è¿”å›leftå°±è¡Œäº†,ä¸»è¦æ˜¯é¿å…ææ··\n    return res; \n}\n\n//æ ¸å¿ƒçš„check\npublic boolean check(int[] time,int T,int m){\n    int day=1,sum=0,maxt=0;\n    for (int t:time) {\n        sum+=t;\n        maxt=Math.max(maxt,t); //ç»´æŠ¤æ¯ä¸€ç»„çš„æœ€å¤§å€¼\n        if(sum-maxt>T){ //å½“å‰ç»„å‡å»æœ€å¤§å€¼ä¸æ»¡è¶³\n            day++;\n            sum=t;\n            maxt=t;\n        }\n    }\n    return day<=m;\n}\n```\n\n## [410. åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼](https://leetcode-cn.com/problems/split-array-largest-sum/)\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° *m*ï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ•°ç»„åˆ†æˆ *m* ä¸ªéç©ºçš„è¿ç»­å­æ•°ç»„ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•ä½¿å¾—è¿™ *m* ä¸ªå­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼æœ€å°ã€‚\n\n**æ³¨æ„:**\næ•°ç»„é•¿åº¦ *n* æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:\n\n- 1 â‰¤ *n* â‰¤ 1000\n- 1 â‰¤ *m* â‰¤ min(50, *n*)\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥:\nnums = [7,2,5,10,8]\nm = 2\n\nè¾“å‡º:\n18\n\nè§£é‡Š:\nä¸€å…±æœ‰å››ç§æ–¹æ³•å°†numsåˆ†å‰²ä¸º2ä¸ªå­æ•°ç»„ã€‚\nå…¶ä¸­æœ€å¥½çš„æ–¹å¼æ˜¯å°†å…¶åˆ†ä¸º[7,2,5] å’Œ [10,8]ï¼Œ\nå› ä¸ºæ­¤æ—¶è¿™ä¸¤ä¸ªå­æ•°ç»„å„è‡ªçš„å’Œçš„æœ€å¤§å€¼ä¸º18ï¼Œåœ¨æ‰€æœ‰æƒ…å†µä¸­æœ€å°ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nHardé¢˜ï¼Œä½†æ˜¯æ„Ÿè§‰å’Œå‰é¢çš„midå·®ä¸å¤šï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œä¸ªäººæ„Ÿè§‰è¿™é¢˜è¿˜æ²¡ä¸Šé¢çš„[LCP12.å°å¼ åˆ·é¢˜è®¡åˆ’](#lcp-12-å°å¼ åˆ·é¢˜è®¡åˆ’) éš¾ï¼Œä¸è¿‡æœ‰ä¸ªcaseæŒºæ¶å¿ƒï¼Œç®—çš„sumä¼šæº¢å‡ºï¼Œå®³æˆ‘WAäº†ä¸€æ¬¡ï¼Œä½†æ˜¯ä»–ç»“æœè¿”å›çš„åˆæ˜¯ä¸ªintï¼Œè¿™å°±å¾ˆè ¢\n\n```java\n//ä¸€æ ·çš„å¥—è·¯\npublic int splitArray(int[] nums, int m) {\n    long left=0,right=0;\n    for(int num:nums){\n        left=Math.max(left,num);\n        right+=num;\n    }\n    long res=0;\n    while(left<=right){\n        long mid=left+(right-left)/2;\n        if(check(nums,mid,m)){\n            res=mid;\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return (int)res;\n}\n\n//åˆ†ä¸ºmç»„èƒ½å¦ä¿è¯æ¯ç»„éƒ½å°äºç­‰äºmidï¼ˆå¦‚æœå¯ä»¥è¯´æ˜è¿˜å¯ä»¥æ›´å°ï¼‰\npublic boolean check(int[] nums,long limit,int m){\n    long sum=0;\n    int count=1;\n    for(int num:nums){\n        if(sum+num>limit){\n            sum=0;\n            count++;\n        }\n        sum+=num;\n    }\n    return count<=m;\n}\n```\n\n## [NC82.åˆ†ç»„](https://www.nowcoder.com/practice/829419bde0e946b6b4fe813ed3972db8)\n\né¢˜ç›®æè¿°\nç‰›ç‰›æœ‰ä¸€ä¸ªnä¸ªæ•°å­—çš„åºåˆ—a1ï¼Œa2ï¼Œa3...anç°åœ¨ç‰›ç‰›æƒ³æŠŠè¿™ä¸ªåºåˆ—åˆ†æˆkæ®µè¿ç»­æ®µï¼Œç‰›ç‰›æƒ³çŸ¥é“åˆ†å‡ºæ¥çš„kä¸ªè¿ç»­æ®µçš„æ®µå†…æ•°å­—å’Œçš„æœ€å°å€¼æœ€å¤§å¯ä»¥æ˜¯å¤šå°‘ï¼Ÿ\n\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥ : 4,2,[1,2,1,5]\nè¾“å‡º : 4\nè¯´æ˜:\næœ‰3ç§åˆ†æ³•\n[1],[2,1,5]ï¼Œæ•°å­—å’Œåˆ†åˆ«ä¸º1ï¼Œ8ï¼Œæœ€å°å€¼ä¸º1\n[1,2][1,5]ï¼Œæ•°å­—å’Œåˆ†åˆ«ä¸º3ï¼Œ6ï¼Œæœ€å°å€¼ä¸º3\n[1,2,1],[5]æ•°å­—å’Œåˆ†åˆ«ä¸º4ï¼Œ5ï¼Œæœ€å°å€¼ä¸º4\nåˆ™æœ€å°å€¼çš„æœ€å¤§å€¼ä¸º4\n```\n**å¤‡æ³¨:**\n- 1 <= k <= n <= 1e5\n- 0 <= ai <= 1e4\n\nç¬¬ä¸€ä¸ªå‚æ•°æ•´æ•°nä»£è¡¨åºåˆ—æ•°å­—ä¸ªæ•°ï¼Œ\nç¬¬äºŒä¸ªå‚æ•°æ•´æ•°kä»£è¡¨åˆ†å‡ºçš„æ®µæ•°ï¼Œ\nç¬¬ä¸‰ä¸ªå‚æ•°vector a åŒ…å«nä¸ªå…ƒç´ ä»£è¡¨nä¸ªæ•°å­—\n\n**è§£æ³•ä¸€**\n\næˆ‘æ˜¯çœŸçš„èœå•Šï¼Œä¸Šé¢ä¸€é¢˜ä¼šå†™è¿™é¢˜å°±ä¸ä¼šå†™äº†ï¼Œæœç„¶æˆ‘è¿™ç§èœé¸¡åˆ·é¢˜å°±æ˜¯èƒŒé¢˜ï¼Œå˜ä¸€ä¸‹å°±ä¸ä¼šäº†ã€‚ã€‚ã€‚å…¶å®å’Œä¸Šé¢çš„æ­£å¥½æ˜¯åè¿‡æ¥çš„ï¼Œä¸Šé¢æ˜¯è¦æœ€å¤§å€¼æœ€å°ï¼Œè¿™é‡Œæ˜¯è¦æœ€å°å€¼æœ€å¤§ï¼Œæ‰€ä»¥checkçš„æ€è·¯ä¹Ÿæ˜¯ç›¸åçš„ï¼Œä¸Šé¢æ˜¯éªŒè¯ï¼šåˆ†ä¸ºkç»„èƒ½å¦ä¿è¯æ¯ç»„éƒ½å°äºç­‰äºmidã€‚æ‰€ä»¥è¿™é¢˜å¾ˆæ˜¾ç„¶å°±åº”è¯¥æ˜¯ï¼šåˆ†ä¸ºkç»„èƒ½å¦ä¿è¯æ¯ç»„éƒ½å¤§äºç­‰äºmidï¼ˆè¿™é‡ŒéªŒè¯ä¹Ÿæ˜¯é€æ¸é€¼è¿‘ç­”æ¡ˆï¼‰\n```java\n//æœ€å°å€¼æœ€å¤§\npublic int solve (int n, int k, int[] a) {\n    int left = 0;\n    int right = 0;\n    for (int i = 0; i < a.length; i++) {\n        left = Math.min(left, a[i]);\n        right += a[i];\n    }\n    int res = 0;\n    while (left <= right) {\n        int mid = left + (right-left)/2;\n        if (check(mid, a, k)) {\n            res = mid;\n            left = mid + 1;\n        }else {\n            right = mid - 1;\n        }\n    }\n    return res;\n}\n\n//åˆ†ä¸ºkç»„èƒ½å¦ä¿è¯æ¯ç»„éƒ½å¤§äºç­‰äºmidï¼ˆå¦‚æœå¯ä»¥è¯´æ˜è¿˜å¯ä»¥æ›´å¤§ï¼‰\npublic boolean check(int mid, int[] a, int k) {\n    int sum = 0;\n    int count = 0;\n    for (int i = 0; i < a.length; i++) {\n        sum += a[i];\n        if (sum >= mid) {\n            sum = 0;\n            count++;\n        }\n    }\n    return count >= k;\n}\n```\n## [1482. åˆ¶ä½œ m æŸèŠ±æ‰€éœ€çš„æœ€å°‘å¤©æ•°](https://leetcode-cn.com/problems/minimum-number-of-days-to-make-m-bouquets/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `bloomDay`ï¼Œä»¥åŠä¸¤ä¸ªæ•´æ•° m å’Œ k ã€‚\n\nç°éœ€è¦åˆ¶ä½œ `m` æŸèŠ±ã€‚åˆ¶ä½œèŠ±æŸæ—¶ï¼Œéœ€è¦ä½¿ç”¨èŠ±å›­ä¸­ `ç›¸é‚»çš„ k` æœµèŠ± ã€‚\n\nèŠ±å›­ä¸­æœ‰ n æœµèŠ±ï¼Œç¬¬ i æœµèŠ±ä¼šåœ¨ bloomDay[i] æ—¶ç››å¼€ï¼Œæ°å¥½ å¯ä»¥ç”¨äº ä¸€æŸ èŠ±ä¸­ã€‚\nè¯·ä½ è¿”å›ä»èŠ±å›­ä¸­æ‘˜ m æŸèŠ±éœ€è¦ç­‰å¾…çš„æœ€å°‘çš„å¤©æ•°ã€‚å¦‚æœä¸èƒ½æ‘˜åˆ° m æŸèŠ±åˆ™è¿”å› -1 ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šbloomDay = [1,10,3,10,2], m = 3, k = 1\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šè®©æˆ‘ä»¬ä¸€èµ·è§‚å¯Ÿè¿™ä¸‰å¤©çš„èŠ±å¼€è¿‡ç¨‹ï¼Œx è¡¨ç¤ºèŠ±å¼€ï¼Œè€Œ _ è¡¨ç¤ºèŠ±è¿˜æœªå¼€ã€‚\nç°åœ¨éœ€è¦åˆ¶ä½œ 3 æŸèŠ±ï¼Œæ¯æŸåªéœ€è¦ 1 æœµã€‚\n1 å¤©åï¼š[x, _, _, _, _]   // åªèƒ½åˆ¶ä½œ 1 æŸèŠ±\n2 å¤©åï¼š[x, _, _, _, x]   // åªèƒ½åˆ¶ä½œ 2 æŸèŠ±\n3 å¤©åï¼š[x, _, x, _, x]   // å¯ä»¥åˆ¶ä½œ 3 æŸèŠ±ï¼Œç­”æ¡ˆä¸º 3\n```\n**ç¤ºä¾‹ 2ï¼š**\n```java\nè¾“å…¥ï¼šbloomDay = [1,10,3,10,2], m = 3, k = 2\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼šè¦åˆ¶ä½œ 3 æŸèŠ±ï¼Œæ¯æŸéœ€è¦ 2 æœµèŠ±ï¼Œä¹Ÿå°±æ˜¯ä¸€å…±éœ€è¦ 6 æœµèŠ±ã€‚è€ŒèŠ±å›­ä¸­åªæœ‰ 5 æœµèŠ±ï¼Œæ— æ³•æ»¡è¶³åˆ¶ä½œè¦æ±‚ï¼Œè¿”å› -1 ã€‚\n```\n**ç¤ºä¾‹ 3ï¼š**\n```\nè¾“å…¥ï¼šbloomDay = [7,7,7,7,12,7,7], m = 2, k = 3\nè¾“å‡ºï¼š12\nè§£é‡Šï¼šè¦åˆ¶ä½œ 2 æŸèŠ±ï¼Œæ¯æŸéœ€è¦ 3 æœµã€‚\nèŠ±å›­åœ¨ 7 å¤©åå’Œ 12 å¤©åçš„æƒ…å†µå¦‚ä¸‹ï¼š\n7 å¤©åï¼š[x, x, x, x, _, x, x]\nå¯ä»¥ç”¨å‰ 3 æœµç››å¼€çš„èŠ±åˆ¶ä½œç¬¬ä¸€æŸèŠ±ã€‚ä½†ä¸èƒ½ä½¿ç”¨å 3 æœµç››å¼€çš„èŠ±ï¼Œå› ä¸ºå®ƒä»¬ä¸ç›¸é‚»ã€‚\n12 å¤©åï¼š[x, x, x, x, x, x, x]\næ˜¾ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼åˆ¶ä½œä¸¤æŸèŠ±ã€‚\n```\n**ç¤ºä¾‹ 4ï¼š**\n```java\nè¾“å…¥ï¼šbloomDay = [1000000000,1000000000], m = 1, k = 1\nè¾“å‡ºï¼š1000000000\nè§£é‡Šï¼šéœ€è¦ç­‰ 1000000000 å¤©æ‰èƒ½é‡‡åˆ°èŠ±æ¥åˆ¶ä½œèŠ±æŸ\nç¤ºä¾‹ 5ï¼š\n\nè¾“å…¥ï¼šbloomDay = [1,10,2,9,3,8,4,7,5,6], m = 4, k = 2\nè¾“å‡ºï¼š9\n ```\n**æç¤ºï¼š**\n- bloomDay.length == n\n- 1 <= n <= 10^5\n- 1 <= bloomDay[i] <= 10^9\n- 1 <= m <= 10^6\n- 1 <= k <= n\n\n**è§£æ³•ä¸€**\n\n193thå‘¨èµ›çš„T3ï¼Œæ²¡å‚åŠ ï¼Œä½†æ˜¯åœ¨ç¾¤é‡Œå¬ç¾¤å‹è®¨è®ºäº†ï¼Œæ˜¯ä¸ªäºŒåˆ†ï¼Œåˆšåˆšå…·ä½“çš„çœ‹äº†é¢˜ç›®ï¼Œå‘ç°å…¶å®æ˜¯å¾ˆæ˜æ˜¾çš„äºŒåˆ†ç­”æ¡ˆï¼Œå¾ˆå¯æƒœæ²¡å‚åŠ è¿™æ¬¡æ¯”èµ›ï¼Œæ„Ÿè§‰èƒ½A3é“ã€‚ã€‚ã€‚\n```java\npublic int minDays(int[] bloomDay, int m, int k) {\n    int n=bloomDay.length;\n    if(m*k>n) return -1; //èŠ±å›­çš„èŠ±ä¸å¤Ÿ\n    //ç›´æ¥å†™å°±å®Œäº‹äº†ï¼Œè¿™é‡Œæ•°æ®èŒƒå›´åªåˆ°1e9ï¼Œlog(1e9)å¾ˆå°çš„ï¼Œåªæœ‰30å·¦å³\n    int left=1,right=(int)1e9;\n    int res=right+1;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(check(bloomDay,m,k,mid)){\n            res=mid;\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return res;\n}\n\n//checkå†™çš„å¥½ä¸‘...\npublic boolean check(int[] bloomDay,int m,int k,int day){\n    int i=0;\n    int count=0;\n    while(i<bloomDay.length){\n        int temp=0;\n        while(i<bloomDay.length){\n            if(bloomDay[i]<=day){\n                temp++;\n                if(temp==k){\n                    count++;\n                    break;\n                }\n                i++;\n            }else{\n                break;\n            }\n        }\n        if(count>=m) return true;\n        i++;\n    }\n    return false;\n}\n```\n**è§£æ³•äºŒ**\n\nçœ‹äº†è¯„è®ºåŒºï¼Œç„¶åè‡ªå·±æ€è€ƒäº†ä¸‹ï¼Œæ”¹è¿›äº†`check`\n```java\npublic int minDays(int[] bloomDay, int m, int k) {\n    int n=bloomDay.length;\n    if(m*k>n) return -1; //èŠ±å›­çš„èŠ±ä¸å¤Ÿ\n    //ç›´æ¥å†™å°±å®Œäº‹äº†ï¼Œè¿™é‡Œæ•°æ®èŒƒå›´åªåˆ°1e9ï¼Œlog(1e9)å¾ˆå°çš„ï¼Œåªæœ‰30å·¦å³\n    int left=1,right=(int)1e9; \n    int res=right+1;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if(check(bloomDay,m,k,mid)){\n            res=mid;\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return res;\n}\n\npublic boolean check(int[] bloomDay,int m,int k,int day){\n    int i=0;\n    int count=0;\n    int temp=0; //ç›¸é‚»çš„å¼€èŠ±æ•°é‡\n    for(int d:bloomDay){\n        if(d<=day){ //èŠ±å¼€äº†(mdï¼Œè¿™ä¸ªifå†™åä¸¤æ¬¡)\n            temp++;\n        }else{\n            temp=0;\n        }\n        if(temp==k){\n            temp=0;\n            count++;\n        }\n    }\n    return count>=m;\n}\n```\n\n## [378. æœ‰åºçŸ©é˜µä¸­ç¬¬Kå°çš„å…ƒç´ ](https://leetcode-cn.com/problems/kth-smallest-element-in-a-sorted-matrix/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªÂ _`n x n`Â _çŸ©é˜µï¼Œå…¶ä¸­æ¯è¡Œå’Œæ¯åˆ—å…ƒç´ å‡æŒ‰å‡åºæ’åºï¼Œæ‰¾åˆ°çŸ©é˜µä¸­ç¬¬ `k` å°çš„å…ƒç´ ã€‚  \nè¯·æ³¨æ„ï¼Œå®ƒæ˜¯æ’åºåçš„ç¬¬ `k` å°å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ `k` ä¸ªä¸åŒçš„å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```go\nmatrix = [\n   [ 1,  5,  9],\n   [10, 11, 13],\n   [12, 13, 15]\n],\nk = 8,\n\nè¿”å› 13ã€‚\n```\n\n**æç¤ºï¼š**  \nä½ å¯ä»¥å‡è®¾ k çš„å€¼æ°¸è¿œæ˜¯æœ‰æ•ˆçš„ï¼Œ`1 â‰¤ k â‰¤ n<sup>2Â </sup>`ã€‚\n\nï¼ˆç›´æ¥æ¬è¿æˆ‘åœ¨lcé¢˜è§£åŒºå†™çš„[é¢˜è§£](https://leetcode-cn.com/problems/kth-smallest-element-in-a-sorted-matrix/solution/java-xiao-gen-dui-er-fen-da-an-chang-shi-jie-shi-e/)ï¼‰\n\n**è§£æ³•ä¸€**\n\nå°æ ¹å †ï¼Œå¤šè·¯å½’å¹¶ï¼Œæ²¡å•¥å¥½è¯´çš„\n```java\npublic int kthSmallest(int[][] matrix, int k) {\n    PriorityQueue<Pair> pq = new PriorityQueue<>((p1,p2)->matrix[p1.x][p1.y] - matrix[p2.x][p2.y]);\n    for(int i = 0;i < matrix.length; i++){\n        pq.add(new Pair(i, 0));  \n    } \n    while(k > 1){\n        Pair pair = pq.poll();\n        if(pair.y + 1 < matrix[0].length){\n            pq.add(new Pair(pair.x, pair.y+1));   \n        }\n        k--;\n    }\n    return matrix[pq.peek().x][pq.peek().y];\n}\n\nclass Pair{\n    int x, y;\n    public Pair(int x, int y){\n        this.x = x;\n        this.y = y;\n    }\n}\n```\n\n**è§£æ³•äºŒ**\n\näºŒåˆ†ç­”æ¡ˆï¼Œæˆ‘ä»¬æ±‚çš„å…ƒç´ ä¸€å®šæ˜¯åœ¨`matrix[0][0]~matrix[n-1][n-1]`ä¹‹é—´ï¼Œå–ä¸­é—´æŸä¸ªå…ƒç´ `mid`ï¼Œå¤§äº`mid`çš„éƒ½åˆ†å¸ƒåœ¨å³ä¸‹è§’ï¼Œå°äº`mid`çš„çš„åˆ†å¸ƒåœ¨å³ä¸Šè§’ï¼Œè¶Šå¾€å³ä¸Šèµ°ï¼Œå°äº`mid`çš„å…ƒç´ å°±è¶Šå°‘ï¼Œå¤§äº`mid`çš„å…ƒç´ å°±è¶Šå¤šï¼Œæ‰€ä»¥æ•´ä½“æ˜¯å…·æœ‰å•è°ƒæ€§çš„ï¼Œæ‰€ä»¥å¯ä»¥äºŒåˆ†\n\nç„¶åæˆ‘è®¤ä¸ºå¾ˆå…³é”®çš„ä¸€ä¸ªåœ°æ–¹å°±æ˜¯äºŒåˆ†çš„å†™æ³•ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ [zlsçš„ä¸€ä¸ªäºŒåˆ†æ¨¡æ¿](https://www.bilibili.com/video/BV1YT4y137G4)ï¼Œä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªæ˜¯ç­”æ¡ˆåŒºé—´ï¼Œä¸€ä¸ªæ˜¯æ’é™¤åŒºé—´ï¼Œåœ¨ç­”æ¡ˆåŒºé—´è®°å½•ç­”æ¡ˆï¼Œç°åœ¨é—®é¢˜å°±æ˜¯ï¼šæ˜¯ç”¨ `<=` ä½œä¸ºç­”æ¡ˆåŒºé—´ï¼Œè¿˜æ˜¯ç”¨ `>=`åšä¸ºç­”æ¡ˆåŒºé—´ï¼Ÿ\n\nä¸¤ç§æ–¹æ³•çš„åŒºåˆ«å°±æ˜¯åŒºé—´æ”¶ç¼©çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯`left=mid+1`åè€…æ˜¯`right=mid-1`ï¼Œæ‰€ä»¥é—®é¢˜å…¶å®å°±å˜æˆäº†ï¼šå½“**å°äºç­‰äºmidçš„æ•°é‡==k**çš„æ—¶å€™ï¼ŒäºŒåˆ†çš„åŒºé—´åº”è¯¥å¦‚ä½•ç¼©å‡ï¼Ÿ\n\nå…¶å®ä¸¾ä¸ªä¾‹å­å°±æ‡‚äº†\n```go\nmatrix = [\n   [ 1,  5,  9],\n   [10, 11, 13],\n   [12, 13, 15]\n],\nk = 2\n```\nk=2ï¼Œå¯¹åº”ç»“æœåº”è¯¥æ˜¯5ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨mid=8ï¼Œè¿™é‡Œ8å’Œ5åœ¨çŸ©é˜µä¸­å°äºç­‰äºå®ƒä»¬çš„æ•°é‡æ˜¯ç›¸åŒçš„ï¼Œè¿™ä¸ªæ—¶å€™å¾ˆæ˜æ˜¾åº”è¯¥ç¼©çŸ­rightå»é€¼è¿‘5ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥é€‰å–`>=`ä½œä¸ºç­”æ¡ˆåŒºé—´å¹¶è®°å½•ç­”æ¡ˆï¼Œå¹¶ä¸”ç¼©çŸ­righté€¼è¿‘çŸ©é˜µä¸­çœŸå®å­˜åœ¨çš„å€¼\n\n>è¿™é‡Œæ˜¯ä¸€å®šæ˜¯å¯ä»¥å–åˆ°çŸ©é˜µä¸­çš„å€¼çš„ï¼ŒäºŒåˆ†æœ€åä¼šåœ¨å¤§äºç­‰äºåŒºåŸŸä¸æ–­ç¼©å‡rightç›´è‡³ä¸èƒ½å†ç¼©å‡ï¼Œä¹Ÿå°±æ˜¯ç¼©å‡æˆä¸ºçŸ©é˜µä¸­çš„å…ƒç´ ï¼ˆå†ç¼©å‡å°±å°äºKäº†ï¼‰\n```java\npublic int kthSmallest(int[][] matrix, int k) {\n    int n = matrix.length;\n    int left = matrix[0][0];\n    int right = matrix[n-1][n-1];\n    int res = left;\n    while(left <= right){\n        int mid = left + (right - left)/2;\n        //æ³¨æ„è¿™ä¸ªåœ°æ–¹ï¼Œå¾ˆå…³é”®ï¼Œæ ¸å¿ƒå°±æ˜¯è¿™ä¸ªç­‰äºå·çš„ä½ç½®ï¼Œåœ¨å°äºç­‰äºmidçš„æ•°é‡==kçš„æ—¶å€™äºŒåˆ†çš„åŒºé—´åº”è¯¥å¦‚ä½•ç§»åŠ¨\n        //å…¶å®ä¸¾ä¸ªä¾‹å­å°±æ‡‚äº†ï¼Œå‡è®¾k=2ï¼Œå¯¹äºç»“æœåº”è¯¥æ˜¯5ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨mid=8\n        //è¿™é‡Œ8å’Œ5åœ¨çŸ©é˜µä¸­å°äºç­‰äºå®ƒä»¬çš„æ•°é‡æ˜¯ç›¸åŒçš„ï¼Œè¿™ä¸ªæ—¶å€™å¾ˆæ˜æ˜¾åº”è¯¥ç¼©çŸ­rightå»é€¼è¿‘5\n        //æ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨äºŒåˆ†çš„å¤§äºç­‰äºåŒºé—´è®°å½•ç­”æ¡ˆï¼Œå¹¶ä¸”ç¼©çŸ­right\n        if (check(matrix, mid) >= k){\n            res = mid;\n            right = mid - 1;\n        }else{\n            left = mid + 1;\n        }\n    }\n    return res;\n}\n\n//æ£€æŸ¥æ•°ç»„ä¸­å°äºç­‰äºmidçš„ä¸ªæ•°\npublic int check(int[][] matrix, int mid){\n    int row = matrix.length-1, column = 0;\n    int count = 0;\n    int lastRow = 0; \n    while(row >= 0){\n        while (column < matrix[0].length && matrix[row][column] <= mid){\n            column++;\n            lastRow++;\n        }\n        count += lastRow;\n        row--;\n    }\n    return count;\n}\n```\n\n## [441. æ’åˆ—ç¡¬å¸](https://leetcode-cn.com/problems/arranging-coins/)\n\nDifficulty: **ç®€å•**\n\nä½ æ€»å…±æœ‰Â _nÂ _æšç¡¬å¸ï¼Œä½ éœ€è¦å°†å®ƒä»¬æ‘†æˆä¸€ä¸ªé˜¶æ¢¯å½¢çŠ¶ï¼Œç¬¬Â _kÂ _è¡Œå°±å¿…é¡»æ­£å¥½æœ‰Â _kÂ _æšç¡¬å¸ã€‚\n\nç»™å®šä¸€ä¸ªæ•°å­—Â _n_ï¼Œæ‰¾å‡ºå¯å½¢æˆå®Œæ•´é˜¶æ¢¯è¡Œçš„æ€»è¡Œæ•°ã€‚\n\n_nÂ _æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œå¹¶ä¸”åœ¨32ä½æœ‰ç¬¦å·æ•´å‹çš„èŒƒå›´å†…ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```\nn = 5\n\nç¡¬å¸å¯æ’åˆ—æˆä»¥ä¸‹å‡ è¡Œ:\nÂ¤\nÂ¤ Â¤\nÂ¤ Â¤\n\nå› ä¸ºç¬¬ä¸‰è¡Œä¸å®Œæ•´ï¼Œæ‰€ä»¥è¿”å›2.\n```\n\n**ç¤ºä¾‹ 2:**\n\n```\nn = 8\n\nç¡¬å¸å¯æ’åˆ—æˆä»¥ä¸‹å‡ è¡Œ:\nÂ¤\nÂ¤ Â¤\nÂ¤ Â¤ Â¤\nÂ¤ Â¤\n\nå› ä¸ºç¬¬å››è¡Œä¸å®Œæ•´ï¼Œæ‰€ä»¥è¿”å›3.\n```\n**è§£æ³•ä¸€**\n\nå› ä¸ºæ˜¯ä»äºŒåˆ†çš„tagæ¥çš„ï¼Œæ‰€ä»¥çŸ¥é“æ˜¯äºŒåˆ†ï¼Œç„¶åçœ‹äº†é¢˜ï¼Œç¡®å®šäº†æœ‰äºŒåˆ†ç­”æ¡ˆæ€§è´¨ï¼Œç„¶åç›´æ¥äºŒåˆ†ï¼Œå¯æ˜¯æ²¡æƒ³åˆ°å±…ç„¶æº¢å‡ºäº†ï¼Œçœ‹æ¥è¿˜æ˜¯æœ‰ç‚¹å¤§æ„äº†å•Šï¼Œæ—¶é—´å¤æ‚åº¦O(logN)\n```java\n//äºŒåˆ†ç­”æ¡ˆ\npublic int arrangeCoins(int n) {\n    int left = 1;\n    int right = n;\n    int res = 0;\n    while(left <= right){\n        long mid = left + (right - left)/2;\n        long sum = (1 + mid) * mid / 2;\n        if(sum <= n){\n            res = (int)mid;\n            left = (int)mid + 1;\n        }else{\n            right = (int)mid - 1;\n        }\n    }\n    return res;\n}\n```\nè¿™é¢˜å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æ¨¡æ‹Ÿï¼Œä¸è¿‡æ„ä¹‰ä¸å¤§ï¼Œè¿™é¢˜è¿˜æœ‰æ•°å­¦çš„è§£æ³•ï¼Œæ ¹æ®æ±‚å’Œå…¬å¼ç›´æ¥ç®—å‡ºæ ¹ï¼Œç„¶ååˆ©ç”¨sqrtå‡½æ•°ï¼Œè¿™æ ·å¹¶ä¸ä¼šæ¯”äºŒåˆ†å¿«å¤šå°‘ï¼Œsqrtä¹Ÿæ˜¯logNçº§åˆ«çš„ï¼Œè€Œä¸”é¢è¯•å®˜åº”è¯¥ä¹Ÿä¸å¸Œæœ›ä½ åˆ©ç”¨åº“å‡½æ•°ï¼ˆå½“ç„¶äººå¦‚æœèƒ½æ‰‹å†™ç‰›é¡¿è¿­ä»£æ³•é‚£è‚¯å®šæ²¡é—®é¢˜ï¼‰\n\n## [174. åœ°ä¸‹åŸæ¸¸æˆ](https://leetcode-cn.com/problems/dungeon-game/)\n\nDifficulty: **å›°éš¾**\n\n\nä¸€äº›æ¶é­”æŠ“ä½äº†å…¬ä¸»ï¼ˆ**P**ï¼‰å¹¶å°†å¥¹å…³åœ¨äº†åœ°ä¸‹åŸçš„å³ä¸‹è§’ã€‚åœ°ä¸‹åŸæ˜¯ç”±Â M x N ä¸ªæˆ¿é—´ç»„æˆçš„äºŒç»´ç½‘æ ¼ã€‚æˆ‘ä»¬è‹±å‹‡çš„éª‘å£«ï¼ˆ**K**ï¼‰æœ€åˆè¢«å®‰ç½®åœ¨å·¦ä¸Šè§’çš„æˆ¿é—´é‡Œï¼Œä»–å¿…é¡»ç©¿è¿‡åœ°ä¸‹åŸå¹¶é€šè¿‡å¯¹æŠ—æ¶é­”æ¥æ‹¯æ•‘å…¬ä¸»ã€‚\n\néª‘å£«çš„åˆå§‹å¥åº·ç‚¹æ•°ä¸ºä¸€ä¸ªæ­£æ•´æ•°ã€‚å¦‚æœä»–çš„å¥åº·ç‚¹æ•°åœ¨æŸä¸€æ—¶åˆ»é™è‡³ 0 æˆ–ä»¥ä¸‹ï¼Œä»–ä¼šç«‹å³æ­»äº¡ã€‚\n\næœ‰äº›æˆ¿é—´ç”±æ¶é­”å®ˆå«ï¼Œå› æ­¤éª‘å£«åœ¨è¿›å…¥è¿™äº›æˆ¿é—´æ—¶ä¼šå¤±å»å¥åº·ç‚¹æ•°ï¼ˆè‹¥æˆ¿é—´é‡Œçš„å€¼ä¸ºè´Ÿæ•´æ•°ï¼Œåˆ™è¡¨ç¤ºéª‘å£«å°†æŸå¤±å¥åº·ç‚¹æ•°ï¼‰ï¼›å…¶ä»–æˆ¿é—´è¦ä¹ˆæ˜¯ç©ºçš„ï¼ˆæˆ¿é—´é‡Œçš„å€¼ä¸º 0ï¼‰ï¼Œè¦ä¹ˆåŒ…å«å¢åŠ éª‘å£«å¥åº·ç‚¹æ•°çš„é­”æ³•çƒï¼ˆè‹¥æˆ¿é—´é‡Œçš„å€¼ä¸ºæ­£æ•´æ•°ï¼Œåˆ™è¡¨ç¤ºéª‘å£«å°†å¢åŠ å¥åº·ç‚¹æ•°ï¼‰ã€‚\n\nä¸ºäº†å°½å¿«åˆ°è¾¾å…¬ä¸»ï¼Œéª‘å£«å†³å®šæ¯æ¬¡åªå‘å³æˆ–å‘ä¸‹ç§»åŠ¨ä¸€æ­¥ã€‚\n\n**ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—ç¡®ä¿éª‘å£«èƒ½å¤Ÿæ‹¯æ•‘åˆ°å…¬ä¸»æ‰€éœ€çš„æœ€ä½åˆå§‹å¥åº·ç‚¹æ•°ã€‚**\n\nä¾‹å¦‚ï¼Œè€ƒè™‘åˆ°å¦‚ä¸‹å¸ƒå±€çš„åœ°ä¸‹åŸï¼Œå¦‚æœéª‘å£«éµå¾ªæœ€ä½³è·¯å¾„ `å³ -> å³ -> ä¸‹ -> ä¸‹`ï¼Œåˆ™éª‘å£«çš„åˆå§‹å¥åº·ç‚¹æ•°è‡³å°‘ä¸º **7**ã€‚\n\n<table class=\"dungeon\" style=\"display: table;\">\n\n<tbody style=\"display: table-row-group;\">\n\n<tr style=\"display: table-row;\">\n\n<td style=\"display: table-cell;\">-2 (K)</td>\n\n<td style=\"display: table-cell;\">-3</td>\n\n<td style=\"display: table-cell;\">3</td>\n\n</tr>\n\n<tr style=\"display: table-row;\">\n\n<td style=\"display: table-cell;\">-5</td>\n\n<td style=\"display: table-cell;\">-10</td>\n\n<td style=\"display: table-cell;\">1</td>\n\n</tr>\n\n<tr style=\"display: table-row;\">\n\n<td style=\"display: table-cell;\">10</td>\n\n<td style=\"display: table-cell;\">30</td>\n\n<td style=\"display: table-cell;\">-5 (P)</td>\n\n</tr>\n\n</tbody>\n\n</table>\n\n**è¯´æ˜:**\n\n*   éª‘å£«çš„å¥åº·ç‚¹æ•°æ²¡æœ‰ä¸Šé™ã€‚\n\n*   ä»»ä½•æˆ¿é—´éƒ½å¯èƒ½å¯¹éª‘å£«çš„å¥åº·ç‚¹æ•°é€ æˆå¨èƒï¼Œä¹Ÿå¯èƒ½å¢åŠ éª‘å£«çš„å¥åº·ç‚¹æ•°ï¼ŒåŒ…æ‹¬éª‘å£«è¿›å…¥çš„å·¦ä¸Šè§’æˆ¿é—´ä»¥åŠå…¬ä¸»è¢«ç›‘ç¦çš„å³ä¸‹è§’æˆ¿é—´ã€‚\n\n\n**è§£æ³•ä¸€**\n\nä»¥åæ¯æ—¥ä¸€é¢˜æ²¡å†™å‡ºæ¥ä¹‹å‰ç»å£ä¸çœ‹ç¾¤äº†ï¼Œçœ‹äº†ä¸€çœ¼ç¾¤ï¼Œçœ‹è§ç¾¤å‹è®¨è®ºäº†è¿™é¢˜ï¼Œè¯´äº†äºŒåˆ†å’Œdpï¼Œç„¶åæˆ‘å°±ç›´æ¥å‘äºŒåˆ†çš„æ–¹å‘å»æƒ³äº†ï¼Œå¦‚æœç‹¬ç«‹çš„æƒ³çš„è¯ï¼Œåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å¾—å‡ºäºŒåˆ†çš„è§£æ³•çš„ï¼Œæ¯•ç«Ÿé¢˜ç›®çš„æè¿°å¾ˆæ˜æ˜¾å°±æ˜¯äºŒåˆ†ç­”æ¡ˆï¼Œ**æœ€ä½çš„å¥åº·è¡€é‡**ï¼Œå¤§äºè¿™ä¸ªè¡€é‡çš„è‚¯å®šå¯ä»¥æ•‘å‡ºæ¥ï¼Œå°äºè¿™ä¸ªè¡€é‡çš„è‚¯å®šæ•‘ä¸å‡ºæ¥ï¼Œæ‰€ä»¥checkå°±æ˜¯åˆ¤æ–­åœ¨æŸä¸ªè¡€é‡ä¸‹ï¼Œèƒ½å¦æ‹¯æ•‘åˆ°å…¬ä¸»ï¼ˆDPï¼‰\n\næ—¶é—´å¤æ‚åº¦O(N^2logN)ï¼ˆå…¶å®æˆ‘è®¤ä¸ºä¹Ÿå¯ä»¥å½“ä½œN^2æ¯•ç«Ÿä¸Šä¸‹ç•Œéƒ½ç¡®å®šäº†ï¼ŒlogNä¹Ÿå°±30å·¦å³ï¼‰ï¼Œè¿™ç§è§£æ³•ä¹ŸæŒºä¸é”™çš„ï¼Œèåˆäº†äºŒåˆ†å’Œdp\n\n```java\npublic int calculateMinimumHP(int[][] dungeon) {\n    int left = 0;\n    int right = Integer.MAX_VALUE;\n    int res = 0;\n    while(left <= right){\n        int mid = left + (right-left)/2;\n        if(check(dungeon, mid)){\n            res = mid;\n            right = mid - 1;\n        }else{\n            left = mid + 1;\n        }\n    }\n    return res;\n}\n\npublic boolean check(int[][] dungeon, int live){\n    int m = dungeon.length;\n    int n = dungeon[0].length;\n    int INF = Integer.MIN_VALUE;\n    //liveçš„è¡€é‡ä»å·¦ä¸Šåˆ°dungeon[i][j]çš„å‰©ä½™æœ€å¤šè¡€é‡\n    int[][] dp = new int[m+1][n+1];\n    //åœ°ç‰¢å¤–å›´åŠ ä¸ŠINFçš„å›´å¢™ï¼Œç®€åŒ–é€»è¾‘\n    Arrays.fill(dp[0], INF);\n    dp[0][1] = live;\n    for(int i = 1; i <= m; i++){\n        dp[i][0] = INF;\n        for(int j = 1; j <= n; j++){\n            if(dp[i-1][j] <= 0 && dp[i][j-1] <=0 ){\n                dp[i][j] = INF; //æ— æ³•åˆ°è¾¾è¿™é‡Œ\n            }else{\n                dp[i][j] = dungeon[i-1][j-1] + Math.max(dp[i][j-1], dp[i-1][j]);\n            }\n        }\n    }\n    return dp[m][n] > 0;\n}\n```\nå½“ç„¶è¿™é¢˜ä¹Ÿæœ‰çº¯dpçš„åšæ³•ï¼Œå¾ˆå¯æƒœï¼Œæˆ‘å‹æ ¹æ²¡å¾€ä¸Šé¢æƒ³ï¼Œæˆ‘åªæƒ³ç€äºŒåˆ†dpï¼Œå†™å®Œäº†ACä¹‹åå°±å»çœ‹è¯„è®ºåŒºäº†ï¼Œç»“æœå‘ç°å¤§å®¶éƒ½æ˜¯ç›´æ¥dpçš„ã€‚ã€‚ã€‚ç„¶åè¿˜çœ‹åˆ°äº†ä¸€ä¸ªå…³é”®è¯ï¼šé€†å‘dpï¼Œç„¶åèµ¶ç´§å…³äº†è¯„è®ºåŒºå›æ¥å†™äº†ä¸‹é¢çš„dpè§£æ³•\n\n**è§£æ³•äºŒ**\n```java\n/*\n    -2  -3  3\n    -5 -10  1\n    10  30 -5 1\n            \n    7   5   2\n    6  11   5\n    1   1   6\n*/\npublic int calculateMinimumHP(int[][] dungeon) {\n    int m = dungeon.length;\n    int n = dungeon[0].length;\n    int INF = Integer.MAX_VALUE;\n    //ä»dungeon[i-1][j-1]åˆ°å³ä¸‹è§’è‡³å°‘è¦å¤šå°‘è¡€é‡\n    int[][] dp = new int[m+1][n+1];\n    Arrays.fill(dp[m], INF);//æœ«è¡Œ\n    dp[m][n-1] = 1; //åˆå§‹è¡€é‡\n    for (int i = m-1; i >= 0; i--) {\n        dp[i][n] = INF; //é¦–åˆ—å’Œå°¾åˆ—\n        for (int j = n-1; j >= 0; j--) {\n            dp[i][j] = Math.max(Math.min(dp[i+1][j], dp[i][j+1]) - dungeon[i][j], 1);\n        }\n    }\n    return dp[0][0];\n}\n```\nè¿™é¢˜ä¸ºå•¥ä¸èƒ½æ­£å‘dpå‘¢ï¼Œè®¾`dp[i][j]`ä¸ºä»å·¦ä¸Šè§’åˆ°i,jæ‰€éœ€è¦çš„æœ€ä½è¡€é‡? å…¶å®è¿™ä¸ªå¾ˆæ˜æ˜¾å°±æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ²¡åŠæ³•è½¬ç§»ï¼Œ`dp[i][j]`å’Œ`dp[i-1][j]`æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œéƒ½ä¸ä¸€å®šæ˜¯åŒä¸€æ¡è·¯å¾„\n\n## [848. åŠ æ²¹ç«™ä¹‹é—´çš„æœ€å°è·ç¦»ï¼ˆLintCodeï¼‰](https://www.lintcode.com/problem/minimize-max-distance-to-gas-station/description)\n\nåœ¨æ°´å¹³æ•°è½´ä¸Šï¼Œæˆ‘ä»¬æœ‰åŠ æ²¹ç«™ï¼šstations[0], stations[1], ..., stations[N-1], è¿™é‡ŒN = stations.lengthã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬å†å¢åŠ Kä¸ªåŠ æ²¹ç«™ï¼ŒDè¡¨ç¤ºç›¸é‚»åŠ æ²¹ç«™ä¹‹é—´çš„æœ€å¤§è·ç¦»ï¼Œè¿™æ ·Då°±å˜å°äº†ã€‚\n\nè¿”å›æ‰€æœ‰å¯èƒ½å€¼Dä¸­æœ€å°å€¼ã€‚\n1. stations.length ä¸ºæ•´æ•°ï¼ŒèŒƒå›´ [10, 2000].\n2. stations[i] ä¸ºæ•´æ•°ï¼ŒèŒƒå›´ [0, 10^8].\n3. K ä¸ºæ•´æ•°ï¼ŒèŒƒå›´ [1, 10^6].\n4. ç­”æ¡ˆèŒƒå›´åœ¨10 ^ -6ä¹‹å†…çš„æœ‰ç†æ•°ã€‚\n   \n**æ ·ä¾‹ 1:**\n```go\nè¾“å…¥ï¼šstations = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]ï¼ŒK = 9\nè¾“å‡ºï¼š0.50\nè§£é‡Šï¼šç›¸é‚»åŠ æ²¹ç«™çš„è·ç¦»å‡ä¸º0.50\n```\n**æ ·ä¾‹ 2:**\n```go\nè¾“å…¥ï¼šstations = [3,6,12,19,33,44,67,72,89,95]ï¼ŒK = 2\nè¾“å‡ºï¼š14.00\nè§£é‡Šï¼šåœ¨è·ç¦»86å¤„å»ºé€ åŠ æ²¹ç«™(fix: è¿˜æœ‰58å¤„)\n```\n\n**è§£æ³•ä¸€**\n\näºŒåˆ†ç­”æ¡ˆçš„æ€§è´¨å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯è¿™é‡Œå’Œä¹‹å‰çš„ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯æµ®ç‚¹æ•°äºŒåˆ†ï¼Œå’Œæ•´æ•°çš„ä¸å¤ªä¸€æ ·ï¼Œæµ®ç‚¹æ•°/2çš„æ—¶å€™éƒ½æ˜¯å®é™…çš„ä¸€åˆ†ä¸º2ï¼Œä¸ä¼šæœ‰æ•´é™¤çš„é—®é¢˜ï¼ŒåŒæ—¶é¢˜ç›®ç»™å‡ºäº†eps=1e-6ï¼Œåªè¦leftå’Œrightè¯¯å·®åœ¨è¿™ä¸ªèŒƒå›´å†…å°±æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸æ˜¯è¦æ±‚leftå’Œrightç›¸ç­‰ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™é‡Œå¦‚æœepså¤ªå°çš„è¯ç”±äºç²¾åº¦é—®é¢˜è¿˜æ˜¯å¯èƒ½ä¼štleï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é‡‡å–å›ºå®šå¾ªç¯æ¬¡æ•°çš„æ–¹å¼é€¼è¿‘ï¼Œä¸€èˆ¬å–100ï¼Œ200å°±å¤Ÿäº†\n```java\npublic double minmaxGasDist(int[] stations, int k) {\n    // Write your code here\n    double left = 0;\n    double right = 1e8+1;\n    double res = right;\n    //for (int i = 0; i <= 100; i++){\n    while (right-left >= 1e-6){\n        double mid = left+(right-left)/2;\n        if (check(stations, k, mid)) {\n            res = mid;\n            right = mid;\n        }else{\n            left = mid;\n        }\n    }\n    return res;\n}\n\npublic boolean check(int[] stations, int k, double D) {\n    int count = 0;\n    for (int i = 1; i < stations.length; i++) {\n        count += (stations[i]-stations[i-1]) / D;\n    }\n    return count <= k;        \n}\n```\n\n## [5489. ä¸¤çƒä¹‹é—´çš„ç£åŠ›](https://leetcode-cn.com/problems/magnetic-force-between-two-balls/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nåœ¨ä»£å·ä¸º C-137 çš„åœ°çƒä¸Šï¼ŒRick å‘ç°å¦‚æœä»–å°†ä¸¤ä¸ªçƒæ”¾åœ¨ä»–æ–°å‘æ˜çš„ç¯®å­é‡Œï¼Œå®ƒä»¬ä¹‹é—´ä¼šå½¢æˆç‰¹æ®Šå½¢å¼çš„ç£åŠ›ã€‚Rick æœ‰Â `n`Â ä¸ªç©ºçš„ç¯®å­ï¼Œç¬¬Â `i`Â ä¸ªç¯®å­çš„ä½ç½®åœ¨Â `position[i]`Â ï¼ŒMortyÂ æƒ³æŠŠÂ `m`Â ä¸ªçƒæ”¾åˆ°è¿™äº›ç¯®å­é‡Œï¼Œä½¿å¾—ä»»æ„ä¸¤çƒé—´Â **æœ€å°ç£åŠ›**Â æœ€å¤§ã€‚\n\nå·²çŸ¥ä¸¤ä¸ªçƒå¦‚æœåˆ†åˆ«ä½äºÂ `x`Â å’ŒÂ `y`Â ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„ç£åŠ›ä¸ºÂ `|x - y|`Â ã€‚\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â `position`Â å’Œä¸€ä¸ªæ•´æ•°Â `m`Â ï¼Œè¯·ä½ è¿”å›æœ€å¤§åŒ–çš„æœ€å°ç£åŠ›ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![mark](http://static.imlgw.top/blog/20200816/1KmEXzfFOozs.png?imageslim)\n```go\nè¾“å…¥ï¼šposition = [1,2,3,4,7], m = 3\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šå°† 3 ä¸ªçƒåˆ†åˆ«æ”¾å…¥ä½äº 1ï¼Œ4 å’Œ 7 çš„ä¸‰ä¸ªç¯®å­ï¼Œä¸¤çƒé—´çš„ç£åŠ›åˆ†åˆ«ä¸º [3, 3, 6]ã€‚æœ€å°ç£åŠ›ä¸º 3 ã€‚æˆ‘ä»¬æ²¡åŠæ³•è®©æœ€å°ç£åŠ›å¤§äº 3 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šposition = [5,4,3,2,1,1000000000], m = 2\nè¾“å‡ºï¼š999999999\nè§£é‡Šï¼šæˆ‘ä»¬ä½¿ç”¨ä½äº 1 å’Œ 1000000000 çš„ç¯®å­æ—¶æœ€å°ç£åŠ›æœ€å¤§ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `n == position.length`\n*   `2 <= n <= 10^5`\n*   `1 <= position[i] <= 10^9`\n*   æ‰€æœ‰Â `position`Â ä¸­çš„æ•´æ•° **äº’ä¸ç›¸åŒ**Â ã€‚\n*   `2 <= m <= position.length`\n\n\n**è§£æ³•ä¸€**\n\n202å‘¨èµ›T3ï¼Œæ²¡å‚èµ›ï¼ˆå®åœ¨æ˜¯æ²¡æ—¶é—´æ‰“ï¼‰èµ›åç‹¬ç«‹çš„å†™å‡ºæ¥äº†ï¼Œå¾ˆæ˜æ˜¾æ˜¯äºŒåˆ†ç­”æ¡ˆï¼Œä¸è¿‡è¿™é‡Œæœ‰ä¸€ç‚¹å°ä¸åŒ\n```java\npublic int maxDistance(int[] position, int m) {\n    Arrays.sort(position);\n    int left = 1;\n    int right = (int)1e9+1;\n    int res = 1;\n    while (left <= right) {\n        int mid = left + (right-left)/2;\n        if (check(position, m, mid)) {\n            res = mid;\n            left = mid + 1; \n        }else{\n            right = mid - 1;\n        }\n    }\n    return res;\n}\n//1  1000 2000 3000 m=3\n//éªŒè¯åœ¨è·ç¦»è‡³å°‘ä¸ºforceçš„æƒ…å†µä¸‹èƒ½å¦æ”¾ä¸‹æ‰€æœ‰çš„çƒï¼Œç„¶åå¢å¤§forceé€¼è¿‘ç­”æ¡ˆ\n//æ‰€ä»¥checkéªŒè¯æˆåŠŸçš„ä¸ä¸€å®šæ˜¯åˆæ³•çš„ç­”æ¡ˆï¼Œä½†æ˜¯æœ€ç»ˆä¸€å®šä¼šåˆ°è¾¾real ans\n//ç±»ä¼¼ã€378. æœ‰åºçŸ©é˜µä¸­ç¬¬Kå°çš„å…ƒç´ ã€‘è¿™é“é¢˜\npublic boolean check(int[] position, int m, int force) {\n    int last = position[0];\n    m--;\n    for (int i = 1; i < position.length; i++) {\n        if (position[i]-last < force) {\n            continue;\n        }\n        last = position[i];\n        m--;\n        if (m==0) return true;\n    }\n    return false;\n}\n```\ncheckç±»ä¼¼[378. æœ‰åºçŸ©é˜µä¸­ç¬¬Kå°çš„å…ƒç´ ](#378-æœ‰åºçŸ©é˜µä¸­ç¬¬kå°çš„å…ƒç´ )è¿™é“é¢˜ï¼Œéƒ½æ˜¯é€¼è¿‘ç­”æ¡ˆï¼Œè€Œä¸æ˜¯éªŒè¯ç­”æ¡ˆï¼Œå…¶å®ä¸€å¼€å§‹æˆ‘çš„checkä¸æ˜¯è¿™æ ·å†™çš„ï¼Œå†™çš„å¾ˆä¸‘ï¼Œè¿™é‡Œçœ‹äº†åˆ«äººçš„å†™æ³•å‘ç°continueæœ‰æ—¶å€™è¿˜æ˜¯æŒºå¥½ç”¨çš„","tags":["LeetCode","äºŒåˆ†"],"categories":["ç®—æ³•"]},{"title":"å †å’Œä¼˜å…ˆé˜Ÿåˆ—","url":"/2019/12/01/dui-he-you-xian-dui-lie/","content":"\n### å †\n\né¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ï¼Œå †å®é™…ä¸Šæ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼Œå€ŸåŠ©**å®Œå…¨äºŒå‰æ ‘**çˆ¶å­èŠ‚ç‚¹å…³ç³»çš„æ€§è´¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨æ•°ç»„ä¸­å®ç°è¿™ä¸€ç»“æ„ï¼Œè€Œå †ä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å¤§æ ¹å †ï¼Œé¡¾åæ€ä¹‰ä¹Ÿå°±æ˜¯çˆ¶èŠ‚ç‚¹valueå¤§äºå­èŠ‚ç‚¹valueï¼Œå°æ ¹å †åˆ™ç›¸å\n\n### åŠ¨æ€æ•°ç»„\n\nå€ŸåŠ©è¿™ä¸ªç±»å®ç°å †ç»“æ„ï¼Œç›´æ¥ç”¨`ArrayList`ä¹Ÿå¯ä»¥\n\n```java\n\npublic class Array<E> {\n\n    private E[] data;\n    private int size;\n\n    // æ„é€ å‡½æ•°ï¼Œä¼ å…¥æ•°ç»„çš„å®¹é‡capacityæ„é€ Array\n    public Array(int capacity){\n        data = (E[])new Object[capacity];\n        size = 0;\n    }\n\n    // æ— å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œé»˜è®¤æ•°ç»„çš„å®¹é‡capacity=10\n    public Array(){\n        this(10);\n    }\n\n    // è·å–æ•°ç»„çš„å®¹é‡\n    public int getCapacity(){\n        return data.length;\n    }\n\n    // è·å–æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°\n    public int getSize(){\n        return size;\n    }\n\n    // è¿”å›æ•°ç»„æ˜¯å¦ä¸ºç©º\n    public boolean isEmpty(){\n        return size == 0;\n    }\n\n    // åœ¨indexç´¢å¼•çš„ä½ç½®æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ e\n    public void add(int index, E e){\n        if(index < 0 || index > size)\n            throw new IllegalArgumentException(\"Add failed. Require index >= 0 and index <= size.\");\n        if(size == data.length)\n            resize(2 * data.length); //2å€æ‰©å®¹\n        for(int i = size - 1; i >= index ; i --){\n            data[i + 1] = data[i];\n        }\n        data[index] = e;\n        size ++;\n    }\n\n    // å‘æ‰€æœ‰å…ƒç´ åæ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ \n    public void addLast(E e){\n        add(size, e);\n    }\n\n    // åœ¨æ‰€æœ‰å…ƒç´ å‰æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ \n    public void addFirst(E e){\n        add(0, e);\n    }\n\n    // è·å–indexç´¢å¼•ä½ç½®çš„å…ƒç´ \n    public E get(int index){\n        if(index < 0 || index >= size)\n            throw new IllegalArgumentException(\"Get failed. Index is illegal.\");\n        return data[index];\n    }\n\n    // ä¿®æ”¹indexç´¢å¼•ä½ç½®çš„å…ƒç´ ä¸ºe\n    public void set(int index, E e){\n        if(index < 0 || index >= size)\n            throw new IllegalArgumentException(\"Set failed. Index is illegal.\");\n        data[index] = e;\n    }\n\n    // æŸ¥æ‰¾æ•°ç»„ä¸­æ˜¯å¦æœ‰å…ƒç´ e\n    public boolean contains(E e){\n        for(int i = 0 ; i < size ; i ++){\n            if(data[i].equals(e))\n                return true;\n        }\n        return false;\n    }\n\n    // æŸ¥æ‰¾æ•°ç»„ä¸­å…ƒç´ eæ‰€åœ¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨å…ƒç´ eï¼Œåˆ™è¿”å›-1\n    public int find(E e){\n        for(int i = 0 ; i < size ; i ++){\n            if(data[i].equals(e))\n                return i;\n        }\n        return -1;\n    }\n\n    // ä»æ•°ç»„ä¸­åˆ é™¤indexä½ç½®çš„å…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ \n    public E remove(int index){\n        if(index < 0 || index >= size)\n            throw new IllegalArgumentException(\"Remove failed. Index is illegal.\");\n\n        E ret = data[index];\n        for(int i = index + 1 ; i < size ; i ++)\n            data[i - 1] = data[i];\n        size --;\n        data[size] = null; // loitering objects != memory leak\n        //æ•°æ®ä¸åˆ°1/4çš„æ—¶å€™ç¼©å‡\n        if(size == data.length / 4 && data.length / 2 != 0)\n            resize(data.length / 2);\n        return ret;\n    }\n\n    // ä»æ•°ç»„ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ \n    public E removeFirst(){\n        return remove(0);\n    }\n\n    // ä»æ•°ç»„ä¸­åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ \n    public E removeLast(){\n        return remove(size - 1);\n    }\n\n    // ä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ e\n    public void removeElement(E e){\n        int index = find(e);\n        if(index != -1)\n            remove(index);\n    }\n\n    //äº¤æ¢\n    public void swap(int a,int b){\n        if (a<0||a>=size || b<0||b>=size) {\n            throw new IllegalArgumentException(\"index illegal\");\n        }\n        E temp=data[a];\n        data[a]=data[b];\n        data[b]=temp;\n    }\n\n    @Override\n    public String toString(){\n\n        StringBuilder res = new StringBuilder();\n        res.append(String.format(\"Array: size = %d , capacity = %d\\n\", size, data.length));\n        res.append('[');\n        for(int i = 0 ; i < size ; i ++){\n            res.append(data[i]);\n            if(i != size - 1)\n                res.append(\", \");\n        }\n        res.append(']');\n        return res.toString();\n    }\n\n    // å°†æ•°ç»„ç©ºé—´çš„å®¹é‡å˜æˆnewCapacityå¤§å°\n    private void resize(int newCapacity){\n        E[] newData = (E[])new Object[newCapacity];\n        for(int i = 0 ; i < size ; i ++)\n            newData[i] = data[i];\n        data = newData;\n    }\n}\n\n```\n\n### å¤§æ ¹å †\n\n```java\npublic class MaxHeap<E extends Comparable<E>>{\n    private Array<E> data;\n\n    public MaxHeap(int capacity){\n        data=new Array<>(capacity);\n    }\n\n    public MaxHeap(){\n        data=new Array<>();\n    }\n\n    public int size(){\n        return data.getSize();\n    }\n\n    public boolean isEmpty(){\n        return data.isEmpty();\n    }\n\n    //çˆ¶èŠ‚ç‚¹\n    private int parent(int index){\n        if (index==0) {\n            throw new IllegalArgumentException(\"index 0 don't have parent\");\n        }\n        return (index-1)/2;\n    }\n\n    //å·¦å­©å­\n    private int leftChild(int index){\n        return index*2+1;\n    }\n\n    //å³å­©å­\n    private int rightChild(int index){\n        return index*2+2;\n    }\n\n    public void add(E e){\n        data.addLast(e);\n        siftUp(data.getSize()-1);\n    }\n\n    //ä¸Šæµ®\n    private void siftUp(int cur){\n        while(cur>0 && data.get(parent(cur)).compareTo(data.get(cur)) < 0){\n            data.swap(cur,parent(cur));\n            cur=parent(cur);\n        }\n    }\n\n    public E findMax(){\n        if (data.getSize()==0) {\n            throw new IllegalArgumentException(\"heap is empty !!!\");\n        }\n        return  data.get(0);\n    }\n\n    public E popMax(){\n        if (data.getSize()==0) {\n            throw new IllegalArgumentException(\"heap is empty !!!\");\n        }\n        E res=findMax();\n        data.swap(0,data.getSize()-1);\n        data.removeLast();\n        siftDown(0);\n        return res;\n    }    \n\n    private void siftDown(int cur){\n        while(leftChild(cur)<data.getSize()){ //æœ‰å·¦å­©å­\n            int large=leftChild(cur);\n            //å¦‚æœä¹Ÿæœ‰å³å­©å­,å°±æ¯”è¾ƒä¸‹ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼å–æœ€å¤§å€¼\n            if (large+1<data.getSize() && data.get(large).compareTo(data.get(large+1))<0) {\n                large=large+1;\n            }\n            //æ¯”å·¦å³å­©å­éƒ½å¤§å°±ç›´æ¥ç»“æŸäº†\n            if (data.get(large).compareTo(data.get(cur))<=0){\n                return;\n            }\n            data.swap(large,cur);\n            cur=large;\n        }\n    }\n}\n```\n\nå…¶å®ä¸Šé¢çš„å®ç°è¿˜æ˜¯æœ‰ä¸€äº›ç¼ºé™·çš„ï¼Œåªèƒ½æŒ‰ç…§ç»™å®šçš„é”®çš„é»˜è®¤æ’åºè§„åˆ™è¿›è¡Œæ¯”è¾ƒï¼Œä¸æ–¹ä¾¿å®ç°è‡ªå®šä¹‰çš„æ¯”è¾ƒè§„åˆ™ï¼Œéœ€è¦è¿›è¡Œå°è£…æ‰å¯ä»¥ï¼Œå…³äºè¿™ä¸€ç‚¹å…¶å®å¯ä»¥å€Ÿé‰´Javaä¸­çš„`PriorityQueue`\n\n### æµ‹è¯•\n\n```java\nimport java.util.*;\npublic class HeapTest{\n    public static void main(String[] args) {\n        int[] nums=generateRandomArray(50000000,500);\n        MaxHeap heap=new MaxHeap();\n        for (int i=0;i<nums.length;i++) {\n            heap.add(nums[i]);\n        }\n        for (int i=0;i<nums.length;i++) {\n            nums[i]=(int)heap.popMax();\n        }\n        for (int i=1;i<nums.length;i++) {\n            if (nums[i-1]<nums[i]) {\n                System.out.println(\"fuxk!!!\");\n                return;\n            }\n        }\n        System.out.println(\"sucess!!!!!\");\n    }\n\n    // for test\n    public static int[] generateRandomArray(int maxSize, int maxValue) {\n        int[] arr = new int[(int) ((maxSize + 1) * Math.random())];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = (int) ((maxValue + 1) * Math.random()) - (int) (maxValue * Math.random());\n        }\n        return arr;\n    }\n}\n```\n\n### PriorityQueue\n\n```java\npackage java.util;\n\nimport java.util.function.Consumer;\nimport sun.misc.SharedSecrets;\n\n/**\n * An unbounded priority {@linkplain Queue queue} based on a priority heap.\n * The elements of the priority queue are ordered according to their\n * {@linkplain Comparable natural ordering}, or by a {@link Comparator}\n * provided at queue construction time, depending on which constructor is\n * used.  A priority queue does not permit {@code null} elements.\n * A priority queue relying on natural ordering also does not permit\n * insertion of non-comparable objects (doing so may result in\n * {@code ClassCastException}).\n *\n * <p>The <em>head</em> of this queue is the <em>least</em> element\n * with respect to the specified ordering.  If multiple elements are\n * tied for least value, the head is one of those elements -- ties are\n * broken arbitrarily.  The queue retrieval operations {@code poll},\n * {@code remove}, {@code peek}, and {@code element} access the\n * element at the head of the queue.\n *\n * <p>A priority queue is unbounded, but has an internal\n * <i>capacity</i> governing the size of an array used to store the\n * elements on the queue.  It is always at least as large as the queue\n * size.  As elements are added to a priority queue, its capacity\n * grows automatically.  The details of the growth policy are not\n * specified.\n *\n * <p>This class and its iterator implement all of the\n * <em>optional</em> methods of the {@link Collection} and {@link\n * Iterator} interfaces.  The Iterator provided in method {@link\n * #iterator()} is <em>not</em> guaranteed to traverse the elements of\n * the priority queue in any particular order. If you need ordered\n * traversal, consider using {@code Arrays.sort(pq.toArray())}.\n *\n * <p><strong>Note that this implementation is not synchronized.</strong>\n * Multiple threads should not access a {@code PriorityQueue}\n * instance concurrently if any of the threads modifies the queue.\n * Instead, use the thread-safe {@link\n * java.util.concurrent.PriorityBlockingQueue} class.\n *\n * <p>Implementation note: this implementation provides\n * O(log(n)) time for the enqueuing and dequeuing methods\n * ({@code offer}, {@code poll}, {@code remove()} and {@code add});\n * linear time for the {@code remove(Object)} and {@code contains(Object)}\n * methods; and constant time for the retrieval methods\n * ({@code peek}, {@code element}, and {@code size}).\n *\n * <p>This class is a member of the\n * <a href=\"{@docRoot}/../technotes/guides/collections/index.html\">\n * Java Collections Framework</a>.\n *\n * @since 1.5\n * @author Josh Bloch, Doug Lea\n * @param <E> the type of elements held in this collection\n */\npublic class PriorityQueue<E> extends AbstractQueue<E>\n    implements java.io.Serializable {\n\n    private static final long serialVersionUID = -7720805057305804111L;\n\n    private static final int DEFAULT_INITIAL_CAPACITY = 11;\n\n    /**\n     * Priority queue represented as a balanced binary heap: the two\n     * children of queue[n] are queue[2*n+1] and queue[2*(n+1)].  The\n     * priority queue is ordered by comparator, or by the elements'\n     * natural ordering, if comparator is null: For each node n in the\n     * heap and each descendant d of n, n <= d.  The element with the\n     * lowest value is in queue[0], assuming the queue is nonempty.\n     */\n    transient Object[] queue; // non-private to simplify nested class access\n\n    /**\n     * The number of elements in the priority queue.\n     */\n    private int size = 0;\n\n    /**\n     * The comparator, or null if priority queue uses elements'\n     * natural ordering.\n     * å¦‚æœæ²¡æœ‰ä¼ å…¥æ¯”è¾ƒå™¨çš„è¯ï¼ŒæŒ‰ç…§å…ƒç´ çš„è‡ªç„¶æ’åºè¿›è¡Œæ¯”è¾ƒ\n     */\n    private final Comparator<? super E> comparator;\n\n    /**\n     * The number of times this priority queue has been\n     * <i>structurally modified</i>.  See AbstractList for gory details.\n     */\n    transient int modCount = 0; // non-private to simplify nested class access\n\n    /**\n     * Creates a {@code PriorityQueue} with the default initial\n     * capacity (11) that orders its elements according to their\n     * {@linkplain Comparable natural ordering}.\n     */\n    public PriorityQueue() {\n        this(DEFAULT_INITIAL_CAPACITY, null);\n    }\n\n    public PriorityQueue(int initialCapacity) {\n        this(initialCapacity, null);\n    }\n    \n    //ä¼ å…¥è‡ªå®šä¹‰çš„æ¯”è¾ƒè§„åˆ™\n    public PriorityQueue(Comparator<? super E> comparator) {\n        this(DEFAULT_INITIAL_CAPACITY, comparator);\n    }\n\n    public PriorityQueue(int initialCapacity,\n                         Comparator<? super E> comparator) {\n        // Note: This restriction of at least one is not actually needed,\n        // but continues for 1.5 compatibility\n        if (initialCapacity < 1)\n            throw new IllegalArgumentException();\n        this.queue = new Object[initialCapacity];\n        this.comparator = comparator;\n    }\n\n    /**\n     * Creates a {@code PriorityQueue} containing the elements in the\n     * specified collection.  If the specified collection is an instance of\n     * a {@link SortedSet} or is another {@code PriorityQueue}, this\n     * priority queue will be ordered according to the same ordering.\n     * Otherwise, this priority queue will be ordered according to the\n     * {@linkplain Comparable natural ordering} of its elements.\n     * ä¼ å…¥ä¸€ä¸ªé›†åˆç±»å‹ï¼Œå¦‚æœæ˜¯SortSetï¼ˆæœ‰åºï¼‰ç±»å‹çš„é›†åˆæˆ–è€…ä¹Ÿæ˜¯PriorityQueueå°±ä¼šæŒ‰ç…§ç›¸åŒçš„è§„åˆ™å»æ¯”è¾ƒã€‚\n     * å¦åˆ™å°±ä¼šæŒ‰ç…§å…ƒç´ çš„è‡ªç„¶æ’åºè§„åˆ™å»æ¯”è¾ƒã€‚\n     * \n     * @param  c the collection whose elements are to be placed\n     *         into this priority queue\n     * @throws ClassCastException if elements of the specified collection\n     *         cannot be compared to one another according to the priority\n     *         queue's ordering\n     * @throws NullPointerException if the specified collection or any\n     *         of its elements are null\n     */\n    @SuppressWarnings(\"unchecked\")\n    public PriorityQueue(Collection<? extends E> c) {\n        if (c instanceof SortedSet<?>) {\n            SortedSet<? extends E> ss = (SortedSet<? extends E>) c;\n            //æ‹¿åˆ°SortSeté›†åˆä¸­å…ƒç´ çš„æ¯”è¾ƒå™¨ï¼Œç”¨äºååºçš„æ“ä½œ\n            this.comparator = (Comparator<? super E>) ss.comparator();\n            initElementsFromCollection(ss);\n        }\n        else if (c instanceof PriorityQueue<?>) {\n            PriorityQueue<? extends E> pq = (PriorityQueue<? extends E>) c;\n            this.comparator = (Comparator<? super E>) pq.comparator();\n            initFromPriorityQueue(pq);\n        }\n        else {\n            this.comparator = null;\n            initFromCollection(c);\n        }\n    }\n\n    /**\n     * Creates a {@code PriorityQueue} containing the elements in the\n     * specified priority queue.  This priority queue will be\n     * ordered according to the same ordering as the given priority\n     * queue.\n     *\n     * @param  c the priority queue whose elements are to be placed\n     *         into this priority queue\n     * @throws ClassCastException if elements of {@code c} cannot be\n     *         compared to one another according to {@code c}'s\n     *         ordering\n     * @throws NullPointerException if the specified priority queue or any\n     *         of its elements are null\n     */\n    @SuppressWarnings(\"unchecked\")\n    public PriorityQueue(PriorityQueue<? extends E> c) {\n        this.comparator = (Comparator<? super E>) c.comparator();\n        initFromPriorityQueue(c);\n    }\n\n    /**\n     * Creates a {@code PriorityQueue} containing the elements in the\n     * specified sorted set.   This priority queue will be ordered\n     * according to the same ordering as the given sorted set.\n     *\n     * @param  c the sorted set whose elements are to be placed\n     *         into this priority queue\n     * @throws ClassCastException if elements of the specified sorted\n     *         set cannot be compared to one another according to the\n     *         sorted set's ordering\n     * @throws NullPointerException if the specified sorted set or any\n     *         of its elements are null\n     */\n    @SuppressWarnings(\"unchecked\")\n    public PriorityQueue(SortedSet<? extends E> c) {\n        this.comparator = (Comparator<? super E>) c.comparator();\n        initElementsFromCollection(c);\n    }\n\n    private void initFromPriorityQueue(PriorityQueue<? extends E> c) {\n        if (c.getClass() == PriorityQueue.class) {\n            this.queue = c.toArray();\n            this.size = c.size();\n        } else {\n            initFromCollection(c);\n        }\n    }\n\t\n\t//ä»SortSetæœ‰åºé›†åˆä¸­çš„å…ƒç´ ç›´æ¥å¤åˆ¶åˆ°å½“å‰çš„queueä¸­\n    private void initElementsFromCollection(Collection<? extends E> c) {\n        Object[] a = c.toArray();\n        // If c.toArray incorrectly doesn't return Object[], copy it.\n        if (a.getClass() != Object[].class)\n            a = Arrays.copyOf(a, a.length, Object[].class);\n        int len = a.length;\n        if (len == 1 || this.comparator != null)\n            for (int i = 0; i < len; i++)\n                if (a[i] == null)\n                    throw new NullPointerException();\n        this.queue = a;\n        this.size = a.length;\n    }\n\n    /**\n     * Initializes queue array with elements from the given Collection.\n     * ä»æ— åºé›†åˆä¸­æ„å»ºqueue\n     * @param c the collection\n     */\n    private void initFromCollection(Collection<? extends E> c) {\n        initElementsFromCollection(c);\n        //å¤åˆ¶å®Œæˆä¹‹åè¿›è¡Œè°ƒæ•´\n        heapify();\n    }\n\n    /**\n     * The maximum size of array to allocate.\n     * Some VMs reserve some header words in an array.\n     * Attempts to allocate larger arrays may result in\n     * OutOfMemoryError: Requested array size exceeds VM limit\n     */\n    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;\n\n    /**\n     * Increases the capacity of the array.\n     * queue æ•°ç»„æ‰©å®¹\n     * @param minCapacity the desired minimum capacity\n     */\n    private void grow(int minCapacity) {\n        int oldCapacity = queue.length;\n        // Double size if small; else grow by 50%\n        int newCapacity = oldCapacity + ((oldCapacity < 64) ?\n                                         (oldCapacity + 2) :\n                                         (oldCapacity >> 1));\n        // overflow-conscious code\n        if (newCapacity - MAX_ARRAY_SIZE > 0)\n            newCapacity = hugeCapacity(minCapacity);\n        queue = Arrays.copyOf(queue, newCapacity);\n    }\n\n    private static int hugeCapacity(int minCapacity) {\n        if (minCapacity < 0) // overflow\n            throw new OutOfMemoryError();\n        return (minCapacity > MAX_ARRAY_SIZE) ?\n            Integer.MAX_VALUE :\n            MAX_ARRAY_SIZE;\n    }\n\n    /**\n     * Inserts the specified element into this priority queue.\n     *\n     * @return {@code true} (as specified by {@link Collection#add})\n     * @throws ClassCastException if the specified element cannot be\n     *         compared with elements currently in this priority queue\n     *         according to the priority queue's ordering\n     * @throws NullPointerException if the specified element is null\n     */\n    public boolean add(E e) {\n        return offer(e);\n    }\n\n    /**\n     * Inserts the specified element into this priority queue.\n     *\n     * @return {@code true} (as specified by {@link Queue#offer})\n     * @throws ClassCastException if the specified element cannot be\n     *         compared with elements currently in this priority queue\n     *         according to the priority queue's ordering\n     * @throws NullPointerException if the specified element is null\n     */\n    public boolean offer(E e) {\n        if (e == null)\n            throw new NullPointerException();\n        modCount++;\n        int i = size;\n        if (i >= queue.length)\n            grow(i + 1);\n        size = i + 1;\n        if (i == 0)\n            queue[0] = e;\n        else\n            siftUp(i, e);\n        return true;\n    }\n\n    public E peek() {\n        return (size == 0) ? null : (E) queue[0];\n    }\n\n    private int indexOf(Object o) {\n        if (o != null) {\n            for (int i = 0; i < size; i++)\n                if (o.equals(queue[i]))\n                    return i;\n        }\n        return -1;\n    }\n\n    /**\n     * Removes a single instance of the specified element from this queue,\n     * if it is present.  More formally, removes an element {@code e} such\n     * that {@code o.equals(e)}, if this queue contains one or more such\n     * elements.  Returns {@code true} if and only if this queue contained\n     * the specified element (or equivalently, if this queue changed as a\n     * result of the call).\n     *\n     * @param o element to be removed from this queue, if present\n     * @return {@code true} if this queue changed as a result of the call\n     */\n    public boolean remove(Object o) {\n        int i = indexOf(o);\n        if (i == -1)\n            return false;\n        else {\n            removeAt(i);\n            return true;\n        }\n    }\n\n    /**\n     * Version of remove using reference equality, not equals.\n     * Needed by iterator.remove.\n     *\n     * @param o element to be removed from this queue, if present\n     * @return {@code true} if removed\n     */\n    boolean removeEq(Object o) {\n        for (int i = 0; i < size; i++) {\n            if (o == queue[i]) {\n                removeAt(i);\n                return true;\n            }\n        }\n        return false;\n    }\n\n\n    public boolean contains(Object o) {\n        return indexOf(o) != -1;\n    }\n\n\n    public Object[] toArray() {\n        return Arrays.copyOf(queue, size);\n    }\n\n    public <T> T[] toArray(T[] a) {\n        final int size = this.size;\n        if (a.length < size)\n            // Make a new array of a's runtime type, but my contents:\n            return (T[]) Arrays.copyOf(queue, size, a.getClass());\n        System.arraycopy(queue, 0, a, 0, size);\n        if (a.length > size)\n            a[size] = null;\n        return a;\n    }\n\n    public Iterator<E> iterator() {\n        return new Itr();\n    }\n\n    private final class Itr implements Iterator<E> {\n        /**\n         * Index (into queue array) of element to be returned by\n         * subsequent call to next.\n         */\n        private int cursor = 0;\n\n        /**\n         * Index of element returned by most recent call to next,\n         * unless that element came from the forgetMeNot list.\n         * Set to -1 if element is deleted by a call to remove.\n         */\n        private int lastRet = -1;\n\n\n        private ArrayDeque<E> forgetMeNot = null;\n\n        /**\n         * Element returned by the most recent call to next iff that\n         * element was drawn from the forgetMeNot list.\n         */\n        private E lastRetElt = null;\n\n        /**\n         * The modCount value that the iterator believes that the backing\n         * Queue should have.  If this expectation is violated, the iterator\n         * has detected concurrent modification.\n         */\n        private int expectedModCount = modCount;\n\n        public boolean hasNext() {\n            return cursor < size ||\n                (forgetMeNot != null && !forgetMeNot.isEmpty());\n        }\n\n        @SuppressWarnings(\"unchecked\")\n        public E next() {\n            if (expectedModCount != modCount)\n                throw new ConcurrentModificationException();\n            if (cursor < size)\n                return (E) queue[lastRet = cursor++];\n            if (forgetMeNot != null) {\n                lastRet = -1;\n                lastRetElt = forgetMeNot.poll();\n                if (lastRetElt != null)\n                    return lastRetElt;\n            }\n            throw new NoSuchElementException();\n        }\n\n        public void remove() {\n            if (expectedModCount != modCount)\n                throw new ConcurrentModificationException();\n            if (lastRet != -1) {\n                E moved = PriorityQueue.this.removeAt(lastRet);\n                lastRet = -1;\n                if (moved == null)\n                    cursor--;\n                else {\n                    if (forgetMeNot == null)\n                        forgetMeNot = new ArrayDeque<>();\n                    forgetMeNot.add(moved);\n                }\n            } else if (lastRetElt != null) {\n                PriorityQueue.this.removeEq(lastRetElt);\n                lastRetElt = null;\n            } else {\n                throw new IllegalStateException();\n            }\n            expectedModCount = modCount;\n        }\n    }\n\n    public int size() {\n        return size;\n    }\n\n    public void clear() {\n        modCount++;\n        for (int i = 0; i < size; i++)\n            queue[i] = null;\n        size = 0;\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    public E poll() {\n        if (size == 0)\n            return null;\n        int s = --size;\n        modCount++;\n        E result = (E) queue[0];\n        E x = (E) queue[s];\n        queue[s] = null;\n        if (s != 0)\n            siftDown(0, x);\n        return result;\n    }\n\n    /**\n     * Removes the ith element from queue.\n     * åˆ é™¤æŸä¸ªä½ç½®çš„å…ƒç´ \n     * Normally this method leaves the elements at up to i-1,\n     * inclusive, untouched.  Under these circumstances, it returns\n     * null.  Occasionally, in order to maintain the heap invariant,\n     * it must swap a later element of the list with one earlier than\n     * i.  Under these circumstances, this method returns the element\n     * that was previously at the end of the list and is now at some\n     * position before i. This fact is used by iterator.remove so as to\n     * avoid missing traversing elements.\n     */\n    private E removeAt(int i) {\n        // assert i >= 0 && i < size;\n        modCount++;\n        int s = --size;\n        if (s == i) // removed last element ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ \n            queue[i] = null;\n        else {\n            E moved = (E) queue[s]; //ä¿å­˜é˜Ÿåˆ—å°¾éƒ¨çš„å…ƒç´ \n            queue[s] = null; //ç½®ä¸ºnull\n            siftDown(i, moved); //movedç›´æ¥æ’å…¥åˆ°iä½ç½®ï¼Œç›¸å½“äºç›´æ¥åˆ é™¤äº†iä½ç½®çš„å…ƒç´ \n            if (queue[i] == moved) {\n                siftUp(i, moved);\n                if (queue[i] != moved)\n                    return moved;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Inserts item x at position k, maintaining heap invariant by\n     * promoting x up the tree until it is greater than or equal to\n     * its parent, or is the root.\n     * å°†xæ’å…¥kä½ç½®ï¼Œå¹¶è¿›è¡Œä¸Šæµ®è°ƒæ•´\n     * To simplify and speed up coercions and comparisons. the\n     * Comparable and Comparator versions are separated into different\n     * methods that are otherwise identical. (Similarly for siftDown.)\n     *\n     * @param k the position to fill\n     * @param x the item to insert\n     */\n    private void siftUp(int k, E x) {\n        if (comparator != null)\n            siftUpUsingComparator(k, x);\n        else\n            siftUpComparable(k, x);\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    private void siftUpComparable(int k, E x) {\n        Comparable<? super E> key = (Comparable<? super E>) x;\n        while (k > 0) {\n            int parent = (k - 1) >>> 1;\n            Object e = queue[parent];\n            if (key.compareTo((E) e) >= 0)\n                break;\n            queue[k] = e;\n            k = parent;\n        }\n        queue[k] = key;\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    private void siftUpUsingComparator(int k, E x) {\n        while (k > 0) {\n            int parent = (k - 1) >>> 1;\n            Object e = queue[parent];\n            if (comparator.compare(x, (E) e) >= 0)\n                break;\n            queue[k] = e;\n            k = parent;\n        }\n        queue[k] = x;\n    }\n\n    /**\n     * Inserts item x at position k, maintaining heap invariant by\n     * demoting x down the tree repeatedly until it is less than or\n     * equal to its children or is a leaf.\n     * æ’å…¥å…ƒç´ xåˆ°åˆ°ä½ç½®k,å¹¶è¿›è¡Œä¸‹æ²‰è°ƒæ•´\n     * \n     * @param k the position to fill\n     * @param x the item to insert\n     */\n    private void siftDown(int k, E x) {\n        if (comparator != null)\n            siftDownUsingComparator(k, x);  //å¸¦æ¯”è¾ƒå™¨çš„\n        else\n            siftDownComparable(k, x); //ä¸å¸¦æ¯”è¾ƒå™¨ï¼Œç”¨xçš„compator\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    private void siftDownComparable(int k, E x) {\n        Comparable<? super E> key = (Comparable<? super E>)x;\n        int half = size >>> 1;        // loop while a non-leaf\n        while (k < half) {\n            int child = (k << 1) + 1; // assume left child is least\n            Object c = queue[child];\n            int right = child + 1;\n            if (right < size &&\n                ((Comparable<? super E>) c).compareTo((E) queue[right]) > 0)\n                c = queue[child = right];\n            if (key.compareTo((E) c) <= 0)\n                break;\n            queue[k] = c;\n            k = child;\n        }\n        queue[k] = key;\n    }\n\n    @SuppressWarnings(\"unchecked\")\n    private void siftDownUsingComparator(int k, E x) {\n        int half = size >>> 1;\n        while (k < half) {\n            int child = (k << 1) + 1;\n            Object c = queue[child];\n            int right = child + 1;\n            if (right < size &&\n                comparator.compare((E) c, (E) queue[right]) > 0)\n                c = queue[child = right];\n            if (comparator.compare(x, (E) c) <= 0)\n                break;\n            queue[k] = c;\n            k = child;\n        }\n        queue[k] = x;\n    }\n\n    /**\n     * Establishes the heap invariant (described above) in the entire tree,\n     * assuming nothing about the order of the elements prior to the call.\n     */\n    @SuppressWarnings(\"unchecked\")\n    private void heapify() {\n        for (int i = (size >>> 1) - 1; i >= 0; i--)\n            siftDown(i, (E) queue[i]);\n    }\n\n    public Comparator<? super E> comparator() {\n        return comparator;\n    }\n\n    /**\n     * Saves this queue to a stream (that is, serializes it).\n     *\n     * @serialData The length of the array backing the instance is\n     *             emitted (int), followed by all of its elements\n     *             (each an {@code Object}) in the proper order.\n     * @param s the stream\n     */\n    private void writeObject(java.io.ObjectOutputStream s)\n        throws java.io.IOException {\n        // Write out element count, and any hidden stuff\n        s.defaultWriteObject();\n\n        // Write out array length, for compatibility with 1.5 version\n        s.writeInt(Math.max(2, size + 1));\n\n        // Write out all elements in the \"proper order\".\n        for (int i = 0; i < size; i++)\n            s.writeObject(queue[i]);\n    }\n\n    /**\n     * Reconstitutes the {@code PriorityQueue} instance from a stream\n     * (that is, deserializes it).\n     *\n     * @param s the stream\n     */\n    private void readObject(java.io.ObjectInputStream s)\n        throws java.io.IOException, ClassNotFoundException {\n        // Read in size, and any hidden stuff\n        s.defaultReadObject();\n\n        // Read in (and discard) array length\n        s.readInt();\n\n        SharedSecrets.getJavaOISAccess().checkArray(s, Object[].class, size);\n        queue = new Object[size];\n\n        // Read in all elements.\n        for (int i = 0; i < size; i++)\n            queue[i] = s.readObject();\n\n        // Elements are guaranteed to be in \"proper order\", but the\n        // spec has never explained what that might be.\n        heapify();\n    }\n\n    /**\n     * Creates a <em><a href=\"Spliterator.html#binding\">late-binding</a></em>\n     * and <em>fail-fast</em> {@link Spliterator} over the elements in this\n     * queue.\n     *\n     * <p>The {@code Spliterator} reports {@link Spliterator#SIZED},\n     * {@link Spliterator#SUBSIZED}, and {@link Spliterator#NONNULL}.\n     * Overriding implementations should document the reporting of additional\n     * characteristic values.\n     *\n     * @return a {@code Spliterator} over the elements in this queue\n     * @since 1.8\n     */\n    public final Spliterator<E> spliterator() {\n        return new PriorityQueueSpliterator<E>(this, 0, -1, 0);\n    }\n\n    static final class PriorityQueueSpliterator<E> implements Spliterator<E> {\n        /*\n         * This is very similar to ArrayList Spliterator, except for\n         * extra null checks.\n         */\n        private final PriorityQueue<E> pq;\n        private int index;            // current index, modified on advance/split\n        private int fence;            // -1 until first use\n        private int expectedModCount; // initialized when fence set\n\n        /** Creates new spliterator covering the given range */\n        PriorityQueueSpliterator(PriorityQueue<E> pq, int origin, int fence,\n                             int expectedModCount) {\n            this.pq = pq;\n            this.index = origin;\n            this.fence = fence;\n            this.expectedModCount = expectedModCount;\n        }\n\n        private int getFence() { // initialize fence to size on first use\n            int hi;\n            if ((hi = fence) < 0) {\n                expectedModCount = pq.modCount;\n                hi = fence = pq.size;\n            }\n            return hi;\n        }\n\n        public PriorityQueueSpliterator<E> trySplit() {\n            int hi = getFence(), lo = index, mid = (lo + hi) >>> 1;\n            return (lo >= mid) ? null :\n                new PriorityQueueSpliterator<E>(pq, lo, index = mid,\n                                                expectedModCount);\n        }\n\n        @SuppressWarnings(\"unchecked\")\n        public void forEachRemaining(Consumer<? super E> action) {\n            int i, hi, mc; // hoist accesses and checks from loop\n            PriorityQueue<E> q; Object[] a;\n            if (action == null)\n                throw new NullPointerException();\n            if ((q = pq) != null && (a = q.queue) != null) {\n                if ((hi = fence) < 0) {\n                    mc = q.modCount;\n                    hi = q.size;\n                }\n                else\n                    mc = expectedModCount;\n                if ((i = index) >= 0 && (index = hi) <= a.length) {\n                    for (E e;; ++i) {\n                        if (i < hi) {\n                            if ((e = (E) a[i]) == null) // must be CME\n                                break;\n                            action.accept(e);\n                        }\n                        else if (q.modCount != mc)\n                            break;\n                        else\n                            return;\n                    }\n                }\n            }\n            throw new ConcurrentModificationException();\n        }\n\n        public boolean tryAdvance(Consumer<? super E> action) {\n            if (action == null)\n                throw new NullPointerException();\n            int hi = getFence(), lo = index;\n            if (lo >= 0 && lo < hi) {\n                index = lo + 1;\n                @SuppressWarnings(\"unchecked\") E e = (E)pq.queue[lo];\n                if (e == null)\n                    throw new ConcurrentModificationException();\n                action.accept(e);\n                if (pq.modCount != expectedModCount)\n                    throw new ConcurrentModificationException();\n                return true;\n            }\n            return false;\n        }\n\n        public long estimateSize() {\n            return (long) (getFence() - index);\n        }\n\n        public int characteristics() {\n            return Spliterator.SIZED | Spliterator.SUBSIZED | Spliterator.NONNULL;\n        }\n    }\n}\n\n```\n\n### æ‰©å±•\n\n**då‰å †**ï¼šå¤šå‰å †ï¼Œä¸Šé¢æˆ‘ä»¬å®ç°çš„éƒ½æ˜¯äºŒå‰å †ï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶æ‰©å±•ä¸ºå¤šå‰å †ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªå­èŠ‚ç‚¹\n\n**ç´¢å¼•å †**ï¼šæˆ‘ä»¬ä¸Šé¢å®ç°çš„äºŒå‰å †åªèƒ½çœ‹è§å †é¡¶çš„å…ƒç´ ï¼Œçœ‹ä¸åˆ°å †ä¸­çš„å…ƒç´ ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦æ“ä½œå †ä¸­é—´çš„å…ƒç´ ï¼Œç´¢å¼•å †é¡¾åæ€ä¹‰å°±æ˜¯æœ‰ç´¢å¼•å¯ä»¥å¯¹åº”æ¯ä¸ªå…ƒç´ ï¼Œå€Ÿæ­¤å°±å¯ä»¥æ“ä½œå †ä¸­é—´çš„å…ƒç´ \n\n**äºŒé¡¹å †**ï¼Œ**æ–æ³¢æ‹‰å¥‘å †** ..... è¿™äº›ç»“æ„å…¶å®éƒ½æ˜¯æ‰©å±•çš„ï¼Œç®€å•äº†è§£å³å¯\n\n### æºç åœ°å€\n\n[Github](https://github.com/imlgw/LeetCode/blob/master/tree/heap/MaxHeap.java)\n\n","tags":["æ•°æ®ç»“æ„","å †","ä¼˜å…ˆé˜Ÿåˆ—"],"categories":["æ•°æ®ç»“æ„"]},{"title":"LeetCodeèƒŒåŒ…é—®é¢˜","url":"/2019/11/29/leetcode-bei-bao-wen-ti/","content":"\n> ä»[åŠ¨æ€è§„åˆ’ä¸“é¢˜](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/) ä¸­æŠ½å–å‡ºæ¥çš„\n\n## [92.èƒŒåŒ…é—®é¢˜ï¼ˆlintCodeï¼‰](https://www.lintcode.com/problem/backpack/description)\n\nåœ¨nä¸ªç‰©å“ä¸­æŒ‘é€‰è‹¥å¹²ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œæœ€å¤šèƒ½è£…å¤šæ»¡ï¼Ÿå‡è®¾èƒŒåŒ…çš„å¤§å°ä¸ºmï¼Œæ¯ä¸ªç‰©å“çš„å¤§å°ä¸ºA[i]\n\n- ä½ ä¸å¯ä»¥å°†ç‰©å“è¿›è¡Œåˆ‡å‰²\n\n**æ ·ä¾‹**\n\n```java\næ ·ä¾‹ 1:\n\tè¾“å…¥:  [3,4,8,5], backpack size=10\n\tè¾“å‡º:  9\næ ·ä¾‹ 2:\n\tè¾“å…¥:  [2,3,5,7], backpack size=12\n\tè¾“å‡º:  12\n```\n\n**æŒ‘æˆ˜**\n\n- O(n x m) time and O(m) memory.\n\n- O(n x m) memory is also acceptable if you do not know how to optimize memory.\n\n**è§£æ³•ä¸€**\n\nè®°å¿†åŒ–é€’å½’ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼Œè£…æˆ–è€…ä¸è£…\n\n```java\n//ç”¨Integer[][],ç©ºé—´ä¼šè¶…ç©ºé—´ã€‚ã€‚ã€‚lintCodeå¥½ä¸¥æ ¼\nint [][] cache=null;    \n\npublic int backPack2(int m,int[] A) {\n    cache=new int[A.length+1][m+1];\n    for (int i=0;i<A.length;i++) {\n        Arrays.fill(cache[i],-1);   \n    }\n    if (A==null || A.length<=0) {\n        return 0;\n    }\n    return putPack(m,A,A.length-1);\n}\n\n//å°†A[index,A.len-1]èŒƒå›´å†…çš„å…ƒç´ è£…è¿›å¤§å°ä¸ºmçš„èƒŒåŒ…çš„æœ€å¤§æ”¶ç›Š\npublic int putPack(int m,int[] A,int index) {\n    //index==0çš„æ—¶å€™ä¸åº”è¯¥è¿”å›=0ä»£è¡¨ç¬¬ä¸€ä¸ª,æ˜¯å¯ä»¥è£…çš„\n    //å¯¹äºmä¹Ÿæ˜¯ä¸€æ ·, è¿™ç§è¾¹ç•Œæ€è€ƒä¸€ä¸‹må°±ç­‰äº0ï¼Œæˆ–è€…å°±åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œindexå°±ç­‰äº0è¿™ç§ç‰¹ä¾‹å°±å¯ä»¥\n    //åªè¦è¿™ç§ç‰¹ä¾‹æ˜¯æ­£ç¡®çš„é‚£ä¹ˆæ•´ä¸ªé€’å½’å°±æ˜¯æ­£ç¡®çš„,å¹¶ä¸éœ€è¦å»æ€è€ƒæ•´ä¸ªé€’å½’çš„ç»“æŸæ¡ä»¶\n    if (index<0 || m<=0) {\n        return 0;\n    }\n    if (cache[index][m]!=-1) {\n        return cache[index][m];\n    }\n    //ä¸è£…indexä½ç½®çš„å…ƒç´ \n    int res=putPack(m,A,index-1);\n    if (A[index]<=m) {\n        //è¯´æ˜å¯ä»¥è£…ä¸‹indexä½ç½®çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†indexä½ç½®çš„å…ƒç´ è£…è¿›å»è¯•è¯•çœ‹\n        //ç„¶åæ±‚å‡ºå‰©ä¸‹çš„ç©ºé—´è¿˜æœ€å¤šèƒ½è£…å¤šå°‘ï¼Œæœ€åæ±‚æ˜¯è£…indexæ”¶ç›Šå¤§è¿˜æ˜¯ä¸è£…indexæ”¶ç›Šå¤§\n        res=Math.max(res,A[index]+putPack(m-A[index],A,index-1));\n    }\n    cache[index][m]=res;\n    return res;\n}\n```\n\næš´åŠ›é€’å½’çš„æ—¶é—´å¤æ‚åº¦å°†ä¼šæ˜¯`O((2^N)*N)`\n\nå…¶å®æ•´ä¸ªé€’å½’çš„æ€è·¯æ˜¯å¾ˆæ¸…æ™°æ˜ç™½çš„ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸º0-1èƒŒåŒ…çš„åŸå› \n\n- ä¸é€‰çš„è¯ï¼ŒèƒŒåŒ…çš„å®¹é‡ä¸å˜ï¼Œæ”¹å˜ä¸ºé—®é¢˜`putPack(m,A,index-1)`\n- é€‰çš„è¯ï¼ŒèƒŒåŒ…çš„å®¹é‡å˜å°ï¼Œæ”¹å˜ä¸ºé—®é¢˜`putPack(m-A[index],A,index-1)+A[index]`\n\nåˆ°åº•é€‰è¿˜æ˜¯ä¸é€‰ï¼Œå–å†³äºä¸¤ç§æ–¹æ¡ˆå“ªä¸€ç§æ›´å¥½ï¼Œæˆ‘ä»¬è¦æ±‚çš„ï¼Œå°±æ˜¯è¿™ä¸ªæœ€å¥½çš„æ–¹æ¡ˆï¼ŒçŸ¥é“äº†è¿™æ ·çš„é€’æ¨å…³ç³»åæˆ‘ä»¬å°±å¯ä»¥å¾ˆå®¹æ˜“çš„å†™å‡ºé€’å½’æ–¹ç¨‹ï¼Œè¿™é‡Œåœ¨é€’å½’çš„è¿‡ç¨‹ä¸­æœ‰å¯èƒ½ä¼šäº§ç”Ÿé‡å çš„å­é—®é¢˜ï¼ˆå…¶å®è¿™é‡Œæˆ‘è¿˜çº ç»“äº†å¥½ä¸€ä¼šå„¿ï¼Œæˆ‘ä¸€ç›´æ„Ÿè§‰æ²¡æœ‰é‡å çš„å­é—®é¢˜ï¼Œåæ¥ç”»ä¸€ä¸‹é€’å½’æ ‘å°±æ˜ç™½äº†ï¼Œåªæ˜¯é‡å çš„ä¸æ˜æ˜¾ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼“å­˜æ¯æ¬¡è®¡ç®—çš„ç»“æœæ¥è¿›è¡Œè®°å¿†åŒ–é€’å½’ï¼Œæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯`O(2^N)`ï¼Œç©ºé—´`O(M*N)`æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ\n\n> è¿™é‡Œä¸€å¼€å§‹æˆ‘æ˜¯æƒ³ç”¨`Integer[][]`çš„æ•°ç»„ï¼Œç„¶åå°±ä¸ç”¨èµ‹åˆå§‹å€¼ï¼Œåˆ¤æ–­ä¸ä¸ºnullå°±è¡Œï¼Œç»“æœç©ºé—´æº¢å‡ºäº†ã€‚ã€‚ã€‚lintCodeå¥½ä¸¥æ ¼ï¼Œæ¢æˆ`int[][]`ç„¶åèµ‹ä¸ªåˆå§‹å€¼å°±è¿‡äº†\n\n**è§£æ³•äºŒ**\n\nåŠ¨æ€è§„åˆ’è§£æ³•ï¼Œåœ¨è®²è§£ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªäºŒç»´è¡¨æ¥åˆ†æä¸‹æ•´ä¸ªé€’æ¨çš„è¿‡ç¨‹\n\nç‰©å“åˆ—è¡¨ï¼ˆæ ·ä¾‹1ï¼‰ï¼Œå› ä¸ºè¿™é¢˜ä»·å€¼å°±æ˜¯é‡é‡ï¼Œæ‰€ä»¥wå’Œvæ˜¯ä¸€æ ·çš„\n\n![mark](http://static.imlgw.top/blog/20200227/XIvS0eAf1FqA.png?imageslim)\n\n**DpTableï¼ˆæ ·ä¾‹1ï¼‰**\n\n![mark](http://static.imlgw.top/blog/20200227/YkPisR3fx1wa.png?imageslim)\n\nä¸€è¡Œä¸€è¡Œçš„çœ‹ï¼Œä»å·¦åˆ°å³ï¼Œ`dp[index][m]`ä»£è¡¨ **èƒŒåŒ…æ€»å®¹é‡ä¸è¶…è¿‡mçš„æƒ…å†µä¸‹ï¼Œè€ƒè™‘è£…å…¥`[0,index]`ä¸­çš„å…ƒç´ èƒ½è·å¾—æœ€å¤§æ”¶ç›Š**ï¼Œæ¯”å¦‚`dp[1][7]`ä»£è¡¨çš„å°±æ˜¯èƒŒåŒ…æ€»å®¹é‡ä¸è¶…è¿‡7çš„æƒ…å†µä¸‹ï¼Œè€ƒè™‘è£…å…¥`[0,1]` èŒƒå›´å†…çš„å…ƒç´ æ‰€èƒ½è·å¾—çš„æœ€å¤§æ”¶ç›Šï¼Œäººè„‘æ€è€ƒç»“æœè‡ªç„¶æ˜¯7äº†ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†æä¸‹å¦‚æœdpæ¨å‡ºè¿™ä¸ªç»“æœ\n\nå‰é¢æˆ‘ä»¬å·²ç»åˆ†æè¿‡0-1èƒŒåŒ…çš„é€’å½’è¿‡ç¨‹ï¼Œæ¯ä¸ªå…ƒç´ é¢ä¸´ä¸¤ä¸ªé€‰æ‹©ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·\n\n`dp[1][7]`å¦‚æœæˆ‘ä»¬é€‰æ‹©ä¸è£…å…¥å½“å‰indexä½ç½®çš„å…ƒç´ çš„è¯ï¼Œé‚£ä¹ˆæœ€å¤§æ”¶ç›Šå°±æ˜¯`dp[0][7]=3`è¿™ä¸€ç‚¹åº”è¯¥æ²¡å•¥ç–‘é—®\n\nå¦‚æœæˆ‘ä»¬è€ƒè™‘è£…å…¥å½“å‰indexä½ç½®çš„å…ƒç´ çš„è¯ï¼Œmè‚¯å®šä¼šå‡å°ï¼Œé‚£ä¹ˆæ‰€è·å¾—çš„æœ€å¤§æ”¶ç›Šå°±åº”è¯¥æ˜¯`A[index]+dp[0][7-4]=7` \n\n> æ³¨æ„è¿™é‡Œå½“å‰indexçš„å€¼éƒ½æ˜¯ä¾èµ–äºä¸Šä¸€å±‚`index-1`çš„è®¡ç®—ç»“æœçš„ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–äºä¸Šä¸€æ¬¡`m,[0,index-1]`æœ€å¤§å€¼çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„åˆå§‹åŒ–ç¬¬ä¸€å±‚çš„å€¼ï¼‰\n\næœ€åæˆ‘ä»¬å¾—åˆ°çš„æ ¸å¿ƒçŠ¶æ€æ–¹ç¨‹å°±æ˜¯ä¸‹é¢è¿™æ ·çš„\n\n`dp[index][m]=max(dp[index-1][m],A[index]+dp[index-1][j-A[index]])`\n\nç„¶åæˆ‘ä»¬æ ¹æ®è¿™ä¸ªå¾ˆå®¹æ˜“å°±å¯ä»¥å†™å‡ºdpçš„è§£æ³•\n\n```java\n//äºŒç»´åŠ¨æ€è§„åˆ’\npublic int backPack(int m,int[] A) {\n    if (A==null || A.length<=0) {\n        return 0;\n    }\n    int[][] dp=new int[A.length][m+1];\n    for (int i=0;i<A.length;i++) {\n        for (int j=0;j<=m;j++) {\n            if (j==0) {//åˆå§‹åŒ–ç¬¬ä¸€åˆ—\n                dp[i][j]=0;\n            }else if (i==0) {//åˆå§‹åŒ–ç¬¬ä¸€è¡Œ\n                dp[i][j]=j-A[i]>=0?A[i]:0;\n            }else if (i>0) {\n                dp[i][j]=j-A[i]>=0?Math.max(dp[i-1][j],dp[i-1][j-A[i]]+A[i]):dp[i-1][j];\n            }\n        }\n    }\n    return dp[A.length-1][m];\n}\n```\nå½“ç„¶æˆ‘ä»¬è‚¯å®šæ˜¯ä¸æ»¡è¶³äºè¿™ç§äºŒç»´çš„dpçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—ä¼˜åŒ–ä¸‹ç©ºé—´ï¼Œè¿™é‡Œæ¯ä¸€å±‚éƒ½åªä¾èµ–äºä¸Šä¸€å±‚çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä¹ˆå¾ˆå®¹æ˜“å°±å¯ä»¥æ”¹æˆä¸€ç»´çš„ï¼Œå½“ç„¶è¿™é‡Œè¿˜æœ‰ä¸ªå°å‘ï¼Œå¦‚æœç›´æ¥æŒ‰ç…§ä¸Šé¢çš„ä»£ç æ¥æ”¹çš„è¯å°±æ˜¯é”™çš„ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ­£ç¡®çš„æ”¹æ³•\n\n```java\npublic int backPack4(int m,int[] A) {\n    if (A==null || A.length<=0) {\n        return 0;\n    }\n    int[] dp=new int[m+1];\n    for (int i=0;i<A.length;i++) {\n        for (int j=m;j>=0;j--) {//ä»å³å‘å·¦ï¼Œé¿å…è¦†ç›–\n            if (j==0) {//åˆå§‹åŒ–ç¬¬ä¸€åˆ—\n                dp[j]=0;\n            }else if (i==0) {//åˆå§‹åŒ–ç¬¬ä¸€è¡Œ\n                dp[j]= j-A[i]>=0?A[i]:0;\n            }else{\n                dp[j]=j-A[i]>=0?Math.max(dp[j],dp[j-A[i]]+A[i]):dp[j];\n            }\n        }\n    }\n    return dp[m];\n}\n```\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„å†…å±‚å¾ªç¯ä¸å†æ˜¯ä»å·¦å¾€å³ï¼Œè€Œæ˜¯ä»å³å¾€å·¦ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯é¿å…äº†`dp[j-A[i]]`å·²ç»è¢«**å½“å‰å†…å±‚å¾ªç¯å‰é¢çš„å…ƒç´ **è¦†ç›–çš„å°´å°¬æƒ…å†µï¼Œç»“åˆä¸Šé¢çš„è¡¨æ¨ä¸€ä¸‹å°±çŸ¥é“äº†\n\n**è§£æ³•ä¸‰**\n\nç®—æ˜¯å¯¹ä¹‹å‰ä»£ç çš„ä¼˜åŒ–å§ï¼Œä¹‹å‰å†™çš„ä¹±ä¸ƒå…«ç³Ÿçš„\n\n```java\n//ä»£ç ä¼˜åŒ–\npublic int backPack(int m,int[] A) {\n    if (A==null || A.length<=0) {\n        return 0;\n    }\n    int[] dp=new int[m+1];\n    for (int i=0;i<A.length;i++) {\n        for (int j=m;j>=A[i];j--) {\n            dp[j]=Math.max(dp[j],dp[j-A[i]]+A[i]);\n        }\n    }\n    return dp[m];\n}\n```\n## [å®Œå…¨èƒŒåŒ…é—®é¢˜ï¼ˆacwingï¼‰](https://www.acwing.com/problem/content/description/3/) \n\næœ‰ N ç§ç‰©å“å’Œä¸€ä¸ªå®¹é‡æ˜¯ V çš„èƒŒåŒ…ï¼Œæ¯ç§ç‰©å“éƒ½æœ‰æ— é™ä»¶å¯ç”¨ã€‚\n\nç¬¬ i ç§ç‰©å“çš„ä½“ç§¯æ˜¯ viï¼Œä»·å€¼æ˜¯ wiã€‚\n\næ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œå¯ä½¿è¿™äº›ç‰©å“çš„æ€»ä½“ç§¯ä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ï¼Œä¸”æ€»ä»·å€¼æœ€å¤§ã€‚\nè¾“å‡ºæœ€å¤§ä»·å€¼ã€‚\n\n**è¾“å…¥æ ¼å¼**\n\nç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•°ï¼ŒNï¼ŒVç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç‰©å“ç§æ•°å’ŒèƒŒåŒ…å®¹ç§¯ã€‚\n\næ¥ä¸‹æ¥æœ‰ N è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° vi,wiç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç¬¬ i ç§ç‰©å“çš„ä½“ç§¯å’Œä»·å€¼ã€‚\n\n**è¾“å‡ºæ ¼å¼**\n\nè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§ä»·å€¼ã€‚\n\n**æ•°æ®èŒƒå›´**\n\n0<N,Vâ‰¤10000<N,Vâ‰¤1000\n0<vi,wiâ‰¤10000<vi,wiâ‰¤1000\n\n**è¾“å…¥æ ·ä¾‹**\n\n```java\n4 5\n1 2\n2 4\n3 4\n4 5\n```\n\n**è¾“å‡ºæ ·ä¾‹ï¼š**\n\n```java\n10\n```\n\n**è§£æ³•ä¸€**\n\nç›¸æ¯”01èƒŒåŒ…äº¤æ¢äº†å†…å¾ªç¯çš„é¡ºåºå°±okäº†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†æ¯ä¸ªç‰©å“æ‹†åˆ†ï¼Œä¸è¿‡å¤æ‚åº¦ä¼šå˜é«˜\n\n```java\nimport java.util.*;\npublic class Main{\n    public static void main(String[] args){\n        Scanner sc=new Scanner(System.in);\n        int N=sc.nextInt();\n        int V=sc.nextInt();\n        int[] dp=new int[V+1];\n        for(int i=0;i<N;i++){\n            int vi=sc.nextInt();\n            int wi=sc.nextInt();\n            for(int j=vi;j<=V;j++) {\n                dp[j]=Math.max(dp[j],dp[j-vi]+wi);\n            }\n        }\n        System.out.println(dp[V]);\n    }\n}\n```\n\nå…¶å®è¿™ä¸ªç»“è®ºè¦ç›´æ¥ç†è§£è¿˜æ˜¯æœ‰ç‚¹éš¾æ‡‚çš„ï¼Œå…·ä½“çš„æ¨å¯¼è¿‡ç¨‹å¯ä»¥çœ‹ä¸‹é¢çš„ [é›¶é’±å…‘æ¢](#322-é›¶é’±å…‘æ¢)\n\n## [416. åˆ†å‰²ç­‰å’Œå­é›†](https://leetcode-cn.com/problems/partition-equal-subset-sum/)\n\nç»™å®šä¸€ä¸ªåªåŒ…å«æ­£æ•´æ•°çš„éç©ºæ•°ç»„ã€‚æ˜¯å¦å¯ä»¥å°†è¿™ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ã€‚\n\n**æ³¨æ„:**\n\n1. æ¯ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ä¸ä¼šè¶…è¿‡ 100\n2. æ•°ç»„çš„å¤§å°ä¸ä¼šè¶…è¿‡ 200\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1, 5, 11, 5]\n\nè¾“å‡º: true\n\nè§£é‡Š: æ•°ç»„å¯ä»¥åˆ†å‰²æˆ [1, 5, 5] å’Œ [11].\n```\n\n**ç¤ºä¾‹ 2:**\n\n```\nè¾“å…¥: [1, 2, 3, 5]\n\nè¾“å‡º: false\n\nè§£é‡Š: æ•°ç»„ä¸èƒ½åˆ†å‰²æˆä¸¤ä¸ªå…ƒç´ å’Œç›¸ç­‰çš„å­é›†.\n```\n\n**è§£æ³•ä¸€**\n\nç°åœ¨é€’å½’å†™èµ·æ¥å·²ç»æœ‰ç‚¹æ„Ÿè§‰äº†ï¼Œç±»ä¼¼çš„é¢˜åŸºæœ¬ä¸Šéƒ½èƒ½å†™å‡ºè®°å¿†åŒ–é€’å½’çš„æ–¹æ³•æ¥\n\n```java\n//è®°å¿†åŒ–é€’å½’37ms 44%,å¼€å§‹æ…¢æ˜¯å› ä¸ºstreamçš„åŸå› \nBoolean[][] cache=null;\n\npublic boolean canPartition(int[] nums) {\n    if (nums==null || nums.length<=0) return false;\n    //int sum=Arrays.stream(nums).sum();\n    int sum=0;\n    for (int e:nums) sum+=e; //æ±‚å’Œ\n    cache=new Boolean[nums.length][sum+1];\n    if (sum%2!=0) {\n        return false;\n    }\n    return partition(nums,0,0,sum/2);\n}\n\n//å°è¯•æ·»åŠ [0,index]ä½ç½®çš„å…ƒç´ ,çœ‹èƒ½å¦ä½¿å¾—half=sum (è¿™é‡Œå…¶å®åº”è¯¥ç›´æ¥åœ¨sumä¸Šå‡,çœ‹èƒ½ä¸èƒ½å‡ä¸º0)\npublic boolean partition(int[] nums,int index,int half,int sum) {\n    if (index==nums.length) {\n        return false;\n    }\n    if (cache[index][half]!=null) {\n        return cache[index][half];\n    }\n\n    if (half==sum) {\n        return true;\n    }\n    cache[index][half]=partition(nums,index+1,half,sum) || \n        (half<sum&&partition(nums,index+1,half+nums[index],sum));\n    return cache[index][half];\n}\n```\n**è§£æ³•äºŒ**\n\nåŠ¨æ€è§„åˆ’ï¼Œä¾ç„¶æ˜¯å…¸å‹çš„èƒŒåŒ…é—®é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºç”¨numsä¸­çš„å…ƒç´ ï¼Œå¡«æ»¡sum/2å®¹é‡å¤§å°çš„èƒŒåŒ…ï¼Œé€’æ¨å…¬å¼\n\n `dp[i][j] =dp[i-1][j] || dp[i-1][j-nums[i]]`  é€‰å½“å‰å…ƒç´ å’Œä¸é€‰å½“å‰å…ƒç´ ï¼Œæœ‰ä¸€ä¸ªèƒ½å¡«æ»¡å°±ok\n\n`dp[i][j]` å«ä¹‰ä¸ºï¼šè€ƒè™‘`[0,i]` èŒƒå›´å†…çš„å…ƒç´ ï¼Œèƒ½å¦æ°å¥½è£…æ»¡ `j`å¤§å°çš„å®¹å™¨\n\n```java\n//äºŒç»´dp\npublic boolean canPartition(int[] nums) {\n    if (nums==null || nums.length<=0) return false;\n    //int sum=Arrays.stream(nums).sum(); ç”¨streamå¥½æ…¢\n    int sum=0;\n    for (int e:nums) sum+=e; //æ±‚å’Œ\n    if (sum%2!=0) {\n        return false;\n    }\n    int half=sum/2;\n    //dp[i][j]çš„å«ä¹‰æ˜¯ä»[0,i]ä¸­é€‰å–å…ƒç´ ,èƒ½å¦åˆšå¥½å¡«æ»¡j\n    boolean[][] dp=new boolean[nums.length][half+1];\n    for (int j=0;j<=half;j++) {\n        dp[0][j]= nums[0]==j;\n    }\n    for (int i=1;i<nums.length;i++) {\n        for (int j=0;j<=half;j++) {\n            dp[i][j]= j>=nums[i]?dp[i-1][j] || dp[i-1][j-nums[i]]:dp[i-1][j];\n        }\n        //å¦‚æœåœ¨æŸä¸ªä½ç½®ï¼ˆæ¯è¡Œæœ€åä¸€ä¸ªï¼‰å·²ç»åˆšå¥½å¡«æ»¡äº†å°±ç›´æ¥è¿”å›\n        if (dp[i][half]) {\n            return true;\n        }\n    }\n    return dp[nums.length-1][half];\n}\n```\nç©ºé—´ä¸Šçš„ä¼˜åŒ–\n\n```java\npublic boolean canPartition(int[] nums) {\n    if (nums==null || nums.length<=0) return false;\n    int sum=0;\n    for (int e:nums) sum+=e; //æ±‚å’Œ\n    if (sum%2!=0) {\n        return false;\n    }\n    int half=sum/2;\n    //dp[j]çš„å«ä¹‰æ˜¯ä»[0,i]ä¸­é€‰å–å…ƒç´ ,èƒ½å¦åˆšå¥½å¡«æ»¡j\n    boolean[] dp=new boolean[half+1];\n    for (int j=0;j<=half;j++) {\n        dp[j]= nums[0]==j;\n    }\n\n    for (int i=1;i<nums.length;i++) {\n        for (int j=half;j>=nums[i];j--) {\n            //dp[i][j]= j>=nums[i]?dp[i-1][j] || dp[i-1][j-nums[i]]:dp[i-1][j];\n            dp[j]=dp[j]||dp[j-nums[i]];\n        }\n        if (dp[half]) {\n            return true;\n        }\n    }\n    return dp[half];\n}\n```\n## [322. é›¶é’±å…‘æ¢](https://leetcode-cn.com/problems/coin-change/)\n\nç»™å®šä¸åŒé¢é¢çš„ç¡¬å¸ coins å’Œä¸€ä¸ªæ€»é‡‘é¢ amountã€‚ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„æœ€å°‘çš„ç¡¬å¸ä¸ªæ•°ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› -1ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: coins = [1, 2, 5], amount = 11\nè¾“å‡º: 3 \nè§£é‡Š: 11 = 5 + 5 + 1\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: coins = [2], amount = 3\nè¾“å‡º: -1\n```\n\n**è¯´æ˜:**\nä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„\n\n**è§£æ³•ä¸€**\n\nå…¶å®å°±æ˜¯dfsï¼Œæˆ‘æœ€å¼€å§‹å°±æ˜¯å†™çš„dfsåªä¸è¿‡æ—¶é—´å¤æ‚åº¦å¤ªé«˜ï¼Œæ²¡åšè®°å¿†åŒ–ï¼Œè¿™é‡Œå…¶å®ä¸€å¼€å§‹åšäº†è®°å¿†åŒ–ä¹Ÿä¸€ç›´æ²¡è·‘è¿‡ï¼Œä¸€ç›´è¶…æ—¶ï¼Œæœ€åç»™çš„caseæ˜¯6249 å¥½åƒä¹Ÿä¸ç®—å¾ˆå¤§å§ï¼Œç„¶åæˆ‘åæ¥æŠŠ`fill` å¡«å……æ•°ç»„åˆ äº†ï¼Œç”¨Integerå°±è·‘è¿‡äº†ã€‚ã€‚ã€‚\n\n```java\n//è®°å¿†åŒ–é€’å½’AC 50%å·¦å³\nprivate Integer[] cache=null;\n\npublic int coinChange2(int[] coins,int amount){\n    cache=new Integer[amount+1];\n    //Arrays.fill(cache,-1); è¿™é‡Œfillç›´æ¥tleäº†ã€‚ã€‚ã€‚ã€‚\n    return takeCoins(coins,amount);\n}\n\npublic int takeCoins(int[] coins, int amount) {\n    if (amount==0) {\n        return 0;\n    }\n    if (cache[amount]!=null) {\n        return cache[amount];\n    }\n    //int t1=coins(coins,amount,index+1);\n    int res=Integer.MAX_VALUE;\n    for (int i=0;i<coins.length;i++) {\n        if (amount<coins[i]) continue;\n        int sub=takeCoins(coins,amount-coins[i]);\n        if (sub!=-1) {\n            res=Math.min(sub+1,res);\n        }\n    }\n    cache[amount]= res==Integer.MAX_VALUE?-1:res;\n    return cache[amount];\n}\n```\n**è§£æ³•äºŒ**\n\nåŠ¨æ€è§„åˆ’ï¼ŒäºŒç»´dpï¼Œæ³¨æ„è¿™é‡Œå…¶å®å’Œå‰é¢çš„èƒŒåŒ…é—®é¢˜å°±æœ‰åŒºåˆ«äº†ï¼Œè¿™é‡Œå®é™…ä¸Šå°±æ˜¯ä¸ª`æ— é™èƒŒåŒ…`é—®é¢˜ï¼Œå› ä¸ºè¿™é‡Œçš„ç¡¬å¸æ˜¯æ— é™çš„ï¼Œæ¯ä¸ªé¢å€¼çš„ç¡¬å¸éƒ½å¯ä»¥é‡å¤çš„é€‰å–\n\n**DPTable**\n\n![mark](http://static.imlgw.top/blog/20200227/ekmjFAHgA2K4.png?imageslim)\n\n**çŠ¶æ€å®šä¹‰**\n\nè¿™é‡Œ`dp[i][j]` çš„å«ä¹‰ä¸ºï¼š**è€ƒè™‘`[0ï¼Œi]` èŒƒå›´å†…çš„å…ƒç´ ï¼Œèƒ½å‡‘æˆ `j` æ‰€éœ€çš„æœ€å°‘ç¡¬å¸æ•°**ï¼Œå’Œä¹‹å‰çš„01èƒŒåŒ…é—®é¢˜çŠ¶æ€å®šä¹‰æ²¡ä»€ä¹ˆåŒºåˆ«\n\n**çŠ¶æ€æ–¹ç¨‹**\n\né¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹ç¬¬`coins[i]`ä¸ªç¡¬å¸æœ‰ä¸¤ç§é€‰æ‹© \n\n1. ä¸æ‹¿ \n2.  æ‹¿ï¼Œæ‹¿1~kä¸ª(kä¸ºç¡¬å¸ä¸ªæ•°çš„é™åˆ¶ï¼Œè¿™é‡Œæ²¡æœ‰é™åˆ¶ï¼Œæ‰€ä»¥æ˜¯æ— ç©·å¤§)\n\nè¿›è€Œæˆ‘ä»¬å¯ä»¥çš„åˆ°çŠ¶æ€è½¬ç§»çš„æ–¹ç¨‹ï¼š\n\n`f[i][j] = min(f[i-1][j], f[i-1][j-c]+1, f[i-1][j-2*c]+2, ..., f[i-1][j-k*c]+k)`\n\nä½†æ˜¯è¿™ä¸ªæ–¹ç¨‹æœ‰å¾ˆå¤šè®¡ç®—æ˜¯é‡å¤çš„\n\n`f[i][j-c]=min(f[i-1][j-c], f[i-1][j-2*c]+1, ..., f[i-1][j-k*c]+k-1)`\n\nä¸¤è€…åˆå¹¶å¾—åˆ°\n\n`f[i][j] = min(f[i-1]f[j], f[i][j-c]+1)`  æœ‰äº†çŠ¶æ€æ–¹ç¨‹ï¼Œä»£ç å°±å¥½å†™äº†\n\n```java\npublic int coinChange4(int[] coins,int amount){\n    int[][] dp=new int[coins.length][amount+1];\n    for (int j=0;j<=amount;j++) {\n        dp[0][j]=j%coins[0]==0?j/coins[0]:Integer.MAX_VALUE;\n    }\n    for (int i=1;i<coins.length;i++) {\n        for (int j=0;j<=amount;j++) {\n            if (j<coins[i] || dp[i][j-coins[i]]==Integer.MAX_VALUE) {\n                //æ”¾ä¸ä¸‹\n                dp[i][j]=dp[i-1][j];\n            }else {\n                dp[i][j]=Math.min(dp[i][j-coins[i]]+1,dp[i-1][j]);\n            }\n        }\n    }\n    return dp[coins.length-1][amount]!=Integer.MAX_VALUE?dp[coins.length-1][amount]:-1;\n}\n```\n\n**ç©ºé—´ä¼˜åŒ–**\n\nå°†ä¸Šé¢çš„äºŒç»´æ”¹æˆä¸€ç»´å°±æ˜¯åƒä¸‹é¢ä¸€æ ·ï¼Œæ³¨æ„å†…å±‚çš„å¾ªç¯ï¼å› ä¸ºåé¢æ˜¯ `f[i][j-c]+1` æ‰€ä»¥éœ€è¦ä¾èµ–åŒä¸€å±‚å‰é¢çš„ç»“æœï¼Œæ‰€ä»¥å¿…é¡»é¡ºåºçš„éå†\n\n```java\npublic int coinChange(int[] coins,int amount){\n    int[] dp=new int[amount+1];\n    //å¡«å……åˆå§‹å€¼ä¸ºInteger.MAX_VALUE,ä»£è¡¨ä¸å¯è¾¾\n    Arrays.fill(dp,Integer.MAX_VALUE);\n    dp[0]=0; //é™¤äº†dp[0]\n    for (int i=0;i<coins.length;i++) {\n        //æ³¨æ„è¿™é‡Œä¸èƒ½é€†åºï¼\n        for (int j=coins[i];j<=amount;j++) {\n            if (dp[j-coins[i]]!=Integer.MAX_VALUE) {\n                dp[j]=Math.min(dp[j-coins[i]]+1,dp[j]);   \n            }\n        }\n    }\n    return dp[amount]==Integer.MAX_VALUE?-1:dp[amount];\n}\n```\n## [518. é›¶é’±å…‘æ¢ II](https://leetcode-cn.com/problems/coin-change-2/)\n\nç»™å®šä¸åŒé¢é¢çš„ç¡¬å¸å’Œä¸€ä¸ªæ€»é‡‘é¢ã€‚å†™å‡ºå‡½æ•°æ¥è®¡ç®—å¯ä»¥å‡‘æˆæ€»é‡‘é¢çš„ç¡¬å¸ç»„åˆæ•°ã€‚å‡è®¾æ¯ä¸€ç§é¢é¢çš„ç¡¬å¸æœ‰æ— é™ä¸ª\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: amount = 5, coins = [1, 2, 5]\nè¾“å‡º: 4\nè§£é‡Š: æœ‰å››ç§æ–¹å¼å¯ä»¥å‡‘æˆæ€»é‡‘é¢:\n5=5\n5=2+2+1\n5=2+1+1+1\n5=1+1+1+1+1\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: amount = 3, coins = [2]\nè¾“å‡º: 0\nè§£é‡Š: åªç”¨é¢é¢2çš„ç¡¬å¸ä¸èƒ½å‡‘æˆæ€»é‡‘é¢3ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: amount = 10, coins = [10] \nè¾“å‡º: 1\n```\n\n**æ³¨æ„:**\n\nä½ å¯ä»¥å‡è®¾ï¼š\n\n- 0 <= amount (æ€»é‡‘é¢) <= 5000\n- 1 <= coin (ç¡¬å¸é¢é¢) <= 5000\n- ç¡¬å¸ç§ç±»ä¸è¶…è¿‡ 500 ç§\n- ç»“æœç¬¦åˆ 32 ä½ç¬¦å·æ•´æ•°\n\n**è§£æ³•ä¸€**\n\næ±‚æ–¹æ¡ˆæ•°ï¼Œä¸è€ƒè™‘é¡ºåº\n\n```java\npublic int change(int amount, int[] coins) {\n    if (coins==null || coins.length<=0) {\n        return amount==0?1:0;\n    }\n    int[][] dp=new int[coins.length][amount+1];\n    for (int i=0;i<coins.length;i++) {\n        for (int j=0;j<=amount;j++) {\n            if (i==0) {\n                dp[0][j]=j%coins[i]==0?1:0;\n            }else if (j==0) {\n                dp[i][0]=1;\n            }else{\n                  dp[i][j]= j>=coins[i]?dp[i-1][j]+dp[i][j-coins[i]]:dp[i-1][j];\n                //dp[i][j]= j>=coins[i]?dp[i-1][j]+dp[i-1][j-coins[i]]:dp[i-1][j];\n            }\n        }\n    }\n    return dp[coins.length-1][amount];\n}\n```\n**ç©ºé—´ä¼˜åŒ–**\n\n`f(5)=f(4)+f(3)+f(0)` çªç„¶æ„Ÿè§‰å†™äºŒç»´çš„æœ‰ç‚¹å¤šä½™ã€‚ã€‚ã€‚è¿™ç§å­ç»“æ„è¦æ¸…æ™°çš„å¤š\n\n```java\n//ç›´æ¥ç†è§£ä¸€ç»´dpè¿˜æ˜¯ä¸å¤ªå®¹æ˜“,ä½†æ˜¯çŸ¥é“é€’æ¨å…¬å¼åå…ˆå†™ä¸ªäºŒç»´dpå†æ”¹ä¸ºä¸€ç»´å°±å¾ˆå®¹æ˜“\npublic int change(int amount, int[] coins) {\n    int[] dp=new int[amount+1];\n    dp[0]=1;\n    //è¿™ç§æ–¹å¼ç›¸å½“äºå¯¹dpTableä»å·¦å‘å³,ä¸€è¡Œè¡Œçš„é€’æ¨\n    for (int i=0;i<coins.length;i++) {\n        for (int j=0;j<=amount;j++) {\n            //dp[j]+= dp[j-coins[i]]:0;\n            dp[j]=j-coins[i]>=0?dp[j]+dp[j-coins[i]]:dp[j];\n        }\n    }\n    /* äº¤æ¢ä¸€ä¸‹å†…å¤–é¡ºåºå°±å˜æˆäº†å¦ä¸€ä¸ªé—®é¢˜çš„è§£\n    for (int j=0;j<=amount;j++) {\n        for (int i=0;i<coins.length;i++) {\n            dp[j]+= j-coins[i]>=0?dp[j-coins[i]]:0;\n        }\n    }*/\n    return dp[amount];\n}\n```\n**è§£æ³•äºŒ**\n\nè®°å¿†åŒ–é€’å½’ï¼ŒåŸºæœ¬ä¸Šdpèƒ½è¿‡å¾—ï¼Œè®°å¿†åŒ–é€’å½’ä¸€å®šèƒ½è¿‡ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘è§‰å¾—è®°å¿†åŒ–é€’å½’ä¼šå¥½å†™ä¸€äº›\n\n```java\npublic int change(int amount, int[] coins) {\n    if (coins==null || coins.length<=0) {\n        return amount==0?1:0;\n    }\n    cache=new Integer[coins.length][amount+1];\n    return takeCoins(amount,coins,0);\n}\n\nInteger[][] cache=null;\n\n//[index,coins.length] ä¸­å‡‘æˆamountçš„æ–¹æ¡ˆæ•°ï¼Œè€ƒè™‘é¡ºåº\npublic int takeCoins(int amount,int[] coins,int index){\n    if (index>=coins.length || amount<0) {\n        return 0;\n    }\n    if (cache[index][amount]!=null) {\n        return cache[index][amount];\n    }\n    if (amount==0) {\n        return 1;\n    }\n    return cache[index][amount]=takeCoins(amount-coins[index],coins,index)+takeCoins(amount,coins,index+1);\n}\n```\n## [é¢è¯•é¢˜ 08.11. ç¡¬å¸](https://leetcode-cn.com/problems/coin-lcci/)\n\nç¡¬å¸ã€‚ç»™å®šæ•°é‡ä¸é™çš„ç¡¬å¸ï¼Œå¸å€¼ä¸º25åˆ†ã€10åˆ†ã€5åˆ†å’Œ1åˆ†ï¼Œç¼–å†™ä»£ç è®¡ç®—nåˆ†æœ‰å‡ ç§è¡¨ç¤ºæ³•ã€‚(ç»“æœå¯èƒ½ä¼šå¾ˆå¤§ï¼Œä½ éœ€è¦å°†ç»“æœæ¨¡ä¸Š1000000007)\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢çš„ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œè®°å½•ä¸‹ï¼Œå…ƒç´ è§£æ³•å°±ä¸å†™äº†ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·\n\n```java\nint mod=1000000007;\n\npublic int waysToChange(int n) {\n    n/=5; //ä½™æ•°æ²¡æœ‰å½±å“ï¼Œéƒ½ç”¨1è¡¥\n    int[] coins={5,2,1}; //å¸å€¼ä¹Ÿ/5\n    long[] dp=new long[n+1];\n    Arrays.fill(dp,1L); //æ’é™¤1åˆ†çš„ç¡¬å¸ï¼Œæ‰€æœ‰çš„é¢é¢éƒ½å¯ä»¥ç”¨1åˆ†çš„å‡‘å‡ºæ¥\n    for(int i=0;i<coins.length;i++){\n        for(int j=coins[i];j<=n;j++){\n            dp[j]=(dp[j]+dp[j-coins[i]])%mod;\n        }\n    }\n    return (int)(dp[n]%mod);\n}\n```\n\nç›´æ¥æŠŠæ—¶é—´ä»114mså¹²åˆ°äº†17msï¼Œå…¶å®æ—¶é—´å¤æ‚åº¦æ²¡å˜ï¼Œä½†æ˜¯ç¼©å°äº†è§£ç©ºé—´ï¼Œæ‰€ä»¥æ•´ä½“çš„æ—¶é—´ä¼šæé«˜å¾ˆå¤šï¼Œå½“ç„¶è¿™é‡Œèƒ½ç¼©å°çš„åŸå› ä¸»è¦è¿˜æ˜¯å› ä¸ºé¢˜ç›®æ¯”è¾ƒç‰¹æ®Š\n\n## [377. ç»„åˆæ€»å’Œ â…£](https://leetcode-cn.com/problems/combination-sum-iv/)\n\nç»™å®šä¸€ä¸ªç”±æ­£æ•´æ•°ç»„æˆä¸”ä¸å­˜åœ¨é‡å¤æ•°å­—çš„æ•°ç»„ï¼Œæ‰¾å‡ºå’Œä¸ºç»™å®šç›®æ ‡æ­£æ•´æ•°çš„ç»„åˆçš„ä¸ªæ•°ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nnums = [1, 2, 3]\ntarget = 4\n\næ‰€æœ‰å¯èƒ½çš„ç»„åˆä¸ºï¼š\n(1, 1, 1, 1)\n(1, 1, 2)\n(1, 2, 1)\n(1, 3)\n(2, 1, 1)\n(2, 2)\n(3, 1)\n\nè¯·æ³¨æ„ï¼Œé¡ºåºä¸åŒçš„åºåˆ—è¢«è§†ä½œä¸åŒçš„ç»„åˆã€‚\n\nå› æ­¤è¾“å‡ºä¸º 7ã€‚\n```\n\n**è¿›é˜¶ï¼š**\nå¦‚æœç»™å®šçš„æ•°ç»„ä¸­å«æœ‰è´Ÿæ•°ä¼šæ€ä¹ˆæ ·ï¼Ÿ\né—®é¢˜ä¼šäº§ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Ÿ\næˆ‘ä»¬éœ€è¦åœ¨é¢˜ç›®ä¸­æ·»åŠ ä»€ä¹ˆé™åˆ¶æ¥å…è®¸è´Ÿæ•°çš„å‡ºç°ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\nè®°å¿†åŒ–é€’å½’ï¼Œæ²¡å•¥å¥½è¯´çš„\n\n```java\n//è®°å¿†åŒ–é€’å½’ 1ms 100%\npublic int combinationSum4(int[] nums, int target) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    cache=new Integer[target+1];\n    return combination(nums,target);\n}\n\nInteger[] cache=null;\n\npublic int combination(int[] nums,int target){\n    if (cache[target]!=null) {\n        return cache[target];\n    }\n    if (target==0) {\n        return 1;\n    }\n    int res=0;\n    for (int i=0;i<nums.length;i++) {\n        if (target-nums[i]>=0) {\n            res+=combination(nums,target-nums[i]);\n        }\n    }\n    return cache[target]=res;\n}\n```\n**è§£æ³•äºŒ**\n\nåŠ¨æ€è§„åˆ’ï¼Œä¹ä¸€çœ‹å¥½åƒå’Œä¸Šé¢ä¸€é¢˜ä¸€æ ·ï¼Œå®é™…ä¸Šå¹¶ä¸ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯è€ƒè™‘é¡ºåºçš„ï¼Œæœ€ä¼˜å­ç»“æ„ä¹Ÿæ˜¯\n\n`f(5)=f(4)+f(3)+f(0)` è¿™æ ·çš„\n\n```java\n//ä¸€ç»´dp\npublic int combinationSum4(int[] nums,int target){\n    int[] dp=new int[target+1];\n    dp[0]=1;\n    for (int i=0;i<=target;i++) {\n        for (int j=0;j<nums.length;j++) {\n            dp[i]+= i>=nums[j]?dp[i-nums[j]]:0;\n        }\n    }\n    return dp[target];\n}\n```\n\nè¿™é‡Œè¿˜æ˜¯è¦å­˜ä¸ªç–‘å•Šï¼Œæ²¡ææ˜ç™½å•Šï¼Œä¸ºå•¥äº¤æ¢ä¸ªé¡ºåºå°±ä¸ä¸€æ ·äº†å‘¢ï¼Ÿä¸€ä¸ªæ˜¯æŒ‰è¡Œæ‰“è¡¨ï¼Œä¸€ä¸ªæ˜¯æŒ‰åˆ—æ‰“è¡¨ï¼Ÿï¼Ÿï¼Ÿè¿˜æ˜¯é€’å½’å¥½å†™ã€‚ã€‚ã€‚\n\n## [494. ç›®æ ‡å’Œ](https://leetcode-cn.com/problems/target-sum/)\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼Œa1, a2, ..., an, å’Œä¸€ä¸ªç›®æ ‡æ•°ï¼ŒSã€‚ç°åœ¨ä½ æœ‰ä¸¤ä¸ªç¬¦å· + å’Œ -ã€‚å¯¹äºæ•°ç»„ä¸­çš„ä»»æ„ä¸€ä¸ªæ•´æ•°ï¼Œä½ éƒ½å¯ä»¥ä» + æˆ– -ä¸­é€‰æ‹©ä¸€ä¸ªç¬¦å·æ·»åŠ åœ¨å‰é¢ã€‚\n\nè¿”å›å¯ä»¥ä½¿æœ€ç»ˆæ•°ç»„å’Œä¸ºç›®æ ‡æ•° S çš„æ‰€æœ‰æ·»åŠ ç¬¦å·çš„æ–¹æ³•æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums: [1, 1, 1, 1, 1], S: 3\nè¾“å‡º: 5\nè§£é‡Š: \n\n-1+1+1+1+1 = 3\n+1-1+1+1+1 = 3\n+1+1-1+1+1 = 3\n+1+1+1-1+1 = 3\n+1+1+1+1-1 = 3\n\nä¸€å…±æœ‰5ç§æ–¹æ³•è®©æœ€ç»ˆç›®æ ‡å’Œä¸º3ã€‚\n```\n\n**æ³¨æ„:**\n\n- æ•°ç»„éç©ºï¼Œä¸”é•¿åº¦ä¸ä¼šè¶…è¿‡20ã€‚\n- åˆå§‹çš„æ•°ç»„çš„å’Œä¸ä¼šè¶…è¿‡1000ã€‚\n- ä¿è¯è¿”å›çš„æœ€ç»ˆç»“æœèƒ½è¢«32ä½æ•´æ•°å­˜ä¸‹\n\n**è§£æ³•ä¸€**\n\nåé¢çš„é¢˜éƒ½ä¼˜å…ˆå†™è®°å¿†åŒ–é€’å½’äº†ï¼ŒåŠ¨æ€è§„åˆ’ç¡®å®æœ‰ç‚¹éš¾é¡¶\n\n```java\nInteger[][] cache=null;\n\n//HashMap<Integer,Integer> cache=new HashMap<>\n\npublic int findTargetSumWays(int[] nums, int S) {\n    if (nums==null || nums.length<=0 || S>1000) {\n        return 0;\n    }\n    //\n    int sum=0;\n    for(int n:nums)sum+=n;\n    if(S>sum)return 0;\n    \n    //ç›¸å½“äºå¹³ç§»äº†ä¸€ä¸‹,ä»[-sum,sum] --> [0,2*sum]\n    cache=new Integer[nums.length][2*sum+1];\n    return findTarget(nums,S,0,2*sum+1);\n}\n\npublic int findTarget(int[] nums,int S,int index,int max){\n    if (S==0 && index ==nums.length) {\n        return 1;\n    }\n    if (index>=nums.length) {\n        return 0;\n    }\n    if(S <0  && cache[index][S+max]!=null){\n        return cache[index][S+max];\n    }\n    if (S>=0 && cache[index][S]!=null) {\n        return cache[index][S];\n    }\n    int temp=findTarget(nums,S-nums[index],index+1,max)+findTarget(nums,S+nums[index],index+1,max);\n    if (S<0) {\n        cache[index][S+max]=temp;\n    }else{\n        cache[index][S]=temp;\n    }\n    return  temp;\n}\n```\nè¿™é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå› ä¸ºé‡Œé¢æ˜¯æœ‰è´Ÿæ•°çš„ï¼Œç›´æ¥è®°å¿†åŒ–æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦è½¬æ¢ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘æ˜¯ç›´æ¥å°†cacheæ•°ç»„æ‰©å¤§ï¼ŒåŒæ—¶ä¿è¯ä¸ä¼šæœ‰è¦†ç›–ï¼Œæ‰€ä»¥ç›´æ¥æ‰©å¤§ä¸º 2sumå°±okï¼Œè¿™æ ·æ•´ä¸ªSçš„èŒƒå›´å°±ä»`[-sum,+sum]` å˜ä¸º `[0,2sum]` ä»è€Œå¯ä»¥ç¼“å­˜æ‰€æœ‰çš„é€’å½’ç»“æœï¼Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„ä¸€ä¸ªå­˜æ­£æ•°ï¼Œä¸€ä¸ªå­˜è´Ÿæ•°ï¼Œç„¶ååªéœ€è¦ç¬¦å·å–åå°±okäº†ï¼Œåªä¸è¿‡å ç”¨çš„ç©ºé—´ä¼šå¤§ä¸€ç‚¹\n\n**è§£æ³•äºŒ**\n\næ­£å„¿å…«ç»çš„01èƒŒåŒ…åšæ³•\n\n```java\npublic int findTargetSumWays(int[] nums, int S) {\n    if(nums==null || nums.length<=0) return 0;\n    //nsumè´Ÿ,psumæ­£; sum;\n    //sum=psum+nsum;\n    //S=psum-nsum;\n    //(sum+S)/2 = psum\n    int sum=0;\n    for(int i=0;i<nums.length;i++) sum+=nums[i];\n    if((sum+S)%2!=0 || S>sum) return 0;\n    int target=(sum+S)/2;\n    int[] dp=new int[target+1];\n    //Arrays.fill(dp,-1);\n    dp[0]=1;\n    for(int i=0;i<nums.length;i++){\n        for(int j=target;j>=nums[i];j--){\n            dp[j]+=dp[j-nums[i]];\n        }\n    }\n    return dp[target];\n}\n```\n\n## [1049. æœ€åä¸€å—çŸ³å¤´çš„é‡é‡ II](https://leetcode-cn.com/problems/last-stone-weight-ii/)\n\næœ‰ä¸€å †çŸ³å¤´ï¼Œæ¯å—çŸ³å¤´çš„é‡é‡éƒ½æ˜¯æ­£æ•´æ•°ã€‚\n\næ¯ä¸€å›åˆï¼Œä»ä¸­é€‰å‡º**ä»»æ„ä¸¤å—çŸ³å¤´**ï¼Œç„¶åå°†å®ƒä»¬ä¸€èµ·ç²‰ç¢ã€‚å‡è®¾çŸ³å¤´çš„é‡é‡åˆ†åˆ«ä¸º `x` å’Œ `y`ï¼Œä¸” `x <= y`ã€‚é‚£ä¹ˆç²‰ç¢çš„å¯èƒ½ç»“æœå¦‚ä¸‹ï¼š\n\n- å¦‚æœ `x == y`ï¼Œé‚£ä¹ˆä¸¤å—çŸ³å¤´éƒ½ä¼šè¢«å®Œå…¨ç²‰ç¢ï¼›\n- å¦‚æœ `x != y`ï¼Œé‚£ä¹ˆé‡é‡ä¸º `x` çš„çŸ³å¤´å°†ä¼šå®Œå…¨ç²‰ç¢ï¼Œè€Œé‡é‡ä¸º `y` çš„çŸ³å¤´æ–°é‡é‡ä¸º `y-x`ã€‚\n\næœ€åï¼Œæœ€å¤šåªä¼šå‰©ä¸‹ä¸€å—çŸ³å¤´ã€‚è¿”å›æ­¤çŸ³å¤´**æœ€å°çš„å¯èƒ½é‡é‡**ã€‚å¦‚æœæ²¡æœ‰çŸ³å¤´å‰©ä¸‹ï¼Œå°±è¿”å› `0`ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```go\nè¾“å…¥ï¼š[2,7,4,1,8,1]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼š\nç»„åˆ 2 å’Œ 4ï¼Œå¾—åˆ° 2ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [2,7,1,8,1]ï¼Œ\nç»„åˆ 7 å’Œ 8ï¼Œå¾—åˆ° 1ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [2,1,1,1]ï¼Œ\nç»„åˆ 2 å’Œ 1ï¼Œå¾—åˆ° 1ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [1,1,1]ï¼Œ\nç»„åˆ 1 å’Œ 1ï¼Œå¾—åˆ° 0ï¼Œæ‰€ä»¥æ•°ç»„è½¬åŒ–ä¸º [1]ï¼Œè¿™å°±æ˜¯æœ€ä¼˜å€¼ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= stones.length <= 30`\n2. `1 <= stones[i] <= 1000`\n\n**è§£æ³•ä¸€**\n\næƒ³äº†ä¸€ä¸‹ï¼Œå…¶å®å°±æ˜¯åœ¨æ‰€æœ‰çŸ³å¤´ä¸­é€‰å–éƒ¨åˆ†çŸ³å¤´ï¼Œæ±‚è¿™éƒ¨åˆ†çš„çŸ³å¤´å’Œå¤§äº`sum/2`çš„æœ€å°å€¼ï¼ˆå’Œæ­£å¸¸çš„èƒŒåŒ…æ€è·¯åç€æ¥çš„ï¼‰\n\n```java\n//   sum   = psum + nsum\n//  target = psum - nsum  (psum >= nsum)\n//  sum+target = 2*psum\n//  target = 2*psum-sum\n//  2*psum-sum>=0\n//è®°å¿†åŒ–é€’å½’\nInteger[][] dp=null;\n\npublic int lastStoneWeightII(int[] stones) {\n    int sum=0;\n    for (int i=0;i<stones.length;i++) {\n        sum+=stones[i];\n    }\n    dp=new Integer[stones.length+1][sum];\n    return 2*dfs(stones,0,0,sum)-sum;\n}\n\npublic int dfs(int[] stones,int index,int psum,int sum){\n    if(2*psum>=sum){\n        return psum;\n    }\n    if(dp[index][psum]!=null){\n        return dp[index][psum];\n    }\n    int min=Integer.MAX_VALUE;\n    for (int i=index;i<stones.length;i++) {\n        min=Math.min(dfs(stones,i+1,psum+stones[i],sum),min);\n    }\n    return dp[index][psum]=min;\n}\n```\nå½“æˆ‘æŒ‰ç…§è¿™ä¸ªæ€è·¯iå†™å‡ºæ¥åå‘ç°ä¸å¥½æ”¹é€’æ¨äº†ğŸ˜‚ï¼Œè¿™ä¸ªæ€è·¯ç¡®å®æœ‰ä¸€ç‚¹ç‚¹æ€ª\n\n**è§£æ³•äºŒ**\n\næ­£å¸¸çš„01èƒŒåŒ…è§£æ³•ï¼Œå…¶å®æŠŠä¸Šé¢çš„ç»“è®ºåè¿‡æ¥å°±è¡Œäº†ï¼Œæ—¢ç„¶è¦æ±‚ä¸€ä¸ªå¤§äºç­‰äº`sum/2`çš„æœ€å°å€¼ï¼Œå…¶å®å°±æ˜¯æ±‚ä¸€ä¸ªå°äºç­‰äº`sum/2` çš„æœ€å¤§å€¼ï¼Œè¿™æ ·ä¸€è¯´å°±å¾ˆæ¸…æ¥šäº†ï¼Œç»å…¸çš„01èƒŒåŒ…\n\n```java\npublic int lastStoneWeightII(int[] stones) {\n    if(stones==null ||stones.length<=0){\n        return 0;\n    }\n    int n=stones.length;\n    int sum=0;\n    for(int i=0;i<n;i++){\n        sum+=stones[i];\n    }\n    //èƒŒåŒ…å®¹é‡ä¸ºsum/2,æ±‚æœ€å¤šèƒ½è£…å¤šå°‘,ç»å…¸çš„01èƒŒåŒ…\n    int amount=sum/2;\n    int[] dp=new int[amount+1];\n    for (int i=0;i<stones.length;i++) {\n        for (int j=amount;j>=stones[i];j--) {\n            dp[j]=Math.max(dp[j],dp[j-stones[i]]+stones[i]);\n        }\n    }\n    //wrong: return (amount-dp[amount])*2;\n    //return sum%2==0?(amount-dp[amount])*2:(amount-dp[amount])*2+1\n    //nsum=dp[amount]\n    //target=psum-nsum = sum-nusm-nsum\n    return sum-2*dp[amount];\n}\n```\nè¿™é‡Œçš„retrunæœ‰ä¸¤ç§å†™æ³•ï¼Œæ¨èç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§è¿˜è¦åˆ¤å¥‡å¶\n\n> æ‹¿åˆ°è¿™é¢˜çš„çš„ç¬¬ä¸€ä¸ªè§£æ³•å…¶å®æ˜¯è´ªå¿ƒï¼Œæ¯æ¬¡æ¶ˆé™¤ä¸¤ä¸ªæœ€å¤§çš„ï¼Œç”¨ä¼˜å…ˆé˜Ÿåˆ—ç»´æŠ¤çŸ³å¤´å¤§å°\n>\n> å¤©çœŸçš„é”™è¯¯è§£æ³• 74 / 82 ä¸ªé€šè¿‡æµ‹è¯•ç”¨ä¾‹\n> [21,26,31,33,40] ->[7,21,26,31] -> [5,7,21] -> [5,14] ->[9]\n> [21,26,31,33,40] ->[19,26,31,33]->[5]\n>\n> è¿™ä¸ªæ€è·¯å…¶å®æ˜¯ è¿™é¢˜çš„å¼±åŒ–ç‰ˆæœ¬ [1046. æœ€åä¸€å—çŸ³å¤´çš„é‡é‡](https://leetcode-cn.com/problems/last-stone-weight/) çš„è§£æ³•\n\n## [474. ä¸€å’Œé›¶](https://leetcode-cn.com/problems/ones-and-zeroes/)\n\nåœ¨è®¡ç®—æœºç•Œä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯è¿½æ±‚ç”¨æœ‰é™çš„èµ„æºè·å–æœ€å¤§çš„æ”¶ç›Šã€‚\n\nç°åœ¨ï¼Œå‡è®¾ä½ åˆ†åˆ«æ”¯é…ç€ m ä¸ª 0 å’Œ n ä¸ª 1ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªä»…åŒ…å« 0 å’Œ 1 å­—ç¬¦ä¸²çš„æ•°ç»„ã€‚\n\nä½ çš„ä»»åŠ¡æ˜¯ä½¿ç”¨ç»™å®šçš„ m ä¸ª 0 å’Œ n ä¸ª 1 ï¼Œæ‰¾åˆ°èƒ½æ‹¼å‡ºå­˜åœ¨äºæ•°ç»„ä¸­çš„å­—ç¬¦ä¸²çš„æœ€å¤§æ•°é‡ã€‚æ¯ä¸ª 0 å’Œ 1 è‡³å¤šè¢«ä½¿ç”¨ä¸€æ¬¡ã€‚\n\n**æ³¨æ„:**\n\n- ç»™å®š 0 å’Œ 1 çš„æ•°é‡éƒ½ä¸ä¼šè¶…è¿‡ 100ã€‚\n- ç»™å®šå­—ç¬¦ä¸²æ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 600ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: Array = {\"10\", \"0001\", \"111001\", \"1\", \"0\"}, m = 5, n = 3\nè¾“å‡º: 4\n\nè§£é‡Š: æ€»å…± 4 ä¸ªå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡ 5 ä¸ª 0 å’Œ 3 ä¸ª 1 æ‹¼å‡ºï¼Œå³ \"10\",\"0001\",\"1\",\"0\" ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: Array = {\"10\", \"0\", \"1\"}, m = 1, n = 1\nè¾“å‡º: 2\n\nè§£é‡Š: ä½ å¯ä»¥æ‹¼å‡º \"10\"ï¼Œä½†ä¹‹åå°±æ²¡æœ‰å‰©ä½™æ•°å­—äº†ã€‚æ›´å¥½çš„é€‰æ‹©æ˜¯æ‹¼å‡º \"0\" å’Œ \"1\" ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nä¹‹å‰åªç”¨Javaå†™äº†ä¸ªè®°å¿†åŒ–çš„ï¼Œè¡¥ä¸€ä¸‹çº¯dpçš„\n```golang\n//ä¹‹å‰åªç”¨Javaå†™äº†ä¸ªè®°å¿†åŒ–çš„ï¼Œè¡¥ä¸€ä¸‹çº¯dpçš„\nfunc findMaxForm(strs []string, m int, n int) int {\n    var sn = len(strs)\n    var dp = make([][]int, m+1)\n    var Max = func(a, b int) int {if a>b {return a};return b}\n    for i := 0; i <= m; i++ {\n        dp[i] = make([]int, n+1)\n    }\n    for i := 0; i < sn; i++ {\n        zero, one := count(strs[i])\n        for j := m; j >= zero; j-- {\n            for k := n; k >= one; k-- {\n                dp[j][k] = Max(dp[j][k], dp[j-zero][k-one]+1)\n            }\n        }\n    }\n    return dp[m][n]\n}\n\nfunc count(str string) (int, int) {\n    var one, zero = 0, 0\n    for i := 0; i < len(str); i++ {\n        if str[i] == '0' {\n            zero++\n        }\n        if str[i] == '1' {\n            one++\n        }\n    }\n    return zero, one\n}\n```\n\n**è§£æ³•äºŒ**\n\nå…¶å®è¿™æ˜¯ä¸€ä¸ªå¤šé‡èƒŒåŒ…é—®é¢˜ï¼Œä¸€ä¸ªç‰©å“æœ‰å¤šä¸ªæƒå€¼\n\n```java\nInteger [][][] cache=null;\n\npublic int findMaxForm(String[] strs, int m, int n) {\n    cache=new Integer[m+1][n+1][strs.length];\n    return findMax(strs,m,n,0);\n}\n\n//m:0 n:1\npublic int findMax(String[] strs, int m, int n,int index) {\n    if (index>=strs.length) {\n        return 0;\n    }\n    if (cache[m][n][index]!=null) {\n        return cache[m][n][index];\n    }\n    int[] oz=count(strs[index]);\n    if (oz[1]<=n && oz[0]<=m) {\n        return cache[m][n][index]=Math.max(1+findMax(strs,m-oz[0],n-oz[1],index+1),findMax(strs,m,n,index+1));\n    }\n    return cache[m][n][index]=findMax(strs,m,n,index+1);\n}\n\npublic int[] count(String str){\n    int one=0,zero=0;\n    char[] s=str.toCharArray();\n    for (char c:s) {\n        if (c=='1') {\n            one++;\n        }else{\n            zero++;\n        }\n    }\n    return new int[]{zero,one};\n}\n```\n\n## [1255. å¾—åˆ†æœ€é«˜çš„å•è¯é›†åˆ](https://leetcode-cn.com/problems/maximum-score-words-formed-by-letters/)\n\nä½ å°†ä¼šå¾—åˆ°ä¸€ä»½å•è¯è¡¨ wordsï¼Œä¸€ä¸ªå­—æ¯è¡¨ letters ï¼ˆå¯èƒ½ä¼šæœ‰é‡å¤å­—æ¯ï¼‰ï¼Œä»¥åŠæ¯ä¸ªå­—æ¯å¯¹åº”çš„å¾—åˆ†æƒ…å†µè¡¨ scoreã€‚\n\nè¯·ä½ å¸®å¿™è®¡ç®—ç©å®¶åœ¨å•è¯æ‹¼å†™æ¸¸æˆä¸­æ‰€èƒ½è·å¾—çš„ã€Œæœ€é«˜å¾—åˆ†ã€ï¼šèƒ½å¤Ÿç”± letters é‡Œçš„å­—æ¯æ‹¼å†™å‡ºçš„ ä»»æ„ å±äº words å•è¯å­é›†ä¸­ï¼Œåˆ†æ•°æœ€é«˜çš„å•è¯é›†åˆçš„å¾—åˆ†ã€‚\n\nå•è¯æ‹¼å†™æ¸¸æˆçš„è§„åˆ™æ¦‚è¿°å¦‚ä¸‹ï¼š\n\n- ç©å®¶éœ€è¦ç”¨å­—æ¯è¡¨ letters é‡Œçš„å­—æ¯æ¥æ‹¼å†™å•è¯è¡¨ words ä¸­çš„å•è¯ã€‚\n- å¯ä»¥åªä½¿ç”¨å­—æ¯è¡¨ letters ä¸­çš„éƒ¨åˆ†å­—æ¯ï¼Œä½†æ˜¯æ¯ä¸ªå­—æ¯æœ€å¤šè¢«ä½¿ç”¨ä¸€æ¬¡ã€‚\n- å•è¯è¡¨ words ä¸­æ¯ä¸ªå•è¯åªèƒ½è®¡åˆ†ï¼ˆä½¿ç”¨ï¼‰ä¸€æ¬¡ã€‚\n- æ ¹æ®å­—æ¯å¾—åˆ†æƒ…å†µè¡¨scoreï¼Œå­—æ¯ 'a', 'b', 'c', ... , 'z' å¯¹åº”çš„å¾—åˆ†åˆ†åˆ«ä¸º score[0], score[1], ..., score[25]ã€‚\n- æœ¬åœºæ¸¸æˆçš„ã€Œå¾—åˆ†ã€æ˜¯æŒ‡ï¼šç©å®¶æ‰€æ‹¼å†™å‡ºçš„å•è¯é›†åˆé‡ŒåŒ…å«çš„æ‰€æœ‰å­—æ¯çš„å¾—åˆ†ä¹‹å’Œ\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šwords = [\"dog\",\"cat\",\"dad\",\"good\"], letters = [\"a\",\"a\",\"c\",\"d\",\"d\",\"d\",\"g\",\"o\",\"o\"], score = [1,0,9,5,0,0,3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0]\nè¾“å‡ºï¼š23\nè§£é‡Šï¼š\nå­—æ¯å¾—åˆ†ä¸º  a=1, c=9, d=5, g=3, o=2\nä½¿ç”¨ç»™å®šçš„å­—æ¯è¡¨ lettersï¼Œæˆ‘ä»¬å¯ä»¥æ‹¼å†™å•è¯ \"dad\" (5+1+5)å’Œ \"good\" (3+2+2+5)ï¼Œå¾—åˆ†ä¸º 23 ã€‚\nè€Œå•è¯ \"dad\" å’Œ \"dog\" åªèƒ½å¾—åˆ° 21 åˆ†ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šwords = [\"xxxz\",\"ax\",\"bx\",\"cx\"], letters = [\"z\",\"a\",\"b\",\"c\",\"x\",\"x\",\"x\"], score = [4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,10]\nè¾“å‡ºï¼š27\nè§£é‡Šï¼š\nå­—æ¯å¾—åˆ†ä¸º  a=4, b=4, c=4, x=5, z=10\nä½¿ç”¨ç»™å®šçš„å­—æ¯è¡¨ lettersï¼Œæˆ‘ä»¬å¯ä»¥ç»„æˆå•è¯ \"ax\" (4+5)ï¼Œ \"bx\" (4+5) å’Œ \"cx\" (4+5) ï¼Œæ€»å¾—åˆ†ä¸º 27 ã€‚\nå•è¯ \"xxxz\" çš„å¾—åˆ†ä»…ä¸º 25 ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šwords = [\"leetcode\"], letters = [\"l\",\"e\",\"t\",\"c\",\"o\",\"d\"], score = [0,0,1,1,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼š\nå­—æ¯ \"e\" åœ¨å­—æ¯è¡¨ letters ä¸­åªå‡ºç°äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥æ— æ³•ç»„æˆå•è¯è¡¨ words ä¸­çš„å•è¯ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= words.length <= 14`\n- `1 <= words[i].length <= 15`\n- `1 <= letters.length <= 100`\n- `letters[i].length == 1`\n- `score.length == 26`\n- `0 <= score[i] <= 10`\n- `words[i] å’Œ letters[i] `åªåŒ…å«å°å†™çš„è‹±æ–‡å­—æ¯\n\n**è§£æ³•ä¸€**\n\nçœ‹ç€é¢˜ç›®å°±çŸ¥é“è¿™é¢˜ä¸ç®€å•ğŸ˜‚ï¼Œ11.10çš„å‘¨èµ›æœ€åä¸€é¢˜ï¼Œ1msï¼Œç”¨01èƒŒåŒ…çš„æ€è·¯åšçš„ï¼Œå¾ˆå¤šåœ°æ–¹å…¶å®è¿˜æ²¡å¤„ç†å¥½\n\n```java\npublic int maxScoreWords(String[] words, char[] letters, int[] score) {\n    int[] les=new int[26];\n    for (int i=0;i<letters.length;i++) {\n        les[letters[i]-'a']++;\n    }\n    return maxScoreWords(words,letters,score,0,les);\n}\n\npublic int maxScoreWords(String[] words, char[] letters, int[] score,int index,int[] les) {\n    if (index==words.length) {\n        return 0;\n    }\n    int res=maxScoreWords(words,letters,score,index+1,les);\n    String word=words[index];\n    if (hasWord(les,word)) {\n        int[] bak=new int[les.length];\n        System.arraycopy(les,0,bak,0,les.length);\n        res=Math.max(res,getScore(bak,word,score)+maxScoreWords(words,letters,score,index+1,bak));\n    }\n    return res;\n}\n\npublic boolean hasWord(int[] les,String word){\n    int[] bak=new int[les.length];\n    System.arraycopy(les,0,bak,0,les.length);\n    int count=0;\n    for(char c:word.toCharArray()){\n        if (bak[c-'a']!=0) {\n            bak[c-'a']--;\n            count++;\n        }\n    }\n    return count==word.length();\n}   \n\npublic int getScore(int[] les,String word,int[] score){\n    int sc=0;\n    for (char c:word.toCharArray()) {\n        les[c-'a']--;\n        sc+=score[c-'a'];\n    }\n    return sc;\n}\n```\n\n## [HUD4501.å°æ˜ç³»åˆ—æ•…äº‹â€”â€”ä¹°å¹´è´§ï¼ˆHUDOJï¼‰](http://acm.hdu.edu.cn/showproblem.php?pid=4501)\n\n**Problem Description**\n\næ˜¥èŠ‚å°†è‡³ï¼Œå°æ˜è¦å»è¶…å¸‚è´­ç½®å¹´è´§ï¼Œäºæ˜¯å°æ˜å»äº†è‡ªå·±ç»å¸¸å»çš„éƒ½å°šè¶…å¸‚ã€‚\n\nåˆšåˆ°è¶…å¸‚ï¼Œå°æ˜å°±å‘ç°è¶…å¸‚é—¨å£èšé›†ä¸€å †äººã€‚ç”¨ç™½äº‘å¥³å£«çš„è¯è¯´å°±æ˜¯ï¼šâ€œé‚£å®¶ä¼™ï¼Œé‚£åœºé¢ï¼ŒçœŸæ˜¯äººå±±äººæµ·ï¼Œé”£é¼“å–§å¤©ï¼Œé­ç‚®é½å‘¤ï¼Œçº¢æ——æ‹›å±•ã€‚é‚£å¯çœŸæ˜¯ç›¸å½“çš„å£®è§‚å•Šï¼â€ã€‚å¥½å¥‡çš„å°æ˜èµ°è¿‡å»ï¼Œå¥‹åŠ›æŒ¤è¿‡äººç¾¤ï¼Œå‘ç°è¶…å¸‚é—¨å£è´´äº†ä¸€å¼ é€šçŸ¥ï¼Œå†…å®¹å¦‚ä¸‹\n\nå€¼æ­¤æ–°æ˜¥ä½³èŠ‚æ¥ä¸´ä¹‹é™…ï¼Œä¸ºäº†å›é¦ˆå¹¿å¤§é¡¾å®¢çš„æ”¯æŒå’Œåšçˆ±ï¼Œç‰¹ä¸¾è¡Œæ˜¥èŠ‚å¤§é…¬å®¾ã€ä¼˜æƒ å¤§æ”¾é€æ´»åŠ¨ã€‚å‡¡æ˜¯éƒ½å°šä¼šå‘˜éƒ½å¯ç”¨ä¼šå‘˜ç§¯åˆ†å…‘æ¢å•†å“ï¼Œå‡¡æ˜¯éƒ½å°šä¼šå‘˜éƒ½å¯**å…è´¹æ‹¿kä»¶å•†å“**ï¼Œå‡¡æ˜¯è´­ç‰©é¡¾å®¢å‡æœ‰å¥½ç¤¼ç›¸é€ã€‚æ»¡100å…ƒé€bla bla bla blaï¼Œæ»¡200å…ƒé€bla bla bla bla bla...blablabla....\n\nè¿˜æ²¡çœ‹å®Œé€šçŸ¥ï¼Œå°æ˜å°±é«˜å…´çš„è¦æ­»ï¼Œå› ä¸ºä»–å°±æ˜¯éƒ½å°šçš„ä¼šå‘˜å•Šã€‚è¿«ä¸åŠå¾…çš„å°æ˜åœ¨è¶…å¸‚é€›äº†ä¸€åœˆå‘ç°è¶…å¸‚é‡Œæœ‰**nä»¶ä»–æƒ³è¦çš„å•†å“**ã€‚å°æ˜é¡ºä¾¿å¯¹è¿™nä»¶å•†å“æ‰“äº†åˆ†ï¼Œè¡¨ç¤ºå•†å“çš„å®é™…ä»·å€¼ã€‚å°æ˜å‘ç°èº«ä¸Šå¸¦äº†**v1çš„äººæ°‘å¸**ï¼Œä¼šå‘˜å¡é‡Œé¢æœ‰**v2çš„ç§¯åˆ†**ã€‚ä»–æƒ³çŸ¥é“ä»–æœ€å¤šèƒ½ä¹°å¤šå¤§ä»·å€¼çš„å•†å“ã€‚\n\nç”±äºå°æ˜æƒ³è¦çš„å•†å“å®åœ¨å¤ªå¤šäº†ï¼Œä»–ç®—äº†åŠå¤©å¤´éƒ½ç–¼äº†ä¹Ÿæ²¡ç®—å‡ºæ¥ï¼Œæ‰€ä»¥è¯·ä½ è¿™ä½èªæ˜çš„ç¨‹åºå‘˜æ¥å¸®å¸®ä»–å§ã€‚\n \n\n**Input**\n```go\nè¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚\næ¯ç»„æ•°æ®çš„ç¬¬ä¸€è¡Œæ˜¯å››ä¸ªæ•´æ•°nï¼Œv1ï¼Œv2ï¼Œkï¼›\nç„¶åæ˜¯nè¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•°aï¼Œbï¼Œvalï¼Œåˆ†åˆ«è¡¨ç¤ºæ¯ä¸ªå•†å“çš„ä»·é’±ï¼Œå…‘æ¢æ‰€éœ€ç§¯åˆ†ï¼Œå®é™…ä»·å€¼ã€‚\n[Technical Specification]\n1 <= n <= 100\n0 <= v1, v2 <= 100\n0 <= k <= 5\n0 <= a, b, val <= 100\n\nPs. åªè¦é’±æˆ–è€…ç§¯åˆ†æ»¡è¶³è´­ä¹°ä¸€ä»¶å•†å“çš„è¦æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¹°ä¸‹è¿™ä»¶å•†å“ã€‚\n```\n\n**Output**\n```go\nå¯¹äºæ¯ç»„æ•°æ®ï¼Œè¾“å‡ºèƒ½ä¹°çš„æœ€å¤§ä»·å€¼ã€‚\nè¯¦ç»†ä¿¡æ¯è§Sampleã€‚\n```\n**Sample Input**\n\n```go\n5 1 6 1\n4 3 3\n0 3 2\n2 3 3\n3 3 2\n1 0 2\n4 2 5 0\n0 1 0\n4 4 1\n3 3 4\n3 4 4\n```\n\n**Sample Output**\n\n```go\n12\n4\n```\nSource\n2013è…¾è®¯ç¼–ç¨‹é©¬æ‹‰æ¾åˆèµ›ç¬¬ã€‡åœºï¼ˆ3æœˆ20æ—¥ï¼‰\n\n**è§£æ³•ä¸€**\n\nä¸‰ç»´è´¹ç”¨çš„èƒŒåŒ…ï¼Œä½†æ˜¯å’Œå‰é¢çš„[474.ä¸€å’Œé›¶](#474-ä¸€å’Œé›¶)è¿˜æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä¸‰ä¸ªç»´åº¦çš„è´¹ç”¨æ˜¯æ— å…³çš„ï¼Œè€Œ1å’Œ0ä¸­1çš„ä¸ªæ•°å’Œ0çš„ä¸ªæ•°æ˜¯ç›¸å…³çš„\n> ä»£ç ä½¿ç”¨äº†Petrçš„è¾“å…¥æ¨¡æ¿ï¼Œè‡ªå·±æ”¹è¿›äº†ä¸‹ï¼Œå¢åŠ äº†è¾“å…¥ç»“æŸåˆ¤æ–­ï¼Œæ‰€ä»¥çœ‹èµ·æ¥ç‰¹åˆ«é•¿\n```java\nimport java.util.*;\nimport java.io.*;// petrçš„è¾“å…¥æ¨¡æ¿\nimport java.math.*; // ä¸æ˜¯å¤§æ•°é¢˜å¯ä»¥ä¸è¦è¿™ä¸ª\n\npublic class Solve_HDOJ_4501 {\n\n    public static PrintWriter out = new PrintWriter(new OutputStreamWriter(System.out));\n\n    public static void main(String[] args) throws Exception{\n        InputReader in = new InputReader(System.in);\n        //InputReader in = new InputReader(new FileInputStream(\"./input.txt\"));\n        while(!in.EOF()) {\n            int n = in.nextInt();\n            int v1 = in.nextInt();\n            int v2 = in.nextInt();\n            int k = in.nextInt();\n            int[][] cost = new int[n][3];\n            for (int i = 0; i < n; i++) {\n                cost[i][0] = in.nextInt();\n                cost[i][1] = in.nextInt();\n                cost[i][2] = in.nextInt();\n            }\n            solve(n, v1, v2, k, cost);\n        }\n        //åˆ«å¿˜äº†flush\n        out.flush();\n        out.close();\n    }\n\n    //å› ä¸ºæ•°æ®é‡ä¸å¤§ï¼Œå°±ç›´æ¥Scanneräº†\n    public static void solve(int n, int v1, int v2, int k, int[][] cost) {\n        int[][][] dp = new int[k+1][v1+1][v2+1];\n        for (int i = 0; i < n; i++) {\n            for (int j = k; j >= 0; j--) {\n                for (int u = v1; u >= 0; u--) {\n                    for (int w = v2; w >= 0; w--) {\n                        //è¿™é‡Œä¸èƒ½ç›´æ¥u>=cost[i][0] w >= cost[i][1]ï¼Œå› ä¸ºç§¯åˆ†å’Œé’±å’Œå…è´¹æ‹¿æ˜¯åˆ†å¼€çš„ï¼Œæ²¡æœ‰å…³è”çš„\n                        //å³ä½¿æˆ‘ä¸èƒ½å…è´¹æ‹¿ï¼Œä½†æ˜¯æˆ‘èƒ½ç”¨ç§¯åˆ†æ‹¿ï¼Œå³ä½¿ä¸èƒ½ç”¨ç§¯åˆ†æ‹¿ï¼Œæˆ‘å¯ä»¥ç”¨é’±ä¹°\n                        //dp[j][u][w] = Math.max(dp[j][u][w], dp[j-1][u-cost[i][0]][w-cost[i][1]] + cost[i][2]);\n                        int ans = 0;\n                        if (j >= 1) { //å…è´¹æ‹¿\n                            ans = Math.max(ans, dp[j-1][u][w] + cost[i][2]);\n                        }\n                        if (u >= cost[i][0]) { //é’±\n                            ans = Math.max(ans, dp[j][u-cost[i][0]][w] + cost[i][2]);\n                        }\n                        if (w >= cost[i][1]) { //ç§¯åˆ†\n                            ans = Math.max(ans, dp[j][u][w-cost[i][1]] + cost[i][2]);\n                        }\n                        dp[j][u][w] = Math.max(ans, dp[j][u][w]);\n                    }\n                }\n            }\n        }\n        out.println(dp[k][v1][v2]);\n    }\n}\n\n\nclass InputReader {\n\n    public BufferedReader reader;\n    \n    public StringTokenizer tokenizer;\n\n    public InputReader(InputStream stream) {\n        //char[32768]\n        reader = new BufferedReader(new InputStreamReader(stream), 32768);\n        tokenizer = null;\n    }\n\n    //é»˜è®¤ä»¥\" \"ä½œä¸ºåˆ†éš”ç¬¦ï¼Œè¯»ä¸€ä¸ª\n    public String next() {\n        while (tokenizer == null || !tokenizer.hasMoreTokens()) {\n            try {\n                tokenizer = new StringTokenizer(reader.readLine());\n            } catch (IOException e) {\n                throw new RuntimeException(e);\n            }\n        }\n        return tokenizer.nextToken();\n    }\n\n    //æœ‰çš„é¢˜ç›®ä¸ç»™æœ‰å¤šå°‘ç»„æµ‹è¯•ç”¨ä¾‹ï¼Œåªèƒ½ä¸€ç›´è¯»ï¼Œè¯»åˆ°ç»“å°¾ï¼Œéœ€è¦è‡ªå·±åˆ¤æ–­ç»“æŸ\n    //è¯¥å‡½æ•°ä¹Ÿä¼šè¯»å–ä¸€è¡Œï¼Œå¹¶åˆå§‹åŒ–tokenizerï¼Œååºç›´æ¥nextInt..ç­‰å°±å¯ä»¥è¯»åˆ°è¯¥è¡Œ\n    public boolean EOF() {\n        String str = null;\n        try {\n            str = reader.readLine();\n            if (str == null) {\n                return true;\n            }\n            //åˆ›å»ºtokenizer\n            tokenizer = new StringTokenizer(str);\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n        return false;\n    }\n\n    int nextInt(){\n        return Integer.parseInt(next());\n    }\n    \n    long nextLong(){\n        return Long.parseLong(next());\n    }\n    \n    double nextDouble(){\n        return Double.parseDouble(next());\n    }\n    \n    BigInteger nextBigInteger(){\n        return new BigInteger(next());\n    }\n\n    BigDecimal nextBigDecimal(){\n        return new BigDecimal(next());\n    }\n}\n```","tags":["LeetCode","èƒŒåŒ…"],"categories":["ç®—æ³•"]},{"title":"Mapæ˜ å°„ç»“æ„","url":"/2019/11/25/map-ying-she/","content":"\n## Mapæ¥å£\n\n```java\npublic interface Map<K,V>{\n    void put(K key,V value);\n    V remove(K key);\n    boolean contains(K key);\n    V get(K key);\n    void set(K key,V newValue);\n    int getSize();\n    boolean isEmpty();\n}\n```\n\n## LinkedListMap\n\n```java\npublic class LinkedListMap<K,V> implements Map<K,V>{\n    \n    private class Node{\n        public K key;\n        public V value;\n        public Node next;\n\n        public Node(K key,V value,Node next){\n            this.key=key;\n            this.value=value;\n            this.next=next;\n        }\n\n        public Node(K key){\n            this(key,null,null);\n        }\n\n        public Node(){\n            this(null,null,null);\n        }\n\n        @Override\n        public String toString(){\n            return key.toString()+\" : \"+value.toString();\n        }\n    }\n\n    private Node dummyNode;\n\n    private int size;\n\n    public LinkedListMap(){\n        dummyNode=new Node();\n        size=0;\n    }\n\n    @Override\n    public int getSize(){\n        return size;\n    }\n\n    @Override\n    public boolean isEmpty(){\n        return size==0;\n    }\n\n    private Node getNode(K key){\n        Node cur=dummyNode.next;\n        while(cur!=null){\n            if (cur.key.equals(key)) {\n                return cur;\n            }\n            cur=cur.next;\n        }\n        return null;\n    }\n\n    @Override\n    public boolean contains(K key){\n        return getNode(key)==null;\n    }\n\n    @Override\n    public V get(K key){\n        Node node=getNode(key);\n        return node==null?null:node.value;\n    }\n\n    @Override\n    public void put(K key,V value){\n        Node node = getNode(key);\n        if(node==null){\n            dummyNode.next=new Node(key,value,dummyNode.next);\n            size++;\n        }else{\n            node.value=value;\n        }\n    }\n\n    @Override\n    public void set(K key,V value){\n        Node node = getNode(key);\n        if(contains(key)){\n            node.value=value;\n        }else{\n            throw new IllegalArgumentException(key +\" doesn't exist!\");\n        }\n    }\n\n    @Override\n    public V remove(K key){\n        Node prev=dummyNode;\n        while(prev.next!=null){\n            if (prev.next.key.equals(key)) {\n                break;\n            }\n            prev=prev.next;\n        }\n        if (prev.next==null) {\n            //å…¶å®å¯ä»¥å’Œä¸Šé¢ä¸€æ ·æŠ›ä¸€ä¸ªå¼‚å¸¸\n            return null;\n        }\n        Node deleNode=prev.next;\n        prev.next=deleNode.next;\n        deleNode.next=null;\n        size--;\n        return deleNode.value;\n    }\n}\n```\n\n## BSTMap\n\n```java\npublic class BSTMap<K extends Comparable,V> implements Map<K,V>{\n\n    private class Node{\n        public K key;\n        public V value;\n        public Node left;\n        public Node right;\n        public Node(K key,V value){\n            this.key=key;\n            this.value=value;\n            left=null;\n            right=null;\n        }\n    }  \n\n    public Node root;\n\n    private int size;\n\n    public BSTMap(){\n        root=null;\n        size=0;\n    }\n\n    public int getSize(){\n        return size;\n    }\n\n    public boolean isEmpty(){\n        return size==0;\n    }\n\n    public void put(K key,V value){\n        root=put(root,key,value);\n    }\n\n    //addå…ƒç´ åè¿”å›æ–°çš„æ ¹èŠ‚ç‚¹\n    private Node put(Node node,K key,V value){\n        if (node == null) {\n            size++;\n            return new Node(key,value);\n        }\n        if(key.compareTo(node.key) < 0){\n            node.left=put(node.left, key,value);\n        }else if (key.compareTo(node.key) > 0) {\n            node.right=put(node.right, key,value);   \n        }else{\n            //ç›¸ç­‰çš„æƒ…å†µ\n            node.value=value;\n        }\n        return node;\n    }\n\n    private Node getNode(Node node,K key){\n        if (node==null) {\n            return null;\n        }\n        int temp=node.key.compareTo(key);\n        if (temp==0) {\n            return node;\n        }\n        if (temp>0) { //node.key > key\n            return getNode(node.left,key);\n        }\n        return getNode(node.right,key);\n    }\n\n    public boolean contains(K key){\n        return getNode(root,key)!=null;\n    }\n\n    public V get(K key){\n        Node node=getNode(root,key);\n        return node==null?null:node.value;\n    }\n\n    public void set(K key,V newValue){\n        Node node=getNode(root,key);\n        if (node!=null) {\n            node.value=newValue;\n            return;\n        }\n        throw new IllegalArgumentException(key+ \" doesn't exist\");\n    }\n\n    private Node getMin(Node root){\n        if (root.left==null) {\n            return root;\n        }\n        return getMin(root.left);\n    }\n\n    private Node deleteMin(Node node){\n        if (node.left==null) {\n            return node.right;\n        }\n        node.left=deleteMin(node.left);\n        return node;\n    }\n\n    public V remove(K key){\n        Node node=getNode(root,key);\n        if (node==null) {\n            return null;\n        }\n        root=remove(node,key);\n        size--;\n        return node.value;\n    }\n\n    public Node remove(Node root,K key){\n        if (key.compareTo(root.key)>0) { //key > root\n            root.right=remove(root.right,key);\n        }else if (key.compareTo(root.key)<0) {\n            root.left=remove(root.left,key);\n        }else{\n            if (root.left==null) {\n                return root.right;\n            }\n            if (root.right==null) {\n                return root.left;\n            }\n            Node deleNode=root;\n            root=getMin(root.right);\n            root.right=deleteMin(deleNode.right);\n            root.left=deleNode.left;\n        }\n        return root;\n    }\n}\n```\n\n## MapTest\n\n```java\npublic class MapTest{\n    public static void main(String[] args) {\n        Map<Integer,Integer> map=new BSTMap<>();\n        map.put(1,2);\n        map.put(2,2);\n        map.put(3,2);\n        map.put(4,2);\n        map.put(5,2);\n        map.put(6,2);\n        map.put(7,2);\n        map.put(8,2);\n        map.put(9,32131);\n        map.put(11,2);\n        System.out.println(map.contains(13)); //false\n        System.out.println(map.getSize()); //10\n        System.out.println(map.get(9)); //32131\n        map.remove(9);\n        System.out.println(map.get(9)); //null\n        System.out.println(map.getSize()); //10\n        map.set(11,1234567);\n        System.out.println(map.get(11)); //1234567\n    }\n}\n```\n\n## HashMap\n\n```java\nimport java.util.TreeMap;\n\npublic class HashTable<K,V>{\n    private TreeMap<K,V>[] hashtable;\n    private int M;\n    private int size;\n\n    private static final int upperTol=10;\n    private static final int lowerTol=2;\n    private static final int initCapacity=7;\n\n    public HashTable(int M){\n        this.M=M;\n        size=0;\n        hashtable=new TreeMap[M];\n        for (int i=0;i<M;i++) {\n            hashtable[i]=new TreeMap<>();\n        }\n    }\n\n    public HashTable(){\n        this(initCapacity);\n    }\n\n    private int hash(K key){\n        return key.hashCode() & 0x7fffffff %M;\n    }\n\n    private int getSize(){\n        return size;\n    }\n\n    public void add(K key,V value){\n        TreeMap<K,V> map=hashtable[hash(key)];\n        if(map.containsKey(key)){\n            map.put(key,value);\n        }else{\n            map.put(key,value);\n            size++;\n            //æ‰©å®¹\n            // size/M >=upperTol\n            if (size>=upperTol*M) {\n                resize(2*M);\n            }\n        }\n    }\n\n    public V remove(K key){\n        TreeMap<K,V> map=hashtable[hash(key)];\n        V ret=null;\n        if(map.containsKey(key)){\n            ret=map.remove(key);\n            size--;\n            if (size<lowerTol*M && M/2 >= initCapacity) {\n                resize(M/2);\n            }\n        }\n        return ret;\n    }\n\n    public void resize(int size){\n        TreeMap<K,V> newHashTable=new TreeMap[size];\n        for (int i=0;i<size;i++) {\n            newHashTable[i]=new TreeMap<>();\n        }\n        int oldSize=M;\n        this.M=size; //è¦å…ˆå°†Mè®¾ç½®å¥½,ä¸ç„¶hashçš„å€¼ä¸å¯¹\n        for (int i=0;i<oldSize;i++) {\n            TreeMap<K,V> map=hashtable[i];\n            for (K key:map.keySet()) {\n                newHashTable[hash(key)].put(key,map.get(key));\n            }\n        }\n        this.hashtable=newHashTable;\n    }\n\n    public void set(K key,V value){\n        TreeMap<K,V> map=hashtable[hash(key)];\n        if(!map.containsKey(key)){\n            throw new IllegalArgumentException(\"key not exist!\");\n        }\n        map.put(key,value);\n    }\n\n    public boolean contains(K key){\n        return hashtable[hash(key)].containsKey(key);\n    }\n\n    public V get(K key){\n        return hashtable[hash(key)].get(key);\n    }\n}\n```\n\n## æºç åœ°å€\n\n[Github](https://github.com/imlgw/LeetCode/tree/master/tree/map)\n\n\n\n\n\n","tags":["æ•°æ®ç»“æ„","æ˜ å°„"],"categories":["æ•°æ®ç»“æ„"]},{"title":"LRUé˜Ÿåˆ—å®ç°","url":"/2019/11/16/lrucache/","content":"\n## [146. LRUç¼“å­˜æœºåˆ¶](https://leetcode-cn.com/problems/lru-cache/)\n\nè¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª  LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ã€‚å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® get å’Œ å†™å…¥æ•°æ® put ã€‚\n\nè·å–æ•°æ® `get(key)` - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚\nå†™å…¥æ•°æ® `put(key, value)` - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚\n\n**è¿›é˜¶:**\n\nä½ æ˜¯å¦å¯ä»¥åœ¨ `O(1)` æ—¶é—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸¤ç§æ“ä½œï¼Ÿ\n\n**ç¤ºä¾‹:**\n\n```java\nLRUCache cache = new LRUCache( 2 /* ç¼“å­˜å®¹é‡ */ );\n\ncache.put(1, 1);\ncache.put(2, 2);\ncache.get(1);       // è¿”å›  1\ncache.put(3, 3);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ\ncache.get(2);       // è¿”å› -1 (æœªæ‰¾åˆ°)\ncache.put(4, 4);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ\ncache.get(1);       // è¿”å› -1 (æœªæ‰¾åˆ°)\ncache.get(3);       // è¿”å›  3\ncache.get(4);       // è¿”å›  4\n```\n\n**è§£æ³•ä¸€**\n\næ”¹äº†å¥½å‡ æ¬¡æ‰æ”¹å¯¹ï¼Œæ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨HashMap+åŒå‘é“¾è¡¨\n\n```java\npublic class LRUCache {\n\n    class Node{\n        int key;\n        int value;\n        Node pre;\n        Node next;\n        public Node(int key,int value){\n            this.value=value;\n            this.key=key;\n        }\n    }\n\n    HashMap<Integer,Node> map=new HashMap<>();\n\n    Node head=null;\n\n    Node tail=null;\n\n    int capacity=0;\n\n    public LRUCache(int capacity) {\n        this.capacity=capacity;\n    }\n    \n    public int get(int key) {\n        if (map.containsKey(key)) {\n            Node node=map.get(key);\n            //ç§»åŠ¨åˆ°é“¾è¡¨å¤´\n            move2Head(node);\n            return node.value;\n        }\n        return -1;\n    }\n    \n    public void put(int key, int value) {\n        Node newHead=new Node(key,value);\n        if (map.containsKey(key)) {\n            Node node=map.get(key);\n            node.value=value;\n            //ç§»åŠ¨åˆ°é“¾è¡¨å¤´\n            move2Head(node);\n            return;\n        }\n        if (map.size()==capacity) {\n            map.remove(tail.key);\n            removeNode(tail);\n        }\n        move2Head(newHead);\n        map.put(key,newHead);\n    }\n\n    public void removeNode(Node node){\n        if (node.key==tail.key) {\n            tail=tail.pre;\n            return;\n        }\n        if (node.pre==null || node.next==null) {\n            return;\n        }\n        node.pre.next=node.next;\n        node.next.pre=node.pre;\n    }\n\n    public void move2Head(Node newHead){\n        if (map.size()==0) {\n            head=tail=newHead;\n            return;\n        }\n        if (newHead.key==head.key) {\n            return;\n        }\n        removeNode(newHead);\n        newHead.next=head;\n        newHead.pre=null;\n        head.pre=newHead;\n        head=newHead;\n    }\n}\n\n/**\n * Your LRUCache object will be instantiated and called as such:\n * LRUCache obj = new LRUCache(capacity);\n * int param_1 = obj.get(key);\n * obj.put(key,value);\n */\n```\n\næ—¢ç„¶å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å°±æ¥è€ƒè™‘ä¸‹ä¸ºå•¥è¦è¿™æ ·å®ç°\n\nå…¶å®æˆ‘ä¸€å¼€å§‹ä¹Ÿä¸çŸ¥é“å’‹å®ç°ï¼ŒæŸ¥äº†ä¸‹æ‰çŸ¥é“ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š\n\n1. é¦–å…ˆæ˜¯é¢˜ç›®è¦æ±‚get/putæ—¶é—´å¤æ‚åº¦æ˜¯`O(1)` çš„ï¼Œè€Œæˆ‘ä»¬åœ¨get/putçš„æ—¶å€™è‚¯å®šä¼šé¢‘ç¹çš„ç§»åŠ¨å…ƒç´ çš„ä½ç½®ï¼Œé‚£æˆ‘ä»¬è‚¯å®šæ˜¯ä¸èƒ½ç”¨æ•°ç»„ï¼Œé˜Ÿåˆ—ä¹‹ç±»çš„ç»“æ„äº†\n\n2. é‚£æˆ‘ä»¬èƒ½ç”¨å•é“¾è¡¨ä¹ˆï¼Ÿæˆ‘ä»¬å¯ä»¥å°†æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹æ”¾åœ¨å¤´éƒ¨ï¼Œç„¶åæ¯æ¬¡æ»¡çš„æ—¶å€™å‰”é™¤å°¾èŠ‚ç‚¹çš„å…ƒç´ ï¼Œç”±äºæ˜¯é“¾è¡¨ï¼Œç§»åŠ¨èŠ‚ç‚¹çš„ä½ç½®éƒ½æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœè¦getä¸€ä¸ªå…ƒç´ çš„æ—¶å€™å°±éº»çƒ¦äº†ï¼Œéœ€è¦éå†æ•´ä¸ªé“¾è¡¨æ‰èƒ½å–åˆ°å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´å•é“¾è¡¨å®šä½æŸä¸ªå…ƒç´ æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ç”¨HashMapæ¥è¾…åŠ©å•é“¾è¡¨ï¼Œè¿™æ ·æˆ‘ä»¬ä»¥keyä¸ºmapçš„keyï¼ŒNodeèŠ‚ç‚¹ä¸ºmapçš„valueå°±å¯ä»¥è¿…é€Ÿå®šä½åˆ°æŸä¸ªå…ƒç´ \n\n3. å•é“¾è¡¨+HashMapå°±å¯ä»¥äº†ä¹ˆï¼Ÿå…¶å®è¿˜å·®ç‚¹å„¿ï¼Œå¦‚æœç°åœ¨æ»¡äº†ï¼Œéœ€è¦åˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å°†tailçš„å‰ä¸€ä¸ªä½œä¸ºæ–°çš„tailï¼Œä½†æ˜¯ç”±äºæ˜¯å•é“¾è¡¨ï¼Œæ²¡æœ‰å‰ç½®æŒ‡é’ˆï¼Œä¸æ–¹ä¾¿å®šä½å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€åçš„æ–¹æ¡ˆå°±æ˜¯é‡‡ç”¨**åŒå‘é“¾è¡¨+HashMap**æ¥å®ç°LRU\n\n   ![img](https://pic4.zhimg.com/80/v2-09f037608b1b2de70b52d1312ef3b307_hd.jpg)\n\nå…¶å®LRUæ€æƒ³å¹¶ä¸å¤æ‚ï¼ŒæŒ‰ç…§è§„åˆ™æ¥ç§»åŠ¨èŠ‚ç‚¹ï¼Œåˆ é™¤èŠ‚ç‚¹å°±OKï¼Œæ“ä½œç³»ç»Ÿæ•™ç¨‹ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„è¿‡ç¨‹å›¾ï¼Œç†è§£äº†ä¸‹é¢çš„å›¾ä»£ç å°±å¥½å†™äº†\n\n![mark](http://static.imlgw.top/blog/20191116/BISfMVdI96FT.png?imageslim)\n\nä½†æ˜¯å¦‚æœå®ç°çš„æ–¹å¼ä¸å¤ªå¥½çš„è¯ï¼Œå°±ä¼šå†™å¾ˆå¤šif-elseåˆ¤æ–­ä¸€äº›è¾¹ç•Œï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢è‡ªå·±çš„å®ç°å°±æ˜¯ã€‚ã€‚ã€‚\n\nå…¶å®è¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯æˆ‘ä¸Šé¢çš„æ–¹å¼headå’Œtailæ˜¯çœŸå®çš„èŠ‚ç‚¹ï¼Œä¸æ˜¯è™šèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šæœ‰å¾ˆå¤šè¾¹ç•Œçš„é€»è¾‘åˆ¤æ–­ï¼Œé¢è¯•çš„æ—¶å€™ä¸å»ºè®®é‚£æ ·å†™ï¼Œå¾ˆå®¹æ˜“å‡ºé—®é¢˜ï¼ï¼ï¼\n\n**è§£æ³•äºŒ**\n\né¢è¯•ä¸­æ¯”è¾ƒæ¨èåƒè¿™æ ·å†™\n\n```java\npublic class LRUCache {\n\n    class Node{\n        int key;\n        int value;\n        Node pre;\n        Node next;\n        public Node(int key,int value){\n            this.value=value;\n            this.key=key;\n        }\n    }\n\t\n    HashMap<Integer,Node> map=new HashMap<>();\n\n    Node head=null;\n\n    Node tail=null;\n\n    int capacity=0;\n\n    public LRUCache(int capacity) {\n        this.capacity=capacity;\n        //åˆå§‹åŒ–å¤´å°¾èŠ‚ç‚¹,æ³¨æ„è¿™ä¸¤ä¸ªèŠ‚ç‚¹åªæ˜¯ä¸ªå“¨å…µèŠ‚ç‚¹,å¹¶ä¸ä¼šå­˜å…¥mapä¸­\n        head=new Node(-1,-1);\n        tail=new Node(-1,-1);\n        head.next=tail;\n        tail.pre=head;\n    }\n    \n    public int get(int key) {\n        if (map.containsKey(key)) {\n            Node node=map.get(key);\n            //ç§»åŠ¨åˆ°é“¾è¡¨å¤´\n            move2Head(node);\n            return node.value;\n        }\n        return -1;\n    }\n    \n    public void put(int key, int value) {\n        Node newHead=new Node(key,value);\n        if (map.containsKey(key)) {\n            Node node=map.get(key);\n            //è®¾ç½®èŠ‚ç‚¹å€¼ä¸ºæ–°value\n            node.value=value;\n            //ç§»åŠ¨åˆ°é“¾è¡¨å¤´\n            move2Head(node);\n            return;\n        }\n        //æ»¡äº†,å…ˆå‰”é™¤tailå†æ’å…¥\n        if (map.size()==capacity) {\n            map.remove(popTail().key);\n        }\n        addFirst(newHead);\n        map.put(key,newHead);\n    }\n\n    //å¼¹å‡ºtail\n    private Node popTail(){\n        Node newTail=tail.pre;\n        removeNode(newTail);\n        return newTail;\n    }\n\n    //ç§»é™¤èŠ‚ç‚¹\n    private void removeNode(Node node){\n        node.pre.next=node.next;\n        node.next.pre=node.pre;\n    }\n\n    //ä»å¤´æ·»åŠ \n    private void addFirst(Node node){\n        node.next=head.next;\n        head.next.pre=node;\n        head.next=node;\n        node.pre=head;\n    }\n\n    //ç§»åŠ¨èŠ‚ç‚¹åˆ°head\n    private void move2Head(Node node){\n        //åˆ é™¤åŸé“¾è¡¨ä¸­å¯¹åº”ä½ç½®çš„node\n        removeNode(node);\n        //ä»å¤´å†æ·»åŠ ä¸€é\n        addFirst(node);\n    }\n}\n```\n\nåƒè¿™æ ·å†™ï¼Œå°±ä¸ç”¨è€ƒè™‘é‚£ä¹ˆå¤šè¾¹ç•Œï¼Œå†™é‚£ä¹ˆå¤šçš„ifå’Œelseï¼Œé¢„å…ˆå¼€è¾Ÿä¸¤ä¸ªèŠ‚ç‚¹çš„ä½œä¸ºå“¨å…µèŠ‚ç‚¹ï¼Œè¿™æ ·ä»£ç å°±æ˜¾å¾—æ¸…æ™°ç®€æ´ï¼Œä¹Ÿä¸å®¹æ˜“å‡ºé—®é¢˜\n\n[å‚è€ƒ](https://zhuanlan.zhihu.com/p/34133067)\n\n## UPDATE\néšä¾¿é‡å†™äº†ä¸‹\n\n```java\nclass LRUCache {\n    \n    HashMap<Integer, Node> map = null;\n        \n    int capacity = 0;\n    \n    Node head = null;\n    \n    Node tail = null;\n    \n    public LRUCache(int capacity) {\n        this.capacity = capacity;\n        map = new HashMap<>();\n        head = new Node(-1, -1);\n        tail = new Node(-1, -1);\n        head.next = tail;\n        tail.prev = head;\n    }\n    \n    public int get(int key) {\n        Node node = map.get(key);\n        if (node == null) {\n            return -1;\n        }\n        removeNode(node);\n        insert2head(node);\n        return node.val;\n    }\n    \n    public void put(int key, int value) {\n        Node node = map.get(key);\n        if (node == null) {\n            node = new Node(key, value);\n            insert2head(node);\n            map.put(key, node);\n        } else {\n            removeNode(node);\n            node.val = value;\n            insert2head(node);\n        }\n        if (map.size() > capacity) {\n            map.remove(tail.prev.key);\n            removeNode(tail.prev);\n        }\n    }\n    \n    public void insert2head(Node node) {\n        node.next = head.next;\n        node.prev = head;\n        head.next.prev = node;\n        head.next = node;\n    }\n    \n    //ç§»é™¤NodeèŠ‚ç‚¹\n    public void removeNode(Node node) {\n        node.prev.next = node.next;\n        node.next.prev = node.prev;\n        node.next = null;\n        node.prev = null;\n    }\n    \n    class Node {\n        Node prev, next;\n        int key, val;\n        public Node (int key, int val) {\n            this.key = key;\n            this.val = val;\n        }\n    }\n}\n\n/**\n * Your LRUCache object will be instantiated and called as such:\n * LRUCache obj = new LRUCache(capacity);\n * int param_1 = obj.get(key);\n * obj.put(key,value);\n */\n```\n\nGolang\n\n```golang\ntype LRUCache struct {\n    capacity int\n    cache map[int]*Node\n    head *Node\n    tail *Node\n}\n\ntype Node struct {\n    prev *Node\n    next *Node\n    key int\n    val int\n}\n\n\nfunc Constructor(capacity int) LRUCache {\n    head := &Node{key : -1, val : -1}\n    tail := &Node{key : -1, val : -1}\n    head.next = tail\n    tail.next = head\n    return LRUCache{\n        capacity : capacity,\n        cache : make(map[int]*Node),\n        head : head,\n        tail : tail,\n    }\n}\n\n\nfunc (this *LRUCache) Get(key int) int {\n    if v, ok := this.cache[key]; ok {\n        this.removeNode(v)\n        this.insert2Head(v)\n        return v.val\n    }\n    return -1\n}\n\n\nfunc (this *LRUCache) Put(key int, value int)  {\n    if v, ok := this.cache[key]; ok {\n        this.removeNode(v)\n        v.val = value\n        this.insert2Head(v)\n    } else {\n        newNode := &Node{key : key, val : value}\n        this.cache[key] = newNode\n        this.insert2Head(newNode)\n    }\n    if len(this.cache) > this.capacity {\n        delete(this.cache, this.tail.prev.key)\n        this.removeNode(this.tail.prev)\n    }\n}\n\nfunc (this *LRUCache) removeNode (node *Node) {\n    node.next.prev = node.prev\n    node.prev.next = node.next\n    node.prev = nil\n    node.next = nil\n}\n\nfunc (this *LRUCache) insert2Head (node *Node) {\n    node.prev = this.head\n    node.next = this.head.next\n    this.head.next.prev = node\n    this.head.next = node\n}\n\n/**\n * Your LRUCache object will be instantiated and called as such:\n * obj := Constructor(capacity);\n * param_1 := obj.Get(key);\n * obj.Put(key,value);\n */\n```","tags":["LeetCode","LRU"],"categories":["ç®—æ³•"]},{"title":"Redisæ€ç»´å¯¼å›¾","url":"/2019/11/16/redis-si-wei-dao-tu/","content":"\n<iframe id=\"embed_dom\" name=\"embed_dom\" frameborder=\"0\" style=\"display:block;width:2000px; height:5000px;\" src=\"https://www.processon.com/embed/mind/5dda2b45e4b0bbcb8a6ae8bc\"></iframe>\n\n## åŸå§‹Xmindæ–‡ä»¶\n\n[Redisæ€ç»´å¯¼å›¾](http://static.imlgw.top/Redis.xmind)\n\n![Redis](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/Redis.png)\n\n\n\n\n\n","tags":["Redis"],"categories":["Web"]},{"title":"äºŒåˆ†æœç´¢æ ‘","url":"/2019/11/08/er-fen-sou-suo-shu/","content":"\n## äºŒåˆ†æœç´¢æ ‘\n\n**äºŒå‰æŸ¥æ‰¾æ ‘**ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼‰ï¼Œä¹Ÿç§°ä¸º**äºŒåˆ†æœç´¢æ ‘**ï¼Œ**äºŒå‰æœç´¢æ ‘**ã€**æœ‰åºäºŒå‰æ ‘**ï¼ˆordered binary treeï¼‰æˆ–**æ’åºäºŒå‰æ ‘**ï¼ˆsorted binary treeï¼‰ä¹Ÿå¯ä»¥ç®€å†™ä¸º `BST`ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„[äºŒå‰æ ‘](https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%A0%91)ï¼š\n\n1. è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›\n2. è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›\n3. ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼›\n4. æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚\n\näºŒå‰æŸ¥æ‰¾æ ‘ç›¸æ¯”äºå…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜åŠ¿åœ¨äºæŸ¥æ‰¾ã€æ’å…¥çš„[æ—¶é—´å¤æ‚åº¦](https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6)è¾ƒä½ã€‚ä¸º` O(logN) `ã€‚äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯åŸºç¡€æ€§æ•°æ®ç»“æ„ï¼Œç”¨äºæ„å»ºæ›´ä¸ºæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå¦‚é›†åˆï¼Œæ˜ å°„ç­‰\n\n## åŸºæœ¬ç»“æ„\n\nå…ˆæ­ä¸€ä¸ªåŸºæœ¬çš„æ¶å­å‡ºæ¥ï¼Œåé¢å†æ¥æ…¢æ…¢çš„å®Œå–„åŠŸèƒ½\n\n```java\npublic class BST<E extends Comparable<E>>{\n    //TreeNode\n    private class Node{\n        public E e;\n        public Node left;\n        public Node right;\n        public Node(E e){\n            this.e=e;\n            left=null;\n            right=null;\n        }\n    }\n\n    private Node root;\n\n    private int size;\n\n    public BST(){\n        root=null;\n        size=0;\n    }\n\n    public int size(){\n        return size;\n    }\n\n    public boolean isEmpty(){\n        return size==0;\n    }\n\n    public void add(E e){\n        //...\n    }\n\n    public boolean contains(E e){\n        //...\n    }\n}\n```\n\n## æ·»åŠ \n\næ·»åŠ å‡½æ•°ï¼Œæ—¶é—´å¤æ‚åº¦`O(logN)`ï¼Œåªè¦æŠ“ä½äº†å®ƒçš„æ€§è´¨å°±å¾ˆå¥½å†™ï¼Œç”»ä¸ªå›¾æè¿°ä¸‹è¿™ä¸ªè¿‡ç¨‹\n\n![mark](http://static.imlgw.top/blog/20191113/P39b50Ikv4sV.png?imageslim)\n\nâ‘  é¦–å…ˆå’ŒrootèŠ‚ç‚¹8æ¯”è¾ƒï¼Œæ¯”8å°ï¼Œæ‰€ä»¥è‚¯å®šå†8çš„å·¦å­æ ‘ä¸­\n\nâ‘¡ å†å’Œrootçš„å·¦å­æ ‘æ ¹èŠ‚ç‚¹5æ¯”è¾ƒï¼Œæ¯”5å¤§ï¼Œæ‰€ä»¥æœ€åè‚¯å®šæ’å…¥5çš„å³å­æ ‘ä¸­\n\nâ‘¢ å†å’Œ5èŠ‚ç‚¹çš„å³å­æ ‘æ ¹èŠ‚ç‚¹6æ¯”è¾ƒï¼Œæ¯”6å¤§ï¼Œæ‰€ä»¥æœ€åæ’å…¥6çš„å³å­æ ‘ä¸­\n\nâ‘£ å³å­æ ‘ä¸ºç©ºï¼Œç›´æ¥æ’å…¥åˆ°6çš„å³è¾¹\n\næ ¹æ®ä¸Šé¢çš„æµç¨‹æˆ‘ä»¬å¾ˆå®¹æ˜“å†™å‡ºä»£ç \n\n```java\npublic void addLoop(E e){\n    if (root==null) {\n        size++;\n        root=new Node(e);\n        return;\n    }\n    Node temp=root;\n    while(temp!=null){\n        if (e.compareTo(temp.e)>0) {\n            if (temp.right==null) {\n                temp.right=new Node(e);\n                size++;\n                return;\n            }\n            temp=temp.right;\n        }else if (e.compareTo(temp.e)<0) {\n            if (temp.left==null) {\n                temp.left=new Node(e);\n                size++;\n                return;\n            }\n            temp=temp.left;\n        }else return; //ä¸èƒ½æœ‰ç›¸ç­‰å…ƒç´ \n    }\n}\n```\nè¿™é‡Œæ—¢ç„¶æ˜¯æ ‘ç»“æ„ï¼Œç”¨å¾ªç¯ä¼¼ä¹æœ‰çš„æ˜¾å¾—ä¸å¤Ÿä¼˜é›…ğŸ˜‚\n\næ‰€ä»¥æˆ‘ä»¬å°è¯•æŠŠè¿™ä¸ªæ”¹æˆé€’å½’\n\n```java\npublic void add2(E e){\n    if(root == null){\n        root = new Node(e);\n        size ++;\n    }else add(root, e);\n}\n\n// å‘ä»¥nodeä¸ºæ ¹çš„äºŒåˆ†æœç´¢æ ‘ä¸­æ’å…¥å…ƒç´ e,ç•¥æ˜¾ç¹ç\nprivate void add2(Node node, E e){\n    if(e.equals(node.e)) return;\n    if(e.compareTo(node.e) < 0 && node.left == null){\n        node.left = new Node(e);\n        size ++;\n        return;\n    }\n    if(e.compareTo(node.e) > 0 && node.right == null){\n        node.right = new Node(e);\n        size ++;\n        return;\n    }\n    if(e.compareTo(node.e) < 0)\n        add(node.left, e);\n    else //e.compareTo(node.e) > 0\n    \tadd(node.right, e);\n}\n```\nè¿™ä¸ªé€’å½’ï¼Ÿï¼Ÿï¼Ÿå’‹æ„Ÿè§‰æ¯”å¾ªç¯è¿˜ç¹çğŸ™„ \n\nç¡®å®ï¼Œä¸Šé¢è¿™ä¸ªé€’å½’çš„ç»ˆæ­¢æ¡ä»¶å¤ªç¹çäº†ï¼Œ`compareTo`ä¸€å…±æ¯”è¾ƒäº†4æ¬¡ï¼Œæœ‰å¾ˆå¤šé‡å¤ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—æ”¹æ”¹ğŸ˜‹\n\næˆ‘ä»¬è®©è¿™ä¸ª`add`å‡½æ•°æœ‰è¿”å›å€¼ï¼Œè¿”å›æ’å…¥åçš„æ ¹èŠ‚ç‚¹ï¼Œè¿™æ ·æˆ‘ä»¬çš„å‡½æ•° `add(Node node,E e)` å®šä¹‰å°±å˜æˆäº† **æ’å…¥å…ƒç´ `e`åˆ° ä»¥ `node` ä¸ºæ ¹èŠ‚ç‚¹çš„BSTä¸­ï¼Œå¹¶ä¸”è¿”å›æ ¹èŠ‚ç‚¹** ï¼Œæ¸…æ¥šäº†é€’å½’å‡½æ•°çš„å®šä¹‰ï¼Œæˆ‘ä»¬å†æ¥å†™æ–¹æ³•å°±ä¼šå®¹æ˜“å¾ˆå¤š\n\n```java\npublic void add(E e){\n    root=add(root,e);\n}\n\n//æ’å…¥å…ƒç´ `e`åˆ° ä»¥ `node` ä¸ºæ ¹èŠ‚ç‚¹çš„BSTä¸­ï¼Œå¹¶ä¸”è¿”å›æ ¹èŠ‚ç‚¹\nprivate Node add(Node node, E e){\n    if (node == null) {\n        size++;\n        return new Node(e);\n    }\n    if(e.compareTo(node.e) < 0){\n        //æ’å…¥å·¦å­æ ‘ä¸­ï¼Œå¹¶è¿”å›æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ¥åœ¨node.left\n        node.left=add(node.left, e);\n    }else if (e.compareTo(node.e) > 0) { //æ³¨æ„ä¸è¦å†™else,å‰é¢æ²¡æœ‰å¯¹ç›¸ç­‰çš„å…ƒç´ åšåˆ¤æ–­\n        //æ’å…¥å³å­æ ‘ä¸­ï¼Œå¹¶è¿”å›æ ¹èŠ‚ç‚¹ï¼Œç„¶åæ¥åœ¨node.right\n        node.right=add(node.right, e);   \n    }\n    return node;\n}\n```\nè¿˜æ˜¯é‚£å¥è¯ï¼Œå†™é€’å½’å‡½æ•°ï¼Œä¸è¦çº ç»“äºå‡½æ•°çš„æ¯ä¸€æ­¥æ˜¯å¦‚ä½•å»è¿›è¡Œï¼Œå¦‚ä½•å»å¾—åˆ°ç»“æœçš„ï¼Œä»å…¨å±€å‡ºå‘ï¼Œåªè¦ææ¸…æ¥šé€’å½’å‡½æ•°çš„å®šä¹‰ï¼ŒæŒ‰ç…§å‡½æ•°çš„å®šä¹‰æ¥å†™ä»£ç ï¼Œæœ€åæ€è€ƒä¸€ä¸‹è¾¹ç•Œï¼Œæœ€åçš„ä»£ç å°±ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼\n\nè¿™ä¸ªè¾¹ç•Œçš„æ€è€ƒï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ªç»“æŸæ¡ä»¶ï¼Œæˆ‘ä»¬ä¸ç”¨å»è€ƒè™‘ä¸€æ­¥æ­¥ç›´åˆ°é€’å½’ç»ˆç»“æ—¶æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œæˆ‘ä»¬æ€è€ƒä¸€ä¸‹æç«¯çš„è¾¹ç•Œæƒ…å†µï¼ˆå…¶å®è¿™å°±æ˜¯ç»ˆç»“çš„æƒ…å†µï¼‰ï¼Œrootä¸ºnullï¼Œè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼ŒBSTè¿˜æ˜¯ç©ºçš„ï¼Œè¿™ä¸ªæ—¶å€™addå…ƒç´ ï¼Œå…¶å®æƒ³éƒ½ä¸ç”¨æƒ³ï¼Œè‚¯å®šæ˜¯ç›´æ¥æŠŠè¿™ä¸ª eä½œä¸ºæ ¹èŠ‚ç‚¹è¿”å›å°±okäº†ï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶çš„å°±å†™å‡ºäº†ç»ˆæ­¢æ¡ä»¶\n\n## æŸ¥æ‰¾\n\næŸ¥æ‰¾ç›¸æ¯”äºä¸Šé¢çš„æ·»åŠ ï¼Œä¼šç®€å•å¾ˆå¤šï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å†™å‡ºä»£ç \n\n```java\n//æŸ¥è¯¢æ“ä½œ\npublic boolean contains(E e){\n    if (e==null) {\n        return false;\n    }\n    return contains(e,root);\n}\n\nprivate boolean contains(E e,Node root){\n    if (root==null) {\n        return false;\n    }\n    if (e.compareTo(root.e)==0) {\n        return true;\n    }\n    return e.compareTo(root.e)<0?contains(e,root.left):contains(e,root.right);\n}\n```\nè¿™é‡Œæˆ‘ä¸ºäº†ç®€æ´å†™äº†ä¸‰ç›®ï¼Œä¸ç†Ÿæ‚‰çš„å¯ä»¥æ”¹æˆifï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯`O(logN)` ï¼Œæ¯”çº¿æ€§è¡¨çš„æŸ¥æ‰¾ä¼šå¿«å¾ˆå¤šï¼\n\n## éå†\n\nè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œè¿™ä¸ªåœ¨æˆ‘ä¹‹å‰çš„ [LeetCode-äºŒå‰æ ‘](http://imlgw.top/2019/11/06/leetcode-er-cha-shu-di-gui/) é‡Œé¢ä¹Ÿåšè¿‡äº†ï¼Œè¿™é‡Œå†ç¿»å‡ºæ¥çœ‹çœ‹ï¼Œå…¶å®é‡ç‚¹æ˜¯æƒ³æŠŠååºéå†ç»™ææ¸…æ¥šäº†ï¼Œä¹‹å‰ä¸€ç›´æŒºè¿·ç³Šçš„\n\n### å‰åºéå†\n\n#### é€’å½’å†™æ³•\n\n```java\n//å‰åºéå†,é€’å½’\npublic void preorderTravelRecur(){\n    preorderTravel(root);\n}\n\nprivate void preorderTravel(Node root){\n    if (root==null) {\n        return;\n    }\n    System.out.print(root.e+\" \");\n    preorderTravel(root.left);\n    preorderTravel(root.right);\n}\n```\n#### éé€’å½’å†™æ³•\n\n```java\n//å‰åºéå†,éé€’å½’å®ç°\npublic void preorderTravelNoRecur(){\n    Stack<Node> stack=new Stack<>();\n    Node cur=root;\n    while( cur!=null || !stack.isEmpty()){\n        while(cur!=null){\n            System.out.print(cur.e+\" \");\n            stack.push(cur);\n            cur=cur.left;\n        }\n        cur=stack.pop();\n        cur=cur.right;\n    }\n}\n```\næ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯ç»å…¸çš„å‰åºéå†æ–¹å¼ï¼Œæ˜¯æŒ‰ç…§ â€œæ¨¡æ¿â€ æ¥çš„ï¼Œé¦–å…ˆæˆ‘ä»¬è€ƒè™‘æ ˆé‡Œé¢å­˜çš„æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œçš„æ ˆé‡Œé¢å­˜çš„å®é™…ä¸Šæ˜¯ `å·¦å­æ ‘çš„å·¦è¾¹` çš„é›†åˆï¼Œè¿™é‡Œæˆ‘ä¸çŸ¥é“å’‹æè¿°ï¼Œç”»ä¸ªå›¾å§\n\n![mark](http://static.imlgw.top/blog/20191113/BF0cCcWcy3zP.png?imageslim)\n\nå›¾ä¸­ç»¿è‰²éƒ¨åˆ†å°±æ˜¯æˆ‘æ‰€è¯´çš„**å·¦å­æ ‘çš„å·¦è¾¹çš„é›†åˆ**ï¼Œæ•´ä¸ªæ ˆçš„å…¥æ ˆé¡ºåºå°±æ˜¯ä»å·¦å¾€å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä¾æ¬¡çš„å°†è¿™äº›â€œå·¦è¾¹â€ å…¥æ ˆï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰å·¦å­æ ‘ï¼Œä¹Ÿå°±æ˜¯éå†åˆ°å¶å­èŠ‚ç‚¹çš„æ—¶å€™å¼€å§‹å‡ºæ ˆï¼Œç„¶ååˆ‡æ¢æˆ`å½“å‰å‡ºæ ˆçš„èŠ‚ç‚¹`çš„å³å­æ ‘ï¼Œå°†å³å­æ ‘çš„`å·¦å­æ ‘çš„å·¦è¾¹`é‡å¤å‰é¢çš„è¿‡ç¨‹ç»§ç»­å…¥æ ˆå‡ºæ ˆï¼Œæˆ‘ä»¬è¦è€ƒè™‘çš„å°±æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è®¿é—®èŠ‚ç‚¹ï¼\n\nç»†å¿ƒçš„åŒå­¦è‚¯å®šå·²ç»å‘ç°äº†ï¼Œå…¶å®è¿™é‡Œè¿›æ ˆé¡ºåºå’Œå‡ºæ ˆé¡ºåºï¼Œåˆ†åˆ«å¯¹åº”çš„å°±æ˜¯è¿™é¢—æ ‘å‰åºéå†å’Œä¸­åºéå†ï¼ï¼ï¼æ‰€ä»¥æˆ‘ä»¬å°±åªéœ€è¦åœ¨è¿›æ ˆå’Œå‡ºæ ˆçš„æ—¶å€™ï¼Œè¿›è¡Œè®¿é—®èŠ‚ç‚¹çš„æ“ä½œï¼Œå°±å¯ä»¥å®Œæˆå‰åºå’Œååºéå†\n\n### ä¸­åºéå†\n\n#### é€’å½’å†™æ³•\n\n```java\n//ä¸­åºéå†,é€’å½’\npublic void inorderTravelRecur(){\n    inorderTravel(root);\n}\n\nprivate void inorderTravel(Node root){\n    if (root==null) {\n        return;\n    }\n    inorderTravel(root.left);\n    System.out.print(root.e+\" \");\n    inorderTravel(root.right);\n}\n```\n#### éé€’å½’å†™æ³•\n\nç»“åˆä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„å¾—å‡ºéé€’å½’çš„ä¸­åºéå†çš„å†™æ³•\n\n```java\n//ä¸­åºéå†,éé€’å½’\npublic void inorderTravelNoRecur(){\n    Stack<Node> stack=new Stack<>();\n    Node cur=root;\n    while( cur!=null || !stack.isEmpty()){\n        while(cur!=null){\n            stack.push(cur);\n            cur=cur.left;\n        }\n        cur=stack.pop();\n        System.out.print(cur.e+\" \");\n        cur=cur.right;\n    }\n}\n```\n### ååºéå†\n\n#### é€’å½’å†™æ³•\n\n```java\n//ååºéå†,é€’å½’\npublic void postorderTravelRecur(){\n    postorderTravel(root);\n}\n\nprivate void postorderTravel(Node root){\n    if (root==null) {\n        return;\n    }\n    postorderTravel(root.left);\n    postorderTravel(root.right);\n    System.out.print(root.e+\" \");\n}\n```\n#### éé€’å½’å†™æ³•\n\nè¿™é‡Œçš„éé€’å½’å†™æ³•å°±ä¸ä¸€æ ·äº†ï¼Œæ¯”å‰ä¸¤ç§è¦å¤æ‚\n\n```java\n//ååºéå†,éé€’å½’\npublic void postorderTravelNoRecur(){\n    Stack<Node> stack=new Stack<>();\n    Node cur=root,lastNode=null;\n    while(cur!=null || !stack.isEmpty()){\n        while(cur!=null){\n            stack.push(cur);\n            cur=cur.left;\n        }\n        cur=stack.peek();//æŸ¥çœ‹æ ˆé¡¶å…ƒç´ \n        //å¦‚æœå³å­æ ‘ä¸ºç©ºæˆ–è€…å³èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡ï¼Œåˆ™å½“å‰èŠ‚ç‚¹å‡ºæ ˆï¼Œå¹¶è®°å½•lastNode\n        if (cur.right==null || lastNode==cur.right) { \n            System.out.print(cur.e+\" \");\n            stack.pop();\n            lastNode=cur;\n            //ä¸ºäº†ä¸‹ä¸€æ¬¡èƒ½ç›´æ¥æŸ¥çœ‹æ ˆé¡¶å…ƒç´ \n            //curçš„ä½¿å‘½å…¶å®å·²ç»ç»“æŸäº†ï¼Œcurå’Œå®ƒçš„å­©å­éƒ½å·²ç»è®¿é—®äº†ï¼Œä¸‹ä¸€æ¬¡ç›´æ¥ä»æ ˆé¡¶å–ï¼Œä¸ç„¶å°±æ­»å¾ªç¯äº†\n            cur=null; \n        }else{\n            cur=cur.right;\n        }\n    }\n}\n```\n![mark](http://static.imlgw.top/blog/20191113/zM80igBy0RDX.png?imageslim)\n\nå…¶å®ä¸ç®¡æ˜¯ä»€ä¹ˆéå†ï¼Œå¯¹äºè¿™ä¸ªæ¨¡æ¿æ¥è¯´ï¼Œ**æ ˆçš„è½¨è¿¹éƒ½æ˜¯ä¸€æ ·çš„**ï¼Œåªä¸è¿‡è®¿é—®èŠ‚ç‚¹çš„æ—¶æœºæœ‰æ‰€ä¸åŒï¼Œè“è‰²çº¿æ¡ä»£è¡¨å®¡æŸ¥çš„é¡ºåºï¼Œçº¢è‰²è¾…åŠ©çš„ä»£è¡¨å‡ºæ ˆéƒ¨åˆ†ï¼Œå³è¾¹å¯¹åº”çš„å°±æ˜¯éå†è¿‡ç¨‹ä¸­æ ˆçš„å˜åŒ–ï¼Œå’Œå¯¹åº”ç»“æœçš„å˜åŒ–ï¼Œå¯¹ç…§è¿™ä¸ªå›¾å†åˆ†æä¸‹å°±å¾ˆæ¸…æ¥šäº†ã€‚\n\nå¦‚æœè§‰å¾—å®åœ¨æ˜¯ä¸å¥½ç†è§£ä¹Ÿå¯ä»¥æ¢ç”¨ä¸‹é¢çš„æ–¹å¼\n\n```java\npublic void postorderTravelNoRecur2() {\n    Stack<Node> stack=new Stack<>();\n    stack.push(root);\n    Node lastNode=null;\n    while(!stack.isEmpty()){\n        //å–æ ˆé¡¶å…ƒç´ \n        Node cur=stack.peek();\n        //å·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼Œæˆ–è€…ä¸Šä¸€ä¸ªè®¿é—®çš„èŠ‚ç‚¹æ˜¯å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å°±è¾“å‡ºè¯¥èŠ‚ç‚¹\n        if ( (cur.left==null && cur.right ==null) || \n             (lastNode!=null &&(cur.left==lastNode || cur.right==lastNode))){\n            stack.pop();\n            System.out.print(cur.e+\" \");\n            lastNode=cur;\n        }else{\n            if (cur.right!=null) {\n                stack.push(cur.right);\n            } if (cur.left!=null) {\n                stack.push(cur.left);\n            }  \n        } \n    }\n}\n```\nè¿™ç§æ–¹å¼ç›¸æ¯”ä¸Šé¢å°±å¥½ç†è§£å¤šäº†ï¼Œå·¦å³å­æ ‘éƒ½ä¸ºç©ºï¼Œæˆ–è€…ä¸Šä¸€ä¸ªè®¿é—®çš„èŠ‚ç‚¹æ˜¯å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå°±å¯ä»¥è¾“å‡ºè¯¥èŠ‚ç‚¹äº†ï¼Œæ³¨æ„æ·»åŠ çš„æ—¶å€™æ˜¯é€†åºæ·»åŠ çš„ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å…ˆè®¿é—®å·¦èŠ‚ç‚¹ï¼Œå†è®¿é—®å³èŠ‚ç‚¹ï¼Œæœ€åè®¿é—®æ ¹èŠ‚ç‚¹\n\n### å±‚æ¬¡éå†\n\n#### é€’å½’å†™æ³•\n\n```java\npublic List<List<Integer>> levelOrder(TreeNode root) {\n    List<List<Integer>> res = new ArrayList<>();\n    helper(res, root, 0);\n    return res;\n}\n\nprivate void helper(List<List<Integer>> res, TreeNode root, int depth) {\n    if (root == null) return;\n    //éœ€è¦å¢åŠ ä¸€å±‚\n    if (res.size() == depth) res.add(new LinkedList<>());\n    res.get(depth).add(root.val);\n    helper(res, root.left, depth + 1);\n    helper(res, root.right, depth + 1);\n}\n```\n\n#### éé€’å½’å†™æ³•\n\nç»å…¸çš„BFS\n\n```java\n//å±‚æ¬¡éå†\npublic void levelorderTravel(){\n    Queue<Node> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        int count=queue.size();\n        while(count>0){\n            Node node=queue.poll();\n            System.out.print(node.e+\" \");\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            count--;\n        }\n    }\n}\n```\n\n> å…¶å®å…³äºå‰ä¸­ååºçš„éå†æ–¹å¼ï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œä¸»è¦è®°å½•çš„æ˜¯` æ¨¡æ¿ `çš„æ€è·¯ï¼Œå…¶å®è¿˜æœ‰ä¸€ç§å¾ˆğŸ‚ğŸºçš„åšæ³•ï¼Œæ¨¡æ‹Ÿç³»ç»Ÿæ ˆçš„æ–¹å¼ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„  [LeetCodeäºŒå‰æ ‘](http://imlgw.top/2019/11/06/leetcode-er-cha-shu-di-gui/#144-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86) è¿™é‡Œå°±ä¸å¤šè§£é‡Šäº†\n\n## å–æ•´\n\n### å‘ä¸‹å–æ•´ï¼ˆfloorï¼‰\n\n```java\npublic E floor(E e){\n    Node node=floor(root,e);\n    return node!=null?node.e:null;\n}\n\npublic Node floor(Node root,E e){\n    if (root==null) {\n        return null;\n    }\n    int temp=e.compareTo(root.e);\n    if (temp==0) {\n        return root;\n    }\n    if (temp<0) { //root.e > e,æ±‚å°äºeçš„å€¼,ä¸€å®šåœ¨å·¦è¾¹\n        return floor(root.left,e);\n    }\n    //tmep>0 e>root.e\n    Node node=floor(root.right,e);\n    return node!=null?node:root;\n}\n```\n### å‘ä¸Šå–æ•´ï¼ˆceilingï¼‰\n\n```java\npublic E ceiling(E e){\n    Node node=ceiling(root,e);\n    return node!=null?node.e:null;\n}\n\npublic Node ceiling(Node root,E e){\n    if (root==null) {\n        return null;\n    }\n    int temp=e.compareTo(root.e);\n    if (temp==0) {\n        return root;\n    }\n    if (temp>0) { //root.e<e,æ±‚çš„æ˜¯æœ€åå¤§äºroot.eçš„å…ƒç´ ,ä¸€å®šåœ¨å³è¾¹\n        return ceiling(root.right,e);\n    }\n    //tmep<0 e<root.e\n    Node node=ceiling(root.left,e);\n    return node!=null?node:root;\n}\n```\nè¿™ä¸¤ä¸ªå‡½æ•°è¿˜æ˜¯æŒºæœ‰ç”¨çš„ï¼Œæ¯”å¦‚è¿™ä¸ªé¢˜ [220-å­˜åœ¨é‡å¤å…ƒç´ -III ](http://imlgw.top/2019/09/15/leetcode-cha-zhao/#220-%E5%AD%98%E5%9C%A8%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0-III) é€šè¿‡ç‡åªæœ‰25%çš„midé¢˜ã€‚ã€‚ã€‚ã€‚\n\n## è·å–ç¬¬Kå¤§\n\nè·å–ç¬¬kå¤§ï¼ˆä»0å¼€å§‹ï¼‰çš„å…ƒç´ ï¼Œå¦‚æœå·¦å­æ ‘èŠ‚ç‚¹æ•°å°äº`k`ï¼Œåˆ™ç¬¬kå¤§çš„å…ƒç´ è‚¯å®šåœ¨å³å­æ ‘ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥æ’é™¤`size(left)+1` ä¸ªå…ƒç´ ï¼ˆåŠ ä¸Šæ ¹èŠ‚ç‚¹ï¼‰ ã€‚\n\nç„¶åç›´æ¥åœ¨ å³å­æ ‘ä¸­ç»§ç»­æœç´¢ `getKth(root.right,k-size(left)-1)`  ï¼Œåªæœ‰å½“å·¦å­æ ‘åˆšå¥½kä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæ ¹èŠ‚ç‚¹å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„`Kth`\n\n```java\npublic E getKth(int k){\n    if (k>=size || k<0) {\n        return null;\n    }\n    return getKth(root,k).e;\n}\n\npublic Node getKth(Node root,int k){\n    if (root==null) {\n        return root;\n    }\n    int temp = childSize(root.left);\n    if (temp>k) {\n        return getKth(root.left,k);\n    }\n    if (temp<k) {\n        return getKth(root.right,k-temp-1);\n    }\n    return root;\n}\n```\n> è¿™é‡Œå…¶å®æˆ‘çš„å®ç°æ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘çš„æ—¶é—´å¤æ‚åº¦æ˜¯`O(NlogN)`ï¼ï¼ï¼ï¼ä¸»è¦æ˜¯`childSize()`æ—¶é—´å¤æ‚åº¦æ˜¯O(N)ä¸æ˜¯O(1)ï¼Œåœ¨ã€Šç®—æ³•4ã€‹ä¸­è¿™ä¸ªå®ç°çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)ï¼Œä¹¦ä¸Šåœ¨å®šä¹‰çš„Nodeçš„æ—¶å€™ç»™NodeåŠ äº†ä¸€ä¸ªcountå±æ€§ï¼Œç”¨æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ï¼Œåœ¨æ¯æ¬¡addå’Œdeleteçš„æ—¶å€™åŠ¨æ€çš„ç»´æŠ¤è¿™ä¸ªcountï¼Œè¿™æ ·æœ€åæ±‚å­èŠ‚ç‚¹æ•°çš„æ“ä½œæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)çš„äº†ï¼Œé‚£ä¸ªç‰ˆæœ¬çš„æˆ‘ä¹Ÿå®ç°äº†ä¸€ä¸‹ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åœ¨è¿™ç¯‡æ–‡ç« ä¸­è¿™æ ·å†™ï¼ˆä¸»è¦æ˜¯æ‡’å¾—æ”¹ï¼‰ï¼Œè€Œä¸”è¿™ä¹Ÿä¸æ˜¯é‡ç‚¹ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹ [BSTWithCount](https://github.com/imlgw/LeetCode/blob/master/tree/BSTWithCount.java) ä¸»è¦å°±æ˜¯è¦**æ³¨æ„æ“ä½œcountçš„æ—¶æœº**\n>\nè¿™é‡Œæ—¢ç„¶æ²¡æœ‰countæ•°ç»„ï¼Œé‚£ä¹ˆå…¶å®å°±ä¸åº”è¯¥è¿™æ ·æ±‚ï¼Œåº”è¯¥ç›´æ¥ä¸­åºéå†ï¼Œæ±‚ç¬¬Kå¤§ï¼Œæ—¶é—´å¤æ‚åº¦O(N)\n\n## Rank()\n\nå…¶å®æ˜¯ä¸Šé¢çš„é€†è¿‡ç¨‹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ç­‰äºkeyï¼Œé‚£ä¹ˆç›´æ¥è¿”å›å·¦å­æ ‘çš„é”®æ€»æ•°ï¼›å¦‚æœkeyå°äºæ ¹èŠ‚ç‚¹ï¼Œå°±ç»§ç»­å»å·¦å­æ ‘ä¸­é€’å½’æ‰¾ï¼Œå¦‚æœå¤§äºæ ¹èŠ‚ç‚¹ï¼Œè¿”å›`size(left)+1`åŠ ä¸Šå®ƒåœ¨å³å­æ ‘ä¸­çš„`rank()`\n\n```java\npublic int getRank(E e){\n    return getRank(root,e);\n}\n\npublic int getRank(Node root,E e){\n    if (e.compareTo(root.e)<0) { //e<root.e\n        return getRank(root.left,e);\n    }\n    if (e.compareTo(root.e)>0) {\n        return getRank(root.right,e)+childSize(root.left)+1;\n    }\n    return childSize(root.left);\n}\n```\n## Max&Min\n\næ²¡å•¥å¥½è¯´çš„\n\n```java\n//æ±‚æœ€å¤§å€¼,é€’å½’æ¯”è¾ƒä¼˜é›…\npublic E getMax(){\n    return getMax(root).e;\n}\n\npublic Node getMax(Node root){\n    if (root.right==null) {\n        return root;\n    }\n    return getMax(root.right);\n}\n\n//æ±‚æœ€å°å€¼\npublic E getMin(){\n    return getMin(root).e;\n}\n\npublic Node getMin(Node root){\n    if (root.left==null) {\n        return root;\n    }\n    return getMin(root.left);\n}\n```\n## åˆ é™¤\n\nåˆ é™¤åº”è¯¥æ¥è¯´æ˜¯BSTä¸­é‡Œé¢æ¯”è¾ƒå¤æ‚çš„ä¸€ä¸ªæ“ä½œäº†ï¼Œæˆ‘ä»¬å…ˆä»ç®€å•çš„å¼€å§‹\n\n### åˆ é™¤æœ€å€¼\n\n```java\n//åˆ é™¤æœ€å°çš„é”®\npublic void deleteMin(){\n    root=deleteMin(root);\n}\n//åˆ é™¤nodeä¸ºå¤´èŠ‚ç‚¹çš„æ ‘ä¸­çš„æœ€å°å€¼ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹\nprivate Node deleteMin(Node node){\n    if (node.left==null) {\n        return node.right;\n    }\n    node.left=deleteMin(node.left);\n    return node;\n}\n\n//åˆ é™¤æœ€å¤§çš„é”®\npublic void deleteMax(){\n    root=deleteMax(root);\n}\n\nprivate Node deleteMax(Node node){\n    if (node.right==null) {\n        return node.left;\n    }\n    node.right=deleteMax(node.right);\n    return node;\n}\n```\né€’å½’å‡½æ•°å®šä¹‰ä¸º**åˆ é™¤nodeä¸ºå¤´èŠ‚ç‚¹çš„æ ‘ä¸­çš„æœ€å°å€¼ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹**ï¼Œåˆ é™¤æœ€å°å€¼å®é™…ä¸Šå°±æ˜¯åˆ é™¤äºŒå‰æ ‘æœ€å·¦è¾¹çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬é€’å½’çš„åˆ é™¤node.leftå°±okï¼Œå½“node.leftä¸ºç©ºçš„æ—¶å€™è¿”å›node.rightï¼Œè¿™æ ·å‰é¢èŠ‚ç‚¹çš„leftå°±æ¥åœ¨äº†node.rightä¸Šï¼Œå°±è¾¾åˆ°äº†åˆ é™¤çš„ä½œç”¨\n\n### åˆ é™¤ä»»æ„å€¼\n\n```java\n//åˆ é™¤ä»»æ„çš„é”®\npublic void delete(E e){\n    root=delete(root,e);\n}\n\n//åˆ é™¤ä»¥nodeä¸ºé¦–çš„BSTä¸­,å€¼ä¸ºeçš„èŠ‚ç‚¹å¹¶ä¸”è¿”å›æ ¹èŠ‚ç‚¹\nprivate Node delete(Node node,E e){\n    if (node==null) {\n        return null;\n    }\n    if (e.compareTo(node.e)>0) { //e>root.e\n        node.right=delete(node.right,e);\n    }else if (e.compareTo(node.e)<0) {\n        node.left=delete(node.left,e);\n    }else{ //e==root.e\n        if (node.left==null) { //å¦‚æœæ²¡æœ‰å·¦å­æ ‘å°±è¿”å›å³å­æ ‘\n            return node.right;\n        }\n        if (node.right==null) { //å¦‚æœæ²¡æœ‰å³å­æ ‘å°±è¿”å›å·¦å­æ ‘\n            return node.left;\n        }\n        Node delNode=node;\n        //æœ‰å·¦å³å­èŠ‚ç‚¹éƒ½æœ‰\n        node=getMin(node.right); //ç”¨å³å­æ ‘çš„æœ€å°å€¼å¡«è¡¥åˆ é™¤çš„å…ƒç´ çš„ç©ºä½\n        //åˆ é™¤å¯¹åº”çš„å³å­æ ‘çš„æœ€å°å€¼,ç„¶åè¿æ¥èµ·æ¥\n        node.right=deleteMin(delNode.right);\n        node.left=delNode.left;\n    }\n    return node;\n}\n```\nè¿™é‡Œæ–‡å­—çš„æè¿°æ¯”è¾ƒæ— åŠ›ï¼Œç”»ä¸ªå›¾å°±æ¸…æ™°æ˜ç™½äº†ï¼Œæ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯åˆ©ç”¨å³å­æ ‘ä¸­çš„æœ€å°å€¼å¡«è¡¥å¾…åˆ é™¤èŠ‚ç‚¹\n\n![mark](http://static.imlgw.top/blog/20191113/yyI0q2yftm0X.png?imageslim)\n\nå½“ç„¶è¿™é‡Œå…¶å®ä¹Ÿæ˜¯æœ‰å‘çš„ï¼Œä¸»è¦å°±æ˜¯è¿æœ€åä¸¤å¥\n\n```java\n//åˆ é™¤å¯¹åº”çš„å³å­æ ‘çš„æœ€å°å€¼,ç„¶åè¿æ¥èµ·æ¥\nnode.right=deleteMin(delNode.right);\nnode.left=delNode.left;\n```\nè¿™é‡Œçš„ä¸¤å¥è¯æ˜¯ä¸èƒ½äº¤æ¢çš„ï¼Œå¦‚æœæˆ‘ä»¬äº¤æ¢äº†ä¸¤å¥è¯çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸‹ä¸€æ­¥åˆ é™¤æœ€å°å€¼å°±ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯åˆ é™¤å³å­æ ‘ä¸­æœ€å°çš„nodeèŠ‚ç‚¹ï¼Œç»“æœä½ å…ˆæŠŠå¾…åˆ é™¤èŠ‚ç‚¹çš„leftæ¥åˆ°äº†nodeçš„å·¦è¾¹ï¼Œè¿™æ ·çš„è¯nodeå°±ä¸å†æ˜¯delNode.rightä¸­çš„æœ€å°å€¼ï¼Œæœ€åç»“æœå¯èƒ½å°±ä¼šæˆè¿™ä¸ªæ ·å­ï¼Œæˆäº†ä¸€ä¸ªé—­ç¯ï¼ï¼ï¼\n\n![mark](http://static.imlgw.top/blog/20191113/qc5kHljj03uq.png?imageslim)\n\næ‰€ä»¥æœ€åçš„ç»“æœè‚¯å®šæ˜¯ä¸å¯¹çš„ï¼Œå…¶å®è¿™ä¸€ç‚¹ä¹¦ä¸Šå¹¶æ²¡æœ‰æåˆ°ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨åšè¿™é“é¢˜[åˆ é™¤èŠ‚ç‚¹](https://leetcode-cn.com/problems/delete-node-in-a-bst/) çš„æ—¶å€™å†™åäº†ï¼Œæ‰å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»è¯•è¯•\n\n> å…¶å®è¿™æ ·çš„åˆ é™¤æ—¶ä¸€ç§å¾ˆéšæœºçš„åšæ³•ï¼Œè™½ç„¶èƒ½æ­£ç¡®çš„åˆ é™¤å…ƒç´ ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è€ƒè™‘æ ‘çš„å¯¹ç§°æ€§ï¼Œå…³äºæ ‘çš„å¯¹ç§°æ€§ï¼Œæˆ‘ä»¬åé¢å†æ¥ç ”ç©¶\n\n## ä»£ç åœ°å€\n\n[BST.java](https://github.com/imlgw/LeetCode/blob/master/tree/BST.java)\n\n[BSTTest.java](https://github.com/imlgw/LeetCode/blob/master/tree/BSTTest.java)\n\n[BSTWithCount.java](https://github.com/imlgw/LeetCode/blob/master/tree/BSTWithCount.java)\n\n","tags":["æ•°æ®ç»“æ„","æ ‘"],"categories":["æ•°æ®ç»“æ„"]},{"title":"LeetCodeäºŒå‰æ ‘","url":"/2019/11/06/leetcode-er-cha-shu/","content":"\n## _LeetCode äºŒå‰æ ‘_\n\n> å–„ç”¨**ctrl+f**\n\n## [144. äºŒå‰æ ‘çš„å‰åºéå†](https://leetcode-cn.com/problems/binary-tree-preorder-traversal/)\n\nGiven a binary tree, return the *preorder* traversal of its nodes' values.\n\n**Example:**\n\n```java\nInput: [1,null,2,3]\n   1\n    \\\n     2\n    /\n   3\n\nOutput: [1,2,3]\n```\n\n**Follow up:** Recursive solution is trivial, could you do it iteratively?\n\n**è§£æ³•ä¸€**\n\né€’å½’ï¼Œæ²¡å•¥å¥½è¯´çš„\n\n```java\nprivate List<Integer> res=new ArrayList<>();\n\npublic List<Integer> preorderTraversal(TreeNode root) {\n    if(root!=null){\n        res.add(root.val);\n        preorderTraversal(root.left);\n        preorderTraversal(root.right);\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\næ•™ç§‘ä¹¦ä¸Šçš„å†™æ³•ï¼Œç»å…¸çš„å‰åºéå†éé€’å½’å®ç°æ–¹å¼\n\n```java\npublic List<Integer> preorderTraversal(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    if (root==null) return res;\n    Stack<TreeNode> stack=new Stack<>();\n    stack.push(root);\n    while(!stack.isEmpty()){\n        TreeNode top=stack.pop();\n        res.add(top.val);\n        //æ³¨æ„é¡ºåº\n        if (top.right!=null) {\n            stack.push(top.right);\n        }\n        if (top.left!=null) {\n            stack.push(top.left);\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•ä¸‰**\n\néé€’å½’ï¼Œæ¨¡æ‹Ÿé€’å½’æ ˆçš„æ–¹å¼ï¼Œè®°å½•èŠ‚ç‚¹ä»¥åŠæ˜¯å¦éœ€è¦ç»§ç»­å¯»æ‰¾å­èŠ‚ç‚¹\n\n```java\npublic List<Integer> preorderTraversal(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    if (root==null) return res;\n    Stack<Command> stack=new Stack<>();\n    stack.push(new Command(true,root));\n    while(!stack.isEmpty()){\n        Command command=stack.pop();\n        if (!command.isGo) {\n            res.add(command.node.val);\n        }else{\n            TreeNode node=command.node;\n            //é€†åºè¿›æ ˆ\n            if (node.right!=null) {\n                stack.push(new Command(true,node.right));\n            }\n            if (node.left!=null) {\n                stack.push(new Command(true,node.left));\n            }    \n            stack.push(new Command(false,node));\n        }\n    }\n    return res;\n}\n\nstatic class Command{\n    boolean  isGo; //æ˜¯å¦ç»§ç»­å¯»æ‰¾å­èŠ‚ç‚¹\n    TreeNode node; //å½“å‰èŠ‚ç‚¹\n    public Command(boolean isGo,TreeNode node){\n        this.isGo=isGo;\n        this.node=node;\n    }\n}\n```\nboboè€å¸ˆçš„ä¸€ç§æ€è·¯ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“å¦™äº†ğŸ‘ï¼Œä¸€ä¸‹å°±è§£å†³äº†ä¸‰ç§éå†çš„éé€’å½’å®ç°ï¼Œå¦å¤–ä¸¤ç§åªéœ€è¦è°ƒæ•´ä¸€ä¸‹è¿›æ ˆçš„é¡ºåºå°±å¯ä»¥äº†ï¼\n\n**è§£æ³•å››**\n\næ‰¾åˆ°ä¸€ä¸ªæ¿å­ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³ä¸‰ç§éå†\n\n```java\n//ç»å…¸çš„éé€’å½’å®ç°æ–¹å¼\npublic List<Integer> preorderTraversal4(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    if (root==null) return res;\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root;\n    while(cur!=null||!stack.isEmpty()){\n        while (cur!=null) {\n            res.add(cur.val);\n            stack.push(cur);\n            cur=cur.left;\n        }\n        //æ²¡æœ‰å·¦å­æ ‘äº†\n        cur=stack.pop();\n        //åˆ‡æ¢ä¸ºå³å­æ ‘\n        cur=cur.right;\n        \n    }\n    return res;\n}\n```\n> å…³äº `while(cur!=null||!stack.isEmpty())`ï¼Œå…¶å®æ ˆä¸­å­˜çš„åªæ˜¯æŸä¸€ä¸ªæ ¹èŠ‚ç‚¹çš„æ‰€æœ‰å·¦å­æ ‘ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ ˆä¸ºç©ºä¸ä»£è¡¨å·²ç»éå†å®Œæ‰€æœ‰èŠ‚ç‚¹äº†ï¼Œåªèƒ½ä»£è¡¨å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘éƒ½éå†å®Œäº†ï¼Œè¿˜æœ‰å³å­æ ‘è¿˜æ²¡éå†ï¼Œåªæœ‰å½“å³å­æ ‘ä¹Ÿä¸ºç©ºä¹Ÿå°±æ˜¯`cur==null` çš„æ—¶å€™æ‰æ˜¯éå†å®Œäº†ï¼Œå…·ä½“çœ‹ä¸€ä¸‹ä¸‹é¢è¿™é¢—æ ‘å°±æ˜ç™½äº†\n>\n> ```java\n>       5\n>      / \\\n>     4    6 \n>   /      \\\n> 3       8\n> ```\n>\n> \n\n## [589. Nå‰æ ‘çš„å‰åºéå†](https://leetcode-cn.com/problems/n-ary-tree-preorder-traversal/)\n\nç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„*å‰åºéå†*ã€‚\n\nä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª `3å‰æ ‘` :\n\n![MWwEt0.png](https://s2.ax1x.com/2019/11/20/MWwEt0.png)\n\nè¿”å›å…¶å‰åºéå†: `[1,3,5,6,2,4]`ã€‚\n\n**è¯´æ˜:** é€’å½’æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿­ä»£æ³•å®Œæˆæ­¤é¢˜å—?\n\n**è§£æ³•ä¸€**\n\né€’å½’æ²¡å•¥å¥½è¯´çš„\n\n```java\n//é€’å½’çš„æ–¹å¼\nList<Integer> res=new LinkedList<>();\n\npublic List<Integer> preorder(Node root) {\n    dfs(root);\n    return res;\n}\n\npublic void dfs(Node root) {\n    if (root==null) {\n        return;\n    }\n    List<Node> children=root.children;\n    res.add(root.val);\n    for (Node node:children) {\n        preorder(node);\n    }\n}\n```\n**è§£æ³•äºŒ**\n\nè¿­ä»£çš„æ–¹å¼\n\n```java\npublic List<Integer> preorder(Node root) {\n    List<Integer> res=new LinkedList<>();\n    if (root==null) {\n        return res;\n    }\n    Stack<Node> stack=new Stack<>();\n    stack.add(root);\n    while(!stack.isEmpty()){\n        Node node=stack.pop();\n        res.add(node.val);\n        List<Node> children=node.children;\n        //é€†åºæ·»åŠ \n        for (int i=children.size()-1;i>=0;i--) {\n            stack.add(children.get(i));\n        }\n    }\n    return res;\n}\n```\nåˆ°è¿™é‡Œæˆ‘æ˜¯çœŸçš„å¯¹éå†çš„é‚£ä¸ªæ¿å­æ— æ„Ÿäº†ï¼Œè¿™é‡Œæˆ‘å¼€å§‹æƒ³ç”¨æ¿å­å†™ï¼Œç»“æœå‘ç°å¹¶ä¸å¥½å†™ï¼Œæ— ä»ä¸‹æ‰‹ï¼ˆå¯èƒ½æ˜¯æˆ‘å¤ªèœï¼‰ï¼Œæ‰€ä»¥é‡‡ç”¨äº†ç»å…¸çš„å‰åºéå†æ–¹å¼ï¼Œæœç„¶ç»å…¸å°±æ˜¯ç»å…¸ï¼Œé€šç”¨æ€§å¾ˆå¼ºï¼Œè€Œä¸”ç›¸å½“å¥½ç†è§£ï¼Œæ‰€ä»¥ä»¥åé‡åˆ°éå†çš„é¢˜ç›®ï¼Œå°½é‡è¿˜æ˜¯è‡ªå·±å†™ï¼Œåˆ«å¥—æ¿å­ï¼ˆå¯¹ååºçš„æ¿å­ä¹Ÿä¸€ç›´ä¸æ˜¯ç‰¹åˆ«ç†è§£ï¼Œæ‰€ä»¥ä¹Ÿä¸€ç›´æ²¡è®°ä½ï¼Œå¥—æ¿å­è¿˜æ˜¯è¦å»ºç«‹åœ¨ç†è§£çš„åŸºç¡€ä¸Šå•Šï¼Œä¸ç„¶æ°¸è¿œä¸ä¼šåšï¼ï¼‰\n\n## [94. äºŒå‰æ ‘çš„ä¸­åºéå†](https://leetcode-cn.com/problems/binary-tree-inorder-traversal/)\n\nGiven a binary tree, return the *inorder* traversal of its nodes' values.\n\n**Example:**\n\n```java\nInput: [1,null,2,3]\n   1\n    \\\n     2\n    /\n   3\n\nOutput: [1,3,2]\n```\n\n**Follow up:** Recursive solution is trivial, could you do it iteratively?\n\n**è§£æ³•ä¸€**\n\né€’å½’çš„æ–¹å¼å’Œæ¨¡æ‹Ÿæ ˆçš„æ–¹å¼å°±ä¸è®°å½•äº†ï¼Œé‡ç‚¹çœ‹ä¸€ä¸‹è¿™ä¸ªæ¿å­\n\n```java\n//ç»å…¸çš„éé€’å½’å®ç°æ–¹å¼\npublic List<Integer> inorderTraversal3(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    if (root==null) return res;\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root;\n    while(cur!=null||!stack.isEmpty()){\n        while (cur!=null) {\n            stack.push(cur);\n            cur=cur.left;\n        }\n        //æ²¡æœ‰å·¦å­æ ‘äº†\n        cur=stack.pop();\n        //å°†å½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°resä¸­\n        res.add(cur.val);\n        //åˆ‡æ¢ä¸ºå³å­æ ‘\n        cur=cur.right;\n    }\n    return res;\n}\n```\n## [145. äºŒå‰æ ‘çš„ååºéå†](https://leetcode-cn.com/problems/binary-tree-postorder-traversal/)\n\nGiven a binary tree, return the *postorder* traversal of its nodes' values.\n\n**Example:**\n\n```java\nInput: [1,null,2,3]\n   1\n    \\\n     2\n    /\n   3\n\nOutput: [3,2,1]\n```\n\n**Follow up:** Recursive solution is trivial, could you do it iteratively?\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜æ˜¯ä¸ªhardé¢˜ï¼Œæ²¡é‚£ä¹ˆå®¹æ˜“ï¼ˆä¸è¿‡æ ¹æ®boboè€å¸ˆçš„æ–¹å¼æ¥åšç¡®å®ç®€å•ğŸ˜‚ï¼‰\n\n```java\npublic List<Integer> postorderTraversal3(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    if (root==null) return res;\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root,lastNode=null; //lastNodeä¸ºä¸Šä¸€æ¬¡è®¿é—®çš„èŠ‚ç‚¹\n    while(cur!=null||!stack.isEmpty()){\n        while (cur!=null) {\n            stack.push(cur);\n            cur=cur.left;\n        }\n        //æ²¡æœ‰å·¦å­æ ‘äº†,æŠŠåä¸€ä¸ªå·¦èŠ‚ç‚¹æ‹¿å‡ºæ¥\n        cur=stack.peek();\n        //å¦‚æœæ²¡æœ‰å³èŠ‚ç‚¹,æˆ–è€…å³èŠ‚ç‚¹è®¿é—®è¿‡äº†\n        if (cur.right==null||cur.right==lastNode) {\n            //æ·»åŠ èŠ‚ç‚¹\n            res.add(cur.val);\n            //è®°å½•å½“å‰èŠ‚ç‚¹ä¸ºlastNode\n            lastNode=cur;\n            //å°†ä»–popå‡ºå»\n            stack.pop();\n            //èŠ‚ç‚¹å·²ç»å¼¹å‡º\n            //æŒ‡å‘null,ä¸ç„¶å°±æ­»å¾ªç¯äº†\n            cur=null;\n        }else{\n            //å³èŠ‚ç‚¹ä¸ä¸ºç©º,å¹¶ä¸”æ²¡è®¿é—®è¿‡\n            //åˆ‡æ¢ä¸ºå³å­æ ‘,é‡å¤ä¸Šé¢çš„æ­¥éª¤\n            cur=cur.right;\n        }\n        \n    }\n    return res;\n}\n```\nè¿™ç§é¢˜ä¸€å®šè¦è®°ä½ \"æ‹›å¼\"ï¼Œä¹±å†™åªä¼šè¶Šå†™è¶Šä¹±\n\n**è§£æ³•äºŒ**\n\nè¿™ç§è§£æ³•ä¼¼ä¹æ›´åŠ å®¹æ˜“ç†è§£ï¼ï¼ï¼\n\n```java\npublic List<Integer> postorderTraversals(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    if (root==null) return res;\n    Stack<TreeNode> stack=new Stack<>();\n    stack.push(root);\n    TreeNode lastNode=null;\n    while(!stack.isEmpty()){\n        TreeNode cur=stack.peek();\n        if ((cur.left==null && cur.right ==null) || (lastNode!=null &&( cur.left==lastNode || cur.right==lastNode))) {\n            stack.pop();\n            res.add(cur.val);\n            lastNode=cur;\n        }else{\n            if (cur.right!=null) {\n                stack.push(cur.right);\n            }\n            if (cur.left!=null) {\n                stack.push(cur.left);\n            }\n        }\n    }\n    return res;\n}\n```\n## [590. Nå‰æ ‘çš„ååºéå†](https://leetcode-cn.com/problems/n-ary-tree-postorder-traversal/)\n\nç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„*ååºéå†*ã€‚\n\nä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª `3å‰æ ‘` :\n\n![NTree](https://i.loli.net/2019/12/01/KAQP9UNfV5bau7J.png)\n\nè¿”å›å…¶ååºéå†: `[5,6,3,2,4,1]`.\n\n**è¯´æ˜:** é€’å½’æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿­ä»£æ³•å®Œæˆæ­¤é¢˜å—?\n\n**è§£æ³•ä¸€**\n\né€’å½’çš„è§£æ³•ï¼Œæ²¡å•¥å¥½è¯´çš„\n\n```java\nList<Integer> res=new LinkedList<>();\n\npublic List<Integer> postorder(Node root) {\n    if (root==null) {\n        return res;\n    }\n    dfs(root);\n    return res;\n}\n\npublic void dfs(Node root) {\n    List<Node> children=root.children;\n    for (Node node:children) {\n        dfs(node);\n    }\n    res.add(root.val);\n}\n```\n\n**è§£æ³•äºŒ**\n\né”äº†ï¼è¿™æ‰æ˜¯æ ‘éå†çš„æ¿å­\n\n```java\npublic List<Integer> postorder(Node root) {\n    List<Integer> res=new LinkedList<>();\n    if (root==null) {\n        return res;\n    }\n    Stack<Node> stack=new Stack<>();\n    stack.push(root);\n    Node lastNode=null;\n    while(!stack.isEmpty()){\n        Node node=stack.peek();\n        List<Node> children=node.children;\n        if (children.isEmpty() || (lastNode!=null && lastNode == children.get(children.size()-1))) {\n            res.add(node.val);\n            stack.pop();\n            lastNode=node;\n        }else{\n            for (int i=children.size()-1;i>=0;i--) {\n                stack.push(children.get(i));\n            }\n        }\n    }\n    return res;\n}\n```\n\nè¿™é¢˜å¼€å§‹å› ä¸ºä¸€ä¸ªç©ºçš„caseæŠŠæˆ‘ææ™•äº†ï¼Œæäº†åŠå¤©æ‰å‘ç°\n\n## [102. äºŒå‰æ ‘çš„å±‚æ¬¡éå†](https://leetcode-cn.com/problems/binary-tree-level-order-traversal/)\n\nGiven a binary tree, return the *level order* traversal of its nodes' values. (ie, from left to right, level by level).\n\nFor example:\nGiven binary tree `[3,9,20,null,null,15,7]`,\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\nreturn its level order traversal as:\n\n```java\n[\n  [3],\n  [9,20],\n  [15,7]\n]\n```\n\n**è§£æ³•ä¸€**\n\nBFSï¼Œåˆ©ç”¨é˜Ÿåˆ—\n\n```java\npublic List<List<Integer>> levelOrder(TreeNode root) {\n    List<List<Integer>> res=new ArrayList<>();\n    if (root==null)return res;\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        //countä»£è¡¨çš„å…¶å®å°±æ˜¯æ¯ä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°\n        int count=queue.size();\n        List<Integer> list=new ArrayList<>();\n        while(count>0){\n            //å–å‡ºå½“å‰èŠ‚ç‚¹,å¹¶å°†å…¶å·¦å³å­èŠ‚ç‚¹å…¥é˜Ÿåˆ—\n            TreeNode node=queue.poll();\n            list.add(node.val);\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            count--;\n        }\n        res.add(list);\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\né€’å½’DFSï¼Œè¿™ç§å…¶å®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¯ä»¥çœ‹ä¸‹\n\n```java\npublic List<List<Integer>> levelOrder(TreeNode root) {\n    List<List<Integer>> res = new ArrayList<>();\n    helper(res, root, 0);\n    return res;\n}\n\nprivate void helper(List<List<Integer>> res, TreeNode root, int depth) {\n    if (root == null) return;\n    //éœ€è¦å¢åŠ ä¸€å±‚\n    if (res.size() == depth) res.add(new LinkedList<>());\n    res.get(depth).add(root.val);\n    helper(res, root.left, depth + 1);\n    helper(res, root.right, depth + 1);\n}\n```\n## [429. Nå‰æ ‘çš„å±‚åºéå†](https://leetcode-cn.com/problems/n-ary-tree-level-order-traversal/)\n\nç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„*å±‚åºéå†*ã€‚ (å³ä»å·¦åˆ°å³ï¼Œé€å±‚éå†)ã€‚\n\nä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª `3å‰æ ‘` :\n\n![NTee](https://i.loli.net/2019/12/01/He8KVlms1jynbvr.png)\n\n\n\nè¿”å›å…¶å±‚åºéå†:\n\n```java\n[\n     [1],\n     [3,2,4],\n     [5,6]\n]\n```\n\n**è¯´æ˜:**\n\n1. æ ‘çš„æ·±åº¦ä¸ä¼šè¶…è¿‡ `1000`ã€‚\n2. æ ‘çš„èŠ‚ç‚¹æ€»æ•°ä¸ä¼šè¶…è¿‡ `5000`ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic List<List<Integer>> levelOrder(Node root) {\n    List<List<Integer>> res=new LinkedList<>();\n    if (root==null) {\n        return res;\n    }\n    Queue<Node> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        int count=queue.size();\n        List<Integer> temp=new LinkedList<>();\n        while(count>0){\n            Node node=queue.poll();\n            temp.add(node.val);\n            for (Node child:node.children) {\n                queue.add(child);\n            }\n            count--;\n        }\n        if (!temp.isEmpty()) {\n            res.add(temp);   \n        }\n    }\n    return res;\n}\n```\n## [107. äºŒå‰æ ‘çš„å±‚æ¬¡éå† II](https://leetcode-cn.com/problems/binary-tree-level-order-traversal-ii/)\n\nGiven a binary tree, return the *bottom-up level order* traversal of its nodes' values. (ie, from left to right, level by level from leaf to root).\n\nFor example:\nGiven binary tree `[3,9,20,null,null,15,7]`,\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\n\n\nreturn its bottom-up level order traversal as:\n\n```java\n[\n  [15,7],\n  [9,20],\n  [3]\n]\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic List<List<Integer>> levelOrderBottom(TreeNode root) {\n    List<List<Integer>> res=new ArrayList<>();\n    if(root==null)return res;\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        List<Integer> list=new ArrayList<>();\n        int count=queue.size();\n        while(count>0){\n            TreeNode top=queue.poll();\n            if (top.left!=null) {\n                queue.add(top.left);\n            }\n            if (top.right!=null) {\n                queue.add(top.right);\n            }\n            list.add(top.val);\n            count--;\n        }\n        //ä»å¤´æ·»åŠ \n        res.add(0,list);\n    }\n    return res;\n}\n```\nä¸»è¦æ˜¯å¤ä¹ ä¸‹å±‚æ¬¡éå†ï¼Œç›¸æ¯”ä¸Šé¢å°±å¤šäº† `res.add(0,list)` ä»å¤´éƒ¨æ·»åŠ \n\n## [103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚æ¬¡éå†](https://leetcode-cn.com/problems/binary-tree-zigzag-level-order-traversal/)\n\nGiven a binary tree, return the *zigzag level order* traversal of its nodes' values. (ie, from left to right, then right to left for the next level and alternate between).\n\nFor example:\nGiven binary tree `[3,9,20,null,null,15,7]`,\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\nreturn its zigzag level order traversal as:\n\n```java\n[\n  [3],\n  [20,9],\n  [15,7]\n]\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic List<List<Integer>> zigzagLevelOrder(TreeNode root) {\n    List<List<Integer>> res=new ArrayList<>();\n    if(root==null)return res;\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    boolean reverse=false;\n    while(!queue.isEmpty()){\n        LinkedList<Integer> list=new LinkedList<>();\n        int count=queue.size();\n        while(count>0){\n            TreeNode node=queue.poll();\n            if (reverse) {\n                //ä»å¤´æ·»åŠ ï¼Œç›¸å½“äºé€†åºäº†\n                list.addFirst(node.val);\n            }else{\n                list.add(node.val);\n            }\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            count--;\n        }\n        reverse=!reverse;\n        res.add(list);\n    }\n    return res;\n}\n```\nå’Œä¸Šé¢ä¸€é¢˜ä¸€æ ·ï¼Œè€æƒ³ç€æ€ä¹ˆå»æŒ‰ç…§é¢˜ç›®çš„è¦æ±‚å»éå†èŠ‚ç‚¹ï¼Œå“ï¼Œå¤ªè ¢äº†ï¼Œçµæ´»ä¸€ç‚¹å•Š\n\n## [199. äºŒå‰æ ‘çš„å³è§†å›¾](https://leetcode-cn.com/problems/binary-tree-right-side-view/)\n\nç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [1,2,3,null,5,null,4]\nè¾“å‡º: [1, 3, 4]\nè§£é‡Š:\n\n   1            <---\n /   \\\n2     3         <---\n \\     \\\n  5     4       <---\n```\n\n**è§£æ³•ä¸€**\n\nè¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸€ä¸Šåˆåšäº†ä¸‰é“ä¸€æ ·çš„é¢˜ï¼Œè¿™é¢˜å¸å–äº†ä¸Šé¢çš„æ•™è®­æ²¡æœ‰å»æƒ³æ€ä¹ˆéå†äº†\n\n```java\npublic List<Integer> rightSideView(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    if(root==null) return res;\n    LinkedList<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        int count=queue.size();\n        while(count>0){\n            TreeNode node=queue.poll();\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            //å–æ¯ä¸€å±‚æœ€åä¸€ä¸ªèŠ‚ç‚¹\n            if (count==1) {\n                res.add(node.val);\n            }\n            count--;\n        }\n    }\n    return  res;\n}\n```\nåªè®°å½•æ¯ä¸€å±‚æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åå¾—åˆ°çš„å°±æ˜¯å³è§†å›¾\n\n**è§£æ³•äºŒ**\n\ndfsï¼Œå…¶å®å°±æ˜¯ä¸€ç›´å‘å³èµ°ï¼Œèµ°ä¸åŠ¨å°±å‘å·¦èµ°ï¼Œè¿™æ ·éå†çš„è½¨è¿¹å°±æ˜¯æ²¿ç€äºŒå‰æ ‘çš„å³è¾¹ç¼˜å‘ä¸‹çš„ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•å±‚æ•°ï¼Œç„¶åå½“å±‚æ•°å’Œresæ•°é‡ç›¸ç­‰çš„æ—¶å€™è®°å½•ç»“æœå°±è¡Œäº†ï¼ˆçœ‹è§å¤´æ¡é¢è¯•è¦æ±‚å†™logNç©ºé—´çš„ï¼Œåº”è¯¥å°±æ˜¯è¿™ç§è§£æ³•äº†ï¼Œä½†æ˜¯ä¸‹é¢çš„è§£æ³•ç©ºé—´å¤æ‚åº¦åº”è¯¥è¿˜æ˜¯O(N)çš„ï¼Œæœ€åæƒ…å†µä¸‹å½¢æˆä¸€é“¾è¡¨å°±æˆNäº†ï¼Œä¸è¿‡ç›¸æ¯”ä¸Šé¢å±‚æ¬¡éå†æ°¸è¿œæ˜¯Nçš„åšæ³•è¿˜æ˜¯è¦å¥½ä¸€ç‚¹ï¼‰\n\n```go\nfunc rightSideView(root *TreeNode) []int {\n    var dfs func(root *TreeNode, depth int)\n    var res = make([]int, 0)\n    dfs = func(root *TreeNode, depth int) {\n        if root == nil {\n            return\n        }\n        if depth > len(res) {\n            res = append(res, root.Val)\n        }\n        dfs(root.Right, depth+1)\n        dfs(root.Left, depth+1)\n    }\n    dfs(root, 1)\n    return res\n}\n```\n\n\n\n## [637. äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼](https://leetcode-cn.com/problems/average-of-levels-in-binary-tree/) \n\nç»™å®šä¸€ä¸ªéç©ºäºŒå‰æ ‘, è¿”å›ä¸€ä¸ªç”±æ¯å±‚èŠ‚ç‚¹å¹³å‡å€¼ç»„æˆçš„æ•°ç»„.\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\nè¾“å‡º: [3, 14.5, 11]\nè§£é‡Š:\nç¬¬0å±‚çš„å¹³å‡å€¼æ˜¯ 3,  ç¬¬1å±‚æ˜¯ 14.5, ç¬¬2å±‚æ˜¯ 11. å› æ­¤è¿”å› [3, 14.5, 11].\n```\n\n\n**æ³¨æ„ï¼š**\n\n1. èŠ‚ç‚¹å€¼çš„èŒƒå›´åœ¨32ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´å†…ã€‚\n\n**è§£æ³•ä¸€**\n\nä¸€ç™¾éå•Šä¸€ç™¾éï¼Œè¿™åº”è¯¥å±äºæ ‘ç±»å‹é¢˜çš„HelloWorldå§ ~ \n\n```java\npublic List<Double> averageOfLevels(TreeNode root) {\n    if (root==null) {\n        return new LinkedList<>();\n    }\n    Queue<TreeNode> queue=new LinkedList<>();\n    List<Double> res=new ArrayList<>();\n    queue.add(root);\n    while (!queue.isEmpty()) {\n        int size=queue.size();\n        int temp=size;\n        double average=0;\n        while(size-->0){\n            TreeNode cur=queue.poll();\n            average+=cur.val;\n            if (cur.left!=null) {\n                queue.add(cur.left);\n            }\n            if (cur.right!=null) {\n                queue.add(cur.right);\n            }\n        }\n        average/=temp;\n        res.add(average);\n    }\n    return res;\n}\n```\n## [104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦](https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚\n\näºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚\n\n**è¯´æ˜:** å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ï¼š**\nç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\n\nè¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚\n\n**è§£æ³•ä¸€**\n\né€’å½’è§£æ³•ï¼Œå¾ˆç®€æ´\n\n```java\n//maxDepth(root)=1+max(maxDepth(root.left),maxDepth(root.right));\npublic int maxDepth(TreeNode root) {\n    if(root==null){\n        return 0;\n    }\n    int maxLeft=maxDepth(root.left);\n    int maxRight=maxDepth(root.right);\n    return (maxLeft>maxRight?maxLeft:maxRight)+1;\n}\n```\n**è§£æ³•äºŒ**\n\nBFSï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢\n\n```java\npublic int maxDepth(TreeNode root) {\n    if (root==null) return 0;\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    int max=0;//æ³¨æ„åˆå§‹å€¼\n    while(!queue.isEmpty()){\n        int count=queue.size();\n        while(count>0){\n            TreeNode node=queue.poll();\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            count--;\n        }\n        max++;\n    }\n    return max;\n}\n```\n## [559. Nå‰æ ‘çš„æœ€å¤§æ·±åº¦](https://leetcode-cn.com/problems/maximum-depth-of-n-ary-tree/)\n\nç»™å®šä¸€ä¸ª N å‰æ ‘ï¼Œæ‰¾åˆ°å…¶æœ€å¤§æ·±åº¦ã€‚\n\næœ€å¤§æ·±åº¦æ˜¯æŒ‡ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ€»æ•°ã€‚\n\nä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ª `3å‰æ ‘` :\n\n![3å‰æ ‘](https://s2.ax1x.com/2019/11/20/MWwEt0.png)\n\næˆ‘ä»¬åº”è¿”å›å…¶æœ€å¤§æ·±åº¦ï¼Œ3ã€‚\n\n**è¯´æ˜:**\n\n1. æ ‘çš„æ·±åº¦ä¸ä¼šè¶…è¿‡ `1000`ã€‚\n2. æ ‘çš„èŠ‚ç‚¹æ€»ä¸ä¼šè¶…è¿‡ `5000`ã€‚\n\n**è§£æ³•ä¸€**\n\næ²¡å•¥å¥½è¯´çš„\n\n```java\npublic int maxDepth(Node root) {\n    if (root==null) {\n        return 0;\n    }\n    int max=0;\n    List<Node> children=root.children;\n    for (Node node:children) {\n        max=Math.max(max,maxDepth(node));\n    }\n    return max+1;\n}\n```\n## [111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦](https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å°æ·±åº¦ã€‚\n\næœ€å°æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚\n\n**è¯´æ˜:** å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹:**\n\nç»™å®šäºŒå‰æ ‘ `[3,9,20,null,null,15,7]`   \n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\n\nè¿”å›å®ƒçš„æœ€å°æ·±åº¦  2.\n\n**è§£æ³•ä¸€**\n\næœ€å¤§éƒ½æ±‚äº†ï¼Œæœ€å°ä¹Ÿæ¥ä¸€å‘ï¼Œç»å…¸BFSåšæ³•ï¼Œæ±‚æœ€çŸ­è·¯å¾„\n\n```java\npublic int minDepth(TreeNode root) {\n    if (root==null) return 0;\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    int min=0;\n    while(!queue.isEmpty()){\n        int count=queue.size();\n        min++;\n        while(count>0){\n            TreeNode node=queue.poll();\n            if (node.left==null && node.right==null) {\n                return min;\n            }\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            count--;\n        }\n    }\n    return min;\n}\n```\n**è§£æ³•äºŒ**\n\né€’å½’\n\n```java\npublic int minDepth(TreeNode root) {\n    if (root==null) return 0;\n    if (root.left==null) {\n        return minDepth(root.right)+1;\n    }\n    if (root.right==null) {\n        return minDepth(root.left)+1;\n    }\n    return Math.min(minDepth(root.left),minDepth(root.right))+1;\n}\n```\nå¾ˆä¸Šé¢æœ€å¤§çš„ç›¸åï¼Œä½†æ˜¯æœ‰ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ªæ ¹èŠ‚ç‚¹å·¦å³å­æ ‘ï¼Œ**æœ‰ä¸€é¢—ä¸ºç©º**ï¼Œå¦‚æœä¸å¤„ç†ï¼ŒæŒ‰ç…§ä¹‹å‰çš„é€»è¾‘ï¼Œè¿™é¢—ç©ºå­æ ‘ä¸‹ä¸€æ¬¡å°±ä¼šè¿”å›0ï¼Œè‚¯å®šä¼šæ¯”å¦ä¸€é¢—å°æœ€åè¿”å›çš„å°±æ˜¯åˆ°è¿™é¢—å­æ ‘çš„è·¯å¾„ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³è¿™æ ·æ˜¯æ­£ç¡®çš„ä¹ˆï¼Ÿæ˜æ˜¾ä¸æ˜¯ï¼Œæœ€çŸ­è·¯å¾„çš„å°½å¤´ä¸€å®šæ˜¯å¶å­èŠ‚ç‚¹ä¹Ÿå°±æ˜¯å·¦å³å­æ ‘éƒ½ä¸ºç©ºçš„æ—¶å€™ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„\n\n\n## [226. ç¿»è½¬äºŒå‰æ ‘](https://leetcode-cn.com/problems/invert-binary-tree/)\n\nç¿»è½¬ä¸€æ£µäºŒå‰æ ‘ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\nè¾“å…¥ï¼š\n\n```java\n     4\n   /   \\\n  2     7\n / \\   / \\\n1   3 6   9\n```\n\n\nè¾“å‡ºï¼š\n\n```java\n     4\n   /   \\\n  7     2\n / \\   / \\\n9   6 3   1\n```\n\n**å¤‡æ³¨:**\nè¿™ä¸ªé—®é¢˜æ˜¯å—åˆ° Max Howell çš„ åŸé—®é¢˜ å¯å‘çš„ ï¼š\n\n> è°·æ­Œï¼šæˆ‘ä»¬90ï¼…çš„å·¥ç¨‹å¸ˆä½¿ç”¨æ‚¨ç¼–å†™çš„è½¯ä»¶(Homebrew)ï¼Œä½†æ˜¯æ‚¨å´æ— æ³•åœ¨é¢è¯•æ—¶åœ¨ç™½æ¿ä¸Šå†™å‡ºç¿»è½¬äºŒå‰æ ‘è¿™é“é¢˜ï¼Œè¿™å¤ªç³Ÿç³•äº†ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic TreeNode invertTree(TreeNode root) {\n    if (root==null) {\n        return null;\n    }\n    invertTree(root.left);\n    invertTree(root.right);\n    //äº¤æ¢å·¦å³èŠ‚ç‚¹\n    TreeNode temp=root.left;\n    root.left=root.right;\n    root.right=temp;\n    return root;\n}\n```\næ³¨æ„é€’å½’è°ƒç”¨å’Œäº¤æ¢èŠ‚ç‚¹çš„é¡ºåºï¼Œä¸èƒ½æåäº†\n\n```java\npublic TreeNode invertTree(TreeNode root) {\n    if (root==null) {\n        return null;\n    }\n    TreeNode right=root.right;\n    root.right=invertTree(root.left);\n    root.left=invertTree(right);\n    return root;\n}\n```\næ¯”è¾ƒç®€æ´ä¹Ÿæ¯”è¾ƒç¬¦åˆé€’å½’çš„åšæ³•\n\n## [100. ç›¸åŒçš„æ ‘](https://leetcode-cn.com/problems/same-tree/)\n\nç»™å®šä¸¤ä¸ªäºŒå‰æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ£€éªŒå®ƒä»¬æ˜¯å¦ç›¸åŒã€‚\n\nå¦‚æœä¸¤ä¸ªæ ‘åœ¨ç»“æ„ä¸Šç›¸åŒï¼Œå¹¶ä¸”èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„å€¼ï¼Œåˆ™è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:       1         1\n          / \\       / \\\n         2   3     2   3\n\n        [1,2,3],   [1,2,3]\n\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:      1          1\n          /           \\\n         2             2\n    \n        [1,2],     [1,null,2]\n\nè¾“å‡º: false\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥:       1         1\n          / \\       / \\\n         2   1     1   2\n        \n        [1,2,1],   [1,1,2]\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic boolean isSameTree(TreeNode p, TreeNode q) {\n    if (p==null && q==null) {\n        return true;\n    }\n    if (p!=null && q!=null && p.val==q.val) {\n        return isSameTree(p.right,q.right)&&isSameTree(p.left,q.left);\n    }\n    return false;\n}\n```\n\n## [951. ç¿»è½¬ç­‰ä»·äºŒå‰æ ‘](https://leetcode-cn.com/problems/flip-equivalent-binary-trees/)\n\nDifficulty: **ä¸­ç­‰**\n\n\næˆ‘ä»¬å¯ä»¥ä¸ºäºŒå‰æ ‘ T å®šä¹‰ä¸€ä¸ªç¿»è½¬æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šé€‰æ‹©ä»»æ„èŠ‚ç‚¹ï¼Œç„¶åäº¤æ¢å®ƒçš„å·¦å­æ ‘å’Œå³å­æ ‘ã€‚\n\nåªè¦ç»è¿‡ä¸€å®šæ¬¡æ•°çš„ç¿»è½¬æ“ä½œåï¼Œèƒ½ä½¿ X ç­‰äº Yï¼Œæˆ‘ä»¬å°±ç§°äºŒå‰æ ‘ X _ç¿»è½¬ç­‰ä»·_äºäºŒå‰æ ‘ Yã€‚\n\nç¼–å†™ä¸€ä¸ªåˆ¤æ–­ä¸¤ä¸ªäºŒå‰æ ‘æ˜¯å¦æ˜¯_ç¿»è½¬ç­‰ä»·_çš„å‡½æ•°ã€‚è¿™äº›æ ‘ç”±æ ¹èŠ‚ç‚¹Â `root1` å’Œ `root2`Â ç»™å‡ºã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```go\nè¾“å…¥ï¼šroot1 = [1,2,3,4,5,6,null,null,null,7,8], root2 = [1,3,2,null,6,4,5,null,null,null,null,8,7]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šæˆ‘ä»¬ç¿»è½¬å€¼ä¸º 1ï¼Œ3 ä»¥åŠ 5 çš„ä¸‰ä¸ªèŠ‚ç‚¹ã€‚\n\n```\n\n**æç¤ºï¼š**\n\n1.  æ¯æ£µæ ‘æœ€å¤šæœ‰Â `100`Â ä¸ªèŠ‚ç‚¹ã€‚\n2.  æ¯æ£µæ ‘ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„ã€åœ¨ `[0, 99]`Â èŒƒå›´å†…çš„æ•´æ•°ã€‚\n\n\n**è§£æ³•ä¸€**\n\näº¤é”™çš„æ¯”è¾ƒå°±è¡Œäº†\n```golang\n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n * Â  Â  Val int\n * Â  Â  Left *TreeNode\n * Â  Â  Right *TreeNode\n * }\n */\nfunc flipEquiv(root1 *TreeNode, root2 *TreeNode) bool {\n Â  Â if root1 == nil && root2 == nil {\n Â  Â  Â  Â return true\n Â   }\n Â  Â if root1 == nil || root2 == nil {\n Â  Â  Â  Â return false\n Â   }\n Â  Â if root1.Val != root2.Val {\n Â  Â  Â  Â return false\n Â   }\n Â  Â return (flipEquiv(root1.Left, root2.Left) && \n Â  Â  Â  Â  Â  Â flipEquiv(root1.Right, root2.Right)) || \n Â  Â  Â  Â  Â  (flipEquiv(root1.Left, root2.Right) &&\n Â  Â  Â  Â  Â  Â flipEquiv(root1.Right, root2.Left))\n}\n```\n\n## [572. å¦ä¸€ä¸ªæ ‘çš„å­æ ‘](https://leetcode-cn.com/problems/subtree-of-another-tree/)\n\nç»™å®šä¸¤ä¸ªéç©ºäºŒå‰æ ‘ s å’Œ tï¼Œæ£€éªŒ s ä¸­æ˜¯å¦åŒ…å«å’Œ t å…·æœ‰ç›¸åŒç»“æ„å’ŒèŠ‚ç‚¹å€¼çš„å­æ ‘ã€‚s çš„ä¸€ä¸ªå­æ ‘åŒ…æ‹¬ s çš„ä¸€ä¸ªèŠ‚ç‚¹å’Œè¿™ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­å­™ã€‚s ä¹Ÿå¯ä»¥çœ‹åšå®ƒè‡ªèº«çš„ä¸€æ£µå­æ ‘ã€‚\n\n**ç¤ºä¾‹ 1:**\nç»™å®šçš„æ ‘ s:\n\n```java\n     3\n    / \\\n   4   5\n  / \\\n 1   2\n```\n\n\nç»™å®šçš„æ ‘ tï¼š\n\n```java\n   4 \n  / \\\n 1   2\n```\n\nè¿”å› **true**ï¼Œå› ä¸º t ä¸ s çš„ä¸€ä¸ªå­æ ‘æ‹¥æœ‰ç›¸åŒçš„ç»“æ„å’ŒèŠ‚ç‚¹å€¼ã€‚\n\n**ç¤ºä¾‹ 2:**\nç»™å®šçš„æ ‘ sï¼š\n\n```java\n     3\n    / \\\n   4   5\n  / \\\n 1   2\n    /\n   0\n```\n\nç»™å®šçš„æ ‘ tï¼š\n\n```java\n   4\n  / \\\n 1   2\n```\n\nè¿”å› **false**\n\n**è§£æ³•ä¸€**\n\nå…ˆä¸Šä¸€ä¸ªé”™è¯¯è§£æ³•\n\n```java\npublic boolean isSubtree(TreeNode s, TreeNode t) {\n    if (t==null && s==null) {\n        return true;\n    }\n    if (s==null) {\n        return false;\n    }\n    if (s!=null&& t!=null && s.val == t.val) {\n        return isSubtree(s.left,t.left) && isSubtree(s.right,t.right);\n    }\n    return isSubtree(s.left,t) | isSubtree(s.right,t);\n}\n```\nè¿‡äº†146/176çš„caseï¼Œä½†æ˜¯è¿™ä¸ªæ˜æ˜¾æ˜¯é”™çš„ï¼Œä¸è¿‡æ ¸å¿ƒçš„é€’å½’è¿˜æ˜¯å¤§æ¦‚é›å½¢å†™å‡ºæ¥äº†\n\n**è§£æ³•äºŒ**\n\næ€è€ƒäº†ä¸€ä¼šï¼Œå…‰é€Ÿç„äº†ä¸€çœ¼è¯„è®ºåŒºï¼Œéšçº¦çœ‹åˆ°äº†æœ‰äººè¯´åŒé€’å½’ï¼Œç„¶åæƒ³åˆ°äº†ä¸‹é¢çš„è§£\n\n```java\n//ç®€åŒ–ä»£ç \npublic boolean isSubtree(TreeNode s, TreeNode t) {\n    if (s==null) {\n        return false;\n    }\n    return isSame(s,t)| isSubtree(s.left,t) | isSubtree(s.right,t);\n}\n\npublic boolean isSame(TreeNode s, TreeNode t){\n    if (s==null && t==null) {\n        return true;        \n    }\n    if (s==null || t==null) {\n        return false;\n    }\n    return s.val==t.val && isSame(s.left,t.left) && isSame(s.right,t.right);\n}\n```\n\nå¼€å§‹çš„ä»£ç æ²¡è¿™ä¹ˆç®€æ´ï¼Œæ¯”è¾ƒç½—å—¦ï¼Œè¦åˆ¤æ–­ä¸€æ£µæ ‘æ˜¯ä¸æ˜¯å¦ä¸€é¢—çš„å­æ ‘å¾ˆå¥½åˆ¤æ–­ï¼Œè¦ä¹ˆså’Œtç›´æ¥ç›¸ç­‰ï¼Œè¦ä¹ˆtæ˜¯så·¦å­æ ‘çš„å­æ ‘ï¼Œæˆ–è€…å³å­æ ‘çš„å­æ ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå‡½æ•°åˆ¤æ–­ä¸¤ä¸ªä¸¤æ£µæ ‘æ˜¯å¦ç›¸ç­‰ï¼Œåªç”¨ä¸€ä¸ªå‡½æ•°ç¡®å®ä¸å¥½å®ç°\n\n**è§£æ³•ä¸‰**\n\nå…¶å®è¿˜æœ‰ä¸€ç§è§£æ³•ï¼Œä¹Ÿæ˜¯æœ€å¼€å§‹æƒ³åˆ°çš„ï¼Œå°±æ˜¯ç›´æ¥ä¸­åºéå†å’Œå‰åºéå†ï¼Œå¾—åˆ°ä¸¤ä¸ªåºåˆ—ï¼Œç„¶åç”¨kmpåŒ¹é…ä¸¤æ£µæ ‘ï¼Œkmpå¾ˆä¹…æ²¡çœ‹äº†ï¼Œä¸ä¼šå†™äº†ï¼Œåé¢æœ‰æ—¶é—´å†æ¥å†™\n\n## [é¢è¯•é¢˜26. æ ‘çš„å­ç»“æ„](https://leetcode-cn.com/problems/shu-de-zi-jie-gou-lcof/)\n\nè¾“å…¥ä¸¤æ£µäºŒå‰æ ‘Aå’ŒBï¼Œåˆ¤æ–­Bæ˜¯ä¸æ˜¯Açš„å­ç»“æ„ã€‚(çº¦å®šç©ºæ ‘ä¸æ˜¯ä»»æ„ä¸€ä¸ªæ ‘çš„å­ç»“æ„)\n\nBæ˜¯Açš„å­ç»“æ„ï¼Œ å³ Aä¸­æœ‰å‡ºç°å’ŒBç›¸åŒçš„ç»“æ„å’ŒèŠ‚ç‚¹å€¼ã€‚\n\n**ä¾‹å¦‚:**\nç»™å®šçš„æ ‘ A:\n\n```java\n     3\n    / \\\n   4   5\n  / \\\n 1   2\n```\n\nç»™å®šçš„æ ‘ Bï¼š\n\n```java\n   4 \n  /\n 1\n```\n\n\nè¿”å› trueï¼Œå› ä¸º B ä¸ A çš„ä¸€ä¸ªå­æ ‘æ‹¥æœ‰ç›¸åŒçš„ç»“æ„å’ŒèŠ‚ç‚¹å€¼ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šA = [1,2,3], B = [3,1]\nè¾“å‡ºï¼šfalse\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šA = [3,4,5,1,2], B = [4,1]\nè¾“å‡ºï¼štrue\n```\n\n**é™åˆ¶ï¼š**\n\n0 <= èŠ‚ç‚¹ä¸ªæ•° <= 10000\n\n**è§£æ³•ä¸€**\n\nä¸€æ ·çš„é¢˜ä¸ºå•¥è¿˜åŠ ä¸Šï¼Ÿä»”ç»†çœ‹é¢˜ï¼Œæˆ‘å¼€å§‹ä¹Ÿä»¥ä¸ºæ˜¯ä¸€æ ·çš„\n\n```java\npublic boolean isSubStructure(TreeNode A, TreeNode B) {\n    if(A==null || B==null){\n        return false;\n    }\n    return isSame(A,B) | isSubStructure(A.left,B) | isSubStructure(A.right,B);\n}\n\npublic boolean isSame(TreeNode A,TreeNode B){\n    if (B==null) { //ABåŒæ—¶ä¸ºNULLåº”è¯¥è¿”å›true,æ‰€ä»¥ä¸Šä¸‹ä¸èƒ½äº¤æ¢\n        return true;\n    }\n    if(A==null){\n        return false;\n    }\n    return A.val==B.val && isSame(A.left,B.left) && isSame(A.right,B.right);\n}\n```\nè¿™é‡Œè¯´çš„æ˜¯å­ç»“æ„ä¸æ˜¯å­æ ‘ï¼ŒisSameå‡½æ•°ä¸éœ€è¦ä¿è¯å®Œå…¨ç›¸ç­‰ï¼Œè¿™é‡Œå°±éœ€è¦æ³¨æ„äº†ï¼Œå½“`A!=null && B==null`çš„æ—¶å€™å°±è¯´æ˜Bå·²ç»åŒ¹é…å®Œäº†Aè¿˜æ²¡æœ‰ï¼Œè¿™å°±è¯´æ˜Bæ˜¯Açš„å­ç»“æ„\n\n**UPDATE(2020.5.7)**\n\næ¢äº†ä¸€ä¸‹å†™æ³•ï¼Œä¸ç”¨è€ƒè™‘é¡ºåºäº†\n\n```go\nfunc isSubStructure(A *TreeNode, B *TreeNode) bool {\n    if B==nil || A==nil{\n        return false\n    }\n    return dfs(A,B) || isSubStructure(A.Left,B) || isSubStructure(A.Right,B)\n}\n\nfunc dfs(A *TreeNode, B *TreeNode)bool{\n    if A==nil && B==nil{\n        return true\n    }\n    if A==nil || B==nil{\n        return B==nil\n    }\n    return A.Val==B.Val && dfs(A.Left,B.Left) && dfs(A.Right,B.Right)\n}\n```\n\n## [222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°](https://leetcode-cn.com/problems/count-complete-tree-nodes/)\n\nç»™å‡ºä¸€ä¸ª**å®Œå…¨äºŒå‰æ ‘**ï¼Œæ±‚å‡ºè¯¥æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚\n\n**è¯´æ˜ï¼š**\n\nå®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å¦‚ä¸‹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2h ä¸ªèŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: \n    1\n   / \\\n  2   3\n / \\  /\n4  5 6\n\nè¾“å‡º: 6\n```\n\n**è§£æ³•ä¸€**\n\nBFSï¼Œæƒå½“å¤ä¹ äº†\n\n```java\n//BFS\npublic int countNodes(TreeNode root) {\n    Queue<TreeNode> queue=new LinkedList<>();\n    if (root == null) return 0;\n    queue.add(root);\n    int count=1;\n    while(!queue.isEmpty()){\n        int nextLevel=queue.size();\n        while(nextLevel>0){\n            TreeNode node=queue.poll(); \n            count++;\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            nextLevel--;\n        }\n    }\n    return count;\n}\n```\n**è§£æ³•äºŒ**\n\né€’å½’è§£æ³•\n\n```java\n//æš´åŠ›\npublic int countNodes(TreeNode root) {\n    if (root==null) return 0;\n    return countNodes(root.left)+countNodes(root.right)+1;\n}\n```\næ›´åŠ ç²¾ç®€ç‚¹å¯ä»¥ç¼©å‡æˆä¸€è¡Œ\n\n**è§£æ³•ä¸‰**\n\nè¿™é¢˜æ˜¯midéš¾åº¦ï¼Œè€Œä¸”é¢˜ç›®ç»™çš„æ¡ä»¶è¿˜æ²¡ç”¨ä¸Šï¼š**è¿™æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘**ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒçš„æ€§è´¨æ¥åšï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œ**æ»¡äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°**å¯ä»¥ç›´æ¥æ ¹æ®å…¬å¼ `2^H-1` è®¡ç®—å¾—æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åˆ¤æ–­å½“å‰çš„å®Œå…¨äºŒå‰æ ‘æ˜¯ä¸æ˜¯**æ»¡äºŒå‰æ ‘**ï¼Œå¦‚æœæ˜¯ç›´æ¥ç®—å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥çœå»ä¸­é—´å¾ˆå¤šèŠ‚ç‚¹çš„éå†\n\n```java\n//åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨\npublic int countNodes(TreeNode root) {\n    if (root==null) return 0;\n    TreeNode left=root.left;\n    TreeNode right=root.right;\n    int hight=0;\n    while(left!=null && right!=null){\n        left=left.left;\n        right=right.right;\n        hight++;\n    }\n    //åŒæ—¶å‘å·¦å‘å³èµ°ï¼Œèµ°åˆ°æœ€åleft==nullå°±è¯´æ˜è¿™é¢—æ ‘æ˜¯æ»¡äºŒå‰æ ‘ï¼Œå¯ä»¥åˆ©ç”¨å…¬å¼ç›´æ¥æ±‚å‡ºèŠ‚ç‚¹ä¸ªæ•°\n    //å¦åˆ™å°±å¯¹å…¶å·¦å³å­æ ‘é€’å½’æ±‚è§£\n    return left==null?(1<<hight)-1:countNodes(root.left)+countNodes(root.right)+1;\n}\n```\nä¸å¾—ä¸è¯´è¿™æ ·çš„æ–¹å¼è¿˜æ˜¯æŒºå·§å¦™çš„ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯`O(2logN)`? \n\n## [112. è·¯å¾„æ€»å’Œ](https://leetcode-cn.com/problems/path-sum/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œä¸€ä¸ªç›®æ ‡å’Œï¼Œåˆ¤æ–­è¯¥æ ‘ä¸­æ˜¯å¦å­˜åœ¨**æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹**çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å€¼ç›¸åŠ ç­‰äºç›®æ ‡å’Œã€‚\n\n**è¯´æ˜:** å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹:** \nç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ `sum = 22`\n\n```java\n          5\n         / \\\n        4   8\n       /   / \\\n      11  13  4\n     /  \\      \\\n    7    2      1\n```\nè¿”å› true, å› ä¸ºå­˜åœ¨ç›®æ ‡å’Œä¸º 22 çš„æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ `5->4->11->2`\n\n**è§£æ³•ä¸€**\n\né€’å½’è§£æ³•\n\n```java\npublic boolean hasPathSum(TreeNode root, int sum) {\n    if (root==null) {\n        return false;\n    }\n    //éœ€è¦æ³¨æ„è¿™é‡Œçš„å¶èŠ‚ç‚¹åˆ¤æ–­\n    if (root.left==null && root.right==null&&root.val==sum) {\n        return true;\n    }\n    return hasPathSum(root.left,sum-root.val) || hasPathSum(root.right,sum-root.val);\n}\n```\nå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯è¿™ä¸ªå¶å­èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œä¸€å¼€å§‹æ²¡æ³¨æ„åˆ°ï¼Œç›´æ¥å†™çš„ `root.val==sum` ï¼Œå…¶å®å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹çš„è¯ï¼Œå…¶å®æ˜¯ä¸æˆç«‹çš„ï¼Œæ¯”å¦‚\n\n```java\n  1\n /\n2       sum=1\n```\n\nå…¶å®è¿™å°±æ˜¯`false` ï¼Œå› ä¸ºä»–æ²¡æœ‰å³å­æ ‘ï¼Œè€Œé¢˜ç›®è¦æ±‚çš„æ˜¯ä»**æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹**\n\n## [404. å·¦å¶å­ä¹‹å’Œ](https://leetcode-cn.com/problems/sum-of-left-leaves/)\n\nè®¡ç®—ç»™å®šäºŒå‰æ ‘çš„æ‰€æœ‰å·¦å¶å­ä¹‹å’Œã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\nåœ¨è¿™ä¸ªäºŒå‰æ ‘ä¸­ï¼Œæœ‰ä¸¤ä¸ªå·¦å¶å­ï¼Œåˆ†åˆ«æ˜¯ 9 å’Œ 15ï¼Œæ‰€ä»¥è¿”å› 24\n\n**è§£æ³•ä¸€**\n\nè¯´å®è¯ï¼Œè¿™äº›é¢˜ç»™çš„ä¾‹å­éƒ½æŒºè¯¯å¯¼äººçš„ï¼Œä¼šè®©äººä¸è‡ªè§‰åœ°å¿½ç•¥**å¶å­èŠ‚ç‚¹**è¿™ä¸ªæ¡ä»¶ğŸ˜‚\n\n```java\nprivate int sum=0;\n\npublic int sumOfLeftLeaves(TreeNode root){\n    sumOfLeft(root);\n    return sum;\n};\n\npublic void sumOfLeft(TreeNode root) {\n    if (root==null) {\n        return;\n    }\n    //æ³¨æ„è¿™é‡Œçš„æ¡ä»¶ï¼ï¼ï¼ï¼\n    if (root.left!=null && root.left.left==null &&root.left.right==null) {\n        sum+=root.left.val;\n    }\n    sumOfLeft(root.left);\n    sumOfLeft(root.right);\n}\n```\n## [257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„](https://leetcode-cn.com/problems/binary-tree-paths/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚\n\n**è¯´æ˜:** å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\n è¾“å…¥:\n\n   1\n /   \\\n2     3\n \\\n  5\n\nè¾“å‡º: [\"1->2->5\", \"1->3\"]\n\nè§£é‡Š: æ‰€æœ‰æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸º: 1->2->5, 1->3\n```\n\n**è§£æ³•ä¸€**\n\né€’å½’DFSçš„è§£æ³•\n\n```java\n//DFS\npublic List<String> binaryTreePaths(TreeNode root) {\n    List<String> res=new ArrayList<>();\n    if (root==null) return res;\n\n    if (root!=null&&root.left==null&&root.right==null) {\n        res.add(String.valueOf(root.val));\n        return res;\n    }\n    //å·¦å­æ ‘çš„æ‰€æœ‰è·¯å¾„\n    List<String> lefts=binaryTreePaths(root.left);\n    //å³å­æ ‘çš„æ‰€æœ‰è·¯å¾„\n    List<String> rights=binaryTreePaths(root.right);\n    \n    //åœ¨æ¯æ¡è·¯å¾„å‰é¢åŠ ä¸Šå½“å‰æ ¹èŠ‚ç‚¹\n    for (int i=0;i<lefts.size();i++) {\n        res.add(root.val+\"->\"+lefts.get(i));\n    }\n    for (int i=0;i<rights.size();i++) {\n        res.add(root.val+\"->\"+rights.get(i));\n    }\n    return res;\n}\n```\næ¯”ä¸Šé¢çš„é€’å½’ç¨å¾®å¤æ‚ç‚¹ï¼Œæ ¸å¿ƒæ€æƒ³è¿˜æ˜¯è¦æŠ“ä½é€’å½’çš„æœ¬è´¨ï¼Œä¸è¦å»çº ç»“é€’å½’æ¯ä¸€æ­¥éƒ½æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Œä»å®è§‚ä¸Šå»å†™ä»£ç ï¼Œè¿˜æ˜¯è¦å¤šç»ƒå•Š\n\n**è§£æ³•äºŒ**\n\nBFSå¹¿æœ\n\n```java\npublic List<String> binaryTreePaths(TreeNode root) {\n    List<String> res=new ArrayList<>();\n    if (root==null) return res;\n    Stack<TreeNode> node_stack=new Stack<>();\n    Stack<String> path_stack=new Stack<>();\n    node_stack.add(root);\n    path_stack.add(String.valueOf(root.val));\n    String path=\"\";\n    while(!node_stack.isEmpty()){\n        TreeNode node=node_stack.pop();\n        path=path_stack.pop();\n        //å¶å­èŠ‚ç‚¹ï¼Œè¿™æ¡è·¯å¾„æœç´¢ç»“æŸï¼Œæ·»åŠ åˆ°resä¸­\n        if (node.left==null&&node.right==null) {\n            res.add(path);\n        }\n        \n        if (node.left!=null) {\n            node_stack.add(node.left);\n            path_stack.add(path+\"->\"+node.left.val);\n        }\n        if (node.right!=null) {\n            node_stack.add(node.right);\n            path_stack.add(path+\"->\"+node.right.val);\n        }\n    }\n    return res;\n}\n```\nè¿™é‡Œå’Œä¼ ç»Ÿçš„BFSä¸å¤ªä¸€æ ·ï¼Œæ˜¯ç”¨çš„æ ˆæ¥éå†çš„\n\n**è§£æ³•ä¸‰**\n\nè¿™ç§è§£æ³•åº”è¯¥ä¼šæ¯”ä¸Šé¢çš„è§£æ³•å¤æ‚åº¦ä½ä¸€ç‚¹\n\n```go\nfunc binaryTreePaths(root *TreeNode) []string {\n    var res []string\n    dfs(root,\"\",&res)\n    return res\n}\n\n//æ³¨æ„è¿™ä¸ªresè¦ä¼ æŒ‡é’ˆ\nfunc dfs(root *TreeNode,path string,res *[]string){\n    if root==nil {return}\n    path+=strconv.Itoa(root.Val)\n    if root.Left==nil && root.Right==nil{\n        *res=append(*res,path)\n        return\n    }\n    dfs(root.Left,path+\"->\",res)\n    dfs(root.Right,path+\"->\",res)\n}\n```\n\n## [113. è·¯å¾„æ€»å’Œ II](https://leetcode-cn.com/problems/path-sum-ii/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œä¸€ä¸ªç›®æ ‡å’Œï¼Œæ‰¾åˆ°æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„æ€»å’Œç­‰äºç»™å®šç›®æ ‡å’Œçš„è·¯å¾„ã€‚\n\n**è¯´æ˜:** å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹\n\n**ç¤ºä¾‹:**\nç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ `sum = 22`ï¼Œ\n\n```java\n          5\n         / \\\n        4   8\n       /   / \\\n      11  13  4\n     /  \\    / \\\n    7    2  5   1\n```\nè¿”å›:\n\n```java\n[\n   [5,4,11,2],\n   [5,8,4,5]\n]\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šä¸€é¢˜çš„åšæ³•åŸºæœ¬ä¸€è‡´ï¼Œæœ¬æ¥åº”è¯¥æ˜¯ä¸€ébugfreeçš„ï¼Œç¼–è¯‘é”™è¯¯æ•´äº†åŠå¤©\n\n```java\npublic List<List<Integer>> pathSum(TreeNode root, int sum) {\n    List<List<Integer>> res=new LinkedList<>();\n    if (root==null) {\n        return res;\n    }\n    if (root!=null && root.left==null && root.right==null && root.val==sum) {\n        LinkedList<Integer>  lis= new LinkedList<>(); \n        lis.add(root.val);\n        res.add(lis);\n        return res;\n    }\n    //å·¦å³å­æ ‘ç¬¦åˆæ¡ä»¶çš„è·¯å¾„\n    List<List<Integer>> lefts=pathSum(root.left,sum-root.val);\n    List<List<Integer>> rights=pathSum(root.right,sum-root.val);\n\n    for (int i=0;i<lefts.size();i++) {\n        ((LinkedList<Integer>)lefts.get(i)).addFirst(root.val);\n        res.add(lefts.get(i));\n    }\n\n    for (int i=0;i<rights.size();i++) {\n        ((LinkedList<Integer>)rights.get(i)).addFirst(root.val);\n        res.add(rights.get(i));\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nåºŸäº†è€å¤§åŠ²ç»ˆäºæŠŠBFSå†™å‡ºæ¥äº†ã€‚ã€‚ã€‚å¯ä»¥çœ‹å‡ºè¿˜æ˜¯å€Ÿé‰´çš„ä¸Šé¢çš„æ€è·¯\n\n```java\npublic List<List<Integer>> pathSum2(TreeNode root,int sum) {\n    List<List<Integer>> res=new LinkedList<>();\n    if (root==null) return res;\n    //èŠ‚ç‚¹æ ˆ\n    Stack<TreeNode> node_stack=new Stack<>();\n    //è·¯å¾„æ ˆ\n    Stack<List<Integer>> path_stack=new Stack<>();\n    //èŠ‚ç‚¹sumæ ˆ\n    Stack<Integer> sum_stack=new Stack<>();\n    //ç»™æ¯ä¸ªæ ˆå­˜å…¥åˆå§‹å€¼\n    node_stack.add(root);\n    path_stack.add(new LinkedList(){{\n        add(root.val);\n    }});\n    sum_stack.add(root.val);\n    //BFS\n    while(!node_stack.isEmpty()){\n        TreeNode node=node_stack.pop();\n        List<Integer> pathList=path_stack.pop();\n        int tempS=sum_stack.pop();\n        //ç»ˆæ­¢æ¡ä»¶\n        if (node.left==null && node.right==null&&tempS==sum) {\n            res.add(pathList);\n            continue;\n        }\n        if (node.left!=null) {\n            //è¿™ä¸‰ä¸ªæ ˆæ˜¯åŒæ­¥çš„,nodeæ ˆå­˜æ”¾å½“å‰èŠ‚ç‚¹\n            //pathæ ˆå­˜æ”¾æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„\n            //sumæ ˆå­˜æ”¾çš„æ˜¯pathæ ˆä¸­æ‰€æœ‰èŠ‚ç‚¹çš„valå’Œ\n            node_stack.add(node.left);\n            //è¿™é‡Œä¸è¦ç›´æ¥æ“ä½œpathList,å¦åˆ™å·¦å³çš„è·¯å¾„ä¼šæ··åœ¨ä¸€èµ·\n            LinkedList<Integer> tlis= new LinkedList(pathList);\n            tlis.add(node.left.val);\n            path_stack.add(tlis);\n            //ç´¯åŠ è·¯å¾„ä¸Šçš„èŠ‚ç‚¹å€¼\n            sum_stack.add(tempS+node.left.val);\n        }\n        if (node.right!=null) {\n            node_stack.add(node.right);\n            //åŒä¸Š\n            LinkedList<Integer> tlis= new LinkedList(pathList);\n            tlis.add(node.right.val);\n            path_stack.add(tlis);\n            sum_stack.add(tempS+node.right.val);\n        }\n    }\n    return res;\n}\n```\nç”¨åˆ°ä¸‰ä¸ªæ ˆï¼ŒåŒæ­¥ä¿å­˜èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿˜æ˜¯æŒºç®€å•çš„\n\n**è§£æ³•ä¸‰**\n\nè¡¥ä¸€ç§dfs+å›æº¯çš„æ€è·¯ï¼Œä¸Šé¢çš„æ‰€æœ‰è·¯å¾„ä¹Ÿå¯ä»¥è¿™æ ·åšï¼Œæ„Ÿè§‰ä¼šæ¯”ä¸Šé¢çš„è¦å¥½ä¸€ç‚¹\n\n```java\npublic List<List<Integer>> pathSum(TreeNode root, int sum) {\n    dfs(root,sum,new ArrayList<>());\n    return res;\n}\n\nprivate List<List<Integer>> res=new ArrayList<>();\n\npublic void dfs(TreeNode root,int sum,List<Integer> lis){\n    if(root==null) return;\n    lis.add(root.val);\n    if(root.left==null && root.right==null && sum==root.val){\n        res.add(new ArrayList(lis)); //è¿™é‡Œä¸èƒ½returnï¼Œå¾—åˆ°åé¢å›æº¯åæ‰èƒ½return\n    }else{\n        dfs(root.left,sum-root.val,lis);\n        dfs(root.right,sum-root.val,lis);\n    }\n    lis.remove(lis.size()-1);\n}\n```\n\n## [894. æ‰€æœ‰å¯èƒ½çš„æ»¡äºŒå‰æ ‘](https://leetcode-cn.com/problems/all-possible-full-binary-trees/)\n\n*æ»¡äºŒå‰æ ‘*æ˜¯ä¸€ç±»äºŒå‰æ ‘ï¼Œå…¶ä¸­æ¯ä¸ªç»“ç‚¹æ°å¥½æœ‰ 0 æˆ– 2 ä¸ªå­ç»“ç‚¹ã€‚\n\nè¿”å›åŒ…å« `N` ä¸ªç»“ç‚¹çš„æ‰€æœ‰å¯èƒ½æ»¡äºŒå‰æ ‘çš„åˆ—è¡¨ã€‚ ç­”æ¡ˆçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå¯èƒ½æ ‘çš„æ ¹ç»“ç‚¹ã€‚\n\nç­”æ¡ˆä¸­æ¯ä¸ªæ ‘çš„æ¯ä¸ª`ç»“ç‚¹`éƒ½**å¿…é¡»**æœ‰ `node.val=0`ã€‚\n\nä½ å¯ä»¥æŒ‰ä»»ä½•é¡ºåºè¿”å›æ ‘çš„æœ€ç»ˆåˆ—è¡¨ã€‚\n\n![tXXu4A.png](https://s1.ax1x.com/2020/06/13/tXXu4A.png)\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š7\nè¾“å‡ºï¼š[[0,0,0,null,null,0,0,null,null,0,0],[0,0,0,null,null,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,null,null,null,null,0,0],[0,0,0,0,0,null,null,0,0]]\nè§£é‡Šï¼š\n```\n\n**æç¤ºï¼š**\n\n- `1 <= N <= 20`\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å’Œä¸Šé¢ä¸¤é¢˜å¾ˆç±»ä¼¼ï¼Œå¯æƒœæˆ‘å¹¶æ²¡æœ‰ç›´æ¥åšå‡ºæ¥ï¼Œèœå•Šï¼Œçœ‹äº†ä¸€çœ¼è¯„è®ºåŒºçœ‹è§äº†å‡ ä¸ªforå¾ªç¯ç«‹é©¬å°±æ‡‚äº†ï¼Œç„¶åè¿‡äº†å¥½å‡ å¤©å®ç°äº†ä¸‹ï¼Œä¸€å¼€å§‹rootçš„ä½ç½®æ”¾é”™äº†ï¼Œæ”¹äº†ä¸€ä¼šå„¿\n\n```java\npublic List<TreeNode> allPossibleFBT(int N) {\n    List<TreeNode> res=new ArrayList<>();\n    if(N%2==0) return res; //å¶æ•°æå‰è¿”å›ï¼ŒåŠ å¿«é€Ÿåº¦\n    if(N==1){\n        res.add(new TreeNode(0));\n        return res;  \n    }\n    N--; //å‡å»æ ¹èŠ‚ç‚¹\n    for(int i=1;i<N;i+=2){ //å°†å·¦å³å­æ ‘åˆ’åˆ†ä½ä¸¤ä¸ªå¥‡æ•°\n        List<TreeNode> lefts=allPossibleFBT(i);\n        List<TreeNode> rights=allPossibleFBT(N-i);\n        for(TreeNode le:lefts){\n            for(TreeNode ri:rights){\n                //ä¸€è·¯ä»æœ€å¤–å±‚ç§»åŠ¨åˆ°è¿™é‡Œã€‚ã€‚ã€‚ã€‚\n                TreeNode root=new TreeNode(0); \n                root.left=le;\n                root.right=ri;\n                res.add(root);\n            }\n        }\n    }\n    return res;\n}\n```\n\n## [129. æ±‚æ ¹åˆ°å¶å­èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ](https://leetcode-cn.com/problems/sum-root-to-leaf-numbers/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹éƒ½å­˜æ”¾ä¸€ä¸ª `0-9` çš„æ•°å­—ï¼Œæ¯æ¡ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„éƒ½ä»£è¡¨ä¸€ä¸ªæ•°å­—ã€‚\n\nä¾‹å¦‚ï¼Œä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ `1->2->3` ä»£è¡¨æ•°å­— `123`\n\nè®¡ç®—ä»æ ¹åˆ°å¶å­èŠ‚ç‚¹ç”Ÿæˆçš„æ‰€æœ‰æ•°å­—ä¹‹å’Œã€‚\n\n**è¯´æ˜:** å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3]\n    1\n   / \\\n  2   3\nè¾“å‡º: 25\nè§£é‡Š:\nä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ 1->2 ä»£è¡¨æ•°å­— 12.\nä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ 1->3 ä»£è¡¨æ•°å­— 13.\nå› æ­¤ï¼Œæ•°å­—æ€»å’Œ = 12 + 13 = 25.\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [4,9,0,5,1]\n    4\n   / \\\n  9   0\n / \\\n5   1\nè¾“å‡º: 1026\nè§£é‡Š:\nä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ 4->9->5 ä»£è¡¨æ•°å­— 495.\nä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ 4->9->1 ä»£è¡¨æ•°å­— 491.\nä»æ ¹åˆ°å¶å­èŠ‚ç‚¹è·¯å¾„ 4->0 ä»£è¡¨æ•°å­— 40.\nå› æ­¤ï¼Œæ•°å­—æ€»å’Œ = 495 + 491 + 40 = 1026.\n```\n\n**è§£æ³•ä¸€**\n\nBFSï¼Œå»¶ç»­ä¸Šé¢çš„åšæ³•\n\n```java\npublic int sumNumbers(TreeNode root) {\n    int res=0;\n    if (root == null ) return res;\n    Stack<TreeNode> node_stack=new Stack<>();\n    Stack<Integer> sum_stack=new Stack<>();\n    node_stack.add(root);\n    sum_stack.add(root.val);\n    while(!node_stack.isEmpty()){\n        TreeNode node=node_stack.pop();\n        int tempS=sum_stack.pop();\n        if (node.left==null && node.right==null) {\n            res+=tempS;\n            continue;\n        }\n        if (node.left!=null) {\n            node_stack.add(node.left);\n             //æ³¨æ„*10,åœ¨ä¸Šä¸€å±‚çš„åŸºç¡€ä¸Š*10\n            sum_stack.add(tempS*10+node.left.val);\n        }\n        if (node.right!=null) {\n            node_stack.add(node.right);\n            sum_stack.add(tempS*10+node.right.val);\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nDFSè§£æ³•ï¼Œä¸€å¼€å§‹æ²¡æƒ³å‡ºæ¥ã€‚ã€‚ã€‚\n\n```java\nprivate int sum=0;\n//DFS\npublic int sumNumbers2(TreeNode root) {\n    sumNumber(0,root);\n    return sum;\n}\n\npublic void sumNumber(int parent,TreeNode root) {\n    if (root==null) {\n        return;\n    }\n    int cur=parent*10+root.val;\n    //å¶å­èŠ‚ç‚¹\n    if (root!=null && root.left==null&& root.right==null) {\n        sum+=cur;\n    }\n    sumNumber(cur,root.left);\n    sumNumber(cur,root.right);\n}\n```\n\n## [1022. ä»æ ¹åˆ°å¶çš„äºŒè¿›åˆ¶æ•°ä¹‹å’Œ](https://leetcode-cn.com/problems/sum-of-root-to-leaf-binary-numbers/)\n\nç»™å‡ºä¸€æ£µäºŒå‰æ ‘ï¼Œå…¶ä¸Šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½æ˜¯ `0` æˆ– `1` ã€‚æ¯ä¸€æ¡ä»æ ¹åˆ°å¶çš„è·¯å¾„éƒ½ä»£è¡¨ä¸€ä¸ªä»æœ€é«˜æœ‰æ•ˆä½å¼€å§‹çš„äºŒè¿›åˆ¶æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè·¯å¾„ä¸º `0 -> 1 -> 1 -> 0 -> 1`ï¼Œé‚£ä¹ˆå®ƒè¡¨ç¤ºäºŒè¿›åˆ¶æ•° `01101`ï¼Œä¹Ÿå°±æ˜¯ `13` ã€‚\n\nå¯¹æ ‘ä¸Šçš„æ¯ä¸€ç‰‡å¶å­ï¼Œæˆ‘ä»¬éƒ½è¦æ‰¾å‡ºä»æ ¹åˆ°è¯¥å¶å­çš„è·¯å¾„æ‰€è¡¨ç¤ºçš„æ•°å­—ã€‚\n\nä»¥ **10^9 + 7** ä¸º**æ¨¡**ï¼Œè¿”å›è¿™äº›æ•°å­—ä¹‹å’Œã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n![JI4uDI.png](https://s1.ax1x.com/2020/04/28/JI4uDI.png)\n\n```java\nè¾“å…¥ï¼š[1,0,1,0,1,0,1]\nè¾“å‡ºï¼š22\nè§£é‡Šï¼š(100) + (101) + (110) + (111) = 4 + 5 + 6 + 7 = 22\n```\n\n \n\n**æç¤ºï¼š**\n\n1. æ ‘ä¸­çš„ç»“ç‚¹æ•°ä»‹äº `1` å’Œ `1000` ä¹‹é—´ã€‚\n2. node.val ä¸º `0` æˆ– `1` ã€‚\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šä¸€é¢˜ä¸€æ‘¸ä¸€æ ·ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯10è¿›åˆ¶ï¼Œä¸€ä¸ªæ˜¯äºŒè¿›åˆ¶\n\n```go\n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n *     Val int\n *     Left *TreeNode\n *     Right *TreeNode\n * }\n */\nvar mod=int(1e9+7)\n\nfunc sumRootToLeaf(root *TreeNode) int {\n    sum:=0;\n    dfs(root,0,&sum)\n    return sum\n}\n\nfunc dfs(root *TreeNode,cur int,sum *int){\n    if root==nil{\n        return\n    }\n    cur=(cur<<1+root.Val)%mod\n    if root!=nil && root.Left==nil && root.Right==nil{\n        *sum=(*sum+cur)%mod\n        return\n    }\n    dfs(root.Left,cur,sum)\n    dfs(root.Right,cur,sum)\n}\n```\n\n> è¿™é¢˜çš„æ•°æ®å¤ªå¼±äº†ï¼Œç”šè‡³éƒ½ä¸ç”¨å–æ¨¡ç…§æ ·å¯ä»¥è¿‡ã€‚ã€‚ã€‚ã€‚æˆ‘ä¸€å¼€å§‹çœ‹åˆ°1000ä¸ªèŠ‚ç‚¹ï¼Œè¿˜è€ƒè™‘è¦ä¸è¦å¤„ç†å¤§æ•°çš„æƒ…å†µï¼Œçœ‹åˆ°è¿”å›å€¼æ˜¯intæ‰ä½œç½¢ğŸ¤£\n\n## [437. è·¯å¾„æ€»å’Œ III](https://leetcode-cn.com/problems/path-sum-iii/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹éƒ½å­˜æ”¾ç€ä¸€ä¸ªæ•´æ•°å€¼ã€‚\n\næ‰¾å‡ºè·¯å¾„å’Œç­‰äºç»™å®šæ•°å€¼çš„è·¯å¾„æ€»æ•°ã€‚\n\nè·¯å¾„ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚\n\näºŒå‰æ ‘ä¸è¶…è¿‡1000ä¸ªèŠ‚ç‚¹ï¼Œä¸”èŠ‚ç‚¹æ•°å€¼èŒƒå›´æ˜¯ [-1000000,1000000] çš„æ•´æ•°ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nroot = [10,5,-3,3,2,null,11,3,-2,null,1], sum = 8\n      10\n     /  \\\n    5   -3\n   / \\    \\\n  3   2   11\n / \\   \\\n3  -2   1\n```\n\nè¿”å› 3ã€‚å’Œç­‰äº 8 çš„è·¯å¾„æœ‰:\n\n1.  5 -> 3\n2.  5 -> 2 -> 1\n3.  -3 -> 11\n\n**è§£æ³•ä¸€**\n\n```java\npublic int pathSum(TreeNode root, int sum) {\n    if (root == null ) {\n        return 0;\n    }\n    int res=findPath(root,sum);\n    res+=pathSum(root.left,sum);\n    res+=pathSum(root.right,sum);\n    return res;\n}\n\npublic int findPath(TreeNode node,int sum){\n    int res=0;\n    if (node==null) {\n        return res;\n    }\n    if (node.val==sum) {\n        res++;\n    }\n    res+=findPath(node.left,sum-node.val);\n    res+=findPath(node.right,sum-node.val);\n    return res;\n}\n```\n~~emmmmï¼Œè¿™é¢˜åˆ†ç±»æ˜¯easyç¡®å®å¤ªè¿·äº†ï¼ŒåµŒå¥—çš„é€’å½’ï¼Œçœ‹äº†è§£æ³•ç¡®å®çœ‹çš„æ‡‚ï¼Œä½†æ˜¯å†™æ˜¯ç»å¯¹å†™ä¸å‡ºæ¥çš„ï¼ˆçœ¼ç›ï¼šæˆ‘æ‡‚äº†ï¼Œè„‘å­ï¼šä½ æ‡‚ä¸ªé”¤å­ï¼‰é™¤éèƒ½è®°ä½~~\n\nå›å¤´æ¥çœ‹å‘ç°å…¶å®æŒºç®€å•çš„ï¼Œç¡®å®æ˜¯easyé¢˜~ ä½†æ˜¯è¿™ä¸ªè§£å¾ˆæ˜æ˜¾ä¸æ˜¯æœ€ä¼˜è§£ï¼Œè¿™ä¸ªé‡Œé¢ä¼šæœ‰å¾ˆå¤šçš„é‡å¤çš„è®¡ç®—ï¼Œæœ€ä¼˜è§£æ˜¯åˆ©ç”¨ å‰ç¼€å’Œ+å›æº¯çš„è§£æ³•ï¼Œæœ‰ç‚¹å°é¡¶~\n\n**è§£æ³•äºŒ**\n\nè¡¥ä¸Šå‰ç¼€å’Œçš„åšæ³•ï¼Œä¹‹å‰å¥½åƒæ˜¯çœ‹äº†ç­”æ¡ˆï¼Œç„¶åæ„Ÿè§‰å¾ˆéš¾ï¼Œå°±æ²¡å†™ï¼Ÿä»Šå¤©åˆé‡æ–°åšäº†ä¸‹ï¼Œå…ˆå†™äº†æš´åŠ›è§£ï¼Œç„¶åå°±ç›´æ¥å†™å‡ºäº†å‰ç¼€å’Œçš„åšæ³•ï¼Œæ„Ÿè§‰å‰ç¼€å’Œçš„æ€è·¯è¿˜æ˜¯æŒºä¼˜ç§€çš„ï¼Œä¸€å¼€å§‹å¿˜äº†å›æº¯ï¼Œæ€è€ƒäº†ä¸‹æ„è¯†åˆ°è¿™é‡Œè®°å½•çš„åº”è¯¥æ˜¯ä¸€æ¡åˆ†æ”¯ä¹‹ä¸Šè€Œä¸‹çš„å‰ç¼€å’Œï¼Œæ‰€ä»¥åœ¨ç»Ÿè®¡å®ŒæŸä¸ªèŠ‚ç‚¹ååº”è¯¥å›æº¯\n```golang\n//å‰ç¼€å’Œçš„æ€è·¯O(N)æŒºä¸é”™çš„\nfunc pathSum(root *TreeNode, sum int) int {\n    if root == nil {\n        return 0\n    }\n    var res = 0\n    //å‰ç¼€å’Œï¼Œè®°å½•ä¸€æ¡è‡ªä¸Šè€Œä¸‹çš„è·¯å¾„å‰ç¼€å’Œ\n    var preSum = make(map[int]int)\n    preSum[0] = 1\n    dfs(root, 0, sum, preSum, &res)\n    return res\n}\n\nfunc dfs(root *TreeNode, sum int, target int, preSum map[int]int, res *int) {\n    if root == nil {\n        return\n    }\n    sum += root.Val\n    //preSum[sum]++ï¼Œè¿™é‡ŒWAäº†ä¸€å‘ï¼Œå†™åœ¨ä¸Šé¢å¦‚æœtatgetä¸º0å°±æŠŠå½“å‰èŠ‚ç‚¹ç®—è¿›å»äº†\n    *res += preSum[sum-target]\n    preSum[sum]++\n    dfs(root.Left, sum, target, preSum, res)\n    dfs(root.Right, sum, target, preSum, res)\n    preSum[sum]--\n}\n\n```\n\n## [235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ](https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-search-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚\n\nç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆ**ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆ**ï¼‰\n\nä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æœç´¢æ ‘:  `root = [6,2,8,0,4,7,9,null,null,3,5]`\n\n![mark](http://static.imlgw.top/blog/20191001/KlQJmqmdWmP3.png?imageslim)\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 8\nè¾“å‡º: 6 \nè§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 8 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 6\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 4\nè¾“å‡º: 2\nè§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 2, å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚\n```\n\n**è¯´æ˜:**\n\n- æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚\n- pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æœç´¢æ ‘ä¸­ã€‚\n\n**è§£æ³•ä¸€**\n\nçœ‹äº†ä¸€ç‚¹ç‚¹æ€è·¯ï¼Œç„¶åbugfree\n\n```java\npublic TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {\n    //ç‰¹æ®Šæƒ…å†µ,å…¶ä¸­ä¸€ä¸ªå·²ç»æ˜¯å¦ä¸€ä¸ªçš„ç¥–å…ˆäº†\n    //if (p==root || q==root) return root;\n    //éƒ½å°äºæ ¹èŠ‚ç‚¹\n    if (p.val<root.val && q.val<root.val) {\n        return lowestCommonAncestor(root.left,p,q);\n    }else if (p.val > root.val && q.val > root.val) {\n        //éƒ½å¤§äºæ ¹èŠ‚ç‚¹\n        return lowestCommonAncestor(root.right,p,q);\n    }else{\n        //ä¸€å¤§ä¸€å° æˆ–è€…æœ‰ä¸€ä¸ªæ˜¯root\n        return root;\n    }\n}\n```\nå…¶å®æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨å¥½BSTçš„æ€§è´¨ï¼Œå·¦å­æ ‘ä¸€å®šå°äºæ ¹èŠ‚ç‚¹ï¼Œå³å­æ ‘ä¸€å®šå¤§äºæ ¹èŠ‚ç‚¹ï¼Œæ±‚å…¬å…±ç¥–å…ˆï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨å·¦å­æ ‘ï¼Œä¸€ä¸ªåœ¨å³å­æ ‘ï¼Œé‚£ä¹ˆæœ€è¿‘çš„å…¬å…±ç¥–å…ˆä¸€å®šæ˜¯rootï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µå°±æ˜¯å½“ä¸¤ä¸ªèŠ‚ç‚¹å·²ç»æœ‰ç¥–å…ˆå…³ç³»çš„æ—¶å€™ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç¥–å…ˆèŠ‚ç‚¹å°±å¯ä»¥äº†\n\n> è¿™é‡Œå…¶å®å‰é¢çš„`if`å¯ä»¥å»æ‰ï¼Œé¢˜ç›®ä¸­è¯´åˆ°äº†æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥èŠ‚ç‚¹å€¼ç›¸ç­‰å°±è¯´æ˜æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±å·²ç»åŒ…å«åœ¨æœ€åä¸€ä¸ªelseçš„æƒ…å†µä¸­äº†\n\n## [98. éªŒè¯äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/validate-binary-search-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚\n\nå‡è®¾ä¸€ä¸ªäºŒå‰æœç´¢æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š\n\n- èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«**å°äº**å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚\n- èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«**å¤§äº**å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚\n- æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n    2\n   / \\\n  1   3\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\n    5\n   / \\\n  1   4\n     / \\\n    3   6\nè¾“å‡º: false\nè§£é‡Š: è¾“å…¥ä¸º: [5,1,4,null,null,3,6]ã€‚\n     æ ¹èŠ‚ç‚¹çš„å€¼ä¸º 5 ï¼Œä½†æ˜¯å…¶å³å­èŠ‚ç‚¹å€¼ä¸º 4 \n```\n\n**è§£æ³•ä¸€**\n\né€’å½’è§£æ³•ï¼Œå¾ˆå·§å¦™\n\n```java\npublic boolean isValidBST(TreeNode root) {\n    if (root==null) {\n        return true;\n    }\n    return isValidBST(root,null,null);\n}\n\npublic boolean isValidBST(TreeNode node,Integer low,Integer high){\n    if (node==null) return true;\n    if (low!=null && low>=node.val || high!=null && high<=node.val) {\n        return false;\n    }\n    return isValidBST(node.left,low,node.val) && isValidBST(node.right,node.val,high);\n}\n```\nä¸€å®šè¦æ³¨æ„BSTçš„æ€§è´¨æ˜¯æ ¹èŠ‚ç‚¹**å¤§äºæ‰€æœ‰** å³å­æ ‘çš„èŠ‚ç‚¹ï¼Œ**å°äºæ‰€æœ‰**å·¦å­æ ‘çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ç®€å•çš„éªŒè¯å½“å‰èŠ‚ç‚¹å’Œå·¦å³èŠ‚ç‚¹çš„å¤§å°å…³ç³»å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨éªŒè¯çš„æ—¶å€™ä¼ å…¥å¯¹åº”çš„**ä¸Šç•Œ**å’Œ**ä¸‹ç•Œ**ï¼ŒèŠ‚ç‚¹å¿…é¡»è¦å¤§äºä¸‹ç•Œï¼Œå°äºä¸Šç•Œï¼Œé‚£ä¹ˆä¸Šç•Œå’Œä¸‹ç•Œä»å“ªé‡Œæ¥ï¼Ÿ_å½“å‰èŠ‚ç‚¹å°±æ˜¯å·¦å­æ ‘çš„ä¸Šç•Œï¼Œå³å­æ ‘çš„ä¸‹ç•Œï¼_  ç„¶åé€’å½’å·¦å³å­æ ‘å°±okäº†\n\n> è¿™é¢˜å…¶å®è¿˜æœ‰ä¸€ä¸ªå‘ï¼Œåªä¸è¿‡æˆ‘è¿™ä¸ªåšæ³•ç›´æ¥è·³è¿‡äº†ï¼Œé¢˜ç›®çš„caseä¸­æœ‰çš„èŠ‚ç‚¹å€¼æ˜¯`Integer.MIN_VALUE`ï¼Œå’Œ`Integer.MAX_VALUE`  ï¼Œå¦‚æœä¸Šç•Œä¸‹ç•Œç›´æ¥ç”¨intæ¥ä¼ é€’çš„è¯ï¼Œå¾ˆæœ‰å¯èƒ½é€’å½’åˆå§‹è°ƒç”¨å°±æ˜¯è¿™æ ·çš„\n>\n> `return isValidBST(root,Integer.MIN_VALUE,Integer.MAX_VALUE);` è¿™å°±æ­£ä¸­å‡ºé¢˜äººä¸‹æ€€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨ä¸€ä¸ªåŒ…è£…ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦æ£€æµ‹ä¸Šç•Œä¸‹ç•Œæ˜¯ä¸æ˜¯nullå°±å¯ä»¥äº†\n\n**è§£æ³•äºŒ**\n\nè¿™ä¸ªå°±åˆ©ç”¨äº†BSTå’Œä¸­åºéå†çš„å…³ç³»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸­åºéå†æ˜¯ `å·¦->æ ¹->å³`  è¿™ä¸ªé¡ºåºæ”¾åˆ° BSTä¸­æ°å¥½å°±æ˜¯ä¸€ä¸ªå‡åºçš„åºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ€§è´¨æ¥åˆ¤æ–­äºŒå‰æ ‘æ˜¯ä¸æ˜¯BST\n\n```java\n//BSTçš„ä¸­åºéå†ä¸€å®šæ˜¯å‡åºçš„\npublic boolean isValidBST(TreeNode root){\n    LinkedList<Integer> order=new LinkedList<>();\n    if (root==null) {\n        return true;\n    }\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root;\n    while(cur!=null || !stack.isEmpty()){\n        while(cur!=null){\n            stack.add(cur);\n            cur=cur.left;\n        }\n        cur=stack.pop();\n        //å’Œä¸Šä¸€æ¬¡çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹å€¼æ¯”è¾ƒ\n        if (!order.isEmpty() && order.getLast()>= cur.val) {\n            return false;\n        }\n        order.add(cur.val);\n        cur=cur.right;\n    }\n    return true;\n}\n```\nè¿™é‡Œå…¶å®å¯ä»¥ä¸ç”¨listä¿å­˜ç»“æœï¼Œ~~ç”¨ä¸€ä¸ªintä¿å­˜ä¸Šä¸€æ¬¡çš„èŠ‚ç‚¹å€¼å°±è¡Œäº†~~ mdé‡åšçš„æ—¶å€™å› ä¸ºè¿™ä¸ªWAäº†å¥½å‡ æ¬¡ï¼Œå¦‚æœç”¨intçš„è¯éœ€è¦åŠ ä¸€ä¸ªæ ‡å¿—ä½ç”¨æ¥åˆå§‹åŒ–\n\n## [958. äºŒå‰æ ‘çš„å®Œå…¨æ€§æ£€éªŒ](https://leetcode-cn.com/problems/check-completeness-of-a-binary-tree/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œç¡®å®šå®ƒæ˜¯å¦æ˜¯ä¸€ä¸ª_å®Œå…¨äºŒå‰æ ‘_ã€‚\n\n**ä¸­å¯¹å®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å¦‚ä¸‹ï¼š**\n\nè‹¥è®¾äºŒå‰æ ‘çš„æ·±åº¦ä¸º hï¼Œé™¤ç¬¬ h å±‚å¤–ï¼Œå…¶å®ƒå„å±‚ (1ï½h-1) çš„ç»“ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§ä¸ªæ•°ï¼Œç¬¬ h å±‚æ‰€æœ‰çš„ç»“ç‚¹éƒ½è¿ç»­é›†ä¸­åœ¨æœ€å·¦è¾¹ï¼Œè¿™å°±æ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚ï¼ˆæ³¨ï¼šç¬¬ h å±‚å¯èƒ½åŒ…å« 1~Â 2<sup>h</sup>Â ä¸ªèŠ‚ç‚¹ã€‚ï¼‰\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/15/complete-binary-tree-1.png)\n\n```go\nè¾“å…¥ï¼š[1,2,3,4,5,6]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šæœ€åä¸€å±‚å‰çš„æ¯ä¸€å±‚éƒ½æ˜¯æ»¡çš„ï¼ˆå³ï¼Œç»“ç‚¹å€¼ä¸º {1} å’Œ {2,3} çš„ä¸¤å±‚ï¼‰ï¼Œä¸”æœ€åä¸€å±‚ä¸­çš„æ‰€æœ‰ç»“ç‚¹ï¼ˆ{4,5,6}ï¼‰éƒ½å°½å¯èƒ½åœ°å‘å·¦ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n**![](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/15/complete-binary-tree-2.png)**\n\n```go\nè¾“å…¥ï¼š[1,2,3,4,5,null,7]\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šå€¼ä¸º 7 çš„ç»“ç‚¹æ²¡æœ‰å°½å¯èƒ½é å‘å·¦ä¾§ã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  æ ‘ä¸­å°†ä¼šæœ‰ 1 åˆ° 100 ä¸ªç»“ç‚¹ã€‚\n\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹æ€è·¯å‡ºç°äº†é—®é¢˜ï¼Œæƒ³ç€å»æŒ‰ç…§èŠ‚ç‚¹ä¸ªæ•°å»æ ¡éªŒï¼Œç„¶åå¯¹æœ€åä¸€å±‚åšç‰¹åˆ¤ï¼Œç„¶åå‘ç°è¿™ç§æ€è·¯æ˜¯æ­»èƒ¡åŒï¼Œå®é™…ä¸Šåˆ¤æ–­æ˜¯å¦æ˜¯å®Œå…¨äºŒå‰æ ‘å¾ˆç®€å•ï¼Œåªè¦èŠ‚ç‚¹**ä¸­é—´**æ²¡æœ‰å‡ºç°nullå°±è¯´æ˜æ˜¯å®Œå…¨äºŒå‰æ ‘\n```java\npublic boolean isCompleteTree(TreeNode root) {\n    if (root == null) {\n        return true;\n    }\n    Queue<TreeNode> queue = new LinkedList<>();\n    queue.add(root);\n    TreeNode pre = root;\n    while(!queue.isEmpty()){\n        TreeNode cur = queue.poll();\n        //å½“å‰èŠ‚ç‚¹å‰é¢å‡ºç°äº†null\n        if (pre==null && cur!=null){\n            return false;\n        }\n        if (cur!=null) {\n            //å› ä¸ºè¦åˆ¤æ–­nullæ˜¯å¦åœ¨ä¸­é—´ï¼Œæ‰€ä»¥nullèŠ‚ç‚¹ä¹Ÿè¦å­˜è¿›å»\n            queue.add(cur.left);\n            queue.add(cur.right);\n        }\n        pre = cur;\n    }\n    return true;\n}\n```\n\n## [108. å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/convert-sorted-array-to-binary-search-tree/)\n\nå°†ä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æœ‰åºæ•°ç»„ï¼Œè½¬æ¢ä¸ºä¸€æ£µ**é«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘**\n\næœ¬é¢˜ä¸­ï¼Œä¸€ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æ ‘æ˜¯æŒ‡ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nç»™å®šæœ‰åºæ•°ç»„: [-10,-3,0,5,9]\nä¸€ä¸ªå¯èƒ½çš„ç­”æ¡ˆæ˜¯ï¼š[0,-3,9,-10,null,5]ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸‹é¢è¿™ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼š\n      0\n     / \\\n   -3   9\n   /   /\n -10  5\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic TreeNode sortedArrayToBST(int[] nums) {\n    return sortedArrayToBST(nums,0,nums.length-1);\n}\n\npublic TreeNode sortedArrayToBST(int[] nums,int left,int right) {\n    if (left>right) {\n        return null;\n    }\n    int mid=(right-left)/2+left;\n    TreeNode node=new TreeNode(nums[mid]);\n    node.left=sortedArrayToBST(nums,left,mid-1);\n    node.right=sortedArrayToBST(nums,mid+1,right);\n    return node;\n}\n```\nè¿™é¢˜æœ€å¼€å§‹ç»ˆæ­¢æ¡ä»¶å†™é”™äº†ï¼Œæ€è·¯æ˜¯å¯¹çš„ï¼Œå¯¹é€’å½’è¿ç”¨çš„è¿˜æ˜¯ä¸å¤Ÿç†Ÿç»ƒï¼Œç»ˆæ­¢æ¡ä»¶å…¶å®åªéœ€è¦æƒ³ä¸€ä¸‹æç«¯æƒ…å†µå°±å¯ä»¥äº†\n\n## [109. æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/convert-sorted-list-to-binary-search-tree/)\n\nç»™å®šä¸€ä¸ªå•é“¾è¡¨ï¼Œå…¶ä¸­çš„å…ƒç´ æŒ‰å‡åºæ’åºï¼Œå°†å…¶è½¬æ¢ä¸ºé«˜åº¦å¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ã€‚\n\næœ¬é¢˜ä¸­ï¼Œä¸€ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æ ‘æ˜¯æŒ‡ä¸€ä¸ªäºŒå‰æ ‘*æ¯ä¸ªèŠ‚ç‚¹* çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ã€‚\n\n**ç¤ºä¾‹:**\n\n```sql\nç»™å®šçš„æœ‰åºé“¾è¡¨ï¼š [-10, -3, 0, 5, 9],\n\nä¸€ä¸ªå¯èƒ½çš„ç­”æ¡ˆæ˜¯ï¼š[0, -3, 9, -10, null, 5], å®ƒå¯ä»¥è¡¨ç¤ºä¸‹é¢è¿™ä¸ªé«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼š\n\n      0\n     / \\\n   -3   9\n   /   /\n -10  5\n```\n\n**è§£æ³•ä¸€**\n\n~~BSTä¸å¤ªç†Ÿçœ‹äº†ä¸‹è¯„è®ºå†™å‡ºæ¥çš„~~\n\nå¥½ä¹…ä¹‹å‰å†™çš„é¢˜äº†ï¼Œæ¯æ—¥æ‰“å¡é¢˜å‡ºäº†ä¸Šé¢çš„é¢˜ç›®ï¼Œéšä¾¿åšä¸€ä¸‹è¿™é¢˜ï¼Œå‘ç°è¿™é¢˜è¢«è®°å½•åœ¨é“¾è¡¨ä¸“é¢˜ä¸­äº†ï¼Œç§»è¿‡æ¥ä¸‹ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·ï¼Œåªä¸è¿‡æ‰¾ä¸­ç‚¹çš„æ–¹å¼ä¸ä¸€æ ·ï¼ˆUPDATE: 2020.7.3ï¼‰\n\n```java\npublic TreeNode sortedListToBST(ListNode head) {\n    return build(head,null);\n}\n\npublic static TreeNode build(ListNode head,ListNode tail){\n    if(head==tail){\n        return null;\n    }\n    //å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹\n    ListNode fast=head,slow=head;\n    while(fast!=tail&&fast.next!=tail){\n        //å·¦é—­å³å¼€\n        fast=fast.next.next;\n        slow=slow.next;\n    }\n    //slowä¸ºä¸­ç‚¹æˆ–ä¸­ç‚¹åä¸€ä¸ª\n    //1 2 3 4\n    TreeNode root=new TreeNode(slow.val);\n    root.left=build(head,slow);\n    root.right=build(slow.next,tail);\n    return root;\n}\n```\n**UPDATE: 2020.7.3**\n```golang\nfunc sortedListToBST(head *ListNode) *TreeNode {\n    if head == nil{\n        return nil\n    }\n    if head.Next == nil{\n        return &TreeNode{Val : head.Val}\n    }\n    var fast = head\n    var slow = head //slowä¸ºå·¦ä¸­ç‚¹\n    var pre  = head\n    for fast != nil && fast.Next !=nil{\n        fast = fast.Next.Next\n        pre = slow\n        slow = slow.Next\n    }\n    pre.Next = nil //æ–©æ–­å’Œslowçš„è”ç³»\n    root := &TreeNode{Val : slow.Val}\n    root.Left = sortedListToBST(head)\n    root.Right = sortedListToBST(slow.Next)\n    return root\n}\n```\n\n## [230. äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ ](https://leetcode-cn.com/problems/kth-smallest-element-in-a-bst/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•° `kthSmallest` æ¥æŸ¥æ‰¾å…¶ä¸­ç¬¬ k ä¸ªæœ€å°çš„å…ƒç´ \n\n**è¯´æ˜ï¼š**\nä½ å¯ä»¥å‡è®¾ k æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œ1 â‰¤ k â‰¤ äºŒå‰æœç´¢æ ‘å…ƒç´ ä¸ªæ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: root = [3,1,4,null,2], k = 1\n   3\n  / \\\n 1   4\n  \\\n   2\nè¾“å‡º: 1\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: root = [5,3,6,2,4,null,null,1], k = 3\n       5\n      / \\\n     3   6\n    / \\\n   2   4\n  /\n 1\nè¾“å‡º: 3\n```\n\n\n**è¿›é˜¶ï¼š**\nå¦‚æœäºŒå‰æœç´¢æ ‘ç»å¸¸è¢«ä¿®æ”¹ï¼ˆæ’å…¥/åˆ é™¤æ“ä½œï¼‰å¹¶ä¸”ä½ éœ€è¦é¢‘ç¹åœ°æŸ¥æ‰¾ç¬¬ k å°çš„å€¼ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ– kthSmallest å‡½æ•°ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\néé€’å½’ä¸­åºéå†\n\n```java\npublic int kthSmallest(TreeNode root, int k) {\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root;\n    int count=0;\n    while(cur!=null || !stack.isEmpty()){\n        while(cur!=null){\n            stack.add(cur);\n            cur=cur.left;\n        }\n        cur=stack.pop();\n        if (count==k-1) {\n            return cur.val;\n        }\n        cur=cur.right;\n        count++;\n    }\n    //æ²¡æ‰¾åˆ°\n    return -1;\n}\n```\nè¿˜æ˜¯åˆ©ç”¨BSTä¸­åºéå†æ˜¯å‡åºçš„æ€§è´¨ï¼Œåœ¨å–åˆ°ç¬¬kä¸ªå…ƒç´ çš„æ—¶å€™å°±ç›´æ¥`break`\n\n**è§£æ³•äºŒ**\n\né€’å½’çš„æ–¹å¼ï¼ŒåŠ äº†ä¸¤ä¸ªé¢å¤–çš„å®ä¾‹å˜é‡å…¶å®ä¸å¤ªå¥½\n\n```java\npublic int kthSmallest(TreeNode root, int k) {\n    kthSmallest(root,k);\n    return res;\n}\n\nprivate int count=0;\n\nprivate int res=0;\n\npublic void kthSmall(TreeNode root, int k) {\n    if (root==null) {\n        return;\n    }\n    kthSmall(root.left,k);\n    if (count==k-1) {\n        res=root.val;\n        return;\n    }\n    count++;\n    kthSmall(root.right,k);\n}\n```\nå¦‚æœæ˜¯ç¬¬Kå¤§å°±äº¤æ¢ä¸‹éå†é¡ºåºå°±è¡Œäº†\n```golang\nfunc kthLargest(root *TreeNode, k int) int {\n    var res = root.Val\n    var count = 0\n    var dfs func(*TreeNode)\n    dfs = func(root *TreeNode){\n        if root == nil{\n            return\n        }\n        //å…ˆright\n        dfs(root.Right)\n        count++\n        if count == k{\n            res = root.Val\n        }\n        dfs(root.Left)\n    }\n    dfs(root)\n    return res\n}\n```\n**è¿›é˜¶**\n\nå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå¤§æ ¹å †ï¼Œå°±å’Œæœ€å°æ ˆä¸€æ ·ï¼Œæ¯æ¬¡å¯¹BSTæ“ä½œçš„æ—¶å€™åŒæ­¥æ“ä½œè¿™ä¸ªå¤§æ ¹å †\n\n## [236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ](https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚\n\nç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€\n\nä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘:  root = [3,5,1,6,2,0,8,null,null,7,4]\n\n ![mark](http://static.imlgw.top/blog/20191003/m0bWNSMUQWy2.png?imageslim)\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1\nè¾“å‡º: 3\nè§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4\nè¾“å‡º: 5\nè§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚\n```\n\n**è¯´æ˜:**\n\n- æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚\n- pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {\n    if(root==null || root==p || root==q) return root; \n    TreeNode left=lowestCommonAncestor(root.left,p,q);\n    TreeNode right=lowestCommonAncestor(root.right,p,q);\n    if(left==null){\n        return right;\n    }else if(right==null){\n        return left;\n    }\n    return root;\n}\n```\n\nè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æœ‰ä¸‰ä¸ªï¼šç»™å®šä¸¤ä¸ªèŠ‚ç‚¹ pp å’Œ qq\n\n- å¦‚æœ pp å’Œ qq éƒ½å­˜åœ¨ï¼Œåˆ™è¿”å›å®ƒä»¬çš„å…¬å…±ç¥–å…ˆ\n- å¦‚æœåªå­˜åœ¨ä¸€ä¸ªï¼Œåˆ™è¿”å›å­˜åœ¨çš„ä¸€ä¸ª\n- å¦‚æœ pp å’Œ qq éƒ½ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›NULL \n\n**è§£æ³•äºŒ**\n\n2020.4.9æ–°å¢è§£æ³•ï¼Œåˆ©ç”¨Mapè®°å½•çˆ¶èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®p,qå€’æ¨å°±è¡Œäº†\n\n```java\n//update: 2020.5.10åŸæ¥ç”¨çš„TreeNodeåšé”®ï¼Œå±…ç„¶èƒ½è¿‡ä¹Ÿæ˜¯å¾ˆç¥å¥‡ï¼Œæˆ‘è¯•äº†ä¸‹ï¼ŒTreeNodeåº”è¯¥æ˜¯æ²¡æœ‰è¦†ç›–equalsçš„\n//æ‰€ä»¥è¦æ˜¯ç¢°æ’çš„å¤Ÿå¤šï¼Œé‚£ç§åšæ³•å°±é”™äº†\npublic TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {\n    if (root == null || p==root ||q==root) {\n        return root;\n    }\n    Deque<TreeNode> stack=new ArrayDeque<>();\n    //é¢˜ç›®è¯´äº†å€¼å”¯ä¸€ï¼Œæ‰€ä»¥å¯ä»¥ç”¨Integerå½“é”®\n    HashMap<Integer,TreeNode> map=new HashMap<>();\n    map.put(root.val,null); //æ ¹èŠ‚ç‚¹\n    stack.push(root);\n    while(!stack.isEmpty()){\n        TreeNode cur=stack.poll();\n        if(cur.right!=null){\n            stack.push(cur.right);\n            map.put(cur.right.val,cur);\n        }\n        if(cur.left!=null){\n            stack.push(cur.left);\n            map.put(cur.left.val,cur);\n        }\n    }\n    HashSet<Integer> set=new HashSet<>();\n    while(p!=null){\n        set.add(p.val);\n        p=map.get(p.val);\n    }\n    while(!set.contains(q.val)){\n        q=map.get(q.val);\n    }\n    return q;\n}\n```\n## [101. å¯¹ç§°äºŒå‰æ ‘](https://leetcode-cn.com/problems/symmetric-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„ã€‚\n\nä¾‹å¦‚ï¼ŒäºŒå‰æ ‘ `[1,2,2,3,4,4,3]` æ˜¯å¯¹ç§°çš„\n\n```java\n    1\n   / \\\n  2   2\n / \\ / \\\n3  4 4  3\n```\n\n\nä½†æ˜¯ä¸‹é¢è¿™ä¸ª `[1,2,2,null,3,null,3]` åˆ™ä¸æ˜¯**é•œåƒå¯¹ç§°**çš„:\n\n```java\n    1\n   / \\\n  2   2\n   \\   \\\n   3    3\n```\n\n**è¯´æ˜:**\n\nå¦‚æœä½ å¯ä»¥è¿ç”¨é€’å½’å’Œè¿­ä»£ä¸¤ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¼šå¾ˆåŠ åˆ†ã€‚\n\n**è§£æ³•ä¸€**\n\nå“ï¼Œæ„Ÿè§‰åˆ·é¢˜è¿˜æ˜¯å¾—åœ¨ç™½å¤©ï¼Œè„‘å­æ¸…é†’ç‚¹ï¼Œä¸‹åˆå°±æ„Ÿè§‰åšé¢˜è€æ˜¯å‡ºé—®é¢˜ï¼Œä¸€å¼€å§‹é¢˜éƒ½æ²¡çœ‹æ¸…å°±å¼€å§‹åš\n\nå…¶å®ä¸€å¼€å§‹æ˜¯æƒ³BFSå±‚æ¬¡éå†ç„¶ååˆ¤æ–­æ¯ä¸€å±‚æ˜¯ä¸æ˜¯é•œåƒå¯¹ç§°çš„ï¼Œç„¶åå‘ç°æœ‰äº›caseæ˜¯è¿‡ä¸äº†çš„ï¼Œæ¯”å¦‚\n\n`[1,3,3,2,null,2]` è¿™æ ·çš„case\n\n```java\n    1\n   / \\\n  3   3\n /   /\n2   2\n```\n\n~~å±‚åºéå†åˆ¤æ–­ä¸å‡ºäº†è¿™æ ·çš„case~~   ä¸‹é¢è§£æ³•å››æ‰“è„¸\n\nç„¶åæ¢ä¸€ç§éå†æ–¹å¼ï¼Œå…¶å®ä¸€å¼€å§‹å°±æƒ³åˆ°äº†å‰åºéå†ï¼Œå¦‚æœæ˜¯é•œåƒå¯¹ç§°çš„è¯ï¼Œå‰åºéå†åˆšå¥½å°±æ˜¯å¯¹ç§°çš„ï¼Œä½†æ˜¯ï¼ï¼ï¼è¿˜æ˜¯æœ‰caseè¿‡ä¸äº†ï¼ï¼ï¼æˆ‘ä»¬å†çœ‹ä¸Šé¢çš„caseï¼Œæˆ‘ä»¬æ”¹ä¸€æ”¹\n\n```java\n    1\n   / \\\n  2   2\n /   /\n2   2\n```\n\nç¬¬`192/195ä¸ªcase`ï¼Œæˆ‘æƒŠäº†ï¼Œå±…ç„¶è¿˜æœ‰è¿™ç§æ“ä½œï¼ï¼ï¼å®åœ¨æ²¡åŠæ³•ç¿»äº†ä¸‹è§£ç­”ï¼Œå‘ç°æœ‰ä½è€å…„ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œç„¶åä»–å¾ˆå·§å¦™çš„åœ¨æ¯ä¸ªèŠ‚ç‚¹å€¼åé¢åŠ äº†ä¸€ä¸ª**å±‚æ•°**ï¼Œä»–å¥½åƒæ˜¯ç›´æ¥å½“ä½œå­—ç¬¦ä¸²æ·»åŠ çš„ï¼Œæˆ‘æ„Ÿè§‰ä¸å¤ªå¥½ï¼Œæ”¹ç”¨äº†æ•°ç»„ï¼Œæœ€ååˆ¤æ–­çš„æ—¶å€™éœ€è¦ä¿è¯å±‚æ•°å’Œå€¼éƒ½ç›¸åŒæ‰è¡Œï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹\n\n```java\n//[1,2,2,2,null,2] å¿˜äº†è¿˜æœ‰è¿™æ ·çš„caseäº†,å“­äº†\npublic boolean isSymmetric(TreeNode root) {\n    if (root == null) {\n        return true;\n    }\n    List<Integer[]> lis=new ArrayList<>();\n    preTravle(root,lis,0); \n    for (int i=0,j=lis.size()-1;i<=j;i++,j--) {\n        if (lis.get(i)[0]!= lis.get(j)[0] ||  lis.get(j)[1]!= lis.get(i)[1]) {\n            return false;\n        }\n    }\n    return true;\n}\n\n//å‰åºéå†\npublic void preTravle(TreeNode node,List<Integer[]> lis,int k){\n    if (node!=null) {\n        preTravle(node.left,lis,k+1);\n        //è¿™é‡Œå…¶å®ç”¨ä¸ªå­—ç¬¦ä¸²å°±å¯ä»¥ï¼Œä½†æ˜¯æ„Ÿè§‰æ‹¼æ¥çš„æ•ˆç‡ä¸é«˜ï¼Œè€Œä¸”ï¼Œæ˜¯ä¸æ˜¯æœ‰å¯èƒ½å‡ºç°é—®é¢˜ï¼Ÿ\n        // 11+3 ==1+13 ï¼Ÿï¼Ÿï¼Ÿæ˜¯ä¸æ˜¯æœ‰å¯èƒ½å‡ºç°ç±»ä¼¼è¿™æ ·çš„æƒ…å†µ\n        Integer[] temp=new Integer[2];\n        temp[0]=node.val;\n        temp[1]=k;\n        lis.add(temp);\n        preTravle(node.right,lis,k+1);\n    }\n}\n```\n\n**è§£æ³•äºŒ**\n\né€’å½’çš„è§£æ³•ï¼Œåº”è¯¥ç®—æ˜¯å®˜è§£äº†ï¼Œä¸€å¼€å§‹ä¹Ÿæ˜¯æƒ³ç”¨é€’å½’å†™çš„ï¼Œæ²¡æŠ“ä½é—®é¢˜çš„æœ¬è´¨ï¼Œå¤ªèœäº†\n\n```java\npublic boolean isSymmetric(TreeNode root) {\n    if (root ==null) {\n        return true;\n    }\n    //è½¬æ¢ä¸ºæ±‚å·¦å³å­æ ‘æ˜¯å¦é•œåƒå¯¹ç§°çš„é—®é¢˜\n    return isSymmetric(root.left,root.right);\n    //return isSymmetric(root,root);\n}\n\n//dfs\npublic boolean isSymmetric(TreeNode t1,TreeNode t2) {\n    if (t1==null && t2==null) {\n        return true;\n    }\n    //æœ‰ä¸€ä¸ªä¸ºnull\n    if (t1== null || t2==null) {\n        return false;\n    }\n    //éƒ½ä¸ä¸ºnull\n    return t1.val==t2.val && isSymmetric(t1.left,t2.right) && isSymmetric(t1.right,t2.left);\n}\n```\nä¸€æ£µæ ‘æ˜¯é•œåƒå¯¹ç§°ï¼Œè¯´æ˜å·¦å³å­æ ‘å·¦å³å¯¹ç§°ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜å°±å¯ä»¥è½¬æ¢ä¸ºï¼Œåˆ¤æ–­å·¦å³ä¸¤é¢—å­æ ‘æ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„é—®é¢˜\n\n![mark](http://static.imlgw.top/blog/20191107/Ae6daB6SuXdl.png?imageslim)\n\nåˆ¤æ–­ä¸¤é¢—æ ‘æ˜¯å¦æˆé•œåƒå¯¹ç§°çš„è¯ï¼Œå…¶å®å°±å’Œç…§é•œå­ä¸€æ ·çš„ï¼Œå¦‚ä¸Šå›¾ï¼Œåˆ¤æ–­å·¦å­æ ‘å’Œå³å­æ ‘æ˜¯å¦æˆé•œåƒå¯¹ç§°ï¼Œå°±éœ€è¦åˆ¤æ–­**t1çš„å·¦å­æ ‘å’Œt2çš„å³å­æ ‘æ˜¯å¦é•œåƒå¯¹ç§°,t1çš„å³å­æ ‘å’Œt2çš„å·¦å­æ ‘æ˜¯å¦é•œåƒå¯¹ç§°**ï¼Œæ ¹æ®è¿™ä¸ªå°±å¯ä»¥å†™å‡ºé€’å½’å‡½æ•°ï¼Œè¿˜æ˜¯æŒºå¦™çš„\n\n**è§£æ³•ä¸‰**\n\nç±»ä¼¼äºå±‚æ¬¡éå†ï¼Œå…¶å®å°±æ˜¯æ ¹æ®ä¸Šé¢çš„é€’å½’æ–¹æ³•æ”¹æ¥çš„ï¼Œæ ¸å¿ƒæ€æƒ³å’Œä¸Šé¢é€’å½’çš„æ˜¯ä¸€æ ·çš„\n\n```java\n//éé€’å½’è§£æ³•\npublic boolean isSymmetric(TreeNode root) {\n    if (root ==null) {\n        return true;\n    }\n    Stack<TreeNode> stack=new Stack<>();\n    stack.push(root.left);\n    stack.push(root.right);\n    while(!stack.isEmpty()){\n        TreeNode t1=stack.pop();\n        TreeNode t2=stack.pop();\n        if (t1==null && t2==null) {\n            continue;\n        }\n        if (t1==null||t2==null || t1.val!=t2.val) {\n            return false;\n        }\n        /*if (t1.val!=t2.val) {\n                return false;\n         }*/\n        stack.push(t1.left);\n        stack.push(t2.right);\n        stack.push(t1.right);\n        stack.push(t2.left);\n    }\n    return true;\n}       \n```\n\n**è§£æ³•å››**\n\nå‰åºéå†ï¼Œå…¶å®æˆ‘ä¸€å¼€å§‹ä¹Ÿæƒ³åˆ°äº†ç”¨å ä½çš„æ–¹å¼ï¼Œä½†æ˜¯å› ä¸ºä¹‹å‰éå†æ–¹å¼ä¸åŒï¼Œå¯¼è‡´æ²¡æƒ³å¥½åœ¨å“ªé‡ŒåŠ \n\n```java\npublic boolean isSymmetric(TreeNode root) {\n    if (root ==null) {\n        return true;\n    }\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        int count=queue.size();\n        ArrayList<Integer> lis=new ArrayList<>();\n        while(count>0){\n            TreeNode node=queue.poll();\n            //lis.add(node.val);\n            if (node.left!=null) {\n                queue.add(node.left);\n                lis.add(node.left.val);\n            }else{\n                //-1å ä½\n                lis.add(-1);\n            }\n            \n            if (node.right!=null) {\n                queue.add(node.right);\n                lis.add(node.right.val);\n            }else{\n                //ä¸ºç©ºåŠ -1å ä½\n                lis.add(-1);\n            }\n            count--;\n        }\n        //å¯¹æ¯ä¸€å±‚ç»å¸¸åˆ¤æ–­\n        for (int i=0,j=lis.size()-1;i<=j;i++,j--) {\n            if (lis.get(i)!=lis.get(j)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n```\nè¿™æ ·çš„åšæ³•æ˜æ˜¾æ—¶é—´å¤æ‚åº¦ä¼šä¹‹å‰è¦é«˜ï¼Œä¸ä»…éå†äº†æ•´é¢—æ ‘ä¸€éï¼Œè¿˜å¯¹æ¯ä¸€å±‚éå†äº†ä¸€éï¼Œä¸€å…±éå†äº†ä¸¤é\n\n## [513. æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼](https://leetcode-cn.com/problems/find-bottom-left-tree-value/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåœ¨æ ‘çš„æœ€åä¸€è¡Œæ‰¾åˆ°æœ€å·¦è¾¹çš„å€¼ã€‚\n\nç¤ºä¾‹ 1:\n```java\nè¾“å…¥:\n    2\n   / \\\n  1   3\nè¾“å‡º:\n1\n```\n\nç¤ºä¾‹ 2:\n```java\nè¾“å…¥:\n        1\n       / \\\n      2   3\n     /   / \\\n    4   5   6\n       /\n      7\nè¾“å‡º:\n7\n```\n**æ³¨æ„:** æ‚¨å¯ä»¥å‡è®¾æ ‘ï¼ˆå³ç»™å®šçš„æ ¹èŠ‚ç‚¹ï¼‰ä¸ä¸º NULLã€‚\n\n**è§£æ³•ä¸€**\n\nè¿™ç§é¢˜å†™ä¸€ç™¾éäº†ğŸ˜‚ï¼Œç„¶è€Œæˆ‘è¿˜æ˜¯æ²¡æœ‰bugfree\n\n```java\n//å…¶å®è¿™ç§å±‚åºéå†çš„æ–¹å¼å¯¹è¿™é¢˜æœ‰ä¸€ç‚¹å°é¢˜å¤§ä½œï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æ¯”è¾ƒä¹ æƒ¯è¿™ç§æ–¹å¼\npublic int findBottomLeftValue(TreeNode root) {\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    int res=-1;\n    while(!queue.isEmpty()){\n        int count=queue.size();\n        int temp=count;\n        while(count>0){\n            TreeNode node=queue.poll();\n            if (count==temp) {\n                res=node.val;\n            }\n            if (node.left!=null) {\n                queue.add(node.left);\n            }\n            if (node.right!=null) {\n                queue.add(node.right);\n            }\n            count--;\n        }\n    }\n    return res;   \n}\n```\n**è§£æ³•äºŒ**\n\næœ€å·¦è¾¹çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œdfsæ·±åº¦ä¼˜å…ˆï¼Œæ·±åº¦æ¯å¢åŠ ä¸€æ¬¡å°±æ›´æ–°ä¸€æ¬¡res\n\n```java\n//DFS\npublic int findBottomLeftValue2(TreeNode root) {\n    dfs(root,0);\n    return res;\n}\n\nint res=-1,max=Integer.MIN_VALUE;\n\npublic void dfs(TreeNode node,int depth){\n    if (node==null) return;\n    if (depth>max) {\n        max=depth;\n        res=node.val;\n    }\n    dfs(node.left,depth+1);\n    dfs(node.right,depth+1);\n}\n```\n\n## [105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘](https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/)\n\næ ¹æ®ä¸€æ£µæ ‘çš„å‰åºéå†ä¸ä¸­åºéå†æ„é€ äºŒå‰æ ‘ã€‚\n\n**æ³¨æ„:**\nä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚\n\nä¾‹å¦‚ï¼Œç»™å‡º\n\n```java\nå‰åºéå† preorder = [3,9,20,15,7]\nä¸­åºéå† inorder = [9,3,15,20,7]\n```\n\n\nè¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n**è§£æ³•ä¸€**\n\n```java\npublic TreeNode buildTree(int[] preorder, int[] inorder) {\n    if (preorder==null) {\n        return null;\n    }\n    return buildTree(preorder,0,preorder.length-1,inorder,0,inorder.length-1);\n}\n\npublic TreeNode buildTree(int[] preorder,int preleft,int preright,int[] inorder,int inleft,int inright) {\n    //é€’å½’å‡ºå£åªéœ€è¦æƒ³ä¸€ä¸‹è¾¹ç•Œ,æ¯”å¦‚åªè¦ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™,å¾ˆæ˜æ˜¾åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™è¿™å‡ ä¸ªå€¼éƒ½æ˜¯ 0\n    //ä½†æ˜¯æ­¤æ—¶è‚¯å®šä¸èƒ½è¿”å›null,æ‰€ä»¥è¿™é‡Œé€’å½’å‡ºå£ä¸æ˜¯å¤§äºç­‰äº,è€Œæ˜¯å¤§äº\n    if (preleft>preright || inleft>inright) {\n        return null;\n    }\n    TreeNode root=new TreeNode(preorder[preleft]);\n    int index=inleft;\n    while(inorder[index] != preorder[preleft]) {\n        index++;\n    }\n    root.left=buildTree(preorder,preleft+1,preleft+index-inleft,inorder,inleft,index-1);\n    root.right=buildTree(preorder,preleft+index-inleft+1,preright,inorder,index+1,inright);\n    return root;\n}\n```\nè¿™é¢˜æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨è¿™å‡ ç§éå†çš„æ€§è´¨ï¼Œæ–‡å­—æ€»æ˜¯è‹ç™½çš„ï¼Œçœ‹ä¸ªå›¾å§\n\n![mark](http://static.imlgw.top/blog/20191106/pcmvnEK8Hwg8.png?imageslim)\n\nè¿™æ ·ä¸€çœ‹å°±æ¸…æ™°äº†ï¼Œå‰åºéå†å·¦è¾¹ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ `1` ä¸€å®šæ˜¯æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆç¡®å®šäº†æ ¹èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬å»ä¸­åºéå†ä¸­å»æ‰¾è¿™ä¸ªæ ¹èŠ‚ç‚¹ï¼ˆä¸€å®šæœ‰ï¼‰ï¼Œå¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸­é—´çš„ `1`ç„¶åå†æ ¹æ®ä¸­åºéå†çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å°±çŸ¥é“ï¼Œä¸­åºéå†ä¸­ï¼Œè¿™ä¸ª`1` çš„å·¦è¾¹æ˜¯ `1` çš„å·¦å­æ ‘ï¼Œå³è¾¹æ˜¯`1` çš„å³å­æ ‘ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±ç¡®å®šäº†æ ¹èŠ‚ç‚¹åŠå…¶å·¦å³å­æ ‘ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™é€’å½’å»å®Œæˆäº†ğŸ˜ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å·¦å³å­æ ‘åˆ†åˆ«é€’å½’è¯¥è¿‡ç¨‹å°±å¯ä»¥å¾—åˆ°ä¸€é¢—å®Œæ•´çš„æ ‘äº†\n\nå½“ç„¶è¿™é‡Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ä¸‹æ ‡çš„å˜æ¢ï¼Œè¦ååˆ†æ³¨æ„ï¼Œè‡ªå·±å¸¦å…¥å‡ ä¸ªå€¼è¯•è¯•\n\n**UPDATE(2020.5.22)**\n\n```go\nvar m map[int]int\n\nfunc buildTree(preorder []int, inorder []int) *TreeNode {\n    n:=len(inorder)\n    //m:=make(map[int]int,n) é ï¼è¿™ä¸ªbugçœ‹äº†åŠå¤©\n    m=make(map[int]int,n)\n    for i,val:=range inorder{\n        m[val]=i\n    }\n    return build(preorder,0,n-1,inorder,0,n-1)\n}\n\nfunc build(pre []int,pl int,pr int,in []int,il int,ir int) *TreeNode{\n    if pl>pr || il>ir{\n        return nil\n    }\n    root:=&TreeNode{Val:pre[pl]}\n    idx:=m[pre[pl]]\n    root.Left=build(pre,pl+1,pl+idx-il,in,il,idx-1)\n    root.Right=build(pre,pl+idx-il+1,pr,in,idx+1,ir)\n    return root\n}\n```\n\n## [106. ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘](https://leetcode-cn.com/problems/construct-binary-tree-from-inorder-and-postorder-traversal/)\n\næ ¹æ®ä¸€æ£µæ ‘çš„ä¸­åºéå†ä¸ååºéå†æ„é€ äºŒå‰æ ‘ã€‚\n\n**æ³¨æ„:**\nä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚\n\nä¾‹å¦‚ï¼Œç»™å‡º\n\n```java\nä¸­åºéå† inorder = [9,3,15,20,7]\nååºéå† postorder = [9,15,7,20,3]\n```\n\n\nè¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n**è§£æ³•ä¸€**\n\næ–¹æ³•åŒä¸Šï¼Œåªä¸è¿‡æ˜¯ä»åå¾€å‰äº†\n\n```java\npublic TreeNode buildTree(int[] inorder, int[] postorder) {\n    if (inorder==null || inorder.length<=0) {\n        return null;\n    }\n    return buildTree(inorder,0,inorder.length-1,postorder,0,postorder.length-1);\n}\n\npublic TreeNode buildTree(int[] inorder,int inL,int inR, int[] postorder,int pL,int pR) {\n    //é€’å½’å‡ºå£åªéœ€è¦æƒ³ä¸€ä¸‹è¾¹ç•Œ,æ¯”å¦‚åªè¦ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™,å¾ˆæ˜æ˜¾åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™è¿™å‡ ä¸ªå€¼éƒ½æ˜¯0\n    //ä½†æ˜¯æ­¤æ—¶è‚¯å®šä¸èƒ½è¿”å›null,æ‰€ä»¥è¿™é‡Œé€’å½’å‡ºå£ä¸æ˜¯å¤§äºç­‰äº,è€Œæ˜¯å¤§äº\n    if (inL>inR || pL>pR) { \n        return null;\n    }\n    TreeNode root=new TreeNode(postorder[pR]);\n    int index=inL;\n    while(inorder[index]!=postorder[pR]){\n        index++; //ä¸€å®šæœ‰,æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒè¶Šç•Œçš„é—®é¢˜\n    }\n    root.left=buildTree(inorder,inL,index-1,postorder,pL,pL+index-inL-1);\n    root.right=buildTree(inorder,index+1,inR,postorder,pL+index-inL,pR-1);\n    return root;\n}\n```\nå’Œä¸Šé¢ä¸€æ ·æ²¡å•¥å¥½è¯´çš„\n\n**è§£æ³•äºŒ**\n\nä¸Šé¢ä¸¤ç§è§£æ³•æäº¤åæ•ˆç‡éƒ½ä¸é«˜ï¼Œè¿™é‡Œå»ä¸­åºéå†ä¸­æ‰¾æ ¹èŠ‚ç‚¹çš„æ“ä½œå…¶å®å¯ä»¥ç”¨Hashè¡¨ä»£æ›¿\n\n```java\n//hashè¡¨ä¼˜åŒ–\nHashMap<Integer,Integer> map=new HashMap<>();\n\npublic TreeNode buildTree(int[] inorder, int[] postorder) {\n    if (inorder==null || inorder.length<=0) {\n        return null;\n    }\n    for (int i=0;i<inorder.length;i++) {\n        map.put(inorder[i],i);\n    }\n    return buildTree(inorder,0,inorder.length-1,postorder,0,postorder.length-1);\n}\n\npublic TreeNode buildTree(int[] inorder,int inL,int inR, int[] postorder,int pL,int pR) {\n    //é€’å½’å‡ºå£åªéœ€è¦æƒ³ä¸€ä¸‹è¾¹ç•Œ,æ¯”å¦‚åªè¦ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™,å¾ˆæ˜æ˜¾åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™è¿™å‡ ä¸ªå€¼éƒ½æ˜¯ç›¸ç­‰çš„\n    //ä½†æ˜¯æ­¤æ—¶è‚¯å®šä¸èƒ½è¿”å›null,æ‰€ä»¥è¿™é‡Œé€’å½’å‡ºå£ä¸æ˜¯å¤§äºç­‰äº,è€Œæ˜¯å¤§äº\n    if (inL>inR || pL>pR) { \n        return null;\n    }\n    TreeNode root=new TreeNode(postorder[pR]);\n    int index=map.get(postorder[pR]);\n    root.left=buildTree(inorder,inL,index-1,postorder,pL,pL+index-inL-1);\n    root.right=buildTree(inorder,index+1,inR,postorder,pL+index-inL,pR-1);\n    return root;\n}\n```\n\n## [889. æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘](https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-postorder-traversal/)\n\nè¿”å›ä¸ç»™å®šçš„å‰åºå’Œååºéå†åŒ¹é…çš„ä»»ä½•äºŒå‰æ ‘ã€‚\n\n pre å’Œ post éå†ä¸­çš„å€¼æ˜¯ä¸åŒçš„æ­£æ•´æ•°ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼špre = [1,2,4,5,3,6,7], post = [4,5,2,6,7,3,1]\nè¾“å‡ºï¼š[1,2,3,4,5,6,7]\n```\n\n**æç¤ºï¼š**\n\n- `1 <= pre.length == post.length <= 30`\n- `pre[]` å’Œ `post[]` éƒ½æ˜¯ 1, 2, ..., pre.length çš„æ’åˆ—\n- æ¯ä¸ªè¾“å…¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªç­”æ¡ˆã€‚å¦‚æœæœ‰å¤šä¸ªç­”æ¡ˆï¼Œå¯ä»¥è¿”å›å…¶ä¸­ä¸€ä¸ªã€‚\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢çš„æœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«\n\n```java\nHashMap<Integer,Integer> map=new HashMap<>();\n\npublic TreeNode constructFromPrePost(int[] pre, int[] post) {\n    for (int i=0;i<post.length;i++) {\n        map.put(post[i],i);\n    }\n    return constructFromPrePost(pre,0,pre.length-1,post,0,post.length-1);\n}\n\npublic TreeNode constructFromPrePost(int[] pre,int preL,int preR,int[] post,int postL,int postR){\n    if (preL>preR || postL>preR) {\n        return null;\n    }\n    TreeNode root=new TreeNode(pre[preL]);\n    if (preL==preR) {\n        return root;\n    }\n    int postIndex=map.get(pre[preL+1]); //è¿™ç§ä½ç½®ä¸€å®šè¦æ³¨æ„æº¢å‡º\n    int len=postIndex-postL;\n    root.left=constructFromPrePost(pre,preL+1,preL+1+len,post,postL,postIndex);\n    root.right=constructFromPrePost(pre,preL+2+len,preR,post,postIndex+1,postR-1);\n    return root;\n}\n```\n![mark](http://static.imlgw.top/blog/20191106/pcmvnEK8Hwg8.png?imageslim)\n\nè¿˜æ˜¯è¿™å¼ å›¾ï¼Œå‰åºçš„ç¬¬ä¸€ä¸ªæ˜¯æ ¹èŠ‚ç‚¹ï¼Œååºçš„æœ€åä¸€ä¸ªæ˜¯æ ¹èŠ‚ç‚¹ï¼Œè€Œæˆ‘ä»¬è¦æ‰¾çš„æ˜¯å·¦å³å­æ ‘çš„åˆ†ç•Œçº¿ï¼Œè¿™é‡Œæ²¡æœ‰ä¸­åºéå†ï¼Œä¹ä¸€çœ‹ä¼¼ä¹ä¸å¥½ç¡®å®šï¼Œå…¶å®ä¸ç„¶ï¼Œæ³¨æ„è§‚å¯Ÿå‰åºçš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸Šé¢çš„2ï¼Œå¯¹åº”åˆ°ååºéå†ä¸­å…¶å®æ­£å¥½å°±å¯ä»¥ä½œä¸ºå·¦å­æ ‘çš„åˆ†ç•Œçº¿ï¼Œè¿™æ ·ä¸€æ¥å°±å’Œä¸Šé¢ä¸€æ ·äº†ï¼Œæ‰€ä»¥è¿™é‡Œçš„å…³é”®å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªåˆ’åˆ†ç‚¹\n\nğŸ”” **æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œé¢˜ç›®è¯´äº†è¿™é¢˜çš„ç»“æœå¯èƒ½æ˜¯ä¸å”¯ä¸€çš„ï¼Œæ•°æ®ç»“æ„çš„è¯¾ç¨‹é‡Œé¢ä¹Ÿè®²è¿‡ï¼Œä»…å‡­å‰åºå’Œååºæ˜¯æ— æ³•ç¡®å®šä¸€é¢—äºŒå‰æ ‘çš„ï¼Œä½†æ˜¯ä¸€å®šä¹ˆï¼Ÿ**\n\nå¹¶ä¸ä¸€å®šï¼Œæˆ‘ä»¬é¢˜ç›®çš„caseå°±æ˜¯ä¸ªåä¾‹ï¼Œå®ƒå°±å¯ä»¥é€šè¿‡å‰åºå’Œååºå”¯ä¸€çš„ç¡®å®šè¿™é¢—äºŒå‰æ ‘ï¼Œé‚£ä»€ä¹ˆæ—¶å€™å¯ä»¥ç¡®å®šï¼Œä»€ä¹ˆæ—¶å€™æ— æ³•ç¡®å®šå‘¢ï¼Ÿ\n\næ— æ³•ç¡®å®šçš„ä¾‹å­å¥½è¯´ï¼Œã€1ï¼Œ2ã€‘ï¼Œã€2ï¼Œ1ã€‘è¿™ä¸ªå°±æ— æ³•ç¡®å®š\n\n ```java\n  1              1   \n   \\            /\n    2          2        ä¸¤ç§å¯èƒ½éƒ½æœ‰\n ```\n\n ä½†æ˜¯å¦‚æœæ˜¯è¿™æ ·çš„ã€1ï¼Œ2ï¼Œ3ã€‘ã€2ï¼Œ3ï¼Œ1ã€‘è¿™ç§å°±å¯ä»¥å”¯ä¸€çš„ç¡®å®š\n\n ```java\n  1\n / \\\n2   3  åªå¯èƒ½æ˜¯è¿™ç§æƒ…å†µ\n ```\nå½’çº³æ€»ç»“ä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°ï¼Œ**å¦‚æœè¿™é¢—äºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹çš„åº¦éƒ½æ˜¯0æˆ–è€…2** é‚£ä¹ˆä»–å°±å¯ä»¥é€šè¿‡å‰åºå’Œååºç¡®å®šï¼Œåä¹‹å°±ä¸ä¸€å®šäº†ï¼Œå› ä¸ºä½ åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹é‚£ä¹ˆå°±æ— æ³•ç¡®å®šè¿™ä¸ªèŠ‚ç‚¹æ˜¯å·¦èŠ‚ç‚¹è¿˜æ˜¯å³èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰æˆ–è€…ä¸¤ä¸ªéƒ½æœ‰é‚£ä¹ˆå°±å¯ä»¥ç¡®å®šäº†ï¼ˆæ ¹æ®é¡ºåºç¡®å®šï¼Œå‰é¢çš„æ˜¯å·¦åé¢çš„æ˜¯å³ï¼Œä½†æ˜¯ä½ åªæœ‰ä¸€ä¸ªæˆ‘å°±ä¸çŸ¥é“æ˜¯å·¦è¿˜æ˜¯å³äº†ï¼‰\n\n## [114. äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨](https://leetcode-cn.com/problems/flatten-binary-tree-to-linked-list/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼ŒåŸåœ°å°†å®ƒå±•å¼€ä¸ºé“¾è¡¨ã€‚\n\nä¾‹å¦‚ï¼Œç»™å®šäºŒå‰æ ‘\n\n```java\n\t1\n   / \\\n  2   5\n / \\   \\\n3   4   6\n```\n\nå°†å…¶å±•å¼€ä¸ºï¼š\n\n```java\n1\n \\\n  2\n   \\\n    3\n     \\\n      4\n       \\\n        5\n         \\\n          6\n```\n\n> é¢˜ç›®æ²¡æŠ„é”™ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼Œç¡®å®é¢˜ç›®æ²¡æœ‰è¯´æ˜æŒ‰ç…§ä»€ä¹ˆæ–¹å¼å±•å¼€ï¼Œä½†æ˜¯çœ‹caseèƒ½çŒœåˆ°æ˜¯å‰åºéå†çš„æ–¹å¼å±•å¼€ï¼ˆé çŒœçš„ï¼Ÿï¼‰\n\n**è§£æ³•ä¸€**\n\nå‰åºéå†ï¼Œé€’å½’çš„è§£æ³•ï¼Œç”¨ä¸€ä¸ªå…¨å±€å˜é‡ä¿å­˜é“¾è¡¨çš„ç»“å°¾ï¼Œæ¯æ¬¡å°†èŠ‚ç‚¹æ·»åŠ åˆ°lastçš„åé¢\n\n```java\nTreeNode last=null;\n\npublic void flatten(TreeNode root) {\n    if (root==null) {\n        return;\n    }\n    if (last!=null) {\n        last.left=null;\n        last.right=root;\n    }\n    last=root;\n    TreeNode right=root.right;//ä¿å­˜å³å­æ ‘\n    flatten(root.left);\n    flatten(right);\n}\n```\néœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯éœ€è¦ä¿å­˜å³å­æ ‘ï¼Œå› ä¸ºå‰é¢çš„æ“ä½œå°†å·¦å­æ ‘æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹å³å­æ ‘çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´åŸæœ¬çš„å³å­æ ‘ä¸¢å¤±\n\n**éé€’å½’çš„å†™æ³•**\n\n```java\npublic void flatten(TreeNode root) {\n    if (root==null) return;\n    TreeNode last=null;\n    Deque<TreeNode> stack=new ArrayDeque<>();\n    stack.push(root);\n    while(!stack.isEmpty()){\n        TreeNode cur=stack.pop();\n        if(last!=null){\n            last.right=cur;\n            last.left=null;\n        }\n        last=cur;\n        if(cur.right!=null){\n            stack.push(cur.right);\n        }\n        if(cur.left!=null){\n            stack.push(cur.left);\n        }\n    }\n}\n```\n\n**è§£æ³•äºŒ**\n\nå˜å½¢çš„ååºéå†ï¼Œé€’å½’è§£æ³•\n\n```java\nTreeNode pre=null;\n\npublic void flatten(TreeNode root) {\n    if (root==null) {\n        return;\n    }\n    flatten(root.right);\n    flatten(root.left);\n    root.right=pre;\n    root.left=null;\n    pre=root;\n}\n```\nç›¸æ¯”å‰é¢çš„è§£æ³•ï¼Œä¸ºäº†ä¸ä¸¢å¤±å³å­æ ‘ï¼Œå…ˆéå†å³å­æ ‘ï¼Œå†éå†å·¦å­æ ‘ï¼Œæ•´ä¸ªåºåˆ—å°±æ˜¯`6 5 4 3 2 1`  æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹çš„rightæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹å°±okäº†\n\n**è§£æ³•ä¸‰**\n\nè¿­ä»£ï¼Œæˆ‘è§‰å¾—è¿™ç§è§£æ³•æŒºç§€ï¼Œè€Œä¸”æ˜¯å®Œå…¨çš„ `in-place`ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦ä¼šé«˜ä¸€äº›ï¼Œæ¯ä¸ªå…ƒç´ ä¸åªéå†ä¸€æ¬¡\n\n```java\npublic void flatten(TreeNode root) {\n    TreeNode mRight=null;\n    while(root!=null){\n        if (root.left!=null) {\n            mRight=root.left;\n            //æ‰¾åˆ°å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹\n            while(mRight.right!=null){\n                mRight=mRight.right;\n            }\n            //å°†æ ¹çš„å³èŠ‚ç‚¹æ¥åœ¨ mRight.right\n            mRight.right=root.right;\n            //å°†root.leftæ¥åœ¨root.right\n            root.right=root.left;\n            //å·¦èŠ‚ç‚¹ç½®ä¸ºnull\n            root.left=null;\n        }\n        //é‡å¤è¯¥è¿‡ç¨‹\n        root=root.right;\n    }\n}\n```\nç”»ä¸ªå›¾å°±æ˜¯è¿™æ ·\n\n![mark](http://static.imlgw.top/blog/20191108/BIx12P1AYjeX.png?imageslim)\n\n## [é¢è¯•é¢˜36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨](https://leetcode-cn.com/problems/er-cha-sou-suo-shu-yu-shuang-xiang-lian-biao-lcof/)\n\nè¾“å…¥ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œå°†è¯¥äºŒå‰æœç´¢æ ‘è½¬æ¢æˆä¸€ä¸ªæ’åºçš„å¾ªç¯åŒå‘é“¾è¡¨ã€‚è¦æ±‚ä¸èƒ½åˆ›å»ºä»»ä½•æ–°çš„èŠ‚ç‚¹ï¼Œåªèƒ½è°ƒæ•´æ ‘ä¸­èŠ‚ç‚¹æŒ‡é’ˆçš„æŒ‡å‘ã€‚\n\nä¸ºäº†è®©æ‚¨æ›´å¥½åœ°ç†è§£é—®é¢˜ï¼Œä»¥ä¸‹é¢çš„äºŒå‰æœç´¢æ ‘ä¸ºä¾‹ï¼š\n\n![3VE7QO.png](https://s2.ax1x.com/2020/02/19/3VE7QO.png)\n\næˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸ªäºŒå‰æœç´¢æ ‘è½¬åŒ–ä¸ºåŒå‘å¾ªç¯é“¾è¡¨ã€‚é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå‰é©±å’Œåç»§æŒ‡é’ˆã€‚å¯¹äºåŒå‘å¾ªç¯é“¾è¡¨ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„å‰é©±æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åç»§æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚\n\nä¸‹å›¾å±•ç¤ºäº†ä¸Šé¢çš„äºŒå‰æœç´¢æ ‘è½¬åŒ–æˆçš„é“¾è¡¨ã€‚â€œheadâ€ è¡¨ç¤ºæŒ‡å‘é“¾è¡¨ä¸­æœ‰æœ€å°å…ƒç´ çš„èŠ‚ç‚¹ã€‚\n![Nn3iZR.png](https://s1.ax1x.com/2020/06/18/Nn3iZR.png)\nç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å°±åœ°å®Œæˆè½¬æ¢æ“ä½œã€‚å½“è½¬åŒ–å®Œæˆä»¥åï¼Œæ ‘ä¸­èŠ‚ç‚¹çš„å·¦æŒ‡é’ˆéœ€è¦æŒ‡å‘å‰é©±ï¼Œæ ‘ä¸­èŠ‚ç‚¹çš„å³æŒ‡é’ˆéœ€è¦æŒ‡å‘åç»§ã€‚è¿˜éœ€è¦è¿”å›é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚\n\n**è§£æ³•ä¸€**\n\nå¼€å§‹è¿˜ä»¥ä¸ºæŒºéš¾æï¼Œä¸€éå°±å†™å‡ºæ¥äº†ğŸ˜æ¯”ä¸Šä¸€é¢˜ç®€å•\n\n```java\npublic Node treeToDoublyList(Node root) {\n    if(root==null) return root;\n    dfs(root);\n    head.left=lastNode;\n    lastNode.right=head;\n    return head;\n}\n\nNode lastNode,head=null;\n\npublic void dfs(Node root){\n    if(root==null) return;\n    dfs(root.left);\n    if(lastNode==null){\n        head=lastNode=root;\n    }else{\n        root.left=lastNode;\n        lastNode.right=root;\n        lastNode=root;\n    }\n    dfs(root.right);\n}\n```\n\n## [116. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ](https://leetcode-cn.com/problems/populating-next-right-pointers-in-each-node/)\n\nç»™å®šä¸€ä¸ª**å®Œç¾äºŒå‰æ ‘**ï¼Œå…¶æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œæ¯ä¸ªçˆ¶èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚äºŒå‰æ ‘å®šä¹‰å¦‚ä¸‹ï¼š\n\n```java\nstruct Node {\n  int val;\n  Node *left;\n  Node *right;\n  Node *next;\n}\n```\n\n\nå¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º NULL\n\nåˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º NULL\n\n![leet](https://i.loli.net/2019/11/10/eC4VBqXmwuspZlG.png)\n\n**è§£æ³•ä¸€**\n\nå¼€å§‹æ²¡åšå‡ºæ¥ï¼Œèœï¼ï¼ï¼ç„¶åç‰¹æ„ç•™åˆ°ä»Šå¤©æ€»ç»“ï¼Œåˆåœ¨webä¸Šæäº¤äº†ä¸€é\n\n```java\npublic Node connect(Node root) {\n    if (root ==null ||root.left==null) {\n        return root;\n    }\n    root.left.next=root.right;\n    if (root.next!=null) {\n        root.right.next=root.next.left;   \n    }\n    connect(root.left);\n    connect(root.right);\n    return root;\n}\n```\n**è§£æ³•äºŒ**\n\nè¿™ä¸ªè§£æ³•æ¢³ç†è¿˜æ˜¯å¾ˆæ¸…å¥‡çš„ï¼Œç±»ä¼¼æ‹‰æ‹‰é“¾çš„è¿‡ç¨‹\n\n```java\npublic Node connect(Node root) {\n    if (root ==null ||root.left==null) {\n        return root;\n    }\n    Node left=root.left;\n    Node right=root.right;\n    //æœ‰çš„åƒæ‹‰æ‹‰é“¾çš„è¿‡ç¨‹\n    while(left!=null){\n        left.next=right;\n        left=left.right;\n        right=right.left;\n    }\n    connect(root.left);\n    connect(root.right);\n    return root;\n}\n```\n\n> è¿˜æœ‰ä¸€ä¸ªå¾ˆç›´ç™½çš„å±‚åºéå†çš„æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸å†™äº†\n\n## [117. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ II](https://leetcode-cn.com/problems/populating-next-right-pointers-in-each-node-ii/) \n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘\n\n```java\nstruct Node {\n  int val;\n  Node *left;\n  Node *right;\n  Node *next;\n}\n```\n\nå¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ã€‚å¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œåˆ™å°† next æŒ‡é’ˆè®¾ç½®ä¸º `NULL`ã€‚\n\nåˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰ next æŒ‡é’ˆéƒ½è¢«è®¾ç½®ä¸º `NULL`ã€‚\n\n**è¿›é˜¶ï¼š**\n\n- ä½ åªèƒ½ä½¿ç”¨å¸¸é‡çº§é¢å¤–ç©ºé—´ã€‚\n- ä½¿ç”¨é€’å½’è§£é¢˜ä¹Ÿç¬¦åˆè¦æ±‚ï¼Œæœ¬é¢˜ä¸­é€’å½’ç¨‹åºå ç”¨çš„æ ˆç©ºé—´ä¸ç®—åšé¢å¤–çš„ç©ºé—´å¤æ‚åº¦ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n![Y7BwBd.png](https://s1.ax1x.com/2020/05/20/Y7BwBd.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,3,4,5,null,7]\nè¾“å‡ºï¼š[1,#,2,3,#,4,5,7,#]\nè§£é‡Šï¼šç»™å®šäºŒå‰æ ‘å¦‚å›¾ A æ‰€ç¤ºï¼Œä½ çš„å‡½æ•°åº”è¯¥å¡«å……å®ƒçš„æ¯ä¸ª next æŒ‡é’ˆï¼Œä»¥æŒ‡å‘å…¶ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹ï¼Œå¦‚å›¾ B æ‰€ç¤ºã€‚\n```\n\n**æç¤ºï¼š**\n\n- æ ‘ä¸­çš„èŠ‚ç‚¹æ•°å°äº `6000`\n- `-100 <= node.val <= 100`\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®è¦æ±‚çš„O(1)ç©ºé—´ï¼Œå‚è€ƒäº†å¤§ä½¬çš„è§£æ³•ï¼Œæ¨¡æ‹Ÿå±‚åºéå†ï¼Œç€å®æ˜¯å¾ˆå·§å¦™ï¼Œä»£ç ç®€æ´æ¸…æ™°ï¼Œå€¼å¾—ç»†ç»†å“å‘³\n\n```java\npublic Node connect(Node root) {\n    Node dummyNode=new Node(-1);\n    Node cur=root;\n    //curåœ¨ä¸Šå±‚ï¼ŒdummyNodeå’Œtailåœ¨ä¸‹å±‚ï¼Œtailè´Ÿè´£è¿æ¥ä¸‹å±‚æ‰€æœ‰å­èŠ‚ç‚¹\n    while(cur!=null){\n        dummyNode.next=null; //é‡ç½®\n        Node tail=dummyNode;\n        while(cur!=null){\n            if(cur.left!=null){\n                tail.next=cur.left;\n                tail=tail.next;\n            }\n            if(cur.right!=null){\n                tail.next=cur.right;\n                tail=tail.next;\n            }\n            cur=cur.next;\n        }\n        cur=dummyNode.next; //curè½¬æ¢åˆ°ä¸‹ä¸€å±‚\n    }\n    return root;\n}\n```\n\n## [450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹](https://leetcode-cn.com/problems/delete-node-in-a-bst/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªå€¼ keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„ key å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›äºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤èŠ‚ç‚¹å¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š\n\n1. é¦–å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼›\n\n2. å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ é™¤å®ƒã€‚\n\n**è¯´æ˜ï¼š** è¦æ±‚ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(h)ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nroot = [5,3,6,2,4,null,7]\nkey = 3\n\n    5\n   / \\\n  3   6\n / \\   \\\n2   4   7\n\nç»™å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹å€¼æ˜¯ 3ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ° 3 è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤å®ƒã€‚\n\nä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ [5,4,6,2,null,null,7], å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n    5\n   / \\\n  4   6\n /     \\\n2       7\n\nå¦ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆæ˜¯ [5,2,6,null,4,null,7]ã€‚\n\n    5\n   / \\\n  2   6\n   \\   \\\n    4   7\n\n```\n\n**è§£æ³•ä¸€**\n\næ›´å¤šè§£é‡Šçœ‹å¦ä¸€ç¯‡ [äºŒå‰æœç´¢æ ‘](http://imlgw.top/2019/11/08/er-fen-sou-suo-shu/#%E5%88%A0%E9%99%A4%E4%BB%BB%E6%84%8F%E5%80%BC)\n\n```java\npublic TreeNode deleteNode(TreeNode root, int key) {\n    if (root ==null) {\n        return null;           \n    }\n    if (root.val>key) {\n        root.left=deleteNode(root.left,key);\n    }else if (root.val<key) {\n        root.right=deleteNode(root.right,key);\n    }else{\n        if (root.left==null) {\n            return root.right;\n        }\n        if (root.right==null) {\n            return root.left;\n        }\n        //ç”¨å³å­æ ‘çš„æœ€å°å€¼å¡«è¡¥åˆ é™¤çš„å…ƒç´ \n        TreeNode delNode=root;\n        root=getMin(root.right);\n        //ä¸‹é¢çš„leftå’Œrightä¸èƒ½äº¤æ¢,è¿˜å¥½åˆšå¼€å§‹å†™é”™äº†ä¸€æ³¢,ä¸ç„¶ä¹Ÿä¸ä¼šå‘ç°,å“ˆå“ˆå•Šå“ˆå“ˆå“ˆ\n        //è¿™é‡Œçš„deleteMinæ˜¯ä¸ºäº†åˆ é™¤delNodeçš„æœ€å°å€¼root,å¦‚æœä½ å…ˆæŠŠdelNode.leftè¿æ¥åˆ°äº†root.left\n        //é‚£ä¹ˆrootå°±ä¸å†æ˜¯æœ€å°å€¼äº†,å†è¿›è¡ŒdeleteMinå°±ä¼šå¯¼è‡´rootæ— æ³•åˆ é™¤,æœ€åè¿”å›root,å¯¼è‡´root.right=rootå½¢æˆç¯\n        //ç»“æœæ— æ³•æ‰“å°\n        root.right=deleteMin(delNode.right);\n        root.left=delNode.left;\n    }\n    return root;\n}\n\npublic TreeNode deleteMin(TreeNode node){\n    if (node.left==null) {\n        return node.right;\n    }\n    node.left=deleteMin(node.left);\n    return node;\n}\n\npublic TreeNode getMin(TreeNode node){\n    if (node.left==null) {\n        return node;\n    }\n    return getMin(node.left);\n}\n```\n\n## [701. äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ](https://leetcode-cn.com/problems/insert-into-a-binary-search-tree/)\n\nç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹å’Œè¦æ’å…¥æ ‘ä¸­çš„å€¼ï¼Œå°†å€¼æ’å…¥äºŒå‰æœç´¢æ ‘ã€‚ è¿”å›æ’å…¥åäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ ä¿è¯åŸå§‹äºŒå‰æœç´¢æ ‘ä¸­ä¸å­˜åœ¨æ–°å€¼ã€‚\n\næ³¨æ„ï¼Œå¯èƒ½å­˜åœ¨å¤šç§æœ‰æ•ˆçš„æ’å…¥æ–¹å¼ï¼Œåªè¦æ ‘åœ¨æ’å…¥åä»ä¿æŒä¸ºäºŒå‰æœç´¢æ ‘å³å¯ã€‚ ä½ å¯ä»¥è¿”å›ä»»æ„æœ‰æ•ˆçš„ç»“æœã€‚\n\nä¾‹å¦‚, \n\nç»™å®šäºŒå‰æœç´¢æ ‘:\n\n```java\n    4\n   / \\\n  2   7\n / \\\n1   3\n\nå’Œ æ’å…¥çš„å€¼: 5\n```\n\n\nä½ å¯ä»¥è¿”å›è¿™ä¸ªäºŒå‰æœç´¢æ ‘:\n\n```java\n     4\n   /   \\\n  2     7\n / \\   /\n1   3 5\n```\næˆ–è€…è¿™ä¸ªæ ‘ä¹Ÿæ˜¯æœ‰æ•ˆçš„:\n\n```java\n     5\n   /   \\\n  2     7\n / \\   \n1   3\n     \\\n      4\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic TreeNode insertIntoBST(TreeNode root, int val) {\n    if (root==null) {\n        return new TreeNode(val);\n    }\n    if (root.val>val) {\n        root.left=insertIntoBST(root.left,val);   \n    }else if (root.val<val) {\n        root.right=insertIntoBST(root.right,val);   \n    }\n    return root;\n}\n```\næ²¡å•¥å¥½è¯´çš„ï¼Œçœ‹ä»£ç å°±æ‡‚äº†\n\n\n\n## [662. äºŒå‰æ ‘æœ€å¤§å®½åº¦](https://leetcode-cn.com/problems/maximum-width-of-binary-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è·å–è¿™ä¸ªæ ‘çš„æœ€å¤§å®½åº¦ã€‚æ ‘çš„å®½åº¦æ˜¯æ‰€æœ‰å±‚ä¸­çš„æœ€å¤§å®½åº¦ã€‚**è¿™ä¸ªäºŒå‰æ ‘ä¸æ»¡äºŒå‰æ ‘ï¼ˆfull binary treeï¼‰ç»“æ„ç›¸åŒï¼Œä½†ä¸€äº›èŠ‚ç‚¹ä¸ºç©ºã€‚**\n\næ¯ä¸€å±‚çš„å®½åº¦è¢«å®šä¹‰ä¸ºä¸¤ä¸ªç«¯ç‚¹ï¼ˆè¯¥å±‚æœ€å·¦å’Œæœ€å³çš„éç©ºèŠ‚ç‚¹ï¼Œä¸¤ç«¯ç‚¹é—´çš„nullèŠ‚ç‚¹ä¹Ÿè®¡å…¥é•¿åº¦ï¼‰ä¹‹é—´çš„é•¿åº¦ã€‚\n\n**Example 1:**\n\n```java\nInput: \n\n           1\n         /   \\\n        3     2\n       / \\     \\  \n      5   3     9 \n\nOutput: 4\nExplanation: The maximum width existing in the third level with the length 4 (5,3,null,9).\n```\n\n**Example 2:**\n\n```java\nInput: \n\n          1\n         /  \n        3    \n       / \\       \n      5   3     \n\nOutput: 2\nExplanation: The maximum width existing in the third level with the length 2 (5,3).\n```\n\n**Example 3:**\n\n```java\nInput: \n\n          1\n         / \\\n        3   2 \n       /        \n      5      \n\nOutput: 2\nExplanation: The maximum width existing in the second level with the length 2 (3,2).\n```\n\n**Example 4:**\n\n```java\nInput: \n\n          1\n         / \\\n        3   2\n       /     \\  \n      5       9 \n     /         \\\n    6           7\nOutput: 8\nExplanation:The maximum width existing in the fourth level with the length 8 (6,null,null,null,null,null,null,7).\n```\n\n**Note:** Answer will in the range of 32-bit signed integer.\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹å±…ç„¶æ²¡æƒ³åˆ°ï¼Œå“ğŸ˜è¿˜æ˜¯èœå•Š\n\n```java\npublic int widthOfBinaryTree(TreeNode root) {\n    if (root==null) {\n        return 0;\n    }\n    Queue<TreeNode> queue=new LinkedList<>();\n    LinkedList<Integer> idxs=new LinkedList<>();\n    int max=1;\n    idxs.add(1);\n    queue.add(root);\n    while(!queue.isEmpty()){\n        int size=queue.size();\n        while(size>0){\n            TreeNode top=queue.poll();\n            int index=idxs.removeFirst();\n            if (top.left!=null) {\n                queue.add(top.left);\n                idxs.add(index*2);\n            }\n            if (top.right!=null) {\n                queue.add(top.right);\n                idxs.add(index*2+1);\n            }\n            size--;\n        }\n        if (idxs.size()!=0) {\n            max=Math.max(idxs.getLast()-idxs.getFirst()+1,max);    \n        }\n    }\n    return max;\n}\n```\nè¿˜æ˜¯å±‚æ¬¡éå†çš„æ€è·¯ï¼Œä¸è¿‡éœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªç´¢å¼•åˆ—è¡¨ï¼Œç”¨æ¥**è®°å½•æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”åœ¨å®Œå…¨äºŒå‰æ ‘ä¸­çš„ç´¢å¼•**ï¼Œè¿™ä¸ªç´¢å¼•å€¼å®Œå…¨å¯ä»¥æ ¹æ®ä¸Šä¸€å±‚çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•çš„åˆ°ï¼Œæˆ‘ä»¬åˆå§‹åŒ–å®šä¹‰æ ¹èŠ‚ç‚¹çš„indexä¸º1ï¼Œç„¶åè¿›è¡Œå±‚æ¬¡éå†è®°å½•æ¯ä¸€å±‚çš„æ¯ä¸ªèŠ‚ç‚¹çš„indexå°±okï¼Œå½“éå†å®Œä¸€å±‚ä¹‹åç»Ÿè®¡åˆ—è¡¨æœ€å·¦å’Œæœ€å³ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å·®ï¼Œè¿™ä¸ªå€¼å°±æ˜¯å½“å‰å±‚çš„å®½åº¦ï¼Œæœ€åæ±‚ä¸ªæœ€å¤§å€¼å°±okäº†ï¼Œå¾ˆå¯æƒœï¼Œçœ‹äº†ç­”æ¡ˆæ‰çŸ¥é“\n\n**è§£æ³•äºŒ**\n\né€’å½’ç‰ˆæœ¬\n\n```java\npublic int widthOfBinaryTree(TreeNode root) {\n    if (root==null) {\n        return 0;\n    }\n    dfs(root,0,0,new LinkedList<>());\n    return max;\n}\n\nint max=1;\n\npublic void dfs(TreeNode node,int depth,int index,List<Integer> leftIdxs){\n    if (node==null) {\n        return;\n    }\n    if (depth>=leftIdxs.size()) {\n        leftIdxs.add(index);\n    }\n    //è®°å½•å½“å‰èŠ‚ç‚¹å’Œå½“å‰å±‚æœ€å·¦èŠ‚ç‚¹çš„å·®\n    max=Math.max(index-leftIdxs.get(depth)+1,max);\n    dfs(node.left,depth+1,index*2,leftIdxs);\n    dfs(node.right,depth+1,index*2+1,leftIdxs);\n}\n```\nè¿™ä¸ªç‰ˆæœ¬åœ¨ç©ºé—´å¤æ‚åº¦å¯èƒ½ä¼šä½ä¸€ç‚¹ï¼Œlistä¸­åªå­˜æ¯ä¸ªå±‚æœ€å·¦çš„èŠ‚ç‚¹ï¼Œå½“æ·±åº¦å¤§äºç­‰äºlistçš„é•¿åº¦æ—¶å€™è¯´æ˜å½“å‰èŠ‚ç‚¹ä¸€å®šæ˜¯æ–°ä¸€å±‚çš„æœ€å·¦èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™æ·»åŠ è¿›å»å°±okï¼Œç„¶åæ±‚æ¯ä¸ªèŠ‚ç‚¹å’Œå½“å‰å±‚æœ€å·¦çš„èŠ‚ç‚¹indexå·®å€¼å°±æœ€åæ›´æ–°æœ€å¤§å€¼å°±okï¼Œè¿™ä¸ªè§£æ³•è¿˜æ˜¯æ²¡æœ‰é‚£ä¹ˆè‡ªç„¶ï¼Œè¿˜æ˜¯ä¸Šé¢çš„BFSå¥½ç†è§£ä¸€ç‚¹\n\n## [671. äºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹](https://leetcode-cn.com/problems/second-minimum-node-in-a-binary-tree/)\n\nç»™å®šä¸€ä¸ªéç©ºç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯æ­£æ•°ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°é‡åªèƒ½ä¸º 2 æˆ– 0ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ä¸å¤§äºå®ƒçš„å­èŠ‚ç‚¹çš„å€¼ã€‚ \n\nç»™å‡ºè¿™æ ·çš„ä¸€ä¸ªäºŒå‰æ ‘ï¼Œä½ éœ€è¦è¾“å‡ºæ‰€æœ‰èŠ‚ç‚¹ä¸­çš„ç¬¬äºŒå°çš„å€¼ã€‚å¦‚æœç¬¬äºŒå°çš„å€¼ä¸å­˜åœ¨çš„è¯ï¼Œè¾“å‡º -1 ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \n    2\n   / \\\n  2   5\n     / \\\n    5   7\n\nè¾“å‡º: 5\nè¯´æ˜: æœ€å°çš„å€¼æ˜¯ 2 ï¼Œç¬¬äºŒå°çš„å€¼æ˜¯ 5 ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \n    2\n   / \\\n  2   2\n\nè¾“å‡º: -1\nè¯´æ˜: æœ€å°çš„å€¼æ˜¯ 2, ä½†æ˜¯ä¸å­˜åœ¨ç¬¬äºŒå°çš„å€¼ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n```go\n//è‡ªç„¶çš„ä»ä¸Šåˆ°ä¸‹çš„æ€è·¯\nvar INT_MAX = int(^uint(0) >> 1)\n\nfunc findSecondMinimumValue(root *TreeNode) int {\n\tres := dfs(root)\n\tif res == INT_MAX {\n\t\treturn -1\n\t}\n\treturn res\n}\n\nfunc dfs(root *TreeNode) int {\n\tif root == nil || root.Left == nil {\n\t\treturn INT_MAX\n\t}\n\t//å’Œå·¦å³å­æ ‘éƒ½ä¸ç­‰ï¼Œè°å°å°±æ˜¯è°\n\tif root.Val != root.Left.Val && root.Val != root.Right.Val {\n\t\treturn min(root.Left.Val, root.Right.Val)\n\t}\n\t//å’Œå·¦å³å­æ ‘éƒ½ç›¸ç­‰ï¼Œåˆ†åˆ«åœ¨å·¦å³å­æ ‘ä¸­æ‰¾ç¬¬äºŒå°æ¯”è¾ƒ\n\tif root.Val == root.Left.Val && root.Val == root.Right.Val {\n\t\treturn min(dfs(root.Left), dfs(root.Right))\n\t}\n\t//å’Œå·¦å­æ ‘ç›¸ç­‰,åœ¨å·¦å­æ ‘ä¸­æ‰¾ç¬¬äºŒå°å’Œå³å­æ ‘æ¯”è¾ƒ\n\tif root.Val == root.Left.Val {\n\t\treturn min(dfs(root.Left), root.Right.Val)\n\t}\n\t//åŒä¸Š\n\treturn min(dfs(root.Right), root.Left.Val)\n}\n\nfunc min(a, b int) int {\n\tif a > b {\n\t\treturn b\n\t}\n\treturn a\n}\n```\n\n## [938. äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ](https://leetcode-cn.com/problems/range-sum-of-bst/)\n\nç»™å®šäºŒå‰æœç´¢æ ‘çš„æ ¹ç»“ç‚¹ rootï¼Œè¿”å› L å’Œ Rï¼ˆå«ï¼‰ä¹‹é—´çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼çš„å’Œã€‚\n\näºŒå‰æœç´¢æ ‘ä¿è¯å…·æœ‰å”¯ä¸€çš„å€¼ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šroot = [10,5,15,3,7,null,18], L = 7, R = 15\nè¾“å‡ºï¼š32\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šroot = [10,5,15,3,7,13,18,1,null,6], L = 6, R = 10\nè¾“å‡ºï¼š23\n```\n\n**æç¤ºï¼š**\n\n- æ ‘ä¸­çš„ç»“ç‚¹æ•°é‡æœ€å¤šä¸º 10000 ä¸ªã€‚\n- æœ€ç»ˆçš„ç­”æ¡ˆä¿è¯å°äº 2^31\n\n**è§£æ³•ä¸€**\n\nè¿˜è¡Œï¼Œè¿™é¢˜ååº”è¿‡æ¥äº†ï¼Œä¸­åºéå†\n\n```java\nprivate int sum=0;\n\npublic int rangeSumBST(TreeNode root, int L, int R) {\n    preorder(root,L,R);\n    return sum;\n}\n\npublic void preorder(TreeNode root, int L, int R) {\n    if (root==null) {\n        return;\n    }\n    rangeSumBST(root.left,L,R);\n    if (root.val>=L && root.val<=R) {\n        sum+=root.val;\n    }\n    rangeSumBST(root.right,L,R);\n}\n```\n\n## [617. åˆå¹¶äºŒå‰æ ‘](https://leetcode-cn.com/problems/merge-two-binary-trees/)\n\nç»™å®šä¸¤ä¸ªäºŒå‰æ ‘ï¼Œæƒ³è±¡å½“ä½ å°†å®ƒä»¬ä¸­çš„ä¸€ä¸ªè¦†ç›–åˆ°å¦ä¸€ä¸ªä¸Šæ—¶ï¼Œä¸¤ä¸ªäºŒå‰æ ‘çš„ä¸€äº›èŠ‚ç‚¹ä¾¿ä¼šé‡å ã€‚\n\nä½ éœ€è¦å°†ä»–ä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„äºŒå‰æ ‘ã€‚åˆå¹¶çš„è§„åˆ™æ˜¯å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹é‡å ï¼Œé‚£ä¹ˆå°†ä»–ä»¬çš„å€¼ç›¸åŠ ä½œä¸ºèŠ‚ç‚¹åˆå¹¶åçš„æ–°å€¼ï¼Œå¦åˆ™ä¸ä¸º NULL çš„èŠ‚ç‚¹å°†ç›´æ¥ä½œä¸ºæ–°äºŒå‰æ ‘çš„èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \n\tTree 1                     Tree 2                  \n          1                         2                             \n         / \\                       / \\                            \n        3   2                     1   3                        \n       /                           \\   \\                      \n      5                             4   7                  \nè¾“å‡º: \nåˆå¹¶åçš„æ ‘:\n\t     3\n\t    / \\\n\t   4   5\n\t  / \\   \\ \n\t 5   4   7\n```\n\n**æ³¨æ„:** åˆå¹¶å¿…é¡»ä»ä¸¤ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic TreeNode mergeTrees(TreeNode t1, TreeNode t2) {\n    if (t2==null) {\n        return  t1;\n    }\n    if (t1==null) {\n        return t2;\n    }\n    t1.val+=t2.val;\n    t1.left=mergeTrees(t1.left,t2.left);\n    t1.right=mergeTrees(t1.right,t2.right);\n    return t1;\n}\n```\n\n## [530. äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®](https://leetcode-cn.com/problems/minimum-absolute-difference-in-bst/)\n\nç»™å®šä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹ä¸ºéè´Ÿå€¼çš„äºŒå‰æœç´¢æ ‘ï¼Œæ±‚æ ‘ä¸­ä»»æ„ä¸¤èŠ‚ç‚¹çš„å·®çš„ç»å¯¹å€¼çš„æœ€å°å€¼ã€‚\n\n**ç¤ºä¾‹ :**\n\n```java\nè¾“å…¥:\n\n   1\n    \\\n     3\n    /\n   2\n\nè¾“å‡º:\n1\n\nè§£é‡Š:\næœ€å°ç»å¯¹å·®ä¸º1ï¼Œå…¶ä¸­ 2 å’Œ 1 çš„å·®çš„ç»å¯¹å€¼ä¸º 1ï¼ˆæˆ–è€… 2 å’Œ 3ï¼‰ã€‚\n```\n\n**æ³¨æ„:** æ ‘ä¸­è‡³å°‘æœ‰2ä¸ªèŠ‚ç‚¹ã€‚\n\n**è§£æ³•ä¸€**\n\nå¾ˆå¯æƒœï¼Œè¿™é¢˜è¿˜WAäº†ä¸€æ¬¡ã€‚ã€‚ã€‚\n\n```java\npublic int getMinimumDifference(TreeNode root) {\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root;\n    int diff=Integer.MAX_VALUE,last=-1;\n    while(!stack.isEmpty() || cur!=null){\n        while(cur!=null){\n            stack.push(cur);\n            cur=cur.left;\n        }\n        cur=stack.pop();\n        if (last!=-1) {\n            diff=Math.min(diff,Math.abs(last-cur.val));   \n        }\n        last=cur.val;\n        cur=cur.right;\n    }\n    return diff;\n}\n```\n**è§£æ³•äºŒ**\n\né€’å½’çš„æ–¹å¼\n\n```java\nprivate int diff = Integer.MAX_VALUE;\n\nprivate int last = -1;\n\npublic int getMinimumDifference(TreeNode root) {\n    inorder(root);\n    return diff;\n}\n\npublic void inorder(TreeNode root){\n    if (root==null) {\n        return;\n    }\n    inorder(root.left);\n    diff = last==-1?diff:Math.min(diff,Math.abs(last-root.val));\n    last = root.val;\n    inorder(root.right);\n}\n```\n\n## [501. äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°](https://leetcode-cn.com/problems/find-mode-in-binary-search-tree/)\n\nDifficulty: **ç®€å•**\n\n\nç»™å®šä¸€ä¸ªæœ‰ç›¸åŒå€¼çš„äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰ï¼Œæ‰¾å‡º BST ä¸­çš„æ‰€æœ‰ä¼—æ•°ï¼ˆå‡ºç°é¢‘ç‡æœ€é«˜çš„å…ƒç´ ï¼‰ã€‚\n\nå‡å®š BST æœ‰å¦‚ä¸‹å®šä¹‰ï¼š\n\n*   ç»“ç‚¹å·¦å­æ ‘ä¸­æ‰€å«ç»“ç‚¹çš„å€¼å°äºç­‰äºå½“å‰ç»“ç‚¹çš„å€¼\n*   ç»“ç‚¹å³å­æ ‘ä¸­æ‰€å«ç»“ç‚¹çš„å€¼å¤§äºç­‰äºå½“å‰ç»“ç‚¹çš„å€¼\n*   å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æœç´¢æ ‘\n\nä¾‹å¦‚ï¼š  \nç»™å®š BST `[1,null,2,2]`,\n\n```go\n   1\n    \\\n     2\n    /\n   2\n```\n\n`è¿”å›[2]`.\n\n**æç¤º**ï¼šå¦‚æœä¼—æ•°è¶…è¿‡1ä¸ªï¼Œä¸éœ€è€ƒè™‘è¾“å‡ºé¡ºåº\n\n**è¿›é˜¶ï¼š**ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–çš„ç©ºé—´å—ï¼Ÿï¼ˆå‡è®¾ç”±é€’å½’äº§ç”Ÿçš„éšå¼è°ƒç”¨æ ˆçš„å¼€é”€ä¸è¢«è®¡ç®—åœ¨å†…ï¼‰\n\n\n**è§£æ³•ä¸€**\n\nä¹‹å‰å¿˜äº†è®°å½•äº†ï¼Œä¸­åºéå†ç»Ÿè®¡ç­”æ¡ˆå°±okï¼Œä½†æ˜¯éè¦ä¸¥æ ¼çš„O(1)å°±éœ€è¦ä½¿ç”¨Morriséå†ï¼ˆä¸ä¼š\n```golang\n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n * Â  Â  Val int\n * Â  Â  Left *TreeNode\n * Â  Â  Right *TreeNode\n * }\n */\nfunc findMode(root *TreeNode) []int {\n Â  Â var dfs func(root *TreeNode)\n Â  Â var prev *TreeNode\n Â  Â var count, max = 0, 0\n Â  Â var res []int\n Â  Â dfs = func(root *TreeNode) {\n Â  Â  Â  Â if root == nil {\n Â  Â  Â  Â  Â  Â return\n Â  Â  Â   }\n Â  Â  Â  Â dfs(root.Left)\n Â  Â  Â  Â if prev == nil || prev.Val == root.Val {\n Â  Â  Â  Â  Â  Â count++\n Â  Â  Â   } else {\n Â  Â  Â  Â  Â  Â count = 1\n Â  Â  Â   }\n Â  Â  Â  Â if count == max {\n Â  Â  Â  Â  Â  Â res = append(res, root.Val)\n Â  Â  Â   }\n Â  Â  Â  Â if count > max {\n Â  Â  Â  Â  Â  Â res = []int{}\n Â  Â  Â  Â  Â  Â res = append(res, root.Val)\n Â  Â  Â  Â  Â  Â max = count\n Â  Â  Â   }\n Â  Â  Â  Â prev = root\n Â  Â  Â  Â dfs(root.Right)\n Â   }\n Â  Â dfs(root)\n```\n\n## [515. åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼](https://leetcode-cn.com/problems/find-largest-value-in-each-tree-row/)\n\næ‚¨éœ€è¦åœ¨äºŒå‰æ ‘çš„æ¯ä¸€è¡Œä¸­æ‰¾åˆ°æœ€å¤§çš„å€¼ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥: \n\t  1\n     / \\\n    3   2\n   / \\   \\  \n  5   3   9 \nè¾“å‡º: [1, 3, 9]\n```\n\n**è§£æ³•ä¸€**\n\nå¨±ä¹é¢˜\n\n```java\npublic List<Integer> largestValues(TreeNode root) {\n    List<Integer> res=new ArrayList<>();\n    dfs(root,res,0);\n    return res;\n}\n\npublic void dfs(TreeNode node,List<Integer> list,int level){\n    if (node==null) {\n        return;\n    }\n    if (level>=list.size()) {\n        list.add(node.val);\n    }\n    if(node.val>list.get(level)){\n        list.set(level,node.val);\n    }\n    dfs(node.left,list,level+1);\n    dfs(node.right,list,level+1);\n}\n```\n\n## [173. äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨](https://leetcode-cn.com/problems/binary-search-tree-iterator/)\n\nå®ç°ä¸€ä¸ªäºŒå‰æœç´¢æ ‘è¿­ä»£å™¨ã€‚ä½ å°†ä½¿ç”¨äºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹åˆå§‹åŒ–è¿­ä»£å™¨ã€‚\n\nè°ƒç”¨ `next()` å°†è¿”å›äºŒå‰æœç´¢æ ‘ä¸­çš„ä¸‹ä¸€ä¸ªæœ€å°çš„æ•°ã€‚\n\n **ç¤ºä¾‹ï¼š**\n\n![leetcode](https://i.loli.net/2019/12/25/TXK397rI5hwjG4B.png)\n\n```java\nBSTIterator iterator = new BSTIterator(root);\niterator.next();    // è¿”å› 3\niterator.next();    // è¿”å› 7\niterator.hasNext(); // è¿”å› true\niterator.next();    // è¿”å› 9\niterator.hasNext(); // è¿”å› true\niterator.next();    // è¿”å› 15\niterator.hasNext(); // è¿”å› true\niterator.next();    // è¿”å› 20\niterator.hasNext(); // è¿”å› false\n```\n\n**æç¤ºï¼š**\n\n- next() å’Œ hasNext() æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œå¹¶ä½¿ç”¨ **O(h)** å†…å­˜ï¼Œå…¶ä¸­ h æ˜¯æ ‘çš„é«˜åº¦ã€‚\n- ä½ å¯ä»¥å‡è®¾ next() è°ƒç”¨æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è°ƒç”¨ next() æ—¶ï¼ŒBST ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªä¸‹ä¸€ä¸ªæœ€å°çš„æ•°ã€‚ \n\n**è§£æ³•ä¸€**\n\næ³¨æ„è¿™é¢˜ç©ºé—´å¤æ‚åº¦è¦æ±‚æ˜¯`O(h)` ï¼Œå¹¶ä¸æ˜¯æ†¨æ†¨é¢˜\n\n```java\nStack<TreeNode> stack=new Stack<>();\n\npublic BSTIterator(TreeNode root) {\n    pushLeft(root);\n}\n\npublic int next() {\n    TreeNode node=stack.pop();\n    if (node.right!=null) {\n        pushLeft(node.right);\n    }\n    return node.val;\n}\n\npublic boolean hasNext() {\n    return !stack.isEmpty();\n}\n\npublic void pushLeft(TreeNode node){\n    while(node!=null){\n        stack.add(node);\n        node=node.left;\n    }\n}\n```\n\næˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªstackå­˜å‚¨BSTçš„å·¦é“¾ï¼Œå½“å–æœ€å°å€¼å°±ä»stackä¸­ç›´æ¥å–ï¼Œå¦‚æœå–å‡ºæ¥çš„nodeè¿˜æœ‰å³å­æ ‘å°±å°†å³å­æ ‘çš„å·¦é“¾ä¹Ÿæ·»åŠ è¿›æ¥ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹ç†Ÿæ‚‰ï¼Ÿå…¶å®å°±æ˜¯ä¸­åºéå†çš„è¿‡ç¨‹\n\n## [95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II](https://leetcode-cn.com/problems/unique-binary-search-trees-ii/)\n\nç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œç”Ÿæˆæ‰€æœ‰ç”± 1 ... n ä¸ºèŠ‚ç‚¹æ‰€ç»„æˆçš„**äºŒå‰æœç´¢æ ‘**ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: 3\nè¾“å‡º:\n[\n  [1,null,3,2],\n  [3,2,null,1],\n  [3,1,null,null,2],\n  [2,1,3],\n  [1,null,2,null,3]\n]\nè§£é‡Š:\nä»¥ä¸Šçš„è¾“å‡ºå¯¹åº”ä»¥ä¸‹ 5 ç§ä¸åŒç»“æ„çš„äºŒå‰æœç´¢æ ‘ï¼š\n\n   1         3     3      2      1\n    \\       /     /      / \\      \\\n     3     2     1      1   3      2\n    /     /       \\                 \\\n   2     1         2                 3\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic  List<TreeNode> generateTrees(int n) {\n    if(n<=0){\n        return new ArrayList<>();\n    }\n    return generateTrees(1,n);\n}\n\npublic List<TreeNode> generateTrees(int start,int end) {\n    List<TreeNode> res=new ArrayList<>();\n    if (start>end) {\n        //nullä¹Ÿæ˜¯ä¸€ç§æƒ…å†µï¼Œå·¦å³å­æ ‘ä¸ºç©º\n        res.add(null);\n        return res;\n    }\n    for (int i=start;i<=end;i++) {\n        List<TreeNode> left=generateTrees(start,i-1);\n        List<TreeNode> right=generateTrees(i+1,end);\n        for (TreeNode l:left) {\n            for (TreeNode r:right) {\n                TreeNode currentNode=new TreeNode(i);\n                currentNode.left=l;\n                currentNode.right=r;\n                res.add(currentNode);\n            }\n        }\n    }\n    return res;\n}\n```\nå¾ˆä¹…ä¹‹å‰åšè¿‡çš„é¢˜ï¼Œä»Šå¤©åˆæ‹¿å‡ºæ¥çœ‹çœ‹ï¼Œå…¶å®å±äºåˆ†æ²»æ€è·¯\n\n## [538. æŠŠäºŒå‰æœç´¢æ ‘è½¬æ¢ä¸ºç´¯åŠ æ ‘](https://leetcode-cn.com/problems/convert-bst-to-greater-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼ˆBinary Search Treeï¼‰ï¼ŒæŠŠå®ƒè½¬æ¢æˆä¸ºç´¯åŠ æ ‘ï¼ˆGreater Tree)ï¼Œä½¿å¾—æ¯ä¸ªèŠ‚ç‚¹çš„å€¼æ˜¯åŸæ¥çš„èŠ‚ç‚¹å€¼åŠ ä¸Šæ‰€æœ‰å¤§äºå®ƒçš„èŠ‚ç‚¹å€¼ä¹‹å’Œã€‚\n\n**ä¾‹å¦‚ï¼š**\n\n```java\nè¾“å…¥: äºŒå‰æœç´¢æ ‘:\n              5\n            /   \\\n           2     13\n\nè¾“å‡º: è½¬æ¢ä¸ºç´¯åŠ æ ‘:\n             18\n            /   \\\n          20     13\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é‡Œæˆ‘æƒ³å…ˆä¸Šä¸€ä¸ª**é”™è¯¯çš„è§£æ³•**\n\n```java\n//ä»¥ä¸‹ä»£ç çº¯å±å¨±ä¹\npublic TreeNode convertBST(TreeNode root) {\n    if (root==null) {\n        return new TreeNode(0);//è¿™é‡Œè‚¯å®šæ˜¯é”™çš„ï¼Œnullåº”è¯¥ç›´æ¥è¿”å›null\n    }\n    if (root.left==null && root.right==null) {\n        return root;\n    }\n    root.val+= convertBST(root.right).val;\n    convertBST(root.left).val+=root.val;\n    return root;\n}\n```\n\nå¿½ç•¥è¿”å›å€¼çš„éƒ¨åˆ†ï¼Œä¹ä¸€çœ‹å¥½åƒæ˜¯å¯¹çš„ğŸ˜‚ï¼Œå…¶å®é—®é¢˜å¤§äº†ï¼Œé¦–å…ˆæ˜¯å·¦è¾¹çš„å€¼ç®—çš„ä¸å¯¹ï¼Œå› ä¸ºæ˜¯DFSä¼šä»æœ€å·¦è¾¹å¼€å§‹ç®—ï¼Œéƒ½åªåŠ äº†ä»–çš„çˆ¶èŠ‚ç‚¹åŸå§‹çš„å€¼ï¼Œè€Œçˆ¶èŠ‚ç‚¹çš„ç´¯åŠ å€¼è¿˜æ²¡æœ‰ç®—å‡ºæ¥ï¼Œå…¶æ¬¡æœ‰äº›æƒ…å†µæ˜¯ç®—ä¸å‡ºæ¥çš„æ¯”å¦‚å·¦å­æ ‘çš„æŸä¸€ä¸ªå³èŠ‚ç‚¹ä½ å°±ç®—ä¸å‡ºæ¥\n\n**è§£æ³•äºŒ**\n\nå…¶å®ä¸€å¼€å§‹å°±çŸ¥é“å¯ä»¥ç›´æ¥ä¸­åºéå†åšï¼Œåªæ˜¯æƒ³ç©ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œå¯æƒœæ²¡æå‡ºæ¥ğŸ˜‚\n\n```java\npublic TreeNode convertBST(TreeNode root) {\n    dfs(root);\n    return root;\n}\n\nprivate int sum=0;\n\npublic void dfs(TreeNode root){\n    if (root==null) {\n        return;\n    }\n    dfs(root.right);\n    sum+=root.val;\n    root.val=sum;\n    dfs(root.left);\n}\n```\nè¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯è¦ç¿»è¿‡æ¥éå†ï¼Œä»å¤§åˆ°å°ï¼Œå› ä¸ºå®ƒæ±‚çš„æ˜¯æ¯”å®ƒå¤§çš„èŠ‚ç‚¹çš„å€¼\n\n## [508. å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­æ ‘å…ƒç´ å’Œ](https://leetcode-cn.com/problems/most-frequent-subtree-sum/)\n\nç»™å‡ºäºŒå‰æ ‘çš„æ ¹ï¼Œæ‰¾å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„å­æ ‘å…ƒç´ å’Œã€‚ä¸€ä¸ªç»“ç‚¹çš„å­æ ‘å…ƒç´ å’Œå®šä¹‰ä¸ºä»¥è¯¥ç»“ç‚¹ä¸ºæ ¹çš„äºŒå‰æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å…ƒç´ ä¹‹å’Œï¼ˆåŒ…æ‹¬ç»“ç‚¹æœ¬èº«ï¼‰ã€‚ç„¶åæ±‚å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„å­æ ‘å…ƒç´ å’Œã€‚å¦‚æœæœ‰å¤šä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ç›¸åŒï¼Œè¿”å›æ‰€æœ‰å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ ï¼ˆä¸é™é¡ºåºï¼‰ã€‚\n\n**ç¤ºä¾‹ 1**\n\n```java\nè¾“å…¥:\n\n  5\n /  \\\n2   -3\nè¿”å› [2, -3, 4]ï¼Œæ‰€æœ‰çš„å€¼å‡åªå‡ºç°ä¸€æ¬¡ï¼Œä»¥ä»»æ„é¡ºåºè¿”å›æ‰€æœ‰å€¼ã€‚\n```\n\n**ç¤ºä¾‹ 2**\n\n```java\nè¾“å…¥:\n\n  5\n /  \\\n2   -5\nè¿”å› [2]ï¼Œåªæœ‰ 2 å‡ºç°ä¸¤æ¬¡ï¼Œ-5 åªå‡ºç° 1 æ¬¡ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nå·¦å­æ ‘å’Œ+å³å­æ ‘å’Œï¼ŒHashMapè®°å½•å‡ºç°çš„æ¬¡æ•°ï¼Œè®°å½•æœ€å¤§å€¼ç„¶åå–å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„\n\n```java\nprivate Map<Integer,Integer> map = new HashMap<>();\n\nprivate int maxCount=0;\n\npublic int[] findFrequentTreeSum(TreeNode root) {\n    if (root ==null) {\n        return new int[]{};\n    }\n    dfs(root);\n    List<Integer> res=new ArrayList<>();\n    map.keySet().stream().filter(val->map.get(val)==maxCount).forEach(res::add);\n    return res.stream().mapToInt(Integer::valueOf).toArray(); //listè½¬æ•°ç»„çš„åˆä¸€ä¸ªå°æŠ€å·§ï¼Œå•çº¯çš„toArrayåªèƒ½è½¬æ¢æˆInteger[],è¿˜éœ€è¦è½¬\n}\n\npublic int dfs(TreeNode root){\n    if (root==null) {\n        return 0;\n    }\n    int value=root.val+dfs(root.right)+dfs(root.left);\n    map.put(value,map.getOrDefault(value,0)+1);\n    maxCount=Math.max(maxCount,map.get(value));\n    return value;\n}\n```\n\nå†™æ³•æ˜¯åŸºäºLambdaçš„ï¼Œå‡½æ•°å¼å†™èµ·æ¥çœŸçš„èˆ’æœ\n\n## [606. æ ¹æ®äºŒå‰æ ‘åˆ›å»ºå­—ç¬¦ä¸²](https://leetcode-cn.com/problems/construct-string-from-binary-tree/)\n\nä½ éœ€è¦é‡‡ç”¨å‰åºéå†çš„æ–¹å¼ï¼Œå°†ä¸€ä¸ªäºŒå‰æ ‘è½¬æ¢æˆä¸€ä¸ªç”±æ‹¬å·å’Œæ•´æ•°ç»„æˆçš„å­—ç¬¦ä¸²ã€‚\n\nç©ºèŠ‚ç‚¹åˆ™ç”¨ä¸€å¯¹ç©ºæ‹¬å· \"()\" è¡¨ç¤ºã€‚è€Œä¸”ä½ éœ€è¦çœç•¥æ‰€æœ‰ä¸å½±å“å­—ç¬¦ä¸²ä¸åŸå§‹äºŒå‰æ ‘ä¹‹é—´çš„ä¸€å¯¹ä¸€æ˜ å°„å…³ç³»çš„ç©ºæ‹¬å·å¯¹ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: äºŒå‰æ ‘: [1,2,3,4]\n       1\n     /   \\\n    2     3\n   /    \n  4     \n\nè¾“å‡º: \"1(2(4))(3)\"\n\nè§£é‡Š: åŸæœ¬å°†æ˜¯â€œ1(2(4)())(3())â€ï¼Œ\nåœ¨ä½ çœç•¥æ‰€æœ‰ä¸å¿…è¦çš„ç©ºæ‹¬å·å¯¹ä¹‹åï¼Œ\nå®ƒå°†æ˜¯â€œ1(2(4))(3)â€ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: äºŒå‰æ ‘: [1,2,3,null,4]\n       1\n     /   \\\n    2     3\n     \\  \n      4 \n\nè¾“å‡º: \"1(2()(4))(3)\"\n\nè§£é‡Š: å’Œç¬¬ä¸€ä¸ªç¤ºä¾‹ç›¸ä¼¼ï¼Œ\né™¤äº†æˆ‘ä»¬ä¸èƒ½çœç•¥ç¬¬ä¸€ä¸ªå¯¹æ‹¬å·æ¥ä¸­æ–­è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„ä¸€å¯¹ä¸€æ˜ å°„å…³ç³»ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic String tree2str(TreeNode t) {\n    StringBuilder s=new StringBuilder();\n    dfs(t,s);\n    return s.toString();\n}\n\npublic void dfs(TreeNode node,StringBuilder s){\n    if (node==null) {\n        return;\n    }\n    s.append(node.val);\n    if(node.left==null && node.right==null){//æ²¡æœ‰å­èŠ‚ç‚¹\n        return;\n    }\n    s.append(\"(\");\n    dfs(node.left,s);\n    s.append(\")\");\n    if (node.right==null) { //æ²¡æœ‰å³èŠ‚ç‚¹\n        return;\n    }\n    s.append(\"(\");\n    dfs(node.right,s);\n    s.append(\")\");\n}\n```\n\næ²¡å•¥å¥½è¯´çš„ï¼Œææ¸…æ¥šé¢˜ç›®æ„æ€ç„¶åæ³¨æ„é€’å½’çš„å‡ ä¸ªå‡ºå£å°±è¡Œäº†\n\n## [1315. ç¥–çˆ¶èŠ‚ç‚¹å€¼ä¸ºå¶æ•°çš„èŠ‚ç‚¹å’Œ](https://leetcode-cn.com/problems/sum-of-nodes-with-even-valued-grandparent/)\n\nç»™ä½ ä¸€æ£µäºŒå‰æ ‘ï¼Œè¯·ä½ è¿”å›æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ‰€æœ‰èŠ‚ç‚¹çš„å€¼ä¹‹å’Œï¼š\n\nè¯¥èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹çš„å€¼ä¸ºå¶æ•°ã€‚ï¼ˆä¸€ä¸ªèŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹æ˜¯æŒ‡è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚ï¼‰\nå¦‚æœä¸å­˜åœ¨ç¥–çˆ¶èŠ‚ç‚¹å€¼ä¸ºå¶æ•°çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿”å› 0 ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n![1473_ex1.png](https://i.loli.net/2020/01/13/CgBK9WOMbNvxJpY.png)\n\n```java\nè¾“å…¥ï¼šroot = [6,7,8,2,7,1,3,9,null,1,4,null,null,null,5]\nè¾“å‡ºï¼š18\nè§£é‡Šï¼šå›¾ä¸­çº¢è‰²èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹çš„å€¼ä¸ºå¶æ•°ï¼Œè“è‰²èŠ‚ç‚¹ä¸ºè¿™äº›çº¢è‰²èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹ã€‚\n```\n\n**æç¤ºï¼š**\n\n- æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨ `1` åˆ° `10^4` ä¹‹é—´ã€‚\n- æ¯ä¸ªèŠ‚ç‚¹çš„å€¼åœ¨ `1` åˆ° `100` ä¹‹é—´ã€‚\n\n**è§£æ³•ä¸€**\n\nå¥½åƒæ˜¯170å‰ä¸€å¤©çš„åŒå‘¨èµ›çš„ç¬¬3é¢˜ï¼Œè¿˜æ˜¯å¾ˆç›´ç™½çš„é¢˜ï¼Œéå†çš„æ—¶å€™å¸¦ä¸Šå®ƒçš„fatherçš„å€¼å’Œgrandfatherçš„å€¼å¸¦åˆ°ä¸‹ä¸€å±‚ï¼Œç„¶ååˆ¤æ–­å°±å¯ä»¥äº†\n\n```java\npublic int sumEvenGrandparent(TreeNode root) {\n    return dfs(root,-1,-1);\n}\n\npublic int dfs(TreeNode node,int fa,int ga){\n    if (node==null) {\n        return 0;\n    }\n    int sum=0;\n    if (fa!=-1 && ga!=-1 && ga%2==0) {\n        sum+=node.val;\n    }\n    sum+=dfs(node.left,node.val,fa);\n    sum+=dfs(node.right,node.val,fa);\n    return sum;\n}\n```\n\n\n\n\n\n## [1026. èŠ‚ç‚¹ä¸å…¶ç¥–å…ˆä¹‹é—´çš„æœ€å¤§å·®å€¼](https://leetcode-cn.com/problems/maximum-difference-between-node-and-ancestor/) \n\nç»™å®šäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ `root`ï¼Œæ‰¾å‡ºå­˜åœ¨äºä¸åŒèŠ‚ç‚¹ `A` å’Œ `B` ä¹‹é—´çš„æœ€å¤§å€¼ `V`ï¼Œå…¶ä¸­ `V = |A.val - B.val|`ï¼Œä¸” `A` æ˜¯ `B` çš„ç¥–å…ˆã€‚\n\nï¼ˆå¦‚æœ A çš„ä»»ä½•å­èŠ‚ç‚¹ä¹‹ä¸€ä¸º Bï¼Œæˆ–è€… A çš„ä»»ä½•å­èŠ‚ç‚¹æ˜¯ B çš„ç¥–å…ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸º A æ˜¯ B çš„ç¥–å…ˆï¼‰\n\n**ç¤ºä¾‹ï¼š**\n\n![YpF3r9.png](https://s1.ax1x.com/2020/05/03/YpF3r9.png)\n\n```java\nè¾“å…¥ï¼š[8,3,10,1,6,null,14,null,null,4,7,13]\nè¾“å‡ºï¼š7\nè§£é‡Šï¼š \næˆ‘ä»¬æœ‰å¤§é‡çš„èŠ‚ç‚¹ä¸å…¶ç¥–å…ˆçš„å·®å€¼ï¼Œå…¶ä¸­ä¸€äº›å¦‚ä¸‹ï¼š\n|8 - 3| = 5\n|3 - 7| = 4\n|8 - 1| = 7\n|10 - 13| = 3\nåœ¨æ‰€æœ‰å¯èƒ½çš„å·®å€¼ä¸­ï¼Œæœ€å¤§å€¼ 7 ç”± |8 - 1| = 7 å¾—å‡ºã€‚\n```\n\n**æç¤ºï¼š**\n\n1. æ ‘ä¸­çš„èŠ‚ç‚¹æ•°åœ¨ `2` åˆ° `5000` ä¹‹é—´ã€‚\n2. æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ä»‹äº `0` åˆ° `100000` ä¹‹é—´ã€‚\n\n**è§£æ³•ä¸€**\n\næ°´é¢˜ï¼Œç»´æŠ¤æ¯æ¡è·¯å¾„ä¸Šçš„æœ€å€¼ï¼Œç„¶åç»Ÿè®¡æœ€å¤§å·®å°±è¡Œäº†\n\n```go\nfunc maxAncestorDiff(root *TreeNode) int {\n    var res = 0\n    dfs(root, 1<<30, -1>>30, &res)\n    return res\n}\n\nfunc dfs(root *TreeNode, min, max int, res *int) {\n    if root == nil {\n        return\n    }\n    min = fmin(min, root.Val)\n    max = fmax(max, root.Val)\n    *res = fmax(max-min, *res)\n    dfs(root.Left, min, max, res)\n    dfs(root.Right, min, max, res)\n}\n\nfunc fmin(a, b int) int {\n    if a < b {\n        return a\n    }\n    return b\n}\n\nfunc fmax(a, b int) int {\n    if a > b {\n        return a\n    }\n    return b\n}\n\n```\n\n## [1325. åˆ é™¤ç»™å®šå€¼çš„å¶å­èŠ‚ç‚¹](https://leetcode-cn.com/problems/delete-leaves-with-a-given-value/)\n\nç»™ä½ ä¸€æ£µä»¥ `root` ä¸ºæ ¹çš„äºŒå‰æ ‘å’Œä¸€ä¸ªæ•´æ•° `target` ï¼Œè¯·ä½ åˆ é™¤æ‰€æœ‰å€¼ä¸º `target` çš„ å¶å­èŠ‚ç‚¹ ã€‚\n\næ³¨æ„ï¼Œä¸€æ—¦åˆ é™¤å€¼ä¸º `target` çš„å¶å­èŠ‚ç‚¹ï¼Œå®ƒçš„çˆ¶èŠ‚ç‚¹å°±å¯èƒ½å˜æˆå¶å­èŠ‚ç‚¹ï¼›å¦‚æœæ–°å¶å­èŠ‚ç‚¹çš„å€¼æ°å¥½ä¹Ÿæ˜¯ `target` ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹ä¹Ÿåº”è¯¥è¢«åˆ é™¤ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œä½ éœ€è¦é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°ä¸èƒ½ç»§ç»­åˆ é™¤ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/01/28/e7dOxoLNciVa4Uf.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,3,2,null,2,4], target = 2\nè¾“å‡ºï¼š[1,null,3,null,4]\nè§£é‡Šï¼š\nä¸Šé¢å·¦è¾¹çš„å›¾ä¸­ï¼Œç»¿è‰²èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œä¸”å®ƒä»¬çš„å€¼ä¸ target ç›¸åŒï¼ˆåŒä¸º 2 ï¼‰ï¼Œå®ƒä»¬ä¼šè¢«åˆ é™¤ï¼Œå¾—åˆ°ä¸­é—´çš„å›¾ã€‚\næœ‰ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å˜æˆäº†å¶å­èŠ‚ç‚¹ä¸”å®ƒçš„å€¼ä¸ target ç›¸åŒï¼Œæ‰€ä»¥å°†å†æ¬¡è¿›è¡Œåˆ é™¤ï¼Œä»è€Œå¾—åˆ°æœ€å³è¾¹çš„å›¾ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![image.png](https://i.loli.net/2020/01/28/aNLo4wQz3C1ZiAf.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,3,3,3,2], target = 3\nè¾“å‡ºï¼š[1,3,null,null,2]\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n![image.png](https://i.loli.net/2020/01/28/JHBRy7uZDFWLMVT.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,null,2,null,2], target = 2\nè¾“å‡ºï¼š[1]\nè§£é‡Šï¼šæ¯ä¸€æ­¥éƒ½åˆ é™¤ä¸€ä¸ªç»¿è‰²çš„å¶å­èŠ‚ç‚¹ï¼ˆå€¼ä¸º 2ï¼‰ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= target <= 1000`\n- æ¯ä¸€æ£µæ ‘æœ€å¤šæœ‰ `3000` ä¸ªèŠ‚ç‚¹ã€‚\n- æ¯ä¸€ä¸ªèŠ‚ç‚¹å€¼çš„èŒƒå›´æ˜¯ `[1, 1000]` ã€‚\n\n**è§£æ³•ä¸€**\n\næŸæ¬¡å‘¨èµ›çš„ç¬¬ä¸‰é¢˜\n\n```java\npublic TreeNode removeLeafNodes(TreeNode root, int target) {\n    return delete(root,target);\n}\n\npublic TreeNode delete(TreeNode root,int target){\n    if (root==null) {\n        return null;\n    }\n    root.left=delete(root.left,target);\n    root.right=delete(root.right,target);\n    if (root.left==null && root.right==null && root.val==target) {\n        return null;\n    }\n    return root;\n}\n```\næäº†åŠå¤©ã€‚ã€‚ã€‚ä¸€å¼€å§‹å†™çš„æ—¶å€™å†™çš„å‰åºéå†çš„æ–¹å¼ï¼Œå…ˆåˆ é™¤è‡ªå·±ç„¶åå†å»åˆ é™¤å·¦å³å­©å­ï¼Œç„¶ååœ¨å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰å¶å­èŠ‚ç‚¹ä¸Šå¡äº†åŠå¤©ï¼Œæœ€åå†™äº†ä¸ªfor3000çš„å¾ªç¯è¿‡çš„ã€‚ã€‚ã€‚å¥½èœå•Šï¼Œåªè¦äº¤æ¢ä¸€ä¸‹é¡ºåºå˜æˆååºéå†çš„æ–¹å¼ï¼Œå…ˆåˆ é™¤å·¦å³å­èŠ‚ç‚¹ï¼Œç„¶åå†å›å¤´åˆ é™¤è‡ªå·±çš„å°±å¯ä»¥ä¸€ç›´åˆ äº†ã€‚ã€‚\n\n## [1305. ä¸¤æ£µäºŒå‰æœç´¢æ ‘ä¸­çš„æ‰€æœ‰å…ƒç´ ](https://leetcode-cn.com/problems/all-elements-in-two-binary-search-trees/)\n\nç»™ä½  `root1` å’Œ `root2` è¿™ä¸¤æ£µäºŒå‰æœç´¢æ ‘ã€‚\n\nè¯·ä½ è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å« **ä¸¤æ£µæ ‘** ä¸­çš„æ‰€æœ‰æ•´æ•°å¹¶æŒ‰ **å‡åº** æ’åºã€‚.\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/01/31/Hy3MEwa4sRO6jUq.png)\n\n```java\nè¾“å…¥ï¼šroot1 = [2,1,4], root2 = [1,0,3]\nè¾“å‡ºï¼š[0,1,1,2,3,4]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šroot1 = [0,-10,10], root2 = [5,1,7,0,2]\nè¾“å‡ºï¼š[-10,0,0,1,2,5,7,10]\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šroot1 = [], root2 = [5,1,7,0,2]\nè¾“å‡ºï¼š[0,1,2,5,7]\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šroot1 = [0,-10,10], root2 = []\nè¾“å‡ºï¼š[-10,0,10]\n```\n\n**è§£æ³•ä¸€**\n\næŸæ¬¡å‘¨èµ›çš„é¢˜ï¼Œå¤§æ°´é¢˜ï¼Œç™½æ¿å›å¿†å†™å‡ºäº†ä¸­åºçš„éé€’å½’hahaï¼Œæ„Ÿè§‰å¿˜ä¸äº†äº†\n\n```java\npublic List<Integer> getAllElements(TreeNode root1, TreeNode root2) {\n    //return megerList(inorder(root1),0,inorder(root2),0);\n    return megerList(inorder(root1),inorder(root2));\n}\n\npublic List<Integer> inorder(TreeNode root){\n    List<Integer> res=new ArrayList<>();\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root;\n    while(!stack.isEmpty() || cur!=null){\n        while(cur!=null){\n            stack.add(cur);\n            cur=cur.left;\n        }\n        cur=stack.pop();\n        res.add(cur.val);\n        cur=cur.right;\n    }\n    return res;\n}\n\npublic List<Integer> megerList(List<Integer> list1,List<Integer> list2){\n    List<Integer> res=new ArrayList<>();\n    int index1=0,index2=0;\n    while(index1<list1.size() && index2<list2.size()){\n        res.add(list1.get(index1)<list2.get(index2)?list1.get(index1++):list2.get(index2++));\n    }\n    while(index1<list1.size()){\n        res.add(list1.get(index1++));\n    }\n    while(index2<list2.size()){\n        res.add(list2.get(index2++));\n    }\n    return res;\n}\n\n\n//é€’å½’çš„TLEäº† 42/48,ä¸åœçš„åˆ›å»ºlistå¤ªè€—æ—¶äº†\npublic List<Integer> megerList(List<Integer> list1,int index1,List<Integer> list2,int index2){\n    List<Integer> res=new ArrayList<>();\n    if (index1==list1.size()) {\n        for (int i=index2;i<list2.size();i++) {\n            res.add(list2.get(i));\n        }\n        return res;\n    }\n    if (index2==list2.size()) {\n        for (int i=index1;i<list1.size();i++) {\n            res.add(list1.get(i));\n        }\n        return res;\n    }\n    if (list1.get(index1)<list2.get(index2)) {\n        res.add(list1.get(index1));\n        res.addAll(megerList(list1,index1+1,list2,index2));\n    }else{\n        res.add(list2.get(index2));\n        res.addAll(megerList(list1,index1,list2,index2+1));\n    }\n    return res;\n}\n```\n\n## [1339. åˆ†è£‚äºŒå‰æ ‘çš„æœ€å¤§ä¹˜ç§¯](https://leetcode-cn.com/problems/maximum-product-of-splitted-binary-tree/)\n\nç»™ä½ ä¸€æ£µäºŒå‰æ ‘ï¼Œå®ƒçš„æ ¹ä¸º root ã€‚è¯·ä½ åˆ é™¤ 1 æ¡è¾¹ï¼Œä½¿äºŒå‰æ ‘åˆ†è£‚æˆä¸¤æ£µå­æ ‘ï¼Œä¸”å®ƒä»¬å­æ ‘å’Œçš„ä¹˜ç§¯å°½å¯èƒ½å¤§ã€‚\n\nç”±äºç­”æ¡ˆå¯èƒ½ä¼šå¾ˆå¤§ï¼Œè¯·ä½ å°†ç»“æœå¯¹ 10^9 + 7 å–æ¨¡åå†è¿”å›ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/02/02/HT93vAj7gcXwY8U.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,3,4,5,6]\nè¾“å‡ºï¼š110\nè§£é‡Šï¼šåˆ é™¤çº¢è‰²çš„è¾¹ï¼Œå¾—åˆ° 2 æ£µå­æ ‘ï¼Œå’Œåˆ†åˆ«ä¸º 11 å’Œ 10 ã€‚å®ƒä»¬çš„ä¹˜ç§¯æ˜¯ 110 ï¼ˆ11*10ï¼‰\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![image.png](https://i.loli.net/2020/02/02/Fit7Xl2jkzCZyhV.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,null,2,3,4,null,null,5,6]\nè¾“å‡ºï¼š90\nè§£é‡Šï¼šç§»é™¤çº¢è‰²çš„è¾¹ï¼Œå¾—åˆ° 2 æ£µå­æ ‘ï¼Œå’Œåˆ†åˆ«æ˜¯ 15 å’Œ 6 ã€‚å®ƒä»¬çš„ä¹˜ç§¯ä¸º 90 ï¼ˆ15*6ï¼‰\n```\n\n**è§£æ³•ä¸€**\n\n174å‘¨èµ›çš„ç¬¬ä¸‰é¢˜ï¼Œå½“æ—¶æ¯”èµ›TLEäº†ã€‚ã€‚å†™äº†ä¸ªå¾ˆè ¢çš„ç®—æ³•\n\n```java\nprivate long mod=1000000007;\n\npublic int maxProduct(TreeNode root) {\n    Stack<TreeNode> stack=new Stack<>();\n    TreeNode cur=root;\n    long sumAll=sum(root);\n    while(!stack.isEmpty() || cur!=null){\n        TreeNode temp=null;\n        long s=0L;\n        while(cur!=null){\n            temp=cur.left;\n            cur.left=null;\n            long r=sum(root);\n            s=r*(sumAll-r);\n            max=Math.max(s,max);\n            cur.left=temp;\n            stack.add(cur);\n            cur=cur.left;\n        }\n        cur=stack.pop();\n        temp=cur.right;\n        cur.right=null;\n        long r=sum(root);\n        s=r*(sumAll-r);\n        max=Math.max(s,max);\n        cur.right=temp;\n        cur=cur.right;\n    }\n    return (int)(max%mod);\n}\n\nprivate long max=-1;\n\npublic long sum(TreeNode root){\n    if (root==null) {\n        return 0;\n    }\n    return root.val+sum(root.left)+sum(root.right);\n}\n```\n\næˆ‘å±…ç„¶çœŸçš„å»åˆ é™¤èŠ‚ç‚¹å»äº†ã€‚ã€‚ã€‚å¯¼è‡´åé¢éƒ½æ²¡åŠæ³•å¯¹sumåšè®°å¿†åŒ–ï¼Œå¤ªèœäº†å•Š\n\n**è§£æ³•äºŒ**\n\nèƒ½ACä½†æ˜¯æ•ˆç‡æ„Ÿäºº\n\n```java\nprivate long mod=1000000007;\n\nprivate long sumAll=0;\n\nprivate long max=-1;\n\npublic int maxProduct(TreeNode root) {\n    sumAll=sum(root);\n    dfs(root);\n    return (int)(max%mod);\n}\n\npublic void dfs(TreeNode root){\n    if (root==null) {\n        return;\n    }\n    long temp=sum(root);\n    max=Math.max(max,temp*(sumAll-temp));\n    dfs(root.left);\n    dfs(root.right);\n}\n\nprivate HashMap<String,Long> cache=new HashMap<>();\n\npublic long sum(TreeNode root){\n    if (root==null) {\n        return 0;\n    }\n    if (cache.containsKey(root.toString())) {\n        return cache.get(root.toString());\n    }\n    cache.put(root.toString(),root.val+sum(root.left)+sum(root.right));\n    return cache.get(root.toString());\n}\n```\n\n**è§£æ³•ä¸‰**\n\næ ‡å‡†`O(N)`çš„è§£æ³•\n\n```java\nprivate long mod=1000000007;    \n\nList<Long> sum=new ArrayList<>();\n\n//æ ‡å‡†è§£æ³•\npublic int maxProduct(TreeNode root) {\n    long max=-1;\n    long sumAll=dfs(root);\n    for (Long s:sum) {\n        max=Math.max(max,s*(sumAll-s));    \n    }\n    return (int)(max%mod);\n}\n\npublic long dfs(TreeNode root){\n    if (root==null) {\n        return 0;\n    }\n    sum.add(root.val+dfs(root.left)+dfs(root.right));\n    return sum.get(sum.size()-1);\n}\n```\n\nåœ¨dfsçš„è¿‡ç¨‹ä¸­å°†å­æ ‘çš„sumå­˜èµ·æ¥ï¼Œç„¶åç›´æ¥éå†listï¼Œæ±‚ `max(s*(sumAll-s))`å°±ok\n\n> è¿™é‡Œæœ€å¼€å§‹è¢«å¤§æ•°æ®ä¹Ÿå¡äº†ä¸€ä¼šå„¿ï¼Œä¸çŸ¥é“å•¥æ—¶å€™å–æ¨¡ï¼Œå…¶å®è¿™é‡Œé¢˜ç›®æ²¡æœ‰é‚£ä¹ˆéš¾ï¼Œç›¸ä¹˜çš„ç»“æœå¹¶ä¸ä¼šæº¢å‡ºLongï¼Œå¦‚æœè¦æ˜¯æº¢å‡ºLongçš„è¯å¯èƒ½å°±è¦ç”¨ä»€ä¹ˆå¸¦æ¨¡å¿«é€Ÿä¹˜äº†\n\n## [297. äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–](https://leetcode-cn.com/problems/serialize-and-deserialize-binary-tree/)\n\nåºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡è½¬æ¢ä¸ºè¿ç»­çš„æ¯”ç‰¹ä½çš„æ“ä½œï¼Œè¿›è€Œå¯ä»¥å°†è½¬æ¢åçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å†…å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºç¯å¢ƒï¼Œé‡‡å–ç›¸åæ–¹å¼é‡æ„å¾—åˆ°åŸæ•°æ®ã€‚\n\nè¯·è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥å®ç°äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚è¿™é‡Œä¸é™å®šä½ çš„åºåˆ— / ååºåˆ—åŒ–ç®—æ³•æ‰§è¡Œé€»è¾‘ï¼Œä½ åªéœ€è¦ä¿è¯ä¸€ä¸ªäºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶ä¸”å°†è¿™ä¸ªå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºåŸå§‹çš„æ ‘ç»“æ„ã€‚\n\n**ç¤ºä¾‹:** \n\n```java\nä½ å¯ä»¥å°†ä»¥ä¸‹äºŒå‰æ ‘ï¼š\n    1\n   / \\\n  2   3\n     / \\\n    4   5\n\nåºåˆ—åŒ–ä¸º \"[1,2,3,null,null,4,5]\"\n```\n\n**æç¤º:** è¿™ä¸ LeetCode ç›®å‰ä½¿ç”¨çš„æ–¹å¼ä¸€è‡´ï¼Œè¯¦æƒ…è¯·å‚é˜… LeetCode åºåˆ—åŒ–äºŒå‰æ ‘çš„æ ¼å¼ã€‚ä½ å¹¶éå¿…é¡»é‡‡å–è¿™ç§æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n**è¯´æ˜:** ä¸è¦ä½¿ç”¨ç±»çš„æˆå‘˜ / å…¨å±€ / é™æ€å˜é‡æ¥å­˜å‚¨çŠ¶æ€ï¼Œä½ çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç®—æ³•åº”è¯¥æ˜¯æ— çŠ¶æ€çš„ã€‚\n\n**è§£æ³•ä¸€**\n\nå±‚åºéå†éé€’å½’çš„æ–¹å¼\n\n```java\n//å±‚åºéå†çš„æ–¹å¼\npublic String serialize(TreeNode root) {\n    if (root==null) {\n        return \"\";\n    }\n    //BFS\n    StringBuilder sb=new StringBuilder();\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        TreeNode cur=queue.poll();\n        if (cur!=null) {\n            sb.append(cur.val+\",\");\n            queue.add(cur.left);\n            queue.add(cur.right);\n        }else{\n            sb.append(\"null,\"); //ä¼šå¤šå¾ˆå¤šnull,ä¸è¿‡å½±å“ä¸å¤§\n        }\n    }\n    return sb.toString();\n}\n\n//æŒ‰ç…§é¢˜ç›®æ„æ€å†™ä»£ç å°±ok\npublic TreeNode deserialize(String data) {\n    if (\"\".equals(data)) {\n        return null;\n    }\n    String[] treeData=data.split(\",\");\n    int index=0;\n    TreeNode root=node(treeData[index]);\n    Queue<TreeNode> queue=new LinkedList<>();\n    queue.add(root);\n    while(!queue.isEmpty()){\n        TreeNode cur=queue.poll();\n        cur.left=node(treeData[++index]);\n        if (cur.left!=null) {\n            queue.add(cur.left);\n        }\n        cur.right=node(treeData[++index]);\n        if (cur.right!=null) {\n            queue.add(cur.right);\n        }\n    }\n    return root;\n}\n\npublic TreeNode node(String str){\n    if (!\"null\".equals(str)) {\n        return new TreeNode(Integer.valueOf(str));\n    }\n    return null;\n}\n```\n\n**è§£æ³•äºŒ**\n\nå‰åºéå†é€’å½’æ–¹å¼ï¼Œæˆ‘ä»¬å°†åºåˆ—åŒ–çš„ç»“æœå­˜åœ¨ä¸€ä¸ª`queue`ä¸­ï¼Œç„¶åä»å¤´å¼€å§‹å–ï¼Œå› ä¸ºæ˜¯å‰åºéå†ï¼Œæ‰€ä»¥æ•´ä½“ç»“æ„è‚¯å®šæ˜¯`ã€root,root.left,root.rightã€‘` \n\nååºåˆ—åŒ–å…³é”®å°±æ˜¯å¦‚ä½•åŒºåˆ†å·¦å³å­æ ‘ï¼Œä»…ä»…ä¾é ä¸€ä¸ªå‰åºéå†æ˜¯æ— æ³•é‡å»ºäºŒå‰æ ‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšä¸€äº›å°æ‰‹æ®µï¼Œåœ¨åºåˆ—åŒ–èŠ‚ç‚¹ä¸ºç©ºçš„æ—¶å€™åŠ å…¥`null`å­—ç¬¦ï¼Œè¿™æ ·å·¦å³èŠ‚ç‚¹å°±ä¼šè¢«è¿ç»­çš„ä¸¤ä¸ª`[null,null]`åˆ†éš”å¼€ï¼Œæ–¹ä¾¿é‡å»º\n\n> eg.  ç¤ºä¾‹ä¸€ï¼š  1,2,null,null,3,4,null,null,5,null,null\n\n```java\npublic TreeNode node(String str){\n    if (!\"null\".equals(str)) {\n        return new TreeNode(Integer.valueOf(str));\n    }\n    return null;\n}\n\npublic String serialize(TreeNode root) {\n    if (root==null) {\n        return \"null\";\n    }\n    return root.val+\",\"+serialize(root.left)+\",\"+serialize(root.right);\n}\n\npublic TreeNode deserialize(String data) {\n    if (\"\".equals(data)) {\n        return null;\n    }\n    String[] dataTree=data.split(\",\");\n    Queue<String> queue=new LinkedList<>(Arrays.asList(dataTree));\n    return deserialize(queue);\n}\n\npublic TreeNode deserialize(Queue<String> queue){\n    String val=queue.poll();\n    if (\"null\".equals(val)) {\n        return null;\n    }\n    TreeNode root=node(val);\n    root.left=deserialize(queue);\n    root.right=deserialize(queue);\n    return root;\n}\n```\n**è§£æ³•ä¸‰**\n\nè¡¥å……ä¸€ä¸ªgoçš„å†™æ³•ï¼Œå’Œè§£æ³•äºŒçš„æ€è·¯æ˜¯ä¸€æ ·çš„\n```go\ntype Codec struct {\n}\n\nfunc Constructor() Codec {\n    return Codec{}\n}\n\n// Serializes a tree to a single string.\nfunc (this *Codec) serialize(root *TreeNode) string {\n    if root == nil {\n        return \"nil\"\n    }\n    return strconv.Itoa(root.Val) + \",\" + this.serialize(root.Left) + \",\" + this.serialize(root.Right)\n}\n\n// Deserializes your encoded data to tree.\nfunc (this *Codec) deserialize(data string) *TreeNode {\n    queue := strings.Split(data, \",\")\n    return this.des(&queue)\n}\n\nfunc (this *Codec) des(queue *[]string) *TreeNode {\n    if len(*queue) == 0 {\n        return nil\n    }\n    cur := (*queue)[0]\n    *queue = (*queue)[1:]\n    if cur == \"nil\" {\n        return nil\n    }\n    val, _ := strconv.Atoi(cur)\n    root := &TreeNode{Val: val}\n    root.Left = this.des(queue)\n    root.Right = this.des(queue)\n    return root\n}\n```\n## [449. åºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/serialize-and-deserialize-bst/)\nåºåˆ—åŒ–æ˜¯å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢ä¸ºä¸€ç³»åˆ—ä½çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿å®ƒå¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶æˆ–å†…å­˜ç¼“å†²åŒºä¸­ï¼Œæˆ–é€šè¿‡ç½‘ç»œè¿æ¥é“¾è·¯ä¼ è¾“ï¼Œä»¥ä¾¿ç¨ååœ¨åŒä¸€ä¸ªæˆ–å¦ä¸€ä¸ªè®¡ç®—æœºç¯å¢ƒä¸­é‡å»ºã€‚\n\nè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æœç´¢æ ‘ã€‚ å¯¹åºåˆ—åŒ–/ååºåˆ—åŒ–ç®—æ³•çš„å·¥ä½œæ–¹å¼æ²¡æœ‰é™åˆ¶ã€‚ æ‚¨åªéœ€ç¡®ä¿äºŒå‰æœç´¢æ ‘å¯ä»¥åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å¯ä»¥å°†è¯¥å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºæœ€åˆçš„äºŒå‰æœç´¢æ ‘ã€‚\n\nç¼–ç çš„å­—ç¬¦ä¸²åº”å°½å¯èƒ½ç´§å‡‘ã€‚\n\n**æ³¨æ„ï¼š** ä¸è¦ä½¿ç”¨ç±»æˆå‘˜/å…¨å±€/é™æ€å˜é‡æ¥å­˜å‚¨çŠ¶æ€ã€‚ ä½ çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç®—æ³•åº”è¯¥æ˜¯æ— çŠ¶æ€çš„ã€‚\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®è¯´ `ç¼–ç çš„å­—ç¬¦ä¸²åº”å°½å¯èƒ½ç´§å‡‘`ï¼Œæ‰€ä»¥ç›´æ¥æŠŠä¸Šé¢297çš„æ¬è¿‡æ¥å…¶å®ä¸å¤ªå¥½ï¼Œå› ä¸ºä¼šæœ‰å¾ˆå¤šnullå­—ç¬¦ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰ç”¨åˆ°é¢˜ç›®äºŒ`bst`çš„æ¡ä»¶ï¼Œ`bst`åªéœ€è¦çŸ¥é“ä¸€ä¸ªå‰åºæˆ–è€…ååºå°±å¯ä»¥è¿˜åŸæ•´æ£µæ ‘ï¼Œé¢˜ç›®å°±å˜æˆäº†æ ¹æ®`å‰åº/ååº`å’Œ`ä¸­åº`è¿˜åŸäºŒå‰æ ‘\n\n`golang`æ–°æ‰‹ï¼Œç”¨`golang`å†™äº†ä¸€å‘ï¼Œæ„Ÿè§‰å†™å¤æ‚äº†ï¼ˆå®˜æ–¹è§£æ³•ä¸­è¿˜æœ‰æ›´åŠ æ¿€è¿›çš„å‹ç¼©ç¼–ç çš„æ–¹å¼ï¼Œæ„Ÿè§‰æœ‰ç‚¹åäº†ï¼‰\n\n```go\ntype Codec struct {\n}\n\nfunc Constructor() Codec {\n    return Codec{}\n}\n\n// Serializes a tree to a single string.\nfunc (this *Codec) serialize(root *TreeNode) string {\n    if root == nil {\n        return \"\"\n    }\n    var queue []string\n    var dfs func(root *TreeNode)\n    dfs = func(root *TreeNode) {\n        if root == nil {\n            return\n        }\n        queue = append(queue, strconv.Itoa(root.Val))\n        dfs(root.Left)\n        dfs(root.Right)\n    }\n    dfs(root)\n    return strings.Join(queue, \",\")\n}\n\n// Deserializes your encoded data to tree.\nfunc (this *Codec) deserialize(data string) *TreeNode {\n    if data == \"\" {\n        return nil\n    }\n    //fmt.Println(data)\n    queue := strings.Split(data, \",\")\n    inOrder := make([]int, len(queue))\n    for i, v := range queue {\n        inOrder[i], _ = strconv.Atoi(v)\n    }\n    preOrder := make([]int, len(inOrder))\n    copy(preOrder, inOrder)\n    sort.Ints(inOrder)\n    var dfs func(preOrder, inOrder []int) *TreeNode\n    dfs = func(preOrder, inOrder []int) *TreeNode {\n        if len(inOrder) == 0 {\n            return nil\n        }\n        root := &TreeNode{Val: preOrder[0]}\n        rootIdx := 0\n        for i, v := range inOrder {\n            if v == preOrder[0] {\n                rootIdx = i\n                break\n            }\n        }\n        root.Left = dfs(preOrder[1:rootIdx+1], inOrder[:rootIdx])\n        root.Right = dfs(preOrder[rootIdx+1:], inOrder[rootIdx+1:])\n        return root\n    }\n    return dfs(preOrder, inOrder)\n}\n```\n\n\n## [é¢è¯•é¢˜33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—](https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/)\n\nè¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­è¯¥æ•°ç»„æ˜¯ä¸æ˜¯æŸäºŒå‰æœç´¢æ ‘çš„ååºéå†ç»“æœã€‚å¦‚æœæ˜¯åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚å‡è®¾è¾“å…¥çš„æ•°ç»„çš„ä»»æ„ä¸¤ä¸ªæ•°å­—éƒ½äº’ä¸ç›¸åŒã€‚\n\nå‚è€ƒä»¥ä¸‹è¿™é¢—äºŒå‰æœç´¢æ ‘ï¼š\n\n```java\n     5\n    / \\\n   2   6\n  / \\\n 1   3\n```\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: [1,6,3,2,5]\nè¾“å‡º: false\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: [1,3,2,6,5]\nè¾“å‡º: true\n```\n\n**æç¤ºï¼š**\n\n1. `æ•°ç»„é•¿åº¦ <= 1000`\n\n**è§£æ³•ä¸€**\n\næ ¸å¿ƒåœ¨äºæ„è¯†åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹\n\n```java\npublic boolean verifyPostorder(int[] postorder) {\n    if(postorder==null || postorder.length<=0) return true;\n    return verify(postorder,0,postorder.length-1);\n}\n\npublic boolean verify(int[] postorder,int left,int right){\n    if(left>=right) return true;\n    int root=postorder[right];\n    //WAç‚¹,è¿™é‡Œè¦è®¾ç½®æˆleft-1é˜²æ­¢æ²¡æœ‰å·¦å­æ ‘çš„æƒ…å†µ,æ¯”å¦‚5 4 3 2 1\n    //è¿™æ ·å¯ä»¥è·³è¿‡ç¬¬äºŒä¸ªå¾ªç¯å¹¶ä¸”ä¸ç”¨é€’å½’éªŒè¯å·¦å­æ ‘\n    int index=left-1;\n    for(int i=right-1;i>=left;i--){ //ä»åå¾€å‰æ‰¾ç¬¬ä¸€ä¸ªå°äºroot\n        if(postorder[i]<root){\n            index=i; //æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äºrootçš„,ä½œä¸ºå·¦å­æ ‘çš„æ ¹\n            break;\n        }\n    }\n    //åˆ¤æ–­å·¦å­æ ‘æ˜¯å¦éƒ½æ˜¯å°äºrootçš„\n    for(int i=index;i>=left;i--){\n        if(postorder[i]>root){\n            return false;\n        }\n    }\n    //é€’å½’éªŒè¯å·¦å³å­æ ‘\n    return verify(postorder,left,index) && verify(postorder,index+1,right-1);\n}\n```\nè¿™é¢˜WAäº†3å‘ï¼Œå‰ä¸¤å‘æ˜¯ä»£ç é€»è¾‘çš„é—®é¢˜ï¼Œæƒ³ç®€åŒ–ä»£ç ï¼Œç»“æœæŠŠè‡ªå·±å¸¦å‘é‡Œé¢å»äº†ï¼Œæœ€åä¸€æ¬¡æ˜¯å› ä¸ºä¸€ä¸ªå˜é‡è®¾ç½®çš„é—®é¢˜ï¼Œä»£ç ä¸­å·²ç»æ³¨é‡Š\n\n**UPDATE: 2020.7.14**\n\né‡å†™äº†ä¸‹ï¼Œè¿™æ ·å†™å°±ä¸ä¼šæœ‰å¥‡æ€ªçš„WAç‚¹äº†ï¼Œè¿˜æ˜¯è¦å¤šæ³¨æ„ç»†èŠ‚å’Œè¾¹ç•Œ\n```golang\nfunc verifyPostorder(post []int) bool {\n    return dfs(post, 0, len(post)-1)\n}\n\nfunc dfs(post[] int, left int, right int) bool {\n    if left>=right{\n        return true\n    }\n    var p = right-1\n    for p >= left && post[p] > post[right]{\n        p--\n    }\n    for i := p; i >= left; i--{\n        if post[i] > post[right]{\n            return false\n        }\n    }\n    return dfs(post, left, p) && dfs(post, p+1,right-1)\n}\n```\n\n**è§£æ³•äºŒ**\n\nå•è°ƒæ ˆçš„è§£æ³•ï¼Œæ”¾åœ¨[å•è°ƒæ ˆä¸“é¢˜](http://imlgw.top/2019/10/01/leetcode-zhan-dui-lie/#%E9%9D%A2%E8%AF%95%E9%A2%9833-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97)ä¸­\n\n## [654. æœ€å¤§äºŒå‰æ ‘](https://leetcode-cn.com/problems/maximum-binary-tree/)\n\nç»™å®šä¸€ä¸ªä¸å«é‡å¤å…ƒç´ çš„æ•´æ•°æ•°ç»„ã€‚ä¸€ä¸ªä»¥æ­¤æ•°ç»„æ„å»ºçš„æœ€å¤§äºŒå‰æ ‘å®šä¹‰å¦‚ä¸‹ï¼š\n\n1. äºŒå‰æ ‘çš„æ ¹æ˜¯æ•°ç»„ä¸­çš„æœ€å¤§å…ƒç´ ã€‚\n2. å·¦å­æ ‘æ˜¯é€šè¿‡æ•°ç»„ä¸­æœ€å¤§å€¼å·¦è¾¹éƒ¨åˆ†æ„é€ å‡ºçš„æœ€å¤§äºŒå‰æ ‘ã€‚\n3. å³å­æ ‘æ˜¯é€šè¿‡æ•°ç»„ä¸­æœ€å¤§å€¼å³è¾¹éƒ¨åˆ†æ„é€ å‡ºçš„æœ€å¤§äºŒå‰æ ‘ã€‚\n\né€šè¿‡ç»™å®šçš„æ•°ç»„æ„å»ºæœ€å¤§äºŒå‰æ ‘ï¼Œå¹¶ä¸”è¾“å‡ºè¿™ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ ï¼š**\n\n```java\nè¾“å…¥ï¼š[3,2,1,6,0,5]\nè¾“å‡ºï¼šè¿”å›ä¸‹é¢è¿™æ£µæ ‘çš„æ ¹èŠ‚ç‚¹ï¼š\n\t  6\n\t/   \\\n   3     5\n    \\    / \n     2  0   \n       \\\n        1\n```\n\n**æç¤ºï¼š**\n\n1. ç»™å®šçš„æ•°ç»„çš„å¤§å°åœ¨ [1, 1000] ä¹‹é—´ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\n//ä¸åšé¢„å¤„ç†,ç›´æ¥æœç´¢2ms,æˆ‘è¿™ä¸ª50ms+.....æ‡’å¾—æ”¹çš„å°±å½“ç»ƒæ‰‹äº†\npublic TreeNode constructMaximumBinaryTree(int[] nums) {\n    int n=nums.length;\n    int[][] max=new int[n][n];\n    for(int i=0;i<n;i++){\n        max[i][i]=i;\n        for(int j=i+1;j<n;j++){\n            max[i][j]=nums[j]>nums[max[i][j-1]]?j:max[i][j-1];\n        }\n    }\n    return dfs(nums,0,n-1,max);\n}\n\npublic TreeNode dfs(int[] nums,int left,int right,int[][] max){\n    if(left>right) return null;\n    int maxIdx=max[left][right];\n    TreeNode root=new TreeNode(nums[maxIdx]);\n    root.left=dfs(nums,left,maxIdx-1,max);\n    root.right=dfs(nums,maxIdx+1,right,max);\n    return root;\n}\n```\n\n> æ…¢çš„ä¸»è¦åŸå› æ˜¯æ„å»ºè¿™ä¸ªæ ‘çš„è¯å¤§æ¦‚åªä¼šæŸ¥è¯¢logNæ¬¡ï¼ˆæ ‘é«˜åº¦ï¼‰æœ€å¤§å€¼ï¼Œè€Œæ¯å±‚æŸ¥è¯¢çš„å¤æ‚åº¦å’Œä¸ºNï¼Œæ‰€ä»¥æ•´ä½“çš„å¤æ‚åº¦å…¶å®åªè¦O(NlogN)ï¼Œé™¤éæ•°ç»„å®Œå…¨æœ‰åºï¼Œè¿™æ ·æ¯æ¬¡åˆ†å‰²éƒ½åŠå…¶ä¸å‡åŒ€ï¼Œæ•°çš„é«˜åº¦ä¸ºNæ—¶é—´å¤æ‚åº¦æ‰ä¼šåˆ°N^2ï¼Œè€Œæˆ‘è¿™ä¸ªå°±ç›´æ¥æ˜¯N^2äº†hhhhhï¼Œå¤ªèœäº†ï¼Œé¢„å¤„ç†çš„æ€æƒ³æ˜¯å¥½çš„ï¼Œä½†æ˜¯è¿˜æ˜¯è¦çœ‹å…·ä½“çš„é¢˜ç›®ï¼Œè¿™é‡Œå…¶å®å¾ˆå¤šçš„åŒºé—´å€¼éƒ½ç”¨ä¸ä¸Šï¼ˆé™¤éæçº¿æ®µæ ‘ğŸ¤£\n\n**è§£æ³•äºŒ**\n\nè¿™é¢˜ä¹Ÿå¯ä»¥ç”¨å•è°ƒæ ˆåšï¼Œæ˜å¤©å†™ï¼Œè¿™é¢˜è¿˜æœ‰ä¸ª2ï¼Œæ˜å¤©ä¸€èµ·åšäº†\n\n## [998. æœ€å¤§äºŒå‰æ ‘ II](https://leetcode-cn.com/problems/maximum-binary-tree-ii/)\n\né¢˜ç›®æè¿°å¾ˆè¾£é¸¡ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨`æœ€å¤§äºŒå‰æ ‘A`çš„å³è¾¹æ’å…¥ä¸€ä¸ªvalï¼Œä»ç„¶æ˜¯æœ€å¤§äºŒå‰æ ‘\n\n**è§£æ³•ä¸€**\n\n```java\npublic TreeNode insertIntoMaxTree(TreeNode root, int val) {\n    if(root==null){\n        return new TreeNode(val);\n    }\n    if(root.val>val){\n        root.right=insertIntoMaxTree(root.right,val);    \n        return root;\n    }\n    TreeNode newRoot=new TreeNode(val);\n    newRoot.left=root;\n    return newRoot;\n}\n```\n## [652. å¯»æ‰¾é‡å¤çš„å­æ ‘](https://leetcode-cn.com/problems/find-duplicate-subtrees/)\n\nç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œè¿”å›æ‰€æœ‰é‡å¤çš„å­æ ‘ã€‚å¯¹äºåŒä¸€ç±»çš„é‡å¤å­æ ‘ï¼Œä½ åªéœ€è¦è¿”å›å…¶ä¸­ä»»æ„**ä¸€æ£µ**çš„æ ¹ç»“ç‚¹å³å¯ã€‚\n\nä¸¤æ£µæ ‘é‡å¤æ˜¯æŒ‡å®ƒä»¬å…·æœ‰ç›¸åŒçš„ç»“æ„ä»¥åŠç›¸åŒçš„ç»“ç‚¹å€¼ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\n        1\n       / \\\n      2   3\n     /   / \\\n    4   2   4\n       /\n      4\n```\n\nä¸‹é¢æ˜¯ä¸¤ä¸ªé‡å¤çš„å­æ ‘ï¼š\n\n```java\n      2\n     /\n    4\n```\n\nå’Œ\n\n```java\n    4\n```\n\nå› æ­¤ï¼Œä½ éœ€è¦ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å›ä¸Šè¿°é‡å¤å­æ ‘çš„æ ¹ç»“ç‚¹ã€‚\n\n**è§£æ³•ä¸€**\n\nåšäº†å¿˜äº†åŠ ä¸Šäº†ï¼Œåºåˆ—åŒ–å­æ ‘ï¼Œç”¨å“ˆå¸Œè¡¨åˆ¤é‡å°±è¡Œäº†\n\n```java\nHashMap<String,Integer> map=new HashMap<>();\n\nList<TreeNode> res=new ArrayList<>();\n\npublic List<TreeNode> findDuplicateSubtrees(TreeNode root) {\n    dfs(root);\n    return res;\n}\n\npublic String dfs(TreeNode root){\n    if(root==null){\n        //return \"#null\";\n        return \"null\";\n    }\n    //String key=\"#\"+root.val+dfs(root.left)+dfs(root.right);\n    String key=root.val+dfs(root.left)+dfs(root.right);\n    int count=map.getOrDefault(key,0);\n    if(count==1){\n        res.add(root);\n    }\n    map.put(key,count+1);\n    return key;\n}\n```\n\n> è¿™é¢˜å°‘äº†caseï¼Œä¸åŠ åˆ†éš”ç¬¦ä¹Ÿèƒ½Aï¼Œæˆ‘ä»¥ä¸ºä¼šå¡è¿™ä¸ªï¼Œè¯•äº†ä¸‹ç»“æœæ²¡å¡ï¼Œ100ç§¯åˆ†åˆ°æ‰‹ ==>  [issue](https://github.com/LeetCode-Feedback/LeetCode-Feedback/issues/284) \n\n## [653. ä¸¤æ•°ä¹‹å’Œ IV - è¾“å…¥ BST](https://leetcode-cn.com/problems/two-sum-iv-input-is-a-bst/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘å’Œä¸€ä¸ªç›®æ ‡ç»“æœï¼Œå¦‚æœ BST ä¸­å­˜åœ¨ä¸¤ä¸ªå…ƒç´ ä¸”å®ƒä»¬çš„å’Œç­‰äºç»™å®šçš„ç›®æ ‡ç»“æœï¼Œåˆ™è¿”å› trueã€‚\n\n**æ¡ˆä¾‹ 1:**\n\n```java\nè¾“å…¥: \n    5\n   / \\\n  3   6\n / \\   \\\n2   4   7\n\nTarget = 9\n\nè¾“å‡º: True\n```\n\n**æ¡ˆä¾‹ 2:**\n\n```java\nè¾“å…¥: \n    5\n   / \\\n  3   6\n / \\   \\\n2   4   7\n\nTarget = 28\n\nè¾“å‡º: False\n```\n\n**è§£æ³•ä¸€**\n\nå¼€å§‹è¿˜æƒ³ç€åœ¨logNçš„è§£æ³•ï¼Œå‘ç°å¥½åƒæä¸äº†ï¼Œè€Œä¸”è¿™æ˜¯ä¸ªeasyé¢˜ï¼Œæ‰€ä»¥è‚¯å®šå°±æ˜¯ç›´æ¥ä¸­åº+åŒæŒ‡é’ˆäº†\n\n```go\nfunc findTarget(root *TreeNode, k int) bool {\n    var inorder []int\n    dfs(root, &inorder)\n    i, j := 0, len(inorder)-1\n    for i < j {\n        if inorder[i]+inorder[j] < k {\n            i++\n        } else if inorder[i]+inorder[j] > k {\n            j--\n        } else {\n            return true\n        }\n    }\n    return false\n}\n\nfunc dfs(root *TreeNode, inorder *[]int) {\n    if root == nil {\n        return\n    }\n    dfs(root.Left, inorder)\n    *inorder = append(*inorder, root.Val)\n    dfs(root.Right, inorder)\n}\n```\n\n## [872. å¶å­ç›¸ä¼¼çš„æ ‘](https://leetcode-cn.com/problems/leaf-similar-trees/)\n\nè¯·è€ƒè™‘ä¸€é¢—äºŒå‰æ ‘ä¸Šæ‰€æœ‰çš„å¶å­ï¼Œè¿™äº›å¶å­çš„å€¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ’åˆ—å½¢æˆä¸€ä¸ª *å¶å€¼åºåˆ—* ã€‚\n\n![YDcL28.png](https://s1.ax1x.com/2020/05/14/YDcL28.png)\n\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç»™å®šä¸€é¢—å¶å€¼åºåˆ—ä¸º `(6, 7, 4, 9, 8)` çš„æ ‘ã€‚\n\nå¦‚æœæœ‰ä¸¤é¢—äºŒå‰æ ‘çš„å¶å€¼åºåˆ—æ˜¯ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºå®ƒä»¬æ˜¯ *å¶ç›¸ä¼¼* çš„ã€‚\n\nå¦‚æœç»™å®šçš„ä¸¤ä¸ªå¤´ç»“ç‚¹åˆ†åˆ«ä¸º `root1` å’Œ `root2` çš„æ ‘æ˜¯å¶ç›¸ä¼¼çš„ï¼Œåˆ™è¿”å› `true`ï¼›å¦åˆ™è¿”å› `false` ã€‚\n\n**æç¤ºï¼š**\n\n- ç»™å®šçš„ä¸¤é¢—æ ‘å¯èƒ½ä¼šæœ‰ `1` åˆ° `200` ä¸ªç»“ç‚¹ã€‚\n- ç»™å®šçš„ä¸¤é¢—æ ‘ä¸Šçš„å€¼ä»‹äº `0` åˆ° `200` ä¹‹é—´ã€‚\n\n**è§£æ³•ä¸€**\n\næ¢æˆ`StringBuilder`å¯èƒ½ä¼šå¿«ä¸€ç‚¹\n\n```java\n//æ²¡å•¥å¥½è¯´çš„\npublic boolean leafSimilar(TreeNode root1, TreeNode root2) {\n    if(root1==null || root2==null) return false;\n    return dfs(root1).equals(dfs(root2));\n}\n\npublic String dfs(TreeNode root){\n    if(root==null){\n        return \"\";\n    }\n    if(root.left==null && root.right==null){\n        return \"#\"+root.val;\n    }\n    return dfs(root.left)+dfs(root.right);\n}\n```\n> å½“æ—¶çœ‹åˆ°è¿™é¢˜å°±ç€ä¼šä¸ä¼šåˆæœ‰caseé—æ¼ï¼Œæ¯”å¦‚ä¸åŠ åˆ†éš”ç¬¦ä»€ä¹ˆçš„ï¼Œç»“æœçœ‹åˆ°githubå·²ç»æœ‰äººå…ˆæ‰‹æäº¤äº†\n\n## [5398. ç»Ÿè®¡äºŒå‰æ ‘ä¸­å¥½èŠ‚ç‚¹çš„æ•°ç›®](https://leetcode-cn.com/problems/count-good-nodes-in-binary-tree/)\n\nç»™ä½ ä¸€æ£µæ ¹ä¸º `root` çš„äºŒå‰æ ‘ï¼Œè¯·ä½ è¿”å›äºŒå‰æ ‘ä¸­å¥½èŠ‚ç‚¹çš„æ•°ç›®ã€‚\n\nã€Œå¥½èŠ‚ç‚¹ã€X å®šä¹‰ä¸ºï¼šä»æ ¹åˆ°è¯¥èŠ‚ç‚¹ X æ‰€ç»è¿‡çš„èŠ‚ç‚¹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•èŠ‚ç‚¹çš„å€¼å¤§äº X çš„å€¼ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![YREc7j.png](https://s1.ax1x.com/2020/05/17/YREc7j.png)\n\n```java\nè¾“å…¥ï¼šroot = [3,1,4,3,null,1,5]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šå›¾ä¸­è“è‰²èŠ‚ç‚¹ä¸ºå¥½èŠ‚ç‚¹ã€‚\næ ¹èŠ‚ç‚¹ (3) æ°¸è¿œæ˜¯ä¸ªå¥½èŠ‚ç‚¹ã€‚\nèŠ‚ç‚¹ 4 -> (3,4) æ˜¯è·¯å¾„ä¸­çš„æœ€å¤§å€¼ã€‚\nèŠ‚ç‚¹ 5 -> (3,4,5) æ˜¯è·¯å¾„ä¸­çš„æœ€å¤§å€¼ã€‚\nèŠ‚ç‚¹ 3 -> (3,1,3) æ˜¯è·¯å¾„ä¸­çš„æœ€å¤§å€¼ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![YREukR.png](https://s1.ax1x.com/2020/05/17/YREukR.png)\n\n```java\nè¾“å…¥ï¼šroot = [3,3,null,4,2]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šèŠ‚ç‚¹ 2 -> (3, 3, 2) ä¸æ˜¯å¥½èŠ‚ç‚¹ï¼Œå› ä¸º \"3\" æ¯”å®ƒå¤§ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šroot = [1]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šæ ¹èŠ‚ç‚¹æ˜¯å¥½èŠ‚ç‚¹ã€‚\n```\n\n**æç¤ºï¼š**\n\n- äºŒå‰æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®èŒƒå›´æ˜¯ `[1, 10^5]` ã€‚\n- æ¯ä¸ªèŠ‚ç‚¹æƒå€¼çš„èŒƒå›´æ˜¯ `[-10^4, 10^4]` ã€‚\n\n**è§£æ³•ä¸€**\n\n26thåŒå‘¨èµ›çš„t3ï¼Œæ°´é¢˜\n\n```java\nint count=0;\n\npublic int goodNodes(TreeNode root) {\n    if(root==null) return 0;\n    dfs(root,root.val);\n    return count;\n}\n\npublic void dfs(TreeNode root,int max){\n    if(root==null){\n        return;\n    }\n    if(max<=root.val){\n        count++;\n        max=root.val;\n    }\n    dfs(root.left,max);\n    dfs(root.right,max);\n}\n```\n\n## [669. ä¿®å‰ªäºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/trim-a-binary-search-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼ŒåŒæ—¶ç»™å®šæœ€å°è¾¹ç•Œ`L` å’Œæœ€å¤§è¾¹ç•Œ `R`ã€‚é€šè¿‡ä¿®å‰ªäºŒå‰æœç´¢æ ‘ï¼Œä½¿å¾—æ‰€æœ‰èŠ‚ç‚¹çš„å€¼åœ¨`[L, R]`ä¸­ (R>=L) ã€‚ä½ å¯èƒ½éœ€è¦æ”¹å˜æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç»“æœåº”å½“è¿”å›ä¿®å‰ªå¥½çš„äºŒå‰æœç´¢æ ‘çš„æ–°çš„æ ¹èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```\nè¾“å…¥: \n    1\n   / \\\n  0   2\n\n  L = 1\n  R = 2\n\nè¾“å‡º: \n    1\n      \\\n       2\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \n    3\n   / \\\n  0   4\n   \\\n    2\n   /\n  1\n\n  L = 1\n  R = 3\n\nè¾“å‡º: \n      3\n     / \n   2   \n  /\n 1\n```\n\n**è§£æ³•ä¸€**\n\næ²¡å•¥å¥½è¯´çš„ï¼Œé€’å½’ååºéå†å°±å®Œäº‹äº†ï¼Œæ ‘çš„é¢˜è¿˜æ˜¯æŒºå¥—è·¯çš„\n\n```java\npublic TreeNode trimBST(TreeNode root, int L, int R) {\n    if(root==null){\n        return root;\n    }\n    root.left=trimBST(root.left,L,R);\n    root.right=trimBST(root.right,L,R);\n    //root.val<L,å·¦å­æ ‘å…¨éƒ¨å°äºL\n    if(root.val<L){\n        return root.right;\n    }\n    if(root.val>R){\n        return root.left;\n    }\n    return root;\n}\n```\n## [814. äºŒå‰æ ‘å‰ªæ](https://leetcode-cn.com/problems/binary-tree-pruning/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šäºŒå‰æ ‘æ ¹ç»“ç‚¹Â `root`Â ï¼Œæ­¤å¤–æ ‘çš„æ¯ä¸ªç»“ç‚¹çš„å€¼è¦ä¹ˆæ˜¯ 0ï¼Œè¦ä¹ˆæ˜¯ 1ã€‚\n\nè¿”å›ç§»é™¤äº†æ‰€æœ‰ä¸åŒ…å« 1 çš„å­æ ‘çš„åŸäºŒå‰æ ‘ã€‚\n\n( èŠ‚ç‚¹ X çš„å­æ ‘ä¸º X æœ¬èº«ï¼Œä»¥åŠæ‰€æœ‰ X çš„åä»£ã€‚)\n\n```golang\nç¤ºä¾‹1:\nè¾“å…¥: [1,null,0,0,1]\nè¾“å‡º: [1,null,0,null,1]\n\nè§£é‡Š: \nåªæœ‰çº¢è‰²èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶â€œæ‰€æœ‰ä¸åŒ…å« 1 çš„å­æ ‘â€ã€‚\nå³å›¾ä¸ºè¿”å›çš„ç­”æ¡ˆã€‚\n```\n\n```golang\nç¤ºä¾‹2:\nè¾“å…¥: [1,0,1,0,0,0,1]\nè¾“å‡º: [1,null,1,null,1]\n\n```\n\n```golang\nç¤ºä¾‹3:\nè¾“å…¥: [1,1,0,1,1,0,1,0]\nè¾“å‡º: [1,1,0,1,1,null,1]\n\n```\n\n**è¯´æ˜:**\n\n*   ç»™å®šçš„äºŒå‰æ ‘æœ€å¤šæœ‰Â `100`Â ä¸ªèŠ‚ç‚¹ã€‚\n*   æ¯ä¸ªèŠ‚ç‚¹çš„å€¼åªä¼šä¸ºÂ `0` æˆ–Â `1`Â ã€‚\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢å·®ä¸å¤šï¼Œæ„Ÿè§‰åº”è¯¥æ˜¯æ˜¯easyã€‚ã€‚ã€‚\n```golang\n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n * Â  Â  Val int\n * Â  Â  Left *TreeNode\n * Â  Â  Right *TreeNode\n * }\n */\nfunc pruneTree(root *TreeNode) *TreeNode {\n Â  Â if root == nil{\n Â  Â  Â  Â return nil\n Â   }\n Â  Â root.Left = pruneTree(root.Left)\n Â  Â root.Right = pruneTree(root.Right)\n Â  Â if root.Left == nil && root.Right==nil && root.Val == 0{\n Â  Â  Â  Â return nil\n Â   }\n Â  Â return root\n}\n```\n\n## [965. å•å€¼äºŒå‰æ ‘](https://leetcode-cn.com/problems/univalued-binary-tree/)\n\né¢˜ç›®å°±ä¸copyäº†ï¼ŒäºŒå‰æ ‘åªæœ‰ä¸€ä¸ªå€¼ï¼Œæ°´é¢˜\n\n**è§£æ³•ä¸€**\n\n```java\npublic boolean isUnivalTree(TreeNode root) {\n    return dfs(root,root.val);\n}\n\npublic boolean dfs(TreeNode root,int val){\n    if(root==null) return true;\n    return root.val==val && dfs(root.left,val) && dfs(root.right,val);\n}\n```\n\n## [1145. äºŒå‰æ ‘ç€è‰²æ¸¸æˆ](https://leetcode-cn.com/problems/binary-tree-coloring-game/)\n\næœ‰ä¸¤ä½æå®¢ç©å®¶å‚ä¸äº†ä¸€åœºã€ŒäºŒå‰æ ‘ç€è‰²ã€çš„æ¸¸æˆã€‚æ¸¸æˆä¸­ï¼Œç»™å‡ºäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ `root`ï¼Œæ ‘ä¸Šæ€»å…±æœ‰ `n` ä¸ªèŠ‚ç‚¹ï¼Œä¸” `n` ä¸ºå¥‡æ•°ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å€¼ä» `1` åˆ° `n` å„ä¸ç›¸åŒã€‚\n\næ¸¸æˆä»ã€Œä¸€å·ã€ç©å®¶å¼€å§‹ï¼ˆã€Œä¸€å·ã€ç©å®¶ä¸ºçº¢è‰²ï¼Œã€ŒäºŒå·ã€ç©å®¶ä¸ºè“è‰²ï¼‰ï¼Œæœ€å¼€å§‹æ—¶ï¼Œ\n\nã€Œä¸€å·ã€ç©å®¶ä» `[1, n]` ä¸­å–ä¸€ä¸ªå€¼ `x`ï¼ˆ`1 <= x <= n`ï¼‰ï¼›\n\nã€ŒäºŒå·ã€ç©å®¶ä¹Ÿä» `[1, n]` ä¸­å–ä¸€ä¸ªå€¼ `y`ï¼ˆ`1 <= y <= n`ï¼‰ä¸” `y != x`ã€‚\n\nã€Œä¸€å·ã€ç©å®¶ç»™å€¼ä¸º `x` çš„èŠ‚ç‚¹æŸ“ä¸Šçº¢è‰²ï¼Œè€Œã€ŒäºŒå·ã€ç©å®¶ç»™å€¼ä¸º `y` çš„èŠ‚ç‚¹æŸ“ä¸Šè“è‰²ã€‚\n\nä¹‹åä¸¤ä½ç©å®¶è½®æµè¿›è¡Œæ“ä½œï¼Œæ¯ä¸€å›åˆï¼Œç©å®¶é€‰æ‹©ä¸€ä¸ªä»–ä¹‹å‰æ¶‚å¥½é¢œè‰²çš„èŠ‚ç‚¹ï¼Œå°†æ‰€é€‰èŠ‚ç‚¹ä¸€ä¸ª **æœªç€è‰²** çš„é‚»èŠ‚ç‚¹ï¼ˆå³å·¦å³å­èŠ‚ç‚¹ã€æˆ–çˆ¶èŠ‚ç‚¹ï¼‰è¿›è¡ŒæŸ“è‰²ã€‚\n\nå¦‚æœå½“å‰ç©å®¶æ— æ³•æ‰¾åˆ°è¿™æ ·çš„èŠ‚ç‚¹æ¥æŸ“è‰²æ—¶ï¼Œä»–çš„å›åˆå°±ä¼šè¢«è·³è¿‡ã€‚\n\nè‹¥ä¸¤ä¸ªç©å®¶éƒ½æ²¡æœ‰å¯ä»¥æŸ“è‰²çš„èŠ‚ç‚¹æ—¶ï¼Œæ¸¸æˆç»“æŸã€‚ç€è‰²èŠ‚ç‚¹æœ€å¤šçš„é‚£ä½ç©å®¶è·å¾—èƒœåˆ© âœŒï¸ã€‚\n\nç°åœ¨ï¼Œå‡è®¾ä½ æ˜¯ã€ŒäºŒå·ã€ç©å®¶ï¼Œæ ¹æ®æ‰€ç»™å‡ºçš„è¾“å…¥ï¼Œå‡å¦‚å­˜åœ¨ä¸€ä¸ª `y` å€¼å¯ä»¥ç¡®ä¿ä½ èµ¢å¾—è¿™åœºæ¸¸æˆï¼Œåˆ™è¿”å› `true`ï¼›è‹¥æ— æ³•è·èƒœï¼Œå°±è¯·è¿”å› `false`ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n![tpXUW6.png](https://s1.ax1x.com/2020/05/25/tpXUW6.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,3,4,5,6,7,8,9,10,11], n = 11, x = 3\nè¾“å‡ºï¼šTrue\nè§£é‡Šï¼šç¬¬äºŒä¸ªç©å®¶å¯ä»¥é€‰æ‹©å€¼ä¸º 2 çš„èŠ‚ç‚¹ã€‚\n```\n\n**æç¤ºï¼š**\n\n- äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ä¸º `root`ï¼Œæ ‘ä¸Šç”± `n` ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¸Šçš„å€¼ä» `1` åˆ° `n` å„ä¸ç›¸åŒã€‚\n- `n` ä¸ºå¥‡æ•°ã€‚\n- `1 <= x <= n <= 100`\n\n**è§£æ³•ä¸€**\n\nç¬¬ä¸€ä¸ªé€‰æ‰‹é€‰æ‹©äº†ä¸€ä¸ªèŠ‚ç‚¹ä¹‹åï¼Œå°†äºŒå‰æ ‘å®é™…ä¸Šåˆ’åˆ†ä¸ºäº†3ä¸ªåŒºåŸŸï¼Œå·¦å­©å­åŒºåŸŸï¼Œå³å­©å­åŒºåŸŸï¼Œè¿˜æœ‰çˆ¶èŠ‚ç‚¹æ‰€åœ¨åŒºåŸŸï¼Œä¸‰ä¸ªåŒºåŸŸä»¥xä¸ºç•Œé™ï¼Œæ²¡æœ‰äº¤é›†ï¼Œç¬¬äºŒä¸ªé€‰æ‰‹éœ€è¦åœ¨ä¸‰ä¸ªåŒºåŸŸä¸­é€‰å–ä¸€ä¸ªåŒºåŸŸï¼Œä½¿è‡ªå·±èƒ½èµ¢ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬è‚¯å®šè¦é€‰æœ€å¤§çš„é‚£ä¸ªåŒºåŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­æœ€å¤§çš„åŒºåŸŸæ˜¯å¦æ¯”å‰©ä¸‹å…¶ä»–éƒ¨åˆ†å’Œéƒ½è¦å¤§å°±è¡Œäº†\n\n```java\nint max=0;\n\npublic boolean btreeGameWinningMove(TreeNode root, int n, int x) {\n    dfs(root,x,n);\n    return max>n-max;\n}\n\npublic int dfs(TreeNode root,int x,int n){\n    if(root==null) return 0;\n    int left=dfs(root.left,x,n);\n    int right=dfs(root.right,x,n);\n    if(root.val==x){\n        max=Math.max(left,max);\n        max=Math.max(right,max);\n        max=Math.max(n-left-right-1,max);\n    }\n    return left+right+1;\n}\n```\n\n## [993. äºŒå‰æ ‘çš„å ‚å…„å¼ŸèŠ‚ç‚¹](https://leetcode-cn.com/problems/cousins-in-binary-tree/)\n\nåœ¨äºŒå‰æ ‘ä¸­ï¼Œæ ¹èŠ‚ç‚¹ä½äºæ·±åº¦ `0` å¤„ï¼Œæ¯ä¸ªæ·±åº¦ä¸º `k` çš„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä½äºæ·±åº¦ `k+1` å¤„ã€‚\n\nå¦‚æœäºŒå‰æ ‘çš„ä¸¤ä¸ªèŠ‚ç‚¹æ·±åº¦ç›¸åŒï¼Œä½†**çˆ¶èŠ‚ç‚¹ä¸åŒ**ï¼Œåˆ™å®ƒä»¬æ˜¯ä¸€å¯¹*å ‚å…„å¼ŸèŠ‚ç‚¹*ã€‚\n\næˆ‘ä»¬ç»™å‡ºäº†å…·æœ‰å”¯ä¸€å€¼çš„äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ `root`ï¼Œä»¥åŠæ ‘ä¸­ä¸¤ä¸ªä¸åŒèŠ‚ç‚¹çš„å€¼ `x` å’Œ `y`ã€‚\n\nåªæœ‰ä¸å€¼ `x` å’Œ `y` å¯¹åº”çš„èŠ‚ç‚¹æ˜¯å ‚å…„å¼ŸèŠ‚ç‚¹æ—¶ï¼Œæ‰è¿”å› `true`ã€‚å¦åˆ™ï¼Œè¿”å› `false`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![tsO8yR.png](https://s1.ax1x.com/2020/06/05/tsO8yR.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,3,4], x = 4, y = 3\nè¾“å‡ºï¼šfalse\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![tsOYex.png](https://s1.ax1x.com/2020/06/05/tsOYex.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,3,null,4,null,5], x = 5, y = 4\nè¾“å‡ºï¼štrue\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n![tsOaFO.png](https://s1.ax1x.com/2020/06/05/tsOaFO.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,2,3,null,4], x = 2, y = 3\nè¾“å‡ºï¼šfalse\n```\n\n**æç¤ºï¼š**\n\n1. äºŒå‰æ ‘çš„èŠ‚ç‚¹æ•°ä»‹äº `2` åˆ° `100` ä¹‹é—´ã€‚\n2. æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€èŒƒå›´ä¸º `1` åˆ° `100` çš„æ•´æ•°ã€‚\n\n**è§£æ³•ä¸€**\n\näºŒå‰æ ‘æ°´é¢˜ï¼ˆ3å¤©æ²¡åˆ·æ–°é¢˜äº†ï¼Œå†ä¸åˆ·å‡ é“å®åœ¨æ˜¯è¯´ä¸è¿‡å…¶äº†ï¼Œåˆ·é¢˜è¿˜æ˜¯è¦ä¿æŒæ‰‹æ„Ÿå•Šï¼‰\n\n```go\nfunc isCousins(root *TreeNode, x int, y int) bool {\n    var depX = -1\n    var pX *TreeNode\n    var depY = -1\n    var pY *TreeNode\n    var dfs func(root, parent *TreeNode, x, y int, depth int)\n    dfs = func(root, parent *TreeNode, x, y int, depth int) {\n        if root == nil { //æŒ‰é¢˜ç›®è¯´çš„è¿™é‡Œå…¶å®ä¸éœ€è¦\n            return\n        }\n        if root.Val == x {\n            depX = depth\n            pX = parent\n            //ç»“æŸè¯¥å­æ ‘çš„æœç´¢ï¼ŒåŠ å¿«é€Ÿåº¦ï¼Œä¸‹é¢å³ä½¿æœ‰Yä¹Ÿè‚¯å®šä¸æ˜¯Xçš„å ‚å…„å¼Ÿ\n            return\n        }\n        if root.Val == y {\n            depY = depth\n            pY = parent\n            //åŒä¸Š\n            return\n        }\n        dfs(root.Left, root, x, y, depth+1)\n        dfs(root.Right, root, x, y, depth+1)\n    }\n    dfs(root, nil, x, y, 0)\n    return pX != pY && depX == depY\n}\n```\n\næœ‰ä¸€ä¸ªå°çš„ä¼˜åŒ–ç‚¹è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå°±æ˜¯returnçš„åœ°æ–¹ï¼Œä¸€å¼€å§‹æ²¡è€ƒè™‘è¿™ä¹ˆå¤šï¼ŒACäº†ä¹‹åæ„Ÿè§‰ä¸å¯¹ï¼Œæ˜¯ä¸æ˜¯LCåˆå°‘CASEäº†ï¼Œç»“æœä»”ç»†ä¸€æƒ³å‘ç°è¿™é‡Œæ˜¯ä¸ªä¼˜åŒ–ç‚¹ğŸ˜\n\n## [440. å­—å…¸åºçš„ç¬¬Kå°æ•°å­—](https://leetcode-cn.com/problems/k-th-smallest-in-lexicographical-order/)\n\nç»™å®šæ•´æ•° `n` å’Œ `k`ï¼Œæ‰¾åˆ° `1` åˆ° `n` ä¸­å­—å…¸åºç¬¬ `k` å°çš„æ•°å­—ã€‚\n\næ³¨æ„ï¼š1 â‰¤ k â‰¤ n â‰¤ 1e9ã€‚\n\n**ç¤ºä¾‹ :**\n\n```java\nè¾“å…¥:\nn: 13   k: 2\n\nè¾“å‡º:\n10\n\nè§£é‡Š:\nå­—å…¸åºçš„æ’åˆ—æ˜¯ [1, 10, 11, 12, 13, 2, 3, 4, 5, 6, 7, 8, 9]ï¼Œæ‰€ä»¥ç¬¬äºŒå°çš„æ•°å­—æ˜¯ 10ã€‚\n```\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹çœ‹äº†è¯„è®ºåŒºè¯´äº†10å‰æ ‘,ç„¶åæˆ‘å°±é¡ºç€è¿™ä¸ªæ€è·¯å»æƒ³äº†,ç„¶åå°±ç›´æ¥å»å‰åºéå†äº†,ç„¶åå°±Täº†,è¿™é‡Œçœ‹ä¸‹æ•°æ®èŒƒå›´å°±çŸ¥é“è‚¯å®šæ˜¯è¿‡ä¸äº†çš„\n```java\n//TLE\npublic int findKthNumber(int n, int k) {\n    for (int i=1;i<=9;i++) {\n        dfs(i,n,k);\n    }\n    return res;\n}\n\nint idx=0,res=-1;\n\npublic void dfs(int cur,int n,int k){\n    if(res!=-1) return;\n    if(cur>n) return;\n    idx++;\n    if(k==idx){\n        res=cur;\n        return;\n    }\n    for (int i=0;i<=9;i++) {\n        dfs(cur*10+i,n,k);\n    }\n}\n```\n**è§£æ³•äºŒ**\n\nç›´æ¥éå†è‚¯å®šæ˜¯è¡Œä¸é€š,é‚£ä¹ˆå°±åªèƒ½æƒ³åŠæ³•è·³è¿‡ä¸€äº›èŠ‚ç‚¹,è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ä¸ªæ•°æ¥åˆ¤æ–­ç¬¬kä¸ªæ˜¯ä¸æ˜¯åœ¨è¯¥èŠ‚ç‚¹ä¸‹,è€Œå­èŠ‚ç‚¹çš„ä¸ªæ•°å°±å¯ä»¥ç”¨`Min(n+1,next*10)-cur`è®¡ç®—å¾—åˆ°,`next`æ˜¯å’Œcurç›¸é‚»çš„èŠ‚ç‚¹,`n`æ˜¯æœ€å¤§å€¼,ç”»ä¸ªå›¾å°±æ‡‚äº†\n![mark](http://static.imlgw.top/blog/20200614/3WPecCGnzxQl.png?imageslim)\n```golang\n//UPDATE: 2020.7.29 ä¹‹å‰çš„ä»£ç ç»†èŠ‚æœ‰çš„ä¸å¥½ç†è§£ï¼Œé‡å†™äº†ä¸€ç‰ˆ\n//æ­£è§£\nfunc findKthNumber(n int, k int) int {\n    //kå’Œcountéƒ½æ˜¯ä»1å¼€å§‹\n    var cur = 1\n    for k > 1 {\n        count := getChild(cur, n)\n        if count < k { //ä¸åœ¨è¯¥èŠ‚ç‚¹ä¸‹ï¼Œåˆ‡æ¢æˆå…„å¼ŸèŠ‚ç‚¹\n            cur++ \n            k-=count\n        } else { //åœ¨è¯¥èŠ‚ç‚¹ä¸‹ï¼Œåˆ‡æ¢æˆå­èŠ‚ç‚¹\n            cur *= 10\n            k--\n        }\n    }\n    return cur\n}\n\n//å½“å‰èŠ‚ç‚¹ä¸‹æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä»¥curå¼€å¤´çš„æœ‰å¤šå°‘ä¸ªï¼ˆåŒ…æ‹¬curï¼‰\nfunc getChild(cur int, n int) int {\n    var count = 0\n    var next = cur+1\n    for cur <= n {\n        count += Min(n+1, next) - cur\n        cur *= 10\n        next *= 10\n    }\n    return count\n}\n\nfunc Min(a, b int) int {\n    if a < b {\n        return a\n    }\n    return b\n}\n```\n\n\n## [386. å­—å…¸åºæ’æ•°](https://leetcode-cn.com/problems/lexicographical-numbers/)\nç»™å®šä¸€ä¸ªæ•´æ•°Â n, è¿”å›ä»Â 1Â åˆ°Â nÂ çš„å­—å…¸é¡ºåºã€‚\n\nä¾‹å¦‚ï¼Œ\n\nç»™å®š n =1 3ï¼Œè¿”å› [1,10,11,12,13,2,3,4,5,6,7,8,9] ã€‚\n\nè¯·å°½å¯èƒ½çš„ä¼˜åŒ–ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ã€‚ è¾“å…¥çš„æ•°æ®Â nÂ å°äºç­‰äºÂ 5,000,000ã€‚\n\n**è§£æ³•ä¸€**\n\nå…ˆåšçš„ä¸Šé¢é‚£ä¸€é¢˜,å†åšè¿™ä¸€é¢˜å°±ç®€å•å¤šäº†,å‰é¢tleçš„æ–¹æ³•å°±æ˜¯è¿™é‡Œçš„æ­£è§£,åå‰æ ‘çš„å‰åºéå†\n```java\nList<Integer> res=new ArrayList<>();\n\npublic List<Integer> lexicalOrder(int n) {\n    for(int i=1;i<=9;i++){\n        dfs(i,n);   \n    }\n    return res;\n}\n\npublic void dfs(int cur,int n){\n    if(cur>n) return;\n    res.add(cur);\n    for(int i=0;i<=9;i++){\n        dfs(cur*10+i,n);   \n    }\n}\n```\n## [1028. ä»å…ˆåºéå†è¿˜åŸäºŒå‰æ ‘](https://leetcode-cn.com/problems/recover-a-tree-from-preorder-traversal/)\n\næˆ‘ä»¬ä»äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ rootÂ å¼€å§‹è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ã€‚\n\nåœ¨éå†ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¤„ï¼Œæˆ‘ä»¬è¾“å‡ºÂ DÂ æ¡çŸ­åˆ’çº¿ï¼ˆå…¶ä¸­Â DÂ æ˜¯è¯¥èŠ‚ç‚¹çš„æ·±åº¦ï¼‰ï¼Œç„¶åè¾“å‡ºè¯¥èŠ‚ç‚¹çš„å€¼ã€‚ï¼ˆå¦‚æœèŠ‚ç‚¹çš„æ·±åº¦ä¸º Dï¼Œåˆ™å…¶ç›´æ¥å­èŠ‚ç‚¹çš„æ·±åº¦ä¸º D + 1ã€‚æ ¹èŠ‚ç‚¹çš„æ·±åº¦ä¸º 0ï¼‰ã€‚\n\nå¦‚æœèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¿è¯è¯¥å­èŠ‚ç‚¹ä¸ºå·¦å­èŠ‚ç‚¹ã€‚\n\nç»™å‡ºéå†è¾“å‡ºÂ Sï¼Œè¿˜åŸæ ‘å¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹Â rootã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n```java\nè¾“å…¥ï¼š\"1-2--3--4-5--6--7\"\nè¾“å‡ºï¼š[1,2,5,3,4,6,7]\n```\n**ç¤ºä¾‹ 2ï¼š**\n```java\nè¾“å…¥ï¼š\"1-2--3---4-5--6---7\"\nè¾“å‡ºï¼š[1,2,5,3,null,6,null,4,null,7]\n```\n**ç¤ºä¾‹ 3ï¼š**\n```java\nè¾“å…¥ï¼š\"1-401--349---90--88\"\nè¾“å‡ºï¼š[1,401,null,349,88,90]\n```\n**æç¤ºï¼š**\nåŸå§‹æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ä»‹äº 1 å’Œ 1000 ä¹‹é—´ã€‚\næ¯ä¸ªèŠ‚ç‚¹çš„å€¼ä»‹äº 1 å’Œ 10 ^ 9 ä¹‹é—´ã€‚\n\n**è§£æ³•ä¸€**\n\næŠ„ç­”æ¡ˆï¼Œç¬¬ä¸€å¤©çœ‹äº†å‡ åˆ†é’Ÿï¼Œä¸€å¼€å§‹æƒ³å†™é€’å½’ï¼Œç›´æ¥çœ‹äº†ç­”æ¡ˆï¼Œç¬¬äºŒå¤©è¿˜æ˜¯æ²¡æœ‰å®Œæ•´çš„å†™å‡ºæ¥ï¼Œå…¶å®è¿™é¢˜è¿­ä»£ä¼šå¥½ç†è§£å¾ˆå¤šï¼Œé€’å½’çš„çœ‹äº†ä¸‹ï¼Œæœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œå¾ˆtrick\n```java\npublic TreeNode recoverFromPreorder(String S) {\n    //æ ˆä¸­å­˜çš„æ˜¯æ·±åº¦ä¸¥æ ¼å•è°ƒé€’å¢ï¼ˆæ­¥ä¼ä¸º1ï¼‰çš„èŠ‚ç‚¹ 0 1 2 3 4....\n    Deque<TreeNode> stack=new ArrayDeque(); \n    int i=0;\n    while(i<S.length()){\n        int depth=0;\n        while(i<S.length() && S.charAt(i)=='-') {\n            depth++;\n            i++;\n        }\n        int val=0;\n        while(i<S.length() && S.charAt(i)>='0' && S.charAt(i)<='9'){\n            val=val*10+S.charAt(i)-48;\n            i++;\n        }\n        TreeNode node=new TreeNode(val);\n        if(depth==stack.size()){ //æ ˆçš„èŠ‚ç‚¹æ•°é‡å°±æ˜¯å½“å‰çš„æ·±åº¦\n            if(!stack.isEmpty()) stack.peek().left=node;\n        }else{\n            while(depth!=stack.size()){\n                stack.pop();\n            }\n            //depth==0çš„åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œæ˜¯ä¸ä¼šèµ°è¿™ä¸ªåˆ†æ”¯çš„ï¼Œæ‰€ä»¥è¿™é‡Œè‚¯å®šä¸ä¸ºç©º\n            stack.peek().right=node;\n        }\n        stack.push(node);\n    }\n    while(stack.size()!=1) stack.pop();\n    return stack.pop();\n}\n```\n\n## [897. é€’å¢é¡ºåºæŸ¥æ‰¾æ ‘](https://leetcode-cn.com/problems/increasing-order-search-tree/)\n\nç»™ä½ ä¸€ä¸ªæ ‘ï¼Œè¯·ä½  æŒ‰ä¸­åºéå† é‡æ–°æ’åˆ—æ ‘ï¼Œä½¿æ ‘ä¸­æœ€å·¦è¾¹çš„ç»“ç‚¹ç°åœ¨æ˜¯æ ‘çš„æ ¹ï¼Œå¹¶ä¸”æ¯ä¸ªç»“ç‚¹æ²¡æœ‰å·¦å­ç»“ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªå³å­ç»“ç‚¹ã€‚\n\n**ç¤ºä¾‹ ï¼š**\n```java\nè¾“å…¥ï¼š[5,3,6,2,4,null,8,1,null,null,null,7,9]\n\n       5\n      / \\\n    3    6\n   / \\    \\\n  2   4    8\nÂ /        / \\ \n1        7   9\n\nè¾“å‡ºï¼š[1,null,2,null,3,null,4,null,5,null,6,null,7,null,8,null,9]\n\n 1\nÂ  \\\nÂ   2\nÂ    \\\nÂ     3\nÂ      \\\nÂ       4\nÂ        \\\nÂ         5\nÂ          \\\nÂ           6\nÂ            \\\nÂ             7\nÂ              \\\nÂ               8\nÂ                \\\n                 9  \n```\nÂ \n**æç¤ºï¼š**\n\nç»™å®šæ ‘ä¸­çš„ç»“ç‚¹æ•°ä»‹äº 1 å’ŒÂ 100 ä¹‹é—´ã€‚æ¯ä¸ªç»“ç‚¹éƒ½æœ‰ä¸€ä¸ªä» 0 åˆ° 1000 èŒƒå›´å†…çš„å”¯ä¸€æ•´æ•°å€¼ã€‚\n\n**è§£æ³•ä¸€**\n\ngoä¸­åºéå†é…åˆå…¨å±€å˜é‡ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼ˆçœ‹è¯„è®ºåŒºå¾ˆå¤šäººç›´æ¥new TreeNodeæ„Ÿè§‰ä¸å¤ªå¥½å§ï¼Œé¢˜ç›®çš„æ„æ€ä¸æ˜¯åœ¨åŸæ ‘ä¸Šæ”¹ä¹ˆï¼Ÿï¼‰\n```golang\nfunc increasingBST(root *TreeNode) *TreeNode {\n    var dfs func(root *TreeNode)\n    dummyNode:=&TreeNode{}\n    last:=dummyNode\n    dfs = func(root *TreeNode){\n        if root==nil{\n            return\n        }\n        dfs(root.Left)\n        root.Left=nil\n        last.Right=root\n        last = root\n        dfs(root.Right)\n    }\n    dfs(root)\n    return dummyNode.Right\n}\n```\n> è¿™é¢˜å’Œ[é¢è¯•é¢˜ 17.12. BiNode](https://leetcode-cn.com/problems/binode-lcci/)è§£æ³•æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™ä¸ªsbé¢˜çš„æè¿°æˆ‘æ˜¯çœŸæ²¡çœ‹æ‡‚ï¼Œç»“åˆè¯„è®ºåŒºå’Œcaseæ‰çŸ¥é“åˆ°åº•è¦å¹²å•¥ï¼Œçœ‹è¯„è®ºåŒºå¥½åƒéƒ½æ•´çš„æŒºæ˜ç™½çš„ï¼Œä¸€åº¦ä»¥ä¸ºæˆ‘ç†è§£èƒ½åŠ›å‡ºäº†é—®é¢˜\n\n## [979. åœ¨äºŒå‰æ ‘ä¸­åˆ†é…ç¡¬å¸](https://leetcode-cn.com/problems/distribute-coins-in-binary-tree/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªæœ‰ `N` ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ `root`ï¼Œæ ‘ä¸­çš„æ¯ä¸ªç»“ç‚¹ä¸Šéƒ½å¯¹åº”æœ‰ `node.val` æšç¡¬å¸ï¼Œå¹¶ä¸”æ€»å…±æœ‰ `N` æšç¡¬å¸ã€‚\n\nåœ¨ä¸€æ¬¡ç§»åŠ¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸¤ä¸ªç›¸é‚»çš„ç»“ç‚¹ï¼Œç„¶åå°†ä¸€æšç¡¬å¸ä»å…¶ä¸­ä¸€ä¸ªç»“ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç»“ç‚¹ã€‚(ç§»åŠ¨å¯ä»¥æ˜¯ä»çˆ¶ç»“ç‚¹åˆ°å­ç»“ç‚¹ï¼Œæˆ–è€…ä»å­ç»“ç‚¹ç§»åŠ¨åˆ°çˆ¶ç»“ç‚¹ã€‚)ã€‚\n\nè¿”å›ä½¿æ¯ä¸ªç»“ç‚¹ä¸Šåªæœ‰ä¸€æšç¡¬å¸æ‰€éœ€çš„ç§»åŠ¨æ¬¡æ•°ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n![UTOOLS1594052444483.png](https://upload.cc/i1/2020/07/07/w2G7JY.png)\n\n```go\nè¾“å…¥ï¼š[3,0,0]\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šä»æ ‘çš„æ ¹ç»“ç‚¹å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä¸€æšç¡¬å¸ç§»åˆ°å®ƒçš„å·¦å­ç»“ç‚¹ä¸Šï¼Œä¸€æšç¡¬å¸ç§»åˆ°å®ƒçš„å³å­ç»“ç‚¹ä¸Šã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![UTOOLS1594052495418.png](https://upload.cc/i1/2020/07/07/kPOvxa.png)\n\n```go\nè¾“å…¥ï¼š[0,3,0]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šä»æ ¹ç»“ç‚¹çš„å·¦å­ç»“ç‚¹å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä¸¤æšç¡¬å¸ç§»åˆ°æ ¹ç»“ç‚¹ä¸Š [ç§»åŠ¨ä¸¤æ¬¡]ã€‚ç„¶åï¼Œæˆ‘ä»¬æŠŠä¸€æšç¡¬å¸ä»æ ¹ç»“ç‚¹ç§»åˆ°å³å­ç»“ç‚¹ä¸Šã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n![UTOOLS1594052508155.png](https://upload.cc/i1/2020/07/07/j4YpZS.png)\n\n```go\nè¾“å…¥ï¼š[1,0,2]\nè¾“å‡ºï¼š2\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n![UTOOLS1594052519453.png](https://upload.cc/i1/2020/07/07/DYZ6cE.png)\n\n```go\nè¾“å…¥ï¼š[1,0,0,null,3]\nè¾“å‡ºï¼š4\n```\n\n**æç¤ºï¼š**\n\n1.  `1<= N <= 100`\n2.  `0 <= node.val <= N`\n\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹ç›´æ¥æƒ³å‡ºæ¥çš„åšæ³•ï¼Œåé¢çœ‹äº†å…¶ä»–äººçš„è§£æ³•å‘ç°è¿˜ä¸å¤ªä¸€æ ·ğŸ˜‚ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æ„Ÿè§‰æˆ‘çš„æ–¹æ³•æ›´å¥½ç†è§£\n```golang\n//é—­åŒ…çš„å†™æ³•\nfunc distributeCoins(root *TreeNode) int {\n    var res = 0\n    var Abs = func(a int) int {\n        if a < 0 {\n            return -a\n        }\n        return a\n    }\n    //dfsè¿”å›æ ‘çš„èŠ‚ç‚¹æ•°é‡ å’Œ é‡‘å¸æ•°é‡\n    var dfs func(*TreeNode) (int, int)\n    dfs = func(root *TreeNode) (int, int) {\n        if root == nil {\n            return 0, 0\n        }\n        lCount, lCoins := dfs(root.Left)\n        //å…¶å®ä¸¤è€…çš„å·®å€¼å°±æ˜¯éœ€è¦ç»è¿‡è¯¥èŠ‚ç‚¹ä¸­è½¬çš„æ¬¡æ•°\n        //ç»Ÿè®¡å‡ºæ‰€æœ‰èŠ‚ç‚¹çš„ä¸­è½¬æ¬¡æ•°å°±æ˜¯æ•´ä½“çš„è½¬ç§»æ¬¡æ•°\n        res += Abs(lCount - lCoins)\n        rCount, rCoins := dfs(root.Right)\n        res += Abs(rCount - rCoins)\n        return 1 + lCount + rCount, root.Val + lCoins + rCoins\n    }\n    dfs(root)\n    return res\n}\n```\n\n**è§£æ³•äºŒ**\n\nå…¶ä»–äººçš„åšæ³•ï¼Œdfsè¿”å›èŠ‚ç‚¹çš„ç›ˆäºå€¼ï¼ˆèŠ‚ç‚¹æ•°å’Œé‡‘å¸æ•°çš„å·®å€¼ï¼‰ï¼Œç›ˆäºå€¼ç»å¯¹å€¼ä¹‹å’Œå°±æ˜¯æ€»ä½“çš„è½¬ç§»æ¬¡æ•°ï¼ˆæ‰€ä»¥ä¸¤ç§è§£æ³•å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è®¡ç®—çš„æ—¶é—´ä¸ä¸€æ ·ï¼Œæˆ‘çš„æ˜¯å‡½æ•°è¿”å›åè®¡ç®—ç›ˆäºï¼Œè€Œä¸‹é¢çš„è§£æ³•æ˜¯è¿”å›å‰è®¡ç®—ç›ˆäºï¼Œæ„Ÿè§‰æˆ‘çš„æ›´å¥½ç†è§£ğŸ˜‚ï¼‰\n```golang\n//å¦ä¸€ç§åšæ³•\nfunc distributeCoins(root *TreeNode) int {\n    var res = 0\n    var Abs = func(a int) int {\n        if a < 0 {\n            return -a\n        }\n        return a\n    }\n    var dfs func(*TreeNode) int\n    dfs = func(root *TreeNode) int {\n        if root == nil {\n            return 0\n        }\n        left := dfs(root.Left)\n        right := dfs(root.Right)\n        res += Abs(left) + Abs(right)\n        return root.Val + left + right - 1\n    }\n    dfs(root)\n    return res\n}\n```\n\n## [99. æ¢å¤äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/recover-binary-search-tree/)\n\nDifficulty: **å›°éš¾**\n\n\näºŒå‰æœç´¢æ ‘ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹è¢«é”™è¯¯åœ°äº¤æ¢ã€‚\n\nè¯·åœ¨ä¸æ”¹å˜å…¶ç»“æ„çš„æƒ…å†µä¸‹ï¼Œæ¢å¤è¿™æ£µæ ‘ã€‚\n\n**ç¤ºä¾‹Â 1:**\n\n```go\nè¾“å…¥: [1,3,null,null,2]\n\nÂ   1\nÂ  /\nÂ 3\nÂ  \\\nÂ   2\n\nè¾“å‡º: [3,1,null,null,2]\n\nÂ   3\nÂ  /\nÂ 1\nÂ  \\\nÂ   2\n```\n\n**ç¤ºä¾‹Â 2:**\n\n```go\nè¾“å…¥: [3,1,4,null,null,2]\n\n  3\n / \\\n1   4\nÂ   /\nÂ  2\n\nè¾“å‡º: [2,1,4,null,null,3]\n\n  2\n / \\\n1   4\nÂ   /\n Â 3\n```\n\n**è¿›é˜¶:**\n\n*   ä½¿ç”¨ O(_n_) ç©ºé—´å¤æ‚åº¦çš„è§£æ³•å¾ˆå®¹æ˜“å®ç°ã€‚\n*   ä½ èƒ½æƒ³å‡ºä¸€ä¸ªåªä½¿ç”¨å¸¸æ•°ç©ºé—´çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ\n\n\n**è§£æ³•ä¸€**\n\nä¸­åºéå†ï¼Œè®°å½•ä¸‹ä½ç½®ä¸å¯¹çš„èŠ‚ç‚¹ï¼Œæœ€åäº¤æ¢ä»–ä»¬çš„å€¼å°±è¡Œäº†\n```golang\nfunc recoverTree(root *TreeNode) {\n    var node1 *TreeNode\n    var node2 *TreeNode\n    //è¿™é‡ŒçŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œä¸€å¼€å§‹ç»™preèµ‹å€¼äº†ä¸€ä¸ªroot,å¯¼è‡´èŠ‚ç‚¹è®°å½•é”™äº†\n    var pre *TreeNode\n    var dfs func(*TreeNode)\n    dfs = func(root *TreeNode) {\n        if root == nil {\n            return\n        }\n        dfs(root.Left)\n        if pre != nil && root.Val < pre.Val {\n            if node1 == nil {\n                node1 = pre\n            }\n            node2 = root\n        }\n        pre = root\n        dfs(root.Right)\n    }\n    dfs(root)\n    node1.Val, node2.Val = node2.Val, node1.Val\n}\n```\nè¿™ç§è§£æ³•ä¸¥æ ¼æ¥è¯´ç©ºé—´å¤æ‚åº¦å¹¶ä¸æ˜¯O(1)ï¼Œé€’å½’ä¼šæœ‰ç³»ç»Ÿæ ˆçš„å¼€é”€ï¼Œç©ºé—´å¤æ‚åº¦åº”è¯¥æ˜¯O(h)ï¼Œhæ˜¯æ ‘çš„é«˜åº¦ï¼ŒçœŸæ­£çš„O(1)çš„åšæ³•åº”è¯¥æ˜¯Morriséå†ï¼Œè¿™ç§è§£æ³•å°±ç§°å¾—ä¸Šhardäº†\n\n## [1302. å±‚æ•°æœ€æ·±å¶å­èŠ‚ç‚¹çš„å’Œ](https://leetcode-cn.com/problems/deepest-leaves-sum/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€æ£µäºŒå‰æ ‘ï¼Œè¯·ä½ è¿”å›å±‚æ•°æœ€æ·±çš„å¶å­èŠ‚ç‚¹çš„å’Œã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n![wmC0aT.png](https://s1.ax1x.com/2020/09/06/wmC0aT.png)\n\n```\nè¾“å…¥ï¼šroot = [1,2,3,4,5,null,6,7,null,null,null,null,8]\nè¾“å‡ºï¼š15\n```\n\n**æç¤ºï¼š**\n\n*   æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨Â `1`Â åˆ°Â `10^4`Â ä¹‹é—´ã€‚\n*   æ¯ä¸ªèŠ‚ç‚¹çš„å€¼åœ¨Â `1`Â åˆ°Â `100` ä¹‹é—´ã€‚\n\n\n**è§£æ³•ä¸€**\n\nBFSæ²¡å•¥å¥½è¯´çš„ï¼ŒDFSçš„æŒºæœ‰æ„æ€\n```golang\nfunc deepestLeavesSum(root *TreeNode) int {\n Â  Â var dfs func(*TreeNode, int)\n Â  Â var maxDep = 0\n Â  Â var sum = 0\n Â  Â dfs = func(root *TreeNode, dep int) {\n Â  Â  Â  Â if root == nil {\n Â  Â  Â  Â  Â  Â return\n Â  Â  Â   }\n Â  Â  Â  Â if maxDep == dep {\n Â  Â  Â  Â  Â  Â sum += root.Val\n Â  Â  Â   }\n Â  Â  Â  Â if dep > maxDep {\n Â  Â  Â  Â  Â  Â sum = root.Val\n Â  Â  Â  Â  Â  Â maxDep = dep\n Â  Â  Â   }\n Â  Â  Â  Â dfs(root.Left, dep+1)\n Â  Â  Â  Â dfs(root.Right, dep+1)\n Â  Â  Â  Â \n Â   }\n Â  Â dfs(root, 0)\n Â  Â return sum\n}\n```\n\n## _æ ‘å½¢DP(å¤§æ¦‚)_\n\n> 2020.5.10æ›´æ–°ï¼Œåœ¨çœ‹äº†å·¦ç¥çš„ä¹¦åï¼Œå¤§æ¦‚äº†è§£äº†æ ‘å½¢DPï¼Œæ‰€è°“çš„æ ‘å½¢DPå®é™…ä¸Šå°±æ˜¯æŠŠé€’æ¨æ–¹ç¨‹æ¬åˆ°äº†æ ‘ç»“æ„ä¸Šï¼ŒæŒ‰æˆ‘çš„ç†è§£æ ‘å½¢DPå¾ˆå¤§çš„ç‰¹ç‚¹å°±æ˜¯æœ€ç»ˆçš„è§£å¯èƒ½å­˜åœ¨äºæ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹ï¼Œåƒæˆ‘ä¸‹é¢çš„é¢˜æœ‰çš„æš´åŠ›è§£ç”¨çš„å°±æ˜¯åŒé‡é€’å½’ï¼Œå°±æ˜¯dfséå†æ²¡ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†å¯¹æ¯ä¸ªèŠ‚ç‚¹é€’å½’æ±‚è§£ï¼Œä½†æ˜¯å¯¹æ ¹èŠ‚ç‚¹æ±‚è§£çš„æ—¶å€™ï¼Œå®é™…ä¸Šå…¶ä»–çš„å­èŠ‚ç‚¹éƒ½æˆäº†å­é—®é¢˜ï¼Œæ‰€ä»¥åé¢å†å¯¹å­èŠ‚ç‚¹æ±‚è§£çš„æ—¶å€™é—®é¢˜å°±é‡å¤äº†ï¼Œæ‰€ä»¥å°±å¯ä»¥é‡‡ç”¨ååºéå†ï¼Œè‡ªåº•å‘ä¸Šï¼Œå…ˆæ±‚å·¦å³èŠ‚ç‚¹çš„å€¼å†æ›´æ–°æ ¹èŠ‚ç‚¹ï¼Œ**ä¸‹é¢çš„é¢˜å…¶å®æˆ‘ä¸çŸ¥é“åˆ°åº•æ˜¯ä¸æ˜¯å±äºæ ‘å½¢DPï¼Œå¯èƒ½å¤ªç®€å•äº†ï¼Œä½†æ˜¯å†æˆ‘çœ‹æ¥è§£æ³•æ¯”è¾ƒç»Ÿä¸€ï¼Œå¾ˆæœ‰å¥—è·¯æ‰€ä»¥æ•´ç†åˆ°ä¸€èµ·**ï¼Œæˆ‘æŸ¥äº†ä¸‹ç½‘ä¸Šä»‹ç»çš„æ ‘å½¢DPè¿˜æ˜¯æŒºéš¾çš„ï¼Œåé¢æœ‰æ—¶é—´äº†è§£åå†æ¥è®°å½•\n\n## [110. å¹³è¡¡äºŒå‰æ ‘](https://leetcode-cn.com/problems/balanced-binary-tree/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚\n\næœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼š\n\n>  ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1\n\n**ç¤ºä¾‹ 1:**\n\nç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]\n\n```java\n    3\n   / \\\n  9  20\n    /  \\\n   15   7\n```\n\nè¿”å› true ã€‚\n\n**ç¤ºä¾‹ 2:**\n\nç»™å®šäºŒå‰æ ‘ [1,2,2,3,3,null,null,4,4]\n\n```java\n       1\n      / \\\n     2   2\n    / \\\n   3   3\n  / \\\n 4   4\n```\n\n\nè¿”å› false ã€‚\n\n**è§£æ³•ä¸€**\n\næš´åŠ›æ³•ï¼Œç»“åˆä¸Šé¢çš„[äºŒå‰æ ‘æœ€å¤§æ·±åº¦](#104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦)ï¼Œ**è‡ªé¡¶å‘ä¸‹**ï¼Œæ±‚å·¦å³å­æ ‘çš„é«˜åº¦å·®\n\n```java\n//top 2 bottom\npublic boolean isBalanced(TreeNode root) {\n    if (root==null) return true;\n    if (Math.abs(hight(root.left)-hight(root.right))>1) {\n        return false;\n    }\n    return isBalanced(root.left) && isBalanced(root.right);\n}\n\npublic int hight(TreeNode root){\n    if (root==null) {\n        return 0;\n    }\n    return Math.max(hight(root.right),hight(root.left))+1;\n}\n```\nè‡ªé¡¶å‘ä¸‹ï¼Œå…ˆåˆ¤æ–­æ ¹èŠ‚ç‚¹ï¼Œç„¶ååˆ¤æ–­å·¦å³å­æ ‘ï¼Œå¾ˆæ˜æ˜¾ã€‚åœ¨åˆ¤æ–­å·¦å³å­æ ‘çš„æ—¶å€™ï¼Œä¼šé‡å¤çš„éå†åˆ¤æ–­æ ¹èŠ‚ç‚¹çš„æ—¶å€™å·²ç»éå†è¿‡çš„èŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯`O(N^2)`\n\n**è§£æ³•äºŒ**\n\nè‡ªåº•å‘ä¸Šï¼Œåˆ©ç”¨ä¸€ä¸ªå®ä¾‹å˜é‡ä¿å­˜ç»“æœï¼Œå…¶å®å°±æ˜¯åœ¨ä¸Šé¢çš„æ±‚heighè¿‡ç¨‹ä¸­å°†å·¦å³å­æ ‘çš„é«˜åº¦å…ˆå–å‡ºæ¥ç›´æ¥æ¯”è¾ƒï¼Œå¦‚æœå·®è·å¤§äº1å°±ç›´æ¥è®°å½•ä¸‹ç»“æœfalseï¼Œä½†æ˜¯å…¶å®è¿™é‡Œè¿˜æ˜¯å¯ä»¥ä¼˜åŒ–ä¸‹\n\n```java\nprivate boolean ans=true;\n\n//buttom 2 top\npublic boolean isBalanced(TreeNode root) {\n    if (root==null) return true;\n    hight(root);\n    return ans;\n}\n\npublic int hight(TreeNode root){\n    if (root==null) {\n        return 0;\n    }\n    //é€’å½’åˆ†æ²»ï¼Œè‡ªåº•å‘ä¸Šï¼Œåœ¨æ±‚é«˜åº¦çš„è¿‡ç¨‹ä¸­è®¡ç®—å·¦å³é«˜åº¦å·®\n    int left=hight(root.left);\n    int right=hight(root.right);\n    if (Math.abs(left-right)>1) {\n        ans=false;\n    }\n    return Math.max(left,right)+1;\n}\n```\nè‡ªåº•å‘ä¸Šï¼Œåªéœ€è¦éå†ä¸€éäºŒå‰æ ‘å°±å¯ä»¥å¾—åˆ°ç»“æœï¼Œæ—¶é—´å¤æ‚åº¦`O(N)` \n\n**è§£æ³•ä¸‰**\n\n```java\npublic boolean isBalanced(TreeNode root) {\n    if (root==null) return true;\n    return hight(root)!=-1;\n}\n\npublic int hight(TreeNode root){\n    if (root==null) {\n        return 0;\n    }\n    int left=hight(root.left);\n    if (left==-1) {\n        return -1;\n    }\n    int right=hight(root.right);\n    if (right==-1) {\n        return -1;\n    }\n    return Math.abs(left-right)>1?-1:Math.max(left,right)+1;\n}\n```\n\nåœ¨ä¸ç¬¦åˆçš„æ—¶å€™ä¸€è·¯`return -1` èŠ‚çœåé¢çš„è®¡ç®—\n\n## [563. äºŒå‰æ ‘çš„å¡åº¦](https://leetcode-cn.com/problems/binary-tree-tilt/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè®¡ç®—æ•´ä¸ªæ ‘çš„å¡åº¦ã€‚\n\nä¸€ä¸ªæ ‘çš„èŠ‚ç‚¹çš„å¡åº¦å®šä¹‰å³ä¸ºï¼Œè¯¥èŠ‚ç‚¹å·¦å­æ ‘çš„ç»“ç‚¹ä¹‹å’Œå’Œå³å­æ ‘ç»“ç‚¹ä¹‹å’Œçš„å·®çš„ç»å¯¹å€¼ã€‚ç©ºç»“ç‚¹çš„çš„å¡åº¦æ˜¯0ã€‚\n\næ•´ä¸ªæ ‘çš„å¡åº¦å°±æ˜¯å…¶æ‰€æœ‰èŠ‚ç‚¹çš„å¡åº¦ä¹‹å’Œã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: \n         1\n       /   \\\n      2     3\nè¾“å‡º: 1\nè§£é‡Š: \nç»“ç‚¹çš„å¡åº¦ 2 : 0\nç»“ç‚¹çš„å¡åº¦ 3 : 0\nç»“ç‚¹çš„å¡åº¦ 1 : |2-3| = 1\næ ‘çš„å¡åº¦ : 0 + 0 + 1 = 1\n```\n\n**æ³¨æ„:**\n\n1. ä»»ä½•å­æ ‘çš„ç»“ç‚¹çš„å’Œä¸ä¼šè¶…è¿‡32ä½æ•´æ•°çš„èŒƒå›´ã€‚\n2. å¡åº¦çš„å€¼ä¸ä¼šè¶…è¿‡32ä½æ•´æ•°çš„èŒƒå›´ã€‚. \n\n**è§£æ³•ä¸€**\n\nå¾ˆå¿«å†™å‡ºæ¥çš„è§£æ³•ï¼Œå‘ç°è¿™é¢˜å’Œä¸Šé¢çš„ **å¹³è¡¡äºŒå‰æ ‘** æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼\n\n```java\n//é¦–å…ˆæƒ³åˆ°çš„è§£æ³•\npublic int findTilt(TreeNode root) {\n    if (root==null) {\n        return 0;\n    }\n    return findTilt(root.left)+findTilt(root.right)+Math.abs(childSum(root.left)-childSum(root.right));\n}\n\npublic int childSum(TreeNode root) {\n    if (root==null) {\n        return 0;\n    }\n    return childSum(root.left)+childSum(root.right)+root.val;\n}\n```\nåµŒå¥—é€’å½’ï¼Œç›¸å½“æš´åŠ›\n\n**è§£æ³•äºŒ**\n\nä¸Šé¢çš„åšæ³•ç¡®å®æœ‰ç‚¹å¯æƒœï¼Œå…¶å®åœ¨è®¡ç®—childSumçš„æ—¶å€™å°±å¯ä»¥å­—èŠ‚æŠŠå¡åº¦ç®—å‡ºæ¥ç„¶åç´¯åŠ å°±æ˜¯æ•´ä½“çš„å¡åº¦\n\n```java\nint tilt=0;\n\n//ç»“æœå‘ç°ä¸Šé¢çš„åšæ³•å‚»é€¼äº†ã€‚ã€‚ã€‚å…¶å®æˆ‘çŸ¥é“æ˜¯ä¸å¯¹çš„,ä½†æ˜¯ä¸çŸ¥é“å’‹æ”¹,ä¸è¿‡å†™äº†ä¸ªåµŒå¥—é€’å½’ä¹Ÿè¿˜è¡Œhahaha\npublic int findTilt(TreeNode root) {\n    childSum(root);\n    return tilt;\n}\n\npublic int childSum(TreeNode root) {\n    if (root==null) {\n        return 0;\n    }\n    int left=childSum(root.left);\n    int right=childSum(root.right);\n    tilt+=Math.abs(left-right);\n    return left+right+root.val;\n}\n```\n\n## [543. äºŒå‰æ ‘çš„ç›´å¾„](https://leetcode-cn.com/problems/diameter-of-binary-tree/)\n\nç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œä½ éœ€è¦è®¡ç®—å®ƒçš„ç›´å¾„é•¿åº¦ã€‚ä¸€æ£µäºŒå‰æ ‘çš„ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹è·¯å¾„é•¿åº¦ä¸­çš„æœ€å¤§å€¼ã€‚è¿™æ¡è·¯å¾„å¯èƒ½ç©¿è¿‡æ ¹ç»“ç‚¹ã€‚\n\n**ç¤ºä¾‹ :**\nç»™å®šäºŒå‰æ ‘\n\n```java\n      1\n     / \\\n    2   3\n   / \\     \n  4   5    \n```\nè¿”å› 3, å®ƒçš„é•¿åº¦æ˜¯è·¯å¾„ [4,2,1,3] æˆ–è€… [5,2,1,3]ã€‚\n\n**æ³¨æ„ï¼š**ä¸¤ç»“ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦æ˜¯ä»¥å®ƒä»¬ä¹‹é—´è¾¹çš„æ•°ç›®è¡¨ç¤º\n\n**è§£æ³•ä¸€**\n\næ ‘çš„é¢˜ç›®åšå¤šäº†ï¼Œå‘ç°å…¶å®ä¹Ÿå°±å‡ ç§é¢˜å‹ï¼Œéƒ½å¾ˆç†Ÿæ‚‰ï¼Œè¿™é¢˜å°±å’Œä¸Šé¢çš„ [äºŒå‰æ ‘çš„å¡åº¦]() ï¼Œ[å¹³è¡¡äºŒå‰æ ‘]() å¾ˆç±»ä¼¼ï¼Œè¿™é¢˜éœ€è¦æ³¨æ„**ç›´å¾„ä¸ä¸€å®šè¿‡æ ¹èŠ‚ç‚¹**\n\n```java\nint max=Integer.MIN_VALUE;\n\npublic int diameterOfBinaryTree(TreeNode root) {\n    if (root==null) {\n        return 0;\n    }\n    hight(root);\n    return max;\n}\n\npublic int hight(TreeNode node){\n    if (node==null) {\n        return 0;\n    }\n    int left=hight(node.left);\n    int right=hight(node.right);\n    max=Math.max(left+right,max);\n    return Math.max(left,right)+1;\n}\n```\n\n**è§£æ³•äºŒ**\n\nå’Œä¹‹å‰ä¸€æ ·ï¼Œå…ˆå†™äº†ä¸ªæš´åŠ›çš„åµŒå¥—é€’å½’ğŸ˜‚ï¼Œä»£ç ç¡®å®ç®€ä»‹ï¼Œéš¾é“è¿™å°±æ˜¯æš´åŠ›ç¾å­¦ä¹ˆï¼Œiäº†\n\n```java\npublic int diameterOfBinaryTree(TreeNode root) {\n    return root==null?0:Math.max(hight(root.left)+hight(root.right),Math.max(diameterOfBinaryTree(root.right),diameterOfBinaryTree(root.left)));\n}\n\npublic int hight(TreeNode node){\n    return node==null?0:Math.max(hight(node.left),hight(node.right))+1;\n}\n```\n\n## [124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ](https://leetcode-cn.com/problems/binary-tree-maximum-path-sum/)\n\nç»™å®šä¸€ä¸ª**éç©º**äºŒå‰æ ‘ï¼Œè¿”å›å…¶æœ€å¤§è·¯å¾„å’Œã€‚\n\næœ¬é¢˜ä¸­ï¼Œè·¯å¾„è¢«å®šä¹‰ä¸ºä¸€æ¡ä»æ ‘ä¸­ä»»æ„èŠ‚ç‚¹å‡ºå‘ï¼Œè¾¾åˆ°ä»»æ„èŠ‚ç‚¹çš„åºåˆ—ã€‚è¯¥è·¯å¾„è‡³å°‘åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸”ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3]\n   1\n  / \\\n 2   3\nè¾“å‡º: 6\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [-10,9,20,null,null,15,7]\n   -10\n   / \\\n  9  20\n    /  \\\n   15   7\n\nè¾“å‡º: 42\n```\n\n**é”™è¯¯è§£æ³•**\n\nå…ˆä¸Šä¸€ä¸ªé”™è¯¯ç­”æ¡ˆï¼Œè¿‡äº† `71/93` ä¸ªcaseï¼ˆlcçš„caseå¥½å°‘ï¼‰\n\n```java\npublic int maxPathSum(TreeNode root) {\n    if (root==null) {\n        return Integer.MIN_VALUE;\n    }\n    if (root.left==null && root.right==null) {\n        return root.val;\n    }\n    int res=helper(root);\n    return Math.max(res,Math.max(maxPathSum(root.left),maxPathSum(root.right)));\n}\n\n//ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„æœ€å¤§è·¯å¾„å’Œ\npublic int helper(TreeNode root){\n    if(root==null) return Integer.MIN_VALUE;;\n    if (root.left==null && root.right==null) {\n        return root.val;\n    }\n    int left=helper(root.left);\n    int right=helper(root.right);\n    return root.val+(left>0?left:0)+(right>0?right:0);\n}\n```\næˆ‘ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯æŒ‰ç…§æ ¹èŠ‚ç‚¹æ¥è®¨è®ºçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§å€¼å°±æ˜¯ å·¦å³å­æ ‘çš„æœ€å¤§è·¯å¾„å’Œï¼ˆå¤§äº0ï¼‰åŠ ä¸Šå½“å‰èŠ‚ç‚¹çš„å€¼ï¼Œæ”¹äº†åŠå¤©WAäº†å‡ å‘åå‘ç°æ˜¯æœ‰é—®é¢˜çš„\n\n```java\n     1 \n   /   \\\n  2     3\n / \\   / \\\n7   9  5  6\n```\n\næ¯”å¦‚è¿™æ ·çš„ï¼Œ2ä¸ºæ ¹çš„æœ€é•¿è·¯å¾„æ˜¯1ï¼Œ2ï¼Œ9ä½†æ˜¯è¿™ä¸ªåœ¨1ä¸ºæ ¹çš„èŠ‚ç‚¹ä¸­æ˜¯ä¸åˆæ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„åªæœ‰å•è¾¹çš„è·¯å¾„å’Œï¼Œå¦‚ä¸Šå›¾çš„æ ‘ï¼Œæˆ‘ä»¬éœ€è¦çš„å°±æ˜¯ `2->9` è¿™æ¡è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†æ·»åŠ ä¸€ä¸ªæ±‚æœ€é•¿è·¯å¾„çš„å‡½æ•°\n\n**è§£æ³•äºŒ**\n\nå¯ACï¼Œä½†æ˜¯æ•ˆç‡è¾ƒä½\n\n```java\npublic int maxPathSum(TreeNode root) {\n    if (root==null) {\n        return Integer.MIN_VALUE;\n    }\n    if (root.left==null && root.right==null) {\n        return root.val;\n    }\n    int res=helper(root);\n    return Math.max(res,Math.max(maxPathSum(root.left),maxPathSum(root.right)));\n}\n\n//ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„æœ€å¤§è·¯å¾„å’Œ(åŒè¾¹)\npublic int helper(TreeNode root){\n    if(root==null) return Integer.MIN_VALUE;\n    if (root.left==null && root.right==null) {\n        return root.val;\n    }\n    int left=dfs(root.left);\n    int right=dfs(root.right);\n    return root.val+(left>0?left:0)+(right>0?right:0);\n}\n\n//rootä¸ºèµ·å§‹èŠ‚ç‚¹çš„æœ€å¤§è·¯å¾„å’Œ(å•è¾¹)\n//è¿™é‡Œå¯ä»¥cacheä¸€ä¸‹\n//cache å‰ 219ms\n//cache å 30ms\n\nprivate  HashMap<String,Integer> cache=new HashMap<>();\n\npublic int dfs(TreeNode root){\n    if (root==null) {\n        return Integer.MIN_VALUE;\n    }\n    if (cache.containsKey(root.toString())) {\n        return cache.get(root.toString());\n    }\n    int left=dfs(root.left);\n    int right=dfs(root.right);\n    int max=Math.max(left,right);\n    cache.put(root.toString(),root.val+(max>0?max:0));\n    return root.val+(max>0?max:0);\n}\n```\n**è§£æ³•ä¸‰**\n\nè¿™ä¸ªè§£æ³•å…¶å®å°±æ˜¯å°†æˆ‘å‰é¢çš„ä»£ç é€»è¾‘ç®€åŒ–äº†ï¼Œæ ¸å¿ƒçš„æ€è·¯è¿˜æ˜¯ä¸€æ ·çš„\n\n```java\nprivate int res=Integer.MIN_VALUE;\n\npublic int maxPathSum(TreeNode root) {\n    helper(root);\n    return res;\n}\n\n//è¿”å›ä»¥å½“å‰èŠ‚ç‚¹ä¸º*èµ·ç‚¹*çš„æœ€å¤§è·¯å¾„å’Œ(å•è¾¹,å·¦å³å­æ ‘ä¸­é€‰æœ€å¤§çš„ä¸€ä¸ª)\npublic int helper(TreeNode root){\n    if(root==null) return 0;\n    int left=Math.max(helper(root.left),0);\n    int right=Math.max(helper(root.right),0);\n    res=Math.max(res,root.val+left+right); //åœ¨è¿™é‡Œè®°å½•æœ€å¤§å€¼\n    return root.val+Math.max(left,right); //è¿”å›çš„å®é™…ä¸Šæ˜¯æˆ‘ä¸Šé¢dfsçš„ç»“æœ\n}\n```\n\nåœ¨é€’å½’å‡½æ•°ä¸­ç”¨å…¨å±€å˜é‡è®°å½•æœ€å¤§å€¼ï¼Œæœ€åè¿”å›çš„å´æ˜¯**å•è¾¹**çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢å†™çš„dfså‡½æ•°è¿”å›çš„å€¼ï¼Œå¯ä»¥è¯´æ˜¯ç›¸å½“å·§å¦™äº†ï¼Œé™¤æ­¤å¤–å¯¹é€’å½’çš„å‡ºå£ä¹Ÿè¿›è¡Œäº†ç®€åŒ–\n\n**Update: 2020.6.21**\n\nç”¨goé‡å†™ä¸€ä¸‹ï¼Œæœ€è¿‘å¾ˆå–œæ¬¢å†™è¿™ç§é—­åŒ…çš„ç»“æ„ï¼Œæ„Ÿè§‰æ¯”è¾ƒç®€æ´\n```golang\nfunc maxPathSum(root *TreeNode) int {\n    res:=-1<<31\n    var Max =func(a,b int) int {\n        if a>b{\n            return a   \n        }\n        return b\n    }\n    //ä»¥rootå¼€å¤´æœ€å¤§å•ä¾§è·¯å¾„\n    var dfs func(root *TreeNode) int\n    dfs = func(root *TreeNode) int {\n        if root==nil{\n            return -1<<31 //è¿”å›çš„å°äº0å°±è¡Œ\n        }\n        left:=Max(0,dfs(root.Left))\n        right:=Max(0,dfs(root.Right))\n        res=Max(res,left+right+root.Val)\n        return root.Val+Max(left,right)\n    }\n    dfs(root)\n    return res\n}\n```\n\n## [687. æœ€é•¿åŒå€¼è·¯å¾„](https://leetcode-cn.com/problems/longest-univalue-path/)\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾åˆ°æœ€é•¿çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å…·æœ‰ç›¸åŒå€¼ã€‚ è¿™æ¡è·¯å¾„å¯ä»¥ç»è¿‡ä¹Ÿå¯ä»¥ä¸ç»è¿‡æ ¹èŠ‚ç‚¹ã€‚\n\n**æ³¨æ„**ï¼šä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦ç”±å®ƒä»¬ä¹‹é—´çš„è¾¹æ•°è¡¨ç¤ºã€‚\n\n**ç¤ºä¾‹ 1:**\n\nè¾“å…¥:\n\n```java\n              5\n             / \\\n            4   5\n           / \\   \\\n          1   1   5\n```\n\nè¾“å‡º:\n\n```java\n2\n```\n\n**ç¤ºä¾‹ 2:**\n\nè¾“å…¥:\n\n```java\n              1\n             / \\\n            4   5\n           / \\   \\\n          4   4   5\n```\n\nè¾“å‡º:\n\n```java\n2\n```\n\n**æ³¨æ„:** ç»™å®šçš„äºŒå‰æ ‘ä¸è¶…è¿‡10000ä¸ªç»“ç‚¹ã€‚ æ ‘çš„é«˜åº¦ä¸è¶…è¿‡1000ã€‚\n\n**é”™è¯¯è§£æ³•**\n\nå…¶å®å†™äº†ä¸€ä¼šå„¿å°±æ„è¯†åˆ°å’Œä¸Šé¢çš„[124.äºŒå‰æ ‘çš„æœ€å¤§è·¯å¾„å’Œ](#124-äºŒå‰æ ‘çš„æœ€å¤§è·¯å¾„å’Œ)ï¼Œ[543.äºŒå‰æ ‘çš„ç›´å¾„](#543-äºŒå‰æ ‘çš„ç›´å¾„)æ˜¯ä¸€æ ·çš„æ€è·¯ï¼Œä½†æ˜¯è‡ªå·±è¿˜æ˜¯æ²¡å†™å¥½ï¼Œé€’å½’å‡½æ•°çš„å†™ç€å†™ç€å°±å†™å˜äº†ï¼Œè„±ç¦»äº†æœ€å¼€å§‹çš„å®šä¹‰\n\n```java\n//é”™è¯¯è§£æ³•ï¼Œå…¶å®æ•´ä½“æ€è·¯æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ç»†èŠ‚æ²¡å¤„ç†å¥½\npublic int longestUnivaluePath(TreeNode root) {\n    dfs(root);\n    return res;\n}\n\nint res=0;\n\npublic int dfs(TreeNode root){\n    if(root==null){\n        return 0;\n    }\n    int leftMax=dfs(root.left);\n    int rightMax=dfs(root.right);\n    int flag=0;\n    if(root.left!=null && root.left.val==root.val){\n        flag++;\n        leftMax++;\n    }\n    if(root.right!=null && root.right.val==root.val){\n        flag++;\n        rightMax++;\n    }\n    if(flag==2){\n        res=Math.max(res,leftMax+rightMax);\n    }\n    res=Math.max(res,Math.max(leftMax,rightMax));\n    return flag==0?0:Math.max(leftMax,rightMax);\n}\n```\n\n**è§£æ³•ä¸€**\n\nåœ¨çœ‹äº†é¢˜è§£åå¯¹ä¸Šé¢é”™è¯¯è§£æ³•çš„çº æ­£\n\n```java\npublic int longestUnivaluePath(TreeNode root) {\n    if(root==null) return 0;\n    dfs(root);\n    return res;\n}\n\nint res=0;\n\n//ä»¥rootå¼€å¤´çš„åŒå€¼è·¯å¾„é•¿åº¦\npublic int dfs(TreeNode root){\n    if(root==null){\n        return 0;\n    }\n    int leftMax=dfs(root.left);\n    int rightMax=dfs(root.right);\n    if(root.left!=null){\n        //ä¸ç›¸ç­‰å°±ç›´æ¥è®¾ç½®æˆ0\n        leftMax=root.left.val==root.val?leftMax+1:0;\n    }\n    if(root.right!=null){\n        rightMax=root.right.val==root.val?rightMax+1:0;\n    }\n    //å…¶å®3ç§æƒ…å†µéƒ½åŒ…å«äº†\n    res=Math.max(res,leftMax+rightMax);\n    return Math.max(leftMax,rightMax);\n}\n```\n\næ³¨æ„dfså‡½æ•°çš„å®šä¹‰ï¼š_**ä»¥rootå¼€å¤´çš„æœ€é•¿åŒå€¼è·¯å¾„**_\n\næ—¢ç„¶æ˜¯ä»¥rootå¼€å¤´ï¼Œæ‰€ä»¥ä»£è¡¨çš„å…¶å®æ˜¯**å•ä¾§**çš„æœ€é•¿è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè·¯å¾„ä¸èƒ½ç©¿è¿‡rootï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ†åˆ«æ±‚å·¦å³çš„å€¼ï¼Œç„¶åå–æœ€å¤§å€¼ï¼Œå†åˆ¤æ–­å’Œå·¦å³èŠ‚ç‚¹æ˜¯å¦ç›¸ç­‰\n\nå†ç„¶åæˆ‘ä»¬éœ€è¦åˆ¤æ–­rootå’Œå·¦å³èŠ‚ç‚¹å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå’Œå·¦å³èŠ‚ç‚¹ä¸æƒ³ç­‰ï¼Œé‚£ä¹ˆ`leftMax`å’Œ`rightMax`åº”è¯¥ç›´æ¥ç½®ä¸º0ï¼Œä¸åº”è¯¥å†ä»£å…¥åšè®¡ç®—ï¼Œä¸Šé¢çš„é”™è¯¯è§£æ³•å°±æ˜¯é”™åœ¨è¿™é‡Œï¼Œå¦‚æœç›¸ç­‰é‚£å°±åº”è¯¥+1ï¼Œç„¶åç»Ÿè®¡æœ€å¤§å€¼çš„æ—¶å€™ä¹Ÿå°±å¯ä»¥å¾ˆè½»æ¾çš„åŒ…å«æ‰€æœ‰çš„3ç§æƒ…å†µ\n\n> è¿™é‡Œä¸ºä»€ä¹ˆè¦å…ˆæ±‚æœ€å¤§å€¼ï¼Œå†åˆ¤æ–­ï¼Œå…ˆåˆ¤æ–­åœ¨æ±‚æœ€å¤§å€¼ä¸è¡Œä¹ˆï¼Ÿ\n>\n> å…¶å®æƒ³æƒ³å°±çŸ¥é“ä¸è¡Œï¼Œå…ˆåˆ¤æ–­å…¶å®ç›¸å½“äº`å‰åºéå†`ï¼Œåœ¨è®¿é—®èŠ‚ç‚¹ç¬¬ä¸€æ¬¡çš„æ—¶å€™å¦‚æœä¸ç¬¦åˆæ¡ä»¶å°±ç›´æ¥è¿”å›äº†ï¼Œè¿™æ ·æ ¹æœ¬æ— æ³•éå†å®Œæ‰€æœ‰çš„èŠ‚ç‚¹è‡ªç„¶æ˜¯ä¸è¡Œï¼Œæ‰€ä»¥è¿™ç§ç±»å‹çš„ä¸€èˆ¬éƒ½æ˜¯`ååºéå†`ï¼Œå¾…å­èŠ‚ç‚¹éƒ½å¤„ç†å®Œä¹‹åå†è¿”å›æ ¹èŠ‚ç‚¹åšå¤„ç†ï¼Œå’Œåˆ†æ²»çš„æ€æƒ³å¾ˆåƒ\n\n**Update: 2020.6.21**\n\ngoé‡å†™ä¸€éï¼Œæ¢äº†ä¸ªæ–¹å¼ï¼Œç»Ÿè®¡èŠ‚ç‚¹ä¸ªæ•°æœ€åå‡ä¸€\n```golang\nfunc longestUnivaluePath(root *TreeNode) int {\n    if root==nil{\n        return 0\n    }\n    var Max=func(a,b int)int{\n        if a>b{return a}\n        return b\n    }\n    var res=0\n    var dfs func(root *TreeNode)int\n    dfs = func (root *TreeNode)int{\n        if root==nil{\n            return 0\n        }\n        //rootå’Œå·¦å³å­èŠ‚ç‚¹èƒ½å½¢æˆçš„æœ€é•¿åŒå€¼è·¯å¾„(è‡³å°‘æ˜¯1)\n        left := 1+dfs(root.Left) \n        right := 1+dfs(root.Right)\n        if root.Left==nil || root.Val!=root.Left.Val{\n            left=1\n        }\n        if root.Right==nil || root.Val!=root.Right.Val{\n            right=1\n        }\n        res=Max(res,left+right-1)\n        return Max(left,right)\n    }\n    dfs(root)\n    return res-1\n}\n```\n**è§£æ³•äºŒ**\n\nå¦ä¸€ç§dfsçš„æ€è·¯ï¼Œä»£ç æ›´åŠ ç®€æ´ä¸€ç‚¹ï¼Œä½†æ˜¯ç¨å¾®æœ‰ä¸€ç‚¹ä¸å¥½æƒ³\n\n```java\npublic int longestUnivaluePath(TreeNode root) {\n    if(root==null) return 0;\n    //èµ·ç‚¹çš„å€¼æ— æ‰€è°“,rootèŠ‚ç‚¹æ²¡æœ‰çˆ¶èŠ‚ç‚¹ä¸ç”¨å‘ä¸Šå±‚å‡½æ•°è¿”å›å€¼\n    dfs(root,-1); \n    return res;\n}\n\nint res=0;\n\n//ä»¥ rootçˆ¶èŠ‚ç‚¹å’Œroot å¼€å§‹çš„åŒå€¼è·¯å¾„é•¿åº¦\npublic int dfs(TreeNode root,int parent){\n    if(root==null){\n        return 0;\n    }\n    int leftMax=dfs(root.left,root.val);\n    int rightMax=dfs(root.right,root.val);\n    //è¿™é‡Œresçš„è®¡ç®—å…¶å®3ç§æƒ…å†µéƒ½åŒ…å«äº†\n    res=Math.max(res,leftMax+rightMax);\n    if(root.val==parent){\n        //å’Œçˆ¶èŠ‚ç‚¹åŒå€¼,è¿”å›å·¦å³æœ€å¤§å€¼+1\n        return Math.max(leftMax,rightMax)+1;\n    }\n    //å’Œçˆ¶èŠ‚ç‚¹ä¸åŒå€¼ï¼Œç›´æ¥è¿”å›0\n    return 0;\n}\n```\n\næ³¨æ„dfså‡½æ•°çš„å®šä¹‰ï¼š_**ä»¥nodeçˆ¶èŠ‚ç‚¹å’Œnodeå¼€å§‹çš„åŒå€¼è·¯å¾„é•¿åº¦**_\n\nåœ¨å‡½æ•°ä¸­æ·»åŠ ä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å€¼ï¼Œç„¶ååœ¨éå†åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™åˆ¤æ–­å½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å…³ç³»å°±è¡Œäº†ï¼Œå¦‚æœå’Œçˆ¶èŠ‚ç‚¹ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›0ï¼Œç›¸ç­‰å°±è¿”å›å·¦å³æœ€å¤§å€¼+1ï¼ˆè¿™ä¸ª+1åŠ çš„æ˜¯å½“å‰èŠ‚ç‚¹ï¼‰ï¼Œç„¶ååŒæ ·é‡‡ç”¨ååºéå†ï¼Œè¿™ä¸ªæ€è·¯æ²¡æœ‰é‚£ä¹ˆè‡ªç„¶ï¼Œä¸è¿‡ä¹ŸæŒºä¸é”™çš„\n\n> è¿˜æœ‰ä¸€ç§æš´åŠ›è§£æ³•ï¼Œè¿™é‡Œå°±ä¸è´´äº†\n\n## [595. äºŒå‰æ ‘æœ€é•¿è¿ç»­åºåˆ—ï¼ˆLintCodeï¼‰](https://www.lintcode.com/problem/binary-tree-longest-consecutive-sequence/description?ordering=-updated_at) \n\n**æè¿°**\n\nç»™ä¸€æ£µäºŒå‰æ ‘ï¼Œæ‰¾åˆ°æœ€é•¿è¿ç»­è·¯å¾„çš„é•¿åº¦ã€‚\nè¿™æ¡è·¯å¾„æ˜¯æŒ‡ ä»»ä½•çš„èŠ‚ç‚¹åºåˆ—ä¸­çš„èµ·å§‹èŠ‚ç‚¹åˆ°æ ‘ä¸­çš„ä»»ä¸€èŠ‚ç‚¹éƒ½å¿…é¡»éµå¾ª çˆ¶-å­ è”ç³»ã€‚æœ€é•¿çš„è¿ç»­è·¯å¾„å¿…é¡»æ˜¯ä»çˆ¶äº²èŠ‚ç‚¹åˆ°å­©å­èŠ‚ç‚¹ï¼ˆ`ä¸èƒ½é€†åº`ï¼‰ã€‚\n\n**æ ·ä¾‹1:**\n\n```java\nè¾“å…¥:\n{1,#,3,2,4,#,#,#,5}\nè¾“å‡º:3\nè¯´æ˜:\nè¿™æ£µæ ‘å¦‚å›¾æ‰€ç¤º\n   1\n    \\\n     3\n    / \\\n   2   4\n        \\\n         5\næœ€é•¿è¿ç»­åºåˆ—æ˜¯3-4-5ï¼Œæ‰€ä»¥è¿”å›3.\n```\n\n**æ ·ä¾‹2:**\n\n```java\nè¾“å…¥:\n{2,#,3,2,#,1,#}\nè¾“å‡º:2\nè¯´æ˜:\nè¿™æ£µæ ‘å¦‚å›¾æ‰€ç¤ºï¼š\n   2\n    \\\n     3\n    / \n   2    \n  / \n 1\næœ€é•¿è¿ç»­åºåˆ—æ˜¯2-3ï¼Œè€Œä¸æ˜¯3-2-1ï¼Œæ‰€ä»¥è¿”å›2.\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šä¸€é¢˜æœ€é•¿åŒå€¼è·¯å¾„å‡ ä¹ä¸€æ‘¸ä¸€æ ·ï¼Œè¿™é¢˜leetCodeä¹Ÿæœ‰ï¼Œ[ä½†æ˜¯æ˜¯ä¼šå‘˜é¢˜](https://leetcode-cn.com/problems/binary-tree-longest-consecutive-sequence)ï¼Œå‰å‡ å¤©æ¯æ—¥ä¸€é¢˜å‡ºäº†è¿™ä¸ªï¼ˆåæ¥æ”¹äº†ï¼‰ï¼Œç„¶åæˆ‘åœ¨lintcodeæ‰¾åˆ°äº†ï¼Œåº”è¯¥æ˜¯åŒä¸€é¢˜ï¼Œéšæ‰‹åšä¸€ä¸‹\n\n```java\npublic int longestConsecutive(TreeNode root) {\n    // write your code here\n    dfs(root);\n    return max;\n}\n\nint max=0;\n\n//ä»¥rootå¼€å§‹çš„æœ€é•¿è¿ç»­åºåˆ—\npublic int dfs(TreeNode root){\n    if(root == null){\n        return 0;\n    }\n    //ä¿è¯è‡³å°‘æ˜¯1\n    int leftMax = Math.max(1,dfs(root.left));\n    int rightMax = Math.max(1,dfs(root.right));\n    if(root.left!=null){\n        leftMax = root.val==root.left.val-1 ? leftMax+1:1;\n    }\n    if(root.right!=null){\n        rightMax = root.val==root.right.val-1 ? rightMax+1:1;\n    }\n    max=Math.max(max,Math.max(leftMax,rightMax));\n    return Math.max(leftMax,rightMax);\n}\n```\n\nå…¶å®ä¸€å¼€å§‹å†™äº†ä¸€ä¸ªå¾ˆå¤æ‚çš„ï¼Œdfsçš„å®šä¹‰åˆå’Œçˆ¶èŠ‚ç‚¹è€¦åˆäº†ï¼Œæ„Ÿè§‰å’Œçˆ¶èŠ‚ç‚¹è€¦åˆä¹‹åå°±å¾ˆéš¾æï¼Œå¾ˆå®¹æ˜“ææ™•ï¼Œæ‰€ä»¥å°½é‡ä¸å’Œçˆ¶èŠ‚ç‚¹è€¦åˆï¼Œç›´æ¥ä»¥å½“å‰èŠ‚ç‚¹å®šä¹‰\n\n**Update: 2020.6.21**\n\n```golang\nfunc longestConsecutive (root *TreeNode) int {\n    var Max = func(a,b int)int{\n        if a>b{return a}\n        return b\n    }\n    var dfs func(root *TreeNode) int\n    var res=0\n    dfs = func(root *TreeNode)int{\n        if root ==nil {\n            return 0\n        }\n        left:= 1+dfs(root.Left)\n        right:= 1+dfs(root.Right)\n        if root.Left==nil ||root.Left.Val!=root.Val+1{\n            left=1\n        }\n        if root.Right==nil ||root.Right.Val!=root.Val+1{\n            right=1\n        }\n        res=Max(res,Max(left,right))\n        return Max(left,right)\n    }\n    dfs(root)\n    return res\n}\n```\n\n## [337. æ‰“å®¶åŠ«èˆ III](https://leetcode-cn.com/problems/house-robber-iii/)\n\nåœ¨ä¸Šæ¬¡æ‰“åŠ«å®Œä¸€æ¡è¡—é“ä¹‹åå’Œä¸€åœˆæˆ¿å±‹åï¼Œå°å·åˆå‘ç°äº†ä¸€ä¸ªæ–°çš„å¯è¡Œçªƒçš„åœ°åŒºã€‚è¿™ä¸ªåœ°åŒºåªæœ‰ä¸€ä¸ªå…¥å£ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæ ¹â€ã€‚ é™¤äº†â€œæ ¹â€ä¹‹å¤–ï¼Œæ¯æ ‹æˆ¿å­æœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œçˆ¶â€œæˆ¿å­ä¸ä¹‹ç›¸è¿ã€‚ä¸€ç•ªä¾¦å¯Ÿä¹‹åï¼Œèªæ˜çš„å°å·æ„è¯†åˆ°â€œè¿™ä¸ªåœ°æ–¹çš„æ‰€æœ‰æˆ¿å±‹çš„æ’åˆ—ç±»ä¼¼äºä¸€æ£µäºŒå‰æ ‘â€ã€‚ å¦‚æœä¸¤ä¸ªç›´æ¥ç›¸è¿çš„æˆ¿å­åœ¨åŒä¸€å¤©æ™šä¸Šè¢«æ‰“åŠ«ï¼Œæˆ¿å±‹å°†è‡ªåŠ¨æŠ¥è­¦ã€‚\n\nè®¡ç®—åœ¨ä¸è§¦åŠ¨è­¦æŠ¥çš„æƒ…å†µä¸‹ï¼Œå°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [3,2,3,null,3,null,1]\n \t 3\n\t/ \\\n   2   3\n    \\   \\ \n     3   1\n\nè¾“å‡º: 7 \nè§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ = 3 + 3 + 1 = 7.\n```\n\n**ç¤ºä¾‹ 2:**\n\n~~~java\nè¾“å…¥: [3,4,5,1,3,null,1]\n\n \t 3\n\t/ \\\n   4   5\n  / \\   \\ \n 1   3   1\n\nè¾“å‡º: 9\nè§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ = 4 + 5 = 9.\n~~~\n\n**è§£æ³•ä¸€**\n\næš´åŠ›é€’å½’ï¼Œåº”è¯¥è¿˜æ˜¯å†™å¾—å‡ºæ¥\n\n```java\n//ACäº†,ä½†æ˜¯æ•ˆç‡å¾ˆä½\n//å¯ä»¥ç”¨hashMapç¼“å­˜ä¸€ä¸‹æ¯ä¸ªèŠ‚ç‚¹robçš„å€¼,ä½†æ˜¯æ²¡å¿…è¦\npublic int rob(TreeNode root) {\n    return tryRob(root);\n}\n\npublic int tryRob(TreeNode root) {\n    if (root==null) {\n        return 0;\n    }\n    if (root.left==null && root.right==null) {\n        return root.val;\n    }\n    //å·å–å½“å‰èŠ‚ç‚¹\n    int res=root.val;\n    if (root.left!=null) {\n        res+=tryRob(root.left.left)+tryRob(root.left.right);\n    }\n    if (root.right!=null) {\n        res+=tryRob(root.right.left)+tryRob(root.right.right);\n    }\n    //ä¸å·å½“å‰èŠ‚ç‚¹\n    int res2=0;\n    res2=tryRob(root.left)+tryRob(root.right);\n    return Math.max(res,res2);\n}\n```\n**è§£æ³•äºŒ**\n\nçœ‹è¯„è®ºåŒºè¯´æ˜¯å•¥æ ‘å½¢dp ? çŸ¥è¯†ç›²åŒºäº†hahaha\n\n```java\npublic int rob(TreeNode root) {\n    int[] res=tryRob(root);\n    return Math.max(res[0],res[1]);\n}\n\n//æ ‘å½¢dp???\n//çœ‹çš„æ‡‚ï¼Œä½†æ˜¯è‚¯å®šå†™ä¸å‡ºæ¥ ã€‚ã€‚ã€‚ã€‚\npublic int[] tryRob(TreeNode root) {\n    int[] dp=new int[2];\n    if (root==null) {\n        return dp;\n    }\n\n    int[] left=tryRob(root.left);\n    int[] right=tryRob(root.right);\n    //ä¸åŒ…å«å½“å‰èŠ‚ç‚¹çš„æœ€å¤§å€¼\n    dp[0]=Math.max(left[0],left[1])+Math.max(right[0],right[1]);\n    //åŒ…å«å½“å‰èŠ‚ç‚¹çš„æœ€å¤§å€¼\n    dp[1]=left[0]+right[0]+root.val;\n    return dp;\n}\n```\n~~ä¸æ˜¯æˆ‘å¹ï¼Œå°±è¿™æ ·çš„é¢˜ç›®ï¼Œå†é‡è§å¤šå°‘æ¬¡æˆ‘éƒ½å†™ä¸å‡ºæ¥è¿™æ ·çš„è§£ï¼ˆç¬‘~~\n\n> 2020.5.10æ›´æ–°ï¼Œåœ¨çœ‹äº†å·¦ç¥çš„ä¹¦åï¼Œäº†è§£åˆ°è¿™ç§å…¶å®å°±æ˜¯æ ‘å½¢DPï¼Œæ‰€è°“çš„æ ‘å½¢DPå®é™…ä¸Šå°±æ˜¯æŠŠé€’æ¨æ–¹ç¨‹æ¬åˆ°äº†æ ‘ç»“æ„ä¸Šï¼ŒæŒ‰æˆ‘çš„ç†è§£æ ‘å½¢DPå¾ˆå¤§çš„ç‰¹ç‚¹å°±æ˜¯æœ€ç»ˆçš„è§£å¯èƒ½å­˜åœ¨äºæ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸ªå­é—®é¢˜ï¼Œå¯ä»¥ä»å­é—®é¢˜æ¨å‡ºçˆ¶é—®é¢˜\n\n## [1372. äºŒå‰æ ‘ä¸­çš„æœ€é•¿äº¤é”™è·¯å¾„](https://leetcode-cn.com/problems/longest-zigzag-path-in-a-binary-tree/)\n\nç»™ä½ ä¸€æ£µä»¥ `root` ä¸ºæ ¹çš„äºŒå‰æ ‘ï¼ŒäºŒå‰æ ‘ä¸­çš„äº¤é”™è·¯å¾„å®šä¹‰å¦‚ä¸‹ï¼š\n\n- é€‰æ‹©äºŒå‰æ ‘ä¸­ **ä»»æ„** èŠ‚ç‚¹å’Œä¸€ä¸ªæ–¹å‘ï¼ˆå·¦æˆ–è€…å³ï¼‰ã€‚\n- å¦‚æœå‰è¿›æ–¹å‘ä¸ºå³ï¼Œé‚£ä¹ˆç§»åŠ¨åˆ°å½“å‰èŠ‚ç‚¹çš„çš„å³å­èŠ‚ç‚¹ï¼Œå¦åˆ™ç§»åŠ¨åˆ°å®ƒçš„å·¦å­èŠ‚ç‚¹ã€‚\n- æ”¹å˜å‰è¿›æ–¹å‘ï¼šå·¦å˜å³æˆ–è€…å³å˜å·¦ã€‚\n- é‡å¤ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ï¼Œç›´åˆ°ä½ åœ¨æ ‘ä¸­æ— æ³•ç»§ç»­ç§»åŠ¨ã€‚\n\näº¤é”™è·¯å¾„çš„é•¿åº¦å®šä¹‰ä¸ºï¼š**è®¿é—®è¿‡çš„èŠ‚ç‚¹æ•°ç›® - 1**ï¼ˆå•ä¸ªèŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦ä¸º 0 ï¼‰ã€‚\n\nè¯·ä½ è¿”å›ç»™å®šæ ‘ä¸­æœ€é•¿ **äº¤é”™è·¯å¾„** çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![YX1tJO.png](https://s1.ax1x.com/2020/05/22/YX1tJO.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,null,1,1,1,null,null,1,1,null,1,null,null,null,1,null,1]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šè“è‰²èŠ‚ç‚¹ä¸ºæ ‘ä¸­æœ€é•¿äº¤é”™è·¯å¾„ï¼ˆå³ -> å·¦ -> å³ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![YX1NWD.png](https://s1.ax1x.com/2020/05/22/YX1NWD.png)\n\n```java\nè¾“å…¥ï¼šroot = [1,1,1,null,1,null,null,1,1,null,1]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šè“è‰²èŠ‚ç‚¹ä¸ºæ ‘ä¸­æœ€é•¿äº¤é”™è·¯å¾„ï¼ˆå·¦ -> å³ -> å·¦ -> å³ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šroot = [1]\nè¾“å‡ºï¼š0\n```\n\n**æç¤ºï¼š**\n\n- æ¯æ£µæ ‘æœ€å¤šæœ‰ `50000` ä¸ªèŠ‚ç‚¹ã€‚\n- æ¯ä¸ªèŠ‚ç‚¹çš„å€¼åœ¨ `[1, 100]` ä¹‹é—´ã€‚\n\n**è§£æ³•ä¸€**\n\næŸæ¬¡å‘¨èµ›çš„T3ï¼Œæ ‘å½¢DP\n\n```java\nint max=0;\n\npublic int longestZigZag(TreeNode root) {\n    dfs(root);\n    return max-1;\n}\n\n//å½“å‰èŠ‚ç‚¹å·¦å³äº¤é”™è·¯å¾„çš„é•¿åº¦\npublic int[] dfs(TreeNode root){\n    int[] res=new int[2];\n    if(root==null){\n        return res;\n    }\n    res[0]=dfs(root.left)[1]+1;\n    res[1]=dfs(root.right)[0]+1;\n    max=Math.max(max,Math.max(res[0],res[1]));\n    return res;\n}\n```\n**Update: 2020.6.21**\n\nç”¨goé‡å†™ï¼ˆå›é¡¾ï¼‰ä¸‹\n```golang\nfunc longestZigZag(root *TreeNode) int {\n    var Max = func(a,b int)int{\n        if a>b{return a}\n        return b\n    }\n    var dfs func(root *TreeNode)[]int\n    var res = 0\n    dfs = func(root *TreeNode)[]int{\n        if root==nil{\n            return []int{0,0}\n        }\n        //0ï¼šå‘å·¦èµ°æœ€é•¿äº¤é”™ 1ï¼šå‘å³æœ€é•¿äº¤é”™è·¯å¾„\n        left := dfs(root.Left)\n        right := dfs(root.Right)\n        res=Max(res,Max(left[1]+1,right[0]+1))\n        return []int{left[1]+1,right[0]+1}\n    }\n    dfs(root)\n    return res-1\n}\n```\n\n**è§£æ³•äºŒ**\n\nç›´æ¥æœç´¢çš„åšæ³•ï¼Œå…¶å®è¿™ç§åšæ³•æ²¡æœ‰ä¸Šé¢æ ‘å½¢dpå¥½ç†è§£ï¼Œdfså‡½æ•°çš„å®šä¹‰ä¼šå’Œçˆ¶èŠ‚ç‚¹æ··åˆ\n\n```java\nint res=0;\n\npublic int longestZigZag(TreeNode root) {\n    dfs(root,false);//true falseéƒ½æ— æ‰€è°“ï¼Œrootæ²¡æœ‰çˆ¶èŠ‚ç‚¹\n    return res-1;\n}\n\n//å½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹å½¢æˆçš„äº¤é”™è·¯å¾„é•¿åº¦ï¼ŒisRightä»£è¡¨çˆ¶èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„èµ°å‘æ˜¯ä¸æ˜¯right\npublic int dfs(TreeNode root,boolean isRight){\n    if(root==null){\n        return 0;\n    }\n    int l=dfs(root.left,false);\n    int r=dfs(root.right,true);\n    res=Math.max(res,Math.max(l+1,r+1));\n    if(isRight){\n        return l+1;\n    }\n    return r+1;\n}\n```\n\n## [968. ç›‘æ§äºŒå‰æ ‘](https://leetcode-cn.com/problems/binary-tree-cameras/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæˆ‘ä»¬åœ¨æ ‘çš„èŠ‚ç‚¹ä¸Šå®‰è£…æ‘„åƒå¤´ã€‚\n\nèŠ‚ç‚¹ä¸Šçš„æ¯ä¸ªæ‘„å½±å¤´éƒ½å¯ä»¥ç›‘è§†**å…¶çˆ¶å¯¹è±¡ã€è‡ªèº«åŠå…¶ç›´æ¥å­å¯¹è±¡ã€‚**\n\nè®¡ç®—ç›‘æ§æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ‘„åƒå¤´æ•°é‡ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![wjBgQ1.png](https://s1.ax1x.com/2020/09/23/wjBgQ1.png)\n\n```golang\nè¾“å…¥ï¼š[0,0,null,0,0]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šå¦‚å›¾æ‰€ç¤ºï¼Œä¸€å°æ‘„åƒå¤´è¶³ä»¥ç›‘æ§æ‰€æœ‰èŠ‚ç‚¹ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![wjBfeK.png](https://s1.ax1x.com/2020/09/23/wjBfeK.png)\n\n```golang\nè¾“å…¥ï¼š[0,0,null,0,null,0,null,null,0]\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šéœ€è¦è‡³å°‘ä¸¤ä¸ªæ‘„åƒå¤´æ¥ç›‘è§†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚ ä¸Šå›¾æ˜¾ç¤ºäº†æ‘„åƒå¤´æ”¾ç½®çš„æœ‰æ•ˆä½ç½®ä¹‹ä¸€ã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  ç»™å®šæ ‘çš„èŠ‚ç‚¹æ•°çš„èŒƒå›´æ˜¯Â `[1, 1000]`ã€‚\n2.  æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½æ˜¯ 0ã€‚\n\n\n**è§£æ³•ä¸€**\n\næ ‘å½¢DP\n```golang\n/**\n * Definition for a binary tree node.\n * type TreeNode struct {\n * Â  Â  Val int\n * Â  Â  Left *TreeNode\n * Â  Â  Right *TreeNode\n * }\n */\n//0: è¦†ç›–æ•´æ£µæ ‘ï¼Œrootå¿…é¡»è®¾ç½®ç›‘æ§\n//1: è¦†ç›–æ•´æ£µæ ‘ï¼Œæ— è®ºrootæ˜¯å¦è®¾ç½®ç›‘æ§\n//2: è¦†ç›–ä¸¤é¢—å­æ ‘ï¼Œæ— è®ºrootæ˜¯å¦è¢«è¦†ç›–\nfunc minCameraCover(root *TreeNode) int {\n Â  Â var Min = func(a, b int) int {if a < b {return a}; return b}\n Â  Â var INF = 0x3f3f3f3f\n Â  Â var dfs func(root *TreeNode) [3]int \n Â  Â dfs = func (root *TreeNode) [3]int {\n Â  Â  Â  Â var res [3]int\n Â  Â  Â  Â if root == nil {\n Â  Â  Â  Â  Â  Â return [3]int{INF, 0, 0}\n Â  Â  Â   }\n Â  Â  Â  Â left := dfs(root.Left)\n Â  Â  Â  Â right := dfs(root.Right)\n Â  Â  Â  Â res[0] = left[2] + right[2] + 1\n Â  Â  Â  Â res[1] = Min(res[0], Min(left[0]+right[1], left[1]+right[0]))\n Â  Â  Â  Â res[2] = Min(res[0], left[1] + right[1])\n Â  Â  Â  Â return res\n Â   }\n Â  Â r := dfs(root)\n Â  Â return r[1]\n}\n```\n\n## _æ ‘çŠ¶æ•°ç»„ï¼ˆBITï¼‰_\n\næš‚æ—¶å…ˆæ”¾åœ¨è¿™é‡Œï¼Œç­‰ä»¥åç´¯è®¡å¤šäº†å†å•ç‹¬å¼€è¾Ÿä¸“é¢˜\n\n## [315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/)\n\nDifficulty: **å›°éš¾**\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ _nums_ï¼ŒæŒ‰è¦æ±‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„Â _counts_ã€‚æ•°ç»„ _counts_ æœ‰è¯¥æ€§è´¨ï¼š `counts[i]` çš„å€¼æ˜¯Â  `nums[i]` å³ä¾§å°äºÂ `nums[i]` çš„å…ƒç´ çš„æ•°é‡ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [5,2,6,1]\nè¾“å‡ºï¼š[2,1,1,0] \nè§£é‡Šï¼š\n5 çš„å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„å…ƒç´  (2 å’Œ 1)\n2 çš„å³ä¾§ä»…æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1)\n6 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1)\n1 çš„å³ä¾§æœ‰ 0 ä¸ªæ›´å°çš„å…ƒç´ \n```\n\n**æç¤ºï¼š**\n\n*   `0 <= nums.length <= 10^5`\n*   `-10^4Â <= nums[i] <= 10^4`\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜æœ‰[æ›´å¥½çš„åšæ³•](http://imlgw.top/2019/05/04/leetcode-shu-zu/#315-%E8%AE%A1%E7%AE%97%E5%8F%B3%E4%BE%A7%E5%B0%8F%E4%BA%8E%E5%BD%93%E5%89%8D%E5%85%83%E7%B4%A0%E7%9A%84%E4%B8%AA%E6%95%B0)ï¼Œç›´æ¥å½’å¹¶å°±è¡Œäº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†å­¦ä¹ BIT\n\næš´åŠ›çš„åšæ³•: å…¶å®å°±æ˜¯æ¡¶æ’åºçš„æ€æƒ³ï¼Œæˆ‘ä»¬ä»å³å‘å·¦æ‰«æ•°ç»„ï¼Œæ‰«æä¸€ä¸ªå°±åœ¨å¯¹åº”çš„æ¡¶+1ï¼ŒåŒæ—¶è®¡ç®—è¯¥ä½ç½®å·¦è¾¹çš„å‰ç¼€å’Œï¼Œå°±æ˜¯å³è¾¹æ¯”å½“å‰å…ƒç´ å°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ç»“æœï¼Œä½†æ˜¯é—®é¢˜æ˜¯è¿™ä¸ª`bit`æ•°ç»„æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œæ‰«æä¸€ä¸ªå…ƒç´ å°±ä¼šåœ¨bitæ•°ç»„å¯¹åº”çš„ä½ç½®ä¸Š+1ï¼Œæ¯æ¬¡å˜åŒ–åéƒ½éœ€è¦O(N)æ¥é‡æ–°è®¡ç®—åç¼€å’Œï¼Œè¿™æ ·æ•´ä½“çš„å¤æ‚åº¦å°±æ˜¯O(N^2)ï¼Œæ•°æ®é‡1e5ï¼Œè¿‡ä¸äº†OJ\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨çº¿æ®µæ ‘æ¥ç»´æŠ¤åŒºé—´å’Œï¼Œä½†æ˜¯çº¿æ®µæ ‘ä»£ç é‡æ¯”è¾ƒå¤§ï¼Œå¸¸æ•°ä¹Ÿæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥è¿™é‡Œå­¦ä¸€ä¸‹æ–°ç§‘æŠ€ï¼š**[æ ‘çŠ¶æ•°ç»„](https://blog.csdn.net/Yaokai_AssultMaster/article/details/79492190)**ï¼ŒåŒºé—´æŸ¥è¯¢ï¼Œå•ç‚¹ä¿®æ”¹æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯logNï¼Œä¸”ä»£ç ç®€å•ã€‚\n\nåŒæ—¶è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æŒ‰ç…§å€¼æ¥å®šä½æ˜¯ä¸åˆé€‚çš„ï¼Œæ•°æ®èŒƒå›´æ¯”è¾ƒå¤§ï¼Œç›´æ¥æŒ‰ç…§å…ƒç´ å€¼æ¥å®šä½ä¼šé€ æˆå¾ˆå¤§ç©ºé—´çš„æµªè´¹ï¼Œå¹¶ä¸”é¢˜ç›®ä¹Ÿä¸å…è®¸å¼€è¿™ä¹ˆå¤§çš„ç©ºé—´ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¦»æ•£åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬åªå…³ç³»å…ƒç´ ä¹‹é—´çš„å¤§å°å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬è½¬æ¢æˆæ¯ä¸ªå…ƒç´ è¯´å¯¹åº”çš„rankå°±è¡Œäº†\n\n```java\nint[] tree;\n\nint n = 0;\n\npublic int lowbit(int i) {\n    return i & -i;\n}\n\n//updateç´¢å¼•iä½ç½®\npublic void update(int i, int delta) {\n    while (i <= n) {\n        tree[i] += delta;\n        i += lowbit(i);\n    }\n}\n\npublic int query(int i) {\n    int sum = 0;\n    //ä»1å¼€å§‹\n    while (i > 0) {\n        sum += tree[i];\n        i -= lowbit(i);\n    }\n    return sum;\n}\n\n/*\næš´åŠ›çš„åšæ³•: å…¶å®å°±æ˜¯æ¡¶æ’åºçš„æ€æƒ³ï¼Œæˆ‘ä»¬ä»å³å‘å·¦æ‰«æ•°ç»„ï¼Œæ‰«æä¸€ä¸ªå°±åœ¨å¯¹åº”çš„æ¡¶+1ï¼Œ\nåŒæ—¶è®¡ç®—è¯¥ä½ç½®å·¦è¾¹çš„å‰ç¼€å’Œï¼Œå°±æ˜¯å³è¾¹æ¯”å½“å‰å…ƒç´ å°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ç»“æœï¼Œ\nä½†æ˜¯é—®é¢˜æ˜¯è¿™ä¸ª`bit`æ•°ç»„æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œæ‰«æä¸€ä¸ªå…ƒç´ å°±ä¼šåœ¨bitæ•°ç»„å¯¹åº”çš„ä½ç½®ä¸Š+1ï¼Œ\næ¯æ¬¡å˜åŒ–åéƒ½éœ€è¦O(N)æ¥é‡æ–°è®¡ç®—åç¼€å’Œï¼Œè¿™æ ·æ•´ä½“çš„å¤æ‚åº¦å°±æ˜¯O(N^2)ï¼Œæ•°æ®é‡1e5ï¼Œè¿‡ä¸äº†OJ\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨çº¿æ®µæ ‘æ¥ç»´æŠ¤åŒºé—´å’Œï¼Œä½†æ˜¯çº¿æ®µæ ‘ä»£ç é‡æ¯”è¾ƒå¤§ï¼Œå¸¸æ•°ä¹Ÿæ¯”è¾ƒå¤§\næ‰€ä»¥è¿™é‡Œå­¦ä¸€ä¸‹æ–°ç§‘æŠ€ï¼š**æ ‘çŠ¶æ•°ç»„**ï¼ŒåŒºé—´æŸ¥è¯¢ï¼Œå•ç‚¹ä¿®æ”¹æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯logNï¼Œä¸”ä»£ç ç®€å•ã€‚\nåŒæ—¶è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æŒ‰ç…§å€¼æ¥å®šä½æ˜¯ä¸åˆé€‚çš„ï¼Œæ•°æ®èŒƒå›´æ¯”è¾ƒå¤§ï¼Œ\nç›´æ¥æŒ‰ç…§å…ƒç´ å€¼æ¥å®šä½ä¼šé€ æˆå¾ˆå¤§ç©ºé—´çš„æµªè´¹ï¼Œå¹¶ä¸”é¢˜ç›®ä¹Ÿä¸å…è®¸å¼€è¿™ä¹ˆå¤§çš„ç©ºé—´\næ‰€ä»¥è¿˜éœ€è¦ç¦»æ•£åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬åªå…³ç³»å…ƒç´ ä¹‹é—´çš„å¤§å°å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬è½¬æ¢æˆæ¯ä¸ªå…ƒç´ è¯´å¯¹åº”çš„rankå°±è¡Œäº†\n*/\npublic List<Integer> countSmaller(int[] nums) {\n    n = nums.length;\n    tree = new int[n+1];\n    List<Integer> res = new LinkedList<>();\n    int[] rank = new int[n];\n    //temp[0]: index temp[1]: val\n    int[][] temp = new int[n][2];\n    for (int i = 0; i < n; i++) {\n        temp[i] = new int[]{i, nums[i]};\n    }\n    //ç¦»æ•£åŒ–\n    Arrays.sort(temp, (t1, t2) -> t1[1]-t2[1]);\n    for (int i = 0; i < n; i++) {\n        rank[temp[i][0]] = i+1;\n    }\n    for (int i = n-1; i >= 0; i--) {\n        //O(NlogN)æ„å»ºBIT(å¯ä»¥ä¼˜åŒ–æˆO(N))\n        update(rank[i], 1);\n        res.add(0, query(rank[i]-1));\n    }\n    return res;\n}\n```","tags":["LeetCode","äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"LeetCodeå›æº¯&é€’å½’","url":"/2019/10/10/leetcode-hui-su/","content":"\n## [17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ](https://leetcode-cn.com/problems/letter-combinations-of-a-phone-number/)\n\nç»™å®šä¸€ä¸ªä»…åŒ…å«æ•°å­— `2-9` çš„å­—ç¬¦ä¸²ï¼Œè¿”å›æ‰€æœ‰å®ƒèƒ½è¡¨ç¤ºçš„å­—æ¯ç»„åˆã€‚\n\nç»™å‡ºæ•°å­—åˆ°å­—æ¯çš„æ˜ å°„å¦‚ä¸‹ï¼ˆä¸ç”µè¯æŒ‰é”®ç›¸åŒï¼‰æ³¨æ„ 1 ä¸å¯¹åº”ä»»ä½•å­—æ¯\n\n![mark](http://static.imlgw.top/blog/20191012/Ro4wr1dv5pR7.png?imageslim)\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥ï¼š\"23\"\nè¾“å‡ºï¼š[\"ad\", \"ae\", \"af\", \"bd\", \"be\", \"bf\", \"cd\", \"ce\", \"cf\"].\n```\n\n**è¯´æ˜:**\nå°½ç®¡ä¸Šé¢çš„ç­”æ¡ˆæ˜¯æŒ‰å­—å…¸åºæ’åˆ—çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥ä»»æ„é€‰æ‹©ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚\n\n**è§£æ³•ä¸€**\n\n```java\nString[] letter={\" \",\"\",\"abc\",\"def\",\"ghi\",\"jkl\",\"mno\",\"pqrs\",\"tuv\",\"wxyz\"};\n\nprivate List<String> res=new LinkedList<>();\n\npublic List<String> letterCombinations(String digits) {\n    //ç©ºå­—ç¬¦ä¸²è¦æ³¨æ„\n    if (\"\".equals(digits)) return res;\n    letterCombinations(digits,0,\"\");\n    return res;\n}\n\npublic void letterCombinations(String digits,int index,String str) {\n    //é€’å½’å‡ºå£,å½“index==digitsçš„é•¿åº¦çš„æ—¶å€™å°±è¯´æ˜èµ°åˆ°å°½å¤´äº†\n    //éœ€è¦å›å¤´å°è¯•å…¶ä»–çš„æƒ…å†µ\n    if (index==digits.length()) {\n        res.add(str);\n        return;\n    }\n    //å½“å‰å­—ç¬¦å¯¹åº”çš„å­—æ¯ç»„åˆ\n    char[] ls=letter[digits.charAt(index)-48].toCharArray();\n    //éå†æ¯ç§å¯èƒ½,å…¶å®å°±æ˜¯DFS\n    for (int i=0;i<ls.length;i++) {\n        letterCombinations(digits,index+1,str+ls[i]);\n    }\n    return;\n}\n```\n\nå¯æƒ³è€ŒçŸ¥ï¼Œè¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ç›¸å½“é«˜ï¼Œ`3^N * 4^M = O(2^N)` Mæ˜¯èƒ½è¡¨ç¤º3ä¸ªå­—ç¬¦çš„æ•°å­—ä¸ªæ•°ï¼ŒNæ˜¯è¡¨ç¤º4ä¸ªå­—ç¬¦çš„æ•°å­—ä¸ªæ•°ï¼ŒæŒ‡æ•°çº§åˆ«çš„ç®—æ³•ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å…¶ä»–åˆ«çš„æ¯”è¾ƒå¥½çš„ç®—æ³•äº†\n\n## [93. å¤åŸIPåœ°å€](https://leetcode-cn.com/problems/restore-ip-addresses/)\n\nç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„å­—ç¬¦ä¸²ï¼Œå¤åŸå®ƒå¹¶è¿”å›æ‰€æœ‰å¯èƒ½çš„ IP åœ°å€æ ¼å¼ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: \"25525511135\"\nè¾“å‡º: [\"255.255.11.135\", \"255.255.111.35\"]\n```\n\n**è§£æ³•ä¸€**\n\nå…¶å®è¿˜æ˜¯æœ‰ä¸€ä¸ªå¤§è‡´çš„æ€è·¯ï¼Œä½†æ˜¯æ²¡å†™å‡ºæ¥ï¼Œå¾ˆå¤šç»†èŠ‚ä¸çŸ¥é“å’‹å¤„ç†\n\n```java\npublic List<String> restoreIpAddresses(String s) {\n    restoreIpAddresses(s,0,\"\",0);\n    return res;\n}\n\nLinkedList<String> res=new LinkedList<>();\n\npublic void restoreIpAddresses(String s,int index,String des,int count) {\n    if (count>4) {\n        return;\n    }\n    //åˆ°å­—ç¬¦ä¸²æœ«å°¾äº†\n    if (index==s.length()) {\n        if (count==4) {\n            res.add(des.substring(0,des.length()-1));    \n        }\n        return;\n    }\n    //å¦‚æœä¸º0å°±ä¸ç”¨åˆ‡åˆ†äº†,è¿™é‡Œå°±ç›¸å½“äºç›´æ¥è·³è¿‡\n    if (s.charAt(index)=='0') {\n        restoreIpAddresses(s,index+1,des+\"0.\",count+1);\n    }else{\n        //ä¸ä¸º0å°±éœ€è¦ç»§ç»­åˆ‡åˆ†ä¸º1ï¼Œ2ï¼Œ3\n        //åˆ‡åˆ†è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„è¦å°äº255,åŒæ—¶éœ€è¦ä¸€ä¸ªè®¡æ•°å™¨æ¥åˆ¤åº¦æ˜¯å¦ç»ˆæ­¢\n        for (int i=1;i<4;i++) {\n            if (index+i<=s.length()) {\n                String temp=s.substring(index,index+i);\n                if (Integer.valueOf(temp)<=255){\n                    restoreIpAddresses(s,index+i,des+temp+\".\",count+1);    \n                }\n            }\n        }\n    }\n}\n```\n\n**UPDATE: 2020.8.9**\n\nä»Šå¤©çš„æ‰“å¡é¢˜ï¼Œç”¨goé‡å†™äº†ä¸‹ï¼Œæ¯”ä¹‹å‰å†™çš„å¥½å¤šäº†ï¼Œä¸è¿‡ä¸€å¼€å§‹å¿˜äº†å¤„ç†0WAäº†ä¸€å‘ï¼Œç„¶åæ‡’çš„å¯¹é•¿åº¦ä¸åˆæ³•çš„å‰ªæåˆTäº†ä¸€å‘ã€‚ã€‚ã€‚\n```golang\nfunc restoreIpAddresses(s string) []string {\n    var res []string\n    if len(s) < 4 || len(s) > 12 {\n        return res\n    }\n    var dfs func(s string, lis []string)\n    dfs = func(s string, lis []string) {\n        if s == \"\" {\n            if len(lis) == 4 {\n                res = append(res, strings.Join(lis, \".\"))\n            }\n            return\n        }\n        //sæœªéå†å®Œå°±é›†é½äº†4å—\n        if len(lis) >= 4 {\n            return\n        }\n        for i := 1; i <= 3; i++ {\n            if i <= len(s) && check(s[:i]) {\n                lis = append(lis, s[:i])\n                dfs(s[i:], lis)\n                lis = lis[:len(lis)-1]\n                //å‰å¯¼0çš„å¤„ç†ï¼Œè¯»å–0ä¹‹åå°±ä¸å†å‘åæ‰©å±•\n                if s[:i] == \"0\" {\n                    return\n                }\n            }\n        }\n    }\n    dfs(s, []string{})\n    return res\n}\n\nfunc check(s string) bool {\n    if ns, _ := strconv.Atoi(s); ns <= 255 {\n        return true\n    }\n    return false\n}\n\n```\n\n## [131. åˆ†å‰²å›æ–‡ä¸²](https://leetcode-cn.com/problems/palindrome-partitioning/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œå°† s åˆ†å‰²æˆä¸€äº›å­ä¸²ï¼Œä½¿æ¯ä¸ªå­ä¸²éƒ½æ˜¯å›æ–‡ä¸²ã€‚\n\nè¿”å› s æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: \"aab\"\nè¾“å‡º:\n[\n  [\"aa\",\"b\"],\n  [\"a\",\"a\",\"b\"]\n]\n```\n\n**è§£æ³•ä¸€**\n\næ€»ç®—è‡ªå·±å®Œæ•´åšäº†ä¸€é¢˜å‡ºæ¥äº†\n\n```java\npublic List<List<String>> partition(String s) {\n    partition(s,0,new ArrayList());\n    return res;\n}   \n\nList<List<String>> res=new ArrayList<>();\n\npublic void partition(String s,int index,List<String> lis) {\n    if (index==s.length()) {\n        //æ³¨æ„è¿™é‡Œè¦copyä¸€ä¸ªlistä¸èƒ½ç›´æ¥æ·»åŠ lis\n        //liså¼•ç”¨çš„å¯¹è±¡åé¢è¿˜ä¼šç»§ç»­å˜åŒ–ï¼Œæœ€åä¼šå˜ä¸ºnull\n        res.add(new ArrayList(lis));\n        return;\n    }\n    for (int i=index+1;i<=s.length();i++) {\n        String temp=s.substring(index,i);\n        //System.out.println(index+\"=\"+i+\"=\"+temp);\n        if (isPalind(temp)) {\n            lis.add(temp);\n            partition(s,i,lis);\n            //ä¸èƒ½ç›´æ¥remove(temp),ä¸»è¦æ˜¯ä¼šæœ‰é‡å¤çš„å­—ç¬¦,æ‰€ä»¥ä¼šå¯¼è‡´æœ€åçš„é¡ºåºä¸ä¸€è‡´,è€Œä¸”æ•ˆç‡ä¹Ÿå¾ˆä½\n            //lis.remove(temp);\n            lis.remove(lis.size()-1);\n        }\n    }\n}\n\npublic boolean isPalind(String s){\n    for (int i=0,j=s.length()-1;i<=j;i++,j--) {\n        if (s.charAt(i)!=s.charAt(j)) {\n            return false;\n        }\n    }\n    return true;\n}\n```\n4msï¼Œ93%ï¼Œå…¶å®å°±æ˜¯æš´åŠ›å›æº¯ï¼Œè¿˜æ˜¯æŒºç®€å•çš„ï¼Œä¸€å¼€å§‹å¿˜äº†`remove()`ï¼Œç›´æ¥æŠŠæ‰€æœ‰ç»“æœæ‰“å‡ºæ¥äº†ï¼Œ ç„¶åä¸€ç›´åœ¨æƒ³æ€ä¹ˆè°ƒæ•´é€’å½’çš„ç»“æ„ã€‚ã€‚ã€‚DFSåŸºæœ¬çš„å¥—è·¯éƒ½å¿˜äº†ğŸ˜‚\n\n## [46. å…¨æ’åˆ—](https://leetcode-cn.com/problems/permutations/)\n\nç»™å®šä¸€ä¸ª**æ²¡æœ‰é‡å¤**æ•°å­—çš„åºåˆ—ï¼Œè¿”å›å…¶æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [1,2,3]\nè¾“å‡º:\n[\n  [1,2,3],\n  [1,3,2],\n  [2,1,3],\n  [2,3,1],\n  [3,1,2],\n  [3,2,1]\n]\n```\n\n**è§£æ³•ä¸€**\n\nç»å…¸çš„å…¨æ’åˆ—é—®é¢˜ï¼Œç†Ÿæ‚‰äº†DFSå¥—è·¯ä¹‹åéƒ½æŒºç®€å•çš„ï¼Œæ³¨æ„å›æº¯å°±è¡Œäº†\n\n```java\npublic List<List<Integer>> permute(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return res;\n    }\n    boolean[] visit=new boolean[nums.length];\n    permute(nums,new ArrayList(),visit);\n    return res;\n}\n\nprivate List<List<Integer>> res=new ArrayList<>();\n\npublic void permute(int[] nums,List<Integer> lis,boolean[] visit) {\n    if (lis.size()==nums.length) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n    for (int i=0;i<nums.length;i++) {\n        if (visit[i]) continue;\n        lis.add(nums[i]);\n        visit[i]=true;\n        permute(nums,lis,visit);\n        //å›æº¯\n        visit[i]=false;\n        lis.remove(lis.size()-1);\n    }\n}\n```\n## [60. ç¬¬kä¸ªæ’åˆ—](https://leetcode-cn.com/problems/permutation-sequence/)\n\nç»™å‡ºé›†åˆ [1,2,3,â€¦,n]ï¼Œå…¶æ‰€æœ‰å…ƒç´ å…±æœ‰ n! ç§æ’åˆ—ã€‚\n\næŒ‰å¤§å°é¡ºåºåˆ—å‡ºæ‰€æœ‰æ’åˆ—æƒ…å†µï¼Œå¹¶ä¸€ä¸€æ ‡è®°ï¼Œå½“ n = 3 æ—¶, æ‰€æœ‰æ’åˆ—å¦‚ä¸‹ï¼š\n\n1. `\"123\"`\n2. `\"132\"`\n3. `\"213\"`\n4. `\"231\"`\n5. `\"312\"`\n6. `\"321\"`\n\nç»™å®š n å’Œ kï¼Œè¿”å›ç¬¬ k ä¸ªæ’åˆ—ã€‚\n\n**è¯´æ˜ï¼š**\n\n- ç»™å®š n çš„èŒƒå›´æ˜¯ [1, 9]ã€‚\n- ç»™å®š k çš„èŒƒå›´æ˜¯[1,  n!]ã€‚\n\n**ç¤ºä¾‹ 1: **\n\n```java\nè¾“å…¥: n = 3, k = 3\nè¾“å‡º: \"213\"\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: n = 4, k = 9\nè¾“å‡º: \"2314\"\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic String getPermutation(int n, int k) {\n    boolean[] visit=new boolean[n+1];\n    getPermutation(n,k,0,visit,new StringBuilder(\"\"));\n    return res.get(k-1).toString();\n}\n\nprivate List<StringBuilder> res=new LinkedList<>();\n\npublic void getPermutation(int n, int k,int count,boolean[] visit,StringBuilder str) {\n    if (count == n) {\n        res.add(new StringBuilder(str));\n        return;\n    }\n    if (res.size()==k) {\n        return;\n    }\n    for (int i=1;i<=n;i++) {\n        if (!visit[i]) {\n            str.append(i);\n            visit[i]=true;\n            getPermutation(n,k,count+1,visit,str);\n            visit[i]=false;\n            str.delete(str.length()-1,str.length());\n        }\n    }\n}\n```\nå¶ç„¶å‘ç°è¿™ä¸€é¢˜å¹¶æ²¡æœ‰è®°å½•ï¼Œä¹‹å‰æ²¡æœ‰è®°å½•çš„åŸå› è‚¯å®šæ˜¯å› ä¸ºæ–¹æ³•å¤ªåƒåœ¾äº†ï¼Œè¿™é¢˜æœ€ä¼˜è§£æ˜¯ `åº·æ‰˜å±•å¼€`ï¼Œè¯´å®è¯ï¼Œæš‚æ—¶å¹¶ä¸æƒ³å»äº†è§£ğŸ˜‚ï¼Œåé¢æœ‰æ—¶é—´å†è¯´å§\n\n## [5374. é•¿åº¦ä¸º n çš„å¼€å¿ƒå­—ç¬¦ä¸²ä¸­å­—å…¸åºç¬¬ k å°çš„å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/the-k-th-lexicographical-string-of-all-happy-strings-of-length-n/) \n\nä¸€ä¸ª ã€Œå¼€å¿ƒå­—ç¬¦ä¸²ã€å®šä¹‰ä¸ºï¼š\n\n- ä»…åŒ…å«å°å†™å­—æ¯ ['a', 'b', 'c'].\n- å¯¹æ‰€æœ‰åœ¨ 1 åˆ° s.length - 1 ä¹‹é—´çš„ i ï¼Œæ»¡è¶³ s[i] != s[i + 1] ï¼ˆå­—ç¬¦ä¸²çš„ä¸‹æ ‡ä» 1 å¼€å§‹ï¼‰ã€‚\n\næ¯”æ–¹è¯´ï¼Œå­—ç¬¦ä¸² \"abc\"ï¼Œ\"ac\"ï¼Œ\"b\" å’Œ \"abcbabcbcb\" éƒ½æ˜¯å¼€å¿ƒå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ \"aa\"ï¼Œ\"baa\" å’Œ \"ababbc\" éƒ½ä¸æ˜¯å¼€å¿ƒå­—ç¬¦ä¸²ã€‚\n\nç»™ä½ ä¸¤ä¸ªæ•´æ•° n å’Œ k ï¼Œä½ éœ€è¦å°†é•¿åº¦ä¸º n çš„æ‰€æœ‰å¼€å¿ƒå­—ç¬¦ä¸²æŒ‰å­—å…¸åºæ’åºã€‚\n\nè¯·ä½ è¿”å›æ’åºåçš„ç¬¬ k ä¸ªå¼€å¿ƒå­—ç¬¦ä¸²ï¼Œå¦‚æœé•¿åº¦ä¸º n çš„å¼€å¿ƒå­—ç¬¦ä¸²å°‘äº k ä¸ªï¼Œé‚£ä¹ˆè¯·ä½ è¿”å› ç©ºå­—ç¬¦ä¸² ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 1, k = 3\nè¾“å‡ºï¼š\"c\"\nè§£é‡Šï¼šåˆ—è¡¨ [\"a\", \"b\", \"c\"] åŒ…å«äº†æ‰€æœ‰é•¿åº¦ä¸º 1 çš„å¼€å¿ƒå­—ç¬¦ä¸²ã€‚æŒ‰ç…§å­—å…¸åºæ’åºåç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²ä¸º \"c\" ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 1, k = 4\nè¾“å‡ºï¼š\"\"\nè§£é‡Šï¼šé•¿åº¦ä¸º 1 çš„å¼€å¿ƒå­—ç¬¦ä¸²åªæœ‰ 3 ä¸ªã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 3, k = 9\nè¾“å‡ºï¼š\"cab\"\nè§£é‡Šï¼šé•¿åº¦ä¸º 3 çš„å¼€å¿ƒå­—ç¬¦ä¸²æ€»å…±æœ‰ 12 ä¸ª [\"aba\", \"abc\", \"aca\", \"acb\", \"bab\", \"bac\", \"bca\", \"bcb\", \"cab\", \"cac\", \"cba\", \"cbc\"] ã€‚ç¬¬ 9 ä¸ªå­—ç¬¦ä¸²ä¸º \"cab\"\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 2, k = 7\nè¾“å‡ºï¼š\"\"\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 10, k = 100\nè¾“å‡ºï¼š\"abacbabacb\"\n```\n\n**æç¤ºï¼š**\n\n- `1 <= n <= 10`\n- `1 <= k <= 100`\n\n**è§£æ³•ä¸€**\n\nè¡¥ä¸‹24thåŒå‘¨èµ›T3ï¼Œå’Œä¸Šé¢ä¸€é¢˜å¾ˆç±»ä¼¼ï¼Œç›´æ¥æš´åŠ›å›æº¯äº†\n\n```java\npublic String getHappyString(int n, int k) {\n    dfs(\"a\",n,k);\n    dfs(\"b\",n,k);\n    dfs(\"c\",n,k);\n    return res;\n}\n\nprivate int count=0;\n\nprivate String res=\"\";\n\npublic void dfs(String cur,int n,int k){\n    if(!\"\".equals(res)) return;\n    if(cur.length()==n){\n        count++;\n        if(count==k){\n            res=cur;\n        }\n        return;\n    }\n    char last=cur.charAt(cur.length()-1);\n    if(last=='a'){\n        dfs(cur+'b',n,k);\n        dfs(cur+'c',n,k);\n    }\n    if(last=='b'){\n        dfs(cur+'a',n,k);\n        dfs(cur+'c',n,k);\n    }\n    if(last=='c'){\n        dfs(cur+'a',n,k);\n        dfs(cur+'b',n,k);\n    }\n}\n```\nå…¶å®ç›´æ¥é˜Ÿåˆ—æ¨¡æ‹Ÿä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ¨¡æ‹Ÿçš„æ•ˆç‡åº”è¯¥ä¼šæ›´é«˜ä¸€äº›ï¼Œå¥½åƒä¹Ÿå¯ä»¥ç›´æ¥æ„é€ å‡ºæ¥\n\n## [47. å…¨æ’åˆ— II](https://leetcode-cn.com/problems/permutations-ii/)\n\nç»™å®šä¸€ä¸ªå¯åŒ…å«é‡å¤æ•°å­—çš„åºåˆ—ï¼Œè¿”å›æ‰€æœ‰ä¸é‡å¤çš„å…¨æ’åˆ—ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [1,1,2]\nè¾“å‡º:\n[\n  [1,1,2],\n  [1,2,1],\n  [2,1,1]\n]\n```\n\n**è§£æ³•ä¸€**\n\nå¼€å§‹æˆ‘å¾ˆçº ç»“è¿™é¢˜ï¼Œåæ¥æƒ³é€šäº†ï¼Œå…¶å®å°±æ˜¯å»é‡ï¼Œé‡åˆ°å·²ç»å­˜åœ¨äºç»“æœä¸­ç›¸åŒçš„å…ƒç´ å°±ç›´æ¥è·³è¿‡å°±è¡Œäº†\n\n```java\npublic List<List<Integer>> permuteUnique(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return res;\n    }\n    //Arrays.sort(nums); è§£æ³•äºŒéœ€è¦å…ˆæ’åº\n    boolean[] visit=new boolean[nums.length];\n    permuteUnique(nums,new ArrayList(),visit);\n    return res;\n}\n\nprivate List<List<Integer>> res=new ArrayList<>();\n\npublic void permuteUnique(int[] nums,List<Integer> lis,boolean[] visit){\n    HashSet<Integer> set=new HashSet<>();\n    if (lis.size()==nums.length) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n    for (int i=0;i<nums.length;i++) {\n        if (!visit[i] && !set.contains(nums[i])) {\n            lis.add(nums[i]);\n            visit[i]=true;\n            set.add(nums[i]);\n            permuteUnique(nums,lis,visit);\n            visit[i]=false;\n            lis.remove(lis.size()-1);\n        }\n    }\n}\n\n//éœ€è¦æ’åº\npublic void permuteUnique2(int[] nums,List<Integer> lis,boolean[] visit){\n    if (lis.size()==nums.length) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n    for (int i=0;i<nums.length;i++) {\n        //å‰ªæå»é‡ï¼Œå’Œå‰ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒ\n        //Bugè­¦å‘Šï¼Œåº”è¯¥å†™!visit[i-1]\n        if (i>0&&nums[i]==nums[i-1] && !visit[i-1]) \n            continue;\n        if (!visit[i]) {\n            lis.add(nums[i]);\n            visit[i]=true;\n            permuteUnique2(nums,lis,visit);\n            visit[i]=false;\n            lis.remove(lis.size()-1);\n        }\n    }\n}\n```\nå…³äºå»é‡çš„æ–¹å¼ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ä»å›æº¯çš„**æ ¹èŠ‚ç‚¹**æ¥è€ƒè™‘ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è€ƒè™‘æœ€é¡¶å±‚çš„ã€**1ï¼Œ1ï¼Œ2**ã€‘çš„éå†æƒ…å†µï¼Œæ¯ä¸€æ¬¡éå†å®é™…ä¸Šéƒ½æ˜¯åœ¨æ‰¾**ä»¥å½“å‰å…ƒç´ å¼€å¤´çš„æ’åˆ—**ï¼Œå½“ç¬¬ä¸€æ¬¡å·²ç»éå†å®Œ1å¼€å¤´çš„æ‰€ä»¥æ’åˆ—åï¼Œåé¢çš„å¾ªç¯å†ç¢°åˆ°1è‡ªç„¶å°±å¯ä»¥ç›´æ¥è·³è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡éå†ä¸­ç”¨HashMapæ¥å»é‡ï¼Œæ¥ä¿è¯ä¸€æ¬¡å¾ªç¯ä¸­ä¸ä¼šæœ‰é‡å¤çš„å…ƒç´ è¢«é€‰å–ï¼Œå…¶å®ä¹Ÿåªæœ‰è¿™é¢˜å¯ä»¥ç”¨HashSetï¼Œå› ä¸ºè¿™é‡Œæ’åˆ—æ˜¯è®²ç©¶é¡ºåºçš„ï¼Œå¾ªåºå®Œå…¨ä¸€æ ·æ‰æ˜¯é‡å¤ï¼Œåé¢çš„é¢˜éƒ½æ˜¯ä¸è®²ç©¶é¡ºåºçš„ï¼Œéƒ½éœ€è¦æ’åºæ‰èƒ½å»é‡ï¼Œå…·ä½“åé¢å†åˆ†æ\n\n> æˆ‘é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯Hashè¡¨ï¼Œè¿™é‡Œç¿»äº†ä¸‹è¯„è®ºåŒºå¥½åƒéƒ½æ˜¯ç”¨çš„ç¬¬äºŒç§æ–¹å¼å»é‡çš„ï¼Œéš¾é“ç”¨HashSetä¸å¥½ä¹ˆğŸ˜‚ï¼Œç¬¬äºŒç§å¿…é¡»è¦å…ˆæ’åºï¼Œä¿è¯ç›¸åŒçš„å…ƒç´ éƒ½èšåœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿åˆ¤æ–­ï¼Œè¿™ç§é¢˜åœ¨çº¸ä¸Šç”»ä¸€ç”»é€’å½’æ ‘å…¶å®å°±å¾ˆæ¸…æ¥šäº†\n\n### Bugè­¦å‘Š\n\nè¿™é‡Œ `!visit[i-1]`å’Œ `visit[i-1]`å¯¹äºè¿™é¢˜æ¥è¯´å¹¶ä¸å½±å“æ­£ç¡®æ€§ï¼Œä½†æ˜¯ä½ å¦‚æœå°†ç”Ÿæˆçš„è¿‡ç¨‹æ‰“å°å‡ºæ¥å¯¹æ¯”ä¸‹å°±çŸ¥é“ä¸ºå•¥äº†ï¼Œå…·ä½“çš„è¯·çœ‹ä¸‹é¢ [1079. æ´»å­—å°åˆ·](#1079-æ´»å­—å°åˆ·) çš„è§£é‡Š\n\n## [1286. å­—æ¯ç»„åˆè¿­ä»£å™¨](https://leetcode-cn.com/problems/iterator-for-combination/)\n\nè¯·ä½ è®¾è®¡ä¸€ä¸ªè¿­ä»£å™¨ç±»ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š\n\n- ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¾“å…¥å‚æ•°åŒ…æ‹¬ï¼šä¸€ä¸ª æœ‰åºä¸”å­—ç¬¦å”¯ä¸€ çš„å­—ç¬¦ä¸² charactersï¼ˆè¯¥å­—ç¬¦ä¸²åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ï¼‰å’Œä¸€ä¸ªæ•°å­— combinationLength ã€‚\n- å‡½æ•° next() ï¼ŒæŒ‰ å­—å…¸åº è¿”å›é•¿åº¦ä¸º combinationLength çš„ä¸‹ä¸€ä¸ªå­—æ¯ç»„åˆã€‚\n- å‡½æ•° hasNext() ï¼Œåªæœ‰å­˜åœ¨é•¿åº¦ä¸º combinationLength çš„ä¸‹ä¸€ä¸ªå­—æ¯ç»„åˆæ—¶ï¼Œæ‰è¿”å› Trueï¼›å¦åˆ™ï¼Œè¿”å› Falseã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nCombinationIterator iterator = new CombinationIterator(\"abc\", 2); // åˆ›å»ºè¿­ä»£å™¨ iterator\n\niterator.next(); // è¿”å› \"ab\"\niterator.hasNext(); // è¿”å› true\niterator.next(); // è¿”å› \"ac\"\niterator.hasNext(); // è¿”å› true\niterator.next(); // è¿”å› \"bc\"\niterator.hasNext(); // è¿”å› false\n```\n\n**æç¤ºï¼š**\n\n- 1 <= combinationLength <= characters.length <= 15\n- æ¯ç»„æµ‹è¯•æ•°æ®æœ€å¤šåŒ…å« 10^4 æ¬¡å‡½æ•°è°ƒç”¨ã€‚\n- é¢˜ç›®ä¿è¯æ¯æ¬¡è°ƒç”¨å‡½æ•° next æ—¶éƒ½å­˜åœ¨ä¸‹ä¸€ä¸ªå­—æ¯ç»„åˆã€‚\n\n**è§£æ³•ä¸€**\n\nå”‰ï¼ŒçœŸçš„èœï¼Œå¥½ä¹…æ²¡å†™å›æº¯äº†ï¼Œåˆçµ¦å¿˜äº†ï¼Œè¿™é¢˜å¼€å§‹è¢«åˆ«äººè¯¯å¯¼äº†ï¼Œä»¥ä¸ºæ˜¯ä¸‹ä¸€ä¸ªæ’åˆ—ï¼Œç„¶åå°±ä¸€ç›´åœ¨æƒ³æ€ä¹ˆå»æ±‚nextï¼Œå…¶å®æ ¹æœ¬å°±ä¸ç”¨è¿™æ ·...\n\n```java\nprivate LinkedList<String> res=new LinkedList<>();\n\n//abc\npublic CombinationIterator(String characters, int combinationLength) {\n    dfs(\"\",combinationLength,0,0,characters);\n}\n\npublic String next() {\n    return res.pollFirst();\n}\n\npublic void dfs(String cur,int len,int index,int count,String source) {\n    if (count == len) {\n        res.add(cur); //ç›´æ¥æ ¹æ®curå¾—é•¿åº¦åˆ¤æ–­å°±okäº†\n        return;\n    }\n    for (int i=index;i<source.length();i++) {\n        dfs(cur+source.charAt(i),len,i+1,count+1,source);\n    }\n}\n\npublic boolean hasNext() {\n    return !res.isEmpty();\n}\n```\n\n> å›å¤´å¼€äº†ä¸‹ä¹‹å‰çš„ä»£ç ï¼Œå‘ç°éƒ½å†™å¾—ä¸å¥½ï¼Œå¾ˆå–œæ¬¢åŠ ä¸ªcountç»Ÿè®¡æ•°é‡ï¼Œå…¶å®ç›´æ¥æ ¹æ®curå¾—é•¿åº¦åˆ¤æ–­å°±å¯ä»¥äº†\n\n## [77. ç»„åˆ](https://leetcode-cn.com/problems/combinations/)\n\nç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å› 1 ... n ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: n = 4, k = 2\nè¾“å‡º:\n[\n  [2,4],\n  [3,4],\n  [2,3],\n  [1,2],\n  [1,3],\n  [1,4],\n]\n```\n\n**è§£æ³•ä¸€**\n\nå…¶å®ä¸€å¼€å§‹æ²¡å†™å‡ºå‰ªæçš„ä»£ç ï¼Œçœ‹äº†ä¸€ç‚¹æç¤ºåæ‰å†™å‡ºäº†ä¸‹é¢çš„çš„ç¬¬ä¸€ç§å‰ªæçš„æ–¹æ³•\n\n```java\npublic List<List<Integer>> combine(int n, int k) {\n    if (k>n || n<=0 ||k<=0) {\n        return res;\n    }\n    //boolean[] visit=new boolean[n+1];\n    combine(n,k,1,new ArrayList(),0);\n    return res;\n}   \n\nprivate List<List<Integer>> res=new ArrayList<>();\n\n//å‰ªæä¼˜åŒ–1\npublic void combine(int n, int k,int index,List<Integer> lis,int count) {\n    if (count==k) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n    //1 2 3 4 | 3\n    //index = 3 k=3  n=4 count=0 (3ä¸ºå¤´,æ˜¾ç„¶æ˜¯ä¸è¡Œçš„,è‚¯å®šä¼šå’Œå‰é¢é‡å¤) --> 3<=3\n    //index = 3 k=3  n=4 count=1 (3ä¸ºç¬¬äºŒä¸ª,æ˜¯å¯è¡Œçš„) --> 3 <= 2\n    if (n-index+2<=k-count) {\n        return;\n    }\n    for (int i=index;i<=n;i++) {\n        lis.add(i);\n        combine(n,k,i+1,lis,count+1);\n        //å›æº¯çš„å…³é”®\n        lis.remove(lis.size()-1);\n    }\n}\n\n//å‰ªæä¼˜åŒ–2\npublic void combine4(int n, int k,int index,List<Integer> lis,int count) {\n    if (count==k) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n    //å¾ªç¯çš„åŒºé—´è‡³å°‘è¦æœ‰k-countä¸ªå…ƒç´  ä¹Ÿå°±æ˜¯[i,N]ä¹‹é—´è‡³å°‘è¦æœ‰k-countä¸ªå…ƒç´ \n    //N-i+1>=k-count --> i<=n-(k-count)+1\n    for (int i=index;i<=n-(k-count)+1;i++) {\n        lis.add(i);\n        combine4(n,k,i+1,lis,count+1);\n        //å›æº¯çš„å…³é”®\n        lis.remove(lis.size()-1);\n    }\n}\n```\nä¸¾ä¸ªä¾‹å­`1ï¼Œ2ï¼Œ3ï¼Œ4 k=3`  å…¶å®åœ¨å¾ªç¯n=3çš„æ—¶å€™å°±å¯ä»¥ç»“æŸäº†ï¼Œå› ä¸ºåé¢å·²ç»æ²¡æœ‰é‚£ä¹ˆå¤šå…ƒç´ å¯ä»¥å’Œ3æ„æˆç»„åˆäº†\n\n## [39. ç»„åˆæ€»å’Œ](https://leetcode-cn.com/problems/combination-sum/)\n\nç»™å®šä¸€ä¸ªæ— é‡å¤å…ƒç´ çš„æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆ ï¼Œ`candidates` ä¸­çš„æ•°å­—å¯ä»¥æ— é™åˆ¶é‡å¤è¢«é€‰å–\n\nè¯´æ˜ï¼š\n\n- æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬ targetï¼‰éƒ½æ˜¯æ­£æ•´æ•°ã€‚\n\n- è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ \n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: candidates = [2,3,6,7], target = 7,\næ‰€æ±‚è§£é›†ä¸º:\n[\n  [7],\n  [2,2,3]\n]\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: candidates = [2,3,5], target = 8,\næ‰€æ±‚è§£é›†ä¸º:\n[\n  [2,2,2,2],\n  [2,3,3],\n  [3,5]\n]\n```\n\n**è§£æ³•ä¸€**\n\næ²¡æœ‰ä»»ä½•å‰ªæå¤„ç†çš„å›æº¯ï¼Œæ„Ÿè§‰ä¸€å¼€å§‹å°±æƒ³å¥½æ€ä¹ˆå‰ªæè¿˜æ˜¯ä¸å¤ªå®¹æ˜“ï¼Œè¿™é¢˜å…¶å®å’Œä¸Šé¢çš„ç»„åˆå¾ˆç±»ä¼¼ï¼Œå€¼å¾—æ³¨æ„çš„å°±æ˜¯å­é€’å½’è°ƒç”¨çš„æ—¶å€™ä¼ é€’çš„indexå‚æ•°\n\n```java\npublic List<List<Integer>> combinationSum(int[] candidates, int target) {\n    if (candidates==null || candidates.length<=0) {\n        return res;\n    }\n    combinationSum(candidates,target,0,0,new ArrayList());\n    return res;\n}\n\nprivate List<List<Integer>> res=new ArrayList<>();\n\npublic void combinationSum(int[] candidates, int target,int index,int sum,List<Integer> lis) {\n    if (sum>target) {\n        return;\n    }\n    if (target==sum) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n    //è¿™é‡Œä¸€æ¬¡å¾ªç¯å…¶å®å°±ç¡®å®šäº†åŒ…å«içš„æ‰€æœ‰å¯èƒ½è§£ï¼Œæ‰€ä»¥èµ·ç‚¹æ˜¯indexä¸æ˜¯0\n    for (int i=index;i<candidates.length;i++) {\n        //è·³è¿‡æ¯”targetå¤§çš„\n        if (candidates[i]>target) continue;\n        sum+=candidates[i];\n        lis.add(candidates[i]);\n\t\t//å…¶å®ä¸»è¦å°±æ˜¯ææ¸…æ¥šæ¯æ¬¡ä»å“ªé‡Œå¼€å§‹,ä»¥åŠæ¯æ¬¡å¾ªç¯çš„ä½œç”¨\n        //å¯ä»¥é‡å¤é€‰å–è‡ªå·±ï¼Œæ‰€ä»¥å­é€’å½’ä¹Ÿä»iå¼€å§‹è€Œä¸æ˜¯i+1\n        combinationSum(candidates,target,i,sum,lis);\n        sum-=candidates[i];\n        lis.remove(lis.size()-1);\n    }\n}\n```\n**è§£æ³•äºŒ**\n\nå‰ªæä¼˜åŒ–ï¼Œä¸»è¦æ˜¯è¦å…ˆæ’ä¸ªåºï¼Œè¿™æ ·å¦‚æœåœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œç´¯åŠ å’Œå·²ç»å¤§äºtargetäº†å°±ç›´æ¥returnï¼Œå¦‚æœä¸æ’åºå°±ä¸èƒ½returnï¼Œå› ä¸ºæ— æ³•ç¡®ä¿åé¢ä¼šä¸ä¼šæ›´å°çš„å…ƒç´ \n\n```java\npublic List<List<Integer>> combinationSum(int[] candidates, int target) {\n    if (candidates==null || candidates.length<=0) {\n        return res;\n    }\n    //æ’åº,æ–¹ä¾¿å‰ªæ\n    Arrays.sort(candidates);\n    combinationSum(candidates,target,0,0,new ArrayList());\n    return res;\n}\n\nprivate List<List<Integer>> res=new ArrayList<>();\n\n//å‰ªæä¼˜åŒ–2\npublic void combinationSum(int[] candidates, int target,int index,int sum,List<Integer> lis) {\n    if (sum>target) {\n        return;\n    }\n    if (target==sum) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n    for (int i=index;i<candidates.length;i++) {\n        if (sum+candidates[i]>target) return;\n        sum+=candidates[i];\n        lis.add(candidates[i]);\n        //æ³¨æ„è¿™é‡Œä¼ é€’è¿›å»çš„indexæ˜¯i\n        combinationSum(candidates,target,i,sum,lis);\n        sum-=candidates[i];\n        lis.remove(lis.size()-1);\n    }\n}\n```\nè¿™ä¸¤å¤©çŠ¶æ€è¿˜å¯ä»¥å•Šï¼Œå¥½å¤šé¢˜éƒ½å¯ä»¥å®Œå…¨ç‹¬ç«‹çš„å†™å‡ºæ¥äº†ğŸ˜\n\n## [40. ç»„åˆæ€»å’Œ II](https://leetcode-cn.com/problems/combination-sum-ii/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚\n\ncandidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚\n\n**è¯´æ˜ï¼š**\n\n- æ‰€æœ‰æ•°å­—ï¼ˆåŒ…æ‹¬ç›®æ ‡æ•°ï¼‰éƒ½æ˜¯æ­£æ•´æ•°ã€‚\n- è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ \n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: candidates = [10,1,2,7,6,1,5], target = 8,\næ‰€æ±‚è§£é›†ä¸º:\n[\n  [1, 7],\n  [1, 2, 5],\n  [2, 6],\n  [1, 1, 6]\n]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: candidates = [2,5,2,1,2], target = 5,\næ‰€æ±‚è§£é›†ä¸º:\n[\n  [1,2,2],\n  [5]\n]\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic List<List<Integer>> combinationSum2(int[] candidates, int target) {\n    if (candidates ==null || candidates.length<=0) {\n        return res;\n    }\n    Arrays.sort(candidates);\n    combinationSum2(candidates,target,0,new ArrayList());\n    return res;\n}\n\npublic void combinationSum2(int[] candidates, int target,int index,List<Integer> lis) {\n    /*if (target<0) {\n            return;\n        }*/\n    if (target==0) {\n        res.add(new ArrayList(lis));\n        return;\n    }\n\n    for (int i=index;i<candidates.length;i++) {\n        //æ³¨æ„è¿™é‡Œi>index\n        if (i>index && candidates[i]==candidates[i-1]  ) continue;\n        //æ’è¿‡åºçš„,å¯ä»¥ç›´æ¥return\n        if (target-candidates[i]<0) return;\n        lis.add(candidates[i]);\n        combinationSum2(candidates,target-candidates[i],i+1,lis);\n        lis.remove(lis.size()-1);\n    }\n}\n```\nå›æº¯å…¶å®å€¼å¾—æ³¨æ„çš„å°±é‚£å‡ ä¸ªç‚¹ï¼Œå¾ªç¯çš„èµ·ç‚¹ï¼Œä¸‹æ¬¡é€’å½’çš„èµ·ç‚¹ï¼Œå›æº¯ï¼Œå‡ºå£ï¼Œè¿™å‡ ä¸ªç‚¹éƒ½ææ¸…æ¥šäº†å…¶å®å°±å¾ˆç®€å•äº†ï¼Œå…³é”®çš„åœ°æ–¹å°±æ˜¯å¦‚ä½•å»é‡\n\nè¿™é¢˜å¦‚æœå‚ç…§ä¸Šé¢[å…¨æ’åˆ—2](## 47. å…¨æ’åˆ— II) çš„ç¬¬ä¸€ç§HashSetçš„å»é‡æ–¹å¼çš„è¯ï¼Œæ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼ŒHashSetçš„å»é‡æ–¹å¼åªèƒ½ä¿è¯**æ¯ä¸€æ¬¡å¾ªç¯ä¸­ä¸ä¼šæœ‰é‡å¤çš„å…ƒç´ è¢«é€‰å–**ï¼Œä½†æ˜¯è¿™é¢˜å³ä½¿å¾ªç¯ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ è¢«é€‰å–ï¼Œç»“æœä»ç„¶ä¼šæœ‰é‡å¤\n\næ¯”å¦‚ `10,1,2,7,6,1,5` éå†1çš„æ—¶å€™ä¼šå¾—åˆ°`1 2 5`ï¼Œåç»­éå†2çš„æ—¶å€™åˆä¼šå¾—åˆ°ä¸€ä¸ª `2 1 5` ï¼Œä½†æ˜¯å…¶å®åœ¨ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™å°±**å·²ç»æ‰¾åˆ°äº†æ‰€æœ‰åŒ…å«1çš„è§£ï¼Œåé¢å¾ªç¯ä¸­åŒ…å«1çš„è§£å…¶å®éƒ½é‡å¤äº†**ï¼Œå¦‚æœæˆ‘ä»¬æ’åºåå°±å˜ä¸º `1 1 2 5 6 7 10` æŠŠç›¸åŒçš„å…ƒç´ èšé›†åˆ°ä¸€èµ·ï¼Œä¸€æ–¹é¢å¯ä»¥å»é‡ï¼Œå¦ä¸€æ–¹é¢è¿˜å¯ä»¥å‰ªæï¼Œåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™å°±å·²ç»æ‰¾åˆ°äº†æ‰€æœ‰çš„ å¸¦æœ‰1çš„è§£ï¼Œåé¢çš„è¿ç€çš„1éƒ½å¯ä»¥è·³è¿‡äº†ï¼Œåç»­å°±ä¸ä¼šå†æœ‰åŒ…å«1çš„è§£äº†ï¼Œå¦‚æœä¸æ’åºï¼Œåé¢ä»ç„¶ä¼šæœ‰åŒ…å«1çš„è§£\n\n## [216. ç»„åˆæ€»å’Œ III](https://leetcode-cn.com/problems/combination-sum-iii/)\n\næ‰¾å‡ºæ‰€æœ‰ç›¸åŠ ä¹‹å’Œä¸º n çš„ k ä¸ªæ•°çš„ç»„åˆã€‚ç»„åˆä¸­åªå…è®¸å«æœ‰ 1 - 9 çš„æ­£æ•´æ•°ï¼Œå¹¶ä¸”æ¯ç§ç»„åˆä¸­ä¸å­˜åœ¨é‡å¤çš„æ•°å­—ã€‚\n\n**è¯´æ˜ï¼š**\n\n- æ‰€æœ‰æ•°å­—éƒ½æ˜¯æ­£æ•´æ•°ã€‚\n- è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ \n\n**ç¤ºä¾‹ 1:**\n```java\nè¾“å…¥: k = 3, n = 7\nè¾“å‡º: [[1,2,4]]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: k = 3, n = 9\nè¾“å‡º: [[1,2,6], [1,3,5], [2,3,4]]\n```\n\n**è§£æ³•ä¸€**\n\næ„Ÿè§‰æ¯”ä¸Šé¢ä¸¤é¢˜è¿˜ç®€å•ä¸€ç‚¹ï¼Œå¯ä»¥ç›´æ¥å‰ªæ\n\n```golang\n//UPDATE: 2020.9.11\nfunc combinationSum3(k int, n int) [][]int {\n    var res [][]int\n    var dfs func(idx int, sum int, lis []int)\n    dfs = func(idx int, sum int, lis []int) {\n        if len(lis) > k {\n            return\n        }\n        if sum == n && len(lis) == k {\n            dest := make([]int, len(lis))\n            copy(dest, lis)\n            res = append(res, dest)\n            return\n        }\n        for i := idx; i <= 9; i++ {\n            if sum + i > n {\n                return\n            }\n            dfs(i+1, sum+i, append(lis, i))\n        }\n    }\n    dfs(1, 0, []int{})\n    return res\n}\n```\n\n**è§£æ³•äºŒï¼ˆUPDATEï¼š2020.9.11ï¼‰**\n\nå­¦äº†ä¸‹äºŒè¿›åˆ¶æšä¸¾å­é›†çš„æ–¹æ³•ï¼Œå¾ˆç®€æ´\n```golang\nfunc combinationSum3(k int, n int) [][]int {\n    var res [][]int\n    for i := 0; i < (1<<9); i++ {\n        var sum, cnt = 0, 0\n        var lis []int\n        for j := 0; j < 9; j++ {\n            if i & (1<<j) != 0 {\n                sum += j+1\n                cnt++\n                lis = append(lis, j+1)\n            }\n        }\n        if sum == n && cnt == k {\n            res = append(res, lis)   \n        }\n    }\n    return res\n}\n```\n\n## [78. å­é›†](https://leetcode-cn.com/problems/subsets/)\n\nç»™å®šä¸€ç»„**ä¸å«é‡å¤å…ƒç´ **çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚\n\n**è¯´æ˜ï¼š**è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: nums = [1,2,3]\nè¾“å‡º:\n[\n  [3],\n  [1],\n  [2],\n  [1,2,3],\n  [1,3],\n  [2,3],\n  [1,2],\n  []\n]\n```\n\n**è§£æ³•ä¸€**\n\n```java\nprivate List<List<Integer>> res=new ArrayList<>();\n\npublic List<List<Integer>> subsets(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return res;\n    }\n    subsets(nums,0,new ArrayList());\n    return res;\n}\n\npublic void subsets(int[] nums,int index,List<Integer> lis) {\n    //if (index<=nums.length) {\n        res.add(new ArrayList(lis));\n    //}\n    for (int i=index; i<nums.length;i++) {\n        lis.add(nums[i]);\n        subsets(nums,i+1,lis);\n        lis.remove(lis.size()-1);\n    }\n}\n```\nç®€å•çš„å›æº¯ï¼Œæ³¨æ„æ”¶é›†ç»“æœçš„æ—¶æœºå°±è¡Œ\n\n**Update: 2020.6.20**\n\nå¢åŠ ä¸€ä¸ªgoçš„å†™æ³•\n```golang\nfunc subsets(nums []int) [][]int {\n    var res [][]int\n    var lis []int\n    var dfs func(index int)\n    dfs = func(index int){\n        dest:=make([]int,len(lis))\n        copy(dest,lis)\n        res=append(res,dest)\n        for i:=index;i<len(nums);i++{\n            lis=append(lis,nums[i])\n            dfs(i+1)\n            lis=lis[:len(lis)-1]\n        }\n    }\n    dfs(0)\n    return res\n}\n```\n\n**è§£æ³•äºŒ**\n\nBFSï¼Œç±»ä¼¼äºäºŒå‰æ ‘å±‚æ¬¡éå†ï¼Œé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„listï¼Œåé¢æ¯æ¬¡è¿­ä»£éƒ½å°†listä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å–å‡ºæ¥åŠ ä¸Šå½“å‰å…ƒç´ ï¼Œå†é‡æ–°åŠ å…¥åˆ°listä¸­\n\n```java\npublic List<List<Integer>> subsets(int[] nums) {\n    List<List<Integer>> queue=new ArrayList<>();\n    if (nums==null || nums.length<=0) {\n        return queue;\n    }\n    queue.add(new ArrayList());\n    for (int i=0;i<nums.length;i++) {\n        int next=queue.size();\n        for (int j=0;j<next;j++) {\n            List<Integer> temp=new ArrayList(queue.get(j));\n            temp.add(nums[i]);\n            queue.add(temp);\n        }\n    }\n    return queue;\n}\n```\n**è§£æ³•ä¸‰ï¼ˆUPDATE: 2020.9.11ï¼‰**\n\näºŒè¿›åˆ¶æšä¸¾å­é›†\n```golang\nfunc subsets(nums []int) [][]int {\n    var n = len(nums)\n    var res [][]int\n    for i := 0; i < (1<<n); i++ {\n        var lis []int\n        for j := 0; j < n; j++ {\n            if i & (1<<j) != 0 {\n                lis = append(lis, nums[j])\n            }\n        }\n        res = append(res, lis)\n    }\n    return res\n}\n```\n## [90. å­é›† II](https://leetcode-cn.com/problems/subsets-ii/)\n\nç»™å®šä¸€ä¸ª**å¯èƒ½åŒ…å«é‡å¤å…ƒç´ **çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚\n\n**è¯´æ˜ï¼š**è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [1,2,2]\nè¾“å‡º:\n[\n  [2],\n  [1],\n  [1,2,2],\n  [2,2],\n  [1,2],\n  []\n]\n```\n\n**è§£æ³•ä¸€**\n\nå’Œ40é¢˜å¾ˆç±»ä¼¼ï¼Œä¸»è¦å°±æ˜¯è¿™ä¸ªå»é‡çš„æ“ä½œï¼Œæ¯”å¦‚é¢˜ç›®ç»™çš„caseï¼Œ`[1,2,2]` å·²ç»æœ‰åºäº†ï¼Œåœ¨é€‰æ‹©ç¬¬ä¸€ä¸ª2çš„æ—¶å€™å…¶å®å°±å·²ç»å°†æ‰€æœ‰åŒ…å«2çš„å­é›†éƒ½æ±‚å‡ºæ¥äº†ï¼Œåé¢çš„2å°±å¯ä»¥ç›´æ¥è·³è¿‡ï¼Œå½“ç„¶è¿™é‡Œ1ï¼Œ2ï¼Œ2æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œè¯•æƒ³å¦‚æœæ˜¯`2,1,2` éå†ç¬¬ä¸€ä¸ª2ä¼šå°†æ‰€æœ‰åŒ…å«2çš„å­é›†æ±‚å‡ºæ¥ï¼Œä½†æ˜¯éå†åˆ°1çš„æ—¶å€™ä¼šå°†ç¬¬ä¸‰ä¸ª2åŒ…å«è¿›æ¥ï¼Œä¹Ÿå°±æ˜¯`1ï¼Œ2` è¿™ä¸ªè§£ï¼Œä½†æ˜¯å‰é¢å·²ç»æ±‚å‡ºäº†`[2,1]` è¿™å°±é‡å¤äº†ï¼Œæ’åºå°±æ˜¯ä¸ºäº†å°†ç›¸åŒçš„å…ƒç´ èšåˆåˆ°ä¸€èµ·ï¼Œè¿™æ ·é‡åˆ°ç›¸åŒçš„å…ƒç´ å°±è·³è¿‡ï¼Œåé¢çš„å…ƒç´ å°±ä¸ä¼šå†åŒ…å«å·²ç»éå†è¿‡çš„å…ƒç´ äº†\n\n```java\npublic List<List<Integer>> subsetsWithDup(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return res;\n    }\n    //éœ€è¦å…ˆæ’åºï¼Œä¾¿äºè·³è¿‡ç›¸åŒçš„å…ƒç´ \n    Arrays.sort(nums);\n    subsets(nums,0,new ArrayList());\n    return res;\n}\n\nprivate  List<List<Integer>> res=new ArrayList<>();\n\npublic void subsets(int[] nums,int index,List<Integer> lis) {\n    res.add(new ArrayList(lis));\n    for (int i=index;i<nums.length;i++) {\n        if (i>index && nums[i] == nums[i-1]) {\n            continue;\n        }\n        lis.add(nums[i]);\n        subsets(nums,i+1,lis);\n        lis.remove(lis.size()-1);\n    }\n}\n```\n\n**Update: 2020.6.20**\n\nç”¨goé‡å†™äº†ä¸€éï¼Œå¤ä¹ ä¸‹\n```golang\nfunc subsetsWithDup(nums []int) [][]int {\n    sort.Ints(nums)\n    var res [][]int\n    var lis []int\n    var dfs func(index int)\n    dfs = func(index int){\n        dest:=make([]int,len(lis))\n        copy(dest,lis)\n        res=append(res,dest)\n        for i:=index;i<len(nums);i++{\n            if i>index && nums[i]==nums[i-1]{\n                continue\n            }\n            lis=append(lis,nums[i])\n            dfs(i+1)\n            lis=lis[:len(lis)-1]\n        }\n    }\n    dfs(0)\n    return res\n}\n```\n\n## [357. è®¡ç®—å„ä¸ªä½æ•°ä¸åŒçš„æ•°å­—ä¸ªæ•°](https://leetcode-cn.com/problems/count-numbers-with-unique-digits/)\n\nç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° nï¼Œè®¡ç®—å„ä½æ•°å­—éƒ½ä¸åŒçš„æ•°å­— x çš„ä¸ªæ•°ï¼Œå…¶ä¸­ 0 â‰¤ x < 10n ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: 2\nè¾“å‡º: 91 \nè§£é‡Š: ç­”æ¡ˆåº”ä¸ºé™¤å» 11,22,33,44,55,66,77,88,99 å¤–ï¼Œåœ¨ [0,100) åŒºé—´å†…çš„æ‰€æœ‰æ•°å­—ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n> è¿™é‡Œè¦å­˜ä¸ªç–‘é—®ï¼Œè¿™é‡Œçš„å›æº¯è®°å¿†åŒ–åº”è¯¥æ˜¯é”™çš„ï¼Œå¯èƒ½æ˜¯æ•°æ®å¤ªå°‘äº†ï¼Œæ²¡æµ‹è¯•å‡ºæ¥ï¼Œä½†æ˜¯å±…ç„¶çœŸçš„æé«˜äº†æ•ˆç‡ã€‚ã€‚ã€‚ã€‚è¿™å°±å¾ˆè¯¡å¼‚\n\n```java\n//è¿™ç§å¯ä»¥åšè®°å¿†åŒ–,0ms\nInteger[] cache=null;\n\npublic int countNumbersWithUniqueDigits2(int n) {\n    boolean[] visit=new boolean[10];\n    cache=new Integer[n+1];\n    int res=0;\n    if (n==0) return 1;\n    for (int i=1;i<=9;i++) { //ä¸è€ƒè™‘0å¼€å¤´çš„\n        visit[i]=true;\n        res+=countNumbersWithUniqueDigits2(n,visit,1);\n        visit[i]=false;\n    }\n    return res+1; //åŠ çš„æ˜¯0è¿™ç§æƒ…å†µ\n}\n\n//[index,n](ä½æ•°)åŒºé—´å†…,èƒ½æ„æˆæœ€å¤šçš„ä¸é‡å¤æ•°å­—\npublic int countNumbersWithUniqueDigits2(int n,boolean[] visit,int index){\n    if (index==n) { //æ²¡å¾—é€‰,åªæœ‰ä¸€ç§\n        return 1;\n    }\n    if (cache[index]!=null) {\n        return cache[index];\n    }\n    int count=1;\n    for (int i=0;i<=9;i++) {\n        if (!visit[i]) {\n            visit[i]=true;\n            count+=countNumbersWithUniqueDigits2(n,visit,index+1);\n            visit[i]=false;\n        }\n    }\n    return cache[index]=count;\n}\n```\næˆ‘éƒ½ä¸å¥½æ„æ€æ”¾åˆ°å›æº¯ä¸“é¢˜ä¸­ï¼Œå¼€å§‹å†™äº†ä¸ªè´¼è„‘æ®‹çš„å›æº¯451msï¼Œå®åœ¨ä¸å¥½æ„æ€æ”¾ä¸Šæ¥\n\n**è§£æ³•äºŒ**\n\n```java\n//æ•°å­¦æ–¹æ³•(åˆä¸­æ•°å­¦)\npublic int countNumbersWithUniqueDigits3(int n){\n    if (n==0) return 1;\n    if (n>10) return 0;\n    int res=10,count=9; //i=1çš„æƒ…å†µ\n    for (int i=2;i<=n;i++) {\n        count*=(11-i); //9*9*8*7*6*5.....\n        res+=count;\n    }\n    return res;\n}\n```\nè¯´å®è¯ï¼Œè¿™ç§æ–¹æ³•æˆ‘ä¸€å¼€å§‹å†™ç¬¬ä¸€ç§å¾ˆè„‘æ®‹çš„å›æº¯çš„æ—¶å€™æ¨å‡ºæ¥äº†çš„ï¼Œä½†æ˜¯æˆ‘å±…ç„¶æ²¡æ„è¯†åˆ°ã€‚ã€‚ã€‚ã€‚\n\n## 89. æ ¼é›·ç¼–ç \n\næ ¼é›·ç¼–ç æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—ç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œä¸¤ä¸ªè¿ç»­çš„æ•°å€¼ä»…æœ‰ä¸€ä¸ªä½æ•°çš„å·®å¼‚ã€‚\n\nç»™å®šä¸€ä¸ªä»£è¡¨ç¼–ç æ€»ä½æ•°çš„éè´Ÿæ•´æ•° nï¼Œæ‰“å°å…¶æ ¼é›·ç¼–ç åºåˆ—ã€‚æ ¼é›·ç¼–ç åºåˆ—å¿…é¡»ä»¥ 0 å¼€å¤´ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 2\nè¾“å‡º: [0,1,3,2]\nè§£é‡Š:\n00 - 0\n01 - 1\n11 - 3\n10 - 2\n\nå¯¹äºç»™å®šçš„ nï¼Œå…¶æ ¼é›·ç¼–ç åºåˆ—å¹¶ä¸å”¯ä¸€ã€‚\nä¾‹å¦‚ï¼Œ[0,2,3,1] ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ ¼é›·ç¼–ç åºåˆ—ã€‚\n\n00 - 0\n10 - 2\n11 - 3\n01 - 1\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 0\nè¾“å‡º: [0]\nè§£é‡Š: æˆ‘ä»¬å®šä¹‰æ ¼é›·ç¼–ç åºåˆ—å¿…é¡»ä»¥ 0 å¼€å¤´ã€‚\n     ç»™å®šç¼–ç æ€»ä½æ•°ä¸º n çš„æ ¼é›·ç¼–ç åºåˆ—ï¼Œå…¶é•¿åº¦ä¸º 2nã€‚å½“ n = 0 æ—¶ï¼Œé•¿åº¦ä¸º 20 = 1ã€‚\n     å› æ­¤ï¼Œå½“ n = 0 æ—¶ï¼Œå…¶æ ¼é›·ç¼–ç åºåˆ—ä¸º [0]ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nåˆä¸€ä¸ªè„‘æ®‹åšæ³•ã€‚ã€‚ã€‚\n\n```java\npublic List<Integer> grayCode3(int n) {\n    List<Integer> res=new ArrayList<>();\n    res.add(0);\n    int max=(1<<n)-1; //æ³¨æ„ä¼˜å…ˆçº§\n    boolean[] visit=new boolean[max+1];\n    grayCode3(max,res,visit);\n    return res;\n}\n\npublic boolean grayCode3(int max,List<Integer> lis,boolean[] visit) {\n    if (lis.size()>max) { // list.size()==max+1 eg. when max=3 the list.size()=4\n        return true;\n    }\n    int last=lis.get(lis.size()-1);\n    for (int i=1;i<=max;i++) {\n        if (!visit[i] && Integer.bitCount(i^last)==1) {\n            lis.add(i);\n            visit[i]=true;\n            if(grayCode3(max,lis,visit)){\n                return true;\n            }\n            lis.remove(lis.size()-1);\n            visit[i]=false;\n        }\n    }\n    return false;\n}\n```\n\n**è§£æ³•äºŒ**\n\næ­£å¸¸çš„å›æº¯ï¼Œæ¯æ¬¡ä¿®æ”¹ä¸€ä½ï¼Œ**ç›´æ¥ç”Ÿæˆä¸‹ä¸€ä¸ªå¯èƒ½çš„æ ¼é›·ç **ï¼Œè€Œä¸æ˜¯å‘ä¸Šé¢ä¸€æ ·ä¸€ä¸ªä¸ªéå†ã€‚ã€‚ã€‚\n\n```java\n//å¸¸è§„å›æº¯\npublic List<Integer> grayCode2(int n) {\n    List<Integer> res=new ArrayList<>();\n    boolean[] visit=new boolean[1<<n];\n    res.add(0);\n    visit[0]=true;\n    grayCode2(n,res,visit,0);\n    return res;\n}\n\npublic boolean grayCode2(int n,List<Integer> lis,boolean[] visit,int last) {\n    if (lis.size()>=(1<<n)) { // list.size()==max+1 eg. when max=3 the list.size()=4\n        return true;\n    }\n    for (int i=0;i<n;i++) {\n        //ç›´æ¥ç”Ÿæˆä¸‹ä¸€ä¸ª\n        int next=last^(1<<i); //è¿™ä¸€æ­¥å…¶å®å°±æ˜¯ä»åå¾€å‰,ä¾æ¬¡æ”¹å˜lastä¸€ä½\n        if (!visit[next]) {\n            lis.add(next);\n            visit[next]=true;\n            if(grayCode2(n,lis,visit,next)){\n                return true;\n            }\n            lis.remove(lis.size()-1);\n            visit[next]=false;\n        }\n    }\n    return false;\n}\n```\n**è§£æ³•ä¸‰**\n\nä¸åœçš„å’Œè‡ªå·±å³ç§»ä¸€ä½çš„å€¼åšå¼‚æˆ–ï¼Œæœ€ç»ˆå°±å¯ä»¥çš„åˆ°å®Œæ•´çš„æ ¼é›·ç ï¼Œè‡³äºåŸç†å¹¶ä¸æƒ³å»ç ”ç©¶ğŸ˜‚ï¼Œå…ˆè®°ä½å†è¯´\n\n```java\n//æœ€ä¼˜è§£,è§„å¾‹\npublic List<Integer> grayCode(int n) {\n    List<Integer> res=new ArrayList<>();\n    for (int i=0;i<1<<n;i++) {\n        res.add(i^(i>>1));\n    }\n    return res;\n}\n```\nçœ‹äº†è¯„è®ºåŒºå‘ç°è¿˜æœ‰ä¸ªè§„å¾‹ï¼Œæ¯ä¸€å±‚çš„æ ¼é›·ç éƒ½æ˜¯ä¸Šä¸€å±‚å‰é¢åŠ 0 å’Œé€†åºä¸Šä¸€å±‚åœ¨å‰é¢åŠ 1ï¼Œæ„Ÿè§‰å¯èƒ½å’Œä¸Šé¢çš„è§„å¾‹æ˜¯ä¸€æ ·çš„ï¼Œä¸€å›¾ä»¥è”½ä¹‹\n\n![leetCodeé¢˜è§£](http://static.imlgw.top/blog/20191219/7rzdkpDvA4IN.png?imageslim)\n\n## [526. ä¼˜ç¾çš„æ’åˆ—](https://leetcode-cn.com/problems/beautiful-arrangement/)\n\nå‡è®¾æœ‰ä» 1 åˆ° N çš„ N ä¸ªæ•´æ•°ï¼Œå¦‚æœä»è¿™ N ä¸ªæ•°å­—ä¸­æˆåŠŸæ„é€ å‡ºä¸€ä¸ªæ•°ç»„ï¼Œä½¿å¾—æ•°ç»„çš„ç¬¬ i ä½ (1 <= i <= N) æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸ªæ•°ç»„ä¸ºä¸€ä¸ªä¼˜ç¾çš„æ’åˆ—ã€‚æ¡ä»¶ï¼š\n\n1. ç¬¬ i ä½çš„æ•°å­—èƒ½è¢« i æ•´é™¤\n2. i èƒ½è¢«ç¬¬ i ä½ä¸Šçš„æ•°å­—æ•´é™¤\n\nç°åœ¨ç»™å®šä¸€ä¸ªæ•´æ•° Nï¼Œè¯·é—®å¯ä»¥æ„é€ å¤šå°‘ä¸ªä¼˜ç¾çš„æ’åˆ—ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\nå›æº¯æ³•\n\n```java\npublic int countArrangement(int N) {\n    boolean[] visit=new boolean[N+1];\n    return countArrangement(N,visit,1);\n}\n\npublic int countArrangement(int N,boolean[] visit,int index) {\n    if (index > N) {\n        return 1;\n    }\n    int res=0;\n    for (int i=1;i<=N;i++) {\n        if (!visit[i] && (index%i==0 || i%index==0)) {\n            visit[i]=true;\n            res+=countArrangement(N,visit,index+1);\n            visit[i]=false;\n        }\n    }\n    return res;\n}\n```\n\nå…¶å®æˆ‘æ˜¯æƒ³æ”¹æˆè®°å¿†åŒ–é€’å½’çš„ï¼Œä¸ç„¶æˆ‘ä¹Ÿä¸ä¼šè¿™æ ·å†™ï¼Œä½†æ˜¯åé¢æ”¹çš„æ—¶å€™å±…ç„¶å‡ºäº†bugï¼Œè¿™ä¹Ÿç®—æ˜¯æ‰“é†’äº†æˆ‘ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºè¿™æ ·çš„å›æº¯éƒ½èƒ½æ”¹æˆè®°å¿†åŒ–é€’å½’ã€‚ã€‚ã€‚è¿™é‡Œå¾ˆæ˜æ˜¾æ— æ³•åšè®°å¿†åŒ–ï¼Œå› ä¸ºä½ æ¯æ¬¡å›æº¯çš„æ—¶å€™indexç›¸åŒï¼Œä½†æ˜¯visitæ•°ç»„çš„çŠ¶æ€æ˜¯ä¸ä¸€æ ·çš„ï¼Œç›´æ¥è®°å¿†åŒ–è‚¯å®šå°±é”™äº†ã€‚ã€‚ã€‚ä½†æ˜¯è¯´åˆ°è¿™é‡Œæˆ‘å‘ç°ä¸Šé¢çš„ [357.å„ä¸ªä½æ•°ä¸åŒæ•°å­—ä¸ªæ•°](##) å±…ç„¶è¿™æ ·è¿‡äº†ï¼Œå¹¶ä¸”è¿˜çœŸçš„æé«˜äº†æ•ˆç‡ã€‚ã€‚ã€‚ã€‚\n\n## [784. å­—æ¯å¤§å°å†™å…¨æ’åˆ—](https://leetcode-cn.com/problems/letter-case-permutation/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²Sï¼Œé€šè¿‡å°†å­—ç¬¦ä¸²Sä¸­çš„æ¯ä¸ªå­—æ¯è½¬å˜å¤§å°å†™ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚è¿”å›æ‰€æœ‰å¯èƒ½å¾—åˆ°çš„å­—ç¬¦ä¸²é›†åˆã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: S = \"a1b2\"\nè¾“å‡º: [\"a1b2\", \"a1B2\", \"A1b2\", \"A1B2\"]\n\nè¾“å…¥: S = \"3z4\"\nè¾“å‡º: [\"3z4\", \"3Z4\"]\n\nè¾“å…¥: S = \"12345\"\nè¾“å‡º: [\"12345\"]\n```\n\n**æ³¨æ„ï¼š**\n\n- S çš„é•¿åº¦ä¸è¶…è¿‡12ã€‚\n- S ä»…ç”±æ•°å­—å’Œå­—æ¯ç»„æˆã€‚ \n\n**è§£æ³•ä¸€**\n\nä¸€çœ‹æ˜¯ç®€å•é¢˜ï¼Œå±é¢ å±é¢ å°±å¼€å§‹æï¼Œç»“æœå‘ç°æ²¡æƒ³è±¡ä¸­ç®€å•ï¼ˆä¸»è¦æ˜¯æˆ‘å¤ªèœäº†ï¼‰\n\n```java\nprivate List<String> res=new ArrayList<>();\n\npublic List<String> letterCasePermutation(String S) {\n    letterCasePermutation(S,0,new StringBuilder(S));\n    return res;\n}\n\npublic void letterCasePermutation(String S,int index,StringBuilder cur) {\n    res.add(cur.toString()); //å˜åŒ–ä¸€æ¬¡å°±æ·»åŠ ä¸€æ¬¡\n    for (int i=index;i<S.length();i++) {\n        char c=S.charAt(i);\n        if (c>='0' && c<='9') {\n            continue;\n        }\n        cur.replace(i,i+1,letterCase(c));\n        letterCasePermutation(S,i+1,cur);\n        cur.replace(i,i+1,letterCase(cur.charAt(i))); //çŠ¶æ€é‡ç½®\n    }\n}\n\n//è¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼šc^(1<<5)å°±å¯ä»¥ä½¿å¤§å†™å˜å°å†™,å°å†™å˜å¤§å†™\npublic String letterCase(char c){\n    if (c>='a' && c<='z') { //65:A 97:a\n        c-=32;\n    }else if (c>='A' && c<='Z') {\n        c+=32;\n    }\n    return c+\"\";\n}\n```\nè¿™é‡Œçš„çŠ¶æ€é‡ç½®å’Œä¹‹å‰çš„ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡æ•´ä½“è¿˜æ˜¯å¾ˆå¥½æƒ³çš„ï¼Œå…¶å®ä¹Ÿå¯ä»¥å®Œå…¨ä¸ç”¨å¾ªç¯çš„å½¢å¼\n\n## [1079. æ´»å­—å°åˆ·](https://leetcode-cn.com/problems/letter-tile-possibilities/)\n\nä½ æœ‰ä¸€å¥—æ´»å­—å­—æ¨¡ tilesï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¨¡ä¸Šéƒ½åˆ»æœ‰ä¸€ä¸ªå­—æ¯ tiles[i]ã€‚è¿”å›ä½ å¯ä»¥å°å‡ºçš„éç©ºå­—æ¯åºåˆ—çš„æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š\"AAB\"\nè¾“å‡ºï¼š8\nè§£é‡Šï¼šå¯èƒ½çš„åºåˆ—ä¸º \"A\", \"B\", \"AA\", \"AB\", \"BA\", \"AAB\", \"ABA\", \"BAA\"ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š\"AAABBC\"\nè¾“å‡ºï¼š188\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= tiles.length <= 7`\n2. `tiles` ç”±å¤§å†™è‹±æ–‡å­—æ¯ç»„æˆ\n\n**è§£æ³•ä¸€**\n\nè¿™é“é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œæœ‰ç‚¹ç»“åˆå…¨æ’åˆ—å’Œå­é›†çš„æ„æ€ï¼Œ\n\n```java\npublic int numTilePossibilities(String tiles) {\n    boolean[] visit=new boolean[tiles.length()];\n    char[] cs=tiles.toCharArray();\n    Arrays.sort(cs);\n    numTilePossibilities(cs,visit);\n    return count;\n}\n\nint count=-1;\n\n//æ’åºå»é‡\npublic void numTilePossibilities(char[]cs,boolean[] visit) {\n    count++;\n    for (int i=0;i<cs.length;i++) {\n        //æƒ³æ¸…æ¥šè¿™é‡Œä¸ºå•¥å¿…é¡»æ˜¯!visit[i-1]\n        if(i>0 && cs[i]==cs[i-1] && !visit[i-1]){ \n            continue;\n        }\n        if (!visit[i]) {\n            visit[i]=true;\n            numTilePossibilities(cs,visit);\n            visit[i]=false;\n        }\n    }\n}\n```\nè¿™é¢˜æ”¶è·æ¯”è¾ƒå¤§ï¼Œå¯¹æ’åˆ—ç»„åˆç±»å‹çš„é¢˜ç›®åˆå¤šäº†ä¸€å±‚ç†è§£ï¼ŒåŒæ—¶ä¹Ÿçº æ­£äº†ä¹‹å‰çš„é”™è¯¯è§‚ç‚¹\n\n### Bugè­¦å‘Šï¼ï¼ï¼\n\nçœ‹ä¸€ä¸‹æœ€å¼€å§‹å†™çš„é”™è¯¯è§£æ³•ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±åœ¨è¿™ä¸ª`!visit[i-1]`ä¸Šï¼\n\n```java\n if (i>0 && cs[i]==cs[i-1] && visit[i-1])\n```\n\nè¿™é‡Œæˆ‘ä¹‹å‰ä¸€ç›´ç†è§£æˆäº†ä¿ç•™ç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸Šä¸€ä¸ªå…ƒç´ å·²ç»è®¿é—®è¿‡äº†ï¼Œåé¢å°±ç›´æ¥è·³è¿‡ï¼Œåšäº†è¿™ä¸€é¢˜å†™å‡ºé—®é¢˜äº†æ‰çŸ¥é“åŸæ¥è¿™é‡Œå®Œå…¨ç†è§£åäº†ğŸ˜‚ï¼Œå½“æ—¶æ²¡æœ‰ä»”ç»†æƒ³ï¼Œå…¶å®è¿™é‡Œç»†æƒ³ä¸€ä¸‹å°±å¾ˆå®¹æ˜“å‘ç°é—®é¢˜ï¼Œvisitæ•°ç»„å…¶å®ä¿è¯çš„æ˜¯å½“å‰è¿™ä¸€æ¡**è‡ªä¸Šè€Œä¸‹çš„çºµå‘åˆ†æ”¯å†…ä¸ä¼šæœ‰é‡å¤ä½ç½®çš„å…ƒç´ è¢«é€‰å–**ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬**è¦ç¡®ä¿çš„å…¶å®æ˜¯æ¨ªå‘çš„ä¸é‡å¤ï¼Œä¹Ÿå°±æ˜¯åŒä¸€å±‚å†…ä¸é‡å¤**ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨`visit[i-1]` å…¶å®ä»è¯­ä¹‰ä¸Šæ¥è¯´å°±æ˜¯æœ‰é—®é¢˜çš„ï¼Œç”»ä¸ªå›¾æ¥è¯´æ˜ä¸‹ä¸ºå•¥ä¼šæœ‰é—®é¢˜\n\n![mark](http://static.imlgw.top/blog/20200625/HekOxo1dFTYw.png?imageslim)\n\nç”»ä¸ªé€’å½’æ ‘ï¼Œç„¶åæ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå…¶å®å°±æ˜ç™½äº†ï¼Œä½¿ç”¨`visit[i-1]`çš„æ–¹å¼ï¼Œç”Ÿæˆçš„ç¬¬ä¸€ä¸ªåˆ†æ”¯å…¶å®å°±ä¸å®Œæ•´äº†ï¼Œåªæœ‰åé¢çš„ç¬¬äºŒä¸ªåˆ†æ”¯æ‰ä¼šæ˜¯å®Œæ•´çš„ï¼Œæ‰€ä»¥**å¯ä»¥ç†è§£ä¸ºä¿ç•™æœ€åä¸€ä¸ªåˆ†æ”¯ï¼Œå°†å‰é¢çš„åˆ†æ”¯å‰ªæ‰**ï¼Œåœ¨å…¨æ’åˆ—ä¸­å› ä¸ºæœ‰é•¿åº¦é™åˆ¶ï¼Œç¬¬ä¸€ä¸ªåˆ†æ”¯å¹¶æ²¡æœ‰è¾¾åˆ°ç»™å®šçš„é•¿åº¦ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šåŠ å…¥ç»“æœé›†ï¼Œå¯¹ç»“æœæ²¡æœ‰å½±å“ï¼Œï¼ˆå…¶å®æ˜¯ä¼šå½±å“æ•ˆç‡çš„ï¼Œä¼šé‡å¤çš„éå†åˆ†æ”¯ï¼Œè¿™ä¸ªæ‰“å°ä¸€ä¸‹ç”Ÿæˆå…¨æ’åˆ—è¿‡ç¨‹çš„ç»“æœé›†å°±èƒ½çœ‹å‡ºæ¥ï¼‰\n\nä½†æ˜¯åœ¨è¿™ä¸€é¢˜ï¼Œå¹¶æ²¡æœ‰é•¿åº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥countä¼šå°†ç¬¬ä¸€ä¸ªä¸å®Œæ•´çš„åˆ†æ”¯ä¹Ÿå½“ä½œç»“æœé›†ç®—è¿›å»ï¼Œè€Œåé¢ç¬¬äºŒä¸ªåˆ†æ”¯çš„æ—¶å€™ï¼ˆå®Œæ•´åˆ†æ”¯ï¼‰åˆä¼šè®¡ç®—ä¸€éï¼Œç»“æœå°±é”™äº†\n\n**é‚£ä¸ºä»€ä¹ˆ`!visit[i-1]` å°±å¯ä»¥å‘¢ï¼Ÿ**\n\nå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œvisitè™½ç„¶ä¿è¯çš„æ˜¯çºµå‘çš„ä¸é‡å¤ï¼Œä½†æ˜¯æ¯éå†å®Œä¸€ä¸ªåˆ†æ”¯åï¼Œéƒ½ä¼šå›æº¯çŠ¶æ€ï¼Œè€Œæˆ‘ä»¬åˆæ˜¯**æŒ‰ç…§é¡ºåºæ¥éå†å…ƒç´ **çš„ï¼Œæ‰€ä»¥å¦‚æœä¸Šä¸€ä¸ªå…ƒç´ çš„ visit[i]æ˜¯falseï¼Œé‚£å°±è¯´æ˜ä¸Šä¸€ä¸ªå…ƒç´ çš„åˆ†æ”¯å·²ç»éå†å®Œäº†ï¼ä»¥å®ƒå¼€å¤´çš„æ‰€æœ‰æ’åˆ—éƒ½æ‰¾å®Œäº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ç„¶åè·³è¿‡ï¼Œæ‰æ˜¯çœŸæ­£çš„ä¿ç•™äº†ç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼åé¢çš„ç›´æ¥è·³è¿‡ï¼Œå‡å°‘äº†å¤šä½™çš„æ“ä½œï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå‡ºç°bugï¼Œæ‰€ä»¥ä½ æ˜ç™½ä»¥åè¦ç”¨é‚£ä¸ªäº†å§ğŸ˜‰\n\n## [1291. é¡ºæ¬¡æ•°](https://leetcode-cn.com/problems/sequential-digits/)\n\næˆ‘ä»¬å®šä¹‰ã€Œé¡ºæ¬¡æ•°ã€ä¸ºï¼šæ¯ä¸€ä½ä¸Šçš„æ•°å­—éƒ½æ¯”å‰ä¸€ä½ä¸Šçš„æ•°å­—å¤§ 1 çš„æ•´æ•°ã€‚\n\nè¯·ä½ è¿”å›ç”± [low, high] èŒƒå›´å†…æ‰€æœ‰é¡ºæ¬¡æ•°ç»„æˆçš„ æœ‰åº åˆ—è¡¨ï¼ˆä»å°åˆ°å¤§æ’åºï¼‰ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å‡ºï¼šlow = 100, high = 300\nè¾“å‡ºï¼š[123,234]\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å‡ºï¼šlow = 1000, high = 13000\nè¾“å‡ºï¼š[1234,2345,3456,4567,5678,6789,12345]\n```\n\n**æç¤ºï¼š**\n\n- 10 <= low <= high <= 10^9 \n\n**è§£æ³•ä¸€**\n\nå›æº¯tagä¸‹çš„ï¼ŒæŸä¸€æ¬¡å‘¨èµ›çš„é¢˜ï¼Œæˆ‘å†™çš„å·²ç»ä¸åƒå›æº¯äº†ï¼Œå°¾é€’å½’ï¼Œæœ‰ç‚¹é¸¡è‚‹\n\n```java\npublic List<Integer> sequentialDigits(int low, int high) {\n    String slow=String.valueOf(low);\n    int slen=slow.length();\n    int first=Integer.valueOf(slow.charAt(0))-'0'-1;\n    List<Integer> res=new ArrayList<>();\n    int start=first,len=slen;\n    if(first+len>9){\n        start=0;\n        len++;\n    }\n    sequentialDigits(low,high,start,len,res);\n    return res;\n}\n\nprivate String str=\"123456789\";\n\npublic void sequentialDigits(int low,int high,int start,int len,List<Integer> list) {\n    if(start+len>9) return;\n    int cur=Integer.valueOf(str.substring(start,start+len));\n    if(cur>high){\n        return;\n    }\n    if(cur>=low){\n        list.add(cur);\n    }\n    if(start+len==9){\n        sequentialDigits(low,high,0,len+1,list);    \n    }else{\n        sequentialDigits(low,high,start+1,len,list);\n    }\n}\n```\n\nå…¶å®ç›´æ¥æš´åŠ›æšä¸¾`1~9`çš„æ‰€æœ‰é¡ºåºç»„åˆç„¶ååˆ¤æ–­åœ¨ä¸åœ¨`low~high` ä¹‹é—´å°±okäº†ï¼Œæœ€å†æ’ä¸ªåºå°±okï¼Œä¸€å…±ä¹Ÿåªæœ‰36ä¸ªï¼Œä¸ªäººæ„Ÿè§‰æˆ‘ä¸Šé¢çš„è¿˜æ˜¯æ¯”å•çº¯çš„æš´åŠ›ä¼šå¥½ä¸€ç‚¹ï¼Œé¦–å…ˆä¸ç”¨æ’åºï¼Œå…¶æ¬¡ä¹Ÿä¸ä¼šä»å¤´å¼€å§‹éå†ï¼Œä¼šæ ¹æ®lowçš„å€¼æ¥é€‰å–ä»å“ªé‡Œå¼€å§‹æˆªå–ï¼Œä½†æ˜¯è¿™é¢˜æ•°æ®é‡æœ‰é™ï¼Œä½“ç°ä¸å‡ºæ¥å·®å¼‚\n\n## [22. æ‹¬å·ç”Ÿæˆ](https://leetcode-cn.com/problems/generate-parentheses/)\n\nç»™å‡º n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ å†™å‡ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸”æœ‰æ•ˆçš„æ‹¬å·ç»„åˆã€‚\n\nä¾‹å¦‚ï¼Œç»™å‡º `n = 3`ï¼Œç”Ÿæˆç»“æœä¸ºï¼š\n\n```java\n[\n  \"((()))\",\n  \"(()())\",\n  \"(())()\",\n  \"()(())\",\n  \"()()()\"\n]\n```\n\n**è§£æ³•ä¸€**\n\nå“ï¼ŒçŸ¥é“æ˜¯å›æº¯è¿˜æ˜¯æ²¡åšå‡ºæ¥ï¼Œè¿˜æ˜¯å¤ªèœäº†å•Š\n\n```java\npublic List<String> generateParenthesis(int n) {\n    dfs(n,\"\",0,0);\n    return res;\n}\n\nprivate List<String> res=new LinkedList<>();\n\npublic void dfs(int n,String sb,int left,int right) {\n    if (left>n /*|| right>n*/ || right>left) {\n        return;\n    }\n    if (left==n && right ==n) {\n        res.add(sb.toString());   \n        return;\n    }\n    dfs(n,sb+\"(\",left+1,right);\n    dfs(n,sb+\")\",left,right+1);\n}\n```\nå…³é”®è¿˜æ˜¯æ²¡æƒ³æ˜ç™½è¿™é¢˜çš„é€’å½’æ¡ä»¶ï¼Œæˆ‘çŸ¥é“æ˜¯å…ˆç”Ÿæˆ \"(â€œ å†ç”Ÿæˆ \")\" ä½†æ˜¯ç»ˆæ­¢æ¡ä»¶ä¸€ç›´æ²¡æƒ³æ¸…æ¥šï¼Œå…¶å®æˆ‘ä»¬éœ€è¦ç»™å·¦å³æ‹¬å·åŠ ä¸€ä¸ªè®¡æ•°å™¨`leftå’Œright`ï¼Œç”¨æ¥è®°å½•å·²ç»ç”Ÿæˆçš„å·¦å³æ‹¬å·çš„æ•°é‡ï¼Œç„¶åæˆ‘ä»¬æ€è€ƒç»ˆæ­¢æ¡ä»¶æ˜¯å•¥ï¼Œé¦–å…ˆå¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯å·¦å³æ‹¬å·æ•°é‡ `left==right` çš„æ—¶å€™ï¼Œè¿™æ˜¯åˆæ³•çš„ç»ˆæ­¢æ¡ä»¶ï¼Œä½†æ˜¯è¿™æ ·å°±å¤Ÿäº†ä¹ˆï¼Ÿå¾ˆæ˜æ˜¾ä¸å¤Ÿï¼Œ`()))((` ç±»ä¼¼è¿™æ ·çš„å°±å¹¶ä¸æ˜¯åˆæ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¿è¯ç”Ÿæˆæ‹¬å·çš„åˆæ³•æ€§ï¼Œæ‰€ä»¥è¿™ç§æ—¶å€™è‹¥æ˜¯ä¸å¤ªæ¸…æ¥šçš„å°±å¯ä»¥æ¥ç”»ä¸€ç”»é€’å½’æ ‘\n\n![mark](http://static.imlgw.top/blog/20191024/9uvjEQzjtKtf.png?imageslim)\n\nå›¾ç”»çš„æ¯”è¾ƒé­”æ€§ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆå®¹æ˜“çœ‹æ‡‚çš„ï¼Œé€šè¿‡è¿™ä¸ªé€’å½’æ ‘æˆ‘è¿˜å‘ç°äº†ä¸Šé¢ä»£ç çš„ä¸€ç‚¹å°é—®é¢˜ï¼Œ`right>n` æ˜¯ä¸ªå†—ä½™æ¡ä»¶ï¼Œåˆæ³•æ¡ä»¶ `right< left < n`ï¼Œrightè‚¯å®šä¸ä¼šè¶…è¿‡nï¼Œæ­£å¦‚ä¸Šé¢ä¸‰ä¸ªç”» âŒçš„åœ°æ–¹å°±æ˜¯å¯¹åº”çš„ä¸‰ä¸ªä¸åˆæ³•çš„ç»ˆæ­¢æ¡ä»¶ï¼Œæœ‰äº†è¿™ä¸ªå°±å¯ä»¥å¾ˆå®¹æ˜“çš„å†™å‡ºå›æº¯ä»£ç ï¼Œä¸‹é¢çš„æ˜¯ç”¨çš„`StringBuilder`çš„ï¼Œéœ€è¦å›æº¯å­—ç¬¦ä¸²ï¼Œæ›´ç¬¦åˆå›æº¯çš„æ€æƒ³ï¼Œä¸Šé¢çš„Stringæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‰‹åŠ¨å›æº¯\n\n```java\npublic List<String> generateParenthesis(int n) {\n    dfs(n,new StringBuilder(),0,0);\n    return res;\n}\n\nprivate List<String> res=new LinkedList<>();\n\npublic void dfs(int n,StringBuilder sb,int left,int right) {\n    if (left>n || right>n || right>left) {\n        return;\n    }\n    if (left==n && right ==n) {\n        res.add(sb.toString());\n        return;\n    }\n    dfs(n,sb.append(\"(\"),left+1,right);\n    sb.delete(sb.length()-1,sb.length());\n    dfs(n,sb.append(\")\"),left,right+1);\n    sb.delete(sb.length()-1,sb.length());\n}\n```\n\n## [306. ç´¯åŠ æ•°](https://leetcode-cn.com/problems/additive-number/)\n\nç´¯åŠ æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»„æˆå®ƒçš„æ•°å­—å¯ä»¥å½¢æˆç´¯åŠ åºåˆ—ã€‚\n\nä¸€ä¸ªæœ‰æ•ˆçš„ç´¯åŠ åºåˆ—å¿…é¡»**è‡³å°‘**åŒ…å« 3 ä¸ªæ•°ã€‚é™¤äº†æœ€å¼€å§‹çš„ä¸¤ä¸ªæ•°ä»¥å¤–ï¼Œå­—ç¬¦ä¸²ä¸­çš„å…¶ä»–æ•°éƒ½ç­‰äºå®ƒä¹‹å‰ä¸¤ä¸ªæ•°ç›¸åŠ çš„å’Œã€‚\n\nç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­— `'0'-'9'` çš„å­—ç¬¦ä¸²ï¼Œç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ç»™å®šè¾“å…¥æ˜¯å¦æ˜¯ç´¯åŠ æ•°ã€‚\n\n**è¯´æ˜:** ç´¯åŠ åºåˆ—é‡Œçš„æ•°ä¸ä¼šä»¥ 0 å¼€å¤´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° `1, 2, 03` æˆ–è€… `1, 02, 3` çš„æƒ…å†µã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"112358\"\nè¾“å‡º: true \nè§£é‡Š: ç´¯åŠ åºåˆ—ä¸º: 1, 1, 2, 3, 5, 8 ã€‚1 + 1 = 2, 1 + 2 = 3, 2 + 3 = 5, 3 + 5 = 8\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"199100199\"\nè¾“å‡º: true \nè§£é‡Š: ç´¯åŠ åºåˆ—ä¸º: 1, 99, 100, 199ã€‚1 + 99 = 100, 99 + 100 = 199\n```\n\n**è¿›é˜¶:**\n\n- ä½ å¦‚ä½•å¤„ç†ä¸€ä¸ªæº¢å‡ºçš„è¿‡å¤§çš„æ•´æ•°è¾“å…¥?\n\n**è§£æ³•ä¸€**\n\nåœ¨å›æº¯ä¸“é¢˜é‡Œç¿»åˆ°çš„ï¼Œè¯´å®è¯ï¼Œcaseæœ‰ç‚¹æ¶å¿ƒ\n\n```java\npublic boolean isAdditiveNumber(String num) {\n    LinkedList<String> list=new LinkedList<>();\n    list.add(\"-1\");\n    list.add(\"-1\");\n    return dfs(num,0,list);\n}\n\npublic boolean dfs(String num,int index,List<String> list) {\n    //System.out.println(list);\n    if (index==num.length() && list.size()>4) {\n        return true;\n    }\n    for(int i=index+1;i<=num.length();i++){\n        //0å¼€å¤´åº”è¯¥ç›´æ¥break,é™¤éæ˜¯å•ç‹¬çš„0....\n        if (num.charAt(index)=='0' && i>index+1) { //\"101\" .....\n            break;\n        }\n        //å‰ªæ\n        if (i-index>num.length()/2) {\n            return false;\n        }\n        String sub=num.substring(index,i);\n        String a=list.get(list.size()-1);\n        String b=list.get(list.size()-2);\n        list.add(sub);\n        if ((\"-1\".equals(a)||\"-1\".equals(b) || addTwoStr(a,b).equals(sub)) && dfs(num,i,list)) {\n            return true;\n        }\n        list.remove(list.size()-1);\n    }\n    return false;\n}\n\n//å¤§æ•°ç›¸åŠ \nprivate String addTwoStr(String a,String b){\n    StringBuilder res=new StringBuilder();\n    int aIdx=a.length()-1;\n    int bIdx=b.length()-1;\n    int temp=0; //è¿›ä½\n    while(aIdx>=0 || bIdx>=0) {\n        int as=aIdx>=0?a.charAt(aIdx)-48:0;\n        int bs=bIdx>=0?b.charAt(bIdx)-48:0;\n        int sum=as+bs+temp;\n        temp=(sum)/10;\n        res.append(sum%10);\n        aIdx--;bIdx--;\n    }\n    if (temp==1) {\n        res.append(1);\n    }\n    return res.reverse().toString();\n}\n```\n\nå›æº¯ä¸éš¾æƒ³åˆ°ï¼Œè¿™ä¸€ç±»å›æº¯å’‹è¯´å‘¢ï¼Œå±äº â€œä¸€é•œåˆ°åº•â€ çš„é‚£ç§ï¼Œå¯ä»¥çœ‹çœ‹è§£æ•°ç‹¬çš„å“ªä¸ªè§£æ³•ï¼Œä¹Ÿæ˜¯è¿™æ ·çš„ï¼ˆå…¶å®å°±æ˜¯å‚è€ƒçš„é‚£ä¸ªï¼‰å¸¦ä¸€ä¸ªbooleanè¿”å›å€¼ï¼Œèµ°åˆ°ç»“å°¾èµ°ä¸é€šæ‰ä¼šå›æº¯ï¼ŒNçš‡åè¿™ç§å°±ä¸å¤ªä¸€æ ·ï¼Œä¸ç®¡æ˜¯å¦æˆåŠŸéƒ½ä¼šå›æº¯ï¼Œåæ­£ç›®å‰å¤§è‡´çš„æ„Ÿè§‰å°±æ˜¯è¿™æ ·ï¼Œåé¢é‡åˆ°æ›´å¤šé¢˜å‹å†æ¥æ€»ç»“\n\nä¸è¿‡æ„Ÿè§‰è¿™é¢˜çš„å…³é”®ä¸æ˜¯å›æº¯ï¼Œè€Œæ˜¯è¾¹ç•Œçš„å¤„ç†ï¼Œé¦–å…ˆæ˜¯æº¢å‡ºçš„é—®é¢˜ï¼Œæˆ‘çœ‹è§æœ‰è¿›é˜¶çš„å°±æ²¡è€ƒè™‘æº¢å‡ºï¼Œç»“æœè¿˜æ˜¯æº¢å‡ºäº†ï¼Œè€Œä¸”æº¢å‡ºäº†ä¸¤æ¬¡ï¼ï¼ï¼æœ€åæ²¡åŠæ³•ï¼Œä¹Ÿä¸æƒ³ç”¨`BigInteger`å°±è‡ªå·±å†™äº†å¤§æ•°ç›¸åŠ çš„é€»è¾‘\n\né™¤äº†æº¢å‡ºçš„é—®é¢˜ï¼Œè¿™é¢˜éœ€è¦æ³¨æ„ `0 ` åœ¨è¿™ä¸ª`0` ä¸Šä¹ŸWAäº†ä¸€å‘ï¼Œå› ä¸ºå›æº¯è¿˜æ˜¯åœ¨åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¦‚æœæœ‰0çš„è¯å°±ä¸èƒ½éšä¾¿çš„åˆ†å‰²äº†ï¼Œå…·ä½“çœ‹ä»£ç å°±æ‡‚äº†\n\n## [842. å°†æ•°ç»„æ‹†åˆ†æˆæ–æ³¢é‚£å¥‘åºåˆ—](https://leetcode-cn.com/problems/split-array-into-fibonacci-sequence/)\n\nç»™å®šä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸² Sï¼Œæ¯”å¦‚ S = \"123456579\"ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒåˆ†æˆæ–æ³¢é‚£å¥‘å¼çš„åºåˆ— [123, 456, 579]ã€‚\n\nå½¢å¼ä¸Šï¼Œæ–æ³¢é‚£å¥‘å¼åºåˆ—æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°åˆ—è¡¨ Fï¼Œä¸”æ»¡è¶³ï¼š\n\n- 0 <= F[i] <= 2^31 - 1ï¼Œï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ•´æ•°éƒ½ç¬¦åˆ 32 ä½æœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼‰ï¼›\n- F.length >= 3ï¼›\n- å¯¹äºæ‰€æœ‰çš„0 <= i < F.length - 2ï¼Œéƒ½æœ‰ `F[i] + F[i+1] = F[i+2]` æˆç«‹ã€‚\n\nå¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œå°†å­—ç¬¦ä¸²æ‹†åˆ†æˆå°å—æ—¶ï¼Œæ¯ä¸ªå—çš„æ•°å­—ä¸€å®šä¸è¦ä»¥é›¶å¼€å¤´ï¼Œé™¤éè¿™ä¸ªå—æ˜¯æ•°å­— 0 æœ¬èº«ã€‚\n\nè¿”å›ä» S æ‹†åˆ†å‡ºæ¥çš„æ‰€æœ‰æ–æ³¢é‚£å¥‘å¼çš„åºåˆ—å—ï¼Œå¦‚æœä¸èƒ½æ‹†åˆ†åˆ™è¿”å› `[]`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š\"123456579\"\nè¾“å‡ºï¼š[123,456,579]\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: \"11235813\"\nè¾“å‡º: [1,1,2,3,5,8,13]\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```jsvs\nè¾“å…¥: \"112358130\"\nè¾“å‡º: []\nè§£é‡Š: è¿™é¡¹ä»»åŠ¡æ— æ³•å®Œæˆã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼š\"0123\"\nè¾“å‡ºï¼š[]\nè§£é‡Šï¼šæ¯ä¸ªå—çš„æ•°å­—ä¸èƒ½ä»¥é›¶å¼€å¤´ï¼Œå› æ­¤ \"01\"ï¼Œ\"2\"ï¼Œ\"3\" ä¸æ˜¯æœ‰æ•ˆç­”æ¡ˆã€‚\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥: \"1101111\"\nè¾“å‡º: [110, 1, 111]\nè§£é‡Š: è¾“å‡º [11,0,11,11] ä¹ŸåŒæ ·è¢«æ¥å—ã€‚\n```\n\n\n**æç¤ºï¼š**\n\n- `1 <= S.length <= 200`\n- å­—ç¬¦ä¸² S ä¸­åªå«æœ‰æ•°å­—ã€‚\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢é‚£é¢˜ä¸€æ ·ï¼Œä½†æ˜¯è¿™é¢˜ä¼šç®€å•ä¸€ç‚¹ï¼Œä¸ç”¨å¤„ç†å¤§æ•°ç›¸åŠ çš„æƒ…å†µï¼ŒåŒæ—¶é™å®šäº†æ•°å­—çš„èŒƒå›´å°±æ˜¯32ä½intï¼Œæ‰€ä»¥åªè¦èŒƒå›´è¶…è¿‡äº†int32å°±ç›´æ¥break\n\n```java\npublic List<Integer> splitIntoFibonacci(String S) {\n    LinkedList<Integer> res=new LinkedList<>();\n    dfs(S,0,res);\n    return res;\n}\n\npublic boolean dfs(String S,int index,List<Integer> lis){\n    if (index == S.length()) {\n        return lis.size()>2;\n    }\n    for (int i=index+1;i<=S.length();i++) {\n        String temp=S.substring(index,i);\n        //é•¿åº¦å¤§äº10,æˆ–è€…Longè§£æå‡ºæ¥å¤§äºINT_MAXäº†å°±ç›´æ¥break\n        if (S.charAt(index) == '0' && i>index+1 || temp.length()>10 || Long.valueOf(temp)>Integer.MAX_VALUE) {\n            break;\n        }\n        int str=Integer.valueOf(temp);\n        int one=lis.size()>=2 ? lis.get(lis.size()-1):-1;\n        int two=lis.size()>=2 ? lis.get(lis.size()-2):-1;\n        lis.add(str);\n        if ((one==-1 || two==-1 || one+two==str) && dfs(S,i,lis)) {\n            return true;\n        }\n        lis.remove(lis.size()-1);\n    }\n    return false;\n}\n```\n\n## [139. å•è¯æ‹†åˆ†](https://leetcode-cn.com/problems/word-break/)\n\nç»™å®šä¸€ä¸ªéç©ºå­—ç¬¦ä¸² s å’Œä¸€ä¸ªåŒ…å«éç©ºå•è¯åˆ—è¡¨çš„å­—å…¸ wordDictï¼Œåˆ¤å®š s æ˜¯å¦å¯ä»¥è¢«ç©ºæ ¼æ‹†åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåœ¨å­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚\n\n**è¯´æ˜ï¼š**\n\n- æ‹†åˆ†æ—¶å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚\n- ä½ å¯ä»¥å‡è®¾å­—å…¸ä¸­æ²¡æœ‰é‡å¤çš„å•è¯ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: s = \"leetcode\", wordDict = [\"leet\", \"code\"]\nè¾“å‡º: true\nè§£é‡Š: è¿”å› true å› ä¸º \"leetcode\" å¯ä»¥è¢«æ‹†åˆ†æˆ \"leet code\"ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: s = \"applepenapple\", wordDict = [\"apple\", \"pen\"]\nè¾“å‡º: true\nè§£é‡Š: è¿”å› true å› ä¸º \"applepenapple\" å¯ä»¥è¢«æ‹†åˆ†æˆ \"apple pen apple\"ã€‚\n     æ³¨æ„ä½ å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥: s = \"catsandog\", wordDict = [\"cats\", \"dog\", \"sand\", \"and\", \"cat\"]\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\nå›æº¯DFS+è®°å¿†åŒ–\n\n```java\nBoolean[] cache=null;\n\npublic boolean wordBreak(String s, List<String> wordDict) {\n    if (s==null || s.length()<=0) {\n        return false;\n    }\n    cache=new Boolean[s.length()];\n    HashSet<String> set=new HashSet<>(wordDict);\n    return dfs(s,set,0);\n}\n\n//åˆ¤æ–­ã€index,s.lenã€‘ä¸­çš„å­—ç¬¦æ˜¯å¦èƒ½æ‹†åˆ†\npublic boolean dfs(String s, HashSet<String> dict,int index) {\n    //è¿™é‡Œçš„ç»ˆæ­¢æ¡ä»¶è¿˜æ˜¯æœ‰ç‚¹è¿·æƒ‘çš„,è¿™é‡Œindexåªæœ‰åœ¨å­—å…¸ä¸­å­˜åœ¨å½“å‰å…ƒç´ çš„æ—¶å€™æ‰ä¼šå‘åç§»åŠ¨\n    //æ‰€ä»¥å½“indexç§»åŠ¨åˆ°s==lengthçš„æ˜¯å¶å°±è¯´æ˜å‰é¢çš„å•è¯éƒ½åŒ¹é…ä¸Šäº†\n    if (index==s.length()) {\n        return true;\n    }\n    if (cache[index]!=null) {\n        return cache[index];\n    }\n    for (int i=index+1;i<=s.length();i++) {\n        //System.out.println(s.substring(index,i));\n        if (dict.contains(s.substring(index,i)) && dfs(s,dict,i)){\n            return cache[index]=true;\n        }\n    }\n    return cache[index]=false;\n}\n```\n\nå¾ˆä¹…ä¹‹å‰åšçš„é¢˜ç›®ï¼Œåœ¨åšè¿™é¢˜è¿›é˜¶ç‰ˆçš„æ—¶å€™å‘ç°è¿™ä¸€é¢˜åšäº†ä½†æ˜¯æ²¡æœ‰è®°å½•ã€‚ã€‚ã€‚å¯èƒ½æ˜¯å¿˜äº†\n\nè¿™é‡Œå›æº¯è®°å¿†åŒ–æ²¡å•¥å¥½è¯´çš„ï¼Œä¹Ÿæ˜¯å±äºé‚£ç§ â€œä¸€é•œåˆ°åº•â€ ç±»å‹çš„\n\n**è§£æ³•äºŒ**\n\nBFS\n\n```java\n//BFS,éœ€è¦ä¸€ä¸ªvisitä¿è¯ä¸ä¼šé‡å¤è®¿é—®\npublic boolean wordBreak(String s, List<String> wordDict) {\n    if (s==null || s.length()<=0) {\n        return false;\n    }\n    HashSet<String> dict=new HashSet<>(wordDict);\n    //queueä¸­å­˜index\n    LinkedList<Integer> queue=new LinkedList<>();\n    boolean[] visit=new boolean[s.length()];\n    queue.add(0);\n    while(!queue.isEmpty()){\n        int index=queue.poll();\n        if (!visit[index]) {\n            for (int i=index+1;i<=s.length();i++) {\n                if(dict.contains(s.substring(index,i))){\n                    if (i==s.length()) {\n                        return true;\n                    }\n                    queue.add(i);\n                }\n            }\n            visit[index]=true;\n        }\n    }\n    return false;\n}\n```\n\nè‡ªå·±å†™çš„å±…ç„¶ä¸€ç‚¹å°è±¡éƒ½æ²¡æœ‰ï¼ŒBFSæ„Ÿè§‰ä¹Ÿæ²¡å•¥å¥½è¯´çš„\n\n**è§£æ³•ä¸‰**\n\nåŠ¨æ€è§„åˆ’ï¼Œè¿™ä¸ªå½“æ—¶æ²¡æœ‰å†™å‡ºæ¥ï¼Œä»Šå¤©é‡æ–°çœ‹çš„æ—¶å€™å‘ç°æœ‰dpçš„tagå°±å†™äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯æŒºç®€å•çš„\n\n```java\npublic boolean wordBreak(String s, List<String> wordDict) {\n    if (s==null || s.length()<=0) {\n        return false;\n    }\n    HashSet<String> dict=new HashSet<>(wordDict);\n    boolean[] dp=new boolean[s.length()+1];\n    dp[0]=true;\n    for (int i=1;i<=s.length();i++) {\n        for (int j=0;j<=i;j++) {\n            if (dp[j] && dict.contains(s.substring(j,i))) {\n               dp[i]=true; //ç›¸æ¯”ä¸Šé¢çš„å¯ä»¥break\n               break;\n            }\n        }\n    }\n    return dp[s.length()];\n}\n```\n## [140. å•è¯æ‹†åˆ† II](https://leetcode-cn.com/problems/word-break-ii/)\n\nç»™å®šä¸€ä¸ª**éç©º**å­—ç¬¦ä¸² s å’Œä¸€ä¸ªåŒ…å«éç©ºå•è¯åˆ—è¡¨çš„å­—å…¸ wordDictï¼Œåœ¨å­—ç¬¦ä¸²ä¸­å¢åŠ ç©ºæ ¼æ¥æ„å»ºä¸€ä¸ªå¥å­ï¼Œä½¿å¾—å¥å­ä¸­æ‰€æœ‰çš„å•è¯éƒ½åœ¨è¯å…¸ä¸­ã€‚è¿”å›æ‰€æœ‰è¿™äº›å¯èƒ½çš„å¥å­ã€‚\n\n**è¯´æ˜ï¼š**\n\n- åˆ†éš”æ—¶å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚\n- ä½ å¯ä»¥å‡è®¾å­—å…¸ä¸­æ²¡æœ‰é‡å¤çš„å•è¯ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥:\ns = \"catsanddog\"\nwordDict = [\"cat\", \"cats\", \"and\", \"sand\", \"dog\"]\nè¾“å‡º:\n[\n  \"cats and dog\",\n  \"cat sand dog\"\n]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥:\ns = \"pineapplepenapple\"\nwordDict = [\"apple\", \"pen\", \"applepen\", \"pine\", \"pineapple\"]\nè¾“å‡º:\n[\n  \"pine apple pen apple\",\n  \"pineapple pen apple\",\n  \"pine applepen apple\"\n]\nè§£é‡Š: æ³¨æ„ä½ å¯ä»¥é‡å¤ä½¿ç”¨å­—å…¸ä¸­çš„å•è¯ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥:\ns = \"catsandog\"\nwordDict = [\"cats\", \"dog\", \"sand\", \"and\", \"cat\"]\nè¾“å‡º:\n[]\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜è¦æ±‚å‡ºæ‰€æœ‰çš„åºåˆ—ï¼Œæ‰€ä»¥dpè‚¯å®šæ˜¯ä¸å¥½æ•´äº†ï¼Œç›´æ¥ä¸Šå›æº¯\n\n```java\npublic List<String> wordBreak(String s, List<String> wordDict) {\n    HashSet<String> dict=new HashSet<>(wordDict);\n    dfs(s,0,\"\",dict);\n    return res;\n}\n\nprivate List<String> res=new ArrayList<>();\n\npublic void dfs(String s,int index,String word,HashSet<String> dict){\n    if (index==s.length()) {\n        res.add(word.substring(0,word.length()-1));\n        return;\n    }\n    for (int i=index+1;i<=s.length();i++) {\n        String str=s.substring(index,i);\n        if (dict.contains(str)) {\n            //word.append(str+\" \"); // app#pa# \n            dfs(s,i,word+str+\" \",dict);\n            //word.delete(word.length()-(i-),i);\n        }\n    }\n}\n```\n\nå¾ˆå¯æƒœï¼Œè¶…æ—¶äº†ï¼Œå¡åœ¨äº†aaaaaaaa....é‚£ä¸ªcaseä¸Šï¼Œç¿»äº†è¯„è®ºåŒºï¼Œå‘ç°å¾ˆå¤šäººå€Ÿç”¨äº†ä¸Šä¸€é¢˜çš„è§£æ³•ï¼Œå…ˆå¯¹æ•´ä¸ªsåšå¯è¡Œæ€§åˆ†æï¼Œä¹Ÿå°±æ˜¯çœ‹èƒ½ä¸èƒ½æ‹†åˆ†ï¼Œèƒ½æ‹†åˆ†ç„¶åå†è¿›è¡Œå›æº¯ï¼Œè¿™æ ·å°±åˆšå¥½è·³è¿‡äº†é‚£ä¸ªcaseï¼Œå¥½åƒç¡®å®æ˜¯å¯ä»¥è¿‡ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰æœ‰ç‚¹é¢å‘caseç¼–ç¨‹äº†ã€‚ã€‚ã€‚\n\n**è§£æ³•äºŒ**\n\nè®°å¿†åŒ–å›æº¯ï¼Œä¸Šé¢çš„è¿‡ç¨‹åˆ†æä¸€ä¸‹ä¼šå‘ç°å…¶å®æœ‰å¾ˆå¤šçš„é‡å¤è®¡ç®—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰é’ˆå¯¹æ€§çš„åšè®°å¿†åŒ–ï¼ŒåŠ å¿«æœç´¢é€Ÿåº¦\n\n```java\n//åšè®°å¿†åŒ–\nHashMap<String,List<String>> cache=new HashMap<>();\n\npublic List<String> wordBreak(String s, List<String> wordDict) {\n    HashSet<String> dict=new HashSet<>(wordDict);\n    return dfs(s,dict);\n}\n\npublic List<String> dfs(String s,HashSet<String> dict){\n    if (cache.containsKey(s)) {\n        return cache.get(s);\n    }\n    List<String> res=new ArrayList<>();\n    if (s.length()==0) {\n        return res;\n    }\n    for (int i=0;i<=s.length();i++) {\n        String word=s.substring(0,i);\n        if (dict.contains(word)) {\n            if (i==s.length()) {\n                res.add(word);\n            }else{\n                //å‰©ä½™å­—ç¬¦\n                List<String> temp=dfs(s.substring(i,s.length()),dict);\n                for (String tmp:temp) {\n                    res.add(word+\" \"+tmp);\n                }\n            }\n        }\n    }\n    cache.put(s,res);\n    return res;\n}\n```\n\nå…¶å®æˆ‘è¿™é‡Œä¹Ÿæ˜¯å‚è€ƒäº†è¯„è®ºåŒºçš„è§£æ³•ï¼Œæˆ‘ä¸Šé¢çš„é‚£ç§å›æº¯çš„æ–¹å¼è¦æ”¹æˆè®°å¿†åŒ–æœ‰ç‚¹ä¸å¥½æï¼Œæœ‰ä¸¤ä¸ªå˜é‡ï¼Œå¦å¤–æˆ‘æ„Ÿè§‰è¿™ç§**å›æº¯åˆ†å‰²**çš„æ–¹å¼æ„Ÿè§‰æ›´åŠ çš„ç›´è§‚æ˜“æ‡‚ get\n\n**UPDATE: 2020.7.8**\n\nå¶ç„¶çœ‹åˆ°è¿™ä¸ªé¢˜ï¼Œé‡å†™äº†ä¸€ä¸‹ï¼Œç›´æ¥è®°å¿†åŒ–\n```golang\n//è®°å¿†åŒ–é€’å½’\nfunc wordBreak(s string, wordDict []string) []string {\n    var set = make(map[string]bool)\n    var cache = make(map[string][]string)\n    for i := 0; i < len(wordDict); i++ {\n        set[wordDict[i]] = true\n    }\n    return dfs(s, set, cache)\n}\n\nfunc dfs(s string, set map[string]bool, cache map[string][]string) []string {\n    if _, ok := cache[s]; ok {\n        return cache[s]\n    }\n    var res []string\n    for i := 1; i <= len(s); i++ {\n        if set[s[:i]] {\n            if i == len(s) {\n                res = append(res, s[:i])\n            } else {\n                temp := dfs(s[i:], set, cache)\n                for _, w := range temp {\n                    res = append(res, s[:i]+\" \"+w)\n                }\n            }\n        }\n    }\n    cache[s] = res\n    return res\n}\n\n```\n\n## [473. ç«æŸ´æ‹¼æ­£æ–¹å½¢](https://leetcode-cn.com/problems/matchsticks-to-square/)\n\nè¿˜è®°å¾—ç«¥è¯ã€Šå–ç«æŸ´çš„å°å¥³å­©ã€‹å—ï¼Ÿç°åœ¨ï¼Œä½ çŸ¥é“å°å¥³å­©æœ‰å¤šå°‘æ ¹ç«æŸ´ï¼Œè¯·æ‰¾å‡ºä¸€ç§èƒ½ä½¿ç”¨æ‰€æœ‰ç«æŸ´æ‹¼æˆä¸€ä¸ªæ­£æ–¹å½¢çš„æ–¹æ³•ã€‚ä¸èƒ½æŠ˜æ–­ç«æŸ´ï¼Œå¯ä»¥æŠŠç«æŸ´è¿æ¥èµ·æ¥ï¼Œå¹¶ä¸”æ¯æ ¹ç«æŸ´éƒ½è¦ç”¨åˆ°ã€‚\n\nè¾“å…¥ä¸ºå°å¥³å­©æ‹¥æœ‰ç«æŸ´çš„æ•°ç›®ï¼Œæ¯æ ¹ç«æŸ´ç”¨å…¶é•¿åº¦è¡¨ç¤ºã€‚è¾“å‡ºå³ä¸ºæ˜¯å¦èƒ½ç”¨æ‰€æœ‰çš„ç«æŸ´æ‹¼æˆæ­£æ–¹å½¢ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,1,2,2,2]\nè¾“å‡º: true\n\nè§£é‡Š: èƒ½æ‹¼æˆä¸€ä¸ªè¾¹é•¿ä¸º2çš„æ­£æ–¹å½¢ï¼Œæ¯è¾¹ä¸¤æ ¹ç«æŸ´ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [3,3,3,3,4]\nè¾“å‡º: false\n\nè§£é‡Š: ä¸èƒ½ç”¨æ‰€æœ‰ç«æŸ´æ‹¼æˆä¸€ä¸ªæ­£æ–¹å½¢ã€‚\n```\n\n**æ³¨æ„:**\n\n1. ç»™å®šçš„ç«æŸ´é•¿åº¦å’Œåœ¨ `0` åˆ° `10^9`ä¹‹é—´ã€‚\n2. ç«æŸ´æ•°ç»„çš„é•¿åº¦ä¸è¶…è¿‡15ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\n//ç­‰ä»·äºèƒ½å¦å°†numsåˆ†ä¸º4ç­‰åˆ†\npublic boolean makesquare(int[] nums) {\n    if(nums==null || nums.length<4){\n        return false;\n    }\n    int N=nums.length;\n    int sum=0;\n    for(int i=0;i<N;i++){\n        sum+=nums[i];\n    }\n    if(sum%4!=0) return false;\n    int[] side=new int[4];\n    Arrays.sort(nums);\n    return dfs(nums,N-1,side,sum/4);\n}\n\npublic boolean dfs(int[] nums,int index,int[] side,int avg){\n    if(index==-1){\n        return true;\n    }\n    for(int i=0;i<side.length;i++){\n        //if(side[i]+nums[index]<=avg){\n        int rest=avg-side[i]-nums[index];\n        if(rest==0 || rest>=nums[0]){ //æ”¹è¿›å‰ªææ–¹å¼\n            side[i]+=nums[index];\n            if(dfs(nums,index-1,side,avg)){\n                return true;\n            }\n            side[i]-=nums[index];\n        }\n    }\n    return false;\n}\n```\nä¸€å¼€å§‹æ²¡æƒ³åˆ°åˆ†æ¡¶çš„åšæ³•ï¼Œåªæƒ³ç€è¿™ä¹ˆæœç´¢4ç­‰åˆ†ï¼Œçœ‹äº†ä¸€çœ¼è¯„è®ºåŒºå°±æ˜ç™½äº†ï¼ŒæŠ½è±¡å‡º4æ¡è¾¹ï¼Œç„¶åéå†æ‰€æœ‰ç«æŸ´ï¼Œå°è¯•å°†ç«æŸ´æ”¾å…¥æ‰€æœ‰çš„ç›’å­ï¼Œçœ‹æœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½æ˜¯4ç­‰åˆ†çš„ï¼Œè¯´ç™½äº†å…¶å®å°±æ˜¯æš´åŠ›æœç´¢ï¼Œç„¶ååŠ ä¸Šä¸€ç‚¹å‰ªæä¼˜åŒ–ï¼Œè¿™é¢˜å°±ä¸ç»†è¯´äº†ï¼Œå…³é”®çœ‹ä¸‹é¢è¿™é¢˜\n\n## [698. åˆ’åˆ†ä¸ºkä¸ªç›¸ç­‰çš„å­é›†](https://leetcode-cn.com/problems/partition-to-k-equal-sum-subsets/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„  `nums` å’Œä¸€ä¸ªæ­£æ•´æ•° `k`ï¼Œæ‰¾å‡ºæ˜¯å¦æœ‰å¯èƒ½æŠŠè¿™ä¸ªæ•°ç»„åˆ†æˆ `k` ä¸ªéç©ºå­é›†ï¼Œå…¶æ€»å’Œéƒ½ç›¸ç­‰ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š nums = [4, 3, 2, 3, 5, 2, 1], k = 4\nè¾“å‡ºï¼š True\nè¯´æ˜ï¼š æœ‰å¯èƒ½å°†å…¶åˆ†æˆ 4 ä¸ªå­é›†ï¼ˆ5ï¼‰ï¼Œï¼ˆ1,4ï¼‰ï¼Œï¼ˆ2,3ï¼‰ï¼Œï¼ˆ2,3ï¼‰ç­‰äºæ€»å’Œã€‚\n```\n\n**æ³¨æ„:**\n\n- `1 <= k <= len(nums) <= 16`\n- `0 < nums[i] < 10000`\n\n**è§£æ³•ä¸€**\n\n[473. ç«æŸ´æ‹¼æ­£æ–¹å½¢](#473-ç«æŸ´æ‹¼æ­£æ–¹å½¢)å…¶å®åªæ˜¯è¿™é“é¢˜çš„ä¸€ä¸ªå­é—®é¢˜ï¼Œå…³é”®ææ‡‚è¿™é¢˜å°±è¡Œäº†\n\n```java\npublic boolean canPartitionKSubsets(int[] nums, int k) {\n    if(nums==null || nums.length<=0){\n        return false;\n    }\n    int sum=0;\n    for(int i=0;i<nums.length;i++){\n        sum+=nums[i];\n    }\n    if(sum%k!=0) return false;\n    Arrays.sort(nums);\n    return dfs(nums,nums.length-1,new int[k],sum);\n}\n\npublic boolean dfs(int[] nums,int index,int[] bucket,int sum){\n    //sum(bucket)==sum\n    //ifæ¡ä»¶: bucket[i]<=sum/bucket.len => bucket[i]<=sum(bucket)/bucket.len\n    //æ‰€ä»¥ä¸ç”¨å•ç‹¬å»åˆ¤æ–­æ˜¯å¦éƒ½ç›¸ç­‰,ç›´æ¥retuen true\n    if(index==-1){\n        return true;\n    }\n    for(int i=0;i<bucket.length;i++){\n        //æ™®é€šçš„å‰ªæ 60msï¼Œåªåˆ¤æ–­äº†æ˜¯å¦å°äºå¹³å‡å€¼\n        //if(bucket[i]+nums[index]<=sum/bucket.length){\n        //æ›´å¥½çš„å‰ªææ–¹å¼1msï¼Œåˆ¤æ–­å‰©ä½™ç©ºé—´ä¸ä¸º0çš„æ—¶å€™è¿˜èƒ½ä¸èƒ½å¡«å…¶ä»–å…ƒç´ \n        int rest=sum/bucket.length-bucket[i]-nums[index];\n        if(rest==0 || rest>=nums[0]){ //å°äºnums[0]å°±å•¥ä¹Ÿå¡«ä¸äº†äº†\n            bucket[i]+=nums[index];\n            if(dfs(nums,index-1,bucket,sum)){\n                return true;\n            }\n            bucket[i]-=nums[index];\n        }\n    }\n    return false;\n}\n```\n\nå…¶å®æ€»ä½“ä¸Šæ¥è¯´è¿˜æ˜¯æš´åŠ›çš„æœç´¢ï¼Œç„¶ååŠ ä¸Šä¸€äº›å‰ªæä¼˜åŒ–çš„æ‰‹æ®µï¼Œé¦–å…ˆèƒ½æƒ³åˆ°çš„æ˜¯**çº¦æŸæ¡¶å†…å…ƒç´ å’Œè¦å°äºç­‰äº`sum/k`**ï¼Œè¿™æ ·å°±èƒ½å‡å»å¾ˆå¤šæ— æ•ˆæœç´¢ï¼Œä½†æ˜¯ä»…ä»…è¿™æ ·è¿˜æ˜¯æ— æ³•ACè¿™é¢˜ï¼Œè¿˜æœ‰ä¸€æ­¥å¾ˆå…³é”®çš„ä¼˜åŒ–ç‚¹æ˜¯**æ’åº**ï¼Œæ’åºåæˆ‘ä»¬ä»å¤§å¾€å°æœç´¢ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆå°†å¤§çš„å…ƒç´ æ”¾å…¥æ¡¶ä¸­ï¼Œå°½å¿«æ»¡è¶³ifæ¡ä»¶ï¼Œç»è¿‡ä¸Šé¢çš„ä¼˜åŒ–å°±å¯ä»¥æˆåŠŸçš„ACäº†ï¼Œè€—æ—¶60mså·¦å³ï¼Œä½†æ˜¯çœ‹äº†è¯„è®ºåŒºçš„å¤§ä½¬çš„è§£æ³•åå‘ç°è¿˜æœ‰ä¸€ç§æ›´å¥½çš„å‰ªææ–¹å¼ï¼Œå°±æ˜¯è€ƒè™‘æ”¾ä¸‹å½“å‰å…ƒç´ åè¿˜èƒ½ä¸èƒ½æ”¾ä¸‹å…¶ä»–çš„å…ƒç´ ï¼Œå¦‚æœåˆšå¥½æ”¾ä¸‹å°±ç›´æ¥æ”¾ï¼Œå¦‚æœæ”¾ä¸‹åè¿˜æœ‰å‰©ä½™ç©ºé—´ï¼Œä¸”è¿™ä¸ªå‰©ä½™ç©ºé—´å¾ˆå°ï¼Œè¿`nums[0]`éƒ½æ”¾ä¸ä¸‹ï¼ˆå‰é¢æ’åºäº†ï¼‰é‚£ä¹ˆè¿™ç§æƒ…å†µä¹Ÿæ˜¯å¯ä»¥ç›´æ¥å‰ªæ‰çš„ï¼Œæ—¶é—´ä¼˜åŒ–åˆ°1ms\n\n> `index==-1`ä¸ºä»€ä¹ˆå°±ç›´æ¥è¿”å›trueäº†ï¼Ÿç®€å•æ¨ä¸€ä¸‹å°±è¡Œäº†\n>\n> é¦–å…ˆ`index==-1`è¯´æ˜æ‰€æœ‰å…ƒç´ éƒ½å·²ç»æ”¾å…¥`bucket`ä¸­äº†ï¼Œæ‰€ä»¥`sum(bucket)=sum(nums)`\n>\n> å†æ¥çœ‹æˆ‘ä»¬çš„ifæ¡ä»¶ï¼šçº¦æŸæ¡¶å†…å…ƒç´ å°äºç­‰äº`sum/k`ï¼Œä¹Ÿå°±æ˜¯`bucket[i]<=sum(nums)/k` å€ŸåŠ©ä¸Šé¢çš„ç»“è®ºï¼Œè½¬æ¢ä¸€ä¸‹å°±æ˜¯ `bucket[i]<=sum(bucket)/k`ä¹Ÿå°±æ˜¯`bucket[i]<=avg(bucket)`å¾ˆæ˜æ˜¾ï¼Œåªæœ‰åœ¨æ¯ä¸ªæ¡¶å†…å…ƒç´ éƒ½ç›¸ç­‰çš„æ—¶å€™æ‰æˆç«‹ï¼Œæ•…è¿™é‡Œå¯ä»¥ç›´æ¥è¿”å›true\n\n**è§£æ³•äºŒ**\n\nå®˜æ–¹æä¾›äº†ä¸€ä¸ªçŠ¶å‹çš„æ–¹æ³•ï¼Œä½†æ˜¯æ²¡çœ‹æ‡‚ï¼Œè‡ªå·±è¯•ç€å‹äº†ä¸‹æ²¡è¿‡ï¼Œæ‡’å¾—å»ç ”ç©¶äº†\n\n## [491. é€’å¢å­åºåˆ—](https://leetcode-cn.com/problems/increasing-subsequences/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªæ•´å‹æ•°ç»„, ä½ çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°æ‰€æœ‰è¯¥æ•°ç»„çš„é€’å¢å­åºåˆ—ï¼Œé€’å¢å­åºåˆ—çš„é•¿åº¦è‡³å°‘æ˜¯2ã€‚\n\n**ç¤ºä¾‹:**\n\n```\nè¾“å…¥: [4, 6, 7, 7]\nè¾“å‡º: [[4, 6], [4, 7], [4, 6, 7], [4, 6, 7, 7], [6, 7], [6, 7, 7], [7,7], [4,7,7]]\n```\n\n**è¯´æ˜:**\n\n1.  ç»™å®šæ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡15ã€‚\n2.  æ•°ç»„ä¸­çš„æ•´æ•°èŒƒå›´æ˜¯Â [-100,100]ã€‚\n3.  ç»™å®šæ•°ç»„ä¸­å¯èƒ½åŒ…å«é‡å¤æ•°å­—ï¼Œç›¸ç­‰çš„æ•°å­—åº”è¯¥è¢«è§†ä¸ºé€’å¢çš„ä¸€ç§æƒ…å†µã€‚\n\n**è§£æ³•ä¸€**\n\næ„Ÿè§‰ä»Šå¤©æ™šä¸ŠçŠ¶æ€ä¸å¤ªå¥½ï¼Œå¥½ä¹…æ²¡å†™å›æº¯äº†ï¼Œå†™äº†å‡ å‘æ€è·¯éƒ½æœ‰é—®é¢˜ï¼Œæœ€åç„äº†ä¸€çœ¼è¯„è®ºåŒºæ‰ååº”è¿‡æ¥ï¼Œå’Œä¸Šé¢[842-å°†æ•°ç»„æ‹†åˆ†æˆæ–æ³¢é‚£å¥‘åºåˆ—](#842-å°†æ•°ç»„æ‹†åˆ†æˆæ–æ³¢é‚£å¥‘åºåˆ—)å¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯åˆ©ç”¨lisæ•°ç»„ä¸Šæ¬¡å­˜å€¼åˆ¤æ–­ï¼Œå½“æ—¶è¿™é¢˜è¿˜æ˜¯æˆ‘ç‹¬ç«‹å†™å‡ºæ¥çš„ï¼Œå†™å®Œå‘çš„codeè¯„è®ºè¿˜æ˜¯ä¸ªçƒ­è¯„ï¼Œä»Šå¤©å†™è¿™é¢˜å±…ç„¶æ²¡ååº”è¿‡æ¥ï¼Œå¤ªèœäº†ğŸ˜¥\n```golang\nfunc findSubsequences(nums []int) [][]int {\n Â  Â var n = len(nums)\n Â  Â var res [][]int\n Â  Â var dfs func(int, []int)\n Â  Â dfs = func(index int, lis []int){\n Â  Â  Â  Â if len(lis) >= 2{\n Â  Â  Â  Â  Â  Â dest := make([]int, len(lis))\n Â  Â  Â  Â  Â  Â copy(dest, lis)\n Â  Â  Â  Â  Â  Â res = append(res, dest)\n Â  Â  Â   }\n Â  Â  Â  Â //ä¿è¯ä¸€æ¬¡forå¾ªç¯ä¸­æ²¡æœ‰é‡å¤çš„å°±è¡Œäº†ï¼Œæ ¹æ®å–å€¼èŒƒå›´åšä¸‹åç§»\n Â  Â  Â  Â var visit = make([]bool, 201)\n Â  Â  Â  Â for i := index; i < n; i++{\n Â  Â  Â  Â  Â  Â if !visit[nums[i]+100] && (len(lis) == 0 || nums[i] >= lis[len(lis)-1]) {\n Â  Â  Â  Â  Â  Â  Â  Â visit[nums[i]+100] = true\n Â  Â  Â  Â  Â  Â  Â  Â lis = append(lis, nums[i])\n Â  Â  Â  Â  Â  Â  Â  Â dfs(i+1, lis)\n Â  Â  Â  Â  Â  Â  Â  Â lis = lis[:len(lis)-1]\n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â   }\n Â  Â dfs(0, make([]int, 0))\n Â  Â return res\n}\n```\n\n## [679. 24 ç‚¹æ¸¸æˆ](https://leetcode-cn.com/problems/24-game/)\n\nDifficulty: **å›°éš¾**\n\n\nä½ æœ‰ 4 å¼ å†™æœ‰ 1 åˆ° 9 æ•°å­—çš„ç‰Œã€‚ä½ éœ€è¦åˆ¤æ–­æ˜¯å¦èƒ½é€šè¿‡Â `*`ï¼Œ`/`ï¼Œ`+`ï¼Œ`-`ï¼Œ`(`ï¼Œ`)`Â çš„è¿ç®—å¾—åˆ° 24ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: [4, 1, 8, 7]\nè¾“å‡º: True\nè§£é‡Š: (8-4) * (7-1) = 24\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥: [1, 2, 1, 2]\nè¾“å‡º: False\n```\n\n**æ³¨æ„:**\n\n1.  é™¤æ³•è¿ç®—ç¬¦Â `/`Â è¡¨ç¤ºå®æ•°é™¤æ³•ï¼Œè€Œä¸æ˜¯æ•´æ•°é™¤æ³•ã€‚ä¾‹å¦‚ 4 / (1 - 2/3) = 12 ã€‚\n2.  æ¯ä¸ªè¿ç®—ç¬¦å¯¹ä¸¤ä¸ªæ•°è¿›è¡Œè¿ç®—ã€‚ç‰¹åˆ«æ˜¯æˆ‘ä»¬ä¸èƒ½ç”¨Â `-`Â ä½œä¸ºä¸€å…ƒè¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ`[1, 1, 1, 1]`Â ä½œä¸ºè¾“å…¥æ—¶ï¼Œè¡¨è¾¾å¼Â `-1 - 1 - 1 - 1`Â æ˜¯ä¸å…è®¸çš„ã€‚\n3.  ä½ ä¸èƒ½å°†æ•°å­—è¿æ¥åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥ä¸ºÂ `[1, 2, 1, 2]`Â æ—¶ï¼Œä¸èƒ½å†™æˆ 12 + 12 ã€‚\n\n**è§£æ³•ä¸€**\n\nä»£ç æœ‰ç‚¹é•¿ï¼Œä¸è¿‡æ€è·¯è¿˜æ˜¯å¾ˆæ¸…æ¥šï¼Œä¸€å…±4ä¸ªæ•°å­—ï¼Œä»é‡Œé¢ä»»æ„é€‰2ä¸ªï¼Œç„¶ååšå„ç§è¿ç®—åå’Œå‰©ä¸‹çš„æ•°å­—æ„æˆæ–°çš„æ•°ç»„ï¼Œç„¶åé‡å¤è¯¥è¿‡ç¨‹ç›´åˆ°æ•°ç»„åªå‰©ä¸‹ä¸€ä¸ªç„¶ååˆ¤æ–­å€¼æ˜¯å¦æ˜¯24ï¼ˆæ³¨æ„ç²¾åº¦ï¼‰\n```golang\nfunc judgePoint24(nums []int) bool {\n    var eps float32 = 1e-5\n    var Abs = func(a float32) float32 {\n        if a < 0 {\n            return -a\n        }\n        return a\n    }\n    //è®¡æ•°+-*/\n    var compute = func(a, b float32) []float32 {\n        return []float32{a + b, a * b, a - b, a / b}\n    }\n    var dfs func([]float32) bool\n    dfs = func(nums []float32) bool {\n        if len(nums) == 0 {\n            return false\n        }\n        if len(nums) == 1 {\n            return Abs(nums[0]-24) < eps\n        }\n        var n = len(nums)\n        //ä»numsä¸­é€‰å–2ä¸ªæ•°\n        for i := 0; i < n; i++ {\n            for j := 0; j < n; j++ {\n                if i == j {\n                    continue\n                }\n                //æ”¶é›†å‰©ä¸‹çš„æ•°å­—\n                var rest []float32\n                for k := 0; k < n; k++ {\n                    if k != i && k != j {\n                        rest = append(rest, nums[k])\n                    }\n                }\n                //å°è¯•åšå„ç§è¿ç®—\n                for _, v := range compute(nums[i], nums[j]) {\n                    if dfs(append(rest, v)) {\n                        return true\n                    }\n                }\n            }\n        }\n        return false\n    }\n    var temp = make([]float32, len(nums))\n    for i := 0; i < len(nums); i++ {\n        temp[i] = float32(nums[i])\n    }\n    return dfs(temp)\n}\n```\n\n## [5526. æœ€å¤šå¯è¾¾æˆçš„æ¢æ¥¼è¯·æ±‚æ•°ç›®](https://leetcode-cn.com/problems/maximum-number-of-achievable-transfer-requests/)\n\nDifficulty: **å›°éš¾**\n\n\næˆ‘ä»¬æœ‰Â `n`Â æ ‹æ¥¼ï¼Œç¼–å·ä»Â `0`Â åˆ°Â `n - 1`Â ã€‚æ¯æ ‹æ¥¼æœ‰è‹¥å¹²å‘˜å·¥ã€‚ç”±äºç°åœ¨æ˜¯æ¢æ¥¼çš„å­£èŠ‚ï¼Œéƒ¨åˆ†å‘˜å·¥æƒ³è¦æ¢ä¸€æ ‹æ¥¼å±…ä½ã€‚\n\nç»™ä½ ä¸€ä¸ªæ•°ç»„ `requests`Â ï¼Œå…¶ä¸­Â requests[i] = [from<sub style=\"display: inline;\">i</sub>, to<sub style=\"display: inline;\">i</sub>]Â ï¼Œè¡¨ç¤ºä¸€ä¸ªå‘˜å·¥è¯·æ±‚ä»ç¼–å·ä¸ºfrom<sub style=\"display: inline;\">i</sub>Â çš„æ¥¼æ¬åˆ°ç¼–å·ä¸ºÂ to<sub style=\"display: inline;\">i</sub>çš„æ¥¼ã€‚\n\nä¸€å¼€å§‹Â **æ‰€æœ‰æ¥¼éƒ½æ˜¯æ»¡çš„**ï¼Œæ‰€ä»¥ä»è¯·æ±‚åˆ—è¡¨ä¸­é€‰å‡ºçš„è‹¥å¹²ä¸ªè¯·æ±‚æ˜¯å¯è¡Œçš„éœ€è¦æ»¡è¶³ æ¯æ ‹æ¥¼å‘˜å·¥å‡€å˜åŒ–ä¸º 0Â ã€‚æ„æ€æ˜¯æ¯æ ‹æ¥¼ **ç¦»å¼€**Â çš„å‘˜å·¥æ•°ç›® **ç­‰äº**Â è¯¥æ¥¼ **æ¬å…¥**Â çš„å‘˜å·¥æ•°æ•°ç›®ã€‚æ¯”æ–¹è¯´Â `n = 3`Â ä¸”ä¸¤ä¸ªå‘˜å·¥è¦ç¦»å¼€æ¥¼Â `0`Â ï¼Œä¸€ä¸ªå‘˜å·¥è¦ç¦»å¼€æ¥¼Â `1`Â ï¼Œä¸€ä¸ªå‘˜å·¥è¦ç¦»å¼€æ¥¼ `2`Â ï¼Œå¦‚æœè¯¥è¯·æ±‚åˆ—è¡¨å¯è¡Œï¼Œåº”è¯¥è¦æœ‰ä¸¤ä¸ªå‘˜å·¥æ¬å…¥æ¥¼Â `0`Â ï¼Œä¸€ä¸ªå‘˜å·¥æ¬å…¥æ¥¼Â `1`Â ï¼Œä¸€ä¸ªå‘˜å·¥æ¬å…¥æ¥¼Â `2`Â ã€‚\n\nè¯·ä½ ä»åŸè¯·æ±‚åˆ—è¡¨ä¸­é€‰å‡ºè‹¥å¹²ä¸ªè¯·æ±‚ï¼Œä½¿å¾—å®ƒä»¬æ˜¯ä¸€ä¸ªå¯è¡Œçš„è¯·æ±‚åˆ—è¡¨ï¼Œå¹¶è¿”å›æ‰€æœ‰å¯è¡Œåˆ—è¡¨ä¸­æœ€å¤§è¯·æ±‚æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![0AZHr8.png](https://s1.ax1x.com/2020/09/27/0AZHr8.png)\n\n```go\nè¾“å…¥ï¼šn = 5, requests = [[0,1],[1,0],[0,1],[1,2],[2,0],[3,4]]\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šè¯·æ±‚åˆ—è¡¨å¦‚ä¸‹ï¼š\nä»æ¥¼ 0 ç¦»å¼€çš„å‘˜å·¥ä¸º x å’Œ y ï¼Œä¸”ä»–ä»¬éƒ½æƒ³è¦æ¬åˆ°æ¥¼ 1 ã€‚\nä»æ¥¼ 1 ç¦»å¼€çš„å‘˜å·¥ä¸º a å’Œ b ï¼Œä¸”ä»–ä»¬åˆ†åˆ«æƒ³è¦æ¬åˆ°æ¥¼ 2 å’Œ 0 ã€‚\nä»æ¥¼ 2 ç¦»å¼€çš„å‘˜å·¥ä¸º z ï¼Œä¸”ä»–æƒ³è¦æ¬åˆ°æ¥¼ 0 ã€‚\nä»æ¥¼ 3 ç¦»å¼€çš„å‘˜å·¥ä¸º c ï¼Œä¸”ä»–æƒ³è¦æ¬åˆ°æ¥¼ 4 ã€‚\næ²¡æœ‰å‘˜å·¥ä»æ¥¼ 4 ç¦»å¼€ã€‚\næˆ‘ä»¬å¯ä»¥è®© x å’Œ b äº¤æ¢ä»–ä»¬çš„æ¥¼ï¼Œä»¥æ»¡è¶³ä»–ä»¬çš„è¯·æ±‚ã€‚\næˆ‘ä»¬å¯ä»¥è®© yï¼Œa å’Œ z ä¸‰äººåœ¨ä¸‰æ ‹æ¥¼é—´äº¤æ¢ä½ç½®ï¼Œæ»¡è¶³ä»–ä»¬çš„è¦æ±‚ã€‚\næ‰€ä»¥æœ€å¤šå¯ä»¥æ»¡è¶³ 5 ä¸ªè¯·æ±‚ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![0AZLVg.png](https://s1.ax1x.com/2020/09/27/0AZLVg.png)\n\n```go\nè¾“å…¥ï¼šn = 3, requests = [[0,0],[1,2],[2,1]]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šè¯·æ±‚åˆ—è¡¨å¦‚ä¸‹ï¼š\nä»æ¥¼ 0 ç¦»å¼€çš„å‘˜å·¥ä¸º x ï¼Œä¸”ä»–æƒ³è¦å›åˆ°åŸæ¥çš„æ¥¼ 0 ã€‚\nä»æ¥¼ 1 ç¦»å¼€çš„å‘˜å·¥ä¸º y ï¼Œä¸”ä»–æƒ³è¦æ¬åˆ°æ¥¼ 2 ã€‚\nä»æ¥¼ 2 ç¦»å¼€çš„å‘˜å·¥ä¸º z ï¼Œä¸”ä»–æƒ³è¦æ¬åˆ°æ¥¼ 1 ã€‚\næˆ‘ä»¬å¯ä»¥æ»¡è¶³æ‰€æœ‰çš„è¯·æ±‚ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šn = 4, requests = [[0,3],[3,1],[1,2],[2,0]]\nè¾“å‡ºï¼š4\n```\n\n**æç¤ºï¼š**\n\n*   1 <= n <= 20\n*   1 <= requests.length <= 16\n*   requests[i].length == 2\n*   0 <= from<sub style=\"display: inline;\">i</sub>, to<sub style=\"display: inline;\">i</sub> < n\n\n\n**è§£æ³•ä¸€**\n\n208å‘¨èµ›T4ï¼Œæœ‰ç‚¹ç™½ç»™ï¼Œæƒ³å¥½æ€ä¹ˆå¤„ç†å°±å¾ˆç®€å•ï¼ˆå¥½ä¸å®¹æ˜“T4è¿™ä¹ˆç®€å•ï¼Œè¢«T2ï¼ŒT3ç»™å¹²æ‡µäº†ï¼‰\n```java\nclass Solution {\n Â  Â public int maximumRequests(int n, int[][] requests) {\n Â  Â  Â  Â int[] nums = new int[n+1];\n Â  Â  Â  Â dfs(nums, 0, requests, 0);\n Â  Â  Â  Â return res;\n Â   }\n Â  Â \n Â  Â int res = 0;\n Â  Â \n Â  Â public void dfs(int[] nums, int idx, int[][] requests, int count){\n Â  Â  Â  Â if (check(nums)) {\n Â  Â  Â  Â  Â  Â res = Math.max(res, count);\n Â  Â  Â   }\n Â  Â  Â  Â for (int i = idx; i < requests.length; i++) {\n Â  Â  Â  Â  Â  Â nums[requests[i][0]]--;\n Â  Â  Â  Â  Â  Â nums[requests[i][1]]++;\n Â  Â  Â  Â  Â  Â dfs(nums, i+1, requests, count+1);\n Â  Â  Â  Â  Â  Â nums[requests[i][0]]++;\n Â  Â  Â  Â  Â  Â nums[requests[i][1]]--;\n Â  Â  Â   }\n Â   }\n Â  Â \n Â  Â public boolean check(int[] nums) {\n Â  Â  Â  Â for (int i = 0; i < nums.length; i++) {\n Â  Â  Â  Â  Â  Â if (nums[i] != 0) {\n Â  Â  Â  Â  Â  Â  Â  Â return false;\n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â  Â  Â  Â return true;\n Â   }\n}\n```\n\n## _äºŒç»´å¹³é¢ä¸Šçš„å›æº¯_\n\n## [79. å•è¯æœç´¢](https://leetcode-cn.com/problems/word-search/)\n\nç»™å®šä¸€ä¸ªäºŒç»´ç½‘æ ¼å’Œä¸€ä¸ªå•è¯ï¼Œæ‰¾å‡ºè¯¥å•è¯æ˜¯å¦å­˜åœ¨äºç½‘æ ¼ä¸­ã€‚\n\nå•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ç›¸é‚»çš„å•å…ƒæ ¼å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nboard =\n[\n  ['A','B','C','E'],\n  ['S','F','C','S'],\n  ['A','D','E','E']\n]\n\nç»™å®š word = \"ABCCED\", è¿”å› true.\nç»™å®š word = \"SEE\", è¿”å› true.\nç»™å®š word = \"ABCB\", è¿”å› false.\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®å¹¶ä¸éš¾ï¼Œä½†æ˜¯æˆ‘ä¸€å¼€å§‹å°±é’»åˆ°æ­»èƒ¡é‡Œå»äº†ï¼Œæˆ‘ç›´æ¥æ‹¿èµ·æ¥å°±æƒ³çš„æ˜¯æš´åŠ›dfsä»ï¼ˆ0ï¼Œ0ï¼‰å¼€å§‹éå†æ¯ç§æƒ…å†µï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç›¸ç­‰çš„ã€‚ã€‚ã€‚æˆ‘çœŸæ˜¯ä¸ªhapi\n\n```java\n/*\n    board =\n    [\n      ['A','B','C','E'],\n      ['S','F','C','S'],\n      ['A','D','E','E']\n    ]\n     */\n\n//æ–¹å‘: å³,ä¸‹,å·¦,ä¸Š\nprivate int[][] direction={{0,1},{1,0},{0,-1},{-1,0}};\n\npublic boolean exist(char[][] board, String word) {\n    if (board==null || word==null) {\n        return false;\n    }\n    char[] words=word.toCharArray();\n    boolean[][] visit=new boolean[board.length][board[0].length];\n    for (int i=0;i<board.length;i++) {\n        for (int j=0;j<board[0].length;j++) {\n            //éå†boardæ¯ä¸ªå…ƒç´ ,ä»¥ä¸ºä¸ªå…ƒç´ ä¸ºèµ·ç‚¹éƒ½è¯•ä¸€ä¸‹\n            if(dfs(board,words,0,i,j,visit)){\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\npublic boolean dfs(char[][] board, char[] word,int index,int x,int y,boolean[][] visit) {\n    //éå†åˆ°wordçš„æœ€åä¸€ä¸ªå­—ç¬¦äº†,ç›´æ¥æ¯”è¾ƒå°±å¯ä»¥å¾—å‡ºç»“æœ\n    if (index == word.length-1) {\n        return word[index] == board[x][y];\n    }\n    /*\n     è¿™æ ·å†™å¦‚æœboardåªæœ‰ä¸€ä¸ªå…ƒç´ å°±ä¼šé”™äº†,åé¢çš„isValidä¼šç›´æ¥false,ä½†æ˜¯æœ‰å¯èƒ½wordå°±æ˜¯è¿™ä¸ªboard\n     if (index == word.length) {\n            return true;\n     }*/\n    \n    //å½“å…ƒç´ ç›¸ç­‰çš„æ—¶å€™æ‰æœ‰ç»§ç»­çš„å¿…è¦\n    if (board[x][y]==word[index]) {\n        visit[x][y]=true;\n        for (int i=0;i<direction.length;i++) {\n            int nx=x+direction[i][0];\n            int ny=y+direction[i][1];\n            //ä¿è¯åˆæ³•æ€§\n            if (isValid(board,nx,ny)&&!visit[nx][ny]&&dfs(board,word,index+1,nx,ny,visit)) {\n                return true;\n            }\n        }\n        visit[x][y]=false;\n    }\n    return false;\n}\n\npublic boolean isValid(char[][] cs,int x,int y){\n    return x>=0 && x<cs.length && y >=0 && y< cs[0].length;\n}\n```\n## [200. å²›å±¿æ•°é‡](https://leetcode-cn.com/problems/number-of-islands/)\n\nç»™å®šä¸€ä¸ªç”± '1'ï¼ˆé™†åœ°ï¼‰å’Œ '0'ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè®¡ç®—å²›å±¿çš„æ•°é‡ã€‚ä¸€ä¸ªå²›è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”å®ƒæ˜¯é€šè¿‡æ°´å¹³æ–¹å‘æˆ–å‚ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥è€Œæˆçš„ã€‚ä½ å¯ä»¥å‡è®¾ç½‘æ ¼çš„å››ä¸ªè¾¹å‡è¢«æ°´åŒ…å›´\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n11110\n11010\n11000\n00000\n\nè¾“å‡º: 1\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\n11000\n11000\n00100\n00011\n\nè¾“å‡º: 3\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢ä¸€é¢˜ç±»ä¼¼ï¼Œå¾ˆæƒ­æ„§ï¼Œä¸€å¼€å§‹ä¹Ÿæ²¡å†™å‡ºæ¥ï¼Œå†™äº†ä¸ªå¤§æ¦‚ï¼Œç»†èŠ‚æ²¡æœ‰æ‹æ¸…æ¥š\n\n```java\n//æ–¹å‘: å³,ä¸‹,å·¦,ä¸Š\nprivate int[][] direction={{0,1},{1,0},{0,-1},{-1,0}};\n\npublic int numIslands(char[][] grid) {\n    if (grid==null||grid.length<=0) {\n        return 0;\n    }\n    boolean[][] visit=new boolean[grid.length][grid[0].length];\n    for (int i=0;i<grid.length;i++) {\n        for (int j=0;j<grid[0].length;j++) {\n            if (grid[i][j]=='1'&&!visit[i][j]) {\n                dfs(grid,i,j,visit);\n                res++;\n            }\n        }\n    }\n    return res;\n}\n\nprivate int res=0;\n\npublic void dfs(char[][] grid,int x,int y,boolean[][] visit) {\n    //å…¶å®æ•´ä¸ªdfsåšçš„å°±æ˜¯å¯¹visit[x][y]æ ‡è®°,æ ‡è®°ä¸ºtrueä»£è¡¨è®¿é—®è¿‡\n    visit[x][y]=true;\n    for (int i=0;i<direction.length;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (isValid(grid,nx,ny) && !visit[nx][ny] && grid[nx][ny]=='1') {\n            dfs(grid,nx,ny,visit);\n            //æ— éœ€å›æº¯visitçŠ¶æ€\n        }\n    }\n}\n\npublic boolean isValid(final char[][] grid,int x,int y){\n    return x>=0 && x<grid.length && y>=0 && y<grid[0].length;\n} \n```\n## [130. è¢«å›´ç»•çš„åŒºåŸŸ](https://leetcode-cn.com/problems/surrounded-regions/)\n\nç»™å®šä¸€ä¸ªäºŒç»´çš„çŸ©é˜µï¼ŒåŒ…å« `'X'` å’Œ `'O'`ï¼ˆ**å­—æ¯ O**ï¼‰ã€‚\n\næ‰¾åˆ°æ‰€æœ‰è¢« 'X' å›´ç»•çš„åŒºåŸŸï¼Œå¹¶å°†è¿™äº›åŒºåŸŸé‡Œæ‰€æœ‰çš„ `'O'` ç”¨ `'X'` å¡«å……ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nX X X X\nX O O X\nX X O X\nX O X X\n```\n\n\nè¿è¡Œä½ çš„å‡½æ•°åï¼ŒçŸ©é˜µå˜ä¸ºï¼š\n\n```java\nX X X X\nX X X X\nX X X X\nX O X X\n```\n\n**è§£é‡Š:**\n\nè¢«å›´ç»•çš„åŒºé—´ä¸ä¼šå­˜åœ¨äºè¾¹ç•Œä¸Šï¼Œæ¢å¥è¯è¯´ï¼Œä»»ä½•è¾¹ç•Œä¸Šçš„ 'O' éƒ½ä¸ä¼šè¢«å¡«å……ä¸º 'X'ã€‚ ä»»ä½•ä¸åœ¨è¾¹ç•Œä¸Šï¼Œæˆ–ä¸ä¸è¾¹ç•Œä¸Šçš„ 'O' ç›¸è¿çš„ 'O' æœ€ç»ˆéƒ½ä¼šè¢«å¡«å……ä¸º 'X'ã€‚å¦‚æœä¸¤ä¸ªå…ƒç´ åœ¨æ°´å¹³æˆ–å‚ç›´æ–¹å‘ç›¸é‚»ï¼Œåˆ™ç§°å®ƒä»¬æ˜¯â€œç›¸è¿â€çš„\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜åœ¨å¾ˆä¹…ä»¥å‰ï¼ˆçœ‹äº†æäº¤è®°å½•æ˜¯ä¸€å¹´å‰çš„ï¼‰å¼€å§‹å­¦dfsçš„æ—¶å€™ï¼Œåœ¨leetcodeæœç´¢åˆ°äº†è¿™ä¸€é¢˜ï¼Œå½“æ—¶ä¹Ÿåšå‡ºæ¥äº†ï¼Œåªä¸è¿‡æ•ˆç‡æ„Ÿäººï¼Œæ”¾ä¸Šæ¥çœ‹çœ‹æ˜¯ä¸ªå•¥ç©æ„\n\n```java\n// å®šä¹‰4ä¸ªæ–¹å‘ï¼ˆé¡ºæ—¶é’ˆ å³...ï¼‰\nprivate static int[][] direction = { { 1, 0 }, { 0, 1 }, { -1, 0 }, { 0, -1 } };\n\nprivate static int[][] mark = null;\n\npublic static void solve(char[][] board) {\n    if(board.length==0) { return; }\n    // æ ¹æ®ä¼ è¿›æ¥çš„boardç»™markåˆå§‹åŒ–\n    mark = new int[board.length][board[0].length];\n    // éå†è¾¹ç¼˜æ‰¾å‡ºè¾¹ç¼˜çš„ O çš„åæ ‡\n    for (int i = 0; i < board.length; i++) {\n        if (board[i][0] == 'O') {\n            dfs(0, i, board);\n            //æ‰§è¡Œå®Œä¹‹åå†èµ‹å€¼å½“å‰ä½ç½®çš„O é¿å…åœ¨è¾¹ç¼˜è§’è½çš„é—®é¢˜\n            mark[i][0] = 1;\n        }\n        if (board[i][board[0].length - 1] == 'O') {\n            dfs(board[0].length, i, board);\n            mark[i][board[0].length - 1] = 1;\n        }\n    }\n    // ä¸Šè¾¹ç¼˜\n    for (int i = 0; i < board[0].length; i++) {\n        if (board[0][i] == 'O') {\n            dfs(i, 0, board);\n            mark[0][i] = 1;\n        }\n    }\n    // ä¸‹è¾¹ç¼˜\n    for (int i = 0; i < board[0].length; i++) {\n        if (board[board.length - 1][i] == 'O') {\n            dfs(i, board.length - 1, board);\n            mark[board.length - 1][i] = 1;\n        }\n    }\n\n    for (int i = 0; i < board.length; i++) {\n        for (int j = 0; j < board[0].length; j++) {\n            if (board[i][j] == 'O' && mark[i][j] == 0) {\n                board[i][j] = 'X';\n            }\n        }\n    }\n\n}\n\n// å®ç°å‡½æ•°\npublic static void dfs(int x, int y, char[][] board) {\n    int tx, ty;\n    // é¦–å…ˆåˆ¤æ–­è¾¹ç¼˜ä¸Šæœ‰æ²¡æœ‰ O æœ‰çš„è¯å°†ä¸ä»–è”é€šçš„ O éƒ½åŠ ä¸Šæ ‡è®°\n    for (int i = 0; i <= 3; i++) {\n        // x=x+direction[i][0]; è¿™æ ·å†™æ¯ä¸ªç‚¹å‘4ä¸ªæ–¹å‘æ‰©å±•å¦‚æœè¿™æ ·å†™ ç‚¹çš„èµ°å‘å°±æœ‰é—®é¢˜äº†\n        tx = x + direction[i][0];\n        ty = y + direction[i][1];\n        // System.out.println(tx+\" \"+ty);\n        if (tx < board[0].length && tx >= 0 && ty < board.length && ty >= 0 && board[ty][tx] == 'O'\n            && mark[ty][tx] == 0) {\n            // ä»£è¡¨èµ°è¿‡äº†\n            mark[ty][tx] = 1;\n            // è¿™é‡Œæ²¡æœ‰å¤„ç†å¥½ï¼Œæˆ‘çš„dfså‡½æ•°çš„å‚æ•°æ˜¯åæ ‡ä½†æ˜¯å¯¹åº”åˆ°marké‡Œé¢å’Œboardé‡Œé¢å°±ä¸æ˜¯åæ ‡äº†å°±é¢ å€’äº†\n            // æ¯”å¦‚æŒ‰ç…§åæ ‡æ¥ 2 , 1 ---->å¯¹åº”åˆ°æ•°ç»„é‡Œé¢å°±æ˜¯ 1 ï¼Œ2\n            dfs(tx, ty, board);\n        }\n    }\n    return;\n}\n```\n21msï¼Œ8% ä¹ä¸€çœ‹å¥½åƒæ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯ä¸ºå•¥è¿™ä¹ˆæ…¢å‘¢ï¼Ÿçœ‹çœ‹ä»Šå¤©ä¸‹åˆé‡æ–°åšçš„è§£\n\n**è§£æ³•äºŒ**\n\n```java\n//æ–¹å‘: å³,ä¸‹,å·¦,ä¸Š\nprivate int[][] direction={{0,1},{1,0},{0,-1},{-1,0}};\n\npublic void solve(char[][] board) {\n    if (board==null || board.length<=0) {\n        return;\n    }\n    boolean[][] visit=new boolean[board.length][board[0].length];\n    int lx=0,ly=0;\n\n    //éå†4æ¡è¾¹çš„'O',å°†ä¸ç›¸è¿çš„'O'éƒ½æ ‡è®°ä¸ºtrue\n    while(lx<board.length) { \n        if (board[lx][0]=='O') { //å·¦\n            dfs(board,lx,0,visit);\n        }\n        if (board[lx][board[0].length-1] == 'O') { //å³\n            dfs(board,lx,board[0].length-1,visit);\n        }\n        lx++;\n    }\n\n    while(ly<board[0].length) { \n        if (board[0][ly]=='O') { //ä¸Š\n            dfs(board,0,ly,visit);\n        }\n        if (board[board.length-1][ly] == 'O') { //ä¸‹\n            dfs(board,board.length-1,ly,visit);   \n        }\n        ly++;\n    }\n\n    //éå†å°†æ‰€æœ‰visit=falseçš„Oå˜ä¸ºX\n    for (int i=0;i<board.length;i++) {\n        for (int j=0;j<board[0].length;j++) {\n            if (board[i][j]=='O' && !visit[i][j]) {\n                board[i][j]='X';\n            }\n        }\n    }\n}\n\npublic void dfs(char[][] board,int x,int y,boolean[][] visit) {\n    visit[x][y]=true;\n    for (int i=0;i<direction.length;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (isValid(board,nx,ny) && board[nx][ny]=='O' && !visit[nx][ny]) {\n            dfs(board,nx,ny,visit);\n        }\n    }\n}\n\n//æ˜¯å¦åˆæ³•\npublic boolean isValid(final char[][] grid,int x,int y){\n    return x>=0 && x<grid.length && y>=0 && y<grid[0].length;\n}\n```\n2msï¼Œæ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯dfsç»™visitæ•°ç»„èµ‹å€¼çš„æ—¶æœºä¸åŒï¼Œä¸€ä¸ªæ˜¯åœ¨å¾ªç¯é‡Œé¢ï¼Œä¸€ä¸ªæ˜¯åœ¨å‡½æ•°å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ç§è§£æ³•å¹¶ä¸ä¼šç«‹å³ç»™è¾¹ç¼˜çš„`'O'` æ ‡è®°ï¼Œè¿™æ ·å¯¼è‡´çš„é—®é¢˜å°±æ˜¯å®ƒåç»­çš„èŠ‚ç‚¹ä»ç„¶ä¼šæœç´¢åˆ°è¿™ä¸ªè¾¹ç¼˜çš„ `'O'` è¿™æ ·å°±ä¼šé€ æˆé‡å¤çš„è®¡ç®—ï¼Œæ‰€ä»¥è¯´ï¼Œä¸€å®šè¦æ‹æ¸…æ¥šè¿™ä¸ªè¿‡ç¨‹ï¼Œä¸èƒ½ä¹±å†™\n\n## [417. å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜](https://leetcode-cn.com/problems/pacific-atlantic-water-flow/)\n\nç»™å®šä¸€ä¸ª `m x n` çš„éè´Ÿæ•´æ•°çŸ©é˜µæ¥è¡¨ç¤ºä¸€ç‰‡å¤§é™†ä¸Šå„ä¸ªå•å…ƒæ ¼çš„é«˜åº¦ã€‚â€œå¤ªå¹³æ´‹â€å¤„äºå¤§é™†çš„å·¦è¾¹ç•Œå’Œä¸Šè¾¹ç•Œï¼Œè€Œâ€œå¤§è¥¿æ´‹â€å¤„äºå¤§é™†çš„å³è¾¹ç•Œå’Œä¸‹è¾¹ç•Œã€‚\n\nè§„å®šæ°´æµåªèƒ½æŒ‰ç…§ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘æµåŠ¨ï¼Œä¸”åªèƒ½ä»é«˜åˆ°ä½æˆ–è€…åœ¨åŒç­‰é«˜åº¦ä¸ŠæµåŠ¨ã€‚\n\nè¯·æ‰¾å‡ºé‚£äº›æ°´æµæ—¢å¯ä»¥æµåŠ¨åˆ°â€œå¤ªå¹³æ´‹â€ï¼Œåˆèƒ½æµåŠ¨åˆ°â€œå¤§è¥¿æ´‹â€çš„é™†åœ°å•å…ƒçš„åæ ‡\n\n**æç¤ºï¼š**\n\n1. è¾“å‡ºåæ ‡çš„é¡ºåºä¸é‡è¦\n\n2. m å’Œ n éƒ½å°äº150\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nç»™å®šä¸‹é¢çš„ 5x5 çŸ©é˜µ:\n\n  å¤ªå¹³æ´‹ ~   ~   ~   ~   ~ \n       ~  1   2   2   3  (5) *\n       ~  3   2   3  (4) (4) *\n       ~  2   4  (5)  3   1  *\n       ~ (6) (7)  1   4   5  *\n       ~ (5)  1   1   2   4  *\n          *   *   *   *   * å¤§è¥¿æ´‹\n\nè¿”å›:\n\n[[0, 4], [1, 3], [1, 4], [2, 2], [3, 0], [3, 1], [4, 0]] (ä¸Šå›¾ä¸­å¸¦æ‹¬å·çš„å•å…ƒ).\n```\n\n**è§£æ³•ä¸€**\n\nå…¶å®å’Œä¸Šé¢ä¹Ÿæ˜¯å¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡æœ€å¼€å§‹æ²¡æƒ³åˆ°ä¸¤ä¸ªvisitæ•°ç»„æ¥åš\n\n```java\n//æ–¹å‘é”®\nprivate int[][] direction={{0,1},{1,0},{0,-1},{-1,0}};\n\npublic List<List<Integer>> pacificAtlantic(int[][] matrix) {\n    List<List<Integer>> res=new ArrayList<>();\n    //leetcodeè€æ˜¯å–œæ¬¢æäº›å¹ºè›¾å­\n    if (matrix==null || matrix.length<=0) {\n        return res;\n    }\n    int m=matrix.length;\n    int n=matrix[0].length;\n    //å¤ªå¹³æ´‹\n    boolean[][] pacific=new boolean[m][n];\n    //å¤§è¥¿æ´‹\n    boolean[][] atlantic=new boolean[m][n];\n\n    for (int i=0;i<m;i++) {\n        dfs(matrix,i,0,pacific);\n        dfs(matrix,i,n-1,atlantic);\n    }\n\n    for (int i=0;i<n;i++) {\n        dfs(matrix,0,i,pacific);\n        dfs(matrix,m-1,i,atlantic);\n    }\n    for (int i=0;i<m;i++) {\n        for (int j=0;j<n;j++) {\n            //åŒæ—¶ä¸ºtrueçš„å°±æ˜¯è§£\n            if (pacific[i][j] && atlantic[i][j]) {\n                res.add(Arrays.asList(i,j));\n            }\n        }\n    }\n    return res;\n}\n\npublic void dfs(int[][] matrix,int x,int y,boolean[][] visit) {\n    visit[x][y]=true;\n    //å‘4ä¸ªæ–¹å‘floodfill\n    for (int i=0;i<direction.length;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (isValid(matrix,nx,ny) && matrix[nx][ny]>= matrix[x][y] && !visit[nx][ny]) {\n            dfs(matrix,nx,ny,visit);\n        }\n    }\n}\n\npublic boolean isValid(final int[][] matrix,int x,int y){\n    return x>=0 && x<matrix.length && y>=0 && y<matrix[0].length;\n}\n```\n6msï¼Œ96%ï¼Œè¿˜æ˜¯æ¯”è¾ƒokçš„\n\n## [51. Nçš‡å](https://leetcode-cn.com/problems/n-queens/)\n\n*n* çš‡åé—®é¢˜ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† *n* ä¸ªçš‡åæ”¾ç½®åœ¨ *n*Ã—*n* çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»\n\n![mark](http://static.imlgw.top/blog/20191011/ac4lTcAFesSc.png?imageslim)\n\nä¸Šå›¾ä¸º 8 çš‡åé—®é¢˜çš„ä¸€ç§è§£æ³•ã€‚\n\nç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè¿”å›æ‰€æœ‰ä¸åŒçš„ n çš‡åé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚\n\næ¯ä¸€ç§è§£æ³•åŒ…å«ä¸€ä¸ªæ˜ç¡®çš„ n çš‡åé—®é¢˜çš„æ£‹å­æ”¾ç½®æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä¸­ 'Q' å’Œ ' . ' åˆ†åˆ«ä»£è¡¨äº†çš‡åå’Œç©ºä½ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: 4\nè¾“å‡º: [\n [\".Q..\",  // è§£æ³• 1\n  \"...Q\",\n  \"Q...\",\n  \"..Q.\"],\n\n [\"..Q.\",  // è§£æ³• 2\n  \"Q...\",\n  \"...Q\",\n  \".Q..\"]\n]\nè§£é‡Š: 4 çš‡åé—®é¢˜å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„è§£æ³•\n```\n\n**è§£æ³•ä¸€**\n\nHardé¢˜ï¼ŒNçš‡åé—®é¢˜å¯ä»¥è¯´æ˜¯å¾ˆç»å…¸çš„é—®é¢˜äº†ï¼Œä¹‹å‰æœ‰çœ‹è¿‡ï¼Œä½†æ˜¯éƒ½æ˜¯ä¸€è„¸æ‡µé€¼ï¼Œæ— ä»ä¸‹æ‰‹ï¼Œè¿™ä¸€æ¬¡çœ‹äº†ä¸‹æç¤ºè¿˜æ˜¯è‡ªå·±ç»™åšå‡ºæ¥äº†\n\n```java\nprivate List<List<String>> res=new ArrayList<>();\n\nprivate boolean[] col;\n//private boolean[] row;\n//ä¸¤æ¡å¯¹è§’çº¿\nprivate boolean[] dia1;\nprivate boolean[] dia2;\n\npublic List<List<String>> solveNQueens(int n) {\n    if (n<=0) return res;\n    col=new boolean[n];\n    //row=new boolean[n];\n    dia1=new boolean[2*n-1];\n    dia2=new boolean[2*n-1];\n    dfs(n,0,new ArrayList());\n    return res;\n}\n\n//dfs\npublic void dfs(int n,int index,List<Integer> lis) {\n    if (index==n) {\n        res.add(generateRes(lis));\n        return;\n    }\n    //æ£€æµ‹ç¬¬indexè¡Œç¬¬iåˆ—\n    for (int i=0;i<n;i++) {\n        //æ³¨æ„å¯¹è§’çº¿çš„ä¸‹æ ‡\n        if (!col[i] && !dia1[index-i+n-1] && !dia2[i+index]) {\n            col[i]=true;\n            dia1[index-i+n-1]=true;\n            dia2[index+i]=true;\n            //å°è¯•æ·»åŠ \n            lis.add(i);\n            dfs(n,index+1,lis);\n            //å›æº¯\n            lis.remove(lis.size()-1);\n            col[i]=false;\n            dia1[index-i+n-1]=false;\n            dia2[index+i]=false;\n        }\n    }\n}\n\n//æ ¹æ®lisç”Ÿæˆè§£\npublic List<String> generateRes(List<Integer> lis){\n    List<String> res=new ArrayList<>();\n    for (int i=0;i<lis.size();i++) {\n        int index = lis.get(i);\n        StringBuilder sb=new StringBuilder();\n        for (int j=0;j<lis.size();j++) {\n            if (j!=index){\n                sb.append(\".\");\n            }else{\n                sb.append(\"Q\");\n            }\n        }\n        res.add(sb.toString());\n    }\n    return res;\n}\n```\næ ¸å¿ƒæ€è·¯å°±æ˜¯ï¼šä¸€è¡Œè¡Œéå†ï¼Œç„¶ådfså°è¯•åœ¨æ¯ä¸ªä½ç½®æ”¾ç½®çš‡åï¼Œæˆ‘è§‰å¾—ä¸»è¦çš„éš¾ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­å„ä¸ªåˆ—ï¼Œå¯¹è§’çº¿æ˜¯å¦å·²ç»æœ‰çš‡åï¼Œè¿™ä¸€ç‚¹éœ€è¦ç»†è‡´çš„è§‚å¯Ÿï¼Œæœ‰ä¸€æ¡å¯¹è§’çº¿çš„æ¨ªçºµåæ ‡ä¹‹å’Œä¸ºå¸¸æ•°ï¼Œå¦ä¸€æ¡æ¨ªçºµåæ ‡ä¹‹å·®æ˜¯ä¸ªå¸¸æ•°ï¼Œå€Ÿæ­¤ä¾¿å¯ä»¥å”¯ä¸€ç¡®å®šä¸€æ¡å¯¹è§’çº¿\n\n## [52. Nçš‡å II](https://leetcode-cn.com/problems/n-queens-ii/)\n\nå’Œä¸Šé¢ä¸€é¢˜ä¸åŒçš„åœ°æ–¹æ˜¯è¿™é¢˜åªéœ€è¦æ±‚è§£çš„ä¸ªæ•°ï¼Œæ„Ÿè§‰è¿™é¢˜æ‰åº”è¯¥æ˜¯`â… `ï¼Œä¸ç”¨æ±‚æ‰€æœ‰çš„è§£ï¼Œè²Œä¼¼æ›´åŠ ç®€å•äº†ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\nç›´æ¥å¥—ç”¨ä¸Šé¢çš„ä»£ç ï¼Œæ²¡å•¥å¥½è¯´çš„\n\n```java\npublic int totalNQueens(int n) {\n    res=0;\n    if (n<=0) return 0;\n    col=new boolean[n];\n    //row=new boolean[n];\n    dia1=new boolean[2*n-1];\n    dia2=new boolean[2*n-1];\n    dfs(n,0,new ArrayList());\n    return res;\n}\n\nprivate int res=0;\n\nprivate boolean[] col;\nprivate boolean[] dia1;\nprivate boolean[] dia2;\n\n//dfs\npublic void dfs(int n,int index,List<Integer> lis) {\n    if (index==n) {\n        res++;\n        return;\n    }\n    //æ£€æµ‹ç¬¬indexè¡Œç¬¬iåˆ—\n    for (int i=0;i<n;i++) {\n        if (!col[i] && !dia1[index-i+n-1] && !dia2[i+index]) {\n            col[i]=true;\n            dia1[index-i+n-1]=true;\n            dia2[index+i]=true;\n            //ä¸ç”¨æ·»åŠ åˆ°lisä¸­\n            dfs(n,index+1,lis);\n            //å›æº¯\n            col[i]=false;\n            dia1[index-i+n-1]=false;\n            dia2[index+i]=false;\n        }\n    }\n}\n```\nè™½ç„¶æäº¤äº†ä¹Ÿæ˜¯1msï¼Œä¸»è¦æ˜¯è¿™ä¸¤é¢˜caseéƒ½æ¯”è¾ƒå°‘ï¼Œæœ€å¤§çš„caseå¥½åƒåªåˆ°11ï¼Œæ‰€ä»¥å·®è·ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œæˆ‘è¿™æ ·åšè‚¯å®šä¸æ˜¯è¿™é¢˜çš„æœ€ä¼˜è§£ï¼Œè¿™é¢˜çš„æœ€ä¼˜è§£æ˜¯åˆ©ç”¨`ä½å›¾ï¼ˆbitmapï¼‰`ä½œä½è¿ç®—ï¼Œåæ­£æˆ‘ä¸å¯èƒ½å†™å‡ºæ¥å°±æ˜¯äº†ğŸ˜‚ [å‚è€ƒ](http://www.ic-net.or.jp/home/takaken/e/queen/)\n\n## [37. è§£æ•°ç‹¬](https://leetcode-cn.com/problems/sudoku-solver/)\n\nç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œé€šè¿‡å·²å¡«å……çš„ç©ºæ ¼æ¥è§£å†³æ•°ç‹¬é—®é¢˜ã€‚\n\nä¸€ä¸ªæ•°ç‹¬çš„è§£æ³•éœ€éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š\n\næ•°å­— `1-9` åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚\næ•°å­— `1-9` åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚\næ•°å­— 1-9 åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ `3x3` å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚\nç©ºç™½æ ¼ç”¨ `'.'` è¡¨ç¤ºã€‚\n\n![mark](http://static.imlgw.top/blog/20191012/jvSukv6RnXFL.png?imageslim)\n\nä¸€ä¸ªæ•°ç‹¬\n\n![mark](http://static.imlgw.top/blog/20191012/XgTokVUgo5Yy.png?imageslim)\n\nç­”æ¡ˆè¢«æ ‡æˆçº¢è‰²ã€‚\n\n**Note:**\n\n- ç»™å®šçš„æ•°ç‹¬åºåˆ—åªåŒ…å«æ•°å­— `1-9` å’Œå­—ç¬¦ `'.'` \n- ä½ å¯ä»¥å‡è®¾ç»™å®šçš„æ•°ç‹¬åªæœ‰å”¯ä¸€è§£ã€‚\n- ç»™å®šæ•°ç‹¬æ°¸è¿œæ˜¯ `9x9` å½¢å¼çš„ã€‚\n\n**è§£æ³•ä¸€**\n\nå—¯ï¼Œåˆæ˜¯ä¸€é“hardé¢˜ï¼Œè‡ªå·±æ‘¸äº†åŠå¤©æ²¡åšå‡ºæ¥ï¼Œçœ‹äº†è¯„è®ºåŒºåšå‡ºæ¥çš„\n```java\n//ä¸‰ä¸ªçº¦æŸè§„åˆ™\nprivate boolean[][] col=new boolean[9][9];\nprivate boolean[][] row=new boolean[9][9];\nprivate boolean[][] block=new boolean[9][9];\n\npublic void solveSudoku(char[][] board) {\n    if (board==null || board.length<=0) {\n        return;\n    }\n    for (int i=0;i<9;i++) {\n        for (int j=0;j<9;j++) {\n            if (board[i][j]!='.') {\n                col[i][board[i][j]-48-1]=true;\n                row[j][board[i][j]-48-1]=true;\n                //å—å·ä¸º i/3*3+j/3\n                block[i/3*3+j/3][board[i][j]-48-1]=true;\n            }\n        }\n    }\n    dfs(board,0,0);\n}\n\n//private  static char[][] res=new char[9][9];\n\npublic boolean dfs(char[][] board,int i,int j) {\n    //ä»,i,jä½ç½®å‘åå¯»æ‰¾'.', i>=9è¯´æ˜å…¨éƒ¨å¡«å……å®Œäº†\n    while(board[i][j]!='.') {\n        j++;\n        if (j==9) {\n            i++;\n            j=0;\n        }\n        //over\n        if (i==9) {\n            return true;\n        }\n    }\n    //System.out.println(i+\",\"+j);\n    for (int val=0;val<9;val++) {\n        if (!col[i][val] && !row[j][val] && !block[i/3*3+j/3][val]) {\n            col[i][val]=true;\n            row[j][val]=true;\n            block[i/3*3+j/3][val]=true;\n            //å°è¯•å¡«å……ä¸º val+1\n            board[i][j]=(char)(val+1+48);\n            //å°è¯•åé¢çš„'.',è¿™é‡Œä¼ è¿›å»è¿˜æ˜¯i,j\n            //å¤§è„‘æ¨¡æ‹Ÿä¸‹å…¶å®è¿™ä¸ªdfsè¿‡ç¨‹ä¹ŸæŒºç®€å•\n            if(dfs(board,i,j)){//è¿™é‡Œä¼šå°è¯•æ‰€æœ‰è§£ï¼Œå¤±è´¥åå›æº¯\n                return true;\n            }else{\n                //å›æº¯\n                board[i][j]='.';\n                col[i][val]=false;\n                row[j][val]=false;\n                block[i/3*3+j/3][val]=false;\n            }\n        }\n    }\n    return false;\n}\n```\n\næ¯”ä¸Šé¢çš„Nçš‡åè¦æ›´å¤æ‚ï¼ŒåŒæ ·ä¹Ÿæ˜¯å¸¦æœ‰çº¦æŸçš„dfså›æº¯ï¼Œæˆ‘ä¸€å¼€å§‹å†™çš„æ–¹æ³•ä¸»è¦æ˜¯æ€è·¯éƒ½é”™äº†ï¼Œæˆ‘æƒ³çš„å’Œä¸Šé¢nçš‡åä¸€æ ·ï¼Œä¸€å±‚ä¸€å±‚çš„æœç´¢æœ€ån==9å°±ç»“æŸï¼Œä½†æ˜¯æ²¡è€ƒè™‘åˆ°ä¸€å±‚å…¶å®ä¸åªæœ‰ä¸€ä¸ª`ç©ºä½`ï¼ŒåŒæ—¶è¿˜è¦æ³¨æ„å›æº¯çš„æ—¶æœºï¼Œå¹¶ä¸æ˜¯dfsä¹‹åå°±å›æº¯ï¼Œç”¨å¤§è„‘æ¨¡æ‹Ÿä¸‹è¿™ä¸ªé€’å½’å…¶å®å°±æ˜ç™½äº†ï¼Œæˆ‘è§‰å¾—æ ¸å¿ƒè¿˜æ˜¯`æ‰¾'.'é‚£ä¸€æ­¥`ï¼Œè¿™ä¸€æ­¥ç¡®å®æ²¡æƒ³åˆ°\n\n> è¿™é¢˜æœ‰ä¸€ä¸ªç®€å•ç‰ˆï¼Œ[36. æœ‰æ•ˆçš„æ•°ç‹¬](https://leetcode-cn.com/problems/valid-sudoku/) æŒºç®€å•çš„ï¼Œæ‡’å¾—åšäº†\n\n## [529. æ‰«é›·æ¸¸æˆ](https://leetcode-cn.com/problems/minesweeper/)\n\nè®©æˆ‘ä»¬ä¸€èµ·æ¥ç©æ‰«é›·æ¸¸æˆï¼\n\nç»™å®šä¸€ä¸ªä»£è¡¨æ¸¸æˆæ¿çš„äºŒç»´å­—ç¬¦çŸ©é˜µã€‚ 'M' ä»£è¡¨ä¸€ä¸ªæœªæŒ–å‡ºçš„åœ°é›·ï¼Œ'E' ä»£è¡¨ä¸€ä¸ªæœªæŒ–å‡ºçš„ç©ºæ–¹å—ï¼Œ'B' ä»£è¡¨æ²¡æœ‰ç›¸é‚»ï¼ˆä¸Šï¼Œä¸‹ï¼Œå·¦ï¼Œå³ï¼Œå’Œæ‰€æœ‰4ä¸ªå¯¹è§’çº¿ï¼‰åœ°é›·çš„å·²æŒ–å‡ºçš„ç©ºç™½æ–¹å—ï¼Œæ•°å­—ï¼ˆ'1' åˆ° '8'ï¼‰è¡¨ç¤ºæœ‰å¤šå°‘åœ°é›·ä¸è¿™å—å·²æŒ–å‡ºçš„æ–¹å—ç›¸é‚»ï¼Œ'X' åˆ™è¡¨ç¤ºä¸€ä¸ªå·²æŒ–å‡ºçš„åœ°é›·ã€‚\n\nç°åœ¨ç»™å‡ºåœ¨æ‰€æœ‰æœªæŒ–å‡ºçš„æ–¹å—ä¸­ï¼ˆ'M'æˆ–è€…'E'ï¼‰çš„ä¸‹ä¸€ä¸ªç‚¹å‡»ä½ç½®ï¼ˆè¡Œå’Œåˆ—ç´¢å¼•ï¼‰ï¼Œæ ¹æ®ä»¥ä¸‹è§„åˆ™ï¼Œè¿”å›ç›¸åº”ä½ç½®è¢«ç‚¹å‡»åå¯¹åº”çš„é¢æ¿ï¼š\n\n1. å¦‚æœä¸€ä¸ªåœ°é›·ï¼ˆ'M'ï¼‰è¢«æŒ–å‡ºï¼Œæ¸¸æˆå°±ç»“æŸäº†- æŠŠå®ƒæ”¹ä¸º 'X'ã€‚\n2. å¦‚æœä¸€ä¸ªæ²¡æœ‰ç›¸é‚»åœ°é›·çš„ç©ºæ–¹å—ï¼ˆ'E'ï¼‰è¢«æŒ–å‡ºï¼Œä¿®æ”¹å®ƒä¸ºï¼ˆ'B'ï¼‰ï¼Œå¹¶ä¸”æ‰€æœ‰å’Œå…¶ç›¸é‚»çš„æ–¹å—éƒ½åº”è¯¥è¢«é€’å½’åœ°æ­éœ²ã€‚\n3. å¦‚æœä¸€ä¸ªè‡³å°‘ä¸ä¸€ä¸ªåœ°é›·ç›¸é‚»çš„ç©ºæ–¹å—ï¼ˆ'E'ï¼‰è¢«æŒ–å‡ºï¼Œä¿®æ”¹å®ƒä¸ºæ•°å­—ï¼ˆ'1'åˆ°'8'ï¼‰ï¼Œè¡¨ç¤ºç›¸é‚»åœ°é›·çš„æ•°é‡ã€‚\n4. å¦‚æœåœ¨æ­¤æ¬¡ç‚¹å‡»ä¸­ï¼Œè‹¥æ— æ›´å¤šæ–¹å—å¯è¢«æ­éœ²ï¼Œåˆ™è¿”å›é¢æ¿ã€‚\n\n**ç¤ºä¾‹ä¸€**\n\n```java\nInput: \n\n[['E', 'E', 'E', 'E', 'E'],\n ['E', 'E', 'M', 'E', 'E'],\n ['E', 'E', 'E', 'E', 'E'],\n ['E', 'E', 'E', 'E', 'E']]\n\nClick : [3,0]\n\nOutput: \n\n[['B', '1', 'E', '1', 'B'],\n ['B', '1', 'M', '1', 'B'],\n ['B', '1', '1', '1', 'B'],\n ['B', 'B', 'B', 'B', 'B']]\n\n```\n\n**Explanation:**\n\n![æ‰«é›·](https://i.loli.net/2019/11/18/B26DWk8CrhPFtHI.png)\n\n**ç¤ºä¾‹äºŒ**\n\n```java\nInput: \n\n[['B', '1', 'E', '1', 'B'],\n ['B', '1', 'M', '1', 'B'],\n ['B', '1', '1', '1', 'B'],\n ['B', 'B', 'B', 'B', 'B']]\n\nClick : [1,2]\n\nOutput: \n\n[['B', '1', 'E', '1', 'B'],\n ['B', '1', 'X', '1', 'B'],\n ['B', '1', '1', '1', 'B'],\n ['B', 'B', 'B', 'B', 'B']]\n```\n\n**Explanation:**\n\n![æ‰«é›·](https://s2.ax1x.com/2019/11/18/MyccWT.png)\n\n**è§£æ³•ä¸€**\n\næ ‡å‡†çš„DFSï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå‘8ä¸ªæ–¹å‘æ‰©å±•ï¼Œé‡åˆ°å‘¨å›´æœ‰åœ°é›·çš„å°±è®¡æ•°å¹¶ä¸”åœæ­¢ï¼Œä¼šç©æ‰«é›·å°±ä¼šåšğŸ˜‰\n\n```java\nprivate int[][] direction={{0,1},{1,0},{-1,1},{1,-1},{-1,0},{0,-1},{-1,-1},{1,1}};\n\npublic char[][] updateBoard(char[][] board, int[] click) {\n    int x=click[0];\n    int y=click[1];\n    if (board[x][y]=='M') {\n        board[x][y]='X';\n        return board;\n    }\n    boolean[][] visit=new boolean[board.length][board[0].length];\n    dfs(board,x,y,visit);\n    return board;\n}\n\npublic void dfs(char[][] board,int x,int y,boolean[][] visit){\n    visit[x][y]=true;\n    int count=getRoundBoom(board,x,y);\n    if(count!=0){\n        board[x][y]=(char)(count+'0');\n        return;\n    }\n    board[x][y]='B';\n    for (int i=0;i<8;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (isValid(board,nx,ny) && !visit[nx][ny] && board[nx][ny]!='M') {\n            dfs(board,nx,ny,visit);\n        }\n    }\n}\n\npublic int getRoundBoom(char[][] board,int x,int y){\n    int count=0;\n    for (int i=0;i<8;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (isValid(board,nx,ny) && board[nx][ny]=='M') {\n            count++;\n        }   \n    }\n    return count;\n}\n\npublic boolean isValid(final char[][] board,int x,int y){\n    return x>=0 && x<board.length && y>=0 && y<board[0].length;\n}\n```\n## [695. å²›å±¿çš„æœ€å¤§é¢ç§¯](https://leetcode-cn.com/problems/max-area-of-island/)\n\nç»™å®šä¸€ä¸ªåŒ…å«äº†ä¸€äº› 0 å’Œ 1çš„éç©ºäºŒç»´æ•°ç»„ `grid` , ä¸€ä¸ª `å²›å±¿` æ˜¯ç”±å››ä¸ªæ–¹å‘ (æ°´å¹³æˆ–å‚ç›´) çš„ 1 (ä»£è¡¨åœŸåœ°) æ„æˆçš„ç»„åˆã€‚ä½ å¯ä»¥å‡è®¾äºŒç»´çŸ©é˜µçš„å››ä¸ªè¾¹ç¼˜éƒ½è¢«æ°´åŒ…å›´ç€ã€‚\n\næ‰¾åˆ°ç»™å®šçš„äºŒç»´æ•°ç»„ä¸­æœ€å¤§çš„å²›å±¿é¢ç§¯ã€‚(å¦‚æœæ²¡æœ‰å²›å±¿ï¼Œåˆ™è¿”å›é¢ç§¯ä¸º0)\n\n**ç¤ºä¾‹ 1:**\n\n```java\n[[0,0,1,0,0,0,0,1,0,0,0,0,0],\n [0,0,0,0,0,0,0,1,1,1,0,0,0],\n [0,1,1,0,1,0,0,0,0,0,0,0,0],\n [0,1,0,0,1,1,0,0,1,0,1,0,0],\n [0,1,0,0,1,1,0,0,1,1,1,0,0],\n [0,0,0,0,0,0,0,0,0,0,1,0,0],\n [0,0,0,0,0,0,0,1,1,1,0,0,0],\n [0,0,0,0,0,0,0,1,1,0,0,0,0]]\n```\n\nå¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçŸ©é˜µåº”è¿”å› 6ã€‚æ³¨æ„ç­”æ¡ˆä¸åº”è¯¥æ˜¯11ï¼Œå› ä¸ºå²›å±¿åªèƒ½åŒ…å«æ°´å¹³æˆ–å‚ç›´çš„å››ä¸ªæ–¹å‘çš„ `â€˜1â€™`ã€‚\n\n**ç¤ºä¾‹ 2:**\n\n```java\n[[0,0,0,0,0,0,0,0]]\n```\n\n\nå¯¹äºä¸Šé¢è¿™ä¸ªç»™å®šçš„çŸ©é˜µ, è¿”å› 0\n\n**æ³¨æ„:** ç»™å®šçš„çŸ©é˜µgrid çš„é•¿åº¦å’Œå®½åº¦éƒ½ä¸è¶…è¿‡ 50ã€‚\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢ [200é¢˜å²›å±¿çš„æ•°é‡](#200-å²›å±¿æ•°é‡)å¾ˆç±»ä¼¼ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œè¦è®¡ç®—çš„æ˜¯æœ€å¤§çš„é¢ç§¯\n\n```java\nprivate int[][] direction={{0,1},{0,-1},{1,0},{-1,0}};\n\npublic int maxAreaOfIsland(int[][] grid) {\n    if (grid==null || grid.length<=0) {\n        return max;\n    }\n    boolean[][] visit=new boolean[grid.length][grid[0].length];\n    for (int i=0;i<grid.length;i++) {\n        for (int j=0;j<grid[0].length;j++) {\n            if (grid[i][j]==1 &&!visit[i][j]) {\n                int t=dfs(grid,i,j,visit);\n                max=max>t?max:t;\n            }\n        }\n    }\n    return max;\n}\n\nprivate int max=0;\n\npublic int dfs(int[][] grid,int x,int y,boolean[][] visit) {\n    int temp=1;\n    visit[x][y]=true;\n    for (int i=0;i<direction.length;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (isValid(grid,nx,ny) && grid[nx][ny]==1 && !visit[nx][ny]) {\n            //å°†4ä¸ªæ–¹å‘çš„ç¬¦åˆæ¡ä»¶çš„æ•°é‡åŠ èµ·æ¥\n            temp+=dfs(grid,nx,ny,visit);\n        }\n    }\n    return temp;\n}\n\npublic boolean isValid(final int[][] grid,int x,int y){\n    return x>=0 && x<grid.length && y>=0 && y<grid[0].length;\n}\n```\næœ€å¼€å§‹ç›´æ¥åœ¨dfså‡½æ•°é‡Œé¢ç”¨countè®¡æ•°ï¼Œå±…ç„¶è¿˜è¿‡äº†600å¤šä¸ªcase.....æƒŠäº†ï¼Œé‚£ç§åšæ³•å®Œå…¨æ˜¯é”™çš„ï¼Œè¯´å®è¯æœ‰ç‚¹ä¸å¤ªä¹ æƒ¯å†™æœ‰è¿”å›å€¼çš„é€’å½’\n\n## [547. æœ‹å‹åœˆ](https://leetcode-cn.com/problems/friend-circles/)\n\nç­ä¸Šæœ‰ N åå­¦ç”Ÿã€‚å…¶ä¸­æœ‰äº›äººæ˜¯æœ‹å‹ï¼Œæœ‰äº›åˆ™ä¸æ˜¯ã€‚ä»–ä»¬çš„å‹è°Šå…·æœ‰æ˜¯ä¼ é€’æ€§ã€‚å¦‚æœå·²çŸ¥ A æ˜¯ B çš„æœ‹å‹ï¼ŒB æ˜¯ C çš„æœ‹å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¤ä¸º A ä¹Ÿæ˜¯ C çš„æœ‹å‹ã€‚æ‰€è°“çš„æœ‹å‹åœˆï¼Œæ˜¯æŒ‡æ‰€æœ‰æœ‹å‹çš„é›†åˆã€‚\n\nç»™å®šä¸€ä¸ª N * N çš„çŸ©é˜µ Mï¼Œè¡¨ç¤ºç­çº§ä¸­å­¦ç”Ÿä¹‹é—´çš„æœ‹å‹å…³ç³»ã€‚å¦‚æœM[i] [j] = 1ï¼Œè¡¨ç¤ºå·²çŸ¥ç¬¬ i ä¸ªå’Œ j ä¸ªå­¦ç”Ÿäº’ä¸ºæœ‹å‹å…³ç³»ï¼Œå¦åˆ™ä¸ºä¸çŸ¥é“ã€‚ä½ å¿…é¡»è¾“å‡ºæ‰€æœ‰å­¦ç”Ÿä¸­çš„å·²çŸ¥çš„æœ‹å‹åœˆæ€»æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \n[[1,1,0],\n [1,1,0],\n [0,0,1]]\nè¾“å‡º: 2 \nè¯´æ˜ï¼šå·²çŸ¥å­¦ç”Ÿ0å’Œå­¦ç”Ÿ1äº’ä¸ºæœ‹å‹ï¼Œä»–ä»¬åœ¨ä¸€ä¸ªæœ‹å‹åœˆã€‚\nç¬¬2ä¸ªå­¦ç”Ÿè‡ªå·±åœ¨ä¸€ä¸ªæœ‹å‹åœˆã€‚æ‰€ä»¥è¿”å›2ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \n[[1,1,0],\n [1,1,1],\n [0,1,1]]\nè¾“å‡º: 1\nè¯´æ˜ï¼šå·²çŸ¥å­¦ç”Ÿ0å’Œå­¦ç”Ÿ1äº’ä¸ºæœ‹å‹ï¼Œå­¦ç”Ÿ1å’Œå­¦ç”Ÿ2äº’ä¸ºæœ‹å‹ï¼Œæ‰€ä»¥å­¦ç”Ÿ0å’Œå­¦ç”Ÿ2ä¹Ÿæ˜¯æœ‹å‹ï¼Œæ‰€ä»¥ä»–ä»¬ä¸‰ä¸ªåœ¨ä¸€ä¸ªæœ‹å‹åœˆï¼Œè¿”å›1ã€‚\n```\n\n**æ³¨æ„ï¼š**\n\n- N åœ¨[1,200]çš„èŒƒå›´å†…ã€‚\n- å¯¹äºæ‰€æœ‰å­¦ç”Ÿï¼Œæœ‰M[i] [i] = 1ã€‚\n- å¦‚æœæœ‰M[i] [j] = 1ï¼Œåˆ™æœ‰M[j] [i] = 1ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic int findCircleNum(int[][] M) {\n    if (M==null || M.length<=0) {\n        return 0;\n    }\n    boolean[] visit=new boolean[M.length];\n    int count=0;\n    for (int i=0;i<M.length;i++) {\n        if (!visit[i]) {\n            dfs(M,visit,i);\n            count++;\n        }\n    }\n    return count;\n}\n\n//ä¸€å…±m.lengthä¸ªäºº\npublic void dfs(int[][] M,boolean[] visit,int index) {\n    //æ ‡è®°indexå·å­¦ç”Ÿå·²ç»è®¿é—®è¿‡\n    visit[index]=true;\n    for (int i=0;i<M.length;i++) {\n        //indexå’Œiæ˜¯å¥½æœ‹å‹\n        if (M[index][i]==1 && !visit[i]) {\n            //é€’å½’æ ‡è®°içš„å¥½æœ‹å‹,å½¢æˆæœ‹å‹åœˆ\n            dfs(M,visit,i);\n        }\n    }\n}\n```\nè¿™é¢˜ä¸çŸ¥é“ä¸ºå•¥ï¼Œä¸€å¼€å§‹é¢˜ç›®æ²¡ææ˜ç™½ã€‚ã€‚ã€‚ã€‚å»çº ç»“é‚£ä¸ªçŸ©é˜µå»äº†ï¼Œæ²¡ç†è§£å¥½é¢˜ç›®çš„æ„æ€ï¼Œå…¶å®è·Ÿé‚£ä¸ªN*Nçš„çŸ©é˜µæ²¡å•¥å…³ç³»ï¼Œä¸»è¦æ˜¯Nä¸ªäººï¼Œå¯¹æ¯ä¸ªäººè¿›è¡Œdfsæ‰¾åˆ°ä¸ä»–ä»¬ç›¸å…³çš„äººï¼Œåšå¥½ç»Ÿè®¡å°±okï¼Œå’Œä¸Šé¢çš„ 200é¢˜ä¹Ÿå¾ˆç±»ä¼¼\n\n## [1219. é»„é‡‘çŸ¿å·¥](https://leetcode-cn.com/problems/path-with-maximum-gold/)\n\nä½ è¦å¼€å‘ä¸€åº§é‡‘çŸ¿ï¼Œåœ°è´¨å‹˜æµ‹å­¦å®¶å·²ç»æ¢æ˜äº†è¿™åº§é‡‘çŸ¿ä¸­çš„èµ„æºåˆ†å¸ƒï¼Œå¹¶ç”¨å¤§å°ä¸º m * n çš„ç½‘æ ¼ grid è¿›è¡Œäº†æ ‡æ³¨ã€‚æ¯ä¸ªå•å…ƒæ ¼ä¸­çš„æ•´æ•°å°±è¡¨ç¤ºè¿™ä¸€å•å…ƒæ ¼ä¸­çš„é»„é‡‘æ•°é‡ï¼›å¦‚æœè¯¥å•å…ƒæ ¼æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°±æ˜¯ 0ã€‚\n\nä¸ºäº†ä½¿æ”¶ç›Šæœ€å¤§åŒ–ï¼ŒçŸ¿å·¥éœ€è¦æŒ‰ä»¥ä¸‹è§„åˆ™æ¥å¼€é‡‡é»„é‡‘ï¼š\n\n- æ¯å½“çŸ¿å·¥è¿›å…¥ä¸€ä¸ªå•å…ƒï¼Œå°±ä¼šæ”¶é›†è¯¥å•å…ƒæ ¼ä¸­çš„æ‰€æœ‰é»„é‡‘ã€‚\n- çŸ¿å·¥æ¯æ¬¡å¯ä»¥ä»å½“å‰ä½ç½®å‘ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘èµ°ã€‚\n- æ¯ä¸ªå•å…ƒæ ¼**åªèƒ½è¢«å¼€é‡‡ï¼ˆè¿›å…¥ï¼‰ä¸€æ¬¡**ã€‚\n- **ä¸å¾—å¼€é‡‡**ï¼ˆè¿›å…¥ï¼‰é»„é‡‘æ•°ç›®ä¸º 0 çš„å•å…ƒæ ¼ã€‚\n- çŸ¿å·¥å¯ä»¥ä»ç½‘æ ¼ä¸­ **ä»»æ„ä¸€ä¸ª** æœ‰é»„é‡‘çš„å•å…ƒæ ¼å‡ºå‘æˆ–è€…æ˜¯åœæ­¢ã€‚  \n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šgrid = [[0,6,0],[5,8,7],[0,9,0]]\nè¾“å‡ºï¼š24\nè§£é‡Šï¼š\n[[0,6,0],\n [5,8,7],\n [0,9,0]]\nä¸€ç§æ”¶é›†æœ€å¤šé»„é‡‘çš„è·¯çº¿æ˜¯ï¼š9 -> 8 -> 7ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šgrid = [[1,0,7],[2,0,6],[3,4,5],[0,3,0],[9,0,20]]\nè¾“å‡ºï¼š28\nè§£é‡Šï¼š\n[[1,0,7],\n [2,0,6],\n [3,4,5],\n [0,3,0],\n [9,0,20]]\nä¸€ç§æ”¶é›†æœ€å¤šé»„é‡‘çš„è·¯çº¿æ˜¯ï¼š1 -> 2 -> 3 -> 4 -> 5 -> 6 -> 7ã€‚\n```\n\n**æç¤ºï¼š**\n\n- -`1 <= grid.length, grid[i].length <= 15`\n- `0 <= grid[i][j] <= 100`\n- æœ€å¤š 25 ä¸ªå•å…ƒæ ¼ä¸­æœ‰é»„é‡‘ã€‚ \n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¡«è¡¥äº†æˆ‘ä¸€ç‚¹äºŒç»´å¹³é¢å›æº¯çš„ç©ºç¼ºï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼ˆæ”¹äº†å¥½å‡ ä¸ªå°æ—¶è¿˜å¥½æ„æ€è¯´è¿™ç§è¯ğŸ˜‚ï¼‰\n\n```java\nprivate int[][] direction={{0,1},{1,0},{0,-1},{-1,0}};\n\npublic int getMaximumGold(int[][] grid) {\n    int max=0;\n    boolean[][] visit=new boolean[grid.length][grid[0].length];\n    for (int i=0;i<grid.length;i++) {\n        for (int j=0;j<grid[0].length;j++) {\n            if (grid[i][j]>0) {\n                max=Math.max(dfs(grid,i,j,visit),max);\n            }\n        }\n    }\n    return max;\n}\n\n//æ±‚å‡ºä»x,yå¼€å§‹æ‰€èƒ½è·å¾—çš„æœ€å¤§çš„æ”¶ç›Šï¼Œè®°å¾—å›æº¯çŠ¶æ€ï¼Œåé¢çš„èŠ‚ç‚¹è¿˜éœ€è¦éå†\npublic int dfs(int[][] grid,int x,int y,boolean[][] visit){\n    int maxGlod=grid[x][y]; //ä¸€å¼€å§‹è¿™é‡Œå†™çš„0...æ’äº†åŠå¤©çš„é”™\n    visit[x][y]=true;\n    for (int i=0;i<direction.length;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (isValid(grid,nx,ny) && !visit[nx][ny] && grid[nx][ny]>0) {\n            //æ±‚å‘4ä¸ªæ–¹å‘æ‰©å±•çš„æœ€å¤§å€¼\n            maxGlod=Math.max(dfs(grid,nx,ny,visit)+grid[x][y],maxGlod);\n        }\n    }\n    visit[x][y]=false;\n    return maxGlod;\n}\n\npublic boolean isValid(final int[][] grid,int x,int y){\n    return x>=0 && x<grid.length && y>=0 && y<grid[0].length;\n}\n```\n\næ€è·¯å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå¯¹æ¯ä¸ªæœ‰é‡‘çŸ¿çš„ç‚¹è¿›è¡Œdfsè®¡ç®—è·¯å¾„ä¸Šçš„é‡‘çŸ¿å’Œå°±okäº†ï¼Œä½†æ˜¯è¿™é¢˜æœ‰ä¸€ä¸ªå¾ˆå…³é”®çš„æ¡ä»¶ï¼Œä¸èƒ½å›å¤´ï¼Œä¸‹è¿‡çš„é‡‘çŸ¿æ˜¯ä¸èƒ½ç¬¬äºŒæ¬¡å†è¿›å…¥çš„ï¼Œä¸ç„¶è¿™é¢˜å°±å’Œå‰é¢çš„ [695. å²›å±¿æœ€å¤§é¢ç§¯](##695. å²›å±¿çš„æœ€å¤§é¢ç§¯)ä¸€æ ·äº†ï¼Œæ‰€ä»¥å¾ˆæ˜¾ç„¶è¿™é¢˜æ˜¯éœ€è¦çŠ¶æ€çš„å›æº¯çš„ï¼Œè®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œåé¢çš„èŠ‚ç‚¹è¿˜æ˜¯å¯èƒ½éœ€è¦éå†çš„ï¼Œæœ€å¼€å§‹å†™çš„ä¸€ä¸ªbugå°±æ˜¯ä»£ç ä¸­æåˆ°çš„ï¼Œé‚£é‡Œä¸€å¼€å§‹å†™çš„0...ç„¶åæ’é”™æ’äº†å¥½é•¿æ—¶é—´ã€‚ã€‚ã€‚èœå•Š\n\n## [é¢è¯•é¢˜13. æœºå™¨äººçš„è¿åŠ¨èŒƒå›´](https://leetcode-cn.com/problems/ji-qi-ren-de-yun-dong-fan-wei-lcof/)\n\nåœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œnåˆ—çš„æ–¹æ ¼ï¼Œä»åæ ‡ [0,0] åˆ°åæ ‡ [m-1,n-1] ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡ [0, 0] çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œå®ƒæ¯æ¬¡å¯ä»¥å‘å·¦ã€å³ã€ä¸Šã€ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼ˆä¸èƒ½ç§»åŠ¨åˆ°æ–¹æ ¼å¤–ï¼‰ï¼Œä¹Ÿä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ [35, 37] ï¼Œå› ä¸º3+5+3+7=18ã€‚ä½†å®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ [35, 38]ï¼Œå› ä¸º3+5+3+8=19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿåˆ°è¾¾å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šm = 2, n = 3, k = 1\nè¾“å‡ºï¼š3\n```\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šm = 3, n = 1, k = 0\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n- `1 <= n,m <= 100`\n- `0 <= k <= 20`\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹æ²¡è®¤çœŸçœ‹ä¾‹å­ï¼Œä»¥ä¸ºæ˜¯æ±‚ä¸èƒ½å›å¤´ä¸€æ¬¡èƒ½èµ°çš„æœ€å¤šçš„æ ¼å­ï¼ŒåŸåŸºç¡€ä¸Šç¨å¾®æ”¹ä¸€ä¸‹å°±å¯ä»¥äº†\n\n```java\nprivate int[][] direction={{1,0},{0,1},{0,-1},{-1,0}};\n\npublic int movingCount(int m, int n, int k) {\n    return dfs(m,n,0,0,k,new boolean[m][n]);   \n}\n\npublic int dfs(int m,int n,int x,int y,int k,boolean[][] visit){\n    visit[x][y]=true;\n    int res=1;\n    for (int i=0;i<direction.length;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if(valid(m,n,nx,ny,k) && !visit[nx][ny]){\n            //ä»¥ä¸ºæ˜¯æ±‚æœ€é•¿çš„è·ç¦».....\n            //res=Math.max(dfs(m,n,nx,ny,k,visit)+1,res);\n            res+=dfs(m,n,nx,ny,k,visit);\n        }\n    }\n    //visit[x][y]=false;\n    return res;\n}\n\npublic boolean valid(int m,int n,int x,int y,int k){\n    if(x<0 || x>=m || y<0 || y>=n){\n        return false;\n    }\n    int res=0;\n    //35 37\n    while(x!=0){\n        res+=(x%10);\n        x/=10;\n    }\n    while(y!=0){\n        res+=(y%10);\n        y/=10;\n    }\n    return res<=k;\n}\n```\n\n## [1020. é£åœ°çš„æ•°é‡](https://leetcode-cn.com/problems/number-of-enclaves/)\n\nç»™å‡ºä¸€ä¸ªäºŒç»´æ•°ç»„ `A`ï¼Œæ¯ä¸ªå•å…ƒæ ¼ä¸º 0ï¼ˆä»£è¡¨æµ·ï¼‰æˆ– 1ï¼ˆä»£è¡¨é™†åœ°ï¼‰ã€‚\n\nç§»åŠ¨æ˜¯æŒ‡åœ¨é™†åœ°ä¸Šä»ä¸€ä¸ªåœ°æ–¹èµ°åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼ˆæœå››ä¸ªæ–¹å‘ä¹‹ä¸€ï¼‰æˆ–ç¦»å¼€ç½‘æ ¼çš„è¾¹ç•Œã€‚\n\nè¿”å›ç½‘æ ¼ä¸­**æ— æ³•**åœ¨ä»»æ„æ¬¡æ•°çš„ç§»åŠ¨ä¸­ç¦»å¼€ç½‘æ ¼è¾¹ç•Œçš„é™†åœ°å•å…ƒæ ¼çš„æ•°é‡ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[[0,0,0,0],[1,0,1,0],[0,1,1,0],[0,0,0,0]]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼š \næœ‰ä¸‰ä¸ª 1 è¢« 0 åŒ…å›´ã€‚ä¸€ä¸ª 1 æ²¡æœ‰è¢«åŒ…å›´ï¼Œå› ä¸ºå®ƒåœ¨è¾¹ç•Œä¸Šã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼š\næ‰€æœ‰ 1 éƒ½åœ¨è¾¹ç•Œä¸Šæˆ–å¯ä»¥åˆ°è¾¾è¾¹ç•Œã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= A.length <= 500`\n2. `1 <= A[i].length <= 500`\n3. `0 <= A[i][j] <= 1`\n4. æ‰€æœ‰è¡Œçš„å¤§å°éƒ½ç›¸åŒ\n\n**è§£æ³•ä¸€**\n\ndfsæœç´¢å°±å®Œäº‹å„¿äº†ï¼Œæ°´é¢˜\n\n```java\n//DFS\nint[][] dir={{1,0},{0,1},{-1,0},{0,-1}};\n\npublic int numEnclaves(int[][] A) {\n    if(A==null || A.length<=0) return 0;\n    int N=A.length;\n    int M=A[0].length;\n    boolean[][] visit=new boolean[N][M];\n    int a=0,b=0;\n    while(a<N){ //å·¦å³è¾¹ç•Œ\n        if(A[a][0]==1 && !visit[a][0]) dfs(A,a,0,visit);\n        if(A[a][M-1]==1 && !visit[a][M-1]) dfs(A,a,M-1,visit);\n        a++;\n    }\n    while(b<M){ //ä¸Šä¸‹è¾¹ç•Œ\n        if(A[0][b]==1&& !visit[0][b]) dfs(A,0,b,visit);\n        if(A[N-1][b]==1&& !visit[N-1][b]) dfs(A,N-1,b,visit);\n        b++;\n    }\n    int res=0;\n    for (int i=0;i<N;i++) {\n        for (int j=0;j<M;j++) {\n            if(A[i][j]==1 && !visit[i][j]){\n                res++;\n            }\n        }\n    }\n    return res;\n}\n\npublic void dfs(int[][] A,int x,int y,boolean[][] visit){\n    visit[x][y]=true;\n    for (int i=0;i<dir.length;i++) {\n        int nx=x+dir[i][0];\n        int ny=y+dir[i][1];\n        if(valid(A,nx,ny) && !visit[nx][ny] && A[nx][ny]==1){\n            dfs(A,nx,ny,visit);\n        }\n    }\n}\n\npublic boolean valid(final int[][] A,int x,int y){\n    return x>=0 && x<A.length && y>=0 && y<A[0].length;\n}\n```\n\nå¹¶æŸ¥é›†çš„è§£æ³•æ”¾åœ¨ [å¹¶æŸ¥é›†ä¸“é¢˜](http://imlgw.top/2020/02/02/bing-cha-ji/) ä¸­\n\n## [934. æœ€çŸ­çš„æ¡¥](https://leetcode-cn.com/problems/shortest-bridge/)\n\nåœ¨ç»™å®šçš„äºŒç»´äºŒè¿›åˆ¶æ•°ç»„ `A` ä¸­ï¼Œå­˜åœ¨ä¸¤åº§å²›ã€‚ï¼ˆå²›æ˜¯ç”±å››é¢ç›¸è¿çš„ `1` å½¢æˆçš„ä¸€ä¸ªæœ€å¤§ç»„ã€‚ï¼‰\n\nç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† `0` å˜ä¸º `1`ï¼Œä»¥ä½¿ä¸¤åº§å²›è¿æ¥èµ·æ¥ï¼Œå˜æˆä¸€åº§å²›ã€‚\n\nè¿”å›å¿…é¡»ç¿»è½¬çš„ `0` çš„æœ€å°æ•°ç›®ã€‚ï¼ˆå¯ä»¥ä¿è¯ç­”æ¡ˆè‡³å°‘æ˜¯ 1ã€‚ï¼‰\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[[0,1],[1,0]]\nè¾“å‡ºï¼š1\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[[0,1,0],[0,0,0],[0,0,1]]\nè¾“å‡ºï¼š2\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[[1,1,1,1,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,1,1,1,1]]\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= A.length = A[0].length <= 100`\n2. `A[i][j] == 0` æˆ– `A[i][j] == 1`\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜è¿˜æŒºæœ‰æ„æ€çš„ï¼Œdfs+bfséƒ½è¦ç”¨ï¼Œå•çº¯çš„æ·±æœå’Œå¹¿æœå¾ˆéš¾æï¼Œå…ˆdfsç»™ä¸€ä¸ªå²›åšæ ‡è®°ï¼Œç„¶åå¤šæºbfsæ‰¾è·ç¦»æœ€è¿‘çš„å¦ä¸€ä¸ªå²›\n\n```java\nint[] dir = {0, 1, 0, -1, 0};\n\npublic int shortestBridge(int[][] A) {\n    boolean[][] mark = new boolean[A.length][A[0].length];\n    lable:\n    for (int i = 0; i < A.length; i++) {\n        for (int j = 0; j < A[0].length; j++) {\n            if (A[i][j] == 1) {\n                dfs(A, i, j, mark);\n                break lable;\n            }\n        }\n    }\n    Queue<Pair> queue = new LinkedList<>();\n    for (int i = 0; i < A.length; i++) {\n        for (int j = 0; j < A[0].length; j++) {\n            if (A[i][j] == 1 && mark[i][j]) {\n                queue.add(new Pair(i, j, 0));\n            }\n        }\n    }\n    while (!queue.isEmpty()) {\n        Pair pair = queue.poll();\n        for (int i = 0; i < 4; i++) {\n            int nx = pair.x + dir[i];\n            int ny = pair.y + dir[i + 1];\n            if (valid(A, nx, ny) && !mark[nx][ny]) {\n                if (A[nx][ny] == 1) {\n                    return pair.step;\n                }\n                mark[nx][ny] = true;\n                queue.add(new Pair(nx, ny, pair.step + 1));\n            }\n        }\n    }\n    return 1;\n}\n\npublic void dfs(int[][] A, int x, int y, boolean[][] mark) {\n    mark[x][y] = true;\n    for (int i = 0; i < 4; i++) {\n        int nx = x + dir[i];\n        int ny = y + dir[i + 1];\n        if (valid(A, nx, ny) && A[nx][ny] == 1 && !mark[nx][ny]) {\n            dfs(A, nx, ny, mark);\n        }\n    }\n}\n\npublic boolean valid(int[][] A, int x, int y) {\n    return x >= 0 && x < A.length && y >= 0 && y < A[0].length;\n}\n\nclass Pair {\n    int x, y;\n    int step;\n    public Pair(int x, int y, int step) {\n        this.x = x;\n        this.y = y;\n        this.step = step;\n    }\n}\n```\n\n## [733. å›¾åƒæ¸²æŸ“](https://leetcode-cn.com/problems/flood-fill/)\n\nDifficulty: **ç®€å•**\n\n\næœ‰ä¸€å¹…ä»¥äºŒç»´æ•´æ•°æ•°ç»„è¡¨ç¤ºçš„å›¾ç”»ï¼Œæ¯ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºè¯¥å›¾ç”»çš„åƒç´ å€¼å¤§å°ï¼Œæ•°å€¼åœ¨ 0 åˆ° 65535 ä¹‹é—´ã€‚\n\nç»™ä½ ä¸€ä¸ªåæ ‡Â `(sr, sc)`Â è¡¨ç¤ºå›¾åƒæ¸²æŸ“å¼€å§‹çš„åƒç´ å€¼ï¼ˆè¡Œ ï¼Œåˆ—ï¼‰å’Œä¸€ä¸ªæ–°çš„é¢œè‰²å€¼Â `newColor`ï¼Œè®©ä½ é‡æ–°ä¸Šè‰²è¿™å¹…å›¾åƒã€‚\n\nä¸ºäº†å®Œæˆä¸Šè‰²å·¥ä½œï¼Œä»åˆå§‹åæ ‡å¼€å§‹ï¼Œè®°å½•åˆå§‹åæ ‡çš„ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ä¸Šåƒç´ å€¼ä¸åˆå§‹åæ ‡ç›¸åŒçš„ç›¸è¿åƒç´ ç‚¹ï¼Œæ¥ç€å†è®°å½•è¿™å››ä¸ªæ–¹å‘ä¸Šç¬¦åˆæ¡ä»¶çš„åƒç´ ç‚¹ä¸ä»–ä»¬å¯¹åº”å››ä¸ªæ–¹å‘ä¸Šåƒç´ å€¼ä¸åˆå§‹åæ ‡ç›¸åŒçš„ç›¸è¿åƒç´ ç‚¹ï¼Œâ€¦â€¦ï¼Œé‡å¤è¯¥è¿‡ç¨‹ã€‚å°†æ‰€æœ‰æœ‰è®°å½•çš„åƒç´ ç‚¹çš„é¢œè‰²å€¼æ”¹ä¸ºæ–°çš„é¢œè‰²å€¼ã€‚\n\næœ€åè¿”å›ç»è¿‡ä¸Šè‰²æ¸²æŸ“åçš„å›¾åƒã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: \nimage = [[1,1,1],[1,1,0],[1,0,1]]\nsr = 1, sc = 1, newColor = 2\nè¾“å‡º: [[2,2,2],[2,2,0],[2,0,1]]\nè§£æ: \nåœ¨å›¾åƒçš„æ­£ä¸­é—´ï¼Œ(åæ ‡(sr,sc)=(1,1)),\nåœ¨è·¯å¾„ä¸Šæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„åƒç´ ç‚¹çš„é¢œè‰²éƒ½è¢«æ›´æ”¹æˆ2ã€‚\næ³¨æ„ï¼Œå³ä¸‹è§’çš„åƒç´ æ²¡æœ‰æ›´æ”¹ä¸º2ï¼Œ\nå› ä¸ºå®ƒä¸æ˜¯åœ¨ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ä¸Šä¸åˆå§‹ç‚¹ç›¸è¿çš„åƒç´ ç‚¹ã€‚\n```\n\n**æ³¨æ„:**\n\n*   `image` å’ŒÂ `image[0]`Â çš„é•¿åº¦åœ¨èŒƒå›´Â `[1, 50]` å†…ã€‚\n*   ç»™å‡ºçš„åˆå§‹ç‚¹å°†æ»¡è¶³Â `0 <= sr < image.length` å’ŒÂ `0 <= sc < image[0].length`ã€‚\n*   `image[i][j]` å’ŒÂ `newColor`Â è¡¨ç¤ºçš„é¢œè‰²å€¼åœ¨èŒƒå›´Â `[0, 65535]`å†…ã€‚\n\n**è§£æ³•ä¸€**\n\nç»å…¸æœç´¢ï¼Œæ²¡å•¥å¥½è¯´çš„\n```golang\nfunc floodFill(image [][]int, sr int, sc int, newColor int) [][]int {\n Â  Â var m = len(image)\n Â  Â var n = len(image[0])\n Â  Â var dir = []int{1, 0, -1, 0, 1}\n Â  Â var visit = make([][]bool, m)\n Â  Â for i := 0; i < m; i++ {\n Â  Â  Â  Â visit[i] = make([]bool, n)\n Â   }\n Â  Â var src = image[sr][sc]\n Â  Â var valid = func(x int, y int) bool {\n Â  Â  Â  Â return x >= 0 && x < m && y >= 0 && y < n\n Â   }\n Â  Â var dfs func(x int, y int)\n Â  Â dfs = func(x int, y int) {\n Â  Â  Â  Â visit[x][y] = true\n Â  Â  Â  Â image[x][y] = newColor\n Â  Â  Â  Â for i := 0; i < 4; i++ {\n Â  Â  Â  Â  Â  Â var nx = x + dir[i]\n Â  Â  Â  Â  Â  Â var ny = y + dir[i+1]\n Â  Â  Â  Â  Â  Â if valid(nx, ny) && !visit[nx][ny] && image[nx][ny] == src {\n Â  Â  Â  Â  Â  Â  Â  Â dfs(nx, ny)\n Â  Â  Â  Â  Â   } \n Â  Â  Â   }\n Â   }\n Â  Â dfs(sr, sc)\n Â  Â return image\n}\n```\né€šè¿‡æŸ“è‰²çš„æƒ…å†µåˆ¤æ–­æ˜¯å¦éå†è¿‡èŠ‚ç‚¹ï¼ŒèŠ‚çœvisitæ•°ç»„\n```golang\nfunc floodFill(image [][]int, sr int, sc int, newColor int) [][]int {\n    var m = len(image)\n    var n = len(image[0])\n    var dir = []int{1, 0, -1, 0, 1}\n    var src = image[sr][sc]\n    var valid = func(x int, y int) bool {\n        return x >= 0 && x < m && y >= 0 && y < n\n    }\n    var dfs func(x int, y int)\n    dfs = func(x int, y int) {\n        image[x][y] = newColor\n        for i := 0; i < 4; i++ {\n            var nx = x + dir[i]\n            var ny = y + dir[i+1]\n            if valid(nx, ny) && image[nx][ny]!=newColor && image[nx][ny] == src {\n                dfs(nx, ny)\n            } \n        }\n    }\n    dfs(sr, sc)\n    return image\n}\n```\n\n## [1559. äºŒç»´ç½‘æ ¼å›¾ä¸­æ¢æµ‹ç¯](https://leetcode-cn.com/problems/detect-cycles-in-2d-grid/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™ä½ ä¸€ä¸ªäºŒç»´å­—ç¬¦ç½‘æ ¼æ•°ç»„Â `grid`Â ï¼Œå¤§å°ä¸ºÂ `m x n`Â ï¼Œä½ éœ€è¦æ£€æŸ¥Â `grid`Â ä¸­æ˜¯å¦å­˜åœ¨ **ç›¸åŒå€¼** å½¢æˆçš„ç¯ã€‚\n\nä¸€ä¸ªç¯æ˜¯ä¸€æ¡å¼€å§‹å’Œç»“æŸäºåŒä¸€ä¸ªæ ¼å­çš„é•¿åº¦ **å¤§äºç­‰äº 4**Â çš„è·¯å¾„ã€‚å¯¹äºä¸€ä¸ªç»™å®šçš„æ ¼å­ï¼Œä½ å¯ä»¥ç§»åŠ¨åˆ°å®ƒä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘ç›¸é‚»çš„æ ¼å­ä¹‹ä¸€ï¼Œå¯ä»¥ç§»åŠ¨çš„å‰ææ˜¯è¿™ä¸¤ä¸ªæ ¼å­æœ‰ **ç›¸åŒçš„å€¼Â **ã€‚\n\nåŒæ—¶ï¼Œä½ ä¹Ÿä¸èƒ½å›åˆ°ä¸Šä¸€æ¬¡ç§»åŠ¨æ—¶æ‰€åœ¨çš„æ ¼å­ã€‚æ¯”æ–¹è¯´ï¼Œç¯Â Â `(1, 1) -> (1, 2) -> (1, 1)`Â æ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸ºä» `(1, 2)`Â ç§»åŠ¨åˆ° `(1, 1)` å›åˆ°äº†ä¸Šä¸€æ¬¡ç§»åŠ¨æ—¶çš„æ ¼å­ã€‚\n\nå¦‚æœ `grid`Â ä¸­æœ‰ç›¸åŒå€¼å½¢æˆçš„ç¯ï¼Œè¯·ä½ è¿”å› `true`Â ï¼Œå¦åˆ™è¿”å› `false`Â ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![](https://i.loli.net/2020/12/16/IF9PVSHoOXtZwRr.png)\n\n```golang\nè¾“å…¥ï¼šgrid = [[\"a\",\"a\",\"a\",\"a\"],[\"a\",\"b\",\"b\",\"a\"],[\"a\",\"b\",\"b\",\"a\"],[\"a\",\"a\",\"a\",\"a\"]]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ‰ 2 ä¸ªç”¨ä¸åŒé¢œè‰²æ ‡å‡ºæ¥çš„ç¯ï¼š\n```\n![](https://i.loli.net/2020/12/16/8EJDuUPc2xMilBm.png)\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![](https://i.loli.net/2020/12/16/eljrFPCzf4pgd6s.png)\n\n```golang\nè¾“å…¥ï¼šgrid = [[\"c\",\"c\",\"c\",\"a\"],[\"c\",\"d\",\"c\",\"c\"],[\"c\",\"c\",\"e\",\"c\"],[\"f\",\"c\",\"c\",\"c\"]]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåªæœ‰é«˜äº®æ‰€ç¤ºçš„ä¸€ä¸ªåˆæ³•ç¯ï¼š\n```\n![](https://i.loli.net/2020/12/16/9FfYxP7DSUBXEaG.png)\n\n**ç¤ºä¾‹ 3ï¼š**\n\n![](https://i.loli.net/2020/12/16/fAr1TEQNpumaXck.png)\n\n```golang\nè¾“å…¥ï¼šgrid = [[\"a\",\"b\",\"b\"],[\"b\",\"z\",\"b\"],[\"b\",\"b\",\"a\"]]\nè¾“å‡ºï¼šfalse\n```\n\n**æç¤ºï¼š**\n\n*   `m == grid.length`\n*   `n == grid[i].length`\n*   `1 <= m <= 500`\n*   `1 <= n <= 500`\n*   `grid`Â åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚\n\n\n**è§£æ³•ä¸€**\n\n33åŒå‘¨èµ›çš„T4ï¼Œæ€»ä½“ä¸æ˜¯å¾ˆéš¾ï¼Œdfsæˆ–è€…å¹¶æŸ¥é›†éƒ½å¯ä»¥\n```golang\nfunc containsCycle(grid [][]byte) bool {\n    var m, n = len(grid), len(grid[0])\n    var dir = [4][2]int{{0,1},{1,0},{-1,0},{0,-1}}\n    var visit = make([][]bool, m)\n    for i := 0; i < m; i++ {\n        visit[i] = make([]bool, n)\n    }\n    var valid = func(x, y int) bool { return x >= 0 && x < m && y >= 0 && y < n}\n    var dfs func (int, int, int, int)\n    var res = false\n    dfs = func(preX int, preY int, x int, y int) {\n        if visit[x][y] || res{\n            res = true\n            return\n        }\n        visit[x][y] = true\n        for i := 0; i < len(dir); i++ {\n            nx := x + dir[i][0]\n            ny := y + dir[i][1]\n            //ä¸èµ°å›å¤´è·¯\n            if nx == preX && ny == preY {\n                continue\n            }\n            if valid(nx, ny) && grid[nx][ny] == grid[x][y] {\n                dfs(x, y, nx, ny)\n            }\n        }\n    }\n    for i := 0; i < m; i++ {\n        for j := 0; j < n; j++ {\n            if !visit[i][j] {\n                dfs(i,j,i,j)\n            }\n        }\n    }\n    return res\n}\n```\n**è§£æ³•äºŒ**\n\nå¹¶æŸ¥é›†çš„è§£æ³•ï¼Œç•™ç€ä»¥åå†æ¥å†™\n\n## [332. é‡æ–°å®‰æ’è¡Œç¨‹](https://leetcode-cn.com/problems/reconstruct-itinerary/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªæœºç¥¨çš„å­—ç¬¦ä¸²äºŒç»´æ•°ç»„ `[from, to]`ï¼Œå­æ•°ç»„ä¸­çš„ä¸¤ä¸ªæˆå‘˜åˆ†åˆ«è¡¨ç¤ºé£æœºå‡ºå‘å’Œé™è½çš„æœºåœºåœ°ç‚¹ï¼Œå¯¹è¯¥è¡Œç¨‹è¿›è¡Œé‡æ–°è§„åˆ’æ’åºã€‚æ‰€æœ‰è¿™äº›æœºç¥¨éƒ½å±äºä¸€ä¸ªä» JFKï¼ˆè‚¯å°¼è¿ªå›½é™…æœºåœºï¼‰å‡ºå‘çš„å…ˆç”Ÿï¼Œæ‰€ä»¥è¯¥è¡Œç¨‹å¿…é¡»ä» JFK å¼€å§‹ã€‚\n\n**æç¤ºï¼š**\n\n1.  å¦‚æœå­˜åœ¨å¤šç§æœ‰æ•ˆçš„è¡Œç¨‹ï¼Œè¯·ä½ æŒ‰å­—ç¬¦è‡ªç„¶æ’åºè¿”å›æœ€å°çš„è¡Œç¨‹ç»„åˆã€‚ä¾‹å¦‚ï¼Œè¡Œç¨‹ [\"JFK\", \"LGA\"] ä¸ [\"JFK\", \"LGB\"] ç›¸æ¯”å°±æ›´å°ï¼Œæ’åºæ›´é å‰\n2.  æ‰€æœ‰çš„æœºåœºéƒ½ç”¨ä¸‰ä¸ªå¤§å†™å­—æ¯è¡¨ç¤ºï¼ˆæœºåœºä»£ç ï¼‰ã€‚\n3.  å‡å®šæ‰€æœ‰æœºç¥¨è‡³å°‘å­˜åœ¨ä¸€ç§åˆç†çš„è¡Œç¨‹ã€‚\n4.  æ‰€æœ‰çš„æœºç¥¨å¿…é¡»éƒ½ç”¨ä¸€æ¬¡ ä¸” åªèƒ½ç”¨ä¸€æ¬¡ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š[[\"MUC\", \"LHR\"], [\"JFK\", \"MUC\"], [\"SFO\", \"SJC\"], [\"LHR\", \"SFO\"]]\nè¾“å‡ºï¼š[\"JFK\", \"MUC\", \"LHR\", \"SFO\", \"SJC\"]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š[[\"JFK\",\"SFO\"],[\"JFK\",\"ATL\"],[\"SFO\",\"ATL\"],[\"ATL\",\"JFK\"],[\"ATL\",\"SFO\"]]\nè¾“å‡ºï¼š[\"JFK\",\"ATL\",\"JFK\",\"SFO\",\"ATL\",\"SFO\"]\nè§£é‡Šï¼šå¦ä¸€ç§æœ‰æ•ˆçš„è¡Œç¨‹æ˜¯Â [\"JFK\",\"SFO\",\"ATL\",\"JFK\",\"ATL\",\"SFO\"]ã€‚ä½†æ˜¯å®ƒè‡ªç„¶æ’åºæ›´å¤§æ›´é åã€‚\n```\n\n**è§£æ³•ä¸€**\n\næ¬§æ‹‰å›è·¯ï¼Œä¸€ç¬”ç”»ï¼Œååºéå†ï¼Œå…ˆå°è¯•å®Œæ‰€æœ‰çš„å­èŠ‚ç‚¹æœ€ååœ¨æ·»åŠ å½“å‰èŠ‚ç‚¹ï¼Œç¡®ä¿æ­»èƒ¡åŒä¼šè¢«é¦–å…ˆåŠ å…¥ï¼Œè¿™æ ·resä¸­å°±ä¿æŒäº†ç­”æ¡ˆçš„é€†åº\n```golang\n//æ¬§æ‹‰å›è·¯ï¼Œä¸€ç¬”ç”»é—®é¢˜\nfunc findItinerary(tickets [][]string) []string {\n    var adj = make(map[string][]string)\n    for _, tick := range tickets {\n        adj[tick[0]] = append(adj[tick[0]], tick[1])\n    }\n    for _, toList := range adj {\n        sort.Strings(toList)\n    }\n    var res []string\n    var dfs func (cur string) \n    dfs = func (cur string) {\n        for len(adj[cur]) != 0 {\n            //åˆ é™¤èŠ‚ç‚¹ï¼Œé¿å…é‡å¤è®¿é—®\n            to := adj[cur][0]\n            adj[cur] = adj[cur][1:]\n            dfs(to)\n        }\n        //ååºéå†ï¼Œæœ€åå°†è·¯å¾„æ·»åŠ è¿›å»ï¼Œä¿è¯æ­»èƒ¡åŒä¼šé¦–å…ˆåŠ å…¥\n        res = append(res, cur)\n    }\n    dfs(\"JFK\")\n    //ç¿»è½¬ä¸‹\n    for i, j := 0, len(res)-1; i < j; i, j = i+1, j-1 {\n        res[i], res[j] = res[j], res[i]\n    }\n    return res\n}\n```\n\n## [841. é’¥åŒ™å’Œæˆ¿é—´](https://leetcode-cn.com/problems/keys-and-rooms/)\n\nDifficulty: **ä¸­ç­‰**\n\n\næœ‰ `N` ä¸ªæˆ¿é—´ï¼Œå¼€å§‹æ—¶ä½ ä½äº `0` å·æˆ¿é—´ã€‚æ¯ä¸ªæˆ¿é—´æœ‰ä¸åŒçš„å·ç ï¼š`0ï¼Œ1ï¼Œ2ï¼Œ...ï¼ŒN-1`ï¼Œå¹¶ä¸”æˆ¿é—´é‡Œå¯èƒ½æœ‰ä¸€äº›é’¥åŒ™èƒ½ä½¿ä½ è¿›å…¥ä¸‹ä¸€ä¸ªæˆ¿é—´ã€‚\n\nåœ¨å½¢å¼ä¸Šï¼Œå¯¹äºæ¯ä¸ªæˆ¿é—´ `i` éƒ½æœ‰ä¸€ä¸ªé’¥åŒ™åˆ—è¡¨ `rooms[i]`ï¼Œæ¯ä¸ªé’¥åŒ™ `rooms[i][j]` ç”± `[0,1ï¼Œ...ï¼ŒN-1]` ä¸­çš„ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºï¼Œå…¶ä¸­ `N = rooms.length`ã€‚ é’¥åŒ™ `rooms[i][j] = v` å¯ä»¥æ‰“å¼€ç¼–å·ä¸º `v` çš„æˆ¿é—´ã€‚\n\næœ€åˆï¼Œé™¤ `0` å·æˆ¿é—´å¤–çš„å…¶ä½™æ‰€æœ‰æˆ¿é—´éƒ½è¢«é”ä½ã€‚\n\nä½ å¯ä»¥è‡ªç”±åœ°åœ¨æˆ¿é—´ä¹‹é—´æ¥å›èµ°åŠ¨ã€‚\n\nå¦‚æœèƒ½è¿›å…¥æ¯ä¸ªæˆ¿é—´è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥: [[1],[2],[3],[]]\nè¾“å‡º: true\nè§£é‡Š:  \næˆ‘ä»¬ä» 0 å·æˆ¿é—´å¼€å§‹ï¼Œæ‹¿åˆ°é’¥åŒ™ 1ã€‚\nä¹‹åæˆ‘ä»¬å» 1 å·æˆ¿é—´ï¼Œæ‹¿åˆ°é’¥åŒ™ 2ã€‚\nç„¶åæˆ‘ä»¬å» 2 å·æˆ¿é—´ï¼Œæ‹¿åˆ°é’¥åŒ™ 3ã€‚\næœ€åæˆ‘ä»¬å»äº† 3 å·æˆ¿é—´ã€‚\nç”±äºæˆ‘ä»¬èƒ½å¤Ÿè¿›å…¥æ¯ä¸ªæˆ¿é—´ï¼Œæˆ‘ä»¬è¿”å› trueã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š[[1,3],[3,0,1],[2],[0]]\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šæˆ‘ä»¬ä¸èƒ½è¿›å…¥ 2 å·æˆ¿é—´ã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  `1 <= rooms.length <=Â 1000`\n2.  `0 <= rooms[i].length <= 1000`\n3.  æ‰€æœ‰æˆ¿é—´ä¸­çš„é’¥åŒ™æ•°é‡æ€»è®¡ä¸è¶…è¿‡Â `3000`ã€‚\n\n**è§£æ³•ä¸€**\n\næ²¡å•¥å¥½è¯´çš„\n```golang\nfunc canVisitAllRooms(rooms [][]int) bool {\n Â  Â var n = len(rooms)\n Â  Â var visit = make([]bool, n)\n Â  Â var dfs func(int)\n Â  Â var count = 0\n Â  Â dfs = func(idx int) {\n Â  Â  Â  Â visit[idx] = true\n Â  Â  Â  Â count++\n Â  Â  Â  Â for i := 0; i < len(rooms[idx]); i++ {\n Â  Â  Â  Â  Â  Â if !visit[rooms[idx][i]] {\n Â  Â  Â  Â  Â  Â  Â  Â dfs(rooms[idx][i]) Â  \n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â   }\n Â  Â dfs(0)\n Â  Â return count == n\n}\n```\n\n## _åˆ†æ²»_\n\nå¼€ä¸ªæ–°å‘ï¼Œå…¶å®åˆ†æ²»è¿™ä¸ªtagæŒºå¤§çš„ï¼Œå¾ˆå¤šé¢˜çš„åšæ³•éƒ½å±äºåˆ†æ²»ï¼Œè€Œä¸”æ¶‰åŠåˆ°åˆ†æ²»çš„é¢˜ç›®ä¸€èˆ¬éƒ½è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„ï¼Œä¸å®¹æ˜“ç›´æ¥æƒ³å‡ºæ¥\n\n## [241. ä¸ºè¿ç®—è¡¨è¾¾å¼è®¾è®¡ä¼˜å…ˆçº§](https://leetcode-cn.com/problems/different-ways-to-add-parentheses/)\n\nç»™å®šä¸€ä¸ªå«æœ‰æ•°å­—å’Œè¿ç®—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä¸ºè¡¨è¾¾å¼æ·»åŠ æ‹¬å·ï¼Œæ”¹å˜å…¶è¿ç®—ä¼˜å…ˆçº§ä»¥æ±‚å‡ºä¸åŒçš„ç»“æœã€‚ä½ éœ€è¦ç»™å‡ºæ‰€æœ‰å¯èƒ½çš„ç»„åˆçš„ç»“æœã€‚æœ‰æ•ˆçš„è¿ç®—ç¬¦å·åŒ…å« +, - ä»¥åŠ * ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"2-1-1\"\nè¾“å‡º: [0, 2]\nè§£é‡Š: \n((2-1)-1) = 0 \n(2-(1-1)) = 2\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"2*3-4*5\"\nè¾“å‡º: [-34, -14, -10, -10, 10]\nè§£é‡Š: \n(2*(3-(4*5))) = -34 \n((2*3)-(4*5)) = -14 \n((2*(3-4))*5) = -10 \n(2*((3-4)*5)) = -10 \n(((2*3)-4)*5) = 10\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å’‹è¯´å‘¢ï¼Œåº”è¯¥ä¸ç®—æ˜¯å›æº¯ï¼Œæ˜¯åœ¨åˆ†æ²»tagä¸­æ‰¾çš„ä¸€é¢˜ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„\n\n```java\nprivate Map<String,List<Integer>> map=new HashMap<>();\n\n//åˆ†æ²»\npublic List<Integer> diffWaysToCompute(String input) {\n    if (input==null || input.length()<=0) {\n        return new LinkedList<>();\n    }\n    return diffWaysToCompute(input,0,input.length()-1);\n}\n\npublic List<Integer> diffWaysToCompute(String input,int left,int right) {\n    List<Integer> res=new LinkedList<>();\n    /*if (left==right) { //è¿™ä¸€æ­¥å¯ä»¥å»æ‰,æœ€å¼€å§‹æ²¡è€ƒè™‘å¤šä½æ•°çš„æƒ…å†µ(è€ƒè™‘åˆ°äº†ä¸çŸ¥é“æ€ä¹ˆå¤„ç†)\n            res.add(Integer.valueOf(input.charAt(left))-48);\n            return res;\n        }*/\n    String key=input.substring(left,right+1);\n    if (map.containsKey(key)) {\n        return map.get(key);\n    }\n    for (int i=left;i<=right;i++) { //å¤§æ„äº†,è¿™é‡Œä¸€å¼€å§‹å†™æˆäº†input.length...\n        char c=input.charAt(i);\n        if (c<'0') {\n            List<Integer> leftCompute=diffWaysToCompute(input,left,i-1);\n            List<Integer> rightCompute=diffWaysToCompute(input,i+1,right);\n            for (int lc:leftCompute) {\n                for (int rc:rightCompute) {\n                    if (c=='+') \n                        res.add(lc+rc);\n                    if (c=='-') \n                        res.add(lc-rc);\n                    if (c=='*') \n                        res.add(lc*rc);\n                }\n            }\n        }\n    }\n    if (res.isEmpty()) {\n        res.add(Integer.valueOf(key));\n    }\n    map.put(key,res);\n    return res;\n}\n```\n\nç¬¬ä¸€å¤©çœ‹äº†è¿™é“é¢˜ï¼Œæ²¡æƒ³åˆ°æ€è·¯ï¼Œç„¶åç„äº†ä¸€çœ¼è¯„è®ºåŒºï¼Œçœ‹åˆ°äº†å…³é”®ç‚¹ï¼Œæ‰¾åˆ°è¿ç®—ç¬¦ï¼Œç„¶åå·¦å³åˆ†åˆ«é€’å½’ï¼Œæ²¡çœ‹åˆ°ç»†èŠ‚ï¼Œç¬¬äºŒå¤©å›å¿†äº†ä¸‹æ€è·¯å†™å‡ºäº†è§£ï¼Œå…¶å®è¿™é¢˜å¯ä»¥å‚è€ƒ[95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II](https://leetcode-cn.com/problems/unique-binary-search-trees-ii/) æˆ‘åœ¨æˆ‘çš„ [äºŒå‰æ ‘ä¸“é¢˜](http://imlgw.top/2019/11/06/leetcode-er-cha-shu/) ä¸­ä¹ŸåŠ äº†è¿™é“é¢˜ï¼Œä¸¤è€…è§£æ³•æä¸ºç›¸ä¼¼\n\n## [395. è‡³å°‘æœ‰Kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²](https://leetcode-cn.com/problems/longest-substring-with-at-least-k-repeating-characters/)\n\nDifficulty: **ä¸­ç­‰**\n\næ‰¾åˆ°ç»™å®šå­—ç¬¦ä¸²ï¼ˆç”±å°å†™å­—ç¬¦ç»„æˆï¼‰ä¸­çš„æœ€é•¿å­ä¸²`T`ï¼ŒÂ è¦æ±‚Â `T`Â ä¸­çš„æ¯ä¸€å­—ç¬¦å‡ºç°æ¬¡æ•°éƒ½ä¸å°‘äº `k` ã€‚è¾“å‡º `T`çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥:\ns = \"aaabb\", k = 3\n\nè¾“å‡º:\n3\n\næœ€é•¿å­ä¸²ä¸º \"aaa\" ï¼Œå…¶ä¸­ 'a' é‡å¤äº† 3 æ¬¡ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥:\ns = \"ababbc\", k = 2\n\nè¾“å‡º:\n5\n\næœ€é•¿å­ä¸²ä¸º \"ababb\" ï¼Œå…¶ä¸­ 'a' é‡å¤äº† 2 æ¬¡ï¼Œ 'b' é‡å¤äº† 3 æ¬¡ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nä»¥å‡ºç°æ¬¡æ•°æœ€å°‘çš„å­—ç¬¦ä¸ºä¸­ç‚¹åˆ†æ²»ï¼Œä½†æ˜¯æ•ˆç‡æ„Ÿäººï¼Œ380ms+\n```java\npublic int longestSubstring(String s, int k) {\n    if (s == null || s.length() == 0){\n        return 0;\n    }\n    int[] count = new int[26];\n    for(int i = 0; i < s.length(); i++){\n        count[s.charAt(i)-'a']++;\n    }\n    int min = 0; //è®°å½•countæœ€å°çš„index\n    for(int i = 0;i < s.length(); i++){\n        min = count[s.charAt(i)-'a'] < count[s.charAt(min)-'a'] ? i : min;\n    }\n    if (count[s.charAt(min)-'a'] >= k) {\n        return s.length();\n    }\n    return Math.max(longestSubstring(s.substring(0,min),k),longestSubstring(s.substring(min+1),k));\n}\n```\n\n**è§£æ³•äºŒ**\n\nå‚è€ƒäº†é¢˜è§£åŒºå¤§ä½¬ä»¬çš„å‰ªæå’Œä¼˜åŒ–æ–¹æ³•ï¼Œå¾ªç¯ä»¥æ¯ä¸ªå°äºkçš„å­—ç¬¦ä¸ºç»“å°¾ï¼Œåˆ†å‰²å­—ç¬¦ï¼Œå¤šè·¯åˆ†æ²»ï¼Œå¤§å¤§é™ä½åˆ†æ²»é€’å½’æ ‘çš„é«˜åº¦\n```java\n//1ms å¤šè·¯åˆ†æ²»ï¼Œè™½ç„¶è¿‡äº†ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹ä¸æµç•…\n//ä¸»è¦å°±æ˜¯æœ€åé‚£ä¸ªå½“ä»¥å¤§äºkçš„å­—ç¬¦ç»“å°¾çš„æ—¶å€™çš„é¢å¤–å¤„ç†ï¼Œå¦‚æœä¸waä¸€å‘ä¸å®¹æ˜“å‘ç°\npublic int longestSubstring(String s, int k) {\n    if (s == null || s.length() == 0){\n        return 0;\n    }\n    int[] count = new int[26];\n    for(int i = 0; i < s.length(); i++){\n        count[s.charAt(i)-'a']++;\n    }\n    int res = 0;\n    int left = 0; //åˆ†æ²»å·¦ç«¯ç‚¹\n    boolean flag = false;\n    for(int i = 0; i < s.length(); i++){\n        if(count[s.charAt(i)-'a'] < k){\n            flag = true;\n            if(i - left >= res){ //å‰ªæä¼˜åŒ–\n                res = Math.max(longestSubstring(s.substring(left,i),k),res);\n            }\n            left = i+1;\n        }\n    }\n    if(!flag) return s.length();\n    //ä¸Šé¢åˆ†æ²»çš„é€»è¾‘æ˜¯ä»¥leftåˆ°å°äºkçš„å­—æ¯iè¿›è¡Œåˆ†æ²»ï¼Œä½†æ˜¯å¦‚æœå­—ç¬¦ä¸æ˜¯ä»¥å°äºkçš„å­—æ¯ç»“å°¾å°±æ— æ³•è®¡ç®—\n    //eg: aabbb k=3\n    return Math.max(res,longestSubstring(s.substring(left),k));\n}\n```\nå…¶å®è¿˜è¦å¾ˆå¤šåˆ†æ²»çš„æ–¹æ³•ï¼Œä½†æ˜¯æ„Ÿè§‰éƒ½å¤§åŒå°å¼‚","tags":["LeetCode","å›æº¯"],"categories":["ç®—æ³•"]},{"title":"LeetCodeæ ˆ&é˜Ÿåˆ—","url":"/2019/10/01/leetcode-zhan-dui-lie/","content":"\n## [20. æœ‰æ•ˆçš„æ‹¬å·](https://leetcode-cn.com/problems/valid-parentheses/)\n\nGiven a string containing just the characters `'('`, `')'`, `'{'`, `'}'`, `'['` and `']'`, determine if the input string is valid.\n\nAn input string is valid if:\n\n1. Open brackets must be closed by the same type of brackets.\n2. Open brackets must be closed in the correct order.\n\nNote that an empty string is also considered valid.\n\n**Example 1:**\n\n```java\nInput: \"()\"\nOutput: true\n```\n\n**Example 2:**\n\n```java\nInput: \"()[]{}\"\nOutput: true\n```\n\n**Example 3:**\n\n```java\nInput: \"(]\"\nOutput: false\n```\n\n**Example 4:**\n\n```java\nInput: \"([)]\"\nOutput: false\n```\n\n**Example 5:**\n\n```java\nInput: \"{[]}\"\nOutput: true\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é“é¢˜åªè¦å­¦è¿‡æ•°æ®ç»“æ„çš„è‚¯å®šä¼šåšï¼Œå…¸å‹çš„åˆ©ç”¨æ ˆçš„é¢˜\n\n```java\npublic boolean isValid2(String s) {\n    if(s.length()<=0){\n        return true;\n    }\n    Stack<Character> stack=new Stack();\n    for(int i=0;i<s.length();i++){\n        if(s.charAt(i)=='(' || s.charAt(i)=='{' || s.charAt(i)=='['){\n            stack.push(s.charAt(i));\n        }else{\n            //æ³¨æ„è¿™ç§æƒ…å†µï¼Œä¸€å¼€å§‹å°±æ˜¯])}\n            if(stack.isEmpty()){\n                return false;\n            }\n            char p=s.charAt(i);\n            if( (p==')' && stack.pop()!='(') || (p==']' && stack.pop()!='[') || (p=='}' && stack.pop()!='{')){\n                return false;\n            }\n        }\n    }\n    return stack.isEmpty();\n}\n```\n**è§£æ³•äºŒ**\n\nå…¶å®å’Œä¸Šé¢çš„è§£æ³•æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯ç”¨çš„stackæ˜¯è‡ªå·±ç”¨æ•°ç»„ç®€å•å°è£…çš„æ ˆ\n\n```java\npublic class MyStack<T>{\n\n    T [] objValues=null;\n\n    int top=-1;\n\n    public MyStack(int size){\n        objValues= (T[]) new Object[size];\n    }\n\n    public void push(T obj){\n        objValues[++top]=obj;\n    }\n\n    public T peek(){\n        if (top<0) {\n            throw new RuntimeException(\"stack is isEmpty\");\n        }\n        return objValues[top];\n    }\n\n    public T pop(){\n        if (top<0) {\n            throw new RuntimeException(\"stack is isEmpty\");\n        }\n        //è¦†ç›–\n        return objValues[top--];\n    }\n\n    public boolean isEmpty(){\n        return top<0;\n    }\n}\n```\n\n3msï¼Œ94%ï¼Œæ¯”ä¹‹å‰å¿«äº†ä¸€ç‚¹ï¼Œå»çœ‹äº†ä¸‹Stackçš„æºç ï¼Œå®ƒçš„popæ˜¯çœŸçš„åˆ é™¤ï¼Œæˆ‘çš„åªæ˜¯ç§»åŠ¨äº†æŒ‡é’ˆï¼Œæ‰€ä»¥æ•ˆç‡ä¼šé«˜å¾ˆå¤š\n\n> åé¢çš„é¢˜å¯èƒ½è¿˜ä¼šåˆ©ç”¨è¿™ä¸ª`MyStack`\n\n**è§£æ³•ä¸‰**\n\nä»Šå¤©çœ‹é¢ç­‹çœ‹åˆ°ä¸€ä¸ªå†™è¿™é“é¢˜ï¼Œè¦æ±‚O(1)çš„ç©ºé—´å¤æ‚åº¦\n\n```java\npublic boolean isValid(String s) {\n    if(s.length()<=0){\n        return true;\n    }\n    while(true){\n        int len=s.length();\n        s=s.replace(\"{}\",\"\");\n        s=s.replace(\"()\",\"\");\n        s=s.replace(\"[]\",\"\");\n        if (len==s.length()) {\n            break;\n        }\n    }\n    return \"\".equals(s);\n}\n```\n100msï¼Œæ•ˆç‡æ„Ÿäººï¼Œæ„Ÿè§‰åº”è¯¥è¯´çš„æ˜¯è¿™ç§åšæ³•å§ï¼Œå½“ç„¶è¿˜å¯ä»¥å†™æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ï¼Œä½†æ˜¯æˆ‘ä¸å¤ªä¼šå†™ã€‚ã€‚ã€‚\n\n## [678. æœ‰æ•ˆçš„æ‹¬å·å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/valid-parenthesis-string/)\n\nç»™å®šä¸€ä¸ªåªåŒ…å«ä¸‰ç§å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼šï¼ˆ ï¼Œï¼‰ å’Œ *ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥æ£€éªŒè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆå­—ç¬¦ä¸²ã€‚æœ‰æ•ˆå­—ç¬¦ä¸²å…·æœ‰å¦‚ä¸‹è§„åˆ™ï¼š\n\n1. ä»»ä½•å·¦æ‹¬å· `(` å¿…é¡»æœ‰ç›¸åº”çš„å³æ‹¬å· `)`ã€‚\n2. ä»»ä½•å³æ‹¬å· `)` å¿…é¡»æœ‰ç›¸åº”çš„å·¦æ‹¬å· `(` ã€‚\n3. å·¦æ‹¬å· `(` å¿…é¡»åœ¨å¯¹åº”çš„å³æ‹¬å·ä¹‹å‰ `)`ã€‚\n4. `*` å¯ä»¥è¢«è§†ä¸ºå•ä¸ªå³æ‹¬å· `)` ï¼Œæˆ–å•ä¸ªå·¦æ‹¬å· `(` ï¼Œæˆ–ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚\n5. ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä¹Ÿè¢«è§†ä¸ºæœ‰æ•ˆå­—ç¬¦ä¸²ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"()\"\nè¾“å‡º: True\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"(*)\"\nè¾“å‡º: True\n```\n\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: \"(*))\"\nè¾“å‡º: True\n```\n\n\n**æ³¨æ„:**\n\n1. å­—ç¬¦ä¸²å¤§å°å°†åœ¨ [1ï¼Œ100] èŒƒå›´å†…ã€‚\n\n**è§£æ³•ä¸€**\n\nçœ‹é¢ç­‹çœ‹åˆ°çš„è¿™ä¸€é¢˜ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè¯„è®ºåŒºæœ‰äººè¯´äº†åŒæ ˆï¼Œç„¶åä»Šå¤©æ¥è¯•äº†ä¸‹\n\n```java\npublic boolean checkValidString(String s) {\n    Stack<Integer> bracketStack=new Stack<>();\n    Stack<Integer> starStack=new Stack<>();\n    for (int i=0;i<s.length();i++) {\n        if (s.charAt(i)=='(') {\n            bracketStack.push(i);\n        }else if(s.charAt(i)=='*'){\n            starStack.push(i);\n        }else{\n            if (bracketStack.isEmpty()) {\n                if (starStack.isEmpty()) {\n                    return false;\n                }\n                starStack.pop();\n            }else{\n                bracketStack.pop();\n            }\n        }\n    }\n    //æ¶ˆé™¤å·¦æ‹¬å·\n    while(!starStack.isEmpty() && !bracketStack.isEmpty()){\n        if(starStack.peek()>bracketStack.peek()){ //è¿™é‡Œçš„é€»è¾‘ä¸å¤ªå¥½ï¼Œå…¶å®å¯ä»¥å¾ˆç®€å•\n            bracketStack.pop();\n        }\n        starStack.pop();\n    }\n    return bracketStack.isEmpty();\n}\n```\n\nå¾ˆå¯æƒœæ²¡æœ‰`bugfree`ï¼Œæœ€åå¯¹å·¦æ‹¬å·çš„åˆ¤æ–­æ”¹äº†å¥½å‡ æ¬¡ï¼Œä¸€å¼€å§‹å†™çš„`bracketStack.size()<=starStack().size()`  ç„¶åæäº¤åæ‰æ„è¯†åˆ°è¿˜è¦ `\"*(\"` è¿™æ ·çš„æƒ…å†µï¼Œç„¶åè¦æ¶ˆé™¤è¿™ç§æƒ…å†µä¹Ÿç®€å•ï¼Œä¸€å¼€å§‹æˆ‘å†æ ˆä¸­å­˜çš„å°±æ˜¯indexï¼Œä»staræ ˆé‡Œé¢å–æ¯”bracketæ ˆindexå¤§çš„ï¼Œç„¶åæ¶ˆé™¤ï¼Œæœ€åå†çœ‹æ‹¬å·æ ˆæ˜¯ä¸æ˜¯ç©º\n\n```java\n//2020.4.10é‡å†™ä¸€ä¸‹\npublic boolean checkValidString(String s) {\n    Deque<Integer> stack=new ArrayDeque<>();\n    Deque<Integer> helpStack=new ArrayDeque<>();\n    for(int i=0;i<s.length();i++){\n        if(s.charAt(i)=='('){\n            stack.push(i);\n        }else if(s.charAt(i)==')'){\n            if(!stack.isEmpty()){\n                stack.pop();\n            }else{\n                if(helpStack.isEmpty()){\n                    return false;\n                }\n                helpStack.pop();\n            }\n        }else{\n            helpStack.push(i);\n        }\n    }\n    while(!stack.isEmpty() && !helpStack.isEmpty()){\n        if(stack.pop()>helpStack.pop()){\n            return false;\n        }\n    }\n    return stack.isEmpty();\n}\n```\n## [921. ä½¿æ‹¬å·æœ‰æ•ˆçš„æœ€å°‘æ·»åŠ ](https://leetcode-cn.com/problems/minimum-add-to-make-parentheses-valid/)\n\nç»™å®šä¸€ä¸ªç”± `'('` å’Œ `')'` æ‹¬å·ç»„æˆçš„å­—ç¬¦ä¸² `S`ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ æœ€å°‘çš„æ‹¬å·ï¼ˆ `'('` æˆ–æ˜¯ `')'`ï¼Œå¯ä»¥åœ¨ä»»ä½•ä½ç½®ï¼‰ï¼Œä»¥ä½¿å¾—åˆ°çš„æ‹¬å·å­—ç¬¦ä¸²æœ‰æ•ˆã€‚\n\nä»å½¢å¼ä¸Šè®²ï¼Œåªæœ‰æ»¡è¶³ä¸‹é¢å‡ ç‚¹ä¹‹ä¸€ï¼Œæ‹¬å·å­—ç¬¦ä¸²æ‰æ˜¯æœ‰æ•ˆçš„ï¼š\n\n- å®ƒæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œæˆ–è€…\n- å®ƒå¯ä»¥è¢«å†™æˆ `AB` ï¼ˆ`A` ä¸ `B` è¿æ¥ï¼‰, å…¶ä¸­ `A` å’Œ `B` éƒ½æ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ï¼Œæˆ–è€…\n- å®ƒå¯ä»¥è¢«å†™ä½œ `(A)`ï¼Œå…¶ä¸­ `A` æ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ã€‚\n\nç»™å®šä¸€ä¸ªæ‹¬å·å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸ºä½¿ç»“æœå­—ç¬¦ä¸²æœ‰æ•ˆè€Œå¿…é¡»æ·»åŠ çš„æœ€å°‘æ‹¬å·æ•°ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š\"())\"\nè¾“å‡ºï¼š1\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š\"(((\"\nè¾“å‡ºï¼š3\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š\"()\"\nè¾“å‡ºï¼š0\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼š\"()))((\"\nè¾“å‡ºï¼š4\n```\n\n**æç¤ºï¼š**\n\n1. `S.length <= 1000`\n2. `S` åªåŒ…å« `'('` å’Œ `')'` å­—ç¬¦ã€‚\n\n**è§£æ³•ä¸€**\n\næ²¡å•¥å¥½è¯´çš„ï¼Œeasyé¢˜\n\n```java\npublic int minAddToMakeValid(String S) {\n    int left=0,right=0;\n    int wa=0;\n    for(int i=0;i<S.length();i++){\n        if(S.charAt(i)=='('){\n            left++;\n        }else{\n            if(left>0){\n                left--;\n            }else{\n                wa++;\n            }\n        }\n    }\n    return wa+left;\n}\n```\n\n## [394. å­—ç¬¦ä¸²è§£ç ](https://leetcode-cn.com/problems/decode-string/)\n\nç»™å®šä¸€ä¸ªç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒè§£ç åçš„å­—ç¬¦ä¸²ã€‚\n\nç¼–ç è§„åˆ™ä¸º: `k[encoded_string]`ï¼Œè¡¨ç¤ºå…¶ä¸­æ–¹æ‹¬å·å†…éƒ¨çš„ `encoded_string` æ­£å¥½é‡å¤ k æ¬¡ã€‚æ³¨æ„ k ä¿è¯ä¸ºæ­£æ•´æ•°ã€‚\n\nä½ å¯ä»¥è®¤ä¸ºè¾“å…¥å­—ç¬¦ä¸²æ€»æ˜¯æœ‰æ•ˆçš„ï¼›è¾“å…¥å­—ç¬¦ä¸²ä¸­æ²¡æœ‰é¢å¤–çš„ç©ºæ ¼ï¼Œä¸”è¾“å…¥çš„æ–¹æ‹¬å·æ€»æ˜¯ç¬¦åˆæ ¼å¼è¦æ±‚çš„ã€‚\n\næ­¤å¤–ï¼Œä½ å¯ä»¥è®¤ä¸ºåŸå§‹æ•°æ®ä¸åŒ…å«æ•°å­—ï¼Œæ‰€æœ‰çš„æ•°å­—åªè¡¨ç¤ºé‡å¤çš„æ¬¡æ•° k ï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°åƒ 3a æˆ– 2[4] çš„è¾“å…¥ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\ns = \"3[a]2[bc]\", è¿”å› \"aaabcbc\".\ns = \"3[a2[c]]\", è¿”å› \"accaccacc\".\ns = \"2[abc]3[cd]ef\", è¿”å› \"abcabccdcdcdef\".\n```\n\n**è§£æ³•ä¸€**\n\nå€ŸåŠ©æ ˆç›´æ¥åœ¨åŸå­—ç¬¦ä¸Šåšæ”¹åŠ¨\n\n```java\npublic String decodeString(String s) {\n    if (s==null || s.length()<=0) {\n        return \"\";\n    }\n    //è½¬æ¢ä¸ºStringBuilderæ¯”è¾ƒå¥½å¤„ç†,ä¸”æ•ˆç‡è¾ƒé«˜\n    StringBuilder sb=new StringBuilder(s);\n    Stack<Integer>  stack=new Stack<>();\n    int i=0;//éå†ç´¢å¼•\n    while(i<sb.length()) {\n        if (sb.charAt(i)=='[') {\n            stack.push(i);\n        }else if(sb.charAt(i)==']'){\n            int left=stack.pop();//å¯¹åº”å·¦æ‹¬å·ç´¢å¼•\n            String temp=sb.substring(left+1,i);//ç›¸é‚»æ‹¬å·ä¸­çš„å­—ç¬¦\n            int preInt=left;\n            //'['å‰çš„æ•°å­—,ä¸€å¼€å§‹ä»¥ä¸ºåªæ˜¯ä¸ªä½æ•°,è¿˜æ˜¯æŒºéº»çƒ¦çš„\n            while(preInt-1>=0 && sb.charAt(preInt-1)>='0' && sb.charAt(preInt-1) <='9'){\n                preInt--;\n            }\n            //repeatæ¬¡æ•°\n            int repeat=Integer.valueOf(sb.substring(preInt,left));\n            //åˆ é™¤ k[encoded_string] \n            sb.delete(preInt,Math.min(i+1,sb.length()));\n            for (int j=0;j<repeat;j++) {\n                //ä»kä½ç½®é‡æ–°æ’å…¥å­—ç¬¦\n                sb.insert(preInt,temp);\n            }\n            //é‡æ–°å®šä½ç´¢å¼•åˆ°å°¾éƒ¨\n            i=preInt+(repeat*temp.length())-1;\n        }\n        i++;\n    }\n    return sb.toString();\n}\n```\nä¸€å¼€å§‹æ˜¯æƒ³ç”¨ä¸€ä¸ªé¢å¤–çš„Stringæ¥ä¿å­˜ç»“æœï¼Œç»“æœå‘ç°æ¯”è¾ƒéº»çƒ¦ï¼Œç´¢æ€§ç›´æ¥å°†åŸå­—ç¬¦è½¬æ¢ä¸ºStringBuilderï¼Œç„¶åå€ŸåŠ©apiç›´æ¥åœ¨åŸå­—ç¬¦ä¸Šåšæ”¹åŠ¨ï¼Œå› ä¸ºæ˜¯åœ¨åŸå­—ç¬¦ä¸Šåšæ”¹åŠ¨ï¼Œæ‰€ä»¥ç´¢å¼•çš„å˜åŒ–éœ€è¦é¢å¤–çš„æ³¨æ„ï¼Œè¿™ä¹Ÿæ˜¯æœ€éº»çƒ¦çš„ä¸€ç‚¹ï¼Œéœ€è¦åœä¸‹æ¥ç¨å¾®æ€è€ƒä¸‹æ‰èƒ½ç¡®å®šï¼Œå…¶ä»–çš„è¿˜å¥½ï¼Œæ­£å¸¸çš„æ€è·¯ï¼Œæœ€åˆWAäº†ä¸€å‘æ˜¯å› ä¸ºå¿½ç•¥äº†å‰é¢çš„æ•°å­—å¯èƒ½æ˜¯å¤šä½æ•°ğŸ˜‚\n\n**è§£æ³•äºŒ**\n\né€’å½’çš„æ–¹å¼ï¼Œæ”¹æˆ`StringBuilder`åº”è¯¥ä¼šå¥½ä¸€ç‚¹ğŸ˜‚\n\n```java\nprivate int index=0; //å­—ç¬¦ç´¢å¼•ä¸‹æ ‡\n\npublic String decodeString(String s) {\n    if (s==null || s.length()<=0) {\n        return \"\";\n    }\n    String sb=\"\";\n    while(index<s.length()){\n        if (s.charAt(index)==']') { //é‡åˆ°å³æ‹¬å·å°±ç»“æŸ\n            index++;//indexå®šä½åˆ°å³æ‹¬å·ä¸‹ä¸€ä¸ª\n            return sb;\n        }else if(s.charAt(index)>='0' && s.charAt(index)<='9'){\n            int temp=index;\n            while(index<s.length() && s.charAt(index)!='['){\n                index++;\n            }\n            int repeat=Integer.valueOf(s.substring(temp,index));\n            index++;//è·³è¿‡'['\n            String rs=decodeString(s);//ä»å·¦æ‹¬å·å¼€å§‹\n            for (int i=0;i<repeat;i++) {\n                sb+=rs;\n            }\n        }else{\n            sb+=s.charAt(index++);\n        }\n    }\n    return sb;\n}\n```\n\n\n## [344. åè½¬å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/reverse-string/)\n\nç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ char[] çš„å½¢å¼ç»™å‡ºã€‚\n\nä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»**åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„**ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚\n\nä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯ ASCII ç è¡¨ä¸­çš„å¯æ‰“å°å­—ç¬¦ã€‚\n\n **ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[\"h\",\"e\",\"l\",\"l\",\"o\"]\nè¾“å‡ºï¼š[\"o\",\"l\",\"l\",\"e\",\"h\"]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[\"H\",\"a\",\"n\",\"n\",\"a\",\"h\"]\nè¾“å‡ºï¼š[\"h\",\"a\",\"n\",\"n\",\"a\",\"H\"]\n```\n\n**è§£æ³•ä¸€**\n\nå¾ˆä¹…ä¹‹å‰åšçš„äº†ï¼Œæœ¬æ¥æ˜¯æƒ³å•ç‹¬æä¸€ä¸ªé€’å½’ä¸“é¢˜ï¼Œæ„Ÿè§‰æ²¡å•¥å¿…è¦å°±ç›´æ¥åŠ åˆ°ä¸€èµ·äº†\n\n```java\npublic void reverseString(char[] s) {\n    if(s==null||s.length<=1)return;\n    reverseString(s,0,s.length-1);\n}\n\npublic void reverseString(char[] s,int l,int r) {\n    if(l>=r){\n        return;\n    }\n    char temp=s[l];\n    s[l]=s[r];\n    s[r]=temp;\n    reverseString(s,++l,--r);\n}\n```\n\n## [150. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼](https://leetcode-cn.com/problems/evaluate-reverse-polish-notation/)\n\næ ¹æ®[é€†æ³¢å…°è¡¨ç¤ºæ³•](https://baike.baidu.com/item/%E9%80%86%E6%B3%A2%E5%85%B0%E5%BC%8F/128437)ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚\n\næœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ `+, -, *, /` ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼\n\nè¯´æ˜ï¼š\n\n- æ•´æ•°é™¤æ³•åªä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚\n- ç»™å®šé€†æ³¢å…°è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨è¾¾å¼æ€»ä¼šå¾—å‡ºæœ‰æ•ˆæ•°å€¼ä¸”ä¸å­˜åœ¨é™¤æ•°ä¸º 0 çš„æƒ…å†µã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: [\"2\", \"1\", \"+\", \"3\", \"*\"]\nè¾“å‡º: 9\nè§£é‡Š: ((2 + 1) * 3) = 9\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: [\"4\", \"13\", \"5\", \"/\", \"+\"]\nè¾“å‡º: 6\nè§£é‡Š: (4 + (13 / 5)) = 6\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥: [\"10\", \"6\", \"9\", \"3\", \"+\", \"-11\", \"*\", \"/\", \"*\", \"17\", \"+\", \"5\", \"+\"]\nè¾“å‡º: 22\nè§£é‡Š: \n  ((10 * (6 / ((9 + 3) * -11))) + 17) + 5\n= ((10 * (6 / (12 * -11))) + 17) + 5\n= ((10 * (6 / -132)) + 17) + 5\n= ((10 * 0) + 17) + 5\n= (0 + 17) + 5\n= 17 + 5\n= 22\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic static int evalRPN(String[] tokens) {\n    //ä¸Šé¢è‡ªå·±å°è£…çš„Stack\n    MyStack<Integer> stack=new MyStack<>(tokens.length);\n    for (int i=0;i<tokens.length;i++) {\n        if(\"+\".equals(tokens[i])){\n            stack.push(stack.pop()+stack.pop());\n        } else if(\"-\".equals(tokens[i])){\n            int rd1=stack.pop();\n            int rd2=stack.pop();\n            stack.push(rd2-rd1);\n        }else if(\"*\".equals(tokens[i])){\n            stack.push(stack.pop()*stack.pop());\n        }else if(\"/\".equals(tokens[i])){\n            int div1=stack.pop();\n            int div2=stack.pop();\n            stack.push(div2/div1);\n        }else{\n            stack.push(Integer.valueOf(tokens[i]));\n        }\n    }\n    return stack.peek();\n}\n```\n12msï¼Œ90%ï¼Œå…¶å®ä¸€å¼€å§‹çœ‹åˆ°è¿™ä¸ªé¢˜æˆ‘æ˜¯æ‹’ç»çš„ï¼Œæˆ‘ä»¥ä¸ºåˆæ˜¯å•¥æ•°å­¦é¢˜ï¼Œç„¶åä»”ç»†çœ‹äº†ä¸‹å‘ç°æŒºç®€å•çš„ï¼Œæ€è·¯å°±æ˜¯åˆ©ç”¨æ ˆï¼Œæ¯æ¬¡é‡åˆ°ç¬¦å·å°±popä¸¤ä¸ªå‡ºæ¥è¿›è¡Œè¿ç®—ï¼Œç„¶åå†å…¥æ ˆï¼Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯å‡æ³•å’Œé™¤æ³•çš„é¡ºåº\n\n## [71. ç®€åŒ–è·¯å¾„](https://leetcode-cn.com/problems/simplify-path/)\n\nä»¥ Unix é£æ ¼ç»™å‡ºä¸€ä¸ªæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä½ éœ€è¦ç®€åŒ–å®ƒã€‚æˆ–è€…æ¢å¥è¯è¯´ï¼Œå°†å…¶è½¬æ¢ä¸ºè§„èŒƒè·¯å¾„ã€‚\n\nåœ¨ Unix é£æ ¼çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç‚¹ï¼ˆ.ï¼‰è¡¨ç¤ºå½“å‰ç›®å½•æœ¬èº«ï¼›æ­¤å¤–ï¼Œä¸¤ä¸ªç‚¹ ï¼ˆ..ï¼‰ è¡¨ç¤ºå°†ç›®å½•åˆ‡æ¢åˆ°ä¸Šä¸€çº§ï¼ˆæŒ‡å‘çˆ¶ç›®å½•ï¼‰ï¼›ä¸¤è€…éƒ½å¯ä»¥æ˜¯å¤æ‚ç›¸å¯¹è·¯å¾„çš„ç»„æˆéƒ¨åˆ†ã€‚æ›´å¤šä¿¡æ¯è¯·å‚é˜…ï¼š[Linux / Unixä¸­çš„ç»å¯¹è·¯å¾„ vs ç›¸å¯¹è·¯å¾„](https://blog.csdn.net/u011327334/article/details/50355600)\n\nè¯·æ³¨æ„ï¼Œè¿”å›çš„è§„èŒƒè·¯å¾„å¿…é¡»å§‹ç»ˆä»¥æ–œæ  / å¼€å¤´ï¼Œå¹¶ä¸”ä¸¤ä¸ªç›®å½•åä¹‹é—´å¿…é¡»åªæœ‰ä¸€ä¸ªæ–œæ  `/`ã€‚æœ€åä¸€ä¸ªç›®å½•åï¼ˆå¦‚æœå­˜åœ¨ï¼‰**ä¸èƒ½**ä»¥ / ç»“å°¾ã€‚æ­¤å¤–ï¼Œè§„èŒƒè·¯å¾„å¿…é¡»æ˜¯è¡¨ç¤ºç»å¯¹è·¯å¾„çš„**æœ€çŸ­**å­—ç¬¦ä¸²\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š\"/home/\"\nè¾“å‡ºï¼š\"/home\"\nè§£é‡Šï¼šæ³¨æ„ï¼Œæœ€åä¸€ä¸ªç›®å½•ååé¢æ²¡æœ‰æ–œæ ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š\"/../\"\nè¾“å‡ºï¼š\"/\"\nè§£é‡Šï¼šä»æ ¹ç›®å½•å‘ä¸Šä¸€çº§æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ ¹æ˜¯ä½ å¯ä»¥åˆ°è¾¾çš„æœ€é«˜çº§ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š\"/home//foo/\"\nè¾“å‡ºï¼š\"/home/foo\"\nè§£é‡Šï¼šåœ¨è§„èŒƒè·¯å¾„ä¸­ï¼Œå¤šä¸ªè¿ç»­æ–œæ éœ€è¦ç”¨ä¸€ä¸ªæ–œæ æ›¿æ¢ã€‚\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼š\"/a/./b/../../c/\"\nè¾“å‡ºï¼š\"/c\"\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼š\"/a/../../b/../c//.//\"\nè¾“å‡ºï¼š\"/c\"\n```\n\n\n**ç¤ºä¾‹ 6ï¼š**\n\n```java\nè¾“å…¥ï¼š\"/a//b////c/d//././/..\"\nè¾“å‡ºï¼š\"/a/b/c\"\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic static String simplifyPath(String path) {\n    MyStack<String> stack=new MyStack<>(path.length());\n    StringBuilder str=new StringBuilder(path);\n    //è¿™é‡Œåˆ’åˆ†å‡ºæ¥æœ‰ä¸€éƒ¨åˆ†æ˜¯ç©ºçš„ \"\"\n    String[] s=path.split(\"/\");\n    for (int i=0;i<s.length;i++) {\n        if (!stack.isEmpty() && s[i].equals(\"..\")) {\n            //.. å›æº¯\n            stack.pop();\n        }else if (!\".\".equals(s[i]) && !\"\".equals(s[i]) && !s[i].equals(\"..\") ) {\n            //æ™®é€šçš„è‹±æ–‡å­—ç¬¦abcd\n            stack.push(s[i]);\n        }\n    }\n    if (stack.isEmpty()) {\n        return \"/\";\n    }\n    StringBuilder res=new StringBuilder();\n    for (int i=0;i<stack.size(); i++) {\n        res.append(\"/\"+stack.get(i));   \n    }\n    return res.toString();\n}\n\n//è‡ªå·±å°è£…çš„stack\npublic class MyStack<T>{\n\n    T [] objValues=null;\n\n    int top=-1;\n\n    public MyStack(int size){\n        objValues= (T[]) new Object[size];\n    }\n\n    public void push(T obj){\n        objValues[++top]=obj;\n    }\n\n    public T peek(){\n        if (top<0) {\n            throw new RuntimeException(\"stack is isEmpty\");\n        }\n        return objValues[top];\n    }\n\n    public T pop(){\n        if (top<0) {\n            throw new RuntimeException(\"stack is isEmpty\");\n        }\n        //è¦†ç›–\n        return objValues[top--];\n    }\n\n    public T get(int index){\n        if (index>top || index < 0) {\n            throw new RuntimeException(\"index is wrong\");\n        }\n        return objValues[index];\n    }\n\n    public boolean isEmpty(){\n        return top<0;\n    }\n\n    public int size(){\n        return top+1;\n    }\n}\n```\nè¿™é¢˜æœ¬æ¥æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯æˆ‘é’»åˆ°ç‰›è§’å°–å»äº†ï¼Œä¸€ç›´æƒ³ç€æ€ä¹ˆåœ¨éå†è¿‡ç¨‹ä¸­å¤„ç†ï¼Œå†™äº†ä¸€å †ifelseã€‚ã€‚ã€‚è¿˜æ˜¯å¤ªèœäº†å•Šï¼Œå…¶å®ç›´æ¥æŒ‰ç…§`\"/\"` åˆ’åˆ†splitå­—ç¬¦ä¸²ç„¶åå¤„ç†é‚£ä¸ªæ•°ç»„å°±å¯ä»¥äº†\n\n## [225. ç”¨é˜Ÿåˆ—å®ç°æ ˆ](https://leetcode-cn.com/problems/implement-stack-using-queues/)\n\nImplement the following operations of a stack using queues.\n\n- push(x) -- Push element x onto stack.\n- pop() -- Removes the element on top of the stack.\n- top() -- Get the top element.\n- empty() -- Return whether the stack is empty.\n\n**Example:**\n\n```java\nMyStack stack = new MyStack();\n\nstack.push(1);\nstack.push(2);  \nstack.top();   // returns 2\nstack.pop();   // returns 2\nstack.empty(); // returns false\n```\n\n**Notes:**\n\n- You must use *only* standard operations of a queue -- which means only `push to back`, `peek/pop from front`, `size`, and `is empty` operations are valid.\n- Depending on your language, queue may not be supported natively. You may simulate a queue by using a list or deque (double-ended queue), as long as you use only standard operations of a queue.\n- You may assume that all operations are valid (for example, no pop or top operations will be called on an empty stack).\n\n**è§£æ³•ä¸€**\n\nå¾ˆç»å…¸çš„é¢˜\n\n```java\nclass MyStack {\n\n    private ArrayDeque<Integer> queue=null;\n\n    /** Initialize your data structure here. */\n    public MyStack() {\n        queue=new ArrayDeque();\n    }\n    \n    /** Push element x onto stack. */\n    public void push(int x) {\n        queue.add(x);\n        int size=queue.size();\n        //é™¤äº†æ–°åŠ å…¥çš„å…ƒç´ ï¼Œå…¶ä»–çš„å…ƒç´ éƒ½å‡ºé˜Ÿå†å…¥é˜Ÿï¼Œå°†æ–°åŠ å…¥çš„å…ƒç´ æ¨ç½®é˜Ÿåˆ—å¤´\n        while(size-- >1){\n            queue.add(queue.pop());\n        }\n    }\n    \n    /** Removes the element on top of the stack and returns that element. */\n    public int pop() {\n       return  queue.pop();\n    }\n    \n    /** Get the top element. */\n    public int top() {\n        return queue.peek();\n    }\n\n    /** Returns whether the stack is empty. */\n    public boolean empty() {\n        return queue.isEmpty();\n    }\n}\n```\n\nå¾ˆå·§å¦™çš„åšæ³•ï¼Œå°†å…ƒç´ å‰n-1ä¸ªå‡ºé˜Ÿåå†é‡æ–°å…¥é˜Ÿï¼Œ`1 2 --> 2 1` ç›´æ¥å°†å †é¡¶æ¨ç½®é˜Ÿåˆ—å¤´ ï¼Œå°†æ¯æ¬¡æ–°åŠ å…¥çš„å…ƒç´ éƒ½æ”¾ç½®é˜Ÿåˆ—å¤´è€Œä¸æ˜¯é˜Ÿå°¾ï¼Œè¿™æ ·å®é™…ä¸Šå°±å®Œæˆäº†é€†åºçš„æ“ä½œ\n\nè¿™æ ·pushå‹æ ˆæ—¶é—´å¤æ‚åº¦`O(N)` ï¼Œ`pop/peek` æ—¶é—´å¤æ‚åº¦`O(1)`\n\n**è§£æ³•äºŒ**\n\né€‚ç”¨äºpushé¢‘ç¹çš„stack\n\n```java\npublic class MyStack{\n   //å½¢å¼ä¸Šq1æ˜¯è´Ÿè´£è¿›æ ˆ q2è´Ÿè´£å‡ºæ ˆ\n    private LinkedList inQueue=new LinkedList(); \n    private LinkedList outQueue=new LinkedList();\n\n    private  void  add(Object obj){\n        inQueue.add(obj);\n    }\n\n    private Object pop(){\n        // q1 ----> q2 ç•™ä¸€ä¸ª\n        while(inQueue.size()>1){\n            outQueue.add(inQueue.poll());\n        }\n        //äº¤æ¢q1,q2çš„å¼•ç”¨\n        LinkedList temp;\n        temp=inQueue;\n        inQueue=outQueue;\n        outQueue=temp;\n        return outQueue.poll();\n    }\n\n    private Object peek(){\n        //q1 --->q2 ç•™ä¸€ä¸ª,æœ€åä¸€ä¸ªä¸poll,æœ€åpoll\n        while(inQueue.size()>1){\n            outQueue.add(inQueue.poll());\n            if(inQueue.size()==1){\n                outQueue.add(inQueue.peek());\n            }\n        }\n        //äº¤æ¢q1,q2çš„å¼•ç”¨\n        LinkedList temp;\n        temp=inQueue;\n        inQueue=outQueue;\n        outQueue=temp;\n        return outQueue.poll();\n    }\n}\n```\n\nä¸¤ä¸ªé˜Ÿåˆ—ï¼Œpushå‹æ ˆæ—¶é—´å¤æ‚åº¦`O(1)`ï¼Œpop/pushå‡ºæ ˆæ—¶é—´å¤æ‚åº¦`O(N)` ï¼Œå‡ºæ ˆçš„æ—¶å€™å°†ä¸€ä¸ªé˜Ÿåˆ—çš„å‰n-1ä¸ªå…ƒç´ å…¨éƒ¨åŠ å…¥åˆ°å¦ä¸€ä¸ªé˜Ÿåˆ—ä¸­ä½œä¸ºç¼“å­˜ï¼Œç„¶åå°†æœ€åä¸€ä¸ªå…ƒç´ å‡ºæ ˆï¼Œæœ€ååˆ«å¿˜äº†äº¤æ¢ä¸¤ä¸ªé˜Ÿåˆ—çš„å¼•ç”¨ï¼Œä¸ç„¶pushçš„æ—¶å€™å°±ä¼šå‡ºé—®é¢˜ï¼Œè¦ä¿è¯`inQueue` ä¸€ç›´æ˜¯å…¥æ ˆçš„é˜Ÿåˆ—ï¼Œå…¶ä¸­å­˜æ”¾ç€æ‰€æœ‰çš„å…ƒç´ \n\n## [232. ç”¨æ ˆå®ç°é˜Ÿåˆ—](https://leetcode-cn.com/problems/implement-queue-using-stacks/)\n\nImplement the following operations of a queue using stacks.\n\n- push(x) -- Push element x to the back of queue.\n- pop() -- Removes the element from in front of queue.\n- peek() -- Get the front element.\n- empty() -- Return whether the queue is empty.\n\n**Example:**\n\n```java\nMyQueue queue = new MyQueue();\n\nqueue.push(1);\nqueue.push(2);  \nqueue.peek();  // returns 1\nqueue.pop();   // returns 1\nqueue.empty(); // returns false\n```\n\n**Notes:**\n\n- You must use *only* standard operations of a stack -- which means only `push to top`, `peek/pop from top`, `size`, and `is empty` operations are valid.\n- Depending on your language, stack may not be supported natively. You may simulate a stack by using a list or deque (double-ended queue), as long as you use only standard operations of a stack.\n- You may assume that all operations are valid (for example, no pop or peek operations will be called on an empty queue).\n\n**è§£æ³•ä¸€**\n\n```java\nclass MyQueue {\n\n    Stack<Integer> inStack=null;\n\n    Stack<Integer> outStack=null;\n    /** Initialize your data structure here. */\n    public Stack2Queue232() {\n        inStack=new Stack<>();\n        outStack=new Stack<>();\n    }\n\n    /** Push element x to the back of queue. */\n    public void push(int x) {\n        inStack.push(x);\n    }\n\n    /** Removes the element from in front of queue and returns that element. */\n    public int pop() {\n        s2s();\n        return outStack.pop();\n    }\n\n    /** Get the front element. */\n    public int peek() {\n        s2s();\n        return outStack.peek();\n    }\n\n    /** Returns whether the queue is empty. */\n    public boolean empty() {\n        return outStack.isEmpty() && inStack.isEmpty();\n    }\n\n    private void s2s(){\n        if (outStack.isEmpty()) {\n            while(!inStack.isEmpty()) {\n                outStack.push(inStack.pop());\n            }\n        }     \n    }\n}\n```\n\nå¾ˆä¸Šé¢ä¸€é¢˜æ˜¯å§Šå¦¹é¢˜ï¼Œéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯`s2s`çš„æ—¶å€™è¦ç¡®ä¿stack2æ ˆæ˜¯ç©ºçš„æ‰èƒ½push\n\n## [155. æœ€å°æ ˆ](https://leetcode-cn.com/problems/min-stack/)\n\nè®¾è®¡ä¸€ä¸ªæ”¯æŒ pushï¼Œpopï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚\n\n- push(x) -- å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚\n\n- pop() -- åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚\n\n- top() -- è·å–æ ˆé¡¶å…ƒç´ ã€‚\n\n- getMin() -- æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nMinStack minStack = new MinStack();\nminStack.push(-2);\nminStack.push(0);\nminStack.push(-3);\nminStack.getMin();   --> è¿”å› -3.\nminStack.pop();\nminStack.top();      --> è¿”å› 0.\nminStack.getMin();   --> è¿”å› -2.\n```\n\n**è§£æ³•ä¸€**\n\nåˆ©ç”¨è¾…åŠ©æ ˆï¼ŒåŒæ­¥çš„pushå’Œpop\n\n```java\nclass MinStack {\n\n    /** initialize your data structure here. */\n    private Stack<Integer> stack=null;\n\n    private Stack<Integer> helpStack=null;\n\n    public MinStack() {\n        stack=new Stack<>();\n        helpStack=new Stack<>();\n    }\n    \n    public void push(int x) {\n        stack.push(x);\n        if (helpStack.isEmpty()) {\n            helpStack.push(x);\n        }else{\n            if (helpStack.peek()>x) {\n                helpStack.push(x);\n            }else{\n                helpStack.push(helpStack.peek());\n            }\n        }\n    }\n    \n    public void pop() {\n        stack.pop();\n        helpStack.pop();\n    }\n    \n    public int top() {\n        return stack.peek();\n    }\n    \n    public int getMin() {\n        return helpStack.peek();\n    }\n}\n```\n\n**è§£æ³•äºŒ**\n\nåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šè¿›è¡Œç©ºé—´çš„ä¼˜åŒ–\n\n```java\nclass MinStack {\n\n    /** initialize your data structure here. */\n    private Stack<Integer> stack=null;\n\n    private Stack<Integer> helpStack=null;\n\n    public MinStack() {\n        stack=new Stack<>();\n        helpStack=new Stack<>();\n    }\n\n    public void push(int x) {\n        stack.push(x);\n        if (helpStack.isEmpty()) {\n            helpStack.push(x);\n        }else if (x<=helpStack.peek()) {\n            //ç›¸ç­‰çš„ä¹Ÿè¦å…¥æ ˆ,ä¸ç„¶ä¸å¥½æ§åˆ¶åé¢å‡ºæ ˆ\n            helpStack.push(x);\n        }\n    }\n    \n    public void pop() {\n        int top=stack.pop();\n        //å’Œè¾…åŠ©æ ˆæ ˆé¡¶ç›¸åŒå°±å‡ºæ ˆ\n        if(top==helpStack.peek()){\n            helpStack.pop();\n        }\n        /*\n        if(stack.pop()==helpStack.peek()){\n            helpStack.pop();\n        }*/\n    }\n    \n    public int top() {\n        return stack.peek();\n    }\n    \n    public int getMin() {\n        return helpStack.peek();\n    }\n}\n```\n\nå…¶å®è¿™é‡Œæœ‰ä¸€ä¸ªåœ°æ–¹æŠŠæˆ‘å¡äº†ä¸€ä¼šå„¿ï¼Œå°±æ˜¯å‡ºæ ˆçš„æ—¶å€™ï¼Œæˆ‘å¼€å§‹ä¸ºäº†ç®€æ´ifçš„æ¡ä»¶å†™çš„\n\n`stack.pop()==helpStack.peek()` ç„¶åå¡åœ¨äº†ä¸€ä¸ªcaseä¸Šï¼Œæƒ³äº†åŠå¤©æ‰æ„è¯†åˆ°æ˜¯`Integer`çš„é—®é¢˜ï¼Œè¿™é‡Œå¼¹å‡ºæ¥çš„æ˜¯ä¸¤ä¸ª`Integer`å¹¶ä¸ä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œè€Œä¸”å€¼æ˜¯ä¸åœ¨ -128~127ä¹‹é—´çš„ï¼Œæ‰€ä»¥å°±falseäº†\n\n**è§£æ³•ä¸‰**\n\nå¸…åœ°ä¸Šçœ‹è§çš„è§£æ³•ï¼Œåœ¨æ ˆä¸­å­˜ä¸€ä¸ªdiffå·®å€¼ï¼Œä»£è¡¨å½“å‰å…ƒç´ å’Œå…¥æ ˆå‰çš„minçš„å·®å€¼ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä½†æ˜¯è¿™ç§åšæ³•é™åˆ¶æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æ•°æ®çš„å¤§å°ä¼šæœ‰é™åˆ¶ï¼ŒåŒæ—¶è²Œä¼¼ä¹Ÿæ— æ³•åš`peek()`æ“ä½œ\n\n```java\npublic class MinStack155_2{\n    /** initialize your data structure here. */\n    private Stack<Integer> stack=null;\n\n    private int min=0;\n\n    public MinStack155_2() {\n        stack=new Stack<>();\n    }\n    \n    public void push(int x) {\n        if (stack.isEmpty()) {\n            min=x;\n            stack.push(0);\n        }else{\n            int diff=x-min;\n            min=diff>0?min:x;\n            stack.push(diff);\n        }\n    }\n    \n    public void pop() {\n        int diff=stack.pop();\n        //å°äºç­‰äº0è¯´æ˜ minå°±æ˜¯å½“å‰çœŸå®çš„æ ˆé¡¶å…ƒç´ ,ä¹Ÿå°±æ˜¯è¯´ min-minPre=diff\n        min=diff<=0?min-diff:min;\n    }\n    \n    /*public int top() {\n        int diff=stack.peek();\n        return diff<=0?min:diff-min;\n    }*/\n    \n    public int getMin() {\n        return min;\n    }\n}\n```\n\n## [779. ç¬¬Kä¸ªè¯­æ³•ç¬¦å·](https://leetcode-cn.com/problems/k-th-symbol-in-grammar/)\n\nOn the first row, we write a `0`. Now in every subsequent row, we look at the previous row and replace each occurrence of `0` with `01`, and each occurrence of `1` with `10`.\n\nGiven row `N` and index `K`, return the `K`-th indexed symbol in row `N`. (The values of `K` are 1-indexed.) (1 indexed).\n\n```java\nExamples:\nInput: N = 1, K = 1\nOutput: 0\n\nInput: N = 2, K = 1\nOutput: 0\n\nInput: N = 2, K = 2\nOutput: 1\n\nInput: N = 4, K = 5\nOutput: 1\n\nExplanation:\nrow 1: 0\nrow 2: 01\nrow 3: 0110\nrow 4: 01101001\n```\n\n**Note:**\n\n1. `N` will be an integer in the range `[1, 30]`.\n2. `K` will be an integer in the range `[1, 2^(N-1)]`.\n\n**è§£æ³•ä¸€**\n\næ‰¾è§„å¾‹ï¼Œå‰åŠéƒ¨åˆ†å’ŒååŠéƒ¨åˆ†æ˜¯æœ‰ä¸€å®šè§„å¾‹çš„ï¼ŒæŠŠå‰å…­è¡Œéƒ½å†™å‡ºæ¥\n\n```java\n  ç¬¬ä¸€è¡Œ: 0\n  ç¬¬äºŒè¡Œ: 01\n  ç¬¬ä¸‰è¡Œ: 01|10\n  ç¬¬å››è¡Œ: 01 10|10 01\n  ç¬¬äº”è¡Œ: 01 10 10 01|10 01 01 10\n  ç¬¬å…­è¡Œ: 01 10 10 01 10 01 01 10 | 10 01 01 10 01 10 10 01\n```\n\n  N%2!=0 å¯¹ç§°, ç¬¬Kä¸ªç­‰äº 2^(N-1)-K+1\n  N%2==0 äº’è¡¥å¯¹ç§°\n\n```java\npublic int kthGrammar(int N, int K) {\n    if(K==1 || N==1){\n        return 0;\n    }\n    if(K==2){\n        return 1;\n    }\n    int len=1<<(N-1); //å½“å‰è¡Œé•¿åº¦\n    if(K>len/2){ //å¤§äº1/2\n        //ç»“åˆä¸Šé¢çš„è§„å¾‹ï¼Œæ‰¾å‰åŠéƒ¨åˆ†å’Œè‡ªå·±ç­‰ä»·çš„ä½ç½®\n        if(N%2!=0){ \n            K=len-K+1;\n        }else{\n            if(K%2==0){\n                K=len-K+2;  \n            }else{\n                K=len-K;\n            }\n        }\n    }\n    //å»ä¸Šä¸€è¡Œç»§ç»­\n    return kthGrammar(N-1,K);\n}\n```\n\næ—¶é—´å¤æ‚ç¬¬O(N)ï¼Œæ€è·¯è¿˜ç®—æ¸…æ™°ï¼Œæœ€å¼€å§‹æ²¡æƒ³åˆ°ç”¨`ä½è¿ç®—`æ¥ç®—é•¿åº¦ï¼Œç”¨çš„`pow()`æœ€åæ•ˆç‡å·®ä¸å¤šï¼Œå¯èƒ½æ˜¯åº•å±‚åšäº†ä¼˜åŒ–ã€‚\n\n**è§£æ³•äºŒ**\n\nè¿™ç§è§£æ³•å®é™…ä¸Šå°±æ˜¯æŠŠæ•´ä¸ªåºåˆ—çœ‹ä½œä¸€é¢—æ»¡äºŒå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼å’Œçˆ¶èŠ‚ç‚¹å…¶å®æ˜¯æœ‰å¯¹åº”å…³ç³»çš„ï¼Œå¦‚æœKæ˜¯å¶æ•°é‚£ä¹ˆå°±å’Œçˆ¶èŠ‚ç‚¹çš„å€¼ç›¸åï¼Œå¦åˆ™å°±ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€’å½’çš„å»æ‰¾çˆ¶èŠ‚ç‚¹å¯¹åº”çš„indexçš„å€¼ã€‚\n\n```java\n//01æ’åˆ—\n//              0\n//          /        \\   \n//      0                1\n//    /   \\            /    \\\n//  0       1        1       0\n// / \\     /  \\     /  \\    / \\ \n//0   1   1    0   1    0  0   1\n\n\npublic int kthGrammar(int N, int K) {\n    if (K==1) return 0;\n    //(K+1)/2æ˜¯å¯¹åº”çˆ¶èŠ‚ç‚¹çš„index\n    int parent=kthGrammar(N-1,(K+1)/2);\n    //å–å\n    int f_parent=-(parent-1);\n    if (K%2==0) {\n        return f_parent;\n    }\n    return parent;\n}\n```\næ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯`O(N)` ä½†æ˜¯æ¯”ä¸Šé¢é‚£ç§è¦æ›´æ¸…æ™°æ˜äº†\n\n**è§£æ³•ä¸‰**\n\nè¿™ä¸ªè§£æ³•å…¶å®å’Œä¸Šé¢çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨çˆ¶èŠ‚ç‚¹å’ŒKçš„å¥‡å¶æ¥åˆ¤æ–­ï¼Œå…¶å®ä»”ç»†çœ‹ä¸Šé¢çš„ä»£ç ä½ ä¼šå‘ç°Nå…¶å®å¹¶æ²¡æœ‰å®é™…çš„æ„ä¹‰ï¼Œå…·ä½“Kçš„å€¼åªå’ŒKæœ¬èº«æœ‰å…³ï¼Œä¸‹é¢çš„è§£æ³•å°±æ²¡æœ‰ç”¨åˆ°N.\n\n```java\npublic static int kthGrammar3(int N, int K) {\n    boolean r=false;\n    while(K>1){\n        if (K%2==0) {\n            K=K/2;\n            r=!r;\n        }else{\n            K=(K+1)/2;\n        }\n    }\n    return r?1:0;\n}\n```\nè¿™é¢˜å…¶å®è¿˜æœ‰ä¸€ç§è§£æ³•ï¼Œåˆ©ç”¨äºŒè¿›åˆ¶ï¼Œå¯¹Kåšå¥‡å¶æ£€éªŒï¼Œè²Œä¼¼æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚\n\n\n## [50. Pow(x, n)](https://leetcode-cn.com/problems/powx-n/)\n\nå®ç° pow(*x*, *n*) ï¼Œå³è®¡ç®— x çš„ n æ¬¡å¹‚å‡½æ•°ã€‚\n\n**è§£æ³•ä¸€**\n\nè¿™é‡Œå°±è¦ä»‹ç»ä¸€ç§å¿«é€Ÿå¹‚ç®—æ³•äº†\n\n```java\npublic static double fastPow(double x,int n){\n    if(n==0){\n        return 1;\n    }\n    if(n<0){\n        x=1/x;\n        n=-n;\n    }\n    double res=fastPow(x,n/2);\n    if(n%2==0){\n        return res*res;\n    }\n    return res*res*x;\n}\n```\n\næ ¸å¿ƒæ€æƒ³å°±æ˜¯ `x^n=(x^2/n)^2`ï¼Œå¸¸è§„ç´¯ä¹˜çš„æ–¹å¼è®¡ç®—æ—¶é—´å¤æ‚åº¦æ˜¯O(N)å› ä¸ºè¦éå†æ‰€æœ‰çš„å…ƒç´ ï¼Œä½†æ˜¯å…¶å®çŸ¥é“äº†`x^n/2`ä¹‹å `x^n`å°±å¯ä»¥ç›´æ¥å¹³æ–¹å¾—åˆ°äº†ä¸ç”¨ç»§ç»­éå†ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦ä¸ºO(logN) \n\n2019.8.20ï¼Œåˆå†™äº†ä¸€éï¼Œæäº¤ç„¶åæ²¡è¿‡ã€‚çœ‹äº†ä¸‹ç»™çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæœ€åä¸€ä¸ªç»™çš„næ˜¯ `-2^31` ä¹Ÿå°±æ˜¯intæ•´æ•°çš„æœ€å°å€¼ï¼Œintç±»å‹çš„å–å€¼èŒƒå›´æ˜¯ `-2^31 ~ 2^31-1` è€Œè¿™ä¸ªè´Ÿå€¼åœ¨è¿™é‡Œå–åä¹‹åä¼šç›´æ¥æº¢å‡ºæœ€åå¾—åˆ°çš„è¿˜æ˜¯ `-2^31` ï¼Œæ‰€ä»¥è¿™é‡Œè¿™æ ·å†™ ifä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œxå°±åˆä¼šå˜å›æ¥ï¼Œæ‰€ä»¥ç»“æœç›´æ¥å°±æ˜¯`Infinity`æ— ç©·å¤§äº†ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯ifåªä¼šæ‰§è¡Œä¸€æ¬¡å¯ä»¥å°†å…¶å°è£…ä¸€ä¸‹\n\n```java\npublic static double myPow(double x, int n) {\n    if(n<0){\n        x=1/x;\n        n=-n;\n    }\n    return fastPow(x,n);\n} \n\npublic static double fastPow(double x,int n){\n    if(n==0){\n        return 1.0;\n    }\n    double  half=fastPow(x,n/2);\n    if(n%2==0)\n        return half*half;\n    return half*half*x;\n}\n```\n\n## 5222. åˆ†å‰²å¹³è¡¡å­—ç¬¦ä¸²\n\nåœ¨ä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ä¸­ï¼Œ'L' å’Œ 'R' å­—ç¬¦çš„æ•°é‡æ˜¯ç›¸åŒçš„ã€‚\n\nç»™å‡ºä¸€ä¸ªå¹³è¡¡å­—ç¬¦ä¸² `s`ï¼Œè¯·ä½ å°†å®ƒåˆ†å‰²æˆå°½å¯èƒ½å¤šçš„å¹³è¡¡å­—ç¬¦ä¸²ã€‚\n\nè¿”å›å¯ä»¥é€šè¿‡åˆ†å‰²å¾—åˆ°çš„å¹³è¡¡å­—ç¬¦ä¸²çš„æœ€å¤§æ•°é‡\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"RLRRLLRLRL\"\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šs å¯ä»¥åˆ†å‰²ä¸º \"RL\", \"RRLL\", \"RL\", \"RL\", æ¯ä¸ªå­å­—ç¬¦ä¸²ä¸­éƒ½åŒ…å«ç›¸åŒæ•°é‡çš„ 'L' å’Œ 'R'ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"RLLLLRRRLR\"\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šs å¯ä»¥åˆ†å‰²ä¸º \"RL\", \"LLLRRR\", \"LR\", æ¯ä¸ªå­å­—ç¬¦ä¸²ä¸­éƒ½åŒ…å«ç›¸åŒæ•°é‡çš„ 'L' å’Œ 'R'ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"LLLLRRRR\"\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šs åªèƒ½ä¿æŒåŸæ · \"LLLLRRRR\".\n```\n\n**æç¤ºï¼š**\n\n- `1 <= s.length <= 1000`\n- `s[i] = 'L' æˆ– 'R'`\n\n**è§£æ³•ä¸€**\n\n19.10.13çš„å‘¨èµ›çš„ç¬¬1é¢˜ï¼Œæœç„¶æ¯”èµ›å’Œåˆ·é¢˜è¿˜æ˜¯ä¸ä¸€æ ·ï¼Œå·®ç‚¹æ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚\n\n```java\npublic static int balancedStringSplit(String s) {\n    if (s.length()%2==1) {\n        return 0;\n    }\n    Stack<Character> stack=new Stack<>();\n    int count=0;\n    for(int i=0;i<s.length();i++){\n        if (!stack.isEmpty() ){\n            if(s.charAt(i)==stack.peek()) {\n                stack.push(s.charAt(i));    \n            }else{\n                stack.pop();\n                if (stack.isEmpty()) {\n                    count++;\n                }\n            }\n        }else{\n            stack.push(s.charAt(i));\n        }\n    }\n    return count;\n}\n```\n\n## [1249. ç§»é™¤æ— æ•ˆçš„æ‹¬å·](https://leetcode-cn.com/problems/minimum-remove-to-make-valid-parentheses/)\n\nç»™ä½ ä¸€ä¸ªç”± '('ã€')' å’Œå°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² sã€‚\n\nä½ éœ€è¦ä»å­—ç¬¦ä¸²ä¸­åˆ é™¤æœ€å°‘æ•°ç›®çš„ '(' æˆ–è€… ')' ï¼ˆå¯ä»¥åˆ é™¤ä»»æ„ä½ç½®çš„æ‹¬å·)ï¼Œä½¿å¾—å‰©ä¸‹çš„ã€Œæ‹¬å·å­—ç¬¦ä¸²ã€æœ‰æ•ˆã€‚\n\nè¯·è¿”å›ä»»æ„ä¸€ä¸ªåˆæ³•å­—ç¬¦ä¸²ã€‚\n\næœ‰æ•ˆã€Œæ‹¬å·å­—ç¬¦ä¸²ã€åº”å½“ç¬¦åˆä»¥ä¸‹ **ä»»æ„ä¸€æ¡** è¦æ±‚ï¼š\n\n- ç©ºå­—ç¬¦ä¸²æˆ–åªåŒ…å«å°å†™å­—æ¯çš„å­—ç¬¦ä¸²\n- å¯ä»¥è¢«å†™ä½œ ABï¼ˆA è¿æ¥ Bï¼‰çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ A å’Œ B éƒ½æ˜¯æœ‰æ•ˆã€Œæ‹¬å·å­—ç¬¦ä¸²ã€\n- å¯ä»¥è¢«å†™ä½œ (A) çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ A æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ã€Œæ‹¬å·å­—ç¬¦ä¸²ã€\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"lee(t(c)o)de)\"\nè¾“å‡ºï¼š\"lee(t(c)o)de\"\nè§£é‡Šï¼š\"lee(t(co)de)\" , \"lee(t(c)ode)\" ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œç­”æ¡ˆã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"a)b(c)d\"\nè¾“å‡ºï¼š\"ab(c)d\"\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"))((\"\nè¾“å‡ºï¼š\"\"\nè§£é‡Šï¼šç©ºå­—ç¬¦ä¸²ä¹Ÿæ˜¯æœ‰æ•ˆçš„\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"(a(b(c)d)\"\nè¾“å‡ºï¼š\"a(b(c)d)\"\n```\n\n**æç¤ºï¼š**\n\n- `1 <= s.length <= 10^5`\n- `s[i]` å¯èƒ½æ˜¯ `'('`ã€`')'` æˆ–è‹±æ–‡å°å†™å­—æ¯ \n\n**è§£æ³•ä¸€**\n\n11.3å‘¨èµ›ç¬¬ä¸‰é¢˜ï¼Œè¿™é¢˜å€’æ˜¯æ²¡ä»€ä¹ˆéšœç¢ï¼Œç”¨æ ˆå°±okï¼Œä¸è¿‡æˆ‘è¿™é‡Œå®ç°çš„ä¸å¤ªå¥½ï¼Œreplaceæ—¶é—´å¤æ‚åº¦ç•¥é«˜ï¼Œåº”è¯¥ç”¨ä¸€ä¸ªæ•°ç»„åšmarkæœ€åç”¨StringBuilderåšappendåº”è¯¥æ•ˆç‡ä¼šé«˜å¾ˆå¤š\n\n```java\npublic String minRemoveToMakeValid(String s) {\n    StringBuilder sb=new StringBuilder(s);\n    Stack<Integer> stack=new Stack<>();\n    for (int i=0;i<s.length();i++) {\n        if (s.charAt(i)>='a' && s.charAt(i)<='z') {\n            continue;\n        }\n        if (s.charAt(i)==')') {\n            if (stack.isEmpty()) {\n                sb.replace(i,i+1,\"*\");    \n            }else{\n                stack.pop();\n            }\n        }\n        if (s.charAt(i)=='(') {\n            stack.push(i);\n        }\n    }\n    while (!stack.isEmpty()) {\n        int temp=stack.pop();\n        sb.replace(temp,temp+1,\"*\");\n    }\n    String res=sb.toString().replace(\"*\",\"\");\n    return res;\n}\n```\n\n## [856. æ‹¬å·çš„åˆ†æ•°](https://leetcode-cn.com/problems/score-of-parentheses/)\n\nç»™å®šä¸€ä¸ªå¹³è¡¡æ‹¬å·å­—ç¬¦ä¸² Sï¼ŒæŒ‰ä¸‹è¿°è§„åˆ™è®¡ç®—è¯¥å­—ç¬¦ä¸²çš„åˆ†æ•°ï¼š\n\n- () å¾— 1 åˆ†ã€‚\n- AB å¾— A + B åˆ†ï¼Œå…¶ä¸­ A å’Œ B æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ã€‚\n- (A) å¾— 2 * A åˆ†ï¼Œå…¶ä¸­ A æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š \"()\"\nè¾“å‡ºï¼š 1\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š \"(())\"\nè¾“å‡ºï¼š 2\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š \"()()\"\nè¾“å‡ºï¼š 2\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼š \"(()(()))\"\nè¾“å‡ºï¼š 6\n```\n\n**æç¤ºï¼š**\n\n1. S æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ï¼Œä¸”åªå«æœ‰ ( å’Œ ) ã€‚\n2. 2 <= S.length <= 50\n\n**è§£æ³•ä¸€**\n\n```java\npublic int scoreOfParentheses(String S) {\n    Stack<Integer> stack=new Stack<>();\n    for(int i=0;i<S.length();i++){\n        if(S.charAt(i)=='('){\n            stack.push(-11111);\n        }else{\n            //é‡åˆ°å³æ‹¬å·,ä¸‹é¢çš„åˆ†æ”¯éƒ½æ˜¯å¤„ç† \")\"\n            int top=stack.peek();\n            if(top == -11111){ //æ ˆé¡¶æ˜¯å·¦æ‹¬å·ï¼Œå°† ( --> 1\n                stack.pop();\n                stack.push(1);\n            }else{\n                int sum=0; //é‡åˆ°æ•°å€¼äº†\n                while(!stack.isEmpty()){\n                    int temp=stack.pop();\n                    //å¼¹å‡ºå»,ç›´åˆ°é‡åˆ° \"(\"å°±*2,å…¶å®å°±æ˜¯æŠŠ\"(1\"-->2\n                    if(temp==-11111){ \n                        sum*=2;\n                        break;\n                    }\n                    sum+=temp;\n                }\n                stack.push(sum);\n            }\n        }\n    }\n    int res=0;\n    while(!stack.isEmpty()) res+=stack.pop();\n    return res;\n}\n```\nè¿™ç§è§£æ³•ä¸€å¼€å§‹ä¹Ÿæ²¡æƒ³å‡ºæ¥ï¼Œå…¶å®è¿™ç§å°±ç±»ä¼¼äºæ¶ˆæ¶ˆä¹æ¸¸æˆä¸€æ ·ï¼Œå°±æŒ‰ç…§é¢˜ç›®çš„é€»è¾‘æ¥å†™ï¼Œä»å·¦å‘å³ï¼Œæ ˆä¸­å­˜æ ‡è¯†å·¦æ‹¬å·çš„æ•°å€¼ï¼Œè¿™é‡Œæˆ‘ç”¨çš„`-11111` è¡¨ç¤º`ï¼ˆ` ï¼Œç„¶åå‘å³ç§»åŠ¨ï¼Œä¸€è¾¹ç§»åŠ¨ä¸€è¾¹å°†`ï¼ˆï¼‰`ç»™æ¶ˆé™¤æ‰ï¼Œå…¶å®ä¸Šé¢çš„é€»è¾‘è‡ªå·±èµ°ä¸€è¾¹å°±é€šäº†\n\n**è§£æ³•äºŒ**\n\nè¿™ä¸ªè§£æ³•å°±å¸¦æœ‰ç‚¹æŠ€å·§æ€§äº†ï¼Œçœ‹æ‡‚ä¸Šé¢çš„æ³¨é‡Šï¼Œä¸‹é¢çš„ä»£ç å°±å¾ˆç®€å•äº†\n\n```java\n// (()(())) = 2*()+2*(())= (())+((()))\npublic int scoreOfParentheses(String S) {\n    int k=0,res=1;\n    for (int i=0;i<S.length();i++) {\n        if (S.charAt(i)=='(') {\n            k++; //kç”¨æ¥è®¡ç®—æ‹¬å·çš„æ·±åº¦\n        }else{\n            k--;\n            if (S.charAt(i-1)=='(') {\n                //\"()\"é—­åˆçš„æ—¶å€™è®¡ç®—ä¸€æ³¢\n                res+= 1<<k; //2^k\n            }\n        }\n    }\n    return res;\n}\n```\n\n## [946. éªŒè¯æ ˆåºåˆ—](https://leetcode-cn.com/problems/validate-stack-sequences/)\n\nç»™å®š `pushed` å’Œ `popped` ä¸¤ä¸ªåºåˆ—ï¼Œæ¯ä¸ªåºåˆ—ä¸­çš„ å€¼éƒ½ä¸é‡å¤ï¼Œåªæœ‰å½“å®ƒä»¬å¯èƒ½æ˜¯åœ¨æœ€åˆç©ºæ ˆä¸Šè¿›è¡Œçš„æ¨å…¥ `push` å’Œå¼¹å‡º pop æ“ä½œåºåˆ—çš„ç»“æœæ—¶ï¼Œè¿”å› `true` å¦åˆ™ï¼Œè¿”å› `false` \n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼špushed = [1,2,3,4,5], popped = [4,5,3,2,1]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š\npush(1), push(2), push(3), push(4), pop() -> 4,\npush(5), pop() -> 5, pop() -> 3, pop() -> 2, pop() -> 1\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼špushed = [1,2,3,4,5], popped = [4,3,5,1,2]\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼š1 ä¸èƒ½åœ¨ 2 ä¹‹å‰å¼¹å‡ºã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `0 <= pushed.length == popped.length <= 1000`\n2. `0 <= pushed[i], popped[i] < 1000`\n3. `pushed` æ˜¯ `popped` çš„æ’åˆ—\n\n**è§£æ³•ä¸€**\n\nç›´æ¥ç”¨æ ˆæ¨¡æ‹Ÿï¼Œå¯æƒœæ²¡æœ‰bugfree...\n\n```java\npublic boolean validateStackSequences(int[] pushed, int[] popped) {\n    if(pushed==null || pushed.length<=0) return true;\n    Deque<Integer> stack=new ArrayDeque<>();\n    int popIndex=0;\n    int pushIndex=0;\n    //pushed = [1,2,3,4,5], popped = [4,5,3,2,1]\n    //[1,2,3,4,5]      [4,3,5,1,2]\n    //[1,0] [1,0]\n    while(pushIndex<pushed.length){\n        stack.push(pushed[pushIndex++]);\n        while(!stack.isEmpty()&&popped[popIndex]==stack.peek()){\n            stack.pop();\n            popIndex++;\n        }\n    }\n    return stack.isEmpty();\n}\n```\næ¯è¿›ä¸€ä¸ªå…ƒç´ å°±åˆ¤æ–­æ ˆé¡¶å’Œå‡ºæ ˆé¡ºåºçš„å¤´æ˜¯å¦ç›¸ç­‰ï¼Œç„¶åå‡ºæ ˆï¼Œæœ€åçœ‹æ ˆä¸­æ˜¯å¦ä¸ºç©ºå°±ok\n\n## [NC560.æ‰“å­—](https://www.nowcoder.com/practice/7819ebf1369044e5bee2f9848d9c6c72)\n\nç‰›å¦¹åœ¨ç»ƒä¹ æ‰“å­—ï¼Œç°åœ¨æŒ‰ç…§æ—¶é—´é¡ºåºç»™å‡ºç‰›å¦¹æŒ‰ä¸‹çš„é”®ï¼ˆä»¥å­—ç¬¦ä¸²å½¢å¼ç»™å‡º,'<'ä»£è¡¨å›é€€backspaceï¼Œå…¶ä½™å­—ç¬¦å‡æ˜¯ç‰›å¦¹æ‰“çš„å­—ç¬¦ï¼Œå­—ç¬¦åªåŒ…å«å°å†™å­—æ¯ä¸'<'ï¼‰ï¼Œç‰›å¦¹æƒ³çŸ¥é“æœ€ååœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„æ–‡æœ¬å†…å®¹æ˜¯ä»€ä¹ˆã€‚\nåœ¨æ–‡æœ¬å†…å®¹ä¸ºç©ºçš„æ—¶å€™ä¹Ÿå¯ä»¥æŒ‰å›é€€backspaceï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ²¡æœ‰ä»»ä½•æ•ˆæœï¼‰ã€‚\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥: \"acv<\"\nè¾“å‡º: \"ac\"\nè¯´æ˜:\nç‰›å¦¹åœ¨æ‰“å®Œ\"acv\"ä¹‹åæŒ‰äº†å›é€€ï¼Œæ‰€ä»¥æœ€åæ˜¯\"ac\"\n```\n**è§£æ³•ä¸€**\n\nä¹Ÿå¯ä»¥ç›´æ¥æ•°ç»„æ¨¡æ‹Ÿ\n```java\npublic String Typing (String s) {\n    // write code here\n    Deque<Integer> stack = new ArrayDeque<>();\n    for (int i = 0; i < s.length(); i++) {\n        if (s.charAt(i) == '<') {\n            if (stack.isEmpty()) {\n                continue;\n            }\n            stack.pop();\n        }else{\n            stack.push(i);\n        }\n    }\n    StringBuilder sb = new StringBuilder();\n    while(!stack.isEmpty()){\n        sb.append(s.charAt(stack.pop()));\n    }\n    return sb.reverse().toString();\n}\n```\n\n## _BFSå¹¿æœ_\n\n## [279. å®Œå…¨å¹³æ–¹æ•°](https://leetcode-cn.com/problems/perfect-squares/)\n\nç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, ...ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: n = 12\nè¾“å‡º: 3 \nè§£é‡Š: 12 = 4 + 4 + 4.\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: n = 13\nè¾“å‡º: 2\nè§£é‡Š: 13 = 4 + 9.\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜åœ¨ä¸Šä¸€ç¯‡[dpä¸“é¢˜](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/)ä¸­æœ‰è®²è¿‡ï¼Œä¸è¿‡æ˜¯dpçš„è§£æ³•ï¼Œè¿™é‡Œä¸»è¦è®°å½•BFSçš„è§£æ³•\n\n```java\npublic static int numSquares2(int n) {\n    Queue<Pair> queue=new LinkedList<>();\n    boolean[] visit=new boolean[n+1];\n    queue.add(new Pair(n,0));\n    visit[n]=true;\n    while(!queue.isEmpty()){\n        Pair pair=queue.poll();\n        int num=pair.num;\n        int step=pair.step;\n        //nums=0è¯´æ˜æ‰¾åˆ°äº†ï¼Œå¹¶ä¸”ä¸€å®šæ˜¯æœ€çŸ­çš„\n        if (num==0) {\n            return step;\n        }\n        for (int i=1;i*i<=num;i++) {\n            int temp=num-i*i;\n            //æ³¨æ„ä¸è¦æ·»åŠ é‡å¤çš„å…ƒç´ \n            if (!visit[temp]) {\n                queue.add(new Pair(temp,step+1));\n                visit[temp]=true;\n            }\n        }\n    }\n    return -1;\n}\n\nstatic class Pair{\n    public int step;\n    public int num;\n    public Pair(int num,int step){\n        this.num=num;\n        this.step=step;\n    }\n}\n```\n30ms 90%ï¼Œæ¯”dpçš„æ–¹å¼ä¼šå¿«å¾ˆå¤šï¼Œæ€è·¯å°±æ˜¯å°†è¿™ä¸ªé—®é¢˜è½¬æ¢ä¸ºæ±‚å›¾çš„æœ€çŸ­è·¯å¾„çš„é—®é¢˜ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœ€çŸ­çš„ä»nåˆ°0çš„ä»¥å¹³æ–¹æ•°ä¸ºå·®çš„è·¯å¾„\n\n## [127. å•è¯æ¥é¾™](https://leetcode-cn.com/problems/word-ladder/)\n\nGiven two words (*beginWord* and *endWord*), and a dictionary's word list, find the length of shortest transformation sequence from *beginWord* to *endWord*, such that:\n\n1. Only one letter can be changed at a time.\n2. Each transformed word must exist in the word list. Note that *beginWord* is *not* a transformed word.\n\n**Note:**\n\n- Return 0 if there is no such transformation sequence.\n- All words have the same length.\n- All words contain only lowercase alphabetic characters.\n- You may assume no duplicates in the word list.\n- You may assume *beginWord* and *endWord* are non-empty and are not the same.\n\n**Example 1:**\n\n```java\nInput:\nbeginWord = \"hit\",\nendWord = \"cog\",\nwordList = [\"hot\",\"dot\",\"dog\",\"lot\",\"log\",\"cog\"]\n\nOutput: 5\n\nExplanation: As one shortest transformation is \"hit\" -> \"hot\" -> \"dot\" -> \"dog\" -> \"cog\",\nreturn its length 5.\n```\n\n**Example 2:**\n\n```java\nInput:\nbeginWord = \"hit\"\nendWord = \"cog\"\nwordList = [\"hot\",\"dot\",\"dog\",\"lot\",\"log\"]\n\nOutput: 0\n\nExplanation: The endWord \"cog\" is not in wordList, therefore no possible transformation.\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®å¾ˆä¹…ä»¥å‰å°±å†™è¿‡äº†ï¼Œå½“æ—¶æ˜¯çœ‹äº†å•Šå“ˆç®—æ³•çš„ä¸€äº›BFSç®—æ³•ç„¶åä»¿ç…§ä¹¦ä¸Šçš„å†™çš„ï¼Œä¹¦ä¸Šæ˜¯Cè¯­è¨€å†™çš„ï¼Œæ‰€ä»¥æœ€åæˆ‘å†™çš„æ—¶å€™ä¹ŸæŒ‰ç…§Cçš„æ ¼å¼å»å†™äº†ğŸ˜…ï¼Œå†™çš„è´¼å•°å—¦ï¼Œç°åœ¨åˆç”¨\"Java\"çš„æ–¹å¼åˆé‡æ–°å†™äº†ä¸€é\n\n```java\nprivate static int[] mark;\n\nint min = Integer.MAX_VALUE;\n\npublic int ladderLength(String beginWord, String endWord, List<String> wordList)     {\n    // ä¸å­˜åœ¨\n    mark = new int[wordList.size() + 1];\n    if (!wordList.contains(endWord)) {\n        return 0;\n    }\n    // BFS\n    int head = 0, tail = 0;\n    // åˆå§‹åŒ–é˜Ÿåˆ—\n    Que[] que = new Que[wordList.size() + 1];\n    // å¾ªç¯ä¿ƒä½¿è¯è¿°ç¥–\n    for (int i = 0; i < que.length; i++) {\n        que[i] = new Que();\n    }\n    que[tail].word = beginWord;\n    que[tail].step = 1;\n    tail++;\n    int flag=0;\n    while (head < tail) {\n        // éå†å­—å…¸\n        for (int i = 0; i < wordList.size(); i++) {\n            if (mark[i] == 0 && cmp(wordList.get(i), que[head].word)) {\n                que[tail].word = wordList.get(i);\n                //è¿™é‡Œæ˜¯ä»headå¼€å§‹çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯headçš„æ­¥æ•°+1\n                que[tail].step=que[head].step+1;\n                // æ ‡è®°ä¸ºå·²ç»èµ°è¿‡\n                mark[i] = 1;\n                // ç»Ÿè®¡æœ€å°æ­¥æ•°\n               if (que[tail].word.equals(endWord)) {\n                //è·³å‡ºå¾ªç¯\n                    flag=1;\n                   break;\n                }\n                tail++;\n            }\n        }\n        if(flag==1){\n            break;\n        }\n        // æ¯æ¬¡æ£€æŸ¥å®Œä¸€ä¸ªå•è¯å°±å°†å…¶å‡ºé˜Ÿåˆ—\n        head++;\n    }\n    return que[tail].step;\n}\n\n// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ²¡åƒæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯\nprivate boolean cmp(String s1, String s2) {\n    int count = 0;\n    for (int i = 0; i < s1.length(); i++) {\n        if (s1.charAt(i) != s2.charAt(i)) {\n            count++;\n        }\n    }\n    return count == 1;\n}\n\n// å†…éƒ¨ç±»\nclass Que {\n    String word;\n    int step;\n}\n```\nè¿™å°±æ˜¯å½“æ—¶å†™çš„è§£æ³•ï¼Œæ€è·¯å°±æ˜¯BFSï¼Œåªä¸è¿‡å†™çš„å¤æ‚äº†\n\n**è§£æ³•äºŒ**\n\n```java\npublic int ladderLength(String beginWord, String endWord, List<String> wordList)     {\n    //visitæ•°ç»„\n    boolean[] visit=new boolean[wordList.size()];\n    if (!wordList.contains(endWord)) {\n        return 0;\n    }\n\n    Queue<Pair> queue=new LinkedList<>();\n    queue.add(new Pair(beginWord,1));\n    //int flag=0;\n    while (!queue.isEmpty()) {\n        Pair pair=queue.poll();\n        // ç»Ÿè®¡æœ€å°æ­¥æ•°,æ”¾åœ¨å†…å¾ªç¯ä¸­ä¼šå¿«ä¸€ç‚¹\n        /*if (pair.word.equals(endWord)) {\n            return pair.step;\n        }*/\n        // éå†å­—å…¸\n        for (int i = 0; i < wordList.size(); i++) {\n            if (!visit[i] && cmp(wordList.get(i),pair.word)) {\n                if (wordList.get(i).equals(endWord)) {\n                    //è¿™é‡ŒåŠ 1 æ˜¯å› ä¸ºå–çš„æ˜¯pairçš„step\n                    //åˆ°å½“å‰è¿™ä¸ªå•è¯è¿˜è¦å¤šèµ°ä¸€æ­¥\n                    return pair.step+1;\n                }\n                queue.add(new Pair(wordList.get(i),pair.step+1));\n                //æ ‡è®°ä¸ºå·²ç»èµ°è¿‡\n                visit[i] = true;\n            }\n        }\n    }\n    return 0;\n}\n\n//æ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—ç¬¦\nprivate boolean cmp(String s1, String s2) {\n    int count = 0;\n    for (int i = 0; i < s1.length(); i++) {\n        if (s1.charAt(i) != s2.charAt(i)) {\n            count++;\n            if (count>1) {\n                return false;\n            }\n        }\n    }\n    return count == 1;\n}\n\n//Pair\nclass Pair {\n    String word;\n    int step;\n    public Pair(String word,int step){\n        this.word=word;\n        this.step=step;\n    }\n}\n```\n273msï¼Œ47%ä¸­è§„ä¸­çŸ©çš„åšæ³•ï¼Œè¿ç»­å†™äº†å¥½å‡ é¢˜BFSçš„ï¼Œæ€»ç®—æ˜¯å¯¹BFSçš„æ¿å­æœ‰ç‚¹ç†Ÿæ‚‰äº†ï¼Œè¿™é¢˜è¿˜æœ‰ä¸¤ä¸ªå¯ä»¥ä¼˜åŒ–çš„ç‚¹ â‘  _åŒç«¯BFS_ â‘¡ _å¯»æ‰¾ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–¹å¼_ï¼Œåªä¸è¿‡æˆ‘æ²¡å’‹çœ‹æ‡‚ï¼Œç­‰çœ‹æ‡‚äº†å†æ¥è¡¥å……ï¼Œé‚£ç§æ–¹å¼æ—¶é—´å¥½åƒå¯ä»¥ç¼©å‡åˆ° 20mså†….....\n\n> è¿™é¢˜æœ‰ä¸ªå›°éš¾ç‰ˆæœ¬ï¼Œéœ€è¦æ‰“å°å‡ºæ‰€æœ‰çš„æœ€çŸ­åºåˆ—ï¼Œè¿™ä¸ªåœ¨æˆ‘å¾ˆä¹…ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­ä¹Ÿæœ‰è®²ï¼Œä½†æ˜¯è‡³ä»Šæˆ‘ä¹Ÿè¿˜æ²¡æœ‰ACï¼Œä¸€ç›´æ˜¯TLEï¼Œç°åœ¨å›å¤´çœ‹æˆ‘ä¹‹å‰çš„ä»£ç å·²ç»çœ‹ä¸æ‡‚äº†ã€‚ã€‚ã€‚å†™äº†100å¤šè¡Œï¼Œç•¥å¤æ‚BFS+DFSçš„åšæ³•ï¼Œå¯èƒ½æ˜¯æ²¡å¤„ç†å¥½æ‰€ä»¥TLEäº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹[é‚£ç¯‡æ–‡ç« ](http://imlgw.top/2018/10/31/yi-dao-leetcode-yin-fa-de-can-an/#2-%E5%8A%A0%E5%BC%BA%E7%89%88-%E5%8D%95%E8%AF%8D%E6%8E%A5%E9%BE%99-2)\n\n## [542. 01 çŸ©é˜µ](https://leetcode-cn.com/problems/01-matrix/)\n\nç»™å®šä¸€ä¸ªç”± 0 å’Œ 1 ç»„æˆçš„çŸ©é˜µï¼Œæ‰¾å‡ºæ¯ä¸ªå…ƒç´ åˆ°æœ€è¿‘çš„ 0 çš„è·ç¦»ã€‚\n\nä¸¤ä¸ªç›¸é‚»å…ƒç´ é—´çš„è·ç¦»ä¸º 1 \n\n**ç¤ºä¾‹ 1:**\nè¾“å…¥:\n\n```java\n0 0 0\n0 1 0\n0 0 0\n```\n\nè¾“å‡º:\n\n```java\n0 0 0\n0 1 0\n0 0 0\n```\n\n**ç¤ºä¾‹ 2:**\nè¾“å…¥:\n\n```java\n0 0 0\n0 1 0\n1 1 1\n```\n\n\nè¾“å‡º:\n\n```java\n0 0 0\n0 1 0\n1 2 1\n```\n\n\n**æ³¨æ„:**\n\n- ç»™å®šçŸ©é˜µçš„å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡ 10000\n- ç»™å®šçŸ©é˜µä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ æ˜¯ 0\n- çŸ©é˜µä¸­çš„å…ƒç´ åªåœ¨å››ä¸ªæ–¹å‘ä¸Šç›¸é‚»: ä¸Šã€ä¸‹ã€å·¦ã€å³\n\n**è§£æ³•ä¸€**\n\næ†¨æ†¨çš„BFSè§£æ³•\n\n```java\n//éå†æ¯ä¸€ä¸ª1,BFSå¯»æ‰¾ç¦»ä»–æœ€è¿‘çš„0,ä¸€æ¬¡åªèƒ½ç¡®å®šä¸€ä¸ª1,æ•ˆç‡ç•¥ä½\npublic int[][] updateMatrix(int[][] matrix) {\n    if (matrix == null || matrix.length <=0 || matrix[0].length <=0) {\n        return new int[][]{};\n    }\n    for (int i=0;i<matrix.length;i++) {\n        for (int j=0;j<matrix[0].length;j++) {\n            if (matrix[i][j] == 1) {\n                matrix[i][j]=findMinDis(matrix,i,j);   \n            }\n        }\n    }\n    return matrix;\n}\n\nprivate int[][] direction={{1,0},{0,1},{-1,0},{0,-1}};\n\npublic int findMinDis(int[][] matrix,int x,int y){\n    Queue<Pair> queue=new LinkedList<>();\n    //boolean[][] visit=new boolean[matrix.length][matrix[0].length];\n    queue.add(new Pair(x,y,0));\n    //visit[x][y]=true;\n    while(!queue.isEmpty()){\n        Pair pair=queue.poll();\n        for (int i=0;i<direction.length;i++) {\n            int nx=pair.x + direction[i][0];\n            int ny=pair.y + direction[i][1];\n            if (isValid(matrix,nx,ny) /*&& !visit[nx][ny]*/) {\n                //visit[nx][ny]=true;\n                if (matrix[nx][ny] == 0) {\n                    return pair.step+1;\n                }\n                queue.add(new Pair(nx,ny,pair.step+1));\n            }\n        }\n    }\n    return -1; //é¢˜ç›®è¯´äº†ä¸€å®šæœ‰0,æ‰€ä»¥ä¸ä¼šèµ°åˆ°è¿™é‡Œ\n}\n\npublic boolean isValid(int[][] matrix,int x,int y){\n    return x>=0 && x<matrix.length && y>=0 && y<matrix[0].length;\n}\n\nclass Pair{\n    int x;\n    int y;\n    int step;\n    public Pair(int x,int y,int step){\n        this.x=x;\n        this.y=y;\n        this.step=step;\n    }\n}\n```\nå¯ä»¥çœ‹åˆ°ä»£ç ä¸­æœ‰å¾ˆæ˜æ˜¾çš„æ”¹åŠ¨ç—•è¿¹ï¼Œæœ€å¼€å§‹æ˜¯ç”¨visitæ•°ç»„ä¿è¯æ¯ä¸€ä¸ªå…ƒç´ åªä¼šè¿›é˜Ÿåˆ—ä¸€æ¬¡ï¼Œä¸ä¼šé‡å¤çš„è¿›é˜Ÿåˆ—ï¼Œä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆæˆ‘å»æ‰äº†å‘¢ï¼Ÿ\n\nå…¶å®ä¸»è¦æ˜¯ä¸€å¼€å§‹æäº¤çš„è§£æ³•è¶…æ—¶äº†ï¼ŒæŠŠvisitæ•°ç»„å»æ‰å°±è¿‡äº†ï¼Œåœ¨æ•°ç»„è¿‡å¤§çš„æ—¶å€™æ¯æ¬¡BFSéƒ½è¦å¼€è¾Ÿä¸€ä¸ªmatrixå¤§å°çš„booleanæ•°ç»„ï¼Œè¿™æ— ç–‘ä¼šæå…¶è€—è´¹æ—¶é—´ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸åŠ visitæ•°ç»„ä¸ä¼šæ­»å¾ªç¯å‘¢ï¼Ÿ\n\nç¡®å®ï¼Œå¦‚æœä¸åŠ visitæ•°ç»„é‚£ä¹ˆç¡®å®æ˜¯æœ‰å¯èƒ½ä¼šå¯¼è‡´æ­»å¾ªç¯çš„ï¼Œä¸¤ä¸ªèŠ‚ç‚¹äº’ç›¸é‡å¤æ·»åŠ å¯¹æ–¹ï¼Œä½†æ˜¯è¿™ä¸€é¢˜æœ‰ä¸ªå¾ˆå…³é”®çš„åœ°æ–¹ï¼Œé¢˜ç›®è¯´æ˜äº†ä¸€å®šä¼šæœ‰0ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å®šä¼šè§£ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ­»å¾ªç¯ï¼Œä¸¾ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­\n\n`ã€0ï¼Œ1ï¼Œ1ã€‘` è¿™é‡Œæˆ‘ä»¬å…ˆè€ƒè™‘ä¸­é—´çš„1ï¼Œç„¶åæˆ‘ä»¬æŒ‰ç…§ä¸‹å³ä¸Šå·¦çš„é¡ºåºå»æ·»åŠ å‘¨å›´çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­å°±ä¸ºæœ«å°¾çš„`[1]` ï¼Œå½“éå†åˆ°å³çš„æ—¶å€™å‘ç°æ˜¯0ï¼Œç›´æ¥returnï¼Œç„¶åæˆ‘ä»¬è€ƒè™‘ä¸‹ä¸€ä¸ª1ï¼Œè½¬äº†ä¸€åœˆé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä¸­é—´çš„`[1]` ï¼Œ ç„¶åæˆ‘ä»¬åˆé‡å¤åˆšåˆšçš„æ­¥éª¤ä¼šå°†æœ«å°¾çš„1åˆåŠ å…¥é˜Ÿåˆ—ï¼Œä½†æ˜¯ä¸‹ä¸€æ¬¡éå†å°±ä¼šæ‰¾åˆ°æœ€å·¦è¾¹çš„0ï¼Œç„¶åè¿”å›ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ­»å¾ªç¯ï¼Œå½“ç„¶è¿™æ ·åšçš„å‰ææ˜¯ä¸€å®šè¦æœ‰è§£ï¼\n\n**è§£æ³•äºŒ**\n\nå¦ä¸€ç§æ›´å¥½çš„åšæ³•ï¼Œä»¥0ä½œä¸ºæºï¼Œå‘å››å‘¨BFSï¼ŒåŒæ—¶æ›´æ–°å‘¨å›´çš„1çš„å€¼\n\n```java\n//update: 2020.4.15\nprivate int[][] dir={{1,0},{0,1},{-1,0},{0,-1}};\n\npublic int[][] updateMatrix(int[][] matrix) {\n    if(matrix==null || matrix.length<=0) return matrix;\n    boolean[][] visit=new boolean[matrix.length][matrix[0].length];\n    Queue<Pair> queue=new LinkedList<>();\n    for(int i=0;i<matrix.length;i++){\n        for(int j=0;j<matrix[0].length;j++){\n            if(matrix[i][j]==0){\n                queue.add(new Pair(i,j,0));\n                visit[i][j]=true;\n            }else{\n                matrix[i][j]=Integer.MAX_VALUE;\n            }\n        }\n    }\n    while(!queue.isEmpty()){\n        Pair pair=queue.poll();\n        for(int i=0;i<dir.length;i++){\n            int nx=pair.x+dir[i][0];\n            int ny=pair.y+dir[i][1];\n            if(valid(matrix,nx,ny) && !visit[nx][ny]){\n                queue.add(new Pair(nx,ny,pair.step+1));\n                matrix[nx][ny]=pair.step+1; //è¿™é‡Œä¸ç”¨åˆ¤æ–­æ˜¯ä¸æ˜¯å˜å°ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°çš„å°±æ˜¯æœ€è¿‘çš„\n                visit[nx][ny]=true;\n            }\n        }\n    }\n    return matrix;\n}\n\npublic boolean valid(final int[][] matrix,int x,int y){\n    return x>=0 && x<matrix.length && y>=0 && y<matrix[0].length;\n}\n\nclass Pair{\n    int x,y;\n    int step;\n    public Pair(int x,int y,int step){\n        this.x=x;\n        this.y=y;\n        this.step=step;\n    }\n}\n```\n\næ ¸å¿ƒæ€æƒ³å°±æ˜¯ æŠŠæ‰€æœ‰1éƒ½ç½®ä¸ºæœ€å¤§å€¼, æŠŠæ‰€æœ‰ä¸º0çš„ä½ç½®åŠ å…¥é˜Ÿåˆ—ä¸­, æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­poll ä¸€ä¸ªèŠ‚ç‚¹, æ›´æ–°å…¶å››å‘¨çš„èŠ‚ç‚¹, ~~å¦‚æœè¢«æ›´æ–°çš„èŠ‚ç‚¹è·ç¦»å˜å°äº†å°±å°†å…¶ä¹ŸåŠ å…¥é˜Ÿåˆ—å‡†å¤‡æ›´æ–°å…¶é‚»æ¥ç‚¹~~ stepæ˜¯é€’å¢çš„ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°çš„ä¸€å®šæ˜¯æœ€è¿‘çš„\n\nå¤šæºBFSï¼Œå‚è€ƒä¸‹é¢çš„ [994. è…çƒ‚çš„æ©˜å­]()  å’Œ [1162. åœ°å›¾åˆ†æ]()\n\n**è§£æ³•ä¸‰**\n\n> è¿™é¢˜çš„æœ€ä¼˜è§£åº”è¯¥æ˜¯åŠ¨æ€è§„åˆ’çš„è§£æ³•ï¼Œæˆ‘å®åœ¨æ˜¯æ‡’å¾—å†™ï¼ˆèœï¼‰ï¼Œå…¶å®å’Œå“ªä¸ª ä¸åŒè·¯å¾„æœ‰ç‚¹ç±»ä¼¼ï¼Œæ¯ä¸ª1ç¦»ä»–æœ€è¿‘çš„0çš„è·ç¦»å…¶å®å°±æ˜¯å®ƒå‘¨å›´çš„å…ƒç´ ç¦»0æœ€è¿‘çš„è·ç¦»+1\n>\n> ä¹Ÿå°±æ˜¯ `matrix[i][j] =min(dp[i][j-1],dp[i-1][j],dp[i+1][j],dp[i][j+1]) + 1` ä½†æ˜¯æˆ‘ä»¬ä¸å¯èƒ½åŒæ—¶æ±‚å‡ºæ˜¯ä¸ªæ–¹å‘çš„æœ€å°å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤æ¬¡éå†ï¼Œç¬¬ä¸€éä»å·¦ä¸Šåˆ°å³ä¸‹ï¼Œç¬¬äºŒéä»å³ä¸‹åˆ°å·¦ä¸Šï¼Œä¸¤æ¬¡éå†å°±å¯ä»¥ç¡®å®šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œä»£ç ä»¥åæœ‰æ—¶é—´å†æ¥å†™\n\n## [1306. è·³è·ƒæ¸¸æˆ III](https://leetcode-cn.com/problems/jump-game-iii/)\n\nè¿™é‡Œæœ‰ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ `arr`ï¼Œä½ æœ€å¼€å§‹ä½äºè¯¥æ•°ç»„çš„èµ·å§‹ä¸‹æ ‡ `start` å¤„ã€‚å½“ä½ ä½äºä¸‹æ ‡ i å¤„æ—¶ï¼Œä½ å¯ä»¥è·³åˆ° `i + arr[i]` æˆ–è€… `i - arr[i]`ã€‚\n\nè¯·ä½ åˆ¤æ–­è‡ªå·±æ˜¯å¦èƒ½å¤Ÿè·³åˆ°å¯¹åº”å…ƒç´ å€¼ä¸º 0 çš„ `ä»»æ„` ä¸‹æ ‡å¤„ã€‚\n\næ³¨æ„ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œä½ éƒ½æ— æ³•è·³åˆ°æ•°ç»„ä¹‹å¤–\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [4,2,3,0,3,1,2], start = 5\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼š\nåˆ°è¾¾å€¼ä¸º 0 çš„ä¸‹æ ‡ 3 æœ‰ä»¥ä¸‹å¯èƒ½æ–¹æ¡ˆï¼š \nä¸‹æ ‡ 5 -> ä¸‹æ ‡ 4 -> ä¸‹æ ‡ 1 -> ä¸‹æ ‡ 3 \nä¸‹æ ‡ 5 -> ä¸‹æ ‡ 6 -> ä¸‹æ ‡ 4 -> ä¸‹æ ‡ 1 -> ä¸‹æ ‡ 3 \n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [4,2,3,0,3,1,2], start = 0\nè¾“å‡ºï¼štrue \nè§£é‡Šï¼š\nåˆ°è¾¾å€¼ä¸º 0 çš„ä¸‹æ ‡ 3 æœ‰ä»¥ä¸‹å¯èƒ½æ–¹æ¡ˆï¼š \nä¸‹æ ‡ 0 -> ä¸‹æ ‡ 4 -> ä¸‹æ ‡ 1 -> ä¸‹æ ‡ 3\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [3,0,2,1,2], start = 2\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šæ— æ³•åˆ°è¾¾å€¼ä¸º 0 çš„ä¸‹æ ‡ 1 å¤„ã€‚ \n```\n\n**æç¤ºï¼š**\n\n- `1 <= arr.length <= 5 * 10^4`\n- `0 <= arr[i] < arr.length`\n- `0 <= start < arr.length`\n\n**è§£æ³•ä¸€**\n\nBFSï¼ŒæŸæ¬¡å‘¨èµ›çš„ç¬¬3é¢˜ï¼Œè¿˜æ˜¯æŒºç®€å•çš„ï¼Œå¯æƒœé‚£æ¬¡æ²¡å‚åŠ \n\n```java\npublic boolean canReach(int[] arr, int start) {\n    boolean[] visit=new boolean[arr.length];\n    Queue<Integer> queue=new LinkedList<>();\n    queue.add(start);\n    visit[start]=true;\n    while(!queue.isEmpty()){\n        int cur=queue.poll();\n        if (arr[cur] == 0) {\n            return true;\n        }\n        if (cur-arr[cur]>=0 && !visit[cur-arr[cur]]) {\n            queue.add(cur-arr[cur]);\n            visit[cur-arr[cur]]=true;\n        }\n        if (cur+arr[cur]<arr.length && !visit[cur+arr[cur]]) {\n            queue.add(cur+arr[cur]);\n            visit[cur+arr[cur]]=true;\n        }\n    }\n    return false;\n}\n```\n\n**è§£æ³•äºŒ**\n\nDFSè§£æ³•ï¼Œæ²¡å•¥å¥½è¯´çš„\n\n```java\npublic boolean canReach(int[] arr,int start){\n    boolean[] visit=new boolean[arr.length];\n    return dfs(arr,start,visit);\n}\n\npublic boolean dfs(int[] arr,int index,boolean[] visit){\n    if (arr[index] == 0) {\n        return true;\n    }\n    visit[index]=true;\n    boolean b=false;\n    if (index-arr[index] >=0 && !visit[index-arr[index]]) {\n        b=dfs(arr,index-arr[index],visit);\n    }\n    if (index+arr[index] <arr.length && !visit[index+arr[index]]) {\n        return b|dfs(arr,index+arr[index],visit);\n    }\n    return b;\n}\n```\n## [5314. è·³è·ƒæ¸¸æˆ IV](https://leetcode-cn.com/problems/jump-game-iv/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ arr ï¼Œä½ ä¸€å¼€å§‹åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¤„ï¼ˆä¸‹æ ‡ä¸º 0ï¼‰ã€‚\n\næ¯ä¸€æ­¥ï¼Œä½ å¯ä»¥ä»ä¸‹æ ‡ i è·³åˆ°ä¸‹æ ‡ï¼š\n\n- i + 1 æ»¡è¶³ï¼ši + 1 < arr.length\n- i - 1 æ»¡è¶³ï¼ši - 1 >= 0\n- j æ»¡è¶³ï¼šarr[i] == arr[j] ä¸” i != j\n\nè¯·ä½ è¿”å›åˆ°è¾¾æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡å¤„æ‰€éœ€çš„ æœ€å°‘æ“ä½œæ¬¡æ•° ã€‚ \næ³¨æ„ï¼šä»»ä½•æ—¶å€™ä½ éƒ½ä¸èƒ½è·³åˆ°æ•°ç»„å¤–é¢ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [100,-23,-23,404,100,23,23,23,3,404]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šé‚£ä½ éœ€è¦è·³è·ƒ 3 æ¬¡ï¼Œä¸‹æ ‡ä¾æ¬¡ä¸º 0 --> 4 --> 3 --> 9 ã€‚ä¸‹æ ‡ 9 ä¸ºæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [7]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šä¸€å¼€å§‹å°±åœ¨æœ€åä¸€ä¸ªå…ƒç´ å¤„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦è·³è·ƒã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [7,6,9,6,9,6,9,7]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šä½ å¯ä»¥ç›´æ¥ä»ä¸‹æ ‡ 0 å¤„è·³åˆ°ä¸‹æ ‡ 7 å¤„ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ å¤„ã€‚\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [6,1,9]\nè¾“å‡ºï¼š2\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [11,22,7,7,7,7,7,7,7,22,13]\nè¾“å‡ºï¼š3\n```\n\n**æç¤ºï¼š**\n\n- `1 <= arr.length <= 5 * 10^4`\n- `-10^8 <= arr[i] <= 10^8`\n\n**è§£æ³•ä¸€**\n\n19åŒå‘¨èµ›çš„æœ€åä¸€é¢˜ï¼Œè®²é“ç†æŒºç®€å•çš„ï¼ˆå¯æˆ‘è¿˜æ˜¯TLEäº†å¥½é•¿æ—¶é—´ï¼‰\n\n```java\npublic int minJumps(int[] arr) {\n    Queue<Pair> queue=new LinkedList<>();\n    boolean[] visit=new boolean[arr.length];\n    HashMap<Integer,List<Integer>> map=new HashMap<>();\n    //æ„å»ºç­‰å€¼çš„ç´¢å¼• è¿ç»­ç›¸åŒçš„åªä¿ç•™å¤´å°¾\n    for (int i=0;i<arr.length;i++) {\n        List<Integer> lis=map.computeIfAbsent(arr[i],k->new ArrayList<>());\n        if (!((i-1>=0&&arr[i-1]==arr[i]) && (i+1<arr.length&&arr[i+1]==arr[i]))){\n            lis.add(i);\n        }\n    }\n    queue.add(new Pair(0,0));\n    visit[0]=true;\n    while(!queue.isEmpty()){\n        Pair pair=queue.poll();\n        if (pair.index==arr.length-1) {\n            return pair.step;\n        }\n        if(pair.index+1<arr.length && !visit[pair.index+1]){\n            queue.add(new Pair(pair.index+1,pair.step+1));\n            visit[pair.index+1]=true;\n        }\n        if (pair.index-1>=0 && !visit[pair.index-1]) {\n            queue.add(new Pair(pair.index-1,pair.step+1));\n            visit[pair.index-1]=true;\n        }\n        List<Integer> list=map.get(arr[pair.index]);\n        for (int i=list.size()-1;i>=0;i--) {\n            int idx=list.get(i);\n            if (!visit[idx]) {\n                queue.add(new Pair(idx,pair.step+1));\n                visit[idx]=true;\n            }\n        }\n    }\n    return -1;\n}\n\nclass Pair{\n    int index;\n    int step;\n    public Pair(int index,int step){\n        this.index=index;\n        this.step=step;\n    }\n}\n```\n\nçœ‹ä¸€ä¸‹æ•°æ®èŒƒå›´ï¼Œç›´æ¥BFSéå†è·³åŒå€¼çš„è‚¯å®šä¸è¡Œï¼Œæ‰€ä»¥æƒ³åˆ°äº†ç”¨mapé¢„å¤„ç†åŒå€¼çš„ç´¢å¼•ï¼Œç»“æœè¿˜æ˜¯TLEäº†ï¼Œåé¢ä¸€ä¸ªcaseæœ‰50000ä¸ª7ï¼Œè¿™é‡Œå³ä½¿åšäº†mapç´¢å¼•ä½†æ˜¯æ— å¥ˆå¤ªå¤šäº†ï¼Œä¾ç„¶ä¼šè¶…æ—¶ï¼Œè¿™é‡Œå…¶å®è¿™ä¹ˆå¤š7ï¼Œåªæœ‰å¤´å’Œå°¾çš„7æ˜¯ç”¨çš„ï¼Œå…¶ä»–ä½ç½®çš„7éƒ½æ˜¯æ— ç”¨çš„ï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥ï¼Œæ‰€ä»¥æ„å»ºç´¢å¼•çš„æ—¶å€™å¯ä»¥è·³è¿‡è¿™äº›ä¸­é—´ä½ç½®ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´\n\n## [690. å‘˜å·¥çš„é‡è¦æ€§](https://leetcode-cn.com/problems/employee-importance/)\n\nç»™å®šä¸€ä¸ªä¿å­˜å‘˜å·¥ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œå®ƒåŒ…å«äº†å‘˜å·¥å”¯ä¸€çš„idï¼Œé‡è¦åº¦ å’Œ ç›´ç³»ä¸‹å±çš„idã€‚\n\næ¯”å¦‚ï¼Œå‘˜å·¥1æ˜¯å‘˜å·¥2çš„é¢†å¯¼ï¼Œå‘˜å·¥2æ˜¯å‘˜å·¥3çš„é¢†å¯¼ã€‚ä»–ä»¬ç›¸åº”çš„é‡è¦åº¦ä¸º15, 10, 5ã€‚é‚£ä¹ˆå‘˜å·¥1çš„æ•°æ®ç»“æ„æ˜¯[1, 15, [2]]ï¼Œå‘˜å·¥2çš„æ•°æ®ç»“æ„æ˜¯[2, 10, [3]]ï¼Œå‘˜å·¥3çš„æ•°æ®ç»“æ„æ˜¯[3, 5, []]ã€‚æ³¨æ„è™½ç„¶å‘˜å·¥3ä¹Ÿæ˜¯å‘˜å·¥1çš„ä¸€ä¸ªä¸‹å±ï¼Œä½†æ˜¯ç”±äºå¹¶ä¸æ˜¯ç›´ç³»ä¸‹å±ï¼Œå› æ­¤æ²¡æœ‰ä½“ç°åœ¨å‘˜å·¥1çš„æ•°æ®ç»“æ„ä¸­ã€‚\n\nç°åœ¨è¾“å…¥ä¸€ä¸ªå…¬å¸çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œä»¥åŠå•ä¸ªå‘˜å·¥idï¼Œè¿”å›è¿™ä¸ªå‘˜å·¥å’Œä»–æ‰€æœ‰ä¸‹å±çš„é‡è¦åº¦ä¹‹å’Œã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [[1, 5, [2, 3]], [2, 3, []], [3, 3, []]], 1\nè¾“å‡º: 11\nè§£é‡Š:\nå‘˜å·¥1è‡ªèº«çš„é‡è¦åº¦æ˜¯5ï¼Œä»–æœ‰ä¸¤ä¸ªç›´ç³»ä¸‹å±2å’Œ3ï¼Œè€Œä¸”2å’Œ3çš„é‡è¦åº¦å‡ä¸º3ã€‚å› æ­¤å‘˜å·¥1çš„æ€»é‡è¦åº¦æ˜¯ 5 + 3 + 3 = 11ã€‚\n```\n\n\n**æ³¨æ„:**\n\n1. ä¸€ä¸ªå‘˜å·¥æœ€å¤šæœ‰ä¸€ä¸ªç›´ç³»é¢†å¯¼ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªç›´ç³»ä¸‹å±\n2. å‘˜å·¥æ•°é‡ä¸è¶…è¿‡2000ã€‚\n\n**è§£æ³•ä¸€**\n\nBFSï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œæ†¨æ†¨é¢˜ç›´æ¥bugfree\n\n```java\npublic int getImportance(List<Employee> employees, int id) {\n    HashMap<Integer,Employee> map=new HashMap<>();\n    for (Employee e:employees) {\n        map.put(e.id,e);\n    }\n    Queue<Integer> queue=new LinkedList<>();\n    queue.add(id);\n    int res=0;\n    while(!queue.isEmpty()){\n        Employee cur=map.get(queue.poll());\n        res+=cur.importance;\n        List<Integer> subordinates=cur.subordinates;\n        if (!subordinates.isEmpty()) {\n            for (int eid:subordinates) {\n                queue.add(eid);\n            }\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nDFSï¼Œæœ¬æ¥ä¸æƒ³å†™çš„ï¼Œè¿™ç±»é¢˜å…¶å®éƒ½æ˜¯æ ‘çš„é¢˜å˜äº†ä¸ªè¯´æ³•è€Œå·²\n\n```java\npublic int getImportance(List<Employee> employees, int id) {\n    HashMap<Integer,Employee> map=new HashMap<>();\n    for (Employee e:employees) {\n        map.put(e.id,e);\n    }\n    return dfs(map,id);\n}\n\npublic int dfs(HashMap<Integer,Employee> map,int id){\n    Employee cur=map.get(id);\n    int res=cur.importance;\n    for (int eid:cur.subordinates) {\n        res+=dfs(map,eid);\n    }\n    return res;\n}\n```\n## [1311. è·å–ä½ å¥½å‹å·²è§‚çœ‹çš„è§†é¢‘](https://leetcode-cn.com/problems/get-watched-videos-by-your-friends/)\n\næœ‰ n ä¸ªäººï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ª  0 åˆ° n-1 çš„å”¯ä¸€ id ã€‚\n\nç»™ä½ æ•°ç»„ `watchedVideos`  å’Œ `friends` ï¼Œå…¶ä¸­ `watchedVideos[i]`  å’Œ friends[i] åˆ†åˆ«è¡¨ç¤º id = i çš„äººè§‚çœ‹è¿‡çš„è§†é¢‘åˆ—è¡¨å’Œä»–çš„å¥½å‹åˆ—è¡¨ã€‚\n\nLevel 1 çš„è§†é¢‘åŒ…å«æ‰€æœ‰ä½ å¥½å‹è§‚çœ‹è¿‡çš„è§†é¢‘ï¼Œlevel 2 çš„è§†é¢‘åŒ…å«æ‰€æœ‰ä½ å¥½å‹çš„å¥½å‹è§‚çœ‹è¿‡çš„è§†é¢‘ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¸€èˆ¬çš„ï¼ŒLevel ä¸º k çš„è§†é¢‘åŒ…å«æ‰€æœ‰ä»ä½ å‡ºå‘ï¼Œæœ€çŸ­è·ç¦»ä¸º k çš„å¥½å‹è§‚çœ‹è¿‡çš„è§†é¢‘ã€‚\n\nç»™å®šä½ çš„ `id`  å’Œä¸€ä¸ª `level` å€¼ï¼Œè¯·ä½ æ‰¾å‡ºæ‰€æœ‰æŒ‡å®š level çš„è§†é¢‘ï¼Œå¹¶å°†å®ƒä»¬æŒ‰è§‚çœ‹é¢‘ç‡å‡åºè¿”å›ã€‚å¦‚æœæœ‰é¢‘ç‡ç›¸åŒçš„è§†é¢‘ï¼Œè¯·å°†å®ƒä»¬æŒ‰åå­—å­—å…¸åºä»å°åˆ°å¤§æ’åˆ—ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/02/01/I5XJKQg3WwvaeB1.png)\n\n```java\nè¾“å…¥ï¼šwatchedVideos = [[\"A\",\"B\"],[\"C\"],[\"B\",\"C\"],[\"D\"]], friends = [[1,2],[0,3],[0,3],[1,2]], id = 0, level = 1\nè¾“å‡ºï¼š[\"B\",\"C\"] \nè§£é‡Šï¼š\nä½ çš„ id ä¸º 0 ï¼Œä½ çš„æœ‹å‹åŒ…æ‹¬ï¼š\nid ä¸º 1 -> watchedVideos = [\"C\"] \nid ä¸º 2 -> watchedVideos = [\"B\",\"C\"] \nä½ æœ‹å‹è§‚çœ‹è¿‡è§†é¢‘çš„é¢‘ç‡ä¸ºï¼š\nB -> 1 \nC -> 2\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![image.png](https://i.loli.net/2020/02/01/qhDZvr3sbJkgIuw.png)\n\n```java\nè¾“å…¥ï¼šwatchedVideos = [[\"A\",\"B\"],[\"C\"],[\"B\",\"C\"],[\"D\"]], friends = [[1,2],[0,3],[0,3],[1,2]], id = 0, level = 2\nè¾“å‡ºï¼š[\"D\"]\nè§£é‡Šï¼š\nä½ çš„ id ä¸º 0 ï¼Œä½ æœ‹å‹çš„æœ‹å‹åªæœ‰ä¸€ä¸ªäººï¼Œä»–çš„ id ä¸º 3 ã€‚\n```\n\n**æç¤ºï¼š**\n\n- n == watchedVideos.length == friends.length\n- 2 <= n <= 100\n- 1 <= watchedVideos[i].length <= 100\n- 1 <= watchedVideos[i][j].length <= 8\n- 0 <= friends[i].length < n\n- 0 <= friends[i][j] < n\n- 0 <= id < n\n- 1 <= level < n\n- å¦‚æœ friends[i] åŒ…å« j ï¼Œé‚£ä¹ˆ friends[j] åŒ…å« i\n\n**è§£æ³•ä¸€**\n\n170å‘¨èµ›çš„ç¬¬ä¸‰é¢˜ï¼Œå…¶å®æ˜¯ä¸€é“æ°´é¢˜ï¼Œé¢˜ç›®æ„æ€ææ¸…æ¥šå°±å¾ˆç®€å•äº†\n\n```java\npublic List<String> watchedVideosByFriends(List<List<String>> watchedVideos, int[][] friends, int id, int level) {\n    Queue<Integer> queue=new LinkedList<>();\n    int[] levels=new int[friends.length]; //è¿™é‡Œæ²¡å¿…è¦,è¿™é‡Œç”¨ä¸€ä¸ªå˜é‡å°±okäº†\n    boolean[] visit=new boolean[friends.length];\n    HashMap<String,Integer> map=new HashMap<>();\n    List<Integer> flist=new ArrayList<>(); //levelå±‚çš„æœ‹å‹\n    queue.add(id);\n    visit[id]=true;\n    while(!queue.isEmpty()){\n        int cur=queue.poll();\n        int[] cfs=friends[cur];\n        for (int i=0;i<cfs.length;i++) {\n            if (!visit[cfs[i]]) {\n                queue.add(cfs[i]);\n                levels[cfs[i]]=levels[cur]+1;   \n                visit[cfs[i]]=true;\n                if (levels[cfs[i]] == level) {\n                    flist.add(cfs[i]);\n                }\n            }\n        }\n    }\n    for (int i=0;i<flist.size();i++) {\n        List<String> videos=watchedVideos.get(flist.get(i));\n        for (String v:videos) {\n            map.put(v,map.getOrDefault(v,0)+1); //mapè®°å½•videoså‡ºç°çš„æ¬¡æ•°\n        }\n    }\n    //ä¸‹é¢å‡ æ­¥è¿˜æ˜¯æŒºè€é“çš„\n    List<String> res=new ArrayList(map.keySet());\n    res.sort((v1,v2)->{\n        int c1=map.get(v1);\n        int c2=map.get(v2);\n        return c1==c2?v1.compareTo(v2):c1-c2; //ç›¸ç­‰çš„æ—¶å€™æŒ‰ç…§å­—å…¸åºåˆ—æ’åº\n    });\n    return res;\n}\n```\n\n## [399. é™¤æ³•æ±‚å€¼](https://leetcode-cn.com/problems/evaluate-division/)\n\nç»™å‡ºæ–¹ç¨‹å¼ A / B = k, å…¶ä¸­ A å’Œ B å‡ä¸ºä»£è¡¨å­—ç¬¦ä¸²çš„å˜é‡ï¼Œ k æ˜¯ä¸€ä¸ªæµ®ç‚¹å‹æ•°å­—ã€‚æ ¹æ®å·²çŸ¥æ–¹ç¨‹å¼æ±‚è§£é—®é¢˜ï¼Œå¹¶è¿”å›è®¡ç®—ç»“æœã€‚å¦‚æœç»“æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1.0ã€‚\n\nç¤ºä¾‹ :\n\n```java\nç»™å®š a / b = 2.0, b / c = 3.0\né—®é¢˜: a / c = ?, b / a = ?, a / e = ?, a / a = ?, x / x = ? \nè¿”å› [6.0, 0.5, -1.0, 1.0, -1.0 ]\n```\n\nè¾“å…¥ä¸º: `vector<pair<string, string>> equations, vector<double>& values, vector<pair<string, string>> queries(æ–¹ç¨‹å¼ï¼Œæ–¹ç¨‹å¼ç»“æœï¼Œé—®é¢˜æ–¹ç¨‹å¼)`ï¼Œ å…¶ä¸­ `equations.size() == values.size()`ï¼Œå³æ–¹ç¨‹å¼çš„é•¿åº¦ä¸æ–¹ç¨‹å¼ç»“æœé•¿åº¦ç›¸ç­‰ï¼ˆç¨‹å¼ä¸ç»“æœä¸€ä¸€å¯¹åº”ï¼‰ï¼Œå¹¶ä¸”ç»“æœå€¼å‡ä¸ºæ­£æ•°ã€‚ä»¥ä¸Šä¸ºæ–¹ç¨‹å¼çš„æè¿°ã€‚ è¿”å›`vector<double>`ç±»å‹ã€‚\n\nåŸºäºä¸Šè¿°ä¾‹å­ï¼Œè¾“å…¥å¦‚ä¸‹ï¼š\n\n```java\nequations(æ–¹ç¨‹å¼) = [ [\"a\", \"b\"], [\"b\", \"c\"] ],\nvalues(æ–¹ç¨‹å¼ç»“æœ) = [2.0, 3.0],\nqueries(é—®é¢˜æ–¹ç¨‹å¼) = [ [\"a\", \"c\"], [\"b\", \"a\"], [\"a\", \"e\"], [\"a\", \"a\"], [\"x\", \"x\"] ]. \n```\n\nè¾“å…¥æ€»æ˜¯æœ‰æ•ˆçš„ã€‚ä½ å¯ä»¥å‡è®¾é™¤æ³•è¿ç®—ä¸­ä¸ä¼šå‡ºç°é™¤æ•°ä¸º0çš„æƒ…å†µï¼Œä¸”ä¸å­˜åœ¨ä»»ä½•çŸ›ç›¾çš„ç»“æœã€‚\n\n**è§£æ³•ä¸€**\n\nå»ºç«‹å›¾ï¼Œç„¶åBFSï¼Œè¿™æ ·å°±ç®€å•å¤šäº†ï¼Œæ¯”å¹¶èŒ¶é›†çš„æ–¹æ³•ç›´ç™½å¤šäº†ï¼Œéšä¾¿ä¹Ÿå­¦äº†ä¸€ä¸‹å¦‚ä½•å»ºå›¾\n\n```java\n//æ„é€ å›¾ + BFS/DFS\nprivate Map<String,Map<String,Double>> graph = new HashMap<>();\n\npublic void buildGraph(List<List<String>> equations, double[] values){\n    for (int i = 0; i < values.length; i++) {\n        graph.computeIfAbsent(equations.get(i).get(0), k -> new HashMap<>()).put(equations.get(i).get(1), values[i]);\n        graph.computeIfAbsent(equations.get(i).get(1), k -> new HashMap<>()).put(equations.get(i).get(0), 1 / values[i]);\n    }\n}\n\nclass Pair{\n    String key;\n    double val;\n    public Pair(String key,double val){\n        this.key=key;\n        this.val=val;\n    }\n}\n\npublic double bfs(String a,String b){\n    //è®²é“ç†,ä¸ç®¡a,bæ˜¯å¦åœ¨graphä¸­,åªè¦æƒ³ç­‰éƒ½åº”è¯¥è¿”å›1å§,è¿™é‡Œæ˜¯è€ƒè™‘äº†0çš„æƒ…å†µ?\n    if (!graph.containsKey(a) || !graph.containsKey(b)) {\n        return -1.0;\n    }\n    if (a.equals(b)) {\n        return 1.0;\n    }\n    Queue<Pair> queue=new LinkedList<>();\n    queue.add(new Pair(a,1.0));\n    HashSet<String> visit=new HashSet<>();\n    while(!queue.isEmpty()){\n        Pair cur=queue.poll();\n        if (!visit.contains(cur.key)) {\n            visit.add(cur.key);\n            Map<String,Double> map=graph.get(cur.key);\n            for (String next:map.keySet()) {\n                if (b.equals(next)) {\n                    return cur.val*map.get(next);\n                }\n                queue.add(new Pair(next,cur.val*map.get(next)));\n            }\n        }\n    }\n    return -1.0;\n}\n\npublic double dfs(String a,String b,HashSet<String> visit){\n    if (!graph.containsKey(a)) {\n        return -1;\n    }\n    if (a.equals(b)) {\n        return 1;\n    }\n    visit.add(a);\n    Map<String,Double> nextMap=graph.get(a);\n    for (String next:nextMap.keySet()) {\n        if (!visit.contains(next)) {\n            double subres=dfs(next,b,visit);\n            if (subres!=-1) {\n                return subres*nextMap.get(next);\n            }\n        }\n    }\n    return -1;\n}\n\npublic double[] calcEquation(List<List<String>> equations, double[] values, List<List<String>> queries) {\n    buildGraph(equations,values);\n    double[] res=new double[queries.size()];\n    int index=0;\n    for (List<String> query:queries) {\n        HashSet<String> visit=new HashSet<>();\n        //res[index++]=bfs(query.get(0),query.get(1),visit); \n        res[index++]=bfs(query.get(0),query.get(1));\n    }\n    return res;\n}\n```\n\n## [301. åˆ é™¤æ— æ•ˆçš„æ‹¬å·](https://leetcode-cn.com/problems/remove-invalid-parentheses/)\n\nåˆ é™¤æœ€å°æ•°é‡çš„æ— æ•ˆæ‹¬å·ï¼Œä½¿å¾—è¾“å…¥çš„å­—ç¬¦ä¸²æœ‰æ•ˆï¼Œè¿”å›æ‰€æœ‰å¯èƒ½çš„ç»“æœã€‚\n\n**è¯´æ˜:** è¾“å…¥å¯èƒ½åŒ…å«äº†é™¤ ( å’Œ ) ä»¥å¤–çš„å­—ç¬¦ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"()())()\"\nè¾“å‡º: [\"()()()\", \"(())()\"]\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"(a)())()\"\nè¾“å‡º: [\"(a)()()\", \"(a())()\"]\n```\n\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: \")(\"\nè¾“å‡º: [\"\"]\n```\n\n**è§£æ³•ä¸€**\n\nBFSè§£æ³•\n\n```java\npublic List<String> removeInvalidParentheses(String s) {\n    List<String> res=new ArrayList<>();\n    Queue<String> queue=new LinkedList<>();\n    HashSet<String> visit=new HashSet<>();\n    visit.add(s);\n    queue.add(s);\n    boolean flag=false;\n    while(!queue.isEmpty()){\n        String cur=queue.poll();\n        if (isValid(cur)) {\n            res.add(cur);\n            flag=true;\n        }\n        if (flag) {\n            continue;\n        }\n        for (int i=0;i<cur.length();i++) {\n            if (cur.charAt(i)=='(' || cur.charAt(i)==')') {\n                String temp=cur.substring(0,i)+cur.substring(i+1,cur.length());\n                if (!visit.contains(temp)) {\n                    queue.add(temp);\n                    visit.add(temp);\n                }\n            }\n        }\n    }\n    if(res.isEmpty()) res.add(\"\");\n    return res;\n}\n\npublic boolean isValid(String s){\n    int left=0,right=0;\n    for (int i=0;i<s.length();i++) {\n        if (s.charAt(i)=='(') {\n            left++;\n        }else if (s.charAt(i)==')') {\n            if (left>0) {\n                left--;\n            }else{\n                return false;\n            }\n        }\n    }\n    return left==0;\n}\n```\n\nè¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œdfsçš„è§£æ³•æ¯”è¾ƒéš¾æï¼Œå®¹æ˜“TLEï¼Œè¿™é‡Œæ‡’å¾—å†™äº†\n\n## [994. è…çƒ‚çš„æ©˜å­](https://leetcode-cn.com/problems/rotting-oranges/)\n\nåœ¨ç»™å®šçš„ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªå•å…ƒæ ¼å¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ä¸ªå€¼ä¹‹ä¸€ï¼š\n\n- å€¼ 0 ä»£è¡¨ç©ºå•å…ƒæ ¼ï¼›\n- å€¼ 1 ä»£è¡¨æ–°é²œæ©˜å­ï¼›\n- å€¼ 2 ä»£è¡¨è…çƒ‚çš„æ©˜å­ã€‚\n\næ¯åˆ†é’Ÿï¼Œä»»ä½•ä¸è…çƒ‚çš„æ©˜å­ï¼ˆåœ¨ 4 ä¸ªæ­£æ–¹å‘ä¸Šï¼‰ç›¸é‚»çš„æ–°é²œæ©˜å­éƒ½ä¼šè…çƒ‚ã€‚\n\nè¿”å›ç›´åˆ°å•å…ƒæ ¼ä¸­æ²¡æœ‰æ–°é²œæ©˜å­ä¸ºæ­¢æ‰€å¿…é¡»ç»è¿‡çš„æœ€å°åˆ†é’Ÿæ•°ã€‚å¦‚æœä¸å¯èƒ½ï¼Œè¿”å› -1ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![mark](http://static.imlgw.top/blog/20200304/YGBajce2liDs.png?imageslim)\n\n```java\nè¾“å…¥ï¼š[[2,1,1],[1,1,0],[0,1,1]]\nè¾“å‡ºï¼š4\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[[2,1,1],[0,1,1],[1,0,1]]\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼šå·¦ä¸‹è§’çš„æ©˜å­ï¼ˆç¬¬ 2 è¡Œï¼Œ ç¬¬ 0 åˆ—ï¼‰æ°¸è¿œä¸ä¼šè…çƒ‚ï¼Œå› ä¸ºè…çƒ‚åªä¼šå‘ç”Ÿåœ¨ 4 ä¸ªæ­£å‘ä¸Šã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[[0,2]]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šå› ä¸º 0 åˆ†é’Ÿæ—¶å·²ç»æ²¡æœ‰æ–°é²œæ©˜å­äº†ï¼Œæ‰€ä»¥ç­”æ¡ˆå°±æ˜¯ 0 ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= grid.length <= 10`\n2. `1 <= grid[0].length <= 10`\n3. `grid[i][j]` ä»…ä¸º `0`ã€`1` æˆ– `2`\n\n**è§£æ³•ä¸€**\n\nBFSæ‰“å¡é¢˜ï¼Œè¿™ç§è§£æ³•åº”è¯¥ç®—æ˜¯æ¯”è¾ƒå¥½çš„äº†ï¼Œ2ms\n\n```java\nprivate int[][] diretion={{0,1},{1,0},{0,-1},{-1,0}};\n\npublic int orangesRotting(int[][] grid) {\n    Queue<Pair> queue=new LinkedList<>();\n    int time=0;\n    int count=0;\n    for(int i=0;i<grid.length;i++){\n        for(int j=0;j<grid[0].length;j++){\n            if(grid[i][j]==1) count++; //ç»Ÿè®¡å¥½æ©˜å­çš„æ•°é‡\n            if(grid[i][j]==2){\n                queue.add(new Pair(i,j));\n            }\n        }\n    }\n    if(count==0) return 0;\n    while(!queue.isEmpty()){\n        //æ¯ä¸€è½®çš„åæ©˜å­æ•°é‡\n        int size=queue.size();\n        time++;\n        while(size-- >0){\n            Pair pair=queue.poll();\n            for (int i=0;i<4;i++) {\n                int nx=pair.x+diretion[i][0];\n                int ny=pair.y+diretion[i][1];\n                if(valid(grid,nx,ny) && grid[nx][ny]==1){\n                    grid[nx][ny]=2;\n                    count--;//å¥½æ©˜å­--\n                    queue.add(new Pair(nx,ny));\n                }\n            }\n            if(count==0) return time;\n        }\n    }\n    return -1;\n}\n\nclass Pair{\n    int x,y;\n    public Pair(int x,int y){\n        this.x=x;\n        this.y=y;\n    }\n}\n\npublic boolean valid(final int[][] grid,int x,int y){\n    return x>=0 && x<grid.length && y>=0 && y<grid[0].length;\n}\n```\n**è§£æ³•äºŒ**\n\nä¸€å¼€å§‹çš„è§£æ³•ï¼Œè™½ç„¶æ•ˆç‡ç¨å¾®ä½ä¸€ç‚¹ç‚¹ 4msï¼Œä½†æ˜¯bugfreeäº†\n\n```java\nprivate int[][] diretion={{0,1},{1,0},{0,-1},{-1,0}};\n\nclass Pair{\n    int x,y;\n    int step;\n    public Pair(int x,int y,int step){\n        this.x=x;\n        this.y=y;\n        this.step=step;\n    }\n}\n\npublic int orangesRotting(int[][] grid) {\n    Queue<Pair> queue=new LinkedList<>();\n    int max=0;\n    for(int i=0;i<grid.length;i++){\n        for(int j=0;j<grid[0].length;j++){\n            if(grid[i][j]==2){\n                queue.add(new Pair(i,j,0));\n            }\n        }\n    }\n    while(!queue.isEmpty()){\n        Pair pair=queue.poll();\n        //ç»Ÿè®¡ä¸€ä¸ªæœ€å¤§çš„æ­¥æ•°ä½œä¸ºç»“æœ\n        //max=Math.max(max,pair.step);\n        max=pair.step; //æœ€åå¼¹å‡ºçš„å“ªä¸ªå°±æ˜¯æœ€å¤§çš„ï¼Œè¿™æ˜¯ä¸ªé€’å¢(éå•è°ƒ)çš„è¿‡ç¨‹\n        for (int i=0;i<4;i++) {\n            int nx=pair.x+diretion[i][0];\n            int ny=pair.y+diretion[i][1];\n            if(valid(grid,nx,ny) && grid[nx][ny]==1){\n                grid[nx][ny]=2;\n                queue.add(new Pair(nx,ny,pair.step+1));\n            }\n        }\n    }\n    return check(grid)?max:-1;\n}\n\npublic boolean check(int[][] grid){\n    for(int i=0;i<grid.length;i++){\n        for(int j=0;j<grid[0].length;j++){\n            if(grid[i][j]==1){\n                return false;\n            }\n        }\n    }\n    return true;\n}\n\npublic boolean valid(final int[][] grid,int x,int y){\n    return x>=0 && x<grid.length && y>=0 && y<grid[0].length;\n}\n```\nç»è¿‡å‹˜è¯¯ï¼Œå‘ç°æœ‰ä¸€å¤„åœ°æ–¹æœ‰ç‚¹å°é—®é¢˜ï¼Œå·²ç»ä¿®æ”¹ï¼Œ`pair.step` åœ¨é˜Ÿåˆ—ä¸­æ˜¯ä¸€ä¸ªé€’å¢ï¼ˆä¸å•è°ƒï¼Œä¼šç›¸ç­‰ï¼‰çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æœ€åå¼¹å‡ºçš„å°±æ˜¯æœ€å¤§çš„\n\n## [1162. åœ°å›¾åˆ†æ](https://leetcode-cn.com/problems/as-far-from-land-as-possible/)\n\nä½ ç°åœ¨æ‰‹é‡Œæœ‰ä¸€ä»½å¤§å°ä¸º N x N çš„ã€åœ°å›¾ã€ï¼ˆç½‘æ ¼ï¼‰ gridï¼Œä¸Šé¢çš„æ¯ä¸ªã€åŒºåŸŸã€ï¼ˆå•å…ƒæ ¼ï¼‰éƒ½ç”¨ 0 å’Œ 1 æ ‡è®°å¥½äº†ã€‚å…¶ä¸­ 0 ä»£è¡¨æµ·æ´‹ï¼Œ1 ä»£è¡¨é™†åœ°ï¼Œä½ çŸ¥é“è·ç¦»é™†åœ°åŒºåŸŸæœ€è¿œçš„æµ·æ´‹åŒºåŸŸæ˜¯æ˜¯å“ªä¸€ä¸ªå—ï¼Ÿè¯·è¿”å›è¯¥æµ·æ´‹åŒºåŸŸåˆ°ç¦»å®ƒæœ€è¿‘çš„é™†åœ°åŒºåŸŸçš„è·ç¦»ã€‚\n\næˆ‘ä»¬è¿™é‡Œè¯´çš„è·ç¦»æ˜¯ã€æ›¼å“ˆé¡¿è·ç¦»ã€ï¼ˆ Manhattan Distanceï¼‰ï¼š(x0, y0) å’Œ (x1, y1) è¿™ä¸¤ä¸ªåŒºåŸŸä¹‹é—´çš„è·ç¦»æ˜¯ |x0 - x1| + |y0 - y1| ã€‚\n\nå¦‚æœæˆ‘ä»¬çš„åœ°å›¾ä¸Šåªæœ‰é™†åœ°æˆ–è€…æµ·æ´‹ï¼Œè¯·è¿”å› -1ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![GVuO3Q.png](https://s1.ax1x.com/2020/03/29/GVuO3Q.png)\n\n```java\nè¾“å…¥ï¼š[[1,0,1],[0,0,0],[1,0,1]]\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š \næµ·æ´‹åŒºåŸŸ (1, 1) å’Œæ‰€æœ‰é™†åœ°åŒºåŸŸä¹‹é—´çš„è·ç¦»éƒ½è¾¾åˆ°æœ€å¤§ï¼Œæœ€å¤§è·ç¦»ä¸º 2ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![GVKSH0.png](https://s1.ax1x.com/2020/03/29/GVKSH0.png)\n\n```java\nè¾“å…¥ï¼š[[1,0,0],[0,0,0],[0,0,0]]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼š \næµ·æ´‹åŒºåŸŸ (2, 2) å’Œæ‰€æœ‰é™†åœ°åŒºåŸŸä¹‹é—´çš„è·ç¦»éƒ½è¾¾åˆ°æœ€å¤§ï¼Œæœ€å¤§è·ç¦»ä¸º 4ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= grid.length == grid[0].length <= 100`\n2. `grid[i][j]` ä¸æ˜¯ `0` å°±æ˜¯ `1`\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜çš„æ„æ€å…¶å®æ±‚**ç¦»é™†åœ°æœ€è¿œçš„æµ·æ´‹æ˜¯é‚£ä¸€å—ï¼Œç„¶åè¿”å›è¿™ä¸ªæœ€è¿œçš„è·ç¦»**ï¼Œè¿™ä¸ªé¢˜ç›®æè¿°çš„ç¡®å®è®©äººè¿·æƒ‘ï¼Œä¸€ä¼šå„¿æœ€è¿œï¼Œä¸€ä¼šå„¿æœ€è¿‘ï¼Œå…¶å®é¢˜ç›®æ„æ€ææ‡‚äº†å°±å¾ˆç®€å•äº†ï¼Œå…¶å®å’Œä¸Šé¢è…çƒ‚çš„æ©˜å­æ˜¯ä¸€æ ·çš„ã€‚å¤šæºçš„BFSï¼Œæ›¼å“ˆé¡¿è·ç¦»å…¶å®å°±æ˜¯ä¸Šä¸‹å·¦å³èµ°çš„step\n\n```java\nprivate int[][] diretion={{1,0},{-1,0},{0,1},{0,-1}};\n\npublic int maxDistance(int[][] grid) {\n    int maxDis=-1;\n    int m=grid.length,n=grid[0].length;\n    boolean[][] visit=new boolean[m][n];\n    Queue<Pair> queue=new LinkedList<>();\n    for(int i=0;i<m;i++){\n        for(int j=0;j<n;j++){\n            if(grid[i][j]==1){\n                queue.add(new Pair(i,j,0));\n                visit[i][j]=true;\n            }\n        }\n    }\n    if(queue.size()==0 || queue.size()==m*n)return -1;\n    int step=0;\n    int res=-1;\n    while(!queue.isEmpty()){\n        Pair pair=queue.poll();\n        res=pair.step;\n        for (int i=0;i<4;i++) {\n            int nx=pair.x+diretion[i][0];\n            int ny=pair.y+diretion[i][1];\n            if(valid(grid,nx,ny) && !visit[nx][ny] && grid[nx][ny]==0){\n                queue.add(new Pair(nx,ny,pair.step+1));\n                visit[nx][ny]=true;\n            }\n        }\n    }\n    return res;\n}\n\nclass Pair{\n    int x,y;\n    int step;\n    public Pair(int x,int y,int step){\n        this.x=x;\n        this.y=y;\n        this.step=step;\n    }\n}\n\npublic boolean valid(final int[][] grid,int x,int y){\n    return x>=0 && x<grid.length && y>=0 && y<grid[0].length;\n}\n```\n## [207. è¯¾ç¨‹è¡¨](https://leetcode-cn.com/problems/course-schedule/)\n\nä½ è¿™ä¸ªå­¦æœŸå¿…é¡»é€‰ä¿® `numCourse` é—¨è¯¾ç¨‹ï¼Œè®°ä¸º 0 åˆ° `numCourse-1` ã€‚\n\nåœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬ï¼š`[0,1]`\n\nç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œè¯·ä½ åˆ¤æ–­æ˜¯å¦å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ ï¼Ÿ\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 2, [[1,0]] \nè¾“å‡º: true\nè§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å®Œæˆè¯¾ç¨‹ 0ã€‚æ‰€ä»¥è¿™æ˜¯å¯èƒ½çš„ã€‚\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 2, [[1,0],[0,1]]\nè¾“å‡º: false\nè§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ï¼›å¹¶ä¸”å­¦ä¹ è¯¾ç¨‹ 0 ä¹‹å‰ï¼Œä½ è¿˜åº”å…ˆå®Œæˆè¯¾ç¨‹ 1ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. è¾“å…¥çš„å…ˆå†³æ¡ä»¶æ˜¯ç”± è¾¹ç¼˜åˆ—è¡¨ è¡¨ç¤ºçš„å›¾å½¢ï¼Œè€Œä¸æ˜¯ é‚»æ¥çŸ©é˜µ ã€‚è¯¦æƒ…è¯·å‚è§å›¾çš„è¡¨ç¤ºæ³•ã€‚\n2. ä½ å¯ä»¥å‡å®šè¾“å…¥çš„å…ˆå†³æ¡ä»¶ä¸­æ²¡æœ‰é‡å¤çš„è¾¹ã€‚\n3. `1 <= numCourses <= 10^5`\n\n**è§£æ³•äºŒ**\n\nå­¦ä¹ ä¸‹æ‹“æ‰‘æ’åºï¼Œå…¶å®æ ¸å¿ƒåœ¨äºé‚»æ¥è¡¨çš„æ„å»º\n\n```java\npublic boolean canFinish(int numCourses, int[][] prerequisites) {\n    int[] indegree=new int[numCourses];\n    List<List<Integer>> adjacency=new ArrayList<>();\n    for(int i=0;i<numCourses;i++){\n        adjacency.add(new ArrayList<>());\n    }\n    for(int[] p:prerequisites){\n        indegree[p[0]]++; //æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦å€¼\n        //é‚»æ¥è¡¨,æ³¨æ„è¿™é‡Œåˆ«æåäº†,è¿™é‡Œè®°å½•çš„æ˜¯p[1]æ‰€æœ‰çš„å‡ºåº¦èŠ‚ç‚¹\n        adjacency.get(p[1]).add(p[0]); \n    }\n    //è¯¾ç¨‹id\n    Queue<Integer> queue=new LinkedList<>();\n    for(int i=0;i<numCourses;i++){\n        if(indegree[i]==0){\n            queue.add(i);\n        }\n    }\n    while(!queue.isEmpty()){\n        int cid=queue.poll();\n        numCourses--;\n        for (int id:adjacency.get(cid)) { //cid --> id\n            //è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰é‚»æ¥èŠ‚ç‚¹å…¥åº¦--\n            indegree[id]--;\n            if(indegree[id]==0){\n                queue.add(id);\n            }\n        }\n    }\n    return numCourses==0;\n}\n```\n## [210. è¯¾ç¨‹è¡¨ II](https://leetcode-cn.com/problems/course-schedule-ii/)\n\nç°åœ¨ä½ æ€»å…±æœ‰ *n* é—¨è¯¾éœ€è¦é€‰ï¼Œè®°ä¸º `0` åˆ° `n-1`ã€‚\n\nåœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬: `[0,1]`\n\nç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œè¿”å›ä½ ä¸ºäº†å­¦å®Œæ‰€æœ‰è¯¾ç¨‹æ‰€å®‰æ’çš„å­¦ä¹ é¡ºåºã€‚\n\nå¯èƒ½ä¼šæœ‰å¤šä¸ªæ­£ç¡®çš„é¡ºåºï¼Œä½ åªè¦è¿”å›ä¸€ç§å°±å¯ä»¥äº†ã€‚å¦‚æœä¸å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼Œè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 2, [[1,0]] \nè¾“å‡º: [0,1]\nè§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 1ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºä¸º [0,1] ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 4, [[1,0],[2,0],[3,1],[3,2]]\nè¾“å‡º: [0,1,2,3] or [0,2,1,3]\nè§£é‡Š: æ€»å…±æœ‰ 4 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 3ï¼Œä½ åº”è¯¥å…ˆå®Œæˆè¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2ã€‚å¹¶ä¸”è¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2 éƒ½åº”è¯¥æ’åœ¨è¯¾ç¨‹ 0 ä¹‹åã€‚\n     å› æ­¤ï¼Œä¸€ä¸ªæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºæ˜¯ [0,1,2,3] ã€‚å¦ä¸€ä¸ªæ­£ç¡®çš„æ’åºæ˜¯ [0,2,1,3] ã€‚\n```\n\n**è¯´æ˜:**\n\n1. è¾“å…¥çš„å…ˆå†³æ¡ä»¶æ˜¯ç”±**è¾¹ç¼˜åˆ—è¡¨**è¡¨ç¤ºçš„å›¾å½¢ï¼Œè€Œä¸æ˜¯é‚»æ¥çŸ©é˜µã€‚è¯¦æƒ…è¯·å‚è§[å›¾çš„è¡¨ç¤ºæ³•](http://blog.csdn.net/woaidapaopao/article/details/51732947)ã€‚\n2. ä½ å¯ä»¥å‡å®šè¾“å…¥çš„å…ˆå†³æ¡ä»¶ä¸­æ²¡æœ‰é‡å¤çš„è¾¹ã€‚\n\n**æç¤º:**\n\n1. è¿™ä¸ªé—®é¢˜ç›¸å½“äºæŸ¥æ‰¾ä¸€ä¸ªå¾ªç¯æ˜¯å¦å­˜åœ¨äºæœ‰å‘å›¾ä¸­ã€‚å¦‚æœå­˜åœ¨å¾ªç¯ï¼Œåˆ™ä¸å­˜åœ¨æ‹“æ‰‘æ’åºï¼Œå› æ­¤ä¸å¯èƒ½é€‰å–æ‰€æœ‰è¯¾ç¨‹è¿›è¡Œå­¦ä¹ ã€‚\n2. [é€šè¿‡ DFS è¿›è¡Œæ‹“æ‰‘æ’åº](https://www.coursera.org/specializations/algorithms) - ä¸€ä¸ªå…³äºCourseraçš„ç²¾å½©è§†é¢‘æ•™ç¨‹ï¼ˆ21åˆ†é’Ÿï¼‰ï¼Œä»‹ç»æ‹“æ‰‘æ’åºçš„åŸºæœ¬æ¦‚å¿µã€‚\n3. æ‹“æ‰‘æ’åºä¹Ÿå¯ä»¥é€šè¿‡ [BFS](https://baike.baidu.com/item/%E5%AE%BD%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2/5224802?fr=aladdin&fromid=2148012&fromtitle=%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2) å®Œæˆã€‚\n\n**è§£æ³•ä¸€**\n\nBFSåšæ³•ï¼Œå’Œä¸Šé¢ä¸€æ ·\n\n```java\n//BFSæ‹“æ‰‘æ’åº\npublic int[] findOrder(int numCourses, int[][] prerequisites) {\n    int[] indegree=new int[numCourses]; //å…¥åº¦æ•°\n    List<List<Integer>> adjacency=new ArrayList<>();\n    for(int i=0;i<numCourses;i++){\n        adjacency.add(new ArrayList<>());\n    }\n    for(int[] pre:prerequisites){\n        indegree[pre[0]]++;\n        adjacency.get(pre[1]).add(pre[0]);\n    }\n    int k=0;\n    int[] res=new int[numCourses];\n    Queue<Integer> queue=new LinkedList<>();\n    for(int i=0;i<numCourses;i++){\n        if(indegree[i]==0){\n            queue.add(i);\n        }\n    }\n    while(!queue.isEmpty()){\n        int cur=queue.poll();\n        res[k++]=cur;\n        for(int c:adjacency.get(cur)){\n            indegree[c]--;\n            if(indegree[c]==0){\n                queue.add(c);\n            }\n        }\n    }\n    return k==numCourses?res:new int[0];\n}\n```\n\n**è§£æ³•äºŒ**\n\nDFSçš„åšæ³•ï¼Œæ¯”BFSæ›´æœ‰æ„æ€ä¸€ç‚¹ï¼Œå…¶å®å°±æ˜¯ä¸ªä¸æ–­åˆ¤ç¯çš„è¿‡ç¨‹ï¼Œå›¾ç›¸å…³çš„è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰å•Š\n\n```java\n//DFSçš„è§£æ³•\nint k=0;\n\npublic int[] findOrder(int numCourses, int[][] prerequisites) {\n    List<List<Integer>> adjacency=new ArrayList<>();\n    for(int i=0;i<numCourses;i++){\n        adjacency.add(new ArrayList<>());\n    }\n    int[] mark=new int[numCourses];\n    int[] res=new int[numCourses];\n    for(int[] pre:prerequisites){\n        adjacency.get(pre[0]).add(pre[1]); //æ³¨æ„è¿™ä¸ªåŒºåˆ«\n    }\n    for (int i=0;i<numCourses;i++) {\n        if(dfs(adjacency,i,mark,res)) return new int[0];\n    }\n    return res;\n}\n\npublic boolean dfs(List<List<Integer>> adj,int cur,int[] mark,int[] res){\n    if(mark[cur]==1) return true;  //æ­£åœ¨è®¿é—®\n    if(mark[cur]==2) return false; //èŠ‚ç‚¹å·²ç»è®¿é—®å®Œï¼ˆä¹‹å‰å·²ç»å­¦äº†ï¼‰\n    mark[cur]=1;\n    for(int c:adj.get(cur)){\n        if(dfs(adj,c,mark,res)){\n            return true;\n        }\n    }\n    mark[cur]=2;\n    //curçš„å…ˆå†³è¯¾ç¨‹æ˜¯æ²¡ç¯çš„ï¼Œæ‰€ä»¥å¯ä»¥å­¦cur\n    res[k++]=cur; \n    return false;\n}\n```\n\n## [365. æ°´å£¶é—®é¢˜](https://leetcode-cn.com/problems/water-and-jug-problem/)\n\nDifficulty: **ä¸­ç­‰**\n\n\næœ‰ä¸¤ä¸ªå®¹é‡åˆ†åˆ«ä¸ºÂ _x_å‡ å’Œ _y_å‡ çš„æ°´å£¶ä»¥åŠæ— é™å¤šçš„æ°´ã€‚è¯·åˆ¤æ–­èƒ½å¦é€šè¿‡ä½¿ç”¨è¿™ä¸¤ä¸ªæ°´å£¶ï¼Œä»è€Œå¯ä»¥å¾—åˆ°æ°å¥½Â _z_å‡ çš„æ°´ï¼Ÿ\n\nå¦‚æœå¯ä»¥ï¼Œæœ€åè¯·ç”¨ä»¥ä¸Šæ°´å£¶ä¸­çš„ä¸€æˆ–ä¸¤ä¸ªæ¥ç››æ”¾å–å¾—çš„Â _zå‡Â _æ°´ã€‚\n\nä½ å…è®¸ï¼š\n\n*   è£…æ»¡ä»»æ„ä¸€ä¸ªæ°´å£¶\n*   æ¸…ç©ºä»»æ„ä¸€ä¸ªæ°´å£¶\n*   ä»ä¸€ä¸ªæ°´å£¶å‘å¦å¤–ä¸€ä¸ªæ°´å£¶å€’æ°´ï¼Œç›´åˆ°è£…æ»¡æˆ–è€…å€’ç©º\n\n**ç¤ºä¾‹ 1:** (From the famous )\n\n```go\nè¾“å…¥: x = 3, y = 5, z = 4\nè¾“å‡º: True\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥: x = 2, y = 6, z = 5\nè¾“å‡º: False\n```\n\n\n**è§£æ³•ä¸€**\n\næš´åŠ›BFSçš„è§£æ³•\n```java\npublic boolean canMeasureWater(int x, int y, int z) {\n    Queue<int[]> queue = new LinkedList<>();\n    int capX = x;\n    int capY = y;\n    queue.add(new int[]{x, y});\n    while(!queue.isEmpty()) {\n        int[] cur = queue.poll();\n        int cx = cur[0];\n        int cy = cur[1];\n        if (cx==z || cy==z || cx+cy==z) {\n            return true;\n        }\n        //æ¸…ç©ºx\n        addQueue(0, cy, queue);\n        //æ¸…ç©ºy\n        addQueue(cx, 0, queue);\n        //è£…æ»¡x\n        addQueue(capX, cy, queue);\n        //è£…æ»¡y\n        addQueue(cx, capY, queue);\n        //x-->y\n        addQueue(Math.max(0, cx-capY+cy), Math.min(capY, cy+cx), queue);\n        //y-->x\n        addQueue(Math.min(capX, cy+cx), Math.max(0, cy-capY+cx), queue);\n    }\n    return false;\n}\n\npublic void addQueue(int x, int y, Queue<int[]> queue){\n    long hashCode = x * (long)1e9+7 + y;\n    if (!visit.contains(hashCode)) {\n        queue.add(new int[]{x, y});\n        visit.add(hashCode);\n    }\n}\n```\n**è§£æ³•äºŒ**\næ•°å­¦è§£æ³•ï¼Œæ¶‰åŠåˆ°ä¸€äº›æ•°å­¦å®šç†ï¼ˆè´ç¥–å®šç†ï¼‰ï¼Œæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼ˆå°±æ˜¯ææ‡‚è¿‡ä¸¤å¤©ä¹Ÿå¿˜äº†ï¼‰\n```java\npublic boolean canMeasureWater(int x, int y, int z) {\n    if(x+y<z) return false;\n    if(x==0 || y==0) return z==0 || x+y==z;\n    return z%gcd(x,y)==0;\n}\n\npublic int gcd(int a,int b){\n    if(b==0) return a;\n    return gcd(b,a%b);\n}\n```\n\n## _å•è°ƒæ ˆ_\n\n> å•ç‹¬å¼€è¾Ÿå‡ºæ–°çš„ä¸“é¢˜ [LeetCodeå•è°ƒæ ˆ](http://imlgw.top/2020/08/28/leetcode-dan-diao-zhan/)","tags":["LeetCode"],"categories":["ç®—æ³•"]},{"title":"AQSæºç è§£æï¼ˆä¸Šï¼‰","url":"/2019/09/24/abstractqueuedsynchronizer/","content":"\n## AbstractQueuedSynchronized\n\n`AbstractQueuedSynchronized` ç®€ç§°AQSï¼Œè¿™ä¸ªç±»æ˜¯æ•´ä¸ªå¹¶å‘åŒ…çš„åŸºç¡€å·¥å…·ç±»ï¼Œ ReentrantLockã€CountDownLatchã€Semaphoreã€FutureTask ç­‰å¹¶å‘å·¥å…·ç±»åº•å±‚éƒ½æ˜¯é€šè¿‡å®ƒæ¥å®ç°çš„\n\nAQSå®šä¹‰äº†ä¸¤ç§èµ„æºå…±äº«çš„æ–¹å¼ï¼š\n\n- Exclusiveï¼šç‹¬å å¼ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–èµ„æºå¹¶æ‰§è¡Œï¼Œæ¯”å¦‚ReentrantLockã€‚\n- Shareï¼šå…±äº«å¼ï¼Œå¤šä¸ªçº¿ç¨‹è·å–èµ„æºï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œæ¯”å¦‚CountDownLatchï¼ŒReentrantReadWriteLockçš„ReadLockç­‰\n\n### AQSç»“æ„\n\n#### å±æ€§\n\nä¸»è¦çš„å°±æ˜¯è¿™ä¸‰ä¸ªvolatileä¿®é¥°çš„Nodeå¯¹è±¡ï¼Œè¿˜æœ‰ä¸€äº›å¯¹åº”çš„åç§»é‡(ç”¨äºCASçš„)\n\n```java\n/**\n * Head of the wait queue, lazily initialized.  Except for\n * initialization, it is modified only via method setHead.  Note:\n * If head exists, its waitStatus is guaranteed not to be\n * CANCELLED.\n * å¤´èŠ‚ç‚¹ï¼Œå¯ä»¥ç†è§£ä¸ºå½“å‰æŒæœ‰é”çš„èŠ‚ç‚¹\n * åœ¨åˆ†æçš„è¿‡ç¨‹ä¸­ä¸è¦å°†å®ƒç®—ä½œé˜Ÿåˆ—çš„ä¸€éƒ¨åˆ†ï¼å®ƒåªæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹\n */\nprivate transient volatile Node head;\n\n/**\n * Tail of the wait queue, lazily initialized.  Modified only via\n * method enq to add new wait node.\n * å°¾èŠ‚ç‚¹\n */\nprivate transient volatile Node tail;\n\n/**\n * The synchronization state.\n * åŒæ­¥çŠ¶æ€ï¼Œ0ä»£è¡¨æ²¡æœ‰è¢«å ç”¨ï¼Œ1ä»£è¡¨è¢«ä¸€ä¸ªçº¿ç¨‹å ç”¨ï¼Œ>1 ä»£è¡¨è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡å ç”¨ï¼ˆå¯é‡å…¥ï¼‰\n */\nprivate volatile int state;\n```\n\n#### NodeèŠ‚ç‚¹\n\n```java\nstatic final class Node {\n    /** Marker to indicate a node is waiting in shared mode */\n    //å…±äº«æ¨¡å¼\n    static final Node SHARED = new Node();\n    /** Marker to indicate a node is waiting in exclusive mode */\n    //ç‹¬å æ¨¡å¼\n    static final Node EXCLUSIVE = null;\n\n    /** waitStatus value to indicate thread has cancelled */\n    //å–æ¶ˆæŠ¢é”\n    static final int CANCELLED =  1;\n    \n    /** waitStatus value to indicate successor's thread needs unparking */\n    //ä»£è¡¨å½“å‰èŠ‚ç‚¹çš„åç»­èŠ‚ç‚¹éœ€è¦è¢«unparkingï¼Œä¹Ÿå°±æ˜¯è¯´åç»§èŠ‚ç‚¹çŠ¶æ€æ˜¯parking\n    static final int SIGNAL    = -1;\n    \n    /** waitStatus value to indicate thread is waiting on condition */\n    //åœ¨conditionä¸Šç­‰å¾…\n    static final int CONDITION = -2;\n    \n    /**\n     * waitStatus value to indicate the next acquireShared should\n     * unconditionally propagate\n     */\n    static final int PROPAGATE = -3;\n\n\t//ä¸Šé¢çš„é‚£äº›çŠ¶æ€\n    volatile int waitStatus;\n\n    //å‰é©±èŠ‚ç‚¹    \n    volatile Node prev;\n    //åç»§èŠ‚ç‚¹\n    volatile Node next;\n\n    /**\n     * The thread that enqueued this node.  Initialized on\n     * construction and nulled out after use.\n     */\n    volatile Thread thread;\n\n    /**\n     * Link to next node waiting on condition, or the special\n     * value SHARED.  Because condition queues are accessed only\n     * when holding in exclusive mode, we just need a simple\n     * linked queue to hold nodes while they are waiting on\n     * conditions. They are then transferred to the queue to\n     * re-acquire. And because conditions can only be exclusive,\n     * we save a field by using special value to indicate shared\n     * mode.\n     */\n    Node nextWaiter;\n\n    /**\n     * Returns true if node is waiting in shared mode.\n     */\n    final boolean isShared() {\n        return nextWaiter == SHARED;\n    }\n\n    //è¿”å›å‰é©±èŠ‚ç‚¹\n    final Node predecessor() throws NullPointerException {\n        Node p = prev;\n        if (p == null)\n            throw new NullPointerException();\n        else\n            return p;\n    }\n\n    Node() {    // Used to establish initial head or SHARED marker\n    }\n\n    Node(Thread thread, Node mode) {     // Used by addWaiter\n        this.nextWaiter = mode;\n        this.thread = thread;\n    }\n\n    Node(Thread thread, int waitStatus) { // Used by Condition\n        this.waitStatus = waitStatus;\n        this.thread = thread;\n    }\n}\n```\n\n## ReentrantLockåˆ†æ\n\næˆ‘ä»¬çŸ¥é“ReentrantLockå†…éƒ¨æœ‰ä¸¤ä¸ªé”ï¼Œä¸€ä¸ªæ˜¯å…¬å¹³é”(FairSync)ğŸ”’ï¼Œä¸€ä¸ªæ˜¯éå…¬å¹³é”(NonFairSync)ğŸ”’ï¼Œè¿™ä¸¤ä¸ªé”éƒ½æ˜¯ç‹¬å é”ï¼Œä¸¤è€…å®ç°çš„å·®å¼‚å…¶å®å¹¶ä¸å¤§ï¼Œæˆ‘ä»¬å…ˆä»`å…¬å¹³é”`å¼€å§‹è¯´èµ·ã€‚\n\n```java\nstatic final class FairSync extends Sync {\n    private static final long serialVersionUID = -3000897897090466540L;\n\n    final void lock() {\n        acquire(1);\n    }\n    \n    /**\n     * Fair version of tryAcquire.  Don't grant access unless\n     * recursive call or no waiters or is first.\n     */\n    protected final boolean tryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        if (c == 0) {\n            if (!hasQueuedPredecessors() &&\n                compareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        else if (current == getExclusiveOwnerThread()) {\n            int nextc = c + acquires;\n            if (nextc < 0)\n                throw new Error(\"Maximum lock count exceeded\");\n            setState(nextc);\n            return true;\n        }\n        return false;\n    }\n}\n```\n\n### Lock()\n\nğŸ”” **è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ¨¡æ‹ŸçœŸå®çš„æƒ…å†µï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹`Thread0` å’Œ`Thread1` è¿‡æ¥æ‰§è¡Œäº†`Lock()` æ–¹æ³•ï¼Œä¸”`Thread0` æ¯”`Thread1` è¦å…ˆæ‰§è¡Œã€‚**\n\n`Lock()`æ–¹æ³•ä¸­è°ƒç”¨äº†çˆ¶ç±»çš„`acquire(1)`\n\n#### acquire()\n\n```java\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) && acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n```\n\né¦–å…ˆå°è¯•tryAcquire(1)ï¼Œè¿™ä¸ªtryLock()åœ¨AQSä¸­æ²¡æœ‰å…·ä½“å®ç°æ˜¯äº¤ç»™å­ç±»å»å®ç°çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¼šè°ƒç”¨FairSyncçš„ï¼ŒtryAquire(1)\n\n#### tryAquire()\n\n```java\nprotected final boolean tryAcquire(int acquires) {\n    //è·å–å½“å‰çº¿ç¨‹\n    final Thread current = Thread.currentThread();\n    //è·å–åŒæ­¥çŠ¶æ€\n    int c = getState();\n    if (c == 0) { //0ä»£è¡¨è¿˜æ²¡æœ‰çº¿ç¨‹å ç”¨\n        //åˆ¤æ–­æœ‰æ²¡æœ‰å‰é©±èŠ‚ç‚¹ï¼ˆé™¤headèŠ‚ç‚¹å¤–ï¼‰ï¼Œæ²¡æœ‰åˆ™è¿›è¡ŒCASè®¾ç½®åŒæ­¥çŠ¶æ€è·å–é”\n        if (!hasQueuedPredecessors() && compareAndSetState(0, acquires)) { \n            //è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºç‹¬å çº¿ç¨‹\n            setExclusiveOwnerThread(current);\n            return true;\n        }\n    }\n    //åˆ°è¿™é‡Œå°±è¯´æ˜å·²ç»æœ‰çº¿ç¨‹å ç”¨äº†ï¼Œæ‰€ä»¥ä¸‹é¢æ˜¯ä¸ºäº†é‡å…¥\n    else if (current == getExclusiveOwnerThread()) {\n        //è¿™é‡Œä¸ç”¨æ‹…å¿ƒå¹¶å‘çš„é—®é¢˜ï¼Œå› ä¸ºæ˜¯ç‹¬å é”ï¼ŒåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šåˆ°è¾¾è¿™é‡Œ\n        int nextc = c + acquires;\n        if (nextc < 0)\n            throw new Error(\"Maximum lock count exceeded\");\n        setState(nextc);\n        return true;\n    }\n    return false;\n}\n```\n\n#### hasQueuedPredecessors()\n\nå…¬å¹³é”å’Œéå…¬å¹³é”çš„tryAcquireæ–¹æ³•åŒºåˆ«å°±åœ¨è¿™é‡Œï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰å‰é©±èŠ‚ç‚¹(ä¸åŒ…å«å¤´èŠ‚ç‚¹headï¼Œä¹Ÿå°±æ˜¯)å­˜åœ¨ï¼Œæœ‰çš„è¯ä¸ºäº†ä¿è¯å…¬å¹³æ€§å°±æ˜¯éœ€è¦ç­‰å¾…ï¼Œè¿”å›trueã€‚\n\n```java\npublic final boolean hasQueuedPredecessors() {\n    // The correctness of this depends on head being initialized\n    // before tail and on head.next being accurate if the current\n    // thread is first in queue.\n    Node t = tail; // Read fields in reverse initialization order\n    Node h = head;\n    Node s;\n    // å¤´ä¸ç­‰äºå°¾ï¼Œå¹¶ä¸”é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ‰€æŒæœ‰çº¿ç¨‹éå½“å‰çº¿ç¨‹è¿”å›true\n    return h != t &&\n        ((s = h.next) == null || s.thread != Thread.currentThread());\n}\n```\n\nğŸ’¡ åˆ°è¿™é‡Œæˆ‘ä»¬åˆ†æä¸‹`Thread0` å’Œ`Thread1` çš„æ‰§è¡Œæƒ…å†µ\n\nğŸ”¸ é¦–å…ˆ`Thread0`å…ˆæ‰§è¡Œäº†`tryAcquire(1)`  æ²¡æœ‰ä»»ä½•é˜»ç¢ï¼Œæ‰§è¡ŒæˆåŠŸç›´æ¥retrurn\n\nğŸ”¸ `Thread1` æ­¤æ—¶æœ‰å¤šç§æƒ…å†µï¼š\n\n- è¿˜æ²¡æœ‰è·å–state ï¼Œ`Thread0`æ‰§è¡Œå®Œåè·å–State==1 ï¼Œç”±äºæ˜¯ç‹¬å é”ç›´æ¥return false ï¼Œè·å–é”å¤±è´¥ã€‚\n\n-  å·²ç»`getState()==0`äº†ï¼Œæ‰§è¡Œ`hasQueuedPredecessors` æ–¹æ³•ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶headå’Œtailéƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œéƒ½è¿˜æ˜¯nullï¼ˆå®˜æ–¹çš„æ³¨é‡Šä¸­ä¹Ÿæåˆ°headå’Œtailæ˜¯ lazily initialized ï¼‰æ‰€ä»¥è¿™é‡Œä¼šç›´æ¥ return falseï¼Œç„¶åç»§ç»­æ‰§è¡ŒCASï¼Œç”±äºå‰é¢`Thread0` å·²ç»å°†stateè®¾ç½®ä¸ºäº† 1 ï¼Œæ‰€ä»¥è¿™é‡ŒCASè‚¯å®šå¤±è´¥äº†ï¼Œæœ€ç»ˆ`Thread1`çš„tryAcquireå¤±è´¥è¿”å›falseã€‚\n\nğŸ”¸ æ—¢ç„¶`tryAcquire()` å¤±è´¥äº†ï¼Œé‚£`Thread1` å°±ä¼šè½¬å¤´ç»§ç»­æ‰§è¡Œåé¢çš„æ–¹æ³•\n\n```java\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) && acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n```\n\né¦–å…ˆæ‰§è¡Œçš„å°±æ˜¯`AddWaiter()` \n\n#### addWaiter()\n\nè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å°†Threadå’ŒmodeåŒ…è£…æˆNodeç„¶åæ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨ç„¶åè¿”å›è¿™ä¸ªNode\n\n```java\nprivate Node addWaiter(Node mode) {\n    //å°†å½“å‰çº¿ç¨‹å’Œæ¨¡å¼å°è£…è¿›Node\n    Node node = new Node(Thread.currentThread(), mode);\n    // Try the fast path of enq; backup to full enq on failure\n    Node pred = tail;\n    //å¦‚æœå°¾èŠ‚ç‚¹ä¸ä¸ºç©º\n    if (pred != null) {\n        //å°†nodeè¿æ¥åœ¨å½“å‰tailåé¢\n        node.prev = pred;\n        //casè®¾ç½®å½“å‰tailä¸ºnode\n        if (compareAndSetTail(pred, node)) {\n            pred.next = node;\n            return node;\n        }\n    }\n    // å…¶å®å‰é¢çœ‹ä¼¼ä¼šæœ‰å¹¶å‘çš„é—®é¢˜å…¶å®å¹¶æ²¡æœ‰\n    // ä¸Šé¢æŠ¢é”å¤±è´¥çš„çº¿ç¨‹ä¼šç›´æ¥è¿›å…¥enqæ–¹æ³•è‡ªæ—‹é‡æ–°è®¾ç½®ï¼Œç›´åˆ°æˆåŠŸ\n    enq(node);\n    return node;\n}\n```\n\nğŸ’¡ æ ¹æ®å‰é¢åˆ†æheadå’Œtailéƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–éƒ½è¿˜æ˜¯nullï¼Œæ‰€ä»¥è¿™é‡Œä¼šç›´æ¥è¿›å…¥ `enq()`æ–¹æ³•\n\n####  enq()\n\n```java\nprivate Node enq(final Node node) {\n    for (;;) {\n        Node t = tail;\n        if (t == null) { // Must initialize\n            if (compareAndSetHead(new Node()))\n                tail = head;\n        } else {\n            node.prev = t;\n            if (compareAndSetTail(t, node)) {\n                t.next = node;\n                return t;\n            }\n        }\n    }\n}\n```\n\nğŸ”¸ å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œå› ä¸ºheadå’Œtailéƒ½è¿˜æ˜¯ç©ºçš„æ‰€ä»¥è¿™é‡Œè¿›å…¥ç¬¬ä¸€ä¸ªå¾ªç¯ï¼ŒCASè®¾ç½®ä¸€ä¸ªç©ºçš„Node()ä¸ºå¤´èŠ‚ç‚¹headï¼Œç„¶åå°†tailä¹ŸæŒ‡å‘è¿™ä¸ªheadï¼Œåˆ°è¿™é‡Œheadå’Œtailæ‰ç®—æ˜¯åˆå§‹åŒ–å®Œæˆäº†(lazily initialized )ã€‚\n\nğŸ”¸ å¾ªç¯ï¼Œè¿›å…¥elseï¼Œè¿™é‡Œå°±å°†å½“å‰nodeè¿æ¥åˆ°tailåé¢å¹¶ä¸”åˆ©ç”¨CASè‡ªæ—‹è®¾ç½®tailä¸ºå½“å‰nodeä¹Ÿå°±æ˜¯åŒ…å«`Thread1` çš„nodeï¼Œç„¶åreturn å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹(è¿™é‡Œè¿”å›å€¼å¹¶æ²¡æœ‰ç”¨åˆ°)ã€‚\n\n```java\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) && acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n```\n\nä¸‹ä¸€æ­¥å°±æ˜¯æ‰§è¡Œ`acquireQueued()`\n\nâ“ **ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨æ„é€ å™¨é‡Œé¢å°±åˆå§‹åŒ–å¤´èŠ‚ç‚¹headï¼Ÿè€Œè¦é‡‡ç”¨æ‡’åŠ è½½çš„æ–¹å¼ï¼Ÿ**\n\n> CLH queues need a dummy header node to get started. Butwe don't create them on **construction**, because it would be wasted  effort if there is **never contention**. Instead, the nodeis constructed and head and tail pointers are set up **on first contention**.\n\nä»¥ä¸Šæ‘˜è‡ª**Doug Lea** å¤§å¸ˆçš„æ³¨é‡Šè§£é‡Šï¼Œæ ¹æ®æˆ‘ä»¬çš„ä¸Šé¢çš„åˆ†æï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹`Thread0` è¿‡æ¥çš„æ—¶å€™å¹¶æ²¡æœ‰å»åˆå§‹åŒ–headï¼Œåé¢çš„çº¿ç¨‹`Thread1`è¿‡æ¥çš„æ—¶å€™ æœ‰äº†ç«äº‰æ‰åˆå§‹åŒ–äº†è¿™ä¸ªå¤´èŠ‚ç‚¹headï¼Œå¦‚æœç›´æ¥åˆå§‹åŒ–è¿™ä¸ªheadï¼Œç„¶ååˆæ²¡æœ‰é”ç«äº‰ï¼Œè¿™ä¸ªheadèŠ‚ç‚¹å°±è¢«æµªè´¹äº†ã€‚ å¤§å¸ˆå°±æ˜¯å¤§å¸ˆï¼Œå¤ªå¼ºäº† ğŸ˜®\n\n#### acquireQueued()\n\n```java\nfinal boolean acquireQueued(final Node node, int arg) {\n    boolean failed = true;\n    try {\n        boolean interrupted = false;\n        for (;;) {\n            //è·å–å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹\n            final Node p = node.predecessor();\n            //å¦‚æœå‰ç½®èŠ‚ç‚¹æ˜¯headå°±å°è¯•å»è·å–é”\n            if (p == head && tryAcquire(arg)) {\n                //è®¾ç½®å¤´èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹\n                setHead(node);\n                p.next = null; // help GC\n                failed = false;\n                return interrupted;\n            }\n            if (shouldParkAfterFailedAcquire(p, node) && parkAndCheckInterrupt())\n                interrupted = true;\n        }\n    } finally {\n        //å‘ç”Ÿå¼‚å¸¸å–æ¶ˆæŠ¢é”\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n```\n\nğŸ’¡ å› ä¸ºå‰ç½®èŠ‚ç‚¹æ˜¯headï¼Œæ‰€ä»¥è¿™é‡Œä½œä¸ºé˜Ÿåˆ—ç¬¬ä¸€ä¸ªå¯ä»¥å»å°è¯•è·å–é”ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä¸ªæ­»å¾ªç¯ï¼Œä¼šä¸€ç›´å°è¯•è·å–é”ï¼Œå…¶å®ç±»ä¼¼ä¸CASçš„è‡ªæ—‹ï¼Œä½†æ˜¯ç›¸æ¯”CASè‡ªæ—‹åˆæœ‰å¾ˆå¤§ä¸åŒï¼Œå®ƒå¹¶ä¸ä¼šä¸€ç›´è‡ªæ—‹ï¼Œè¯¦ç»†å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ã€‚\n\nğŸ”¸ å‰é¢ä¼ é€’è¿‡æ¥çš„nodeå‰ç»§èŠ‚ç‚¹æ­£å¥½å°±æ˜¯headï¼Œæ‰€ä»¥æ‰§è¡ŒtryAcquire() ä½†æ˜¯ç”±äº`Thread0` è¿˜æ²¡æœ‰é‡Šæ”¾é”æ‰€ä»¥è¿™é‡Œä»ç„¶å¤±è´¥ã€‚\n\nğŸ”¸ è¿›å…¥ç¬¬äºŒä¸ªif æ‰§è¡Œ `shouldParkAfterFailedAcquire(p,node)`\n\n#### shouldParkAfterFailedAcquire()\n\nçœ‹åå­—å°±çŸ¥é“æ˜¯å¹²å•¥çš„äº†ï¼Œè·å–å¤±è´¥æ˜¯å¦Parkï¼Ÿ\n\n```java\nprivate static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n    //å‰ç½®èŠ‚ç‚¹çš„çŠ¶æ€\n    int ws = pred.waitStatus;\n    \n    if (ws == Node.SIGNAL)\n        //å‰ç½®èŠ‚ç‚¹çŠ¶æ€ä¸º-1ï¼Œä»£è¡¨å½“å‰èŠ‚ç‚¹çš„åç»­èŠ‚ç‚¹éœ€è¦è¢«æŒ‚èµ·\n        /*\n         * This node has already set status asking a release\n         * to signal it, so it can safely park.\n         */\n        return true;\n    if (ws > 0) {\n        // å‰é©±èŠ‚ç‚¹ waitStatuså¤§äº0ï¼Œè¯´æ˜å‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿã€‚\n        // è¿™é‡Œéœ€è¦çŸ¥é“è¿™ç‚¹ï¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—æ’é˜Ÿçš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œè€Œå”¤é†’çš„æ“ä½œæ˜¯ç”±å‰é©±èŠ‚ç‚¹å®Œæˆçš„ã€‚\n        // æ‰€ä»¥ä¸‹é¢è¿™å—ä»£ç è¯´çš„æ˜¯å°†å½“å‰èŠ‚ç‚¹çš„prevæŒ‡å‘waitStatus<=0çš„èŠ‚ç‚¹ï¼Œ\n        // ç®€å•è¯´ï¼Œå°±æ˜¯ä¸ºäº†æ‰¾ä¸ªæ­£å¸¸çš„å‰é©±èŠ‚ç‚¹ï¼Œå› ä¸ºä½ è¿˜å¾—ä¾èµ–å®ƒæ¥å”¤é†’å‘¢ï¼Œå¦‚æœå‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿï¼Œå°±æ— æ³•å”¤é†’ä½ äº†\n        // åŒæ—¶è¿™ä¸ªæ“ä½œä¹Ÿä¼šå°†é‚£äº› ws>0 çš„èŠ‚ç‚¹ç§»é™¤æ‰\n        do {\n            node.prev = pred = pred.prev;\n        } while (pred.waitStatus > 0);\n        pred.next = node;\n    } else {\n        /*\n         * waitStatus must be 0 or PROPAGATE.  Indicate that we\n         * need a signal, but don't park yet.  Caller will need to\n         * retry to make sure it cannot acquire before parking.\n         */\n        //è®¾ç½®å‰é©±èŠ‚ç‚¹çŠ¶æ€ä¸º -1\n        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n    }\n    return false;\n}\n```\n\næ³¨æ„è¿™ä¸ªé‡Œé¢å›å‰”é™¤ä¸æ­£å¸¸çš„èŠ‚ç‚¹ï¼Œä¸ºä¸‹é¢çš„å”¤é†’æ“ä½œè€ƒè™‘\n\nğŸ’¡ åˆ†æ`Thread1`ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å½“å‰é˜Ÿåˆ—çš„çŠ¶æ€\n\n![mark](http://static.imlgw.top/blog/20190809/jOs2WA3R7lGR.png?imageslim)\n\nğŸ”¸ å› ä¸ºå‰é¢çš„æ“ä½œå¹¶æ²¡æœ‰å¯¹stateè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œä¼šç›´æ¥è¿›å…¥æœ€åçš„elseï¼Œè®¾ç½®å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ä¸º `SIGNAL`\n\nç„¶årenturn  falseå›åˆ°acquireQueuedçš„å†…å¾ªç¯\n\nğŸ”¸ å†æ¬¡å°è¯•è·å–é”ï¼Œ`Thread0` ä»ç„¶æ²¡æœ‰é‡Šæ”¾é”ï¼Œå¤±è´¥ï¼Œå†æ¬¡è¿›å…¥shouldParkAfterFailedAcquireï¼Œè¿™ä¸€æ¬¡ç”±äºå·²ç»å°†å‰ç»§èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®ä¸º`SIGNAL` æ‰€ä»¥ç›´æ¥return trueï¼Œè¿›å…¥åé¢çš„ `parkAndCheckInterrupt()` æ–¹æ³•\n\n**æ­¤æ—¶çŠ¶æ€å˜ä¸º**\n\n![mark](http://static.imlgw.top/blog/20190809/pQ5NOkN5mQTY.png?imageslim)\n\n#### parkAndCheckInterrupt()\n\n```java\nprivate final boolean parkAndCheckInterrupt() {\n    LockSupport.park(this);\n    return Thread.interrupted();\n}\n```\n\nåˆ°è¿™é‡Œæˆ‘ä»¬çš„çº¿ç¨‹`Thread1`å°±ä¼šè¢«é˜»å¡ä½ï¼Œä¹Ÿä¸ä¼šç»§ç»­è‡ªæ—‹è·å–é”äº†ã€‚\n\n> LockSupport.park()å®é™…ä¸Šè°ƒç”¨çš„æ˜¯Unsafeæä¾›çš„æŒ‡ä»¤å±äº`çº¿ç¨‹é˜»å¡åŸè¯­`ï¼Œå¯ä»¥ç†è§£ä¸ºäºŒå…ƒä¿¡å·é‡ï¼ˆåªæœ‰ä¸€ä¸ªpermitï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šå“åº”Interrupt  [å‚è€ƒ](https://segmentfault.com/a/1190000008420938)\n\nğŸ”” **å‡è®¾æ­¤æ—¶åˆæœ‰ä¸€ä¸ªçº¿ç¨‹`Thread2`è¿‡æ¥äº†ï¼Œå¹¶ä¸”`Thread0` ä¾ç„¶æ²¡æœ‰é‡Šæ”¾é”**\n\nğŸ”¸ tryAcquireå¤±è´¥\n\nğŸ”¸addWaiter()ï¼Œ å°†`Thread2`å’Œæ¨¡å¼åŒ…è£…æˆNodeæ·»åŠ åˆ°é˜Ÿå°¾ï¼ˆè¿™ä¸ªæ—¶å€™å°±ä¸ä¼šè¿›å…¥enqäº†ï¼Œå› ä¸ºtailæ­¤æ—¶ä¸º`Thread1`å·²ç»ä¸ä¸ºç©ºäº†ï¼‰ç„¶åè¿”å›åŒ…å«`Thread2`çš„èŠ‚ç‚¹ï¼Œé˜Ÿåˆ—çŠ¶æ€å˜ä¸ºï¼š\n\n![mark](http://static.imlgw.top/blog/20190809/yniIvx1sgpXa.png?imageslim)\n\nğŸ”¸acquireQueued()ï¼Œæ ¹æ®ä¸Šé¢çš„çŠ¶æ€å›¾ï¼Œè¿™é‡Œå‰ç½®èŠ‚ç‚¹å¹¶ä¸æ˜¯headï¼Œç›´æ¥è¿›å…¥shouldParkAfterFailedAcquire()\n\nğŸ”¸shouldParkAfterFailedAcquire()ï¼Œæ˜æ˜¾å‰é©±èŠ‚ç‚¹çŠ¶æ€å¹¶ä¸æ˜¯`SIGNAL` è€Œæ˜¯0ï¼Œæ‰€ä»¥ç›´æ¥åˆ©ç”¨CASè®¾ç½®å‰é©±èŠ‚ç‚¹ä¸º`SIGNAL`  çŠ¶æ€å˜ä¸ºï¼š\n\n![mark](http://static.imlgw.top/blog/20190809/R7GmOQ4V8ESm.png?imageslim)\n\nå›åˆ° `acquireQueued()` ç»§ç»­è‡ªæ—‹\n\nğŸ”¸ å‰ç½®èŠ‚ç‚¹ä¸æ˜¯headï¼Œè°ƒç”¨shouldParkAfterFailedAcquire(NodeT1ï¼Œmode)ï¼ŒæˆåŠŸï¼Œè°ƒç”¨parkAndCheckInterrupté˜»å¡ï¼Œè‡³æ­¤ï¼Œ`Thread1`ï¼Œ`Thread2` éƒ½åœ¨è¿™é‡Œparkä½äº†ã€‚\n\n### unLock()\n\nğŸ”” ç»§ç»­ä¸Šé¢çš„æ¨¡æ‹Ÿï¼Œæ­¤æ—¶`Thread0`é‡Šæ”¾é” ï¼Œè°ƒç”¨`unlock()` æ–¹æ³•ï¼Œunlock()ä¼šè°ƒç”¨AQSä¸­çš„`release(1)`æ–¹æ³•\n\n#### release()\n\n```java\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) {\n        //è·å–å¤´èŠ‚ç‚¹\n        Node h = head;\n        //å¤´èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å¤´èŠ‚ç‚¹çš„waitStatusä¸æ˜¯0\n        if (h != null && h.waitStatus != 0)\n            //unparkåç»§èŠ‚ç‚¹\n            unparkSuccessor(h);\n        return true;\n    }\n    return false;\n}\n```\n\né¦–å…ˆæ‰§è¡Œ`tryRelease(1)` ï¼Œå’Œ`tryAcquire()` ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•æœ€åæ˜¯äº¤ç»™å­ç±»å»å®ç°çš„\n\n#### tryRelease()\n\n```java\nprotected final boolean tryRelease(int releases) {\n    //åŒæ­¥çŠ¶æ€å‡1\n    int c = getState() - releases;\n    if (Thread.currentThread() != getExclusiveOwnerThread())\n        //è§£é”çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œè§£é“ƒè¿˜é¡»ç³»é“ƒäºº\n        throw new IllegalMonitorStateException();\n    //å’Œä¸Šé¢ä¸€æ ·è¿™é‡Œä¸ç”¨æ‹…å¿ƒå¹¶å‘çš„é—®é¢˜ï¼Œå› ä¸ºæ˜¯ç‹¬å é”ï¼ŒåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šåˆ°è¾¾è¿™é‡Œ\n    boolean free = false;\n    //ä¸ä¸º0åˆ™ä»£è¡¨è¢«é‡å…¥äº†ï¼Œéœ€è¦å¤šæ¬¡releaseç›´åˆ°0æ‰ä¼šé‡Šæ”¾é”\n    if (c == 0) {\n        free = true;\n        setExclusiveOwnerThread(null);\n    }\n    setState(c);\n    return free;\n}\n```\n\ntryRelease()æˆåŠŸç»§ç»­æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œçœ‹ä¸€ä¸‹å½“å‰AQSé˜Ÿåˆ—çš„çŠ¶æ€\n\n![mark](http://static.imlgw.top/blog/20190809/R7GmOQ4V8ESm.png?imageslim)\n\nğŸ”¸ å¤´èŠ‚ç‚¹head ! =null å¹¶ä¸”head.waitStateä¸æ˜¯0ï¼Œæ‰§è¡ŒunparkSuccessor().\n\n#### unparkSuccessor()\n\n```java\nprivate void unparkSuccessor(Node node) {\n    /*\n     * If status is negative (i.e., possibly needing signal) try\n     * to clear in anticipation of signalling.  It is OK if this\n     * fails or if status is changed by waiting thread.\n     */\n    int ws = node.waitStatus;\n    if (ws < 0)\n        //å¦‚æœå½“å‰èŠ‚ç‚¹çš„wså°äº0å°±è®¾ç½®ä¸º0ï¼Œå…è®¸å¤±è´¥\n        //å…¶å®æ˜¯ç‹¬å é”çš„è¯è¿™é‡Œè‚¯å®šä¸ä¼šå¤±è´¥ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹\n        //releaseæ‰§è¡Œå®Œä¹‹åï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¢«ç§»é™¤æ‰ã€‚ç„¶åè¢«GC\n        compareAndSetWaitStatus(node, ws, 0);\n\n    /*\n     * Thread to unpark is held in successor, which is normally\n     * just the next node.  But if cancelled or apparently null,\n     * traverse backwards from tail to find the actual\n     * non-cancelled successor.\n     */\n    //è·å–åç»§èŠ‚ç‚¹\n    Node s = node.next;\n    //åç»§èŠ‚ç‚¹ä¸ºç©ºï¼Œæˆ–è€…å·²ç»æ’¤é”€äº†ï¼Œå–æ¶ˆæŠ¢é”ï¼ˆ1>0ï¼‰\n    if (s == null || s.waitStatus > 0) {\n        s = null;\n        //ä»åå¾€å‰éå†æ‰¾åˆ°æ­£æ•°ç¬¬ä¸€ä¸ªwaitStatus<0çš„\n        for (Node t = tail; t != null && t != node; t = t.prev)\n            if (t.waitStatus <= 0)\n                s = t;\n    }\n    if (s != null)\n        //ç„¶åé‡Šæ”¾å®ƒ\n        LockSupport.unpark(s.thread);\n}\n```\n\nğŸ”¸ `Thread1` è¢«`unpark()` ç»§ç»­æ‰§è¡Œã€‚\n\n```java\nprivate final boolean parkAndCheckInterrupt() {\n    LockSupport.park(this);\n    return Thread.interrupted();\n}\n```\n\nè¿”å›`Thread1`çš„ ä¸­æ–­æ ‡å¿—ä½ï¼Œå¹¶å¤åŸä¸ºfalseï¼Œç»“æŸ`parkAndCheckInterrupt()`æ–¹æ³•ï¼Œå†æ¬¡å›åˆ°`acquireQueued()` çš„å¾ªç¯ä¸­æ‰§è¡Œç¬¬ä¸€ä¸ªif\n\n```java\nfor (;;) {\n    final Node p = node.predecessor();\n    if (p == head && tryAcquire(arg)) {\n        setHead(node);\n        p.next = null; // help GC\n        failed = false;\n        return interrupted; //è¿”å›ä¸­æ–­çŠ¶æ€\n    }\n    if (shouldParkAfterFailedAcquire(p, node) && parkAndCheckInterrupt())\n        interrupted = true;\n}\n```\n\nğŸ”¸ ç”±äº`Thread0` å·²ç»é‡Šæ”¾é”ï¼ŒåŒæ­¥çŠ¶æ€å·²ç»å˜ä¸º0ï¼Œ`Thread1` å¯ä»¥ç›´æ¥`tryAcquire`è·å–åˆ°é”ï¼Œç„¶åè®¾ç½®å¤´èŠ‚ç‚¹ä¸ºå½“å‰èŠ‚ç‚¹ï¼Œå°†ä¹‹å‰çš„headèŠ‚ç‚¹**ç§»é™¤**ï¼Œè¿”å›ä¸­æ–­çŠ¶æ€ï¼Œç”±äºä¹‹å‰parkæœŸé—´æ²¡æœ‰è¢«ä¸­æ–­ç›´æ¥`return false`ï¼ŒacquireæˆåŠŸï¼ï¼ï¼ `Thread1` è·å¾—é”ï¼ï¼ï¼\n\nâ“ **ä¸ºä»€ä¹ˆè¦ä»åå¾€å‰éå†ï¼Ÿ**\n\n> è¿™é‡Œçœ‹äº†ä¸€äº›åšå®¢ä»‹ç»ï¼Œå¤§æ¦‚æœ‰ä¸¤ä¸ªè¯´æ³•ï¼Œä¸€ä¸ªæ˜¯åœ¨`enq()` æ–¹æ³•é‡Œé¢ï¼Œå…ˆè®¾ç½®çš„`node.prev = pred;`å†æ‰§è¡Œçš„CASæœ€åæ‰§è¡Œçš„`t.next = node;` CASæˆåŠŸånextä¹Ÿè®¸è¿˜æ²¡æœ‰è®¾ç½®æˆåŠŸï¼Œä»å‰å¾€åéå†æœ‰å¯èƒ½æ‰¾ä¸åˆ°è¿™ä¸ªåˆšåŠ å…¥çš„èŠ‚ç‚¹ï¼›å…¶æ¬¡ï¼Œåœ¨`cancelAcquire(node);` çš„æœ€åä¸€æ­¥æœ‰ä¸€ä¸ª`node.next=node`çš„æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ä»å‰å¾€åéå†ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚\n\nâ“ **ä»åå¾€å‰éå†æ‰¾åˆ°æœ€å‰é¢ç¬¬ä¸€ä¸ªwaitStatus<0çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ“ä½œå¦‚æœè¿”å›çš„æ˜¯ä¸ªä¸­é—´èŠ‚ç‚¹æ€ä¹ˆåŠï¼Ÿ**\n\n> ä¸è¦æ€•ï¼Œæˆ‘ä»¬ç»§ç»­æ‰§è¡Œï¼Œé¦–å…ˆå®ƒæ˜¯ä¸ªä¸­é—´èŠ‚ç‚¹è€Œä¸”æ˜¯å…¬å¹³é”ï¼Œå®ƒæœ‰å‰é©±èŠ‚ç‚¹ï¼Œunparkåè‚¯å®šè·å–ä¸åˆ°é”(å…¬å¹³é”éœ€è¦æ£€æµ‹æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹)ï¼Œç„¶åæ‰§è¡Œ`shouldParkAfterFailedAcquire()`ï¼Œè¿˜è®°å¾—è¿™ä¸ªæ–¹æ³•é‡Œé¢çš„ä¸€ä¸ªæ“ä½œä¹ˆï¼Ÿï¼Ÿå¦‚æœå‰é©±èŠ‚ç‚¹çŠ¶æ€>0ï¼Œä»–å°±ä¼šæ¸…é™¤è¿™äº›ä¸æ­£å¸¸çš„èŠ‚ç‚¹ï¼Œè¿”å›falseï¼Œä¸parkè‡ªæ—‹ï¼Œä¸‹ä¸€æ¬¡å¾ªç¯è¿™ä¸ªèŠ‚ç‚¹åœ¨è·å–é”å°±å¯ä»¥è·å–åˆ°äº†ï¼Œå¦™å“‰ï¼ï¼ï¼\n\næ³¨æ„**setHead**æ˜¯è¿™æ ·çš„\n\n```java\nprivate void setHead(Node node) {\n    head = node;\n    node.thread = null; //è®¾ç½®çº¿ç¨‹ä¸ºnull\n    node.prev = null; //è®¾ç½®å‰é©±ä¸ºç©º\n}\n```\n\næ­¤æ—¶é˜Ÿåˆ—çŠ¶æ€å˜ä¸ºï¼š\n\n![mark](http://static.imlgw.top/blog/20190809/wFDlbQTu417I.png?imageslim)\n\nå†å¾€åå°±æ˜¯é‡å¤å‰é¢çš„è¿‡ç¨‹å•¦ã€‚\n\n### éå…¬å¹³é”å…¬å¹³é”åŒºåˆ«\n\nä¸Šé¢æ˜¯ä»‹ç»çš„å…¬å¹³é”ï¼Œæ‰€è°“çš„å…¬å¹³å°±æ˜¯å…ˆæ¥ååˆ°FIFOã€‚\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹éå…¬å¹³é”çš„lockå’ŒnonfairTryAcquire()çš„å®ç°ï¼Œè¿™ä¸¤ä¸ªé”çš„åŒºåˆ«å…¶å®å°±æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚\n\n#### lock()\n\n```java\nfinal void lock() {\n    if (compareAndSetState(0, 1))\n        setExclusiveOwnerThread(Thread.currentThread());\n    else\n        acquire(1);\n}\n```\n\nå¯ä»¥çœ‹åˆ°éå…¬å¹³é”`lock()`çš„æ—¶å€™ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€å…ˆCASè¯•ä¸€ä¸‹èƒ½ä¸èƒ½è·å–åˆ°é”ï¼Œè·å–åˆ°å°±ç›´æ¥è¿”å›\n\n#### nonfairTryAcquire()\n\n```java\nfinal boolean nonfairTryAcquire(int acquires) {\n    final Thread current = Thread.currentThread();\n    int c = getState();\n    if (c == 0) {\n        if (compareAndSetState(0, acquires)) {\n            setExclusiveOwnerThread(current);\n            return true;\n        }\n    }\n    else if (current == getExclusiveOwnerThread()) {\n        int nextc = c + acquires;\n        if (nextc < 0) // overflow\n            throw new Error(\"Maximum lock count exceeded\");\n        setState(nextc);\n        return true;\n    }\n    return false;\n}\n```\n\nå¯¹æ¯”å…¬å¹³é”çš„å®ç°ï¼Œä¼šå‘ç°å°‘äº†`hasQueuedPredecessors()` è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœå‰é¢`lock()` çš„æ—¶å€™æ²¡æœ‰CASæˆåŠŸï¼Œåˆ°è¿™é‡Œåå¦‚æœä¹‹å‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œå®ƒåˆä¼šå†æ¬¡å°è¯•CASè·å–é”ï¼Œè¿™é‡Œå…¶å®å°±ä½“ç°äº†éå…¬å¹³é”çš„ç‰¹ç‚¹ï¼Œ**å…ˆç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¸€å®šèƒ½å…ˆè·å–åˆ°é”ï¼Œä¸­é—´å…è®¸æœ‰äºº`\"æ’é˜Ÿ\"`**ï¼Œå¦‚æœè¿™ä¸€æ¬¡è¿˜æ˜¯å¤±è´¥äº†ï¼Œå°±ä¼šå’Œå…¬å¹³é”ä¸€æ ·è€è€å®å®å»ç­‰å¾…é˜Ÿåˆ—ä¸­æ’é˜Ÿ\n\nä¸€èˆ¬è€Œè¨€ï¼Œéå…¬å¹³é”çš„æ€§èƒ½ä¼šæ¯”å…¬å¹³é”å¥½ï¼Œè€Œéå…¬å¹³é”å¯èƒ½ä¼šå¯¼è‡´æ’åœ¨åé¢çš„çº¿ç¨‹é¥¥é¥¿\n\n### æµç¨‹å›¾\n\n![mark](http://static.imlgw.top/blog/20190810/6FEWGydOmVzm.png?imageslim)\n\n## å‚è€ƒ\n\n**ã€ŠJavaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ã€‹**\n\n[ä¸€è¡Œä¸€è¡Œæºç åˆ†ææ¸…æ¥šAbstractQueuedSynchronizer](https://javadoop.com/2017/06/16/AbstractQueuedSynchronizer/)\n\n[AbstractQueuedSynchronizeræºç å‰–æï¼ˆå…­ï¼‰- æ·±åˆ»è§£æä¸æ¨¡æ‹Ÿçº¿ç¨‹ç«äº‰èµ„æº](https://blog.csdn.net/pfnie/article/details/53191892)\n\n[[æµ…è°ˆJavaå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆå…«ï¼‰â€”â€” LockSupportåŸç†å‰–æ]](https://segmentfault.com/a/1190000008420938)\n\n[JavaåŒæ­¥å™¨â€”â€”AQSå­¦ä¹ ](https://brightloong.github.io/2018/06/21/Java%E5%90%8C%E6%AD%A5%E5%99%A8%E2%80%94%E2%80%94AQS%E5%AD%A6%E4%B9%A0/)\n\n","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"LeetCodeæŸ¥æ‰¾","url":"/2019/09/15/leetcode-cha-zhao/","content":"\n## [1. ä¸¤æ•°ä¹‹å’Œ](https://leetcode-cn.com/problems/two-sum/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªç›®æ ‡å€¼ `target`ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ **ä¸¤ä¸ª** æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚\n\nä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nç»™å®š nums = [2, 7, 11, 15], target = 9\n\nå› ä¸º nums[0] + nums[1] = 2 + 7 = 9\næ‰€ä»¥è¿”å› [0, 1]\n```\n\n> å¹³ç”Ÿä¸è¯†**TwoSum**ï¼ŒåšéLeetCodeä¹Ÿæ‰ç„¶\n\n**è§£æ³•ä¸€**\n\n```java\npublic int[] twoSum(int[] nums, int target) {\n    int length = nums.length;\n    for (int i = 0; i < length - 1; i++) {\n        for (int j = 1; j < length - i; j++) {\n            int result = nums[i] + nums[i + j];\n            if (result == target) {\n                return new int[] { i, i + j };\n            }\n        }\n    }\n    return null;\n}\n```\n\næœ€å¼€å§‹çš„åšæ³•ï¼Œç›´æ¥æš´åŠ›æ±‚è§£ï¼Œç®€å•ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½ï¼Œ50msï¼Œ41% beatsï¼Œå…¶å®åœ¨ç¬”è¯•æˆ–è€…å…¶å®ƒå¯¹æ•ˆç‡è¦æ±‚æ²¡é‚£ä¹ˆä¸¥æ ¼çš„åœ°æ–¹ç”¨æš´åŠ›æ³•ä¹Ÿæ²¡æ¯›ç—…èŠ‚çº¦å¾ˆå¤šæ—¶é—´ï¼Œèƒ½ç›´æ¥å†™å‡ºæœ€ä¼˜è§£è‚¯å®šå¥½ï¼Œä½†æ˜¯å®åœ¨æ²¡åŠæ³•äº†æš´åŠ›æ³•ä¹Ÿä¸å¤±ä¸ºä¸€ç§å¥½æ–¹æ³•ï¼Œæœ€ä¼˜è§£å¯ä»¥ä¸‹æ¥åå†ç ”ç©¶ã€‚\n\n**è§£æ³•äºŒ**\n\nhashæŸ¥æ‰¾\n\n```java\npublic int[] twoSum(int[] nums, int target) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    //ç¬¬ä¸€éæŠŠæ‰€æœ‰çš„å…ƒç´ å’Œç´¢å¼•å­˜åˆ°hashMapä¸­\n    for (int i=0;i<nums.length;i++) {\n        map.put(nums[i],i);\n    }\n    //å†æŸ¥æ‰¾hash\n    for (int i=0;i<nums.length;i++) {\n        //ä¸èƒ½é‡å¤æ‰€ä»¥ ä¸‹æ ‡éœ€è¦é™åˆ¶ä¸‹\n        if(map.containsKey(target-nums[i]) && map.get(target-nums[i])!=i){\n            return new int[]{i,map.get(target-nums[i])};\n        }\n    }\n    return new int[]{};\n}\n```\n\nå…¶å®å¯ä»¥åªhashä¸€éï¼Œhashä¸¤éä¸»è¦è€ƒè™‘é¡ºåºçš„é—®é¢˜ã€‚ç›´æ¥åˆ©ç”¨hashMapæŸ¥æ‰¾ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚\n\n```java\npublic int[] twoSum2(int[] nums, int target) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    for (int i=0;i<nums.length;i++) {\n        //ä¸èƒ½é‡å¤æ‰€ä»¥ ä¸‹æ ‡éœ€è¦é™åˆ¶ä¸‹\n        if(map.containsKey(target-nums[i]) && map.get(target-nums[i])!=i){\n            return new int[]{i,map.get(target-nums[i])};\n        }\n        map.put(nums[i],i);\n    }\n\n    return new int[]{};\n}\n```\n\næäº¤è®°å½•ä¸Šæœ€å¿«çš„åšæ³•\n\n```java\npublic int[] twoSum(int[] nums, int target) {\n    int index;\n    int indexArrayMax=2047;\n    int[] indexArrays=new int[indexArrayMax+1];\n    int diff;\n    for(int i=1;i<nums.length;i++){\n        diff=target-nums[i];\n        //i=0æ—¶ç´¢å¼•æ— æ•ˆ,æ‰€ä»¥å•ç‹¬å¤„ç†\n        if(diff==nums[0]){\n            return new int[]{0,i};\n        }\n        index=diff&indexArrayMax;\n        if(indexArrays[index]!=0){\n            return new int[]{indexArrays[index],i};\n        }\n        indexArrays[nums[i]&indexArrayMax]=i;   \n    }   \n    return new int[2];\n}\n```\n\næ²¡çœ‹æ‡‚ã€‚ã€‚ã€‚ç¾¤é‡Œé—®äº†ä¸‹ï¼Œæ‰‹åŠ¨hashã€‚ã€‚ã€‚ã€‚ä»¥åå†æ¥ç ”ç©¶å§.\n\n## [349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†](https://leetcode-cn.com/problems/intersection-of-two-arrays/)\n\nç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums1 = [1,2,2,1], nums2 = [2,2]\nè¾“å‡º: [2]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums1 = [4,9,5], nums2 = [9,4,9,8,4]\nè¾“å‡º: [9,4]\n```\n\n**è¯´æ˜:**\n\n- è¾“å‡ºç»“æœä¸­çš„æ¯ä¸ªå…ƒç´ ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚\n- æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic int[] intersection(int[] nums1, int[] nums2) {\n    Set<Integer> s1=new HashSet<>();\n    ArrayList<Integer> res=new ArrayList<>();\n    int index=0;\n    for (int a:nums1 ) {\n        s1.add(a);\n    }\n\n    for (int i=0;i<nums2.length;i++) {\n        if(s1.contains(nums2[i])){\n            res.add(nums2[i]);\n            s1.remove(nums2[i]);//åˆ«å¿˜äº†removeæ‰\n        }\n    }\n\n    int [] res2=new int[res.size()];\n    for (int i=0;i<res.size();i++) {\n        res2[i]=res.get(i);\n    }\n    return res2;\n}\n```\næ²¡å•¥å¥½è¯´çš„ï¼Œè¿™ç§é¢˜ç¡®å®ä¸éš¾ï¼Œä»”ç»†æƒ³æƒ³å°±å¯ä»¥\n\n## [350. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›† II](https://leetcode-cn.com/problems/intersection-of-two-arrays-ii/)\n\nç»™å®šä¸¤ä¸ªæ•°ç»„ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å®ƒä»¬çš„äº¤é›†ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums1 = [1,2,2,1], nums2 = [2,2]\nè¾“å‡º: [2,2]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums1 = [4,9,5], nums2 = [9,4,9,8,4]\nè¾“å‡º: [4,9]\n```\n\n**è¯´æ˜ï¼š**\n\n- è¾“å‡ºç»“æœä¸­æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œåº”ä¸å…ƒç´ åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°ä¸€è‡´ã€‚\n- æˆ‘ä»¬å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚\n\n**è¿›é˜¶:**\n\n- å¦‚æœç»™å®šçš„æ•°ç»„å·²ç»æ’å¥½åºå‘¢ï¼Ÿä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ\n- å¦‚æœ nums1 çš„å¤§å°æ¯” nums2 å°å¾ˆå¤šï¼Œå“ªç§æ–¹æ³•æ›´ä¼˜ï¼Ÿ\n- å¦‚æœ nums2 çš„å…ƒç´ å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç£ç›˜å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä¸€æ¬¡åŠ è½½æ‰€æœ‰çš„å…ƒç´ åˆ°å†…å­˜ä¸­ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿ\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å’Œä¸Šé¢çš„åŒºåˆ«å°±æ˜¯éœ€è¦è¾“å‡ºæ‰€æœ‰çš„äº¤é›†ï¼Œé‡å¤çš„ä¹Ÿç®—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨mapçš„ç»“æ„è®°å½•å­—ç¬¦å‡ºç°çš„æ¬¡æ•°\n\n```java\npublic int[] intersect(int[] nums1, int[] nums2) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    for (int i=0;i<nums1.length;i++) {\n        map.put(nums1[i],map.getOrDefault(nums1[i],0)+1);\n    }\n    ArrayList<Integer> res=new ArrayList<>();\n    for (int i=0;i<nums2.length;i++) {\n        if (map.containsKey(nums2[i])) {\n            if (map.get(nums2[i])!=0) {\n                //æœ‰äº¤é›†\n                res.add(nums2[i]); //æ·»åŠ åˆ°ç»“æœä¸­\n                map.put(nums2[i],map.get(nums2[i])-1); //mapæ˜ å°„å‡ä¸€\n            }\n        }\n    }\n    int []res2=new int[res.size()];\n    for (int i=0;i<res2.length;i++) {\n        res2[i]=res.get(i);\n    }\n    return res2;\n}\n```\n\næ€è·¯ä¹Ÿå¾ˆç›´ç™½ï¼Œå’Œä¸Šä¸€é¢˜çš„åšæ³•ç±»ä¼¼\n\n**è¿›é˜¶**\n\n**Q1:** æ’å¥½åºçš„è¯å°±å¯ä»¥ç›´æ¥åˆ©ç”¨åŒæŒ‡é’ˆï¼Œä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªæ•°ç»„çš„å¤´ï¼Œç›¸ç­‰å°±åŠ å…¥listï¼Œä¸ç›¸ç­‰å°±ç§»åŠ¨å°çš„å“ªä¸€ä¸ªï¼Œç›´åˆ°æœ‰ä¸€ä¸ªæŒ‡é’ˆèµ°åˆ°æœ«å°¾\n\n**Q2:** è¿™ä¸ªå°±å¾ˆæ˜æ˜¾äº†ï¼Œè‚¯å®šå…ˆæŠŠå°çš„å“ªä¸€ä¸ªç”¨mapæ˜ å°„èµ·æ¥ï¼Œè¿™æ ·mapæŸ¥æ‰¾çš„æ•ˆç‡ä¼šæ›´é«˜ ï¼Ÿ\n\n**Q3:** è¿™ä¸ªå‚è€ƒè‹±æ–‡ç‰ˆçš„ [è®¨è®ºåŒº](https://leetcode.com/problems/intersection-of-two-arrays-ii/discuss/82243/Solution-to-3rd-follow-up-question) \n\n## [242. æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯](https://leetcode-cn.com/problems/valid-anagram/)\n\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: s = \"anagram\", t = \"nagaram\"\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: s = \"rat\", t = \"car\"\nè¾“å‡º: false\n```\n\n**è¯´æ˜:**\n\n- ä½ å¯ä»¥å‡è®¾å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ã€‚\n\n**è¿›é˜¶:**\n\n- å¦‚æœè¾“å…¥å­—ç¬¦ä¸²åŒ…å« unicode å­—ç¬¦æ€ä¹ˆåŠï¼Ÿä½ èƒ½å¦è°ƒæ•´ä½ çš„è§£æ³•æ¥åº”å¯¹è¿™ç§æƒ…å†µï¼Ÿ\n\n**è§£æ³•ä¸€**\n\n```java\npublic boolean isAnagram(String s, String t) {\n    if (s.length()!=t.length())return false;\n    int[] freq=new int[256];\n    for (int i=0;i<s.length();i++) {\n        freq[s.charAt(i)]++;\n    }\n    int count=0,match=0;\n    for (int a:freq) {\n        if(a!=0){\n            count++;\n        }\n    }\n    for (int i=0;i<t.length();i++) {\n        if(freq[t.charAt(i)]>0){\n            freq[t.charAt(i)]--;\n            if(freq[t.charAt(i)]==0){\n                match++;\n            }\n        }\n    }\n    return match==count;\n}\n```\n\nè¿™é‡Œå…¶å®ç©ºé—´è¿˜å¯ä»¥ä¼˜åŒ–ï¼Œé¢˜ç›®è¯´äº†å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—ç¬¦æ‰€ä»¥åªéœ€è¦26ä¸ªintå°±è¡Œäº†ï¼Œå¯ä»¥åœ¨freqæ“ä½œçš„æ—¶å€™ `-'A'` ä¼˜åŒ–ç©ºé—´\n\n**è¿›é˜¶**\n\nå­—ç¬¦åŒ…å«`unicode` çš„è¯å¦‚æœå†ä½¿ç”¨intæ•°ç»„å°±ä¸åˆé€‚äº†ï¼Œè¿™ä¸ªèŒƒå›´ä¼šå˜å¾—å¾ˆå¤§ï¼Œæ›´åŠ é€šç”¨çš„æ–¹å¼æ˜¯é‡‡ç”¨`HashMap`\n\n## [1160. æ‹¼å†™å•è¯](https://leetcode-cn.com/problems/find-words-that-can-be-formed-by-characters/)\n\nç»™ä½ ä¸€ä»½ã€è¯æ±‡è¡¨ã€ï¼ˆå­—ç¬¦ä¸²æ•°ç»„ï¼‰ words å’Œä¸€å¼ ã€å­—æ¯è¡¨ã€ï¼ˆå­—ç¬¦ä¸²ï¼‰ charsã€‚\n\nå‡å¦‚ä½ å¯ä»¥ç”¨ chars ä¸­çš„ã€å­—æ¯ã€ï¼ˆå­—ç¬¦ï¼‰æ‹¼å†™å‡º words ä¸­çš„æŸä¸ªã€å•è¯ã€ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºä½ æŒæ¡äº†è¿™ä¸ªå•è¯ã€‚\n\n**æ³¨æ„ï¼š**æ¯æ¬¡æ‹¼å†™æ—¶ï¼Œchars ä¸­çš„æ¯ä¸ªå­—æ¯éƒ½åªèƒ½ç”¨ä¸€æ¬¡ã€‚\n\nè¿”å›è¯æ±‡è¡¨ words ä¸­ä½ æŒæ¡çš„æ‰€æœ‰å•è¯çš„ é•¿åº¦ä¹‹å’Œã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šwords = [\"cat\",\"bt\",\"hat\",\"tree\"], chars = \"atach\"\nè¾“å‡ºï¼š6\nè§£é‡Šï¼š \nå¯ä»¥å½¢æˆå­—ç¬¦ä¸² \"cat\" å’Œ \"hat\"ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 3 + 3 = 6ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šwords = [\"hello\",\"world\",\"leetcode\"], chars = \"welldonehoneyr\"\nè¾“å‡ºï¼š10\nè§£é‡Šï¼š\nå¯ä»¥å½¢æˆå­—ç¬¦ä¸² \"hello\" å’Œ \"world\"ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 5 + 5 = 10ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= words.length <= 1000`\n- `1 <= words[i].length, chars.length <= 100`\n- æ‰€æœ‰å­—ç¬¦ä¸²ä¸­éƒ½ä»…åŒ…å«å°å†™è‹±æ–‡å­—æ¯\n\n**è§£æ³•ä¸€**\n\nå¤§æ™šä¸Šé¢˜ç›®éƒ½æ²¡çœ‹æ¸…å°±å¼€å§‹å†™ï¼ï¼é¢˜ç›®è¯´çš„æ˜¯æ¯æ¬¡åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼ï¼ï¼\n\n```java\npublic int countCharacters(String[] words, String chars) {\n    int[] hash=new int[26];\n    for (int i=0;i<chars.length();i++) {\n        hash[chars.charAt(i)-'a']++;\n    }\n    int res=0;\n    int[] temp=new int[26];\n    for (int i=0;i<words.length;i++) {\n        String word=words[i];\n        Arrays.fill(temp,0);\n        boolean flag=true;\n        for (int j=0;j<word.length();j++) {\n            temp[word.charAt(j)-'a']++;\n            if(temp[word.charAt(j)-'a']>hash[word.charAt(j)-'a']){\n                flag=false;\n                break;\n            }\n        }\n        res+=flag?word.length():0;\n    }\n    return res;\n}\n```\nä¸€å¼€å§‹ç”¨çš„arraycopyç„¶åå‡å‡ï¼Œå·®ä¸å¤š\n\n## [202. å¿«ä¹æ•°](https://leetcode-cn.com/problems/happy-number/)\n\nç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯â€œå¿«ä¹æ•°â€ã€‚\n\nä¸€ä¸ªâ€œå¿«ä¹æ•°â€å®šä¹‰ä¸ºï¼šå¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œï¼Œç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯æ— é™å¾ªç¯ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚å¦‚æœå¯ä»¥å˜ä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚\n\n**ç¤ºä¾‹:** \n\n```java\nè¾“å…¥: 19\nè¾“å‡º: true\nè§£é‡Š: \n12 + 92 = 82\n82 + 22 = 68\n62 + 82 = 100\n12 + 02 + 02 = 1\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic static boolean isHappy(int n) {\n    char[] nums=null;\n    int sum=n;\n    while(true) {\n        nums=String.valueOf(sum).toCharArray();\n        sum=0;\n        for (int i=0;i<nums.length;i++) {\n            sum+=(nums[i]-48)*(nums[i]-48);\n        }\n        if (sum==4) {\n            return false;\n        }else if (sum==1) {\n            return true;\n        }\n    }\n}\n```\n\næ‰¾åˆ°äº†è§„å¾‹ï¼Œæ‰€æœ‰ä¸å¿«ä¹çš„æ•°(ğŸ˜…ï¼Œéƒ½ä¼šè¿›å…¥4 â†’ 16 â†’ 37 â†’ 58 â†’ 89 â†’ 145 â†’ 42 â†’ 20 â†’ 4 çš„å¾ªç¯ï¼Œå¯ä»¥ç›´æ¥åœ¨sumå’Œè¿™äº›å€¼ç›¸ç­‰çš„æ—¶å€™å°±returnæˆ‘æ‡’å¾—å†™é‚£ä¹ˆå¤šï¼Œæ¯”è¾ƒå–å·§ä½†æ˜¯æ•ˆç‡è¿˜æ˜¯æŒºé«˜çš„\n\n**è§£æ³•äºŒ**\n\n```java\npublic static boolean isHappy(int n) {\n    char[] nums=null;\n    int sum=n;\n    HashSet<Integer> set=new HashSet<>();\n    while(true) {\n        nums=String.valueOf(sum).toCharArray();\n        sum=0;\n        for (int i=0;i<nums.length;i++) {\n            sum+=(nums[i]-48)*(nums[i]-48);\n        }\n        if (sum==1) {\n            return true;\n        }else if (set.contain(sum)){\n            return false;\n        }else{\n            set.add(sum);    \n        }\n    }\n}\n```\nè¿™ç§åšæ³•å°±æ¯”è¾ƒå¸¸è§„ï¼Œä¹Ÿæ˜¯ç¬¦åˆè¿™ç¯‡ä¸»é¢˜**æŸ¥æ‰¾**çš„è§£æ³•ï¼Œä»£ç æ¯”è¾ƒç®€å•å°±ä¸å•°å—¦äº†\n\n## [290. å•è¯è§„å¾‹](https://leetcode-cn.com/problems/word-pattern/)\n\nç»™å®šä¸€ç§è§„å¾‹ pattern å’Œä¸€ä¸ªå­—ç¬¦ä¸² str ï¼Œåˆ¤æ–­ str æ˜¯å¦éµå¾ªç›¸åŒçš„è§„å¾‹ã€‚\n\nè¿™é‡Œçš„ **éµå¾ª** æŒ‡å®Œå…¨åŒ¹é…ï¼Œä¾‹å¦‚ï¼Œ pattern é‡Œçš„æ¯ä¸ªå­—æ¯å’Œå­—ç¬¦ä¸² str ä¸­çš„æ¯ä¸ªéç©ºå•è¯ä¹‹é—´å­˜åœ¨ç€åŒå‘è¿æ¥çš„å¯¹åº”è§„å¾‹ã€‚\n\n**ç¤ºä¾‹1:**\n\n```java\nè¾“å…¥: pattern = \"abba\", str = \"dog cat cat dog\"\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:pattern = \"abba\", str = \"dog cat cat fish\"\nè¾“å‡º: false\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: pattern = \"aaaa\", str = \"dog cat cat dog\"\nè¾“å‡º: false\n```\n\n**ç¤ºä¾‹ 4:**\n\n```java\nè¾“å…¥: pattern = \"abba\", str = \"dog dog dog dog\"\nè¾“å‡º: false\n```\n\n**è¯´æ˜:**\nä½ å¯ä»¥å‡è®¾ `pattern` åªåŒ…å«å°å†™å­—æ¯ï¼Œ `str` åŒ…å«äº†ç”±å•ä¸ªç©ºæ ¼åˆ†éš”çš„å°å†™å­—æ¯\n\n**è§£æ³•ä¸€**\n\n```java\npublic static boolean wordPattern(String pattern, String str) {\n    HashMap<Character,String> map=new LinkedHashMap<>();\n    String[] strs=str.split(\" \");\n    char[] p=pattern.toCharArray();\n    if (strs.length!=p.length) {\n        return false;\n    }\n    for (int i=0;i<p.length;i++) {\n        if (map.containsKey(p[i])) {\n            if (!map.get(p[i]).equals(strs[i])) {\n                return false;\n            }\n        }else{\n            //è¿™é‡Œç›´æ¥å’Œå‰ä¸€ä¸ªæ¯”è¾ƒçš„ï¼Œæ­£ç¡®åšæ³•æ˜¯ç”¨map.containsValueåˆ¤æ–­æ˜¯å¦å·²ç»æ·»åŠ \n            /*if (strs[i].equals(strs[i-1])) {\n                return false;\n            }*/\n            if (map.containsValue(strs[i])) {\n                return false;           \n            }\n            map.put(p[i],strs[i]);\n        }\n    }\n    return true;\n}\n```\nå¾ˆç®€å•çš„é¢˜ï¼Œéœ€è¦å¯¹ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå€ŸåŠ©Hashè¡¨ç›´æ¥å°†ä¸¤ä¸ªStringè¿›è¡Œä¸€å¯¹ä¸€çš„æ˜ å°„ï¼Œæ—¢ç„¶è¦åŒ¹é…é‚£ä¹ˆ`åŒä¸€ä¸ªkeyå­—ç¬¦å¯¹åº”çš„valueå­—ç¬¦è‚¯å®šæ˜¯ä¸€æ ·çš„`ï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯åœ¨é‡åˆ°ä¸€ä¸ªæ–°çš„keyå­—ç¬¦çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­å¯¹åº”ä½ç½®çš„valueå­—ç¬¦å‡ºç°è¿‡æ²¡æœ‰ï¼Œå‡ºç°è¿‡å°±ç›´æ¥return falseï¼Œè¿™ä¸€ç‚¹ç¬¬ä¸€éçš„æ—¶å€™æ²¡è€ƒè™‘åˆ°ï¼Œ`ä¸åŒçš„keyå­—ç¬¦å¯¹åº”çš„valueå­—ç¬¦è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„`\n\n> å› ä¸ºç¬¬ä¸€æ¬¡æ²¡è€ƒè™‘åˆ°ç¬¬äºŒç§æƒ…å†µï¼Œæäº¤åç«Ÿç„¶è·‘è¿‡äº†`31/33` ä¸ªcaseï¼Œç„¶åå°±æ„Ÿè§‰è¿™é¢˜caseå¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œç„¶åè‡ªå·±å†™äº†ä¸ªé”™çš„ç®—æ³•å±…ç„¶ä¹Ÿè·‘è¿‡äº†ï¼Œå…·ä½“çš„ä»£ç åœ¨ä¸Šé¢çš„æ³¨é‡Šä¸­ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»è¯•è¯•ï¼Œæˆ‘å·²ç»æäº¤caseäº†ä½†æ˜¯è¿˜æ²¡å›åº”æˆ‘\n\n## [205. åŒæ„å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/isomorphic-strings/)\n\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦æ˜¯åŒæ„çš„ã€‚\n\nå¦‚æœ s ä¸­çš„å­—ç¬¦å¯ä»¥è¢«æ›¿æ¢å¾—åˆ° t ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯åŒæ„çš„ã€‚\n\næ‰€æœ‰å‡ºç°çš„å­—ç¬¦éƒ½å¿…é¡»ç”¨å¦ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ï¼ŒåŒæ—¶ä¿ç•™å­—ç¬¦çš„é¡ºåºã€‚ä¸¤ä¸ªå­—ç¬¦ä¸èƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œä½†å­—ç¬¦å¯ä»¥æ˜ å°„è‡ªå·±æœ¬èº«ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: s = \"egg\", t = \"add\"\nè¾“å‡º: true\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: s = \"foo\", t = \"bar\"\nè¾“å‡º: false\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: s = \"paper\", t = \"title\"\nè¾“å‡º: true\n```\n\n**è¯´æ˜:**\n\n- ä½ å¯ä»¥å‡è®¾ s å’Œ t å…·æœ‰ç›¸åŒçš„é•¿åº¦ã€‚\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å’Œä¸Šé¢ä¸€æ¨¡ä¸€æ ·ï¼ŒHashè¡¨çš„è§£æ³•å°±ä¸å†™äº†ï¼Œè¿™é¢˜éƒ½æ˜¯å•ä¸ªçš„å­—ç¬¦ï¼Œå¯ä»¥ä¸ç”¨Hashè¡¨ï¼Œå¯ä»¥ç”¨æ•°ç»„ä¼˜åŒ–\n\n```java\npublic boolean isIsomorphic2(String s, String t) {\n    if (s.length()!=t.length()) {\n        return false;\n    }\n    int[] key=new int[256];\n    int[] value=new int[256];\n\n    for (int i=0;i<s.length();i++) {\n        int cs=s.charAt(i);\n        int ct=t.charAt(i);\n        if(key[cs]!=0){ //cså‡ºç°è¿‡\n            if (key[cs]!=ct) {\n                return false;\n            }\n        }else{//csæ²¡å‡ºç°è¿‡\n            if (value[ct]!=0) {\n                return false;\n            }\n            key[cs]=ct;\n            value[ct]=cs;\n        }\n    }\n    return true;\n}\n```\n\nğŸ’¬ åŒæ ·çš„ï¼Œè¿™é¢˜å’Œä¸Šé¢çš„290ä¸€æ ·ï¼Œcaseä¹Ÿæœ‰é—®é¢˜ï¼Œç›´æ¥å’Œå‰ä¸€ä¸ªå­—ç¬¦æ¯”è¾ƒå°±å¯ä»¥è¿‡\n\n## [454. å››æ•°ç›¸åŠ  II](https://leetcode-cn.com/problems/4sum-ii/)\n\nç»™å®šå››ä¸ªåŒ…å«æ•´æ•°çš„æ•°ç»„åˆ—è¡¨ A , B , C , D ,è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç»„ (i, j, k, l) ï¼Œä½¿å¾— A[i] + B[j] + C[k] + D[l] = 0ã€‚\n\nä¸ºäº†ä½¿é—®é¢˜ç®€å•åŒ–ï¼Œæ‰€æœ‰çš„ A, B, C, D å…·æœ‰ç›¸åŒçš„é•¿åº¦ Nï¼Œä¸” `0 â‰¤ N â‰¤ 500` ã€‚æ‰€æœ‰æ•´æ•°çš„èŒƒå›´åœ¨ -2^28 åˆ° 2^28 - 1 ä¹‹é—´ï¼Œæœ€ç»ˆç»“æœä¸ä¼šè¶…è¿‡ 2^31 - 1 ã€‚\n\n**ä¾‹å¦‚:**\n\n```java\nè¾“å…¥:\nA = [ 1, 2]\nB = [-2,-1]\nC = [-1, 2]\nD = [ 0, 2]\n\nè¾“å‡º:\n2\n\nè§£é‡Š:\nä¸¤ä¸ªå…ƒç»„å¦‚ä¸‹:\n\n1. (0, 0, 0, 1) -> A[0] + B[0] + C[0] + D[1] = 1 + (-2) + (-1) + 2 = 0\n2. (1, 1, 0, 0) -> A[1] + B[1] + C[0] + D[0] = 2 + (-1) + (-1) + 0 = 0\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®çœ‹æ•°æ®è§„æ¨¡å°±çŸ¥é“åº”è¯¥å†™ä¸€ä¸ªä»€ä¹ˆæ ·å¤æ‚åº¦çš„ç®—æ³•äº†`0~500`ï¼Œæš´åŠ›çš„è¯ä¼šå¾ˆææ€–`O(N^4)`ï¼Œè¿™é‡Œå¯ä»¥è€ƒè™‘å°†å…¶ä¸­ä¸€ä¸ªæ”¾åˆ°hashè¡¨ä¸­ï¼Œç„¶åéå†å…¶ä»–çš„3ä¸ªï¼Œæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº†`O(N^3)`ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦è¿˜æ˜¯å¾ˆææ€–ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘å°†ä¸¤ä¸ªæ•°ç»„çš„å’Œæ”¾åˆ°hashè¡¨ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°`O(N^2)`\n\n```java\npublic int fourSumCount(int[] A, int[] B, int[] C, int[] D) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    for (int i=0;i<C.length;i++) {\n        for (int j=0;j<D.length;j++) {\n            int key=C[i]+D[j];\n            map.put(key,map.getOrDefault(key,0)+1);\n        }\n    }\n    int res=0;\n    for (int i=0;i<A.length;i++) {\n        for (int j=0;j<B.length;j++) {\n            int key=A[i]+B[j];\n            if(map.containsKey(-key)){\n                res+=map.get(-key);\n            }\n        }\n    }\n    return res;\n}\n```\n\n## [451. æ ¹æ®å­—ç¬¦å‡ºç°é¢‘ç‡æ’åº](https://leetcode-cn.com/problems/sort-characters-by-frequency/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·å°†å­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦æŒ‰ç…§å‡ºç°çš„é¢‘ç‡é™åºæ’åˆ—ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n\"tree\"\n\nè¾“å‡º:\n\"eert\"\n\nè§£é‡Š:\n'e'å‡ºç°ä¸¤æ¬¡ï¼Œ'r'å’Œ't'éƒ½åªå‡ºç°ä¸€æ¬¡ã€‚\nå› æ­¤'e'å¿…é¡»å‡ºç°åœ¨'r'å’Œ't'ä¹‹å‰ã€‚æ­¤å¤–ï¼Œ\"eetr\"ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç­”æ¡ˆã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\n\"cccaaa\"\n\nè¾“å‡º:\n\"cccaaa\"\n\nè§£é‡Š:\n'c'å’Œ'a'éƒ½å‡ºç°ä¸‰æ¬¡ã€‚æ­¤å¤–ï¼Œ\"aaaccc\"ä¹Ÿæ˜¯æœ‰æ•ˆçš„ç­”æ¡ˆã€‚\næ³¨æ„\"cacaca\"æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºç›¸åŒçš„å­—æ¯å¿…é¡»æ”¾åœ¨ä¸€èµ·ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥:\n\"Aabb\"\n\nè¾“å‡º:\n\"bbAa\"\n\nè§£é‡Š:\næ­¤å¤–ï¼Œ\"bbaA\"ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç­”æ¡ˆï¼Œä½†\"Aabb\"æ˜¯ä¸æ­£ç¡®çš„ã€‚\næ³¨æ„'A'å’Œ'a'è¢«è®¤ä¸ºæ˜¯ä¸¤ç§ä¸åŒçš„å­—ç¬¦ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic static String frequencySort(String s) {\n    if (s==null || s.length()<1) {\n        return s;\n    }\n    HashMap<Character,Integer> map=new HashMap<>();\n    for (int i=0;i<s.length();i++) {\n        map.put(s.charAt(i),map.getOrDefault(s.charAt(i),0)+1);\n    }\n    ArrayList<HashMap.Entry> list=new ArrayList<>();\n    for(HashMap.Entry entry:map.entrySet()){\n        list.add(entry);\n    }\n    list.sort((e1,e2)->(Integer)e2.getValue()-(Integer)e1.getValue());\n    StringBuilder res=new StringBuilder();\n    for (int i = 0; i < list.size(); i++) {\n        Integer value = (Integer)list.get(i).getValue();\n        while (value>0){\n            res.append(list.get(i).getKey());\n            value--;\n        }\n    }\n    return res.toString();\n}\n```\nè¿™é¢˜å…¶å®ä¹Ÿæ˜¯TopKé—®é¢˜ï¼Œç›´æ¥çš„æƒ³æ³•å°±æ˜¯ç”¨hashMapç»Ÿè®¡å„ä¸ªå­—ç¬¦å‡ºç°çš„ä¸ªæ•°ï¼Œç„¶åæ’åºå†æ‹¼æ¥ä¸ºç»“æœï¼Œå…¶å®è¿™é¢˜ä¸€å¼€å§‹æ˜¯TLEäº†çš„ï¼Œä¸€å¼€å§‹æ²¡æ³¨æ„ç›´æ¥ç”¨çš„Stringæ‹¼æ¥çš„ï¼Œæ•ˆç‡å¾ˆä½ï¼Œæ”¹ç”¨StringBuilderåå°±è¿‡äº†ï¼Œè™½ç„¶æ•ˆç‡è¿˜æ˜¯å¾ˆä½ 138msï¼Œå«åº•\n\n**è§£æ³•äºŒ**\n\n```java\npublic  static String frequencySort2(String s) {\n    if (s==null || s.length()<1) {\n        return s;\n    }\n    int[] freq=new int[256];\n    for (int i=0;i<s.length();i++) {\n        freq[s.charAt(i)]++;\n    }\n    int[] freq_bak=freq.clone();\n    Arrays.sort(freq);\n    StringBuilder res=new StringBuilder();\n    //ä»å¤§åˆ°å°\n    for (int i = 255; i>=0 && freq[i]!=0; i--) {\n        for (int j=0;j<255;j++) {\n            //æ‰¾åˆ°åŸæ•°ç»„ä¸­å¯¹åº”çš„å­—ç¬¦\n            //åªè¦å‡ºç°æ¬¡æ•°ä¸€æ ·çš„å°±è¡Œäº†\n            if(freq_bak[j]==freq[i]){\n                //æ ¹æ®freq_bak[j]æ„é€ ç»“æœ\n                while(freq_bak[j]>0){\n                    res.append((char)j);\n                    freq_bak[j]--;\n                }\n                break;\n            }\n        }\n    }\n    return res.toString();\n}\n```\n15msï¼Œ90% å…¶å®æ€è·¯å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç»Ÿè®¡æ•°é‡åè¿›è¡Œæ’åºï¼Œç„¶åé‡å»ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”¨æ•°ç»„çš„æ–¹å¼æ˜æ˜¾ä¼šæ¯”HashMapæ•ˆç‡ä¼šæ›´é«˜çš„å¤šï¼Œåé¢çš„ä¸¤å±‚å¾ªç¯éƒ½æ˜¯åœ¨å¸¸æ•°æ—¶é—´å†…ï¼Œä¸»è¦æ˜¯é‡å»ºå­—ç¬¦ä¸²å’Œæ’åºæ¶ˆè€—æ—¶é—´ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯`O(NlogN)`\n\n**è§£æ³•ä¸‰**\n\n```java\npublic  static String frequencySort3(String s) {\n    if (s==null || s.length()<1) {\n        return s;\n    }\n    ArrayList<Character> [] bucket=new ArrayList[s.length()+1];\n\n    int[] freq=new int[256];\n\n    for (int i=0;i<s.length();i++) {\n        freq[s.charAt(i)]++;\n    }\n\n    for (int i=0;i<s.length();i++) {\n        if (bucket[freq[s.charAt(i)]]==null) {\n            bucket[freq[s.charAt(i)]]=new ArrayList<>();\n        }\n        //æ¯ä¸ªå…ƒç´ åªè¿›å…¥ä¸€æ¬¡\n        if (!bucket[freq[s.charAt(i)]].contains(s.charAt(i))) {\n            bucket[freq[s.charAt(i)]].add(s.charAt(i));\n        }\n    } \n    //printArray(bucket);\n    StringBuilder res=new StringBuilder();\n    for (int i=bucket.length-1;i>=0;i--) {\n        //è¿‡æ»¤0\n        if (bucket[i]==null) {\n            continue;\n        }\n        //å‡ºç°iæ¬¡çš„å­—ç¬¦list\n        ArrayList<Character> temp=bucket[i];\n        //éå†å‡ºç°æ¬¡æ•°ç›¸åŒçš„list()\n        for (int j=0;j<temp.size();j++) { \n            //éå†å‡ºç°çš„æ¬¡æ•°\n            for (int count=0;count<i;count++) {\n                res.append(temp.get(j));\n            }\n        }\n    }\n    return res.toString();\n}\n```\n50msï¼Œ50% è¿™ä¸ªæ˜¯æ ¹æ® [å‰kä¸ªé«˜é¢‘å…ƒç´ ](http://imlgw.top/2019/05/04/leetcode-shu-zu-tag/#347-%E5%89%8D-K-%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0) ä¸­æ¡¶æ’åºçš„è§£æ³•æ¥çš„ï¼Œå½“ç„¶è¿™é‡Œå¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œåªæ˜¯ä¸€ç§æ€è·¯ï¼Œå…¶å®å†™èµ·æ¥è¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œæ—¶é—´å¤æ‚åº¦ç•¥é«˜ï¼Œä¸»è¦æ˜¯åœ¨æ¡¶æ’åºçš„æ—¶å€™æ·»åŠ å…ƒç´ åšä¸åˆ°O(N)éœ€è¦åˆ¤æ–­å…ƒç´ æ˜¯å¦æ·»åŠ ï¼Œä¸€ä¸ªå…ƒç´ åªèƒ½åœ¨listä¸­æ·»åŠ ä¸€æ¬¡ï¼Œå¦åˆ™åé¢é‡å»ºå­—ç¬¦ä¸²çš„æ—¶å€™å°±ä¼šæœ‰é—®é¢˜\n\n## [49. å­—æ¯å¼‚ä½è¯åˆ†ç»„](https://leetcode-cn.com/problems/group-anagrams/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå°†å­—æ¯å¼‚ä½è¯ç»„åˆåœ¨ä¸€èµ·ã€‚å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [\"eat\", \"tea\", \"tan\", \"ate\", \"nat\", \"bat\"],\nè¾“å‡º:\n[\n  [\"ate\",\"eat\",\"tea\"],\n  [\"nat\",\"tan\"],\n  [\"bat\"]\n]\n```\n\n**è¯´æ˜ï¼š**\n\n- æ‰€æœ‰è¾“å…¥å‡ä¸ºå°å†™å­—æ¯\n- ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåº\n\n**è§£æ³•ä¸€**\n\nç®—æ˜¯æš´åŠ›æ³•äº†ï¼Œå€ŸåŠ©ä¸Šé¢çš„åŒæ„é¢˜æ€è·¯æ¥éå†åˆ¤æ–­\n\n```java\npublic List<List<String>> groupAnagrams(String[] strs) {\n    ArrayList<List<String>> res=new ArrayList<>();\n    for (int i=0;i<strs.length;i++) {\n        if (\"7\"==strs[i]) {\n            continue;\n        }\n        ArrayList<String> group=new ArrayList<String>();\n        group.add(strs[i]);\n        for (int j=i+1;j<strs.length;j++) {\n            if (\"7\"==strs[j]) {\n                continue;\n            }\n            if(isAnagram(strs[i],strs[j])){\n                group.add(strs[j]);\n                //æœ‰åˆ†ç»„äº†\n                strs[j]=\"7\";\n            }\n        }\n        res.add(group);\n    }\n    return res;\n}\n\npublic boolean isAnagram(String str1,String str2){\n    if(str1.length()!=str2.length()){\n        return false;\n    }\n    int[] freq=new int[26];\n    for (int i=0;i<str1.length();i++) {\n        freq[str1.charAt(i)-'a']++;\n    }\n    for (int i=0;i<str2.length();i++) {\n        freq[str2.charAt(i)-'a']--;\n    }\n    for (int i=0;i<freq.length;i++) {\n        if (freq[i]!=0) {\n            return false;\n        }\n    }\n    return true;\n}\n```\nå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ª`7` å…¶å®æ²¡ä»€ä¹ˆå«ä¹‰å°±æ˜¯ä¸ºäº†è¡¨ç¤ºè¿™ä¸ªå­—ç¬¦å·²ç»æœ‰åˆ†ç»„äº†ï¼Œè¿™é‡Œä¸€å¼€å§‹æˆ‘æ˜¯ç”¨çš„equalsæ¥æ¯”è¾ƒçš„è¿™ä¸ª7ç»“æœè¶…æ—¶äº†ï¼Œç„¶åæ¢æˆäº†==å‹‰å¼ºè·‘è¿‡äº†ï¼Œå¯èƒ½æ˜¯ä¸ªä¾‹ï¼Œå› ä¸ºæˆ‘åæ¥ç”¨booleanæ•°ç»„ä¹Ÿæ²¡è·‘è¿‡ã€‚ã€‚ã€‚\n\n> è¿™é‡Œç”¨==å¯ä»¥æ¯”è¾ƒçš„åŸå› å¯èƒ½æ˜¯strså’Œå­—é¢é‡ \"7\"éƒ½åœ¨å­—ç¬¦å¸¸é‡æ± ä¸­ï¼Œä½†æ˜¯è¿™é‡Œå¹¶ä¸å»ºè®®è¿™æ ·æ¯”è¾ƒï¼Œè¿™é‡Œå¯ä»¥è¯´æ˜¯ä¸ªåä¾‹äº†ï¼Œæ¯”è¾ƒå­—ç¬¦ä¸²è¯·ç”¨`equals` ï¼ï¼ï¼\n\n```java\npublic List<List<String>> groupAnagrams(String[] strs) {\n    ArrayList<List<String>> res=new ArrayList<>();\n    boolean[] flag=new boolean[strs.length()];\n    for (int i=0;i<strs.length;i++) {\n        if (flag[i]) continue;\n        ArrayList<String> group=new ArrayList<String>();\n        group.add(strs[i]);\n        for (int j=i+1;j<strs.length;j++) {\n            if(flag[j])continue;\n            if(isAnagram(strs[i],strs[j])){\n                group.add(strs[j]);\n                flag[j]=true;\n            }\n        }\n        res.add(group);\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nåˆ©ç”¨æ’åºç»“æœæ¥ä½œä¸ºkeyï¼Œå°†æ’åºç»“æœç›¸åŒçš„stræ˜ å°„åˆ°ä¸€èµ·\n\n```java\n//æ’åºè§£æ³•\npublic List<List<String>> groupAnagrams(String[] strs) {\n    HashMap<String,List<String>> map=new HashMap<>();\n    for (int i=0;i<strs.length;i++) {\n        char[] strs_i=strs[i].toCharArray();\n        //æ’åºï¼Œå°†ç»“æœä½œä¸ºkey\n        Arrays.sort(strs_i);\n        String key=String.valueOf(strs_i);\n\n        if(map.containsKey(key)){\n            //å­˜åœ¨åŒæ„çš„keyï¼Œç›´æ¥æ·»åŠ è¿›å»\n            map.get(key).add(strs[i]);\n        }else{\n            //ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ªï¼Œç„¶åå°†è‡ªå·±æ·»åŠ è¿›å»\n            map.put(key,new ArrayList<>());\n            map.get(key).add(strs[i]);\n        }\n    }\n    return new ArrayList(map.values());\n}\n```\næ—¶é—´å¤æ‚åº¦`O(NKlogK)`ï¼ŒKä¸ºå­—ç¬¦æ•°ç»„ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²ï¼Œ`O(KlogK)` æ˜¯ç»™è¿™ä¸ªå­—ç¬¦ä¸²æ’åºçš„ç»“æœ\n\n**è§£æ³•ä¸‰**\n\næ ¹æ®å‡ºç°é¢‘æ¬¡æ„æˆçš„å­—ç¬¦ä¸²ä½œä¸ºkeyï¼Œæ¯”å¦‚`aba`ä»¥åŠæ‰€æœ‰çš„å¼‚ä½è¯éƒ½ä¼šè¢«æ˜ å°„ä¸º`2#1#` \n\n```java\npublic List<List<String>> groupAnagrams(String[] strs) {\n    HashMap<String,List<String>> map=new HashMap<>();\n    int[] freq=new int[26];\n    for (int i=0;i<strs.length;i++) {\n        //Arrays.fill(freq,0);\n        //ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘æ¬¡\n        for (int j=0;j<strs[i].length();j++) {\n            freq[strs[i].charAt(j)-'a']++;\n        }\n        //æ„å»ºå”¯ä¸€æ˜ å°„çš„key\n        StringBuilder key=new StringBuilder();\n        //è¿™ä¸ªå…¶å®ç±»ä¼¼æ¡¶æ’åº,ä¾æ¬¡å–abcde...\n        for (int j=0;j<26;j++) {\n            key.append(freq[j]);\n            //è¿™ä¸ª#å¾ˆå…³é”®,ä¸ºäº†é˜²æ­¢é‡å¤,å› ä¸ºæœ‰çš„å­—ç¬¦å¯èƒ½å‡ºç°ä¸¤ä½æ•°çš„æ¬¡æ•°,ä»…ä»…å¯¹æ¯”æ•°å­—æ˜¯æ— æ³•ç¡®å®šçš„\n            key.append(\"#\");\n            //é‡ç½®ä¸º0æ–¹ä¾¿åé¢é‡å¤ä½¿ç”¨\n            freq[j]=0;\n        }\n        String skey=key.toString();\n        if(map.containsKey(skey)){\n            map.get(skey).add(strs[i]);\n        }else{\n            map.put(skey,new ArrayList());\n            map.get(skey).add(strs[i]);\n        }\n    }\n    return new ArrayList(map.values());\n}\n```\n45msï¼Œ21% æ—¶é—´å¤æ‚åº¦`O(NK)` Kä¸ºå­—ç¬¦æ•°ç»„ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¾ˆç„å­¦ï¼Œè®²é“ç†åº”è¯¥ä¸ä¼šè¿™ä¹ˆæ…¢ï¼Œçœ‹äº†leetcodeä¸Šå‰å‡ åè·Ÿæˆ‘çš„å·®ä¸å¤šï¼Œå¼€å§‹åšçš„æ—¶å€™ç›´æ¥ç”¨ `StringBuilder` å¯¹è±¡ä½œä¸ºäº†keyç»“æœè‚¯å®šä¸å¯¹ï¼ŒStringBuilderæ²¡æœ‰è¦†ç›–equalsæ–¹æ³•ï¼Œkeyæ°¸è¿œä¸ä¼šç›¸ç­‰ï¼Œæ¯æ¬¡éƒ½æ˜¯æ–°çš„key\n\n**è§£æ³•å››**\n\n**ç®—æœ¯åŸºæœ¬å®šç†**ï¼Œåˆç§°ä¸ºæ­£æ•´æ•°çš„å”¯ä¸€åˆ†è§£å®šç†ï¼Œå³ï¼šæ¯ä¸ªå¤§äº1çš„è‡ªç„¶æ•°ï¼Œè¦ä¹ˆæœ¬èº«å°±æ˜¯è´¨æ•°ï¼Œè¦ä¹ˆå¯ä»¥å†™ä¸º2ä¸ªä»¥ä¸Šçš„è´¨æ•°çš„ç§¯ï¼Œè€Œä¸”è¿™äº›è´¨å› å­æŒ‰å¤§å°æ’åˆ—ä¹‹åï¼Œå†™æ³•ä»…æœ‰ä¸€ç§æ–¹å¼\n\n```java\npublic List<List<String>> groupAnagrams(String[] strs) {\n    HashMap<Integer, List<String>> hash = new HashMap<>();\n    //æ¯ä¸ªå­—æ¯å¯¹åº”ä¸€ä¸ªè´¨æ•°\n    int[] prime = { 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103 };\n    for (int i = 0; i < strs.length; i++) {\n        int key = 1;\n        //ç´¯ä¹˜å¾—åˆ° key\n        for (int j = 0; j < strs[i].length(); j++) {\n            key *= prime[strs[i].charAt(j) - 'a'];\n        } \n        if (hash.containsKey(key)) {\n            hash.get(key).add(strs[i]);\n        } else {\n            List<String> temp = new ArrayList<String>();\n            temp.add(strs[i]);\n            hash.put(key, temp);\n        }\n    }\n    return new ArrayList<List<String>>(hash.values());\n}\n```\n\næ—¶é—´å¤æ‚åº¦`O(NK)`ï¼Œå¼ºçš„8è¡Œ\n\n> åˆ†æå®Œä¸Šé¢ä¸‰ç§è§£æ³•åå…¶å®å¾ˆåŒæ„å¾—å‡ºè¿™é¢˜çš„å…³é”®ï¼š`ç»™åŒç»„çš„å¼‚ä½è¯æ‰¾åˆ°ä¸€ä¸ªç›¸åŒçš„æ˜ å°„key`ï¼Œå°½é‡çš„ç¼©çŸ­æ±‚è¿™ä¸ªæ˜ å°„çš„æ—¶é—´å°±å¯ä¼˜åŒ–æ•´ä¸ªç®—æ³•\n\n## [447. å›æ—‹é•–çš„æ•°é‡](https://leetcode-cn.com/problems/number-of-boomerangs/)\n\nç»™å®šå¹³é¢ä¸Š n å¯¹ä¸åŒçš„ç‚¹ï¼Œâ€œå›æ—‹é•–â€ æ˜¯ç”±ç‚¹è¡¨ç¤ºçš„å…ƒç»„ `(i, j, k)` ï¼Œå…¶ä¸­ i å’Œ j ä¹‹é—´çš„è·ç¦»å’Œ i å’Œ k ä¹‹é—´çš„è·ç¦»ç›¸ç­‰ï¼ˆ**éœ€è¦è€ƒè™‘å…ƒç»„çš„é¡ºåº**ï¼‰\n\næ‰¾åˆ°æ‰€æœ‰å›æ—‹é•–çš„æ•°é‡ã€‚ä½ å¯ä»¥å‡è®¾ n æœ€å¤§ä¸º 500ï¼Œæ‰€æœ‰ç‚¹çš„åæ ‡åœ¨é—­åŒºé—´ `[-10000, 10000]` ä¸­ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥:\n[[0,0],[1,0],[2,0]]\n\nè¾“å‡º:\n2\n\nè§£é‡Š:\nä¸¤ä¸ªå›æ—‹é•–ä¸º [[1,0],[0,0],[2,0]] å’Œ [[1,0],[2,0],[0,0]]\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic static int numberOfBoomerangs(int[][] points) {\n    int res=0;\n    HashMap<Integer,Integer> map=new HashMap<>();\n    for (int i=0;i<points.length;i++) {\n        for (int j=0;j<points.length;j++) {\n            if (i!=j){\n                int dis=dis(points[i],points[j]);\n                map.put(dis,map.getOrDefault(dis,0)+1);\n            }\n        }\n        //C2m ç»„åˆé—®é¢˜\n        for (Integer count:map.values()) {\n            if (count>1) {\n                res+=count*(count-1);\n            }\n        }\n        map.clear();\n    }\n    return res;\n}\n\npublic static int dis(int[] a,int[] b){\n    return (a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1]);\n}\n```\nçœ‹ä¸€ä¸‹ç»™çš„æ•°æ®é‡`500`å°±çŸ¥é“å¤æ‚åº¦åªèƒ½æ˜¯`O(N^2)` çš„ï¼Œç”¨Hashè¡¨ç»Ÿè®¡åˆ°å½“å‰ç‚¹çš„è·ç¦»ç›¸åŒçš„ç‚¹æœ‰å¤šå°‘ä¸ªï¼Œç„¶ååˆ©ç”¨ç»„åˆæ•°æ±‚å¤šå°‘ç§ç»„åˆï¼Œä¸€å¼€å§‹å¹¶æ²¡æœ‰æƒ³åˆ°è¿™ç§æ–¹æ³•ï¼Œæˆ‘æƒ³çš„æ˜¯åˆ©ç”¨åæ ‡ç³»çš„å¯¹ç§°æ¥åšï¼Œå¤ªèœäº†\n\nè¿™é‡Œè¿˜æœ‰ä¸ªå°ç»†èŠ‚ï¼Œä¸€å¼€å§‹å°†HashMapçš„åˆ›å»ºæ”¾åœ¨å†…å¾ªç¯ä¸­ï¼Œå‘ç°æ•ˆç‡å¾ˆä½ï¼Œ300mså·¦å³ï¼Œç„¶åå°†åˆ›å»ºHashMapç§»å‡ºå»åç”¨clearæ¸…ç©ºï¼Œç¬é—´å¿«äº†100mså·¦å³ï¼Œåˆ›å»ºHashMapçš„æˆæœ¬æœç„¶è¿˜æ˜¯æŒºå¤§çš„\n\nè¿™é¢˜å…¶å®è¿˜å¯ä»¥å‡å°‘å†…å¾ªç¯çš„æ•°é‡ï¼Œ\n\n## [217. å­˜åœ¨é‡å¤å…ƒç´ ](https://leetcode-cn.com/problems/contains-duplicate/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å¤å…ƒç´ ã€‚\n\nå¦‚æœä»»ä½•å€¼åœ¨æ•°ç»„ä¸­å‡ºç°è‡³å°‘ä¸¤æ¬¡ï¼Œå‡½æ•°è¿”å› trueã€‚å¦‚æœæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç›¸åŒï¼Œåˆ™è¿”å› falseã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3,1]\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,2,3,4]\nè¾“å‡º: false\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [1,1,1,3,3,4,3,2,4,2]\nè¾“å‡º: true\n```\n\n**è§£æ³•ä¸€**\n\nå€ŸåŠ©Hashè¡¨ï¼Œå¾ˆç®€å•çš„é¢˜\n\n```java\npublic static boolean containsDuplicate(int[] nums) {\n    if (nums==null) return false;\n    HashSet<Integer> set=new HashSet<>();\n    for (int i=0;i<nums.length;i++) {\n        if (set.contains(nums[i])) {\n            return true;\n        }\n        set.add(nums[i]);\n    }\n    return false;\n}\n```\nå…¶å®è¿˜å¯ä»¥ä¼˜åŒ–ä¸‹\n\n```java\npublic static boolean containsDuplicate(int[] nums) {\n    if (nums==null) return false;\n    HashSet<Integer> set=new HashSet<>();\n    for (int i=0;i<nums.length;i++) {\n        if (!set.add(nums[i])) {\n            return true;\n        }\n    }\n    return false;\n}\n```\n`set.add()` æœ¬èº«å°±å¸¦æœ‰è¿”å›å€¼ï¼Œå¯ä»¥å‡å°‘å¾ˆå¤šåˆ¤æ–­ï¼Œè¿™é¢˜è¿˜æœ‰ä¸€ä¸ªè¿›é˜¶ç‰ˆ [219. å­˜åœ¨é‡å¤å…ƒç´  II](https://leetcode-cn.com/problems/contains-duplicate-ii/) ä¹Ÿä¸éš¾ï¼Œæˆ‘æ”¾åˆ° [æ»‘åŠ¨çª—å£ä¸“é¢˜](http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou-tag/#3-%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2) ä¸­å»äº†\n\n## [220. å­˜åœ¨é‡å¤å…ƒç´  III](https://leetcode-cn.com/problems/contains-duplicate-iii/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦æœ‰ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• i å’Œ jï¼Œä½¿å¾— `nums [i]` å’Œ `nums [j]` çš„å·®çš„ç»å¯¹å€¼æœ€å¤§ä¸º tï¼Œå¹¶ä¸” i å’Œ j ä¹‹é—´çš„å·®çš„ç»å¯¹å€¼æœ€å¤§ä¸º k\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums = [1,2,3,1], k = 3, t = 0\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums = [1,0,1,1], k = 1, t = 2\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: nums = [1,5,9,1,5,9], k = 2, t = 3\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é‡Œå…¶å®å¯ä»¥ç®—éš¾é¢˜äº†ï¼Œé€šè¿‡ç‡åªæœ‰20%ï¼Œåˆ©ç”¨Javaä¸­æä¾›çš„TreeMapï¼Œæœ‰é¡ºåºè€Œä¸”æ’å…¥å’Œåˆ é™¤ç­‰æ“ä½œæ•ˆç‡éƒ½å¾ˆé«˜ï¼ˆlogNï¼‰ï¼Œç„¶åæŸ¥æ‰¾æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼Œçœ‹ç¬¦ä¸ç¬¦åˆé¢˜ç›®è¦æ±‚\n\n```java\npublic boolean containsNearbyAlmostDuplicate(int[] nums, int k, int t) {\n    TreeSet<Integer> set=new TreeSet<>();\n    for (int i=0;i<nums.length;i++) {\n        //å¤§äºnums[i]çš„æœ€å°å…ƒç´ \n        Integer ceiling=set.ceiling(nums[i]);\n        //å°äºnums[i]çš„æœ€å¤§å…ƒç´ \n        Integer floor=set.floor(nums[i]);\n        //é˜²æ­¢æº¢å‡º\n        long temp1=Long.valueOf(nums[i])+Long.valueOf(t);\n        long temp2=Long.valueOf(nums[i])-Long.valueOf(t);\n        if((ceiling!=null && ceiling<=temp1) || (floor!=null && floor>=temp2)) {\n            return true;\n        }\n        set.add(nums[i]);\n        if (set.size()>k) {\n            //ç§»é™¤å·¦è¾¹ç•Œ\n            set.remove(nums[i-k]);\n        }\n    }\n    return false;\n}\n```\n72msï¼Œ5%å·¦å³ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦`O(NlogN)` \n\n**è§£æ³•äºŒ**\n\nçœ‹äº†ä¸‹è¯„è®ºåŒºï¼Œå‘ç°å…¶å®å¯ä»¥ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªè¾¹ç•Œï¼Œè¿™æ ·å¯ä»¥å°‘ä¸€æ¬¡æŸ¥æ‰¾çš„æ“ä½œï¼Œæ•ˆç‡æœ‰å¾ˆå¤§æå‡\n\n```java\npublic boolean containsNearbyAlmostDuplicate2(int[] nums, int k, int t) {\n    TreeSet<Long> set=new TreeSet<>();\n    for (int i=0;i<nums.length;i++) {\n        //å¤§äºnums[i]-tçš„æœ€å°å…ƒç´ \n        Long ceil=set.ceiling((long)nums[i]-(long)t);\n        if(ceil!=null && ceil<=(long)nums[i]+(long)t) {\n            return true;\n        }\n        set.add((long)nums[i]);\n        if (set.size()>k) {\n            set.remove((long)nums[i-k]);\n        }\n    }\n    return false;\n}\n```\n43msï¼Œ56%å·¦å³ï¼Œä¾ç„¶è¦æ³¨æ„æº¢å‡ºçš„é—®é¢˜\n\n## [1282. ç”¨æˆ·åˆ†ç»„](https://leetcode-cn.com/problems/group-the-people-given-the-group-size-they-belong-to/)\n\næœ‰ n ä½ç”¨æˆ·å‚åŠ æ´»åŠ¨ï¼Œä»–ä»¬çš„ ID ä» 0 åˆ° n - 1ï¼Œæ¯ä½ç”¨æˆ·éƒ½ æ°å¥½ å±äºæŸä¸€ç”¨æˆ·ç»„ã€‚ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ groupSizesï¼Œå…¶ä¸­åŒ…å«æ¯ä½ç”¨æˆ·æ‰€å¤„çš„ç”¨æˆ·ç»„çš„å¤§å°ï¼Œè¯·ä½ è¿”å›ç”¨æˆ·åˆ†ç»„æƒ…å†µï¼ˆå­˜åœ¨çš„ç”¨æˆ·ç»„ä»¥åŠæ¯ä¸ªç»„ä¸­ç”¨æˆ·çš„ IDï¼‰ã€‚\n\nä½ å¯ä»¥ä»»ä½•é¡ºåºè¿”å›è§£å†³æ–¹æ¡ˆï¼ŒID çš„é¡ºåºä¹Ÿä¸å—é™åˆ¶ã€‚æ­¤å¤–ï¼Œé¢˜ç›®ç»™å‡ºçš„æ•°æ®ä¿è¯è‡³å°‘å­˜åœ¨ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šgroupSizes = [3,3,3,3,3,1,3]\nè¾“å‡ºï¼š[[5],[0,1,2],[3,4,6]]\nè§£é‡Šï¼š \nå…¶ä»–å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæœ‰ [[2,1,6],[5],[0,4,3]] å’Œ [[5],[0,6,2],[4,3,1]]ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šgroupSizes = [2,1,3,3,3,2]\nè¾“å‡ºï¼š[[1],[0,5],[2,3,4]]\n```\n\n**æç¤ºï¼š**\n\n- `groupSizes.length == n`\n- `1 <= n <= 500`\n- `1 <= groupSizes[i] <= n`\n\n**è§£æ³•ä¸€**\n\n12.8å‘¨èµ›çš„é¢˜ï¼Œæˆ‘æ˜¯æ¨¡æ‹Ÿåšçš„ï¼Œçœ‹äº†åˆ«äººçš„åšæ³•è¿˜æ˜¯æ„Ÿè§‰è¿™ç§æ¯”è¾ƒä¼˜é›…\n\n```java\npublic List<List<Integer>> groupThePeople(int[] groupSizes) {\n    HashMap<Integer,List<Integer>> map=new HashMap<>();\n    List<List<Integer>> res=new LinkedList<>();\n    for (int i=0;i<groupSizes.length;i++) {\n        if (!map.containsKey(groupSizes[i])) {\n            List<Integer> list=new LinkedList();\n            map.put(groupSizes[i],list);\n        }\n        List<Integer> gl=map.get(groupSizes[i]);\n        gl.add(i);\n        if (gl.size()==groupSizes[i]) {\n            res.add(gl);\n            map.remove(groupSizes[i]);\n        }\n    }\n    return res;\n}\n```\næ—¶é—´å¤æ‚åº¦`O(N)`\n\n**è§£æ³•äºŒ**\n\næ¨¡æ‹Ÿçš„è§£æ³•ï¼Œæ—¶é—´å¤æ‚åº¦`O(N^2)`\n\n```java\npublic List<List<Integer>> groupThePeople(int[] groupSizes) {\n    boolean[] visit=new boolean[groupSizes.length];\n    List<List<Integer>> res=new LinkedList<>();\n    for (int i=0;i<groupSizes.length;i++) {\n        if (visit[i]) {\n            continue;\n        }\n        List<Integer> list= new LinkedList<>();\n        list.add(i);\n        for (int j=i+1;j<groupSizes.length;j++) {\n            if (visit[j]) {\n                continue;\n            }\n            if (list.size()==groupSizes[i]) {\n                break;\n            }\n            if (groupSizes[j]==groupSizes[i]) {\n                list.add(j);\n                visit[j]=true;\n            }\n        }\n        res.add(list);\n    }\n    return res;\n}\n```\n\n## [128. æœ€é•¿è¿ç»­åºåˆ—](https://leetcode-cn.com/problems/longest-consecutive-sequence/)\n\nç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºæœ€é•¿è¿ç»­åºåˆ—çš„é•¿åº¦ã€‚\n\nè¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [100, 4, 200, 1, 3, 2]\nè¾“å‡º: 4\nè§£é‡Š: æœ€é•¿è¿ç»­åºåˆ—æ˜¯ [1, 2, 3, 4]ã€‚å®ƒçš„é•¿åº¦ä¸º 4ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nå€ŸåŠ©Hashè¡¨çš„æš´åŠ›è§£æ³•\n\n```java\npublic int longestConsecutive(int[] nums) {\n    if (nums ==null || nums.length<=0) {\n        return 0;\n    }\n    HashSet<Integer> set=new HashSet();\n    for (int n:nums) {\n        set.add(n);\n    }\n    int max=0;\n    for (int i=0;i<nums.length;i++) {\n        int num=nums[i];\n        int res=1;\n        while(set.contains(num+1)){\n            res++;\n            num++;\n        }\n        max=Math.max(max,res);\n    }\n    return max;\n}\n```\n\nå¯¹äºæ¯ä¸ªå…ƒç´ åœ¨Hashè¡¨ä¸­æŸ¥æ‰¾å®ƒçš„ä¸‹ä¸€ä¸ªè¿ç»­çš„å…ƒç´ `num+1` æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯å°±ç»§ç»­å¾€ä¸‹æ‰¾ï¼Œæœ€åæ±‚çš„ä»¥æ¯ä¸ªå…ƒç´ å¼€å¤´çš„æœ€é•¿å­åºåˆ—é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦`O(N^2)`ä¸ç¬¦åˆé¢˜ç›®çš„è¦æ±‚\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¼˜åŒ–æˆ‘ä»¬çš„ç®—æ³•ï¼Œå…¶å®ä¸Šé¢çš„è¿‡ç¨‹æˆ‘ä»¬å¾ˆå®¹æ˜“å°±çœ‹å‡ºå•¦é‡Œé¢ä¼šæœ‰é‡å¤çš„è®¡ç®—\n\n`eg. 5ï¼Œ4ï¼Œ6ï¼Œ7ï¼Œ8`  æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ª5çš„æ—¶å€™è®¡ç®—äº†ä»¥5å¼€å¤´çš„ 5ï¼Œ6ï¼Œ7ï¼Œ8è¿™æ¡è·¯å¾„ï¼Œç„¶åè½¬è€Œè®¡ç®—ç¬¬äºŒä¸ª4ï¼Œè®¡ç®—äº†ä»¥4å¼€å¤´çš„4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8è¿™é‡Œå…¶å®å°±å‘ç”Ÿäº†é‡å¤çš„è®¡ç®—ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œæ±‚çš„æ˜¯æœ€é•¿çš„åºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦èˆå¼ƒç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éå†ç¬¬ä¸€ä¸ª5çš„æ—¶å€™ç›´æ¥è·³è¿‡ï¼Œè·³è¿‡çš„ä¾æ®å°±æ˜¯åˆ¤æ–­ 5-1 åœ¨ä¸åœ¨é›†åˆä¸­ï¼Œå¦‚æœåœ¨é‚£ä¹ˆä»¥å®ƒå¼€å¤´çš„åºåˆ—ä¸€å®šä¸æ˜¯ä¸ä¼šæ˜¯æœ€é•¿çš„ï¼Œåä¹‹åˆ™æœ‰å¯èƒ½æ˜¯æœ€é•¿çš„ï¼Œæˆ‘ä»¬ç»Ÿè®¡æ‰€æœ‰è¿™æ ·çš„åºåˆ—é•¿åº¦ï¼Œæœ€åæ±‚ä¸€ä¸ªæœ€å¤§å€¼å°±å¯ä»¥äº†\n\n**è§£æ³•äºŒ**\n\næ¯ä¸ªå…ƒç´ æœ€å¤šéå†2æ¬¡ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ç¬¦åˆè¦æ±‚\n\n```java\npublic int longestConsecutive(int[] nums) {\n    if (nums ==null || nums.length<=0) {\n        return 0;\n    }\n    HashSet<Integer> set=new HashSet();\n    for (int n:nums) {\n        set.add(n);\n    }\n    int max=0;\n    for (int i=0;i<nums.length;i++) {\n        int num=nums[i];\n        if (!set.contains(num-1)) {\n            int res=1;\n            while(set.contains(num+1)){\n                res++;\n                num++;\n            }\n            max=Math.max(max,res);\n        }\n    }\n    return max;\n}\n```\n\n**è§£æ³•ä¸‰**\n\nå¹¶æŸ¥é›†çš„è§£æ³•ï¼Œç•¥å¾®éº»çƒ¦ç‚¹ï¼Œä½†æ˜¯æ¯•ç«Ÿè¿™é¢˜çš„tagå°±æ˜¯å¹¶æŸ¥é›†ï¼Œè¿˜æ˜¯å®ç°ä¸€ä¸‹\n\n```java\n//å¹¶æŸ¥é›†\nHashMap<Integer,Integer> parent;\n\nHashMap<Integer,Integer> size;\n\nint max=1;\n\npublic int find(int index){\n    while(parent.get(index)!=index){\n        //parent[index]=parent[parent[index]];\n        parent.put(index,parent.get(index));\n        index=parent.get(index);\n    }\n    return index;\n}\n\npublic void union(int p,int q){\n    int pID=find(p);\n    int qID=find(q);\n    if (pID==qID) {\n        return;\n    }\n    int pSize=size.get(pID);\n    int qSize=size.get(qID);\n    if (pSize > qSize) {\n        //parent[qID]=pID;\n        parent.put(qID,pID);\n        //size[pID]+=size[qID];\n        size.put(pID,pSize+qSize);\n    }else{\n        //parent[pID]=qID;\n        parent.put(pID,qID);\n        //size[qID]+=size[pID];\n        size.put(qID,pSize+qSize);\n    }\n    max=Math.max(max,pSize+qSize); //ç»Ÿè®¡æœ€å¤§å€¼\n}\n\npublic void initUnionFind(int[]nums){\n    parent=new HashMap<>();\n    size=new HashMap<>();\n    for (int i=0;i<nums.length;i++) {\n        parent.put(nums[i],nums[i]);\n        size.put(nums[i],1);\n    }\n}\n\npublic int longestConsecutive(int[] nums) {\n    if (nums ==null || nums.length<=0) {\n        return 0;\n    }\n    HashSet<Integer> set=new HashSet();\n    for (int i=0;i<nums.length;i++) {\n        set.add(nums[i]);\n    }\n    initUnionFind(nums);\n    for (int i=0;i<nums.length;i++) {\n        if (set.contains(nums[i]-1)) { //åˆ¤æ–­-1æˆ–è€…+1éƒ½å¯ä»¥\n            union(nums[i],nums[i]-1);\n        }\n    }\n    return max;\n}\n```\n\n## [1002. æŸ¥æ‰¾å¸¸ç”¨å­—ç¬¦](https://leetcode-cn.com/problems/find-common-characters/)\n\nDifficulty: **ç®€å•**\n\nç»™å®šä»…æœ‰å°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²æ•°ç»„ `A`ï¼Œè¿”å›åˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²ä¸­éƒ½æ˜¾ç¤ºçš„å…¨éƒ¨å­—ç¬¦ï¼ˆ**åŒ…æ‹¬é‡å¤å­—ç¬¦**ï¼‰ç»„æˆçš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå­—ç¬¦åœ¨æ¯ä¸ªå­—ç¬¦ä¸²ä¸­å‡ºç° 3 æ¬¡ï¼Œä½†ä¸æ˜¯ 4 æ¬¡ï¼Œåˆ™éœ€è¦åœ¨æœ€ç»ˆç­”æ¡ˆä¸­åŒ…å«è¯¥å­—ç¬¦ 3 æ¬¡ã€‚\n\nä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```\nè¾“å…¥ï¼š[\"bella\",\"label\",\"roller\"]\nè¾“å‡ºï¼š[\"e\",\"l\",\"l\"]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```\nè¾“å…¥ï¼š[\"cool\",\"lock\",\"cook\"]\nè¾“å‡ºï¼š[\"c\",\"o\"]\n```\n\n**æç¤ºï¼š**\n\n1.  `1 <= A.length <= 100`\n2.  `1 <= A[i].length <= 100`\n3.  `A[i][j]` æ˜¯å°å†™å­—æ¯\n\n**è§£æ³•ä¸€**\n\nèŒƒå›´å°ï¼Œéšä¾¿æ\n```golang\nfunc commonChars(A []string) []string {\n Â  Â var m = make(map[int]map[byte]int)\n Â  Â \n Â  Â var max = 0\n Â  Â for i := 0; i < len(A); i++ {\n Â  Â  Â  Â m[i] = make(map[byte]int)\n Â  Â  Â  Â for j := 0; j < len(A[i]); j++ {\n Â  Â  Â  Â  Â  Â m[i][A[i][j]]++\n Â  Â  Â   }\n Â  Â  Â  Â if len(A[i]) > len(A[max]) {\n Â  Â  Â  Â  Â  Â max = i\n Â  Â  Â   }\n Â   }\n Â  Â var res []string\n Â  Â for i := 0; i < len(A[max]); i++ {\n Â  Â  Â  Â var flag = true\n Â  Â  Â  Â for j := 0; j < len(A); j++ {\n Â  Â  Â  Â  Â  Â if j == max {\n Â  Â  Â  Â  Â  Â  Â  Â continue\n Â  Â  Â  Â  Â   }\n Â  Â  Â  Â  Â  Â if m[j][A[max][i]] == 0 {\n Â  Â  Â  Â  Â  Â  Â  Â flag = false\n Â  Â  Â  Â  Â  Â  Â  Â break\n Â  Â  Â  Â  Â   }\n Â  Â  Â  Â  Â  Â m[j][A[max][i]]--\n Â  Â  Â   }\n Â  Â  Â  Â if flag {\n Â  Â  Â  Â  Â  Â res = append(res, string(A[max][i]))\n Â  Â  Â   }\n Â   }\n Â  Â return res\n}\n```\n\n## _å‰ç¼€å’Œç›¸å…³_\n\n## [560. å’Œä¸ºKçš„å­æ•°ç»„](https://leetcode-cn.com/problems/subarray-sum-equals-k/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° kï¼Œä½ éœ€è¦æ‰¾åˆ°è¯¥æ•°ç»„ä¸­å’Œä¸º k çš„è¿ç»­çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚\n\n**ç¤ºä¾‹ 1 :**\n\n```java\nè¾“å…¥:nums = [1,1,1], k = 2\nè¾“å‡º: 2 , [1,1] ä¸ [1,1] ä¸ºä¸¤ç§ä¸åŒçš„æƒ…å†µã€‚\n```\n\n\n**è¯´æ˜ :**\n\n- æ•°ç»„çš„é•¿åº¦ä¸º [1, 20,000]ã€‚\n- æ•°ç»„ä¸­å…ƒç´ çš„èŒƒå›´æ˜¯ [-1000, 1000] ï¼Œä¸”æ•´æ•° k çš„èŒƒå›´æ˜¯ [-1e7, 1e7]ã€‚\n\n**è§£æ³•ä¸€**\n\nå‰ç¼€å’Œ + hashè¡¨\n\n```java\npublic int subarraySum(int[] nums, int k) {\n    HashMap<Integer,Integer> map = new HashMap<>();\n    map.put(0,1);//åˆå§‹åŒ–å¤´å“¨å…µ,é¿å…ä¸‹æ ‡è½¬æ¢\n    int sum=0,res=0;\n    for (int i=0;i<nums.length;i++) {\n        sum+=nums[i];\n        //-1 -1 1 | 0\n        if (/*sum>=k && */map.containsKey(sum-k)) {\n            res+=map.get(sum-k);\n        }\n        map.put(sum,map.getOrDefault(sum,0)+1);\n    }\n    return res;\n}\n```\næˆ‘ä»¬å°†å„ä¸ªä½ç½®çš„å‰ç¼€å’Œä½œä¸ºé”®ï¼Œè¿™ä¸ªå‰ç¼€å’Œåœ¨**å½“å‰ä½ç½®ä¹‹å‰å‡ºç°çš„æ¬¡æ•°ä½œä¸ºé”®** (è¿™ä¸€ç‚¹ä¿è¯äº†è¿ç»­ï¼Œä¸ä¼šæ‰¾åˆ°åé¢å»)\n\nç„¶åæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°å’Œä¸ºkåŒºé—´æœ‰å¤šå°‘ä¸ªï¼ŒåŒºé—´å’Œåˆ©ç”¨å‰ç¼€å’Œå¯ä»¥ç›´æ¥ç®—å‡ºï¼Œä¹Ÿå°±æ˜¯ \n\n`sum[i~j] = sum[j] -sum[i]= k` ç„¶åè¿™ä¸ªé—®é¢˜å°±å¯ä»¥è½¬æ¢ä¸ºï¼Œå½“æˆ‘ä»¬éå†åˆ°æŸä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨mapä¸­æŸ¥æ‰¾å‰ç¼€å’Œä¸º`sum[j] - k`çš„å…ƒç´ æœ‰å‡ ä¸ªï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°åŒºé—´å’Œä¸ºkçš„åŒºé—´æœ‰å¤šå°‘ä¸ªï¼\n\nå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªåˆå§‹çš„`sum=0`çš„å€¼ï¼Œé¿å…ä¸‹æ ‡çš„è½¬æ¢\n\nç”»ä¸ªå›¾å°±åƒä¸‹é¢è¿™æ ·ï¼š\n\n![img](http://static.imlgw.top/blog/20191104/ECiyYqso8i2K.png?imageslim)\n\n## [1248. ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€](https://leetcode-cn.com/problems/count-number-of-nice-subarrays/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° kã€‚\n\nå¦‚æœæŸä¸ªå­æ•°ç»„ä¸­æ°å¥½æœ‰ k ä¸ªå¥‡æ•°æ•°å­—ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸ªå­æ•°ç»„æ˜¯**ã€Œä¼˜ç¾å­æ•°ç»„ã€**ã€‚\n\nè¯·è¿”å›è¿™ä¸ªæ•°ç»„ä¸­ã€Œä¼˜ç¾å­æ•°ç»„ã€çš„æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [1,1,2,1,1], k = 3\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šåŒ…å« 3 ä¸ªå¥‡æ•°çš„å­æ•°ç»„æ˜¯ [1,1,2,1] å’Œ [1,2,1,1] ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [2,4,6], k = 1\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šæ•°åˆ—ä¸­ä¸åŒ…å«ä»»ä½•å¥‡æ•°ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä¼˜ç¾å­æ•°ç»„ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [2,2,2,1,2,2,1,2,2,2], k = 2\nè¾“å‡ºï¼š16\n```\n\n**æç¤ºï¼š**\n\n- `1 <= nums.length <= 50000`\n- `1 <= nums[i] <= 10^5`\n- `1 <= k <= nums.length`\n\n**è§£æ³•ä¸€**\n\n11.3 å‘¨èµ›ç¬¬äºŒé¢˜ï¼Œæ²¡åšå‡ºæ¥ï¼Œä»¥ä¸ºæ˜¯æ»‘åŠ¨çª—å£ï¼Œæ»‘äº†åŠå¤©æ²¡æ»‘å‡ºæ¥ï¼Œåæ¥çœ‹äº†è§£ç­”çŸ¥é“äº†æ˜¯åˆ©ç”¨å‰ç¼€å’Œ + Hashï¼Œå…¶å®å’Œä¸Šé¢ä¸€é¢˜æ˜¯ç±»ä¼¼çš„ï¼Œç›¸å½“äºä¸Šä¸€é¢˜çš„è¿›é˜¶\n\n```java\npublic int numberOfSubarrays(int[] nums, int k) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    int sum=0,res=0;\n    map.put(0,1);\n    for (int i=0;i<nums.length;i++) {\n        if (nums[i]%2==1) {\n            sum++;\n        }\n        //é¢˜ç›®è¯´äº†éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä¼˜åŒ–ä¸‹\n        if (sum>=k && map.containsKey(sum-k)) {\n            res+=map.get(sum-k);\n        }\n        map.put(sum,map.getOrDefault(sum,0)+1);\n    }\n    return res;\n}\n```\nå…¶å®è¿™é‡Œå°±æ˜¯æŠŠå¥‡æ•°éƒ½çœ‹ä½œ 1ï¼Œå¶æ•°éƒ½çœ‹ä½œ0ï¼Œè¿™æ ·é—®é¢˜å°±å˜æˆäº†æ±‚å’Œä¸ºkçš„åŒºé—´ä¸ªæ•°æœ‰å¤šå°‘ä¸ªï¼Œç„¶ååœ¨æ ¹æ®ä¸Šé¢çš„å‰ç¼€å’Œ+Hashè¡¨ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„å¾—åˆ°ç­”æ¡ˆï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯é¢˜ç›®è¯´äº†æ•°æ®éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥åœ¨åˆ¤æ–­çš„æ—¶å€™å¯ä»¥åŠ ä¸€ä¸ª`sum>=k` æ¥å‡å°‘ä¸€ç‚¹åˆ¤æ–­ï¼Œå½“ç„¶è¿™é¢˜é¢˜ç›®æŒ‡å®šäº†æ•°æ®çš„èŒƒå›´ï¼Œæ‰€ä»¥è¿˜å¯ä»¥ç›´æ¥ç”¨æ•°ç»„åšmapæ˜ å°„\n\n```java\n//update: 2020.4.21 ä¹‹å‰çš„æ•°ç»„å¼€å¤§äº†ï¼Œå¼€äº†10wã€‚ã€‚ã€‚\npublic int numberOfSubarrays(int[] nums, int k) {\n    int[] map=new int[50001];  \n    map[0]=1;\n    int sum=0;\n    int res=0;\n    for(int i=0;i<nums.length;i++){\n        sum+=nums[i]&1;\n        map[sum]++;\n        //sum-x=k\n        if(sum-k >=0 && map[sum-k]!=0){\n            res+=map[sum-k];\n        }\n    }\n    return res;\n}\n```\n\n> è¿™é¢˜è¿˜æœ‰å…¶ä»–çš„æ•°å­¦è§£æ³•ï¼Œæš‚æ—¶ä¸å¤ªæƒ³å†™ï¼Œåé¢æœ‰æ—¶é—´å†å†™å§ï¼Œå¤§è‡´æ€è·¯å°±æ˜¯\n>\n> [2ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œ2ï¼Œ2ï¼Œ2] res=3*4=12\n\n## [1371. æ¯ä¸ªå…ƒéŸ³åŒ…å«å¶æ•°æ¬¡çš„æœ€é•¿å­å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/find-the-longest-substring-containing-vowels-in-even-counts/)\n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² `s` ï¼Œè¯·ä½ è¿”å›æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æœ€é•¿å­å­—ç¬¦ä¸²çš„é•¿åº¦ï¼šæ¯ä¸ªå…ƒéŸ³å­—æ¯ï¼Œå³ 'a'ï¼Œ'e'ï¼Œ'i'ï¼Œ'o'ï¼Œ'u' ï¼Œåœ¨å­å­—ç¬¦ä¸²ä¸­éƒ½æ°å¥½å‡ºç°äº†å¶æ•°æ¬¡ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"eleetminicoworoep\"\nè¾“å‡ºï¼š13\nè§£é‡Šï¼šæœ€é•¿å­å­—ç¬¦ä¸²æ˜¯ \"leetminicowor\" ï¼Œå®ƒåŒ…å« eï¼Œiï¼Œo å„ 2 ä¸ªï¼Œä»¥åŠ 0 ä¸ª aï¼Œu ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"leetcodeisgreat\"\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šæœ€é•¿å­å­—ç¬¦ä¸²æ˜¯ \"leetc\" ï¼Œå…¶ä¸­åŒ…å« 2 ä¸ª e ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"bcbcbc\"\nè¾“å‡ºï¼š6\nè§£é‡Šï¼šè¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå­—ç¬¦ä¸² \"bcbcbc\" æœ¬èº«å°±æ˜¯æœ€é•¿çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„å…ƒéŸ³ aï¼Œeï¼Œiï¼Œoï¼Œu éƒ½å‡ºç°äº† 0 æ¬¡ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= s.length <= 5 x 10^5`\n- `s` åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜æŒºå¥½çš„ï¼Œåæ­£æˆ‘æ˜¯æƒ³ä¸å‡ºæ¥è¿™æ ·çš„è§£æ³•ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯æ»‘åŠ¨çª—å£ï¼Œå†™äº†å‡ è¡Œä»£ç å‘ç°è¡Œä¸é€šï¼Œæ•°æ®èŒƒå›´è¿™ä¹ˆå¤§ï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆç®€å•ï¼Œç„¶åå°±ç›´æ¥çœ‹ç­”æ¡ˆäº†ï¼Œæ¶‰åŠåˆ°**å‰ç¼€å’Œ**ä»¥åŠ**çŠ¶æ€å‹ç¼©**ï¼Œå‰ç¼€å’Œç»´æŠ¤å…ƒéŸ³å­—ç¬¦å‡ºç°çš„å¥‡å¶æ€§ï¼Œå¹¶å‹ç¼©æˆä¸€ä¸ªæ•´æ•°ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯`å¥‡æ•°-å¥‡æ•°=å¶æ•°`ï¼Œ`å¶æ•°-å¶æ•°=å¶æ•°`ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒä½ç½®çš„çŠ¶æ€ç›¸åŒï¼Œé‚£ä¹ˆä¸­é—´çš„éƒ¨åˆ†å‡ºç°æ¬¡æ•°ä¸€å®šæ˜¯å¶æ•°ï¼Œå…·ä½“çš„ä¸æƒ³å¤šè§£é‡Šäº†çœ‹çœ‹ [å®˜æ–¹é¢˜è§£](https://leetcode-cn.com/problems/find-the-longest-substring-containing-vowels-in-even-counts/solution/mei-ge-yuan-yin-bao-han-ou-shu-ci-de-zui-chang-z-2/) å°±è¡Œäº†\n\n```java\npublic int findTheLongestSubstring(String s) {\n    //a e i o u\n    //32ç§çŠ¶æ€\n    int[] pre=new int[1<<5];\n    Arrays.fill(pre,-1);\n    pre[0]=0;\n    int res=0;\n    int state=0;\n    for (int i=0;i<s.length();i++) {\n        if(s.charAt(i)=='a') state^=16;\n        if(s.charAt(i)=='e') state^=8;\n        if(s.charAt(i)=='i') state^=4;\n        if(s.charAt(i)=='o') state^=2;\n        if(s.charAt(i)=='u') state^=1;\n        if(pre[state]!=-1){\n            res=Math.max(res,i+1-pre[state]);\n        }else{\n            pre[state]=i+1; //å‰iä¸ªå­—ç¬¦çš„çŠ¶æ€\n        }\n    }\n    return res;\n}\n```\n\n## [974. å’Œå¯è¢« K æ•´é™¤çš„å­æ•°ç»„](https://leetcode-cn.com/problems/subarray-sums-divisible-by-k/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `A`ï¼Œè¿”å›å…¶ä¸­å…ƒç´ ä¹‹å’Œå¯è¢« `K` æ•´é™¤çš„ï¼ˆè¿ç»­ã€éç©ºï¼‰å­æ•°ç»„çš„æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼šA = [4,5,0,-2,-3,1], K = 5\nè¾“å‡ºï¼š7\nè§£é‡Šï¼š\næœ‰ 7 ä¸ªå­æ•°ç»„æ»¡è¶³å…¶å…ƒç´ ä¹‹å’Œå¯è¢« K = 5 æ•´é™¤ï¼š\n[4, 5, 0, -2, -3, 1], [5], [5, 0], [5, 0, -2, -3], [0], [0, -2, -3], [-2, -3]\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= A.length <= 30000`\n2. `-10000 <= A[i] <= 10000`\n3. `2 <= K <= 10000`\n\n**è§£æ³•ä¸€**\n\n```java\n//åŒä½™å®šä¹‰ (b-a)%k=0 => b%k==a%k\npublic int subarraysDivByK(int[] A, int K) {\n    int[] pre=new int[K];\n    int sum=0;\n    pre[sum]=1;\n    int res=0;\n    for(int a:A){\n        sum=(sum+a)%K;\n        //Javaè¢«é™¤æ•°ä¸ºè´Ÿæ•°çš„æ—¶å€™å–æ¨¡ä¹Ÿæ˜¯è´Ÿæ•°\n        //è¿™é‡Œåº”è¯¥çº æ­£ï¼Œé¿å…è´Ÿæ•°çš„æ¨¡\n        if(sum<0) sum+=K;\n        res+=pre[sum];\n        pre[sum]++;\n    }\n    return res;\n}\n```","tags":["LeetCode","æŸ¥æ‰¾"],"categories":["ç®—æ³•"]},{"title":"æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº(ä¸‰)","url":"/2019/09/05/shen-ru-li-jie-java-xu-ni-ji-san/","content":"\n> è¿™ä¸€ç¯‡ä¸»è¦è®°å½•JVMç›¸å…³çš„Classæ–‡ä»¶ç»“æ„\n\n## Classç±»æ–‡ä»¶çš„ç»“æ„\n\n Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥**8ä¸ªå­—èŠ‚**ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµï¼Œæ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒï¼ŒClassæ–‡ä»¶æ ¼å¼é‡‡ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ç§ä¼ªç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼š**æ— ç¬¦å·æ•°å’Œè¡¨** \n\n**æ— ç¬¦å·æ•°**\n\næ— ç¬¦å·æ•°å±äºåŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä»¥u1ï¼Œu2ï¼Œu4ï¼Œu8æ¥åˆ†åˆ«è¡¨ç¤º1ï¼Œ2ï¼Œ4ï¼Œ8ä¸ªå­—èŠ‚å¤§å°çš„æ— ç¬¦å·æ•°ï¼Œæ— ç¬¦å·æ•°ç”¨æ¥æè¿°æ•°å­—ï¼Œç´¢å¼•å¼•ç”¨ï¼Œæ•°é‡å€¼ï¼Œæˆ–è€…æŒ‰ç…§UTF-8ç¼–ç æ„æˆå­—ç¬¦ä¸²å€¼\n\n**è¡¨ï¼ˆæ•°ç»„ï¼‰**\n\nè¡¨æ˜¯ç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–è€…å…¶ä»–è¡¨ä½œä¸ºæ•°æ®é¡¹æ„æˆçš„ç¬¦åˆæ•°æ®ç±»å‹ï¼Œæ‰€æœ‰è¡¨éƒ½ä¹ æƒ¯æ€§çš„ä»¥`_info` ç»“å°¾ï¼Œè¡¨ç”¨äºæè¿°æœ‰ç¨‹æ± å…³ç³»çš„å¤åˆç»“æ„çš„æ•°æ®ï¼Œæ•´ä¸ªClassæ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ è¡¨\n\n### Classæ–‡ä»¶æ•´ä½“ç»“æ„\n\n```java\nClassFile{\n    u4                  magic(é­”æ•°0xCAFFBABE)\n    u2                  minor_version(æ¬¡ç‰ˆæœ¬å·)\n    u2                  major_version(ä¸»ç‰ˆæœ¬å·)\n    u2                  constant_pool_count(å¸¸é‡æ± ä¸ªæ•°)\n    cp_info             constant_pool(å¸¸é‡æ± è¡¨)\n    u2                  access_flags(ç±»æˆ–æ¥å£çš„è®¿é—®æƒé™)\n    u2                  this_class(ç±»å)\n    u2                  super_class(çˆ¶ç±»å)\n    u2                  interfaces_count(æ¥å£ä¸ªæ•°)\n    u2                  interfaces(æ¥å£å)\n    u2                  fields_count(å­—æ®µä¸ªæ•°)\n    field_info          fields(å­—æ®µè¡¨)\n    u2                  methods_count(æ–¹æ³•æ•°)\n    method_info         methods(æ–¹æ³•è¡¨)\n    u2                  attributes_count(é™„åŠ å±æ€§ä¸ªæ•°)\n    attribute_info      attributes(é™„åŠ å±æ€§è¡¨)\n}\n```\n\n> åœ¨ç½‘ä¸Šçœ‹äº†[å›½å¤–çš„å¤§ä½¬](https://www.infoq.cn/article/Secrets-of-the-Bytecode-Ninjas)çš„ä¸€å¼ å›¾ï¼ŒæŒºæœ‰æ„æ€çš„![mark](http://static.imlgw.top/blog/20190902/4JDgENgQ9eIo.png?imageslim)\n\n\n\n**é­”æ•°å’ŒClassæ–‡ä»¶çš„ç‰ˆæœ¬**\n\næ¯ä¸ªClassæ–‡ä»¶çš„**å¤´4ä¸ªå­—èŠ‚**ç§°ä¸ºé­”æ•°ï¼Œä»–å”¯ä¸€çš„ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥æ”¶çš„Classæ–‡ä»¶ï¼Œè¿™ä¸ªå€¼ä¸º`0xCAFFBABE` ï¼Œç´§è·Ÿç€é­”æ•°çš„**4ä¸ªå­—èŠ‚**å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œé«˜ç‰ˆæœ¬çš„JDKèƒ½å…¼å®¹ä½ç‰ˆæœ¬çš„å­—èŠ‚ç ï¼Œè€Œä½ç‰ˆæœ¬JVMçš„æ— æ³•å…¼å®¹é«˜ç‰ˆæœ¬çš„Classæ–‡ä»¶\n\n## å¸¸é‡æ± \n\nç´§è·Ÿç€ç‰ˆæœ¬å·ä¹‹åçš„å°±æ˜¯å¸¸é‡æ± å…¥å£ï¼Œä¸€ä¸ªJavaç±»ä¸­å®šä¹‰çš„å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯ç”±å¸¸é‡æ± æ¥ç»´æŠ¤å’Œæè¿°çš„ï¼Œå¯ä»¥å°†å¸¸é‡æ± çœ‹ä½œClassæ–‡ä»¶çš„èµ„æºä»“åº“ï¼Œæ¯”å¦‚è¯´Javaç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’Œå˜é‡ä¿¡æ¯ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œå¸¸é‡æ± ä¸­ä¸»è¦å­˜å‚¨çš„ä¸¤ç±»å¸¸é‡ï¼š\n\n- **å­—é¢é‡ï¼š** æ–‡æœ¬å­—ç¬¦ä¸²ï¼ŒJavaä¸­å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰\n- **ç¬¦å·å¼•ç”¨ï¼š**ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼Œå­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼Œæ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ç­‰\n\n> å…³äºç¬¦å·å¼•ç”¨ï¼Œå…¶å®åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰ä»‹ç»è¿‡ï¼ŒJavaä»£ç åœ¨ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸åƒC++/Cä¸€æ ·æœ‰è¿æ¥çš„æ­¥éª¤ï¼Œè€Œæ˜¯åœ¨è™šæ‹ŸæœºåŠ è½½Classæ–‡ä»¶çš„æ—¶å€™è¿›è¡Œ**åŠ¨æ€é“¾æ¥**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Classæ–‡ä»¶ä¸­ä¸ä¼šä¿å­˜å„ä¸ªæ–¹æ³•ï¼Œå­—æ®µçš„æœ€ç»ˆå†…å­˜å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤è¿™äº›å­—æ®µï¼Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ— æ³•ç›´æ¥è¢«è™šæ‹Ÿæœºä½¿ç”¨ï¼Œå½“è™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™ï¼Œéœ€è¦ä»å¸¸é‡æ± ä¸­è·å¾—å¯¹åº”å¾—ç¬¦å·å¼•ç”¨ï¼Œåœ¨ç±»åˆ›å»ºæˆ–è¿è¡Œå¾—æ—¶å€™è§£æï¼Œç¿»è¯‘åˆ°å…·ä½“çš„å†…å­˜åœ°å€ä¸­ã€‚\n\n### å¸¸é‡æ± é¡¹ç›®ç±»å‹\n\nå¸¸é‡æ± çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼ŒJDK1.7ä¹‹å‰ä¸€å…±æœ‰11ç§**ç»“æ„ä¸åŒ**çš„è¡¨ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„11ç§ï¼ŒJDK1.7ä¹‹åä¸ºäº†æ›´å¥½çš„æ”¯æŒåŠ¨æ€è¯­è¨€çš„è°ƒç”¨ï¼Œåˆé¢å¤–çš„å¢åŠ äº†3ç§ï¼ˆCONSTANT_MethodHandle_infoï¼ŒCONSTANT_MethodType_infoï¼ŒCONSTANT_InvokeDynamic_infoï¼‰è¿™äº›è¡¨ç»“æ„éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œ**è¡¨å¼€å§‹çš„ç¬¬ä¸€ä½éƒ½æ˜¯ä¸€ä¸ª`u1`ç±»å‹çš„æ ‡å¿—ä½`tag`ï¼Œç›®çš„å°±æ˜¯åŒºåˆ†è¿™ä¸ªå¸¸é‡å±äºé‚£ç§ç±»å‹çš„å¸¸é‡**ï¼Œåé¢çš„å†…å®¹éƒ½å„æœ‰å„çš„ç»“æ„ï¼Œ`index`ä»£è¡¨çš„æ˜¯å¸¸é‡æ± ä¸­çš„å¯¹åº”çš„å¸¸é‡ç´¢å¼•ï¼Œ`bytes`ä»£è¡¨çš„å°±æ˜¯å­—èŠ‚æ•°æ®\n\n### cp_info\n\n![å¸¸é‡æ± è¡¨ç»“æ„](http://static.imlgw.top/blog/20190829/vjjWxwvrt0qg.png)\n\nè¿™å¼ è¡¨ä¸Šçš„æ•°æ®ä¸ç”¨è®°ä½ï¼Œç”¨çš„æ—¶å€™çŸ¥é“å»å“ªé‡ŒæŸ¥å°±è¡Œäº†ï¼ˆè™½ç„¶ç”¨çš„æœºä¼šå¾ˆå°‘ğŸ˜‚ï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬ç¼–è¯‘ä¸€æ®µä»£ç ï¼Œçœ‹ä¸€ä¸‹å­—èŠ‚ç é•¿å•¥æ ·\n\n```java\npublic class Test1 {\n    \n    private int a=1;\n    \n    public int getA(){\n        return a;\n    }\n    public void setA(int a){\n        this.a=a;\n    }\n}\n```\n\nğŸ¯**ç¼–è¯‘å®Œæˆåç”¨16è¿›åˆ¶çš„ç¼–è¯‘å™¨(winHex)æ‰“å¼€Classæ–‡ä»¶**\n\n![mark](http://static.imlgw.top/blog/20190901/EOnrpm9sx8wE.png?imageslim)\n\nâš¡ è¿™é‡Œå‰é¢çš„4ä¸ªå­—èŠ‚`0xCAFEBABE` ä»£è¡¨çš„å°±æ˜¯é­”æ•°ï¼Œåé¢çš„4ä¸ªå­—èŠ‚`0x00000034`ä»£è¡¨çš„å°±æ˜¯ç‰ˆæœ¬å·ï¼Œå†å¾€å2ä¸ªå­—èŠ‚`0x0018`å°±æ˜¯å¸¸é‡æ± çš„å…¥å£ï¼Œå¯¹åº”çš„å°±æ˜¯å¸¸é‡æ± çš„å¤§å°ï¼ˆconstant_pool_countï¼‰ï¼Œè½¬æ¢ä¸º10è¿›åˆ¶å°±æ˜¯24ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸æ˜¯24ä¸ªï¼Œå¸¸é‡æ± è®¡æ•°æ˜¯ä»1è€Œä¸æ˜¯0å¼€å§‹çš„ï¼Œè®¾è®¡è€…å°†0ä½ç½®çš„é¡¹ç©ºå‡ºæ¥ç›®çš„æ˜¯ä¸ºäº†è¡¨ç¤ºåé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹è¡¨ç¤º**ä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®**ï¼ˆå¤§å¸ˆå°±æ˜¯å¤§å¸ˆï¼Œå„ç§ç»†èŠ‚éƒ½èƒ½è€ƒè™‘åˆ°ï¼‰\n\nâš¡ å†å¾€åçœ‹ï¼Œ`0x0A`ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„`tag`æ ‡å¿—ä½ï¼Œè½¬æ¢ä¸º10è¿›åˆ¶å°±æ˜¯`10` ï¼ŒæŸ¥ä¸€ä¸‹è¡¨å¯¹åº”çš„å¸¸é‡ç±»å‹æ˜¯`CONSTANT_Methodref_info`ï¼Œç´§è·Ÿç€çš„ä¸¤ä¸ªå­—èŠ‚`0x0004`æ˜¯ä¸€ä¸ª`index`ç±»å‹çš„æ•°æ®ï¼ŒæŒ‡å‘å£°æ˜æ–¹æ³•æè¿°ç¬¦`CONSTANT_Class_info` çš„ç´¢å¼•é¡¹ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± çš„ç¬¬4é¡¹ï¼Œå†å¾€åä¸¤ä¸ªå­—èŠ‚`0x0014`ä»£è¡¨çš„å°±æ˜¯æŒ‡å‘ç±»å‹æè¿°ç¬¦`CONSTANT_NameAndType`çš„ç´¢å¼•é¡¹ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± çš„ç¬¬20é¡¹\n\nè¿™é‡Œæˆ‘ä»¬å°±ä¸ä¸€ä¸€çš„å»åˆ†æäº†ï¼Œæˆ‘ä»¬å€ŸåŠ©`javap` æ¥çœ‹çœ‹åç¼–è¯‘çš„ç»“æœå’Œæˆ‘ä»¬åˆ†æçš„æ˜¯ä¸æ˜¯ä¸€è‡´çš„\n\n```java\nLast modified 2019-9-1; size 485 bytes\n  MD5 checksum e8148a01ff25087c42827d62a9b827b0\n  Compiled from \"Test1.java\"\npublic class jvmstudy.classfile_stu.Test1\n  minor version: 0\n  major version: 52\n  flags: ACC_PUBLIC, ACC_SUPER\nConstant pool:\n   #1 = Methodref          #4.#20         // java/lang/Object.\"<init>\":()V\n   #2 = Fieldref           #3.#21         // jvmstudy/classfile_stu/Test1.a:I\n   #3 = Class              #22            // jvmstudy/classfile_stu/Test1\n   #4 = Class              #23            // java/lang/Object\n   #5 = Utf8               a\n   #6 = Utf8               I\n   #7 = Utf8               <init>\n   #8 = Utf8               ()V\n   #9 = Utf8               Code\n  #10 = Utf8               LineNumberTable\n  #11 = Utf8               LocalVariableTable\n  #12 = Utf8               this\n  #13 = Utf8               Ljvmstudy/classfile_stu/Test1;\n  #14 = Utf8               getA\n  #15 = Utf8               ()I\n  #16 = Utf8               setA\n  #17 = Utf8               (I)V\n  #18 = Utf8               SourceFile\n  #19 = Utf8               Test1.java\n  #20 = NameAndType        #7:#8          // \"<init>\":()V\n  #21 = NameAndType        #5:#6          // a:I\n  #22 = Utf8               jvmstudy/classfile_stu/Test1\n  #23 = Utf8               java/lang/Object\n{\n  public jvmstudy.classfile_stu.Test1();\n    descriptor: ()V\n    flags: ACC_PUBLIC\n    Code:\n      stack=2, locals=1, args_size=1\n         0: aload_0\n         1: invokespecial #1                  // Method java/lang/Object.\"<init>\":()V\n         4: aload_0\n         5: iconst_1\n         6: putfield      #2                  // Field a:I\n         9: return\n      LineNumberTable:\n        line 7: 0\n        line 9: 4\n      LocalVariableTable:\n        Start  Length  Slot  Name   Signature\n            0      10     0  this   Ljvmstudy/classfile_stu/Test1;\n\n  public int getA();\n    descriptor: ()I\n    flags: ACC_PUBLIC\n    Code:\n      stack=1, locals=1, args_size=1\n         0: aload_0\n         1: getfield      #2                  // Field a:I\n         4: ireturn\n      LineNumberTable:\n        line 12: 0\n      LocalVariableTable:\n        Start  Length  Slot  Name   Signature\n            0       5     0  this   Ljvmstudy/classfile_stu/Test1;\n\n  public void setA(int);\n    descriptor: (I)V\n    flags: ACC_PUBLIC\n    Code:\n      stack=2, locals=2, args_size=2\n         0: aload_0\n         1: iload_1\n         2: putfield      #2                  // Field a:I\n         5: return\n      LineNumberTable:\n        line 16: 0\n        line 17: 5\n      LocalVariableTable:\n        Start  Length  Slot  Name   Signature\n            0       6     0  this   Ljvmstudy/classfile_stu/Test1;\n            0       6     1     a   I\n}\nSourceFile: \"Test1.java\"\n\n```\n\nå¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬åˆ†æç»“æœæ˜¯ä¸€è‡´çš„ï¼Œé‚£è¿™ä¸ª`Methodref`æ˜¯è¡¨ç¤ºçš„é‚£ä¸ªæ–¹æ³•å‘¢ï¼Ÿå…¶å®æ ¹æ®åç¼–è¯‘çš„ç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æˆ‘ä»¬é»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•\n\n## è®¿é—®æ ‡å¿—\n\n| æ ‡å¿—åç§°       | æ ‡å¿—å€¼   | å«ä¹‰                                                         |\n| -------------- | -------- | ------------------------------------------------------------ |\n| ACC_PUBLIC     | 0x00 01  | æ˜¯å¦ä¸ºPublicç±»å‹                                             |\n| ACC_FINAL      | 0x00 10  | æ˜¯å¦è¢«å£°æ˜ä¸ºfinalï¼Œåªæœ‰ç±»å¯ä»¥è®¾ç½®                            |\n| ACC_SUPER      | 0x00 20  | æ˜¯å¦å…è®¸ä½¿ç”¨invokespecialå­—èŠ‚ç æŒ‡ä»¤çš„æ–°è¯­ä¹‰ï¼jdk1.0.2ä¹‹åéƒ½ä¸ºçœŸ |\n| ACC_INTERFACE  | 0x02 00  | æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ¥å£                                             |\n| ACC_ABSTRACT   | 0x04 00  | æ˜¯å¦ä¸ºabstractç±»å‹ï¼Œå¯¹äºæ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥è¯´ï¼Œæ¬¡æ ‡å¿—å€¼ä¸ºçœŸï¼Œå…¶ä»–ç±»å‹ä¸ºå‡ |\n| ACC_SYNTHETIC  | 0x10 00  | æ ‡å¿—è¿™ä¸ªç±»å¹¶éç”±ç”¨æˆ·ä»£ç äº§ç”Ÿ                                 |\n| ACC_ANNOTATION | 0x20 00  | æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ³¨è§£                                             |\n| ACC_ENUM       | ï¼x40 00 | æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæšä¸¾                                             |\n\nåœ¨å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„**ä¸¤ä¸ªå­—èŠ‚**ä»£è¡¨è®¿é—®æ ‡å¿—ï¼ˆ`access_flags`ï¼‰ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ç±»æˆ–æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ªClassæ˜¯æ¥å£è¿˜æ˜¯æ–¹æ³•?æ˜¯å¦å®šä¹‰ä¸ºpublicç±»å‹ï¼Ÿæ˜¯å¦å®šä¹‰ä¸ºabstractï¼Ÿç­‰ï¼Œä¸¤ä¸ªå­—èŠ‚16ä¸ªæ ‡å¿—ä½ï¼Œå¯ä»¥è¡¨ç¤º2^16ç§çŠ¶æ€ï¼Œä½†æ˜¯å½“å‰åªå®šä¹‰äº†8ä¸ªæ ‡å¿—ä½æ²¡æœ‰ä½¿ç”¨åˆ°çš„ä¸€å¾‹è¦æ±‚ä¸º0\n\nè¿˜æ˜¯å‚è€ƒä¸Šé¢çš„å­—èŠ‚ç ï¼Œå¸¸é‡æ± æ˜¯å›¾ä¸­ä»`0A~74` çš„ç´«è‰²éƒ¨åˆ†ï¼Œç´§è·Ÿç€åé¢çš„ä¸¤ä¸ªå­—èŠ‚`0x0021`å¯¹åº”çš„å°±æ˜¯è®¿é—®æ ‡å¿—ä½ï¼Œä¹Ÿå°±æ˜¯ `ACC_PUBLIC | ACC_SUPER` çš„å€¼\n\n## ç±»ç´¢å¼•ï¼Œçˆ¶ç±»ç´¢å¼•æ¥å£ç´¢å¼•é›†åˆ\n\nç±»ç´¢å¼•(`this_class`)å’Œçˆ¶ç±»ç´¢å¼•(`super_class`)éƒ½æ˜¯ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼Œè€Œæ¥å£ç´¢å¼•é›†åˆ(`interfaces`)æ˜¯ä¸€ç»„`u2` ç±»å‹çš„**æ•°æ®çš„é›†åˆ**ï¼ŒClassæ–‡ä»¶ä¸­ç”±è¿™ä¸‰é¡¹æ•°æ®æ¥è¡¨ç¤ºè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»\n\nç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œçˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåï¼Œç”±äºJavaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Objectå¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º0ã€‚æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰implementsè¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯extendsè¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚\n\nç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥æ—¥ç´¢å¼•é›†åˆéƒ½æŒ‰é¡ºåºæ’åˆ—åœ¨è®¿é—®æ ‡å¿—ä¹‹åï¼Œç±»ç´¢å¼•å’Œçˆ¶ç±»ç´¢å¼•ç”¨ä¸¤ä¸ªu2ç±»å‹çš„ç´¢å¼•å€¼è¡¨ç¤ºï¼Œå®ƒä»¬å„è‡ªæŒ‡å‘ä¸€ä¸ªç±»å‹ä¸º`CONSTANT_Class_info`çš„ç±»æè¿°ç¬¦å¸¸é‡ï¼Œé€šè¿‡`CONSTANT_Class_info`ç±»å‹çš„å¸¸é‡ä¸­çš„ç´¢å¼•å€¼ä»¥æ‰¾åˆ°å®šä¹‰åœ¨`CONSTANT_Utf8_info`ç±»å‹çš„å¸¸é‡ä¸­çš„å…¨é™å®šåå­—ç¬¦ä¸²\n\næˆ‘ä»¬æ¥ç€ä¸Šé¢çš„å­—èŠ‚ç æ–‡ä»¶åˆ†æï¼Œç´§æ¥ç€è®¿é—®æ ‡å¿—ç¬¦åé¢çš„u2æ˜¯`0x0003` ä¹Ÿå°±æ˜¯`this_class`åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•ï¼Œå†å¾€åçš„`0x0004`å¯¹åº”çš„å°±æ˜¯`super_class`åœ¨å¸¸é‡æ± çš„ç´¢å¼•`0x0000` è¯´æ˜æ²¡æœ‰çˆ¶æ¥å£ï¼Œåé¢çš„é›†åˆä¹Ÿå°±æ²¡æœ‰äº†\n\n```java\nConstant pool:\n   #1 = Methodref          #4.#20         // java/lang/Object.\"<init>\":()V\n   #2 = Fieldref           #3.#21         // jvmstudy/classfile_stu/Test1.a:I\n   #3 = Class              #22            // jvmstudy/classfile_stu/Test1\n   #4 = Class              #23            // java/lang/Object\n   #5 = Utf8               a\n   #6 = Utf8               I\n   #7 = Utf8               <init>\n   #8 = Utf8               ()V\n   #9 = Utf8               Code\n  #10 = Utf8               LineNumberTable\n  #11 = Utf8               LocalVariableTable\n  #12 = Utf8               this\n  #13 = Utf8               Ljvmstudy/classfile_stu/Test1;\n  #14 = Utf8               getA\n  #15 = Utf8               ()I\n  #16 = Utf8               setA\n  #17 = Utf8               (I)V\n  #18 = Utf8               SourceFile\n  #19 = Utf8               Test1.java\n  #20 = NameAndType        #7:#8          // \"<init>\":()V\n  #21 = NameAndType        #5:#6          // a:I\n  #22 = Utf8               jvmstudy/classfile_stu/Test1\n  #23 = Utf8               java/lang/Object\n```\n\nç»“åˆåç¼–è¯‘çš„ç»“æœï¼Œå¸¸é‡æ± ç¬¬ä¸‰é¡¹å’Œç¬¬å››é¡¹éƒ½å¯¹åº”äº†ä¸€ä¸ª`CONSTANT_Class_info`çš„ç´¢å¼•å¸¸é‡ï¼Œå…¶æœ€ç»ˆæŒ‡å‘äº†ä¸€ä¸ª`CONSTANT_Utf8_info` çš„å¸¸é‡ï¼Œè¿™ä¸ªå¸¸é‡çš„å€¼å°±æ˜¯æˆ‘ä»¬çš„`this_class`å’Œ`super_class` çš„å…¨é™å®šå\n\n## å­—æ®µè¡¨é›†åˆ\n\nç´§è·Ÿç€ä¸Šé¢ç±»ç´¢å¼•ç­‰ä¿¡æ¯åé¢çš„`u2`ç±»å‹çš„æ•°æ®`0x0001`å°±æ˜¯ä»£è¡¨çš„`fields_count`ï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ªå­—æ®µaæ‰€ä»¥è¿™é‡Œæ˜¯`1`\n\n### field_info\n\nå­—æ®µè¡¨ï¼ˆ`field_info`ï¼‰ç”¨äºæè¿°æ¥å£æˆ–è€…ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚å­—æ®µï¼ˆ`field`ï¼‰åŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬åœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡\n\nå­—æ®µçš„å„ç§ä¿®é¥°ç¬¦å…¶å®éƒ½æ˜¯ä¸ªå¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰è¦ä¹ˆæ²¡æœ‰ï¼Œæ‰€ä»¥å¾ˆå¥½è¡¨ç¤ºé€‚åˆç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºï¼Œä½†æ˜¯å­—æ®µçš„ç±»å‹ï¼Œåå­—è¿™äº›å°±å¾ˆéš¾å›ºå®š\n\n| ç±»å‹           | åç§°             | æ•°é‡             |\n| -------------- | ---------------- | ---------------- |\n| u2             | access_flags     | 1                |\n| u2             | name_index       | 1                |\n| u2             | descriptor_index | 1                |\n| u2             | attributes_count | 1                |\n| attribute_info | attributes       | attributes_count |\n\nå‰ä¸‰é¡¹åˆ†åˆ«ä»£è¡¨ï¼Œè®¿é—®ä¿®é¥°ç¬¦ï¼Œåå­—çš„ç´¢å¼•ä»¥åŠ_æè¿°ç¬¦_ï¼ˆ**å¯¹å­—æ®µæ¥è¯´å°±æ˜¯å­—æ®µçš„ç±»å‹**ï¼‰çš„ç´¢å¼•ï¼Œè¿™ä¸‰é¡¹å°±å¯ä»¥æ„æˆä¸€ä¸ªå­—æ®µçš„å®Œæ•´çš„ä¿¡æ¯äº†ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹çœ‹çš„ä¹Ÿæ˜¯å‰ä¸‰é¡¹çš„ä¿¡æ¯ï¼Œå­—æ®µä¿®é¥°ç¬¦`access_flags`å…¶å®å’Œç±»ä¸­çš„`access_flags` ç±»ä¼¼ï¼Œåªä¸è¿‡å¯ä»¥è®¾ç½®çš„ä¿®é¥°ç¬¦ä¸å¤ªä¸€æ ·\n\n**å­—æ®µè®¿é—®æ ‡å¿—**\n\n| æ ‡å¿—åç§°      | æ ‡å¿—å€¼ | å«ä¹‰                       |\n| ------------- | ------ | -------------------------- |\n| ACC_PUBLIC    | 0x0001 | å­—æ®µæ˜¯å¦public             |\n| ACC_PRIVATE   | 0x0002 | å­—æ®µæ˜¯å¦private            |\n| ACC_PROTECTED | 0x0004 | å­—æ®µæ˜¯å¦protected          |\n| ACC_STATIC    | 0x0008 | å­—æ®µæ˜¯å¦static             |\n| ACC_FINAL     | 0x0010 | å­—æ®µæ˜¯å¦final              |\n| ACC_VOLATILE  | 0x0040 | å­—æ®µæ˜¯å¦volatile           |\n| ACC_TRANSIENT | 0x0080 | å­—æ®µæ˜¯å¦transient          |\n| ACC_SYNTHETIC | 0x1000 | å­—æ®µæ˜¯å¦ç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿçš„ |\n| ACC_ENUM      | 0x4000 | å­—æ®µæ˜¯å¦enum               |\n\nğŸ¯**ç»§ç»­æ¥ç€ä¸Šé¢çš„ç±»ç´¢å¼•åˆ†æ**\n\n![mark](http://static.imlgw.top/blog/20190902/s5dWhYXNIuxq.png?imageslim)\n\nâš¡`0x0001` å¯¹åº”`fields_count`ï¼Œå€¼ä¸º1å­—æ®µçš„æ•°é‡ä¸º 1ï¼Œåé¢çš„`field_info`æ•°é‡ä¸º1\n\nâš¡`0x0002` å¯¹åº”å­—æ®µçš„`access_flags`ï¼Œä¸º`ACC_PRIVATE`\n\nâš¡`0x0005` å¯¹åº”å­—æ®µçš„åå­—çš„ç´¢å¼•ï¼Œåœ¨å¸¸é‡æ± ä¸­çš„ç¬¬5é¡¹ï¼Œç»“åˆä¸Šé¢åç¼–è¯‘çš„ç»“æœç¬¬5é¡¹ä¸º  `#5 = Utf8    a`\n\nâš¡`0x0006` å¯¹åº”å­—æ®µçš„æè¿°ç¬¦ç´¢å¼•ï¼Œåœ¨å¸¸é‡æ± ä¸­ç¬¬6é¡¹ï¼Œä¸º`#6 = Utf8   I`\n\nåˆ°è¿™é‡Œå…¶å®æˆ‘ä»¬å°±å¯ä»¥æ¨æ–­å‡ºè¿™ä¸ªå˜é‡çš„å®šä¹‰ä¸º `private int a`\n\n> å­—æ®µè¡¨é›†åˆä¸­ä¸ä¼šåˆ—å‡ºä»è¶…ç±»æˆ–è€…çˆ¶æ¥å£ä¸­ç»§æ‰¿è€Œæ¥çš„å­—æ®µï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šåˆ—å‡ºåŸæœ¬Javaä»£ç ä¸­æ²¡æœ‰çš„å­—æ®µï¼Œæ¯”å¦‚å†…éƒ¨ç±»ä¸­è‡ªåŠ¨æ·»åŠ æŒ‡å‘å¤–éƒ¨ç±»çš„å­—æ®µã€‚ä»æ‰€å‘¨çŸ¥ï¼Œåœ¨**Java**ä¸­å­—æ®µæ˜¯ä¸èƒ½é‡è½½çš„ï¼Œåªè¦ä¸¤ä¸ªå­—æ®µçš„åå­—æ˜¯ä¸èƒ½ä¸€æ ·çš„ï¼Œå¿…é¡»ä½¿ç”¨ä¸åŒçš„åç§°ï¼Œæ³¨æ„ï¼Œè¿™æ˜¯**Javaçš„è¯­è¨€è§„èŒƒ**ï¼Œå…¶å®åœ¨Classå­—èŠ‚ç æ¥è®²ï¼Œåªè¦ä¸¤ä¸ªå­—æ®µçš„æè¿°ç¬¦ä¸ä¸€æ ·ï¼Œé‡åå°±æ˜¯åˆæ³•çš„ã€‚\n\nå†å¾€åä¸¤ä¸ªå­—èŠ‚`0x0000`ä»£è¡¨`attributes_count`ï¼Œå…¶å€¼ä¸º0æ‰€ä»¥åé¢çš„å±æ€§è¡¨å°±æ²¡æœ‰äº†ï¼Œå¦‚æœè¿™é‡Œå°†å­—æ®µæ”¹ä¸º`static final int a` é‚£ä¹ˆ`attributes_count` å°†ä¸º1ï¼Œåé¢ä¼šå¤šå‡ºä¸€æ¡æŒ‡å‘å¸¸é‡æ± `ConstantValue`æ•°æ®çš„index(ä¸‹æ–‡ä¼šæ¼”ç¤º)\n\n## æ–¹æ³•è¡¨é›†åˆ\n\nç´§è·Ÿç€å­—æ®µè¡¨ä¹‹åçš„u2ç±»å‹çš„æ•°æ® `0x0003`ä»£è¡¨çš„å°±æ˜¯`method_count` ï¼Œå€¼ä¸º3ä»£è¡¨æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œé¢åŒ…å«äº†JVMè‡ªåŠ¨ç”Ÿæˆçš„é»˜è®¤æ— å‚æ•°æ„é€ å™¨æ–¹æ³•ï¼Œæ‰€ä»¥æ˜¯3ä¸ª\n\n### method_info\n\næ–¹æ³•è¡¨çš„ç»“æ„å…¶å®å’Œå­—æ®µè¡¨çš„ç»“æ„æ˜¯ä¸€æ ·çš„\n\n| ç±»å‹           | åç§°             | æ•°é‡             |\n| -------------- | ---------------- | ---------------- |\n| u2             | access_flags     | 1                |\n| u2             | name_index       | 1                |\n| u2             | descriptor_index | 1                |\n| u2             | attributes_count | 1                |\n| attribute_info | attributes       | attributes_count |\n\nä½†æ˜¯å…·ä½“çš„`access_flags` å’Œ`attributes`é›†åˆä¸å¤ªä¸€æ ·\n\n**æ–¹æ³•è®¿é—®æ ‡å¿—**\n\n| æ ‡å¿—åç§°          | æ ‡å¿—å€¼  | å«ä¹‰                             |\n| ----------------- | ------- | -------------------------------- |\n| ACC_PUBLIC        | 0x00 01 | æ–¹æ³•æ˜¯å¦ä¸ºpublic                 |\n| ACC_PRIVATE       | 0x00 02 | æ–¹æ³•æ˜¯å¦ä¸ºprivate                |\n| ACC_PROTECTED     | 0x00 04 | æ–¹æ³•æ˜¯å¦ä¸ºprotected              |\n| ACC_STATIC        | 0x00 08 | æ–¹æ³•æ˜¯å¦ä¸ºstatic                 |\n| ACC_FINAL         | 0x00 10 | æ–¹æ³•æ˜¯å¦ä¸ºfinal                  |\n| ACC_SYHCHRONRIZED | 0x00 20 | æ–¹æ³•æ˜¯å¦ä¸ºsynchronized           |\n| ACC_BRIDGE        | 0x00 40 | æ–¹æ³•æ˜¯å¦æ˜¯ç”±ç¼–è¯‘å™¨äº§ç”Ÿçš„æ¡¥æ¥æ–¹æ³• |\n| ACC_VARARGS       | 0x00 80 | æ–¹æ³•æ˜¯å¦æ¥å—å‚æ•°                 |\n| ACC_NATIVE        | 0x01 00 | æ–¹æ³•æ˜¯å¦ä¸ºnative                 |\n| ACC_ABSTRACT      | 0x04 00 | æ–¹æ³•æ˜¯å¦ä¸ºabstract               |\n| ACC_STRICTFP      | 0x08 00 | æ–¹æ³•æ˜¯å¦ä¸ºstrictfp               |\n| ACC_SYNTHETIC     | 0x10 00 | æ–¹æ³•æ˜¯å¦æ˜¯æœ‰ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿçš„     |\n\nğŸ¯**æˆ‘ä»¬ç»§ç»­æ¥ç€ä¸Šé¢çš„å­—æ®µè¡¨åé¢åˆ†æ**\n\n![mark](http://static.imlgw.top/blog/20190902/BuNVfOyD3mJy.png?imageslim)\n\nâš¡`0x0003` æ–¹æ³•è¡¨çš„å…¥å£ï¼Œä»£è¡¨`methods_count` æ–¹æ³•çš„æ•°é‡ï¼Œå€¼ä¸º3ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼ˆåŒ…æ‹¬äº†ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„`<init>`æ–¹æ³•ï¼‰\n\nâš¡ `0x0001` ç¬¬ä¸€ä¸ªæ–¹æ³•çš„è®¿é—®æ ‡å¿—å€¼ï¼Œä»£è¡¨`ACC_PUBLIC`\n\nâš¡ `0x0007` æ–¹æ³•åçš„`name_index`ï¼Œå€¼ä¸º7ä»£è¡¨å¸¸é‡æ± ä¸­ç¬¬7é¡¹å¸¸é‡ï¼Œç»“åˆåç¼–è¯‘çš„ç»“æœå…¶å€¼ä¸º\n\n`#7 = Utf8  <init>`  ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å®ä¾‹æ„é€ æ–¹æ³•ï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆçš„ï¼‰\n\nâš¡ `0x0008` æ–¹æ³•æè¿°ç¬¦çš„`descriptor_index` ï¼Œå€¼ä¸º8ä»£è¡¨å¸¸é‡æ± ä¸­ç¬¬8é¡¹å¸¸é‡ï¼Œå…¶å€¼ä¸º\n\n`#8 = Utf8  ()V`  è‡ªåŠ¨ç”Ÿæˆçš„æ— å‚æ„é€ å™¨çš„æè¿°\n\nâš¡ `0x0001` æ–¹æ³•å±æ€§è¡¨(`attribute_info`)çš„å…¥å£ï¼Œä»£è¡¨`attributes_count` ï¼Œå€¼ä¸º1ä»£è¡¨æœ‰ä¸€ä¸ªå±æ€§è¡¨\n\nâš¡ `0x0009` å±æ€§åç§°çš„ç´¢å¼•ï¼Œå¸¸é‡æ± ä¸­ä¸º `#9 = Utf8   Code`è¯´æ˜æ­¤å±æ€§æ˜¯æ–¹æ³•çš„å­—èŠ‚ç æè¿°ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•ä¸­çš„ä»£ç \n\n> åœ¨æ–¹æ³•è¡¨ä¸­ï¼Œå¦‚æœå­ç±»æ²¡æœ‰é‡å†™çˆ¶ç±»çš„æ–¹æ³•å°±ä¸ä¼šå‡ºç°çˆ¶ç±»çš„æ–¹æ³•ä¿¡æ¯ï¼Œä½†æ˜¯ä¼šå‡ºç°ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ çš„æ–¹æ³•ï¼Œæœ€å…¸å‹çš„å°±æ˜¯`<clinit>`å’Œ`<init>`ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ é™æ€å˜é‡çš„èµ‹å€¼å’Œé™æ€è¯­å¥å—æ‰€ä»¥å¹¶æ²¡æœ‰ç”Ÿæˆ`<clinit>` æ–¹æ³•ï¼Œå¦å¤–ä¸€ç‚¹å’Œä¸Šé¢å­—æ®µè¡¨çš„ä¸€æ ·ï¼ŒJavaè¯­è¨€ä¸­é‡è½½æ˜¯ä¸èƒ½ä»¥è¿”å›å€¼æ¥ç•Œå®šçš„ï¼Œä½†æ˜¯åœ¨Classæ–‡ä»¶æ ¼å¼ä¸­ï¼Œåªè¦æè¿°ç¬¦ä¸ä¸€è‡´ï¼Œå°±æ˜¯å¯ä»¥å…±å­˜çš„ï¼Œè€Œæ–¹æ³•çš„æè¿°ç¬¦å°±åŒ…æ‹¬äº†å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼\n\n## å±æ€§è¡¨é›†åˆ\n\nå±æ€§è¡¨ï¼ˆattribute_infoï¼‰ï¼ŒClassæ–‡ä»¶ï¼Œå­—æ®µè¡¨ï¼Œæ–¹æ³•è¡¨ä¸­å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨ï¼Œè¯´æœ‰attribute_infoçš„å‰ä¸¤é¡¹éƒ½æ˜¯u2ç±»å‹çš„`attribute_name_index`å’Œu4ç±»å‹çš„`attribute_length`åˆ†åˆ«ä»£è¡¨å±æ€§åå­—çš„ç´¢å¼•å’Œå±æ€§å€¼çš„å¤§å° ï¼ŒJavaè™šæ‹Ÿæœºä¸­é¢„å®šä¹‰äº†ä¸€äº›å±æ€§ï¼Œè¿™äº›å±æ€§éƒ½å„æœ‰å„çš„å«ä¹‰å’Œç»“æ„\n\n| å±æ€§åç§°                             | ä½¿ç”¨ä½ç½®           | å«ä¹‰                                                         |\n| :----------------------------------- | ------------------ | :----------------------------------------------------------- |\n| Code                                 | æ–¹æ³•è¡¨             | Java ä»£ç ç¼–è¯‘æˆçš„å­—èŠ‚ç æŒ‡ä»¤                                  |\n| ConstantValue                        | å­—æ®µè¡¨             | final å…³é”®å­—å®šä¹‰çš„å¸¸é‡å€¼                                     |\n| Deprecated                           | ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ | è¢«å£°æ˜ä¸º `deprecated` çš„æ–¹æ³•å’Œå­—æ®µ                           |\n| Exceptions                           | æ–¹æ³•è¡¨             | æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸                                               |\n| EnclosingMethod                      | ç±»æ–‡ä»¶             | ä»…å½“ä¸€ä¸ªç±»ä¸ºå±€éƒ¨ç±»æˆ–åŒ¿åç±»æ—¶æ‰èƒ½æ‹¥æœ‰è¿™ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨äºæ ‡è¯†è¿™ä¸ªç±»æ‰€åœ¨çš„å¤–å›´æ–¹æ³• |\n| InnerClasses                         | ç±»æ–‡ä»¶             | å†…éƒ¨ç±»åˆ—è¡¨                                                   |\n| LineNumberTable                      | Code å±æ€§          | Java æºç çš„è¡Œå·ä¸å­—èŠ‚ç æŒ‡ä»¤çš„å¯¹åº”å…³ç³»                        |\n| LocalVariableTable                   | Code å±æ€§          | æ–¹æ³•çš„å±€éƒ¨å˜é‡æè¿°                                           |\n| StackMapTable                        | Code å±æ€§          | JDK 6 æ–°å¢çš„å±æ€§ï¼Œä¾›æ–°çš„ç±»å‹æ£€æŸ¥éªŒè¯å™¨ï¼ˆType Checkerï¼‰æ£€æŸ¥å’Œå¤„ç†ç›®æ ‡æ–¹æ³•çš„å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æ ˆæ‰€éœ€è¦çš„ç±»å‹æ˜¯å¦åŒ¹é… |\n| Signature                            | ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ | JDK 5 æ–°å¢çš„å±æ€§ï¼Œç”¨äºæ”¯æŒæ³›å‹æƒ…å†µä¸‹çš„æ–¹æ³•ç­¾åï¼Œåœ¨ Java è¯­è¨€ä¸­ï¼Œä»»ä½•ç±»ã€æ¥å£ã€åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ï¼ˆType Variablesï¼‰æˆ–å‚æ•°åŒ–ç±»å‹ï¼ˆParameterized Typesï¼‰ï¼Œåˆ™ Signature å±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯ã€‚ç”±äº Java çš„æ³›å‹é‡‡ç”¨æ“¦é™¤æ³•å®ç°ï¼Œåœ¨ä¸ºäº†é¿å…ç±»å‹ä¿¡æ¯è¢«æ“¦é™¤åå¯¼è‡´ç­¾åæ··ä¹±ï¼Œéœ€è¦è¿™ä¸ªå±æ€§è®°å½•æ³›å‹ä¸­çš„ç›¸å…³ä¿¡æ¯ |\n| SourceFile                           | ç±»æ–‡ä»¶             | è®°å½•æºæ–‡ä»¶åç§°                                               |\n| SourceDebugExtension                 | ç±»æ–‡ä»¶             | JDK 6 æ–°å¢å±æ€§ï¼Œç”¨äºå­˜å‚¨é¢å¤–çš„è°ƒè¯•ä¿¡æ¯ã€‚è­¬å¦‚åœ¨è¿›è¡Œ JSP æ–‡ä»¶è°ƒè¯•æ—¶ï¼Œæ— æ³•é€šè¿‡ Java å †æ ˆæ¥å®šä½åˆ° JSP æ–‡ä»¶çš„è¡Œå·ï¼ŒJSR-45 è§„èŒƒä¸ºè¿™äº›é Java è¯­è¨€ç¼–å†™ï¼Œå´éœ€è¦ç¼–è¯‘æˆå­—èŠ‚ç å¹¶è¿è¡Œåœ¨ Java è™šæ‹Ÿæœºä¸­çš„ç¨‹åºæä¾›äº†ä¸€ä¸ªè¿›è¡Œè°ƒè¯•çš„æ ‡å‡†æœºåˆ¶ï¼Œä½¿ç”¨è¯¥å±æ€§å°±å¯ä»¥å­˜å‚¨è¿™ä¸ªæ ‡å‡†æ‰€æ–°åŠ å…¥çš„è°ƒè¯•ä¿¡æ¯ |\n| Synthetic                            | ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ | è¡¨ç¤ºæ–¹æ³•æˆ–å­—æ®µæ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„                           |\n| LocalVariableTypeTable               | ç±»                 | JDK 5 æ–°å¢å±æ€§ï¼Œå®ƒä½¿ç”¨ç‰¹å¾ç­¾åä»£æ›¿æè¿°ç¬¦ï¼Œä¸ºäº†å¼•å…¥æ³›å‹è¯­æ³•ä¹‹åèƒ½æè¿°æ³›å‹å‚æ•°åŒ–ç±»å‹è€Œæ·»åŠ  |\n| RuntimeVisibleAnnotations            | ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ | JDK 5 æ–°å¢å±æ€§ï¼Œä¸ºåŠ¨æ€æ³¨è§£æä¾›æ”¯æŒã€‚è¯¥å±æ€§æŒ‡æ˜å“ªäº›æ³¨è§£æ˜¯è¿è¡Œæ—¶ï¼ˆå®é™…ä¸Šè¿è¡Œæ—¶å°±æ˜¯è¿›è¡Œåå°„è°ƒç”¨ï¼‰å¯è§çš„ |\n| RuntimeInvisibleAnnotations          | ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨ | JDK 5 æ–°å¢å±æ€§ï¼Œä¸ `RuntimeVisibleAnnotations` ä½œç”¨ç›¸åï¼Œç”¨äºæŒ‡æ˜å“ªäº›æ³¨è§£è¿è¡Œæ—¶ä¸å¯è§ |\n| RuntimeVisibleParameterAnnotations   | æ–¹æ³•è¡¨             | JDK 5 æ–°å¢å±æ€§ï¼Œä½œç”¨ä¸ `RuntimeVisibleAnnotations` ä½œç”¨ç›¸ä¼¼ï¼Œåªä¸è¿‡ä½œç”¨å¯¹è±¡ä¸ºæ–¹æ³•å‚æ•° |\n| RuntimeInvisibleParameterAnnotations | æ–¹æ³•è¡¨             | JDK 5 æ–°å¢å±æ€§ï¼Œä½œç”¨ä¸ `RuntimeInvisibleAnnotations` ä½œç”¨ç›¸ä¼¼ï¼Œåªä¸è¿‡ä½œç”¨å¯¹è±¡ä¸ºæ–¹æ³•å‚æ•° |\n| AnnotationDefault                    | æ–¹æ³•è¡¨             | JDK 5 æ–°å¢å±æ€§ï¼Œç”¨äºè®°å½•æ³¨è§£ç±»å…ƒç´ çš„é»˜è®¤å€¼                   |\n| BootstrapMethods                     | ç±»æ–‡ä»¶             | JDK 7 æ–°å¢å±æ€§ï¼Œç”¨äºå­˜å‚¨ `invokedynamic` æŒ‡ä»¤å¼•ç”¨çš„å¼•å¯¼æ–¹æ³•é™å®šç¬¦ |\n\n### Codeå±æ€§\n\nJavaç¨‹åºæ–¹æ³•ä½“ä¸­çš„ä»£ç ç»è¿‡Javacç¼–è¯‘å™¨å¤„ç†è¿‡åï¼Œæœ€ç»ˆå˜ä¸ºå­—èŠ‚ç æŒ‡ä»¤å­˜å‚¨åœ¨Codeå±æ€§å†…\n\nCodeå±æ€§å‡ºç°åœ¨**æ–¹æ³•è¡¨çš„å±æ€§é›†åˆ**ä¸­ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰çš„æ–¹æ³•è¡¨éƒ½å¿…é¡»å­˜åœ¨è¿™ä¸ªCodeå±æ€§ï¼Œ**åƒæ¥å£å’ŒæŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å°±ä¸å­˜åœ¨Codeå±æ€§**\n\n**Codeå±æ€§ç»“æ„**\n\n| ç±»å‹            | åç§°                   | æ•°é‡                   |\n| --------------- | ---------------------- | ---------------------- |\n| u2              | attribute_name_index   | 1                      |\n| u4              | attribute_length       | 1                      |\n| u2              | max_stack              | 1                      |\n| u2              | max_locals             | 1                      |\n| u4              | code_length            | 1                      |\n| u1              | code                   | code_length            |\n| u2              | exception_table_length | 1                      |\n| exception_info  | exception_table        | exception_table_length |\n| u2              | attributes_count       | 1                      |\n| attributes_info | attributes             | attributes_count       |\n\nğŸ¯**ç´§æ¥ç€ä¸Šé¢çš„æ–¹æ³•è¡¨åˆ†æ**\n\n_è¿™é‡Œåˆ†æçš„è¿˜æ˜¯æ–¹æ³•è¡¨ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼ˆ`<init>`ï¼‰æ‰€æºå¸¦çš„å±æ€§è¡¨_\n\n![mark](http://static.imlgw.top/blog/20190904/Gd5cWl6Yr84x.png?imageslim)\n\nâš¡ `0x0009` å¯¹åº”`attribute_name_index`ï¼Œå±æ€§åç§°çš„ç´¢å¼•ï¼Œå¸¸é‡æ± ä¸­ä¸º `#9 = Utf8   Code`è¯´æ˜æ­¤å±æ€§æ˜¯æ–¹æ³•çš„å­—èŠ‚ç æè¿°ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•ä¸­çš„ä»£ç \n\nâš¡ `0x00000038` ä»£è¡¨`attribute_length` é¡¾åæ€ä¹‰å°±æ˜¯å±æ€§å€¼çš„é•¿åº¦ï¼Œè¿™é‡Œæ˜¯56ï¼ˆä¸åŒ…å«attribute_name_indexå’Œattribute_lengthï¼‰\n\nâš¡`0x0002`ä»£è¡¨`max_stack` æ“ä½œæ•°æ ˆï¼ˆOperand Stacksï¼‰æ·±åº¦çš„æœ€å¤§å€¼ï¼Œè™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™ä¼šæ ¹æ®è¿™ä¸ªå€¼æ¥åˆ†é…æ ˆå¸§ï¼ˆStackFrameï¼‰ä¸­çš„æ“ä½œæ ˆæ·±åº¦\n\nâš¡`0x0001`ä»£è¡¨`max_locals` ä»£è¡¨äº†**å±€éƒ¨å˜é‡è¡¨**æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ï¼Œè¿™é‡Œçš„å†…å­˜åˆ†é…å•ä½æ˜¯`Slot`\n\n> `Slot`æ˜¯è™šæ‹Ÿæœºä¸ºå±€éƒ¨å˜é‡åˆ†é…å†…å­˜æ‰€ä½¿ç”¨çš„æœ€å°å•ä½ï¼Œå¯¹äºbyteï¼Œcharï¼Œfloatï¼Œintï¼Œshortï¼Œbooleanç­‰é•¿åº¦ä¸è¶…è¿‡32ä½çš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸ªå±€éƒ¨å˜é‡å ç”¨ä¸€ä¸ª`Slot` ï¼Œä½†æ˜¯å¯¹äºdoubleå’Œlongç­‰64ä½çš„æ•°æ®ç±»å‹åˆ™éœ€è¦ä¸¤ä¸ª`Slot` \n>\n> æ–¹æ³•å‚æ•°ï¼ˆåŒ…æ‹¬å®ä¾‹æ–¹æ³•ä¸­çš„thiså¼•ç”¨ï¼‰ï¼Œtrycatchè¯­å¥ä¸­catchä¸­å®šä¹‰çš„å¼‚å¸¸ï¼Œæ–¹æ³•ä½“ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ éƒ½éœ€è¦ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨æ¥å­˜æ”¾ï¼Œä½†æ˜¯æœ€åå¹¶ä¸æ˜¯æŠŠæ‰€æœ‰è¿™äº›å±€éƒ¨å˜é‡å ç”¨çš„`Slot`åŠ èµ·æ¥å°±æ˜¯`max_locals` å› ä¸º**å±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotæ˜¯å¯ä»¥å¤ç”¨çš„**ï¼Œå½“ä»£ç æ‰§è¡Œè¶…è¿‡ä¸€ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæ—¶ï¼Œè¿™ä¸ªå˜é‡å ç”¨çš„Slotå°±å¯ä»¥è¢«å…¶ä»–å±€éƒ¨å˜é‡æ‰€ä½¿ç”¨ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šæ ¹æ®ä½œç”¨åŸŸæ¥åˆ†é…`Slot` ç»™å„ä¸ªå±€éƒ¨å˜é‡ä½¿ç”¨\n\nâš¡`0x0000000A`u4ç±»å‹çš„`code_length` ä»£è¡¨çš„å°±æ˜¯å­—èŠ‚ç çš„é•¿åº¦ï¼Œè¿™é‡Œæ˜¯10ï¼Œè¯´æ˜åé¢æœ‰10ä¸ªå­—èŠ‚é•¿åº¦çš„å­—èŠ‚ç æŒ‡ä»¤æµ\n\nâš¡u1ç±»å‹çš„`code` å°±æ˜¯å…·ä½“ç”¨å­—èŠ‚ç æŒ‡ä»¤ï¼Œæ¯ä¸ªæŒ‡ä»¤éƒ½æ˜¯ä¸€ä¸ªu1çš„å•å­—èŠ‚æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šæœ‰256ä¸ªæŒ‡ä»¤ï¼Œç›®å‰Javaè™šæ‹Ÿæœºå·²ç»å®šä¹‰äº†å…¶ä¸­çº¦200æ¡ç¼–ç å€¼å¯¹åº”çš„æŒ‡ä»¤ï¼Œè¿™é‡Œæœ‰è¿ç»­çš„10ä¸ªå•å­—èŠ‚æŒ‡ä»¤ï¼Œæ„æˆäº†`<init>`æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤\n\nâš¡`0x0000`ä»£è¡¨`exception_table_length` å¼‚å¸¸è¡¨çš„é•¿åº¦ï¼Œè¿™é‡Œ`<init>`æ–¹æ³•æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºæ‰€ä»¥ä¸º0\n\nâš¡ `exception_info`ç±»å‹çš„`exception_table` å¼‚å¸¸è¡¨ï¼Œå­˜æ”¾å¤„ç†å¼‚å¸¸çš„ä¿¡æ¯ï¼ˆtry-catchä¸­çš„å¼‚å¸¸ï¼‰ï¼Œå‰é¢çš„é•¿åº¦ä¸º0æ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨è¿™ä¸€é¡¹æ•°æ®\n\n**å¼‚å¸¸è¡¨ç»“æ„**\n\n| ç±»å‹ | åç§°       | æ•°é‡ |\n| ---- | ---------- | ---- |\n| u2   | start_pc   | 1    |\n| u2   | end_pc     | 1    |\n| u2   | handler_pc | 1    |\n| u2   | catch_type | 1    |\n\næ¯ä¸ªexception_tableè¡¨é¡¹ç”±start_pcï¼Œend_pcï¼Œhandler_pcï¼Œcatch_typeï¼ˆæŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Class_infoç±»å‹çš„å¸¸é‡ï¼‰ç»„æˆ\n\nå½“å­—èŠ‚ç åœ¨start_pcåˆ°end_pcä¹‹é—´å‡ºç°äº†ç±»å‹ä¸ºcatch_typeæˆ–è€…å…¶å­ç±»çš„å¼‚å¸¸ï¼Œå°±è½¬åˆ°handler_pcè¡Œç»§ç»­æ‰§è¡Œï¼Œå½“catch_typeä¸º0æ—¶è¡¨ç¤ºå¤„ç†æ‰€æœ‰çš„å¼‚å¸¸\n\nâš¡`0x0002` ä»£è¡¨`attributes_count` æ˜¯`Code` å±æ€§è¡¨çš„**é™„åŠ å±æ€§**çš„å…¥å£ï¼ˆä¸€å±‚å¥—ä¸€å±‚å•ŠğŸ˜‚ï¼‰ï¼Œå€¼ä¸º2æ„å‘³ç€é™„åŠ å±æ€§è¡¨çš„æ•°é‡ä¸º2\n\n### LineNumberTableå±æ€§\n\nè¿™ä¸ªå°±æ˜¯ä¸Šé¢**`<init>`æ–¹æ³•Codeå±æ€§é™„åŠ çš„ç¬¬ä¸€ä¸ªå±æ€§**ï¼Œè¿™ä¸ªå±æ€§ç”¨äºæè¿°Javaæºä»£ç è¡Œå·å’Œå­—èŠ‚ç è¡Œå·ï¼ˆåç§»é‡ï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä»–å¹¶ä¸æ˜¯è¿è¡Œçš„å¿…é¡»å±æ€§ï¼Œä½†æ˜¯é»˜è®¤ä¼šç”Ÿæˆåˆ°Classæ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨`-g:none`æˆ–`-g:lines`å–æ¶ˆç”Ÿæˆè¿™ä¸ªå±æ€§ï¼Œå–æ¶ˆä¹‹åç¨‹åºæŠ›å¼‚å¸¸çš„æ—¶å€™ä¸ä¼šæ˜¾ç¤ºå‡ºé”™çš„è¡Œå·ï¼Œå¹¶ä¸”åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œä¹Ÿæ— æ³•æŒ‰ç…§æºç è¡Œæ¥è®¾ç½®æ–­ç‚¹ï¼Œå…¶ç»“æ„å¦‚ä¸‹è¡¨\n\n| ç±»å‹             | åç§°                     | æ•°é‡                     |\n| ---------------- | ------------------------ | ------------------------ |\n| u2               | attribute_name_index     | 1                        |\n| u4               | attribute_length         | 1                        |\n| u2               | line_number_table_length | 1                        |\n| line_number_info | line_number_table        | line_number_table_length |\n\nğŸ¯**æˆ‘ä»¬å†æ¥ç€ä¸Šé¢çš„Codeå±æ€§çš„å±æ€§è¡¨åˆ†æï¼Œçœ‹çœ‹Codeçš„å±æ€§è¡¨æ˜¯å•¥**\n\n![mark](http://static.imlgw.top/blog/20190904/O7MuBcPXNPKT.png?imageslim)\n\nâš¡`0x000A` attributes_infoçš„ç¬¬ä¸€é¡¹ï¼Œå¯¹åº”çš„æ˜¯atttibuteçš„åå­—çš„ç´¢å¼•ï¼Œå¸¸é‡æ± ä¸­å¯¹åº”ç¬¬10é¡¹çš„ç´¢å¼•æ˜¯ \n\n `#10 = Utf8   LineNumberTable` è¯´æ˜è¿™ä¸ªå±æ€§æ˜¯LineNumberTableå±æ€§ï¼Œç„¶åæ ¹æ®ä¸Šé¢ç»™å‡ºçš„è¡¨æ ¼ç»§ç»­åˆ†æ\n\nâš¡`0x0000000A` å¯¹åº”attribute_lengthï¼Œè¯´æ˜è¯¥å±æ€§å€¼é•¿åº¦ä¸º10\n\nâš¡`0x0002`å¯¹åº”line_number_table_lengthï¼Œè¯´æ˜æœ‰ä¸¤å¤„å¯¹åº”å…³ç³»\n\nâš¡ åé¢ç´§è·Ÿçš„å­—èŠ‚å°±å¯¹åº”çš„`line_number_table` è¯¥å±æ€§åˆæœ‰ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä¸º`start_pc`å’Œ`line_number`ä¸¤ä¸ªu2ç±»å‹çš„æ•°æ®é¡¹ï¼Œå‰è€…æ˜¯å­—èŠ‚ç è¡Œå·ï¼Œåè€…æ˜¯æºç è¡Œå·ï¼Œå‰é¢line_number_table_lengthä¸º2ï¼Œæ‰€ä»¥è¿™é‡Œåé¢æœ‰ä¸¤ä¸ªline_number_table\n\n### LocalVariableTableå±æ€§\n\nè¿™ä¸ªå°±æ˜¯ä¸Šé¢**`<init>` æ–¹æ³•Codeå±æ€§é™„åŠ çš„ç¬¬äºŒä¸ªå±æ€§**ï¼Œè¿™ä¸ªå±æ€§ä¸»è¦ç”¨äºæè¿°**æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨**ä¸­çš„å˜é‡å’ŒJavaæºä»£ç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œæ²¡æœ‰è¿™é¡¹å±æ€§å½“åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨è¯¥æ–¹æ³•çš„æ—¶å€™å…³äºå‚æ•°çš„åç§°éƒ½ä¼šä¸¢å¤±ï¼Œæœ€å…¸å‹çš„å°±æ˜¯IDEä¸­æœ‰æ—¶å€™åç¼–è¯‘ä¸€äº›æ¡†æ¶çš„ä»£ç å°±ä¼šçœ‹è§ä¸€äº›æ–¹æ³•å‚æ•°ä»€ä¹ˆçš„éƒ½æ˜¯arg0ï¼Œarg1ä»€ä¹ˆçš„\n\n**LocalVariableTableå±æ€§ç»“æ„**\n\n| ç±»å‹                | åç§°                        | æ•°é‡                        |\n| ------------------- | --------------------------- | --------------------------- |\n| u2                  | attribute_name_index        | 1                           |\n| u4                  | attribute_length            | 1                           |\n| u2                  | local_variable_table_length | 1                           |\n| local_variable_info | local_variable_table        | local_variable_table_length |\n\nğŸ¯ **æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„LineNumberTableå±æ€§åˆ†æ`LocalVariableTable`**\n\n![mark](http://static.imlgw.top/blog/20190905/TafXz1oMkG4d.png?imageslim)\n\nâš¡`0x000B`å’Œä¹‹å‰æ‰€æœ‰çš„attributes_infoä¸€æ ·ï¼Œè¿™ä¸ªç¬¬ä¸€é¡¹ä»£è¡¨è¯¥å±æ€§çš„åå­—åœ¨å¸¸é‡æ± çš„ç´¢å¼•å€¼ï¼Œè¿™é‡Œå¯¹åº”å¸¸é‡æ± ç¬¬11é¡¹ `#11 = Utf8   LocalVariableTable` \n\nâš¡`0x0000000C` å¯¹åº”attribute_lengthï¼Œè¯´æ˜è¯¥å±æ€§å€¼é•¿åº¦ä¸º12\n\nâš¡`0x0001`å¯¹åº”local_variable_table_lengthï¼Œå€¼ä¸º1è¯´æ˜åªæœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡\n\n> å…¶å®åˆ°ç°åœ¨æˆ‘ä»¬åˆ†æçš„å±æ€§è¡¨éƒ½è¿˜æ˜¯åœ¨åˆ†æè¿™ä¸ªç±»çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼ŒJVMè‡ªåŠ¨ç”Ÿæˆçš„`<init>`æ–¹æ³•æ‰€å¯¹åº”çš„å±æ€§è¡¨ï¼Œè€Œè¿™ä¸ª`<init>`å¾ˆæ˜æ˜¾æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œæ˜¯ä¸€ä¸ªæ— å‚çš„ç©ºæ„é€ å™¨ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™é‡Œçš„å±€éƒ¨å˜é‡æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯0ï¼Ÿ\n>\n> å…¶å®è¿™å¾ˆå¥½è§£é‡Šï¼Œå¹³å¸¸ç¼–ç çš„æ—¶å€™å¤§å®¶è‚¯å®šéƒ½ä½¿ç”¨è¿‡`this` è¿™ä¸ªå…³é”®å­—ï¼Œé€šè¿‡è¿™ä¸ªå…³é”®å­—å¯ä»¥åœ¨å®ä¾‹æ–¹æ³•ä¸­æ‹¿åˆ°å½“å‰çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ª1ä»£è¡¨å…¶å®å°±æ˜¯è¿™ä¸ª`this`ï¼Œåœ¨Javacç¼–è¯‘çš„æ—¶å€™ä¼šå°†å¯¹thisçš„è®¿é—®è½¬æ¢ä¸ºå¯¹ä¸€ä¸ªæ–¹æ³•å‚æ•°çš„è®¿é—®ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å‚æ•°ä¼šåœ¨è¿è¡Œè¿™ä¸ªå®ä¾‹æ–¹æ³•çš„æ—¶å€™ç”±JVMè‡ªåŠ¨çš„ä¼ å…¥ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ä¸­è‡³å°‘ä¼šå­˜åœ¨ä¸€ä¸ªæŒ‡å‘å½“å‰å®ä¾‹çš„å±€éƒ¨å˜é‡\n\næˆ‘ä»¬ç»§ç»­åˆ†æåé¢çš„`local_variable_info` \n\n**local_variable_infoå±æ€§ç»“æ„**\n\n| ç±»å‹ | åç§°             | æ•°é‡ |\n| ---- | ---------------- | ---- |\n| u2   | start_pc         | 1    |\n| u2   | length           | 1    |\n| u2   | name_index       | 1    |\n| u2   | descriptor_index | 1    |\n| u2   | index            | 1    |\n\nâš¡`0x0000` ä»£è¡¨`start_pc`ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹çš„å­—èŠ‚ç åç§»é‡\n\nâš¡`0x000A`ä»£è¡¨`length`ä»£è¡¨è¿™ä¸ªå±€éƒ¨å˜é‡å…¶ä½œç”¨èŒƒå›´è¦†ç›–çš„é•¿åº¦\n\nâš¡`0x000C`ä»£è¡¨`name_index` æ˜¯è¿™ä¸ªå±€éƒ¨å˜é‡çš„åå­—ç´¢å¼•ï¼ŒæŒ‡å‘å¸¸é‡æ± ä¸­ç¬¬12é¡¹å¸¸é‡ `#12 = Utf8   this`ç¬¦åˆæˆ‘ä»¬å‰é¢çš„åˆ†æ\n\nâš¡`0x000D`ä»£è¡¨`decriptor_index` å±€éƒ¨å˜é‡æè¿°ç¬¦ï¼ˆå¯¹å˜é‡æ¥è¯´å°±æ˜¯å˜é‡çš„ç±»å‹ï¼‰çš„ç´¢å¼•ï¼ŒæŒ‡å‘å¸¸é‡æ± ç¬¬13é¡¹å¸¸é‡\n\n`#13 = Utf8    Ljvmstudy/classfile_stu/Test1;` å½“å‰å®ä¾‹å¯¹è±¡çš„**å…¨é™å®šå**\n\nâš¡`0x0000` å¯¹åº”`index` ä»£è¡¨è¿™ä¸ªå±€éƒ¨å˜é‡åœ¨**æ ˆå¸§å±€éƒ¨å˜é‡è¡¨**ä¸­Slotçš„ä½ç½®\n\n> _**â³ åˆ°è¿™é‡Œæˆ‘ä»¬çš„æ–¹æ³•è¡¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•`<init>`çš„Codeå±æ€§å°±ç»“æŸäº†ï¼Œç”±äº`<init>`æ–¹æ³•ä¸åŒ…å«å…¶ä»–çš„å±æ€§æ‰€ä»¥`<init>`æ–¹æ³•åœ¨å­—èŠ‚ç ä¸­ä¹Ÿå·²ç»ç»“æŸäº†**_ï¼Œåé¢çš„æ–¹æ³•å°±ä¸å†é€ä¸ªå­—èŠ‚çš„åˆ†æäº†ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦çš„æ˜¯è¦ææ¸…æ¥šè¿™äº›å±æ€§çš„å±‚çº§å’ŒåŒ…å«å…³ç³»ï¼Œä¸è¦ææ··äº†\n\n### Exceptionså±æ€§\n\n`Exceptions` å±æ€§å’Œä¸Šé¢Codeå±æ€§æ˜¯å¹³çº§çš„ï¼Œå’ŒCodeå±æ€§é™„å¸¦çš„`exception_table`å¹¶ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œä¸è¦ææ··äº†ï¼ŒExceptionså±æ€§çš„ä½œç”¨æ˜¯åˆ—ä¸¾å‡ºæ–¹æ³•ä¸­å¯èƒ½æŠ›å‡ºçš„å—æ£€æŸ¥å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•æè¿°æ—¶åœ¨`throws`å…³é”®å­—åé¢åˆ—ä¸¾çš„å¼‚å¸¸ï¼Œç»“æ„å¦‚ä¸‹\n\n| ç±»å‹ | åç§°                  | æ•°é‡                 |\n| ---- | --------------------- | -------------------- |\n| u2   | attribute_name_index  | 1                    |\n| u4   | attribute_length      | 1                    |\n| u2   | number_of_exceptions  | 1                    |\n| u2   | exception_index_table | number_of_exceptions |\n\n`number_of_exceptions`è¡¨ç¤ºå¯èƒ½æŠ›å‡ºå¤šå°‘ç§å—æ£€æŸ¥å¼‚å¸¸ï¼Œæ¯ç§å¼‚å¸¸éƒ½æ˜¯ä¸€ä¸ª`exception_index_table` å¾ˆæ˜æ˜¾è¿™ä¸ªæ˜¯ä¸€ä¸ªç´¢å¼•ï¼ŒæŒ‡å‘å¸¸é‡æ± ä¸­å¯¹åº”çš„Exceptionçš„æè¿°ç¬¦\n\nè¿™é‡Œæˆ‘ä»¬çš„`<init>` æ–¹æ³•å¹¶æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥è¿™ä¸€é¡¹å±æ€§å¹¶ä¸å­˜åœ¨ï¼Œé‚£æˆ‘ä»¬æ‰¾ä¸€ä¸ªæœ‰å¼‚å¸¸çš„æ¥çœ‹çœ‹\n\n```java\npublic class Test2 {\n\n    private static int bbbb = 99;\n\n    private final static int aaaa = 99;\n\n    private List<Integer> list=null;\n\n    public Test2(int a) {\n        bbbb = a;\n    }\n\n    public int inc() throws ArithmeticException{\n        int x;\n        try {\n            x=1;\n            return  x;\n        }catch (Exception e){\n            x=2;\n            return x;\n        }finally {\n            x=3;\n        }\n    }\n\n    @Deprecated\n    public void deprecatedMethod(){\n\n    }\n}\n```\n\n![mark](http://static.imlgw.top/blog/20190905/uG5AQrVoHphH.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°`exception_table` é‡Œé¢è®°å½•äº†è¿™ä¸ªæ–¹æ³•çš„å¼‚å¸¸å¤„ç†è¡¨ï¼Œä¹Ÿå°±æ˜¯`try-catch`é‡Œé¢çš„å¼‚å¸¸å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯Javaä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äº†å¼‚å¸¸å¤„ç†è¡¨å»å¤„ç†å¼‚å¸¸å’Œfinallyæœºåˆ¶ï¼Œåœ¨jdk1.4ä¹‹å‰ä½¿ç”¨çš„æ˜¯ç®€å•çš„è·³è½¬æŒ‡ä»¤æ¥å®ç°ï¼Œè€ŒExceptionså±æ€§å’ŒCodeå¹³çº§ï¼Œåªæ˜¯åˆ—ä¸¾äº†ä¸€äº›å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸\n\n```java\nExceptions:\n  throws java.lang.ArithmeticException\n```\n## SourceFileå±æ€§\n\nè¿™ä¸ªå±æ€§æ˜¯å±äºClassæ–‡ä»¶çš„å±æ€§ï¼Œå¾ˆæ˜æ˜¾æ˜¯ç”¨æ¥è®°å½•ç”Ÿæˆè¿™ä¸ªClassæ–‡ä»¶çš„æºä»£ç åç§°ï¼Œå…¶å€¼æŒ‡å‘ä¸€ä¸ªCONSTANT_Utf8_infoçš„ç´¢å¼•ï¼Œå€¼å°±æ˜¯æºæ–‡ä»¶çš„åå­—\n\n## ConstantValueå±æ€§\n\nè¿™ä¸ªå±æ€§åœ¨å‰ä¸€ç¯‡ [ç±»åŠ è½½å™¨](http://imlgw.top/2019/08/17/shen-ru-li-jie-java-xu-ni-ji-er/#%E5%87%86%E5%A4%87) ä¸­æåˆ°è¿‡ï¼Œ `ConstantValue`å±æ€§çš„ä½œç”¨æ˜¯é€šçŸ¥è™šæ‹Ÿæœºè‡ªåŠ¨ä¸ºé™æ€å˜é‡èµ‹å€¼ï¼Œåªæœ‰è¢«staticå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼ˆç±»å˜é‡ï¼‰å¯ä»¥ä½¿ç”¨è¿™é¡¹å±æ€§\n\nå¦‚æœ**åŒæ—¶ä½¿ç”¨finalå’Œstaticæ¥ä¿®é¥°ä¸€ä¸ªå˜é‡**ï¼Œå¹¶ä¸”è¿™ä¸ªå˜é‡çš„æ•°æ®ç±»å‹æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…`java.lang.String`çš„è¯ï¼Œå°±ç”Ÿæˆ`ConstantValue`å±æ€§ï¼Œç”¨äºåœ¨**å‡†å¤‡é˜¶æ®µ**ç»™å˜é‡èµ‹åˆå§‹å€¼ï¼Œå¦‚æœè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«finalä¿®é¥°æˆ–è€…å¹¶éåŸºæœ¬ç±»å‹åŠå­—ç¬¦ä¸²ï¼Œåˆ™åœ¨å‡†å¤‡é˜¶æ®µä¼šè¢«åˆå§‹åŒ–ä¸ºé»˜è®¤çš„é›¶å€¼ï¼Œåœ¨`<clinit>`æ–¹æ³•ä¸­è¿›è¡ŒçœŸæ­£çš„åˆå§‹åŒ–\n\n**ä¾ç„¶æ˜¯ä¸Šé¢Exceptionsçš„Demo**\n\n![mark](http://static.imlgw.top/blog/20190905/U8zwbs2c0n8a.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°`aaaa` è¿™ä¸ªå¸¸é‡å­—æ®µé™„å¸¦äº† `ConstantValue` å±æ€§å…¶å€¼å°±æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­99çš„ä¸€ä¸ªç´¢å¼•\n\n> ğŸ¯ åé¢è¿˜æœ‰ä¸€äº›å±æ€§å°±ä¸å†è¯¦ç»†ä»‹ç»äº†\n>\n> Signatureç”¨æ¥è®°å½•æ³›å‹çš„ä¿¡æ¯ï¼ŒStackMapTableç”¨æ¥éªŒè¯å­—èŠ‚ç ï¼ŒBootstarapMethodsç”¨æ¥ä¿å­˜åŠ¨æ€è°ƒç”¨çš„å¼•å¯¼æ–¹æ³•é™å®šç¬¦ï¼ŒDeprecatedå’ŒSyntheticä¸¤ä¸ªbooleanå±æ€§......\n\n## Synchnorizedå­—èŠ‚ç åˆ†æ\n\n**synchnorized**å…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°æ–¹æ³•ä½“ï¼Œæˆ–è€…æ–¹æ³•ä½“å†…çš„ä»£ç å—ï¼Œä¿®é¥°æ–¹æ³•ä½“çš„æ—¶å€™åŒæ­¥æ˜¯éšå¼çš„ï¼Œæ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›ä¸­ï¼Œä¸ºäº†çœ‹åˆ°å­—èŠ‚ç çš„å˜åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸è®¨è®ºè¿™ç§ï¼ˆä¸¤ç§æ–¹å¼çš„åº•å±‚å®ç°å…¶å®è¿˜æ˜¯ä¸€æ ·çš„ï¼‰\n\n```java\npublic class Test4 {\n    public static Integer a = 0;\n\n    public void setA(int x) {\n        synchronized (this) {\n            a = x;\n        }\n    }\n}\n```\n\nç¼–è¯‘ååˆ©ç”¨å·¥å…·æŸ¥çœ‹setAæ–¹æ³•å†…ç”Ÿæˆçš„å­—èŠ‚ç æŒ‡ä»¤ï¼ˆçœç•¥äº†æ¬¡è¦çš„ä¸€äº›ä¿¡æ¯ï¼‰\n\n```java\n0: aload_0           //å¯¹è±¡å¼•ç”¨thiså…¥æ ˆ\n1: dup\t             //å¤åˆ¶æ ˆé¡¶å…ƒç´ (this)\n2: astore_2          //å°†æ ˆé¡¶å…ƒç´ (this)å­˜å…¥å±€éƒ¨å˜é‡è¡¨Slotç´¢å¼•ä¸º2çš„ä½ç½®\n3: monitorenter      //ä»¥æ ˆé¡¶å…ƒç´ (this)ä¸ºé”è¿›å…¥åŒæ­¥å—\n4: iload_1\t         //å±€éƒ¨å˜é‡Slot 1ä½ç½®çš„å…ƒç´ (x)å…¥æ ˆ\n5: invokestatic  #2  // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;\n8: putstatic     #3  // Field a:Ljava/lang/Integer; ç”¨xç»™aèµ‹å€¼\n11: aload_2          //å±€éƒ¨å˜é‡è¡¨Slot 2å…ƒç´ (this)å…¥æ ˆ\n12: monitorexit      //é€€å‡ºåŒæ­¥\n13: goto          21 //è·³è½¬åˆ°21è¡Œç»“æŸ\n16: astore_3         //åˆ°è¿™é‡Œè¯´æ˜å¼‚å¸¸äº†ï¼Œå°†æ ˆé¡¶å…ƒç´ ï¼ˆå¼‚å¸¸å¯¹è±¡ï¼‰å­˜å…¥å±€éƒ¨å˜é‡è¡¨Slot 3ä½ç½®\n17: aload_2          //å±€éƒ¨å˜é‡è¡¨Slot 2å…ƒç´ (this)ä½ç½®å…¥æ ˆ\n18: monitorexit      //é€€å‡ºåŒæ­¥\n19: aload_3          //å±€éƒ¨å˜é‡è¡¨Slot 3ä½ç½®å…ƒç´ å…¥æ ˆ\n20: athrow           //æŠ›å‡ºå¼‚å¸¸\n21: return           //æ–¹æ³•æ­£å¸¸è¿”å›\nException table:\n    from    to  target type\n       4    13    16   any\n      16    19    16   any\n\n```\næœ€å¼€å§‹æ²¡æœ‰å­¦å­—èŠ‚ç çš„æ—¶å€™ä¸€ç›´å¾ˆçº³é—·ä¸ºå•¥æœ‰ä¸¤ä¸ª`monitorexit` ï¼Œç°åœ¨ç®—æ˜¯æ˜ç™½äº†ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯synchnorizedåœ¨æ–¹æ³•å¼‚å¸¸çš„æƒ…å†µä¸‹ä»ç„¶å¯ä»¥æ­£å¸¸çš„é‡Šæ”¾é”ï¼Œè€Œä¸è‡³äºå¯¼è‡´é”æ³„éœ²ï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒæ¨èä½¿ç”¨synchnorizedçš„åŸå› ä¹‹ä¸€\n\né€šè¿‡å­—èŠ‚ç å¯ä»¥çœ‹åˆ°ï¼Œç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬è‡ªåŠ¨çš„ç”Ÿæˆäº†ä¸€ä¸ªå¼‚å¸¸è¡¨ï¼Œä¹Ÿå°±æ˜¯å‰é¢Codeå±æ€§ä¸­æºå¸¦çš„exception_tableå±æ€§ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„ç¨‹åºæ®µå†…å‘ç”Ÿå¼‚å¸¸ï¼Œä¼šæŒ‰ç…§å¼‚å¸¸è¡¨æŒ‡å®šçš„targetè¿›è¡Œè·³è½¬ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¼šé‡Šæ”¾è¿™ä¸ªé”\n\n## æ€»ç»“ & å‚è€ƒ\n\nè¿™ä¸€éƒ¨åˆ†ä¸»è¦è®°å½•äº†Classå­—èŠ‚ç çš„æ–‡ä»¶ç»“æ„ç›¸å…³çš„å†…å®¹ï¼Œä¹Ÿç®—æ˜¯æ˜¯é€ä¸ªå­—èŠ‚çš„åˆ†æäº†ä¸€éï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤§çš„ï¼Œå¯¹JVMå¹³å°çš„ç†è§£åˆåŠ æ·±äº†ï¼Œå½“ç„¶è¿™ä¸€ç¯‡ä¹Ÿæ˜¯ç»™ä¸‹ä¸€ç¯‡**è™šæ‹ŸæœºèŠ‚ç çš„æ‰§è¡Œå¼•æ“**åšé“ºå«\n\n**_ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹â€”â€”å‘¨å¿—æ˜_**\n\n","tags":["Classç»“æ„","JVM"],"categories":["JVM"]},{"title":"LeetCodeåŠ¨æ€è§„åˆ’","url":"/2019/09/01/leetcode-dong-tai-gui-hua/","content":"\n## [70. çˆ¬æ¥¼æ¢¯](https://leetcode-cn.com/problems/climbing-stairs/)\n\nYou are climbing a stair case. It takes *n* steps to reach to the top.\n\nEach time you can either climb 1 or 2 steps. In how many distinct ways can you climb to the top?\n\n**Note:** Given *n* will be a positive integer.\n\n**Example 1:**\n\n```java\nInput: 2\nOutput: 2\nExplanation: There are two ways to climb to the top.\n\n1. 1 step + 1 step\n2. 2 steps\n```\n\n**Example 2:**\n\n```java\nInput: 3\nOutput: 3\nExplanation: There are three ways to climb to the top.\n\n1. 1 step + 1 step + 1 step\n2. 1 step + 2 steps\n3. 2 steps + 1 step\n```\n\n**è§£æ³•ä¸€**\n\næ²¡å•¥å¥½è¯´çš„ï¼Œå¯ä»¥è¯´æ˜¯æœ€ç»å…¸çš„dpé¢˜äº†\n\n```java\npublic static int climbStairsDp(int n){\n    int []dp=new int[n+1];\n    dp[0]=1;\n    dp[1]=1;\n    for (int i=2;i<=n;i++) {\n        dp[i]=dp[i-1]+dp[i-2];\n    }\n    return dp[n];\n}\n```\n\n## [198. æ‰“å®¶åŠ«èˆ](https://leetcode-cn.com/problems/house-robber/)\n\nä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚\n\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\n\n**Example 1:**\n\n```java\nInput: [1,2,3,1]\nOutput: 4\nExplanation: Rob house 1 (money = 1) and then rob house 3 (money = 3).\n             Total amount you can rob = 1 + 3 = 4.\n```\n\n**Example 2:**\n\n```java\nInput: [2,7,9,3,1]\nOutput: 12\nExplanation: Rob house 1 (money = 2), rob house 3 (money = 9) and rob house 5 (money = 1).\n             Total amount you can rob = 2 + 9 + 1 = 12.\n```\n\n**è§£æ³•ä¸€**\n\nç®€å•çš„dpé¢˜ï¼Œdpæ–¹ç¨‹å¾ˆå®¹æ˜“å¾—åˆ°ï¼Œ`dp[i]=max(dp[i-2]+nums[i],dp[i-1])` ï¼ˆ2020.3.22æ›´æ–°äº†ä»£ç ï¼‰\n\n```java\n//  Max[i]=max(nums[i-2]+nums[i],nums[i-1])\npublic int rob(int[] nums) {\n    if(nums==null || nums.length<=0) return 0;\n    int[] dp=new int[nums.length];\n    dp[0]=nums[0];\n    for(int i=1;i<nums.length;i++){\n        dp[i]=Math.max(i>=2?dp[i-2]+nums[i]:nums[i],dp[i-1]);\n    }\n    return dp[nums.length-1];\n}\n```\n\næ—¶é—´ç©ºé—´éƒ½æ˜¯O(N)ï¼Œéœ€è¦æ³¨æ„è¾¹ç•Œæ¡ä»¶\n\n**è§£æ³•äºŒ**\n\nç©ºé—´å¤æ‚åº¦çš„ä¼˜åŒ–\n\n```java\n// Max[i]=max(pre+nums[i],cur);  \npublic int rob(int[] nums) {\n    if(nums==null||nums.length<=0){\n        return 0;\n    }\n    int pre= 0; //å‰ä¸€å¤©\n    int cur= 0; //å½“å¤©ï¼Œå…¶å®å°±æ˜¯ä¸ºäº†ä¿å­˜å‰åä¸¤å¤©çš„dp[i]\n    for (int i=0;i<nums.length;i++) {\n        int temp=cur;\n        cur=Math.max(pre+nums[i],cur);\n        //å‘åèµ°\n        pre=temp;\n    }\n    return cur;\n}\n```\n\n## [213. æ‰“å®¶åŠ«èˆ II](https://leetcode-cn.com/problems/house-robber-ii/)\n\nä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ã€‚è¿™ä¸ªåœ°æ–¹æ‰€æœ‰çš„æˆ¿å±‹éƒ½**å›´æˆä¸€åœˆ**ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªæˆ¿å±‹å’Œæœ€åä¸€ä¸ªæˆ¿å±‹æ˜¯ç´§æŒ¨ç€çš„ã€‚åŒæ—¶ï¼Œç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚\n\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\n\nç¤ºä¾‹ 1:\n\n```java\nè¾“å…¥: [2,3,2]\nè¾“å‡º: 3\nè§£é‡Š: ä½ ä¸èƒ½å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰, å› ä¸ºä»–ä»¬æ˜¯ç›¸é‚»çš„ã€‚\n```\n\nç¤ºä¾‹ 2:\n\n```java\nè¾“å…¥: [1,2,3,1]\nè¾“å‡º: 4\nè§£é‡Š: ä½ å¯ä»¥å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 1ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 3ï¼‰ã€‚\n     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = 1 + 3 = 4 ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nä¸ä¸Šä¸€é¢˜ç›¸æ¯”æˆ¿å±‹éƒ½å›´æˆä¸€åœˆäº†ï¼Œå…¶å®å›´æˆä¸€åœˆä¹Ÿå°±è¯´æ˜`nums[0]`å’Œ`nums[len-1]`ä¸èƒ½åŒæ—¶å·ï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ†ä¸¤ç§æƒ…å†µåˆ†åˆ«æ±‚æœ€å¤§å€¼ï¼Œç„¶åæ±‚æœ€ç»ˆçš„æœ€å¤§å€¼\n\n```java\npublic int rob(int [] nums){\n    if(nums==null||nums.length<=0){\n        return 0;\n    }\n    if(nums.length==1){\n        return nums[0];\n    }\n    if(nums.length==2){\n        return Math.max(nums[0],nums[1]);\n    }\n    int n=nums.length;\n    return Math.max(rob(nums,1,n),rob(nums,0,n-1));\n}\n\npublic int rob(int[] nums,int start,int end) {\n    int pre=0; //å‰ä¸€å®¶æœ€å¤§å€¼\n    int cur=0; //å½“å‰æœ€å¤§å€¼\n    for (int i=start;i<end;i++) {\n        int temp=cur;\n        cur=Math.max(pre+nums[i],cur);\n        pre=temp;\n    }\n    return cur;\n}\n```\n\n## [64. æœ€å°è·¯å¾„å’Œ](https://leetcode-cn.com/problems/minimum-path-sum/)\n\nç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„ m x n ç½‘æ ¼ï¼Œè¯·æ‰¾å‡ºä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œä¸ºæœ€å°ã€‚\n\n**è¯´æ˜**ï¼šæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚\n\n**ç¤ºä¾‹**:\n\n```java\nè¾“å…¥:\n[\n  [1,3,1],\n  [1,5,1],\n  [4,2,1]\n]\nè¾“å‡º: 7\nè§£é‡Š: å› ä¸ºè·¯å¾„ 1â†’3â†’1â†’1â†’1 çš„æ€»å’Œæœ€å°ã€‚\n```\n\nå¾ˆç»å…¸çš„DPé¢˜ã€‚\n\né€’æ¨å…¬å¼ï¼š`dp[i][j]  = grid[i][j] + Math.min(dp[i-1][j],dp[i][j-1])`\n\ndp[i] [j] ä¸ºæ¯ä¸ªæ ¼å­åˆ°`å·¦ä¸Šè§’`æœ€çŸ­è·¯å¾„ ï¼Œæ¯ä¸ªæ ¼å­åˆ°å·¦ä¸Šè§’çš„æœ€å°è·ç¦»ç­‰äºï¼Œå·¦è¾¹æ ¼å­æœ€å°å€¼å’Œä¸Šè¾¹æ ¼å­æœ€å°å€¼çš„æœ€å°å€¼åŠ ä¸Šå½“å‰æ ¼å­çš„å€¼ã€‚\n\n```java\npublic int minPathSum(int[][] grid) {\n    int[][] dp=new int[grid.length][grid[0].length];\n    for (int i=0;i<grid.length;i++) {\n        for (int j=0;j<grid[0].length;j++) {\n            //ç¬¬ä¸€è¡Œ\n            if(i==0 && j!=0){\n                dp[i][j]=grid[i][j]+dp[i][j-1];\n            }else if(i!=0 && j==0){\n                dp[i][j]=grid[i][j]+dp[i-1][j];\n            }else if(i!=0 && j!=0){\n                dp[i][j]=grid[i][j]+Math.min(dp[i-1][j],dp[i][j-1]);\n            }else{\n                dp[i][j]=grid[i][j];\n            }\n        }\n    }\n    return dp[grid.length-1][grid[0].length-1];\n}\n```\n\n**UPDATE: 2020.7.20**\n\nå†™ä¸‹é¢çš„[path-sum-three-ways](#path-sum-three-ways)çš„æ—¶å€™çœ‹äº†è¿™é¢˜ä¹‹å‰çš„ä»£ç ï¼Œå‘ç°å†™çš„ä¸å¤ªå¥½ï¼Œä¸€å †if-elseï¼Œé‡å†™ä¸‹\n```golang\nfunc minPathSum(grid [][]int) int {\n    var m = len(grid)\n    var n = len(grid[0])\n    var dp = make([][]int, m)\n    for i := 0; i < m; i++{\n        dp[i] = make([]int, n)\n    }\n    dp[0][0] = grid[0][0]\n    for i := 1; i < m; i++{\n        dp[i][0] = dp[i-1][0] + grid[i][0]\n    }\n    for j := 1; j < n; j++{\n        dp[0][j] = dp[0][j-1] + grid[0][j];\n    }\n    for i := 1; i < m; i++{\n        for j := 1; j < n; j++{\n            dp[i][j] = grid[i][j] + Min(dp[i-1][j], dp[i][j-1])\n        }\n    }\n    return dp[m-1][n-1]\n}\n\nfunc Min(a, b int) int{\n    if a > b{\n        return b\n    }\n    return a\n}\n```\n\n## [Path sum: three ways](https://projecteuler.net/problem=82)\n\nThe minimal path sum in the 5 by 5 matrix below, by starting in any cell in the left column and finishing in any cell in the right column, and only moving up, down, and right, is indicated in red and bold; the sum is equal to 994.\n\n![UhOJw6.png](https://s1.ax1x.com/2020/07/20/UhOJw6.png)\n\nFind the minimal path sum from the left column to the right column in matrix.txt (right click and \"Save Link/Target As...\"), a 31K text file containing an 80 by 80 matrix.\n\n**è§£æ³•ä¸€**\n\næ¥æº https://leetcode-cn.com/circle/discuss/BNvWBP/ ä»è¿™é‡Œçœ‹è§qcå¤§ä½¬è´´äº†å‡ºå¤„ï¼Œæ‰€ä»¥ç‰¹åœ°æ³¨å†Œäº†è¿™ä¸ªç½‘ç«™è¯•äº†ä¸‹ï¼Œè¿™ä¸ªç½‘ç«™è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼ŒåªéªŒè¯ç­”æ¡ˆï¼Œæ—¶é—´å¤æ‚åº¦å•¥çš„éƒ½ä¸ç®¡\n\nå’Œä¸Šé¢çš„æœ€å°è·¯å¾„å’Œå¾ˆç±»ä¼¼ï¼Œä½†æ˜¯è¿™é‡Œèµ·ç‚¹å’Œç»ˆç‚¹éƒ½ä¸ç¡®å®šï¼Œè€Œä¸”æœ‰3ä¸ªæ–¹å‘å¯ä»¥é€‰æ‹©ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥éå†2æ¬¡ï¼Œ`dp[i][j]`ä»£è¡¨ä»ç¬¬ä¸€åˆ—åˆ°å½“å‰`matrix[i][j]`çš„æœ€å°è·¯å¾„å’Œï¼Œå…ˆç»Ÿè®¡å•çº¯çš„å‘ä¸Šæˆ–è€…å‘ä¸‹çš„æœ€å°å€¼ï¼Œç„¶åå†ç»Ÿè®¡ç›¸åçš„æ–¹å‘çš„å€¼ï¼Œæ€»ä¹‹è¦ä¿è¯3ä¸ªæ–¹å‘çš„å€¼éƒ½æ˜¯è®¡ç®—è¿‡çš„\n```java\nimport java.util.*;\nimport java.io.*;\n//https://projecteuler.net/problem=82  answer:260324\npublic class PathSum_threeWays_projecteuler{\n    public static void main(String[] args) throws Exception{\n        BufferedReader reader = new BufferedReader(new FileReader(\"/usr/p082_matrix.txt\"));\n        int index = 0;\n        int m = 80, n = 80;\n        int[][] matrix = new int[m][n];\n        while (index < 80) {\n            String[] line = reader.readLine().split(\",\");\n            for (int j = 0; j < 80; j++) {\n                matrix[index][j] = Integer.valueOf(line[j]);\n            }\n            index++;\n        }\n        int INF = 0x3f3f3f3f;\n        int[][] dp = new int[m][n];\n        for (int j = 0; j < m; j++) {\n            dp[j][0] = matrix[j][0];\n        }\n        for (int j = 1; j < m; j++) {\n            //é¦–å…ˆåªè€ƒè™‘å‘å³èµ°å’Œå‘ä¸‹èµ°\n            for (int i = 0; i < m; i++) {\n                if (i==0){ //ç¬¬ä¸€è¡Œï¼Œåªèƒ½ä»å·¦è¾¹è½¬ç§»\n                    dp[i][j] = matrix[i][j] + dp[i][j-1];\n                }else{ //ä»å·¦è¾¹æˆ–è€…ä¸Šè¾¹è½¬ç§»\n                    dp[i][j] = matrix[i][j] + Math.min(dp[i][j-1], dp[i-1][j]);\n                }\n            }\n            for (int i = m-1; i >= 0; i--) {\n                //ä¸‰ç›®å†™çš„å¤ªé•¿çœ‹ç€æŒºä¸èˆ’æœ...\n                //dp[i][j] = i==m-1?dp[i][j]:Math.min(dp[i][j], matrix[i][j]+dp[i+1][j]);\n                if (i<m-1) { //ä»ä¸‹é¢è½¬ç§»å’Œä»ä¸Š/å·¦é¢è½¬ç§»çš„æœ€å°å€¼\n                    dp[i][j] = Math.min(dp[i][j], matrix[i][j]+dp[i+1][j]);\n                }\n                //æœ€åä¸€è¡Œï¼Œåªèƒ½ä»å·¦è¾¹æˆ–è€…ä¸Šé¢è½¬ç§»ï¼Œä¹Ÿæ˜¯å°±æ˜¯ç¬¬ä¸€ä¸ªå¾ªç¯çš„å€¼\n                //dp[i][j] = dp[i][j]\n            }\n        }\n        int res = INF;\n        for (int i = 0; i < m; i++) {\n            res = Math.min(res, dp[i][m-1]);\n        }\n        System.out.println(res);\n    }\n}\n```\n> ä¸€å¼€å§‹å†™äº†ä¸ª3ç›®ï¼Œæ”¹äº†åŠå¤©çš„bugï¼Œå‘ç°æ˜¯3ç›®å’Œå‰é¢çš„å€¼æ··åˆ°ä¸€èµ·äº†ã€‚ã€‚ã€‚\n\n## [62. ä¸åŒè·¯å¾„](https://leetcode-cn.com/problems/unique-paths/)\n\nä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚\n\næœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚\n\né—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ\n\n![mark](http://static.imlgw.top/blog/20190818/DfwXk3ObWxX8.png?imageslim)\n\n**è¯´æ˜ï¼š**m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: m = 3, n = 2\nè¾“å‡º: 3\nè§£é‡Š:\nä»å·¦ä¸Šè§’å¼€å§‹ï¼Œæ€»å…±æœ‰ 3 æ¡è·¯å¾„å¯ä»¥åˆ°è¾¾å³ä¸‹è§’ã€‚\n\n1. å‘å³ -> å‘å³ -> å‘ä¸‹\n2. å‘å³ -> å‘ä¸‹ -> å‘å³\n3. å‘ä¸‹ -> å‘å³ -> å‘å³\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: m = 7, n = 3\nè¾“å‡º: 28\n```\n\n**åŠ¨æ€è§„åˆ’è§£æ³•**\n\nè¿™é¢˜ç®—æ˜¯æˆ‘ç¬¬ä¸€é“è‡ªå·±åšå‡ºæ¥çš„DPé¢˜äº†ï¼Œè™½ç„¶å’Œä¸Šé¢çš„ä¸€é¢˜ä¸€æ ·çš„æ€è·¯ï¼Œä½†æ˜¯è¿˜æ˜¯æŒºå¼€å¿ƒçš„\n\n```java\npublic int uniquePaths(int m, int n) {\n    if(m<0||n<0){\n        return 0;\n    }\n    int[][] dp=new int[n][m];\n    for (int i=0;i<n;i++) {\n        for (int j=0;j<m;j++) {\n            if(i==0&&j!=0){\n                dp[i][j]=1;\n            }else if(j==0 && i!=0){\n                dp[i][j]=1;\n            }else if(j!=0&&i!=0){\n                dp[i][j]=dp[i][j-1]+dp[i-1][j];\n            }else{\n                dp[i][j]=1;\n            }\n        }\n    }\n    return dp[n-1][m-1];\n}\n```\næ—¶é—´å¤æ‚åº¦`O(m*n)`ï¼Œç©ºé—´å¤æ‚åº¦`O(m*n)`å¯ä»¥çœ‹å‡ºæ¥å®Œå…¨æ˜¯æŒ‰ç…§å‰ä¸€é¢˜çš„æ¨¡æ¿æ¥çš„ï¼Œä»£ç å†™çš„ä¸å¥½ï¼Œå¯ä»¥æŠŠ if-elseåˆå¹¶èµ·æ¥ï¼Œè¿™é¢˜ç©ºé—´å¤æ‚åº¦å…¶å®è¿˜å¯ä»¥ä¼˜åŒ–æˆ O(m)æˆ–O(n)çš„ï¼ŒæŒ‰è¡Œæ¥å‘ä¸‹èµ°\n\n**ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–**\n\n![leetCodeé¢˜è§£](http://static.imlgw.top/blog/20190824/7uacSvsRMaWq.png?imageslim)\n\n```java\npublic static int uniquePaths2(int m, int n) {\n    if(m<0||n<0){\n        return 0;\n    }\n    int[] dp=new int[n]; \n    Arrays.fill(dp,1); //ç¬¬ä¸€è¡Œï¼Œç¬¬ä¸€åˆ—å‡ä¸º 1\n    for (int i=1;i<m;i++) { //ä¸€è¡Œä¸€è¡Œå‘ä¸‹èµ°\n        for (int j=1;j<n;j++) {\n            //è¿™é‡Œçš„dp[j]å’Œdp[j-1]åˆ†åˆ«å°±ä»£è¡¨äº† ä¸Šè¾¹ å’Œ å·¦è¾¹çš„å…ƒç´ \n            dp[j]=dp[j]+dp[j-1]; //æ±‚æ¯ä¸€è¡Œæ¯ä¸ªå…ƒç´ çš„dpå€¼\n        }\n    }\n    return dp[n-1]; //æœ€åä¸€è¡Œæœ€åä¸€ä¸ªdpå€¼å°±æ˜¯ç»“æœ\n}\n```\n\n**ç»„åˆæ•°å…¬å¼**\n\nè¿™é¢˜å…¶å®å°±æ˜¯æˆ‘ä»¬åˆä¸­è¿˜æ˜¯é«˜ä¸­å­¦çš„æ’åˆ—ç»„åˆçš„é—®é¢˜ï¼Œæœºå™¨äººä¸€å…±èµ°`m+n-2` æ­¥ï¼Œå‘ä¸‹ä¼šèµ°`m-1` æ­¥ï¼Œå‘ä¸‹ä¼šèµ°`n-1` æ­¥ï¼Œæ‰€ä»¥å®é™…ä¸Šå°±æ˜¯æ±‚ä¸€ä¸ªç»„åˆæ•°çš„ç»“æœ `C(n-1ï¼Œm+n-2)` ï¼Œ\n\n```java\npublic int uniquePaths(int m, int n) {\n    if(m<0||n<0){\n        return 0;\n    }\n    int step=m+n-2;\n    int down=n-1;\n    long res=1;\n    for (int i=1;i<=down;i++) {\n        res=res*(step-down+i)/i; //é€’æ¨\n    }\n    return (int)res;\n}\n```\n\n## [63. ä¸åŒè·¯å¾„ II](https://leetcode-cn.com/problems/unique-paths-ii/)\n\nä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x n ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚\n\næœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚\n\nç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ\n\n![mark](http://static.imlgw.top/blog/20190818/DfwXk3ObWxX8.png?imageslim)\n\nç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚\n\n**è¯´æ˜ï¼š**m å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n[\n  [0,0,0],\n  [0,1,0],\n  [0,0,0]\n]\nè¾“å‡º: 2\nè§£é‡Š:\n3x3 ç½‘æ ¼çš„æ­£ä¸­é—´æœ‰ä¸€ä¸ªéšœç¢ç‰©ã€‚\nä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ä¸€å…±æœ‰ 2 æ¡ä¸åŒçš„è·¯å¾„ï¼š\n\n1. å‘å³ -> å‘å³ -> å‘ä¸‹ -> å‘ä¸‹\n2. å‘ä¸‹ -> å‘ä¸‹ -> å‘å³ -> å‘å³\n```\n\n**è§£æ³•ä¸€**\n\nçœ‹åˆ°è¿™ç§è·¯å¾„çš„é¢˜ï¼Œé¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯é€’å½’å›æº¯\n\n```java\n//dfså›æº¯ , TLE\nprivate int[][] direction={{0,1},{1,0}};\n\nprivate int count=0;\n\npublic int uniquePathsWithObstacles(int[][] obstacleGrid) {\n    if (obstacleGrid==null || obstacleGrid.length<=0 || obstacleGrid[0][0]==1) {\n        return 0;\n    }\n    boolean[][] visit=new boolean[obstacleGrid.length][obstacleGrid[0].length];\n    dfs(obstacleGrid,visit,0,0);\n    return count;\n}\n\npublic void dfs(int[][] obstacleGrid,boolean[][] visit,int x,int y) {\n    //!=1 æ˜¯ä¸ºäº†coner case\n    if (x==obstacleGrid.length-1 && y==obstacleGrid[0].length-1 && obstacleGrid[x][y]!=1) {\n        count++;\n        return;\n    }\n    for (int i=0;i<direction.length;i++) {\n        int nx=x+direction[i][0];\n        int ny=y+direction[i][1];\n        if (nx<obstacleGrid.length && ny<obstacleGrid[0].length && !visit[nx][ny] && obstacleGrid[nx][ny] !=1) {\n            visit[nx][ny]=true;\n            dfs(obstacleGrid,visit,nx,ny);\n            visit[nx][ny]=false;\n        }\n    }\n}\n```\nç»“æœå¾ˆæƒ¨ï¼ŒTLEäº†ï¼Œåªè·‘äº†ä¸åˆ°ä¸€åŠçš„caseå°±TLEäº†\n\n**è§£æ³•äºŒ**\n\nåŠ¨æ€è§„åˆ’çš„è§£æ³•ï¼Œå…¶å®å’Œä¸Šé¢ä¸€é¢˜æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡éœ€è¦æ³¨æ„éšœç¢ç‰©ä½ç½®çš„dpå€¼\n\n```java\npublic int uniquePathsWithObstacles(int[][] obstacleGrid) {\n    if (obstacleGrid==null || obstacleGrid.length<=0 || obstacleGrid[0][0]==1) {\n        return 0;\n    }\n    int[][] dp=new int[obstacleGrid.length][obstacleGrid[0].length];\n    for (int i=0;i<obstacleGrid.length;i++) {\n        for (int j=0; j<obstacleGrid[0].length;j++) {\n            if (obstacleGrid[i][j]==1) {\n                dp[i][j]=0;\n            }else if (i==0 && j==0) {\n                dp[0][0]=1;\n            }else if(i==0 && j!=0){\n                dp[0][j]=dp[0][j-1];\n            }else if (j==0 && i!=0) {\n                dp[i][0]=dp[i-1][0];\n            }else{\n                dp[i][j]=dp[i-1][j]+dp[i][j-1];\n            }\n        }\n    }\n    return dp[obstacleGrid.length-1][obstacleGrid[0].length-1];\n}\n```\nå’Œä¸Šé¢ä¸€æ ·ä¹Ÿå¯ä»¥è¿›è¡Œç©ºé—´ä¸Šçš„ä¼˜åŒ–\n\n```java\n//ä¸€ç»´dp\npublic int uniquePathsWithObstacles(int[][] obstacleGrid) {\n    if (obstacleGrid==null || obstacleGrid.length<=0 || obstacleGrid[0][0]==1) {\n        return 0;\n    }\n    //ä»¥è¡Œä¸ºå•ä½å‘ä¸‹èµ°\n    int[] dp=new int[obstacleGrid[0].length];\n    dp[0]=1;\n    for (int i=0;i<obstacleGrid.length;i++) {\n        for (int j=0; j<obstacleGrid[0].length;j++) {\n            if (obstacleGrid[i][j]==1) {\n                dp[j]=0;\n            }else if(i==0 && j!=0){ //ç¬¬ä¸€è¡Œ\n                dp[j]=dp[j-1];\n            }else if(i!=0 && j!=0){ \n                dp[j]=dp[j]+dp[j-1];\n            }\n            //æ¯ä¸€è¡Œç¬¬ä¸€åˆ—çš„dp[j]=dp[j],å’Œä¸Šä¸€è¡Œçš„ç¬¬ä¸€åˆ—ä¿æŒä¸€è‡´å°±è¡Œ\n        }\n    }\n    return dp[obstacleGrid[0].length-1];\n}\n```\n**UPDATE: 2020.7.6**\n\næƒ³å¯¹ç®€æ´çš„åšæ³•\n```golang\nfunc uniquePathsWithObstacles(grid [][]int) int {\n    var m = len(grid)\n    var n = len(grid[0])\n    var dp = make([][]int, m+1)\n    for i := 0; i <= m; i++ {\n        dp[i] = make([]int, n+1)\n    }\n    dp[0][1] = 1 //åˆå§‹å€¼\n    for i := 1; i <= m; i++ {\n        for j := 1; j <= n; j++ {\n            if grid[i-1][j-1] != 1 {\n                dp[i][j] = dp[i-1][j] + dp[i][j-1]\n            }\n        }\n    }\n    return dp[m][n]\n}\n\n```\n## [576. å‡ºç•Œçš„è·¯å¾„æ•°](https://leetcode-cn.com/problems/out-of-boundary-paths/)\n\nç»™å®šä¸€ä¸ª **m Ã— n** çš„ç½‘æ ¼å’Œä¸€ä¸ªçƒã€‚çƒçš„èµ·å§‹åæ ‡ä¸º **(i,j)** ï¼Œä½ å¯ä»¥å°†çƒç§»åˆ°**ç›¸é‚»**çš„å•å…ƒæ ¼å†…ï¼Œæˆ–è€…å¾€ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘ä¸Šç§»åŠ¨ä½¿çƒç©¿è¿‡ç½‘æ ¼è¾¹ç•Œã€‚ä½†æ˜¯ï¼Œä½ **æœ€å¤š**å¯ä»¥ç§»åŠ¨ **N** æ¬¡ã€‚æ‰¾å‡ºå¯ä»¥å°†çƒç§»å‡ºè¾¹ç•Œçš„è·¯å¾„æ•°é‡ã€‚ç­”æ¡ˆå¯èƒ½éå¸¸å¤§ï¼Œè¿”å› ç»“æœ mod 109 + 7 çš„å€¼ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: m = 2, n = 2, N = 2, i = 0, j = 0\nè¾“å‡º: 6\nè§£é‡Š:\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: m = 1, n = 3, N = 3, i = 0, j = 1\nè¾“å‡º: 12\nè§£é‡Š:\n```\n\n**è¯´æ˜:**\n\n1. çƒä¸€æ—¦å‡ºç•Œï¼Œå°±ä¸èƒ½å†è¢«ç§»åŠ¨å›ç½‘æ ¼å†…ã€‚\n2. ç½‘æ ¼çš„é•¿åº¦å’Œé«˜åº¦åœ¨ [1,50] çš„èŒƒå›´å†…ã€‚\n3. N åœ¨ [0,50] çš„èŒƒå›´å†…ã€‚\n\n**è§£æ³•ä¸€**\n\né¦–å…ˆå†™å‡ºæ¥çš„è§£æ³•ï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œè®°å¿†åŒ–é€’å½’\n\n```java\nint[][] dir={{0,1},{1,0},{-1,0},{0,-1}};\n\nint mod=(int)1e9+7;\n\nLong[][][] dp=null;\n\npublic int findPaths(int m, int n, int N, int i, int j) {\n    dp=new Long[m][n][N+1];\n    return (int)(dfs(m,n,i,j,N)%mod);\n}\n\npublic long dfs(int m,int n,int x,int y,int k){\n    if(k==0) return 0;\n    if(dp[x][y][k]!=null){\n        return dp[x][y][k];\n    }\n    long count=0;\n    for(int i=0;i<dir.length;i++){\n        int nx=x+dir[i][0];\n        int ny=y+dir[i][1];\n        if(!valid(m,n,nx,ny)){\n            count++;\n            continue;\n        }\n        count=(count+dfs(m,n,nx,ny,k-1))%mod;\n    }\n    return dp[x][y][k]=(count)%mod;\n}\n\npublic boolean valid(int m,int n,int x,int y){\n    return x>=0 && x<m && y>=0 && y<n;\n}\n```\n\næœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œä¸éœ€è¦visitï¼Œå› ä¸ºæœ‰Kçš„é™åˆ¶ï¼Œä¸ç”¨æ‹…å¿ƒæ­»å¾ªç¯ï¼Œæ„Ÿè§‰åŠ äº†visitåè€Œä¼šé”™ï¼Ÿ\n\n**è§£æ³•äºŒ**\n\næ•´ä½“ä¸Šæ¥è¯´è¿˜æ˜¯å±äºæ¯”è¾ƒç®€å•çš„åŠ¨æ€è§„åˆ’ï¼Œè‡³å°‘é€’æ¨æ–¹ç¨‹å¥½æƒ³\n\n```java\n//è‡ªåº•å‘ä¸Šé€’æ¨\npublic int findPaths(int m, int n, int N, int i, int j) {\n    int mod=(int)1e9+7;\n    //ç¾¤é‡Œå·å­¦åˆ°çš„\n    int[] dir={0,1,0,-1,0};\n    long[][][] dp=new long[m][n][N+1];\n    for (int k=1;k<=N;k++) { //æƒ³æƒ³Kä¸ºä»€ä¹ˆåœ¨æœ€å¤–å±‚\n        for (int r=0;r<m;r++) {\n            for (int c=0;c<n;c++) {\n                for (int d=0;d<4;d++) {\n                    int nx=r+dir[d];\n                    int ny=c+dir[d+1];\n                    if(nx<0 || ny<0 || nx>=m ||ny>=n){\n                        dp[r][c][k]++;\n                    }else{\n                        dp[r][c][k]=(dp[r][c][k]+dp[nx][ny][k-1])%mod;\n                    }\n                }\n                //æå‰ç»“æŸï¼Œåªéœ€è¦i,j,Nå°±è¡Œäº†(è²Œä¼¼æ²¡æœ‰å¿«å¤šå°‘)\n                if(k==N && r==i && c==j){\n                    return (int)(dp[i][j][N]);\n                }\n            }\n        }\n    }\n    //return (int)(dp[m-1][n-1][N]); mdä¸€å¼€å§‹è¿”å›é”™äº†ï¼Œçœ‹äº†åŠå¤©\n    return 0;\n}\n```\nKæ”¾åœ¨æœ€å¤–å±‚çš„åŸå› å…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œæˆ‘ä»¬æ±‚æŸä¸€ä¸ªç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å‘¨å›´4ä¸ªæ–¹å‘çš„`K-1`çš„å€¼ï¼Œè¿™äº›å€¼å¿…é¡»æ˜¯å·²ç»è®¡ç®—è¿‡çš„ï¼Œæ‰€ä»¥Kè‚¯å®šæ˜¯è¦æ”¾åœ¨æœ€å¤–å±‚çš„\n\n## [688. â€œé©¬â€åœ¨æ£‹ç›˜ä¸Šçš„æ¦‚ç‡](https://leetcode-cn.com/problems/knight-probability-in-chessboard/)\n\nå·²çŸ¥ä¸€ä¸ª `N`x`N` çš„å›½é™…è±¡æ£‹æ£‹ç›˜ï¼Œæ£‹ç›˜çš„è¡Œå·å’Œåˆ—å·éƒ½æ˜¯ä» 0 å¼€å§‹ã€‚å³æœ€å·¦ä¸Šè§’çš„æ ¼å­è®°ä¸º `(0, 0)`ï¼Œæœ€å³ä¸‹è§’çš„è®°ä¸º `(N-1, N-1)`ã€‚ \n\nç°æœ‰ä¸€ä¸ª â€œé©¬â€ï¼ˆä¹Ÿè¯‘ä½œ â€œéª‘å£«â€ï¼‰ä½äº `(r, c)` ï¼Œå¹¶æ‰“ç®—è¿›è¡Œ `K` æ¬¡ç§»åŠ¨ã€‚ \n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå›½é™…è±¡æ£‹çš„ â€œé©¬â€ æ¯ä¸€æ­¥å…ˆæ²¿æ°´å¹³æˆ–å‚ç›´æ–¹å‘ç§»åŠ¨ 2 ä¸ªæ ¼å­ï¼Œç„¶åå‘ä¸ä¹‹ç›¸å‚ç›´çš„æ–¹å‘å†ç§»åŠ¨ 1 ä¸ªæ ¼å­ï¼Œå…±æœ‰ 8 ä¸ªå¯é€‰çš„ä½ç½®ã€‚\n\n![YsAXFS.png](https://s1.ax1x.com/2020/05/15/YsAXFS.png) \n\nç°åœ¨ â€œé©¬â€ æ¯ä¸€æ­¥éƒ½ä»å¯é€‰çš„ä½ç½®ï¼ˆåŒ…æ‹¬æ£‹ç›˜å¤–éƒ¨çš„ï¼‰ä¸­ç‹¬ç«‹éšæœºåœ°é€‰æ‹©ä¸€ä¸ªè¿›è¡Œç§»åŠ¨ï¼Œç›´åˆ°ç§»åŠ¨äº† `K` æ¬¡æˆ–è·³åˆ°äº†æ£‹ç›˜å¤–é¢ã€‚\n\næ±‚ç§»åŠ¨ç»“æŸåï¼Œâ€œé©¬â€ ä»ç•™åœ¨æ£‹ç›˜ä¸Šçš„æ¦‚ç‡ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥: 3, 2, 0, 0\nè¾“å‡º: 0.0625\nè§£é‡Š: \nè¾“å…¥çš„æ•°æ®ä¾æ¬¡ä¸º N, K, r, c\nç¬¬ 1 æ­¥æ—¶ï¼Œæœ‰ä¸”åªæœ‰ 2 ç§èµ°æ³•ä»¤ â€œé©¬â€ å¯ä»¥ç•™åœ¨æ£‹ç›˜ä¸Šï¼ˆè·³åˆ°ï¼ˆ1,2ï¼‰æˆ–ï¼ˆ2,1ï¼‰ï¼‰ã€‚å¯¹äºä»¥ä¸Šçš„ä¸¤ç§æƒ…å†µï¼Œå„è‡ªåœ¨ç¬¬2æ­¥å‡æœ‰ä¸”åªæœ‰2ç§èµ°æ³•ä»¤ â€œé©¬â€ ä»ç„¶ç•™åœ¨æ£‹ç›˜ä¸Šã€‚\næ‰€ä»¥ â€œé©¬â€ åœ¨ç»“æŸåä»åœ¨æ£‹ç›˜ä¸Šçš„æ¦‚ç‡ä¸º 0.0625ã€‚\n```\n\n**æ³¨æ„ï¼š**\n\n- `N` çš„å–å€¼èŒƒå›´ä¸º [1, 25]\n- `K` çš„å–å€¼èŒƒå›´ä¸º [0, 100]\n- å¼€å§‹æ—¶ï¼Œâ€œé©¬â€ æ€»æ˜¯ä½äºæ£‹ç›˜ä¸Š\n\n**é”™è¯¯è§£æ³•ä¸€**\n\né¦–å…ˆé‡‡ç”¨äº†å’Œä¸Šä¸€é¢˜ç±»ä¼¼åšæ³•ï¼Œæ˜æ˜¾æ˜¯ä¸è¡Œçš„\n\n```java\n//å°æ•°æ®å¯ä»¥è¿‡ï¼Œå¤§æ•°æ®è¿‡ä¸äº†\n//K[0,100]ç›´æ¥8^100å°±çˆ†äº†ï¼Œæ‰€ä»¥è‚¯å®šä¸èƒ½åƒä¸Šé¢é‚£æ ·æ±‚ï¼Œdpå¾—å­˜æ¦‚ç‡\npublic double knightProbability(int N, int K, int r, int c) {\n    int[][] dir={{-2,-1},{-2,1},{-1,2},{1,2},{2,1},{2,-1},{1,-2},{-1,-2}};\n    int[][][] dp=new int[N][N][K+1];\n    for(int i=0;i<N;i++){\n        for(int j=0;j<N;j++){\n            //è¿™é¢˜å¦‚æœåç€æ±‚å‡ºç•Œè·¯å¾„å°±é”™äº†ï¼Œå¾—æ­£å‘æ±‚\n            dp[i][j][0]=1; \n        }\n    }\n    for(int k=1;k<=K;k++){\n        for(int i=0;i<N;i++){\n            for(int j=0;j<N;j++){\n                for(int d=0;d<dir.length;d++){\n                    int nx=i+dir[d][0];\n                    int ny=j+dir[d][1];\n                    if(nx>=0 && nx<N && ny>=0 && ny<N){\n                        dp[i][j][k]+=(dp[nx][ny][k-1]);\n                    }\n                }\n            }\n        }\n    }\n    return dp[r][c][K]/Math.pow(8,K);\n}\n```\n> å¤šè¯´ä¸€ç‚¹ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¸å’Œä¸Šé¢ä¸€æ ·ï¼Œç®—å‡ºç•Œçš„è·¯å¾„æ•°ï¼Œç„¶åç”¨`8^K`å‡å»å‡ºç•Œæ•°é‡ï¼Œç„¶åé™¤ä»¥`8^K`ï¼Ÿå…¶å®ä¸»è¦æ˜¯å‡ºç•Œçš„è¿™é‡Œå¹¶ä¸å¥½ç®—ï¼Œè¿™é‡Œè¦æ±‚çš„æ˜¯æ¦‚ç‡ï¼Œå‡ºç•Œçš„è·¯å¾„å¹¶ä¸èƒ½å®Œå…¨åŒ…å«å‡ºç•Œçš„æ–¹å¼ï¼ˆå¯ä»¥ç†è§£ä¸ºå‡ºç•Œåä»ç„¶å¯ä»¥èµ°ï¼‰\n\n**è§£æ³•äºŒ**\n\næ ‡å‡†çš„dpè§£æ³•ï¼Œæ³¨æ„æ¦‚ç‡çš„è®¡ç®—å°±è¡Œäº†\n\n```java\n//DPå­˜æ¦‚ç‡ACè§£æ³•\npublic double knightProbability(int N, int K, int r, int c) {\n    int[][] dir={{-2,-1},{-2,1},{-1,2},{1,2},{2,1},{2,-1},{1,-2},{-1,-2}};\n    double[][][] dp=new double[N][N][K+1];\n    for(int i=0;i<N;i++){\n        for(int j=0;j<N;j++){\n            dp[i][j][0]=1;\n        }\n    }\n    for(int k=1;k<=K;k++){\n        for(int i=0;i<N;i++){\n            for(int j=0;j<N;j++){\n                for(int d=0;d<dir.length;d++){\n                    int nx=i+dir[d][0];\n                    int ny=j+dir[d][1];\n                    if(nx>=0 && nx<N && ny>=0 && ny<N){\n                        //mdï¼Œä¸€å¼€å§‹ä¸çŸ¥é“ä¸ºå•¥æƒ³åˆ°æ±‚ç‹¬ç«‹äº‹ä»¶P(A U B)ä¸Šå»äº†\n                        //ä½†æ˜¯å…¶å®ä¸¤è€…å¹¶ä¸æ˜¯ç‹¬ç«‹äº‹ä»¶ï¼Œæ˜¯äº’æ–¥äº‹ä»¶ç›´æ¥P(A)+P(B)å°±è¡Œäº†\n                        dp[i][j][k]+=(dp[nx][ny][k-1])/8;\n                    }\n                }\n                //æå‰è¿”å›\n                if(i==r && j==c && k==K){\n                    return dp[i][j][k];\n                }\n            }\n        }\n    }\n    return dp[r][c][K];\n}\n```\n\n**è§£æ³•ä¸‰**\n\nè®°å¿†åŒ–çš„æ–¹å¼ï¼Œå…¶å®ä¼šæ¯”ä¸Šé¢é€’æ¨çš„ä¼šå¿«ä¸€ç‚¹ï¼Œä¸Šé¢é€’æ¨çš„ä¼šæœ‰å¾ˆå¤šæ— ç”¨çŠ¶æ€\n\n```java\n//è‡ªé¡¶å‘ä¸Š\nDouble[][][] dp=null;\n\nint[][] dir={{-2,-1},{-2,1},{-1,2},{1,2},{2,1},{2,-1},{1,-2},{-1,-2}};\n\npublic double knightProbability(int N, int K, int r, int c) {\n    dp=new Double[N][N][K+1];\n    return dfs(N,K,r,c);\n}\n\npublic double dfs(int N,int k,int x,int y){\n    if(k==0) return 1.0;\n    if(dp[x][y][k]!=null){\n        return dp[x][y][k];\n    }\n    double p=0;\n    for (int i=0;i<dir.length;i++) {\n        int nx=x+dir[i][0];\n        int ny=y+dir[i][1];\n        if(nx>=0 && nx<N && ny>=0 && ny<N){\n            p+=dfs(N,k-1,nx,ny)/8;\n        }\n    }\n    return dp[x][y][k]=p;\n}\n```\n\n## [935. éª‘å£«æ‹¨å·å™¨](https://leetcode-cn.com/problems/knight-dialer/)\n\nå›½é™…è±¡æ£‹ä¸­çš„éª‘å£«å¯ä»¥æŒ‰ä¸‹å›¾æ‰€ç¤ºè¿›è¡Œç§»åŠ¨ï¼š\n\n![YsAXFS.png](https://s1.ax1x.com/2020/05/15/YsAXFS.png) .         ![YcP3o8.png](https://s1.ax1x.com/2020/05/16/YcP3o8.png)\n\n\nè¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°† â€œéª‘å£«â€ æ”¾åœ¨ç”µè¯æ‹¨å·ç›˜çš„ä»»æ„æ•°å­—é”®ï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰ä¸Šï¼Œæ¥ä¸‹æ¥ï¼Œéª‘å£«å°†ä¼šè·³ N-1 æ­¥ã€‚æ¯ä¸€æ­¥å¿…é¡»æ˜¯ä»ä¸€ä¸ªæ•°å­—é”®è·³åˆ°å¦ä¸€ä¸ªæ•°å­—é”®ã€‚\n\næ¯å½“å®ƒè½åœ¨ä¸€ä¸ªé”®ä¸Šï¼ˆåŒ…æ‹¬éª‘å£«çš„åˆå§‹ä½ç½®ï¼‰ï¼Œéƒ½ä¼šæ‹¨å‡ºé”®æ‰€å¯¹åº”çš„æ•°å­—ï¼Œæ€»å…±æŒ‰ä¸‹ `N` ä½æ•°å­—ã€‚\n\nä½ èƒ½ç”¨è¿™ç§æ–¹å¼æ‹¨å‡ºå¤šå°‘ä¸ªä¸åŒçš„å·ç ï¼Ÿ\n\nå› ä¸ºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œ**æ‰€ä»¥è¾“å‡ºç­”æ¡ˆæ¨¡ 10^9 + 7**ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š1\nè¾“å‡ºï¼š10\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š2\nè¾“å‡ºï¼š20\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š3\nè¾“å‡ºï¼š46\n```\n\n**æç¤ºï¼š**\n\n- `1 <= N <= 5000`\n\n**è§£æ³•ä¸€**\n\nå…ˆä¸Šä¸€ä¸ªæå…¶ç²—ç³™çš„è§£æ³•ï¼Œä¹Ÿæ˜¯æœ€å¼€å§‹çš„è§£æ³•\n\n```java\nint[][] dir={{-2,-1},{-2,1},{-1,2},{1,2},{2,1},{2,-1},{1,-2},{-1,-2}};\n\nint mod=(int)1e9+7;\n\nInteger[][][] dp=null;\n\npublic int knightDialer(int N) {\n    int[][] grid={{1,2,3},{4,5,6},{7,8,9},{-1,0,-1}};\n    int res=0;\n    dp=new Integer[4][3][N];\n    for(int i=0;i<grid.length;i++){\n        for(int j=0;j<grid[0].length;j++){\n            if(grid[i][j]!=-1){\n                res=(res+dfs(grid,i,j,N-1))%mod;\n            }\n        }\n    }\n    return res;\n}\n\npublic int dfs(int[][] grid,int x,int y,int N){\n    if(N==0) return 1;\n    if(dp[x][y][N]!=null) return dp[x][y][N];\n    int res=0; //ä¸€å¼€å§‹èµ‹å€¼æˆ1äº†ã€‚ã€‚ä»å½“å‰ä½ç½®èµ·è·³ï¼Œæ‰€ä»¥å½“å‰ä½ç½®ä¸åº”è¯¥æœ‰åˆå§‹å€¼\n    for(int i=0;i<dir.length;i++){\n        int nx=x+dir[i][0];\n        int ny=y+dir[i][1];\n        if(valid(grid,nx,ny)){\n            res=(res+dfs(grid,nx,ny,N-1))%mod;\n        }\n    }\n    return dp[x][y][N]=res;\n}\n\npublic boolean valid(int[][] grid,int x,int y){\n    return x>=0 && y>=0 && x<grid.length && y<grid[0].length && grid[x][y]!=-1;\n}\n```\n\n**è§£æ³•äºŒ**\n\nå°å·§ç²¾è‡´çš„è§£æ³•\n\n```java\nint mod=(int)1e9+7;\n\nInteger[][] dp=null;\n\npublic int knightDialer(int N) {\n    //ç›´æ¥çœ‹å›¾å»ºç«‹å¯¹åº”å…³ç³»\n    int[][] next={{4,6},{6,8},{7,9},{4,8},{0,3,9},{},{0,1,7},{2,6},{1,3},{2,4}};\n    int res=0;\n    dp=new Integer[10][N];\n    for(int i=0;i<=9;i++){\n        res=(res+dfs(i,N-1,next))%mod;\n    }\n    return res;\n}\n\npublic int dfs(int num,int N,int[][] next){\n    if(N==0) return 1;\n    if(dp[num][N]!=null) return dp[num][N];\n    int res=0; //æ³¨æ„åˆ«å†™æˆ1äº†\n    for(int i=0;i<next[num].length;i++){\n        res=(res+dfs(next[num][i],N-1,next))%mod;\n    }\n    return dp[num][N]=res;\n}\n```\n\n**è§£æ³•ä¸‰**\n\né€’æ¨çš„æ–¹å¼\n\n```java\n//é€’æ¨çš„æ–¹å¼\npublic int knightDialer(int N) {\n    //next[i]: iä¸‹ä¸€æ­¥èƒ½è·³åˆ°çš„ä½ç½®\n    int[][] next={{4,6},{6,8},{7,9},{4,8},{0,3,9},{},{0,1,7},{2,6},{1,3},{2,4}};\n    int[][] dp=new int[N][10];\n    Arrays.fill(dp[0],1); //base dp[0]\n    int mod=(int)1e9+7;\n    int res=0;\n    for (int i=1;i<N;i++) {\n        for (int num=0;num<=9;num++) {\n            for (int j=0;j<next[num].length;j++) {\n                dp[i][num]=(dp[i][num]+dp[i-1][next[num][j]])%mod;   \n            }\n        }\n    }\n    for(int i=0;i<=9;i++) res=(res+dp[N-1][i])%mod;\n    return res;\n}\n```\n\n## [303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜](https://leetcode-cn.com/problems/range-sum-query-immutable/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„  numsï¼Œæ±‚å‡ºæ•°ç»„ä»ç´¢å¼• i åˆ° j  (i â‰¤ j) èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼ŒåŒ…å« i,  j ä¸¤ç‚¹ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nç»™å®š nums = [-2, 0, 3, -5, 2, -1]ï¼Œæ±‚å’Œå‡½æ•°ä¸º sumRange()\n\nsumRange(0, 2) -> 1\nsumRange(2, 5) -> -1\nsumRange(0, 5) -> -3\n```\n\n**è¯´æ˜:**\n\n- ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸å¯å˜ã€‚\n- ä¼šå¤šæ¬¡è°ƒç”¨ sumRange æ–¹æ³•ã€‚\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®ä¸€å¼€å§‹å°±æ˜¯æƒ³çš„ç¼“å­˜ä¸€ä¸‹ä¹‹å‰è°ƒç”¨äº§ç”Ÿçš„å€¼ï¼Œæ²¡æœ‰ç†è§£åˆ°è¿™é¢˜çš„è¦ç‚¹ã€‚\n\n```java\nclass NumArray {\n\n    private int[] sums=null;\n\n    public NumArray(int[] nums) {\n        if (nums!=null && nums.length>0) {\n            sums=new int[nums.length];\n            sums[0]=nums[0];\n            for (int i=1;i<sums.length;i++) {\n                sums[i]=sums[i-1]+nums[i];\n            }    \n        }\n        \n    }\n    \n    public int sumRange(int i, int j) {\n        if(i==0){\n            return sums[j];\n        }\n        return sums[j]-sums[i-1];\n    }\n}\n\n/**\n * Your NumArray object will be instantiated and called as such:\n * NumArray obj = new NumArray(nums);\n * int param_1 = obj.sumRange(i,j);\n */\n```\n\nè¿™é¢˜å…³é”®æœ‰ä¸¤ä¸ªåœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯ `sumRange(i , j) = sumRange(0, j)-sumRange(0, i-1)` ï¼Œå¦ä¸€ä¸ªå…³é”®å°±æ˜¯åœ¨æ„é€ å™¨é‡Œé¢å°†æ‰€æœ‰çš„ `sumRange(0 , i)` ç»™é¢„å…ˆæ±‚å‡ºæ¥ï¼Œè¿™æ ·åœ¨åé¢çš„è°ƒç”¨æ—¶æ—¶é—´å¤æ‚åº¦å°±æ˜¯`O(1)`çš„äº†ã€‚\n\nè¿™é‡Œæ±‚`sumRange(0, i)`çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„dp.\n\n## [413. ç­‰å·®æ•°åˆ—åˆ’åˆ†](https://leetcode-cn.com/problems/arithmetic-slices/)\n\nå¦‚æœä¸€ä¸ªæ•°åˆ—è‡³å°‘æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ä»»æ„ä¸¤ä¸ªç›¸é‚»å…ƒç´ ä¹‹å·®ç›¸åŒï¼Œåˆ™ç§°è¯¥æ•°åˆ—ä¸ºç­‰å·®æ•°åˆ—ã€‚\n\nä¾‹å¦‚ï¼Œä»¥ä¸‹æ•°åˆ—ä¸ºç­‰å·®æ•°åˆ—:\n\n```java\n1, 3, 5, 7, 9\n7, 7, 7, 7\n3, -1, -5, -9\n```\n\n\nä»¥ä¸‹æ•°åˆ—ä¸æ˜¯ç­‰å·®æ•°åˆ—ã€‚\n\n```java\n1, 1, 2, 5, 7\n```\n\n\næ•°ç»„ A åŒ…å« N ä¸ªæ•°ï¼Œä¸”ç´¢å¼•ä»0å¼€å§‹ã€‚æ•°ç»„ A çš„ä¸€ä¸ªå­æ•°ç»„åˆ’åˆ†ä¸ºæ•°ç»„ (P, Q)ï¼ŒP ä¸ Q æ˜¯æ•´æ•°ä¸”æ»¡è¶³ 0<=P<Q<N ã€‚\n\nå¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™ç§°å­æ•°ç»„(P, Q)ä¸ºç­‰å·®æ•°ç»„ï¼š\n\nå…ƒç´  A[P], A[p + 1], ..., A[Q - 1], A[Q] æ˜¯ç­‰å·®çš„ã€‚å¹¶ä¸” P + 1 < Q ã€‚\n\nå‡½æ•°è¦è¿”å›æ•°ç»„ A ä¸­æ‰€æœ‰ä¸ºç­‰å·®æ•°ç»„çš„å­æ•°ç»„ä¸ªæ•°ã€‚\n\n **ç¤ºä¾‹:**\n\n```java\nA = [1, 2, 3, 4]\n\nè¿”å›: 3, A ä¸­æœ‰ä¸‰ä¸ªå­ç­‰å·®æ•°ç»„: [1, 2, 3], [2, 3, 4] ä»¥åŠè‡ªèº« [1, 2, 3, 4]ã€‚\n```\n\ndpçš„é¢˜å•Šï¼Œç­”æ¡ˆä¸€çœ‹å°±æ˜ç™½ï¼Œå°±æ˜¯è‡ªå·±æƒ³ä¸åˆ°ã€‚ã€‚ã€‚\n\n```java\npublic int numberOfArithmeticSlices(int[] A) {\n    if(A.length<3){\n        return 0;\n    }\n    //dp[i]=dp[i-1]+1;\n    int []dp=new int[A.length]; //ä»¥ A[i] ç»“å°¾çš„ç­‰å·®æ•°åˆ—æœ‰å¤šå°‘ä¸ª\n    for (int i=2;i<A.length;i++) {\n        if(A[i]-A[i-1]==A[i-1]-A[i-2]){\n            dp[i]=dp[i-1]+1;\n        }\n    }\n    int res=0;\n    for (int i=0;i<dp.length;i++) {\n        res+=dp[i];\n    }\n    return res;\n}\n```\n\nå°±æ˜¯æ²¡æƒ³åˆ°è¦å¯¹ä»¥å½“å‰å…ƒç´ ç»“å°¾çš„åŠ¨æ€æ•°ç»„æ•°é‡åšdpï¼Œå½“ç„¶ä¸Šé¢çš„åšæ³•çš„ç©ºé—´è¿˜å¯ä»¥ä¼˜åŒ–æˆO(1)çš„\n\n```java\npublic int numberOfArithmeticSlices2(int[] A) {\n    if(A.length<3){\n        return 0;\n    }\n    //dp[i]=dp[i-1]+1;\n    int dp=0;\n    int res=0;\n    for (int i=2;i<A.length;i++) {\n        if(A[i]-A[i-1]==A[i-1]-A[i-2]){\n            dp=dp+1;\n            res+=dp;\n        }else{\n            dp=0;\n        }\n    }\n    return res;\n}\n```\n\nåªéœ€è¦æ ¹æ®ä¸Šä¸€æ¬¡çš„dpå€¼æ›´æ–°å°±è¡Œï¼Œå¦‚æœbreakç­‰å·®æ•°åˆ—ï¼Œå°±ç½®ä¸º0\n\n------\n\n## [343. æ•´æ•°æ‹†åˆ†](https://leetcode-cn.com/problems/integer-break/)\n\nç»™å®šä¸€ä¸ªæ­£æ•´æ•° nï¼Œå°†å…¶æ‹†åˆ†ä¸º**è‡³å°‘**ä¸¤ä¸ªæ­£æ•´æ•°çš„å’Œï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚ è¿”å›ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 2\nè¾“å‡º: 1\nè§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 10\nè¾“å‡º: 36\nè§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36ã€‚\n```\n\n**è¯´æ˜:** ä½ å¯ä»¥å‡è®¾ n ä¸å°äº 2 ä¸”ä¸å¤§äº 58ã€‚\n\n**è§£æ³•ä¸€**\n\nåˆ«é—®ï¼Œé—®å°±æ˜¯æš´åŠ›\n\n![leetCodeé¢˜è§£97wgl](http://static.imlgw.top/blog/20190822/BKqmfoXMVq3Q.png?imageslim)\n\n**é€’æ¨å¼ï¼š** `F(n) = max {i * F(n - i)}ï¼Œi = 1ï¼Œ2ï¼Œ...ï¼Œn - 1`  \n\nç©·ä¸¾æ¯ä¸€ç§åˆ†è§£æƒ…å†µï¼Œæ±‚æœ€å¤§å€¼\n\n```java\npublic static int integerBreak(int n) {\n    //é€’å½’å‡ºå£\n    if (n==2) {\n        return 1;\n    }\n    int res=-1;\n    for (int j=1;j<n;j++) {\n        //ç¬¬ä¸€ä¸ªMaxæ±‚æœ€å¤§å€¼ï¼Œç¬¬äºŒä¸ªMaxä¸»è¦æ˜¯ä¸ºäº†è€ƒè™‘ åªåˆ†ä¸¤ä¸ªæ•°å°±æ˜¯æœ€å¤§å€¼çš„æƒ…å†µï¼ˆ<=7çš„æƒ…å†µï¼‰\n        res=Math.max(res, Math.max((n-j)*j,integerBreak(n-j)*j));\n    }\n    return res;\n}\n```\n\néœ€è¦æ³¨æ„çš„å°±æ˜¯ç¬¬äºŒä¸ªMax åˆ«å¿˜äº†**åªåˆ†ä¸ºä¸¤ä¸ªæ•°å°±åˆ°è¾¾æœ€å¤§å€¼**çš„æƒ…å†µï¼Œæ¯”å¦‚n<=7çš„æ—¶å€™ï¼Œ`integerBreak(n-j)*j)`  è‡³å°‘æ˜¯ä¸‰ä¸ªï¼Œä¸‹é¢çš„DPä¹Ÿæ˜¯ä¸€æ ·çš„è¦æ³¨æ„åˆ«å¿˜äº†ä¸¤ä¸ªæ•°çš„æƒ…å†µ\n\né€’å½’çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯`O(N!)` ï¼Œåé¢çš„caseä¼šè¶…æ—¶ï¼Œå…¶å®å¾ˆæ˜æ˜¾ï¼Œé€’å½’è¿‡ç¨‹ä¸­ä¼šæœ‰å¾ˆå¤šçš„é‡å¤è®¡ç®—æ‰€ä»¥å¯ä»¥é‡‡ç”¨è®°å¿†åŒ–é€’å½’ç¼“å­˜ä¸€ä¸‹ä¹‹å‰çš„å€¼ã€‚\n\n```java\nprivate  Integer[] cache=null;\n//åªé¡¶å‘ä¸‹,è®°å¿†åŒ–é€’å½’\npublic  int integerBreak(int n) {\n    cache=new Integer[n+1];\n    return breakInteger(n);\n}\npublic  int breakInteger(int n) {\n    if (cache[n]!=null) {\n        return cache[n];\n    }\n    //é€’å½’å‡ºå£\n    if (n==2) {\n        return 1;\n    }\n    int res=-1;\n    for (int j=1;j<n;j++) {\n        res=Math.max(res, Math.max((n-j)*j,breakInteger(n-j)*j));\n    }\n    cache[n]=res;\n    return res;\n}\n```\nè¿™æ ·çš„è§£æ³•æ˜¯å¯ä»¥ACçš„ï¼Œç¼“å­˜ä¹‹å‰è®¡ç®—çš„ç»“æœï¼Œé¿å…äº†é‡å¤çš„è®¡ç®—\n\n**è§£æ³•äºŒ**\n\nåŠ¨æ€è§„åˆ’ï¼Œç»“åˆä¸Šé¢çš„é€’å½’å¾—åˆ°`é€’æ¨æ–¹ç¨‹`\n\n`dp[i] = max(dp[i]ï¼Œmax(dp[ i-j ] * j ï¼Œ(i-j) * j));`\n\n```java\npublic static int integerBreak2(int n) {\n    if (n==2) {\n        return 1;\n    }\n    int [] dp=new int[n+1];\n    dp[2]=1; //0,1ä¸è€ƒè™‘\n    for (int i=3;i<=n;i++) {\n        for (int j=1;j<i;j++) {\n            dp[i]=Math.max(dp[i],Math.max(dp[i-j]*j,(i-j)*j));\n        }\n    }\n    return dp[n];\n}\n```\n**è§£æ³•ä¸‰**\n\næ‰“æ¿æ‰¾è§„å¾‹ï¼Œç¬”è¯•çš„æ—¶å€™èƒ½ç›´æ¥ä¸€çœ¼çœ‹å‡ºæ¥è§„å¾‹çš„è‚¯å®šä¼˜å…ˆæ‰¾è§„å¾‹äº†\n\n```java\npublic static int integerBreak3(int n) {\n    int[] base={1,2,4,6,9,12};\n    if(n<=7){\n        return base[n-2];\n    }\n    int[] dp=new int[n+1];\n    dp[2]=base[0];\n    dp[3]=base[1];\n    dp[4]=base[2];\n    dp[5]=base[3];\n    dp[6]=base[4];\n    dp[7]=base[5];\n    for (int i=8;i<=n;i++) {\n        dp[i]=dp[i-3]*3; //N>7ä¹‹å dp[N]=dp[N-3]*3\n    }\n    return dp[n];\n}\n```\n\n**è§£æ³•å››**\n\næ•°å­¦åˆ†æï¼Œå…¶å®åˆ†æä¸€ä¸‹ä¼šå‘ç°ï¼Œåªæœ‰2å’Œ3æ˜¯åˆ†è§£åå€¼æ¯”**æœ¬èº«è¿˜è¦å°**çš„ï¼Œ4åˆ†è§£åç›¸ç­‰ï¼Œè¿™æ ·ä¸€åˆ†æï¼Œä»æ•´ä½“ä¸Šæ¥çœ‹å…¶å®å°±æ¸…æ¥šäº†ï¼Œåªè¦åˆ†åˆ°2æˆ–è€…3çš„æ—¶å€™å°±ä¸å†åˆ†å°±è¡Œäº†ï¼Œæ­¤æ—¶çš„å€¼ä¸€å®šæ˜¯æœ€å¤§å€¼ï¼Œå¦‚æœ2ï¼Œ3ç»§ç»­åˆ†å€¼å°±ä¼šå‡å°\n\n```java\npublic int integerBreak(int n) {\n    int[] base={1,2,4};\n    if(n<=4){\n        return base[n-2];\n    }\n    int res=1;\n    while(n>=5){\n        res*=3;\n        n-=3;\n    }\n    res*=n;\n    return res;\n}\n```\n\nå–æ¨¡å†™æ³•ï¼Œè¿™é‡Œå…¶å®æ¶‰åŠåˆ°å–æ¨¡çš„ä¸€ä¸ªè§„åˆ™ï¼Œ`(a*b)%mod=(a%mid * b%mid) % mod` \n\n```java\npublic int cuttingRope(int n) {\n    if(n<=3) return n-1;\n    long res=1;\n    while(n>=5){\n        n-=3;\n        res=(res*3)%1000000007;\n    }\n    return (int)(res*n%1000000007);\n}\n```\n\n## [279. å®Œå…¨å¹³æ–¹æ•°](https://leetcode-cn.com/problems/perfect-squares/)\n\nç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, ...ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: n = 12\nè¾“å‡º: 3 \nè§£é‡Š: 12 = 4 + 4 + 4.\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: n = 13\nè¾“å‡º: 2\nè§£é‡Š: 13 = 4 + 9.\n```\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’ï¼Œä¸å®¹æ˜“å•Šï¼Œè‡ªå·±æ¨å‡ºäº†DPæ–¹ç¨‹ï¼Œæ²¡çœ‹ç­”æ¡ˆï¼Œå…¶å®ä¹Ÿå€Ÿé‰´äº†ä¸Šä¸€é¢˜çš„æ€è·¯\n\n`dp[i] =min(dp[i]ï¼Œdp[i-j*j]+1)` \n\nå…¶å®ä¹Ÿæ˜¯å°†æ•´æ•°æ‹†åˆ†ï¼Œä¸è¿‡æ‹†åˆ†çš„æ—¶å€™æŒ‰ç…§ **å®Œå…¨å¹³æ–¹æ•°** æ¥æ‹†åˆ†ï¼Œå®Œå…¨å¹³æ–¹æ•°çš„è‚¯å®šæ˜¯ 1æ‰€ä»¥æœ€åè¦åŠ ä¸ª 1\n\n```java\npublic static int numSquares(int n) {\n    int[] dp=new int[n+1];\n    dp[0]=0;\n    for (int i=1;i<=n;i++) {\n        dp[i]=Integer.MAX_VALUE; //dp[i]åˆå§‹åŒ–\n        for (int j=1;i>=j*j;++j){\n            dp[i]=Math.min(dp[i],dp[i-j*j]+1);\n        }\n    }\n    return dp[n];\n}\n```\n50%å·¦å³ï¼Œçœ‹äº†ä¸‹æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯ `O(N^1.5)`  è¿˜æ˜¯æŒºé«˜çš„ï¼ˆè¯„è®ºåŒºç”¨Pyçš„éƒ½è¶…æ—¶äº†ï¼‰\n\n**è§£æ³•äºŒ**\n\nBFSï¼Œå°†æ•°å­—æŒ‰ç…§å®Œå…¨å¹³æ–¹æ•°è¿æ¥ä¸ºä¸€ä¸ªå›¾ï¼Œç„¶åBFSæ±‚ä¸€ä¸ªä»nåˆ°0çš„æœ€çŸ­çš„è·¯å¾„\n\n```java\npublic static int numSquares(int n) {\n    Queue<Pair> queue=new LinkedList<>();\n    boolean[] visit=new boolean[n+1];\n    queue.add(new Pair(n,0));\n    visit[n]=true;\n    while(!queue.isEmpty()){\n        Pair pair=queue.poll();\n        int num=pair.num;\n        int step=pair.step;\n        if (num==0) {\n            return step;\n        }\n        for (int i=1;i*i<=num;i++) {\n            int temp=num-i*i;\n            if (!visit[temp]) {\n                queue.add(new Pair(temp,step+1));\n                visit[temp]=true;\n            }\n        }\n    }\n    return -1;\n}\n\nstatic class Pair{\n    public int step;\n    public int num;\n    public Pair(int num,int step){\n        this.num=num;\n        this.step=step;\n    }\n}\n```\n\nè¿™é¢˜æœ€å¿«çš„åšæ³•åº”è¯¥æ˜¯åˆ©ç”¨ **å››å¹³æ–¹å’Œå®šç†** æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œæ‰€ä»¥æš‚æ—¶å…ˆä¸ç ”ç©¶è¿™ç§åšæ³•\n\n## [91. è§£ç æ–¹æ³•](https://leetcode-cn.com/problems/decode-ways/)\n\nä¸€æ¡åŒ…å«å­—æ¯ A-Z çš„æ¶ˆæ¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œäº†ç¼–ç ï¼š\n\n```java\n'A' -> 1\n'B' -> 2\n...\n'Z' -> 26\n```\n\n\nç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„éç©ºå­—ç¬¦ä¸²ï¼Œè¯·è®¡ç®—è§£ç æ–¹æ³•çš„æ€»æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"12\"\nè¾“å‡º: 2\nè§£é‡Š: å®ƒå¯ä»¥è§£ç ä¸º \"AB\"ï¼ˆ1 2ï¼‰æˆ–è€… \"L\"ï¼ˆ12ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"226\"\nè¾“å‡º: 3\nè§£é‡Š: å®ƒå¯ä»¥è§£ç ä¸º \"BZ\" (2 26), \"VF\" (22 6), æˆ–è€… \"BBF\" (2 2 6) ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nå“‡ï¼Œè¿™é¢˜æˆ‘åäº†ï¼Œå¥½ä¸å®¹æ˜“çœ‹å‡ºæ¥äº†é€’æ¨å…¬å¼ï¼Œè¢«è¾¹ç•Œç»™æ•´æ­»äº†ã€‚ã€‚ã€‚é¢å‘æµ‹è¯•ç”¨ä¾‹ç¼–ç¨‹ã€‚ã€‚\n\n```java\npublic static int numDecodings(String s) {\n    if (s.startsWith(\"0\")) {\n        return 0;\n    }\n    int[] s_nums=new int[s.length()];\n    for (int i=0;i<s.length();i++) {\n        s_nums[i]=Integer.valueOf(s.charAt(i)-48);\n    }\n\n    int[] dp =new int[s_nums.length];\n    Arrays.fill(dp,1);\n    dp[0]=1;\n    int res=1;\n    for (int j=1;j<s_nums.length;j++) {\n        if(s_nums[j]==0 && s_nums[j-1]==0 || (s_nums[j]==0 && s_nums[j-1]>2)){\n            //ç›´æ¥return\n            return 0;\n        }\n        if( s_nums[j]==0 || s_nums[j-1]==0 || (j<s_nums.length-1 &&s_nums[j+1]==0)){\n            //ä¸ºäº†å¤„ç† 12120è¿™ç§æƒ…å†µ\n            res*=dp[j-1];\n            continue;\n        }\n        if(s_nums[j-1]*10+s_nums[j]<=26){\n            if(j==1){\n                dp[j]=2;\n            }else{\n                dp[j]=dp[j-1]+dp[j-2];    \n            }\n        }else{\n            //åˆ’åˆ†ç‚¹ã€‚ã€‚ã€‚\n            res*=dp[j-1];\n            dp[j-1]=1;\n            dp[j]=1;\n        }\n    }\n    //æœ€åä¸€æ®µ\n    res*=dp[s_nums.length-1];\n    return res;\n}\n```\n\né¦–å…ˆè¦æ¨å‡ºè¿™é¢˜çš„é€’æ¨å…¬å¼ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨çº¸ä¸Šç”»äº†åŠå¤©æ‰çœ‹å‡ºæ¥ï¼Œå¦‚æœè¿™ä¸ªæ•°ç»„å‰åä¸¤ä¸ªå…ƒç´ ä¹‹å’Œéƒ½æ˜¯å°äº26çš„é‚£ä¹ˆè¿™ä¸€æ®µçš„ç¼–ç æ–¹å¼å°±æ˜¯ä¸€ä¸ª**æ–æ³¢æ‹‰å¥‘æ•°åˆ—** ï¼Œä¹Ÿå°±æ˜¯ `dp[i]=dp[i-1]+dp[i-2]`\n\n80%å·¦å³ï¼Œè¿™é¢˜å…¶å®ä¸€å¼€å§‹å¹¶ä¸æ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘è§‰å¾—æˆ‘å¼€å§‹çš„æ€è·¯è¿˜æ˜¯æŒºå¥½çš„ï¼Œå°†å­—ç¬¦ä¸²åˆ†æ®µï¼Œå½“å‰ä¸€ä¸ªå’Œåä¸€ä¸ªæ— æ³•åˆå¹¶çš„æ—¶å€™å°±ä½œä¸ºä¸€ä¸ªåˆ†ç•Œç‚¹ï¼Œæœ€åå°†æ¯ä¸€æ®µçš„ç¼–ç æ–¹å¼ç›¸ä¹˜å°±æ˜¯ç»“æœäº†ã€‚\n\nä½†æ˜¯ ï¼ï¼ï¼ æˆ‘å¿½ç•¥äº†0è¿™ä¸ªä¸œè¥¿äº†ï¼Œè¿™é¢˜åé¢ç»™çš„caseé‡Œé¢éƒ½æ˜¯å¸¦æœ‰0çš„ï¼ï¼ï¼ï¼å¤„ç†è¿™ä¸ªè¾¹ç•Œå¤„ç†äº†ä¸€ä¸Šåˆç»ˆäºè·‘è¿‡äº†ã€‚ã€‚ã€‚ä»£ç ä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå†™çš„å¤ªçƒ‚äº†ï¼Œè¿™ç§ä»£ç æ²¡å•¥æ„ä¹‰ï¼Œéƒ½æ˜¯èµ°ä¸€æ­¥çœ‹ä¸€æ­¥ã€‚\n\n**è§£æ³•äºŒ**\n\n```java\npublic static int numDecodings2(String s) {\n    if (s.startsWith(\"0\")) {\n        return 0;\n    }\n    int[] s_nums=new int[s.length()];\n    for (int i=0;i<s.length();i++) {\n        s_nums[i]=Integer.valueOf(s.charAt(i)-48);\n    }\n    int[] dp=new int[s.length()+1];\n    dp[0]=1;\n    dp[1]=1;\n    for (int i=2;i<=s.length();i++) {\n        int a=s_nums[i-1];\n        if(a!=0){\n            //åˆ°è¿™é‡Œdp[i]==0,æ²¡æœ‰åˆå§‹åŒ–,é»˜è®¤å°±æ˜¯0\n            //å…¶å®ç­‰ä»·äºdp[i]=dp[i-1],å»¶ç»­å‰ä¸€ä¸ªå­—ç¬¦çš„çŠ¶æ€\n            dp[i]+=dp[i-1];\n        }\n\n        if(s_nums[i-2]==0){\n            //å¦‚æœå‰å‰ä¸€ä¸ªå­—ç¬¦ä¸º0é‚£ä¹ˆå°±ä¸ç”¨dpäº†,ä¿æŒi-1çš„çŠ¶æ€å°±OK\n            continue;\n        }\n\n        //å‰å‰ä¸€ä¸ªå­—ç¬¦å’Œ\n        int b=s_nums[i-2]*10+s_nums[i-1];\n        if(b<=26){\n            dp[i]+=dp[i-2]; //ä¸Šä¸‹è¿™ä¸¤ä¸ªdpå¿…é¡»æ‰§è¡Œä¸€ä¸ªå¦åˆ™æœ€åå°± return 0\n        }\n    }\n    return dp[s_nums.length];\n}\n```\n\nè¿™ç§å†™æ³•å°±æ¸…æ™°å¤šäº†ï¼Œåˆ†æå„ç§æƒ…å†µï¼Œdpä»£è¡¨æˆªè‡³å­—ç¬¦çš„ç¼–ç æ–¹å¼\n\nğŸ’¬  `s_num[i-1]!=0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1] <=26`  \n\nç±»ä¼¼äº **112**  è¿™æ ·çš„ï¼Œè¿™å°±æ˜¯æ­£å¸¸dpçš„æƒ…å†µç¬¦åˆæ–æ³¢æ‹‰å¥‘æ•°åˆ—\n\nğŸ’¬  `s_num[i-1]==0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1] <=26`\n\nç±»ä¼¼äº **102** è¿™æ ·çš„ï¼Œè¿™æ ·å°±ç›´æ¥`ç»§æ‰¿ dp[i-2]çš„çŠ¶æ€`å°±è¡Œäº†ï¼Œç›¸å½“äº`dp[i]=dp[i-2]`\n\nğŸ’¬  `s_num[i-1]!=0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1] >26`\n\nç±»ä¼¼äº **132** è¿™æ ·çš„ï¼Œè¿™æ ·å°±ç›´æ¥`ç»§æ‰¿ dp[i-2]çš„çŠ¶æ€`å°±è¡Œäº†ï¼Œç›¸å½“äº`dp[i]=dp[i-2]`\n\nğŸ’¬ `s_num[i-1]!=0 && s_num[i-2]==0 && s_num[i-2]+s_num[i-1] <=26`\n\nç±»ä¼¼äº **...012**è¿™æ ·çš„ï¼Œ`dp[i]=dp[i-1]`\n\nğŸ’¬ `s_num[i-1]==0 && s_num[i-2]==0` æˆ–è€…`s_num[i-1]==0 && s_num[i-2]!=0 && s_num[i-2]+s_num[i-1]>26`\n\nç±»ä¼¼äº**00** å’Œ**30** è¿™æ ·çš„ï¼Œ è¿™æ ·å°±ä»£è¡¨è¿™ä¸ªå­—ç¬¦ä¸²æ— æ³•ç¼–ç äº† **dp[i]=0** æœ€åè¿”å›çš„å°±æ˜¯0\n\n## [é¢è¯•é¢˜46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²](https://leetcode-cn.com/problems/ba-shu-zi-fan-yi-cheng-zi-fu-chuan-lcof/)\n\nç»™å®šä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬æŒ‰ç…§å¦‚ä¸‹è§„åˆ™æŠŠå®ƒç¿»è¯‘ä¸ºå­—ç¬¦ä¸²ï¼š0 ç¿»è¯‘æˆ â€œaâ€ ï¼Œ1 ç¿»è¯‘æˆ â€œbâ€ï¼Œâ€¦â€¦ï¼Œ11 ç¿»è¯‘æˆ â€œlâ€ï¼Œâ€¦â€¦ï¼Œ25 ç¿»è¯‘æˆ â€œzâ€ã€‚ä¸€ä¸ªæ•°å­—å¯èƒ½æœ‰å¤šä¸ªç¿»è¯‘ã€‚è¯·ç¼–ç¨‹å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªæ•°å­—æœ‰å¤šå°‘ç§ä¸åŒçš„ç¿»è¯‘æ–¹æ³•ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 12258\nè¾“å‡º: 5\nè§£é‡Š: 12258æœ‰5ç§ä¸åŒçš„ç¿»è¯‘ï¼Œåˆ†åˆ«æ˜¯\"bccfi\", \"bwfi\", \"bczi\", \"mcfi\"å’Œ\"mzi\"\n```\n\n**æç¤ºï¼š**\n\n- `0 <= num < 231`\n\n**è§£æ³•ä¸€**\n\nä»£ç æ¯”è¾ƒä¸‘ï¼Œé€»è¾‘è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°ï¼Œå…¶å®è¿™é¢˜ç®—æ˜¯ä¸Šé¢ [91. è§£ç æ–¹æ³•](#91-è§£ç æ–¹æ³•)çš„å¼±åŒ–æ²¡æœ‰äº†0çš„é™åˆ¶ï¼Œ0æ˜¯åˆæ³•çš„æ•°å­—ï¼Œè¿™æ ·å°±èˆ’æœå¤šäº†ï¼Œä¸Šé¢è§£ç æ–¹æ³•ç¡®å®åšçš„è„‘å£³ç–¼\n\n```java\npublic int translateNum(int num) {\n    String s=String.valueOf(num);\n    int len=s.length();\n    if(len==0 || len==1) return 1;\n    int[] dp=new int[len];\n    //1 2 2 5 8\n    //1 2 3 5 5\n    dp[0]=1;\n    dp[1]=Integer.valueOf(s.substring(0,2))>25?1:2;\n    for(int i=2;i<len;i++){\n        int pre=Integer.valueOf(s.charAt(i-1))-48;\n        int cur=Integer.valueOf(s.charAt(i))-48;\n        if(pre!=0 && Integer.valueOf(pre*10+cur)<=25){\n            dp[i]=dp[i-1]+dp[i-2];\n        }else{\n            dp[i]=dp[i-1];\n        }\n    }\n    return dp[len-1];\n}\n```\n\n## [5375. æ¢å¤æ•°ç»„](https://leetcode-cn.com/problems/restore-the-array/)\n\næŸä¸ªç¨‹åºæœ¬æ¥åº”è¯¥è¾“å‡ºä¸€ä¸ªæ•´æ•°æ•°ç»„ã€‚ä½†æ˜¯è¿™ä¸ªç¨‹åºå¿˜è®°è¾“å‡ºç©ºæ ¼äº†ä»¥è‡´è¾“å‡ºäº†ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬æ‰€çŸ¥é“çš„ä¿¡æ¯åªæœ‰ï¼šæ•°ç»„ä¸­æ‰€æœ‰æ•´æ•°éƒ½åœ¨ [1, k] ä¹‹é—´ï¼Œä¸”æ•°ç»„ä¸­çš„æ•°å­—éƒ½æ²¡æœ‰å‰å¯¼ 0 ã€‚\n\nç»™ä½ å­—ç¬¦ä¸² s å’Œæ•´æ•° k ã€‚å¯èƒ½ä¼šæœ‰å¤šç§ä¸åŒçš„æ•°ç»„æ¢å¤ç»“æœã€‚\n\næŒ‰ç…§ä¸Šè¿°ç¨‹åºï¼Œè¯·ä½ è¿”å›æ‰€æœ‰å¯èƒ½è¾“å‡ºå­—ç¬¦ä¸² s çš„æ•°ç»„æ–¹æ¡ˆæ•°ã€‚\n\nç”±äºæ•°ç»„æ–¹æ¡ˆæ•°å¯èƒ½ä¼šå¾ˆå¤§ï¼Œè¯·ä½ è¿”å›å®ƒå¯¹ 10^9 + 7 å–ä½™ åçš„ç»“æœã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"1000\", k = 10000\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šå”¯ä¸€ä¸€ç§å¯èƒ½çš„æ•°ç»„æ–¹æ¡ˆæ˜¯ [1000]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"1000\", k = 10\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šä¸å­˜åœ¨ä»»ä½•æ•°ç»„æ–¹æ¡ˆæ»¡è¶³æ‰€æœ‰æ•´æ•°éƒ½ >= 1 ä¸” <= 10 åŒæ—¶è¾“å‡ºç»“æœä¸º s ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"1317\", k = 2000\nè¾“å‡ºï¼š8\nè§£é‡Šï¼šå¯è¡Œçš„æ•°ç»„æ–¹æ¡ˆä¸º [1317]ï¼Œ[131,7]ï¼Œ[13,17]ï¼Œ[1,317]ï¼Œ[13,1,7]ï¼Œ[1,31,7]ï¼Œ[1,3,17]ï¼Œ[1,3,1,7]\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"2020\", k = 30\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šå”¯ä¸€å¯èƒ½çš„æ•°ç»„æ–¹æ¡ˆæ˜¯ [20,20] ã€‚ [2020] ä¸æ˜¯å¯è¡Œçš„æ•°ç»„æ–¹æ¡ˆï¼ŒåŸå› æ˜¯ 2020 > 30 ã€‚ [2,020] ä¹Ÿä¸æ˜¯å¯è¡Œçš„æ•°ç»„æ–¹æ¡ˆï¼Œå› ä¸º 020 å«æœ‰å‰å¯¼ 0 ã€‚\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"1234567890\", k = 90\nè¾“å‡ºï¼š34\n```\n\n**æç¤ºï¼š**\n\n- 1 <= s.length <= 10^5.\n- s åªåŒ…å«æ•°å­—ä¸”ä¸åŒ…å«å‰å¯¼ 0 ã€‚\n- 1 <= k <= 10^9.\n\n**è§£æ³•ä¸€**\n\n24thåŒå‘¨èµ›çš„T4ï¼Œå…¶å®dpçš„çŠ¶æ€è½¬æ¢è¿˜æ˜¯æƒ³å‡ºæ¥äº†ï¼Œæˆ‘æƒ³çš„æ˜¯ä»å·¦å‘å³ï¼Œä½†æ˜¯ç»†èŠ‚æ²¡ç†æ¸…æ¥šï¼Œç„äº†ä¸€çœ¼è¯„è®ºåŒºï¼Œå‘ç°ä»å³å¾€å·¦æ¯”è¾ƒç®€å•\n\n```java\npublic int numberOfArrays(String s, int k) {\n    int mod=1_000_000_000 + 7;\n    int[] dp=new int[s.length()+1];        \n    dp[0]=1;\n    //dp[i]=dp[i-1]+dp[i-2]+...+dp[0];\n    for (int i=1;i<=s.length();i++) {\n        for (int j=i-1;j>=0 && i-j<=9;j--) {\n            if(s.charAt(j)!='0' && valid(s,j,i,k)){ //éªŒè¯å³è¾¹æ˜¯å¦æ»¡è¶³\n                dp[i]=(dp[i]+dp[j])%mod;\n            }\n        }\n    }\n    return dp[s.length()];\n}\n\n//10 0000 0000\npublic boolean valid(String s,int j,int i,int k){\n    long value=Long.valueOf(s.substring(j,i));\n    return value<=k && value>=1;\n}\n```\næˆ‘å¼€å§‹ä»¥ä¸ºæ—¶é—´å¤æ‚åº¦æ˜¯`O(N^2)`ä¼šTæ‰ï¼Œåæ¥å†™å‡ºæ¥æ‰å‘ç°å…¶å®æ—¶é—´å¤æ‚åº¦å…¶å®æ˜¯`O(10N)` ï¼Œå¹¶ä¸éš¾ï¼Œè¿˜æ˜¯é¢˜ç›®å†™å°‘äº†å•Šï¼ï¼ï¼\n\n**è§£æ³•äºŒ**\n\nä¸€ç‚¹å°ä¼˜åŒ–\n\n```java\npublic int numberOfArrays(String s, int k) {\n    int mod=1_000_000_000 + 7;\n    int[] dp=new int[s.length()+1];        \n    dp[0]=1;\n    for (int i=1;i<=s.length();i++) {\n        for (int j=i-1;j>=0 && i-j<=9;j--) {\n            if(s.charAt(j)=='0') continue;\n            long value=Long.valueOf(s.substring(j,i));\n            if(value>k) break; //è¿™ä¸€æ­¥å…¶å®æ˜¯å¯¹ä¸Šé¢è§£æ³•çš„ä¼˜åŒ–\n            dp[i]=(dp[i]+dp[j])%mod;\n        }\n    }\n    return dp[s.length()];\n}\n```\n## [300. æœ€é•¿ä¸Šå‡å­åºåˆ—](https://leetcode-cn.com/problems/longest-increasing-subsequence/)\n\nç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [10,9,2,5,3,7,101,18]\nè¾“å‡º: 4 \nè§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ 4ã€‚\n```\n\n**è¯´æ˜:**\n\n- å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚\n- ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º O(n2) ã€‚\n- è¿›é˜¶: ä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° O(n log n) å—?\n\n**è§£æ³•ä¸€**\n\nLISï¼Œè¿™é¢˜å¥½åƒåœ¨å¾ˆå¤šåœ°æ–¹è§åˆ°è¿‡äº†ï¼Œè¿˜æ˜¯è¦å¥½å¥½ç†è§£ä¸‹ï¼Œ**dp[i]è¡¨ç¤ºä»¥å½“å‰å…ƒç´ ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦**\n\n```java\npublic static int lengthOfLIS(int[] nums) {\n    if (nums==null||nums.length<=0) {\n        return 0;\n    }\n    int[] dp=new int[nums.length];\n    //Arrays.fill(dp,1);\n    dp[0]=1;\n    for (int i=1;i<nums.length;i++) {\n        dp[i]=1; //åˆå§‹åŒ–dp[i]=1\n        for (int j=0;j<i;j++) {\n            if(nums[i]>nums[j]){\n                //éå†iä¹‹å‰çš„å…ƒç´ ,æ‰¾ä¸€ä¸ªæœ€å¤§çš„dp[j]+1\n                dp[i]=Math.max(dp[j]+1,dp[i]);\n            }\n        }\n    }\n    int res=-1;\n    for (int i=0;i<dp.length;i++) {\n        res=res>dp[i]?res:dp[i];\n    }\n    return res;\n}\n```\n\nä¸€å¼€å§‹é¢˜ç›®å°±æ²¡çœ‹æ¸…æ¥šå°±å¼€å§‹åšï¼Œä»¥ä¸ºæ˜¯è¿ç»­çš„ï¼Œå¿ƒæƒ³è¿™ä¸æ˜¯O(N)çš„ä¹ˆï¼Œä¸ºå•¥è¦æˆ‘å†™O(N^2)çš„ğŸ¤£ \n\n![mark](http://static.imlgw.top/blog/20190824/86VLMN8VWcpI.png?imageslim)\n\nçµé­‚ç”»æ‰‹ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€é“å¾ˆç®€å•çš„DP(ç„¶è€Œæˆ‘è¿˜æ˜¯æ²¡æƒ³å‡ºæ¥)ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜O(N^2)ï¼Œå¯ä»¥ä¼˜åŒ–æˆO(NlogN)\n\n**è§£æ³•äºŒ**\n\n`è´ªå¿ƒ+äºŒåˆ†`  è¿™ä¸ªè´ªå¿ƒè¿˜æ˜¯æœ‰ç‚¹éªšçš„ï¼Œæ ¸å¿ƒæ€æƒ³ï¼š\n\n**å¦‚æœå‰é¢çš„æ•°è¶Šå°ï¼Œåé¢æ¥ä¸Šä¸€ä¸ªéšæœºæ•°ï¼Œå°±ä¼šæœ‰æ›´å¤§çš„å¯èƒ½æ€§æ„æˆä¸€ä¸ªæ›´é•¿çš„â€œä¸Šå‡å­åºåˆ—â€ã€‚**\n\nå®šä¹‰`tail`æ•°ç»„ï¼Œ`tail[i]`ä¸­å­˜å‚¨é•¿åº¦ä¸º `i + 1` çš„æœ€é•¿é€’å¢å­åºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯ç»´æŠ¤tailæ•°ç»„ï¼Œä½¿å¾—å„ä¸ªé•¿åº¦çš„`tail[i]`çš„å°½å¯èƒ½åœ°å°ï¼Œè¿™æ ·åé¢èƒ½æ¥çš„é•¿åº¦å°±è¶Šé•¿ï¼Œå¾ˆæ˜æ˜¾tailæ˜¯ä¸ªå•è°ƒé€’å¢çš„æ•°ç»„ï¼ˆåè¯ï¼‰æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨éå†numsçš„æ—¶å€™åœ¨tailæ•°ç»„ä¸­äºŒåˆ†å¯»æ‰¾ç¬¬ä¸€ä¸ªå¤§äºnums[i]çš„å…ƒç´ ï¼Œç”¨nums[i]æ›¿æ¢è¯¥ä½ç½®çš„å…ƒç´ ï¼Œè¿™æ ·å°±ä½¿å¾—`tail[i]`æ˜¯å½“å‰nums[i]ä¹‹å‰ï¼Œé•¿åº¦ä¸ºi+1çš„é€’å¢åºåˆ—æœ€å°çš„ç»“å°¾å…ƒç´ ï¼Œå½“æˆ‘ä»¬éå†å®Œæ‰€æœ‰çš„å…ƒç´ ï¼Œtailæ•°ç»„çš„é•¿åº¦å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„æœ€é•¿é€’å¢å­åºåˆ—é•¿åº¦ï¼ˆæ³¨æ„tailä¸ä¸€å®šæ˜¯åˆæ³•çš„æœ€é•¿é€’å¢å­åºåˆ—ï¼Œå¦‚æœè¦æ±‚å‡ºå­åºåˆ—å¯ä»¥åœ¨é•¿åº¦å¢åŠ çš„æ—¶å€™æ‹·è´ä¸€ä»½é•¿åº¦ä¸º`i-1`çš„æ•°ç»„ï¼Œç„¶åå†æ“ä½œï¼‰\n\n2020.3.20\n\n```java\npublic static int lengthOfLIS(int[] nums) {\n    int[] top = new int[nums.length];\n    int len = 0;\n    for (int num : nums) {\n        //å¯»æ‰¾å·¦ä¾§æœ€å°çš„å †é¡¶\n        int index=binarySearch(top,len,num);\n        if (index == len) {\n            len++;\n        }\n        top[index] = num;\n    }\n    return len;\n}\n\n//å¯ä»¥æœç´¢\nprivate static int binarySearch(int[] nums, int len, int target) {\n    int left=0,right=len;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(nums[mid]<target){\n            left=mid+1;\n        }else {\n            right=mid;\n        }\n    }\n    return left;\n}\n```\né¦–å…ˆæ˜¯è®°ä½äº†è¿™ä¸ªå¥—è·¯ï¼Œç„¶åä¼˜åŒ–äº†äºŒåˆ†çš„å†™æ³•\n\n![mark](http://static.imlgw.top/blog/20200320/zhcxcxmK4Amt.png?imageslim)\n\n\nï¼ˆcopyè‡ªä»liweiweiå¤§ä½¬ [é¢˜è§£](https://leetcode-cn.com/problems/longest-increasing-subsequence/solution/dong-tai-gui-hua-er-fen-cha-zhao-tan-xin-suan-fa-p/)ï¼‰\n\n## [673. æœ€é•¿é€’å¢å­åºåˆ—çš„ä¸ªæ•°](https://leetcode-cn.com/problems/number-of-longest-increasing-subsequence/)\n\nç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°æœ€é•¿é€’å¢å­åºåˆ—çš„ä¸ªæ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,3,5,4,7]\nè¾“å‡º: 2\nè§£é‡Š: æœ‰ä¸¤ä¸ªæœ€é•¿é€’å¢å­åºåˆ—ï¼Œåˆ†åˆ«æ˜¯ [1, 3, 4, 7] å’Œ[1, 3, 5, 7]ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [2,2,2,2,2]\nè¾“å‡º: 5\nè§£é‡Š: æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦æ˜¯1ï¼Œå¹¶ä¸”å­˜åœ¨5ä¸ªå­åºåˆ—çš„é•¿åº¦ä¸º1ï¼Œå› æ­¤è¾“å‡º5ã€‚\n```\n\n**æ³¨æ„:** ç»™å®šçš„æ•°ç»„é•¿åº¦ä¸è¶…è¿‡ 2000 å¹¶ä¸”ç»“æœä¸€å®šæ˜¯32ä½æœ‰ç¬¦å·æ•´æ•°ã€‚\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹è¿˜æ²¡æƒ³åˆ°ï¼Œå±å®èœé¸¡\n\n```java\npublic int findNumberOfLIS(int[] nums) {\n    int n=nums.length;\n    //dp[i][0]ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—,dp[i][1]ä»£è¡¨ä¸ªæ•°\n    int[][] dp=new int[n][2];\n    int max=0;\n    for(int i=0;i<n;i++){\n        dp[i][1]=1;\n        for(int j=0;j<i;j++){\n            if(nums[i]>nums[j]){\n                if(dp[j][0]+1==dp[i][0]){\n                    dp[i][1]+=dp[j][1];\n                }else if(dp[j][0]+1>dp[i][0]){\n                    dp[i][1]=dp[j][1];\n                    dp[i][0]=dp[j][0]+1;\n                }\n            }\n        }\n        max=Math.max(max,dp[i][0]);\n    }\n    int res=0;\n    for(int i=0;i<nums.length;i++) {\n        res+=dp[i][0]==max?dp[i][1]:0;   \n    }\n    return res;\n}\n```\n\n\n## [1016. ä½¿åºåˆ—é€’å¢çš„æœ€å°äº¤æ¢æ¬¡æ•°ï¼ˆLintCodeï¼‰](https://www.lintcode.com/problem/minimum-swaps-to-make-sequences-increasing/description)\n\n\næœ‰ä¸¤ä¸ªå…·æœ‰ç›¸åŒéé›¶é•¿åº¦çš„æ•´æ•°åºåˆ—Aå’ŒBã€‚å¯ä»¥äº¤æ¢å®ƒä»¬çš„ä¸€äº›å…ƒç´ A[i]å’ŒB[i]ã€‚ æ³¨æ„ï¼Œä¸¤ä¸ªå¯äº¤æ¢çš„å…ƒç´ åœ¨å®ƒä»¬å„è‡ªçš„åºåˆ—ä¸­å¤„äºç›¸åŒçš„ç´¢å¼•ä½ç½®ã€‚è¿›è¡Œä¸€äº›äº¤æ¢ä¹‹åï¼ŒAå’ŒBéœ€è¦ä¸¥æ ¼é€’å¢ã€‚ ï¼ˆå½“ä¸”ä»…å½“A[0] < A[1] < A[2] < ... < A[A.length - 1]æ—¶ï¼Œåºåˆ—ä¸¥æ ¼é€’å¢ã€‚ï¼‰\n\nç»™å®šAå’ŒBï¼Œè¿”å›ä½¿ä¸¤ä¸ªåºåˆ—ä¸¥æ ¼é€’å¢çš„æœ€å°äº¤æ¢æ¬¡æ•°ã€‚ ä¿è¯ç»™å®šçš„è¾“å…¥ç»è¿‡äº¤æ¢å¯ä»¥æ»¡è¶³é€’å¢çš„æ¡ä»¶ã€‚\n\n**æ³¨æ„**\n- A, B æ˜¯é•¿åº¦ç›¸åŒçš„æ•°ç»„, å®ƒä»¬çš„é•¿åº¦èŒƒå›´ä¸º [1, 1000]ã€‚\n- A[i], B[i] æ˜¯åœ¨ [0, 2000]èŒƒå›´å†…çš„æ•´æ•°ã€‚\n\n**æ ·ä¾‹ 1**\n```go\nè¾“å…¥: A = [1,3,5,4], B = [1,2,3,7]\nè¾“å‡º: 1\nè§£é‡Š: äº¤æ¢A[3] and B[3]. ä¸¤ä¸ªåºåˆ—å˜ä¸º:\n  A = [1,3,5,7] å’Œ B = [1,2,3,4],\n  æ­¤æ—¶å®ƒä»¬éƒ½æ˜¯ä¸¥æ ¼é€’å¢çš„ã€‚\n```\n**æ ·ä¾‹ 2:**\n```go\nè¾“å…¥: A = [2,4,5,7,10], B = [1,3,4,5,9]\nè¾“å‡º: 0\n```\n\n**è§£æ³•ä¸€**\n\nç›´æ¥æŠ„ç­”æ¡ˆï¼Œå¾ˆå·§å¦™çš„åŒåºåˆ—å‹dpï¼Œä¸çœ‹ç­”æ¡ˆçœŸæƒ³ä¸å‡ºæ¥\n```java\npublic int minSwap(int[] A, int[] B) {\n    if (A == null || B == null || A.length <=0 || B.length <= 0){\n        return 0;\n    }\n    // Write your code here\n    int n = A.length;\n    int INF = 0x3f3f3f3f;\n    //dp[i][0]: Aå’ŒBå‰iä¸ªå­—ç¬¦éƒ½ä¿æŒæœ‰åºï¼Œå¹¶ä¸”ä¸äº¤æ¢ç¬¬iä¸ªå…ƒç´ çš„æœ€å°äº¤æ¢æ¬¡æ•°\n    //dp[i][1]: Aå’ŒBå‰iä¸ªå­—ç¬¦éƒ½ä¿æŒæœ‰åºï¼Œå¹¶ä¸”äº¤æ¢ç¬¬iä¸ªå…ƒç´ çš„æœ€å°äº¤æ¢æ¬¡æ•°\n    int[][] dp = new int[n][2];\n    for(int i = 0; i < n; i++){\n        Arrays.fill(dp[i], INF);\n    }\n    dp[0][0] = 0; dp[0][1] = 1;\n    for(int i = 1; i < n; i++){\n        //å¾ˆå·§å¦™çš„åˆ†ç±»è®¨è®º\n        if(A[i] > A[i-1] && B[i] > B[i-1]){\n            //å‰åéƒ½ä¸äº¤æ¢\n            dp[i][0] = dp[i-1][0];\n            //å‰åéƒ½äº¤æ¢\n            dp[i][1] = dp[i-1][1]+1; \n        }\n        if(A[i] > B[i-1] && B[i] > A[i-1]){\n            //å½“å‰ä¸äº¤æ¢ï¼Œäº¤æ¢å‰é¢çš„\n            dp[i][0] = Math.min(dp[i][0], dp[i-1][1]);\n            //å½“å‰äº¤æ¢ï¼Œå‰é¢ä¸äº¤æ¢\n            dp[i][1] = Math.min(dp[i][1], dp[i-1][0]+1);\n        }\n    }\n    int res = Math.min(dp[n-1][0],dp[n-1][1]);\n    return  res == INF ? 0 : res;\n}\n```\n\n## [354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°é—®é¢˜](https://leetcode-cn.com/problems/russian-doll-envelopes/)\n\nç»™å®šä¸€äº›æ ‡è®°äº†å®½åº¦å’Œé«˜åº¦çš„ä¿¡å°ï¼Œå®½åº¦å’Œé«˜åº¦ä»¥æ•´æ•°å¯¹å½¢å¼ `(w, h)` å‡ºç°ã€‚å½“å¦ä¸€ä¸ªä¿¡å°çš„å®½åº¦å’Œé«˜åº¦éƒ½æ¯”è¿™ä¸ªä¿¡å°å¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªä¿¡å°å°±å¯ä»¥æ”¾è¿›å¦ä¸€ä¸ªä¿¡å°é‡Œï¼Œå¦‚åŒä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ã€‚\n\nè¯·è®¡ç®—æœ€å¤šèƒ½æœ‰å¤šå°‘ä¸ªä¿¡å°èƒ½ç»„æˆä¸€ç»„â€œä¿„ç½—æ–¯å¥—å¨ƒâ€ä¿¡å°ï¼ˆå³å¯ä»¥æŠŠä¸€ä¸ªä¿¡å°æ”¾åˆ°å¦ä¸€ä¸ªä¿¡å°é‡Œé¢ï¼‰ã€‚\n\n**è¯´æ˜:**\nä¸å…è®¸æ—‹è½¬ä¿¡å°ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: envelopes = [[5,4],[6,4],[6,7],[2,3]]\nè¾“å‡º: 3 \nè§£é‡Š: æœ€å¤šä¿¡å°çš„ä¸ªæ•°ä¸º 3, ç»„åˆä¸º: [2,3] => [5,4] => [6,7]ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic int maxEnvelopes(int[][] envelopes) {\n    int [] dp=new int[envelopes.length];\n    //lamdbaä¼šæ¯”è¾ƒæ…¢\n    Arrays.sort(envelopes,(a,b)->(a[0]-b[0])); //ä¿è¯åé¢çš„ä¸ä¼šè¢«å‰é¢çš„è£…è¿›å»å°±è¡Œäº†\n    int res=0;\n    for (int i=0;i<envelopes.length;i++) {\n        dp[i]=1;\n        for (int j=0;j<i;j++) {\n            if (envelopes[i][0]>envelopes[j][0] && envelopes[i][1]>envelopes[j][1]){\n                dp[i]=Math.max(dp[j]+1,dp[i]);\n            }\n        }\n        res=Math.max(res,dp[i]);\n    }\n    return res;\n}\n```\nå…¶å®å’Œä¸Šé¢çš„LISæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘æ”¾åœ¨äº†ä¸€èµ·ï¼Œå·®ç‚¹bugfreeï¼Œè¢«ç©ºè¾“å…¥å‘äº†ä¸€å‘ï¼Œå¯æƒœè¿™ä¸ªè§£æ³•å¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œè€Œä¸”ä¹Ÿä¸ç¬¦åˆè¿™é¢˜çš„å›°éš¾tagï¼Œè¿™é¢˜çš„æœ€ä¼˜è§£åº”è¯¥æ˜¯åˆ©ç”¨ä¸Šé¢çš„è´ªå¿ƒ+äºŒåˆ†çš„åšæ³•ï¼Œè¿™é‡Œå®åœ¨æ˜¯èƒ½åŠ›æ—¶é—´éƒ½æœ‰é™ï¼Œæ²¡æ³•å»ç ”ç©¶é‚£ç§è§£æ³•ï¼Œæš‚ä¸”å…ˆç”¨è¿™ä¸ªè§£æ³•å§\n\n**è§£æ³•äºŒ**\n\n2020.3.20 é˜¿é‡Œç¬”è¯•è€ƒäº†è¿™ä¸€é¢˜ï¼Œdpè¶…æ—¶äº†ã€‚ã€‚ã€‚ã€‚\n\n```java\npublic int maxEnvelopes(int[][] envelopes) {\n    Arrays.sort(envelopes,(a,b)->a[0]!=b[0]?a[0]-b[0]:b[1]-a[1]); //è¿™ä¸ªæ’åºå¾ˆå…³é”®\n    int N=envelopes.length;\n    int[] top=new int[N];\n    int len=0;\n    for(int i=0;i<N;i++){\n        int cur=envelopes[i][1];\n        //äºŒåˆ†æœç´¢å †é¡¶ï¼Œæ‰¾ç¬¬ä¸€ä¸ªå°äºå½“å‰ç‰Œçš„\n        int index=binarySearch(top,cur,len);\n        if(index==len){ //æ²¡æ‰¾åˆ°åˆé€‚çš„ä½ç½®\n            len++; //æ–°å»ºç‰Œå †ï¼Œç‰Œå †++\n        }\n        top[index]=cur;\n    }\n    return len;\n}\n\npublic int binarySearch(int[] top,int target,int len){\n    int left=0,right=len;\n    while(left<right){\n        int mid=left+(right-left)/2;\n        if(top[mid]<target){\n            left=mid+1;\n        }else{\n            right=mid;\n        }\n    }\n    return left;\n}\n```\n\nç¬¬ä¸€æ­¥çš„æ’åºå¾ˆå…³é”®ï¼Œå¦‚æœåªæŒ‰ç…§å®½åº¦æ’å¥½åºä¹‹åï¼Œå¯¹é«˜åº¦æ±‚ä¸€æ¬¡æœ€é•¿é€’å¢å­åºåˆ—å°±æ˜¯æˆ‘ä»¬çš„ç­”æ¡ˆï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯é¢˜ç›®è¯´äº†ï¼šå®½åº¦å’Œé«˜åº¦éƒ½æ¯”å½“å‰ä¿¡å°å¤§çš„æ—¶å€™æ‰èƒ½è£…è¿›å»ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä¿¡å°æ˜¯`(1,3) (1,5)`é‚£ä¹ˆå‰è€…æ˜¯ä¸èƒ½è¢«åè€…è£…è¿›å»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œåšä¸€ä¸‹å¤„ç†ï¼Œåœ¨å®½åº¦ç›¸åŒçš„æ—¶å€™ï¼Œè®©é«˜åº¦é™åºæ’åˆ—ï¼Œè¿™æ ·åœ¨å¯¹é«˜åº¦æ±‚æœ€é€’å¢å­åºåˆ—çš„æ—¶å€™å°±ä¸ä¼šå‡ºç°é”™è¯¯äº†\n\n**UPDATE: 2020.7.13**\n```golang\nfunc maxEnvelopes(env [][]int) int {\n    sort.Slice(env, func(i int, j int) bool {\n        if env[i][0] == env[j][0]{\n            return env[i][1] > env[j][1]\n        }\n        return env[i][0] < env[j][0]\n    })\n    var tail = make([]int, len(env))\n    var tlen = 0\n    for i := 0; i < len(env); i++{\n        idx := search(tail, env[i][1], tlen)\n        if idx == tlen{\n            tlen++\n        }\n        tail[idx] = env[i][1]\n    }\n    return tlen\n}\n\nfunc search(nums []int, target int, tlen int) int {\n    var left = 0\n    var right = tlen-1\n    var res = tlen\n    for left <= right{\n        mid := left+(right-left)/2\n        if nums[mid] >= target{\n            res = mid\n            right = mid - 1\n        }else{\n            left = mid + 1\n        }\n    }\n    return res\n}\n```\n\n## [53. æœ€å¤§å­åºå’Œ](https://leetcode-cn.com/problems/maximum-subarray/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],\nè¾“å‡º: 6\nè§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚\n```\n\n**è¿›é˜¶:**\n\nå¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’é€’æ¨çš„è§£æ³•ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œè¿™é¢˜å…¶å®è¿˜æœ‰ä¸€é“å§Šå¦¹é¢˜ï¼Œè¦æ±‚å‡ºæœ€å¤§å­åºåˆ—ï¼Œä¸ä»…ä»…æ˜¯æœ€å¤§å€¼ï¼Œ[æˆ‘æ”¾åˆ°äº†æ»‘åŠ¨çª—å£ä¸“é¢˜ä¸­]((http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou-tag/#239-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC)) \n\n```java\n//è¿™æ¬¡æ˜¯ç›´æ¥åœ¨Webä¸Šå†™çš„\npublic int maxSubArray(int[] nums) {\n    if(nums==null || nums.length==0){\n        return 0;\n    }\n    int[] dp=new int[nums.length];\n    //ä¸€å¼€å§‹æ²¡å¤„ç†å¥½Waäº†ä¸€å‘\n    int max=dp[0]=nums[0];\n    for(int i=1;i<nums.length;i++){\n        if(dp[i-1]<=0){\n            dp[i]=nums[i];\n        }else{\n            dp[i]=dp[i-1]+nums[i];\n        }\n        max=Math.max(max,dp[i]);\n    }\n    return max;\n}\n```\n**è§£æ³•äºŒ**\n\næ ¹æ®äºŒç»´æ”¹ä¸€ç»´\n\n```java\npublic int maxSubArray(int[] nums) {\n    if(nums==null || nums.length==0){\n        return 0;\n    }\n    int dp1=nums[0],dp2=0,max=nums[0];\n    for (int i=1;i<nums.length;i++) {\n        if (dp1<=0) {\n            dp2=nums[i];\n        }else{\n            dp2=dp1+nums[i];\n        }\n        dp1=dp2;\n        max=Math.max(max,dp2);\n    }\n    return max;\n}\n```\n\næ„Ÿè§‰ä¸€ç»´çš„ä¸ç”¨å»ç†è§£å«ä¹‰ï¼Œèƒ½æ ¹æ®äºŒç»´æ”¹å‡ºæ¥å°±okäº†ï¼Œé‡ç‚¹æ˜¯ç†è§£å¤šç»´çš„\n\n## [646. æœ€é•¿æ•°å¯¹é“¾](https://leetcode-cn.com/problems/maximum-length-of-pair-chain/)\n\nç»™å‡º `n` ä¸ªæ•°å¯¹ã€‚ åœ¨æ¯ä¸€ä¸ªæ•°å¯¹ä¸­ï¼Œç¬¬ä¸€ä¸ªæ•°å­—æ€»æ˜¯æ¯”ç¬¬äºŒä¸ªæ•°å­—å°ã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ç§è·Ÿéšå…³ç³»ï¼Œå½“ä¸”ä»…å½“ `b < c` æ—¶ï¼Œæ•°å¯¹`(c, d)` æ‰å¯ä»¥è·Ÿåœ¨ `(a, b)` åé¢ã€‚æˆ‘ä»¬ç”¨è¿™ç§å½¢å¼æ¥æ„é€ ä¸€ä¸ªæ•°å¯¹é“¾ã€‚\n\nç»™å®šä¸€ä¸ªå¯¹æ•°é›†åˆï¼Œæ‰¾å‡ºèƒ½å¤Ÿå½¢æˆçš„æœ€é•¿æ•°å¯¹é“¾çš„é•¿åº¦ã€‚ä½ ä¸éœ€è¦ç”¨åˆ°æ‰€æœ‰çš„æ•°å¯¹ï¼Œä½ å¯ä»¥ä»¥ä»»ä½•é¡ºåºé€‰æ‹©å…¶ä¸­çš„ä¸€äº›æ•°å¯¹æ¥æ„é€ ã€‚\n\n**ç¤ºä¾‹ :**\n\n```java\nè¾“å…¥: [[1,2], [2,3], [3,4]]\nè¾“å‡º: 2\nè§£é‡Š: æœ€é•¿çš„æ•°å¯¹é“¾æ˜¯ [1,2] -> [3,4]\n```\n\n**æ³¨æ„ï¼š**\n\n- ç»™å‡ºæ•°å¯¹çš„ä¸ªæ•°åœ¨ [1, 1000] èŒƒå›´å†…ã€‚\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’\n\n```java\npublic int findLongestChain(int[][] pairs) {\n    Arrays.sort(pairs,(a,b)->a[0]-b[0]);\n    int[] dp=new int[pairs.length];\n    int res=0;\n    for (int i=0;i<pairs.length;i++) {\n        dp[i]=1;\n        for (int j=0;j<i;j++) {\n            if (pairs[i][0]>pairs[j][1]) {\n                dp[i]=Math.max(dp[i],dp[j]+1);\n            }\n        }\n        res=res>dp[i]?res:dp[i];\n    }\n    return res;\n}\n```\næ³¨æ„è¿™é‡Œæ²¡æœ‰è¦æ±‚é¡ºåºï¼Œæ‰€ä»¥å…ˆç»™ä»–æ’ä¸ªåºï¼Œç„¶åå†è¿›è¡ŒDPï¼Œå¦‚æœä¸æ’åºå¾ˆéš¾dpï¼Œdp[i]è¡¨ç¤ºå½“å‰æ•°å¯¹èƒ½æ„æˆçš„æœ€é•¿é“¾ï¼Œdpè¿‡ç¨‹å’Œä¸Šé¢çš„æœ€é•¿ä¸Šå‡å­åºåˆ—ç›¸åŒ\n\n**è§£æ³•äºŒ**\n\nè´ªå¿ƒï¼Œä¹Ÿæ˜¯æœ€ä¼˜è§£ï¼ŒåŒæ ·å…ˆæ’åºï¼Œä¸è¿‡æ˜¯æŒ‰ç…§ç¬¬äºŒä¸ªå…ƒç´ æ¥æ’åºï¼Œæ ¸å¿ƒæ€æƒ³\n\n`æ¯æ¬¡éƒ½åœ¨åˆ—è¡¨ä¸­æ‰¾ç¬¬äºŒä¸ªå…ƒç´ æœ€å°çš„æ•°å¯¹ä¾æ¬¡ç»„æˆé“¾ï¼Œæœ€åå¾—åˆ°çš„ä¸€å®šæ˜¯æœ€é•¿çš„é“¾`\n\n```java\npublic int findLongestChain(int[][] pairs) {\n    Arrays.sort(pairs,(a,b)->a[1]-b[1]);\n    int res=1;\n    int tail=pairs[0][1];\n    for (int i=1;i<pairs.length;i++) {\n        if (pairs[i][0]>tail) {\n            res++;\n            tail=pairs[i][1];\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•ä¸‰**\n\nä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„åˆ†æ²»æ³•ï¼Œåˆ†æ²»æ³•åœ¨è¿™é‡Œå¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œæ—¶é—´å¤æ‚åº¦`O(NlogN)`ï¼Œä½†æ˜¯æ€è·¯è¿˜æ˜¯å¾ˆå·§å¦™ï¼Œé¦–å…ˆä¹Ÿæ˜¯è®²æ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œç„¶åæœ€å¤§åºåˆ—å’Œå°±æœ‰ä¸‰ç§æƒ…å†µ\t\n\n1. å…¨åœ¨å·¦è¾¹\n2. å…¨åœ¨å³è¾¹\n3. è·¨ä¸­ç‚¹ï¼Œä¸¤è¾¹éƒ½æœ‰\n\nç„¶åç»Ÿè®¡ä¸‰ä¸ªå€¼å¾—æœ€å¤§å€¼ï¼Œé€’å½’å­è¿‡ç¨‹æ±‚è§£ï¼Œä»£ç å°±ä¸å†™äº†ï¼Œåé¢æƒ³èµ·æ¥æœ‰æ—¶é—´å†è¡¥\n\n## [376. æ‘†åŠ¨åºåˆ—](https://leetcode-cn.com/problems/wiggle-subsequence/)\n\nå¦‚æœè¿ç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸ºæ‘†åŠ¨åºåˆ—ã€‚ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚å°‘äºä¸¤ä¸ªå…ƒç´ çš„åºåˆ—ä¹Ÿæ˜¯æ‘†åŠ¨åºåˆ—ã€‚\n\nä¾‹å¦‚ï¼Œ `[1,7,4,9,2,5]` æ˜¯ä¸€ä¸ªæ‘†åŠ¨åºåˆ—ï¼Œå› ä¸ºå·®å€¼ `(6,-3,5,-7,3)` æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºç°çš„ã€‚ç›¸å, `[1,4,7,2,5]` å’Œ `[1,7,4,5,5]` ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚\n\nç»™å®šä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œè¿”å›ä½œä¸ºæ‘†åŠ¨åºåˆ—çš„æœ€é•¿å­åºåˆ—çš„é•¿åº¦ã€‚ é€šè¿‡ä»åŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥è·å¾—å­åºåˆ—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŸå§‹é¡ºåºã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,7,4,9,2,5]\nè¾“å‡º: 6 \nè§£é‡Š: æ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,17,5,10,13,15,10,5,16,8]\nè¾“å‡º: 7\nè§£é‡Š: è¿™ä¸ªåºåˆ—åŒ…å«å‡ ä¸ªé•¿åº¦ä¸º 7 æ‘†åŠ¨åºåˆ—ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä¸º[1,17,10,13,10,16,8]ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [1,2,3,4,5,6,7,8,9]\nè¾“å‡º: 2\n```\n\n**è¿›é˜¶:**\n\n- ä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å®Œæˆæ­¤é¢˜?\n\n**è§£æ³•ä¸€**\n\nO(N^2 )åŠ¨æ€è§„åˆ’ï¼Œdp[i]ä»£è¡¨ç›®å‰ä¸ºæ­¢ä»¥ nums[i]ç»“å°¾çš„æœ€é•¿çš„`ä¸Šå‡æ‘‡æ‘†åºåˆ—`ï¼Œdown[i]ä»£è¡¨ç›®å‰ä¸ºæ­¢ä»¥nums[i]ç»“å°¾çš„æœ€é•¿çš„`ä¸‹é™æ‘‡æ‘†åºåˆ—`ï¼Œåé¢è¿‡ç¨‹å°±å’Œä¸Šé¢çš„`LIS`çš„è§£æ³•ç±»ä¼¼äº†\n\n```java\npublic int wiggleMaxLength(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int []up=new int[nums.length]; \n    int []down=new int[nums.length]; \n    for (int i=0;i<nums.length;i++) {\n        up[i]=1; down[i]=1; //åˆå§‹åŒ–\n        for (int j=0;j<i;j++) {\n            if(nums[i]>nums[j]){\n                //æ‰¾ä¸€ä¸ªæœ€å¤§çš„ä¸‹é™æ²¿\n                up[i]=Math.max(up[i],down[j]+1);\n            }else if(nums[i]<nums[j]){\n                //æ‰¾ä¸€ä¸ªæœ€å¤§çš„ä¸Šå‡æ²¿\n                down[i]=Math.max(down[i],up[j]+1);\n            }\n        }\n    }\n    return Math.max(up[nums.length-1],down[nums.length-1]);\n}\n```\n**è§£æ³•äºŒ**\n\nçº¿æ€§åŠ¨æ€è§„åˆ’ï¼Œå…¶å®ä¸Šé¢çš„å¾ªç¯æ‰¾æœ€å¤§æ“ä½œæœ‰ç‚¹å¤šä½™ï¼Œå¦‚æœ`nums[i]>nums[i-1]` é‚£ä¹ˆä»¥nums[i]ä¸ºä¸Šå‡æ²¿ç»“å°¾ï¼ˆæ‘†åŠ¨ä¸Šå‡ï¼‰çš„æœ€é•¿æ‘‡æ‘†åºåˆ— `up[i]=down[i-1]+1`\n\n```java\npublic int wiggleMaxLength2(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int []up=new int[nums.length];\n    int []down=new int[nums.length];\n    up[0]=down[0]=1;\n    for (int i=1;i<nums.length;i++) {\n        if(nums[i]>nums[i-1]){\n            up[i]=down[i-1]+1;\n            down[i]=down[i-1];\n        }else if(nums[i]<nums[i-1]){\n            down[i]=up[i-1]+1;\n            up[i]=up[i-1];\n        }else{\n            //ç›¸ç­‰çš„æ—¶å€™åˆ«å¿˜äº†ç»§æ‰¿å‰é¢çš„çŠ¶æ€\n            down[i]=down[i-1];\n            up[i]=up[i-1];\n        }\n    }\n    return Math.max(up[nums.length-1],down[nums.length-1]);\n}\n```\n\næˆ‘æ„Ÿè§‰èƒ½å†™å‡ºO(1)çš„å‰ææ˜¯å…ˆå†™å‡ºO(N)çš„ï¼Œå†™å‡ºO(N)çš„ä¹‹åå†æ”¹æˆO(1)ä¼šæ¯”è¾ƒç®€å•\n\n```java\npublic int wiggleMaxLength(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int up=1;\n    int down=1;\n    for (int i=1;i<nums.length;i++) {\n        if (nums[i]>nums[i-1]) {\n            up=down+1;\n        }else if (nums[i]>nums[i-1]){\n            down=up+1;\n        }//elseå°±æ˜¯ä¸å˜\n    }\n    return Math.max(up,down);\n}\n```\n\n## [978. æœ€é•¿æ¹æµå­æ•°ç»„](https://leetcode-cn.com/problems/longest-turbulent-subarray/)\n\nå½“ `A` çš„å­æ•°ç»„ `A[i], A[i+1], ..., A[j]` æ»¡è¶³ä¸‹åˆ—æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º*æ¹æµå­æ•°ç»„*ï¼š\n\n- è‹¥ `i <= k < j`ï¼Œå½“ `k` ä¸ºå¥‡æ•°æ—¶ï¼Œ `A[k] > A[k+1]`ï¼Œä¸”å½“ `k` ä¸ºå¶æ•°æ—¶ï¼Œ`A[k] < A[k+1]`ï¼›\n- **æˆ–** è‹¥ `i <= k < j`ï¼Œå½“ `k` ä¸ºå¶æ•°æ—¶ï¼Œ`A[k] > A[k+1]` ï¼Œä¸”å½“ `k` ä¸ºå¥‡æ•°æ—¶ï¼Œ `A[k] < A[k+1]`ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ¯”è¾ƒç¬¦å·åœ¨å­æ•°ç»„ä¸­çš„æ¯ä¸ªç›¸é‚»å…ƒç´ å¯¹ä¹‹é—´ç¿»è½¬ï¼Œåˆ™è¯¥å­æ•°ç»„æ˜¯æ¹æµå­æ•°ç»„ã€‚ï¼ˆä¸Šé¢çš„æ˜¯åºŸè¯ï¼‰\n\nè¿”å› `A` çš„æœ€å¤§æ¹æµå­æ•°ç»„çš„**é•¿åº¦**ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[9,4,2,10,7,8,8,1,9]\nè¾“å‡ºï¼š5\nè§£é‡Šï¼š(A[1] > A[2] < A[3] > A[4] < A[5])\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[4,8,12,16]\nè¾“å‡ºï¼š2\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[100]\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= A.length <= 40000`\n2. `0 <= A[i] <= 10^9`\n\n**è§£æ³•ä¸€**\n\nåœ¨æ»‘çª—tagé‡Œå‘ç°çš„ï¼Œä¸€ç›´æ²¡å¾€dpä¸Šæƒ³ï¼Œçœ‹äº†è¯„è®ºåŒºæ‰å‘ç°ğŸ˜‚ï¼Œè¿™é¢˜å…¶å®æ˜¯ä¸Šé¢[376. æ‘†åŠ¨åºåˆ—](#376-æ‘†åŠ¨åºåˆ—)çš„å¼±åŒ–ï¼Œè¿™é‡Œæ˜¯è¦æ±‚è¿ç»­çš„ï¼Œä½†æ˜¯åšæ³•è¿˜æ˜¯ä¸€æ ·çš„\n\n```java\n//åŠ¨æ€è§„åˆ’ï¼Œä»æ»‘çª—tagè¿‡æ¥çš„...æ²¡å¾€dpä¸Šæƒ³ï¼Œçœ‹äº†è¯„è®ºåŒºæ‰æƒ³èµ·æ¥\npublic int maxTurbulenceSize(int[] A) {\n    if(A==null || A.length<=0){\n        return 0;\n    }\n    int up=1,down=1;\n    int res=1;\n    for (int i=1;i<A.length;i++) {\n        if(A[i]>A[i-1]){\n            up=down+1;\n            down=1;\n        }else if (A[i]<A[i-1]){\n            down=up+1;\n            up=1;\n        }else{\n            up=1;down=1;\n        }\n        res=Math.max(res,Math.max(up,down));\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\næ»‘çª—ï¼Œä¹Ÿæ˜¯ä¸€å¼€å§‹çš„åšæ³•ï¼Œæ¯”è¾ƒç®€å•\n\n```java\n//ä¼˜åŒ–ifæ¡ä»¶\npublic int maxTurbulenceSize(int[] A) {\n    if(A==null || A.length<=0){\n        return 0;\n    }\n    int left=0;\n    int res=1;\n    for(int right=left+1;right<A.length;right++){\n        if(A[right]==A[right-1]){ //è·³è¿‡ç›¸ç­‰çš„\n            left=right;\n            continue;\n        }\n        //ä¼˜åŒ–äº†ifæ¡ä»¶ï¼Œä¹‹å‰çœ‹åˆ«äººé¢˜è§£å­¦åˆ°çš„\n        if(right>=2 && (A[right]>A[right-1])==(A[right-1]>A[right-2])){\n            left=right-1; //leftè·³åˆ°ä¸­é—´å€¼\n        }\n        res=Math.max(res,right-left+1);\n    }\n    return res;\n}\n```\n## [96. ä¸åŒçš„äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/unique-binary-search-trees/)\n\nGiven *n*, how many structurally unique **BST's** (binary search trees) that store values 1 ... *n*?\n\n**Example:**\n\n```java\nInput: 3\nOutput: 5\nExplanation:\nGiven n = 3, there are a total of 5 unique BST's:\n\n   1         3     3      2      1\n    \\       /     /      / \\      \\\n     3     2     1      1   3      2\n    /     /       \\                 \\\n   2     1         2                 3\n```\n\n**è§£æ³•ä¸€**\n\nè¿™ä¸ªè§£æ³•å®é™…ä¸Šæ¥è‡ª [95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II](https://leetcode-cn.com/problems/unique-binary-search-trees-ii/)\n\n```java\npublic static int numTrees(int n) {\n    return generateTree(1,n).size();\n}\n\npublic static List<TreeNode> generateTree(int start,int end){\n    List<TreeNode> res=new ArrayList<>();\n    if (start>end) {\n        res.add(null);\n        return res;\n    }\n    for (int i=start;i<=end;i++) {\n        List<TreeNode> left=generateTree(start,i-1);\n        List<TreeNode> right=generateTree(i+1,end);\n        for (TreeNode l:left) {\n            for (TreeNode r:right) {\n                TreeNode currentNode=new TreeNode(i);\n                currentNode.left=l;\n                currentNode.right=r;\n                res.add(currentNode);\n            }\n        }\n    }\n    return res;\n}\n```\nè¿™ç§å†™æ³•å¾ˆæ˜æ˜¾è¿‡ä¸äº†è¿™é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦å¤ªé«˜äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¯ä»¥æ±‚å‡ºæ‰€æœ‰çš„BSTé›†åˆã€‚\n\n**è§£æ³•äºŒ**\n\nåŠ¨æ€è§„åˆ’ï¼Œ`dp[i]`ä»£è¡¨é•¿åº¦ä¸º `i` çš„é€’å¢åºåˆ—æ„æˆçš„ä¸åŒçš„BSTçš„æ•°é‡ï¼ˆåºåˆ—ä»`1 åˆ° i` é€’å¢ï¼‰\n\né€’æ¨å…¬å¼: `dp[i]=dp[i-1]* dp[n-i]`\n\n```java\npublic int numTrees(int n) {\n    if (n<=1) {\n        return 1;\n    }\n    int []dp=new int[n+1];\n    dp[0]=1;\n    dp[1]=1;\n    for (int i=2;i<=n;i++) { //æ§åˆ¶åºåˆ—é•¿åº¦ ç›´åˆ°æˆ‘ä»¬æ±‚å¾— n\n        for (int j=1;j<=i;j++) { //æ§åˆ¶æ ¹çš„é€‰æ‹©\n            //ç´¯åŠ å’Œï¼Œjä¸ºæ ¹èŠ‚ç‚¹ dp[j-1]ä»£è¡¨å·¦å­æ ‘æ•°é‡ï¼Œdp[i-j]ä»£è¡¨å³å­æ ‘æ•°é‡\n            dp[i]+=dp[j-1]*dp[i-j];\n        }\n    }\n    return dp[n];\n}\n```\n\nä»¥ `i` ä½ç½®å…ƒç´ ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå¯ä»¥å¾—å‡ºå¯èƒ½çš„ BSTæ•°é‡ä¸ºï¼Œ`[1 ~ i-1]` å¯ä»¥æ„æˆçš„BSTæ•°é‡ ä¹˜ä»¥  `[i+1ï¼Œn]`å¯ä»¥æ„æˆçš„BSTæ•°é‡ï¼Œä¹Ÿå°±æ˜¯_å·¦å­æ ‘  *  å³å­æ ‘_  ï¼Œå†æ¨å¹¿åˆ°æ•´ä¸ªåºåˆ—çš„BSTæ€»æ•°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ **ä»¥æ¯ä¸ªå…ƒç´ ä¸ºæ ¹èŠ‚ç‚¹æ„æˆçš„BSTçš„æ•°é‡ä¹‹å’Œ** ï¼Œéœ€è¦ç†è§£çš„åœ°æ–¹å°±æ˜¯`dp[i]` çš„å«ä¹‰ï¼Œæ˜ç¡®æœ¬é¢˜ä¸­`dp[i]` å…¶å®**åªå’Œé•¿åº¦ `i`æœ‰å…³**è€Œå’Œå†…å®¹æ— å…³ï¼Œæ¯”å¦‚1ï¼Œ2ï¼Œ3å’Œ4ï¼Œ5ï¼Œ6æ‰€èƒ½æ„æˆçš„BSTæ•°é‡å…¶å®æ˜¯ç›¸åŒçš„\n\n**è§£æ³•ä¸‰**\n\nå¡å¡”å…°æ•°ï¼Œé€’æ¨å¼ `Gn+1 =2(2n+1)/ n+2  *  Gn`\n\n```java\npublic int numTrees3(int n) {\n    long C = 1;\n    for(int i = 0; i < n; ++i){\n        C = C * 2 * (2 * i + 1) /(i + 2);\n    }\n    return (int) C;\n}\n```\n\n\n## [120. ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ](https://leetcode-cn.com/problems/triangle/)\n\nç»™å®šä¸€ä¸ªä¸‰è§’å½¢ï¼Œæ‰¾å‡ºè‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œã€‚æ¯ä¸€æ­¥åªèƒ½ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œä¸­ç›¸é‚»çš„ç»“ç‚¹ä¸Šã€‚\n\nä¾‹å¦‚ï¼Œç»™å®šä¸‰è§’å½¢ï¼š\n\n```java\n[\n     [2],\n    [3,4],\n   [6,5,7],\n  [4,1,8,3]\n]\n```\n\n\nè‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œä¸º `11`ï¼ˆå³ï¼Œ2 + 3 + 5 + 1 = 11ï¼‰ã€‚\n\n**è¯´æ˜ï¼š**\n\nå¦‚æœä½ å¯ä»¥åªä½¿ç”¨ O(n) çš„é¢å¤–ç©ºé—´ï¼ˆn ä¸ºä¸‰è§’å½¢çš„æ€»è¡Œæ•°ï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆä½ çš„ç®—æ³•ä¼šå¾ˆåŠ åˆ†\n\n**è§£æ³•ä¸€**\n\näºŒç»´dpï¼Œemmmï¼Œä¸€å¼€å§‹å†™æˆè´ªå¿ƒäº†ã€‚ã€‚è´ªå¿ƒæ˜æ˜¾æ˜¯é”™çš„\n\n```java\n//dpåšæ³• O(N^2)ç©ºé—´\npublic int minimumTotal(List<List<Integer>> triangle) {\n    int rows=triangle.size();\n    //dp[i][j]ä»£è¡¨çš„æ˜¯æ¯iå±‚ç¬¬jä¸ªå…ƒç´ åˆ°æœ€åº•å±‚çš„æœ€çŸ­è·ç¦»\n    int[][] dp=new int[rows+1][rows+1]; //row+1\n    /*for (int i=0;i<triangle.get(rows-1).size();i++) {\n        //ç»™æœ€åä¸€è¡Œèµ‹åˆå§‹å€¼\n        dp[rows-1][i]=triangle.get(rows-1).get(i);\n    }\n    for (int i=rows-2;i>=0;i--) {\n        for (int j=0;j<triangle.get(i).size();j++) {\n            //æ ¸å¿ƒé€’æ¨å¼ dp[i][j]=min(dp[i+1][j],dp[i+1][j+1])+triangle(i)(j)\n            dp[i][j]=Math.min(dp[i+1][j],dp[i+1][j+1])+triangle.get(i).get(j);\n        }\n    }*/\n    //ç›´æ¥ä»æœ€åä¸€è¡Œå¼€å§‹,è¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨ç»™æœ€åä¸€è¡Œèµ‹åˆå§‹å€¼äº†\n    for (int i=rows-1;i>=0;i--) {\n        for (int j=0;j<triangle.get(i).size();j++) {\n            //æ ¸å¿ƒé€’æ¨å¼ dp[i][j]=min(dp[i+1][j],dp[i+1][j+1])+triangle(i)(j)\n            dp[i][j]=Math.min(dp[i+1][j],dp[i+1][j+1])+triangle.get(i).get(j);\n        }\n    }\n    return dp[0][0];\n}\n```\n**è§£æ³•äºŒ**\n\nè®°å¿†åŒ–é€’å½’ï¼Œä¹Ÿå¾ˆå¿«\n\n```java\n//è®°å¿†åŒ–é€’å½’\npublic int minimumTotal2(List<List<Integer>> triangle) {\n    //ç”¨Integeræ¯”è¾ƒå¥½,æ–¹ä¾¿åˆ¤ç©º\n    Integer [][] cache=new Integer[triangle.size()][triangle.size()];\n    return minimumTotal(triangle,0,0,cache);\n}\n\npublic int minimumTotal(List<List<Integer>> triangle,int cen,int index,Integer[][]cache) {\n    if (cache[cen][index]!=null) {\n        return cache[cen][index];\n    }\n    if (cen==triangle.size()-1) {\n        return triangle.get(cen).get(index);\n    }\n    int left=minimumTotal(triangle,cen+1,index,cache);\n    int right=minimumTotal(triangle,cen+1,index+1,cache);\n    return cache[cen][index]=triangle.get(cen).get(index)+(left<right?left:right);\n}\n```\n**è§£æ³•ä¸‰**\n\n```java\n//dp O(N)ç©ºé—´\npublic int minimumTotal(List<List<Integer>> triangle) {\n    int rows=triangle.size();\n    //dp[i]ä»£è¡¨çš„æ˜¯æ¯ä¸€å±‚ç¬¬iä¸ªå…ƒç´ åˆ°æœ€åº•å±‚çš„æœ€çŸ­è·ç¦»\n    //ä¸Šé¢äºŒç»´dpå®é™…ä¸Šä¹Ÿåªå’Œä¸‹ä¸€å±‚çš„çŠ¶æ€æœ‰å…³,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡å¤çš„ä½¿ç”¨è¿™ä¸ªæ•°ç»„ä¿å­˜æ¯ä¸€å±‚çš„çŠ¶æ€\n    int[] dp=new int[rows+1];\n    for (int i=rows-1;i>=0;i--) {\n        for (int j=0;j<triangle.get(i).size();j++) {\n            //åˆ°è¿™é‡Œå…¶å®Math.min()é‡Œé¢çš„éƒ½æ˜¯ä¸Šä¸€æ¬¡å¾ªç¯çš„ç»“æœ\n            //ä¹Ÿå°±æ˜¯ä¸‹ä¸€å±‚çš„,å¯¹åº”å½“å‰jä½ç½®å·¦å³ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹çš„æœ€å°è·ç¦»\n            dp[j]=Math.min(dp[j+1],dp[j])+triangle.get(i).get(j);\n        }\n    }\n    return dp[0];\n}\n```\nO(N)ç©ºé—´å¤æ‚åº¦ï¼Œåªå’Œä¸‹é¢é‚£ä¸€å±‚çš„æ¯ä¸€ä¸ªå…ƒç´ çš„dp[i]æœ‰å…³ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ”¹æˆä¸€ç»´dp\n\n**UPDATE: 2020.7.14**\n\nä»Šå¤©çš„æ‰“å¡é¢˜ï¼Œå†™äº†ä¸€ä¸ªä»ä¸Šè€Œä¸‹çš„dpï¼Œéœ€è¦å¤„ç†è¾¹ç•Œä¼šéº»çƒ¦ä¸€ç‚¹ï¼Œå’Œä¹‹å‰çš„åç€çš„ï¼Œæœç„¶åˆ·é¢˜ä¸»è¦è¿˜æ˜¯åˆ·ä¸€ä¸ªæ„Ÿè§‰ï¼Œæƒ³è®°ä½é¢˜ç›®è§£æ³•æ˜¯ä¸å¯èƒ½çš„ï¼Œèƒ½é”»ç‚¼ä¸€äº›æ€è€ƒçš„èƒ½åŠ›æ‰æ˜¯å…³é”®\n```golang\nfunc minimumTotal(triangle [][]int) int {\n    if len(triangle) <= 0{\n        return 0\n    }\n    var INF = 1<<31\n    var n = len(triangle)\n    var dp = make([]int, n)\n    for i := 0; i < n; i++{\n        dp[i] = INF\n    }\n    dp[0] = triangle[0][0]\n    var res = INF\n    for i := 1; i < n; i++{\n        for j :=i; j >=0; j--{\n            if j == 0{\n                dp[j] = dp[j] + triangle[i][j]\n            }else if j == i{\n                dp[j] = dp[j-1] + triangle[i][j]\n            }else{\n                dp[j] = Min(dp[j], dp[j-1]) + triangle[i][j]\n            }\n            if i == n-1{\n                res = Min(res, dp[j])\n            }\n        }\n    }\n    if res == INF{\n        return triangle[0][0]\n    }\n    return res\n}\n\nfunc Min(a, b int) int {\n    if a < b{\n        return a\n    }\n    return b\n}\n```\n\n## [121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚\n\nå¦‚æœä½ **æœ€å¤šåªå…è®¸å®Œæˆä¸€ç¬”äº¤æ˜“**ï¼ˆå³ä¹°å…¥å’Œå–å‡ºä¸€æ”¯è‚¡ç¥¨ï¼‰ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚\n\næ³¨æ„ä½ ä¸èƒ½åœ¨ä¹°å…¥è‚¡ç¥¨å‰å–å‡ºè‚¡ç¥¨ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [7,1,5,3,6,4]\nè¾“å‡º: 5\nè§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5  ï¼Œæ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [7,6,4,3,1]\nè¾“å‡º: 0\nè§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚\n```\n\n**è§£æ³•ä¸€**\n\néåŠ¨æ€è§„åˆ’çš„æ€è·¯ï¼Œè¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ±‚ä¸ªæœ€å¤§çš„å·®å€¼å°±okï¼Œå› ä¸ºåªèƒ½ä¹°ä¸€æ¬¡\n\n```java\n//éé€’å½’çš„æ€è·¯\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int min=Integer.MAX_VALUE,max=0;\n    for (int i=0;i<prices.length;i++) {\n        //å½“å¤©ä»·æ ¼å‡å» *ä¹‹å‰* ä»·æ ¼æœ€ä½çš„ä¹°å…¥æ—¶æœº\n        max=Math.max(max,prices[i]-min);\n        //ç»Ÿè®¡ä»·æ ¼æœ€ä½çš„ä¹°å…¥æ—¶æœº\n        min=Math.min(min,prices[i]);\n    }\n    return max;\n}\n```\n**è§£æ³•äºŒ**\n\næ—¢ç„¶æ˜¯åŠ¨æ€è§„åˆ’çš„é¢˜ï¼Œè‡ªç„¶å¾—å†™ä¸ªåŠ¨æ€è§„åˆ’çš„ç‰ˆæœ¬\n\n```java\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int[][] dp=new int[prices.length][2];\n    dp[0][0]=0;\n    dp[0][1]= -prices[0];\n    for (int i=1;i<prices.length;i++) {\n        dp[i][0]=Math.max(dp[i-1][0],dp[i-1][1]+[i]);\n        dp[i][1]=Math.max(dp[i-1][1],-prices[i]);\n    }\n    return dp[prices.length-1][0];\n}\n```\nå…¶å®æ”¹æˆä¸€ç»´çš„å°±å’Œä¸Šé¢çš„ä¸€æ¨¡ä¸€æ ·äº†\n\n## [122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚\n\nè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚**ä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“**ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚\n\n**æ³¨æ„ï¼š**ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [7,1,5,3,6,4]\nè¾“å‡º: 7\nè§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚\néšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-3 = 3 ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,2,3,4,5]\nè¾“å‡º: 4\nè§£é‡Š: åœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚\næ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [7,6,4,3,1]\nè¾“å‡º: 0\nè§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚\n```\n\n**è§£æ³•ä¸€**\n\næ­£å¸¸çš„æ€è·¯ï¼ˆéåŠ¨æ€è§„åˆ’ï¼‰ï¼Œæ³¨æ„å®¡é¢˜ï¼Œä¸Šé¢çš„åªèƒ½ä¹°ä¸€æ¬¡ï¼Œè¿™é‡Œæ˜¯ä¸é™åˆ¶æ¬¡æ•°çš„\n\n```java\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int ans=0;\n    for (int i=1;i<prices.length;i++) {\n        if (prices[i]>prices[i-1]) {\n            ans+=prices[i]-prices[i-1];\n        }\n    }\n    return ans;\n}\n```\nè¿™é‡Œçš„ä»£ç è¿˜æ˜¯å¾ˆæœ‰è¿·æƒ‘æ€§çš„ï¼Œå®é™…ä¸Šåˆ†äº†ä¸‰ç§æƒ…å†µï¼Œæœ‰ä¸¤ç§åˆå¹¶äº†\n\n>**å•ç‹¬äº¤æ˜“æ—¥**ï¼šæ˜å¤©æ¯”ä»Šå¤©ä»·æ ¼é«˜ï¼Œä»Šå¤©ä¹°ï¼Œæ˜å¤©å–\n>\n>**è¿ç»­ä¸Šæ¶¨äº¤æ˜“æ—¥**ï¼šå¼€å§‹çš„ç¬¬ä¸€å¤©ä¹° , æ¶¨åœçš„æœ€åä¸€å¤©å–æœ€æœ‰åˆ©ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è½¬æ¢æˆè¯´`é™¤äº†ç¬¬ä¸€å¤©ï¼Œæ¯å¤©éƒ½å–äº†åˆä¹°`ï¼Œä¹Ÿå°±æ˜¯`pn-p1 = (p2-p1)+(p3-p2)+....(pn-pn-1)`  å¾ˆè‡ªç„¶çš„å°±è½¬æ¢æˆäº†å•ç‹¬äº¤æ˜“æ—¥çš„æƒ…å†µ\n>**è¿ç»­ä¸‹é™äº¤æ˜“æ—¥**ï¼šä¸ä¹°å–æœ€æœ‰åˆ©\n\nå¦‚æœè¿˜æ˜¯ä¸æ˜ç™½å¯ä»¥çœ‹çœ‹å®˜æ–¹çš„å›¾\n\n![mark](http://static.imlgw.top/blog/20191017/Wpsvs09EmnmF.png?imageslim)\n\nA->Dæ˜¯ä¸€æ®µè¿ç»­ä¸Šæ¶¨æ—¥ï¼Œ`D-Açš„å·®å€¼` å°±æ˜¯A->Då„ä¸ªç›¸é‚»èŠ‚ç‚¹å·®å€¼ä¹‹å’Œ\n\n**è§£æ³•äºŒ**\n\næˆ‘ä»¬çš„ä¸»è§’ï¼ŒåŠ¨æ€è§„åˆ’\n\n```java\n//dpçš„æ€è·¯\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int[][] dp=new int[prices.length][2];\n    dp[0][0]=0;\n    dp[0][1]=-prices[0];\n    for (int i=1;i<prices.length;i++) {\n        dp[i][0]=Math.max(dp[i-1][0],dp[i-1][1]+prices[i]);\n        dp[i][1]=Math.max(dp[i-1][1],dp[i-1][0]-prices[i]);\n    }\n    return dp[prices.length-1][0];\n}\n```\nç¬¬ä¸€çœ¼çœ‹å¯èƒ½è§‰å¾—çœ‹ä¸æ‡‚ï¼Œç†Ÿæ‚‰äº†å°±çŸ¥é“äº†ï¼Œå…¶å®éƒ½æ˜¯å¥—è·¯ï¼Œè‚¡ç¥¨é¢˜ç‰¹æœ‰çš„å¥—è·¯ï¼Œå…ˆè€ƒè™‘é¢˜ç›®æœ‰å‡ ç§çŠ¶æ€ï¼Œè¿™é¢˜è¯´äº†ä¸é™åˆ¶æ¬¡æ•°ï¼Œé‚£ä¹ˆå°±ä¸è€ƒè™‘æ¬¡æ•°çš„é—®é¢˜ï¼Œç„¶åå‰©ä¸‹çš„çŠ¶æ€å°±æ˜¯ï¼šé‚£ä¸€å¤©ï¼Œå’Œæ˜¯å¦æŒæœ‰è‚¡ç¥¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªäºŒç»´çš„æ•°ç»„æ¥è¡¨è¿°è¿™ä¸¤ç§çŠ¶æ€ æ¯”å¦‚`dp[i][0]` åˆ™ä»£è¡¨ç¬¬iå¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œ`dp[i][1]`åˆ™ä»£è¡¨ç¬¬iå¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œç„¶åæˆ‘ä»¬å†çœ‹çœ‹çŠ¶æ€è½¬æ¢çš„è¿‡ç¨‹\n\n![mark](http://static.imlgw.top/blog/20191017/J7tfvKDvqC2b.png?imageslim)\n\nå…¶å®æ— éå°±æ˜¯è¿™ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ï¼Œç„¶åæ ¹æ®è¿™ä¸ªçŠ¶æ€è½¬æ¢çš„è¿‡ç¨‹å°±å¯ä»¥å¾ˆè½»æ˜“çš„å†™å‡ºæˆ‘ä»¬çš„çŠ¶æ€è½¬æ¢æ–¹ç¨‹\n\n```java\ndp[i][0]=Math.max(dp[i-1][0],dp[i-1][1]+prices[i]);\ndp[i][1]=Math.max(dp[i-1][1],dp[i-1][0]-prices[i]);\n```\nä¸è¿‡è¿™é‡Œå…¶å®ä¹Ÿå¾ˆå®¹æ˜“å°±å¯ä»¥æ”¹æˆä¸€å”¯çš„dpï¼Œç©ºé—´å¤æ‚åº¦å˜ä¸ºO(1)ï¼Œå› ä¸ºå½“å¤©çš„æœ€å¤§æ”¶ç›Šåªå’Œå‰ä¸€å¤©çš„æœ€å¤§æ”¶ç›Šç›¸å…³ï¼Œä¸¤ä¸ªå˜é‡å°±æ˜¯è¶³å¤Ÿè¡¨ç¤º\n\n```java\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int hlod=-prices[0];\n    int empty=0;\n    for (int i=1;i<prices.length;i++) {\n        //ä¿å­˜å‰ä¸€å¤©çš„çŠ¶æ€\n        int temp=empty;\n        empty=Math.max(empty,hlod+prices[i]);\n        hlod=Math.max(hlod,temp-prices[i]);\n    }\n    return empty;\n}\n```\nè¿™é‡Œæˆ‘æ„Ÿè§‰leetcodeçš„caseæœ‰é—®é¢˜ï¼Œæˆ‘å¼€å§‹æ²¡æœ‰ç¼“å­˜å‰ä¸€å¤©çš„emptyå€¼ï¼Œç›´æ¥å°†emptyå¸¦åˆ°holdå»äº†ï¼Œç»“æœè¿˜è¿‡äº†ã€‚ã€‚ã€‚ä¸è¿‡æˆ‘æ‡’å¾—å»æƒ³caseäº†ï¼Œåæ­£æäº¤äº†leecodeä¹Ÿä¸ä¼šç†æˆ‘ğŸ˜…\n\n## [123. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº III](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iii/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šçš„è‚¡ç¥¨åœ¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚\n\nè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ ä¸¤ç¬” äº¤æ˜“ã€‚\n\n**æ³¨æ„:** ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [3,3,5,0,0,3,1,4]\nè¾“å‡º: 6\nè§£é‡Š: åœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 0ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 6 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 3-0 = 3 ã€‚\n     éšåï¼Œåœ¨ç¬¬ 7 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 8 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 4ï¼‰çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 4-1 = 3 ã€‚\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,2,3,4,5]\nè¾“å‡º: 4\nè§£é‡Š: åœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚   \n     æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚   \n     å› ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [7,6,4,3,1] \nè¾“å‡º: 0 \nè§£é‡Š: åœ¨è¿™ä¸ªæƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0\n```\n\n**è§£æ³•ä¸€**\n\näºŒç»´åŠ¨æ€è§„åˆ’ï¼Œå®šä¹‰å‡ºæ¯ä¸ªçŠ¶æ€ï¼Œç„¶åè½¬æ¢å°±å¯ä»¥äº†\n\n```java\npublic int maxProfit(int[] prices){\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    //çŠ¶æ€å®šä¹‰ï¼š\n    //j=0 ä»€ä¹ˆéƒ½ä¸åš\n    //j=1 ç¬¬ä¸€æ¬¡ä¹°å…¥\n    //j=2 ç¬¬ä¸€æ¬¡å–å‡º\n    //j=3 ç¬¬äºŒæ¬¡ä¹°å…¥\n    //j=4 ç¬¬äºŒæ¬¡å–å‡º\n    int[][] dp=new int[prices.length][5];\n    //è¿™æ ·ä¼šæº¢å‡º\n    //Arrays.fill(dp[0],Integer.MIN_VALUE);\n    //è¿™æ ·å¯ä»¥è¿‡,ä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯åˆ¤æ–­ä¸€ä¸‹å¥½\n    //Arrays.fill(dp[0],-0x3f3f3f3f);\n    int INF=Integer.MIN_VALUE,n=prices.length;\n    Arrays.fill(dp[0],INF); //ä¸å¯è¾¾çŠ¶æ€\n    dp[0][0]=0;\n    dp[0][1]=-prices[0];\n    for(int i=1;i<n;i++){\n        dp[i][0]=0;\n        dp[i][1]=Math.max(-prices[i],dp[i-1][1]);\n        dp[i][2]=Math.max(dp[i-1][1]+prices[i],dp[i-1][2]);\n        dp[i][3]=Math.max(dp[i-1][2]!=INF?dp[i-1][2]-prices[i]:INF,dp[i-1][3]);\n        dp[i][4]=Math.max(dp[i-1][3]!=INF?dp[i-1][3]+prices[i]:INF,dp[i-1][4]);\n    }\n    return Math.max(Math.max(dp[n-1][0],dp[n-1][2]),dp[n-1][4]);\n}\n```\n> å› ä¸ºé¢˜ç›®çš„æ•°æ®ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œæ²¡æœ‰è¶…è¿‡`10^9` ç›´æ¥åˆå§‹åŒ–ä¸º `-0x3f3f3f3f` å°±ä¸ç”¨åˆ¤æ–­å‰é¢çš„çŠ¶æ€æ˜¯å¦å¯è¾¾äº†ï¼Œ\n\n**è§£æ³•äºŒ**\n\nä¼˜åŒ–æˆä¸€ç»´çš„\n\n```java\npublic int maxProfit(int[] prices){\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int[] dp=new int[5];\n    int n=prices.length;\n    Arrays.fill(dp,-0x3f3f3f3f);\n    dp[0]=0;\n    dp[1]=-prices[0];\n    for(int i=1;i<n;i++){\n        //é€†åºé€’æ¨é¿å…è¦†ç›–(å…¶å®æ­£ç€å†™ä¹Ÿæ˜¯å¯¹çš„,è¿™é¢˜ç›¸é‚»çš„çŠ¶æ€ä¸ä¼šåŒæ—¶æ›´æ–°,ä½†æ˜¯ä¸ºäº†è§„èŒƒæœ€å¥½è¿˜æ˜¯é€†åºå†™)\n        dp[4]=Math.max(dp[3]+prices[i],dp[4]);\n        dp[3]=Math.max(dp[2]-prices[i],dp[3]);\n        dp[2]=Math.max(dp[1]+prices[i],dp[2]);\n        dp[1]=Math.max(-prices[i],dp[1]);\n        dp[0]=0;\n    }\n    return Math.max(Math.max(dp[0],dp[2]),dp[4]);\n}\n```\n## [188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iv/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šçš„è‚¡ç¥¨åœ¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚\n\nè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ k ç¬”äº¤æ˜“ã€‚\n\næ³¨æ„: ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [2,4,1], k = 2\nè¾“å‡º: 2\nè§£é‡Š: åœ¨ç¬¬ 1 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 4) çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 4-2 = 2 ã€‚\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [3,2,6,5,0,3], k = 2\nè¾“å‡º: 7\nè§£é‡Š: åœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤© (è‚¡ç¥¨ä»·æ ¼ = 6) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-2 = 4 ã€‚\n     éšåï¼Œåœ¨ç¬¬ 5 å¤© (è‚¡ç¥¨ä»·æ ¼ = 0) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 6 å¤© (è‚¡ç¥¨ä»·æ ¼ = 3) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 3-0 = 3 ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®å°±æ˜¯æ±‚ä¸Šé¢ä¸€é¢˜çš„é€šè§£ï¼Œä¸Šé¢çš„ä»£ç è§„å¾‹å·²ç»éå¸¸æ˜æ˜¾äº†ï¼Œ`j`ä¸ºå¥‡æ•°çš„æ—¶å€™ä¹°å…¥ï¼Œå¶æ•°çš„æ—¶å€™å–å‡ºï¼Œæˆ‘ä»¬ç»Ÿè®¡æœ€åå¶æ•°çš„æœ€å¤§å€¼å°±å¯ä»¥\n\n```java\npublic int maxProfit(int k, int[] prices) {\n    if (prices==null || prices.length<=0 || k<=0) {\n        return 0;\n    }\n    if(k>prices.length/2){\n        return maxProfit(prices);\n    }\n    //kæ¬¡äº¤æ˜“,2*k+1ç§çŠ¶æ€\n    int[] dp=new int[2*k+1];\n    int n=prices.length;\n    int res=0;\n    Arrays.fill(dp,-0x3f3f3f3f);\n    dp[0]=0;\n    dp[1]=-prices[0];\n    for(int i=1;i<n;i++){\n        //æ³¨æ„å€’æ¨\n        for(int j=2*k;j>0;j--){\n            if((j&1)==1){\n                dp[j]=Math.max(dp[j-1]-prices[i],dp[j]);\n            }else{\n                dp[j]=Math.max(dp[j-1]+prices[i],dp[j]);\n                res=Math.max(dp[j],res);\n            }\n        }\n    }\n    return res;\n}\n\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int ans=0;\n    for (int i=1;i<prices.length;i++) {\n        if (prices[i]>prices[i-1]) {\n            ans+=prices[i]-prices[i-1];\n        }\n    }\n    return ans;\n}\n```\n**è§£æ³•äºŒ**\n\næ­£å¸¸çš„DPé€šè§£\n\n```java\n//å¸¸è§„2ç»´è§£æ³•\npublic int maxProfit(int k, int[] prices) {\n    if (prices==null || prices.length<=0 || k<=0) {\n        return 0;\n    }\n    if(k>prices.length/2){\n        return maxProfit(prices);\n    }\n    //ç¬¬kæ¬¡äº¤æ˜“,æŒè‚¡/ä¸æŒè‚¡\n    int[][] dp=new int[k+1][2];\n    int n=prices.length;\n    int res=0;\n    int INF=-0x3f3f3f3f;\n    for(int i=0;i<=k;i++){\n        Arrays.fill(dp[i],INF);\n    }\n    //å…¶å®è¿™é¢˜éš¾æçš„å°±æ˜¯å¯¹äºåˆå§‹çŠ¶æ€çš„init\n    //ç¬¬ä¸€å¤©æ²¡æœ‰äº¤æ˜“å’Œç¬¬ä¸€å¤©æœ‰ä¸€æ¬¡äº¤æ˜“çš„åˆå§‹å€¼\n    dp[0][0]=0;dp[0][1]=INF;\n    dp[1][0]=0;dp[1][1]=-prices[0];\n    for(int i=1;i<n;i++){\n        //æ³¨æ„å€’æ¨\n        for(int j=k;j>0;j--){\n            //è¿™é‡Œå°†ä¹°å…¥å’Œå–å‡ºä½œä¸ºä¸€ä¸ªçŠ¶æ€,æ‰€ä»¥è¿™é‡Œä¹°å…¥æ–°è‚¡ç¥¨ï¼Œè‚¯å®šå°±æ˜¯å±äºä¸‹ä¸€æ¬¡äº¤æ˜“äº†\n            //æ‰€ä»¥è¿™é‡Œçš„jéœ€è¦å‡ä¸€ï¼Œä»£è¡¨ä¸Šä¸€æ¬¡äº¤æ˜“å–å‡ºæ—¶å€™çš„æ”¶ç›Š\n            dp[j][0]=Math.max(dp[j][1]+prices[i],dp[j][0]);\n            dp[j][1]=Math.max(dp[j-1][0]-prices[i],dp[j][1]);\n            res=Math.max(dp[j][0],res);\n        }\n    }\n    return res;\n}\n\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int ans=0;\n    for (int i=1;i<prices.length;i++) {\n        if (prices[i]>prices[i-1]) {\n            ans+=prices[i]-prices[i-1];\n        }\n    }\n    return ans;\n}\n```\n## [714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices`ï¼Œå…¶ä¸­ç¬¬ i ä¸ªå…ƒç´ ä»£è¡¨äº†ç¬¬ i å¤©çš„è‚¡ç¥¨ä»·æ ¼ ï¼Œéè´Ÿæ•´æ•° fee ä»£è¡¨äº†äº¤æ˜“è‚¡ç¥¨çš„æ‰‹ç»­è´¹ç”¨\n\nä½ å¯ä»¥æ— é™æ¬¡åœ°å®Œæˆäº¤æ˜“ï¼Œä½†æ˜¯ä½ æ¯æ¬¡äº¤æ˜“éƒ½éœ€è¦ä»˜æ‰‹ç»­è´¹ã€‚å¦‚æœä½ å·²ç»è´­ä¹°äº†ä¸€ä¸ªè‚¡ç¥¨ï¼Œåœ¨å–å‡ºå®ƒä¹‹å‰ä½ å°±ä¸èƒ½å†ç»§ç»­è´­ä¹°è‚¡ç¥¨äº†ã€‚\n\nè¿”å›è·å¾—åˆ©æ¶¦çš„æœ€å¤§å€¼ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: prices = [1, 3, 2, 8, 4, 9], fee = 2\nè¾“å‡º: 8\nè§£é‡Š: èƒ½å¤Ÿè¾¾åˆ°çš„æœ€å¤§åˆ©æ¶¦:  \nåœ¨æ­¤å¤„ä¹°å…¥ prices[0] = 1\nåœ¨æ­¤å¤„å–å‡º prices[3] = 8\nåœ¨æ­¤å¤„ä¹°å…¥ prices[4] = 4\nåœ¨æ­¤å¤„å–å‡º prices[5] = 9\næ€»åˆ©æ¶¦: ((8 - 1) - 2) + ((9 - 4) - 2) = 8.\n```\n\n**æ³¨æ„:**\n\n- `0 < prices.length <= 50000.`\n- `0 < prices[i] < 50000.`\n- `0 <= fee < 50000.`\n\n**è§£æ³•ä¸€**\n\næˆ‘èµ·äº†ï¼Œä¸€æªç§’äº†ï¼Œæœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Ÿ\n\n```java\npublic int maxProfit(int[] prices, int fee) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int[][] dp=new int[prices.length][2];\n    dp[0][0]=0;\n    dp[0][1]=-prices[0];\n    for (int i=1;i<prices.length;i++) {\n        dp[i][0]=Math.max(dp[i-1][0],dp[i-1][1]+prices[i]-fee);\n        dp[i][1]=Math.max(dp[i-1][1],dp[i-1][0]-prices[i]);\n    }\n    return dp[prices.length-1][0];\n}\n```\næ”¹ä¸ºO(1)ç©ºé—´\n\n```java\n//æ”¹ä¸ºO(1)\npublic int maxProfit(int[] prices, int fee) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int empty=0;\n    int hold=-prices[0];\n    for (int i=1;i<prices.length;i++) {\n        int temp=empty;\n        empty=Math.max(empty,hold+prices[i]-fee);\n        hold=Math.max(hold,temp-prices[i]);\n    }\n    return empty;\n}\n```\n## [309. æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ i ä¸ªå…ƒç´ ä»£è¡¨äº†ç¬¬ i å¤©çš„è‚¡ç¥¨ä»·æ ¼ \n\nè®¾è®¡ä¸€ä¸ªç®—æ³•è®¡ç®—å‡ºæœ€å¤§åˆ©æ¶¦ã€‚åœ¨æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ä¸‹ï¼Œä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰:\n\n- ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰\n- å–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ (å³å†·å†»æœŸä¸º 1 å¤©)\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [1,2,3,0,2]\nè¾“å‡º: 3 \nè§£é‡Š: å¯¹åº”çš„äº¤æ˜“çŠ¶æ€ä¸º: [ä¹°å…¥, å–å‡º, å†·å†»æœŸ, ä¹°å…¥, å–å‡º]\n```\n\n**è§£æ³•ä¸€**\n\nä¾ç„¶æ˜¯ä¸Šé¢é¢˜çš„å‡çº§ç‰ˆï¼Œç›¸æ¯”ä¸Šä¸€é¢˜åˆå¤šäº†ä¸ªé™åˆ¶æ¡ä»¶ï¼ŒåŠ äº†cdï¼Œä¹°å–ä¸€æ¬¡åæœ‰ä¸€å¤©çš„cdï¼Œå½“å¤©ä¸èƒ½å†ä¹°\n\n```java\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    //dp[i][0] ä»£è¡¨ç¬¬iå¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦\n    //dp[i][1] ä»£è¡¨ç¬¬iå¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦\n    int[][] dp=new int[prices.length][2];\n    dp[0][0]=0;\n    dp[0][1]=-prices[0];\n    for (int i=1;i<prices.length;i++) {\n        //è¿™äº›ç©æ„æƒ³èµ·è¿˜æ˜¯è›®æ‰“è„‘é˜”çš„\n        dp[i][0]=Math.max(dp[i-1][1]+prices[i],dp[i-1][0]);\n        //dp[i][1]=Math.max(i<2?-prices[i]:dp[i-2][0]-prices[i],dp[i-1][1]);\n        //è¿™é‡Œi<2å°±æ˜¯ç¬¬ä¸€æ¬¡å¾ªç¯ï¼Œi=1,ä¹Ÿå°±æ˜¯ç¬¬äºŒå¤©æŒæœ‰è‚¡ç¥¨ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯é¦–æ¬¡ä¹°è‚¡ç¥¨ï¼Œç›´æ¥åˆå§‹åŒ–ä¸º -prices[1]\n        //æ˜¨å¤©æœ‰è‚¡ç¥¨ï¼Œæˆ–è€…æ˜¨å¤©å†·å†»å‰å¤©å–å‡º\n        dp[i][1]=Math.max(i<2?-prices[1]:dp[i-2][0]-prices[i],dp[i-1][1]);\n    }\n    return dp[prices.length-1][0];\n}\n```\nè¯„è®ºåŒºå¾ˆå¤šçš„è§£æ³•éƒ½æ˜¯ç”¨äº†ä¸‰ä¸ªçŠ¶æ€æ•°ç»„ï¼Œç›¸æ¯”è¿™ç§å¤šäº†ä¸€ä¸ª å†·å†»æœŸçš„æœ€å¤§å€¼ï¼Œæ„Ÿè§‰æŒºè¿·æƒ‘çš„ã€‚ã€‚ã€‚è™½ç„¶ç»“æœæ˜¯å¯¹çš„ï¼Œä½†æ˜¯æ€»æ—¶æ„Ÿè§‰åˆ«æ‰­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œç”¨ä¸¤ä¸ªçŠ¶æ€è¡¨ç¤ºï¼ŒçŠ¶æ€è½¬æ¢å›¾å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„\n\n![mark](http://static.imlgw.top/blog/20191017/J7tfvKDvqC2b.png?imageslim)\n\nå½“å¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œå°±æ˜¯ä½ å½“å¤©ä¹°è‚¡ç¥¨ï¼Œæˆ–è€…restå•¥ä¹Ÿä¸å¹²å»¶ç»­å‰ä¸€å¤©çš„çŠ¶æ€ï¼Œä¸¤è€…çš„æœ€å¤§å€¼\n\nè¿™é‡Œå’Œä¸Šé¢ä¸åŒçš„å°±æ˜¯ä»`ä¸æŒæœ‰è‚¡ç¥¨` åˆ°`æŒæœ‰è‚¡ç¥¨`ï¼ˆä¹Ÿå°±æ˜¯ä¹°è‚¡ç¥¨ï¼‰çš„æƒ…å†µï¼Œ å› ä¸ºæœ‰å†·å†»æœŸçš„å­˜åœ¨ï¼Œ**æ‰€ä»¥ä½ å½“å¤©ä¹°è‚¡ç¥¨çš„æœ€å¤§å€¼ä¸å†æ˜¯æ˜¨å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§å€¼ï¼Œè€Œæ˜¯å‰å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§å€¼**\n\n**è§£æ³•ä¸‰**\n\næ”¹ä¸ºç©ºé—´å¤æ‚åº¦O(1)çš„\n\n```java\npublic int maxProfit(int[] prices) {\n    if (prices==null || prices.length<=0) {\n        return 0;\n    }\n    int hold=-prices[0];\n    int empty=0;\n    //å‰ä¸€å¤©ä¹°å‡ºçš„æœ€å¤§æ”¶ç›Š\n    int prePre=0;\n    for (int i=1;i<prices.length;i++) {\n        int temp=empty;\n        empty=Math.max(hold+prices[i],empty);\n        hold=Math.max(i<2?-prices[1]:prePre-prices[i],hold);\n        //åˆ°è¿™é‡Œpreå°±å˜æˆäº†å‰ä¸€å¤©\n        prePre=temp;\n    }\n    return empty;\n}\n```\n> çœ‹äº†ä¸‹è¯„è®ºåŒºè¿˜æ˜¯è›®å¤šäº‰è®®çš„ï¼Œæ„Ÿè§‰è¿™é‡Œæ ¹æ®dp[i-2]è½¬æ¢æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œç„¶åç¿»äº†ç¿»è¯„è®ºåŒºçœ‹è§äº†å¤§ç¥çš„å›ç­”\n>\n> `dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])`\n>\n> `dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i])`\n>\n> æ·»åŠ  â€œå†·å†»æœŸâ€ æ¡ä»¶åï¼Œä¹°å…¥çš„å‰ä¸€å¤©æ˜¯ä¸èƒ½å–çš„ï¼Œè€Œ`dp[i-1][0] - prices[i]`å¹¶ä¸èƒ½ç¡®ä¿ `i-1å¤©ä¸å–å‡º`   \n>\n> æ‰€ä»¥è¿›ä¸€æ­¥æ‹†è§£`dp[i-1][0]`ï¼Œ å¥—ç”¨ä¸Šé¢çš„è½¬æ¢æ–¹ç¨‹å¯ä»¥å¾—åˆ°\n>\n> `dp[i-1][0] = max(dp[i-2][0], dp[i-2][1] + prices[i-1])` \n>\n> å†å¸¦å…¥åŸå¼å­ï¼Œåˆ™å¯ä»¥å¾—åˆ°\n>\n> `dp[i][1] = max(dp[i-1][1], max(dp[i-2][0], dp[i-2][1] + prices[i-1]) - prices[i])`\n>\n> å…¶ä¸­`dp[i-2][1] + prices[i-1]` ä»£è¡¨ç€ `â€œi-1å‘ç”Ÿäº†å–å‡ºè¡Œä¸ºâ€`ï¼Œæœ‰è¿é¢˜æ„ï¼Œåº”äºˆåˆ é™¤ï¼Œå¾—ä¸‹å¼ï¼Œæœ€ç»ˆå’Œä¸Šé¢çš„çŠ¶æ€è½¬æ¢æ–¹ç¨‹ä¸€è‡´\n>\n> `dp[i][1] = max(dp[i-1][1], max(dp[i-2][0]) - prices[i])`\n>\n> è¿™æ ·ä¸€è¯æ˜å°±å¾ˆæ¸…æ¥šäº†\n\n\n\n## [1269. åœåœ¨åŸåœ°çš„æ–¹æ¡ˆæ•°](https://leetcode-cn.com/problems/number-of-ways-to-stay-in-the-same-place-after-some-steps/)\n\næœ‰ä¸€ä¸ªé•¿åº¦ä¸º arrLen çš„æ•°ç»„ï¼Œå¼€å§‹æœ‰ä¸€ä¸ªæŒ‡é’ˆåœ¨ç´¢å¼• 0 å¤„ã€‚\n\næ¯ä¸€æ­¥æ“ä½œä¸­ï¼Œä½ å¯ä»¥å°†æŒ‡é’ˆå‘å·¦æˆ–å‘å³ç§»åŠ¨ 1 æ­¥ï¼Œæˆ–è€…åœåœ¨åŸåœ°ï¼ˆæŒ‡é’ˆä¸èƒ½è¢«ç§»åŠ¨åˆ°æ•°ç»„èŒƒå›´å¤–ï¼‰ã€‚\n\nç»™ä½ ä¸¤ä¸ªæ•´æ•° steps å’Œ arrLen ï¼Œè¯·ä½ è®¡ç®—å¹¶è¿”å›ï¼šåœ¨æ°å¥½æ‰§è¡Œ steps æ¬¡æ“ä½œä»¥åï¼ŒæŒ‡é’ˆä»ç„¶æŒ‡å‘ç´¢å¼• 0 å¤„çš„æ–¹æ¡ˆæ•°ã€‚\n\nç”±äºç­”æ¡ˆå¯èƒ½ä¼šå¾ˆå¤§ï¼Œè¯·è¿”å›æ–¹æ¡ˆæ•° æ¨¡ 10^9 + 7 åçš„ç»“æœã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šsteps = 3, arrLen = 2\nè¾“å‡ºï¼š4\nè§£é‡Šï¼š3 æ­¥åï¼Œæ€»å…±æœ‰ 4 ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥åœåœ¨ç´¢å¼• 0 å¤„ã€‚\nå‘å³ï¼Œå‘å·¦ï¼Œä¸åŠ¨\nä¸åŠ¨ï¼Œå‘å³ï¼Œå‘å·¦\nå‘å³ï¼Œä¸åŠ¨ï¼Œå‘å·¦\nä¸åŠ¨ï¼Œä¸åŠ¨ï¼Œä¸åŠ¨\n```\n\n**ç¤ºä¾‹  2ï¼š**\n\n```java\nè¾“å…¥ï¼šsteps = 2, arrLen = 4\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š2 æ­¥åï¼Œæ€»å…±æœ‰ 2 ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥åœåœ¨ç´¢å¼• 0 å¤„ã€‚\nå‘å³ï¼Œå‘å·¦\nä¸åŠ¨ï¼Œä¸åŠ¨\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šsteps = 4, arrLen = 2\nè¾“å‡ºï¼š8\n```\n\n**æç¤ºï¼š**\n\n- `1 <= steps <= 500`\n- `1 <= arrLen <= 10^6`\n\n**è§£æ³•ä¸€**\n\n11.24 çš„å‘¨èµ›æœ€åä¸€é¢˜ï¼Œå¾ˆå¯æƒœæ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚è¦æ˜¯æŠŠè¿™é¢˜æ”¾åœ¨ç¬¬ä¸‰é¢˜æˆ‘å¯èƒ½å°±åšå‡ºæ¥äº†ã€‚ã€‚ã€‚ã€‚è¿˜æ˜¯èœå•Š\n\n```java\npublic int numWays(int steps, int arrLen) {\n    int mod=1_000_000_007;\n    long[][] dp=new long[steps+1][steps+1];\n    dp[0][0]=1; //dp[i][j]çš„å«ä¹‰æ˜¯iæ­¥ä¹‹åå¤„äºjä½ç½®çš„æ–¹æ¡ˆæ•°\n    for (int i=1;i<=steps;i++) {\n        //iæ­¥èƒ½è¾¾åˆ°çš„æœ€å¤§è·ç¦»å°±æ˜¯i,æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå–ä¸€ä¸ªæœ€å°å€¼\n        int k=Math.min(i,arrLen-1);\n        for (int j=0;j<=k;j++) {\n            if (j==0) {\n                dp[i][j]=(dp[i-1][j+1]+dp[i-1][j])%mod;\n            }else if (j<k) {\n                dp[i][j]=(dp[i-1][j-1]+dp[i-1][j+1]+dp[i-1][j])%mod;\n            }else{ //å¤§äºkå°±åªèƒ½æ˜¯ä»å³è¾¹è¿‡æ¥çš„\n                dp[i][j]=(dp[i-1][j-1]+dp[i-1][j])%mod;\n            }\n        }\n    }\n    return (int)dp[steps][0];\n}\n```\n**è§£æ³•äºŒ**\n\næˆ‘æ¯”è¾ƒå–œæ¬¢çš„è®°å¿†åŒ–é€’å½’ğŸ˜ï¼Œ10msç”šè‡³æ¯”ä¸Šé¢è¿˜å¿«ä¸€ç‚¹\n\n```java\nint mod=1_000_000_007;\n\n//cache\nLong[][] cache;\n\npublic int numWays(int steps, int arrLen) {\n    int maxIndex=Math.min(steps,arrLen-1);\n    cache=new Long[steps+1][maxIndex+1];\n    return (int)dfs(steps,0,maxIndex);\n}\n\npublic long dfs(int steps, int index,int maxIndex) {\n    if (steps==0) {\n        return index==0?1:0;\n    }\n    if (index<0 || index > maxIndex )  {\n        return 0;\n    }\n\n    if (cache[steps][index]!=null) {\n        return cache[steps][index];\n    }\n    //stepsä¸€ç›´åœ¨é€’å‡,stepsæœ€å¤šèµ°åˆ°stepsä½ç½®\n    //ä¸ºäº†èŠ‚çº¦æ—¶é—´å¯ä»¥åœ¨è¿™é‡Œä¼˜åŒ–ä¸‹\n    maxIndex=Math.min(steps,maxIndex);\n    //ä¸åŠ¨\n    long res=dfs(steps-1,index,maxIndex);\n    //å‘å·¦\n    res+=dfs(steps-1,index-1,maxIndex);\n    //å‘å³\n    res+=dfs(steps-1,index+1,maxIndex);\n    return cache[steps][index]=res%mod;\n}\n```\n\n## [152. ä¹˜ç§¯æœ€å¤§å­åºåˆ—](https://leetcode-cn.com/problems/maximum-product-subarray/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºä¸€ä¸ªåºåˆ—ä¸­ä¹˜ç§¯æœ€å¤§çš„è¿ç»­å­åºåˆ—ï¼ˆè¯¥åºåˆ—è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [2,3,-2,4]\nè¾“å‡º: 6\nè§£é‡Š: å­æ•°ç»„ [2,3] æœ‰æœ€å¤§ä¹˜ç§¯ 6ã€‚\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [-2,0,-1]\nè¾“å‡º: 0\nè§£é‡Š: ç»“æœä¸èƒ½ä¸º 2, å› ä¸º [-2,-1] ä¸æ˜¯å­æ•°ç»„ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nè‡ªå·±æœ€å¼€å§‹è‡ªå·±å†™å‡ºæ¥çš„è„‘ç˜«dp\n\n```java\npublic static int maxProduct(int[] nums) {\n    int[] dp1=new int[nums.length];\n    int[] dp2=new int[nums.length];\n    //æœ€å¤§å€¼\n    dp1[0]=nums[0]>=0?nums[0]:0;\n    //æœ€å°å€¼\n    dp2[0]=nums[0]>=0?0:nums[0];\n    int max=nums[0]>0?dp1[0]:dp2[0];\n    for(int i=1;i<nums.length;i++){\n        if (nums[i]>0) {\n            if (nums[i-1]<0) {\n                dp1[i]=dp1[i-1]!=0?nums[i]*dp1[i-1]:nums[i];\n                dp2[i]=dp2[i-1]*nums[i];\n            }else if(nums[i-1]>0){\n                dp1[i]=dp1[i-1]*nums[i];\n                dp2[i]=dp2[i-1]!=0?nums[i]*dp2[i-1]:0;\n            }else{\n                dp1[i]=nums[i];\n                dp2[i]=0;\n            }\n        }else if (nums[i]<0) {\n            if (nums[i-1]<0) {\n                dp1[i]=dp2[i-1]*nums[i];\n                dp2[i]=dp1[i-1]!=0?dp1[i-1]*nums[i]:nums[i];\n            }else if(nums[i-1]>0){\n                dp1[i]=dp1[i-1]!=0?nums[i]*dp2[i-1]:0;\n                dp2[i]=dp1[i-1]*nums[i];\n            }else{\n                dp1[i]=0;\n                dp2[i]=nums[i];\n            }\n        }else{\n            dp1[i]=0;\n            dp2[i]=0;\n        }\n        //System.out.println(dp1[i]+\",\"+dp2[i]);\n        max=Math.max(max,dp1[i]);\n    }\n    return max;\n}\n\n/**\n    //     -2  2  3   -4        \n    //dp1:  0  2  6   48        \n    //dp2: -2 -4 -12 -24 \n    //\n    // 2 -5   -2  -4   3\n    // 2  0   20   8   24\n    // 0 -10  -2  -80 -240\n*/\n```\nä¸æƒ³è§£é‡Šå¤ªå¤šï¼Œè™½ç„¶è¿‡äº†ï¼Œä½†æ˜¯ç¡®å®æœ‰ç‚¹è ¢\n\n**è§£æ³•äºŒ**\n\n`max[i],min[i]` ä»£è¡¨çš„å°±æ˜¯ä»¥`nums[i]` ç»“å°¾çš„**æœ€å¤§**ä¹˜ç§¯å’Œ**æœ€å°**ä¹˜ç§¯\n\n```java\npublic static int maxProduct(int[] nums) {\n    int[] min=new int[nums.length];\n    int[] max=new int[nums.length];\n    int res=max[0]=min[0]=nums[0];\n    for (int i=1;i<nums.length;i++) {\n        max[i]=Math.max(nums[i]*min[i-1],Math.max(nums[i],nums[i]*max[i-1]));\n        min[i]=Math.min(nums[i]*min[i-1],Math.min(nums[i],nums[i]*max[i-1]));\n        res=Math.max(res,max[i]);\n    }\n    return res;\n}\n```\nä¸ºä»€ä¹ˆè¦è®°å½•æœ€å°ä¹˜ç§¯ç›¸ä¿¡ä¸éœ€è¦æˆ‘å¤šè¯´äº†å§ï¼Œå…¶å®åªè¦æƒ³æ¸…æ¥šä¸€ç‚¹å°±okï¼Œæ¯ä¸ªä½ç½®çš„`max[i]`å…¶å®åªæœ‰ä¸‰ç§æ¥æºï¼ˆçº¸ä¸Šå†™å†™å°±æ˜ç™½äº†ï¼‰\n\n- `nums[i] >= 0` å¹¶ä¸”`max[i-1] > 0`ï¼Œ`max[i] = max[i-1] * nums[i]`\n-  `nums[i] >= 0` å¹¶ä¸”`max[i-1] < 0`ï¼Œæ­¤æ—¶å¦‚æœå’Œå‰è¾¹çš„æ•°ç´¯ä¹˜çš„è¯ï¼Œä¼šå˜æˆè´Ÿæ•°ï¼Œæ‰€ä»¥`max[i] = nums[i]`\n-  `nums[i] < 0`ï¼Œå¦‚æœæ˜¯è´Ÿæ•°å°±ä¸åº”è¯¥å†å’Œå‰é¢`max[i]`ç›¸ä¹˜ï¼Œè€Œæ˜¯è€ƒè™‘`min[i]`\n  - `å½“min[i-1] < 0ï¼Œmax[i] = min[i-1] * nums[i]`\n  - `å½“min[i-1] >= 0ï¼Œmax[i] = nums[i]`\n\n ç„¶åæˆ‘ä»¬ç›´æ¥æ±‚è¿™ä¸‰ç§æƒ…å†µçš„æœ€å¤§å€¼å°±okäº†ï¼Œä¸ç”¨è€ƒè™‘é‚£äº›åˆ†æ”¯ï¼Œæˆ‘ä¸Šé¢çš„ç¬¬ä¸€ç§è§£æ³•å…¶å®å°±æ˜¯è€ƒè™‘äº†æ‰€æœ‰åˆ†æ”¯ï¼Œç»“æœæ‰å†™å‡ºäº†é‚£æ ·çš„dpï¼Œ `min[i]` çš„è¿‡ç¨‹å’Œä¸Šé¢ä¸€æ ·ï¼Œå°±ä¸èµ˜è¿°\n\n\n## [1567. ä¹˜ç§¯ä¸ºæ­£æ•°çš„æœ€é•¿å­æ•°ç»„é•¿åº¦](https://leetcode-cn.com/problems/maximum-length-of-subarray-with-positive-product/)\n\nDifficulty: **ä¸­ç­‰**\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`Â ï¼Œè¯·ä½ æ±‚å‡ºä¹˜ç§¯ä¸ºæ­£æ•°çš„æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ã€‚\n\nä¸€ä¸ªæ•°ç»„çš„å­æ•°ç»„æ˜¯ç”±åŸæ•°ç»„ä¸­é›¶ä¸ªæˆ–è€…æ›´å¤šä¸ªè¿ç»­æ•°å­—ç»„æˆçš„æ•°ç»„ã€‚\n\nè¯·ä½ è¿”å›ä¹˜ç§¯ä¸ºæ­£æ•°çš„æœ€é•¿å­æ•°ç»„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹Â  1ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [1,-2,-3,4]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šæ•°ç»„æœ¬èº«ä¹˜ç§¯å°±æ˜¯æ­£æ•°ï¼Œå€¼ä¸º 24 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [0,1,-2,-3,-4]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šæœ€é•¿ä¹˜ç§¯ä¸ºæ­£æ•°çš„å­æ•°ç»„ä¸º [1,-2,-3] ï¼Œä¹˜ç§¯ä¸º 6 ã€‚\næ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠ 0 ä¹ŸåŒ…æ‹¬åˆ°å­æ•°ç»„ä¸­ï¼Œå› ä¸ºè¿™æ ·ä¹˜ç§¯ä¸º 0 ï¼Œä¸æ˜¯æ­£æ•°ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [-1,-2,-3,0,1]\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šä¹˜ç§¯ä¸ºæ­£æ•°çš„æœ€é•¿å­æ•°ç»„æ˜¯ [-1,-2] æˆ–è€… [-2,-3] ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [-1,2]\nè¾“å‡ºï¼š1\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [1,2,3,5,-6,4,0,10]\nè¾“å‡ºï¼š4\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= nums.length <= 10^5`\n*   `-10^9 <= nums[i]Â <= 10^9`\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹æƒ³æ­ªäº†ï¼Œå’Œä¸Šé¢ä¸€é¢˜æœ€å¼€å§‹ä¸€æ ·å†™äº†ä¸ªè´¼è ¢çš„dpï¼Œå¥½åœ¨åé¢è¿˜æ˜¯è‡ªå·±æƒ³å‡ºæ¥äº†ï¼Œä¸‹é¢çš„æ˜¯åé¢æƒ³å‡ºæ¥çš„ç®€å•è§£æ³•\n```golang\nfunc getMaxLen(nums []int) int {\n Â  Â var n = len(nums)\n    //dp[i][0]: \n Â  Â var dp = make([][2]int, n+1)\n Â  Â var res = 0\n Â  Â for i := 1; i <= n; i++ {\n Â  Â  Â  Â if nums[i-1] > 0 {\n Â  Â  Â  Â  Â  Â dp[i][0] = dp[i-1][0] + 1\n Â  Â  Â  Â  Â  Â if dp[i-1][1] != 0 {\n Â  Â  Â  Â  Â  Â  Â  Â dp[i][1] = dp[i-1][1] + 1 Â  \n Â  Â  Â  Â  Â   }\n Â  Â  Â   } else if nums[i-1] < 0 {\n Â  Â  Â  Â  Â  Â if dp[i-1][1] != 0 {\n Â  Â  Â  Â  Â  Â  Â  Â dp[i][0] = dp[i-1][1] + 1 Â  \n Â  Â  Â  Â  Â   }\n Â  Â  Â  Â  Â  Â dp[i][1] = dp[i-1][0] + 1\n Â  Â  Â   }\n Â  Â  Â  Â if dp[i][0] > res {\n Â  Â  Â  Â  Â  Â res = dp[i][0]\n Â  Â  Â   }\n Â   }\n Â  Â return res\n}\n```\n\n**è§£æ³•äºŒ**\n\nè´¼è ¢çš„DPï¼Œé¢å‘caseç¼–ç¨‹\n```golang\n//åƒåœ¾DPï¼Œé¢å‘caseç¼–ç¨‹ï¼Œæ²¡æœ‰caseä¸€è¾ˆå­æ”¹ä¸å‡ºæ¥ï¼ˆå±…ç„¶è¿˜è¢«æˆ‘æ”¹å¯¹äº†ï¼‰\n//100+ms æ—¶é—´å¤æ‚åº¦O(N^2)ï¼Œlcçš„caseæ²¡èƒ½å¡æ‰ï¼Œä½†æ˜¯åº”è¯¥æ˜¯å¯ä»¥æ„é€ å‡ºä¸€ç»„ç‰¹æ®Šcaseå¡æ‰çš„ï¼Œæ‡’å¾—æƒ³äº†\nfunc getMaxLen(nums []int) int {\n    var n = len(nums)\n    var dp = make([]int, n+1)\n    if nums[0] > 0 {\n        dp[0] = 1\n    }\n    var res = dp[0]\n    for i := 1; i < n; i++ {\n        if nums[i] > 0 {\n            dp[i] = dp[i-1] + 1\n        } else if nums[i] < 0 {\n            if i-dp[i-1]-1 >= 0 && nums[i-dp[i-1]-1] < 0 {\n                dp[i] = dp[i-1] + 2\n                if i-dp[i-1]-2 >= 0 {\n                    dp[i] += dp[i-dp[i-1]-2]\n                }   \n            } else {\n                //ä»i-dp[i-1]å¼€å§‹æ‰¾è´Ÿæ•°ï¼Œç„¶åä»è¿™ä¸ªè´Ÿæ•°æˆªæ–­\n                var cnt = 0\n                for k := i-dp[i-1]; k < i; k++ {\n                    if nums[k] < 0 {\n                        dp[i] = dp[i-1]-cnt\n                        break\n                    }\n                    cnt++\n                }\n            }\n        }\n        if dp[i] > res {\n            res = dp[i]\n        }\n    }\n    return res\n}\n```\n## [1594. çŸ©é˜µçš„æœ€å¤§éè´Ÿç§¯](https://leetcode-cn.com/problems/maximum-non-negative-product-in-a-matrix/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªå¤§å°ä¸º `rows x cols` çš„çŸ©é˜µ `grid` ã€‚æœ€åˆï¼Œä½ ä½äºå·¦ä¸Šè§’ `(0, 0)` ï¼Œæ¯ä¸€æ­¥ï¼Œä½ å¯ä»¥åœ¨çŸ©é˜µä¸­ **å‘å³** æˆ– **å‘ä¸‹** ç§»åŠ¨ã€‚\n\nåœ¨ä»å·¦ä¸Šè§’ `(0, 0)` å¼€å§‹åˆ°å³ä¸‹è§’ `(rows - 1, cols - 1)` ç»“æŸçš„æ‰€æœ‰è·¯å¾„ä¸­ï¼Œæ‰¾å‡ºå…·æœ‰ **æœ€å¤§éè´Ÿç§¯** çš„è·¯å¾„ã€‚è·¯å¾„çš„ç§¯æ˜¯æ²¿è·¯å¾„è®¿é—®çš„å•å…ƒæ ¼ä¸­æ‰€æœ‰æ•´æ•°çš„ä¹˜ç§¯ã€‚\n\nè¿”å› **æœ€å¤§éè´Ÿç§¯** å¯¹**`10<sup>9</sup>Â + 7`** **å–ä½™** çš„ç»“æœã€‚å¦‚æœæœ€å¤§ç§¯ä¸ºè´Ÿæ•°ï¼Œåˆ™è¿”å›`-1` ã€‚\n\n**æ³¨æ„ï¼Œ**å–ä½™æ˜¯åœ¨å¾—åˆ°æœ€å¤§ç§¯ä¹‹åæ‰§è¡Œçš„ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[-1,-2,-3],\nÂ             [-2,-3,-3],\nÂ             [-3,-3,-2]]\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼šä» (0, 0) åˆ° (2, 2) çš„è·¯å¾„ä¸­æ— æ³•å¾—åˆ°éè´Ÿç§¯ï¼Œæ‰€ä»¥è¿”å› -1\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[1,-2,1],\nÂ             [1,-2,1],\nÂ             [3,-4,1]]\nè¾“å‡ºï¼š8\nè§£é‡Šï¼šæœ€å¤§éè´Ÿç§¯å¯¹åº”çš„è·¯å¾„å·²ç»ç”¨ç²—ä½“æ ‡å‡º (1 * 1 * -2 * -4 * 1 = 8)\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[1, 3],\nÂ             [0,-4]]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šæœ€å¤§éè´Ÿç§¯å¯¹åº”çš„è·¯å¾„å·²ç»ç”¨ç²—ä½“æ ‡å‡º (1 * 0 * -4 = 0)\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šgrid = [[ 1, 4,4,0],\nÂ             [-2, 0,0,1],\nÂ             [ 1,-1,1,1]]\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šæœ€å¤§éè´Ÿç§¯å¯¹åº”çš„è·¯å¾„å·²ç»ç”¨ç²—ä½“æ ‡å‡º (1 * -2 * 1 * -1 * 1 * 1 = 2)\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= rows, cols <= 15`\n*   `-4 <= grid[i][j] <= 4`\n\n\n\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢ä¸¤é¢˜ä¸€æ ·ï¼Œéå¸¸å¥—è·¯çš„DPï¼Œä½†æ˜¯æˆ‘ä¸€å¼€å§‹æƒ³æŠŠåˆå§‹åŒ–ç»™çœæ‰ï¼Œè°ƒäº†åŠå¤©å‘ç°ä¸å¤ªå¥½æã€‚ã€‚ã€‚å¤–å›´çš„dpå–å€¼ä¼šå½±å“å†…éƒ¨çš„å–å€¼ï¼Œæ‰€ä»¥è¿˜æ˜¯è€è€å®å®æ‰‹åŠ¨åˆå§‹åŒ–ï¼Œè€æ˜¯æƒ³å·æ‡’æœ‰æ—¶å€™å¯èƒ½ä¼šé€‚å¾—å…¶åï¼ˆå¥½æœªæ¥ç¬”è¯•ï¼‰\n```golang\nfunc maxProductPath(grid [][]int) int {\n Â  Â var m, n = len(grid), len(grid[0])\n Â  Â var MOD = int(1e9+7)\n Â  Â var dp = make([][][2]int, m)\n Â  Â var Max = func(a, b int) int {if a < b {return b}; return a}\n Â  Â var Min = func(a, b int) int {if a > b {return b}; return a}\n Â  Â for i := 0; i < m; i++ {\n Â  Â  Â  Â dp[i] = make([][2]int, n)\n Â  Â }\n Â  Â dp[0][0][1] = grid[0][0]\n Â  Â dp[0][0][0] = grid[0][0]\n Â  Â for i := 1; i < m; i++ {\n Â  Â  Â  Â dp[i][0][0] = grid[i][0] * dp[i-1][0][0]\n Â  Â  Â  Â dp[i][0][1] = dp[i][0][0]\n Â   }\n Â  Â for j := 1; j < n; j++ {\n Â  Â  Â  Â dp[0][j][0] = grid[0][j] * dp[0][j-1][0]\n Â  Â  Â  Â dp[0][j][1] = dp[0][j][0]\n Â   }\n Â  Â for i := 1; i < m; i++ {\n Â  Â  Â  Â for j := 1; j < n; j++ {\n Â  Â  Â  Â  Â  Â if grid[i][j] > 0 {\n Â  Â  Â  Â  Â  Â  Â  Â dp[i][j][0] = Â grid[i][j] * Max(dp[i][j-1][0], dp[i-1][j][0])\n Â  Â  Â  Â  Â  Â  Â  Â dp[i][j][1] = Â grid[i][j] * Min(dp[i][j-1][1], dp[i-1][j][1])\n Â  Â  Â  Â  Â   }else if grid[i][j] < 0 {\n Â  Â  Â  Â  Â  Â  Â  Â dp[i][j][0] = Â grid[i][j] * Min(dp[i][j-1][1], dp[i-1][j][1])\n Â  Â  Â  Â  Â  Â  Â  Â dp[i][j][1] = Â grid[i][j] * Max(dp[i][j-1][0], dp[i-1][j][0])\n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â   }\n Â  Â if dp[m-1][n-1][0] < 0 {\n Â  Â  Â  Â return -1\n Â   }\n Â  Â return dp[m-1][n-1][0] % MOD\n}\n```\n\n\n## [221. æœ€å¤§æ­£æ–¹å½¢](https://leetcode-cn.com/problems/maximal-square/)\n\nåœ¨ä¸€ä¸ªç”± 0 å’Œ 1 ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« 1 çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: \n\n1 0 1 0 0\n1 0 1 1 1\n1 1 1 1 1\n1 0 0 1 0\n\nè¾“å‡º: 4\n```\n\n**è§£æ³•ä¸€**\n\né€’æ¨å…¬å¼ï¼š`dp[i][j]=1+min(dp[i-1][j-1],dp[i-1][j],dp[i][j-1])`  æœ‰çš„ç±»ä¼¼çŸ­æ¿ç†è®ºï¼Œå–å†³äºæœ€å°çš„å“ªä¸€ä¸ªæ­£æ–¹å½¢\n\n```java\npublic int maximalSquare(char[][] matrix) {\n    if (matrix==null || matrix.length<=0) {\n        return 0;\n    }\n    int m=matrix.length;\n    int n=matrix[0].length;\n    //è¿™é‡Œ+1å¤„ç†è¾¹ç•Œ\n    int[][] dp=new int[m+1][n+1];\n    int max=0;\n    for (int i=1;i<=m;i++) {\n        for (int j=1;j<=n;j++) {\n            if (matrix[i-1][j-1]=='1') {\n                dp[i][j]=1+Math.min(dp[i-1][j-1],Math.min(dp[i][j-1],dp[i-1][j]));\n                max=Math.max(max,dp[i][j]);\n            }\n        }\n    }\n    return max*max;\n}\n```\n\nè¿™é¢˜è¿˜æœ‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯è¾¹ç•Œçš„å¤„ç†ï¼Œè¿™é‡Œå®ç°çš„ä»£ç ä¸­`dp[i][j]` å…¶å®è¡¨ç¤ºçš„æ˜¯ä»¥ `matrix[i-1][j-1]` ä½œä¸ºå³ä¸‹è§’ç»“å°¾çš„æ­£æ–¹å½¢çš„æœ€å¤§è¾¹é•¿ï¼Œè¿™æ ·çš„è¯å°±ä¸ç”¨è€ƒè™‘ä¸Šä¸‹ä¸¤æ¡è¾¹çš„è¾¹ç•Œcaseï¼Œç›¸å½“äºåœ¨dpæ•°ç»„ä¸Šä¸‹è¾¹ç•Œä¹‹å¤–åˆåŠ äº†ä¸€å±‚ 0\n\n> åˆ°è¿™é‡Œæˆ‘ä¹Ÿå¤§è‡´æ˜ç™½äº†ä¸€äº›åŠ¨æ€è§„åˆ’çš„é¢˜ç›®çš„é€’æ¨å†™æ³•ä¸ºéƒ½æ˜¯ä»1å¼€å§‹äº†ï¼Œæ¯”å¦‚ä¸Šé¢çš„ç¼–è¾‘è·ç¦»\n\n## [1277. ç»Ÿè®¡å…¨ä¸º 1 çš„æ­£æ–¹å½¢å­çŸ©é˜µ](https://leetcode-cn.com/problems/count-square-submatrices-with-all-ones/)\n\nç»™ä½ ä¸€ä¸ª `m * n` çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­çš„å…ƒç´ ä¸æ˜¯ `0` å°±æ˜¯ `1`ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å›å…¶ä¸­å®Œå…¨ç”± `1` ç»„æˆçš„ **æ­£æ–¹å½¢** å­çŸ©é˜µçš„ä¸ªæ•°ã€‚\n\nç¤ºä¾‹ 1ï¼š\n\n```java\nè¾“å…¥ï¼šmatrix =\n[\n  [0,1,1,1],\n  [1,1,1,1],\n  [0,1,1,1]\n]\nè¾“å‡ºï¼š15\nè§£é‡Šï¼š \nè¾¹é•¿ä¸º 1 çš„æ­£æ–¹å½¢æœ‰ 10 ä¸ªã€‚\nè¾¹é•¿ä¸º 2 çš„æ­£æ–¹å½¢æœ‰ 4 ä¸ªã€‚\nè¾¹é•¿ä¸º 3 çš„æ­£æ–¹å½¢æœ‰ 1 ä¸ªã€‚\næ­£æ–¹å½¢çš„æ€»æ•° = 10 + 4 + 1 = 15.\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šmatrix = \n[\n  [1,0,1],\n  [1,1,0],\n  [1,1,0]\n]\nè¾“å‡ºï¼š7\nè§£é‡Šï¼š\nè¾¹é•¿ä¸º 1 çš„æ­£æ–¹å½¢æœ‰ 6 ä¸ªã€‚ \nè¾¹é•¿ä¸º 2 çš„æ­£æ–¹å½¢æœ‰ 1 ä¸ªã€‚\næ­£æ–¹å½¢çš„æ€»æ•° = 6 + 1 = 7.\n```\n\n**æç¤ºï¼š**\n\n- `1 <= arr.length <= 300`\n- `1 <= arr[0].length <= 300`\n- `0 <= arr[i][j] <= 1`\n\n**è§£æ³•ä¸€**\n\n12.1çš„å‘¨èµ›é¢˜ç›®ï¼Œå…¶å®å…ˆåšçš„ä¸Šé¢çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œç„¶åå‘ç°è¿™ä¸€é¢˜å’Œä¸Šé¢çš„ä¸€æ ·ã€‚\n\n```java\npublic int countSquares(int[][] matrix) {\n    if (matrix==null || matrix.length<=0) {\n        return 0;\n    }\n    int m=matrix.length;\n    int n=matrix[0].length;\n    int [][]dp=new int[m+1][n+1];\n    int res=0;\n    for (int i=1;i<=m;i++) {\n        for (int j=1;j<=n;j++) {\n            if (matrix[i-1][j-1]==1) {\n                dp[i][j]=Math.min(dp[i-1][j-1],Math.min(dp[i][j-1],dp[i-1][j]))+1;\n                res+=dp[i][j];\n            }\n        }\n    }\n    return res;\n}\n```\n\nä¸€æ‘¸ä¸€æ ·ï¼Œç†è§£ä¸€ç‚¹å°±okï¼Œ**ä»¥`matrix[i][j]` ä¸ºå³ä¸‹è§’çš„æœ€å¤§æ­£æ–¹å½¢çš„è¾¹é•¿ï¼Œå°±æ˜¯ä»¥è¿™ä¸ªç‚¹ä¸ºå³ä¸‹è§’çš„æ­£æ–¹å½¢çš„æ•°é‡ï¼ï¼ï¼**\n\n## [1139. æœ€å¤§çš„ä»¥ 1 ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢](https://leetcode-cn.com/problems/largest-1-bordered-square/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªç”±è‹¥å¹² `0` å’Œ `1` ç»„æˆçš„äºŒç»´ç½‘æ ¼Â `grid`ï¼Œè¯·ä½ æ‰¾å‡ºè¾¹ç•Œå…¨éƒ¨ç”± `1` ç»„æˆçš„æœ€å¤§ **æ­£æ–¹å½¢** å­ç½‘æ ¼ï¼Œå¹¶è¿”å›è¯¥å­ç½‘æ ¼ä¸­çš„å…ƒç´ æ•°é‡ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› `0`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```golang\nè¾“å…¥ï¼šgrid = [[1,1,1],[1,0,1],[1,1,1]]\nè¾“å‡ºï¼š9\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```golang\nè¾“å…¥ï¼šgrid = [[1,1,0,0]]\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= grid.length <= 100`\n*   `1 <= grid[0].length <= 100`\n*   `grid[i][j]` ä¸ºÂ `0`Â æˆ–Â `1`\n\n**è§£æ³•ä¸€**\n\nè¿™ä¸ªé¢˜ç›®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œç¬¬ä¸€æ¬¡çœ‹äº†ä»¥åæ²¡å•¥æ€è·¯ï¼Œçœ‹äº†é¢˜è§£å¯¹dpæ•°ç»„çš„çš„å®šä¹‰åå°±æ˜ç™½äº†ï¼Œä»Šå¤©æ¥å®ç°ä¸‹ï¼ŒWAäº†2æ¬¡ï¼Œéƒ½WAçš„æœ‰ç†æœ‰æ®ï¼Œå¾ˆèˆ’æœï¼Œåšè¿™ç§é¢˜å°±å¾ˆèˆ’æœ\n\n```java\npublic int largest1BorderedSquare(int[][] grid) {\n    int m = grid.length;\n    int n = grid[0].length;\n    //dp[i][j][0]: i,jå·¦è¾¹è¿ç»­çš„1çš„ä¸ªæ•°\n    //dp[i][j][1]: i,jä¸Šè¾¹è¿ç»­çš„1çš„ä¸ªæ•°\n    int[][][] dp = new int[m+1][n+1][2];\n    for (int i = 1; i <= m; i++) {\n        for (int j = 1; j <= n; j++) {\n            if (grid[i-1][j-1] == 1){\n                dp[i][j][0] = 1 + dp[i][j-1][0];\n                dp[i][j][1] = 1 + dp[i-1][j][1];\n            }\n        }\n    }\n    int res = 0;\n    for (int i = 1; i <= m; i++) {\n        for (int j = 1; j <= n; j++) {\n            //WAç‚¹2ï¼šæœ€çŸ­çš„é‚£æ¡è¾¹ä¸ä¸€å®šæ˜¯è¾¹é•¿ï¼Œå¯ä»¥æ›´çŸ­æ‰€ä»¥éœ€è¦éå†æ‰€æœ‰å°äºæœ€çŸ­è¾¹é•¿çš„é•¿åº¦\n            //æ‰€ä»¥é¢˜ç›®çš„æ•°æ®èŒƒå›´æ˜¯ä¸ä¼šéª—äººçš„ï¼Œç»™çš„100é‚£ä¹ˆæ—¶é—´å¤æ‚åº¦ä¸€å®šä¸æ˜¯N2çš„\n            for (int side = Math.min(dp[i][j][0], dp[i][j][1]); side >= 1; side--){\n                //WAç‚¹1ï¼šå¤§äºç­‰äº\n                if (dp[i][j-side+1][1] >= side && dp[i-side+1][j][0] >= side){\n                    res = Math.max(res, side);\n                    break; //æ›´çŸ­çš„å°±æ²¡å¿…è¦è€ƒè™‘äº†\n                }\n            }\n        }\n    }\n    return res * res;\n}\n```\nå…¶å®è¿™ä¸ªé¢˜ç›®çš„å…³é”®å°±åœ¨äºçŠ¶æ€çš„å®šä¹‰ï¼Œå¦‚ä½•å»æ„é€ ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œä¸€å›¾èƒœåƒè¨€ï¼ˆPPTç”»å›¾è¿˜æ˜¯æŒºæ–¹ä¾¿ï¼‰\n![mark](http://static.imlgw.top/blog/20200730/2NpjXbbGcEjQ.png?imageslim)\nï¼ˆä¹‹å‰çš„å›¾æœ‰ç‚¹å°é—®é¢˜ï¼Œæ”¹äº†ä¸‹ï¼‰\n\næ±‚ä»¥æŸä¸ªç‚¹ä¸ºå³ä¸‹è§’çš„æ­£æ–¹å½¢ï¼Œé¦–å…ˆæˆ‘ä»¬è€ƒè™‘è¿™ä¸ªç‚¹ä¸ºå³ä¸‹è§’å¯èƒ½æ„æˆçš„æœ€å¤§æ­£æ–¹å½¢è¾¹é•¿æ˜¯å¤šå¤§\n\nå¾ˆæ˜æ˜¾åº”è¯¥æ˜¯è¯¥ç‚¹å·¦è¾¹å’Œä¸Šè¾¹è¿ç»­1ä¸ªæ•°çš„æœ€å°å€¼ï¼Œå¦‚ä¸Šå›¾çš„ï¼ˆ6ï¼Œ5ï¼‰ç‚¹ï¼Œæœ€å¤§çš„å¯èƒ½è¾¹é•¿å°±åº”è¯¥æ˜¯6ï¼Œç„¶åæˆ‘ä»¬æšä¸¾æ‰€æœ‰çš„å°äºç­‰äº6å¤§äºç­‰äº1çš„è¾¹é•¿sideï¼ŒéªŒè¯sideèƒ½å¦æ„æˆæ­£æ–¹å½¢\n\néªŒè¯sideæ˜¯å¦åˆæ³•ä¹Ÿå¾ˆå®¹æ˜“ï¼Œå¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ï¼ˆ6ï¼Œ5ï¼‰ä¸Šè¾¹è·ç¦»ä¸ºsideçš„ç‚¹çš„å·¦è¾¹è¿ç»­1çš„ä¸ªæ•°æ˜¯å¦å¤§äºç­‰äºsideï¼ˆ`dp[i-side+1][j][0] >= side`ï¼‰ï¼Œä»¥åŠå·¦è¾¹è·ç¦»ä¸ºsideçš„ç‚¹çš„ä¸Šè¾¹è¿ç»­çš„1çš„ä¸ªæ•°æ˜¯å¦å¤§äºç­‰äºsideï¼ˆ`dp[i][j-side+1][1] >= side`ï¼‰ï¼Œå¦‚æœéƒ½å¤§äºç­‰äºsideé‚£ä¹ˆè¯¥sideå°±æ˜¯åˆæ³•çš„ï¼Œæˆ‘ä»¬ç»Ÿè®¡è¿™äº›åˆæ³•çš„sideçš„æœ€å¤§å€¼å°±okäº†\n\n\n> åœ¨lcä¸Šæ°´äº†ä¸€å‘[é¢˜è§£](https://leetcode-cn.com/problems/largest-1-bordered-square/solution/java-dong-tai-gui-hua-by-resolmi/)\n\n## [44. é€šé…ç¬¦åŒ¹é…](https://leetcode-cn.com/problems/wildcard-matching/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² (s) å’Œä¸€ä¸ªå­—ç¬¦æ¨¡å¼ (p) ï¼Œå®ç°ä¸€ä¸ªæ”¯æŒ '?' å’Œ '*' çš„é€šé…ç¬¦åŒ¹é…ã€‚\n\n```java\n'?' å¯ä»¥åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚\n'*' å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼‰ã€‚\n```\n\nä¸¤ä¸ªå­—ç¬¦ä¸²å®Œå…¨åŒ¹é…æ‰ç®—åŒ¹é…æˆåŠŸã€‚\n\n**è¯´æ˜:**\n\n- s å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚\n- p å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ï¼Œä»¥åŠå­—ç¬¦ ? å’Œ *ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\ns = \"aa\"\np = \"a\"\nè¾“å‡º: false\nè§£é‡Š: \"a\" æ— æ³•åŒ¹é… \"aa\" æ•´ä¸ªå­—ç¬¦ä¸²ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\ns = \"aa\"\np = \"*\"\nè¾“å‡º: true\nè§£é‡Š: '*' å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ä¸²ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥:\ns = \"cb\"\np = \"?a\"\nè¾“å‡º: false\nè§£é‡Š: '?' å¯ä»¥åŒ¹é… 'c', ä½†ç¬¬äºŒä¸ª 'a' æ— æ³•åŒ¹é… 'b'ã€‚\n```\n\n**ç¤ºä¾‹ 4:**\n\n```java\nè¾“å…¥:\ns = \"adceb\"\np = \"*a*b\"\nè¾“å‡º: true\nè§£é‡Š: ç¬¬ä¸€ä¸ª '*' å¯ä»¥åŒ¹é…ç©ºå­—ç¬¦ä¸², ç¬¬äºŒä¸ª '*' å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² \"dce\".\n```\n\n**ç¤ºä¾‹ 5:**\n\n```java\nè¾“å…¥:\ns = \"acdcb\"\np = \"a*c?b\"\nè¾“å…¥: false\n```\n\n**è§£æ³•ä¸€**\n\nå…¶å®è¿™é¢˜è¿˜æœ‰ä¸€é“ç±»ä¼¼çš„é¢˜ï¼Œ[10. æ­£åˆ™è¡¨è¾¾å¼ç”Ÿæˆ](http://imlgw.top/2019/10/10/leetcode-hui-su/#10-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D) æˆ‘æ”¾åœ¨å›æº¯é‡Œäº†ï¼Œå› ä¸ºdpçš„è§£æ³•æš‚æ—¶è¿˜æ²¡èŠ±æ—¶é—´å»çœ‹ï¼Œæ„Ÿè§‰é€’å½’å¥½ç†è§£ä¸€ç‚¹ï¼Œåé¢æœ‰æ—¶é—´å†åŠ è¿›æ¥\n\n```java\npublic boolean isMatch(String s, String p) {\n    //dp[i][j]ä»£è¡¨s[0,i-1](sçš„å‰iä¸ªå­—ç¬¦),p[0,j-1](pçš„å‰jä¸ªå­—ç¬¦)æ˜¯å¦åŒ¹é…\n    boolean[][] dp=new boolean[s.length()+1][p.length()+1];        \n    //dp[i][0]=false dp[0][j] p[j]==\"*\"|\"?\"\n    dp[0][0]=true;\n    for (int j=1;j<=p.length();j++) {\n        if (p.charAt(j-1)=='*') {\n            dp[0][j]=dp[0][j-1]; //dp[0][j]=trueæ˜¯é”™çš„\n        }\n    }\n    //1. p[i]=p[j] dp[i][j]=dp[i-1][j-1]\n    //2. p[j]=\"?\"  dp[i][j]=dp[i-1][j-1]\n    //3. p[j]=\"*\"  dp[i][j]=dp[i-1][j] | dp[i][j-1]\n    for (int i=1;i<=s.length();i++) {\n        for (int j=1;j<=p.length();j++) {\n            if (s.charAt(i-1) == p.charAt(j-1) || p.charAt(j-1)=='?') {\n                dp[i][j]=dp[i-1][j-1];\n            }else if (p.charAt(j-1)=='*') { //abcd ab* | ab ab*\n                dp[i][j]=dp[i-1][j]|dp[i][j-1];\n            }\n        }\n    }\n    return dp[s.length()][p.length()];\n}\n```\n\næ€è·¯éƒ½åœ¨æ³¨é‡Šé‡Œé¢äº†ï¼Œæ¯”æ­£åˆ™é‚£ä¸ªè¦ç®€å•ï¼Œæ¯”è¾ƒä¸å¥½æƒ³çš„ä¸€ç‚¹å°±æ˜¯ `dp[i][j]=dp[i-1][j]|dp[i][j-1]`å…¶å®åˆ†åˆ«å¯¹åº”çš„å°±æ˜¯ `*` **åŒ¹é…ä»»æ„å­—ç¬¦**çš„æƒ…å†µå’Œ**åŒ¹é…ç©ºå­—ç¬¦**çš„æƒ…å†µï¼ŒåŒ¹é…ä»»æ„å­—ç¬¦ä¸ºä»€ä¹ˆä¸æ˜¯`dp[i-1][j-1]`? å› ä¸º`*` ä¸ä»…ä»…åªå¯ä»¥åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œå®ƒå¯ä»¥åŒ¹é…ä»»æ„ä¸ªæ•°çš„ä»»æ„å­—ç¬¦ï¼Œå°±æ¯”å¦‚è¿™æ ·çš„` abcdï¼Œab* ` çš„ï¼Œè¿™ç§æƒ…å†µå…¶å®æœ€ç»ˆè¿˜æ˜¯è½¬æ¢æˆäº†åŒ¹é…ç©ºå­—ç¬¦çš„æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯åŠ¨æ€è§„åˆ’çš„æ€æƒ³æ‰€åœ¨ã€‚\n\n## [10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…](https://leetcode-cn.com/problems/regular-expression-matching/)\n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² `s` å’Œä¸€ä¸ªå­—ç¬¦è§„å¾‹ `p`ï¼Œè¯·ä½ æ¥å®ç°ä¸€ä¸ªæ”¯æŒ `'.'` å’Œ `'*'` çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚\n\n```java\n'.' åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦\n'*' åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ \n```\n\n\næ‰€è°“åŒ¹é…ï¼Œæ˜¯è¦æ¶µç›– æ•´ä¸ª å­—ç¬¦ä¸² sçš„ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚\n\n**è¯´æ˜:**\n\n- s å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚\n- p å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ï¼Œä»¥åŠå­—ç¬¦ . å’Œ *ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\ns = \"aa\"\np = \"a\"\nè¾“å‡º: false\nè§£é‡Š: \"a\" æ— æ³•åŒ¹é… \"aa\" æ•´ä¸ªå­—ç¬¦ä¸²ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\ns = \"aa\"\np = \"a*\"\nè¾“å‡º: true\nè§£é‡Š: å› ä¸º '*' ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ 'a'ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² \"aa\" å¯è¢«è§†ä¸º 'a' é‡å¤äº†ä¸€æ¬¡ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥:\ns = \"ab\"\np = \".*\"\nè¾“å‡º: true\nè§£é‡Š: \".*\" è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ'*'ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ'.'ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 4:**\n\n```java\nè¾“å…¥:\ns = \"aab\"\np = \"c*a*b\"\nè¾“å‡º: true\nè§£é‡Š: å› ä¸º '*' è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªï¼Œè¿™é‡Œ 'c' ä¸º 0 ä¸ª, 'a' è¢«é‡å¤ä¸€æ¬¡ã€‚å› æ­¤å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² \"aab\"ã€‚\n```\n\n**ç¤ºä¾‹ 5:**\n\n```java\nè¾“å…¥:\ns = \"mississippi\"\np = \"mis*is*p*.\"\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\ndfså›æº¯ï¼Œæš´åŠ›è§£æ³•ï¼ŒæŒºéš¾æ\n\n```java\npublic boolean isMatch(String s, String p) {\n    return match(s,0,p,0);\n}\n\npublic boolean match(String s,int sIdx, String p,int pIdx) {\n    if (sIdx>=s.length() && pIdx>=p.length()) {\n        return true;\n    }\n    if (pIdx>=p.length()) {\n        return false;\n    }\n    //è¿™é‡Œçš„åˆ¤æ–­å…¶å®ä¸å¤ªå¯¹,ä¹Ÿä¸èƒ½è¯´ä¸å¯¹,ä¼šç¨å¾®æ…¢ä¸€ç‚¹,å› ä¸ºé¢˜ç›®ä¸­æ˜¯ä¸ä¼šç»™**è¿™æ ·çš„caseçš„\n    //å¯ä»¥ç›´æ¥ä¸€æ¬¡è·³ä¸¤æ­¥åˆ¤æ–­æ˜¯ä¸æ˜¯*\n    if (sIdx == s.length()) {\n        //åé¢æ²¡æœ‰*çš„æƒ…å†µ aaa aaaa\n        if (pIdx==p.length()-1 && p.charAt(pIdx)!='*') { //pä¹Ÿåˆ°å°½å¤´,å¹¶ä¸”ä¸ä¸º*\n            return false;\n        }\n        while(pIdx<p.length()){ //pæ²¡åˆ°å°½å¤´,æ£€æŸ¥åé¢çš„æ˜¯å¦æœ‰ä¸¤ä¸ªè¿ç»­çš„é*\n            if (p.charAt(pIdx) != '*' && (pIdx+1<p.length() && p.charAt(pIdx+1)!='*')) {\n                return false;\n            }\n            pIdx++;\n        }\n        //aaa aaa*c\n        return p.charAt(pIdx-1)=='*';\n    }\n\n    if (pIdx+1 < p.length() && p.charAt(pIdx+1) =='*') { //pIdxä¸‹ä¸€ä¸ªæ˜¯ *\n        //*åŒ¹é…è‡³å°‘ä¸€ä¸ª\n        if ((s.charAt(sIdx) == p.charAt(pIdx) || p.charAt(pIdx)=='.') && match(s,sIdx+1,p,pIdx)) {\n            return true;\n        }\n        //*åŒ¹é…0ä¸ª\n        return match(s,sIdx,p,pIdx+2);\n    }else{\n        //pIdxä¸‹ä¸€ä¸ªä¸æ˜¯*\n        if ((p.charAt(pIdx) == s.charAt(sIdx) || p.charAt(pIdx)=='.') && match(s,sIdx+1,p,pIdx+1)) {\n            return true;\n        }\n        return false;\n    }\n}\n```\n\nè¿™é¢˜è¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œæ¯•ç«Ÿæ˜¯hardé¢˜ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹äº†é¢˜è§£æ‰å†™å‡ºæ¥ï¼Œæ ¸å¿ƒå°±æ˜¯è¦æŠŠé¢˜ç›®æ„æ€ç†è§£å¯¹ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰åšè®°å¿†åŒ–ï¼Œæ‡’å¾—å†™\n\n**è§£æ³•äºŒ**\n\nä»–æ¥äº†ä»–æ¥äº†ï¼Œä»–å¸¦ç€dpè§£æ³•æ¥äº†ï¼Œç»ˆäºè¿˜æ˜¯æŠŠdpçš„è§£æ³•è¡¥ä¸Šæ¥äº†ï¼Œå‚è€ƒ[é¢˜è§£ ](https://leetcode-cn.com/problems/regular-expression-matching/solution/dong-tai-gui-hua-si-yao-su-by-a380922457-5/) ï¼Œæ³¨æ„ä¸‹æ ‡çš„è½¬æ¢ï¼Œè¿™é‡Œå®¹æ˜“è¢«ç»•è¿›å»ï¼Œè¯¦ç»†çš„éƒ½åœ¨æ³¨é‡Šä¸­äº†\n\n```java\n//update: 2020.4.12\npublic boolean isMatch(String text, String pattern) {\n    //dp[i][j]ä»£è¡¨ text[0,i)å’Œpattern[0,j)æ˜¯å¦åŒ¹é…\n    boolean[][] dp=new boolean[text.length()+1][pattern.length()+1];\n    //éƒ½ä¸ºç©ºçš„æ—¶å€™è‚¯å®šæ˜¯åŒ¹é…çš„\n    dp[0][0]=true;\n    //patternä¸ºç©ºï¼Œtextä¸ä¸ºç©ºè‚¯å®šæ˜¯æ— æ³•åŒ¹é…,é»˜è®¤false,ä¸ç”¨å¤„ç†\n    //textä¸ºç©º,patternä¸ä¸ºç©ºéœ€è¦é¢å¤–åˆ¤æ–­\n    for(int i=2;i<=pattern.length();i++){\n        dp[0][i]=pattern.charAt(i-1)=='*'&&dp[0][i-2];\n    }\n\n    for(int i=1;i<=text.length();i++){\n        for(int j=1;j<=pattern.length();j++){\n            if(singleMatch(text,pattern,i-1,j-1)){\n                dp[i][j]=dp[i-1][j-1];\n            }else if(pattern.charAt(j-1)=='*'){\n                //jä¸€å®šæ˜¯>=2çš„,på¦‚æœæ˜¯*å¼€å¤´å°±æ˜¯é”™è¯¯çš„è¯­æ³•,ä¸è¿‡lcå…¶å®ä¹Ÿæ²¡æœ‰è¿™æ ·çš„case\n                if(j<2) return false;\n                //ab abb*    --> '*'åŒ¹é…0ä¸ªb\n                //abbbbb ab* --> '*'åŒ¹é…å¤šä¸ªb\n                //æ³¨æ„dp[i-1][j]å’Œtext.charAt(i-1)çš„i-1å«ä¹‰æ˜¯ä¸ä¸€æ ·çš„\n                //text.charAt(i-1)çš„i-1å…¶å®æŒ‡çš„æ˜¯å½“å‰å…ƒç´ ,è€Œdp[i-1][j]ä¸­çš„i-1æ˜¯å‰ä¸€ä¸ªå…ƒç´ \n                //abc ab*\n                dp[i][j]=dp[i][j-2] || (singleMatch(text,pattern,i-1,j-2) && dp[i-1][j]);\n            }\n        }\n    }\n    return dp[text.length()][pattern.length()];\n}\n\npublic boolean singleMatch(String s,String p,int i,int j){\n    return s.charAt(i)==p.charAt(j) || p.charAt(j)=='.';\n}\n```\n\næœç„¶è¿˜æ˜¯åŠ¨æ€è§„åˆ’ç®€æ´ï¼Œè€Œä¸”ææ‡‚ä¹‹åä¹Ÿå¾ˆå¥½ç†è§£~~\n\n## [1326. çŒæº‰èŠ±å›­çš„æœ€å°‘æ°´é¾™å¤´æ•°ç›®](https://leetcode-cn.com/problems/minimum-number-of-taps-to-open-to-water-a-garden/) \n\nåœ¨ x è½´ä¸Šæœ‰ä¸€ä¸ªä¸€ç»´çš„èŠ±å›­ã€‚èŠ±å›­é•¿åº¦ä¸º nï¼Œä»ç‚¹ 0 å¼€å§‹ï¼Œåˆ°ç‚¹ n ç»“æŸã€‚\n\nèŠ±å›­é‡Œæ€»å…±æœ‰ n + 1 ä¸ªæ°´é¾™å¤´ï¼Œåˆ†åˆ«ä½äº [0, 1, ..., n] ã€‚\n\nç»™ä½ ä¸€ä¸ªæ•´æ•° n å’Œä¸€ä¸ªé•¿åº¦ä¸º n + 1 çš„æ•´æ•°æ•°ç»„ ranges ï¼Œå…¶ä¸­ ranges[i] ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰è¡¨ç¤ºï¼šå¦‚æœæ‰“å¼€ç‚¹ i å¤„çš„æ°´é¾™å¤´ï¼Œå¯ä»¥çŒæº‰çš„åŒºåŸŸä¸º [i -  ranges[i], i + ranges[i]] ã€‚\n\nè¯·ä½ è¿”å›å¯ä»¥çŒæº‰æ•´ä¸ªèŠ±å›­çš„ æœ€å°‘æ°´é¾™å¤´æ•°ç›® ã€‚å¦‚æœèŠ±å›­å§‹ç»ˆå­˜åœ¨æ— æ³•çŒæº‰åˆ°çš„åœ°æ–¹ï¼Œè¯·ä½ è¿”å› -1 ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/02/03/kAPc2ELusMa9qJZ.png)\n\n```java\nè¾“å…¥ï¼šn = 5, ranges = [3,4,1,1,0,0]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼š\nç‚¹ 0 å¤„çš„æ°´é¾™å¤´å¯ä»¥çŒæº‰åŒºé—´ [-3,3]\nç‚¹ 1 å¤„çš„æ°´é¾™å¤´å¯ä»¥çŒæº‰åŒºé—´ [-3,5]\nç‚¹ 2 å¤„çš„æ°´é¾™å¤´å¯ä»¥çŒæº‰åŒºé—´ [1,3]\nç‚¹ 3 å¤„çš„æ°´é¾™å¤´å¯ä»¥çŒæº‰åŒºé—´ [2,4]\nç‚¹ 4 å¤„çš„æ°´é¾™å¤´å¯ä»¥çŒæº‰åŒºé—´ [4,4]\nç‚¹ 5 å¤„çš„æ°´é¾™å¤´å¯ä»¥çŒæº‰åŒºé—´ [5,5]\nåªéœ€è¦æ‰“å¼€ç‚¹ 1 å¤„çš„æ°´é¾™å¤´å³å¯çŒæº‰æ•´ä¸ªèŠ±å›­ [0,5] ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 3, ranges = [0,0,0,0]\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼šå³ä½¿æ‰“å¼€æ‰€æœ‰æ°´é¾™å¤´ï¼Œä½ ä¹Ÿæ— æ³•çŒæº‰æ•´ä¸ªèŠ±å›­ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 7, ranges = [1,2,1,0,2,1,0,1]\nè¾“å‡ºï¼š3\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 8, ranges = [4,0,0,0,0,0,0,0,4]\nè¾“å‡ºï¼š2\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 8, ranges = [4,0,0,0,4,0,0,0,4]\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n- `1 <= n <= 10^4`\n- `ranges.length == n + 1`\n- `0 <= ranges[i] <= 100`\n\n**è§£æ³•ä¸€**\n\n172å‘¨èµ›çš„æœ€åä¸€é¢˜\n\n```java\npublic int minTaps(int n, int[] ranges) {\n    int[] dp=new int[n+1]; //æµ‡æº‰iä½ç½®å‰éœ€è¦æœ€å°‘çš„æ°´é¾™å¤´\n    Arrays.fill(dp,Integer.MAX_VALUE);\n    dp[0]=0;\n    for (int i=0;i<=n;i++) {\n        int left=Math.max(0,i-ranges[i]);\n        int right=Math.min(n,i+ranges[i]);\n        if (dp[left]==Integer.MAX_VALUE) { //å·¦è¾¹ç•Œä¸å¯è¾¾\n            continue;\n        }\n        for (int j=left+1;j<=right;j++) {\n            dp[j]=Math.min(dp[j],dp[left]+1); //èŒƒå›´å†…çš„åŒºåŸŸdpå€¼\n        }\n    }\n    return dp[n]==Integer.MAX_VALUE?-1:dp[n];\n}\n```\n\nåŠ¨æ€è§„åˆ’çš„è§£æ³•ï¼Œå¯¹æ¯ä¸ªæ°´é¾™å¤´æ‰€è¦†ç›–çš„åŒºåŸŸè¿›è¡Œé€’æ¨ï¼Œdp[i]ä»£è¡¨æµ‡çŒ`0 ~ i` ä½ç½®åŒºåŸŸæ‰€éœ€è¦çš„æœ€å°‘çš„æ°´å¤´æ‰€ä»¥å¾ˆå®¹æ˜“å¾—åˆ°é€’æ¨å…¬å¼`dp[j]=Math.min(dp[j],dp[left]+1)`  ï¼Œæ•´ä½“è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„\n\n**è§£æ³•äºŒ**\n\nè´ªå¿ƒç®—æ³•ï¼Œå’Œ[è´ªå¿ƒä¸“é¢˜](http://imlgw.top/2020/01/21/leetcode-tan-xin/)ä¸­çš„ [1024. è§†é¢‘å‰ªè¾‘](http://imlgw.top/2020/01/21/leetcode-tan-xin/#1024-%E8%A7%86%E9%A2%91%E6%8B%BC%E6%8E%A5)æ˜¯ä¸€æ ·çš„é¢˜ç›®\n\næœ‰æ—¶é—´å†æ¥è¡¥å§\n\n## [1335. å·¥ä½œè®¡åˆ’çš„æœ€ä½éš¾åº¦](https://leetcode-cn.com/problems/minimum-difficulty-of-a-job-schedule/)\n\nä½ éœ€è¦åˆ¶å®šä¸€ä»½ d å¤©çš„å·¥ä½œè®¡åˆ’è¡¨ã€‚å·¥ä½œä¹‹é—´å­˜åœ¨ä¾èµ–ï¼Œè¦æƒ³æ‰§è¡Œç¬¬ i é¡¹å·¥ä½œï¼Œä½ å¿…é¡»å®Œæˆå…¨éƒ¨ j é¡¹å·¥ä½œï¼ˆ `0 <= j < i`ï¼‰ã€‚\n\nä½ æ¯å¤© **è‡³å°‘** éœ€è¦å®Œæˆä¸€é¡¹ä»»åŠ¡ã€‚å·¥ä½œè®¡åˆ’çš„æ€»éš¾åº¦æ˜¯è¿™ `d` å¤©æ¯ä¸€å¤©çš„éš¾åº¦ä¹‹å’Œï¼Œè€Œä¸€å¤©çš„å·¥ä½œéš¾åº¦æ˜¯å½“å¤©åº”è¯¥å®Œæˆå·¥ä½œçš„æœ€å¤§éš¾åº¦ã€‚\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `jobDifficulty` å’Œä¸€ä¸ªæ•´æ•° dï¼Œåˆ†åˆ«ä»£è¡¨å·¥ä½œéš¾åº¦å’Œéœ€è¦è®¡åˆ’çš„å¤©æ•°ã€‚ç¬¬ i é¡¹å·¥ä½œçš„éš¾åº¦æ˜¯ `jobDifficulty[i]`ã€‚\n\nè¿”å›æ•´ä¸ªå·¥ä½œè®¡åˆ’çš„ **æœ€å°éš¾åº¦** ã€‚å¦‚æœæ— æ³•åˆ¶å®šå·¥ä½œè®¡åˆ’ï¼Œåˆ™è¿”å› -1 ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/01/27/ipKvNZQASOhVmdI.png)\n\n```java\nè¾“å…¥ï¼šjobDifficulty = [6,5,4,3,2,1], d = 2\nè¾“å‡ºï¼š7\nè§£é‡Šï¼šç¬¬ä¸€å¤©ï¼Œæ‚¨å¯ä»¥å®Œæˆå‰ 5 é¡¹å·¥ä½œï¼Œæ€»éš¾åº¦ = 6.\nç¬¬äºŒå¤©ï¼Œæ‚¨å¯ä»¥å®Œæˆæœ€åä¸€é¡¹å·¥ä½œï¼Œæ€»éš¾åº¦ = 1.\nè®¡åˆ’è¡¨çš„éš¾åº¦ = 6 + 1 = 7 \n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šjobDifficulty = [9,9,9], d = 4\nè¾“å‡ºï¼š-1\nè§£é‡Šï¼šå°±ç®—ä½ æ¯å¤©å®Œæˆä¸€é¡¹å·¥ä½œï¼Œä»ç„¶æœ‰ä¸€å¤©æ˜¯ç©ºé—²çš„ï¼Œä½ æ— æ³•åˆ¶å®šä¸€ä»½èƒ½å¤Ÿæ»¡è¶³æ—¢å®šå·¥ä½œæ—¶é—´çš„è®¡åˆ’è¡¨ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šjobDifficulty = [1,1,1], d = 3\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šå·¥ä½œè®¡åˆ’ä¸ºæ¯å¤©ä¸€é¡¹å·¥ä½œï¼Œæ€»éš¾åº¦ä¸º 3 ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šjobDifficulty = [7,1,7,1,7,1], d = 3\nè¾“å‡ºï¼š15\n```\n\n**è§£æ³•ä¸€**\n\n173å‘¨èµ›çš„æœ€åä¸€é“dpé¢˜ï¼Œäº‹åä¸€ä¸ªå°æ—¶å·¦å³ç‹¬ç«‹çš„acï¼Œè¿˜æ˜¯æŒºèˆ’æœçš„ï¼Œå¸Œæœ›ä»¥åèƒ½æ›´å¿«ac\n\n```java\npublic int minDifficulty(int[] jobDifficulty, int d) {\n    int jlen=jobDifficulty.length;\n    if(jlen<d){\n        return -1;\n    }\n    //dp[i][j]   ç¬¬iå¤©å®Œæˆå‰jé¡¹ä»»åŠ¡çš„æœ€ä½éš¾åº¦\n    int[][] dp=new int[d][jlen];\n    for(int i=0;i<dp.length;i++){\n        Arrays.fill(dp[i],Integer.MAX_VALUE);\n    }\n    int max=0;\n    for(int j=0;j<jlen;j++){\n        max=Math.max(max,jobDifficulty[j]);\n        dp[0][j]=max;\n    }\n    for(int i=1;i<d;i++){\n        for(int j=0;j<jlen;j++){\n            for(int k=j-1;k>=i-1;k--){\n                dp[i][j]=Math.min(dp[i][j], dp[i-1][k]+maxDifficulty(jobDifficulty,k+1,j));\n            }\n        }\n    }\n    return dp[d-1][jlen-1];\n}\n\npublic int maxDifficulty(int[] jobDifficulty,int left,int right){\n    int max=jobDifficulty[left];\n    for(int i=left;i<=right;i++){\n        max=Math.max(max,jobDifficulty[i]);\n    }\n    return max;\n}\n```\n\næ ¸å¿ƒçš„é€’æ¨å…¬å¼ï¼š `dp[i][j]=min(dp[i][j],dp[i-1][0~k]+max(k+1,j))` \n\nå…¶å®ä¹Ÿä¸æ˜¯ä¸€å¼€å§‹å°±æƒ³åˆ°äº†è¿™ä¸ªé€’æ¨å…¬å¼ï¼Œé¦–å…ˆéœ€è¦ç¡®å®šçš„æ˜¯ç”¨å‡ ç»´æ•°ç»„å’Œé€’æ¨æ•°ç»„çš„å«ä¹‰ï¼Œè¿™ä¸ªé¢˜ç›®ä¸¤ä¸ªå˜é‡ï¼šå¤©æ•°å’Œå·¥ä½œé‡ï¼›æ‰€ä»¥åº”è¯¥æ˜¯äºŒç»´çš„ç»“æ„ï¼Œ`dp[i][j]` ç„¶åå¯¹åº”é¢˜ç›®æ‰€è¦æ±‚çš„ä¸œè¥¿ï¼Œå…¶å®å°±å¯ä»¥ç¡®å®šdpæ•°ç»„çš„å«ä¹‰\n\n`dp[i][j]` çš„å«ä¹‰æ˜¯å‰`i`å¤©å®Œæˆå‰`j`é¡¹å·¥ä½œçš„æœ€ä½éš¾åº¦ï¼Œæœ€åè¿”å›çš„ç»“æœå°±æ˜¯`dp[d-1][jlen-1]`\n\nä½†æ˜¯ä¸Šé¢è¿™ä¸ªè§£æ³•æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œ`O(dN^3)`ï¼Œå…¶å®å¯ä»¥åšä¸€ä¸‹é¢„å¤„ç†é™ä½æ—¶é—´å¤æ‚åº¦\n\n**è§£æ³•äºŒ**\n\né¢„å¤„ç†çš„åœ°æ–¹ä¹Ÿå†™æˆäº†åŠ¨æ€è§„åˆ’hahaha~ å…¶å®å°±æ˜¯æ±‚ä¸€ä¸ª**åŒºé—´å’Œ**\n\n```java\npublic int minDifficulty(int[] jobDifficulty, int d) {\n    int jlen=jobDifficulty.length;\n    if(jlen<d){\n        return -1;\n    }\n    //dp[i][j]   å‰iå¤©å®Œæˆå‰jé¡¹ä»»åŠ¡çš„æœ€ä½éš¾åº¦\n    int[][] dp=new int[d][jlen];\n    for(int i=0;i<dp.length;i++){\n        Arrays.fill(dp[i],Integer.MAX_VALUE);\n    }\n    //é¢„å¤„ç†\n    int[][] maxRange=new int[jlen][jlen];\n    for(int i=0;i<jlen;i++){\n        maxRange[i][i]=jobDifficulty[i];\n        for (int j=i+1;j<jlen;j++) {\n            //è¿™é‡Œä¹Ÿæ˜¯ä¸ªåŠ¨æ€è§„åˆ’hahaha~\n            maxRange[i][j]=Math.max(maxRange[i][j-1],jobDifficulty[j]);\n        }\n    }\n    for(int j=0;j<jlen;j++){\n        dp[0][j]=maxRange[0][j];\n    }\n    for(int i=1;i<d;i++){\n        for(int j=0;j<jlen;j++){\n            for(int k=j-1;k>=i-1;k--){ //æ³¨æ„è¿™é‡Œk>=i-1çš„å«ä¹‰\n                dp[i][j]=Math.min(dp[i][j], dp[i-1][k]+maxRange[k+1][j]);\n            }\n        }\n    }\n    return dp[d-1][jlen-1];\n}\n```\n\nè¿™æ ·æ—¶é—´å¤æ‚åº¦å°±é™ä½ä¸º`O(dN^2)` ï¼Œå½“ç„¶è¿˜æ˜¯æœ‰ä¸€ç‚¹ä¸å®Œç¾ï¼Œå°±æ˜¯å¯¹è¾¹ç•Œçš„å¤„ç†å¯ä»¥é€šè¿‡å¯¹dpæ•°ç»„+1æ¥è§„é¿ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œè¿™æˆ‘å°è¯•æ”¹äº†ä¸‹ï¼Œæ²¡æ”¹å¥½ï¼Œä¸æ”¹äº†ï¼Œå“ˆå“ˆå“ˆ~\n\n## [5331. è·³è·ƒæ¸¸æˆ V](https://leetcode-cn.com/problems/jump-game-v/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ arr å’Œä¸€ä¸ªæ•´æ•° d ã€‚æ¯ä¸€æ­¥ä½ å¯ä»¥ä»ä¸‹æ ‡ i è·³åˆ°ï¼š\n\n- `i + x` ï¼Œå…¶ä¸­ `i + x < arr.length ä¸” 0 < x <= d` ã€‚\n- `i - x` ï¼Œå…¶ä¸­ `i - x >= 0 ä¸” 0 < x <= d` ã€‚\n\né™¤æ­¤ä»¥å¤–ï¼Œä½ ä»ä¸‹æ ‡ i è·³åˆ°ä¸‹æ ‡ j éœ€è¦æ»¡è¶³ï¼š`arr[i] > arr[j] ä¸” arr[i] > arr[k]` ï¼Œå…¶ä¸­ä¸‹æ ‡ k æ˜¯æ‰€æœ‰ i åˆ° j ä¹‹é—´çš„æ•°å­—ï¼ˆæ›´æ­£å¼çš„ï¼Œmin(i, j) < k < max(i, j)ï¼‰ã€‚\n\nä½ å¯ä»¥é€‰æ‹©æ•°ç»„çš„ä»»æ„ä¸‹æ ‡å¼€å§‹è·³è·ƒã€‚è¯·ä½ è¿”å›ä½  **æœ€å¤š** å¯ä»¥è®¿é—®å¤šå°‘ä¸ªä¸‹æ ‡ã€‚\n\nè¯·æ³¨æ„ï¼Œä»»ä½•æ—¶åˆ»ä½ éƒ½ä¸èƒ½è·³åˆ°æ•°ç»„çš„å¤–é¢\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![image.png](https://i.loli.net/2020/02/02/lroNpJhPkVc46Ya.png)\n\n```java\nè¾“å…¥ï¼šarr = [6,4,14,6,8,13,9,7,10,6,12], d = 2\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šä½ å¯ä»¥ä»ä¸‹æ ‡ 10 å‡ºå‘ï¼Œç„¶åå¦‚ä¸Šå›¾ä¾æ¬¡ç»è¿‡ 10 --> 8 --> 6 --> 7 ã€‚\næ³¨æ„ï¼Œå¦‚æœä½ ä»ä¸‹æ ‡ 6 å¼€å§‹ï¼Œä½ åªèƒ½è·³åˆ°ä¸‹æ ‡ 7 å¤„ã€‚ä½ ä¸èƒ½è·³åˆ°ä¸‹æ ‡ 5 å¤„å› ä¸º 13 > 9 ã€‚ä½ ä¹Ÿä¸èƒ½è·³åˆ°ä¸‹æ ‡ 4 å¤„ï¼Œå› ä¸ºä¸‹æ ‡ 5 åœ¨ä¸‹æ ‡ 4 å’Œ 6 ä¹‹é—´ä¸” 13 > 9 ã€‚\nç±»ä¼¼çš„ï¼Œä½ ä¸èƒ½ä»ä¸‹æ ‡ 3 å¤„è·³åˆ°ä¸‹æ ‡ 2 æˆ–è€…ä¸‹æ ‡ 1 å¤„ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [3,3,3,3,3], d = 3\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šä½ å¯ä»¥ä»ä»»æ„ä¸‹æ ‡å¤„å¼€å§‹ä¸”ä½ æ°¸è¿œæ— æ³•è·³åˆ°ä»»ä½•å…¶ä»–åæ ‡ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [7,6,5,4,3,2,1], d = 1\nè¾“å‡ºï¼š7\nè§£é‡Šï¼šä»ä¸‹æ ‡ 0 å¤„å¼€å§‹ï¼Œä½ å¯ä»¥æŒ‰ç…§æ•°å€¼ä»å¤§åˆ°å°ï¼Œè®¿é—®æ‰€æœ‰çš„ä¸‹æ ‡ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= arr.length <= 1000`\n- `1 <= arr[i] <= 10^5`\n- `1 <= d <= arr.length`\n\n**è§£æ³•ä¸€**\n\né¢„å¤„ç†+å›æº¯+è®°å¿†åŒ–\n\n```java\nprivate Integer[] cache=null;\n\npublic int maxJumps(int[] arr, int d) {\n    int[][] max=new int[arr.length][arr.length];\n    cache=new Integer[arr.length];\n    for (int i=0;i<arr.length;i++) {\n        max[i][i]=arr[i];\n        for (int j=i+1;j<arr.length;j++) {\n            max[i][j]=Math.max(max[i][j-1],arr[j]);\n        }\n    }\n    int res=0;\n    for (int i=0;i<arr.length;i++) {\n        res=Math.max(jump(arr,d,i,max),res);\n    }\n    return res+1;\n}\n\npublic int jump(int[] arr,int d,int index,int[][] max){ //ä»indexèµ·è·³èƒ½è·³å¤šè¿œ\n    if (cache[index]!=null) {\n        return cache[index];\n    }\n    int res=0;\n    for (int i=Math.max(index-d,0);i<index;i++) {\n        if (arr[index]>arr[i] && arr[index]>max[i+1][index-1]) {\n            res=Math.max(jump(arr,d,i,max)+1,res);\n        }\n    }\n    //index=0, i=1 , i<=1\n    for (int i=index+1;i<=Math.min(index+d,arr.length-1);i++) {\n        if (arr[index]>arr[i] && arr[index]>max[index+1][i-1]) {\n            res=Math.max(jump(arr,d,i,max)+1,res);\n        }\n    }\n    return cache[index]=res;\n}\n```\n\nå…¶å®å·²ç»åœ¨è¶…æ—¶çš„è¾¹ç¼˜äº†ã€‚ã€‚ã€‚æ²¡æœ‰å¿…è¦åšé¢„å¤„ç†ï¼Œä¸€å¼€å§‹è¢«é¢˜æ‹¬å·é‡Œé¢çš„ä¿¡æ¯ç»™è¿·æƒ‘äº†ï¼Œä¸ç„¶ä¹Ÿä¸ä¼šæä¸ªé¢„å¤„ç†ï¼Œå…¶å®é¢˜ç›®çš„æ„æ€å°±æ˜¯åªèƒ½å‘ä½å¤„è·³ï¼Œæˆ‘å¼€å§‹è¿˜æäº†ä¸¤ä¸ªåŒºé—´å€¼hahaï¼Œè„‘å£³æœ‰ç‚¹ä¸äº²ç™½\n\n**è§£æ³•äºŒ**\n\næ”¹è‰¯åçš„å›æº¯+è®°å¿†åŒ–\n\n```java\nprivate Integer[] cache=null;\n\npublic int maxJumps(int[] arr, int d) {\n    cache=new Integer[arr.length];\n    int res=0;\n    for (int i=0;i<arr.length;i++) {\n        res=Math.max(jump(arr,d,i),res);\n    }\n    return res+1;\n}\n\npublic int jump(int[] arr,int d,int index){ \n    if (cache[index]!=null) {\n        return cache[index];\n    }\n    int res=0;\n    //æŒ¨ä¸ªè·³,æœ‰ä¸€ä¸ªè·³ä¸åˆ°,åé¢æ‰€æœ‰çš„å°±éƒ½è·³ä¸åˆ°äº†\n    for (int i=index-1;i>=Math.max(index-d,0) && arr[index]>arr[i];i--) {\n        res=Math.max(jump(arr,d,i)+1,res);\n    }\n    for (int i=index+1;i<=Math.min(index+d,arr.length-1) && arr[index]>arr[i];i++) {\n        res=Math.max(jump(arr,d,i)+1,res);\n    }\n    return cache[index]=res;\n}\n```\n\n**è§£æ³•ä¸‰**\n\nè‡ªåº•å‘ä¸ŠåŠ¨æ€è§„åˆ’\n\n```java\npublic int maxJumps(int[] arr, int d) {\n    int res=0,len=arr.length;\n    Pair[] pair=new Pair[len];\n    int[] dp=new int[len];\n    Arrays.fill(dp,1);\n    for (int i=0;i<len;i++) pair[i]=new Pair(i,arr[i]);\n    Arrays.sort(pair,(p1,p2)->p1.value-p2.value);\n    for (int i=0;i<len;i++) {\n        int index=pair[i].index;\n        //å‘å·¦\n        for (int j=index-1;j>=Math.max(index-d,0) && arr[index]>arr[j];j--) {\n            dp[index]=Math.max(dp[j]+1,dp[index]);\n        }\n        //å‘å³\n        for (int j=index+1;j<=Math.min(index+d,arr.length-1) && arr[index]>arr[j];j++) {\n            dp[index]=Math.max(dp[j]+1,dp[index]);\n        }\n        res=Math.max(dp[index],res);\n    }\n    return res;\n}\n\nclass Pair{\n    int index;\n    int value;\n    public Pair(int index,int value){\n        this.index=index;\n        this.value=value;\n    }\n}\n```\n\nè¿™é‡Œå…¶å®åŠ¨æ€è§„åˆ’è¿˜æœ‰éº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºéœ€è¦ä»é«˜å‘ä½è·³ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆä¿è¯ä½å¤„çš„dpå€¼å…ˆè®¡ç®—å®Œæˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆæ’åºï¼ŒåŒæ—¶è¦ä¿ç•™åŸç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ª`Pair`æ•°ç»„æ¥è¾…åŠ©ï¼Œè·³çš„æ–¹å¼å’Œä¸Šé¢å›æº¯çš„ä¸€æ ·\n\n## [1262. å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ](https://leetcode-cn.com/problems/greatest-sum-divisible-by-three/)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›èƒ½è¢«ä¸‰æ•´é™¤çš„å…ƒç´ æœ€å¤§å’Œã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [3,6,5,1,8]\nè¾“å‡ºï¼š18\nè§£é‡Šï¼šé€‰å‡ºæ•°å­— 3, 6, 1 å’Œ 8ï¼Œå®ƒä»¬çš„å’Œæ˜¯ 18ï¼ˆå¯è¢« 3 æ•´é™¤çš„æœ€å¤§å’Œï¼‰ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [4]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼š4 ä¸èƒ½è¢« 3 æ•´é™¤ï¼Œæ‰€ä»¥æ— æ³•é€‰å‡ºæ•°å­—ï¼Œè¿”å› 0ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [1,2,3,4,4]\nè¾“å‡ºï¼š12\nè§£é‡Šï¼šé€‰å‡ºæ•°å­— 1, 3, 4 ä»¥åŠ 4ï¼Œå®ƒä»¬çš„å’Œæ˜¯ 12ï¼ˆå¯è¢« 3 æ•´é™¤çš„æœ€å¤§å’Œï¼‰ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= nums.length <= 4 * 10^4`\n- `1 <= nums[i] <= 10^4`\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’çš„è§£æ³•ï¼Œå¾ˆä¹…ä¹‹å‰çš„ä¸€æ¬¡å‘¨èµ›çš„é¢˜ï¼Œå¥½åƒæ˜¯ç¬¬ä¸€æ¬¡åŒå‘¨èµ›çš„é¢˜ï¼Ÿ\n\n```java\npublic int maxSumDivThree(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    //dp[i][k] 0~i ä¹‹é—´/3ä½™kçš„æœ€å¤§å…ƒç´ å’Œ\n    int[][] dp=new int[nums.length+1][3]; \n    dp[0][0]=0; //åˆå§‹çŠ¶æ€å®šä¹‰\n    dp[0][1]=Integer.MIN_VALUE;\n    dp[0][2]=Integer.MIN_VALUE;\n    for (int i=1;i<=nums.length;i++) {\n        if (nums[i-1]%3==0) {\n            dp[i][0]=Math.max(dp[i-1][0],dp[i-1][0]+nums[i-1]);\n            dp[i][1]=Math.max(dp[i-1][1],dp[i-1][1]+nums[i-1]);\n            dp[i][2]=Math.max(dp[i-1][2],dp[i-1][2]+nums[i-1]);\n        }\n        if (nums[i-1]%3==1) {\n            dp[i][0]=Math.max(dp[i-1][0],dp[i-1][2]+nums[i-1]);\n            dp[i][1]=Math.max(dp[i-1][1],dp[i-1][0]+nums[i-1]);\n            dp[i][2]=Math.max(dp[i-1][2],dp[i-1][1]+nums[i-1]);   \n        }\n        if (nums[i-1]%3==2) {\n            dp[i][0]=Math.max(dp[i-1][0],dp[i-1][1]+nums[i-1]);\n            dp[i][1]=Math.max(dp[i-1][1],dp[i-1][2]+nums[i-1]);\n            dp[i][2]=Math.max(dp[i-1][2],dp[i-1][0]+nums[i-1]);   \n        }\n    }\n    return  Math.max(0,dp[nums.length][0]);\n}\n```\n\nçœ‹ä¸€ä¸‹æ•°æ®çš„èŒƒå›´`40000`ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦è‚¯å®šæ˜¯`O(N)` æˆ–`O(NlogN)`çš„ï¼Œ`O(N^2)`çš„è‚¯å®šè¶…æ—¶å•¦\n\næƒ³äº†å¾ˆä¹…æ²¡æƒ³å‡ºæ¥ï¼Œç„¶åç„äº†ä¸€çœ¼è¯„è®ºåŒºï¼Œå‘ç°dpæ•°ç»„å®šä¹‰çš„æ˜¯å’Œä½™æ•°ç›¸å…³çš„ï¼Œç„¶åå°±ååº”è¿‡æ¥äº†ï¼Œä½™0ä½™1ä½™2ï¼Œ ä»–ä»¬çš„ç»„åˆå°±å¯ä»¥å¾—åˆ°æ–°çš„æœ€å¤§ä½™æ•°å’Œï¼Œæˆ‘ä»¬æœ€åè¦æ±‚çš„å°±æ˜¯æœ€å`[0,nums.length]` ä½™æ•°ä¸º0çš„æœ€å¤§å’Œ\n\né€’æ¨å…¬å¼å°±ä¸ç”¨å¤šè¯´äº†ï¼Œçœ‹ä»£ç å°±è¡Œäº†ï¼Œé€’æ¨å…¬å¼å¾ˆå®¹æ˜“å¾—åˆ°ï¼Œå…³é”®å°±æ˜¯åˆå§‹çš„çŠ¶æ€å®šä¹‰ï¼Œç¬¬ä¸€æ­¥çš„é€’æ¨ï¼Œæˆ‘ä¸€å¼€å§‹æ²¡æœ‰è®¾ç½®è¾¹ç•Œï¼Œç›´æ¥å¼€å§‹dpç„¶ååé¢æ€ä¹ˆæ”¹éƒ½ä¸å¯¹ï¼Œä¸€å¼€å§‹å®šä¹‰çš„base dp\n\n```java\ndp[0][0]=nums[0]%3==0?nums[0]:Integer.MIN_VALUE;\ndp[0][1]=nums[0]%3==1?nums[0]:Integer.MIN_VALUE;\ndp[0][2]=nums[0]%3==2?nums[0]:Integer.MIN_VALUE;\n```\n\nç„¶åè¿‡äº†å‡ ååå¡åœ¨äº†ä¸ªcaseä¸Š\n\n```java\n[2,19,6,16,5,10,7,4,11,6]\n```\n\né€’æ¨åˆ°ç¬¬äºŒä¸ªå…¶å®å°±æœ‰é—®é¢˜äº†\n\n```java\n      0     1      2 \n2    MIN   MIN     2 \n19   21    MIN+19  2\n```\n\nè¿™é‡Œçš„19çš„1æ˜æ˜¾åº”è¯¥å°±æ˜¯19ï¼Œè¿™é‡Œç›´æ¥æ ¹æ®`dp[i-1][1]+19`é€’æ¨å¾—åˆ°çš„ï¼Œåé¢çš„è‚¯å®šéƒ½ä¸å¯¹äº†ï¼Œé‚£æˆ‘ä»¬è¿™é‡Œå°†åˆå§‹å€¼è®¾ç½®ä¸º0å¯ä»¥ä¹ˆï¼Ÿ\n\n```java\ndp[0][0]=nums[0]%3==0?nums[0]:0;\n```\n\nå¯¹è¿™ä¸ªcaseç¡®å®å¯ä»¥ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–çš„å°±ä¸å¯¹äº†ï¼Œè¿™å®¹æ˜“æƒ³åˆ°ï¼Œä½ è®¾ç½®ä¸º0ä¸‹ä¸€å±‚çš„dpå€¼å°±å¯ä»¥ä»è¿™ä¸ªå€¼é€’æ¨è¿‡æ¥ï¼Œä½†æ˜¯è¿™æ˜æ˜¾æ˜¯ä¸å¯¹çš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼š `3ï¼Œ4` ä½ å°†ç¬¬ä¸€ä¸ª3çš„ä½™2æœ€å¤§å€¼è®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ª4å°±å¯ä»¥é€šè¿‡ä¸Šä¸€ä¸ªä½™2çš„æœ€å¤§å€¼æ¥æ›´æ–°å½“å‰çš„ä½™0æœ€å¤§å€¼ï¼Œå˜æˆ4ï¼Œè¿™å¾ˆæ˜æ˜¾å°±ä¸å¯¹äº†ï¼Œ4æ ¹æœ¬å°±ä¸èƒ½è¢«3æ•´é™¤\n\næ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æœ€å¥½çš„å¤„ç†æ–¹å¼æ˜¯æ·»åŠ ä¸€ä¸ªè¾¹ç•Œï¼Œç›¸å½“äºåœ¨æ•°ç»„çš„æœ€å‰é¢æ·»åŠ ä¸€ä¸ª0ï¼Œ0%3=0\n\nç„¶åæˆ‘ä»¬åªéœ€è¦å°†`dp[0][0]`è®¾ç½®ä¸º0å°±å¯ä»¥äº†ï¼Œè€Œ1å’Œ2å°±è®¾ç½®ä¸º`INT_MIN`ï¼Œè®©ä¸‹ä¸€å±‚ä¸èƒ½é€šå®ƒæ¥è½¬ç§»\n\n> dpè¾¹ç•Œçš„å¤„ç†æ–¹å¼è¿˜æ˜¯è¦å¤šç»ƒå•Š\n\n**è§£æ³•äºŒ**\n\nä¼˜åŒ–ç©ºé—´ä¸ºO(1)\n\n```java\npublic int maxSumDivThree2(int[] nums) {\n    int[] dp=new int[3];\n    dp[1]=Integer.MIN_VALUE;\n    dp[2]=Integer.MIN_VALUE;\n    for (int i=1;i<=nums.length;i++) {\n        if (nums[i-1]%3==0) {\n            dp[0]=Math.max(dp[0],dp[0]+nums[i-1]);\n            dp[1]=Math.max(dp[1],dp[1]+nums[i-1]);\n            dp[2]=Math.max(dp[2],dp[2]+nums[i-1]);\n        }\n        if (nums[i-1]%3==1) {\n            int temp0=dp[0];\n            dp[0]=Math.max(dp[0],dp[2]+nums[i-1]);\n            dp[2]=Math.max(dp[2],dp[1]+nums[i-1]); //æŒ‰ä¾èµ–å…³ç³»è°ƒæ•´é¡ºåº,å‡å°‘å˜é‡\n            dp[1]=Math.max(dp[1],temp0+nums[i-1]);\n        }\n        if (nums[i-1]%3==2) {\n            int temp0=dp[0];\n            dp[0]=Math.max(dp[0],dp[1]+nums[i-1]);\n            dp[1]=Math.max(dp[1],dp[2]+nums[i-1]);\n            dp[2]=Math.max(dp[2],temp0+nums[i-1]);\n        }\n    }\n    return dp[0];\n}\n```\n\nå¯ä»¥çœ‹å‡ºä»£ç è¿˜æ˜¯å¯ä»¥ç®€åŒ–çš„å¾ˆçŸ­çš„ï¼Œä¸ºäº†è¡¨è¾¾çš„æ¸…æ™°å°±ä¸æ”¹äº†\n\n**è§£æ³•ä¸‰**\n\nè´ªå¿ƒï¼Œæ”¾åœ¨ [è´ªå¿ƒä¸“é¢˜](http://imlgw.top/2020/01/21/leetcode-tan-xin/#406-%E6%A0%B9%E6%8D%AE%E8%BA%AB%E9%AB%98%E9%87%8D%E5%BB%BA%E9%98%9F%E5%88%97) ä¸­\n\n## [é¢è¯•é¢˜60. nä¸ªéª°å­çš„ç‚¹æ•°](https://leetcode-cn.com/problems/nge-tou-zi-de-dian-shu-lcof/)\n\næŠŠnä¸ªéª°å­æ‰”åœ¨åœ°ä¸Šï¼Œæ‰€æœ‰éª°å­æœä¸Šä¸€é¢çš„ç‚¹æ•°ä¹‹å’Œä¸ºsã€‚è¾“å…¥nï¼Œæ‰“å°å‡ºsçš„æ‰€æœ‰å¯èƒ½çš„å€¼å‡ºç°çš„æ¦‚ç‡ã€‚\n\nä½ éœ€è¦ç”¨ä¸€ä¸ªæµ®ç‚¹æ•°æ•°ç»„è¿”å›ç­”æ¡ˆï¼Œå…¶ä¸­ç¬¬ i ä¸ªå…ƒç´ ä»£è¡¨è¿™ n ä¸ªéª°å­æ‰€èƒ½æ·å‡ºçš„ç‚¹æ•°é›†åˆä¸­ç¬¬ i å°çš„é‚£ä¸ªçš„æ¦‚ç‡ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 1\nè¾“å‡º: [0.16667,0.16667,0.16667,0.16667,0.16667,0.16667]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 2\nè¾“å‡º: [0.02778,0.05556,0.08333,0.11111,0.13889,0.16667,0.13889,0.11111,0.08333,0.05556,0.02778]\n```\n\n**é™åˆ¶ï¼š**\n\n`1 <= n <= 11`\n\n**è§£æ³•ä¸€**\n\nå¾ˆæœ‰æ„æ€çš„é¢˜ï¼Œçœ‹è¿”å›å€¼è¿˜ä¸å®¹æ˜“æƒ³åˆ°ç”¨åŠ¨æ€è§„åˆ’\n\n```java\npublic double[] twoSum(int n) {\n    //dp[i][j]ä»£è¡¨iæšè‰²å­å’Œä¸ºjçš„æ¦‚ç‡\n    double[][] dp=new double[n+1][6*n+1];\n    double probability=1.0/6.0;\n    //baseåˆå§‹åŒ–\n    for(int i=1;i<=6;i++) dp[1][i]=probability;\n    for(int i=2;i<=n;i++){ //æšä¸¾è‰²å­\n        for(int j=i;j<=i*6;j++){ //æšä¸¾ç‚¹æ•°\n            for(int k=1;k<=j && k<=6;k++){ //æšä¸¾å½“å‰è‰²å­çš„ç‚¹æ•°\n                dp[i][j]+=(probability*dp[i-1][j-k]);\n            }\n        }\n    }\n    double[] res=new double[5*n+1];//\n    System.arraycopy(dp[n],n,res,0,res.length);\n    return res;\n}\n```\n\n`dp[i][j]`ä»£è¡¨**i**æšè‰²å­å’Œä¸º**j**çš„æ¦‚ç‡ é€’æ¨å…¬å¼å¾ˆå®¹æ˜“æƒ³åˆ° `dp[i][j]= 1/6(dp[i-1][j-1]+dp[i-1][j-2]+dp[i-1][j-3]...dp[i-1][j-6])` ç„¶åæˆ‘ä»¬æšä¸¾å„ä¸ªçŠ¶æ€å°±okäº†\n\n## [264. ä¸‘æ•° II](https://leetcode-cn.com/problems/ugly-number-ii/)\n\nç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾å‡ºç¬¬ n ä¸ªä¸‘æ•°ã€‚\n\nä¸‘æ•°å°±æ˜¯åªåŒ…å«è´¨å› æ•° 2, 3, 5 çš„æ­£æ•´æ•°ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: n = 10\nè¾“å‡º: 12\nè§£é‡Š: 1, 2, 3, 4, 5, 6, 8, 9, 10, 12 æ˜¯å‰ 10 ä¸ªä¸‘æ•°ã€‚\n```\n\n\n**è¯´æ˜:**  \n\n1. æ˜¯ä¸‘æ•°ã€‚\n2. n ä¸è¶…è¿‡1690ã€‚\n\n**è§£æ³•ä¸€**\n\nå°æ ¹å †ï¼Œå°†baseæ¯æ¬¡ä¹˜2ä¹˜3ä¹˜5çš„ç»“æœæ”¾å…¥å°æ ¹å †ï¼Œç„¶åå°†å †é¡¶æ‹¿å‡ºæ¥baseï¼Œç»§ç»­é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œä¸­é—´è¦æ³¨æ„å»é‡\n\n```java\npublic int nthUglyNumber3(int n) {\n    PriorityQueue<Long> queue=new PriorityQueue<>();\n    n-=1;\n    long base=1;\n    while(n-- >0){\n        queue.add(base*2);\n        queue.add(base*3);\n        queue.add(base*5);\n        base=queue.poll();\n        //å»é‡\n        while(!queue.isEmpty()&&base==queue.peek()){\n            queue.poll();\n        }\n    }\n    return (int)base;\n}\n```\n\nç”¨`HashSet`å»é‡\n\n```java\npublic int nthUglyNumber(int n) {\n    PriorityQueue<Long> queue=new PriorityQueue<>();\n    HashSet<Long> set=new HashSet<>();\n    long base=1;\n    long[] ugly={2,3,5};\n    n-=1;\n    set.add(1L);\n    while(n-->0){\n        for(int i=0;i<3;i++){\n            if (!set.contains(ugly[i]*base)) {\n                queue.add(ugly[i]*base);\n                set.add(ugly[i]*base);\n            }\n        }\n        base=queue.poll();\n    }\n    return (int)base;\n}\n```\n\n**è§£æ³•äºŒ**\n\nè¿™ä¸ªè§£æ³•è¿˜æ˜¯å¾ˆæœ‰æŠ€å·§æ€§çš„ï¼Œå…¶å®å°±æ˜¯æŒ‰é¡ºåºç”Ÿæˆä¸‘æ•°ï¼Œä¸€å¼€å§‹è§‚å¯Ÿçš„æ—¶å€™å°±å‘ç°äº†ä½†æ˜¯ç¡®å®æƒ³ä¸åˆ°ä¸‰æŒ‡é’ˆçš„è§£æ³•\n\n```java\npublic int nthUglyNumber4(int n) {\n    int[] dp=new int[n];\n    dp[0]=1;\n    int index1=0,index2=0,index3=0;\n    for (int i=1;i<n;i++) {\n        dp[i]=Math.min(dp[index1]*2,Math.min(dp[index2]*3,dp[index3]*5));\n        index1+=(dp[index1]*2==dp[i]?1:0);\n        index2+=(dp[index2]*3==dp[i]?1:0);\n        index3+=(dp[index3]*5==dp[i]?1:0);\n    }\n    return dp[n-1];\n}\n```\n## [é¢è¯•é¢˜62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—](https://leetcode-cn.com/problems/yuan-quan-zhong-zui-hou-sheng-xia-de-shu-zi-lcof/) \n\n0,1,,n-1è¿™nä¸ªæ•°å­—æ’æˆä¸€ä¸ªåœ†åœˆï¼Œä»æ•°å­—0å¼€å§‹ï¼Œæ¯æ¬¡ä»è¿™ä¸ªåœ†åœˆé‡Œåˆ é™¤ç¬¬mä¸ªæ•°å­—ã€‚æ±‚å‡ºè¿™ä¸ªåœ†åœˆé‡Œå‰©ä¸‹çš„æœ€åä¸€ä¸ªæ•°å­—ã€‚\n\nä¾‹å¦‚ï¼Œ0ã€1ã€2ã€3ã€4è¿™5ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªåœ†åœˆï¼Œä»æ•°å­—0å¼€å§‹æ¯æ¬¡åˆ é™¤ç¬¬3ä¸ªæ•°å­—ï¼Œåˆ™åˆ é™¤çš„å‰4ä¸ªæ•°å­—ä¾æ¬¡æ˜¯2ã€0ã€4ã€1ï¼Œå› æ­¤æœ€åå‰©ä¸‹çš„æ•°å­—æ˜¯3ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: n = 5, m = 3\nè¾“å‡º: 3\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: n = 10, m = 17\nè¾“å‡º: 2\n```\n\n**é™åˆ¶ï¼š**\n\n- 1 <= n <= 10^5\n- 1 <= m <= 10^6\n\n**è§£æ³•ä¸€**\n\nç”¨é“¾è¡¨æ¨¡æ‹Ÿçš„è§£æ³•ï¼Œåœ¨æ•°æ®å¤ªå¤§çš„æ—¶å€™ä¼šTLE\n\n```java\n/*\né“¾è¡¨æ¨¡æ‹Ÿè§£æ³•\n0 1 2 3 4 5 m=3\n3 4 5 0 1\n*/\npublic int lastRemaining(int n, int m) {\n    Deque<Integer> queue=new LinkedList<>();\n    for(int i=0;i<n;i++)\n        queue.addLast(i);\n    while(queue.size()>1){\n        for(int i=0;i<m;i++){\n            int temp=queue.removeFirst();\n            if(i!=m-1){\n                queue.addLast(temp);\n            }\n        }\n    }\n    return queue.getFirst();\n}\n```\n**è§£æ³•äºŒ**\n\næ•°å­¦å½’çº³æ³•ï¼ŒåŠ ä¸Šä¸€ç‚¹é€’æ¨dp\n\n```java\n/*\n    0 ~ n-1 æ¯æ¬¡killç¬¬kä¸ªäºº\n    k=(m-1)%n\n\n    kill kä¹‹å, åœ¨n-1ä¸ªäººä¸­é‡å»ºæ–°ç´¢å¼•\n    åŸå§‹ç´¢å¼•   æ–°çš„index\n    k+1         0\n    k+2         1\n    k+3         2\n    ...         ...\n    n-1         n-k-2\n    0           n-k-1\n    1           n-k\n    2           n-k+1\n    ...         ...\n    k-1         n-2\n\n    æ–°ç´¢å¼•(x) ---> åŸå§‹ç´¢å¼•(y)\n    y=(x+k+1)%n  eg. (n-2+k+1)%n=(n+k-1)%n=k-1\n    è®¾åœ¨n-1ä¸ªäººä¸­æœ€åå‰©ä¸‹çš„äººæ˜¯ f(n-1,m)æŒ‰ç…§ä¸Šé¢çš„å…¬å¼è½¬æ¢æˆåŸå§‹ç´¢å¼•å°±æ˜¯\n    f(n,m)=(f(n-1,m)+k+1)%n\n */\n//æ•°å­¦è§£æ³•\npublic int lastRemaining(int n, int m) {\n    int last=0;//ä¸€ä¸ªäººçš„æ—¶å€™å­˜æ´»è€…index f(1,m)=0\n    for(int i=2;i<=n;i++){ //æšä¸¾äººæ•°\n        last=(last+m)%i;\n    }\n    return last;\n}\n```\nå‚è€ƒäº†LeetCodeçš„[å¤§ä½¬é¢˜è§£](https://leetcode-cn.com/u/yuanninesuns/)ï¼Œè®²çš„æŒºå¥½çš„\n\n**é€’å½’è§£æ³•**\n\n```java\n//é€’å½’çš„æŒºå¥½ç†è§£\npublic int lastRemaining(int n, int m) {\n    if(n==0) return 0;\n    return (lastRemaining(n-1,m)+m)%n;\n}\n```\n## [1014. æœ€ä½³è§‚å…‰ç»„åˆ](https://leetcode-cn.com/problems/best-sightseeing-pair/)\n\nç»™å®šæ­£æ•´æ•°æ•°ç»„ Aï¼ŒA[i] è¡¨ç¤ºç¬¬ i ä¸ªè§‚å…‰æ™¯ç‚¹çš„è¯„åˆ†ï¼Œå¹¶ä¸”ä¸¤ä¸ªæ™¯ç‚¹ i å’Œ j ä¹‹é—´çš„è·ç¦»ä¸º j - iã€‚\n\nä¸€å¯¹æ™¯ç‚¹ï¼ˆi < jï¼‰ç»„æˆçš„è§‚å…‰ç»„åˆçš„å¾—åˆ†ä¸ºï¼ˆA[i] + A[j] + i - jï¼‰ï¼šæ™¯ç‚¹çš„è¯„åˆ†ä¹‹å’Œå‡å»å®ƒä»¬ä¸¤è€…ä¹‹é—´çš„è·ç¦»ã€‚\n\nè¿”å›ä¸€å¯¹è§‚å…‰æ™¯ç‚¹èƒ½å–å¾—çš„æœ€é«˜åˆ†ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š[8,1,5,2,6]\nè¾“å‡ºï¼š11\nè§£é‡Šï¼ši = 0, j = 2, A[i] + A[j] + i - j = 8 + 5 + 0 - 2 = 11\n```\n\n**æç¤ºï¼š**\n\n- `2 <= A.length <= 50000`\n- `1 <= A[i] <= 1000`\n\n**è§£æ³•ä¸€**\n\næš´åŠ›è§£æ³•ï¼Œ`O(N^2)`ï¼Œè¿™é¢˜æ•°æ®5wï¼Œè‚¯å®šä¼šT\n\n```java\n//A[i] + A[j] + i - j (i<j)\npublic int maxScoreSightseeingPair(int[] A) {\n    int res=-1;\n    for (int i=0;i<A.length;i++) {\n        for (int j=i+1;j<A.length;j++) {\n            res=Math.max(A[i]+A[j]+i-j,res);\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\n```java\n// A[i]+A[j] - (j-i) i<j\n// A[i]+i + (A[j]-j)\npublic int maxScoreSightseeingPair(int[] A) {\n    int res=-1;\n    int maxPre=A[0]+0;\n    for (int j=1;j<A.length;j++) {           \n        res=Math.max(maxPre+A[j]-j,res);\n        maxPre=Math.max(maxPre,A[j]+j);\n    }\n    return res;\n}\n```\næˆ‘ä»¬æŠŠå¼å­åˆå¹¶ä¸€ä¸‹ `(A[i]+i)+(A[j]-j)` ï¼Œç„¶åå‘ç°å…¶å®ä¸Šé¢çš„æš´åŠ›è§£æ³•ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦ç»“æœæœ€å¤§å®é™…ä¸Šå°±æ˜¯è¦ä¸¤éƒ¨åˆ†éƒ½æœ€å¤§ï¼Œç„¶åå†…å±‚å¾ªç¯é‡Œé¢ï¼Œ`A[j]-j` æ˜¯ä¸ªå˜é‡ï¼Œè€Œ`A[i]+i`ä¸å˜çš„ï¼Œä»£è¡¨`j`ä½ç½®ä¹‹å‰ï¼Œæ‰€æœ‰çš„`A[i]+i` ä½†æ˜¯æˆ‘ä»¬åªéœ€è¦æœ€å¤§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨ä¸€ä¸ªå˜é‡æ¥ä¿å­˜è¿™ä¸ªæœ€å¤§å€¼ï¼Œç„¶åéå†çš„è¿‡ç¨‹ä¸­ä¸æ–­çš„æ›´æ–°å®ƒå°±okäº†\n\n## [983. æœ€ä½ç¥¨ä»·](https://leetcode-cn.com/problems/minimum-cost-for-tickets/)\n\nåœ¨ä¸€ä¸ªç«è½¦æ—…è¡Œå¾ˆå—æ¬¢è¿çš„å›½åº¦ï¼Œä½ æå‰ä¸€å¹´è®¡åˆ’äº†ä¸€äº›ç«è½¦æ—…è¡Œã€‚åœ¨æ¥ä¸‹æ¥çš„ä¸€å¹´é‡Œï¼Œä½ è¦æ—…è¡Œçš„æ—¥å­å°†ä»¥ä¸€ä¸ªåä¸º `days` çš„æ•°ç»„ç»™å‡ºã€‚æ¯ä¸€é¡¹æ˜¯ä¸€ä¸ªä» `1` åˆ° `365` çš„æ•´æ•°ã€‚\n\nç«è½¦ç¥¨æœ‰ä¸‰ç§ä¸åŒçš„é”€å”®æ–¹å¼ï¼š\n\n- ä¸€å¼ ä¸ºæœŸä¸€å¤©çš„é€šè¡Œè¯å”®ä»·ä¸º `costs[0]` ç¾å…ƒï¼›\n- ä¸€å¼ ä¸ºæœŸä¸ƒå¤©çš„é€šè¡Œè¯å”®ä»·ä¸º `costs[1]` ç¾å…ƒï¼›\n- ä¸€å¼ ä¸ºæœŸä¸‰åå¤©çš„é€šè¡Œè¯å”®ä»·ä¸º `costs[2]` ç¾å…ƒã€‚\n\né€šè¡Œè¯å…è®¸æ•°å¤©æ— é™åˆ¶çš„æ—…è¡Œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç¬¬ 2 å¤©è·å¾—ä¸€å¼ ä¸ºæœŸ 7 å¤©çš„é€šè¡Œè¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿ç€æ—…è¡Œ 7 å¤©ï¼šç¬¬ 2 å¤©ã€ç¬¬ 3 å¤©ã€ç¬¬ 4 å¤©ã€ç¬¬ 5 å¤©ã€ç¬¬ 6 å¤©ã€ç¬¬ 7 å¤©å’Œç¬¬ 8 å¤©ã€‚\n\nè¿”å›ä½ æƒ³è¦å®Œæˆåœ¨ç»™å®šçš„åˆ—è¡¨ `days` ä¸­åˆ—å‡ºçš„æ¯ä¸€å¤©çš„æ—…è¡Œæ‰€éœ€è¦çš„æœ€ä½æ¶ˆè´¹ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šdays = [1,4,6,7,8,20], costs = [2,7,15]\nè¾“å‡ºï¼š11\nè§£é‡Šï¼š \nä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ç§è´­ä¹°é€šè¡Œè¯çš„æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ å®Œæˆä½ çš„æ—…è¡Œè®¡åˆ’ï¼š\nåœ¨ç¬¬ 1 å¤©ï¼Œä½ èŠ±äº† costs[0] = $2 ä¹°äº†ä¸€å¼ ä¸ºæœŸ 1 å¤©çš„é€šè¡Œè¯ï¼Œå®ƒå°†åœ¨ç¬¬ 1 å¤©ç”Ÿæ•ˆã€‚\nåœ¨ç¬¬ 3 å¤©ï¼Œä½ èŠ±äº† costs[1] = $7 ä¹°äº†ä¸€å¼ ä¸ºæœŸ 7 å¤©çš„é€šè¡Œè¯ï¼Œå®ƒå°†åœ¨ç¬¬ 3, 4, ..., 9 å¤©ç”Ÿæ•ˆã€‚\nåœ¨ç¬¬ 20 å¤©ï¼Œä½ èŠ±äº† costs[0] = $2 ä¹°äº†ä¸€å¼ ä¸ºæœŸ 1 å¤©çš„é€šè¡Œè¯ï¼Œå®ƒå°†åœ¨ç¬¬ 20 å¤©ç”Ÿæ•ˆã€‚\nä½ æ€»å…±èŠ±äº† $11ï¼Œå¹¶å®Œæˆäº†ä½ è®¡åˆ’çš„æ¯ä¸€å¤©æ—…è¡Œã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šdays = [1,2,3,4,5,6,7,8,9,10,30,31], costs = [2,7,15]\nè¾“å‡ºï¼š17\nè§£é‡Šï¼š\nä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ç§è´­ä¹°é€šè¡Œè¯çš„æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ å®Œæˆä½ çš„æ—…è¡Œè®¡åˆ’ï¼š \nåœ¨ç¬¬ 1 å¤©ï¼Œä½ èŠ±äº† costs[2] = $15 ä¹°äº†ä¸€å¼ ä¸ºæœŸ 30 å¤©çš„é€šè¡Œè¯ï¼Œå®ƒå°†åœ¨ç¬¬ 1, 2, ..., 30 å¤©ç”Ÿæ•ˆã€‚\nåœ¨ç¬¬ 31 å¤©ï¼Œä½ èŠ±äº† costs[0] = $2 ä¹°äº†ä¸€å¼ ä¸ºæœŸ 1 å¤©çš„é€šè¡Œè¯ï¼Œå®ƒå°†åœ¨ç¬¬ 31 å¤©ç”Ÿæ•ˆã€‚ \nä½ æ€»å…±èŠ±äº† $17ï¼Œå¹¶å®Œæˆäº†ä½ è®¡åˆ’çš„æ¯ä¸€å¤©æ—…è¡Œã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= days.length <= 365`\n2. `1 <= days[i] <= 365`\n3. `days` æŒ‰é¡ºåºä¸¥æ ¼é€’å¢\n4. `costs.length == 3`\n5. `1 <= costs[i] <= 1000`\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜çš„é€’æ¨å…³ç³»å…¶å®å¾ˆå®¹æ˜“å°±æƒ³åˆ°ï¼š`dp[i]=Min(dp[i-dt[k]]+costs[k],dp[i])`ï¼Œå¯æ˜¯èœé¸¡çš„æˆ‘è¿˜æ˜¯æäº†åŠå¤©æ‰AC\n\n```java\npublic int mincostTickets(int[] days, int[] costs) {\n    int n=days.length;\n    int[] dp=new int[days[n-1]+1];\n    boolean[] visit=new boolean[days[n-1]+1];\n    for (int i:days) {\n        visit[i]=true;\n    }\n    Arrays.fill(dp,0x3f3f3f3f);\n    int [] dt = {1,7,30};\n    dp[days[0]-1]=0;//åˆå§‹çŠ¶æ€\n    //æšä¸¾æ‰€æœ‰çš„day\n    for (int d=days[0];d<=days[n-1];d++) {\n        //ä¸€å¼€å§‹æ²¡æƒ³åˆ°è¿™é‡Œï¼Œdubugçš„æ—¶å€™æ‰çœ‹å‡ºæ¥ï¼Œä¸åœ¨æ—…æ¸¸è®¡åˆ’ä¸­çš„åº”è¯¥ç›´æ¥å»¶ç»­å‰é¢çš„\n        if (!visit[d]) { \n            dp[d]=dp[d-1];\n            continue;\n        }\n        //ä¸‰ç§ç¥¨\n        for (int k=0;k<3;k++) {\n            dp[d]=Math.min((d-dt[k]>=days[0]-1?dp[d-dt[k]]:0)+costs[k],dp[d]);\n        }\n    }\n    return dp[days[n-1]];\n}\n```\nä¸€å¼€å§‹å†™äº†äºŒç»´çš„ï¼Œç„¶åå‘ç°ä¸€ç»´çš„çŠ¶æ€å¹¶æ²¡æœ‰ç”¨ï¼Œæ”¹æˆä¸€ç»´ä¹‹ååˆdubugäº†åŠå¤©ï¼Œä¸»è¦å°±åœ¨é‚£ä¸ªéæ—…è¡Œè®¡åˆ’ä¸­çš„`d`æ²¡å¤„ç†å¥½ï¼Œè¿™é¢˜çš„çŠ¶æ€å®šä¹‰ä¸æ˜¯ç‰¹åˆ«æ¸…æ™°ï¼Œç„¶åææ··äº†ï¼ŒæŠŠéæ—…è¡Œè®¡åˆ’å†…çš„ä¹Ÿç®—è¿›å»äº†\n\n## [837. æ–°21ç‚¹](https://leetcode-cn.com/problems/new-21-game/)\n\nçˆ±ä¸½ä¸å‚ä¸ä¸€ä¸ªå¤§è‡´åŸºäºçº¸ç‰Œæ¸¸æˆ â€œ21ç‚¹â€ è§„åˆ™çš„æ¸¸æˆï¼Œæè¿°å¦‚ä¸‹ï¼š\n\nçˆ±ä¸½ä¸ä»¥ `0` åˆ†å¼€å§‹ï¼Œå¹¶åœ¨å¥¹çš„å¾—åˆ†å°‘äº `K` åˆ†æ—¶æŠ½å–æ•°å­—ã€‚ æŠ½å–æ—¶ï¼Œå¥¹ä» `[1, W]` çš„èŒƒå›´ä¸­éšæœºè·å¾—ä¸€ä¸ªæ•´æ•°ä½œä¸ºåˆ†æ•°è¿›è¡Œç´¯è®¡ï¼Œå…¶ä¸­ `W` æ˜¯æ•´æ•°ã€‚ æ¯æ¬¡æŠ½å–éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå…¶ç»“æœå…·æœ‰ç›¸åŒçš„æ¦‚ç‡ã€‚\n\nå½“çˆ±ä¸½ä¸è·å¾—ä¸å°‘äº `K` åˆ†æ—¶ï¼Œå¥¹å°±åœæ­¢æŠ½å–æ•°å­—ã€‚ çˆ±ä¸½ä¸çš„åˆ†æ•°ä¸è¶…è¿‡ `N` çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ\n\n**ç¤ºä¾‹1**\n\n```java\nè¾“å…¥ï¼šN = 10, K = 1, W = 10\nè¾“å‡ºï¼š1.00000\nè¯´æ˜ï¼šçˆ±ä¸½ä¸å¾—åˆ°ä¸€å¼ å¡ï¼Œç„¶ååœæ­¢ã€‚\n```\n\n**ç¤ºä¾‹** **2**\n\n```java\nè¾“å…¥ï¼šN = 6, K = 1, W = 10\nè¾“å‡ºï¼š0.60000\nè¯´æ˜ï¼šçˆ±ä¸½ä¸å¾—åˆ°ä¸€å¼ å¡ï¼Œç„¶ååœæ­¢ã€‚\nåœ¨ W = 10 çš„ 6 ç§å¯èƒ½ä¸‹ï¼Œå¥¹çš„å¾—åˆ†ä¸è¶…è¿‡ N = 6 åˆ†ã€‚\n```\n\n**ç¤ºä¾‹**3\n\n```java\nè¾“å…¥ï¼šN = 21, K = 17, W = 10\nè¾“å‡ºï¼š0.73278\n```\n\n**æç¤ºï¼š**\n\n1. `0 <= K <= N <= 10000`\n2. `1 <= W <= 10000`\n3. å¦‚æœç­”æ¡ˆä¸æ­£ç¡®ç­”æ¡ˆçš„è¯¯å·®ä¸è¶…è¿‡ `10^-5`ï¼Œåˆ™è¯¥ç­”æ¡ˆå°†è¢«è§†ä¸ºæ­£ç¡®ç­”æ¡ˆé€šè¿‡ã€‚\n4. æ­¤é—®é¢˜çš„åˆ¤æ–­é™åˆ¶æ—¶é—´å·²ç»å‡å°‘ã€‚\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®æ„æ€éƒ½å¾—ç†è§£å¥½ä¹…ï¼Œé¢è¯•åº”è¯¥ä¸ä¼šè€ƒï¼Œå‚è€ƒè¯„è®ºåŒºå¤§ä½¬é¢˜è§£å†™çš„ä¸€ä¸ªç±»ä¼¼èƒŒåŒ…çš„åšæ³•\n\n```java\npublic double new21Game(int N, int K, int W) {\n    if(K==0) return 1;\n    //éšæœºæŠ½ç‰Œå’Œä¸ºiçš„æ¦‚ç‡ï¼ŒèƒŒåŒ…é—®é¢˜\n    double[] dp=new double[N+1];\n    dp[0]=1;\n    dp[1]=1.0/W;\n    // i<=K\n    //dp[i] = 1/W(dp[i-1]+dp[i-2]+...+dp[i-W]);\n    //dp[i-1] = 1/W(dp[i-2]+dp[i-3]+...+dp[i-W-1])\n    //==> dp[i]=(1 + 1/W)*dp[i-1]-(1/W)*dp[i-W-1]\n    for(int i=2;i<=K;i++){\n        if(i-W-1>=0){\n            dp[i]=(1+1.0/W)*dp[i-1]-1.0/W*dp[i-W-1];\n        }else{\n            dp[i]=(1+1.0/W)*dp[i-1];\n        }\n    }\n    // i>K ä»i-W ~ iåŒºé—´é€‰å°äºKçš„éƒ¨åˆ†\n    //å’Œå‰‘æŒ‡offerçš„éª°å­å“ªä¸€é¢˜æœ‰ç‚¹åƒ\n    //dp[i] = 1/W(dp[K-1]+dp[K-2]+...+dp[i-W]) or dp[i]=1/W(dp[i-W]+dp[i-W+1]+..+dp[K-1])\n    //dp[i-1] = 1/W(dp[k-1]+dp[K-2]+...+dp[i-W-1]) or dp[i+1] = 1/W(dp[i-W+1]+dp[i-W+2]...+dp[K-1])\n    //==> dp[i] = dp[i-1]-1/W*dp[i-W-1] or dp[i]=1/W*dp[i-W]+dp[i+1] ä¸¤ä¸ªæ˜¯ç­‰ä»·çš„\n    for (int i=K+1;i<=N;i++) {\n        if(i-W-1>=0){\n            dp[i]=dp[i-1]-1.0/W*dp[i-W-1];  \n        }else{\n            dp[i]=dp[i-1]; //1/W\n        }\n    }\n    double res=0;\n    for (int i=K;i<=N;i++) {\n        res+=dp[i];\n    }\n    return res;\n}\n```\n\nä¸‹ä¸€æ¬¡ç¢°åˆ°å°±ä¸ä¸€å®šä¼šåšäº†ï¼Œç†è§£çš„ä¸æ˜¯å¾ˆé€å½»ï¼Œä¸è¿‡å¯¹èƒŒåŒ…å…¬å¼çš„æ¨å¯¼å€’æ˜¯ç†è§£å¤šäº†ä¸€ç‚¹\n\n## [329. çŸ©é˜µä¸­çš„æœ€é•¿é€’å¢è·¯å¾„](https://leetcode-cn.com/problems/longest-increasing-path-in-a-matrix/)\n\nDifficulty: **å›°éš¾**\n\nç»™å®šä¸€ä¸ªæ•´æ•°çŸ©é˜µï¼Œæ‰¾å‡ºæœ€é•¿é€’å¢è·¯å¾„çš„é•¿åº¦ã€‚\n\nå¯¹äºæ¯ä¸ªå•å…ƒæ ¼ï¼Œä½ å¯ä»¥å¾€ä¸Šï¼Œä¸‹ï¼Œå·¦ï¼Œå³å››ä¸ªæ–¹å‘ç§»åŠ¨ã€‚ ä½ ä¸èƒ½åœ¨å¯¹è§’çº¿æ–¹å‘ä¸Šç§»åŠ¨æˆ–ç§»åŠ¨åˆ°è¾¹ç•Œå¤–ï¼ˆå³ä¸å…è®¸ç¯ç»•ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: nums = \n[\n  [9,9,4],\n  [6,6,8],\n  [2,1,1]\n] \nè¾“å‡º: 4 \nè§£é‡Š: æœ€é•¿é€’å¢è·¯å¾„ä¸ºÂ [1, 2, 6, 9]ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥: nums = \n[\n  [3,4,5],\n  [3,2,6],\n  [2,2,1]\n] \nè¾“å‡º: 4 \nè§£é‡Š: æœ€é•¿é€’å¢è·¯å¾„æ˜¯Â [3, 4, 5, 6]ã€‚æ³¨æ„ä¸å…è®¸åœ¨å¯¹è§’çº¿æ–¹å‘ä¸Šç§»åŠ¨ã€‚\n```\n**è§£æ³•ä¸€**\n\nè®°å¿†åŒ–é€’å½’ï¼Œè¿™é¢˜å¦‚æœé€’æ¨çš„è¯éœ€è¦ä¿è¯å­é—®é¢˜éƒ½å·²ç»è¢«è®¡ç®—è¿‡ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œæ’åºé¢„å¤„ç†ï¼Œç¡®ä¿å¤§çš„å…ˆæ±‚å‡ºæ¥ï¼Œç„¶åå†è¿›è¡Œè½¬ç§»ï¼Œå‚è€ƒä¸Šé¢ [5331-è·³è·ƒæ¸¸æˆ-V](#5331-è·³è·ƒæ¸¸æˆ-V)\n```java\nint [][] dir ={{1, 0}, {0, 1}, {-1, 0}, {0, -1}};\n\nInteger [][] cache = null;\n\n//è®°å¿†åŒ–é€’å½’ï¼Œæ•°ç»„é€’æ¨çš„æ–¹å¼çŠ¶æ€è½¬ç§»æ–¹å‘ä¸æ˜ç¡®ï¼Œéœ€è¦æ’åº\npublic int longestIncreasingPath(int[][] matrix) {\n    if (matrix == null || matrix.length <=0){\n        return 0;\n    }\n    int m = matrix.length;\n    int n = matrix[0].length;\n    cache = new Integer[m][n];\n    int res = 0;\n    for(int i = 0; i < m; i++){\n        for(int j = 0; j < n; j++){\n            res = Math.max(res, dfs(matrix, i, j));\n        }\n    }\n    return res;\n}\n\npublic int dfs(int[][] matrix, int x, int y){\n    if (cache[x][y] != null){\n        return cache[x][y];\n    }\n    int res = 1;\n    for (int i = 0; i < dir.length; i++){\n        int nx = x + dir[i][0];\n        int ny = y + dir[i][1];\n        if (valid(matrix, nx, ny) && matrix[nx][ny] > matrix[x][y]){\n            res = Math.max(res, dfs(matrix, nx, ny)+1);\n        }\n    }\n    return cache[x][y] = res;\n}\n\npublic boolean valid(int[][] matrix, int x, int y){\n    return x >= 0 && x < matrix.length && y >= 0 && y < matrix[0].length; \n}\n```\n\n##  _å­—ç¬¦ä¸²ç±»å‹çš„åŠ¨æ€è§„åˆ’_\n\n## [1143. æœ€é•¿å…¬å…±å­åºåˆ—](https://leetcode-cn.com/problems/longest-common-subsequence/)\n\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² text1 å’Œ text2ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚\n\nä¸€ä¸ªå­—ç¬¦ä¸²çš„ å­åºåˆ— æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚\nä¾‹å¦‚ï¼Œ\"ace\" æ˜¯ \"abcde\" çš„å­åºåˆ—ï¼Œä½† \"aec\" ä¸æ˜¯ \"abcde\" çš„å­åºåˆ—ã€‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ã€Œå…¬å…±å­åºåˆ—ã€æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚ è‹¥è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œåˆ™è¿”å› 0 \n\n> æœ€é•¿å…¬å…±å­åºåˆ—é—®é¢˜æ˜¯åœ¨ä¸€ç»„åºåˆ—ï¼ˆé€šå¸¸2ä¸ªï¼‰ä¸­æ‰¾åˆ°æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆæ³¨æ„ï¼šä¸åŒäºå­ä¸²ï¼ŒLCSä¸éœ€è¦æ˜¯è¿ç»­çš„å­ä¸²ï¼‰ã€‚è¯¥é—®é¢˜æ˜¯å…¸å‹çš„è®¡ç®—æœºç§‘å­¦é—®é¢˜ï¼Œæ˜¯æ–‡ä»¶å·®å¼‚æ¯”è¾ƒç¨‹åºçš„åŸºç¡€ï¼Œåœ¨ç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ä¹Ÿæœ‰æ‰€åº”ç”¨\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥ï¼štext1 = \"abcde\", text2 = \"ace\" \nè¾“å‡ºï¼š3  \nè§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ \"ace\"ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥ï¼štext1 = \"abc\", text2 = \"abc\"\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ \"abc\"ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥ï¼štext1 = \"abc\", text2 = \"def\"\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œè¿”å› 0ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n2019.10.19åŠ›æ‰£ç»ˆäºæœ‰è¿™é¢˜äº†ï¼Œé‡æ–°æ¥åšä¸€éï¼Œè¿™é¢˜ä¹Ÿå°±æ˜¯ç»å¸¸è¯´çš„LCSï¼Œdpçš„ç»å…¸é—®é¢˜\n\n```java\npublic int longestCommonSubsequence(String A, String B) {\n    int[][] dp=new int[A.length()+1][B.length()+1];\n    for (int i=1;i<=A.length();i++) {\n        for (int j=1;j<=B.length();j++) {\n            if (A.charAt(i-1)==B.charAt(j-1)) {\n                dp[i][j]=dp[i-1][j-1]+1;\n            }else{\n                dp[i][j]=Math.max(dp[i-1][j],dp[i][j-1]);\n            }\n        }\n    }\n    return dp[A.length()][B.length()];\n}\n```\nå…¶å®çœ‹è§è¿™ç§ä»€ä¹ˆæœ€é•¿çš„å¤šåŠå’Œdpæœ‰å…³ç³»ï¼Œè¿™é¢˜åªè¦æ˜ç™½å‡ ä¸ªè¦ç‚¹å°±å¯ä»¥æ¨å‡ºdpæ–¹ç¨‹\n\n- `dp[i][j]` ä»£è¡¨Aåºåˆ—å‰`i`ä¸ªå­—ç¬¦ï¼ˆè®°ä¸º`Ai`ï¼‰ï¼Œ å’ŒBåºåˆ—å‰`j`ä¸ªå­—ç¬¦ï¼ˆè®°ä¸º`Bj`ï¼‰ çš„LCS\n\n- ä¸¤å±‚forå¾ªç¯éå†ä¸¤ä¸ªåºåˆ—ï¼Œå½“`A[i]==B[j]`çš„æ—¶å€™ï¼ŒLCSé•¿åº¦å°±ä¼šå¢åŠ  1ï¼Œè¿›è€Œå¾—åˆ°dpæ–¹ç¨‹\n\n  `dp[i][j]=dp[i-1][j-1]+1`   dp[i-1] [j-1]ä»£è¡¨çš„å°±æ˜¯ä¸åŒ…å«`Ai/Bj`çš„`Ai-1`å’Œ`Bj-1` çš„LCS\n\n- `A[i]!=B[j]`çš„æ—¶å€™å°±æœ‰ä¸¤ç§æƒ…å†µäº†ï¼Œé¦–å…ˆ`A[i]`å’Œ`B[j]`å·²ç»**ä¸å¯èƒ½åŒæ—¶å‡ºç°åœ¨æœ€ç»ˆçš„LCSé‡Œé¢**äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å¦å¤–çš„ä¸¤ç§æƒ…å†µ`dp[i][j-1]`å’Œ`dp[i-1][j]`å–ä¸ªæœ€å¤§å€¼\n\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„å°ç»†èŠ‚ï¼Œè¿™é‡Œå¾ªç¯éƒ½æ˜¯ä»1å¼€å§‹çš„ï¼Œè¿™æ ·å°±ä¸ç”¨å¤„ç†åˆå§‹å€¼ï¼Œå¦‚æœä»0å¼€å§‹çš„è¯ï¼Œå¤„ç†åˆå§‹æƒ…å†µï¼ˆiï¼Œj=0çš„æƒ…å†µï¼‰ä¼šéº»çƒ¦ä¸€ç‚¹\n\n**è§£æ³•äºŒ**\n\n2019.10.19é‡å†™äº†ä¸€ç§è®°å¿†åŒ–é€’å½’çš„æ–¹æ³•ï¼Œæ²¡æœ‰dpå¿«ï¼Œä½†æ˜¯æ€è·¯å…¶å®æ˜¯ç±»ä¼¼çš„\n\n```java\nInteger[][] cache=null;\n\npublic int longestCommonSubsequence(String text1, String text2) {\n    if(text2==null || text1==null || text1.length()<=0 ||text2.length()<=0){\n        return 0;\n    }\n    int len1=text1.length();\n    int len2=text2.length();\n    cache=new Integer[len1][len2];\n    return lcs(text1,len1-1,text2,len2-1);\n}\n\n//lcså®šä¹‰: æ±‚text1[0,a]å’Œtext2[0,b]çš„æœ€é•¿å…¬å…±å­åºåˆ—\npublic int lcs(String text1, int a,String text2,int b) {\n    if(a==-1 || b==-1){\n        return 0;\n    }\n    if (cache[a][b]!=null) {\n        return cache[a][b];\n    }\n    if (text1.charAt(a)==text2.charAt(b)) {\n        cache[a][b]=lcs(text1,a-1,text2,b-1)+1;\n        return cache[a][b];\n    }else{\n        cache[a][b]=Math.max(lcs(text1,a-1,text2,b),lcs(text1,a,text2,b-1));\n        return cache[a][b];\n    }\n}\n```\n## [AtCoder-LCS](https://atcoder.jp/contests/dp/tasks/dp_f)\n\né¢˜ç›®å°±ä¸copyäº†ï¼Œè¿™é‡Œå°±æ˜¯æ±‚å‡ºlcså…·ä½“çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ±‚é•¿åº¦\n\næˆ‘è¿™é‡Œæ˜¯å‚è€ƒäº†leetcodeä¸Šä¸€ä¸ªå¤§ä½¬çš„[æ–‡ç« ](https://leetcode-cn.com/circle/article/CwZVuV/) åˆ©ç”¨backæ•°ç»„ï¼Œä»åå‘å‰é€’æ¨ï¼Œä½†æ˜¯å®é™…ä¸Šæœ‰ç‚¹å¤šä½™ï¼Œç›´æ¥æ ¹æ®dpæ•°ç»„ä¹Ÿå¯ä»¥æ¨å›å»ï¼Œä½†æ˜¯è¿™æ ·å†™æ¯”è¾ƒé€šç”¨ï¼Œé€»è¾‘æ¯”è¾ƒæ¸…æ¥šã€‚\n\n```java\npublic static void main(String[] args) {\n    Scanner sc=new Scanner(System.in);\n    while(sc.hasNext()){\n        String A=sc.next();\n        String B=sc.next();\n        System.out.println(longestCommonSubsequence(A,B));\n    }\n}\n\npublic static String longestCommonSubsequence(String A, String B) {\n    int lenA=A.length();\n    int lenB=B.length();\n    int[][] dp=new int[lenA+1][lenB+1];\n    int[][] back=new int[lenA+1][lenB+1];\n    for (int i=1;i<=lenA;i++) {\n        for (int j=1;j<=lenB;j++) {\n            if (A.charAt(i-1)==B.charAt(j-1)) {\n                dp[i][j]=dp[i-1][j-1]+1;\n                back[i][j]=1; //å·¦ä¸Š\n            }else if(dp[i-1][j]>dp[i][j-1]){\n                dp[i][j]=dp[i-1][j];\n                back[i][j]=2; //ä¸Š\n            }else{\n                dp[i][j]=dp[i][j-1];\n                back[i][j]=0; //å·¦\n            }\n        }\n    }\n    int i=lenA,j=lenB;\n    StringBuilder res=new StringBuilder();\n    while(i>0 && j>0){\n        if (back[i][j]==1) {\n            i--;j--;\n            res.append(A.charAt(i));\n        }else if(back[i][j]==2){\n            i--;\n        }else{\n            j--;\n        }\n    }\n    return res.reverse().toString();\n}\n```\n\näº†è§£å³å¯ã€‚\n\n## [718. æœ€é•¿é‡å¤å­æ•°ç»„](https://leetcode-cn.com/problems/maximum-length-of-repeated-subarray/)\n\nç»™ä¸¤ä¸ªæ•´æ•°æ•°ç»„ `A` å’Œ `B` ï¼Œè¿”å›ä¸¤ä¸ªæ•°ç»„ä¸­å…¬å…±çš„ã€é•¿åº¦æœ€é•¿çš„å­æ•°ç»„çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\nA: [1,2,3,2,1]\nB: [3,2,1,4,7]\nè¾“å‡º: 3\nè§£é‡Š: \né•¿åº¦æœ€é•¿çš„å…¬å…±å­æ•°ç»„æ˜¯ [3, 2, 1]ã€‚\n```\n\n**è¯´æ˜:**\n\n1. 1 <= len(A), len(B) <= 1000\n2. 0 <= A[i], B[i] < 100\n\n**è§£æ³•ä¸€**\n\nç®€å•çš„é€’æ¨ï¼Œæ³¨æ„åˆ«å†™æˆä¸Šé¢çš„lcsäº†ï¼Œè¿™é‡Œçš„`dp[i][j]` ä»£è¡¨çš„å…¶å®æ˜¯**å…¬å…±å­ä¸²**ä»¥`A[i]`å’Œ`B[i]` ç»“å°¾çš„æœ€é•¿é‡å¤å­æ•°ç»„é•¿åº¦ï¼Œå¦‚æœ`A[i]`å’Œ`B[i]`ä¸ç›¸ç­‰é‚£å°±æ˜¯0\n\n```java\npublic int findLength(int[] A, int[] B) {\n    int lenA=A.length;\n    int lenB=B.length;\n    int[][] dp=new int[lenA+1][lenB+1];\n    int res=0;\n    for(int i=1;i<=lenA;i++){\n        for(int j=1;j<=lenB;j++){\n            if(A[i-1]==B[j-1]){\n                dp[i][j]=dp[i-1][j-1]+1;\n                res=Math.max(dp[i][j],res);\n            }\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\n> æœ¬æ¥æ˜¯æƒ³ç»ƒç»ƒäºŒåˆ†ï¼Œåœ¨äºŒåˆ†çš„tagé‡Œé¢çœ‹è§çš„è¿™é¢˜ï¼Œç»“æœå‘ç°è¿™é¢˜dpä¼¼ä¹æ›´å®¹æ˜“ï¼Œçœ‹äº†å®˜æ–¹çš„äºŒåˆ†çš„è§£æ³•ï¼Œå…¶å®å°±æ˜¯äºŒåˆ†å…¬å…±å­ä¸²çš„é•¿åº¦ï¼Œç„¶åæ£€æŸ¥ï¼Œæ£€æŸ¥è¿™ä¸€æ­¥æœ‰ä¸€äº›æ“ä½œï¼Œä¸æ˜¯å¾ˆç†è§£ï¼Œä»¥åæœ‰æœºä¼šå†æ¥è¡¥å……ã€‚\n> _å·²è¡¥å……_ï¼Œè§ [Rabin-Karpä¸“é¢˜](http://imlgw.top/2020/07/01/rabinkarp-suan-fa/#718-%E6%9C%80%E9%95%BF%E9%87%8D%E5%A4%8D%E5%AD%90%E6%95%B0%E7%BB%84)\n\n## [72. ç¼–è¾‘è·ç¦»](https://leetcode-cn.com/problems/edit-distance/)\n\nç»™å®šä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œè®¡ç®—å‡ºå°† word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•° ã€‚\n\nä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š\n\n- æ’å…¥ä¸€ä¸ªå­—ç¬¦\n- åˆ é™¤ä¸€ä¸ªå­—ç¬¦\n- æ›¿æ¢ä¸€ä¸ªå­—ç¬¦\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: word1 = \"horse\", word2 = \"ros\"\nè¾“å‡º: 3\nè§£é‡Š: \nhorse -> rorse (å°† 'h' æ›¿æ¢ä¸º 'r')\nrorse -> rose (åˆ é™¤ 'r')\nrose -> ros (åˆ é™¤ 'e')\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: word1 = \"intention\", word2 = \"execution\"\nè¾“å‡º: 5\nè§£é‡Š: \nintention -> inention (åˆ é™¤ 't')\ninention -> enention (å°† 'i' æ›¿æ¢ä¸º 'e')\nenention -> exention (å°† 'n' æ›¿æ¢ä¸º 'x')\nexention -> exection (å°† 'n' æ›¿æ¢ä¸º 'c')\nexection -> execution (æ’å…¥ 'u')\n```\n\n**è§£æ³•ä¸€**\n\nå¾ˆç»å…¸çš„åŠ¨æ€è§„åˆ’çš„é—®é¢˜ï¼Œåšä¹‹å‰çœ‹äº†åŠ¨æ€è§„åˆ’çš„æ€è·¯ï¼Œç„¶åå¾ˆå¿«å†™å‡ºäº†é€’å½’çš„è§£æ³•ã€‚ã€‚ã€‚\n\n```java\nInteger[][] cache=null;\n\npublic int minDistance(String word1, String word2) {\n    cache=new Integer[word1.length()][word2.length()];\n    return minDistance(word1,word1.length()-1,word2,word2.length()-1);\n}\n\n//é€’å½’çš„å®šä¹‰: word1[0,idx1] å’Œ word2[0,idx2] çš„æœ€çŸ­ç¼–è¾‘è·ç¦»\npublic int minDistance(String word1,int idx1,String word2,int idx2) {\n    if (idx1<0) {\n        return idx2+1;\n    }\n    if (idx2<0) {\n        return idx1+1;\n    }\n    if (cache[idx1][idx2]!=null) {\n        return cache[idx1][idx2];\n    }\n    if (word1.charAt(idx1) == word2.charAt(idx2)) {\n        return cache[idx1][idx2]=minDistance(word1,idx1-1,word2,idx2-1);\n    }else{\n        return cache[idx1][idx2]=1+Math.min(minDistance(word1,idx1-1,word2,idx2),Math.min(minDistance(word1,idx1,word2,idx2-1),minDistance(word1,idx1-1,word2,idx2-1)));\n    }\n}\n```\næ ¸å¿ƒçš„é€’æ¨å…¬å¼å°±æ˜¯ \n\n`minDis(i,j)=minDis(i-1,j-1)  word1[i]==word2[j]`\n\n`minDis(i,j)=min(minDis(i-1,j),minDis(i,j-1),minDis(i-1,j-1))+1  word1[i]!=word2[j]`\n\nç¬¬ä¸€ä¸ªå…¬å¼å¥½è¯´ï¼Œç›¸ç­‰æ—¶å€™å°±åˆ«åŠ¨ï¼Œå»¶ç»­ä¹‹å‰çš„çŠ¶æ€ï¼Œå…³é”®æ˜¯ç¬¬äºŒä¸ªï¼Œä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ±‚å¯¹åº”çš„ä¸‰ç§æ“ä½œå¢ï¼Œåˆ ï¼Œæ”¹çš„æœ€å°å€¼ï¼Œä½†æ˜¯è¿™é‡Œï¼Œç¬¬äºŒç§åˆ çš„æ“ä½œï¼Œè¿™é‡Œè¦æƒ³æ¸…æ¥šï¼Œå…¶å®word1åˆ é™¤ä¸€ä¸ªå…¶å®å°±ç­‰ä»·äºword2å¢åŠ ä¸€ä¸ªï¼Œæ‰€ä»¥æ˜¯`minDis(i,j-1)`ï¼Œè™½ç„¶é¢˜ç›®è¯´çš„æ˜¯ä»word1è½¬æ¢ä¸ºword2ï¼Œä½†æ˜¯å…¶å®ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹å…¶å®æ˜¯å¯é€†çš„\n\n**è§£æ³•äºŒ**\n\næ ‡å‡†çš„åŠ¨æ€è§„åˆ’å†™æ³•ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸Šé¢çš„è®°å¿†åŒ–é€’å½’å¥½å†™ï¼ŒåŠ¨æ€è§„åˆ’è¦è€ƒè™‘çš„è¾¹ç•Œæ¯”é€’å½’è¦å¤š\n\n```java\npublic int minDistance2(String word1, String word2) {\n    if (word1.length()<=0 || word2.length()<=0) {\n        return word2.length()==0?word1.length():word2.length();\n    }\n    //dp[i][j]: word1å‰iä¸ªå’Œword2å‰jä¸ªçš„æœ€çŸ­ç¼–è¾‘è·ç¦»\n    int[][] dp=new int[word1.length()+1][word2.length()+1];\n    for (int i=1;i<=word2.length();i++) {\n        dp[0][i]=i;\n    }\n    for (int i=1;i<=word1.length();i++) {\n        dp[i][0]=i;\n    }\n    for (int i=1; i<=word1.length();i++) {\n        for (int j=1;j<=word2.length();j++) {\n            if (word1.charAt(i-1)==word2.charAt(j-1)) {\n                dp[i][j]=dp[i-1][j-1];\n            }else{\n                dp[i][j]=1+Math.min(dp[i-1][j],Math.min(dp[i][j-1],dp[i-1][j-1]));\n            }\n        }\n    }\n    return dp[word1.length()][word2.length()];\n}\n```\n\n## [647. å›æ–‡å­ä¸²](https://leetcode-cn.com/problems/palindromic-substrings/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½ çš„ä»»åŠ¡æ˜¯è®¡ç®—è¿™ä¸ªå­—ç¬¦ä¸²ä¸­æœ‰å¤šå°‘ä¸ªå›æ–‡å­ä¸²ã€‚\n\nå…·æœ‰ä¸åŒå¼€å§‹ä½ç½®æˆ–ç»“æŸä½ç½®çš„å­ä¸²ï¼Œå³ä½¿æ˜¯ç”±ç›¸åŒçš„å­—ç¬¦ç»„æˆï¼Œä¹Ÿä¼šè¢«è®¡ä¸ºæ˜¯ä¸åŒçš„å­ä¸²ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"abc\"\nè¾“å‡º: 3\nè§£é‡Š: ä¸‰ä¸ªå›æ–‡å­ä¸²: \"a\", \"b\", \"c\".\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"aaa\"\nè¾“å‡º: 6\nè¯´æ˜: 6ä¸ªå›æ–‡å­ä¸²: \"a\", \"a\", \"a\", \"aa\", \"aa\", \"aaa\".\n```\n\n\n**æ³¨æ„:**\n\n1. è¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸ä¼šè¶…è¿‡1000ã€‚\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’çš„è§£æ³•ï¼Œå…¶å®æˆ‘æ˜¯æ²¡æƒ³åˆ°çš„ï¼Œ`dp[i][j]`ä»£è¡¨çš„æ˜¯`s[i,j]` æ˜¯ä¸æ˜¯å›æ–‡å­ä¸²\n\n```java\npublic int countSubstrings(String s) { \n    if (s==null || s.length()<=0) {\n        return 0;\n    }\n    int n=s.length();\n    //aaaba\n    //dp[i][j] i~j æ˜¯ä¸æ˜¯å›æ–‡\n    boolean [][] dp=new boolean[n][n];\n    int res=n; //ä¸‹é¢çš„å¾ªç¯æ²¡æœ‰ç»Ÿè®¡å•ä¸ªå­—ç¬¦çš„æƒ…å†µ\n    for (int i=n-1;i>=0;i--) {\n        for (int j=i+1;j<n;j++) { //ç»Ÿä¸€å†™æ³•ï¼Œè¿™é‡Œæ”¹æˆj=iå°±å¯ä»¥ç»Ÿè®¡åˆ°å•ä¸ªå­—ç¬¦çš„æƒ…å†µ\n            if (s.charAt(i) == s.charAt(j) && (j-i<=2 || dp[i+1][j-1])) {\n                dp[i][j]=true;\n                res++;\n            }\n        }\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\nå¾ˆç†Ÿæ‚‰çš„è§£æ³•ï¼Œæ²¡é”™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ [æœ€é•¿å›æ–‡å­ä¸²ä¸­](https://leetcode-cn.com/problems/longest-palindromic-substring/) çš„è§£æ³•ï¼Œæ¯”ä¸Šé¢çš„åŠ¨æ€è§„åˆ’ä¼šå¿«å¾ˆå¤šï¼Œä¹Ÿæ¯”è¾ƒè‡ªç„¶\n\n```java\n//ä¸­å¿ƒæ‰©å±•æ³•\npublic int countSubstrings(String s) {\n    if (s==null || s.length()<=0) {\n        return 0;\n    }\n    int n=s.length();\n    int count=0;\n    for (int i=0;i<n;i++) {\n        count+=spread(s,i,i+1)+spread(s,i,i);\n    }\n    return count;\n}\n\npublic int spread(String s,int i,int j){\n    int res=0;\n    while(i>=0 && j<s.length()){\n        if (s.charAt(i)==s.charAt(j)) {\n            i--;j++;\n            res++;\n        }else{\n            return res;\n        }\n    }\n    return res;\n}\n```\n\n\n## [32. æœ€é•¿æœ‰æ•ˆæ‹¬å·](https://leetcode-cn.com/problems/longest-valid-parentheses/)\n\nç»™å®šä¸€ä¸ªåªåŒ…å« '(' å’Œ ')' çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿çš„åŒ…å«æœ‰æ•ˆæ‹¬å·çš„å­ä¸²çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"(()\"\nè¾“å‡º: 2\nè§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²ä¸º \"()\"\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \")()())\"\nè¾“å‡º: 4\nè§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²ä¸º \"()()\"\n```\n\n**è§£æ³•ä¸€**\n\næ ˆ+dpçš„æ€è·¯\n\n```java\npublic int longestValidParentheses(String s) {\n    if (s==null || s.length()<=0) {\n        return  0;\n    }\n    Stack<Integer> stack=new Stack<>();\n    int[] dp=new int[s.length()]; //ä»¥iä½ç½®æ‹¬å·ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·\n    dp[0]=0;\n    int res=0;\n    for (int i=0;i<s.length();i++) {\n        if (s.charAt(i)=='(') {\n            stack.push(i); //dp[i]=0\n        }else{\n            if(!stack.isEmpty()){\n                int left=stack.pop();\n                dp[i]= left==0?i-left+1:dp[left-1]+i-left+1;\n                res=Math.max(res,dp[i]);\n            }//else dp[i]=0  \n        }\n    }\n    return res;\n}\n```\n\né¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯è¿™ç§è§£æ³•ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œæ ˆä¸­å­˜ç´¢å¼•ï¼Œ`dp[i]` ä»£è¡¨ä»¥`i`ä½ç½®æ‹¬å·ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·ï¼Œå½“é‡åˆ°å³æ‹¬å·çš„æ—¶å€™å°†æ ˆé¡¶çš„å·¦æ‹¬å·çš„ç´¢å¼•`left`å¼¹å‡ºæ¥ï¼Œä¸¤è€…å½¢æˆçš„æ‹¬å·é•¿åº¦å†åŠ ä¸Šå·¦æ‹¬å·ç´¢å¼•å‰ä¸€ä¸ªå…ƒç´ `dp[left-1]`å°±æ˜¯å½“å‰ä½ç½®çš„`dp[i]`\n\n**Update**\n\nå›å¤´åšç¬¬äºŒéåœ°æ—¶å€™ç«Ÿç„¶å†™äº†ä¸ªä¸ä¸€æ ·çš„dpæ€è·¯hahaha~ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œé‡åˆ°å³æ‹¬å·ä¸æ˜¯ç›´æ¥ç”¨`i-left+1` ç®—é•¿åº¦ï¼Œè€Œæ˜¯ç›´æ¥æ ¹æ®å‰ä¸€ä¸ªå­—ç¬¦`dp[i-1]` è¿›è¡Œè½¬åŒ–ï¼Œå…¶å®æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯ç´¯åŠ çš„ï¼Œå‰é¢çš„æ˜¯ä¸€æ¬¡å°±å…¨ç®—å‡ºæ¥äº†\n\n```java\n//update: 2020.4.13\npublic int longestValidParentheses(String s) {\n    if(s==null || s.length()<=0) return 0;\n    Deque<Integer> stack=new ArrayDeque<>();\n    int[] dp=new int[s.length()];\n    int res=0;\n    for(int i=0;i<s.length();i++){\n        if(s.charAt(i)=='('){\n            stack.push(i);\n        }else{\n            if(!stack.isEmpty()){\n                int left=stack.pop();\n                //dp[i]=(left>1?dp[left-1]+dp[i-1]:dp[i-1])+2;\n                dp[i]=dp[i-1]+(left>1?dp[left-1]:0)+2;\n            }\n            res=Math.max(res,dp[i]);\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nçº¯dpè§£æ³•ï¼Œä¸Šé¢çš„è§£æ³•è™½ç„¶ä¹Ÿç”¨åˆ°äº†ä¸€ç‚¹åŠ¨æ€è§„åˆ’ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿçº¯ç²¹\n\n```java\npublic int longestValidParentheses(String s) {\n    if (s==null || s.length()<=0) {\n        return  0;\n    }\n    int[] dp=new int[s.length()];\n    dp[0]=0;\n    int res=0;\n    for (int i=1;i<s.length();i++) {\n        if (s.charAt(i)==')') {\n            if (s.charAt(i-1)=='(') { //å‰ä¸€ä¸ªæ˜¯å·¦æ‹¬å·\n                dp[i]=i-2>=0?dp[i-2]+2:2;\n            }else{ //å‰ä¸€ä¸ªæ˜¯å³æ‹¬å· ()(())\n                if (i-dp[i-1]-1>=0 && s.charAt(i-dp[i-1]-1)=='(') {//å‰ä¸€ä¸ªå³æ‹¬å·çš„åˆæ³•åºåˆ—çš„å‰ä¸€ä¸ªæ˜¯'('\n                    //å‰ä¸€ä¸ªçš„å‰ä¸€ä¸ªçš„dp[i-dp[i-1]-2]+dp[i-1]+2\n                    dp[i]=(i-dp[i-1]-2>=0?dp[i-dp[i-1]-2]:0)+dp[i-1]+2; \n                }\n                //å‰ä¸€ä¸ªå³æ‹¬å·çš„åˆæ³•åºåˆ—çš„å‰ä¸€ä¸ªæ˜¯')',æ²¡æ•‘äº†\n            }\n        }\n        res=Math.max(res,dp[i]);\n    }\n    return res;\n}\n```\n\nè§£é‡Šéƒ½åœ¨ä»£ç æ³¨é‡Šä¸­ï¼Œ~~æ„Ÿè§‰æ²¡é‚£ä¹ˆå®¹æ˜“ç›´æ¥æƒ³åˆ°ï¼Œæ¯•ç«Ÿhardé¢˜~~\n\n**Update: 2020.7.4**\n\nä»Šå¤©çš„æ‰“å¡é¢˜ï¼Œä¹‹å‰çš„åšæ³•åªè®°å¾—æ ˆ+dpçš„åšæ³•ï¼Œdpçš„æ–¹æ³•å¿˜äº†ï¼Œç°åœºå†™äº†ä¸‹çº¯dpçš„æ–¹æ³•ï¼Œå‘ç°å…¶å®çº¯dpçš„å¥½åƒæ›´ç®€å•å•Šï¼ŒçŠ¶æ€å®šä¹‰å‡ºæ¥åï¼Œè½¬ç§»æ–¹ç¨‹å°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼ˆæ˜¯æˆ‘å˜å¼ºäº†ä¹ˆğŸ¤£ï¼‰\n\n```golang\n//å’Œå‰é¢çš„å†™æ³•ä¸ä¸€æ ·ï¼Œæ„Ÿè§‰æˆ‘çš„æ›´å¥½ç†è§£\nfunc longestValidParentheses(s string) int {\n    var dp = make([]int, len(s)) //ä»¥s[i]ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·\n    //dp[0] = 0\n    var res = 0\n    for i := 1; i < len(s); i++{\n        if s[i] == ')' {\n            if i - dp[i-1] - 1 >= 0 && s[i - dp[i-1] - 1] == '('{\n                dp[i] = dp[i - 1] + 2\n                if(i - dp[i-1] - 2 >= 0){\n                    dp[i] += dp[i - dp[i-1] - 2]\n                }\n            }\n        }\n        res = Max(res, dp[i])\n    }\n    return res\n}\n\nfunc Max(a, b int) int{\n    if a > b{\n        return a\n    }\n    return b\n}\n```\n\n> å…¶å®è¿˜æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§åˆ©ç”¨çº¯åˆ©ç”¨æ ˆçš„ï¼Œè¿˜æœ‰ä¸€ç§å¾ˆç¥å¥‡çš„æ–¹æ³•ï¼Œæ²¡ä»€ä¹ˆé€šç”¨æ€§ï¼Œå¾ˆéš¾ç›´æ¥æƒ³å‡ºæ¥ï¼Œå°±ä¸åšè®°å½•äº†ï¼Œçº¯æ ˆçš„è§£æ³•åé¢å†æ¥è¡¥å……\n\n**è§£æ³•ä¸‰**\n\n~~çº¯åˆ©ç”¨æ ˆçš„è§£æ³•ä»¥åå†æ¥è¡¥å……~~ ç®—äº†ï¼Œç›´æ¥å†™äº†å§\n\n```java\npublic int longestValidParentheses(String s) {\n    if (s==null || s.length()<=0) {\n        return  0;\n    }\n    Deque<Integer> stack=new ArrayDeque<>();\n    stack.push(-1); //ä¸´ç•Œç‚¹\n    int res=0;\n    for(int i=0;i<s.length();i++){\n        if(s.charAt(i)=='('){\n            stack.push(i);\n        }else{\n            stack.pop();\n            if(stack.isEmpty()){ \n                //æ ˆä¸ºç©º,è¯´æ˜å½“å‰çš„')'è‚¯å®šæ˜¯ä¸åˆæ³•çš„\n                //å…¶å®ç›¸å½“äºä¸€ä¸ªåˆ†ç•Œç‚¹,è¿™ä¸ªä½ç½®ä¹‹å‰çš„å­—ç¬¦ä¸å¯èƒ½å†æ„æˆåˆæ³•çš„åºåˆ—äº†\n                //åé¢çš„æ ˆç©ºçš„æ—¶å€™å°±ä¸èƒ½å†æ ¹æ®-1æ¥ç®—é•¿åº¦äº†,éœ€è¦ä¸€ä¸ªæ–°çš„ä¸´ç•Œç‚¹\n                stack.push(i);\n            }else{\n                res=Math.max(res,i-stack.peek());\n            }\n        }\n    }\n    return res;\n}\n```\nå…³é”®çš„åœ°æ–¹å°±åœ¨äºå°†**éæ³•çš„å³æ‹¬å·**å…¥æ ˆï¼Œä½œä¸ºä¸€ä¸ªåˆ†ç•Œç‚¹ä¾¿äºåé¢è®¡ç®—ï¼Œåˆå§‹çš„-1ä¹Ÿå¾ˆå…³é”®\n\n**è§£æ³•å››**\n\nUPDATE: 2020.7.4ï¼ŒæŠŠä¹‹å‰æ‰€è°“çš„â€œç¥å¥‡â€çš„æ–¹æ³•ä¹Ÿè®°å½•ä¸‹ï¼Œå…¶å®ä¹Ÿæ²¡å•¥ç¥å¥‡çš„ï¼Œçœ‹ä¸€ä¸‹å°±æ‡‚äº†ï¼Œè¿™ç§æ–¹æ³•è¿˜æ˜¯å¾ˆä¼˜ç§€çš„ï¼Œç©ºé—´å¤æ‚åº¦ä¸º`O(1)`\n```golang\n//å®æ—¶ç»Ÿè®¡å·¦å³æ‹¬å·çš„ä¸ªæ•°ï¼Œå½“åŒ¹é…çš„æ—¶å€™ç»Ÿè®¡é•¿åº¦ï¼Œè®°å¾—å·¦å³éƒ½è¦æ‰«ä¸€é\nfunc longestValidParentheses(s string) int {\n    var left, right = 0, 0\n    var res = 0\n    for i := 0; i < len(s); i++ {\n        if s[i] == '(' {\n            left++\n        } else {\n            right++\n        }\n        if right > left {\n            right, left = 0, 0\n        }else if right == left {\n            res = Max(res, left*2)\n        }\n    }\n    right, left = 0, 0\n    for i := len(s) - 1; i >= 0; i-- {\n        if s[i] == '(' {\n            left++\n        } else {\n            right++\n        }\n        if right < left {\n            right, left = 0, 0\n        } else if right == left {\n            res = Max(res, left*2)\n        }\n    }\n    return res\n}\n\nfunc Max(a, b int) int {\n    if a > b {\n        return a\n    }\n    return b\n}\n```\n\n\n## [é¢è¯•é¢˜ 17.13. æ¢å¤ç©ºæ ¼](https://leetcode-cn.com/problems/re-space-lcci/)\n\nDifficulty: **ä¸­ç­‰**\n\nå“¦ï¼Œä¸ï¼ä½ ä¸å°å¿ƒæŠŠä¸€ä¸ªé•¿ç¯‡æ–‡ç« ä¸­çš„ç©ºæ ¼ã€æ ‡ç‚¹éƒ½åˆ æ‰äº†ï¼Œå¹¶ä¸”å¤§å†™ä¹Ÿå¼„æˆäº†å°å†™ã€‚åƒå¥å­`\"I reset the computer. It still didnâ€™t boot!\"`å·²ç»å˜æˆäº†`\"iresetthecomputeritstilldidntboot\"`ã€‚åœ¨å¤„ç†æ ‡ç‚¹ç¬¦å·å’Œå¤§å°å†™ä¹‹å‰ï¼Œä½ å¾—å…ˆæŠŠå®ƒæ–­æˆè¯è¯­ã€‚å½“ç„¶äº†ï¼Œä½ æœ‰ä¸€æœ¬åšåšçš„è¯å…¸`dictionary`ï¼Œä¸è¿‡ï¼Œæœ‰äº›è¯æ²¡åœ¨è¯å…¸é‡Œã€‚å‡è®¾æ–‡ç« ç”¨`sentence`è¡¨ç¤ºï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼ŒæŠŠæ–‡ç« æ–­å¼€ï¼Œè¦æ±‚æœªè¯†åˆ«çš„å­—ç¬¦æœ€å°‘ï¼Œè¿”å›æœªè¯†åˆ«çš„å­—ç¬¦æ•°ã€‚\n\n**æ³¨æ„:** æœ¬é¢˜ç›¸å¯¹åŸé¢˜ç¨ä½œæ”¹åŠ¨ï¼Œåªéœ€è¿”å›æœªè¯†åˆ«çš„å­—ç¬¦æ•°\n\n**ç¤ºä¾‹ï¼š**\n\n```go\nè¾“å…¥ï¼š\ndictionary = [\"looked\",\"just\",\"like\",\"her\",\"brother\"]\nsentence = \"jesslookedjustliketimherbrother\"\nè¾“å‡ºï¼š 7\nè§£é‡Šï¼š æ–­å¥åä¸º\"jess looked just like tim her brother\"ï¼Œå…±7ä¸ªæœªè¯†åˆ«å­—ç¬¦ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `0 <= len(sentence) <= 1000`\n*   `dictionary`ä¸­æ€»å­—ç¬¦æ•°ä¸è¶…è¿‡ 150000ã€‚\n*   ä½ å¯ä»¥è®¤ä¸º`dictionary`å’Œ`sentence`ä¸­åªåŒ…å«å°å†™å­—æ¯ã€‚\n\n\n\n**è§£æ³•ä¸€**\n\nåŒæ ·çš„è§£æ³•ï¼Œç”¨Javaå†™å°±æ˜¯922msï¼Œæˆ‘è§‰å¾—ä¸»è¦å°±æ˜¯substringæ‹–æ…¢äº†é€Ÿåº¦ï¼ŒJavaé‡Œé¢substringæ˜¯O(N)çš„æ“ä½œï¼Œè€Œgolangä¸­å–åˆ‡ç‰‡å€¼ä»…ä»…åªæ˜¯ä¿®æ”¹å‡ ä¸ªåˆ‡ç‰‡çš„ç†Ÿæ‚‰ç½¢äº†ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)çš„ï¼Œæ‰€ä»¥ä¼šå¾ˆå¿«ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥è¿‘ä¼¼çš„çœ‹ä½œO(N^2)\n```golang\n//æ­£å‘dpï¼Œ60ms\nfunc respace(dictionary []string, sentence string) int {\n    var dict = make(map[string]bool)\n    for i := 0; i < len(dictionary); i++ {\n        dict[dictionary[i]] = true\n    }\n    var n = len(sentence)\n    //å‰iä¸ªå­—ç¬¦çš„æœ€å°‘æœªè¯†åˆ«å­—ç¬¦\n    var dp = make([]int, n+1)\n    for i := 1; i <= n; i++ {\n        dp[i] = dp[i-1] + 1 //åˆå§‹å€¼\n        for j := 0; j < i; j++ {\n            if dict[sentence[j:i]] {\n                dp[i] = Min(dp[j], dp[i])\n            }\n        }\n    }\n    return dp[n]\n}\n\nfunc Min(a, b int) int {\n    if a < b {\n        return a\n    }\n    return b\n}\n```\n> æŸ¥è¯¢äº†ç½‘ä¸Šçš„ä¸€äº›èµ„æ–™ï¼Œå‘ç°Javaçš„substringå…¶å®åœ¨1.7ä¹‹å‰æ—¶é—´å¤æ‚åº¦æ˜¯O(1)çš„ï¼Œåé¢ä¸ºäº†é¿å…å†…å­˜æ³„æ¼å°±æ”¹æˆO(N)äº† [å‚è€ƒ](https://www.iteye.com/blog/lvdccyb-1947937)\n\n**è§£æ³•äºŒ**\n\nè®°å¿†åŒ–é€’å½’ï¼Œå…¶å®ä¸€å¼€å§‹å°±è¢«é¢˜ç›®çš„tagç»™è¿·æƒ‘äº†ï¼Œæˆ‘ä¸€çœ‹è®°å¿†åŒ–ï¼Œå°±ç›´æ¥å¾€è®°å¿†åŒ–çš„æ–¹å‘å»å†™äº†ï¼ŒåŠ ä¸Šå‰å¤©åˆšå†™äº† å•è¯æ‹†åˆ†2çš„è®°å¿†åŒ–ï¼Œå”‰ï¼Œçœ‹æ¥ä»¥åä¸èƒ½ç›´æ¥çœ‹tagäº†ï¼Œä¸€å¼€å§‹å†™äº†ä¸ªè´¼åƒåœ¾çš„dfsï¼Œå°±æ˜¯ä¸‹é¢æ³¨é‡Šçš„éƒ¨åˆ†ï¼Œæ—¶é—´å¤æ‚åº¦çˆ†ç‚¸ï¼Œä¸¤å±‚forå¾ªç¯\n```golang\n//è®°å¿†åŒ–dfs tleäº† å¯èƒ½æ€è·¯æœ‰ç‚¹é—®é¢˜\n//ç¡®å®æ˜¯æ€è·¯å‡ºäº†é—®é¢˜ï¼Œä¸‹é¢è¡¥å……äº†æ­£ç¡®çš„è®°å¿†åŒ–å†™æ³• 248ms\nfunc respace(dictionary []string, sentence string) int {\n    var dict = make(map[string]bool)\n    for i := 0; i < len(dictionary); i++ {\n        dict[dictionary[i]] = true\n    }\n    var cache = make(map[string]int)\n    return dfs(sentence, dict, cache)\n}\n\n// func dfs(s string, dict map[string]bool, cache map[string]int) int {\n//     if _, ok := cache[s]; ok {\n//         return cache[s]\n//     }\n//     var res = len(s)\n//     for i := 0; i <= len(s); i++ {\n//         temp := len(s)\n//         for j := i + 1; j <= len(s); j++ {\n//             if dict[s[i:j]] {\n//                 temp = Min(temp, dfs(s[j:], dict, cache))\n//             }\n//         }\n//         res = Min(res, temp+i)\n//     }\n//     cache[s] = res\n//     return res\n// }\n\nfunc dfs(s string, dict map[string]bool, cache map[string]int) int {\n    if _, ok := cache[s]; ok {\n        return cache[s]\n    }\n    var res = len(s)\n    for i := 1; i <= len(s); i++ {\n        if dict[s[:i]] {\n            res = Min(res, dfs(s[i:], dict, cache))\n        }else{\n            res = Min(res, dfs(s[i:], dict, cache) + i)\n        }\n    }\n    cache[s] = res\n    return res\n}\n\nfunc Min(a, b int) int {\n    if a < b {\n        return a\n    }\n    return b\n}\n```\n\n**è§£æ³•ä¸‰**\n\nä¸Šé¢çš„è§£æ³•ä»æŸç§è§’åº¦ä¸Šæ¥è¯´éƒ½è¿˜æ˜¯æ˜¯å±äºæš´åŠ›è§£æ³•ï¼Œå³ä½¿æ˜¯golangçš„O(N^2)çš„æ–¹æ³•ï¼Œå“ˆå¸Œè¡¨çš„å¸¸æ•°ä¹Ÿæ˜¯å¾ˆå¤§çš„ï¼Œè€Œä¸”å› ä¸ºæ˜¯å­˜çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²æœ¬èº«Hashçš„æ—¶é—´ä¹Ÿæ˜¯ä¸èƒ½å¿½ç•¥çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¼•å…¥**å‰ç¼€æ ‘**ï¼Œä¸äº†è§£ç›¸å…³çŸ¥è¯†çš„å¯ä»¥çœ‹æˆ‘[ä¹‹å‰çš„æ–‡ç« ](http://imlgw.top/2019/12/17/zi-dian-shu/)\n\nè¿™é‡Œæˆ‘ç”¨golangä¹Ÿå†™äº†ä¸€ç‰ˆï¼Œä½†æ˜¯æå‡ä¸æ˜æ˜¾ï¼Œæ‰€ä»¥ç”¨Javaé‡å†™äº†ä¸€ç‰ˆï¼Œæ—¶é—´å¤æ‚åº¦æœ‰äº†è´¨çš„é£è·ƒ\n```java\n//Trie+dp 14ms,å¾ˆå¼º\npublic int respace(String[] dictionary, String s) {\n    Node root = new Node();\n    for (String word : dictionary ) {\n        root.insert(word);\n    }\n    int n = s.length();\n    int[] dp = new int[n+1];\n    for (int i = 1; i <=n ; i++) {\n        dp[i] = dp[i-1] + 1;\n        Node cur = root;\n        for (int j = i-1; j >=0 ; j--) {\n            int c = s.charAt(j)-'a';\n            //å¾ˆå¤§çš„ä¼˜åŒ–ç‚¹ï¼Œcä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä»¥cä¸ºåç¼€çš„å…¶ä»–å­—ç¬¦è‚¯å®šä¹Ÿä¸ä¼šå­˜åœ¨ï¼Œç›´æ¥break\n            if(cur.next[c] == null){\n                break;\n            }\n            if(cur.next[c].isWord){\n                dp[i] = Math.min(dp[i], dp[j]);\n            }\n            if(dp[i] == 0){\n                break;\n            }\n            cur = cur.next[c];\n        }\n    }\n    return dp[n];\n}\n\n//è¿™é‡ŒTrieä¸ç”¨å†™æœç´¢ï¼Œç›´æ¥æ‰‹åŠ¨çš„æœç´¢ï¼Œè¿™æ ·å¯ä»¥åšä¸€äº›å‰ªæ\nclass Node{\n    Node[] next = new Node[26];\n    \n    boolean isWord;\n\n    //åå‘æ’å…¥\n    public void insert(String s){\n        Node cur = this;\n        for (int i = s.length()-1; i >= 0; i--) {\n            int c = s.charAt(i)-'a';\n            if(cur.next[c] == null){\n                cur.next[c] = new Node();\n            }\n            cur = cur.next[c];\n        }\n        cur.isWord = true;\n    }\n}\n```\n**è§£æ³•å››**\n\næ²¡é”™ï¼Œè¿™é¢˜è§£æ³•å¾ˆå¤šï¼Œä¹Ÿéƒ½å¾ˆå€¼å¾—å­¦ä¹ ï¼Œè§£æ³•å››å…¶å®å°±æ˜¯ä¹‹å‰å­¦è¿‡çš„å­—ç¬¦ä¸²å“ˆå¸Œçš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªè§£æ³•å³è½¬--->[Rabin-Karpç®—æ³•](http://imlgw.top/2020/07/01/rabinkarp-suan-fa/#%E9%9D%A2%E8%AF%95%E9%A2%98-17-13-%E6%81%A2%E5%A4%8D%E7%A9%BA%E6%A0%BC)\n\n## [174. åœ°ä¸‹åŸæ¸¸æˆ](https://leetcode-cn.com/problems/dungeon-game/)\n\nDifficulty: **å›°éš¾**\n\n\nä¸€äº›æ¶é­”æŠ“ä½äº†å…¬ä¸»ï¼ˆ**P**ï¼‰å¹¶å°†å¥¹å…³åœ¨äº†åœ°ä¸‹åŸçš„å³ä¸‹è§’ã€‚åœ°ä¸‹åŸæ˜¯ç”±Â M x N ä¸ªæˆ¿é—´ç»„æˆçš„äºŒç»´ç½‘æ ¼ã€‚æˆ‘ä»¬è‹±å‹‡çš„éª‘å£«ï¼ˆ**K**ï¼‰æœ€åˆè¢«å®‰ç½®åœ¨å·¦ä¸Šè§’çš„æˆ¿é—´é‡Œï¼Œä»–å¿…é¡»ç©¿è¿‡åœ°ä¸‹åŸå¹¶é€šè¿‡å¯¹æŠ—æ¶é­”æ¥æ‹¯æ•‘å…¬ä¸»ã€‚\n\néª‘å£«çš„åˆå§‹å¥åº·ç‚¹æ•°ä¸ºä¸€ä¸ªæ­£æ•´æ•°ã€‚å¦‚æœä»–çš„å¥åº·ç‚¹æ•°åœ¨æŸä¸€æ—¶åˆ»é™è‡³ 0 æˆ–ä»¥ä¸‹ï¼Œä»–ä¼šç«‹å³æ­»äº¡ã€‚\n\næœ‰äº›æˆ¿é—´ç”±æ¶é­”å®ˆå«ï¼Œå› æ­¤éª‘å£«åœ¨è¿›å…¥è¿™äº›æˆ¿é—´æ—¶ä¼šå¤±å»å¥åº·ç‚¹æ•°ï¼ˆè‹¥æˆ¿é—´é‡Œçš„å€¼ä¸ºè´Ÿæ•´æ•°ï¼Œåˆ™è¡¨ç¤ºéª‘å£«å°†æŸå¤±å¥åº·ç‚¹æ•°ï¼‰ï¼›å…¶ä»–æˆ¿é—´è¦ä¹ˆæ˜¯ç©ºçš„ï¼ˆæˆ¿é—´é‡Œçš„å€¼ä¸º 0ï¼‰ï¼Œè¦ä¹ˆåŒ…å«å¢åŠ éª‘å£«å¥åº·ç‚¹æ•°çš„é­”æ³•çƒï¼ˆè‹¥æˆ¿é—´é‡Œçš„å€¼ä¸ºæ­£æ•´æ•°ï¼Œåˆ™è¡¨ç¤ºéª‘å£«å°†å¢åŠ å¥åº·ç‚¹æ•°ï¼‰ã€‚\n\nä¸ºäº†å°½å¿«åˆ°è¾¾å…¬ä¸»ï¼Œéª‘å£«å†³å®šæ¯æ¬¡åªå‘å³æˆ–å‘ä¸‹ç§»åŠ¨ä¸€æ­¥ã€‚\n\n**ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—ç¡®ä¿éª‘å£«èƒ½å¤Ÿæ‹¯æ•‘åˆ°å…¬ä¸»æ‰€éœ€çš„æœ€ä½åˆå§‹å¥åº·ç‚¹æ•°ã€‚**\n\nä¾‹å¦‚ï¼Œè€ƒè™‘åˆ°å¦‚ä¸‹å¸ƒå±€çš„åœ°ä¸‹åŸï¼Œå¦‚æœéª‘å£«éµå¾ªæœ€ä½³è·¯å¾„ `å³ -> å³ -> ä¸‹ -> ä¸‹`ï¼Œåˆ™éª‘å£«çš„åˆå§‹å¥åº·ç‚¹æ•°è‡³å°‘ä¸º **7**ã€‚\n\n<table class=\"dungeon\" style=\"display: table;\">\n\n<tbody style=\"display: table-row-group;\">\n\n<tr style=\"display: table-row;\">\n\n<td style=\"display: table-cell;\">-2 (K)</td>\n\n<td style=\"display: table-cell;\">-3</td>\n\n<td style=\"display: table-cell;\">3</td>\n\n</tr>\n\n<tr style=\"display: table-row;\">\n\n<td style=\"display: table-cell;\">-5</td>\n\n<td style=\"display: table-cell;\">-10</td>\n\n<td style=\"display: table-cell;\">1</td>\n\n</tr>\n\n<tr style=\"display: table-row;\">\n\n<td style=\"display: table-cell;\">10</td>\n\n<td style=\"display: table-cell;\">30</td>\n\n<td style=\"display: table-cell;\">-5 (P)</td>\n\n</tr>\n\n</tbody>\n\n</table>\n\n**è¯´æ˜:**\n\n*   éª‘å£«çš„å¥åº·ç‚¹æ•°æ²¡æœ‰ä¸Šé™ã€‚\n\n*   ä»»ä½•æˆ¿é—´éƒ½å¯èƒ½å¯¹éª‘å£«çš„å¥åº·ç‚¹æ•°é€ æˆå¨èƒï¼Œä¹Ÿå¯èƒ½å¢åŠ éª‘å£«çš„å¥åº·ç‚¹æ•°ï¼ŒåŒ…æ‹¬éª‘å£«è¿›å…¥çš„å·¦ä¸Šè§’æˆ¿é—´ä»¥åŠå…¬ä¸»è¢«ç›‘ç¦çš„å³ä¸‹è§’æˆ¿é—´ã€‚\n\n\n**è§£æ³•ä¸€**\n\nä»¥åæ¯æ—¥ä¸€é¢˜æ²¡å†™å‡ºæ¥ä¹‹å‰ç»å£ä¸çœ‹ç¾¤äº†ï¼Œçœ‹äº†ä¸€çœ¼ç¾¤ï¼Œçœ‹è§ç¾¤å‹è®¨è®ºäº†è¿™é¢˜ï¼Œè¯´äº†äºŒåˆ†å’Œdpï¼Œç„¶åæˆ‘å°±ç›´æ¥å‘äºŒåˆ†çš„æ–¹å‘å»æƒ³äº†ï¼Œå¦‚æœç‹¬ç«‹çš„æƒ³çš„è¯ï¼Œåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å¾—å‡ºäºŒåˆ†çš„è§£æ³•çš„ï¼Œæ¯•ç«Ÿé¢˜ç›®çš„æè¿°å¾ˆæ˜æ˜¾å°±æ˜¯äºŒåˆ†ç­”æ¡ˆï¼Œ**æœ€ä½çš„å¥åº·è¡€é‡**ï¼Œå¤§äºè¿™ä¸ªè¡€é‡çš„è‚¯å®šå¯ä»¥æ•‘å‡ºæ¥ï¼Œå°äºè¿™ä¸ªè¡€é‡çš„è‚¯å®šæ•‘ä¸å‡ºæ¥ï¼Œæ‰€ä»¥checkå°±æ˜¯åˆ¤æ–­åœ¨æŸä¸ªè¡€é‡ä¸‹ï¼Œèƒ½å¦æ‹¯æ•‘åˆ°å…¬ä¸»ï¼ˆDPï¼‰\n\næ—¶é—´å¤æ‚åº¦O(N^2logN)ï¼ˆå…¶å®æˆ‘è®¤ä¸ºä¹Ÿå¯ä»¥å½“ä½œN^2æ¯•ç«Ÿä¸Šä¸‹ç•Œéƒ½ç¡®å®šäº†ï¼ŒlogNä¹Ÿå°±30å·¦å³ï¼‰ï¼Œè¿™ç§è§£æ³•ä¹ŸæŒºä¸é”™çš„ï¼Œèåˆäº†äºŒåˆ†å’Œdp\n\n```java\npublic int calculateMinimumHP(int[][] dungeon) {\n    int left = 0;\n    int right = Integer.MAX_VALUE;\n    int res = 0;\n    while(left <= right){\n        int mid = left + (right-left)/2;\n        if(check(dungeon, mid)){\n            res = mid;\n            right = mid - 1;\n        }else{\n            left = mid + 1;\n        }\n    }\n    return res;\n}\n\npublic boolean check(int[][] dungeon, int live){\n    int m = dungeon.length;\n    int n = dungeon[0].length;\n    int INF = Integer.MIN_VALUE;\n    //liveçš„è¡€é‡ä»å·¦ä¸Šåˆ°dungeon[i][j]çš„å‰©ä½™æœ€å¤šè¡€é‡\n    int[][] dp = new int[m+1][n+1];\n    //åœ°ç‰¢å¤–å›´åŠ ä¸ŠINFçš„å›´å¢™ï¼Œç®€åŒ–é€»è¾‘\n    Arrays.fill(dp[0], INF);\n    dp[0][1] = live;\n    for(int i = 1; i <= m; i++){\n        dp[i][0] = INF;\n        for(int j = 1; j <= n; j++){\n            if(dp[i-1][j] <= 0 && dp[i][j-1] <=0 ){\n                dp[i][j] = INF; //æ— æ³•åˆ°è¾¾è¿™é‡Œ\n            }else{\n                dp[i][j] = dungeon[i-1][j-1] + Math.max(dp[i][j-1], dp[i-1][j]);\n            }\n        }\n    }\n    return dp[m][n] > 0;\n}\n```\nå½“ç„¶è¿™é¢˜ä¹Ÿæœ‰çº¯dpçš„åšæ³•ï¼Œå¾ˆå¯æƒœï¼Œæˆ‘å‹æ ¹æ²¡å¾€ä¸Šé¢æƒ³ï¼Œæˆ‘åªæƒ³ç€äºŒåˆ†dpï¼Œå†™å®Œäº†ACä¹‹åå°±å»çœ‹è¯„è®ºåŒºäº†ï¼Œç»“æœå‘ç°å¤§å®¶éƒ½æ˜¯ç›´æ¥dpçš„ã€‚ã€‚ã€‚ç„¶åè¿˜çœ‹åˆ°äº†ä¸€ä¸ªå…³é”®è¯ï¼šé€†å‘dpï¼Œç„¶åèµ¶ç´§å…³äº†è¯„è®ºåŒºå›æ¥å†™äº†ä¸‹é¢çš„dpè§£æ³•\n\n**è§£æ³•äºŒ**\n```java\n/*\n    -2  -3  3\n    -5 -10  1\n    10  30 -5 1\n            \n    7   5   2\n    6  11   5\n    1   1   6\n*/\npublic int calculateMinimumHP(int[][] dungeon) {\n    int m = dungeon.length;\n    int n = dungeon[0].length;\n    int INF = Integer.MAX_VALUE;\n    //ä»dungeon[i-1][j-1]åˆ°å³ä¸‹è§’è‡³å°‘è¦å¤šå°‘è¡€é‡\n    int[][] dp = new int[m+1][n+1];\n    Arrays.fill(dp[m], INF);//æœ«è¡Œ\n    dp[m][n-1] = 1; //åˆå§‹è¡€é‡\n    for (int i = m-1; i >= 0; i--) {\n        dp[i][n] = INF; //é¦–åˆ—å’Œå°¾åˆ—\n        for (int j = n-1; j >= 0; j--) {\n            dp[i][j] = Math.max(Math.min(dp[i+1][j], dp[i][j+1]) - dungeon[i][j], 1);\n        }\n    }\n    return dp[0][0];\n}\n```\nè¿™é¢˜ä¸ºå•¥ä¸èƒ½æ­£å‘dpå‘¢ï¼Œè®¾`dp[i][j]`ä¸ºä»å·¦ä¸Šè§’åˆ°i,jæ‰€éœ€è¦çš„æœ€ä½è¡€é‡? å…¶å®è¿™ä¸ªå¾ˆæ˜æ˜¾å°±æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ²¡åŠæ³•è½¬ç§»ï¼Œ`dp[i][j]`å’Œ`dp[i-1][j]`æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œéƒ½ä¸ä¸€å®šæ˜¯åŒä¸€æ¡è·¯å¾„\n\n## [97. äº¤é”™å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/interleaving-string/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™å®šä¸‰ä¸ªå­—ç¬¦ä¸²Â s1, s2, s3, éªŒè¯Â s3Â æ˜¯å¦æ˜¯ç”±Â s1Â å’ŒÂ s2 äº¤é”™ç»„æˆçš„ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: s1 = \"aabcc\", s2 = \"dbbca\", s3 = \"aadbbcbcac\"\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹Â 2:**\n\n```go\nè¾“å…¥: s1 = \"aabcc\", s2 = \"dbbca\", s3 = \"aadbbbaccc\"\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n![Ugzon0.png](https://s1.ax1x.com/2020/07/18/Ugzon0.png)\n```java\npublic boolean isInterleave(String s1, String s2, String s3) {\n    int ns1 = s1.length(), ns2 = s2.length(), ns3 = s3.length();\n    if(ns1+ns2!=ns3) return false;\n    boolean[][] dp = new boolean[ns1+1][ns2+1];\n    for(int i = 1; i <= ns1 && s1.charAt(i-1)==s3.charAt(i-1); i++){\n        dp[i][0] = true;\n    }\n    for(int i = 1; i <= ns2 && s2.charAt(i-1)==s3.charAt(i-1); i++){\n        dp[0][i] = true;\n    }\n    dp[0][0] = true;\n    for(int i = 1; i <= ns1; i++){\n        for(int j = 1; j <= ns2; j++){\n            char sc = s3.charAt(i+j-1);\n            dp[i][j] = (sc == s1.charAt(i-1) && dp[i-1][j]) \n                || sc == s2.charAt(j-1) && dp[i][j-1];\n        }\n    }\n    return dp[ns1][ns2];\n}\n```\n\n## [857. æœ€å°çš„çª—å£å­åºåˆ—ï¼ˆLintCodeï¼‰](https://www.lintcode.com/problem/minimum-window-subsequence/description)\n\n\nç»™å®šå­—ç¬¦ä¸²Så’ŒTï¼Œåœ¨å­—ç¬¦ä¸²Sä¸­æ‰¾åˆ°æœ€å°(è¿ç»­çš„)å­å­—ç¬¦ä¸²Wï¼ˆçª—å£ï¼‰ï¼Œä½¿å¾—Tæ˜¯Wçš„å­åºåˆ—ã€‚\nå¦‚æœSä¸­æ²¡æœ‰åŒ…å«Tä¸­çš„æ‰€æœ‰å­—ç¬¦çš„çª—å£ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²\"\"ã€‚å¦‚æœæœ‰å¤šä¸ªè¿™æ ·çš„æœ€å°é•¿åº¦çª—å£ï¼Œåˆ™è¿”å›ä¸€ä¸ªèµ·ç‚¹ç¼–å·æœ€å°çš„ã€‚\n1. è¾“å…¥ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯ã€‚\n2. Sçš„é•¿åº¦èŒƒå›´åœ¨[1, 20000]ã€‚\n3. Tçš„é•¿åº¦èŒƒå›´åœ¨[1, 100]ã€‚\n\n**æ ·ä¾‹ 1:**\n```go\nè¾“å…¥ï¼šS=\"jmeqksfrsdcmsiwvaovztaqenprpvnbstl\"ï¼ŒT=\"u\"\nè¾“å‡ºï¼š\"\"\nè§£é‡Šï¼š æ— æ³•åŒ¹é…\n```\n**æ ·ä¾‹ 2:**\n```go\nè¾“å…¥ï¼šS = \"abcdebdde\"ï¼Œ T = \"bde\"\nè¾“å‡ºï¼š\"bcde\"\nè§£é‡Šï¼š\"bcde\"æ˜¯ç­”æ¡ˆï¼Œ\"deb\"ä¸æ˜¯ä¸€ä¸ªè¾ƒå°çš„çª—å£ï¼Œå› ä¸ºçª—å£ä¸­çš„Tå…ƒç´ å¿…é¡»æŒ‰é¡ºåºå‘ç”Ÿã€‚\n```\n**è§£æ³•ä¸€**\n\nLeetCodeä¸Šæ˜¯ä¼šå‘˜é¢˜ï¼Œæ‰€ä»¥åœ¨LintCodeä¸Šå†™çš„ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯æ»‘çª—ï¼Œæƒ³äº†åŠå¤©ï¼Œä¹Ÿåªæœ‰æš´åŠ›çš„æ€è·¯ï¼Œçœ‹äº†ä¸‹è®¨è®ºåŒºï¼Œå‘ç°å¤§å®¶éƒ½æ˜¯dpåšçš„ã€‚ã€‚ã€‚\n\n```java\npublic String minWindow(String S, String T) {\n    int m = S.length(), n = T.length();\n    //Så‰iä¸ªå­—ç¬¦åŒ…å«Tå‰jä¸ªå­—ç¬¦çš„æœ€å°çª—å£å­åºåˆ—èµ·å§‹ä½ç½®\n    int[][] dp = new int[m+1][n+1];\n    for (int i = 0; i <= m; i++){\n        //è™½ç„¶Tä¸²ä¸ºç©ºï¼Œä½†æ˜¯æ³¨æ„è¿™é‡Œä¸æ˜¯0ï¼Œå› ä¸ºéœ€è¦æœ€çŸ­ï¼Œæ‰€ä»¥èµ·ç‚¹è¶Šé åè¶ŠçŸ­\n        //æœ€åçš„é•¿åº¦å°±æ˜¯é€šè¿‡ i-dp[i][j]æ¥è®¡ç®—çš„\n        Arrays.fill(dp[i], -1);\n        dp[i][0] = i;\n    }\n    int start = -1, end = m;\n    for (int i = 1; i <= m; i++) {\n        //æ³¨æ„Tçš„é•¿åº¦å°äºSçš„é•¿åº¦(ä¸è€ƒè™‘ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯ä¼šå¤šéå†å¾ˆå¤šæ¬¡)\n        for (int j = 1; j <= Math.min(n, i); j++){\n            if (S.charAt(i-1) == T.charAt(j-1)) {\n                dp[i][j] = dp[i-1][j-1];\n            }else{\n                //dbd\n                //  b   dbdå’ŒdbåŒ…å«bçš„æœ€å°çª—å£èµ·å§‹ä½ç½®ä¸€æ ·\n                dp[i][j] = dp[i-1][j];\n            }\n            \n        }\n        if (dp[i][n]!=-1 && i-dp[i][n] < end-start+1) {\n            start = dp[i][n];\n            end = i-1;\n        }\n    }\n    return start==-1 ? \"\" : S.substring(start,end+1);\n}\n```\nè¿™é¢˜å’Œæ»‘åŠ¨çª—å£ä¸“é¢˜ä¸­çš„ [æœ€å°è¦†ç›–å­ä¸²](http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou/#76-%E6%9C%80%E5%B0%8F%E8%A6%86%E7%9B%96%E5%AD%90%E4%B8%B2)\nç®—æ˜¯ä¸€é“å§Šå¦¹é¢˜ï¼Œä½†æ˜¯è§£æ³•ç¡®å®Œå…¨ä¸ä¸€æ ·ï¼Œå½“ç„¶è¿™é¢˜ä¹Ÿå¯ä»¥æ»‘çª—ä½†æ˜¯å¹¶ä¸æ˜¯å¾ˆé€šç”¨ï¼ˆä¸»è¦æ˜¯æˆ‘æ²¡çœ‹æ‡‚ï¼‰è²Œä¼¼ä¼šæ¯”dpè¦å¥½\n>åŒåºåˆ—å‹DPï¼Œåé¢æœ‰æ—¶é—´ä¼šæŠŠç±»ä¼¼çš„é¢˜å•ç‹¬æŠ½å–å‡ºæ¥\n\n## [1553. åƒæ‰ N ä¸ªæ©˜å­çš„æœ€å°‘å¤©æ•°](https://leetcode-cn.com/problems/minimum-number-of-days-to-eat-n-oranges/)\n\nDifficulty: **å›°éš¾**\n\nå¨æˆ¿é‡Œæ€»å…±æœ‰ `n`Â ä¸ªæ©˜å­ï¼Œä½ å†³å®šæ¯ä¸€å¤©é€‰æ‹©å¦‚ä¸‹æ–¹å¼ä¹‹ä¸€åƒè¿™äº›æ©˜å­ï¼š\n\n*   åƒæ‰ä¸€ä¸ªæ©˜å­ã€‚\n*   å¦‚æœå‰©ä½™æ©˜å­æ•° `n`Â èƒ½è¢« 2 æ•´é™¤ï¼Œé‚£ä¹ˆä½ å¯ä»¥åƒæ‰ `n/2` ä¸ªæ©˜å­ã€‚\n*   å¦‚æœå‰©ä½™æ©˜å­æ•°Â `n`Â èƒ½è¢« 3 æ•´é™¤ï¼Œé‚£ä¹ˆä½ å¯ä»¥åƒæ‰ `2*(n/3)` ä¸ªæ©˜å­ã€‚\n\næ¯å¤©ä½ åªèƒ½ä»ä»¥ä¸Š 3 ç§æ–¹æ¡ˆä¸­é€‰æ‹©ä¸€ç§æ–¹æ¡ˆã€‚\n\nè¯·ä½ è¿”å›åƒæ‰æ‰€æœ‰ `n`Â ä¸ªæ©˜å­çš„æœ€å°‘å¤©æ•°ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```golang\nè¾“å…¥ï¼šn = 10\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šä½ æ€»å…±æœ‰ 10 ä¸ªæ©˜å­ã€‚\nç¬¬ 1 å¤©ï¼šåƒ 1 ä¸ªæ©˜å­ï¼Œå‰©ä½™æ©˜å­æ•° 10 - 1 = 9ã€‚\nç¬¬ 2 å¤©ï¼šåƒ 6 ä¸ªæ©˜å­ï¼Œå‰©ä½™æ©˜å­æ•° 9 - 2*(9/3) = 9 - 6 = 3ã€‚ï¼ˆ9 å¯ä»¥è¢« 3 æ•´é™¤ï¼‰\nç¬¬ 3 å¤©ï¼šåƒ 2 ä¸ªæ©˜å­ï¼Œå‰©ä½™æ©˜å­æ•° 3 - 2*(3/3) = 3 - 2 = 1ã€‚\nç¬¬ 4 å¤©ï¼šåƒæ‰æœ€å 1 ä¸ªæ©˜å­ï¼Œå‰©ä½™æ©˜å­æ•° 1 - 1 = 0ã€‚\nä½ éœ€è¦è‡³å°‘ 4 å¤©åƒæ‰ 10 ä¸ªæ©˜å­ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```golang\nè¾“å…¥ï¼šn = 6\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šä½ æ€»å…±æœ‰ 6 ä¸ªæ©˜å­ã€‚\nç¬¬ 1 å¤©ï¼šåƒ 3 ä¸ªæ©˜å­ï¼Œå‰©ä½™æ©˜å­æ•° 6 - 6/2 = 6 - 3 = 3ã€‚ï¼ˆ6 å¯ä»¥è¢« 2 æ•´é™¤ï¼‰\nç¬¬ 2 å¤©ï¼šåƒ 2 ä¸ªæ©˜å­ï¼Œå‰©ä½™æ©˜å­æ•° 3 - 2*(3/3) = 3 - 2 = 1ã€‚ï¼ˆ3 å¯ä»¥è¢« 3 æ•´é™¤ï¼‰\nç¬¬ 3 å¤©ï¼šåƒæ‰å‰©ä½™ 1 ä¸ªæ©˜å­ï¼Œå‰©ä½™æ©˜å­æ•° 1 - 1 = 0ã€‚\nä½ è‡³å°‘éœ€è¦ 3 å¤©åƒæ‰ 6 ä¸ªæ©˜å­ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```golang\nè¾“å…¥ï¼šn = 1\nè¾“å‡ºï¼š1\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```golang\nè¾“å…¥ï¼šn = 56\nè¾“å‡ºï¼š6\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= n <= 2*10^9`\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®å¾ˆç®€å•ï¼Œæš´åŠ›çš„æ–¹æ³•éå¸¸å®¹æ˜“æƒ³åˆ°ï¼Œä½†æ˜¯é—®é¢˜æ˜¯è¿™é¢˜çš„æ•°æ®èŒƒå›´æ¯”è¾ƒå¤§`2*1e9`ï¼Œç›´æ¥æš´æœè‚¯å®šä¼šTï¼Œæ‰€ä»¥éœ€è¦ä¼˜åŒ–ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†`minDays(n-1)`ä¼˜åŒ–æ‰ï¼Œå°†è¿™ç§åªåƒä¸€ä¸ªçš„æƒ…å†µå’Œå…¶ä»–æƒ…å†µå’Œå¹¶ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨n=5ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ±‚`Min(minDays(2)+1, minDays(1)+2)`ï¼Œ5æ²¡æ³•è¢«2æˆ–è€…3æ•´é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†5åƒæ‰å‡ ä¸ªï¼Œå˜æˆå¯ä»¥è¢«2å’Œ3æ•´é™¤çš„ï¼Œåƒæ‰çš„ä¸ªæ•°å°±æ˜¯n%2å’Œn%3ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ä¹‹å‰é¢å¤–éœ€è¦çš„å¤©æ•°\n```golang\nvar dp = make(map[int]int)\nâ€‹\nfunc minDays(n int) int {\n Â  Â if n == 1 || n == 0 {\n Â  Â  Â  Â return n\n Â   }\n Â  Â if v, ok := dp[n]; ok {\n Â  Â  Â  Â return v\n Â   }\n Â  Â res := 1+Min(minDays(n/2)+n%2, minDays(n/3)+n%3)\n Â  Â dp[n] = res\n Â  Â return res\n}\nâ€‹\nfunc Min (a, b int) int {\n Â  Â if a < b {\n Â  Â  Â  Â return a\n Â   }\n Â  Â return b\n}\n```\n---\n\n## [NC549.å˜å‘](https://www.nowcoder.com/practice/85efab854e60499daa524ca943b72d35)\n\nç‰›ç‰›å‡†å¤‡åœ¨ä¸€ä¸ª3è¡Œnåˆ—çš„è·‘é“ä¸Šè·‘æ­¥ã€‚ä¸€å¼€å§‹ç‰›ç‰›å¯ä»¥è‡ªå·±é€‰æ‹©ä½äº(1,1)è¿˜æ˜¯(2,1)è¿˜æ˜¯(3,1)ã€‚\n\nè·‘é“çš„æ¯ä¸€æ ¼éƒ½æœ‰ä¸€äº›é‡‘å¸ï¼Œå½“ç‰›ç‰›è·‘åˆ°ä¸€ä¸ªæ ¼å­ï¼Œä»–ä¼šè·å¾—è¿™ä¸ªæ ¼å­çš„æ‰€æœ‰é‡‘å¸ã€‚\n\nå½“ç‰›ç‰›ä½äºç¬¬iè¡Œç¬¬jåˆ—æ—¶ï¼Œä»–å¯ä»¥çš„ä¸‹ä¸€æ­¥æœ€å¤šå¯èƒ½æœ‰ä¸‰ç§é€‰æ‹©ï¼š\n\n1. ä¸èŠ±è´¹é‡‘å¸è·‘åˆ°ç¬¬iè¡Œç¬¬j+1åˆ—\n2. èŠ±è´¹`m[j]`çš„é‡‘å¸è·‘åˆ°ç¬¬i-1è¡Œç¬¬j+1åˆ—ï¼ˆå¦‚æœi=1åˆ™ä¸å¯ä»¥è¿™ä¹ˆè·‘ï¼‰ã€‚\n3. èŠ±è´¹`m[j]`çš„é‡‘å¸è·‘åˆ°ç¬¬i+1è¡Œç¬¬j+1åˆ—ï¼ˆå¦‚æœi=3åˆ™ä¸å¯ä»¥è¿™ä¹ˆè·‘ï¼‰ã€‚\nï¼ˆç‰›ç‰›æ˜¯ä¸€ä¸ªå¯Œè±ªï¼Œæœ¬èº«å¸¦äº†å¾ˆå¤šçš„é‡‘å¸ï¼Œæ‰€ä»¥ä½ ä¸ç”¨æ‹…å¿ƒä»–é’±ä¸å¤Ÿç”¨ï¼‰\nç°åœ¨å‘Šè¯‰ä½ æ‰€æœ‰æ ¼å­çš„é‡‘å¸æ•°é‡å’Œæ¯ä¸€åˆ—çš„é‡‘å¸èŠ±è´¹ï¼Œç‰›ç‰›æƒ³çŸ¥é“ä»–è·‘åˆ°ç¬¬nåˆ—æœ€å¤šå¯ä»¥èµšå¾—å¤šå°‘é‡‘å¸ï¼ˆèµšå¾—é‡‘å¸=è·å¾—é‡‘å¸-æ¶ˆè€—é‡‘å¸ï¼‰\n\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥ï¼š3,[1,9,3],[6,4,6],[1,1,5],[3,2,1]\nè¾“å‡º: 16\nè¯´æ˜: ä¸€å¼€å§‹ç‰›ç‰›é€‰æ‹©ä½äºç¬¬2è¡Œç¬¬1åˆ—ï¼Œæ‹¿åˆ°6ä¸ªé‡‘å¸ã€‚ç„¶åç‰›ç‰›èŠ±3é‡‘å¸åˆ°ç¬¬1è¡Œçš„2åˆ—æ‹¿åˆ°9ä¸ªé‡‘å¸ï¼Œæœ€åç‰›ç‰›èŠ±è´¹2é‡‘å¸åˆ°ç¬¬2è¡Œç¬¬3åˆ—ã€‚æ€»å…±è·å¾—21é‡‘å¸ï¼Œæ¶ˆè€—5é‡‘å¸ã€‚èµšå¾—16é‡‘å¸ã€‚\n```\n**å¤‡æ³¨:**\n\n- 2 <= n <= 1e5\n\n- ç¬¬1ä¸ªå‚æ•°nä»£è¡¨è·‘é“çš„åˆ—æ•°\nç¬¬2ï¼Œ3ï¼Œ4ä¸ªå‚æ•°vector<int> a1,a2,a3å„æœ‰nä¸ªå…ƒç´ ï¼Œä»£è¡¨ç¬¬1ï¼Œ2ï¼Œ3è¡Œæ¯ä¸€åˆ—çš„é‡‘å¸ä¸ªæ•°\nç¬¬5ä¸ªå‚æ•°vector<int> mæœ‰nä¸ªå…ƒç´ ä»£è¡¨æ¯ä¸€åˆ—è¿›è¡Œæ¢è¡Œçš„æ—¶å€™éœ€è¦çš„é‡‘å¸èŠ±è´¹\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®æ„æ€ææ¸…æ¥šå°±è¡Œäº†\n```java\n//å¾ˆç›´ç™½çš„dp\npublic int solve (int n, int[] a1, int[] a2, int[] a3, int[] m) {\n    // write code here\n    int[][] dp = new int[3][n];\n    dp[0][0] = a1[0];\n    dp[1][0] = a2[0];\n    dp[2][0] = a3[0];\n    for (int j = 1; j < n; j++) {\n        dp[0][j] = a1[j] + Math.max(dp[0][j-1], dp[1][j-1]-m[j-1]);\n        dp[1][j] = a2[j] + Math.max(dp[1][j-1], Math.max(dp[0][j-1]-m[j-1], dp[2][j-1]-m[j-1]));\n        dp[2][j] = a3[j] + Math.max(dp[2][j-1], dp[1][j-1]-m[j-1]);\n    }\n    return Math.max(dp[0][n-1],Math.max(dp[1][n-1], dp[2][n-1]));\n}\n```\n## [NC554 ç®€å•å˜å‘](https://www.nowcoder.com/practice/11f7c6cb54524c3693119e4088533305)\nç‰›ç‰›å‡†å¤‡åœ¨ä¸€ä¸ª3è¡Œnåˆ—çš„è·‘é“ä¸Šè·‘æ­¥ã€‚ä¸€å¼€å§‹ç‰›ç‰›ä½äº(1,1)ã€‚\n\nå½“ç‰›ç‰›ä½äºç¬¬iè¡Œç¬¬jåˆ—æ—¶ï¼Œä»–å¯ä»¥çš„ä¸‹ä¸€æ­¥æœ€å¤šå¯èƒ½æœ‰ä¸‰ç§é€‰æ‹©ï¼š\n\n1. è·‘åˆ°ç¬¬iè¡Œç¬¬j+1åˆ—\n2. è·‘åˆ°ç¬¬i-1è¡Œç¬¬j+1åˆ—ï¼ˆå¦‚æœi=1åˆ™ä¸å¯ä»¥è¿™ä¹ˆè·‘ï¼‰ã€‚\n3. è·‘åˆ°ç¬¬i+1è¡Œç¬¬j+1åˆ—ï¼ˆå¦‚æœi=3åˆ™ä¸å¯ä»¥è¿™ä¹ˆè·‘ï¼‰ã€‚\n\nè·‘é“ä¸Šæœ‰ä¸€äº›æ ¼å­è®¾ç½®äº†è·¯éšœ(ä¸€ä¸ªæ ¼å­å¯èƒ½æœ‰å¤šä¸ªè·¯éšœ)ï¼Œç‰›ç‰›ä¸èƒ½è·‘åˆ°è·¯éšœä¸Šã€‚ç°åœ¨ç‰›ç‰›æƒ³çŸ¥é“ï¼Œä»(1,1)åˆ°(3,n)æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ\n\nä¸ºäº†é˜²æ­¢ç­”æ¡ˆè¿‡å¤§ï¼Œç­”æ¡ˆå¯¹1e9+7å–æ¨¡ã€‚\n\næ¯”è¾ƒç®€å•å°±ä¸è´´caseäº†\n\n**è§£æ³•ä¸€**\n\næ³¨æ„æº¢å‡ºå°±è¡Œäº†\n```java\npublic int solve (int n, int m, int[] x, int[] y) {\n    long[][] dp = new long[3][n+1];\n    int MOD = (int)1e9+7;\n    boolean[][] v = new boolean[3][n];\n    for(int i = 0; i < m; i++){\n        v[x[i]-1][y[i]-1] = true;\n    }\n    dp[0][0] = 1;\n    for (int j = 1; j < n; j++) {\n        dp[0][j] = v[0][j] ? 0 : (dp[0][j-1] + dp[1][j-1])%MOD;\n        dp[1][j] = v[1][j] ? 0 : (dp[1][j-1] + dp[0][j-1]+dp[2][j-1])%MOD;\n        dp[2][j] = v[2][j] ? 0 : (dp[2][j-1] + dp[1][j-1])%MOD;\n    }\n    return  (int)(dp[2][n-1]%MOD);\n}\n```\n## [787. K ç«™ä¸­è½¬å†…æœ€ä¾¿å®œçš„èˆªç­](https://leetcode-cn.com/problems/cheapest-flights-within-k-stops/)\n\nDifficulty: **ä¸­ç­‰**\n\n\næœ‰ `n` ä¸ªåŸå¸‚é€šè¿‡ `m` ä¸ªèˆªç­è¿æ¥ã€‚æ¯ä¸ªèˆªç­éƒ½ä»åŸå¸‚ `u` å¼€å§‹ï¼Œä»¥ä»·æ ¼ `w` æŠµè¾¾ `v`ã€‚\n\nç°åœ¨ç»™å®šæ‰€æœ‰çš„åŸå¸‚å’Œèˆªç­ï¼Œä»¥åŠå‡ºå‘åŸå¸‚ `src` å’Œç›®çš„åœ° `dst`ï¼Œä½ çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°ä» `src` åˆ° `dst` æœ€å¤šç»è¿‡ `k`Â ç«™ä¸­è½¬çš„æœ€ä¾¿å®œçš„ä»·æ ¼ã€‚ å¦‚æœæ²¡æœ‰è¿™æ ·çš„è·¯çº¿ï¼Œåˆ™è¾“å‡º `-1`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥: \nn = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]\nsrc = 0, dst = 2, k = 1\nè¾“å‡º: 200\nè§£é‡Š: \nåŸå¸‚èˆªç­å›¾å¦‚ä¸‹\n\nä»åŸå¸‚ 0 åˆ°åŸå¸‚ 2 åœ¨ 1 ç«™ä¸­è½¬ä»¥å†…çš„æœ€ä¾¿å®œä»·æ ¼æ˜¯ 200ï¼Œå¦‚å›¾ä¸­çº¢è‰²æ‰€ç¤ºã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥: \nn = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]\nsrc = 0, dst = 2, k = 0\nè¾“å‡º: 500\nè§£é‡Š: \nåŸå¸‚èˆªç­å›¾å¦‚ä¸‹\n\nä»åŸå¸‚ 0 åˆ°åŸå¸‚ 2 åœ¨ 0 ç«™ä¸­è½¬ä»¥å†…çš„æœ€ä¾¿å®œä»·æ ¼æ˜¯ 500ï¼Œå¦‚å›¾ä¸­è“è‰²æ‰€ç¤ºã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `n` èŒƒå›´æ˜¯ `[1, 100]`ï¼ŒåŸå¸‚æ ‡ç­¾ä» `0` åˆ° `n` `- 1`.\n*   èˆªç­æ•°é‡èŒƒå›´æ˜¯ `[0, n * (n - 1) / 2]`.\n*   æ¯ä¸ªèˆªç­çš„æ ¼å¼ `(src,` `dst``, price)`.\n*   æ¯ä¸ªèˆªç­çš„ä»·æ ¼èŒƒå›´æ˜¯ `[1, 10000]`.\n*   `k` èŒƒå›´æ˜¯ `[0, n - 1]`.\n*   èˆªç­æ²¡æœ‰é‡å¤ï¼Œä¸”ä¸å­˜åœ¨ç¯è·¯\n\n\n**è§£æ³•ä¸€**\n\nèŒƒå›´å¾ˆå°åªæœ‰100ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯Floydï¼Œä½†æ˜¯æœ‰Kçš„é™åˆ¶ä¸å¥½å¤„ç†\n```golang\nfunc findCheapestPrice(n int, flights [][]int, src int, dst int, K int) int {\n Â  Â //dp[i][k]ï¼šä»srcåˆ°ièŠ‚ç‚¹ä¸­è½¬kæ¬¡æœ€çŸ­è·ç¦»\n Â  Â var Min = func(a, b int) int {if a<b {return a};return b}\n Â  Â var INF = 0x3f3f3f3f\n Â  Â var dp = make([][]int, n)\n Â  Â for i := 0; i < n; i++ {\n Â  Â  Â  Â //K+2æ˜¯ä¸ºäº†æ–¹ä¾¿åˆå§‹åŒ–ï¼Œä¸ç”¨å•ç‹¬å¤„ç†K==0çš„æƒ…å†µ\n Â  Â  Â  Â dp[i] = make([]int, K+2)\n Â  Â  Â  Â for j := 0; j <= K+1; j++ {\n Â  Â  Â  Â  Â  Â dp[i][j] = INF Â  \n Â  Â  Â   }\n Â   }\n Â  Â for k := 0; k <= K+1; k++ {\n Â  Â  Â  Â dp[src][k] = 0\n Â   }\n Â  Â for k := 1; k <= K+1; k++ {\n Â  Â  Â  Â for _,flt := range flights {\n Â  Â  Â  Â  Â  Â //srcåˆ°flt[1]é€šè¿‡flt[0]ä¸­è½¬\n Â  Â  Â  Â  Â  Â dp[flt[1]][k] = Min(dp[flt[1]][k], dp[flt[0]][k-1]+flt[2])\n Â  Â  Â   }\n Â   }\n Â  Â if dp[dst][K+1] == INF {\n Â  Â  Â  Â return -1\n Â   }\n Â  Â return dp[dst][K+1]\n}\n```\n> è¿™é¢˜ä¹Ÿå¯ä»¥`Dijkstra`ä½†æ˜¯æˆ‘ä¸ä¼š\n\n## [NC557.å¥½å¤šç‰›ç‰›](https://www.nowcoder.com/practice/edced5e80f3e46efa9c965e7f634c58c)\n\nç»™å‡ºä¸€ä¸ªå­—ç¬¦ä¸²Sï¼Œç‰›ç‰›æƒ³çŸ¥é“è¿™ä¸ªå­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªå­åºåˆ—ç­‰äº\"niuniu\"å­åºåˆ—å¯ä»¥é€šè¿‡åœ¨åŸä¸²ä¸Šåˆ é™¤ä»»æ„ä¸ªå­—ç¬¦(åŒ…æ‹¬0ä¸ªå­—ç¬¦å’Œå…¨éƒ¨å­—ç¬¦)å¾—åˆ°ã€‚ä¸ºäº†é˜²æ­¢ç­”æ¡ˆè¿‡å¤§ï¼Œç­”æ¡ˆå¯¹1e9+7å–æ¨¡\n\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥: \"niuniniu\"\nè¾“å‡º: 3\nè¯´æ˜:\nåˆ é™¤ç¬¬4ï¼Œ5ä¸ªå­—ç¬¦å¯ä»¥å¾—åˆ°\"niuniu\"\nåˆ é™¤ç¬¬5ï¼Œ6ä¸ªå­—ç¬¦å¯ä»¥å¾—åˆ°\"niuniu\"\nåˆ é™¤ç¬¬6ï¼Œ7ä¸ªå­—ç¬¦å¯ä»¥å¾—åˆ°\"niuniu\"\n```\n**å¤‡æ³¨:**\n10 <= len(s) <= 1e5\n\n**è§£æ³•ä¸€**\n\nèœå•Šï¼Œæ²¡æƒ³å‡ºæ¥ï¼ŒçœŸçš„èœ\n```java\n//UPDATE: 2020.9.27ï¼Œä¹‹å‰çš„è§£æ³•è¿‡äº†OJï¼Œä½†æ˜¯å…¶å®æ˜¯æœ‰é—®é¢˜çš„\n//äºŒç»´DPï¼ˆä¸æ–¹ä¾¿ä¼˜åŒ–æˆä¸€ç»´çš„ï¼‰\npublic int solve1 (String s) {\n    // write code here \n    String p = \"niuniu\";\n    int m = p.length();\n    int n = s.length();\n    int MOD = (int)1e9+7;\n    //dp[i][j]ä»£è¡¨s[0,j]ä¸­æœ‰å¤šå°‘ä¸ªp[0,j]\n    long[][] dp = new long[7][n+1];\n    Arrays.fill(dp[0], 1);\n    for (int i = 1; i <= m; i++){\n        for (int j = 1; j <= n; j++){\n            if (s.charAt(j-1) == p.charAt(i-1)) {\n                //dp[i][j] = (dp[i-1][j] + dp[i][j-1]) % MOD;\n                //ä¸Šé¢çš„æ˜¯é”™çš„ï¼Œä¹‹æ‰€ä»¥æ­£ç¡®æ˜¯å› ä¸ºé¢˜ç›®çš„niuniuæ²¡æœ‰è¿ç»­çš„ç›¸åŒå­—ç¬¦\n                //è€ƒè™‘å¦‚ä¸‹case:  p = \"aa\" , s = \"abaa\" wa = 6, ac = 3\n                dp[i][j] = (dp[i-1][j-1] + dp[i][j-1]) % MOD;\n            } else {\n                dp[i][j] = dp[i][j-1];\n            }\n        }\n    }\n    return (int)dp[m][n];\n}\n```\nå®é™…ä¸Šè¿™ä¸ªè§£æ³•æœ€å¥½æŠŠå†…å¤–å¾ªç¯äº¤æ¢ä¸‹ï¼Œè¿™æ ·æ›´å¥½é™ç»´\n```java\n//äºŒç»´DPï¼Œäº¤æ¢å†…å¤–å¾ªç¯\npublic int solve2 (String s) {\n    // write code here \n    String p = \"niuniu\";\n    int n = s.length();\n    int m = p.length();\n    int MOD = (int)1e9+7;\n    //dp[i][j]ä»£è¡¨s[0,i]ä¸­æœ‰å¤šå°‘ä¸ªp[0,j]\n    long[][] dp = new long[n+1][m+1];\n    dp[0][0] = 1;\n    for (int i = 1; i <= n; i++){\n        dp[i][0] = 1;\n        for (int j = 1; j <= m; j++){\n            if (s.charAt(i-1) == p.charAt(j-1)) {\n                dp[i][j] = (dp[i-1][j-1] + dp[i-1][j]) % MOD;\n            } else {\n                dp[i][j] = dp[i-1][j];\n            }\n        }\n    }\n    return (int)dp[n][m];\n}\n```\n**è§£æ³•äºŒ**\n\næŒ‰ç…§ä¸Šé¢äº¤æ¢å†…å¤–å¾ªç¯åçš„è§£æ³•å†é™ç»´\n```java\n//UPDATE: 2020.9.27ï¼Œä¹‹å‰çš„è§£æ³•è¿‡äº†OJï¼Œä½†æ˜¯å…¶å®æ˜¯æœ‰é—®é¢˜çš„\n//æŒ‰ä¸Šé¢çš„æ¥é™ç»´èˆ’æœå¤šäº†\npublic int solve3 (String s) {\n    String p = \"niuniu\";\n    int n = s.length();\n    int m = p.length();\n    int MOD = (int)1e9+7;\n    //dp[j]ä»£è¡¨s[0,i]ä¸­æœ‰å¤šå°‘ä¸ªp[0,i]\n    long[] dp = new long[m+1];\n    dp[0] = 1;\n    for (int i = 1; i <= n; i++){\n        //for (int j = 1; j <= m; j++){\n        //å†…å±‚åº”è¯¥åè¿‡æ¥é€’æ¨ï¼Œä¿è¯dp[j]å’Œdp[j-1]æ˜¯ä¸Šä¸€æ¬¡çš„\n        for (int j = m; j >= 1; j--){\n            if (s.charAt(i-1) == p.charAt(j-1)) {\n                dp[j] = (dp[j] + dp[j-1]) % MOD;\n            }\n        }\n    }\n    return (int)dp[m];\n}\n```\n\n## [926. å°†å­—ç¬¦ä¸²ç¿»è½¬åˆ°å•è°ƒé€’å¢](https://leetcode-cn.com/problems/flip-string-to-monotone-increasing/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nå¦‚æœä¸€ä¸ªç”±Â `'0'` å’Œ `'1'`Â ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œæ˜¯ä»¥ä¸€äº› `'0'`ï¼ˆå¯èƒ½æ²¡æœ‰ `'0'`ï¼‰åé¢è·Ÿç€ä¸€äº› `'1'`ï¼ˆä¹Ÿå¯èƒ½æ²¡æœ‰ `'1'`ï¼‰çš„å½¢å¼ç»„æˆçš„ï¼Œé‚£ä¹ˆè¯¥å­—ç¬¦ä¸²æ˜¯_å•è°ƒé€’å¢_çš„ã€‚\n\næˆ‘ä»¬ç»™å‡ºä¸€ä¸ªç”±å­—ç¬¦ `'0'` å’Œ `'1'`Â ç»„æˆçš„å­—ç¬¦ä¸²Â `S`ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»ä½•Â `'0'` ç¿»è½¬ä¸ºÂ `'1'`Â æˆ–è€…å°†Â `'1'`Â ç¿»è½¬ä¸ºÂ `'0'`ã€‚\n\nè¿”å›ä½¿ `S` å•è°ƒé€’å¢çš„æœ€å°ç¿»è½¬æ¬¡æ•°ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š\"00110\"\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šæˆ‘ä»¬ç¿»è½¬æœ€åä¸€ä½å¾—åˆ° 00111.\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š\"010110\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šæˆ‘ä»¬ç¿»è½¬å¾—åˆ° 011111ï¼Œæˆ–è€…æ˜¯ 000111ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼š\"00011000\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šæˆ‘ä»¬ç¿»è½¬å¾—åˆ° 00000000ã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  `1 <= S.length <= 20000`\n2.  `S` ä¸­åªåŒ…å«å­—ç¬¦Â `'0'`Â å’ŒÂ `'1'`\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’çš„è§£æ³•\n\n```golang\nfunc minFlipsMonoIncr(S string) int {\n Â  Â var n = len(S)\n Â  Â //dp[i][0]: [0~i] s[i]==0 éœ€è¦æœ€å°é¢ç¿»è½¬æ¬¡æ•°\n Â  Â //dp[i][1]: [0~i] s[i]==1 éœ€è¦æœ€å°é¢ç¿»è½¬æ¬¡æ•°\n Â  Â var dp = make([][2]int, n)\n Â  Â var Min = func(a, b int) int {if a < b {return a}; return b}\n Â  Â var preSum = make([]int, n+1)\n Â  Â for i := 1; i <= n; i++ { \n Â  Â  Â  Â preSum[i] = preSum[i-1] + int(S[i-1]-48)\n Â   }\n Â  Â if S[0] == '1' {\n Â  Â  Â  Â dp[0][0] = 1\n Â   }else {\n Â  Â  Â  Â dp[0][1] = 1\n Â   }\n Â  Â for i := 1; i < n; i++ {\n Â  Â  Â  Â if S[i] == '1' {\n Â  Â  Â  Â  Â  Â dp[i][1] = Min(dp[i-1][1], dp[i-1][0])\n Â  Â  Â  Â  Â  Â dp[i][0] = preSum[i+1] //åŒ…å«i\n Â  Â  Â   } else {\n Â  Â  Â  Â  Â  Â dp[i][0] = preSum[i] //ä¸åŒ…å«i\n Â  Â  Â  Â  Â  Â dp[i][1] = Min(dp[i-1][0], dp[i-1][1]) + 1\n Â  Â  Â   }\n Â   }\n Â  Â return Min(dp[n-1][1], dp[n-1][0])\n}\n```\n\n**è§£æ³•äºŒ**\n\nå¯»æ‰¾åˆ†å‰²ç‚¹ï¼Œä½¿å¾—åˆ†å‰²ç‚¹å·¦è¾¹çš„1å’Œå³è¾¹çš„0ç›¸åŠ çš„å’Œæœ€å°‘\n\n```golang\n//Trickï¼Œå¯»æ‰¾åˆ†å‰²ç‚¹ï¼Œä½¿å¾—åˆ†å‰²ç‚¹å·¦è¾¹çš„1å’Œå³è¾¹çš„0ç›¸åŠ çš„å’Œæœ€å°‘\nfunc minFlipsMonoIncr(S string) int {\n    var count0 = 0 //åˆ†å‰²ç‚¹å³è¾¹çš„0\n    var count1 = 0 //åˆ†å‰²ç‚¹å·¦è¾¹çš„1\n    var Min = func(a, b int) int {if a < b {return a}; return b}\n    for i := 0; i < len(S); i++ {\n        if S[i] == '0' {\n            count0++\n        }\n    }\n    var res = count0\n    for i := 0; i < len(S); i++ {\n        if S[i] == '1' {\n            count1++\n        } else {\n            count0--\n        }\n        res = Min(res, count1+count0)\n    }\n    return res\n}\n```\n\n## [LCP 19. ç§‹å¶æ”¶è—é›†](https://leetcode-cn.com/problems/UlBDOe/)\n\nå°æ‰£å‡ºå»ç§‹æ¸¸ï¼Œé€”ä¸­æ”¶é›†äº†ä¸€äº›çº¢å¶å’Œé»„å¶ï¼Œä»–åˆ©ç”¨è¿™äº›å¶å­åˆæ­¥æ•´ç†äº†ä¸€ä»½ç§‹å¶æ”¶è—é›† leavesï¼Œ å­—ç¬¦ä¸² leaves ä»…åŒ…å«å°å†™å­—ç¬¦ r å’Œ yï¼Œ å…¶ä¸­å­—ç¬¦ r è¡¨ç¤ºä¸€ç‰‡çº¢å¶ï¼Œå­—ç¬¦ y è¡¨ç¤ºä¸€ç‰‡é»„å¶ã€‚\nå‡ºäºç¾è§‚æ•´é½çš„è€ƒè™‘ï¼Œå°æ‰£æƒ³è¦å°†æ”¶è—é›†ä¸­æ ‘å¶çš„æ’åˆ—è°ƒæ•´æˆã€Œçº¢ã€é»„ã€çº¢ã€ä¸‰éƒ¨åˆ†ã€‚æ¯éƒ¨åˆ†æ ‘å¶æ•°é‡å¯ä»¥ä¸ç›¸ç­‰ï¼Œä½†å‡éœ€å¤§äºç­‰äº 1ã€‚æ¯æ¬¡è°ƒæ•´æ“ä½œï¼Œå°æ‰£å¯ä»¥å°†ä¸€ç‰‡çº¢å¶æ›¿æ¢æˆé»„å¶æˆ–è€…å°†ä¸€ç‰‡é»„å¶æ›¿æ¢æˆçº¢å¶ã€‚è¯·é—®å°æ‰£æœ€å°‘éœ€è¦å¤šå°‘æ¬¡è°ƒæ•´æ“ä½œæ‰èƒ½å°†ç§‹å¶æ”¶è—é›†è°ƒæ•´å®Œæ¯•ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n```go\nè¾“å…¥ï¼šleaves = \"rrryyyrryyyrr\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šè°ƒæ•´ä¸¤æ¬¡ï¼Œå°†ä¸­é—´çš„ä¸¤ç‰‡çº¢å¶æ›¿æ¢æˆé»„å¶ï¼Œå¾—åˆ° \"rrryyyyyyyyrr\"\n```\n**ç¤ºä¾‹ 2ï¼š**\n```go\nè¾“å…¥ï¼šleaves = \"ryr\"\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šå·²ç¬¦åˆè¦æ±‚ï¼Œä¸éœ€è¦é¢å¤–æ“ä½œ\næç¤ºï¼š\n3 <= leaves.length <= 10^5\nleaves ä¸­åªåŒ…å«å­—ç¬¦ 'r' å’Œå­—ç¬¦ 'y'\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šä¸€é¢˜[926. å°†å­—ç¬¦ä¸²ç¿»è½¬åˆ°å•è°ƒé€’å¢](#926-å°†å­—ç¬¦ä¸²ç¿»è½¬åˆ°å•è°ƒé€’å¢)ä¸€æ ·ï¼Œä¸è¿‡å¾ˆæ˜æ˜¾è¿™é‡Œæœ‰ä¸‰ä¸ªçŠ¶æ€ï¼Œä¸€ä¸ªæ˜¯å‰é¢çš„rç»“å°¾ï¼Œä¸€ä¸ªæ˜¯ä¸­é—´çš„yç»“å°¾ï¼Œä¸€ä¸ªæ˜¯æœ«å°¾çš„rç»“å°¾ï¼Œæœ€åæ±‚å‡ºä»¥æœ€åçš„rç»“å°¾çš„æœ€çŸ­æ¬¡æ•°å°±okäº†\n```java\npublic int minimumOperations(String s) {\n    int n = s.length();\n    int[][] dp = new int[n+1][3];\n    //0ï¼Œ1ï¼Œ2åˆ†åˆ«ä»£è¡¨ å‰é¢çš„r ä¸­é—´çš„y ç»“å°¾çš„r\n    dp[0][0] = s.charAt(0) == 'r' ? 0 : 1;\n    dp[0][1] = dp[0][2] = dp[1][2] = 0x3f3f3f3f;\n    //ç®€å•çš„é€’æ¨\n    for (int i = 1; i < n; i++) {\n        if (s.charAt(i) == 'r') {\n            dp[i][0] = dp[i-1][0];\n            dp[i][1] = Math.min(dp[i-1][1]+1, dp[i-1][0]+1);\n            dp[i][2] = Math.min(dp[i-1][2], dp[i-1][1]);\n        } else {\n            dp[i][0] = dp[i-1][0]+1;\n            dp[i][1] = Math.min(dp[i-1][0], dp[i-1][1]);\n            dp[i][2] = Math.min(dp[i-1][2]+1, dp[i-1][1]+1);\n        }\n    }\n    return dp[n-1][2];\n}\n```\n> ç©ºé—´è¿˜å¯ä»¥ä¼˜åŒ–ï¼Œä»£ç ä¹Ÿè¿˜å¯ä»¥æ›´ç®€æ´ï¼Œä¸è¿‡æˆ‘æ‡’å¾—æ”¹äº†\n\n## [845. æ•°ç»„ä¸­çš„æœ€é•¿å±±è„‰](https://leetcode-cn.com/problems/longest-mountain-in-array/)\n\nDifficulty: **ä¸­ç­‰**\n\næˆ‘ä»¬æŠŠæ•°ç»„ A ä¸­ç¬¦åˆä¸‹åˆ—å±æ€§çš„ä»»æ„è¿ç»­å­æ•°ç»„ B ç§°ä¸º â€œ_å±±è„‰â€_ï¼š\n\n*   `B.length >= 3`\n*   å­˜åœ¨ `0 < iÂ < B.length - 1` ä½¿å¾— `B[0] < B[1] < ... B[i-1] < B[i] > B[i+1] > ... > B[B.length - 1]`\n\nï¼ˆæ³¨æ„ï¼šB å¯ä»¥æ˜¯ A çš„ä»»æ„å­æ•°ç»„ï¼ŒåŒ…æ‹¬æ•´ä¸ªæ•°ç»„ Aã€‚ï¼‰\n\nç»™å‡ºä¸€ä¸ªæ•´æ•°æ•°ç»„ `A`ï¼Œè¿”å›æœ€é•¿ _â€œå±±è„‰â€_Â çš„é•¿åº¦ã€‚\n\nå¦‚æœä¸å«æœ‰ â€œ_å±±è„‰â€Â _åˆ™è¿”å› `0`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š[2,1,4,7,3,2,5]\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šæœ€é•¿çš„ â€œå±±è„‰â€ æ˜¯ [1,4,7,3,2]ï¼Œé•¿åº¦ä¸º 5ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š[2,2,2]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šä¸å« â€œå±±è„‰â€ã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  `0 <= A.length <= 10000`\n2.  `0 <= A[i] <= 10000`\n\nç¤ºä¾‹ 1ï¼š\n\n```go\nè¾“å…¥ï¼š[2,1,4,7,3,2,5]\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šæœ€é•¿çš„å±±è„‰æ˜¯ [1,4,7,3,2]ï¼Œé•¿åº¦ä¸º 5ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š[2,2,2]\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šä¸å«å±±è„‰\n```\n\n**è§£æ³•ä¸€**\n\néå†çš„è¿‡ç¨‹ä¸­è®°å½•ä¸Šå‡å’Œä¸‹é™çš„é•¿åº¦ï¼Œç„¶åæ³¨æ„é‡ç½®çš„æ—¶æœºï¼Œå½“ä¸”ä»…å½“upå’Œdownéƒ½å¤§äº0çš„æ—¶å€™ä¸ºåˆæ³•ï¼Œç»Ÿè®¡ä¸€ä¸ªæœ€å¤§å€¼å°±å¯ä»¥äº†\n```java\npublic int longestMountain(int[] A) {\n    int res = 0;\n    int up = 0, down = 0;\n    //[2,1,4,7,3,2,5]\n    for (int i = 1; i < A.length; i++) {\n        //å‰é¢æ˜¯ä¸‹é™ï¼Œè¿™é‡Œå¼€å§‹å¢åŠ æˆ–è€…å’Œå‰ä¸€ä¸ªå…ƒç´ ç›¸åŒï¼Œéœ€è¦é‡ç½®\n        if ((down > 0 && A[i] > A[i-1]) || A[i] == A[i-1]) {\n            up = down = 0;\n        }\n        up += A[i] > A[i-1] ? 1 : 0;\n        down += A[i] < A[i-1] ? 1 : 0;\n        if (up > 0 && down > 0) {\n            res = Math.max(res, up+down+1);   \n        }\n    }\n    return res;\n}\n```\n## _åŒºé—´DP_\n\nåé¢æœ‰æ—¶é—´ä¼šå•ç‹¬å°†è¿™äº›é¢˜ç›®åˆ†ç±»æ•´ç†æˆæ–‡ç« ï¼Œç›®å‰æš‚æ—¶å…ˆè¿™æ ·\n\n\n\n## [312. æˆ³æ°”çƒ](https://leetcode-cn.com/problems/burst-balloons/)\n\næœ‰ n ä¸ªæ°”çƒï¼Œç¼–å·ä¸º0 åˆ° n-1ï¼Œæ¯ä¸ªæ°”çƒä¸Šéƒ½æ ‡æœ‰ä¸€ä¸ªæ•°å­—ï¼Œè¿™äº›æ•°å­—å­˜åœ¨æ•°ç»„ nums ä¸­ã€‚\n\nç°åœ¨è¦æ±‚ä½ æˆ³ç ´æ‰€æœ‰çš„æ°”çƒã€‚æ¯å½“ä½ æˆ³ç ´ä¸€ä¸ªæ°”çƒ i æ—¶ï¼Œä½ å¯ä»¥è·å¾— `nums[left] * nums[i] * nums[right]` ä¸ªç¡¬å¸ã€‚ è¿™é‡Œçš„ `left` å’Œ `right` ä»£è¡¨å’Œ i ç›¸é‚»çš„ä¸¤ä¸ªæ°”çƒçš„åºå·ã€‚æ³¨æ„å½“ä½ æˆ³ç ´äº†æ°”çƒ i åï¼Œæ°”çƒ left å’Œæ°”çƒ right å°±å˜æˆäº†ç›¸é‚»çš„æ°”çƒã€‚\n\næ±‚æ‰€èƒ½è·å¾—ç¡¬å¸çš„æœ€å¤§æ•°é‡ã€‚\n\n**è¯´æ˜:**\n\n- ä½ å¯ä»¥å‡è®¾ nums[-1] = nums[n] = 1ï¼Œä½†æ³¨æ„å®ƒä»¬ä¸æ˜¯çœŸå®å­˜åœ¨çš„æ‰€ä»¥å¹¶ä¸èƒ½è¢«æˆ³ç ´ã€‚\n- 0 â‰¤ n â‰¤ 500, 0 â‰¤ nums[i] â‰¤ 100\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [3,1,5,8]\nè¾“å‡º: 167 \nè§£é‡Š: nums = [3,1,5,8] --> [3,5,8] -->   [3,8]   -->  [8]  --> []\n     coins =  3*1*5      +  3*5*8    +  1*3*8      + 1*8*1   = 167\n```\n\n**è§£æ³•ä¸€**\n\næš´åŠ›å›æº¯ï¼Œå…¶å®å°±æ˜¯å°è¯•æ‰€æœ‰çš„ç»„åˆï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦`O(N!)` ï¼Œæ•°æ®è¶…è¿‡åå‡ å°±ä¸è¡Œäº†\n\n```java\npublic int maxCoinsTLE(int[] nums) {\n    LinkedList<Integer> list=new LinkedList<>();\n    for (int n:nums) list.add(n);\n    dfs(list,0);\n    return max;\n}\n\nprivate int max=0;\n\npublic void dfs(LinkedList<Integer> list,int sum) {\n    if (list.size()==0) {\n        max=Math.max(sum,max);\n        return;\n    }\n    for (int i=0;i<list.size();i++) {\n        int temp=list.get(i);\n        //è¿™ä¸ªå€¼è¦å…ˆç®—\n        int cur=(i-1<0?1:list.get(i-1))*(i+1>=list.size()?1:list.get(i+1))*temp;\n        list.remove(i);\n        dfs(list,sum+cur);\n        list.add(i,temp);\n    }\n}\n```\n\n**è§£æ³•äºŒ**\n\nåŒºé—´å‹åŠ¨æ€è§„åˆ’ï¼Œä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å¬è¯´è¿™ä¸ªåè¯ï¼Œä½†æ˜¯ä¹‹å‰å…¶å®å·²ç»åšäº†ä¸å°‘çš„åŒºé—´å‹çš„dpäº†\n\n```java\npublic int maxCoins(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int[] A=new int[nums.length+2];\n    A[0]=1;A[A.length-1]=1;\n    for (int i=0;i<nums.length;i++) {\n        A[i+1]=nums[i]; //copyä¸€ä¸ªæ–°æ•°ç»„\n    }\n    //åŒºé—´DP\n    int n=A.length;\n    int[][] dp=new int[n][n]; //dp[i][j]ä»£è¡¨çš„æ˜¯ä¸åŒ…å«è¾¹ç•Œi,jçš„æœ€å¤§å¾—åˆ†\n    for (int len=2;len<=n;len++) { //æšä¸¾åŒºé—´é•¿åº¦\n        for (int i=0;i<=n-len;i++) { //æšä¸¾èµ·ç‚¹\n            int j=i+len-1; //åŒºé—´ç»ˆç‚¹\n            for (int k=i+1;k<j;k++) { //æšä¸¾åˆ†å‰²ç‚¹\n                dp[i][j]=Math.max(dp[i][j],dp[i][k]+dp[k][j]+A[k]*A[i]*A[j]);\n            }\n        }\n    }\n    return dp[0][n-1];\n}\n```\n\nè¿™é‡Œä¸ºäº†å¤„ç†è¾¹ç•Œå°†æ•°ç»„å¤´å°¾æ’å…¥äº†1ï¼Œcopyäº†ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä¸‹é¢çš„åŒºé—´å‹dpä¹Ÿæ˜¯åœ¨çœ‹äº†é¢˜è§£ï¼Œç„¶åå¯¹ç€æ¿å­å†™çš„ï¼Œå½“ç„¶è¿™é¢˜çš„å…³é”®ä¸æ˜¯è¿™é‡Œï¼Œå…³é”®æ˜¯å¦‚ä½•è§„åˆ’ï¼Œè¿™é‡Œæ¬è¿ [é¢˜è§£åŒºå¤§ä½¬](https://leetcode-cn.com/problems/burst-balloons/solution/dong-tai-gui-hua-qiu-jie-by-feng-ji-wei-wang/) çš„è§£é‡Š\n\næˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æŒ‰ç…§ä¸Šé¢çš„é‚£ä¸ªé€’å½’çš„æ€è·¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹èƒ½å†™å—ï¼Ÿå¦‚æœæŒ‰ç…§ä¸Šé¢çš„é€’å½’çš„æ€è·¯ï¼Œæˆ‘ä»¬å®šä¹‰dp[i][j]è¡¨ç¤ºå¯¹äºi-jçš„æ°”çƒçš„æœ€å¤§çš„æ”¶ç›Šï¼Œé‚£çŠ¶æ€è½¬ç§»æ–¹ç¨‹å°±æ˜¯\n\n`dp[i][j]=max(coins[k]* coins[k-1] * coins[k+1]+dp[i][k-1]+dp[k+1][j]) kâˆˆ[i,j]`,\n\nå°±æŒ‰ä¸Šé¢çš„é‚£ä¸ªä¾‹å­ï¼Œ[3,1,5,8],æ¥å†™ä¸€ä¸‹è¿‡ç¨‹\n\n```java\næ‰çˆ†3 å‰©ä¸‹[]å’Œ[1,5,8]\næ‰çˆ†1 å‰©ä¸‹[3]å’Œ[5,8]\næ‰çˆ†5 å‰©ä¸‹[3,1]å’Œ[8]\næ‰çˆ†8 å‰©ä¸‹[3,1,5]å’Œ[]\n```\n\nç„¶ååœ¨è¿™äº›é‡Œé¢æ‰¾åˆ°ä¸€ä¸ªæœ€å¤§å€¼è¿”å›ï¼Œè¿™å…¶ä¸­å¯¹äºæ‰çˆ†1å’Œ8çš„æœ€å¤§çš„æ”¶ç›Šè¿™æ ·å®šä¹‰æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºä¸¤è€…éƒ½åœ¨è¾¹ç•Œï¼Œä½†æ˜¯å¯¹äºæ‰çˆ†1å’Œ5å°±æœ‰é—®é¢˜äº†ï¼Œå°±æ‹¿å…ˆæ‰çˆ†1æ¥è¯´ï¼Œæ‰çˆ†1ï¼Œå‰©ä¸‹çš„æœ€å¤§çš„æ”¶ç›Šå˜ä¸ºäº†[3]å’Œ[5,8]è¿™ä¸¤ä¸ªåŒºé—´çš„æœ€å¤§çš„æ”¶ç›Šçš„å’Œï¼Œè¿™ä¸ªè‚¯å®šä¸å¯¹ï¼Œå› ä¸ºå‰©ä¸‹çš„[3,5,8]åŒºé—´çš„æœ€å¤§çš„æ”¶ç›Šçš„å’Œä¸ä¼šæ˜¯[3]çš„æœ€å¤§æ”¶ç›Šå’Œä¸[5,8]çš„æœ€å¤§æ”¶ç›Šå’Œçš„æ€»å’Œæ„æˆçš„ï¼Œæ‰€ä»¥è¿™ä¸ªçŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯ä¸å¯¹çš„\n\né‚£åº”è¯¥æ€ä¹ˆå®šä¹‰çŠ¶æ€è½¬ç§»æ–¹ç¨‹å‘¢ï¼Œè¿™ä¹Ÿå°±æ˜¯è¿™é“é¢˜å·§å¦™çš„åœ°æ–¹ï¼Œå®ƒä½¿ç”¨é€†å‘æ€ç»´ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯ç”±æŸä¸ªæ°”çƒå…ˆçˆ†å¾—å‡ºæ¥çš„ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬è®©æŒ‡å®šçš„æ°”çƒæœ€åçˆ†ï¼Œè¿™æ ·çš„è¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸º\n\n`dp[i][j]=max(coins[k]*coins[i-1]*coins[j+1]+dp[i][k-1]+dp[k+1][j]) kâˆˆ[i,j]` \n\nå†æ¥çœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œå°±å¯¹äº†ï¼Œä¹Ÿå°±æ˜¯å¯¹äº[i,j]çš„æ°”çƒï¼Œæˆ‘ä»¬è®©æŸä¸ªä½ç½®çš„æ°”çƒæœ€åå†çˆ†ï¼Œæ±‚å‡ºå®ƒå·¦åŒºé—´çš„æœ€å¤§çš„æ”¶ç›Šå’Œå³åŒºé—´çš„æœ€å¤§çš„æ”¶ç›Šï¼ŒåŠ ä¸Šè¿™ä¸ªæ°”çƒæœ€åçˆ†æ‰æ‰€è·å¾—çš„æ”¶ç›Šï¼Œä¸€ ä¸€æ¯”è¾ƒï¼Œè¿”å›ä¸€ä¸ªæœ€å¤§å€¼å°±å¥½äº†ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œè¦æŒ‰åŒºé—´çš„é•¿åº¦æ¥è¿›è¡ŒçŠ¶æ€çš„è½¬ç§»ï¼Œä¹Ÿå°±æ˜¯å…ˆæ±‚é•¿åº¦ä¸º1çš„ï¼Œç„¶å2çš„ä¾æ¬¡ç±»æ¨ï¼Œå› ä¸ºè¿™é‡ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹æ¶‰åŠåˆ°äº†å½“å‰ä½ç½®çš„åé¢çš„åŒºé—´çš„æœ€å¤§çš„æ”¶ç›Šï¼Œä½†æ˜¯åé¢çš„åŒºé—´çš„é•¿åº¦æ˜¯å°äºå½“å‰åŒºé—´çš„é•¿åº¦çš„ï¼Œæ•…åº”è¯¥æŒ‰é•¿åº¦æ¥è¿›è¡ŒçŠ¶æ€çš„è½¬ç§»ï¼Œè¿™ä¹Ÿæ˜¯å…¸å‹çš„åŒºé—´å‹åŠ¨æ€è§„åˆ’çš„å¥—è·¯\n\n**è§£æ³•ä¸‰**\n\nåœ¨è§£æ³•äºŒçš„åŸºç¡€ä¸Šç®€åŒ–äº†ä»£ç ï¼Œ`dp[i][j]`ä»£è¡¨`i`å’Œ`j`ä¹‹é—´ï¼ŒåŒ…å«`i`å’Œ`j`ä½ç½®ï¼Œæˆ³çˆ†æ‰€æœ‰æ°”çƒçš„æœ€å¤§å¾—åˆ†\n\n```java\npublic int maxCoins(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return 0;\n    }\n    int n=nums.length;\n    //dp[i][j]ä»£è¡¨çš„æ˜¯åŒ…å«è¾¹ç•Œi,jçš„æœ€å¤§å¾—åˆ†\n    int[][] dp=new int[n][n]; \n    for (int len=1;len<=n;len++) { //æšä¸¾åŒºé—´é•¿åº¦\n        for (int i=0;i<=n-len;i++) { //æšä¸¾èµ·ç‚¹\n            int j=i+len-1; //åŒºé—´ç»ˆç‚¹\n            for (int k=i;k<=j;k++) { //æšä¸¾åˆ†å‰²ç‚¹\n                dp[i][j]=Math.max(dp[i][j],(k-1>=0?dp[i][k-1]:0)+(k+1<n?dp[k+1][j]:0)+nums[k]*(i-1>=0?nums[i-1]:1)*(j+1<n?nums[j+1]:1));\n            }\n        }\n    }\n    return dp[0][n-1];\n}\n```\n\n**UPDATE:2020.7.19**\næ‰“å¡é¢˜ï¼Œé‡æ–°å†™ä¸€éï¼Œç¨å¾®å¥½ä¸€ç‚¹çš„å†™æ³•ï¼Œä¸Šé¢ä¸€å †ä¸‰ç›®ä¸å¤ªå¥½\n\n```golang\nfunc maxCoins(nums []int) int {\n    if len(nums) <= 0{\n        return 0\n    }\n    nums = append(nums, 1)\n    nums = append([]int{1}, nums...)\n    var n = len(nums)\n    var dp = make([][]int, n)\n    for i := 0; i < n; i++{\n        dp[i] = make([]int, n)\n    }\n    for tlen := 1; tlen <= n-2; tlen++{ //æšä¸¾åŒºé—´é•¿åº¦\n        for left := 1; left+tlen-1 < n-1; left++{ //æšä¸¾å·¦ç«¯ç‚¹\n            right := left+tlen-1 //å³ç«¯ç‚¹\n            for k := left; k <= right; k++{ //æšä¸¾åˆ†å‰²ç‚¹\n                dp[left][right] = Max(dp[left][right], dp[left][k-1]+dp[k+1][right]+nums[k]*nums[left-1]*nums[right+1])\n            }\n        }\n    }\n    return dp[1][n-2]\n}\n\nfunc Max(a, b int)int{\n    if a > b{\n        return a\n    }\n    return b\n}\n```\n\n\n## [877. çŸ³å­æ¸¸æˆ](https://leetcode-cn.com/problems/stone-game/)\n\näºšå†å…‹æ–¯å’Œæç”¨å‡ å †çŸ³å­åœ¨åšæ¸¸æˆã€‚å¶æ•°å †çŸ³å­**æ’æˆä¸€è¡Œ**ï¼Œæ¯å †éƒ½æœ‰æ­£æ•´æ•°é¢—çŸ³å­ `piles[i]` ã€‚\n\næ¸¸æˆä»¥è°æ‰‹ä¸­çš„çŸ³å­æœ€å¤šæ¥å†³å‡ºèƒœè´Ÿã€‚çŸ³å­çš„æ€»æ•°æ˜¯å¥‡æ•°ï¼Œæ‰€ä»¥æ²¡æœ‰å¹³å±€ã€‚\n\näºšå†å…‹æ–¯å’Œæè½®æµè¿›è¡Œï¼Œäºšå†å…‹æ–¯å…ˆå¼€å§‹ã€‚ æ¯å›åˆï¼Œç©å®¶ä»è¡Œçš„å¼€å§‹æˆ–ç»“æŸå¤„å–èµ°æ•´å †çŸ³å¤´ã€‚ è¿™ç§æƒ…å†µä¸€ç›´æŒç»­åˆ°æ²¡æœ‰æ›´å¤šçš„çŸ³å­å †ä¸ºæ­¢ï¼Œæ­¤æ—¶æ‰‹ä¸­çŸ³å­æœ€å¤šçš„ç©å®¶è·èƒœã€‚\n\nå‡è®¾äºšå†å…‹æ–¯å’Œæéƒ½å‘æŒ¥å‡ºæœ€ä½³æ°´å¹³ï¼Œå½“äºšå†å…‹æ–¯èµ¢å¾—æ¯”èµ›æ—¶è¿”å› `true` ï¼Œå½“æèµ¢å¾—æ¯”èµ›æ—¶è¿”å› `false` ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š[5,3,4,5]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼š\näºšå†å…‹æ–¯å…ˆå¼€å§‹ï¼Œåªèƒ½æ‹¿å‰ 5 é¢—æˆ–å 5 é¢—çŸ³å­ ã€‚\nå‡è®¾ä»–å–äº†å‰ 5 é¢—ï¼Œè¿™ä¸€è¡Œå°±å˜æˆäº† [3,4,5] ã€‚\nå¦‚æœææ‹¿èµ°å‰ 3 é¢—ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„æ˜¯ [4,5]ï¼Œäºšå†å…‹æ–¯æ‹¿èµ°å 5 é¢—èµ¢å¾— 10 åˆ†ã€‚\nå¦‚æœææ‹¿èµ°å 5 é¢—ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„æ˜¯ [3,4]ï¼Œäºšå†å…‹æ–¯æ‹¿èµ°å 4 é¢—èµ¢å¾— 9 åˆ†ã€‚\nè¿™è¡¨æ˜ï¼Œå–å‰ 5 é¢—çŸ³å­å¯¹äºšå†å…‹æ–¯æ¥è¯´æ˜¯ä¸€ä¸ªèƒœåˆ©çš„ä¸¾åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿”å› true ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `2 <= piles.length <= 500`\n2. `piles.length` æ˜¯å¶æ•°ã€‚\n3. `1 <= piles[i] <= 500`\n4. `sum(piles)` æ˜¯å¥‡æ•°ã€‚\n\n**è§£æ³•ä¸€**\n\nåšå¼ˆå‹dpï¼Œå…ˆé‡‡ç”¨åŒºé—´dpçš„è§£æ³•è¯•è¯•ï¼ˆåŒºé—´dpæ˜¯çœŸçš„å¦™å•Šï¼ï¼ï¼)\n\n```java\n//é€šç”¨çš„åŒºé—´DP\npublic boolean stoneGame(int[] piles) {\n    //[5,3,4,5]\n    int N=piles.length;\n    //(i~j) å…ˆæ‰‹(0),åæ‰‹(1)çš„æœ€å¤§æ”¶ç›Š\n    int[][][] dp=new int[N][N][2];\n    //base init len=1çš„æƒ…å†µ\n    for(int i=0;i<N;i++){\n        dp[i][i][0]=piles[i];\n        dp[i][i][1]=0;\n    }\n    for (int len=2;len<=N;len++) { //æšä¸¾åŒºé—´é•¿åº¦\n        for (int left=0;left<=N-len;left++) { //æšä¸¾æ‰€æœ‰åŒºé—´\n            //left+len-1<N\n            int right=left+len-1;\n            //å…ˆæ‰‹æ‹¿leftæˆ–è€…rightçš„æœ€å¤§æ”¶ç›Š\n            //æˆ‘å…ˆæ‰‹æ‹¿äº†leftæˆ–è€…rightä¹‹åï¼Œå‰©ä¸‹[left+1,right]æˆ–[left,right-1]åŒºé—´\n            //æˆ‘åœ¨å‰©ä¸‹çš„åŒºé—´ä¸­ç»§ç»­é€‰å…¶å®å°±æˆä¸ºäº†åæ‰‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠ ä¸Šå‰©ä¸‹åŒºé—´çš„åæ‰‹æœ€å¤§å€¼\n            int firLeft=piles[left]+dp[left+1][right][1];\n            int firRight=piles[right]+dp[left][right-1][1];\n            if(firLeft>firRight){\n                dp[left][right][0]=firLeft;\n                //å…ˆæ‰‹é€‰lefté‚£ä¹ˆå°±ç›¸å½“äºè®©å¦ä¸€ä¸ªäººï¼ˆåæ‰‹ï¼‰ä»[left+1,right]ä¸­å…ˆæ‰‹å–æœ€å¤§å€¼\n                dp[left][right][1]=dp[left+1][right][0];\n            }else{\n                dp[left][right][0]=firRight;\n                //åŒä¸Š\n                dp[left][right][1]=dp[left][right-1][0];\n            }\n        }\n    }\n    return dp[0][N-1][0]-dp[0][N-1][1]>0;\n}\n```\n**è§£æ³•äºŒ**\n\næ•°å­¦æ¨ç†çš„æ–¹æ³•ï¼Œå…·ä½“çš„è¯æ˜ç»™ä¸å‡ºæ¥ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“ç†è§£å®ƒçš„æ­£ç¡®æ€§\n\n```java\n//æ•°å­¦\npublic boolean stoneGame(int[] piles) {\n    return true;\n}\n```\né¦–å…ˆé¢˜ç›®æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„æ¡ä»¶ï¼ˆè¿™ä¸¤ä¸ªæ¡ä»¶æˆ‘è§£æ³•ä¸€æ²¡ç”¨åˆ°ï¼‰`piles.length` æ˜¯å¶æ•°ï¼Œ`sum(piles)` æ˜¯å¥‡æ•°ï¼Œè¿™å…¶å®è¯´æ˜äº†ä¸ä¼šæœ‰å¹³å±€ï¼Œå› ä¸ºæ˜¯å¶æ•°ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰çš„æŸ±å­ç”¨å¥‡å¶æ¥åˆ’åˆ†ï¼Œé‚£ä¹ˆå¥‡æ•°æŸ±å­å’Œå¶æ•°**çŸ³å¤´å †çš„æ•°é‡**ä¸€å®šæ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”**ä¸¤è€…æ€»çš„çŸ³å¤´æ•°ä¸€å®šæœ‰ä¸€ä¸ªæ•°é‡çš„å·®å¼‚**ï¼Œä¸å¯èƒ½ç›¸ç­‰ï¼Œæˆ‘å…ˆæ‰‹æ‹¿çš„è¯æˆ‘å°±å¯ä»¥åªè€ƒè™‘æ‹¿è¾ƒå¤§çš„é‚£ä¸€ç±»çŸ³å¤´å †ï¼Œé‚£æˆ‘èƒ½ä¿è¯æˆ‘æ‹¿åˆ°çš„ä¸€å®šæ˜¯å¥‡æ•°æˆ–å¶æ•°çš„å †å—ï¼Ÿå…¶å®éšä¾¿ä¸¾ä¸€ä¸ªä¾‹å­å°±çŸ¥é“äº†ï¼Œæ¯”å¦‚4å †çŸ³å¤´ï¼Œå…ˆæ‰‹çš„äººæ€»æ˜¯èƒ½æ§åˆ¶è‡ªå·±ä¸€å®šæ‹¿åˆ°1ï¼Œ3æˆ–è€…2ï¼Œ4æ‰€ä»¥å…ˆæ‰‹çš„ä¸€å®šæ˜¯å¯ä»¥èµ¢å¾—ï¼Œæ¨å¹¿åˆ°Nå †çŸ³å¤´ä¹ŸåŒæ ·é€‚ç”¨\n\n## [1039. å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†çš„æœ€ä½å¾—åˆ†](https://leetcode-cn.com/problems/minimum-score-triangulation-of-polygon/)\n\nç»™å®š Nï¼Œæƒ³è±¡ä¸€ä¸ªå‡¸ N è¾¹å¤šè¾¹å½¢ï¼Œå…¶é¡¶ç‚¹æŒ‰é¡ºæ—¶é’ˆé¡ºåºä¾æ¬¡æ ‡è®°ä¸º `A[0], A[i], ..., A[N-1]`ã€‚\n\nå‡è®¾æ‚¨å°†å¤šè¾¹å½¢å‰–åˆ†ä¸º N-2 ä¸ªä¸‰è§’å½¢ã€‚å¯¹äºæ¯ä¸ªä¸‰è§’å½¢ï¼Œè¯¥ä¸‰è§’å½¢çš„å€¼æ˜¯é¡¶ç‚¹æ ‡è®°çš„ä¹˜ç§¯ï¼Œä¸‰è§’å‰–åˆ†çš„åˆ†æ•°æ˜¯è¿›è¡Œä¸‰è§’å‰–åˆ†åæ‰€æœ‰ N-2 ä¸ªä¸‰è§’å½¢çš„å€¼ä¹‹å’Œã€‚\n\nè¿”å›å¤šè¾¹å½¢è¿›è¡Œä¸‰è§’å‰–åˆ†åå¯ä»¥å¾—åˆ°çš„æœ€ä½åˆ†ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[1,2,3]\nè¾“å‡ºï¼š6\nè§£é‡Šï¼šå¤šè¾¹å½¢å·²ç»ä¸‰è§’åŒ–ï¼Œå”¯ä¸€ä¸‰è§’å½¢çš„åˆ†æ•°ä¸º 6ã€‚\n```\n\n**å®ä¾‹2ï¼š**\n\n![J8IK8U.png](https://s1.ax1x.com/2020/04/21/J8IK8U.png)\n\n```java\nè¾“å…¥ï¼š[3,7,4,5]\nè¾“å‡ºï¼š144\nè§£é‡Šï¼šæœ‰ä¸¤ç§ä¸‰è§’å‰–åˆ†ï¼Œå¯èƒ½å¾—åˆ†åˆ†åˆ«ä¸ºï¼š3*7*5 + 4*5*7 = 245ï¼Œæˆ– 3*4*5 + 3*4*7 = 144ã€‚æœ€ä½åˆ†æ•°ä¸º 144ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nåŒºé—´DPå¥—è·¯ï¼Œæšä¸¾æ‰€æœ‰çš„åŒºé—´å’ŒåŒºé—´å†…çš„ç‚¹ï¼Œ`åŒºé—´å†…çš„ç‚¹`å’Œ`åŒºé—´å·¦å³ç«¯ç‚¹`å°†æ•´ä¸ªåŒºé—´åˆåˆ’åˆ†ä¸ºä¸¤ä¸ª`å·²çŸ¥çš„å­åŒºé—´`ï¼Œå…¸å‹çš„åŒºé—´dp\n\n```java\n//ç¯å½¢çš„ç»“æ„\npublic int minScoreTriangulation(int[] A) {\n    if(A==null || A.length<=0) return 0;\n    int N=A.length;\n    //ä» 0 ~ N-1 å½¢æˆä¸€ä¸ªç¯\n    //    1-3 \n    //   /    \\\n    //  5      1\n    //   \\    /\n    //    1â€”4\n    // dp[left][right] ä»£è¡¨left~rightåŒºé—´å½¢æˆçš„ç¯çš„æœ€å°å¾—åˆ†å€¼\n    int[][] dp=new int[N][N];\n    for (int len=3;len<=N;len++) { //æšä¸¾é•¿åº¦,ä»3å¼€å§‹\n        for (int left=0;left<=N-len;left++) { //æšä¸¾å·¦ç«¯ç‚¹\n            //left+len-1<N\n            int right=left+len-1;\n            //initåˆå§‹åŒ–åŒºé—´å€¼\n            dp[left][right]=Integer.MAX_VALUE;\n            for (int i=left+1;i<right;i++) { //æšä¸¾åŒºé—´å†…çš„æ‰€æœ‰çš„ç‚¹(ä¸åŒ…æ‹¬ç«¯ç‚¹)),å°†ç¯åˆ†å‰²æˆå·¦å³ä¸¤éƒ¨åˆ†\n                dp[left][right]=Math.min(dp[left][right],dp[left][i]+dp[i][right]+A[i]*A[left]*A[right]);\n            }\n        }\n    }\n    return dp[0][N-1];\n}\n```\n\n## [516. æœ€é•¿å›æ–‡å­åºåˆ—](https://leetcode-cn.com/problems/longest-palindromic-subsequence/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²sï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿çš„å›æ–‡å­åºåˆ—ã€‚å¯ä»¥å‡è®¾sçš„æœ€å¤§é•¿åº¦ä¸º1000ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n\n\"bbbab\"\nè¾“å‡º:\n\n4\nä¸€ä¸ªå¯èƒ½çš„æœ€é•¿å›æ–‡å­åºåˆ—ä¸º \"bbbb\"ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\n\n\"cbbd\"\nè¾“å‡º:\n\n2\nä¸€ä¸ªå¯èƒ½çš„æœ€é•¿å›æ–‡å­åºåˆ—ä¸º \"bb\"ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’ï¼Œ`dp[i][j]` ä»£è¡¨i~jçš„æœ€é•¿å›æ–‡ä¸²\n\n```java\npublic int longestPalindromeSubseq(String s) {\n    if (s==null || s.length()<=0) {\n        return 0;\n    }\n    int n=s.length();\n    int[][] dp=new int[n][n]; //dp[i][j] ä»£è¡¨i~jçš„æœ€é•¿å›æ–‡å­ä¸²\n    for (int i=0;i<n;i++) {\n        dp[i][i]=1;\n    }\n    //bbbab\n    for (int i=n-1;i>=0;i--) {\n        for (int j=i+1;j<n;j++) { \n            if (s.charAt(i)==s.charAt(j)) {\n                dp[i][j]=dp[i+1][j-1]+2;\n            }else{\n                dp[i][j]=Math.max(dp[i+1][j],dp[i][j-1]);\n            }\n        }\n    }\n    return dp[0][n-1];\n}\n```\n\næ ¸å¿ƒçš„dpå…¬å¼ï¼š\n\n1. `s[i]==p[j]`ï¼Œ`dp[i][j]=dp[i+1][j-1]+2` \n2. `s[i]!=p[j]` ï¼Œ`dp[i][j]=max(dp[i+1][j],dp[i][j-1])`\n\næ˜¯ä¸æ˜¯æœ‰çš„çœ¼ç†Ÿï¼Ÿæ²¡é”™ï¼Œå’ŒLCSçš„dpæ€è·¯å¾ˆç›¸ä¼¼\n\nè¿™é‡Œå…¶å®è¿˜æœ‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå°±æ˜¯ä¸¤æ¬¡å¾ªç¯çš„æ–¹å‘ï¼Œæˆ‘ä»¬è¦ä¿è¯æ¯æ¬¡è®¡ç®—dpå€¼çš„æ—¶å€™å³å€¼éƒ½æ˜¯å·²ç»è®¡ç®—è¿‡çš„ï¼Œæ‰€ä»¥éœ€è¦è°ƒæ•´å¾ªç¯çš„æ‰§è¡Œæ–¹å‘è®© `i`ä»å³å¾€å·¦ï¼Œè®©`j`ä»`i`å‘å³ï¼Œè¿™æ ·i+1å’Œj-1çš„dpå°±éƒ½æ˜¯è®¡ç®—è¿‡çš„äº†\n\n**UPDATE**\n\n```java\n//update: 2020.4.19\n//åŒºé—´dpå†™æ³•,æ›´åŠ å¥—è·¯åŒ–ï¼Œå…¶å®æ€è·¯æ˜¯ä¸€æ ·çš„\npublic int longestPalindromeSubseq(String s) {\n    if(s==null || s.length()<=0) return 0;\n    int N=s.length();\n    int[][] dp=new int[N][N];\n    //base len=1\n    for(int i=0;i<N;i++){\n        dp[i][i]=1;\n    }\n    for(int len=2;len<=N;len++){\n        for(int i=0;i<=N-len;i++){\n            //j=i+len-1<N\n            int j=i+len-1;\n            if(s.charAt(i)==s.charAt(j)){\n                dp[i][j]=dp[i+1][j-1]+2;\n            }else{\n                dp[i][j]=Math.max(dp[i+1][j],dp[i][j-1]);\n            }\n        }\n    }\n    return dp[0][N-1];\n}\n```\n\n**è§£æ³•äºŒ**\n\nå¯¹æ¯”ä¸€ä¸‹é€’å½’è§£æ³•æ˜¯çœŸçš„ç®€æ´ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šè¾¹ç•Œè€ƒè™‘\n\n```java\n//é€’å½’è§£æ³•,è‡ªåº•å‘ä¸Š\nprivate Integer[][] cache=null;\n\npublic int longestPalindromeSubseq(String s) {\n    if (s==null || s.length()<=0) {\n        return 0;\n    }\n    int n=s.length();\n    cache=new Integer[n][n];\n    return helper(s,0,n-1);\n}\n\npublic int helper(String s,int left,int right){\n    if (left>right) {\n        return 0;\n    }\n    if (left==right) {\n        return 1;\n    }\n    if (cache[left][right]!=null) {\n        return cache[left][right];\n    }\n    if (s.charAt(left) == s.charAt(right)) {\n        return cache[left][right]=helper(s,left+1,right-1)+2; //ç”±å¤–å‘å†…ç¼©è¿›\n    }\n    return cache[left][right]=Math.max(helper(s,left+1,right),helper(s,left,right-1));\n}\n```\n**è§£æ³•ä¸‰**\n\nå°†é—®é¢˜è½¬æ¢ä¸ºLCSçš„é—®é¢˜\n\n```java\n//LCSçš„è§£æ³•\npublic int longestPalindromeSubseq(String s) {\n    if (s==null || s.length()<=0) {\n        return 0;\n    }\n    int n=s.length();\n    int[][] dp=new int[n+1][n+1]; //dp[i][j] ä»£è¡¨s[0,i]~rs[0,j]çš„æœ€é•¿å­åºåˆ—\n    String rs=new StringBuilder(s).reverse().toString();\n    for (int i=1;i<=s.length();i++) {\n        for (int j=1;j<=rs.length();j++) {\n            if (s.charAt(i-1)==rs.charAt(j-1)) {\n                dp[i][j]=dp[i-1][j-1]+1;\n            }else{\n                dp[i][j]=Math.max(dp[i-1][j],dp[i][j-1]);\n            }\n        }\n    }\n    return dp[n][n];\n}\n```\næœ€é•¿çš„å›æ–‡åºåˆ—å…¶å®å°±æ˜¯æ±‚è¿™ä¸ªå­—ç¬¦ä¸²å’Œå®ƒç¿»è½¬åçš„å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ï¼å¾ˆå¦™çš„è§£æ³•\n\n## [1312. è®©å­—ç¬¦ä¸²æˆä¸ºå›æ–‡ä¸²çš„æœ€å°‘æ’å…¥æ¬¡æ•°](https://leetcode-cn.com/problems/minimum-insertion-steps-to-make-a-string-palindrome/)\n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œæ¯ä¸€æ¬¡æ“ä½œä½ éƒ½å¯ä»¥åœ¨å­—ç¬¦ä¸²çš„ä»»æ„ä½ç½®æ’å…¥ä»»æ„å­—ç¬¦ã€‚\n\nè¯·ä½ è¿”å›è®© s æˆä¸ºå›æ–‡ä¸²çš„ **æœ€å°‘æ“ä½œæ¬¡æ•°** ã€‚\n\nã€Œå›æ–‡ä¸²ã€æ˜¯æ­£è¯»å’Œåè¯»éƒ½ç›¸åŒçš„å­—ç¬¦ä¸²ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"zzazz\"\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šå­—ç¬¦ä¸² \"zzazz\" å·²ç»æ˜¯å›æ–‡ä¸²äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦åšä»»ä½•æ’å…¥æ“ä½œã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"mbadm\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šå­—ç¬¦ä¸²å¯å˜ä¸º \"mbdadbm\" æˆ–è€… \"mdbabdm\" ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"leetcode\"\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šæ’å…¥ 5 ä¸ªå­—ç¬¦åå­—ç¬¦ä¸²å˜ä¸º \"leetcodocteel\" ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"g\"\nè¾“å‡ºï¼š0\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"no\"\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n- 1 <= s.length <= 500\n- s ä¸­æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å°å†™å­—æ¯ã€‚ \n\n**è§£æ³•ä¸€**\n\n170å‘¨èµ›çš„å‹è½´é¢˜ï¼Œå…¶å®å’Œå‰é¢çš„[516. æœ€é•¿å›æ–‡å­åºåˆ—](#516-æœ€é•¿å›æ–‡å­åºåˆ—)æ˜¯ä¸€æ ·çš„ã€‚ã€‚ã€‚æ²¡å•¥å¥½è¯´çš„\n\n```java\npublic int minInsertions(String s) {\n    if (s==null || s.length()<=0) {\n        return 0;\n    }\n    int n=s.length();\n    int[][] dp=new int[n][n];\n    for (int i=n-1;i>=0;i--) {\n        for (int j=i+1;j<n;j++) {\n            if (s.charAt(i) == s.charAt(j)) {\n                dp[i][j]=dp[i+1][j-1];   \n            }else{\n                //ä¸ç›¸ç­‰å°±å¯ä»¥åœ¨å¤´éƒ¨æ’å…¥s[j]æˆ–è€…å°¾éƒ¨æ’å…¥s[i]\n                //å¤´éƒ¨æ’å…¥s[j]åˆ™å­åŒºé—´å°±æ˜¯dp[i][j-1]\n                //å°¾éƒ¨æ’å…¥s[i]åˆ™å­åŒºé—´å°±æ˜¯dp[i+1][j]\n                dp[i][j]=1+Math.min(dp[i+1][j],dp[i][j-1]);\n            }\n        }\n    }\n    return dp[0][n-1];\n}\n```\n**è§£æ³•äºŒ**\n\nUPDATEï¼š2020.5.18ï¼ŒåŒºé—´dpçš„å†™æ³•\n\n```java\npublic int minInsertions(String s) {\n    int[][] dp=new int[s.length()][s.length()];\n    for(int len=2;len<=s.length();len++){\n        for(int left=0;left+len-1<s.length();left++){\n            int right=left+len-1;\n            if(s.charAt(left)==s.charAt(right)){\n                dp[left][right]=dp[left+1][right-1];\n            }else{\n                dp[left][right]=Math.min(dp[left][right-1],dp[left+1][right])+1;\n            }\n        }\n    }\n    return dp[0][s.length()-1];\n}\n```\n\nè¿™é¢˜ä¹Ÿå¯ä»¥ç”¨LCSçš„è§£æ³•è§£ï¼Œ`n-lcs[n][n]`å°±æ˜¯æœ€å°‘çš„æ’å…¥æ¬¡æ•° \n\n## [664. å¥‡æ€ªçš„æ‰“å°æœº](https://leetcode-cn.com/problems/strange-printer/)\n\næœ‰å°å¥‡æ€ªçš„æ‰“å°æœºæœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹æ®Šè¦æ±‚ï¼š\n\næ‰“å°æœºæ¯æ¬¡åªèƒ½æ‰“å°åŒä¸€ä¸ªå­—ç¬¦åºåˆ—ã€‚\næ¯æ¬¡å¯ä»¥åœ¨ä»»æ„èµ·å§‹å’Œç»“æŸä½ç½®æ‰“å°æ–°å­—ç¬¦ï¼Œå¹¶ä¸”ä¼šè¦†ç›–æ‰åŸæ¥å·²æœ‰çš„å­—ç¬¦ã€‚\nç»™å®šä¸€ä¸ªåªåŒ…å«å°å†™è‹±æ–‡å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œä½ çš„ä»»åŠ¡æ˜¯è®¡ç®—è¿™ä¸ªæ‰“å°æœºæ‰“å°å®ƒéœ€è¦çš„æœ€å°‘æ¬¡æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"aaabbb\"\nè¾“å‡º: 2\nè§£é‡Š: é¦–å…ˆæ‰“å° \"aaa\" ç„¶åæ‰“å° \"bbb\"ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"aba\"\nè¾“å‡º: 2\nè§£é‡Š: é¦–å…ˆæ‰“å° \"aaa\" ç„¶ååœ¨ç¬¬äºŒä¸ªä½ç½®æ‰“å° \"b\" è¦†ç›–æ‰åŸæ¥çš„å­—ç¬¦ 'a'ã€‚\n```\n\n**æç¤º:** è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 100ã€‚\n\n**è§£æ³•ä¸€**\n\nå‰ä¸€å¤©çœ‹äº†å¤§è‡´çš„æ€è·¯ï¼Œéš”äº†ä¸€å¤©ç‹¬ç«‹çš„å†™äº†ä¸€ä¸‹ï¼Œå°†å‰å¤©æ€è·¯çš„å¾ˆå¤šç»†èŠ‚éƒ½æƒ³æ˜ç™½äº†\n\n```java\npublic int strangePrinter(String s) {\n    if(s==null || s.length()<=0) return 0;\n    int N=s.length();\n    int[][] dp=new int[N][N];\n    for (int i=0;i<N;i++) {\n        dp[i][i]=1;\n    }\n    //aa        1\n    //aab       2\n    //aaba      2\n    //aabab     3\n    //aababa    4\n    for (int len=2;len<=N;len++) {\n        for (int left=0;left+len-1<N;left++) { //å·¦ç«¯ç‚¹\n            int right=left+len-1; //å³ç«¯ç‚¹\n            //å’Œå‰ä¸€ä¸ªåŒºé—´[left,right-1]çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸ç­‰,å¯ä»¥ç›´æ¥é¡ºå¸¦æ‰“å°å‡ºæ¥\n            if(s.charAt(right)==s.charAt(left)){ \n                //è‡³å°‘æ˜¯dp[left][right-1]\n                dp[left][right]=dp[left][right-1];\n                continue;\n            }\n            //æœ€å¤šæ˜¯å‰ä¸€ä¸ªåŒºé—´+1(ç›´æ¥æ‰“å°rightä½ç½®çš„å­—ç¬¦)\n            dp[left][right]=dp[left][right-1]+1; \n            //æšä¸¾[left,right)ä¸­çš„æ‰€æœ‰å­—ç¬¦,å¦‚æœæœ‰å’Œrightç›¸ç­‰çš„å°±è€ƒè™‘ä»è¿™ä¸ªä½ç½®åˆ†å‰²æ•´ä¸ªå­—ç¬¦\n            //æ¯”å¦‚ abc b è¿™ä¸ªæœ€åçš„bå°±å¯ä»¥è¿åŒå‰é¢çš„bcä¸€èµ·é¡ºå¸¦æ‰“å°å‡ºæ¥\n            //æ‰€ä»¥å½“å‰åŒºé—´çš„å€¼å°±æ˜¯å¯ä»¥æ˜¯dp[a][a]+dp[b][c],æˆ‘ä»¬ä»æ‰€æœ‰çš„è¿™ç§æƒ…å†µä¸­å–æœ€å°å€¼å°±okäº†\n            for (int i=left;i<right;i++) { \n                if(s.charAt(right)==s.charAt(i)){\n                    dp[left][right]=Math.min(dp[left][i-1]+dp[i][right-1],dp[left][right]);\n                }\n            }\n        }\n    }\n    return dp[0][N-1];\n}\n```\n`dp[left][right]`ä»£è¡¨leftåˆ°rightçš„æœ€å°‘æ‰“å°æ¬¡æ•°ï¼Œç„¶åæˆ‘ä»¬è¦ç†è§£ä¸€ç‚¹ï¼š`dp[left][right]` å…¶å®åªå¯èƒ½æœ‰ä¸¤ä¸ªå–å€¼ï¼Œ`dp[left][right-1]`æˆ–è€…`dp[left][right-1]+1`ï¼Œæˆ‘ä»¬æ±‚æœ€å°æ‰“å°æ¬¡æ•°å…¶å®å°±æ˜¯å¸Œæœ›å¢åŠ ä¸€ä¸ªå­—ç¬¦åæ‰“å°æ¬¡æ•°ä¸å˜\n\n> **eg:**  abc b è¿™ä¸ªæœ€åçš„bå°±å¯ä»¥è¿åŒå‰é¢çš„bcä¸€èµ·é¡ºå¸¦æ‰“å°å‡ºæ¥ï¼Œæ‰“å°æ¬¡æ•°ä¸å˜\n\næšä¸¾æ‰€æœ‰çš„åŒºé—´`[left,right]`ï¼Œç„¶åæšä¸¾åŒºé—´`[left,right-1]`å†…çš„å­—ç¬¦ï¼Œå¦‚æœåŒºé—´`[left,right-1]`å†…çš„æŸä¸ªå­—ç¬¦`i`å’Œ`right`ç›¸ç­‰ï¼Œé‚£ä¹ˆ`right`å°±å¯ä»¥è·Ÿéš`[i,right-1]`ä¸€èµ·é¡ºå¸¦æ‰“å°å‡ºæ¥ï¼Œè¿™æ ·è¯¥åŒºé—´çš„dpå€¼ä¸º\n\n`dp[left][right]=dp[left][i-1]+dp[i][right-1]`\nè¿™æ ·å°±æœ‰å¯èƒ½è®©æ‰“å°æ¬¡æ•°ä¸å˜ï¼Œæˆ‘ä»¬æ±‚ä¸€ä¸‹æ‰€æœ‰æƒ…å†µçš„æœ€å°å€¼å°±å¯ä»¥äº†\n\n> è¿™é¢˜çš„ä»£ç è¿˜å¯ä»¥æ›´ç®€æ´ï¼Œä¸è¿‡æˆ‘æ‡’å¾—æ”¹äº†ï¼Œæ„Ÿè§‰ä¸Šé¢çš„ä»£ç å·²ç»å¾ˆæ¸…æ™°äº†\n>\n> ps:  è¿™å‡ å¤©åšäº†ä¸å°‘æœ‰ç‚¹éš¾åº¦çš„DPé¢˜ï¼Œå‘ç°ç¡®å®è‡ªå·±å¯¹è¾¹ç•Œçš„å¤„ç†ï¼Œé€’æ¨å…¬å¼çš„ç†è§£æœ‰äº†ä¸€ç‚¹æå‡ï¼ŒåŠ æ²¹ğŸ’ª\n\n## [1547. åˆ‡æ£å­çš„æœ€å°æˆæœ¬](https://leetcode-cn.com/problems/minimum-cost-to-cut-a-stick/)\n\nDifficulty: **å›°éš¾**\n\n\næœ‰ä¸€æ ¹é•¿åº¦ä¸º `n` ä¸ªå•ä½çš„æœ¨æ£ï¼Œæ£ä¸Šä» `0` åˆ° `n` æ ‡è®°äº†è‹¥å¹²ä½ç½®ã€‚ä¾‹å¦‚ï¼Œé•¿åº¦ä¸º **6** çš„æ£å­å¯ä»¥æ ‡è®°å¦‚ä¸‹ï¼š\n\n![UTOOLS1597929649437.png](https://upload.cc/i1/2020/08/20/5m7x61.png)\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `cuts` ï¼Œå…¶ä¸­ `cuts[i]` è¡¨ç¤ºä½ éœ€è¦å°†æ£å­åˆ‡å¼€çš„ä½ç½®ã€‚\n\nä½ å¯ä»¥æŒ‰é¡ºåºå®Œæˆåˆ‡å‰²ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹åˆ‡å‰²çš„é¡ºåºã€‚\n\næ¯æ¬¡åˆ‡å‰²çš„æˆæœ¬éƒ½æ˜¯å½“å‰è¦åˆ‡å‰²çš„æ£å­çš„é•¿åº¦ï¼Œåˆ‡æ£å­çš„æ€»æˆæœ¬æ˜¯å†æ¬¡åˆ‡å‰²æˆæœ¬çš„æ€»å’Œã€‚å¯¹æ£å­è¿›è¡Œåˆ‡å‰²å°†ä¼šæŠŠä¸€æ ¹æœ¨æ£åˆ†æˆä¸¤æ ¹è¾ƒå°çš„æœ¨æ£ï¼ˆè¿™ä¸¤æ ¹æœ¨æ£çš„é•¿åº¦å’Œå°±æ˜¯åˆ‡å‰²å‰æœ¨æ£çš„é•¿åº¦ï¼‰ã€‚è¯·å‚é˜…ç¬¬ä¸€ä¸ªç¤ºä¾‹ä»¥è·å¾—æ›´ç›´è§‚çš„è§£é‡Šã€‚\n\nè¿”å›åˆ‡æ£å­çš„ **æœ€å°æ€»æˆæœ¬** ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![UTOOLS1597929677739.png](https://upload.cc/i1/2020/08/20/QGugd1.png)\n\n```go\nè¾“å…¥ï¼šn = 7, cuts = [1,3,4,5]\nè¾“å‡ºï¼š16\nè§£é‡Šï¼šæŒ‰ [1, 3, 4, 5] çš„é¡ºåºåˆ‡å‰²çš„æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºï¼š\n\nç¬¬ä¸€æ¬¡åˆ‡å‰²é•¿åº¦ä¸º 7 çš„æ£å­ï¼Œæˆæœ¬ä¸º 7 ã€‚ç¬¬äºŒæ¬¡åˆ‡å‰²é•¿åº¦ä¸º 6 çš„æ£å­ï¼ˆå³ç¬¬ä¸€æ¬¡åˆ‡å‰²å¾—åˆ°çš„ç¬¬äºŒæ ¹æ£å­ï¼‰ï¼Œç¬¬ä¸‰æ¬¡åˆ‡å‰²ä¸ºé•¿åº¦ 4 çš„æ£å­ï¼Œæœ€ååˆ‡å‰²é•¿åº¦ä¸º 3 çš„æ£å­ã€‚æ€»æˆæœ¬ä¸º 7 + 6 + 4 + 3 = 20 ã€‚\nè€Œå°†åˆ‡å‰²é¡ºåºé‡æ–°æ’åˆ—ä¸º [3, 5, 1, 4] åï¼Œæ€»æˆæœ¬ = 16ï¼ˆå¦‚ç¤ºä¾‹å›¾ä¸­ 7 + 4 + 3 + 2 = 16ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šn = 9, cuts = [5,6,1,4,2]\nè¾“å‡ºï¼š22\nè§£é‡Šï¼šå¦‚æœæŒ‰ç»™å®šçš„é¡ºåºåˆ‡å‰²ï¼Œåˆ™æ€»æˆæœ¬ä¸º 25 ã€‚æ€»æˆæœ¬ <= 25 çš„åˆ‡å‰²é¡ºåºå¾ˆå¤šï¼Œä¾‹å¦‚ï¼Œ[4ï¼Œ6ï¼Œ5ï¼Œ2ï¼Œ1] çš„æ€»æˆæœ¬ = 22ï¼Œæ˜¯æ‰€æœ‰å¯èƒ½æ–¹æ¡ˆä¸­æˆæœ¬æœ€å°çš„ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `2 <= n <= 10^6`\n*   `1 <= cuts.length <= min(n - 1, 100)`\n*   `1 <= cuts[i] <= n - 1`\n*   `cuts` æ•°ç»„ä¸­çš„æ‰€æœ‰æ•´æ•°éƒ½ **äº’ä¸ç›¸åŒ**\n\n**è§£æ³•ä¸€**\n\n201thå‘¨èµ›çš„t4ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä»Šå¤©è¡¥çš„æ—¶å€™èŠ±äº†10åˆ†é’Ÿææ¸…æ¥šæ€è·¯ï¼Œä¸€éçœ‹è§†é¢‘ä¸€è¾¹å†™ï¼Œæœ€åä¸å‡ºæ„å¤–çš„çš„Täº†~ğŸ˜‚ä¸€å¼€å§‹æ²¡æƒ³æ¸…æ¥šç»†èŠ‚ï¼Œæƒ³åˆ°äº†ä»¥åŒºé—´å¼€å§‹å’Œç»“å°¾åšdpï¼Œç„¶åå°±ç›´æ¥å¼€äº†ä¸ªn*nçš„æ•°ç»„ï¼Œè™½ç„¶æ˜¯å¯¹çš„ï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±täº†ï¼Œè¿™é‡Œå®é™…ä¸Šåªéœ€è¦å¼€ä¸€ä¸ªlen(cuts)^2çš„ç©ºé—´å°±è¡Œäº†\n```golang\nfunc minCost(n int, cut []int) int {\n    sort.Ints(cut)\n    //åœ¨å‰ååŠ ä¸Š0å’Œn\n    cut = append(cut, n)\n    cut = append([]int{0}, cut...)\n    var Min = func(a,b int) int {if a<b {return a};return b}\n    var m = len(cut)\n    //dp[i][j]åˆ‡å‰²i,jçš„æˆæœ¬\n    var dp = make([][]int, m)\n    for i := 0; i < m; i++ {\n        dp[i] = make([]int, m)\n        if i < m-1 {\n            dp[i][i+1] = 0   \n        }\n    }\n    for tlen := 2; tlen <= m; tlen++ {\n        for left := 0; left+tlen < m; left++ {\n            right := left+tlen //æ³¨æ„è¿™é‡Œä¸åŠ 1\n            dp[left][right] = math.MaxInt32\n            for k := left+1; k < right; k++ {\n                dp[left][right] = Min(dp[left][right], dp[left][k]+dp[k][right]+cut[right]-cut[left])\n            }\n        }\n    }\n    return dp[0][m-1]\n}\n```\nä¸€å¼€å§‹tleçš„**é”™è¯¯**ä»£ç \n```golang\nfunc minCost(n int, cut []int) int {\n    sort.Ints(cut)\n    //0,1,3,4,5,6\n    cut = append(cut, n)\n    cut = append([]int{0}, cut...)\n    var Min = func(a,b int) int {if a<b {return a};return b}\n    var m = len(cut)\n    var dp = make([][]int, n+1)\n    for i := 0; i <= n; i++ {\n        dp[i] = make([]int, n+1) //è¿™é‡Œå°±täº†\n        // for j := 0; j <= n; j++ {\n        //     dp[i][j] = math.MaxInt32\n        // }\n    }\n    for i := 0; i < m-1; i++ {\n        for j := i+1; j < m; j++ {\n            dp[cut[i]][cut[j]] = 0x3f3f3f3f\n        }\n        dp[cut[i]][cut[i+1]] = 0\n    }\n    for tlen := 2; tlen <= m; tlen++ {\n        for left := 0; left+tlen-1 < m; left++ {\n            right := left+tlen-1\n            for k := left+1; k < right; k++ {\n                dp[cut[left]][cut[right]] = Min(dp[cut[left]][cut[right]], dp[cut[left]][cut[k]] + dp[cut[k]][cut[right]] + cut[right]-cut[left])\n            }\n        }\n    }\n    return dp[0][n]\n}\n```\n\n## _æ•°ä½DP_\n\n## [233. æ•°å­— 1 çš„ä¸ªæ•°](https://leetcode-cn.com/problems/number-of-digit-one/)\n\nç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè®¡ç®—æ‰€æœ‰å°äºç­‰äº n çš„éè´Ÿæ•´æ•°ä¸­æ•°å­— 1 å‡ºç°çš„ä¸ªæ•°ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: 13\nè¾“å‡º: 6 \nè§£é‡Š: æ•°å­— 1 å‡ºç°åœ¨ä»¥ä¸‹æ•°å­—ä¸­: 1, 10, 11, 12, 13 ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nè¿™ä¸ªé¢˜å…¶å®å›°æ‰°äº†æˆ‘å¾ˆé•¿æ—¶é—´ï¼Œä¹‹å‰çœ‹äº†å¥½å‡ æ¬¡éƒ½æ”¾å¼ƒäº†ï¼Œæ„Ÿè§‰æœ‰äº›æ‰¾è§„å¾‹çš„æ•°å­¦è§£æ³•å¤ªéš¾æƒ³åˆ°äº†ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥é‡‡ç”¨**æ•°ä½DP**ï¼Œç›¸å¯¹äºå…¶ä»–çš„è§£æ³•ï¼Œè¿™ç§è§£æ³•ä¼šæ›´åŠ å¥—è·¯æ¨¡æ¿åŒ–\n```java\n//dp[pos][sumOne]ä»£è¡¨æšä¸¾åˆ°posä½ç½®ï¼Œå‰é¢1å‡ºç°çš„ä¸ªæ•°ä¸ºsumOneçš„æ—¶å€™ï¼Œposåˆ°æœ€ä½ä½å‡ºç°çš„æ•°å­—1çš„ä¸ªæ•°\nint [][] dp=null;\n\npublic int countDigitOne(int n) {\n    int len=0;\n    int[] num=new int[64]; //64ä½è‚¯å®šå¤Ÿäº†\n    while(n!=0){\n        num[len++]=n%10;\n        n/=10;\n    }\n    dp=new int[len+1][len+1];\n    //ä»é«˜ä½å‘ä½ä½æšä¸¾\n    return dfs(num,len-1,0,true,true);\n}\n\npublic int dfs(int[] num,int pos,int sumOne,boolean leadZero,boolean limit){\n    //æšä¸¾å®Œæ‰€æœ‰çš„æ•°ä½ï¼Œç›´æ¥è¿”å›sumOne(è¿™ä¸ªæ•°æœ‰å¤šå°‘ä¸ª1)\n    if(pos==-1) return sumOne;\n    //çŠ¶æ€é‡å ï¼ŒçŠ¶æ€è¦å®Œå…¨ä¸€è‡´\n    if(!leadZero && !limit && dp[pos][sumOne]!=0) return dp[pos][sumOne];\n    int res=0;\n    int up=limit?num[pos]:9;\n    for (int i=0;i<=up;i++) {\n        res+=dfs(num,pos-1,sumOne+(i==1?1:0),leadZero&&i==0,i==up&&limit);\n    }\n    if(!leadZero && !limit) dp[pos][sumOne]=res;\n    return res;\n}\n```\n\nä¼˜åŒ–ä¸‹ä»£ç ï¼Œå‰å¯¼0å¯¹çŠ¶æ€å­˜å–æ²¡æœ‰å½±å“ï¼Œè¿™é‡Œè€ƒè™‘çš„æ˜¯æ•°å­—çš„ç»„æˆ\n\n```java\n//ç®€åŒ–ä¸‹ä»£ç ï¼Œå‰å¯¼0å…¶å®æ²¡æœ‰å½±å“\n//dp[pos][sumOne]ä»£è¡¨ä»é«˜ä½æšä¸¾åˆ°posä½ç½®ï¼Œå‰é¢1çš„ä¸ªæ•°sumOneæ—¶\nint [][] dp=null;\n\npublic int countDigitOne(int n) {\n    int len=0;\n    int[] num=new int[64]; //64ä½è‚¯å®šå¤Ÿäº†\n    while(n!=0){\n        num[len++]=n%10;\n        n/=10;\n    }\n    dp=new int[len+1][len+1];\n    //ä»é«˜ä½å‘ä½ä½æšä¸¾\n    return dfs(num,len-1,0,true);\n}\n\npublic int dfs(int[] num,int pos,int sumOne,boolean limit){\n    //æšä¸¾å®Œæ‰€æœ‰çš„æ•°ä½ï¼Œç›´æ¥è¿”å›sumOne\n    if(pos==-1) return sumOne;\n    //çŠ¶æ€é‡å ï¼ŒçŠ¶æ€è¦å®Œå…¨ä¸€è‡´\n    if(!limit && dp[pos][sumOne]!=0) return dp[pos][sumOne];\n    int res=0;\n    int up=limit?num[pos]:9;\n    for (int i=0;i<=up;i++) {\n        res+=dfs(num,pos-1,sumOne+(i==1?1:0),i==up&&limit);\n    }\n    if(!limit) dp[pos][sumOne]=res;\n    return res;\n}\n```\n**Update: 2020.6.24**\n\nç”¨goé‡å†™äº†ä¸‹ï¼ŒåŒæ—¶å‘ç°ä¹‹å‰å¯¹è¿™ä¸ªçŠ¶æ€çš„ç†è§£æ˜¯é”™çš„ã€‚\n\n```golang\nfunc countDigitOne(n int) int {\n    var nums []int\n    for n > 0 {\n        nums = append(nums, n%10)\n        n /= 10\n    }\n    dp := make([][]int, len(nums))\n    for i := 0; i < len(dp); i++ {\n        dp[i] = make([]int, len(nums))\n    }\n    return dfs(len(nums)-1, 0, true, nums, dp)\n}\n\nfunc dfs(pos int, cnt int, limit bool, nums []int, dp [][]int) int {\n    if pos == -1 {\n        return cnt\n    }\n    if !limit && dp[pos][cnt] != 0 {\n        return dp[pos][cnt]\n    }\n    var up = 9\n    if limit {\n        up = nums[pos]\n    }\n    var res = 0\n    for i := 0; i <= up; i++ {\n        if i == 1 {\n            res += dfs(pos-1, cnt+1, i == up && limit, nums, dp)\n        } else {\n            res += dfs(pos-1, cnt, i == up && limit, nums, dp)\n        }\n    }\n    if !limit {\n        dp[pos][cnt] = res\n    }\n    return res\n}\n```\nè¿™é‡Œ`cnt`æŒ‡çš„å…¶å®æ˜¯`[æœ€é«˜ä½ ~ posä½]`çš„1å‡ºç°çš„ä¸ªæ•°ï¼Œå½“posä¸º-1çš„æ—¶å€™å…¶å®å°±æ˜¯åˆ°è¾¾äº†æŸä¸€ä¸ªå…·ä½“çš„æ•°å­—ï¼Œæ¯”å¦‚`1231`è¿™ä¸ªæ—¶å€™å°±ä¼šè¿”å›`cnt=2`ï¼Œä¸æ­¤åŒæ—¶ï¼Œcntä¹Ÿæ˜¯çŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚`n=1200 , pos=1 , cnt=1`è¡¨ç¤ºæšä¸¾åˆ°äº†ç¬¬1ä½å‡ºç°äº†1ä¸ª1ï¼Œå°±è¯´æ˜é«˜ä¸¤ä½`1`å‡ºç°äº†1æ¬¡ï¼Œä¹Ÿå°±æ˜¯`10`æˆ–è€…`01`ï¼Œè¿™ä¸ªæ—¶å€™å½“æˆ‘ä»¬å…ˆæ±‚å‡ºäº†`01xx(0100 ~ 0199)`ä¸­çš„1çš„ä¸ªæ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œå½“å‰æˆ‘ä»¬ä¸‹æ¬¡å†é‡åˆ°è¿™ä¸ªçŠ¶æ€çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯`10xx`çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†å‰é¢`01xx`çš„dpå€¼è¿”å›ï¼Œå› ä¸º`01xx`å’Œ`10xx`åŒ…å«çš„1çš„æ•°é‡è‚¯å®šæ˜¯ä¸€æ ·çš„ï¼Œæ— éœ€é‡å¤è®¡ç®—\n\n> **æ•°ä½DP**çš„æ¦‚å¿µå’Œæ¨¡æ¿å…¶å®æˆ‘ä¹Ÿæ˜¯ä¸‹åˆåœ¨ç½‘ä¸ŠæŸ¥çš„ï¼Œç„¶åæ‰¾åˆ°äº†ä¸¤ä¸ªå†™çš„æ¯”è¾ƒå¥½çš„æ–‡ç«  [æ•°ä½dpæ€»ç»“ ä¹‹ ä»å…¥é—¨åˆ°æ¨¡æ¿](https://blog.csdn.net/wust_zzwh/article/details/52100392)ï¼Œ[æ•°å­—ç»„æˆçš„å¥¥å¦™â€”â€”æ•°ä½dp](https://www.luogu.com.cn/blog/virus2017/shuweidp) ä»¥åé‡åˆ°ç±»ä¼¼çš„é¢˜åˆå¤šäº†ä¸€ç§è§£æ³•ï¼ˆæ•°å­¦çš„è§£æ³•è‡³ä»Šä»æ²¡å­¦ä¼šğŸ¤£ï¼‰åªæœ‰è¿™ä¸€é¢˜æƒ³ææ‡‚**æ•°ä½DP**è¿˜æ˜¯ä¸å¤ªå¤Ÿï¼Œè¿™é¢˜è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿˜æ˜¯è¦å¤šåšé¢˜ï¼Œå¤šæ€»ç»“æ‰èƒ½æ…¢æ…¢ä½“ä¼šï¼Œlcä¸Šå¥½åƒæ•°ä½dpå¥½åƒå¹¶ä¸å¤šï¼Œè¿‡ä¸¤å¤©éƒ½åšä¸€ä¸‹è¯•è¯•\n\n## [1420. ç”Ÿæˆæ•°ç»„](https://leetcode-cn.com/problems/build-array-where-you-can-find-the-maximum-exactly-k-comparisons/) \n\nç»™ä½ ä¸‰ä¸ªæ•´æ•° `n`ã€`m` å’Œ `k` ã€‚ä¸‹å›¾æè¿°çš„ç®—æ³•ç”¨äºæ‰¾å‡ºæ­£æ•´æ•°æ•°ç»„ä¸­æœ€å¤§çš„å…ƒç´ ã€‚\n\n![JdU4w8.png](https://s1.ax1x.com/2020/04/23/JdU4w8.png)\n\nè¯·ä½ ç”Ÿæˆä¸€ä¸ªå…·æœ‰ä¸‹è¿°å±æ€§çš„æ•°ç»„ arr ï¼š\n\n- arr ä¸­æœ‰ n ä¸ªæ•´æ•°ã€‚\n- 1 <= arr[i] <= m å…¶ä¸­ (0 <= i < n) ã€‚\n- å°†ä¸Šé¢æåˆ°çš„ç®—æ³•åº”ç”¨äº arr ï¼Œsearch_cost çš„å€¼ç­‰äº k ã€‚\n\nè¿”å›ä¸Šè¿°æ¡ä»¶ä¸‹ç”Ÿæˆæ•°ç»„ arr çš„ æ–¹æ³•æ•° ï¼Œç”±äºç­”æ¡ˆå¯èƒ½ä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥ å¿…é¡» å¯¹ 10^9 + 7 å–ä½™ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 2, m = 3, k = 1\nè¾“å‡ºï¼š6\nè§£é‡Šï¼šå¯èƒ½çš„æ•°ç»„åˆ†åˆ«ä¸º [1, 1], [2, 1], [2, 2], [3, 1], [3, 2] [3, 3]\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 5, m = 2, k = 3\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šæ²¡æœ‰æ•°ç»„å¯ä»¥æ»¡è¶³ä¸Šè¿°æ¡ä»¶\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 9, m = 1, k = 1\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šå¯èƒ½çš„æ•°ç»„åªæœ‰ [1, 1, 1, 1, 1, 1, 1, 1, 1]\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 50, m = 100, k = 25\nè¾“å‡ºï¼š34549172\nè§£é‡Šï¼šä¸è¦å¿˜äº†å¯¹ 1000000007 å–ä½™\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šn = 37, m = 17, k = 7\nè¾“å‡ºï¼š418930126\n```\n\n**æç¤ºï¼š**\n\n- 1 <= n <= 50\n- 1 <= m <= 100\n- 0 <= k <= n \n\n**è§£æ³•ä¸€**\n\n185å‘¨èµ›T4ï¼Œç±»ä¼¼äºæ•°ä½DPï¼Œè®°å¿†åŒ–é€’å½’çš„æ–¹å¼å¾ˆå¥½ç†è§£\n\n```java\nint mod=(int)1e9+7;\n\nInteger [][][] dp=null;\n\npublic int numOfArrays(int n, int m, int k) {\n    dp=new Integer[n+1][m+1][k+1];\n    return dfs(n,0,m,k);\n}\n\npublic int dfs(int pos,int preMax,int m,int k){\n    if(k==0 && pos==0) return dp[pos][preMax][k]=1;\n    //k=0ä½†æ˜¯posä¸ä¸º0å¹¶æ²¡æœ‰ç»“æŸ,è¿˜å¯ä»¥ç»§ç»­æ‰¾æ¯”preMaxå°çš„å…ƒç´ \n    //if(pos==0 || k==0) return 0; \n    if(pos==0 || k<0) return 0;\n    if(dp[pos][preMax][k]!=null){\n        return dp[pos][preMax][k];\n    }\n    long res=0;\n    for (int i=1;i<=m;i++) {\n        if(i>preMax){ //å¤§äºpreMax,ä»£ä»·-1,æ›´æ–°æœ€å¤§å€¼\n            res=(res+dfs(pos-1,i,m,k-1))%mod;\n        }else{ //å°äºpreMax,ä»£ä»·ä¸å˜,æœ€å¤§å€¼ä¸å˜\n            res=(res+dfs(pos-1,preMax,m,k))%mod;\n        }\n    }\n    return dp[pos][preMax][k]=(int)(res%mod);\n}\n```\nä¸€å¼€å§‹æ²¡æ³¨æ„ç»™dpæ•°ç»„èµ‹åˆå§‹å€¼ï¼Œç›´æ¥æŒ‰ç…§0åˆ¤æ–­çš„ï¼Œç»“æœTäº†åŠå¤©ï¼Œæˆ‘éƒ½æ‡µäº†äº†ï¼Œåæ¥æ‰æ„è¯†åˆ°ï¼Œå¾ˆå¤šçŠ¶æ€çš„ç»“æœå°±æ˜¯0ï¼Œä½ ç›´æ¥æŒ‰ç…§0åˆ¤æ–­ï¼Œå¾ˆå¤šç›¸åŒçš„dpå€¼ä¸º0çš„çŠ¶æ€éƒ½æ²¡æœ‰è¢«å–å‡ºæ¥ç”¨\n\n**ä¼˜åŒ–**\n\n```java\nint mod=(int)1e9+7;\n\nLong [][][] dp=null;\n\npublic int numOfArrays(int n, int m, int k) {\n    dp=new Long[n+1][m+1][k+1];\n    return (int)dfs(n,0,m,k);\n}\n\npublic long dfs(int pos,int preMax,int m,int k){\n    if(k==0 && pos==0) return dp[pos][preMax][k]=1L;\n    //k=0ä½†æ˜¯posä¸ä¸º0å¹¶æ²¡æœ‰ç»“æŸ,è¿˜å¯ä»¥ç»§ç»­æ‰¾æ¯”preMaxå°çš„å…ƒç´ \n    //if(pos==0 || k==0) return 0; \n    if(pos==0 || k<0) return 0L;\n    if(dp[pos][preMax][k]!=null){\n        return dp[pos][preMax][k];\n    }\n    long res=0;\n    //å°äºç­‰äºpreMaxçš„éƒ¨åˆ†å¯ä»¥é€šè¿‡dfs(pos-1,preMax,m,k)ç®—å‡ºæ¥,å‡å°‘é€’å½’æ¬¡æ•°\n    res=(res+(preMax*dfs(pos-1,preMax,m,k))%mod)%mod;\n    for (int i=preMax+1;i<=m;i++) {\n        res=(res+dfs(pos-1,i,m,k-1))%mod;\n    }\n    return dp[pos][preMax][k]=res%mod;\n}\n```\n**è§£æ³•äºŒ**\n\né€’æ¨çš„æ–¹å¼ï¼Œå…¶å®æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰å¹¶ä¸æ˜¯ç‰¹åˆ«å®¹æ˜“ç›´æ¥æƒ³å‡ºæ¥\n\n```java\npublic int numOfArrays(int n, int m, int k) {\n    int mod=1000_000_007;\n\n    long[][][] dp=new long[n+1][m+1][k+1];\n    for(int i=1;i<=m;i++){\n        dp[1][i][1]=1;\n    }\n    for(int i=2;i<=n;i++){\n        for(int j=1;j<=m;j++){\n            for(int cost=1;cost<=k;cost++){\n                //æ–°å¢åŠ çš„å…ƒç´ å°äºç­‰äºjä¹Ÿå°±æ˜¯åŸæ•°ç»„çš„æœ€å¤§å€¼,å¯¹åº”ä¸Šé¢é€’å½’çš„i<=preMax\n                //æ‰€ä»¥æ–°å¢åŠ çš„å…ƒç´ åœ¨æ–°æ•°ç»„çš„æœ«å°¾æœ‰1~jç§é€‰æ‹©\n                dp[i][j][cost]=(j*dp[i-1][j][cost])%mod;\n                for(int nm=1;nm<j;nm++){\n                    //æ–°å¢åŠ çš„å…ƒç´ å¤§äºåŸæ•°ç»„çš„æœ€å¤§å€¼j,å¯¹åº”ä¸Šé¢é€’å½’çš„i>preMax\n                    dp[i][j][cost]=(dp[i][j][cost]+dp[i-1][nm][cost-1])%mod;\n                }\n            }\n        }\n    }\n    long res=0;\n    for(int i=1;i<=m;i++){\n        res+=dp[n][i][k];\n        res%=mod;\n    }\n    return (int)(res%mod);\n}\n```\n\n## [902. æœ€å¤§ä¸º N çš„æ•°å­—ç»„åˆ](https://leetcode-cn.com/problems/numbers-at-most-n-given-digit-set/)\n\nDifficulty: **å›°éš¾**\n\n\næˆ‘ä»¬æœ‰ä¸€ç»„**æ’åºçš„**æ•°å­— `D`ï¼Œå®ƒæ˜¯Â  `{'1','2','3','4','5','6','7','8','9'}`Â çš„éç©ºå­é›†ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œ`'0'` ä¸åŒ…æ‹¬åœ¨å†…ã€‚ï¼‰\n\nç°åœ¨ï¼Œæˆ‘ä»¬ç”¨è¿™äº›æ•°å­—è¿›è¡Œç»„åˆå†™æ•°å­—ï¼Œæƒ³ç”¨å¤šå°‘æ¬¡å°±ç”¨å¤šå°‘æ¬¡ã€‚ä¾‹å¦‚Â `D = {'1','3','5'}`ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºåƒÂ `'13', '551', '1351315'`Â è¿™æ ·çš„æ•°å­—ã€‚\n\nè¿”å›å¯ä»¥ç”¨ `D` ä¸­çš„æ•°å­—å†™å‡ºçš„å°äºæˆ–ç­‰äº `N` çš„æ­£æ•´æ•°çš„æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```\nè¾“å…¥ï¼šD = [\"1\",\"3\",\"5\",\"7\"], N = 100\nè¾“å‡ºï¼š20\nè§£é‡Šï¼š\nå¯å†™å‡ºçš„ 20 ä¸ªæ•°å­—æ˜¯ï¼š\n1, 3, 5, 7, 11, 13, 15, 17, 31, 33, 35, 37, 51, 53, 55, 57, 71, 73, 75, 77.\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```\nè¾“å…¥ï¼šD = [\"1\",\"4\",\"9\"], N = 1000000000\nè¾“å‡ºï¼š29523\nè§£é‡Šï¼š\næˆ‘ä»¬å¯ä»¥å†™ 3 ä¸ªä¸€ä½æ•°å­—ï¼Œ9 ä¸ªä¸¤ä½æ•°å­—ï¼Œ27 ä¸ªä¸‰ä½æ•°å­—ï¼Œ\n81 ä¸ªå››ä½æ•°å­—ï¼Œ243 ä¸ªäº”ä½æ•°å­—ï¼Œ729 ä¸ªå…­ä½æ•°å­—ï¼Œ\n2187 ä¸ªä¸ƒä½æ•°å­—ï¼Œ6561 ä¸ªå…«ä½æ•°å­—å’Œ 19683 ä¸ªä¹ä½æ•°å­—ã€‚\næ€»å…±ï¼Œå¯ä»¥ä½¿ç”¨Dä¸­çš„æ•°å­—å†™å‡º 29523 ä¸ªæ•´æ•°ã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  `D` æ˜¯æŒ‰æ’åºé¡ºåºçš„æ•°å­— `'1'-'9'` çš„å­é›†ã€‚\n2.  `1 <= N <= 10^9`\n\n**è§£æ³•ä¸€**\n\nlcä¸Šå†™çš„ç¬¬3é“æ•°ä½DPï¼Œå¥—æ¨¡æ¿ï¼Œç†è§£çš„è¿˜ä¸å¤Ÿæ·±åˆ»ï¼Œç­‰ä»¥ååšå¤šäº†å†å•ç‹¬å¼€ä¸“é¢˜è®²è§£\n```java\nboolean[] dict;\n\nint[] nums;\n\nInteger[] dp;\n\npublic int atMostNGivenDigitSet(String[] D, int N) {\n    int pos = -1;\n    nums = new int[64];\n    while (N > 0) {\n        nums[++pos] = N % 10;\n        N /= 10;\n    }\n    dict = new boolean[10];\n    dp = new Integer[pos + 1];\n    for (int i = 0; i < D.length; i++) {\n        dict[Integer.valueOf(D[i])] = true;\n    }\n    return dfs(pos, true, true);\n}\n\n//ä»pos~0æœ‰å¤šå°‘ä¸ªåˆæ³•çš„æ•°\npublic int dfs(int pos, boolean leadZero, boolean limit) {\n    if (pos == -1) {\n        //æšä¸¾å®Œæ‰€æœ‰çš„æ•°ä½ï¼Œæ²¡æœ‰å‰å¯¼0è¯´æ˜æ‰¾åˆ°äº†ä¸€ä¸ªåˆæ³•çš„æ•°\n        return leadZero ? 0 : 1;\n    }\n    if (!leadZero && !limit && (dp[pos] != null)) {\n        return dp[pos];\n    }\n    int res = 0;\n    int up = limit ? nums[pos] : 9;\n    for (int i = 0; i <= up; i++) {\n        //å‰é¢å…¨æ˜¯0 || å½“å‰ä½åœ¨dictä¸­\n        if ((leadZero && (i == 0)) || dict[i]) {\n            res += dfs(pos - 1, leadZero && (i == 0), limit && (i == up));\n        }\n    }\n    if (!leadZero && !limit) {\n        dp[pos] = res;\n    }\n    return res;\n}\n```\n\n## _çŠ¶å‹DP_\n\n## [464. æˆ‘èƒ½èµ¢å—](https://leetcode-cn.com/problems/can-i-win/)\n\nåœ¨ \"100 game\" è¿™ä¸ªæ¸¸æˆä¸­ï¼Œä¸¤åç©å®¶è½®æµé€‰æ‹©ä» 1 åˆ° 10 çš„ä»»æ„æ•´æ•°ï¼Œç´¯è®¡æ•´æ•°å’Œï¼Œå…ˆä½¿å¾—ç´¯è®¡æ•´æ•°å’Œè¾¾åˆ° 100 çš„ç©å®¶ï¼Œå³ä¸ºèƒœè€…ã€‚\n\nå¦‚æœæˆ‘ä»¬å°†æ¸¸æˆè§„åˆ™æ”¹ä¸º â€œç©å®¶ä¸èƒ½é‡å¤ä½¿ç”¨æ•´æ•°â€ å‘¢ï¼Ÿ\n\nä¾‹å¦‚ï¼Œä¸¤ä¸ªç©å®¶å¯ä»¥è½®æµä»å…¬å…±æ•´æ•°æ± ä¸­æŠ½å–ä» 1 åˆ° 15 çš„æ•´æ•°ï¼ˆä¸æ”¾å›ï¼‰ï¼Œç›´åˆ°ç´¯è®¡æ•´æ•°å’Œ >= 100ã€‚\n\nç»™å®šä¸€ä¸ªæ•´æ•° `maxChoosableInteger` ï¼ˆæ•´æ•°æ± ä¸­å¯é€‰æ‹©çš„æœ€å¤§æ•°ï¼‰å’Œå¦ä¸€ä¸ªæ•´æ•° `desiredTotal`ï¼ˆç´¯è®¡å’Œï¼‰ï¼Œåˆ¤æ–­å…ˆå‡ºæ‰‹çš„ç©å®¶æ˜¯å¦èƒ½ç¨³èµ¢ï¼ˆå‡è®¾ä¸¤ä½ç©å®¶æ¸¸æˆæ—¶éƒ½è¡¨ç°æœ€ä½³ï¼‰ï¼Ÿ\n\nä½ å¯ä»¥å‡è®¾ `maxChoosableInteger` ä¸ä¼šå¤§äº 20ï¼Œ `desiredTotal` ä¸ä¼šå¤§äº 300ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š\nmaxChoosableInteger = 10\ndesiredTotal = 11\n\nè¾“å‡ºï¼š\nfalse\n\nè§£é‡Šï¼š\næ— è®ºç¬¬ä¸€ä¸ªç©å®¶é€‰æ‹©å“ªä¸ªæ•´æ•°ï¼Œä»–éƒ½ä¼šå¤±è´¥ã€‚\nç¬¬ä¸€ä¸ªç©å®¶å¯ä»¥é€‰æ‹©ä» 1 åˆ° 10 çš„æ•´æ•°ã€‚\nå¦‚æœç¬¬ä¸€ä¸ªç©å®¶é€‰æ‹© 1ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªç©å®¶åªèƒ½é€‰æ‹©ä» 2 åˆ° 10 çš„æ•´æ•°ã€‚\nç¬¬äºŒä¸ªç©å®¶å¯ä»¥é€šè¿‡é€‰æ‹©æ•´æ•° 10ï¼ˆé‚£ä¹ˆç´¯ç§¯å’Œä¸º 11 >= desiredTotalï¼‰ï¼Œä»è€Œå–å¾—èƒœåˆ©.\nåŒæ ·åœ°ï¼Œç¬¬ä¸€ä¸ªç©å®¶é€‰æ‹©ä»»æ„å…¶ä»–æ•´æ•°ï¼Œç¬¬äºŒä¸ªç©å®¶éƒ½ä¼šèµ¢ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nä» [åŠ›æ‰£ä¸Šçš„ DP é—®é¢˜åˆ†ç±»æ±‡æ€»](https://leetcode-cn.com/circle/article/NfHhXD/) è¿‡æ¥çš„ï¼Œæ‰€ä»¥é¦–å…ˆçŸ¥é“è¿™ä¸ªæ˜¯çŠ¶å‹DPï¼Œä½†æ˜¯èœé¸¡çš„æˆ‘å¹¶ä¸çŸ¥é“çŠ¶å‹DPæ˜¯å•¥ğŸ¤£ï¼Œæ‰€ä»¥å…ˆå†™äº†ä¸ªæš´åŠ›çš„æœç´¢ï¼Œç„¶åä¸å‡ºæ„æ–™çš„täº†\n\n```java\n//TLE case 20 210 41/45\npublic boolean canIWin(int maxChoosableInteger, int desiredTotal) {\n    if(desiredTotal<=maxChoosableInteger) return true;\n    if((1+maxChoosableInteger)*(maxChoosableInteger)/2<desiredTotal) return false;\n    boolean[] visit=new boolean[maxChoosableInteger+1];\n    return dfs(maxChoosableInteger,desiredTotal,visit);\n}\n\npublic boolean dfs(int max,int total,boolean[] visit){\n    if(total<=0) return false; //å‰äººå·²ç»æ‹¿å®Œäº†\n    for (int i=1;i<=max;i++) {\n        if(!visit[i]){\n            visit[i]=true;\n            boolean temp=dfs(max,total-i,visit);\n            visit[i]=false;\n            if(!temp){\n                return true;\n            }\n        }\n    }\n    return false;\n}\n```\næ³¨æ„è¿™ä¸ªå†™æ³•çš„è¿”å›æ—¶æœºï¼Œæœ‰äº›è¯­å¥æ˜¯ä¸èƒ½åˆå¹¶çš„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·å°±æ˜¯é”™çš„ï¼ˆåˆ«é—®æˆ‘ä¸ºå•¥çŸ¥é“çš„ğŸ¤£ï¼‰\n\n```java\npublic boolean dfs(int max,int total,boolean[] visit){\n    if(total<=0) return false;\n    for (int i=1;i<=max;i++) {\n        if(!visit[i]){\n            visit[i]=true;\n            if(!dfs(max,total-i,visit)){\n                return true;\n            }\n            visit[i]=false;\n        }\n    }\n    return false;\n}\n```\n\nåƒä¸Šé¢è¿™æ ·å†™ä¹ä¸€çœ‹å¥½åƒæ²¡é—®é¢˜ï¼Œå¯¹æ¯”ä¸€ä¸‹ä¸¤ç§å†™æ³•ï¼Œå…¶å®å°±æ˜¯å›æº¯`visit`çš„æ—¶æœºä¸åŒï¼Œç¬¬ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªäºº`dfs` ä¸ç®¡æˆåŠŸä¸å¦éƒ½ä¼šå›æº¯çŠ¶æ€ï¼Œè€Œç¬¬äºŒç§æ˜¯å¦ä¸€ä¸ªäºº`dfs` æˆåŠŸåæ‰ä¼šå›æº¯çŠ¶æ€ï¼Œå¤±è´¥åå°±ä¸ä¼šå›æº¯çŠ¶æ€äº†ï¼Œä½†æ˜¯åœ¨è¿™é¢˜ä¸­ä¸ç®¡å¦ä¸€ä¸ªäººå¤±è´¥ä¸å¦éƒ½éœ€è¦å›æº¯çŠ¶æ€ï¼Œé¦–å…ˆå¦ä¸€ä¸ªäººæˆåŠŸåæˆ‘è‚¯å®šæ˜¯è¦å›æº¯ï¼Œå¦ä¸€ä¸ªäººæˆåŠŸæ„å‘³ç€æˆ‘å¤±è´¥äº†ï¼Œæˆ‘è¿˜è¦ç»§ç»­å°è¯•æ‰¾å¿…èƒœçš„é€‰å–æ–¹æ³•ï¼Œä½†æ˜¯å¦ä¸€ä¸ªäººå¤±è´¥åè¿˜æ˜¯éœ€è¦å›æº¯çŠ¶æ€ï¼Œä»”ç»†æƒ³æƒ³ï¼Œä¸‹ä¸€å±‚dfs(å¦ä¸€ä¸ªäºº)å¤±è´¥æ˜¯å› ä¸ºä¸‹ä¸‹ä¸€å±‚dfs(æˆ‘)æˆåŠŸäº†ï¼Œæˆ‘åœ¨é‚£ä¸€æ¬¡æˆåŠŸåå¹¶æ²¡æœ‰å›æº¯`visit`ï¼Œè¿™æ ·ä¸‹ä¸€å±‚ï¼ˆå¦ä¸€ä¸ªäººï¼‰å°±ç”¨ä¸äº†è¢«ä¸‹ä¸‹å±‚å ç”¨çš„æ•°å­—ï¼Œå°±æ— æ³•æšä¸¾æ‰€æœ‰æƒ…å†µï¼Œè‡ªç„¶å°±é”™äº†\n\n> å„ä½å¤§ä½¬è§è°…ï¼Œè¡¨è¾¾èƒ½åŠ›æœ‰é™ï¼Œä¸Šé¢çš„éƒ½æ˜¯æˆ‘èƒ¡è¨€ä¹±è¯­ï¼Œå¤§ä½¬ä»¬è·³è¿‡å°±è¡Œäº†\n\n**è§£æ³•äºŒ**\n\næ ¹æ®æ˜¨å¤©å†™çš„ä¸€ä¸ªæ•°ä½DPï¼ŒåŠ ä¸Šè‡ªå·±çš„yyï¼Œå†™äº†ä¸ªçŠ¶å‹DPå‡ºæ¥äº†ğŸ¤£ï¼Œä¸Šé¢çš„è§£æ³•æ˜æ˜¾ä¼šæœ‰å¾ˆå¤šçš„é‡å¤è§£ï¼Œè€Œç¡®å®šæ˜¯å¦é‡å¤çš„å…³é”®å…¶å®å°±æ˜¯æ•°å­—çš„é€‰å–æƒ…å†µï¼Œä¸Šé¢æˆ‘ä»¬æ˜¯ç”¨çš„ä¸€ä¸ª`visit`æ•°ç»„æ¥è®°å½•è¿™é€‰å–çš„æƒ…å†µï¼Œè¦ç›´æ¥é€šè¿‡è¿™ä¸ª`visit`æ¥åˆ¤æ–­çŠ¶æ€æ˜¯å¦ç›¸åŒæ˜¯å¾ˆè€—æ—¶è€—åŠ›çš„ï¼Œæ‰€ä»¥å°±å¼•å…¥äº†çŠ¶æ€å‹ç¼©ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨äºŒè¿›åˆ¶çš„ç¬¬`i`ä½çš„0æˆ–è€…1æ¥è¡¨ç¤º`i`è¿™ä¸ªæ•°å­—çš„é€‰å–ä¸å¦ï¼Œè¿™æ ·æ‰€æœ‰æ•°å­—çš„é€‰å–çŠ¶æ€å°±å¯ä»¥ç”¨ä¸€ä¸ªæ•°æ¥å¾ˆæ–¹ä¾¿çš„è¡¨ç¤ºï¼Œé¢˜ç›®è¯´äº†ä¸è¶…è¿‡20ä½ï¼Œæ‰€ä»¥è¿™é‡Œå°±å¯ä»¥ç”¨ä¸€ä¸ª`int`æ¥è¡¨ç¤ºçŠ¶æ€`state`ï¼Œé€šè¿‡`state`æ¥åˆ¤æ–­çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼Œè¿›è€Œè¿›è¡Œè®°å¿†åŒ–çš„å­˜å–\n\n```java\nBoolean[] dp=null; //ç”¨Booleanæ¯”è¾ƒæ–¹ä¾¿åˆ¤æ–­æ˜¯å¦è®°å¿†åŒ–\n\npublic boolean canIWin(int maxChoosableInteger, int desiredTotal) {\n    //å°äºæœ€å¤§å€¼å…ˆæ‰‹å¯ä»¥ç›´æ¥æ‹¿\n    if(desiredTotal<=maxChoosableInteger) return true;\n    //å‰Né¡¹å’Œè¿˜ä¸å¤ŸdesiredTotal\n    if((1+maxChoosableInteger)*(maxChoosableInteger)/2<desiredTotal) return false;\n    //20ä½äºŒè¿›åˆ¶ 1<<21\n    dp=new Boolean[1<<21];\n    return dfs(maxChoosableInteger,desiredTotal,0);\n}\n\npublic boolean dfs(int max,int total,int state){\n    if(total<=0) return false; //å‰äººå·²ç»æ‹¿å®Œäº†\n    if(dp[state]!=null){\n        return dp[state];\n    }\n    for (int i=max;i>=1;i--) {\n        //å‚æ•°ä¼ é€’çš„ï¼Œå°±ä¸ç”¨å›æº¯äº†ï¼Œä»£ç å˜çš„ç®€æ´å¤šäº†\n        if((state>>i&1)==0 && !dfs(max,total-i,state|(1<<i))){\n            return dp[state]=true;\n        }\n    }\n    return dp[state]=false;\n}\n```\nå…¶å®ä¸€å¼€å§‹å¼€äº†ä¸ªäºŒç»´çš„ `new Boolean[desiredTotal] [1<<21]`ï¼Œç„¶åå°±ç›´æ¥MLEäº†ğŸ˜… å¤ªèœäº†hahahaï¼Œç„¶åçœ‹äº†ä¸‹ï¼Œå‘ç°`state`ä¸€æ ·çš„è¯ï¼Œ`total`è‚¯å®šæ˜¯ä¸€æ ·çš„ï¼ˆåè¿‡æ¥å°±ä¸ä¸€å®šäº†ï¼‰ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€ç»´çš„å°±å¯ä»¥äº†\n\nå…¶å®ä¹Ÿå¯ä»¥ç”¨`int[]`åšçŠ¶å‹\n\n```java\n//intåšçŠ¶å‹ï¼Œä¼¼ä¹æ€§èƒ½æ²¡æœ‰æå‡\nint[] dp=null; //0:æœªåˆå§‹åŒ– 1:true 2:false\n\npublic boolean canIWin(int maxChoosableInteger, int desiredTotal) {\n    //å°äºæœ€å¤§å€¼å…ˆæ‰‹å¯ä»¥ç›´æ¥æ‹¿\n    if(desiredTotal<=maxChoosableInteger) return true;\n    //å‰Né¡¹å’Œè¿˜ä¸å¤ŸdesiredTotal\n    if((1+maxChoosableInteger)*(maxChoosableInteger)/2<desiredTotal) return false;\n    //20ä½äºŒè¿›åˆ¶ 1<<21\n    dp=new int[1<<21];\n    return dfs(maxChoosableInteger,desiredTotal,0);\n}\n\npublic boolean dfs(int max,int total,int state){\n    if(dp[state]!=0){\n        return dp[state]==1;\n    }\n    for (int i=max;i>=1;i--) {\n        //å‚æ•°ä¼ é€’çš„ï¼Œå°±ä¸ç”¨å›æº¯äº†ï¼Œä»£ç å˜çš„ç®€æ´å¤šäº†\n        if((state>>i&1)==0 && (i>=total || !dfs(max,total-i,state|(1<<i)))){\n            dp[state]=1;\n            return true;\n        }\n    }\n    dp[state]=2;\n    return false;\n}\n```\n\n## _åšå¼ˆDP_\n\n## [292. Nim æ¸¸æˆ](https://leetcode-cn.com/problems/nim-game/)\n\nä½ å’Œä½ çš„æœ‹å‹ï¼Œä¸¤ä¸ªäººä¸€èµ·ç© Nim æ¸¸æˆï¼šæ¡Œå­ä¸Šæœ‰ä¸€å †çŸ³å¤´ï¼Œæ¯æ¬¡ä½ ä»¬è½®æµæ‹¿æ‰ 1 - 3 å—çŸ³å¤´ã€‚ æ‹¿æ‰æœ€åä¸€å—çŸ³å¤´çš„äººå°±æ˜¯è·èƒœè€…ã€‚ä½ ä½œä¸ºå…ˆæ‰‹ã€‚\n\nä½ ä»¬æ˜¯èªæ˜äººï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯æœ€ä¼˜è§£ã€‚ ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¥åˆ¤æ–­ä½ æ˜¯å¦å¯ä»¥åœ¨ç»™å®šçŸ³å¤´æ•°é‡çš„æƒ…å†µä¸‹èµ¢å¾—æ¸¸æˆã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: 4\nè¾“å‡º: false \nè§£é‡Š: å¦‚æœå †ä¸­æœ‰ 4 å—çŸ³å¤´ï¼Œé‚£ä¹ˆä½ æ°¸è¿œä¸ä¼šèµ¢å¾—æ¯”èµ›ï¼›\n     å› ä¸ºæ— è®ºä½ æ‹¿èµ° 1 å—ã€2 å— è¿˜æ˜¯ 3 å—çŸ³å¤´ï¼Œæœ€åä¸€å—çŸ³å¤´æ€»æ˜¯ä¼šè¢«ä½ çš„æœ‹å‹æ‹¿èµ°ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nåšå¼ˆå‹åŠ¨æ€è§„åˆ’å…¥é—¨é¢˜\n\n```java\npublic boolean canWinNim(int n) {\n    boolean[] dp=new boolean[n];\n    dp[0]=true;\n    dp[1]=true;\n    dp[2]=true;\n    //t t t f t t t f .....\n    //æ¯ä¸ªçŠ¶æ€å–å†³äºå‰3ä¸ªçŠ¶æ€\n    for (int i=3;i<n;i++) {\n        //åˆ†åˆ«æ‹¿1,2,3ä¸ªçœ‹å¯¹é¢èƒ½ä¸èƒ½èµ¢\n        dp[i]=!dp[i-1] || !dp[i-2] || !dp[i-3];\n    }\n    return dp[n-1];\n}\n```\nè¿™ä¸ªè§£æ³•åœ¨æ•°æ®è¿‡å¤§çš„æ—¶å€™è¿˜æ˜¯ä¼šTLE\n\n**è§£æ³•äºŒ**\n\nè§„å¾‹\n\n```java\npublic boolean canWinNim(int n) {\n    return n%4!=0;\n}\n```\n\n## [1025. é™¤æ•°åšå¼ˆ](https://leetcode-cn.com/problems/divisor-game/)\n\nDifficulty: **ç®€å•**\n\n\nçˆ±ä¸½ä¸å’Œé²å‹ƒä¸€èµ·ç©æ¸¸æˆï¼Œä»–ä»¬è½®æµè¡ŒåŠ¨ã€‚çˆ±ä¸½ä¸å…ˆæ‰‹å¼€å±€ã€‚\n\næœ€åˆï¼Œé»‘æ¿ä¸Šæœ‰ä¸€ä¸ªæ•°å­—Â `N`Â ã€‚åœ¨æ¯ä¸ªç©å®¶çš„å›åˆï¼Œç©å®¶éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n\n*   é€‰å‡ºä»»ä¸€Â `x`ï¼Œæ»¡è¶³Â `0 < x < N` ä¸”Â `N % x == 0`Â ã€‚\n*   ç”¨ `N - x`Â æ›¿æ¢é»‘æ¿ä¸Šçš„æ•°å­— `N` ã€‚\n\nå¦‚æœç©å®¶æ— æ³•æ‰§è¡Œè¿™äº›æ“ä½œï¼Œå°±ä¼šè¾“æ‰æ¸¸æˆã€‚\n\nåªæœ‰åœ¨çˆ±ä¸½ä¸åœ¨æ¸¸æˆä¸­å–å¾—èƒœåˆ©æ—¶æ‰è¿”å›Â `True`ï¼Œå¦åˆ™è¿”å› `false`ã€‚å‡è®¾ä¸¤ä¸ªç©å®¶éƒ½ä»¥æœ€ä½³çŠ¶æ€å‚ä¸æ¸¸æˆã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š2\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šçˆ±ä¸½ä¸é€‰æ‹© 1ï¼Œé²å‹ƒæ— æ³•è¿›è¡Œæ“ä½œã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š3\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šçˆ±ä¸½ä¸é€‰æ‹© 1ï¼Œé²å‹ƒä¹Ÿé€‰æ‹© 1ï¼Œç„¶åçˆ±ä¸½ä¸æ— æ³•è¿›è¡Œæ“ä½œã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  `1 <= N <= 1000`\n\n**è§£æ³•ä¸€**\n\nåšå¼ˆDPï¼Œå’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œå°è¯•æ‰€æœ‰æƒ…å†µ\n```golang\nfunc divisorGame(N int) bool {\n    //N=iæ—¶ï¼Œå…ˆæ‰‹çš„äººèƒ½å¦èµ¢\n    var dp = make([]bool, N+1)\n    dp[1] = false\n    for i := 2; i <= N; i++ {\n        //å°è¯•æ‰€æœ‰å¯è¡Œçš„é€‰æ‹©\n        //ä»iä¸­å…ˆæ‰‹æ‹¿jï¼Œçœ‹å¯¹æ–¹åœ¨i-jä¸­å…ˆæ‰‹èƒ½ä¸èƒ½èµ¢\n        for j := 1; j < i; j++ {\n            if i%j == 0 && !dp[i-j] {\n                dp[i] = true\n                break\n            }\n        }\n    }\n    return dp[N]\n}\n```\n\n**è§£æ³•äºŒ**\n\nå¾ˆæ˜æ˜¾ï¼Œè¿™é¢˜ä¹Ÿæœ‰ä¸€ä¸ªæ•°å­¦çš„è§£æ³•ğŸ˜‚ï¼Œåˆ©ç”¨å¥‡æ•°å’Œå¶æ•°çš„æ€§è´¨ï¼ŒNä¸ºå¶æ•°çš„æ—¶å€™ï¼Œå…ˆæ‰‹çš„äººæ˜¯å¿…èµ¢çš„\n```golang\n//è§„å¾‹ï¼Œå¶æ•°å¿…èµ¢ï¼Œå¥‡æ•°å¿…è¾“\n//æœ€ååœ¨N=2çš„æ—¶å€™ç»“æŸæ¯”èµ›ï¼Œæ‰€ä»¥è°å…ˆåˆ°2è°å°±èµ¢\n//å¥‡æ•°çš„å› å­åªæœ‰å¥‡æ•°ï¼Œå¥‡æ•°-å¥‡æ•° = å¶æ•°ï¼Œå½“æˆ‘æ‹¿åˆ°å¶æ•°æ—¶å€™å¯ä»¥ç›´æ¥æ‹¿èµ°1ï¼Œå˜ä¸ºå¥‡æ•°ï¼Œå¦‚æ­¤å¾€æ¥\n//æœ€ç»ˆæˆ‘å¿…å®šèƒ½å…ˆåˆ°2\nfunc divisorGame(N int) bool {\n    return N%2 == 0\n}\n```\n\n## [1140. çŸ³å­æ¸¸æˆ II](https://leetcode-cn.com/problems/stone-game-ii/)\n\nDifficulty: **ä¸­ç­‰**\n\n\näºšå†å…‹æ–¯å’Œæç»§ç»­ä»–ä»¬çš„çŸ³å­æ¸¸æˆã€‚è®¸å¤šå †çŸ³å­Â **æ’æˆä¸€è¡Œ**ï¼Œæ¯å †éƒ½æœ‰æ­£æ•´æ•°é¢—çŸ³å­Â `piles[i]`ã€‚æ¸¸æˆä»¥è°æ‰‹ä¸­çš„çŸ³å­æœ€å¤šæ¥å†³å‡ºèƒœè´Ÿã€‚\n\näºšå†å…‹æ–¯å’Œæè½®æµè¿›è¡Œï¼Œäºšå†å…‹æ–¯å…ˆå¼€å§‹ã€‚æœ€åˆï¼Œ`M = 1`ã€‚\n\nåœ¨æ¯ä¸ªç©å®¶çš„å›åˆä¸­ï¼Œè¯¥ç©å®¶å¯ä»¥æ‹¿èµ°å‰©ä¸‹çš„Â **å‰**Â `X`Â å †çš„æ‰€æœ‰çŸ³å­ï¼Œå…¶ä¸­Â `1 <= X <= 2M`ã€‚ç„¶åï¼Œä»¤Â `M = max(M, X)`ã€‚\n\næ¸¸æˆä¸€ç›´æŒç»­åˆ°æ‰€æœ‰çŸ³å­éƒ½è¢«æ‹¿èµ°ã€‚\n\nå‡è®¾äºšå†å…‹æ–¯å’Œæéƒ½å‘æŒ¥å‡ºæœ€ä½³æ°´å¹³ï¼Œè¿”å›äºšå†å…‹æ–¯å¯ä»¥å¾—åˆ°çš„æœ€å¤§æ•°é‡çš„çŸ³å¤´ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```\nè¾“å…¥ï¼špiles = [2,7,9,4,4]\nè¾“å‡ºï¼š10\nè§£é‡Šï¼š\nå¦‚æœäºšå†å…‹æ–¯åœ¨å¼€å§‹æ—¶æ‹¿èµ°ä¸€å †çŸ³å­ï¼Œææ‹¿èµ°ä¸¤å †ï¼Œæ¥ç€äºšå†å…‹æ–¯ä¹Ÿæ‹¿èµ°ä¸¤å †ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäºšå†å…‹æ–¯å¯ä»¥æ‹¿åˆ° 2 + 4 + 4 = 10 é¢—çŸ³å­ã€‚ \nå¦‚æœäºšå†å…‹æ–¯åœ¨å¼€å§‹æ—¶æ‹¿èµ°ä¸¤å †çŸ³å­ï¼Œé‚£ä¹ˆæå°±å¯ä»¥æ‹¿èµ°å‰©ä¸‹å…¨éƒ¨ä¸‰å †çŸ³å­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäºšå†å…‹æ–¯å¯ä»¥æ‹¿åˆ° 2 + 7 = 9 é¢—çŸ³å­ã€‚\næ‰€ä»¥æˆ‘ä»¬è¿”å›æ›´å¤§çš„ 10ã€‚ \n```\n\n**æç¤ºï¼š**\n\n*   `1 <= piles.length <= 100`\n*   `1 <= piles[i]Â <= 10 ^ 4`\n\n**è§£æ³•ä¸€**\n\nçå†™çš„è®°å¿†åŒ–ï¼Œæ‡’å¾—æ”¹dpäº†\n```java\nint n = 0;\n\nInteger[][] cache;\n\npublic int stoneGameII(int[] piles) {\n    n = piles.length;\n    //è¿™é‡Œç”¨åç¼€å’Œä¼šç®€å•ä¸€ç‚¹ï¼Œæ‡’å¾—æ”¹äº†\n    int[] preSum = new int[n+1];\n    cache = new Integer[n+1][n+1];\n    preSum[0] = 0;\n    for(int i = 1; i <=n; i++){\n        preSum[i] = preSum[i-1] + piles[i-1];\n    }\n    return dfs(preSum, 0, 1);\n}\n\npublic int dfs(int[] preSum, int start, int M){\n    if(cache[start][M]!=null){\n        return cache[start][M];\n    }\n    int res = 0;\n    for(int len = 1; start + len - 1 < n && len <= 2*M; len++){\n        //start=0 len=2 (0,1)\n        int temp = preSum[n] - preSum[start] - dfs(preSum, start + len, Math.max(M, len));\n        res = Math.max(res, temp);\n    }\n    return cache[start][M] = res;\n}\n```\n## [1406. çŸ³å­æ¸¸æˆ III](https://leetcode-cn.com/problems/stone-game-iii/)\n\nDifficulty: **å›°éš¾**\n\n\nAlice å’Œ Bob ç”¨å‡ å †çŸ³å­åœ¨åšæ¸¸æˆã€‚å‡ å †çŸ³å­æ’æˆä¸€è¡Œï¼Œæ¯å †çŸ³å­éƒ½å¯¹åº”ä¸€ä¸ªå¾—åˆ†ï¼Œç”±æ•°ç»„ `stoneValue` ç»™å‡ºã€‚\n\nAlice å’Œ Bob è½®æµå–çŸ³å­ï¼Œ**Alice** æ€»æ˜¯å…ˆå¼€å§‹ã€‚åœ¨æ¯ä¸ªç©å®¶çš„å›åˆä¸­ï¼Œè¯¥ç©å®¶å¯ä»¥æ‹¿èµ°å‰©ä¸‹çŸ³å­ä¸­çš„çš„å‰ **1ã€2 æˆ– 3 å †çŸ³å­** ã€‚æ¯”èµ›ä¸€ç›´æŒç»­åˆ°æ‰€æœ‰çŸ³å¤´éƒ½è¢«æ‹¿èµ°ã€‚\n\næ¯ä¸ªç©å®¶çš„æœ€ç»ˆå¾—åˆ†ä¸ºä»–æ‰€æ‹¿åˆ°çš„æ¯å †çŸ³å­çš„å¯¹åº”å¾—åˆ†ä¹‹å’Œã€‚æ¯ä¸ªç©å®¶çš„åˆå§‹åˆ†æ•°éƒ½æ˜¯ **0** ã€‚æ¯”èµ›çš„ç›®æ ‡æ˜¯å†³å‡ºæœ€é«˜åˆ†ï¼Œå¾—åˆ†æœ€é«˜çš„é€‰æ‰‹å°†ä¼šèµ¢å¾—æ¯”èµ›ï¼Œæ¯”èµ›ä¹Ÿå¯èƒ½ä¼šå‡ºç°å¹³å±€ã€‚\n\nå‡è®¾ Alice å’Œ Bob éƒ½é‡‡å– **æœ€ä¼˜ç­–ç•¥** ã€‚å¦‚æœ Alice èµ¢äº†å°±è¿”å› _\"Alice\"_ _ï¼Œ_Bob èµ¢äº†å°±è¿”å› _\"Bob\"ï¼Œ_å¹³å±€ï¼ˆåˆ†æ•°ç›¸åŒï¼‰è¿”å› _\"Tie\"_ ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼švalues = [1,2,3,7]\nè¾“å‡ºï¼š\"Bob\"\nè§£é‡Šï¼šAlice æ€»æ˜¯ä¼šè¾“ï¼Œå¥¹çš„æœ€ä½³é€‰æ‹©æ˜¯æ‹¿èµ°å‰ä¸‰å †ï¼Œå¾—åˆ†å˜æˆ 6 ã€‚ä½†æ˜¯ Bob çš„å¾—åˆ†ä¸º 7ï¼ŒBob è·èƒœã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼švalues = [1,2,3,-9]\nè¾“å‡ºï¼š\"Alice\"\nè§£é‡Šï¼šAlice è¦æƒ³è·èƒœå°±å¿…é¡»åœ¨ç¬¬ä¸€ä¸ªå›åˆæ‹¿èµ°å‰ä¸‰å †çŸ³å­ï¼Œç»™ Bob ç•™ä¸‹è´Ÿåˆ†ã€‚\nå¦‚æœ Alice åªæ‹¿èµ°ç¬¬ä¸€å †ï¼Œé‚£ä¹ˆå¥¹çš„å¾—åˆ†ä¸º 1ï¼Œæ¥ä¸‹æ¥ Bob æ‹¿èµ°ç¬¬äºŒã€ä¸‰å †ï¼Œå¾—åˆ†ä¸º 5 ã€‚ä¹‹å Alice åªèƒ½æ‹¿åˆ°åˆ†æ•° -9 çš„çŸ³å­å †ï¼Œè¾“æ‰æ¯”èµ›ã€‚\nå¦‚æœ Alice æ‹¿èµ°å‰ä¸¤å †ï¼Œé‚£ä¹ˆå¥¹çš„å¾—åˆ†ä¸º 3ï¼Œæ¥ä¸‹æ¥ Bob æ‹¿èµ°ç¬¬ä¸‰å †ï¼Œå¾—åˆ†ä¸º 3 ã€‚ä¹‹å Alice åªèƒ½æ‹¿åˆ°åˆ†æ•° -9 çš„çŸ³å­å †ï¼ŒåŒæ ·ä¼šè¾“æ‰æ¯”èµ›ã€‚\næ³¨æ„ï¼Œä»–ä»¬éƒ½åº”è¯¥é‡‡å– æœ€ä¼˜ç­–ç•¥ ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œ Alice å°†é€‰æ‹©èƒ½å¤Ÿä½¿å¥¹è·èƒœçš„æ–¹æ¡ˆã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼švalues = [1,2,3,6]\nè¾“å‡ºï¼š\"Tie\"\nè§£é‡Šï¼šAlice æ— æ³•èµ¢å¾—æ¯”èµ›ã€‚å¦‚æœå¥¹å†³å®šé€‰æ‹©å‰ä¸‰å †ï¼Œå¥¹å¯ä»¥ä»¥å¹³å±€ç»“æŸæ¯”èµ›ï¼Œå¦åˆ™å¥¹å°±ä¼šè¾“ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼švalues = [1,2,3,-1,-2,-3,7]\nè¾“å‡ºï¼š\"Alice\"\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```go\nè¾“å…¥ï¼švalues = [-1,-2,-3]\nè¾“å‡ºï¼š\"Tie\"\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= values.length <= 50000`\n*   `-1000Â <= values[i] <= 1000`\n\n\n**è§£æ³•ä¸€**\n\næŸæ¬¡åŒå‘¨èµ›çš„T4ï¼Œæ²¡å‚åŠ ï¼Œæ„Ÿè§‰è¿™é¢˜è¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ¯”2è¿˜è¦ç®€å•ï¼Œä¸‹é¢çš„åšæ³•ç›´æ¥å¥—ç”¨2çš„åšæ³•ï¼Œæ”¹æˆäº†åç¼€å’Œæ•°ç»„\n```java\n//åç¼€æ•°ç»„\nint[] sufSum = null;\n\nInteger[] dp = null;\n\npublic String stoneGameIII(int[] stoneValue) {\n    int n = stoneValue.length;\n    sufSum = new int[n+1];\n    dp = new Integer[n+1];\n    for (int i = n-1; i >= 0; i--){\n        sufSum[i] = sufSum[i+1] + stoneValue[i];\n    }\n    int alice = dfs(stoneValue, 0);\n    int bob = sufSum[0]-alice;\n    if (alice == bob) {\n        return \"Tie\";\n    }\n    return alice > bob ? \"Alice\" : \"Bob\";\n}\n\npublic int dfs(int[] sv, int start){\n    if (start > sv.length) {\n        return 0;\n    }\n    if (dp[start]!=null) {\n        return dp[start];\n    }\n    int sum = sufSum[start];\n    return dp[start] = Math.max(sum-dfs(sv, start+1), Math.max(sum-dfs(sv, start+2), sum-dfs(sv, start+3)));\n}\n```\nè¿™é¢˜è¿˜æœ‰æ›´å¥½çš„åšæ³•ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œåé¢æœ‰æ—¶é—´å†å†™\n\n\n## [1510. çŸ³å­æ¸¸æˆ IV](https://leetcode-cn.com/problems/stone-game-iv/)\n\nDifficulty: **å›°éš¾**\n\n\nAlice å’Œ Bob ä¸¤ä¸ªäººè½®æµç©ä¸€ä¸ªæ¸¸æˆï¼ŒAlice å…ˆæ‰‹ã€‚\n\nä¸€å¼€å§‹ï¼Œæœ‰ `n`Â ä¸ªçŸ³å­å †åœ¨ä¸€èµ·ã€‚æ¯ä¸ªäººè½®æµæ“ä½œï¼Œæ­£åœ¨æ“ä½œçš„ç©å®¶å¯ä»¥ä»çŸ³å­å †é‡Œæ‹¿èµ° **ä»»æ„**Â éé›¶ **å¹³æ–¹æ•°**Â ä¸ªçŸ³å­ã€‚\n\nå¦‚æœçŸ³å­å †é‡Œæ²¡æœ‰çŸ³å­äº†ï¼Œåˆ™æ— æ³•æ“ä½œçš„ç©å®¶è¾“æ‰æ¸¸æˆã€‚\n\nç»™ä½ æ­£æ•´æ•°Â `n`Â ï¼Œä¸”å·²çŸ¥ä¸¤ä¸ªäººéƒ½é‡‡å–æœ€ä¼˜ç­–ç•¥ã€‚å¦‚æœ Alice ä¼šèµ¢å¾—æ¯”èµ›ï¼Œé‚£ä¹ˆè¿”å›Â `True`Â ï¼Œå¦åˆ™è¿”å›Â `False`Â ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šn = 1\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šAlice æ‹¿èµ° 1 ä¸ªçŸ³å­å¹¶èµ¢å¾—èƒœåˆ©ï¼Œå› ä¸º Bob æ— æ³•è¿›è¡Œä»»ä½•æ“ä½œã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šn = 2\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šAlice åªèƒ½æ‹¿èµ° 1 ä¸ªçŸ³å­ï¼Œç„¶å Bob æ‹¿èµ°æœ€åä¸€ä¸ªçŸ³å­å¹¶èµ¢å¾—èƒœåˆ©ï¼ˆ2 -> 1 -> 0ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šn = 4\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šn å·²ç»æ˜¯ä¸€ä¸ªå¹³æ–¹æ•°ï¼ŒAlice å¯ä»¥ä¸€æ¬¡å…¨æ‹¿æ‰ 4 ä¸ªçŸ³å­å¹¶èµ¢å¾—èƒœåˆ©ï¼ˆ4 -> 0ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šn = 7\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šå½“ Bob é‡‡å–æœ€ä¼˜ç­–ç•¥æ—¶ï¼ŒAlice æ— æ³•èµ¢å¾—æ¯”èµ›ã€‚\nå¦‚æœ Alice ä¸€å¼€å§‹æ‹¿èµ° 4 ä¸ªçŸ³å­ï¼Œ Bob ä¼šæ‹¿èµ° 1 ä¸ªçŸ³å­ï¼Œç„¶å Alice åªèƒ½æ‹¿èµ° 1 ä¸ªçŸ³å­ï¼ŒBob æ‹¿èµ°æœ€åä¸€ä¸ªçŸ³å­å¹¶èµ¢å¾—èƒœåˆ©ï¼ˆ7 -> 3 -> 2 -> 1 -> 0ï¼‰ã€‚\nå¦‚æœ Alice ä¸€å¼€å§‹æ‹¿èµ° 1 ä¸ªçŸ³å­ï¼Œ Bob ä¼šæ‹¿èµ° 4 ä¸ªçŸ³å­ï¼Œç„¶å Alice åªèƒ½æ‹¿èµ° 1 ä¸ªçŸ³å­ï¼ŒBob æ‹¿èµ°æœ€åä¸€ä¸ªçŸ³å­å¹¶èµ¢å¾—èƒœåˆ©ï¼ˆ7 -> 6 -> 2 -> 1 -> 0ï¼‰ã€‚\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```go\nè¾“å…¥ï¼šn = 17\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šå¦‚æœ Bob é‡‡å–æœ€ä¼˜ç­–ç•¥ï¼ŒAlice æ— æ³•èµ¢å¾—èƒœåˆ©ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= n <= 10^5`\n\n\n**è§£æ³•ä¸€**\n\nå‰å‡ æ¬¡åŒå‘¨èµ›çš„T4ï¼Œå¤ªæ°´äº†ï¼Œå¤§æ°´é¢˜ï¼Œé¡¶å¤šç®—mid\n```golang\nfunc winnerSquareGame(n int) bool {\n Â  Â var dp = make([]bool, 100001)\n Â  Â dp[0] = false\n Â  Â for i := 1; i <= n; i++ {\n Â  Â  Â  Â for j := 1; j*j <= i; j++ {\n Â  Â  Â  Â  Â  Â if !dp[i-j*j] {\n Â  Â  Â  Â  Â  Â  Â  Â dp[i] = true\n Â  Â  Â  Â  Â  Â  Â  Â break\n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â   }\n Â  Â return dp[n]\n}\n```\n**è§£æ³•äºŒ**\n\nç©äº†ä¸€æ‰‹èŠ±å“¨çš„è®°å¿†åŒ–æ‰‹æ³•ğŸ˜‚\n```golang\n//è®°å¿†åŒ–\nfunc winnerSquareGame(n int) bool {\n    var T, F = true, false\n    var dfs func(int) bool\n    var dp = make([]*bool, 100001)\n    //å…ˆæ‰‹æ‹¿x^2ä¸ªçŸ³å¤´\n    dfs = func (n int) bool {\n        if dp[n] != nil {\n            return *dp[n]\n        }\n        if n == 0 {\n            return F\n        }\n        for i := 1; i*i <= n; i++{\n            if !dfs(n-i*i) {\n                dp[n] = &T\n                return T\n            }\n        }\n        dp[n] = &F\n        return F\n    }\n    return dfs(n)\n}\n```\n\n## [486. é¢„æµ‹èµ¢å®¶](https://leetcode-cn.com/problems/predict-the-winner/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªè¡¨ç¤ºåˆ†æ•°çš„éè´Ÿæ•´æ•°æ•°ç»„ã€‚ ç©å®¶ 1 ä»æ•°ç»„ä»»æ„ä¸€ç«¯æ‹¿å–ä¸€ä¸ªåˆ†æ•°ï¼Œéšåç©å®¶ 2 ç»§ç»­ä»å‰©ä½™æ•°ç»„ä»»æ„ä¸€ç«¯æ‹¿å–åˆ†æ•°ï¼Œç„¶åç©å®¶ 1 æ‹¿ï¼Œâ€¦â€¦ ã€‚æ¯æ¬¡ä¸€ä¸ªç©å®¶åªèƒ½æ‹¿å–ä¸€ä¸ªåˆ†æ•°ï¼Œåˆ†æ•°è¢«æ‹¿å–ä¹‹åä¸å†å¯å–ã€‚ç›´åˆ°æ²¡æœ‰å‰©ä½™åˆ†æ•°å¯å–æ—¶æ¸¸æˆç»“æŸã€‚æœ€ç»ˆè·å¾—åˆ†æ•°æ€»å’Œæœ€å¤šçš„ç©å®¶è·èƒœã€‚\n\nç»™å®šä¸€ä¸ªè¡¨ç¤ºåˆ†æ•°çš„æ•°ç»„ï¼Œé¢„æµ‹ç©å®¶1æ˜¯å¦ä¼šæˆä¸ºèµ¢å®¶ã€‚ä½ å¯ä»¥å‡è®¾æ¯ä¸ªç©å®¶çš„ç©æ³•éƒ½ä¼šä½¿ä»–çš„åˆ†æ•°æœ€å¤§åŒ–ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š[1, 5, 2]\nè¾“å‡ºï¼šFalse\nè§£é‡Šï¼šä¸€å¼€å§‹ï¼Œç©å®¶1å¯ä»¥ä»1å’Œ2ä¸­è¿›è¡Œé€‰æ‹©ã€‚\nå¦‚æœä»–é€‰æ‹© 2ï¼ˆæˆ–è€… 1 ï¼‰ï¼Œé‚£ä¹ˆç©å®¶ 2 å¯ä»¥ä» 1ï¼ˆæˆ–è€… 2 ï¼‰å’Œ 5 ä¸­è¿›è¡Œé€‰æ‹©ã€‚å¦‚æœç©å®¶ 2 é€‰æ‹©äº† 5 ï¼Œé‚£ä¹ˆç©å®¶ 1 åˆ™åªå‰©ä¸‹ 1ï¼ˆæˆ–è€… 2 ï¼‰å¯é€‰ã€‚\næ‰€ä»¥ï¼Œç©å®¶ 1 çš„æœ€ç»ˆåˆ†æ•°ä¸º 1 + 2 = 3ï¼Œè€Œç©å®¶ 2 ä¸º 5 ã€‚\nå› æ­¤ï¼Œç©å®¶ 1 æ°¸è¿œä¸ä¼šæˆä¸ºèµ¢å®¶ï¼Œè¿”å› False ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š[1, 5, 233, 7]\nè¾“å‡ºï¼šTrue\nè§£é‡Šï¼šç©å®¶ 1 ä¸€å¼€å§‹é€‰æ‹© 1 ã€‚ç„¶åç©å®¶ 2 å¿…é¡»ä» 5 å’Œ 7 ä¸­è¿›è¡Œé€‰æ‹©ã€‚æ— è®ºç©å®¶ 2 é€‰æ‹©äº†å“ªä¸ªï¼Œç©å®¶ 1 éƒ½å¯ä»¥é€‰æ‹© 233 ã€‚\n     æœ€ç»ˆï¼Œç©å®¶ 1ï¼ˆ234 åˆ†ï¼‰æ¯”ç©å®¶ 2ï¼ˆ12 åˆ†ï¼‰è·å¾—æ›´å¤šçš„åˆ†æ•°ï¼Œæ‰€ä»¥è¿”å› Trueï¼Œè¡¨ç¤ºç©å®¶ 1 å¯ä»¥æˆä¸ºèµ¢å®¶ã€‚\n```\n\n**æç¤ºï¼š**\n\n*   1 <= ç»™å®šçš„æ•°ç»„é•¿åº¦Â <= 20.\n*   æ•°ç»„é‡Œæ‰€æœ‰åˆ†æ•°éƒ½ä¸ºéè´Ÿæ•°ä¸”ä¸ä¼šå¤§äº 10000000 ã€‚\n*   å¦‚æœæœ€ç»ˆä¸¤ä¸ªç©å®¶çš„åˆ†æ•°ç›¸ç­‰ï¼Œé‚£ä¹ˆç©å®¶ 1 ä»ä¸ºèµ¢å®¶ã€‚\n\n\n**è§£æ³•ä¸€**\n\nè®°å¿†åŒ–ï¼Œè¿™ç§åšå¼ˆçš„é¢˜ç›®è®°å¿†åŒ–å†™èµ·æ¥ä¼šæ¯”è¾ƒè‡ªç„¶\n```golang\nfunc PredictTheWinner(nums []int) bool {\n    var Max = func(a, b int) int {if a > b {return a};return b}\n    var n = len(nums)\n    var preSum = make([]int, n+1)\n    for i := 1; i <= n; i++ {\n        preSum[i] = preSum[i-1] + nums[i-1]\n    }\n    //è®°å¿†åŒ–\n    var dp = make([][]int, n)\n    for i := 0; i < n; i++ {\n        dp[i] = make([]int, n)\n        for j := 0; j < n; j++ {\n            dp[i][j] = -1\n        }\n    }\n    var dfs func(i int, j int) int\n    dfs = func(i int, j int) int {\n        if dp[i][j] != -1 {\n            return dp[i][j]\n        }\n        if i == j {\n            return nums[i]\n        }\n        //åŒºé—´å’Œ\n        sum := preSum[j+1] - preSum[i]\n        dp[i][j] = Max(sum-dfs(i+1, j), sum-dfs(i, j-1))\n        return dp[i][j]\n    }\n    A := dfs(0, n-1)\n    return A >= preSum[n]-A\n}\n```\n**è§£æ³•äºŒ**\n\nåŒºé—´DPçš„å†™æ³•å½“ç„¶ä¹Ÿå¯ä»¥ï¼Œæ€è·¯ä¸€æ ·\n```golang\nfunc PredictTheWinner(nums []int) bool {\n    var n = len(nums)\n    var dp = make([][]int, n)\n    var Max = func(a,b int) int {if a>b {return a};return b}\n    for i := 0; i < n; i++ {\n        dp[i] = make([]int, n)\n        dp[i][i] = nums[i]\n    }\n    var preSum = make([]int, n+1)\n    for i := 1; i <= n; i++ {\n        preSum[i] = preSum[i-1] + nums[i-1]\n    }\n    for tlen := 2; tlen <= n; tlen++ {\n        for left := 0; left+tlen-1 < n; left++ {\n            right := left+tlen-1\n            sum := preSum[right+1]-preSum[left]\n            dp[left][right] = Max(sum-dp[left][right-1], sum-dp[left+1][right])\n        }\n    }\n    return dp[0][n-1] >= preSum[n]-dp[0][n-1]\n}\n```\n\n## _å›¾è®º_\n\næš‚æ—¶å…ˆæ”¾åœ¨è¿™é‡Œï¼Œç­‰åé¢å­¦äº†dijï¼Œspfaé‚£äº›åä¸€èµ·å•ç‹¬æ€»ç»“ä¸€ä¸‹\n\n## [743. ç½‘ç»œå»¶è¿Ÿæ—¶é—´](https://leetcode-cn.com/problems/network-delay-time/)\n\næœ‰ `N` ä¸ªç½‘ç»œèŠ‚ç‚¹ï¼Œæ ‡è®°ä¸º `1` åˆ° `N`ã€‚\n\nç»™å®šä¸€ä¸ªåˆ—è¡¨ `times`ï¼Œè¡¨ç¤ºä¿¡å·ç»è¿‡**æœ‰å‘**è¾¹çš„ä¼ é€’æ—¶é—´ã€‚ `times[i] = (u, v, w)`ï¼Œå…¶ä¸­ `u` æ˜¯æºèŠ‚ç‚¹ï¼Œ`v` æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œ `w` æ˜¯ä¸€ä¸ªä¿¡å·ä»æºèŠ‚ç‚¹ä¼ é€’åˆ°ç›®æ ‡èŠ‚ç‚¹çš„æ—¶é—´ã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬ä»æŸä¸ªèŠ‚ç‚¹ `K` å‘å‡ºä¸€ä¸ªä¿¡å·ã€‚éœ€è¦å¤šä¹…æ‰èƒ½ä½¿æ‰€æœ‰èŠ‚ç‚¹éƒ½æ”¶åˆ°ä¿¡å·ï¼Ÿå¦‚æœä¸èƒ½ä½¿æ‰€æœ‰èŠ‚ç‚¹æ”¶åˆ°ä¿¡å·ï¼Œè¿”å› `-1`ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n![tfoiPf.png](https://s1.ax1x.com/2020/06/08/tfoiPf.png)\n\n```java\nè¾“å…¥ï¼štimes = [[2,1,1],[2,3,1],[3,4,1]], N = 4, K = 2\nè¾“å‡ºï¼š2\n```\n\n**æ³¨æ„:**\n\n1. `N` çš„èŒƒå›´åœ¨ `[1, 100]` ä¹‹é—´ã€‚\n2. `K` çš„èŒƒå›´åœ¨ `[1, N]` ä¹‹é—´ã€‚\n3. `times` çš„é•¿åº¦åœ¨ `[1, 6000]` ä¹‹é—´ã€‚\n4. æ‰€æœ‰çš„è¾¹ `times[i] = (u, v, w)` éƒ½æœ‰ `1 <= u, v <= N` ä¸” `0 <= w <= 100`ã€‚\n\n**è§£æ³•ä¸€**\n\nä¸´æ—¶èµ·æ„å­¦äº†ä¸‹Floydï¼Œç„¶ååœ¨lcä¸Šæœäº†ä¸€ä¸‹æ‰¾åˆ°äº†è¿™ä¸€é¢˜ï¼Œæ€è·¯ä¹Ÿå¾ˆç›´æ¥\n\n```java\n//Floyd\npublic int networkDelayTime(int[][] times, int N, int K) {\n    int[][] dis=new int[N][N];\n    int INF = 0x3f3f3f3f;\n    for(int i=0;i<N;i++) Arrays.fill(dis[i],INF);\n    for(int i=0;i<N;i++) dis[i][i]=0;\n    for(int[] t:times) dis[t[0]-1][t[1]-1]=t[2];\n    for(int k=0;k<N;k++){\n        for(int i=0;i<N;i++){\n            for(int j=0;j<N;j++){\n                dis[i][j]=Math.min(dis[i][j],dis[i][k]+dis[k][j]);\n            }\n        }\n    }\n    int res=0;\n    K-=1; //ä»0å¼€å§‹ï¼ä»1å¼€å§‹çš„éƒ½æ˜¯é‚ªæ•™\n    for(int i=0;i<N;i++){\n        if(dis[K][i]==INF) return -1;\n        res=Math.max(dis[K][i],res);\n    }\n    return res;\n}\n```\n\nå¤§æ¦‚è¯´ä¸€ä¸‹ï¼Œå…¶å®Floydå°±æ˜¯åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œ`dp[k][i][j]`ä»£è¡¨ä»`i~j`å…è®¸ç»è¿‡å‰`k`ä¸ªèŠ‚ç‚¹ä¸­è½¬æ—¶çš„æœ€çŸ­è·¯å¾„ï¼Œé‚£ä¹ˆå…¶å®å¾ˆå®¹æ˜“æ¨å¯¼å‡ºï¼Œ`dp[k][i][j]=min(dp[k-1][i][k]+dp[k-1][k][j],dp[k][i][j])`å…¶å®ä¹Ÿå°±æ˜¯å°è¯•ä»¥æ¯ä¸ªç‚¹ä¸ºä¸­è½¬ç‚¹ï¼Œçœ‹èƒ½å¦ç¼©çŸ­ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œå’ŒåŒºé—´DPæœ‰ç‚¹åƒï¼Œå…³äº`k`ä¸ºä»€ä¹ˆè¦æ”¾å¤–é¢å…¶å®ä»”ç»†æƒ³ä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯åœ¨æ±‚`dp[k][i][j]`çš„æ—¶å€™éœ€è¦ä¿è¯`dp[k-1][i][j]`ä»¥åŠ`dp[k-1][i][k]` å’Œ`dp[k-1][k][j]`éƒ½æ˜¯å·²ç»è®¡ç®—å®Œæ¯•çš„ï¼Œæƒ³ä¸€æƒ³ï¼Œå¦‚æœkæ”¾åœ¨é‡Œé¢èƒ½ä¿è¯ä¹ˆï¼Ÿå¾ˆæ˜æ˜¾ä¸è¡Œï¼Œå¯ä»¥ç±»æ¯”ä¸Šé¢çš„ [576. å‡ºç•Œçš„è·¯å¾„æ•°](#576-å‡ºç•Œçš„è·¯å¾„æ•°)ï¼Œä¸€æ ·çš„é“ç†ã€‚ç„¶åæˆ‘ä»¬å†è§‚å¯Ÿæ•´ä¸ªé€’æ¨æ–¹ç¨‹ï¼Œå‘ç°`dp[k]`åªä¾èµ–äº`dp[k-1]`æ‰€ä»¥å°±å¯ä»¥ç›´æ¥æ»šåŠ¨æ•°ç»„ä¼˜åŒ–æ‰kç»´åº¦çš„ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„è§£æ³•\n\n## [1584. è¿æ¥æ‰€æœ‰ç‚¹çš„æœ€å°è´¹ç”¨](https://leetcode-cn.com/problems/min-cost-to-connect-all-points/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ª`points`Â æ•°ç»„ï¼Œè¡¨ç¤º 2D å¹³é¢ä¸Šçš„ä¸€äº›ç‚¹ï¼Œå…¶ä¸­Â points[i] = [x<sub style=\"display: inline;\">i</sub>, y<sub style=\"display: inline;\">i</sub>]Â ã€‚\n\nè¿æ¥ç‚¹Â [x<sub style=\"display: inline;\">i</sub>, y<sub style=\"display: inline;\">i</sub>] å’Œç‚¹Â [x<sub style=\"display: inline;\">j</sub>, y<sub style=\"display: inline;\">j</sub>]`Â çš„è´¹ç”¨ä¸ºå®ƒä»¬ä¹‹é—´çš„ **æ›¼å“ˆé¡¿è·ç¦»**Â ï¼šx<sub style=\"display: inline;\">i</sub> - x<sub style=\"display: inline;\">j</sub>| + |y<sub style=\"display: inline;\">i</sub> - y<sub style=\"display: inline;\">j</sub>|Â ï¼Œå…¶ä¸­Â |val|Â è¡¨ç¤ºÂ valÂ çš„ç»å¯¹å€¼ã€‚\n\nè¯·ä½ è¿”å›å°†æ‰€æœ‰ç‚¹è¿æ¥çš„æœ€å°æ€»è´¹ç”¨ã€‚åªæœ‰ä»»æ„ä¸¤ç‚¹ä¹‹é—´ **æœ‰ä¸”ä»…æœ‰**Â ä¸€æ¡ç®€å•è·¯å¾„æ—¶ï¼Œæ‰è®¤ä¸ºæ‰€æœ‰ç‚¹éƒ½å·²è¿æ¥ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n![wDmhAf.png](https://s1.ax1x.com/2020/09/14/wDmhAf.png)\n\n```\nè¾“å…¥ï¼špoints = [[0,0],[2,2],[3,10],[5,2],[7,0]]\nè¾“å‡ºï¼š20\nè§£é‡Šï¼š\n\næˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºè¿æ¥æ‰€æœ‰ç‚¹å¾—åˆ°æœ€å°æ€»è´¹ç”¨ï¼Œæ€»è´¹ç”¨ä¸º 20 ã€‚\næ³¨æ„åˆ°ä»»æ„ä¸¤ä¸ªç‚¹ä¹‹é—´åªæœ‰å”¯ä¸€ä¸€æ¡è·¯å¾„äº’ç›¸åˆ°è¾¾ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```\nè¾“å…¥ï¼špoints = [[3,12],[-2,5],[-4,1]]\nè¾“å‡ºï¼š18\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```\nè¾“å…¥ï¼špoints = [[0,0],[1,1],[1,0],[-1,1]]\nè¾“å‡ºï¼š4\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```\nè¾“å…¥ï¼špoints = [[-1000000,-1000000],[1000000,1000000]]\nè¾“å‡ºï¼š4000000\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```\nè¾“å…¥ï¼špoints = [[0,0]]\nè¾“å‡ºï¼š0\n```\n\n**æç¤ºï¼š**\n\n*   1 <= points.length <= 1000\n*   -10<sup>6</sup>Â <= x<sub style=\"display: inline;\">i</sub>, y<sub style=\"display: inline;\">i</sub> <= 10<sup>6</sup>\n*   æ‰€æœ‰ç‚¹Â (x<sub style=\"display: inline;\">i</sub>, y<sub style=\"display: inline;\">i</sub>)Â ä¸¤ä¸¤ä¸åŒã€‚\n\n\n**è§£æ³•ä¸€**\n\nPrim O(V^2)æœ€å°ç”Ÿæˆæ ‘ï¼Œ206thå‘¨èµ›t3ï¼Œè£¸çš„mstï¼Œä½†æ˜¯å½©ç¬”çš„æˆ‘å¹¶ä¸ä¼šï¼Œäº‹åè¡¥äº†ä¸€æ³¢ [OI Wiki](https://oi-wiki.org/graph/mst/#prim)ï¼Œï¼ˆè¿™ä¸ªæ˜¯åŸå§‹çš„æš´åŠ›Primï¼Œåº”å¯¹è¿™ä¸ªé¢˜å¤Ÿäº†ï¼‰  \n```java\n//Prim O(V^2) ä»»å–ä¸€ä¸ªèŠ‚ä½œä¸ºèµ·ç‚¹ï¼Œdis[i]è®°å½•mstç‚¹é›†åˆ°ç‚¹içš„æœ€çŸ­è·ç¦»\n//æ¯æ¬¡å–å‡ºmstç‚¹é›†å¤–dis[i]æœ€å°çš„ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç¦»mstç‚¹é›†æœ€è¿‘çš„ç‚¹ï¼Œå¹¶æ ‡è®°ä¸ºmstèŠ‚ç‚¹\n//ç„¶ååˆ©ç”¨è¯¥ç‚¹æ›´æ–°å…¶ä»–çš„mstç‚¹é›†å¤–çš„ç‚¹çš„disè·ç¦»ï¼Œç›´åˆ°å°†æ‰€æœ‰çš„ç‚¹éƒ½åŠ è¿›å»ï¼Œé€‚åˆç¨ å¯†å›¾ï¼ˆè¾¹æ•°è¿œå¤§äºç‚¹æ•°ï¼‰\n//å¯ä»¥ä½¿ç”¨ä¸€äº›æ•°æ®ç»“æ„æ¥ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ï¼Œæš‚æ—¶ä¸æ·±ç©¶\npublic int minCostConnectPoints(int[][] points) {\n    int INF = 0x3f3f3f3f;\n    int n = points.length;\n    //disè¡¨ç¤ºmstç‚¹é›†åˆ°è¯¥ç‚¹çš„æœ€å°è·ç¦»\n    int[] dis = new int[n];\n    Arrays.fill(dis, INF);\n    dis[0] = 0;\n    boolean[] vis = new boolean[n];\n    int res = 0;\n    for (int i = 0; i < n; i++) {\n        int minCost = INF;\n        int k = -1; //æœ€å°çš„æ–°èŠ‚ç‚¹\n        for (int j = 0; j < n; j++) {\n            if (!vis[j] && dis[j] < minCost) {\n                minCost = dis[j];\n                k = j;\n            }\n        }\n        vis[k] = true;\n        res += minCost;\n        for (int j = 0; j < n; j++) {\n            //æ›´æ–°æ‰€æœ‰mstç‚¹é›†å¤–çš„ç‚¹çš„dis\n            if (vis[j]) continue;\n            int mhd = Math.abs(points[k][0]-points[j][0])+Math.abs(points[k][1]-points[j][1]);\n            dis[j] = Math.min(dis[j], mhd);\n        }\n    }\n    return res;\n}\n```\nè¿™ä¸ªé¢˜æ˜æ˜¾æ˜¯ç¨ å¯†å›¾ï¼Œç”¨é‚»æ¥çŸ©é˜µè¡¨ç¤ºçš„ï¼ŒPrimç”¨é‚»æ¥çŸ©é˜µæ—¶æœºå¤æ‚åº¦å°±æ˜¯O(V^2)ï¼ŒVä¸ºç‚¹æ•°\n> æ•°æ®ç»“æ„ä¸­å¯¹äºç¨€ç–å›¾çš„å®šä¹‰ä¸ºï¼šæœ‰å¾ˆå°‘æ¡è¾¹æˆ–å¼§ï¼ˆè¾¹çš„æ¡æ•°|E|è¿œå°äº|V|Â²ï¼‰çš„å›¾ç§°ä¸ºç¨€ç–å›¾ï¼ˆsparse graphï¼‰ï¼Œåä¹‹è¾¹çš„æ¡æ•°|E|æ¥è¿‘|V|Â²ï¼Œç§°ä¸ºç¨ å¯†å›¾ï¼ˆdense graphï¼‰ã€‚\n\n**è§£æ³•äºŒ**\n\nKruskal + å¹¶æŸ¥é›†ï¼Œæ¯”è¾ƒé€‚åˆç¨€ç–å›¾ï¼Œè¿™é‡Œæ—¶æœºå¤æ‚åº¦æ˜¯O(ElogE)ï¼ŒEä¸ºè¾¹æ•°\n```java\n//Kruskal+UnionFind\n//ä»¥è¾¹ä¸ºä¸­å¿ƒï¼Œé¦–å…ˆæ„é€ å‡ºæ‰€æœ‰çš„è¾¹ï¼Œç„¶åæ’åºï¼Œä»æœ€çŸ­çš„è¾¹å¼€å§‹ï¼Œåˆå¹¶è¯¥è¾¹çš„ä¸¤ä¸ªç«¯ç‚¹ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°å¹¶æŸ¥é›†\n//åˆå¹¶n-1æ¬¡åå°±å¾—åˆ°mstï¼ˆnä¸ºèŠ‚ç‚¹æ•°ï¼‰ï¼Œé€‚åˆç¨€ç–å›¾\nint[] parent;\nint[] rank;\n//è·¯å¾„å‹ç¼©\npublic int find(int a){\n    if (parent[a] == a) {\n        return a;\n    }\n    return parent[a] = find(parent[a]);\n}\n\npublic boolean union(int a, int b) {\n    int pa = find(a);\n    int pb = find(b);\n    if (pa == pb) {\n        return false;\n    }\n    //éšä¾¿åˆå¹¶ 553ms\n    //parent[pa] = pb;\n    //æŒ‰ç§©åˆå¹¶ 564ms ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚ã€‚ã€‚\n    if (rank[pa] > rank[pb]) {\n        parent[pb] = pa;\n    }else if (rank[pb] > rank[pa]) {\n        parent[pa] = pb;\n    }else{\n        parent[pa] = pb;\n        rank[pb]++;\n    }\n    return true;\n}\n\npublic int minCostConnectPoints(int[][] points) {\n    int n = points.length;\n    parent = new int[n];\n    rank = new int[n];\n    //n-1 + n-2 + n-3 +...+ 1 = (n-1) + (n-1)*(n-2)/2 = n(n-1)/2\n    //5 : 4+3+2+1 = 4*\n    //0,1: ç«¯ç‚¹ï¼Œ2: è¾¹æƒå€¼\n    int[][] edge = new int[n*(n-1)/2][3];\n    int idx = 0;\n    for (int i = 0; i < n; i++) {\n        for (int j = i+1; j < n; j++) {\n            int dis = Math.abs(points[i][0]-points[j][0])+Math.abs(points[i][1]-points[j][1]);\n            edge[idx++] = new int[]{i, j, dis};\n        }\n        parent[i] = i;\n        rank[i] = 1;\n    }\n    //æŒ‰ç…§è¾¹çš„æƒå€¼æ’åº\n    Arrays.sort(edge, (e1, e2)->e1[2]-e2[2]);\n    int res = 0;\n    int count = 0;\n    for (int i = 0; i < edge.length; i++) {\n        if (union(edge[i][0], edge[i][1])) {\n            res += edge[i][2];\n            count++;\n        }\n        if (count == n-1) {\n            break;\n        }\n    }\n    return res;\n}\n```","tags":["LeetCode","åŠ¨æ€è§„åˆ’"],"categories":["ç®—æ³•"]},{"title":"æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆäºŒï¼‰","url":"/2019/08/17/shen-ru-li-jie-java-xu-ni-ji-er/","content":"\n> è¿™ä¸€ç¯‡ä¸»è¦è®²JVMçš„ç±»åŠ è½½æœºåˆ¶ï¼Œæœ¬æ¥å¾ˆä¹…ä¹‹å‰å°±å†™äº†ï¼Œä½†æ˜¯è¿™å‡ å¤©åˆé‡æ–°å­¦ä¹ äº†ä¸€éï¼Œçº æ­£äº†ä¹‹å‰å¾ˆå¤šé”™è¯¯çš„è§‚ç‚¹ï¼Œç„¶ååˆè¡¥å……äº†å¾ˆå¤šä¸œè¥¿\n\n## ç±»åŠ è½½çš„è¿‡ç¨‹\n\n**å‰è¨€ï¼š**\n\nåœ¨Javaè¯­è¨€ä¸­ï¼Œç±»å‹çš„åŠ è½½ï¼Œè¿æ¥å’Œåˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯åœ¨**è¿è¡ŒæœŸé—´**å®Œæˆçš„ï¼Œè¿™ä¸é‚£äº›åœ¨**ç¼–è¯‘æœŸé—´**éœ€è¦è¿›è¡Œé“¾æ¥å·¥ä½œçš„è¯­è¨€ï¼ˆC/C++ï¼‰ä¸åŒï¼Œè¿™æ ·æ¯«æ— ç–‘é—®ä¼šå¢åŠ ç±»åŠ è½½çš„æ€§èƒ½å¼€é”€ï¼Œä½†æ˜¯ä¼šä¸ºJavaæä¾›é«˜åº¦çš„çµæ´»æ€§ï¼ŒJavaå¤©ç”Ÿå¯ä»¥åŠ¨æ€æ‰©å±•çš„å°±æ˜¯ä¾èµ–äºè¿è¡Œæ—¶æœŸ**åŠ¨æ€åŠ è½½å’ŒåŠ¨æ€é“¾æ¥**è¿™ä¸ªç‰¹ç‚¹å®ç°çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¥å£ï¼Œå®Œå…¨å¯ä»¥åœ¨è¿è¡Œæ—¶æœŸåŠ¨æ€çš„æŒ‡å®šå…¶å…·ä½“çš„å®ç°ç±»ã€‚åˆæˆ–è€…ç”¨æˆ·å¯ä»¥é€šè¿‡ç±»åŠ è½½å™¨è®©ä¸€ä¸ªæœ¬åœ°çš„å¼•ç”¨è¿è¡Œæ—¶ä»å…¶ä»–åœ°æ–¹ï¼ˆç½‘ç»œç­‰ï¼‰åŠ è½½ä¸€ä¸ªäºŒè¿›åˆ¶çš„æµä½œä¸ºç¨‹åºä»£ç çš„ä¸€éƒ¨åˆ†ã€‚\n\n![mark](http://static.imlgw.top///20190418/em4YNNmXXmho.png?imageslim)\n\n### â‘ åŠ è½½\n\n- é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚\n- å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚\n- åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ `java.lang.Class` å¯¹è±¡\n\n#### ç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©\n\n> ç±»åŠ è½½çš„æœ€ç»ˆäº§ç‰©æ˜¯ä½äºå †ä¸­çš„`Class`å¯¹è±¡\n\nã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹é‡Œé¢ä»‹ç»çš„JVMå†…å­˜ç»“æ„(p39)\n\n![JVMå†…å­˜ç»“æ„](http://static.imlgw.top///20190417/yk2bzxILsCpL.png?imageslim)\n\n\n\n**å †ï¼ˆHeapï¼‰**ï¼šæœ€å¤§çš„ä¸€å—åŒºåŸŸï¼Œçº¿ç¨‹å…±äº«ã€‚æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ã€‚å›æ”¶å™¨ä¸»è¦ç®¡ç†çš„å¯¹è±¡ã€‚\n\n> The Java Virtual Machine has a *heap* that is `shared` among `all` Java Virtual Machine threads. The heap is the run-time data area from which memory for all class instances and arrays is allocated.\n>\n> The heap is created on virtual machine `start-up`. Heap storage for objects is reclaimed by an automatic storage management system (known as a *garbage collector(GC)*); \n>\n> æ‘˜è‡ª  [å®˜æ–¹æ–‡æ¡£](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.3)\n\n**æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰**ï¼šåˆç§°ä¸º`éå †`ï¼Œçº¿ç¨‹å…±äº«ã€‚å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚\n\n> The Java Virtual Machine has a *method area* that is `shared` among all Java Virtual Machine threads. The method area is analogous to the storage area for compiled code of a conventional language or analogous to the \"text\" segment in an operating system process. It stores per-class structures such as the **run-time constant pool**, **field** and **method data**, and the code for methods and constructors, including the special methods ([Â§2.9](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.9)) used in class and instance initialization and interface initialization.\n\n**è¿è¡Œæ—¶å¸¸é‡æ± (run-time constant pool)**ï¼š\n\næ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡\"123\"ï¼Œ\"LGW\" ç­‰å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå’Œç¬¦å·å¼•ç”¨ã€‚è¿è¡Œæ—¶å¸¸é‡æ± å…·æœ‰åŠ¨æ€æ€§ï¼Œå¹¶éåªæœ‰Classæ–‡ä»¶ä¸­çš„å†…å®¹æ‰èƒ½è¿›å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œè¿è¡ŒæœŸé—´ä¹Ÿèƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ã€‚å¦‚String.intern()æ–¹æ³•ã€‚\n\n**æ–¹æ³•æ ˆï¼ˆJVM Stackï¼‰**ï¼š\n\nçº¿ç¨‹ç§æœ‰ã€‚å­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ï¼Œ`å¯¹è±¡æŒ‡é’ˆ`ã€‚\n\n**æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰**ï¼š\n\nçº¿ç¨‹ç§æœ‰ã€‚ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Native æ–¹æ³•æœåŠ¡ã€‚å¦‚Javaä½¿ç”¨cæˆ–è€…c++ç¼–å†™çš„æ¥å£æœåŠ¡æ—¶ï¼Œä»£ç åœ¨æ­¤åŒºè¿è¡Œã€‚\n\n**ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰**ï¼š\n\nçº¿ç¨‹ç§æœ‰ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚æŒ‡å‘ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚\n\n#### åŠ è½½ç±»çš„æ–¹å¼\n\n- æœ¬åœ°ç£ç›˜ classpath\n- å†…å­˜ä¸­åŠ è½½ ï¼ŒåŠ¨æ€ä»£ç†ï¼ŸRPC?\n- é€šè¿‡ç½‘ç»œåŠ è½½.class\n- ä»zipï¼Œjarä¸­åŠ è½½\n- æ•°æ®åº“ä¸­æå–.class\n- åŠ¨æ€ç¼–è¯‘\n\n### â‘¡è¿æ¥:  \n\n#### éªŒè¯ \n\n**æ–‡ä»¶æ ¼å¼éªŒè¯**\n\n- æ˜¯å¦ä»¥é­”æ•°`0xCAFEBABE`ï¼ˆå’–å•¡å®è´ï¼‰å¼€å¤´\n\n- ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†…\n\n- å¸¸é‡æ± ä¸­çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡tagæ ‡å¿—ï¼‰\n\n- .....\n\n**å…ƒæ•°æ®éªŒè¯**\n\nç¬¬äºŒé˜¶æ®µæ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„è¦æ±‚\n\n**å­—èŠ‚ç éªŒè¯**\n\nä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„\n\nç”±äºæ•°æ®æµéªŒè¯çš„é«˜å¤æ‚æ€§ï¼Œè™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿä¸ºäº†é¿å…è¿‡å¤šçš„æ—¶é—´æ¶ˆè€—åœ¨å­—èŠ‚ç éªŒè¯é˜¶æ®µï¼Œåœ¨ JDK 1.6 ä¹‹åçš„ Javac ç¼–è¯‘å™¨å’Œ Java è™šæ‹Ÿæœºä¸­è¿›è¡Œäº†ä¸€é¡¹ä¼˜åŒ–ï¼Œç»™æ–¹æ³•ä½“çš„ Code å±æ€§çš„å±æ€§è¡¨ä¸­å¢åŠ äº†ä¸€é¡¹åä¸º\" StackMapTable\" çš„å±æ€§, åªéœ€è¦æ£€æŸ¥StackMapTableå±æ€§ä¸­çš„è®°å½•æ˜¯å¦åˆæ³•çš†å¯ä»¥äº†\n\n**ç¬¦å·å¼•ç”¨éªŒè¯**\n\nç¬¦å·å¼•ç”¨çš„æ ¡éªŒå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†`ç¬¦å·å¼•ç”¨`è½¬åŒ–ä¸º`ç›´æ¥å¼•ç”¨`çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”-**è§£æ**é˜¶æ®µä¸­å‘ç”Ÿï¼Œé€šå¸¸éœ€è¦æ ¡éªŒä»¥ä¸‹å†…å®¹ï¼š\n\n- ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»\n- åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•çš„å­—æ®µæè¿°ä»¥åŠç®€å•åç§°è¯´æè¿°çš„æ–¹æ³•å’Œå­—æ®µã€‚\n- ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ï¼Œå­—æ®µï¼Œæ–¹æ³•çš„è®¿é—®æ€§æ˜¯å¦å¯ä»¥è¢«å½“å‰ç±»è®¿é—®\n- .......\n\nå¦‚æœæ‰€è¿è¡Œçš„å…¨éƒ¨ä»£ç ï¼ˆåŒ…æ‹¬è‡ªå·±ç¼–å†™çš„åŠç¬¬ä¸‰æ–¹åŒ…ä¸­çš„ä»£ç ï¼‰éƒ½å·²ç»è¢«åå¤ä½¿ç”¨å’ŒéªŒè¯è¿‡ï¼Œé‚£ä¹ˆåœ¨å®æ–½é˜¶æ®µå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨-Xverify:none å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´\n\n#### å‡†å¤‡\n\nä¸ºç±»çš„**é™æ€å˜é‡**åˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼\n\n| æ•°æ®ç±»å‹  | é»˜è®¤å€¼   |\n| --------- | -------- |\n| boolean   | false    |\n| char      | '/u0000' |\n| byte      | (byte)0  |\n| short     | (short)0 |\n| int       | 0        |\n| long      | 0L       |\n| double    | 0.0d     |\n| float     | 0.0f     |\n| reference | null     |\n\nğŸ¯ å½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šåˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œå¦‚æœå­—æ®µè¡¨çš„å±æ€§ä¸­æœ‰`ConstantValue` ï¼Œå‡†å¤‡é˜¶æ®µå°±ä¼šç›´æ¥åˆå§‹åŒ–ä¸ºè¿™ä¸ªè¿™ä¸ª`ConstantValue`å±æ€§çš„å€¼\n\n#### è§£æ\n\nè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†**å¸¸é‡æ± **å†…çš„**ç¬¦å·å¼•ç”¨**æ›¿æ¢ä¸º**ç›´æ¥å¼•ç”¨**çš„è¿‡ç¨‹ã€‚\n\n- **ç¬¦å·å¼•ç”¨ï¼š** ç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨çš„æ—¶å€™èƒ½æ— æ­§ä¹‰çš„å®šä½åˆ°ç›®æ ‡ä¸­å°±è¡Œã€‚\n- **ç›´æ¥å¼•ç”¨ï¼š** ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆï¼Œç›¸å¯¹åç§»é‡æˆ–è€…ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚\n\né™¤ `invokedynamic`(åŠ¨æ€è¯­è¨€æ”¯æŒ) æŒ‡ä»¤ä»¥å¤–ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥å¯¹ç¬¬ä¸€æ¬¡è§£æçš„ç»“æœè¿›è¡Œç¼“å­˜ã€‚\n\nè§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µè§£æã€ç±»æ–¹æ³•è§£æã€æ¥å£æ–¹æ³•è§£æã€æ–¹æ³•ç±»å‹è§£æã€æ–¹æ³•å¥æŸ„è§£æå’Œè°ƒç”¨ç‚¹é™å®šç¬¦ 7 ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚\n\nå…³äºè¿™ä¸ªä¹Ÿå¯ä»¥çœ‹çœ‹Rå¤§çš„å›ç­” [JVMç¬¦å·å¼•ç”¨è½¬æ¢ç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ ](https://www.zhihu.com/question/30300585/answer/51335493)( å¹çˆ†æˆ‘Rå¤§ ğŸ˜\n\n### â‘¢åˆå§‹åŒ–ï¼š\n\nåˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œ`ç±»æ„é€ å™¨<clinit>`æ–¹æ³•çš„è¿‡ç¨‹\n\n#### ç±»æ„é€ å™¨&lt;client&gt;\n\nğŸ’¡`<clinit>`æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰**ç±»å˜é‡çš„èµ‹å€¼**åŠ¨ä½œå’Œ**é™æ€è¯­å¥å—**ï¼ˆstaticå—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­**å‡ºç°çš„é¡ºåºå†³å®šçš„**ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—**å¯ä»¥èµ‹å€¼**ï¼Œä½†æ˜¯**ä¸èƒ½è®¿é—®**ï¼ˆæ¯”å¦‚printï¼‰\n\nğŸ’¡ å’Œ**å®ä¾‹æ„é€ å™¨**`<init>` ä¸åŒï¼Œä¸éœ€è¦æ˜¾å¼çš„å»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯å­ç±»çš„`<clinit>`æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„`<clinit>`æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„`<clinit>` ä¸€å®šæ˜¯Objectç±»\n\nğŸ’¡` <clinit>` æ–¹æ³•å¯¹äºç±»æˆ–è€…æ¥å£æ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ä¹Ÿæ²¡æœ‰é™æ€å˜é‡çš„**èµ‹å€¼**æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ`<clinit>` æ–¹æ³•\n\nğŸ’¡ å¯¹äºæ¥å£ï¼Œä¸èƒ½ä½¿ç”¨staticå—ï¼Œä½†æ˜¯å¯ä»¥æœ‰é™æ€å˜é‡çš„èµ‹å€¼æ“ä½œã€‚å­ç±»æ¥å£çš„`<clinit>`æ–¹æ³•è°ƒç”¨å¹¶ä¸ä¿è¯çˆ¶æ¥å£çš„`<clinit>`æ–¹æ³•è¢«å…ˆè°ƒç”¨ï¼Œåªæœ‰ç”¨åˆ°çˆ¶æ¥å£çš„é™æ€å˜é‡çš„æ—¶å€™ï¼Œçˆ¶æ¥å£`<clinit>`æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ã€‚æ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„`<clinit>`æ–¹æ³•ã€‚\n\nğŸ’¡ è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„`<clinit>`æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åœ°åŠ é”ã€åŒæ­¥ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„`<clinit>`æ–¹æ³•è°ƒç”¨æ—¶é—´è¿‡é•¿ï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ã€‚Demoå¦‚ä¸‹\n\n```java\npublic class ClinitThreadTest {\n    public static void main(String[] args) {\n        new Thread(()->new SimpleObj()).start();\n        new Thread(()->new SimpleObj()).start();\n        new Thread(()->new SimpleObj()).start();\n    }\n\n    static class SimpleObj{\n        private static AtomicBoolean init=new AtomicBoolean(true);\n\n        static {\n            System.out.println(Thread.currentThread().getName()+\" i will be init\");\n            while (init.get()){\n\n            }\n            System.out.println(\"i am finished\");\n       }\n    }\n}\n```\n\n#### ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼\n\nä¸‹é¢è¿™ä¸ªDemoå¾ˆç»å…¸ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ç±»åŠ è½½çš„è¿‡ç¨‹\n\n```java\npublic class SingleTon {\n    private static SingleTon ins=new SingleTon();\n\n    public static  int x=0;\n\n    public static int y;\n\n    private SingleTon(){\n        x++;y++;\n    }\n\n    public static SingleTon getIns(){\n        return ins;\n    }\n\n    public static void main(String[] args) {\n        SingleTon singleTon=getIns();\n        System.out.println(singleTon.x);\n        System.out.println(singleTon.y);\n    }\n}\n```\n\nå¦‚æœä¸ç†Ÿæ‚‰ç±»åŠ è½½çš„è¿‡ç¨‹å¯èƒ½ä¸€çœ¼å°±è§‰å¾—åº”è¯¥æ˜¯ï¼ˆ1ï¼Œ1ï¼‰ï¼Œå…¶å®ä¸ç„¶ï¼Œç»“åˆä¸Šé¢çš„åŠ è½½è¿‡ç¨‹åˆ†æ\n\nğŸ”º é¦–å…ˆåŠ è½½è¿æ¥ï¼Œç„¶åæ‰§è¡Œå‡†å¤‡å·¥ä½œï¼Œåœ¨æ‰§è¡Œå®Œ**å‡†å¤‡é˜¶æ®µ**å·¥ä½œåä¸‰ä¸ªé™æ€å˜é‡éƒ½æœ‰äº†**é»˜è®¤çš„åˆå§‹å€¼**ï¼Œç„¶åè¿›å…¥åˆå§‹åŒ–é˜¶æ®µ\n\nğŸ”º `<clinit>`åˆå§‹åŒ–é˜¶æ®µä¼šæŒ‰é¡ºåº**ä»ä¸Šå¾€ä¸‹**ä¾æ¬¡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼Œæ‰€ä»¥**å…ˆæ‰§è¡Œ**äº†`new Singleton()`ç»™`ins`èµ‹åˆå§‹å€¼ï¼Œä¼šè°ƒç”¨å®ƒçš„æ„é€ å™¨ï¼Œç„¶åxï¼Œyéƒ½++å˜ä¸º1ï¼Œ**å†ç„¶å**å°±ä¼šç»™xï¼Œyèµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼Œxåˆå§‹å€¼ä¸º0ï¼Œè€Œyæ²¡æœ‰åˆå§‹å€¼æ‰€ä»¥å°±æ˜¯ï¼ˆ0ï¼Œ1ï¼‰\n\n### Classå¯¹è±¡åœ¨å“ªé‡Œï¼Ÿ\n\nå…ˆè¯´ç»“è®ºï¼ŒClasså¯¹è±¡å’Œå…¶ä»–æ™®é€šçš„Javaå¯¹è±¡ä¸€æ ·éƒ½æ˜¯å­˜æ”¾åœ¨å †ä¸­çš„ã€‚\n\nå­˜æ”¾åœ¨æ–¹æ³•åŒºçš„æ˜¯ç±»çš„å…ƒæ•°æ®(InstanceKlassï¼ŒåŒ…æ‹¬ç±»çš„å¸¸é‡æ± ( constant pool)  ï¼ŒåŸŸ(Field)ä¿¡æ¯  ï¼Œæ–¹æ³•(Method)ä¿¡æ¯ ï¼Œé™¤äº†å¸¸é‡å¤–çš„æ‰€æœ‰é™æ€(static)å˜é‡ ç­‰)ï¼Œ`java.lang.Classå®ä¾‹`å¹¶ä¸è´Ÿè´£è®°å½•çœŸæ­£çš„ç±»å…ƒæ•°æ®ï¼Œè€Œåªæ˜¯å¯¹VMå†…éƒ¨çš„`InstanceKlass`å¯¹è±¡çš„ä¸€ä¸ªåŒ…è£…ä¾›Javaçš„åå°„è®¿é—®ç”¨ï¼Œåœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸€ä¹¦é‡Œé¢è¯´çš„å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­åº”è¯¥æ˜¯æœ‰é—®é¢˜çš„ã€‚\n\n**ç±»(é™æ€)å˜é‡å­˜æ”¾åœ¨å“ªé‡Œ**\n\nä»JDK 1.3åˆ°JDK 6çš„HotSpot VMï¼Œé™æ€å˜é‡ä¿å­˜åœ¨ç±»çš„å…ƒæ•°æ®ï¼ˆInstanceKlassï¼‰çš„æœ«å°¾(æ°¸ä¹…ä»£)ã€‚è€Œä»JDK 7å¼€å§‹çš„HotSpot VMï¼Œé™æ€å˜é‡åˆ™æ˜¯ä¿å­˜åœ¨ç±»çš„Javaé•œåƒï¼ˆjava.lang.Classå®ä¾‹ï¼‰çš„æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯å †ä¸­\n\nå‚è€ƒ Rå¤§ [çŸ¥ä¹å›ç­”](https://www.zhihu.com/question/50258991) \n\n## Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼\n\næ‰€æœ‰çš„javaè™šæ‹Ÿæœºå®ç°å¿…é¡»åœ¨æ¯ä¸ªç±»æˆ–æ¥å£è¢«javaç¨‹åº**é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨**æ—¶æ‰**åˆå§‹åŒ–**å®ƒä»¬\n\n### ä¸»åŠ¨ä½¿ç”¨\n\n- åˆ›å»ºç±»çš„å®ä¾‹ï¼ˆnewï¼‰\n- å¯¹æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡è¿›è¡Œè¯»å†™ï¼ˆgetstaticï¼Œputstaticï¼‰\n- è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ï¼ˆinvokestaticï¼‰\n- åå°„æŸä¸ªç±» ï¼ˆClass.forName()ä¹Ÿå¯ä»¥è®¾ç½®ä¸åˆå§‹åŒ–ç±»ï¼‰\n- åˆå§‹åŒ–å­ç±»æ—¶ä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±»\n- å¯åŠ¨ç±» java HelloWorld  åŒ…å«mainå‡½æ•°çš„ç±»\n- Jdk1.7çš„åŠ¨æ€è¯­è¨€æ”¯æŒ\n\n### è¢«åŠ¨ä½¿ç”¨\n\né™¤äº†ä¸Šé¢ 7 ä¸ªä¹‹å¤–ï¼Œå…¶å®ƒçš„éƒ½æ˜¯è¢«åŠ¨ä½¿ç”¨ï¼Œ**ä¸ä¼šåˆå§‹åŒ–ç±»**ï¼Œä¸‹é¢çš„Demoæœ‰å‡ ä¸ªå¾ˆå®¹æ˜“å‡ºé”™çš„çš„ä¾‹å­\n\n```java\npackage classloader_study.misc;\npublic class ClassActiveUse {\n    static {\n        System.out.println(\"main is init\");\n    }\n    public static void main(String[] args) throws ClassNotFoundException {\n        //System.out.println(Obj.t);\n        //Obj.getObj();\n        //Class.forName(\"classloader_study.Obj\");\n        //System.out.println(ObjChild.age);\n        \n        //çˆ¶ç±»ä¼šè¢«åˆå§‹åŒ– é€šè¿‡å­ç±»è°ƒç”¨çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œå­ç±»ä¸ä¼šåˆå§‹åŒ–ä½†æ˜¯ä¼šè¢«åŠ è½½ \n        //1. System.out.println(ObjChild.n);\n        //ä¸ä¼šåˆå§‹åŒ– å®šä¹‰åº”ç”¨æ•°ç»„ä¹Ÿä¸ä¼šåˆå§‹åŒ–ç±»ï¼Œä½†æ˜¯ä¼šåŠ è½½ç±»\n        //2. Obj [] arrays=new Obj[10]; \n        //ä¸ä¼šåˆå§‹åŒ– å¸¸é‡ä¼šåœ¨ç¼–è¯‘æœŸé—´æ”¾åˆ°å¸¸é‡æ± ä¸­ä¸ä¼šåˆå§‹åŒ–ç±»ä¹Ÿä¸ä¼šåŠ è½½ï¼Œå­ç±»åŠ è½½ä¹Ÿä¸€æ ·\n        //3. System.out.println(Obj.t); \n        //Objä¼šè¢«åˆå§‹åŒ–   finalä¿®é¥°çš„å¤æ‚åŒ–ç±»å‹å†ç¼–è¯‘æœŸé—´æ— æ³•è®¡ç®—å¾—åˆ°ï¼Œä¼šåˆå§‹åŒ–ç±»\n        //4. System.out.println(Obj.x); \n        // ç±»åŠ è½½å™¨å»åŠ è½½\n        //5. ClassLoader.loadClass();\n    }\n}\n\nclass Obj{\n\n    public static  final int t=10;  //ç¼–è¯‘æœŸé—´å°±å·²ç»ç¡®å®šäº†å°±æ˜¯10\n\t\n    public static int n=111;\n    \n    public static final int x=new Random().nextInt(100); //å€¼ä¸æ˜¯å¸¸é‡ï¼Œè¿è¡ŒæœŸé—´æ‰ä¼šç¡®å®š\n    static { \n        System.out.println(\"Obj is init\");\n    }\n\n    public static void getObj(){\n        System.out.println(\"NULL\");\n    }\n}\n\nclass ObjChild extends Obj{\n    public static int age=12;\n\n    static {\n        System.out.println(\"Child is init\");\n    }\n}\ninterface I{\n    final static int a=0;\n}\n```\n\nâš¡new ä¸€ä¸ªObjæ•°ç»„çš„æ—¶å€™ï¼Œ**ä¼šåŠ è½½**Objç±»ï¼Œ**ä¸ä¼šåˆå§‹åŒ–**Objå¯¹è±¡ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å¦ä¸€ä¸ªç±»çš„åˆå§‹åŒ–: `Lclassloader_study.misc.Obj`  è¿™ä¸ªç±»å°±ä»£è¡¨äº†ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºObjçš„ä¸€ç»´æ•°ç»„ï¼Œæ•°ç»„ä¸­åº”æœ‰çš„å±æ€§lengthå’Œæ–¹æ³•clone()éƒ½æ˜¯åœ¨è¿™ä¸ªç±»å®ç°çš„ï¼Œè¿™ä¸ªç±»æ˜¯ç”±JVMåœ¨è¿è¡ŒæœŸé—´åŠ¨æ€çš„ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ï¼Œè¿™ä¸ªåŠ¨ä½œç”±`anewarray` æŒ‡ä»¤è§¦å‘ï¼Œè€ŒåŸºæœ¬ç±»å‹çš„æ•°ç»„ç”± `newarray` æŒ‡ä»¤è§¦å‘ã€‚\n\nâš¡ finalä¿®é¥°çš„å¸¸é‡ä¼šåœ¨**ç¼–è¯‘æœŸé—´**å°±æ”¾åˆ°è°ƒç”¨è¿™ä¸ªå˜é‡çš„æ–¹æ³•çš„ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæ—¢ä¸ä¼šåŠ è½½ä¹Ÿä¸ä¼šåˆå§‹åŒ–ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åç¼–è¯‘`ClassActiveUse` çœ‹çš„åˆ°ï¼Œä¸¤ä¸ªç±»ä¸å­˜åœ¨ä»»ä½•å…³ç³»äº†ï¼Œç”šè‡³å¯ä»¥åœ¨ç¼–è¯‘å®Œæˆå`å°†Objçš„classæ–‡ä»¶åˆ æ‰`ä»ç„¶å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯åé¢çš„å¦ä¸€ä¸ªfinalå¸¸é‡å¾ˆæ˜æ˜¾åœ¨**ç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šå€¼**ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½å›å»åˆ°å€¼ï¼Œæ‰€ä»¥ä¼šåŠ è½½å¹¶åˆå§‹åŒ–ç±»\n\nâš¡ å¯¹æ¥å£çš„åˆå§‹åŒ–å’Œå¯¹ç±»çš„åˆå§‹åŒ–æœ‰ä¸€ç‚¹ä¸åŒï¼Œæ¥å£ä¹Ÿæœ‰åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ¥å£å’Œç±»çœŸæ­£æœ‰åŒºåˆ«æ˜¯åœ¨ä¸Šé¢ä¸»åŠ¨ä½¿ç”¨çš„ç¬¬5ç‚¹ï¼Œåœ¨**å­æ¥å£è¢«åŠ è½½çš„æ—¶å€™å¹¶ä¸è¦æ±‚å…¶çˆ¶æ¥å£å…¨éƒ¨å®Œæˆäº†åˆå§‹åŒ–**ï¼Œåªæœ‰åœ¨çœŸæ­£ä½¿ç”¨åˆ°çˆ¶æ¥å£çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ï¼Œè¿™ä¸€ç‚¹å¯ä»¥å‚è€ƒå‰æ–‡çš„ [ç±»æ„é€ å™¨éƒ¨åˆ†](#â‘¢åˆå§‹åŒ–ï¼š)\n\n> `-XX:+TraceClassLoading` å¯ä»¥ç”¨æ¥è¿½è¸ªç±»çš„åŠ è½½ä¿¡æ¯å¹¶ä¸”æ‰“å°å‡ºæ¥\n\n###  å¯¹è±¡çš„è®¿é—®å®šä½\n\n**å¦‚æœç›´æ¥ä½¿ç”¨å¥æŸ„è®¿é—®**ï¼Œjavaå †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreferenceä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![mark](http://static.imlgw.top///20190418/FRA9GB31iiXH.png?imageslim)\n\n**å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®**ï¼Œé‚£ä¹ˆjavaå †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œreferenceä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè‡ªå·±Classå¯¹è±¡çš„å¼•ç”¨(`getClass`)\n\n![mark](http://static.imlgw.top///20190418/1OtoI6wkivdz.png?imageslim)\n\nè¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ï¼Œä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯referenceä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œreferenceæœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚\n\nä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼çš„æœ€å¤§å¥½å¤„å°±æ˜¯é€Ÿåº¦æ›´å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚HotSpotè™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯ç›´æ¥æŒ‡é’ˆè®¿é—®çš„æ–¹å¼ã€‚å¥æŸ„æ¥è®¿é—®çš„æƒ…å†µä¹Ÿååˆ†å¸¸è§ã€‚\n\n## JVMç±»åŠ è½½å™¨\n\n### æ¦‚è¿°\n\n> è™šæ‹Ÿæœºè®¾è®¡å›¢é˜ŸæŠŠåŠ è½½é˜¶æ®µä¸­çš„ `â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€` è¿™ä¸ªåŠ¨ä½œè¢«æ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿äºè®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç æ¨¡å—ç§°ä¸º `â€œç±»åŠ è½½å™¨â€`\n\n ç±»åŠ è½½å™¨å¹¶ä¸éœ€è¦ç­‰åˆ°æŸä¸ªç±»è¢« \"é¦–æ¬¡ä½¿ç”¨\" æ—¶æ‰åŠ è½½å®ƒï¼Œè¿™ä¸€ç‚¹ä»å‰é¢è®²è§£çš„ [è¢«åŠ¨ä½¿ç”¨çš„ä¾‹å­](#è¢«åŠ¨ä½¿ç”¨) å“ªé‡Œå°±çœ‹å¾—å‡ºæ¥\n\nJVMè§„èŒƒå…è®¸ç±»åŠ è½½å™¨åœ¨é¢„æ–™æŸä¸ªç±»å°†è¦è¢«ä½¿ç”¨çš„æ—¶å€™å°±é¢„å…ˆåŠ è½½å®ƒï¼Œå¦‚æœåœ¨é¢„å…ˆåŠ è½½çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†classæ–‡ä»¶ç¼ºå¤±æˆ–è€…å­˜åœ¨é”™è¯¯ï¼Œç±»åŠ è½½å™¨å¿…é¡»åœ¨ç¨‹åº**é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨**è¯¥ç±»æ—¶æ‰æŠ¥å‘Šé”™è¯¯ï¼ˆLinkageErroré”™è¯¯ï¼‰\n\n å¦‚æœè¿™ä¸ªç±»ä¸€ç›´æ²¡æœ‰è¢«ç¨‹åºä¸»åŠ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆç±»åŠ è½½å™¨å°±ä¸ä¼šæŠ¥å‘Šé”™è¯¯\n\n![JVMç±»åŠ è½½å™¨](http://static.imlgw.top///20190419/pKeI6Bx6lbcX.png?imageslim)\n\n\n\n**æ ¹ï¼ˆBootstrapï¼‰ç±»åŠ è½½å™¨**\n\nè¯¥åŠ è½½å™¨æ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½è™šæ‹Ÿæœºçš„æ ¸å¿ƒç±»åº“ï¼Œå¦‚java.lang.*ç­‰ã€‚æ ¹ç±»åŠ è½½å™¨ä»ç³»ç»Ÿå±æ€§sun.boot.class.pathæ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ã€‚æ ¹ç±»åŠ è½½å™¨çš„å®ç°ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿï¼Œå±äºè™šæ‹Ÿæœºçš„å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¹¶æ²¡æœ‰ç»§æ‰¿ java.lang.ClassLoaderç±»(c/c++å®ç°çš„)ã€‚\n\n```java\nSystem.out.println(System.getProperty(\"sun.boot.class.path\"));\nD:\\java\\jre\\lib\\resources.jar;D:\\java\\jre\\lib\\rt.jar;D:\\java\\jre\\lib\\sunrsasign.jar;D:\\java\\jre\\lib\\jsse.jar;D:\\java\\jre\\lib\\jce.jar;D:\\java\\jre\\lib\\charsets.jar;D:\\java\\jre\\lib\\jfr.jar;D:\\java\\jre\\classes\n```\n\n**æ‰©å±•ï¼ˆExtensionï¼‰ç±»åŠ è½½å™¨**\n\nå®ƒçš„çˆ¶åŠ è½½å™¨ä¸ºæ ¹ç±»åŠ è½½å™¨ã€‚å®ƒä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–è€…ä»JDKçš„å®‰è£…ç›®å½•çš„jre.lib.extå­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰ä¸‹åŠ è½½ç±»åº“ï¼Œå¦‚æœæŠŠç”¨æˆ·åˆ›å»ºçš„**JAR**æ–‡ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚æ‰©å±•ç±»åŠ è½½å™¨æ˜¯çº¯Javaç±»ï¼Œæ˜¯ java.lang.ClassLoaderç±»çš„å­ç±»ã€‚\n\n```java\nSystem.out.println(System.getProperty(\"java.ext.dirs\")); //java.ext.dirså±æ€§\nD:\\java\\jre\\lib\\ext;C:\\WINDOWS\\Sun\\Java\\lib\\ext\n```\n\n**ç³»ç»Ÿï¼ˆSystemï¼‰ç±»åŠ è½½å™¨**\n\nä¹Ÿç§°ä¸ºåº”ç”¨ç±»åŠ è½½å™¨ï¼Œå®ƒçš„çˆ¶åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨ã€‚å®ƒä»ç¯å¢ƒå˜é‡classpathæˆ–è€…ç³»ç»Ÿå±æ€§java.class.pathæ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»ï¼Œå®ƒæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„`é»˜è®¤çˆ¶åŠ è½½å™¨`ã€‚ç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯çº¯Javaç±»ï¼Œæ˜¯java.lang.ClassLoaderç±»çš„å­ç±»ã€‚\n\n```java\nSystem.out.println(System.getProperty(\"java.class.path\"));\nD:\\java\\jre\\lib\\charsets.jar;D:\\java\\jre\\lib\\deploy.jar;\nD:\\java\\jre\\lib\\ext\\access-bridge-64.jar;\nD:\\java\\jre\\lib\\ext\\cldrdata.jar;\nD:\\java\\jre\\lib\\ext\\dnsns.jar;\nD:\\java\\jre\\lib\\ext\\jaccess.jar;\nD:\\java\\jre\\lib\\ext\\jfxrt.jar;\nD:\\java\\jre\\lib\\ext\\localedata.jar;\nD:\\java\\jre\\lib\\ext\\nashorn.jar;\nD:\\java\\jre\\lib\\ext\\sunec.jar;\nD:\\java\\jre\\lib\\ext\\sunjce_provider.jar;\nD:\\java\\jre\\lib\\ext\\sunmscapi.jar;\nD:\\java\\jre\\lib\\ext\\sunpkcs11.jar;\nD:\\java\\jre\\lib\\ext\\zipfs.jar;\nD:\\java\\jre\\lib\\javaws.jar;\nD:\\java\\jre\\lib\\jce.jar;\nD:\\java\\jre\\lib\\jfr.jar;\nD:\\java\\jre\\lib\\jfxswt.jar;\nD:\\java\\jre\\lib\\jsse.jar;\nD:\\java\\jre\\lib\\management-agent.jar;\nD:\\java\\jre\\lib\\plugin.jar;\nD:\\java\\jre\\lib\\resources.jar;\nD:\\java\\jre\\lib\\rt.jar;\nC:\\WorkSpace\\concurrent_package\\out\\production\\concurrent_package;\nC:\\JetBrains\\IntelliJ IDEA 2018.1.4\\lib\\idea_rt.jar\n```\n\n> å…¶å®æ‰€è°“çš„çˆ¶å­åŠ è½½å™¨å¹¶ä¸æ˜¯ç»§æ‰¿çš„çˆ¶å­å…³ç³»ï¼Œè€Œæ˜¯åŒ…å«çš„å…³ç³»ï¼Œå­åŠ è½½å™¨ä¸­åŒ…å«ä¸€ä¸ªçˆ¶åŠ è½½å™¨çš„å¼•ç”¨\n\n### è‡ªå®šä¹‰ç±»åŠ è½½å™¨\n\n**å…ˆçœ‹ä¸‹JDKçš„ClassLoader(1.8)æºç **\n\n```java\n protected Class<?> loadClass(String name, boolean resolve)\n        throws ClassNotFoundException\n    {\n        synchronized (getClassLoadingLock(name)) {\n            // First, check if the class has already been loaded\n            Class<?> c = findLoadedClass(name);\n            if (c == null) {\n                long t0 = System.nanoTime();\n                try {\n                    if (parent != null) {\n                        c = parent.loadClass(name, false);\n                    } else {\n                        //æ²¡æœ‰çˆ¶åŠ è½½å™¨å°±äº¤ç»™æ ¹åŠ è½½å™¨\n                        c = findBootstrapClassOrNull(name);\n                    }\n                } catch (ClassNotFoundException e) {\n                    // ClassNotFoundException thrown if class not found\n                    // from the non-null parent class loader\n                }\n\n                if (c == null) {\n                    // If still not found, then invoke findClass in order\n                    // to find the class.\n                    long t1 = System.nanoTime();\n                    //éœ€è¦å­ç±»å»å®ç°\n                    c = findClass(name);\n\n                    // this is the defining class loader; record the stats\n                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);\n                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);\n                    sun.misc.PerfCounter.getFindClasses().increment();\n                }\n            }\n            if (resolve) {\n                resolveClass(c);\n            }\n            return c;\n        }\n    }\n```\n\nè¿™æ˜¯ClassLoaderç±»åŠ è½½ç±»çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸€æ®µ \n\n```java\nif(parent!=null){  c = parent.loadClass(name, false);}\n```\n\nè¿™å°±æ˜¯**åŒäº²å§”æ´¾æœºåˆ¶**çš„å®ç°ï¼Œå§”æ‰˜çˆ¶ç±»ï¼Œè®©çˆ¶ç±»å»åŠ è½½ï¼Œçˆ¶ç±»(æ ¹åŠ è½½å™¨)æ²¡æœ‰å°±ä¼šå†å±‚å±‚ä¸‹é™å¦‚æœæœ‰ä¸€ä¸ªåŠ è½½æˆåŠŸå°±ä¼šæˆåŠŸè¿”å›ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜è°ƒç”¨äº†ä¸€ä¸ªæ²¡æœ‰å®ç°çš„`findClass`\n\n```java\nprotected Class<?> findClass(String name) throws ClassNotFoundException {\n    throw new ClassNotFoundException(name);\n}\n```\n\nä¹Ÿå°±æ˜¯è¯´æƒ³è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„è¯å°±å¾—é‡å†™`findClass`æ–¹æ³•ï¼Œå®é™…ä¸Šè¿™ä¸ª`findClass`æ‰æ˜¯ç±»åŠ è½½çš„æ ¸å¿ƒï¼ŒçœŸæ­£åŠ è½½Classæ–‡ä»¶è½¬æ¢ä¸ºCLasså®ä¾‹çš„å°±æ˜¯`findClass`æ–¹æ³•ï¼Œ `loadClass()`åªæ˜¯å®ç°åŠ è½½çš„é€»è¾‘ï¼Œæ¯”å¦‚**åŒäº²å§”æ´¾æœºåˆ¶**\n\n**å®ç°ä¸€ä¸ªç®€æ˜“çš„ClassLoader**\n\n```java\npublic class MyClassLoader extends ClassLoader {\n    //å°†å­—èŠ‚ç æ”¾åˆ°è¿™ä¸ªè·¯å¾„ä¸‹\n    private static final String DEFAULT_DIR = \"D:\\\\ClassLoaderTest\";\n\n    private String dir = DEFAULT_DIR;\n\n    private String classLoaderName;\n\n    public MyClassLoader() {\n        \n    }\n\n    public MyClassLoader(String classLoaderName) {\n        this.classLoaderName = classLoaderName;\n    }\n\n    public MyClassLoader(ClassLoader parent, String classLoaderName) {\n        super(parent);\n        this.classLoaderName = classLoaderName;\n    }\n\n    public String getDir() {\n        return dir;\n    }\n\n    public void setDir(String dir) {\n        this.dir = dir;\n    }\n\n    public String getClassLoaderName() {\n        return classLoaderName;\n    }\n\n    /**\n     * xx.xx.xx.xx.xx.AAA\n     * xx/xx/xx/xx/xx/.AAA.class\n     *\n     * @param name\n     * @return\n     * @throws ClassNotFoundException\n     */\n    @Override\n    protected Class<?> findClass(String name) throws ClassNotFoundException {\n        String classPath = name.replace(\".\", \"/\");\n        File classFile = new File(dir, classPath + \".class\");\n        if (!classFile.exists()) {\n            throw new ClassNotFoundException(\"The class \" + name + \" not found under \" + dir);\n        }\n\t\t//å­—èŠ‚ç æ–‡ä»¶çš„å­—èŠ‚æµ\n        byte[] classBytes = loadClassBytes(classFile);\n        if (null == classBytes || classBytes.length == 0)\n            throw new ClassNotFoundException(\"load the class \" + name + \" failed\");\n\t\t//defineClassæ–¹æ³•å¯ä»¥æŠŠäºŒè¿›åˆ¶æµå­—èŠ‚ç»„æˆçš„æ–‡ä»¶è½¬æ¢ä¸ºä¸€ä¸ªjava.lang.Class\n        return this.defineClass(name, classBytes, 0, classBytes.length);\n    }\n\t\n    //å°†æ–‡ä»¶æµè½¬æ¢ä¸ºå­—èŠ‚æµ\n    private byte[] loadClassBytes(File classFile) {\n        try (ByteArrayOutputStream baos = new ByteArrayOutputStream();\n             FileInputStream fis = new FileInputStream(classFile)) {\n            byte[] buffer = new byte[1024];\n            int len;\n            while ((len = fis.read(buffer)) != -1) {\n                baos.write(buffer, 0, len);\n            }\n            baos.flush();\n            return baos.toByteArray();\n        } catch (IOException e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n}\n```\n\n> defineClassæ–¹æ³•å¯ä»¥æŠŠäºŒè¿›åˆ¶æµå­—èŠ‚ç»„æˆçš„æ–‡ä»¶è½¬æ¢ä¸ºä¸€ä¸ªjava.lang.Classï¼Œå‰ææ˜¯Classæ–‡ä»¶æ˜¯åˆæ³•çš„ã€‚\n\n```java\n//è‡ªå®šä¹‰çš„éœ€è¦åŠ è½½çš„ç±»\npublic class MyObject {\n    static {\n        System.out.println(\"MyObject static is init\");\n    }\n\n    public void Hello(){\n        System.out.println(\"Hello World\");\n    }\n}\n```\n\n**æµ‹è¯•è‡ªå®šä¹‰çš„ClassLoader**\n\n```java\npublic class ClassLoaderTest {\n    public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException {\n        MyClassLoader loader=new MyClassLoader(\"Resolmi\");\n        //Class<?> aClass = loader.loadClass(\"classloader_study.myClassLoader.MyObject\");\n        Class<?> aClass = Class.forName(\"classloader_study.myClassLoader.MyObject\", true, loader);\n        System.out.println(aClass);\n        System.out.println(aClass.getClassLoader());\n\n        Object obj=aClass.newInstance();\n        Method hello = aClass.getMethod(\"Hello\", null);\n        hello.invoke(obj, new Object[]{});\n    }\n}\n```\n\nè¿™é‡Œç›´æ¥`loadClass`æˆ–è€…`Class.forName()`éƒ½å¯ä»¥ï¼Œé€šå¸¸æˆ‘ä»¬çš„forName()éƒ½æ˜¯é»˜è®¤ç”¨çš„**AppClassLoader**ä¹Ÿå°±æ˜¯ç³»ç»ŸåŠ è½½å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæˆ‘ä»¬çš„è‡ªå®šä¹‰åŠ è½½å™¨ä¼ é€’è¿›å»ã€‚\n\n> tip: loadClass ä¸ä¼šåˆå§‹åŒ–ç±»ï¼Œä¸å±äºä¸Šé¢æåˆ°çš„6ç§ä¸»åŠ¨ä½¿ç”¨çš„æ–¹å¼ï¼Œå±äºè¢«åŠ¨ä½¿ç”¨ï¼ŒClass.forName ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æ§åˆ¶æ˜¯å¦åˆå§‹åŒ–\n\n```java\nMyObject static is init\nclass classloader_study.myClassLoader.MyObject\nclassloader_study.myClassLoader.MyClassLoader@74a14482\nHello World\n```\n\nå¦‚æœä½¿ç”¨äº†`ide`çš„è¯ï¼Œè¿™é‡Œå¾ˆæœ‰å¯èƒ½ç¼–è¯‘å™¨å¸®ä½ è‡ªåŠ¨ç¼–è¯‘äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨ä½ çš„classpathé‡Œé¢å·²ç»æœ‰å­—èŠ‚ç æ–‡ä»¶äº†ï¼Œæ‰€ä»¥å°±ç›´äº¤ç»™AppClassLoaderåŠ è½½äº†ï¼Œæ‰€ä»¥éœ€è¦å°†classpathé‡Œé¢çš„åˆ æ‰ï¼Œå°†å­—èŠ‚ç æ‹·è´åˆ°ä½ è‡ªå®šä¹‰çš„classLoaderæŒ‡å®šçš„ç›®å½•é‡Œé¢ã€‚\n\n### åŒäº²å§”æ´¾æ¨¡å¼\n\nå³åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­å½“å‰ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œå¦‚æœè¢«åŠ è½½ï¼Œå°±ä¼šç›´æ¥è¿”å›å¯ç”¨çš„ç±»ï¼Œå¦åˆ™å°±ä¼šå°è¯•åŠ è½½ï¼Œåœ¨å°è¯•åŠ è½½æ—¶ï¼Œä¼šå…ˆè¯·æ±‚åŒäº²å¤„ç†ï¼Œå¦‚æœåŒäº²è¯·æ±‚å¤±è´¥ï¼Œåˆ™ä¼šè‡ªå·±åŠ è½½\n\nè¿™é‡Œå…‰çœ‹å‡ ä¸ªå†…ç½®çš„ClassLoaderå¯èƒ½è¿˜ä¸å¤ªæ¸…æ™°è¿™é‡Œç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„Loaderæ¥è¯•è¯•\n\n```java\npublic class MyClassLoaderTest2 {\n    public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InstantiationException, ClassNotFoundException {\n        //loader1çš„åŠ è½½ç›®å½•æ˜¯D:\\\\ClassLoaderTestï¼ˆé»˜è®¤çš„ï¼‰\n        MyClassLoader loader1=new MyClassLoader(\"Resolmi-father\");\n        //è®¾ç½®loader1ä¸ºloader2çš„çˆ¶åŠ è½½å™¨\n        MyClassLoader loader2=new MyClassLoader(loader1,\"Resolmi2-son\");\n        //è¿™ä¸ªç±»å­˜æ”¾åœ¨ D:\\\\ClassLoaderTest\\\\classloader_study\\\\myClassLoader ä¸‹é¢\n        Class<?> aClass = loader2.loadClass(\"classloader_study.myClassLoader.MyObject\");\n        //è®¾ç½®Loader2çš„åŠ è½½ç›®å½•ï¼Œè¿™æ˜¯ä¸ªç©ºç›®å½•ï¼Œä¸‹é¢ä»€ä¹ˆéƒ½æ²¡æœ‰\n        loader2.setDir(\"D:\\\\ClassLoaderTest2\");\n        System.out.println(aClass);\n        System.out.println(aClass.getClassLoader());\n        System.out.println(((MyClassLoader)aClass.getClassLoader()).getClassLoaderName());\n     }\n}\n```\n\næ§åˆ¶å°æ‰“å°å¦‚ä¸‹\n\n```java\nclass classloader_study.myClassLoader.MyObject\nclassloader_study.myClassLoader.MyClassLoader@74a14482\nResolmi-father\n```\n\næˆ‘ä»¬ç”¨`Loader2`å»åŠ è½½ç±»ï¼Œä½†æ˜¯è¿™ä¸ªç±»çš„åŠ è½½ç›®å½•æ˜¯ç©ºçš„ï¼Œç„¶åæˆ‘ä»¬æŒ‡å®š`Loader2` çš„çˆ¶åŠ è½½å™¨ä¸º`Loader1`è€Œ`loader1` å¾—åŠ è½½è·¯å¾„å°±æ˜¯è¦åŠ è½½å¾—ç±»çš„è·¯å¾„ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿™ä¸ªç±»æœ€ç»ˆè¿˜æ˜¯è¢«åŠ è½½å‡ºæ¥äº†ï¼Œè€Œä¸”æ˜¯è¢« `loader1`åŠ è½½å‡ºæ¥çš„ï¼Œä¹Ÿå°±æ˜¯`loader2`æŠŠåŠ è½½ä»»åŠ¡å§”æ‰˜ç»™äº†çˆ¶åŠ è½½å™¨`loader1`,ç„¶åå±‚å±‚å§”æ‰˜å†å›åˆ°`loader1`ï¼Œç”±å®ƒåŠ è½½ã€‚\n\nåˆ°è¿™é‡Œå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨åŒäº²å§”æ´¾æ¨¡å¼ï¼Ÿè¿™æ ·èµ°ä¸€åœˆå¤šæ…¢å•Šï¼Œå…¶å®è¿™æ ·åšä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢çš„åŸå› \n\nğŸ’¡ æé«˜ç³»ç»Ÿå®‰å…¨æ€§ï¼Œä½¿å¾— Java ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·æœ‰ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œä»è€Œä½¿å¾—åŸºç¡€ç±»å¾—åˆ°ç»Ÿä¸€ã€‚å¯¹äºä¸€äº›ç³»ç»Ÿæ ¸å¿ƒç±»ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„ä¸èµ·ä½œç”¨äº†ï¼Œå› ä¸ºéƒ½ä¼šäº¤ç»™`BootStrapLoader`å»åŠ è½½ï¼Œæ¯”å¦‚è‡ªå®šä¹‰äº†ä¸€ä¸ªjava.lang.Stringçš„ç±»ï¼Œç„¶ååœ¨åŠ è½½çš„æ—¶å€™ç»è¿‡å±‚å±‚å§”æ´¾æœ€åä¼šäº¤ç»™ `BootStrapLoader`å»åŠ è½½ç„¶åè¿”å›ï¼Œæ‰€ä»¥ä½ è‡ªå®šä¹‰çš„Stringæ ¹æœ¬æ²¡æœ‰åŠ è½½çš„æœºä¼šï¼Œè¿™æ ·å°±é¿å…äº†ç”¨æˆ·ç¯¡æ”¹Javaæ ¸å¿ƒçš„ç±»\n\nğŸ’¡ é¿å…é‡å¤åŠ è½½ï¼Œçˆ¶Loaderå·²ç»åŠ è½½è¿‡çš„ç±»ï¼Œå­Loaderå°±ä¸ç”¨å†åŠ è½½äº†ï¼Œæ¯”å¦‚`Objectç±»`è¿™ä¸ªç±»åœ¨`rt.jar`ä¸‹ï¼Œæ‰€ä»¥æ— è®ºæ˜¯åœ¨å“ªç§ç¯å¢ƒä¸‹ï¼Œæœ€ç»ˆéƒ½ä¼šäº¤ç»™`BootStrapClassLoader`å»åŠ è½½è¿™ä¸ªç±»ï¼ŒåŠ è½½å¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ª`Objectç±»`ï¼Œå¦‚æœä¸é‡‡ç”¨åŒäº²å§”æ´¾æœºåˆ¶ï¼Œè®©å„ä¸ªLoaderè‡ªå·±åŠ è½½é‚£ä¹ˆå¯èƒ½åŠ è½½å‡ºæ¥çš„å°±ä¼šæœ‰å¾ˆå¤šä¸ªObjectç±»ï¼ˆä¸æ˜¯åŒä¸€ä¸ªObjectç±»ï¼Œä¸‹é¢ä¼šè¯´åˆ°ï¼‰\n\n```java\nException in thread \"main\" java.lang.SecurityException: Prohibited package name: java.lang\n```\n\n### åŠ å¯†è§£å¯†ç±»åŠ è½½å™¨\n\næœ¬è´¨ä¸Šå’Œä¸Šé¢çš„æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±æ˜¯å¤šäº†è§£å¯†çš„åŠŸèƒ½ï¼Œè¿™é‡Œé¦–å…ˆç”¨åŠ å¯†å·¥å…·ç±»åŠ å¯†class\n\n```java\npublic final class EncryptUtil {\n\t//ç›¸å½“äºå¯†é’¥\n    public static final byte ENCRYPT_FACTOR = (byte) 0xff;\n\n    private EncryptUtil() {\n\n    }\n\n    public static void encrypt(String source, String target) throws FileNotFoundException {\n        try (FileInputStream in= new FileInputStream(source); FileOutputStream out = new FileOutputStream(target)) {\n            int data;\n            while ((data=in.read())!=-1){\n                out.write(data^ENCRYPT_FACTOR);\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n\n    public static void main(String[] args) throws FileNotFoundException {\n        encrypt(\"D:\\\\ClassLoaderTest\\\\classloader_study\\\\myClassLoader\\\\MyObject.class\",\"D:\\\\ClassLoaderTest\\\\classloader_study\\\\myClassLoader\\\\MyObject2.class\");\n    }\n}\n```\n\nç„¶åç”¨åŠ å¯†è§£å¯†ç±»åŠ è½½å™¨åŠ è½½è¿™ä¸ªç±»\n\n```java\npublic class DecryptClassLoader extends ClassLoader {\n\n    private final String DEFAULT_DIR = \"D:\\\\ClassLoaderTest\";\n\n    private String dir = DEFAULT_DIR;\n\n    public DecryptClassLoader() {\n        super();\n    }\n\n    public DecryptClassLoader(ClassLoader parent) {\n        super(parent);\n    }\n\n    @Override\n    protected Class<?> findClass(String name) throws ClassNotFoundException {\n        String classPath = name.replace(\".\", \"/\");\n        File classFile = new File(dir, classPath + \".class\");\n        if (!classFile.exists()) {\n            throw new ClassNotFoundException(\"æ²¡æ‰¾åˆ°å¯¹åº”çš„ç±»æ–‡ä»¶ ï¼š\" + dir);\n        }\n        byte[] classBytes = loadClassByte(classFile);\n        if (null == classBytes || classBytes.length == 0) {\n            throw new ClassNotFoundException(\"åŠ è½½å¤±è´¥\");\n        }\n        return this.defineClass(name, classBytes, 0, classBytes.length);\n    }\n\n    private byte[] loadClassByte(File classFile) {\n        try (FileInputStream in = new FileInputStream(classFile); ByteArrayOutputStream baos = new ByteArrayOutputStream()) {\n            int data;\n            while ((data=in.read())!=-1){\n                //ä¸»è¦å°±æ˜¯è¿™é‡Œå‘ç”Ÿäº†å˜åŒ–ï¼Œå¼‚æˆ–äº†0xff\n                baos.write(data^0xff);\n            }\n            return baos.toByteArray();\n        } catch (IOException e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n\n    public void setDir(String dir) {\n        this.dir = dir;\n    }\n}\n```\n\nå½“ç„¶ç»“æœæ˜¯åŠ è½½æˆåŠŸå•¦ğŸ˜‹ï¼Œè¿™é‡Œå¦‚æœç”¨å…¶ä»–çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œæˆ–è€…æŠŠ0xffé‚£é‡Œå»æ‰ï¼Œå°±ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯\n\n```java\nException in thread \"main\" java.lang.ClassFormatError: Incompatible magic value 889275713 in class file classloader_study/myClassLoader/MyObject\n\tat java.lang.ClassLoader.defineClass1(Native Method)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:763)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:642)\n\tat classloader_study.myClassLoader.MyClassLoader.findClass(MyClassLoader.java:64)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\tat classloader_study.encryption_study.ClassLoaderTest.main(ClassLoaderTest.java:15)\n```\n\nè¿™ä¸ªå¼‚å¸¸æ˜¯é“¾æ¥é˜¶æ®µéªŒè¯çš„é”™è¯¯ï¼Œæ˜¯ä¸Šé¢æåˆ°çš„`defineClass()`æŠ›å‡ºæ¥çš„ï¼Œå› ä¸ºä½ åŠ äº†å¯†ï¼ŒJVMåœ¨åŠ è½½è¿™ä¸ªäºŒè¿›åˆ¶æµçš„æ—¶å€™å°±æ— æ³•è¯†åˆ«äº†è‡ªç„¶å°±æ— æ³•åŠ è½½ã€‚\n\n### æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶\n\n**è¦†ç›–loadClass()**\n\nè¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ä¸»è¦å°±æ˜¯è¦è¦†ç›–`loadClass()`æ–¹æ³•ï¼Œè‡ªå·±å®šä¹‰åŠ è½½ç±»çš„æ–¹å¼ã€‚\n\n```java\nprotected Class<?> loadClass(String name, boolean resolve)\n        throws ClassNotFoundException {\n    Class<?> clazz = null;\n\n    //è®©çˆ¶åŠ è½½å™¨åŠ è½½javaæ ¸å¿ƒçš„åŒ…ï¼Œå› ä¸ºæœ‰äº›ç±»æ˜¯ç»§æ‰¿çš„Javaå†…éƒ¨çš„æ ¸å¿ƒç±»æ¯”å¦‚Objectç±»\n    if (name.startsWith(\"java.\")) {\n        try {\n            ClassLoader system = ClassLoader.getSystemClassLoader();\n            //è¿™é‡Œä»ç„¶æ˜¯å§”æ‰˜ä¸Šçº§\n            clazz = system.loadClass(name);\n            if (clazz != null) {\n                if (resolve)\n                    resolveClass(clazz);\n                return clazz;\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    try {\n        //è‡ªå·±å…ˆæ‰¾\n        clazz = findClass(name);\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n\t//æ‰¾ä¸åˆ°å°±äº¤ç»™çˆ¶åŠ è½½å™¨\n    if (clazz == null && getParent() != null) {\n        getParent().loadClass(name);\n    }\n\n    return clazz;\n}\n```\n\nå…¶å®å°±æ˜¯è‡ªå·±å…ˆæ‰¾ï¼Œæ‰¾ä¸åˆ°æ‰ä¼šäº¤ç»™çˆ¶åŠ è½½å™¨ï¼Œç„¶åä¸€ä¸ªéœ€è¦æ³¨æ„çš„å°±æ˜¯ä½ æƒ³åŠ è½½çš„è¿™ä¸ªç±»å¯èƒ½ç»§æ‰¿äº†Javaå†…éƒ¨æ ¸å¿ƒçš„ç±»åƒ`Object`ç±»ï¼Œç„¶åè¦åŠ è½½å­ç±»å°±è¦å…ˆåŠ è½½å®ƒçš„çˆ¶ç±»ï¼Œè€Œä½ çš„è¿™ä¸ªåŒ…é‡Œé¢è‚¯å®šæ˜¯åŠ è½½ä¸åˆ°è¿™äº›Javaå†…éƒ¨çš„æ ¸å¿ƒç±»çš„ï¼Œæ‰€ä»¥è¿™äº›è¿˜æ˜¯å¾—äº¤ç»™ä¸Šå±‚çš„åŠ è½½å™¨å»åŠ è½½ã€‚\n\n**æµ‹è¯•æ•ˆæœ**\n\n```java\npublic class SimpleClassLoaderTest {\n    public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException {\n        SimpleClassLoader simpleClassLoader = new SimpleClassLoader();\n        Class<?> aClass = simpleClassLoader.loadClass(\"classloader_study.break_parent.SimpleObject\");\n        System.out.println(aClass.getClassLoader());\n    }\n}\n```\n\næ³¨æ„è¿™é‡Œåœ¨`classpath`é‡Œé¢æ˜¯æœ‰è¿™ä¸ªç±»çš„å­—èŠ‚ç æ–‡ä»¶çš„ï¼ŒæŒ‰ç…§åŒäº²å§”æ‰˜æœºåˆ¶åº”è¯¥ç”±AppClassLoaderå»åŠ è½½\n\n![mark](http://static.imlgw.top///20190420/5Nc0S6OoIa2D.png?imageslim)\n\nä½†æ˜¯ä»ç„¶æ˜¯ç”±æˆ‘ä»¬çš„SimpleClassLoaderåŠ è½½çš„ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸäº†æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼ˆè²Œä¼¼Tomcatä¹Ÿæ˜¯è¿™ç§åŠ è½½æœºåˆ¶ï¼Œæœ‰æ—¶é—´çœ‹çœ‹Tomcatçš„ç±»åŠ è½½å™¨ï¼‰\n\n**é¢è¯•é¢˜**\n\nâ“ **èƒ½ä¸èƒ½è‡ªå·±å†™ä¸ªç±»æ¯”å¦‚`java.lang.String`å»è¦†ç›–Javaçš„`String`ï¼Ÿå¦‚æœä¸è¦†ç›–`loadClass()`æ–¹æ³•ä½¿ç”¨åŒäº²å§”æ‰˜è‚¯å®šæ˜¯ä¸è¡Œï¼Œä½†æ˜¯æ—¢ç„¶ä¸Šé¢å·²ç»æ‰“ç ´äº†åŒäº²å§”æ‰˜é‚£æ˜¯ä¸æ˜¯å°±å¯ä»¥äº†å‘¢ï¼Ÿ**\n\n`Talk is cheapï¼Œshow me the code` è¯•è¯•å°±çŸ¥é“äº†\n\nå…ˆå‡†å¤‡ä¸€ä¸ªStringç±»\n\n```java\npackage java.lang;\n/**\n * @author imlgw.top\n * @date 2019/4/18 12:01\n */\npublic class String {\n    static {\n        System.out.println(\"i am init\");\n    }\n    public int getVal(){\n        return  250;\n    }\n}\n```\n\nç¼–è¯‘å¥½ä¹‹åæ”¾åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„`ClassLoader`çš„ç›®å½•ä¸‹ï¼Œç„¶åå°†æˆ‘ä»¬`loadClass()`æ–¹æ³•åŠ è½½æ ¸å¿ƒåŒ…çš„åœ°æ–¹æ³¨é‡Šæ‰ï¼ˆä¸ç„¶è¿˜æ˜¯ä¼šäº¤ç»™çˆ¶åŠ è½½å™¨å»åŠ è½½ï¼‰ç„¶åä¸ºäº†è¡¨ç¤ºæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„`ClassLoader`åŠ è½½çš„æˆ‘ä»¬æŠŠclasspathé‡Œé¢çš„å­—èŠ‚ç æ–‡ä»¶ä¹Ÿåˆ æ‰ã€‚\n\n```java\n public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException {\n        SimpleClassLoader simpleClassLoader = new SimpleClassLoader();\n        Class<?> aClass = simpleClassLoader.loadClass(\"java.lang.String\");\n        System.out.println(aClass.getClassLoader());\n    }\n```\n\nç„¶åå°±ä¼šçœ‹åˆ°å¦‚ä¸‹çš„`SecurityException`\n\n```java\njava.lang.SecurityException: Prohibited package name: java.lang\n\tat java.lang.ClassLoader.preDefineClass(ClassLoader.java:662)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:761)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:642)\n\tat classloader_study.break_parent.SimpleClassLoader.findClass(SimpleClassLoader.java:52)\n\tat classloader_study.break_parent.SimpleClassLoader.loadClass(SimpleClassLoader.java:77)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\tat classloader_study.break_parent.SimpleClassLoaderTest.main(SimpleClassLoaderTest.java:7)\n```\n\nå…¶å®Javaä¸ºäº†å®‰å…¨ï¼Œè‡ªå®šä¹‰ç±»å–åä¸èƒ½å–`java.*`ç­‰æ ¸å¿ƒåŒ…åå¼€å¤´ï¼Œåœ¨`preDefineClass`é‡Œé¢åšäº†æ£€æŸ¥ï¼Œæ‰€ä»¥å³ä½¿ä½ æ‰“ç ´äº†åŒäº²å§”æ‰˜æœºåˆ¶ä½ ä¾ç„¶ä¸èƒ½å»è¦†ç›–Javaçš„æ ¸å¿ƒç±»ï¼ˆè‚¯å®šä¸è¡Œå•ŠğŸ˜„ï¼‰ã€‚\n\nå…¶å®è¿™é‡Œåæ¥äº†è§£äº†`Unsafe`åä¹Ÿå°è¯•ç”¨`Unsafe` å»åŠ è½½è¿™ä¸ªç±»\n\n```java\nprotected Class<?> findClass(String name) throws ClassNotFoundException {\n        Unsafe unsafe=UnsafeTest.getUnsafe();\n        String classPath = name.replace(\".\", \"/\");\n        File classFile = new File(dir, classPath + \".class\");\n        if (!classFile.exists()) {\n            throw new ClassNotFoundException(\"The class \" + name + \" found under \" + dir);\n        }\n\n        byte[] classBytes = loadClassBytes(classFile);\n        if (null == classBytes || classBytes.length == 0)\n            throw new ClassNotFoundException(\"load the class \" + name + \" failed\");\n\n        return unsafe.defineClass(null,classBytes,0,classBytes.length,SimpleClassLoader.this,null);\n}\n```\n\n`loadClass` åŒä¸Šï¼Œå°è¯•åŠ è½½ä½ ä¼šå‘ç° ä¼šæç¤ºæ‰¾ä¸åˆ°`Object` ç±»ï¼Œå—¯ï¼Ÿå·²ç»åœ¨åŠ è½½çˆ¶ç±»äº†ï¼Œéš¾ä¸æˆè¿˜çœŸå¯ä»¥ï¼Ÿè¿™é‡Œå…¶å®å·²ç»å’Œä¸Šé¢çš„æ–¹æ³•ä¸åŒäº†ï¼Œä¸Šé¢çš„æ–¹æ³•æ˜¯ä¸ä¼šè¿›å…¥åˆ°åŠ è½½çˆ¶ç±»çš„ç¯èŠ‚çš„ï¼Œç›´æ¥åœ¨åŠ è½½å‰å°±è¢«æ£€æµ‹äº†åŒ…åç„¶åGGäº†ï¼Œéšåæˆ‘åœ¨`loadClass` ä¸­è®©ç³»ç»ŸåŠ è½½å™¨å»åŠ è½½Objectç±»ï¼Œå†æ¬¡å°è¯•åŠ è½½\n\n```java\njava.lang.SecurityException: Prohibited package name: java.lang\n\tat sun.misc.Unsafe.defineClass(Native Method)\n\tat classloader_study.break_parent.SimpleClassLoader.findClass(SimpleClassLoader.java:57)\n\tat classloader_study.break_parent.SimpleClassLoader.loadClass(SimpleClassLoader.java:83)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\tat classloader_study.break_parent.SimpleClassLoaderTest.main(SimpleClassLoaderTest.java:7)\nException in thread \"main\" java.lang.NullPointerException\n\tat classloader_study.break_parent.SimpleClassLoaderTest.main(SimpleClassLoaderTest.java:8)\n```\n\nè¿˜æ˜¯ç†Ÿæ‚‰çš„å‘³é“ğŸ˜‚ `defineClass`è™šæ‹Ÿæœºæœ¬åœ°æ–¹æ³•æŠ›äº†å¼‚å¸¸\n\n### ç±»åŠ è½½å™¨ç»†èŠ‚æ·±å…¥\n\n**å®šä¹‰åŠ è½½å™¨&åˆå§‹åŠ è½½å™¨**\n\nâš¡çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œçš„ç±»åŠ è½½å™¨å’Œå¯åŠ¨è¿™ä¸ªåŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨ï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚çœŸæ­£`å®Œæˆç±»çš„åŠ è½½`å·¥ä½œæ˜¯é€šè¿‡è°ƒç”¨ `defineClass(findClass)`æ¥å®ç°çš„ï¼›è€Œ`å¯åŠ¨`ç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨ `loadClass`æ¥å®ç°çš„ã€‚å‰è€…ç§°ä¸ºä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨ï¼ˆdefining loaderï¼‰ï¼Œåè€…ç§°ä¸ºåˆå§‹åŠ è½½å™¨ï¼ˆinitiating loaderï¼‰ã€‚åœ¨ Java è™šæ‹Ÿæœºåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„å®šä¹‰åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªç±»åŠ è½½å™¨å¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„åŠ è½½å™¨ã€‚ä¸¤ç§ç±»åŠ è½½å™¨çš„å…³è”ä¹‹å¤„åœ¨äºï¼š**ä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨æ˜¯å®ƒå¼•ç”¨çš„å…¶å®ƒç±»çš„åˆå§‹åŠ è½½å™¨**ã€‚å¦‚ç±» `com.example.Outer`å¼•ç”¨äº†ç±» `com.example.Inner`ï¼Œåˆ™ç”±ç±» `com.example.Outer`çš„**å®šä¹‰åŠ è½½å™¨**è´Ÿè´£å¯åŠ¨ç±» `com.example.Inner`çš„åŠ è½½è¿‡ç¨‹ã€‚\n\n**å‘½åç©ºé—´&è¿è¡Œæ—¶åŒ…**\n\n> æ¯ä¸ªç±»éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ç”±`è¯¥åŠ è½½å™¨åŠæ‰€æœ‰çˆ¶åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»`ç»„æˆï¼Œ`å­åŠ è½½å™¨çš„å‘½åç©ºé—´åŒ…å«æ‰€æœ‰çˆ¶åŠ è½½å™¨çš„å‘½åç©ºé—´`ï¼Œå› æ­¤å­åŠ è½½å™¨å¯ä»¥åŠ è½½çš„ç±»å¯ä»¥çœ‹å°±æŒ‰çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œä¾‹å¦‚ç³»ç»Ÿç±»åŠ è½½å™¨å¯ä»¥çœ‹è§æ ¹åŠ è½½å™¨åŠ è½½çš„ç±»ã€‚ç”±çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»çœ‹ä¸è§å­åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œå¦‚æœä¸¤ä¸ªç±»ä¹‹é—´æ²¡æœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„çˆ¶å­å…³ç³»ï¼Œé‚£ä¹ˆä»–ä»¬å„è‡ªåŠ è½½çš„ç±»ç›¸äº’ä¸å¯è§\n\nâš¡æ•°ç»„ç±»çš„Classä¸æ˜¯ç”±ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œæ˜¯ç”±JVMåœ¨è¿è¡ŒæœŸé—´åŠ¨æ€ç”Ÿæˆçš„ï¼Œä½†æ˜¯é€šè¿‡`getClassLoader`è¿”å›çš„ç±»åŠ è½½å™¨å’Œæ•°ç»„çš„å…ƒç´ çš„ç±»åŠ è½½å™¨æ˜¯ä¸€æ ·çš„ï¼ŒåŸç”Ÿçš„ç±»å‹æ¯”å¦‚`int` ä¹‹ç±»çš„æ²¡æœ‰ç±»åŠ è½½å™¨è¿”å›çš„æ˜¯null\n\nâš¡æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰å…¶è‡ªå·±çš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ç”±è¯¥åŠ è½½å™¨å’Œå…¶æ‰€æœ‰çˆ¶ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ç»„æˆï¼ŒåŒä¸€ä»½å­—èŠ‚ç ä¸¤ä¸ªä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½å‡ºæ¥çš„ä¸æ˜¯åŒä¸€ä¸ªç±»ã€‚\n\n```java\npublic class MyClassLoaderTest2 {\n    public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InstantiationException, ClassNotFoundException {\n        //æ³¨æ„è¿™é‡Œçš„ClassLoaderè¦ä¹ˆåˆ©ç”¨å‰é¢çš„æ‰“ç ´äº†åŒäº²å§”æ‰˜æœºåˆ¶çš„ï¼Œè¦ä¹ˆæŠŠclasspathé‡Œé¢å­—èŠ‚ç çš„åˆ æ‰ã€‚\n        MyClassLoader loader1=new MyClassLoader(\"Resolmi1\");\n        MyClassLoader loader2=new MyClassLoader(\"Resolmi2\");\n        Class<?> aClass2 = loader2.loadClass(\"classloader_study.myClassLoader.MyObject\");\n        Class<?> aClass1 = loader1.loadClass(\"classloader_study.myClassLoader.MyObject\");\n        //ä¸¤ä¸ªä¸åŒçš„åŠ è½½å™¨ï¼ˆæ²¡æœ‰çˆ¶å­å…³ç³»ï¼‰åŠ è½½åŒä¸€ä¸ªç±»åŠ è½½å‡ºæ¥çš„ä¸æ˜¯åŒä¸€ä¸ª\n        System.out.println(aClass1.hashCode()); //2133927002\n        System.out.println(aClass2.hashCode()); //1836019240\n     }\n}\n```\n\nâš¡**çˆ¶ç±»åŠ è½½å™¨**æ— æ³•è®¿é—®**å­ç±»åŠ è½½å™¨**åŠ è½½çš„ç±»ï¼Œè€Œ**å­åŠ è½½å™¨**å¯ä»¥è®¿é—®åˆ°**çˆ¶åŠ è½½å™¨**æ‰€åŠ è½½çš„ç±»\n\n```java\npublic class ClassLoaderTest {\n    public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException {\n        //ä½¿ç”¨ä¸Šé¢è‡ªå®šä¹‰çš„ClassLoader\n        MyClassLoader loader=new MyClassLoader(\"Resolmi\");\n        Class<?> aClass = loader.loadClass(\"classloader_study.myClassLoader.Parent\");\n        //åˆ›å»ºå®ä¾‹\n        aClass.newInstance();\n    }\n}\n```\n\n**Parentç±»**\n\n```java\npublic class Parent {\n    public Parent() {\n        System.out.println(\"Parent is load by\" + this.getClass().getClassLoader());\n        Hello();\n    }\n\n    public void Hello() {\n        //çˆ¶åŠ è½½å™¨è®¿é—®å­åŠ è½½å™¨åŠ è½½çš„ç±»\n        System.out.println(\"Parent can see the \" + Sub.class);\n    }\n}\n```\n\n**Subç±»**\n\n```java\npublic class Sub {\n    public Sub(){\n        System.out.println(\"Sub is load by\"+this.getClass().getClassLoader());\n        new Parent(); //æ„é€ Parentç±»\n    }\n}\n```\n\nåšå®Œäº†è¿™äº›å·¥ä½œä¹‹åï¼Œç¼–è¯‘ä»£ç ï¼Œç„¶åå°†classpathä¸­çš„`Parent.class`æ‹·è´åˆ°è‡ªå®šä¹‰çš„ClassLoaderè·¯å¾„ä¸‹é¢ï¼Œç„¶ååˆ æ‰classpathä¸­çš„`Parent.class` ï¼Œç„¶åè¿è¡Œ\n\n```java\nSub is load byclassloader_study.myClassLoader.MyClassLoader@74a14482\nParent is load bysun.misc.Launcher$AppClassLoader@18b4aac2\nException in thread \"main\" java.lang.NoClassDefFoundError: classloader_study/myClassLoader/Sub\n\tat classloader_study.myClassLoader.Parent.Hello(Parent.java:15)\n\tat classloader_study.myClassLoader.Parent.<init>(Parent.java:10)\n\tat classloader_study.myClassLoader.Sub.<init>(Sub.java:10)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423)\n\tat java.lang.Class.newInstance(Class.java:442)\n\tat classloader_study.myClassLoader.ClassLoaderTest.main(ClassLoaderTest.java:14)\nCaused by: java.lang.ClassNotFoundException: classloader_study.myClassLoader.Sub\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:381)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\t... 9 more\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„`Sub` æ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰çš„`MyClassLoader` åŠ è½½çš„ï¼Œå› ä¸ºæˆ‘ä»¬åˆ æ‰äº†Classpathä¸­çš„å­—èŠ‚ç ï¼Œè€Œåœ¨è‡ªå®šä¹‰çš„è·¯å¾„ä¸­æœ‰æ‰€ä»¥æœ€åè¿˜æ˜¯ç”±æˆ‘ä»¬çš„ `MyClassLoader` åŠ è½½äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„`Parent`ç±»é¦–å…ˆä¹Ÿä¼šç”±æˆ‘ä»¬çš„`è‡ªå®šä¹‰ç±»åŠ è½½å™¨MyClassLoader`å»ä½œä¸º**åˆå§‹åŠ è½½å™¨**åŠ è½½ï¼Œç”±äºæˆ‘ä»¬çš„Classpathä¸­è¿˜æœ‰å­—èŠ‚ç æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨åŒäº²å§”æ´¾æœºåˆ¶ä¸‹`Subç±»` æœ€ç»ˆç”±`AppClassLoader`åŠ è½½ ï¼Œä¸¤ä¸ªç±»ç”±ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œç„¶åæˆ‘ä»¬åœ¨`Parent` ç±»ä¸­è¯•å›¾è®¿é—®`Sub` ç±»ï¼Œç»“æœæŠ›å‡ºäº†`ClassNotFoundException`  å’Œ`NoClassDefFoundError` å¼‚å¸¸\n\nâ“ **é‚£æˆ‘ä»¬åè¿‡æ¥åœ¨`Sub`ç±»ä¸­è®¿é—® `Parent` ç±»ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæ”¹é€ ä¸€ä¸‹Parentå’ŒSub**\n\n**Parentç±»**\n\n```java\npublic class Parent {\n    public Parent() {\n        System.out.println(\"Parent is load by\" + this.getClass().getClassLoader());\n        //Hello();\n    }\n\n    public void Hello() {\n        //çˆ¶åŠ è½½å™¨è®¿é—®å­åŠ è½½å™¨åŠ è½½çš„ç±»\n        System.out.println(\"Parent can see the \" + Sub.class);\n    }\n}\n```\n\n**Subç±»**\n\n```java\npublic class Sub {\n    public Sub(){\n        System.out.println(\"Sub is load by\"+this.getClass().getClassLoader());\n        new Parent(); //æ„é€ Subç±»\n        //è®¿é—®çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»\n        System.out.println(\"Sub can see \"+Parent.class);\n    }\n}\n```\n\nå’Œä¸Šé¢ä¸€æ ·åˆ æ‰Classpathä¸­Subç±»çš„classæ–‡ä»¶æ²¡ç„¶åè¿è¡Œ\n\n```java\nfindclass is invoke MyClassLoader is loadclassloader_study.myClassLoader.Sub\nSub is load byclassloader_study.myClassLoader.MyClassLoader@74a14482\nParent is load bysun.misc.Launcher$AppClassLoader@18b4aac2\nSub can see class classloader_study.myClassLoader.Parent\n\nProcess finished with exit code 0\n```\n\næ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œç”±æ­¤å°±å¯ä»¥è¯æ˜æˆ‘ä»¬ä¸Šé¢çš„ç»“è®ºæ˜¯æ­£ç¡®çš„ã€‚\n\nâ“ **é¢è¯•é¢˜ï¼šå¦‚ä½•è®©ä¸€ä¸ªç±»çš„staticä»£ç å—æ‰§è¡Œä¸¤æ¬¡**\n\nç”¨ä¸åŒçš„ç±»åŠ è½½å™¨å»åŠ è½½è¿™ä¸ªç±»ï¼Œè‡³äºä¸ºä»€ä¹ˆåº”è¯¥ä¸ç”¨æˆ‘å¤šè¯´äº†å§ã€‚\n\n**ç±»çš„å¸è½½å’ŒClassLoaderçš„å¸è½½**\n\n>  ç”±Javaè™šæ‹Ÿæœºè‡ªå¸¦çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ï¼Œåœ¨è™šæ‹Ÿæœºçš„ç”Ÿå‘½å‘¨æœŸä¸­**å§‹ç»ˆä¸ä¼šè¢«å¸è½½**ï¼ŒJavaè™šæ‹Ÿæœºæœ¬èº«ä¼šå¼•ç”¨è¿™äº›ç±»åŠ è½½å™¨ï¼Œè€Œè¿™äº›ç±»åŠ è½½å™¨åˆ™ä¼šå§‹ç»ˆå¼•ç”¨ä»–ä»¬æ‰€åŠ è½½çš„ç±»çš„Classå¯¹è±¡ï¼Œå› æ­¤è¿™äº›Classå¯¹è±¡å§‹ç»ˆæ˜¯å¯è¾¾çš„ã€‚\n\nâš¡JVMä¸­çš„Classåªæœ‰æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰èƒ½è¢«GCå›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯¥Classè¢«å¸è½½ï¼ˆunloadï¼‰\n\n- è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«GCã€‚\n- åŠ è½½è¯¥ç±»çš„ClassLoaderå®ä¾‹å·²ç»è¢«GCã€‚(Classå¯¹è±¡é‡Œé¢æœ‰å¯¹ClassLoaderçš„å¼•ç”¨)\n- è¯¥ç±»çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚\n\nGCçš„æ—¶æœºæˆ‘ä»¬æ˜¯ä¸å¯æ§çš„ï¼Œé‚£ä¹ˆåŒæ ·çš„æˆ‘ä»¬å¯¹äºClassçš„å¸è½½ä¹Ÿæ˜¯ä¸å¯æ§çš„ï¼Œä½¿ç”¨`-XX:+TraceClassUnloading` æˆ–è€…jvisualvmå¯ä»¥çœ‹åˆ°ç±»çš„å¸è½½\n\n## çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨(**TCCL**)\n\nâ€‹\tåœ¨è¯´TCCLä¹‹å‰ä¸å¾—ä¸è¯´ä¸€ä¸‹å¦ä¸€ä¸ªè¯é¢˜ï¼ŒSPIï¼ˆService Provider Interfaceï¼ŒSPIï¼‰æœåŠ¡æä¾›æ¥å£ï¼Œç”±ç¬¬ä¸‰æ–¹ä¸ºè¿™äº›æ¥å£æä¾›å®ç°ã€‚å¸¸è§çš„ SPI æœ‰ JDBCã€JCEã€JNDIã€JAXP å’Œ JBI ç­‰ã€‚è¿™äº› SPI çš„æ¥å£ç”± **Java æ ¸å¿ƒåº“**æ¥æä¾›ï¼Œè€Œè¿™äº› SPI çš„å®ç°ä»£ç åˆ™æ˜¯ä½œä¸º Java åº”ç”¨æ‰€ä¾èµ–çš„ jar åŒ…è¢«åŒ…å«è¿›**ç±»è·¯å¾„**ï¼ˆclasspathï¼‰é‡Œã€‚SPIæ¥å£ä¸­çš„ä»£ç ç»å¸¸éœ€è¦åŠ è½½å…·ä½“çš„å®ç°ç±»ã€‚\n\n> ä¸ºä»€ä¹ˆè¦ä½¿ç”¨SPI?  SPIæ˜¯JDKå†…ç½®çš„ä¸€ç§**æœåŠ¡æä¾›å‘ç°æœºåˆ¶**ã€‚è¿™æ ·åšçš„å¥½å¤„ä¸»è¦æ˜¯ä¸ºäº†è§£è€¦ï¼Œå®ç°åŠ¨æ€æ›¿æ¢ï¼Œå‡å°‘ç¡¬ç¼–ç ï¼ˆæ¯”å¦‚jdk1.6ä¹‹å‰çš„Class.forName(\"XXXX\") ï¼‰é¢å‘æ¥å£ç¼–ç¨‹ï¼Œåœ¨å¾ˆå¤šå¼€æºæ¡†æ¶ä¸­éƒ½æœ‰ä½“ç°ï¼Œæ¯”å¦‚Dubboï¼ŒSpringç­‰\n\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ`SPIçš„æ¥å£`æ˜¯Javaæ ¸å¿ƒåº“çš„ä¸€éƒ¨åˆ†ä½äº`rt.jar`ä¸­ï¼Œæ˜¯ç”±**æ ¹åŠ è½½å™¨**(Bootstrap Classloader)æ¥åŠ è½½çš„ï¼Œè€Œ`SPIçš„å®ç°ç±»`æ˜¯ä¸€èˆ¬æ˜¯ç¬¬ä¸‰æ–¹çš„æä¾›çš„ï¼Œä½äº`classpath`ç›®å½•ä¸­ï¼Œè€Œ**æ ¹åŠ è½½å™¨**å¾ˆæ˜æ˜¾æ˜¯æ— æ³•ç›´æ¥åŠ è½½åˆ°è¿™ä¸ªç›®å½•ä¸‹çš„SPI çš„å®ç°ç±»çš„ (åŒäº²å§”æ´¾)ï¼Œé‚£`SPI`æ˜¯å¦‚ä½•è‡ªåŠ¨åŠ è½½åˆ°å®ç°ç±»çš„å‘¢ï¼Ÿ\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè™šæ‹Ÿæœºæä¾›äº†**çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼ˆTCCLï¼‰**é…åˆ`ServiceLoader`æ¥å¸®åŠ©ä¸Šå±‚åŠ è½½å™¨åŠ è½½ç±»ï¼Œ`TCCL`ç ´åäº†â€œåŒäº²å§”æ´¾æ¨¡å‹â€ï¼Œå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ‡æ¢ä¸º`TCCL` æ¥åŠ è½½ç¬¬ä¸‰æ–¹çš„SPIå®ç°ç±»ï¼ŒæŠ›å¼ƒåŒäº²å§”æ´¾æœºåˆ¶ï¼Œä½¿ç¨‹åºå¯ä»¥é€†å‘ä½¿ç”¨ç±»åŠ è½½å™¨ã€‚**TCCL**é»˜è®¤æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`setContextClassLoader`å»è®¾ç½®\n\n### JDBCæºç æ¡ˆä¾‹åˆ†æ\n\nç¿»åˆ°äº†æœ€å¼€å§‹å­¦JDBCçš„æ—¶å€™å†™çš„ä»£ç ğŸ˜„\n\n![JDBC](http://static.imlgw.top///20190420/K4uQf6h5czDb.png?imageslim)\n\n**è´¾çæ¬²æ‰§äº‹**ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ­¥è¿˜æ˜¯åŠ è½½å¹¶ä¸”åˆå§‹åŒ–é©±åŠ¨ï¼Œå‰é¢å·²ç»æåˆ°è¿™ä¸€æ­¥å…¶å®æ²¡æœ‰å¿…è¦äº†ï¼Œjdk1.6ä¹‹åå› ä¸ºServiceLoaderï¼ŒSPIæœºåˆ¶çš„å‡ºç°ï¼Œå°±ä¸ç”¨å†æ˜¾ç¤ºçš„åŠ è½½é©±åŠ¨ï¼Œä½†æ˜¯æ­£å¦‚ä¸Šé¢æ‰€è¯´`Driver`åªæ˜¯ä¸ªæ¥å£å­˜æ”¾äº`rt.jar` ä¸­ï¼Œç”±æ ¹åŠ è½½å™¨æ‰€åŠ è½½ï¼Œé‚£SPIæ˜¯æ€ä¹ˆè‡ªåŠ¨çš„åŠ è½½åˆ°`mysql`çš„`Driver`å®ä¾‹çš„å‘¢ï¼ŸğŸ˜•\n\næˆ‘ä»¬ä¸€æ­¥æ­¥çš„æ¥çœ‹ï¼Œé¦–å…ˆ`DriverManager.getConnection()`è¿™é‡Œï¼Œ`getConnection`æ˜¯ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨å®ƒå°±ä¼šå…ˆæ‰§è¡Œ`DriverManager`ç±»çš„é™æ€ä»£ç å—ï¼Œè€Œé™æ€ä»£ç å—é‡Œé¢ä¸»è¦æ‰§è¡Œçš„å°±æ˜¯`loadInitialDrivers()`\n\n### loadInitialDrivers()æºç \n\n```java\nprivate static void loadInitialDrivers() {\n    String drivers;\n    try {\n        drivers = AccessController.doPrivileged(new PrivilegedAction<String>() {\n            public String run() {\n                return System.getProperty(\"jdbc.drivers\");\n            }\n        });\n    } catch (Exception ex) {\n        drivers = null;\n    }\n    // If the driver is packaged as a Service Provider, load it.\n    // Get all the drivers through the classloader\n    // exposed as a java.sql.Driver.class service.\n    // ServiceLoader.load() replaces the sun.misc.Providers()\n\t// å¦‚æœé©±åŠ¨æ­£ç¡®æ‰“åŒ…ä¸ºjarå°±ä¼šç”¨ServiceLoaderå»åŠ è½½å®ƒ\n    AccessController.doPrivileged(new PrivilegedAction<Void>() {\n        public Void run() {\n            /****************************************************/\n\t\t\t/*ServiceLoadå·¥å…·ç±»ï¼Œæ³¨æ„è¿™ä¸ªServiceLoadçš„åŠ è½½å™¨ï¼Œé»˜è®¤å°±æ˜¯TCCL*/\n            ServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);\n            /****************************************************/\n            /*åœ¨è¿™é‡Œä¼šè·å–åˆ°ä¸€ä¸ªDriversçš„è¿­ä»£å™¨ï¼Œä½†æ˜¯å…¶å®è¿˜æ²¡æœ‰å¼€å§‹åŠ è½½ç±»*/\n            Iterator<Driver> driversIterator = loadedDrivers.iterator();\n\n            /* Load these drivers, so that they can be instantiated.\n             * It may be the case that the driver class may not be there\n             * i.e. there may be a packaged driver with the service class\n             * as implementation of java.sql.Driver but the actual class\n             * may be missing. In that case a java.util.ServiceConfigurationError\n             * will be thrown at runtime by the VM trying to locate\n             * and load the service.\n             *\n             * Adding a try catch block to catch those runtime errors\n             * if driver not available in classpath but it's\n             * packaged as service and that service is there in classpath.\n             */\n            try{\n                while(driversIterator.hasNext()) {\n                    //è¿­ä»£çš„è¿‡ç¨‹ä¸­é€šè¿‡nextåå°„åŠ è½½å¹¶åˆå§‹åŒ–è¿™ä¸ªé©±åŠ¨å­—èŠ‚ç \n                    //æ²¡æœ‰æ¥æ”¶è¿”å›çš„æ•°æ®åº“é©±åŠ¨å®ä¾‹\n                    driversIterator.next();\n                }\n            } catch(Throwable t) {\n            // Do nothing\n            }\n            return null;\n        }\n    });\n\n    println(\"DriverManager.initialize: jdbc.drivers = \" + drivers);\n\t//åŠ è½½Jdkä¸­çš„é©±åŠ¨å®ä¾‹ï¼ˆè™½ç„¶æˆ‘å¹¶ä¸çŸ¥é“æ˜¯ä»€ä¹ˆï¼‰æ€»ä¹‹æˆ‘ä»¬ç¬¬ä¸‰æ–¹çš„é©±åŠ¨å·²ç»åŠ è½½å¥½äº†\n    if (drivers == null || drivers.equals(\"\")) {\n        return;\n    }\n    String[] driversList = drivers.split(\":\");\n    println(\"number of Drivers:\" + driversList.length);\n    for (String aDriver : driversList) {\n        try {\n            println(\"DriverManager.Initialize: loading \" + aDriver);\n            Class.forName(aDriver, true,\n                    ClassLoader.getSystemClassLoader());\n        } catch (Exception ex) {\n            println(\"DriverManager.Initialize: load failed: \" + ex);\n        }\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸€è¡Œå¾ˆå…³é”®çš„ä»£ç \n\n `ServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);`\n\nè¿™å°±æ˜¯æˆ‘ä¸Šé¢æ‰€æåˆ°çš„ `ServiceLoader` \n\n> å¯¹äºSPIæœºåˆ¶ï¼ŒJDKæä¾›äº†`java.util.ServiceLoader`å·¥å…·ç±»ï¼Œåœ¨ä½¿ç”¨æŸä¸ªæœåŠ¡æ¥å£æ—¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾è¯¥æœåŠ¡æ¥å£çš„å®ç°ç±»ï¼ŒåŠ è½½å’Œåˆå§‹åŒ–ï¼Œå‰ææ¡ä»¶æ˜¯åŸºäºå®ƒçš„çº¦å®šï¼šå½“æœåŠ¡çš„æä¾›è€…æä¾›äº†æœåŠ¡æ¥å£çš„ä¸€ç§å®ç°ä¹‹åï¼Œåœ¨`jar`åŒ…çš„`META-INF/services/`ç›®å½•é‡ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªä»¥`æœåŠ¡æ¥å£å‘½åçš„æ–‡ä»¶`ã€‚è¯¥æ–‡ä»¶é‡Œå°±æ˜¯å®ç°è¯¥æœåŠ¡æ¥å£çš„å…·ä½“å®ç°ç±»ï¼ˆå»è§£å‹çœ‹çœ‹é‚£äº›jaråŒ…å°±å¯ä»¥çœ‹è§è¿™äº›ä¿¡æ¯o(*ï¿£â–½ï¿£*)ãƒ–ï¼‰\n\n### ServiceLoaderç±»æºç \n\nä¸ºäº†èŠ‚çº¦ç¯‡å¹…åˆ æ‰äº†ä¸€äº›æ³¨é‡Šï¼Œå‘ç°å…¶å®æ•´ä¸ªç±»ä¹Ÿæ²¡å¤šå°‘è¡Œå¤§æ¦‚2ï¼Œ3ç™¾è¡Œçš„æ ·å­ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªç±»å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„\n\n```java\npublic final class ServiceLoader<S> implements Iterable<S> {\n\t//ç›®å½•å‰ç¼€å°±æ˜¯ä»è¿™é‡Œæ¥çš„\n    private static final String PREFIX = \"META-INF/services/\";\n\n    //å®ç°ç±»Service\n    private final Class<S> service;\n\n    // The class loader used to locate, load, and instantiate providers\n    private final ClassLoader loader;\n\n    // The access control context taken when the ServiceLoader is created\n    private final AccessControlContext acc;\n\n    // Cached providers, in instantiation order\n    // æŒ‰ç…§å®ä¾‹çš„é¡ºåºï¼Œæ¥ç¼“å­˜æœåŠ¡æä¾›è€…é¿å…é‡å¤çš„åŠ è½½ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„iteratoræ–¹æ³•\n    private LinkedHashMap<String,S> providers = new LinkedHashMap<>();\n\n    // The current lazy-lookup iterator\n    private LazyIterator lookupIterator;\n\n    public void reload() {\n        providers.clear();\n        //åˆå§‹åŒ–æ‡’åŠ è½½è¿­ä»£å™¨\n        lookupIterator = new LazyIterator(service, loader);\n    }\n\t\n    //æ„é€ å™¨\n    private ServiceLoader(Class<S> svc, ClassLoader cl) {\n        service = Objects.requireNonNull(svc, \"Service interface cannot be null\");\n        loader = (cl == null) ? ClassLoader.getSystemClassLoader() : cl;\n        acc = (System.getSecurityManager() != null) ? AccessController.getContext() : null;\n        reload();\n    }\n\n    private static void fail(Class<?> service, String msg, Throwable cause)\n        throws ServiceConfigurationError\n    {\n        throw new ServiceConfigurationError(service.getName() + \": \" + msg,\n                                            cause);\n    }\n\n    private static void fail(Class<?> service, String msg)\n        throws ServiceConfigurationError\n    {\n        throw new ServiceConfigurationError(service.getName() + \": \" + msg);\n    }\n\n    private static void fail(Class<?> service, URL u, int line, String msg)\n        throws ServiceConfigurationError\n    {\n        fail(service, u + \":\" + line + \": \" + msg);\n    }\n\n    // Parse a single line from the given configuration file, adding the name\n    // on the line to the names list.\n    //\n    private int parseLine(Class<?> service, URL u, BufferedReader r, int lc,\n                          List<String> names)\n        throws IOException, ServiceConfigurationError\n    {\n        String ln = r.readLine();\n        if (ln == null) {\n            return -1;\n        }\n        int ci = ln.indexOf('#');\n        if (ci >= 0) ln = ln.substring(0, ci);\n        ln = ln.trim();\n        int n = ln.length();\n        if (n != 0) {\n            if ((ln.indexOf(' ') >= 0) || (ln.indexOf('\\t') >= 0))\n                fail(service, u, lc, \"Illegal configuration-file syntax\");\n            int cp = ln.codePointAt(0);\n            if (!Character.isJavaIdentifierStart(cp))\n                fail(service, u, lc, \"Illegal provider-class name: \" + ln);\n            for (int i = Character.charCount(cp); i < n; i += Character.charCount(cp)) {\n                cp = ln.codePointAt(i);\n                if (!Character.isJavaIdentifierPart(cp) && (cp != '.'))\n                    fail(service, u, lc, \"Illegal provider-class name: \" + ln);\n            }\n            if (!providers.containsKey(ln) && !names.contains(ln))\n                names.add(ln);\n        }\n        return lc + 1;\n    }\n\n    private Iterator<String> parse(Class<?> service, URL u)\n        throws ServiceConfigurationError\n    {\n        InputStream in = null;\n        BufferedReader r = null;\n        ArrayList<String> names = new ArrayList<>();\n        try {\n            in = u.openStream();\n            r = new BufferedReader(new InputStreamReader(in, \"utf-8\"));\n            int lc = 1;\n            while ((lc = parseLine(service, u, r, lc, names)) >= 0);\n        } catch (IOException x) {\n            fail(service, \"Error reading configuration file\", x);\n        } finally {\n            try {\n                if (r != null) r.close();\n                if (in != null) in.close();\n            } catch (IOException y) {\n                fail(service, \"Error closing configuration file\", y);\n            }\n        }\n        return names.iterator();\n    }\n\n    // Private inner class implementing fully-lazy provider lookup\n    // çœ‹åå­—å°±çŸ¥é“äº†ï¼Œæ‡’è¿­ä»£å™¨ï¼Œåœ¨è¿­ä»£çš„æ—¶å€™æ‰çœŸæ­£çš„åŠ è½½\n    private class LazyIterator\n        implements Iterator<S>\n    {\n\n        Class<S> service;\n        ClassLoader loader;\n        Enumeration<URL> configs = null;\n        Iterator<String> pending = null;\n        String nextName = null;\n\n        private LazyIterator(Class<S> service, ClassLoader loader) {\n            this.service = service;\n            this.loader = loader;\n        }\n\n        private boolean hasNextService() {\n            if (nextName != null) {\n                return true;\n            }\n            if (configs == null) {\n                try {\n                    String fullName = PREFIX + service.getName();\n                    if (loader == null)\n                        configs = ClassLoader.getSystemResources(fullName);\n                    else\n                        configs = loader.getResources(fullName);\n                } catch (IOException x) {\n                    fail(service, \"Error locating configuration files\", x);\n                }\n            }\n            while ((pending == null) || !pending.hasNext()) {\n                if (!configs.hasMoreElements()) {\n                    return false;\n                }\n                pending = parse(service, configs.nextElement());\n            }\n            nextName = pending.next();\n            return true;\n        }\n        \n\t\t//è¿­ä»£å™¨çš„next\n        private S nextService() {\n            if (!hasNextService())\n                throw new NoSuchElementException();\n            String cn = nextName;\n            nextName = null;\n            Class<?> c = null;\n            try {\n                //åˆ©ç”¨TCCLåŠ è½½å®ç°ç±»ï¼Œä½†æ˜¯ä¸åˆå§‹åŒ–\n                c = Class.forName(cn, false, loader);\n            } catch (ClassNotFoundException x) {\n                fail(service,\n                     \"Provider \" + cn + \" not found\");\n            }\n            if (!service.isAssignableFrom(c)) {\n                fail(service,\n                     \"Provider \" + cn  + \" not a subtype\");\n            }\n            try {\n                //newInstance()åˆå§‹åŒ–äº†å¯¹åº”çš„å®ç°ç±»\n                S p = service.cast(c.newInstance());\n                //æ”¾åˆ°providersä¸­\n                providers.put(cn, p);\n                return p;\n            } catch (Throwable x) {\n                fail(service,\n                     \"Provider \" + cn + \" could not be instantiated\",\n                     x);\n            }\n            throw new Error();          // This cannot happen\n        }\n\n        public boolean hasNext() {\n            if (acc == null) {\n                return hasNextService();\n            } else {\n                PrivilegedAction<Boolean> action = new PrivilegedAction<Boolean>() {\n                    public Boolean run() { return hasNextService(); }\n                };\n                return AccessController.doPrivileged(action, acc);\n            }\n        }\n\n        public S next() {\n            if (acc == null) {\n                return nextService();\n            } else {\n                PrivilegedAction<S> action = new PrivilegedAction<S>() {\n                    public S run() { return nextService(); }\n                };\n                return AccessController.doPrivileged(action, acc);\n            }\n        }\n\n        public void remove() {\n            throw new UnsupportedOperationException();\n        }\n\n    }\n\n    /**\n     * Lazily loads the available providers of this loader's service.\n     * @return  An iterator that lazily loads providers for this loader's\n     *          service\n     */\n    public Iterator<S> iterator() {\n        return new Iterator<S>() {\n\n            Iterator<Map.Entry<String,S>> knownProviders\n                = providers.entrySet().iterator();\n\n            public boolean hasNext() {\n                if (knownProviders.hasNext())\n                    return true;\n                return lookupIterator.hasNext();\n            }\n\n            public S next() {\n                if (knownProviders.hasNext())\n                    return knownProviders.next().getValue();\n                return lookupIterator.next();\n            }\n\n            public void remove() {\n                throw new UnsupportedOperationException();\n            }\n\n        };\n    }\n\n    /* é‡è½½çš„ServiceLoad */\n    public static <S> ServiceLoader<S> load(Class<S> service,\n                                            ClassLoader loader)\n    {\n        return new ServiceLoader<>(service, loader);\n    }\n\n\t//DriverManageé‡Œé¢å°±æ˜¯è°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•\n    public static <S> ServiceLoader<S> load(Class<S> service) {\n        //æ‹¿åˆ°äº†TCCL\n        ClassLoader cl = Thread.currentThread().getContextClassLoader();\n        //è°ƒç”¨ä¸Šé¢é‡è½½çš„ServiceLoadæ–¹æ³•\n        return ServiceLoader.load(service, cl);\n    }\n\n\n    public static <S> ServiceLoader<S> loadInstalled(Class<S> service) {\n        ClassLoader cl = ClassLoader.getSystemClassLoader();\n        ClassLoader prev = null;\n        while (cl != null) {\n            prev = cl;\n            cl = cl.getParent();\n        }\n        return ServiceLoader.load(service, prev);\n    }\n\n    public String toString() {\n        return \"java.util.ServiceLoader[\" + service.getName() + \"]\";\n    }\n\n}\n```\n\n> é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ä¸€ç‚¹ï¼Œ`Driveræ¥å£`ï¼Œ`DriverManageç±»`ï¼Œä»¥åŠ`ServiceLoader`éƒ½æ˜¯ç”±**æ ¹åŠ è½½å™¨**å»åŠ è½½çš„(å¦‚æœä¸ç›¸ä¿¡çš„è¯å¯ä»¥ç”¨TraceClassLoadingå»æŸ¥çœ‹)ï¼Œæ‰€ä»¥åœ¨`ServiceLoader`ä¸­ä¹Ÿæ˜¯æ— æ³•ç›´æ¥åŠ è½½å…·ä½“å¾—å®ç°ç±»çš„\n\nå‰é¢`loadInitialDriver()`è°ƒç”¨çš„å°±æ˜¯è¿™é‡Œçš„`ServiceLoader.load(Class< S> service)` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­æ‚„æ‚„çš„æ‹¿åˆ°äº†`TCCL` ï¼Œè€ŒTCCLåœ¨`Launcher` ç±»ï¼ˆç³»ç»ŸåŠ è½½å™¨å’Œæ‰©å±•åŠ è½½å™¨éƒ½æ˜¯åœ¨Launcherä¸­å®ç°çš„ï¼‰ä¸­é»˜è®¤è®¾ç½®æˆäº†ç³»ç»ŸåŠ è½½å™¨ï¼Œå…·ä½“å¯ä»¥å»çœ‹ä¸€ä¸‹æºç è¿™é‡Œæˆ‘å°±ä¸å±•å¼€äº†ï¼Œç„¶åè°ƒç”¨å¦ä¸€ä¸ªé‡è½½çš„æ„é€ æ–¹æ³•å°†`TCCL` ä¼ é€’è¿›å»ï¼Œæœ€ç»ˆè°ƒç”¨äº† `reload()`æ–¹æ³•\n\n```java\npublic void reload() {\n    providers.clear();\n    //åˆå§‹åŒ–æ‡’åŠ è½½è¿­ä»£å™¨\n    lookupIterator = new LazyIterator(service, loader);\n}\n```\n\n åœ¨è¿™ä¸ªæ–¹æ³•ä¸­é¦–å…ˆæ¸…ç©ºæœåŠ¡æä¾›è€…(providers)ç¼“å­˜ï¼Œç„¶ååˆå§‹åŒ–äº†ä¸€ä¸ª`LazyIterator` çœ‹åå­—å°±çŸ¥é“æ˜¯å•¥æ„æ€äº†ï¼Œå…¶å®åˆ°è¿™é‡Œä»ç„¶æ²¡æœ‰ä»»ä½•å…·ä½“çš„åŠ è½½åŠ¨ä½œï¼Œå› ä¸ºè¿™é‡Œé‡‡ç”¨çš„æ˜¯æŒ‰éœ€åŠ è½½ï¼Œä¹Ÿå°±æ˜¯æ‡’åŠ è½½ï¼Œåœ¨è¿­ä»£çš„æ—¶å€™æ‰ä¼šå»åŠ è½½ç±»\n\n```java\nprivate class LazyIterator implements Iterator<S>{\n\tClass<S> service;\n    ClassLoader loader;\n    Enumeration<URL> configs = null;\n    Iterator<String> pending = null;\n    String nextName = null;\n\n    private LazyIterator(Class<S> service, ClassLoader loader) {\n        this.service = service;\n        this.loader = loader;\n    }\n\n    private boolean hasNextService() {\n        if (nextName != null) {\n            return true;\n        }\n        if (configs == null) {\n            try {\n                //æ‹¿åˆ°æ¥å£å…¨å\n                String fullName = PREFIX + service.getName();\n                if (loader == null)\n                    configs = ClassLoader.getSystemResources(fullName);\n                else\n                    configs = loader.getResources(fullName);\n            } catch (IOException x) {\n                fail(service, \"Error locating configuration files\", x);\n            }\n        }\n        while ((pending == null) || !pending.hasNext()) {\n            if (!configs.hasMoreElements()) {\n                return false;\n            }\n            //è§£æ\n            pending = parse(service, configs.nextElement());\n        }\n        nextName = pending.next();\n        return true;\n    }\n    \n\t//è¿­ä»£å™¨çš„next\n    private S nextService() {\n        if (!hasNextService())\n            throw new NoSuchElementException();\n        String cn = nextName;\n        nextName = null;\n        Class<?> c = null;\n        try {\n            //å…·ä½“åŠ è½½ç±»çš„åœ°æ–¹å°±æ˜¯åœ¨è¿™é‡Œ\n            //åˆ©ç”¨å‰é¢ä¼ è¿›æ¥çš„TCCLåŠ è½½å®ç°ç±»ï¼Œä½†æ˜¯ä¸åˆå§‹åŒ–ç±»\n            c = Class.forName(cn, false, loader);\n        } catch (ClassNotFoundException x) {\n            fail(service,\n                 \"Provider \" + cn + \" not found\");\n        }\n        if (!service.isAssignableFrom(c)) {\n            fail(service,\n                 \"Provider \" + cn  + \" not a subtype\");\n        }\n        try {\n            //newInstance()å®ä¾‹åŒ–å¯¹åº”çš„å®ç°ç±»\n            S p = service.cast(c.newInstance());\n            //putåˆ°providersä¸­\n            providers.put(cn, p);\n            return p;\n        } catch (Throwable x) {\n            fail(service,\n                 \"Provider \" + cn + \" could not be instantiated\",\n                 x);\n        }\n        throw new Error();          // This cannot happen\n    }\n\n    public boolean hasNext() {\n        if (acc == null) {\n            return hasNextService();\n        } else {\n            PrivilegedAction<Boolean> action = new PrivilegedAction<Boolean>() {\n                public Boolean run() { return hasNextService(); }\n            };\n            return AccessController.doPrivileged(action, acc);\n        }\n    }\n\n    public S next() {\n        if (acc == null) {\n            return nextService();\n        } else {\n            PrivilegedAction<S> action = new PrivilegedAction<S>() {\n                public S run() { return nextService(); }\n            };\n            return AccessController.doPrivileged(action, acc);\n        }\n    }\n\n    public void remove() {\n        throw new UnsupportedOperationException();\n    }\n\n}\n```\nğŸ”¸ å¯ä»¥çœ‹åˆ°åœ¨è¿­ä»£å™¨çš„`nextService()` ä¸­æ‰å¼€å§‹åˆ©ç”¨çš„`Class.forName()` åŠ è½½çš„å…·ä½“å®ç°ç±»ï¼Œè€Œè¿™ä¸ªåŠ è½½å™¨æ­£å™¨æ­£æ˜¯å‰é¢`reload`ä¼ é€’è¿‡æ¥çš„ `TCCL` ä¹Ÿå°±æ˜¯é»˜è®¤çš„ç³»ç»Ÿç±»åŠ è½½å™¨\n\nğŸ”¸ éšååœ¨ç´§è·Ÿçš„tryè¯­å¥ä¸­é€šè¿‡ `newInstance()` å®ä¾‹åŒ–äº†å…·ä½“çš„å®ç°ç±»(MySqlçš„é©±åŠ¨) ï¼Œç„¶åputè¿›providersé˜Ÿåˆ—å¹¶ä¸”è¿”å›å®ä¾‹åŒ–çš„å®ç°ç±»ï¼Œä½†æ˜¯åœ¨`loadInitialDrivers`ä¸­å¹¶æ²¡æœ‰æ¥æ”¶è¿™ä¸ªè¿”å›ï¼Œé‚£ä»–è¿™é‡Œå®ä¾‹åŒ–æ˜¯ä»€ä¹ˆç”¨æ„å‘¢ï¼Ÿ\n\næˆ‘ä»¬å›åˆ°`getConnection()` æ–¹æ³•\n\n### getConnection()æºç \n\nå‰é¢çš„é™æ€æ–¹æ³•è°ƒç”¨å®Œæ¯•é©±åŠ¨å·²ç»åŠ è½½ï¼Œä¸‹é¢å°±æ˜¯è·å–æ•°æ®åº“è¿æ¥äº†.\n\n```java\npublic static Connection getConnection(String url,\n    String user, String password) throws SQLException {\n    java.util.Properties info = new java.util.Properties();\n\n    if (user != null) {\n        info.put(\"user\", user);\n    }\n    if (password != null) {\n        info.put(\"password\", password);\n    }\n\t// Reflection.getCallerClass()è°ƒç”¨è€…çš„Classå¯¹è±¡\n    return (getConnection(url, info, Reflection.getCallerClass()));\n}\n```\n\nä¸€èˆ¬è·å–è¿æ¥éƒ½æ˜¯è°ƒç”¨çš„ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨å¦ä¸€ä¸ªé‡è½½çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¼ å…¥ä¸€ä¸ªè°ƒç”¨è€…çš„Classå¯¹è±¡\n\n```java\nprivate static Connection getConnection(\n    String url, java.util.Properties info, Class<?> caller) throws SQLException {\n    /*\n     * When callerCl is null, we should check the application's\n     * (which is invoking this class indirectly)\n     * classloader, so that the JDBC driver class outside rt.jar\n     * can be loaded from here.\n     */\n    //Callerå°±æ˜¯è°ƒç”¨è€…çš„CLassä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„åº”ç”¨ä»£ç ç±»\n    //è·å–åˆ°æˆ‘ä»¬åº”ç”¨ç±»çš„ç±»åŠ è½½å™¨\n    ClassLoader callerCL = caller != null ? caller.getClassLoader() : null;\n    synchronized(DriverManager.class) {\n        // synchronize loading of the correct classloader.\n        if (callerCL == null) {\n            //å¦‚æœä¸ºç©ºå°±ï¼Œè·å–çº¿ç¨‹çº¿ä¸‹æ–‡åŠ è½½å™¨\n            callerCL = Thread.currentThread().getContextClassLoader();\n        }\n    }\n\n    if(url == null) {\n        throw new SQLException(\"The url cannot be null\", \"08001\");\n    }\n\n    println(\"DriverManager.getConnection(\\\"\" + url + \"\\\")\");\n\n    // Walk through the loaded registeredDrivers attempting to make a connection.\n    // Remember the first exception that gets raised so we can reraise it.\n    SQLException reason = null;\n\t\n    //éå†è¿™ä¸ªregisteredDriversé‡Œé¢éƒ½æ˜¯DriverInfo\n    for(DriverInfo aDriver : registeredDrivers) {\n        // If the caller does not have permission to load the driver then\n        // skip it.\n        //æ£€æŸ¥åŠ è½½é©±åŠ¨çš„åŠ è½½å™¨æ˜¯ä¸æ˜¯è°ƒç”¨è€…çš„ç±»åŠ è½½å™¨\n        if(isDriverAllowed(aDriver.driver, callerCL)) {\n            try {\n                println(\"    trying \" + aDriver.driver.getClass().getName());\n                //è·å–è¿æ¥\n                Connection con = aDriver.driver.connect(url, info);\n                if (con != null) {\n                    // Success!\n                    println(\"getConnection returning \" + aDriver.driver.getClass().getName());\n                    return (con);\n                }\n            } catch (SQLException ex) {\n                if (reason == null) {\n                    reason = ex;\n                }\n            }\n\n        } else {\n            println(\"    skipping: \" + aDriver.getClass().getName());\n        }\n\n    }\n\n    // if we got here nobody could connect.\n    if (reason != null)    {\n        println(\"getConnection failed: \" + reason);\n        throw reason;\n    }\n\n    println(\"getConnection: no suitable driver found for \"+ url);\n    throw new SQLException(\"No suitable driver found for \"+ url, \"08001\");\n}\n```\n\nğŸ”¸ å¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸€ä¸ªforeachå¾ªç¯ï¼Œéå†`registeredDrivers`ï¼Œè¿™æ˜¯ä¸ª`CopyOnWriteArrayList` è¿™ä¸ªç±»çœ‹åå­—å°±çŸ¥é“å­˜æ”¾çš„æ˜¯å·²ç»æ³¨å†Œçš„`Drivers` å®ç°ç±»ï¼Œé‚£è¿™äº›å®ç°ç±»æ˜¯ä»€ä¹ˆæ—¶å€™æ³¨å†Œè¿›æ¥çš„å‘¢ï¼Ÿå›åˆ°æˆ‘ä»¬ä¹‹å‰æŠ›å‡ºçš„ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨`ServiceLoader`çš„è¿­ä»£å™¨ä¸­åŠ è½½äº†å…·ä½“çš„ç±»ä¹‹åè¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œä½†æ˜¯`DriverManager` ä¸­å¹¶æ²¡æœ‰æ¥æ”¶è¿™ä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„é©±åŠ¨å®ç°ç±»\n\n```java\npackage com.mysql.cj.jdbc;\n\nimport java.sql.DriverManager;\nimport java.sql.SQLException;\n\npublic class Driver extends NonRegisteringDriver implements java.sql.Driver {\n    public Driver() throws SQLException {\n    }\n\n    static {\n        try {\n            //æ³¨å†Œåˆ°DriverManagerä¸­å»\n            DriverManager.registerDriver(new Driver());\n        } catch (SQLException var1) {\n            throw new RuntimeException(\"Can't register driver!\");\n        }\n    }\n}\n```\n\nğŸ”¸ ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œå¤§å®¶å°±æ˜ç™½äº†ï¼Œå‰é¢åˆå§‹åŒ–è¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯ä¸ºäº†èƒ½è§¦å‘è¿™ä¸ª**é™æ€ä»£ç å—**ï¼Œè¿›è€Œæ‰§è¡ŒregisterDriver()æ–¹æ³•è¿›è¡Œæ³¨å†Œï¼ŒçœŸæ˜¯å¦™å•ŠğŸ‘ä¸€ç¯å¥—ä¸€ç¯\n\nğŸ”¸ è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯è¿™é‡Œæ³¨å†Œçš„è™½ç„¶æ˜¯ä¸ªç©ºçš„Driverç±»ï¼Œä½†æ˜¯åˆ«å¿˜äº†å®ƒè¿˜æœ‰ä¸ªçˆ¶ç±»NonRegisteringDriver\n\nè¿™ä¸ªç±»æ‰æ˜¯çœŸæ­£çš„å®ç°ç±»å…·ä½“çš„`connect()` ç­‰æ–¹æ³•éƒ½æ˜¯åœ¨è¿™ä¸ªé‡Œé¢å®ç°çš„ï¼Œè€ŒDriverç»§æ‰¿äº†å®ƒçš„æ–¹æ³•\n\nğŸ”¸ åœ¨éå†`registeredDrivers` çš„æ—¶å€™è¿˜è°ƒç”¨äº†ä¸€ä¸ª`isDriverAllowed(aDriver.driver, callerCL)` æ–¹æ³•è¿™ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯é©±åŠ¨çš„å®ç°ç±»ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å‰é¢è·å–åˆ°çš„**è°ƒç”¨è€…çš„ç±»åŠ è½½å™¨** ï¼Œä½œç”¨å°±æ˜¯é€šè¿‡åˆ©ç”¨ä¼ è¿›æ¥çš„åŠ è½½å™¨å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œç„¶ååˆ¤æ–­æ˜¯ä¸æ˜¯åŒä¸€ä¸ªç±»ï¼Œï¼ˆä¼—æ‰€å‘¨çŸ¥ä¸åŒçš„åŠ è½½å™¨å› ä¸ºå‘½åç©ºé—´çš„å­˜åœ¨ï¼Œå³ä½¿åŠ è½½åŒä¸€ä»½å­—èŠ‚ç æ–‡ä»¶å¾—åˆ°çš„ä¹Ÿä¸æ˜¯ä¸€ä¸ªç±»ï¼‰ å¦‚æœæ˜¯å°±å…è®¸åŠ è½½ï¼Œå¦åˆ™ä¸å…è®¸ï¼Œä¸ºå•¥è¦è¿™æ ·åšå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯å› ä¸ºå‘½åç©ºé—´çš„é—®é¢˜ï¼Œå› ä¸ºæœ‰äº†SPIçš„æœºåˆ¶ï¼Œä½ **åŠ è½½åˆå§‹åŒ–è¿™ä¸ªå®ç°ç±»çš„åŠ è½½å™¨**(TCCL)å’Œæœ€ç»ˆå»**è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•çš„ç±»çš„åŠ è½½å™¨**æœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªï¼Œå› ä¸ºç¨‹åºå‘˜å¯ä»¥å¾ˆå®¹æ˜“çš„å°†TCCLä¿®æ”¹æˆå…¶ä»–çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æœä¸ä¿è¯ä¸€è‡´çš„è¯åé¢å°±ä¼šå‡ºç°`ClassCastException`ç­‰å¼‚å¸¸ \n\n```java\nprivate static boolean isDriverAllowed(Driver driver, ClassLoader classLoader) {\n    boolean result = false;\n    if(driver != null) {\n        Class<?> aClass = null;\n        try {\n            aClass =  Class.forName(driver.getClass().getName(), true, classLoader);\n        } catch (Exception ex) {\n            result = false;\n        }\n\n         result = ( aClass == driver.getClass() ) ? true : false;\n    }\n\n    return result;\n}\n```\n\n### **æ€»ç»“**\n\nå½“é«˜å±‚æä¾›äº†ç»Ÿä¸€æ¥å£è®©ä½å±‚å»å®ç°ï¼ˆé¢å‘æ¥å£ç¼–ç¨‹ï¼Œè§£è€¦ï¼‰ï¼ŒåŒæ—¶åˆè¦æ˜¯åœ¨é«˜å±‚åŠ è½½ï¼ˆæˆ–å®ä¾‹åŒ–ï¼‰ä½å±‚çš„ç±»æ—¶ï¼Œå¿…é¡»é€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥å¸®åŠ©é«˜å±‚çš„ClassLoaderæ‰¾åˆ°å¹¶åŠ è½½è¯¥ç±»ã€‚\n\n## Jar Hell\n\nJaråŒ…åœ°ç‹±ï¼Œ[å‚è€ƒ](https://www.hidennis.tech/2016/05/30/what-is-jar-hell/)\n\nè¿™ä¸ªé—®é¢˜å…¶å®å¯ä»¥é€šè¿‡`OSGI`ç­‰ç»„ä»¶åŒ–æ¡†æ¶æ¥è§£å†³ï¼Œä½¿ç”¨OSGIå¯ä»¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒOSGIæ˜¯åŸºäºæ¨¡å—ï¼ˆBundleï¼‰é©±åŠ¨çš„ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰å±äºè‡ªå·±çš„classpathå’Œç±»åŠ è½½å™¨ï¼Œæ¨¡å—ä¹‹é—´é€šè¿‡åŒ…æš´éœ²å’Œå¼•å…¥è¿›è¡Œå…³è”ï¼Œæ¯ä¸ªæ¨¡å—æœ‰ç€è‡ªå·±ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°å¯¹æ¨¡å—è¿›è¡ŒåŠ è½½ã€å¸è½½ã€æ›´æ–°ã€‚å¦‚æ­¤çœ‹æ¥ï¼ŒOSGIå¯ä»¥ç”¨ä¸€å¥è¯æè¿°ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ºJavaæä¾›çš„åŠ¨æ€æ¨¡å—åŒ–çš„ç³»ç»Ÿã€‚ä½†æ˜¯OSGIå¤ªè¿‡å¤æ‚ï¼Œå®ç”¨æ€§å¹¶ä¸å¼º\n\n[é˜¿é‡Œæ¶æ„å¸ˆå¯¹OSGIçš„è¯„ä»·](http://hellojava.info/?p=152)\n\nè¿™é‡Œæˆ‘ä¸»è¦æƒ³è¯´çš„æ˜¯æ€ä¹ˆåœ¨ä»£ç ä¸­åˆ©ç”¨ç±»åŠ è½½å™¨æ¥æ£€æµ‹Jar Hell\n\n```java\npublic class JarHell {  \n    public static void main(String[] args) {  \n        try {  \n            Enumeration<URL> urls = Thread.currentThread().getContextClassLoader().getResources(\"org/apache/log4j/Logger.class\");  \n            while(urls.hasMoreElements()) {  \n                URL url = urls.nextElement();  \n                System.out.println(url);  \n            }  \n        } catch (IOException e) {  \n            e.printStackTrace();  \n        }  \n       \n    }  \n}  \n```\n\nè¿™æ ·å°±å¯ä»¥æ‰¾åˆ°classpathä¸­å†²çªçš„jaråŒ…ï¼Œå½“ç„¶é€šè¿‡ideaçš„å·¥å…·ä¼šæ›´æ–¹ä¾¿ ğŸ˜‚\n\n## å‚è€ƒ\n\nã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹\n\n[æ·±å…¥æ¢è®¨ Java ç±»åŠ è½½å™¨](https://www.ibm.com/developerworks/cn/java/j-lo-classloader/index.html#code4)\n\n","tags":["JVM","ClassLoader"],"categories":["JVM"]},{"title":"æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆä¸€ï¼‰","url":"/2019/08/11/shen-ru-li-jie-java-xu-ni-ji-yi/","content":"\næœ¬æ–‡åœ¨ [CyCå¤§ä½¬](https://cyc2018.github.io/CS-Notes/#/notes/Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA?id=minor-gc-%e5%92%8c-full-gc) çš„åšå®¢åŸºç¡€ä¹‹ä¸Šåšäº†ä¸€äº›æ‰©å……æ”¹ç¼–ï¼ˆ æ”¹ç¼–ä¸æ˜¯ä¹±ç¼–ï¼Œæˆè¯´ä¸æ˜¯èƒ¡è¯´ï¼Œä»Šå¹´ä¸‹åŠå¹´.......ğŸµ\n\n## Javaå†…å­˜åŒºåŸŸ\n\n![mark](http://static.imlgw.top/blog/20190817/rTyjnrafmg3Q.png?imageslim)\n\n### ç¨‹åºè®¡æ•°å™¨\n\n- ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹æˆå½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨\n\n- ç¨‹åºè®¡æ•°å™¨ä½äºçº¿ç¨‹ç‹¬å å»\n- å¦‚æœçº¿ç¨‹æ‰§è¡Œçš„æ˜¯Javaæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°é½è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼Œå¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯nativeæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨çš„å€¼ä¸ºundefined\n- æ­¤åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸ \n\n### Javaè™šæ‹Ÿæœºæ ˆ\n\næ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ä»æ–¹æ³•è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚\n\n![CyC](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/8442519f-0b4d-48f4-8229-56f984363c69.png)\n\nå¯ä»¥é€šè¿‡ -Xss è¿™ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šæ¯ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå†…å­˜å¤§å°ï¼Œåœ¨ JDK 1.4 ä¸­é»˜è®¤ä¸º 256Kï¼Œè€Œåœ¨ JDK 1.5+ é»˜è®¤ä¸º 1Mï¼š\n\n```java\njava -Xss2M HackTheJavaCopy to clipboardErrorCopied\n```\n\nè¯¥åŒºåŸŸå¯èƒ½æŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š\n\n- å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡æœ€å¤§å€¼ï¼Œä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸ï¼›\n- æ ˆè¿›è¡ŒåŠ¨æ€æ‰©å±•æ—¶å¦‚æœæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜ï¼Œä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚\n\n### å †\n\næ‰€æœ‰å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼Œæ˜¯åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸï¼ˆ\"GC å †\"ï¼‰ã€‚\n\nç°ä»£çš„åƒåœ¾æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå…¶ä¸»è¦çš„æ€æƒ³æ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„å¯¹è±¡é‡‡å–ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚å¯ä»¥å°†å †å¤§è‡´åˆ†æˆä¸¤å—ï¼š\n\n- æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰\n- è€å¹´ä»£ï¼ˆOld Generationï¼‰\n\nå †ä¸éœ€è¦è¿ç»­å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€å¢åŠ å…¶å†…å­˜ï¼Œå¢åŠ å¤±è´¥ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚\n\nå¯ä»¥é€šè¿‡ -Xms å’Œ -Xmx è¿™ä¸¤ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªç¨‹åºçš„å †å†…å­˜å¤§å°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æœ€å¤§å€¼ã€‚\n\n### æ–¹æ³•åŒº\n\nJavaè™šæ‹Ÿæœºè§„èŒƒä¸­å°†å…¶æè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒè¿˜æœ‰ä¸€ä¸ªåˆ«åå°±å«åš`éå †`ï¼Œè€Œåœ¨HotSpotä¸­åˆ™ç§°ä¹‹ä¸º`æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰`ã€‚\n\nè¿™ä¸€å—ä¸»è¦ç”¨äºå­˜æ”¾**å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ï¼ˆç±»çš„ç‰ˆæœ¬ï¼Œå­—æ®µï¼Œæ–¹æ³•ï¼Œæ¥å£ï¼‰**ã€**è¿è¡Œæ—¶å¸¸é‡æ± **ã€**é™æ€å˜é‡**ã€å³æ—¶ç¼–è¯‘å™¨(JIT)ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚\n\nå’Œå †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•ï¼ŒåŠ¨æ€æ‰©å±•å¤±è´¥ä¸€æ ·ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚\n\nå¯¹è¿™å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ï¼Œä½†æ˜¯ä¸€èˆ¬æ¯”è¾ƒéš¾å®ç°ã€‚\n\n`HotSpot` è™šæ‹ŸæœºæŠŠå®ƒå½“æˆæ°¸ä¹…ä»£æ¥è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ä½†å¾ˆéš¾ç¡®å®šæ°¸ä¹…ä»£çš„å¤§å°ï¼Œå› ä¸ºå®ƒå—åˆ°å¾ˆå¤šå› ç´ å½±å“ï¼Œå¹¶ä¸”æ¯æ¬¡ Full GC ä¹‹åæ°¸ä¹…ä»£çš„å¤§å°éƒ½ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ç»å¸¸ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ä¸ºäº†æ›´å®¹æ˜“ç®¡ç†æ–¹æ³•åŒºï¼Œä» JDK 1.8 å¼€å§‹ï¼Œç§»é™¤æ°¸ä¹…ä»£ï¼Œå¹¶æŠŠæ–¹æ³•åŒºç§»è‡³å…ƒç©ºé—´ï¼Œå®ƒä½äºæœ¬åœ°å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚\n\næ–¹æ³•åŒºæ˜¯ä¸€ä¸ª JVM è§„èŒƒï¼Œæ°¸ä¹…ä»£ä¸å…ƒç©ºé—´éƒ½æ˜¯å…¶ä¸€ç§å®ç°æ–¹å¼ã€‚åœ¨ JDK 1.8 ä¹‹åï¼ŒåŸæ¥æ°¸ä¹…ä»£çš„æ•°æ®è¢«åˆ†åˆ°äº†å †å’Œå…ƒç©ºé—´ä¸­ã€‚å…ƒç©ºé—´å­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ï¼Œ**é™æ€å˜é‡å’Œå­—ç¬¦ä¸²å¸¸é‡æ± ç­‰è¢«æ”¾å…¥å †ä¸­**ã€‚\n\n### è¿è¡Œæ—¶å¸¸é‡æ± \n\nè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œ**Class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± **ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆçš„**å­—é¢é‡**å’Œ**ç¬¦å·å¼•ç”¨**ï¼‰ä¼šåœ¨**ç±»åŠ è½½å**è¢«æ”¾å…¥è¿™ä¸ªåŒºåŸŸ\n\né™¤äº†åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„å¸¸é‡ï¼Œè¿˜å…è®¸åŠ¨æ€ç”Ÿæˆï¼Œä¾‹å¦‚ String ç±»çš„ intern()\n\n> When the intern method is invoked, if the pool already contains a string equal to this {@code String} object as determined by the {@link #equals(Object)} method, then the string from the pool is returned. Otherwise, this {@code String} object is added to the pool and a reference to this {@code String} object is returned.\n\n```java\npublic class StringIntern {\n    public static void main(String[] args) {\n        //s1 s2å­˜æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­\n        // abc å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­ï¼ˆå­—èŠ‚ç å¸¸é‡ï¼‰\n        String s1=\"abc\";\n        String s2=\"abc\";\n\n        System.out.println(s1==s2); //true\n        //newå‡ºæ¥çš„ä¸€å®šæ˜¯åœ¨å †å†…å­˜ä¸­\n        String s3=new String(\"abc\");\n        System.out.println(s1==s3); //false\n        //è¿è¡Œæ—¶å¸¸é‡,internå°†å­—ç¬¦ä¸²æ·»åŠ åˆ°å¸¸é‡æ± ä¸­å¹¶ä¸”è¿”å›ä¸€ä¸ªå¼•ç”¨\n        System.out.println(s1==s3.intern()); //true\n        //é¢ è¦†è®¤çŸ¥çš„\n        //å®é™…ä¸Šè¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸€ä¸ªåœ¨å †ä¸­ï¼Œä¸€ä¸ªåœ¨å¸¸é‡æ± ä¸­\n        System.out.println(s3==s3.intern()); //false\n    }\n}\n```\n\nå…³äºStringå¸¸é‡æ±  å‚è€ƒå¯ä»¥è¿™ç¯‡ [æ–‡ç« ](https://blog.csdn.net/qq_34115899/article/details/86583262)\n\næˆ–è¿™ä¸€ç¯‡[ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ](https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html)\n\n### ç›´æ¥å†…å­˜\n\nåœ¨ JDK 1.4 ä¸­æ–°å¼•å…¥äº† NIO ç±»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ Java å †é‡Œçš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨å †å†…å­˜å’Œå †å¤–å†…å­˜æ¥å›æ‹·è´æ•°æ®ã€‚\n\n## å¯¹è±¡åˆ›å»º\n\n![mark](http://static.imlgw.top/blog/20190811/JcRnzxY4HN5q.png?imageslim)\n\nå‡è®¾Javaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰ç”¨è¿‡çš„å†…å­˜éƒ½æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´é‚£è¾¹æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸º`â€œæŒ‡é’ˆç¢°æ’â€`ï¼ˆBump the Pointerï¼‰ã€‚å¦‚æœJavaå †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„ï¼Œå·²ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆç¢°æ’äº†ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸º`â€œç©ºé—²åˆ—è¡¨â€`ï¼ˆFree Listï¼‰ã€‚é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”±`Javaå †æ˜¯å¦è§„æ•´`å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„`åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š`ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨Serialã€ParNewç­‰å¸¦Compactè¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨çš„åˆ†é…ç®—æ³•æ˜¯æŒ‡é’ˆç¢°æ’ï¼Œè€Œä½¿ç”¨CMSè¿™ç§åŸºäºMark-Sweepç®—æ³•çš„æ”¶é›†å™¨æ—¶ï¼Œé€šå¸¸é‡‡ç”¨ç©ºé—²åˆ—è¡¨ã€‚\n\n### çº¿ç¨‹å®‰å…¨é—®é¢˜\n\nåˆ›å»ºå¯¹è±¡çš„æ—¶å€™éœ€è¦ä¿®æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹è¿™å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè™šæ‹Ÿæœºå¯ä»¥é‡‡ç”¨CASåŠ ä¸Šå¤±è´¥é‡è¯•ï¼ˆè‡ªæ—‹ï¼‰çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ï¼Œä½†æ˜¯è¿™æ ·ä¼šå½±å“æ€§èƒ½ï¼Œå¦ä¸€ç§æ˜¯æŠŠå†…å­˜åˆ†é…çš„åŠ¨ä½œæŒ‰ç…§çº¿ç¨‹åˆ’åˆ†åœ¨ä¸åŒçš„ç©ºé—´ä¹‹ä¸­è¿›è¡Œï¼Œå³æ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸º`æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²`ï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ã€‚å“ªä¸ªçº¿ç¨‹è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨å“ªä¸ªçº¿ç¨‹çš„TLABä¸Šåˆ†é…ï¼Œåªæœ‰TLABç”¨å®Œå¹¶åˆ†é…æ–°çš„FLABæ—¶ï¼Œæ‰éœ€è¦åŒæ­¥é”å®šã€‚è™šæ‹Ÿæœºæ˜¯å¦ä½¿ç”¨TLABï¼Œå¯ä»¥é€šè¿‡-XXï¼š+/-UseTLABå‚æ•°æ¥è®¾å®šã€‚\n\n###  **å¯¹è±¡ç»“æ„**\n\n#### Object Header\n\nå¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†\n\n**è‡ªèº«è¿è¡Œæ—¶æ•°æ®ï¼ˆMark Wordï¼‰**æ¯”å¦‚ å¯¹è±¡å“ˆå¸Œå€¼ï¼Œå¯¹è±¡åˆ†å¸¦å¹´é¾„ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œçº¿ç¨‹æŒæœ‰çš„é”ï¼Œåå‘çº¿ç¨‹IDï¼Œåå‘æ—¶é—´æˆ³ç­‰ï¼Œå¦ä¸€éƒ¨åˆ†å°±æ˜¯**ç±»å‹æŒ‡é’ˆ**\n\n#### InstanceData\n\nå®ä¾‹æ•°æ®ï¼Œæ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­å®šä¹‰çš„å„ä¸ªç±»å‹å­—æ®µçš„å†…å®¹ï¼Œæ— è®ºæ˜¯ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„è¿˜æ˜¯åœ¨ä¹‹ç±»ç§å®šä¹‰çš„ï¼Œéƒ½éœ€è¦è®°å½•ä¸‹æ¥ã€‚\n\n#### **Padding**\n\nè¿™ä¸€éƒ¨åˆ†å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå…¶å®å°±æ˜¯ç”¨äºå†…å­˜å¯¹é½çš„ï¼ŒHotSpotè‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8ä¸ªå­—èŠ‚çš„æ•´æ•°å€ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8çš„æ•´æ•°å€ï¼Œå¦‚æœä¸å¤Ÿåˆ™éœ€è¦å¡«å……è¿™éƒ¨åˆ†å°±æ˜¯Padding\n\n### HotSpotæºç \n\næ‰¾åˆ°äº†openJdkçš„Java8å¯¹åº”çš„åˆ›å»ºå¯¹è±¡çš„[æºç ](http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/6a0ead6dc6db/src/share/vm/interpreter/bytecodeInterpreter.cpp)ï¼Œå¤§æ¦‚1966è¡Œå·¦å³\n\n## å †çš„åˆ’åˆ†\n\n### å †ç»“æ„åˆ†ä»£\n\nJavaè™šæ‹Ÿæœºå°†å †å†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ï¼Œæ°¸ä¹…ä»£æ˜¯HotSpotè™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼ˆJDK1.8ä¹‹åä¸ºmetaspaceæ›¿ä»£æ°¸ä¹…ä»£ï¼‰ï¼Œå®ƒé‡‡ç”¨æ°¸ä¹…ä»£çš„æ–¹å¼æ¥å®ç°æ–¹æ³•åŒºï¼Œå…¶ä»–çš„è™šæ‹Ÿæœºå®ç°æ²¡æœ‰è¿™ä¸€æ¦‚å¿µï¼Œè€Œä¸”HotSpotä¹Ÿæœ‰å–æ¶ˆæ°¸ä¹…ä»£çš„è¶‹åŠ¿ï¼Œåœ¨JDK 1.7ä¸­HotSpotå·²ç»å¼€å§‹äº†â€œå»æ°¸ä¹…åŒ–â€ï¼ŒæŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ç§»å‡ºã€‚æ°¸ä¹…ä»£ä¸»è¦å­˜æ”¾å¸¸é‡ã€ç±»ä¿¡æ¯ã€é™æ€å˜é‡ç­‰æ•°æ®ï¼Œä¸åƒåœ¾å›æ”¶å…³ç³»ä¸å¤§ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£æ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚\n\n**æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰**\n\næ–°ç”Ÿæˆçš„å¯¹è±¡ä¼˜å…ˆå­˜æ”¾åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ–°ç”Ÿä»£å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œå­˜æ´»ç‡å¾ˆä½ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ï¼Œå¸¸è§„åº”ç”¨è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†ä¸€èˆ¬å¯ä»¥å›æ”¶70% ~ 95% çš„ç©ºé—´ï¼Œå›æ”¶æ•ˆç‡å¾ˆé«˜ã€‚\n\n**è€å¹´ä»£ï¼ˆOld Generationnï¼‰**\n\nåœ¨æ–°ç”Ÿä»£ä¸­ç»å†äº†å¤šæ¬¡ï¼ˆå…·ä½“çœ‹è™šæ‹Ÿæœºé…ç½®çš„é˜€å€¼ï¼‰GCåä»ç„¶å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ä¸­ã€‚è€å¹´ä»£ä¸­çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œå­˜æ´»ç‡æ¯”è¾ƒé«˜ï¼Œåœ¨è€å¹´ä»£ä¸­è¿›è¡ŒGCçš„é¢‘ç‡ç›¸å¯¹è€Œè¨€è¾ƒä½ï¼Œè€Œä¸”å›æ”¶çš„é€Ÿåº¦ä¹Ÿæ¯”è¾ƒæ…¢ã€‚\n\n**æ°¸ä¹…ä»£ï¼ˆPermanent Generationnï¼‰**\n\næ°¸ä¹…ä»£å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼Œå¯¹è¿™ä¸€åŒºåŸŸè€Œè¨€ï¼ŒJavaè™šæ‹Ÿæœºè§„èŒƒæŒ‡å‡ºå¯ä»¥ä¸è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œä¸€èˆ¬è€Œè¨€ä¸ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ã€‚\n\n### å †ç»“æ„åˆ†ä»£çš„æ„ä¹‰\n\nã€€ã€€Javaè™šæ‹Ÿæœºæ ¹æ®å¯¹è±¡å­˜æ´»çš„å‘¨æœŸä¸åŒï¼ŒæŠŠå †å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ï¼ˆ`å¯¹HotSpotè™šæ‹Ÿæœºè€Œè¨€`ï¼‰ï¼Œè¿™å°±æ˜¯JVMçš„å†…å­˜åˆ†ä»£ç­–ç•¥ã€‚\nã€€ã€€å †å†…å­˜æ˜¯è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œä¹Ÿæ˜¯`åƒåœ¾å›æ”¶æœ€é¢‘ç¹`çš„ä¸€å—åŒºåŸŸï¼Œæˆ‘ä»¬ç¨‹åºæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½å­˜æ”¾åœ¨å †å†…å­˜ä¸­ã€‚ç»™å †å†…å­˜åˆ†ä»£æ˜¯ä¸ºäº†æé«˜å¯¹è±¡å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå †å†…å­˜æ²¡æœ‰åŒºåŸŸåˆ’åˆ†ï¼Œæ‰€æœ‰çš„æ–°åˆ›å»ºçš„å¯¹è±¡å’Œç”Ÿå‘½å‘¨æœŸå¾ˆé•¿çš„å¯¹è±¡æ”¾åœ¨ä¸€èµ·ï¼Œéšç€ç¨‹åºçš„æ‰§è¡Œï¼Œå †å†…å­˜éœ€è¦é¢‘ç¹è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œè€Œæ¯æ¬¡å›æ”¶éƒ½è¦éå†æ‰€æœ‰çš„å¯¹è±¡ï¼Œéå†è¿™äº›å¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ä»£ä»·æ˜¯å·¨å¤§çš„ï¼Œä¼šä¸¥é‡å½±å“æˆ‘ä»¬çš„GCæ•ˆç‡ã€‚\nã€€ã€€æœ‰äº†å†…å­˜åˆ†ä»£ï¼Œæƒ…å†µå°±ä¸åŒäº†ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡ä¼šåœ¨æ–°ç”Ÿä»£ä¸­åˆ†é…å†…å­˜ï¼Œç»è¿‡å¤šæ¬¡å›æ”¶ä»ç„¶å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å­˜æ”¾åœ¨`è€å¹´ä»£`ä¸­ï¼Œé™æ€å±æ€§ã€ç±»ä¿¡æ¯ç­‰å­˜æ”¾åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡å­˜æ´»æ—¶é—´çŸ­ï¼Œåªéœ€è¦åœ¨æ–°ç”Ÿä»£åŒºåŸŸä¸­é¢‘ç¹è¿›è¡ŒGCï¼Œè€å¹´ä»£ä¸­å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå†…å­˜å›æ”¶çš„é¢‘ç‡ç›¸å¯¹è¾ƒä½ï¼Œä¸éœ€è¦é¢‘ç¹è¿›è¡Œå›æ”¶ï¼Œæ°¸ä¹…ä»£ä¸­å›æ”¶æ•ˆæœå¤ªå·®ï¼Œä¸€èˆ¬ä¸è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿˜å¯ä»¥æ ¹æ®ä¸åŒå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚åˆ†ä»£æ”¶é›†å¤§å¤§æå‡äº†æ”¶é›†æ•ˆç‡ï¼Œè¿™äº›éƒ½æ˜¯å†…å­˜åˆ†ä»£å¸¦æ¥çš„å¥½å¤„ã€‚\n\n## åƒåœ¾æ”¶é›†\n\nåƒåœ¾æ”¶é›†ä¸»è¦æ˜¯é’ˆå¯¹`å †å’Œæ–¹æ³•åŒº`è¿›è¡Œã€‚ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆè¿™ä¸‰ä¸ªåŒºåŸŸå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œåªå­˜åœ¨äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçº¿ç¨‹ç»“æŸä¹‹åå°±ä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä¸éœ€è¦å¯¹è¿™ä¸‰ä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ã€‚\n\n### åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶\n\nåœ¨å †ä¸­å­˜æ”¾ç€Javaä¸–ç•Œä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶çš„æ—¶å€™ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­é‚£äº›è¿˜â€œæ´»ç€â€ï¼Œé‚£äº›å·²ç»â€œæ­»å»â€ï¼ˆä¸ä¼šå†è¢«ä½¿ç”¨ï¼‰\n\n#### **å¼•ç”¨è®¡æ•°æ³•**\n\nç»™å¯¹è±¡åŠ ä¸Šä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒçš„æ—¶å€™ï¼Œè®¡æ•°å™¨å€¼å°±åŠ 1ï¼Œå¼•ç”¨å¤±æ•ˆçš„æ—¶å€™å°±å‡ä¸€ï¼Œè®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚\n\nä½†æ˜¯åœ¨ä¸»æµçš„Javaè™šæ‹Ÿæœºä¸­éƒ½æ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨æ¥è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œä¸»è¦çš„åŸå› å°±æ˜¯å®ƒå¾ˆéš¾è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚\n\n```java\npublic class Test {\n    public Object instance = null;\n    public static void main(String[] args) {\n        Test a = new Test();\n        Test b = new Test();\n        a.instance = b;\n        b.instance = a;\n        a = null;\n        b = null;\n        doSomething();\n    }\n}\n```\n\nä¸Šé¢çš„ä»£ç ä¸­ `Test a`  å’Œ`Test b` äº’ç›¸å¼•ç”¨ï¼Œåœ¨åç»­å°†ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨èµ‹ä¸ºnullåä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ä»ç„¶ä¸ä¸º0ï¼Œå¯¼è‡´æ— æ³•å›æ”¶è¿™ä¸¤ä¸ªå¯¹è±¡ã€‚\n\n#### **å¯è¾¾æ€§åˆ†ææ³•**\n\nä»¥ `GC Roots` ä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œå¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºä½¿ç”¨è¯¥ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶ã€‚\n\nJavaè¯­è¨€ä¸­å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡åŒ…æ‹¬ä¸‹é¢å‡ ç§\n\n- è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡\n- æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI ä¸­å¼•ç”¨çš„å¯¹è±¡\n- æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡\n- æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡\n\n#### OopMapï¼Œå®‰å…¨ç‚¹ï¼Œå®‰å…¨åŒº\n\né‡‡ç”¨å¯è¾¾æ€§åˆ†ææ³•é¦–å…ˆå°±æ‰¾æ‰¾åˆ°é‚£äº›æ˜¯`GC Root`ï¼Œç›®å‰ä¸»è¦æœ‰ä¸¤ç§æŸ¥æ‰¾ GC Roots çš„æ–¹æ³•ï¼š\n\nğŸ’¡**ä¿å®ˆå¼ GC**ï¼šéå†æ–¹æ³•åŒºå’Œæ ˆåŒºæŸ¥æ‰¾ï¼Œæ— æ³•ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œé™¤éé‡‡ç”¨`å¥æŸ„è®¿é—®å¯¹è±¡çš„æ–¹å¼`ä½†æ•ˆç‡ä¸é«˜ï¼Œæ— æ³•å‡†ç¡®åŒºåˆ†æ˜¯ä¸æ˜¯å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ç±»å‹çš„å˜é‡\n\nğŸ’¡**å‡†ç¡®å¼ GC**ï¼šä¸ä¿å®ˆå¼GCç›¸å¯¹çš„å°±æ˜¯å‡†ç¡®å¼GCï¼Œå°±æ˜¯æˆ‘ä»¬å‡†ç¡®çš„çŸ¥é“ï¼ŒæŸä¸ªä½ç½®ä¸Šé¢æ˜¯å¦æ˜¯æŒ‡é’ˆï¼Œå¯¹äºjavaæ¥è¯´ï¼Œå°±æ˜¯çŸ¥é“å¯¹äºæŸä¸ªä½ç½®ä¸Šçš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å‡ºæ‰€æœ‰çš„ä½ç½®ä¸Šçš„æ•°æ®æ˜¯ä¸æ˜¯æŒ‡å‘GCå †çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬æ ˆå’Œå¯„å­˜å™¨é‡Œçš„æ•°æ®ã€‚HotSpotåˆ™æ˜¯é€šè¿‡ `OopMap` æ•°æ®ç»“æ„æ¥è®°å½•åœ¨å¯¹è±¡å†…çš„ä»€ä¹ˆåç§»é‡ä¸Šæ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®\n\nå¾ˆæ˜æ˜¾ï¼Œä¿å®ˆå¼ GC çš„æˆæœ¬å¤ªé«˜ã€‚å‡†ç¡®å¼ GC çš„ä¼˜ç‚¹å°±æ˜¯èƒ½å¤Ÿè®©è™šæ‹Ÿæœºå¿«é€Ÿå®šä½åˆ° GC Rootsã€‚\n\nå¯¹åº” `OopMap` çš„ä½ç½®å³å¯ä½œä¸ºä¸€ä¸ª`Safe Point`ï¼ˆå®‰å…¨ç‚¹ï¼‰ã€‚\n\n**ä»€ä¹ˆæ˜¯å®‰å…¨ç‚¹ï¼Ÿ**\n\nOopMapçš„ä½œç”¨æ˜¯ä¸ºäº†åœ¨GCçš„æ—¶å€™ï¼Œå¿«é€Ÿè¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰€ä»¥OopMapå¹¶ä¸éœ€è¦ä¸€å‘ç”Ÿæ”¹å˜å°±å»æ›´æ–°è¿™ä¸ªæ˜ å°„è¡¨ã€‚åªè¦è¿™ä¸ª`æ›´æ–°åœ¨GCå‘ç”Ÿä¹‹å‰`å°±å¯ä»¥äº†ã€‚æ‰€ä»¥OopMapåªéœ€è¦åœ¨é¢„å…ˆé€‰å®šçš„ä¸€äº›ä½ç½®ä¸Šè®°å½•å˜åŒ–çš„OopMapå°±è¡Œäº†ã€‚è¿™äº›ç‰¹å®šçš„ç‚¹å°±æ˜¯`SafePoint`ï¼ˆå®‰å…¨ç‚¹ï¼‰ã€‚ç”±æ­¤ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œç¨‹åºå¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„ä½ç½®ä¸Šéƒ½å¯ä»¥è¿›è¡ŒGCçš„ï¼Œåªæœ‰åœ¨è¾¾åˆ°è¿™æ ·çš„å®‰å…¨ç‚¹æ‰èƒ½æš‚åœä¸‹æ¥è¿›è¡ŒGCã€‚\n\n**å®‰å…¨ç‚¹çš„é€‰å–**\n\nåœ¨æ‰§è¡Œ GC æ“ä½œæ—¶ï¼Œæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹å¿…é¡»åœé¡¿ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„`\"Stop-The-World\"`ï¼Œå› ä¸ºå¯è¾¾æ€§åˆ†æç®—æ³•å¿…é¡»æ˜¯åœ¨ä¸€ä¸ªç¡®ä¿ä¸€è‡´æ€§çš„å†…å­˜å¿«ç…§ä¸­è¿›è¡Œã€‚å¦‚æœåœ¨åˆ†æçš„è¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ†æç»“æœçš„å‡†ç¡®æ€§å°±ä¸èƒ½ä¿è¯ã€‚\n\nå®‰å…¨ç‚¹æ„å‘³ç€åœ¨è¿™ä¸ªç‚¹æ—¶ï¼Œæ‰€æœ‰`å·¥ä½œçº¿ç¨‹çš„çŠ¶æ€æ˜¯ç¡®å®š`çš„ï¼ŒJVM å°±å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œ GC ã€‚\n\nå®‰å…¨ç‚¹çš„é€‰å–ä¸€èˆ¬åœ¨ä»¥ä¸‹å‡ ä¸ªä½ç½®ï¼Œé¿å…ç¨‹åºè¿‡é•¿æ—¶é—´æ‰§è¡Œã€‚\n\n- å¾ªç¯çš„æœ«å°¾\n\n- æ–¹æ³•ä¸´è¿”å›å‰\n\n- è°ƒç”¨æ–¹æ³•ä¹‹å\n\n- æŠ›å¼‚å¸¸çš„ä½ç½®\n\n**å®‰å…¨åŒº**\n\nâ€‹\tå®‰å…¨ç‚¹çš„ä½¿ç”¨ä¼¼ä¹è§£å†³äº†OopMapè®¡ç®—çš„æ•ˆç‡çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å®‰å…¨ç‚¹éœ€è¦ç¨‹åºè‡ªå·±è·‘è¿‡å»ï¼Œé‚£ä¹ˆå¯¹äºé‚£äº›å·²ç»åœåœ¨è·¯è¾¹ä¼‘æ¯æˆ–è€…çœ‹é£æ™¯çš„ç¨‹åºï¼ˆæ¯”å¦‚é‚£äº›å¤„åœ¨Sleepæˆ–è€…BlockedçŠ¶æ€çš„çº¿ç¨‹ï¼‰ï¼Œä»–ä»¬å¯èƒ½å¹¶ä¸ä¼šåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è·‘åˆ°å®‰å…¨ç‚¹å»ã€‚æ‰€ä»¥è¿™é‡Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆå¼•å…¥äº†å®‰å…¨åŒºåŸŸçš„æ¦‚å¿µã€‚\n\nâ€‹\tå®‰å…¨åŒºåŸŸå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨ç¨‹åºçš„ä¸€æ®µä»£ç ç‰‡æ®µä¸­å¹¶`ä¸ä¼šå¯¼è‡´å¼•ç”¨å…³ç³»å‘ç”Ÿå˜åŒ–`ï¼Œä¹Ÿå°±ä¸ç”¨å»æ›´æ–°OopMapè¡¨äº†ï¼Œé‚£ä¹ˆåœ¨è¿™æ®µä»£ç åŒºåŸŸå†…ä»»ä½•åœ°æ–¹è¿›è¡ŒGCéƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è¿™æ®µåŒºåŸŸå°±ç§°ä¹‹ä¸ºå®‰å…¨åŒºåŸŸã€‚çº¿ç¨‹æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿›å…¥åˆ°å®‰å…¨åŒºåŸŸå†…ï¼Œå°±ä¼šæ ‡å¿—è‡ªå·±å·²ç»è¿›è¡Œåˆ°å®‰å…¨åŒºåŸŸäº†ã€‚é‚£ä¹ˆè™šæ‹Ÿæœºè¦è¿›è¡ŒGCçš„æ—¶å€™ï¼Œå‘ç°è¯¥çº¿ç¨‹å·²ç»è¿è¡Œåˆ°å®‰å…¨åŒºåŸŸï¼Œå°±ä¸ä¼šç®¡è¯¥çº¿ç¨‹çš„æ­»æ´»äº†ã€‚æ‰€ä»¥ï¼Œè¯¥çº¿ç¨‹åœ¨è„±ç¦»å®‰å…¨åŒºåŸŸçš„æ—¶å€™ï¼Œè¦`è‡ªå·±æ£€æŸ¥`ç³»ç»Ÿæ˜¯å¦å·²ç»å®Œæˆäº†GCæˆ–è€…æ ¹èŠ‚ç‚¹æšä¸¾ï¼ˆè¿™ä¸ªè·ŸGCçš„ç®—æ³•æœ‰å…³ç³»ï¼‰ï¼Œå¦‚æœå®Œæˆäº†å°±ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæœªå®Œæˆï¼Œå®ƒå°±å¿…é¡»ç­‰å¾…æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€å®‰å…¨åŒºåŸŸçš„Safe Regionçš„ä¿¡å·ä¸ºæ­¢ã€‚\n\n**ä¸­æ–­æ–¹å¼**\n\nåœ¨ç¨‹åºéœ€è¦GCçš„æ—¶å€™æ€ä¹ˆè®©æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾å®‰å…¨ç‚¹ä¸­æ–­ç„¶åè¿›è¡ŒGC ?\n\n- æŠ¢æ–­å¼ä¸­æ–­ï¼šæŠ¢æ–­å¼ä¸­æ–­å°±æ˜¯åœ¨GCçš„æ—¶å€™ï¼Œè®©æ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¸­æ–­ï¼Œå¦‚æœè¿™äº›çº¿ç¨‹ä¸­å‘ç°ä¸­æ–­åœ°æ–¹ä¸åœ¨å®‰å…¨ç‚¹ä¸Šçš„ï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©ä»–ä»¬é‡æ–°è·‘èµ·æ¥ï¼Œç›´åˆ°è·‘åˆ°å®‰å…¨ç‚¹ä¸Šã€‚ï¼ˆç°åœ¨å‡ ä¹æ²¡æœ‰è™šæ‹Ÿæœºé‡‡ç”¨è¿™ç§æ–¹å¼ï¼‰\n\n- ä¸»åŠ¨å¼ä¸­æ–­ï¼šä¸»åŠ¨å¼ä¸­æ–­åœ¨GCçš„æ—¶å€™ï¼Œä¸ä¼šä¸»åŠ¨å»ä¸­æ–­çº¿ç¨‹ï¼Œä»…ä»…æ˜¯è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå½“ç¨‹åºè¿è¡Œåˆ°å®‰å…¨ç‚¹æ—¶å°±å»è½®è®­è¯¥ä½ç½®ï¼Œå‘ç°è¯¥ä½ç½®è¢«è®¾ç½®ä¸ºçœŸæ—¶å°±è‡ªå·±ä¸­æ–­æŒ‚èµ·ã€‚æ‰€ä»¥è½®è®­æ ‡å¿—çš„åœ°æ–¹æ˜¯å’Œå®‰å…¨ç‚¹é‡åˆçš„ï¼Œå¦å¤–åˆ›å»ºå¯¹è±¡éœ€è¦åˆ†é…å†…å­˜çš„åœ°æ–¹ä¹Ÿéœ€è¦è½®è¯¢è¯¥ä½ç½®ã€‚\n\n#### æ–¹æ³•åŒºçš„å›æ”¶\n\næ–¹æ³•åŒºï¼ˆHotSpotä¸­çš„æ°¸ä¹…ä»£ï¼‰ï¼Œåœ¨Javaè§„èŒƒä¸­å¹¶æ²¡æœ‰è¦æ±‚è™šæ‹Ÿæœºå¯¹è¯¥åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™ä¸ªåŒºåŸŸçš„åƒåœ¾å›æ”¶æ•ˆç‡è¦è¿œä½äºåœ¨`å †ä¸­` \n\nå›æ”¶çš„ä¸»è¦å¯¹è±¡ï¼š\n\n- åºŸå¼ƒå¸¸é‡\n- æ— ç”¨çš„ç±»(Classå¯¹è±¡)\n\nåˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯åºŸå¼ƒå¸¸é‡ï¼Œåªè¦æ²¡æœ‰ä»»ä½•å¯¹è±¡å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡ï¼Œè¯¥å¸¸é‡å°±å¯ä»¥å›æ”¶ã€‚\n\nåˆ¤æ–­ä¸€ä¸ªç±»æ˜¯ä¸æ˜¯æ— ç”¨çš„ç±»æ¡ä»¶åˆ™æ¯”è¾ƒè‹›åˆ»ã€‚\n\n- è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œæ­¤æ—¶å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚\n- åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚\n- è¯¥ç±»å¯¹åº”çš„ Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•ã€‚\n\næ»¡è¶³äº†ä¸Šè¿°æ¡ä»¶è™šæ‹Ÿæœºæ‰**å¯ä»¥** å¯¹å…¶è¿›è¡Œå›æ”¶ï¼Œä½†æ˜¯è¿™ä¹Ÿå¹¶ä¸æ˜¯å¿…ç„¶çš„ã€‚\n\n#### Finalize()\n\nè¿™ä¸ªæ–¹æ³•å¿˜äº†å°±å¥½ğŸ˜\n\nå½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœé‡å†™è¯¥å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚è‡ªæ•‘åªèƒ½è¿›è¡Œä¸€æ¬¡ï¼Œå¦‚æœå›æ”¶çš„å¯¹è±¡ä¹‹å‰è°ƒç”¨äº† finalize() æ–¹æ³•è‡ªæ•‘ï¼Œåé¢å›æ”¶æ—¶ä¸ä¼šå†è°ƒç”¨è¯¥æ–¹æ³•ã€‚\n\n### å¼•ç”¨ç±»å‹\n\næ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶éƒ½ä¸å¼•ç”¨æœ‰å…³ã€‚\n\nJava æä¾›äº†å››ç§å¼ºåº¦ä¸åŒçš„å¼•ç”¨ç±»å‹ã€‚\n\n#### å¼ºå¼•ç”¨\n\nè¢«å¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ã€‚\n\nä½¿ç”¨ new ä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºå¼ºå¼•ç”¨ã€‚\n\n```java\nObject obj = new Object();Copy to clipboardErrorCopied\n```\n\n#### è½¯å¼•ç”¨\n\nè¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶ã€‚\n\nä½¿ç”¨ SoftReference ç±»æ¥åˆ›å»ºè½¯å¼•ç”¨ã€‚\n\n```java\nObject obj = new Object();\nSoftReference<Object> sf = new SoftReference<Object>(obj);\nobj = null;  // ä½¿å¯¹è±¡åªè¢«è½¯å¼•ç”¨å…³è”Copy to clipboardErrorCopied\n```\n\n#### å¼±å¼•ç”¨\n\nè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰ã€‚\n\nä½¿ç”¨ WeakReference ç±»æ¥åˆ›å»ºå¼±å¼•ç”¨ã€‚\n\n```java\nObject obj = new Object();\nWeakReference<Object> wf = new WeakReference<Object>(obj);\nobj = null;Copy to clipboardErrorCopied\n```\n\n####  è™šå¼•ç”¨\n\nåˆç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´é€ æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ã€‚\n\nä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„å”¯ä¸€ç›®çš„æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚\n\nä½¿ç”¨ PhantomReference æ¥åˆ›å»ºè™šå¼•ç”¨ã€‚\n\n```java\nObject obj = new Object();\nPhantomReference<Object> pf = new PhantomReference<Object>(obj, null);\nobj = null;\n```\n\n### åƒåœ¾æ”¶é›†ç®—æ³•\n\n#### æ ‡è®° - æ¸…é™¤ç®—æ³•\n\n![CyC](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/005b481b-502b-4e3f-985d-d043c2b330aa.png)\n\n\n\nåœ¨æ ‡è®°é˜¶æ®µï¼Œç¨‹åºä¼šæ£€æŸ¥æ¯ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œå¦‚æœæ˜¯æ´»åŠ¨å¯¹è±¡ï¼Œåˆ™ç¨‹åºä¼šåœ¨å¯¹è±¡å¤´éƒ¨æ‰“ä¸Šæ ‡è®°ã€‚\n\nåœ¨æ¸…é™¤é˜¶æ®µï¼Œä¼šéå†æ•´ä¸ªå †è¿›è¡Œå¯¹è±¡å›æ”¶å¹¶å–æ¶ˆæ ‡å¿—ä½ï¼Œå¦å¤–ï¼Œè¿˜ä¼šåˆ¤æ–­å›æ”¶åçš„åˆ†å—ä¸å‰ä¸€ä¸ªç©ºé—²åˆ†å—æ˜¯å¦è¿ç»­ï¼Œè‹¥è¿ç»­ï¼Œä¼šåˆå¹¶è¿™ä¸¤ä¸ªåˆ†å—ã€‚å›æ”¶å¯¹è±¡å°±æ˜¯æŠŠå¯¹è±¡ä½œä¸ºåˆ†å—ï¼Œè¿æ¥åˆ°è¢«ç§°ä¸º `â€œç©ºé—²é“¾è¡¨â€` çš„å•å‘é“¾è¡¨ï¼Œä¹‹åè¿›è¡Œåˆ†é…æ—¶åªéœ€è¦éå†è¿™ä¸ªç©ºé—²é“¾è¡¨ï¼Œå°±å¯ä»¥æ‰¾åˆ°åˆ†å—ã€‚\n\nåœ¨åˆ†é…æ—¶ï¼Œç¨‹åºä¼šæœç´¢ç©ºé—²é“¾è¡¨å¯»æ‰¾ç©ºé—´å¤§äºç­‰äºæ–°å¯¹è±¡å¤§å° size çš„å— blockã€‚å¦‚æœå®ƒæ‰¾åˆ°çš„å—ç­‰äº sizeï¼Œä¼šç›´æ¥è¿”å›è¿™ä¸ªåˆ†å—ï¼›å¦‚æœæ‰¾åˆ°çš„å—å¤§äº sizeï¼Œä¼šå°†å—åˆ†å‰²æˆå¤§å°ä¸º size ä¸ (block - size) çš„ä¸¤éƒ¨åˆ†ï¼Œè¿”å›å¤§å°ä¸º size çš„åˆ†å—ï¼Œå¹¶æŠŠå¤§å°ä¸º (block - size) çš„å—è¿”å›ç»™ç©ºé—²é“¾è¡¨ã€‚\n\nè¯¦ç»†å¯ä»¥å‚è€ƒ [åƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°](http://www.ituring.com.cn/book/tupubarticle/10955)\n\n#### å¤åˆ¶ç®—æ³•\n\n![CyC](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/b2b77b9e-958c-4016-8ae5-9c6edd83871e.png)\n\nå°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´è¿›è¡Œä¸€æ¬¡æ¸…ç†ã€‚\n\nä¸»è¦ä¸è¶³æ˜¯`åªä½¿ç”¨äº†å†…å­˜çš„ä¸€åŠ`ã€‚\n\nç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯ä¸€å—`è¾ƒå¤§çš„ Eden` ç©ºé—´å’Œ`ä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´`ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivorã€‚åœ¨å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å— Survivor ä¸Šï¼Œ`æœ€åæ¸…ç† Eden å’Œä½¿ç”¨è¿‡çš„é‚£ä¸€å— Survivorã€‚`\n\nHotSpot è™šæ‹Ÿæœºçš„ Eden å’Œ Survivor å¤§å°æ¯”ä¾‹é»˜è®¤ä¸º 8:1ï¼Œä¿è¯äº†å†…å­˜çš„åˆ©ç”¨ç‡è¾¾åˆ° 90%ã€‚å¦‚æœæ¯æ¬¡å›æ”¶æœ‰å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œé‚£ä¹ˆä¸€å— Survivor å°±ä¸å¤Ÿç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦`ä¾èµ–äºè€å¹´ä»£è¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿`ï¼Œä¹Ÿå°±æ˜¯å€Ÿç”¨è€å¹´ä»£çš„ç©ºé—´å­˜å‚¨æ”¾ä¸ä¸‹çš„å¯¹è±¡ã€‚\n\n#### æ ‡è®° - æ•´ç†\n\nå¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜çš„æ—¶å€™å°±è¦è¿›è¡Œå¾ˆå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šå˜ä½ï¼Œè€å¹´ä»£ä¹Ÿæ²¡æœ‰é¢å¤–çš„ç©ºé—´åšæ‹…ä¿ï¼Œæ‰€ä»¥è€å¹´ä»£ä¸€èˆ¬ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ç§ç®—æ³•ã€‚\n\n![CyC](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ccd773a5-ad38-4022-895c-7ac318f31437.png)\n\nè®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚\n\n- ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡\n\n- éœ€è¦ç§»åŠ¨å¤§é‡å¯¹è±¡ï¼Œå¤„ç†æ•ˆç‡æ¯”è¾ƒä½ã€‚\n\n#### åˆ†ä»£æ”¶é›†\n\nåˆ†ä»£æ”¶é›†é¡¾åæ€ä¹‰å°±æ˜¯åˆ†ä»£æ¥æ”¶é›†ï¼Œé’ˆå¯¹ä¸åŒçš„ä»£æ‰§è¡Œä¸åŒçš„æ”¶é›†ç®—æ³•ã€‚\n\nä¸€èˆ¬å°†å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚\n\n- æ–°ç”Ÿä»£ä½¿ç”¨ï¼šå°‘é‡å­˜æ´»å¯¹è±¡ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•åªéœ€è¦ä»˜å‡ºå°‘é‡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚\n- è€å¹´ä»£ä½¿ç”¨ï¼šå­˜æ´»ç‡é«˜æ²¡æœ‰æ‹…ä¿ï¼Œé‡‡ç”¨æ ‡è®° - æ¸…é™¤ æˆ–è€… æ ‡è®° - æ•´ç† ç®—æ³•ï¼Œ\n\n### åƒåœ¾æ”¶é›†å™¨\n\n![mark](http://static.imlgw.top/blog/20190813/3f2uQGV4SjI4.png?imageslim)\n\nä»¥ä¸Šæ˜¯ HotSpot è™šæ‹Ÿæœºä¸­çš„ 7 ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¿çº¿è¡¨ç¤ºåƒåœ¾æ”¶é›†å™¨å¯ä»¥é…åˆä½¿ç”¨ã€‚\n\n#### Serialæ”¶é›†å™¨\n\n**Serialï¼ˆä¸²è¡Œï¼‰**æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ï¼Œå®ƒæ˜¯é‡‡ç”¨`å¤åˆ¶ç®—æ³•`çš„`æ–°ç”Ÿä»£æ”¶é›†å™¨`ï¼Œæ›¾ç»ï¼ˆJDK 1.3.1ä¹‹å‰ï¼‰æ˜¯è™šæ‹Ÿæœº`æ–°ç”Ÿä»£`æ”¶é›†çš„å”¯ä¸€é€‰æ‹©ã€‚å®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œåªä¼šä½¿ç”¨ä¸€ä¸ªCPUæˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯**å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´è‡³Serialæ”¶é›†å™¨æ”¶é›†ç»“æŸä¸ºæ­¢ï¼ˆâ€œStop The Worldâ€ï¼‰**ã€‚è¿™é¡¹å·¥ä½œæ˜¯ç”±è™šæ‹Ÿæœºåœ¨åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆçš„ï¼Œåœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹æŠŠç”¨æˆ·æ­£å¸¸å·¥ä½œçš„çº¿ç¨‹å…¨éƒ¨åœæ‰ï¼Œè¿™å¯¹å¾ˆå¤šåº”ç”¨æ¥è¯´æ˜¯éš¾ä»¥æ¥æ”¶çš„ã€‚\n\nä¸‹å›¾å±•ç¤ºäº†Serial æ”¶é›†å™¨ï¼ˆè€å¹´ä»£é‡‡ç”¨Serial Oldæ”¶é›†å™¨ï¼‰çš„è¿è¡Œè¿‡ç¨‹ï¼š\n\n![mark](http://static.imlgw.top/blog/20190813/03PTqvGk6jdy.png?imageslim)\n\nä¸ºäº†æ¶ˆé™¤æˆ–å‡å°‘å·¥ä½œçº¿ç¨‹å› å†…å­˜å›æ”¶è€Œå¯¼è‡´çš„åœé¡¿ï¼ŒHotSpotè™šæ‹Ÿæœºå¼€å‘å›¢é˜Ÿåœ¨JDK 1.3ä¹‹åçš„Javaå‘å±•å†ç¨‹ä¸­ç ”å‘å‡ºäº†å„ç§å…¶ä»–çš„ä¼˜ç§€æ”¶é›†å™¨ï¼Œè¿™äº›å°†åœ¨ç¨åä»‹ç»ã€‚ä½†æ˜¯è¿™äº›æ”¶é›†å™¨çš„è¯ç”Ÿå¹¶ä¸æ„å‘³ç€Serialæ”¶é›†å™¨å·²ç»â€œè€è€Œæ— ç”¨â€ï¼Œå®é™…ä¸Šåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå®ƒä¾ç„¶æ˜¯**HotSpotè™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„é»˜è®¤çš„æ–°ç”Ÿä»£æ”¶é›†å™¨**ã€‚å®ƒä¹Ÿæœ‰ç€ä¼˜äºå…¶ä»–æ”¶é›†å™¨çš„åœ°æ–¹ï¼š**ç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æ›´é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚**\n\nåœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬ä¸ä¼šå¾ˆå¤§ï¼Œæ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„æ–°ç”Ÿä»£ï¼ˆä»…ä»…æ˜¯æ–°ç”Ÿä»£ä½¿ç”¨çš„å†…å­˜ï¼Œæ¡Œé¢åº”ç”¨åŸºæœ¬ä¸ä¼šå†å¤§äº†ï¼‰ï¼Œåœé¡¿æ—¶é—´å®Œå…¨å¯ä»¥æ§åˆ¶åœ¨å‡ åæ¯«ç§’æœ€å¤šä¸€ç™¾æ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œè¿™ç‚¹åœé¡¿æ—¶é—´å¯ä»¥æ¥æ”¶ã€‚æ‰€ä»¥ï¼ŒSerialæ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚\n\n#### ParNew æ”¶é›†å™¨\n\n`ParNew`æ”¶é›†å™¨å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª`æ–°ç”Ÿä»£æ”¶é›†å™¨`ã€‚é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ï¼ˆå¤åˆ¶ç®—æ³•ï¼‰ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰ä¸Serialæ”¶é›†å™¨å®Œå…¨ç›¸åŒï¼Œä¸¤è€…å…±ç”¨äº†ç›¸å½“å¤šçš„ä»£ç ã€‚\n\nParNewæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼ˆè€å¹´ä»£é‡‡ç”¨Serial Oldæ”¶é›†å™¨ï¼‰ï¼š\n\n![mark](http://static.imlgw.top/blog/20190813/NDuVa0QjwwYM.png?imageslim)\n\nParNewæ”¶é›†å™¨é™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹æ”¶é›†å¤–ï¼Œå…¶ä»–ä¸Serialæ”¶é›†å™¨ç›¸æ¯”å¹¶æ— å¤ªå¤šåˆ›æ–°ä¹‹å¤„ï¼Œä½†å®ƒå´æ˜¯è®¸å¤šè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä¸­é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¸æ€§èƒ½æ— å…³çš„é‡è¦åŸå› æ˜¯ï¼Œ`é™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½å’ŒCMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰é…åˆå·¥ä½œ`ï¼ŒCMSæ”¶é›†å™¨æ˜¯JDK 1.5æ¨å‡ºçš„ä¸€ä¸ªå…·æœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„æ”¶é›†å™¨ï¼Œå…·ä½“å†…å®¹å°†åœ¨ç¨åè¿›è¡Œä»‹ç»ã€‚\n\nParNew æ”¶é›†å™¨åœ¨`å•CPUçš„ç¯å¢ƒ`ä¸­ç»å¯¹ä¸ä¼šæœ‰æ¯”Serialæ”¶é›†å™¨æœ‰æ›´å¥½çš„æ•ˆæœï¼Œç”šè‡³ç”±äºå­˜åœ¨çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè¯¥æ”¶é›†å™¨åœ¨é€šè¿‡è¶…çº¿ç¨‹æŠ€æœ¯å®ç°çš„ä¸¤ä¸ªCPUçš„ç¯å¢ƒä¸­éƒ½ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾åœ°ä¿è¯å¯ä»¥è¶…è¶Šã€‚åœ¨å¤šCPUç¯å¢ƒä¸‹ï¼Œéšç€CPUçš„æ•°é‡å¢åŠ ï¼Œå®ƒå¯¹äºGCæ—¶ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨æ˜¯å¾ˆæœ‰å¥½å¤„çš„ã€‚å®ƒé»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šçš„æƒ…å†µä¸‹å¯ä½¿ç”¨`-XX:ParallerGCThreads`å‚æ•°è®¾ç½®ã€‚\n\n#### Parallel Scavenge æ”¶é›†å™¨\n\n`Parallel Scavenge`æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¹¶è¡Œçš„å¤šçº¿ç¨‹`æ–°ç”Ÿä»£æ”¶é›†å™¨`ï¼Œå®ƒä¹Ÿä½¿ç”¨`å¤åˆ¶ç®—æ³•`ã€‚Parallel Scavengeæ”¶é›†å™¨çš„ç‰¹ç‚¹æ˜¯å®ƒçš„å…³æ³¨ç‚¹ä¸å…¶ä»–æ”¶é›†å™¨ä¸åŒï¼ŒCMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚\n\n> **ååé‡**ï¼šCPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å’ŒCPUæ¶ˆè€—çš„æ€»æ—¶é—´ï¼ˆCPUæ‰§è¡Œæ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰çš„æ¯”å€¼\n>\n> **å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹**ï¼šå•çº¿ç¨‹æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œå¤šçº¿ç¨‹ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼›\n>\n> **å¹¶è¡Œï¼ˆParallelï¼‰**ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å’Œç”¨æˆ·çº¿ç¨‹æ˜¯ä¸²è¡Œçš„ã€‚\n>\n> **å¹¶å‘ï¼ˆConcurrentï¼‰**ï¼šå¹¶å‘æŒ‡çš„æ˜¯åƒåœ¾æ”¶é›†å™¨å’Œç”¨æˆ·ç¨‹åºåŒæ—¶æ‰§è¡Œã€‚é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä»¥å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚\n\n`åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åº`ï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚è€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨`åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡`ã€‚\n\n`Parallel Scavenge`  æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºè¾ƒç²¾ç¡®æ§åˆ¶ååé‡\n\n- `-XX:MaxGCPauseMills` æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´\n\n- `-XX:GCTimeRatio` ç›´æ¥è®¾ç½®ååé‡å¤§å°\n\nç¼©çŸ­åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´æ¥æ¢å–çš„ï¼šæ–°ç”Ÿä»£ç©ºé—´å˜å°ï¼Œåƒåœ¾å›æ”¶å˜å¾—é¢‘ç¹ï¼Œå¯¼è‡´ååé‡ä¸‹é™ã€‚\n\nParallel Scavengeæ”¶é›†å™¨é™¤äº†ä¼šæ˜¾è€Œæ˜“è§åœ°æä¾›å¯ä»¥ç²¾ç¡®æ§åˆ¶ååé‡çš„å‚æ•°ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå‚æ•°`-XX:+UseAdaptiveSizePolicy`ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œæ‰“å¼€å‚æ•°åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenå’ŒSurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º`GCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰`ã€‚è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯Parallel Scavengeæ”¶é›†å™¨ä¸ParNewæ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦åŒºåˆ«\n\nå¦å¤–å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒParallel Scavengeæ”¶é›†å™¨`æ— æ³•ä¸CMSæ”¶é›†å™¨é…åˆä½¿ç”¨`ï¼Œæ‰€ä»¥åœ¨JDK 1.6æ¨å‡ºParallel Oldä¹‹å‰ï¼Œå¦‚æœæ–°ç”Ÿä»£é€‰æ‹©Parallel Scavengeæ”¶é›†å™¨ï¼Œè€å¹´ä»£åªæœ‰Serial Oldæ”¶é›†å™¨èƒ½ä¸ä¹‹é…åˆä½¿ç”¨ã€‚\n\n#### Serial Oldæ”¶é›†å™¨\n\nSerialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼ŒåŒæ ·æ˜¯å•çº¿ç¨‹ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•\n\n![mark](http://static.imlgw.top/blog/20190813/y1H9NyikWogV.png?imageslim)\n\nè¿™ä¸ªæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰æ˜¯ç»™ Client åœºæ™¯ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœç”¨åœ¨ Server åœºæ™¯ä¸‹ï¼Œå®ƒæœ‰ä¸¤å¤§ç”¨é€”ï¼š\n\n- åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚\n- ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ `Concurrent Mode Failure` æ—¶ä½¿ç”¨ï¼ˆä¸‹é¢ä¼šä»‹ç»ï¼‰ã€‚\n\n#### Parallel Oldæ”¶é›†å™¨\n\næ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚\n\n![mark](http://static.imlgw.top/blog/20190813/itz21ThRoKAD.png?imageslim)\n\nåœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨\n\n#### CMSæ”¶é›†å™¨ï¼ˆConcurrent Mark Sweepï¼‰\n\nå¹¶å‘çš„è€å¹´ä»£æ”¶é›†å™¨ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼Œå®ƒçš„è¿ä½œç›¸å¯¹å‰é¢å‡ ç§æ¥è¯´è¦æ›´åŠ å¤æ‚ä¸€äº›ï¼Œæ•´ä½“åˆ†ä¸º4å“¥æ­¥éª¤\n\n- **åˆå§‹æ ‡è®°**ï¼šä»…ä»…æ˜¯æ ‡è®°ä¸€ä¸‹GC Rootèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦åœé¡¿\n- **å¹¶å‘æ ‡è®°**ï¼šè¿›è¡ŒGC Root Tracingçš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œä¸éœ€è¦åœé¡¿ï¼Œ\n- **é‡æ–°æ ‡è®°**ï¼šä¸ºäº†`ä¿®æ­£`å¹¶å‘æ ‡è®°é˜¶æ®µç¨‹åºç»§ç»­è¿è¡Œå¯¼è‡´æ ‡è®°å˜åŒ–çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿\n- **å¹¶å‘æ¸…é™¤**ï¼šä¸éœ€è¦åœé¡¿\n\nåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„`å¹¶å‘æ ‡è®°`å’Œ`å¹¶å‘æ¸…é™¤`è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦è¿›è¡Œåœé¡¿ã€‚\n\n![mark](http://static.imlgw.top/blog/20190813/zJiEhyXRjfTO.png?imageslim)\n\n**ç¼ºç‚¹**\n\n- å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ å…¶å®ï¼Œé¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹CPUèµ„æºæ¯”è¾ƒæ•æ„Ÿã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆæˆ–è€…è¯´CPUèµ„æºï¼‰è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ï¼ˆCPUæ•°é‡+3ï¼‰/4ï¼Œä¹Ÿå°±æ˜¯å½“CPUåœ¨4ä¸ªä»¥ä¸Šæ—¶ï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸å°‘äº25%çš„CPUèµ„æºï¼Œå¹¶ä¸”éšç€CPUæ•°é‡çš„å¢åŠ è€Œä¸‹é™ã€‚ä½†æ˜¯å½“CPUä¸è¶³4ä¸ªæ—¶ï¼ˆæ¯”å¦‚2ä¸ªï¼‰ï¼ŒCMSå¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ï¼Œå¦‚æœæœ¬æ¥CPUè´Ÿè½½å°±æ¯”è¾ƒå¤§ï¼Œè¿˜è¦åˆ†å‡ºä¸€åŠçš„è¿ç®—èƒ½åŠ›å»æ‰§è¡Œæ”¶é›†å™¨çº¿ç¨‹ï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦å¿½ç„¶é™ä½äº†50%ï¼Œå…¶å®ä¹Ÿè®©äººæ— æ³•æ¥å—ï¼Œåé¢å‡ºç°äº†`i-CMS`è®©GCçº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹äº¤æ›¿è¿è¡Œï¼Œä½†æ˜¯è¡¨ç°å¾ˆä¸€èˆ¬å·²è¢«å¼ƒç”¨ã€‚\n\n- æ— æ³•å¤„ç†`æµ®åŠ¨åƒåœ¾`ï¼Œå¯èƒ½å‡ºç° `Concurrent Mode Failure`ã€‚æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ã€‚å¦‚æœé¢„ç•™çš„å†…å­˜ä¸å¤Ÿç”¨æˆ·çº¿ç¨‹è¿è¡Œï¼Œå°±ä¼šå‡ºç° `Concurrent Mode Failure`ï¼Œjdk1.6ä¹‹åè™šæ‹Ÿæœºä¼šä¸´æ—¶å¯ç”¨ Serial Old æ¥æ›¿ä»£ CMSã€‚\n\n- æ ‡è®°-æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œè¿™æ„å‘³ç€æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘`Full GC`\n\n#### G1æ”¶é›†å™¨\n\nG1ï¼ˆGarbage-Firstï¼‰ï¼Œå®ƒæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨å¤š CPU å’Œå¤§å†…å­˜çš„åœºæ™¯ä¸‹æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚HotSpot å¼€å‘å›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯æœªæ¥å¯ä»¥æ›¿æ¢æ‰ CMS æ”¶é›†å™¨ã€‚\n\nå †è¢«åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå…¶å®ƒæ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€å¹´ä»£ï¼Œè€Œ G1 å¯ä»¥ç›´æ¥å¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸€èµ·å›æ”¶ã€‚\n\n![mark](http://static.imlgw.top/blog/20190814/o8sxTPY30GnJ.png?imageslim)\n\nG1 æŠŠå †åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†ç‰©ç†éš”ç¦»ã€‚\n\n![mark](http://static.imlgw.top/blog/20190814/3olH4WWVEysA.png?imageslim)\n\né€šè¿‡å¼•å…¥ Region çš„æ¦‚å¿µï¼Œä»è€Œå°†åŸæ¥çš„ä¸€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™ç§åˆ’åˆ†æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª Region åƒåœ¾å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡å»å›æ”¶çš„ç»éªŒè·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ª`ä¼˜å…ˆåˆ—è¡¨`ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚\n\nä½†æ˜¯å³ä½¿æ˜¯è¿™æ ·åˆ†äº†Regionåƒåœ¾å›æ”¶å™¨å°±ä¸€å®šä¼šä»¥Regionä¸ºå•ä½åˆ†é…ä¹ˆï¼Ÿæ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼ŒRegionä¸å¯èƒ½å®Œå…¨ç‹¬ç«‹ï¼Œä¸€ä¸ªå¯¹è±¡åˆ†é…åœ¨Regionä¸­å¹¶ä¸æ˜¯åªèƒ½è¢«å½“å‰Regionéƒ¨åˆ†å¼•ç”¨ï¼Œè€Œæ˜¯å¯ä»¥ä¸æ•´ä¸ªJavaå †çš„ä»»æ„å¯¹è±¡å‘ç”Ÿå¼•ç”¨å…³ç³»ï¼Œè¿™æ ·åœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å²‚ä¸æ˜¯ä»ç„¶éœ€è¦éå†æ•´ä¸ªå †? è¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯åªåœ¨G1ä¸­å­˜åœ¨ï¼Œå…¶ä»–æ”¶é›†å™¨ä¹Ÿä¼šå­˜åœ¨ï¼Œåªæ˜¯G1è¿™æ ·åˆ’åˆ†ä¹‹åé—®é¢˜æ›´åŠ çªå‡ºäº†ï¼Œåœ¨`G1æ”¶é›†å™¨`ä¸­æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ª Remembered Setï¼Œç”¨æ¥è®°å½•è¯¥ Region å¯¹è±¡`çš„å¼•ç”¨å¯¹è±¡`æ‰€åœ¨çš„ Regionã€‚é€šè¿‡ä½¿ç”¨ Remembered Setï¼Œåœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚\n\nå¦‚æœä¸è®¡ç®—ç»´æŠ¤Remembered Setçš„æ“ä½œï¼ŒG1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n\n- **åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰** ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNest Top Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ä»¥çš„Regionä¸­åˆ›å»ºå¯¹è±¡ï¼Œæ­¤é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚\n- **å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰** ä»GC Root å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾åˆ°å­˜æ´»å¯¹è±¡ï¼Œæ­¤é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚\n- **æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰** ä¸ºäº†ä¿®æ­£åœ¨`å¹¶å‘æ ‡è®°æœŸé—´`å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„Remembered Set Logsé‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠRemembered Set Logsçš„æ•°æ®åˆå¹¶åˆ°Remembered Setä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦`åœé¡¿çº¿ç¨‹`ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚\n- **ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰** é¦–å…ˆå¯¹å„ä¸ªRegionä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„GC åœé¡¿æ˜¯æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œ`ä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„`ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚\n\n**ç‰¹ç‚¹**\n\n- **å¹¶è¡Œä¸å¹¶å‘** G1 èƒ½å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUæ¥ç¼©çŸ­â€œStop The Worldâ€åœé¡¿æ—¶é—´ï¼Œéƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©Javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚\n- **åˆ†ä»£æ”¶é›†** ä¸å…¶ä»–æ”¶é›†å™¨ä¸€æ ·ï¼Œåˆ†ä»£æ¦‚å¿µåœ¨G1ä¸­ä¾ç„¶å¾—ä»¥ä¿ç•™ã€‚è™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†å®ƒèƒ½å¤Ÿé‡‡ç”¨ä¸åŒæ–¹å¼å»å¤„ç†æ–°åˆ›å»ºçš„å¯¹è±¡å’Œå·²å­˜æ´»ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡GCçš„æ—§å¯¹è±¡æ¥è·å–æ›´å¥½çš„æ”¶é›†æ•ˆæœã€‚\n- **ç©ºé—´æ•´åˆ** G1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº`â€œæ ‡è®°-æ•´ç†â€`ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäº**â€œå¤åˆ¶â€**ç®—æ³•å®ç°çš„ã€‚è¿™æ„å‘³ç€G1è¿è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ï¼Œæ”¶é›†åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚æ­¤ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCã€‚\n- **å¯é¢„æµ‹çš„åœé¡¿** è¿™æ˜¯G1ç›¸å¯¹CMSçš„ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1é™¤äº†é™ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨GCä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ï¼Œè¿™å‡ ä¹å·²ç»æ˜¯å®æ—¶Javaï¼ˆRTSJï¼‰çš„åƒåœ¾æ”¶é›†å™¨çš„ç‰¹å¾äº†ã€‚\n\n#### ç†è§£GCæ—¥å¿—\n\nGC(Garbage Collection)æ˜¯Javaè™šæ‹Ÿæœºä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éƒ½éœ€è¦æŸ¥çœ‹å®ƒçš„æ—¥å¿—ï¼Œä¸‹é¢å†…å®¹å°±æ˜¯ä»‹ç»å¦‚ä½•æŸ¥çœ‹GCæ—¥å¿—ã€‚\n\nå¯é€‰å‚æ•°\n\n```java\n-XX:+PrintGC è¾“å‡ºGCæ—¥å¿—\n-XX:+PrintGCDetails è¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—\n-XX:+PrintGCTimeStamps è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰\n-XX:+PrintGCDateStamps è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ 2013-05-04T21:53:59.234+0800ï¼‰\n-XX:+PrintHeapAtGC åœ¨è¿›è¡ŒGCçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯\n-Xloggc:../logs/gc.log æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„\n```\n\n**æµ‹è¯•ç±»**\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/8/15 17:16\n */\npublic class GCTest {\n    \n    /**\n     * vmå‚æ•° ï¼š-XX:+PrintGCDetails è¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—\n     */\n    private byte[] data =new byte[1024*1024*10]; //10M\n\n    public static void main(String[] args) {\n        GCTest gcTest = new GCTest();\n        gcTest=null; //for gc\n        System.gc();\n        System.out.println(\"GC Test\");\n    }\n}\n```\n\n**æ§åˆ¶å°æ‰“å°ç»“æœ**\n\n```java\n[GC (System.gc()) [PSYoungGen: 12902K->712K(38400K)] 12902K->720K(125952K), 0.3622244 secs] [Times: user=0.00 sys=0.00, real=0.36 secs] \n[Full GC (System.gc()) [PSYoungGen: 712K->0K(38400K)] [ParOldGen: 8K->638K(87552K)] 720K->638K(125952K), [Metaspace: 3438K->3438K(1056768K)], 0.0103044 secs] [Times: user=0.00 sys=0.00, real=0.02 secs] \nGC Test\nHeap\n PSYoungGen      total 38400K, used 998K [0x00000000d5e00000, 0x00000000d8880000, 0x0000000100000000)\n  eden space 33280K, 3% used [0x00000000d5e00000,0x00000000d5ef9b20,0x00000000d7e80000)\n  from space 5120K, 0% used [0x00000000d7e80000,0x00000000d7e80000,0x00000000d8380000)\n  to   space 5120K, 0% used [0x00000000d8380000,0x00000000d8380000,0x00000000d8880000)\n ParOldGen       total 87552K, used 638K [0x0000000081a00000, 0x0000000086f80000, 0x00000000d5e00000)\n  object space 87552K, 0% used [0x0000000081a00000,0x0000000081a9fb68,0x0000000086f80000)\n Metaspace       used 3446K, capacity 4496K, committed 4864K, reserved 1056768K\n  class space    used 376K, capacity 388K, committed 512K, reserved 1048576K\n  \nProcess finished with exit code 0\n```\n\n`PSYoungGen` çœ‹è§è¿™ä¸ªå…¶å®å°±çŒœçš„åˆ°äº†ï¼ŒParallel Scavengeæ”¶é›†å™¨æ”¶é›†çš„æ–°ç”Ÿä»£ï¼Œä»£è¡¨GCçš„åŒºåŸŸå’Œæ”¶é›†å™¨ã€‚ä¸‹é¢çš„`ParOldGen`å¯¹åº”çš„å°±æ˜¯Parallel Oldçš„è€å¹´ä»£ ï¼ŒPSYoungGenåé¢ç´§è·Ÿçš„ `12902K->712K(38400K)` åˆ™ä»£è¡¨ `GCå‰è¯¥åŒºåŸŸå·²ç»ä½¿ç”¨çš„å®¹é‡ -> GCåè¯¥åŒºåŸŸå·²ä½¿ç”¨çš„å®¹é‡ï¼ˆè¯¥åŒºåŸŸæ€»å®¹é‡ï¼‰`  ï¼Œè€Œæ–¹æ‹¬å·å¤–é¢çš„éƒ¨åˆ†åˆ™ä»£è¡¨ `GCå‰Javaå †å·²ä½¿ç”¨é‡ -> GCåJavaå †å·²ä½¿ç”¨é‡ï¼ˆJavaå †ä¸­å®¹é‡ï¼‰` ã€‚\n\n### å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥\n\n- **Minor GC**ï¼šå›æ”¶æ–°ç”Ÿä»£ï¼Œå› ä¸ºæ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ Minor GC ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰§è¡Œçš„é€Ÿåº¦ä¸€èˆ¬ä¹Ÿä¼šæ¯”è¾ƒå¿«ã€‚\n- **Full GC**ï¼šå›æ”¶è€å¹´ä»£å’Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å¯¹è±¡å…¶å­˜æ´»æ—¶é—´é•¿ï¼Œå› æ­¤ Full GC å¾ˆå°‘æ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦ä¼šæ¯” Minor GC æ…¢å¾ˆå¤šï¼Œå‡ºç°Full GCé€šå¸¸ä¼šä¼´éšç€Minor GCï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šæœ‰æ—¶å€™ä¹Ÿä¼šç›´æ¥è¿›è¡ŒFull GCã€‚\n\nå¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œå¾€å¤§çš„æ–¹å‘è®²å°±æ˜¯åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼ˆä¹Ÿæœ‰å¯èƒ½è¢«JITæ‹†æ•£å¹¶é—´æ¥çš„åœ¨æ ˆä¸Šåˆ†é…ï¼‰ï¼Œå¯¹è±¡ä¸»è¦åˆ†é…åœ¨æ–°ç”Ÿä»£çš„`Eden` åŒºä¸Šï¼Œå¦‚æœå¯åŠ¨äº†`æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²`ï¼ˆTLABï¼‰ ä¼šä¼˜å…ˆåœ¨TLABä¸Šåˆ†é…ï¼Œå°‘æ•°æƒ…å†µä¹Ÿä¼šç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­ï¼Œåˆ†é…çš„è§„åˆ™ä¸æ˜¯ç¡®å®šçš„ï¼Œå–å†³äºåƒåœ¾æ”¶é›†å™¨çš„ç»„åˆä»¥åŠè™šæ‹Ÿæœºç›¸å…³çš„å‚æ•°çš„è®¾ç½®ã€‚\n\n> -Xms  åˆå§‹Heapå¤§å°\n>\n> -Xmx  java heapæœ€å¤§å€¼ \n>\n> -Xmn  Young generationçš„heapå¤§å°\n\n#### å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨Edenä¸Š\n\nå¤§å¤šæ•°æƒ…å†µï¼Œå¯¹è±¡ä¼šç›´æ¥åœ¨æ–°ç”Ÿä»£Edenä¸Šåˆ†é…ã€‚å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿçš„åŒºåŸŸè¿›è¡Œåˆ†é…çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºå°†ä¼šå‘èµ·ä¸€æ¬¡`Minor GC` ã€‚\n\nä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¥æ„Ÿå—ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/8/15 17:16\n */\npublic class GCTest {\n    private static int _1M= 1024*1024; //1m\n\n    /*\n        -XX:+PrintGCDetails\n        -verbose:gc\n        -Xms20M é™åˆ¶Javaå †å¤§å°20Mä¸å¯æ‰©å±•\n        -Xmx20M\n        -Xmn10M 10Måˆ†é…ç»™æ–°ç”Ÿä»£\n        -XX:SurvivorRatio=8\n    */\n    public static void main(String[] args) throws InterruptedException {\n        byte[] alloc1,alloc2,alloc3,alloc4;\n        alloc1=new byte[2*_1M];\n        alloc2=new byte[2*_1M];\n        alloc3=new byte[2*_1M];\n        System.out.println(\"GC Test\"); //å‘ç”ŸGC\n        alloc4=new byte[3*_1M];\n    }\n}\n\n```\n\n**æ§åˆ¶å°æ‰“å°**\n\n```java\nGC Test\n[GC (Allocation Failure) [PSYoungGen: 8002K->696K(9216K)] 8002K->6840K(19456K), 0.0028974 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] \n[Full GC (Ergonomics) [PSYoungGen: 696K->0K(9216K)] [ParOldGen: 6144K->6783K(10240K)] 6840K->6783K(19456K), [Metaspace: 3439K->3439K(1056768K)], 0.0042088 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] \nHeap\n PSYoungGen      total 9216K, used 3154K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)\n  eden space 8192K, 38% used [0x00000000ff600000,0x00000000ff914930,0x00000000ffe00000)\n  from space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)\n  to   space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)\n ParOldGen       total 10240K, used 6783K [0x00000000fec00000, 0x00000000ff600000, 0x00000000ff600000)\n  object space 10240K, 66% used [0x00000000fec00000,0x00000000ff29fc88,0x00000000ff600000)\n Metaspace       used 3446K, capacity 4496K, committed 4864K, reserved 1056768K\n  class space    used 376K, capacity 388K, committed 512K, reserved 1048576K\n\nProcess finished with exit code 0\n\n```\n\nåœ¨`alloc4`çš„æ—¶å€™ å‘ç°ç©ºé—´å·²ç»ä¸è¶³ä»¥è£…ä¸‹äº†ï¼Œæ‰€ä»¥è¿›è¡Œäº†ä¸€æ¬¡Minor GCï¼ŒéšåGCæ‰äº†YoungGenå¤§æ¦‚6Mçš„ç©ºé—´ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡å¤§äº`from` å’Œ`to` ä¸¤å—`Survivor` åŒºåŸŸæ— æ³•ç›´æ¥å­˜å…¥æ‰€ä»¥é€šè¿‡åˆ†é…æ‹…ä¿è¿›å…¥è€å¹´ä»£ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åé¢è€å¹´ä»£66%çš„å ç”¨å­˜æ”¾çš„å°±æ˜¯è¿™å‡ ä¸ªå¯¹è±¡ã€‚GCç»“æŸåï¼Œ`alloc4` ä¹Ÿé¡ºåˆ©çš„è¿›å…¥çš„`Eden` \n\n#### å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£\n\næ‰€è°“çš„å¤§å¯¹è±¡å…¶å®å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œæœ€å…¸å‹çš„å°±æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢ä»£ç ä¸­çš„byteæ•°ç»„ï¼Œç»å¸¸å‡ºç°å¤§å¯¹è±¡å®¹æ˜“å¯¼è‡´å†…å­˜è¿˜æœ‰ä¸å°‘ç©ºé—´å°±æå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´æ¥â€œå®‰ç½®â€è¿™äº›å¤§å¯¹è±¡ï¼Œæ‰€ä»¥åº”è¯¥é¿å…äº§ç”Ÿâ€œæœç”Ÿå¤•æ­»â€çš„çŸ­å‘½å¤§å¯¹è±¡ã€‚\n\nè™šæ‹Ÿæœºæä¾›äº†ä¸€ä¸ª  `-XX: PretenureSizeThreshold`å‚æ•°ï¼Œä»¤å¤§äºè¿™ä¸ªè®¾ç½®å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼ˆåªå¯¹Serialå’ŒParNewä¸¤æ¬¾æ”¶é›†å™¨æœ‰æ•ˆï¼ŒParallelä¸€èˆ¬ä¸ç”¨è®¾ç½®ï¼‰ã€‚\n\n```java\npublic class GCTest {\n    private static int _1M= 1024*1024; //1m\n\n    /*\n        -XX:+PrintGCDetails\n        -verbose:gc\n        -Xms20M é™åˆ¶Javaå †å¤§å°20Mä¸å¯æ‰©å±•\n        -Xmx20M\n        -Xmn10M 10Måˆ†é…ç»™æ–°ç”Ÿä»£\n        -XX:SurvivorRatio=8\n    */\n    public static void main(String[] args) throws InterruptedException {\n        byte[] alloc1,alloc2,alloc3,alloc4;\n        alloc1=new byte[9*_1M];\n        System.out.println(\"GC Test\");\n    }\n}\n```\n\n**æ§åˆ¶å°æ‰“å°**\n\n```java\nGC Test\nHeap\n PSYoungGen      total 9216K, used 2022K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)\n  eden space 8192K, 24% used [0x00000000ff600000,0x00000000ff7f9990,0x00000000ffe00000)\n  from space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)\n  to   space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)\n ParOldGen       total 10240K, used 9216K [0x00000000fec00000, 0x00000000ff600000, 0x00000000ff600000)\n  object space 10240K, 90% used [0x00000000fec00000,0x00000000ff500010,0x00000000ff600000)\n Metaspace       used 3447K, capacity 4496K, committed 4864K, reserved 1056768K\n  class space    used 376K, capacity 388K, committed 512K, reserved 1048576K\n\nProcess finished with exit code 0\n\n```\n\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯¹è±¡å‡ ä¹å…¨éƒ¨è¢«æ”¾åˆ°äº†è€å¹´ä»£é‡Œé¢ï¼Œè€å¹´ä»£å ç”¨ç‡ 90%\n\n#### é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£\n\nè™šæ‹Ÿæœºä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ Ageï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»å¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¯¹è±¡åœ¨SurvivoråŒºåŸŸæ¯ç†¬è¿‡ä¸€æ¬¡ Minor GCå¹´é¾„å°±å¢åŠ ä¸€å²ï¼Œå½“ä»–çš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º15å²ï¼‰ï¼Œå°±ä¼šå°†å®ƒç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ï¼ˆå¾ˆå½¢è±¡æœ‰æ²¡æœ‰ ğŸ˜ï¼‰\n`-XX:MaxTenuringThreshold` ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚\n\n#### åŠ¨æ€å¹´é¾„åˆ¤å®š\n\nè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨ `Survivor` ä¸­`ç›¸åŒå¹´é¾„`æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº `Survivor ç©ºé—´çš„ä¸€åŠ`ï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€ç­‰åˆ°MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„\n\n#### ç©ºé—´åˆ†é…æ‹…ä¿\n\nåœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„`è¿ç»­ç©ºé—´`æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ã€‚\nå¦‚æœä¸æˆç«‹çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure çš„å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£\næœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦`å¤§äº`å†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„`å¹³å‡å¤§å°`ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ Minor GCï¼›å¦‚æœå°äºï¼Œæˆ–è€… HandlePromotionFailure çš„å€¼ä¸å…è®¸å†’é™©ï¼Œé‚£ä¹ˆå°±è¦è¿›è¡Œä¸€æ¬¡ Full GCï¼Œå¦‚æœå‡ºç°äº†æ‹…ä¿å¤±è´¥ï¼Œé‚£å°±åªå¥½å‘èµ·ä¸€æ¬¡`Full GC`  ï¼Œç»•çš„åœˆå­æ˜¯æœ€å¤§çš„ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå¼€å…³è¿˜æ˜¯é»˜è®¤æ‰“å¼€çš„ï¼Œé¿å…äº§ç”Ÿå¤ªå¤šçš„Full GCï¼ŒJDK1.6ä¹‹åè¿™ä¸ªå‚æ•°å°±è¢«åºŸæ‰äº†ï¼Œ`åªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£æ€»ç©ºé—´æˆ–è€…æ¯æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°å°±è¿›è¡ŒMinor GCå¦åˆ™è¿›è¡ŒFull GC`\n\n#### Full GCè§¦å‘æ¡ä»¶\n\nå¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden ç©ºé—´å¿«æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GCã€‚è€Œ Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æƒ…å†µï¼š\n\n**_è°ƒç”¨ System.gc()_**\nåªæ˜¯å»ºè®®è™šæ‹Ÿæœºæ‰§è¡Œ Full GCï¼Œä½†æ˜¯è™šæ‹Ÿæœºä¸ä¸€å®šçœŸæ­£å»æ‰§è¡Œã€‚ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯è®©è™šæ‹Ÿæœºç®¡ç†å†…å­˜ã€‚\n\n**_è€å¹´ä»£ç©ºé—´ä¸è¶³_**\nè€å¹´ä»£ç©ºé—´ä¸è¶³çš„å¸¸è§åœºæ™¯ä¸ºå‰æ–‡æ‰€è®²çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ç­‰ã€‚\nä¸ºäº†é¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œåº”å½“å°½é‡ä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡ä»¥åŠæ•°ç»„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€šè¿‡ -Xmn è™šæ‹Ÿæœºå‚æ•°\nè°ƒå¤§æ–°ç”Ÿä»£çš„å¤§å°ï¼Œè®©å¯¹è±¡å°½é‡åœ¨æ–°ç”Ÿä»£è¢«å›æ”¶æ‰ï¼Œä¸è¿›å…¥è€å¹´ä»£ã€‚è¿˜å¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold è°ƒå¤§å¯¹\nè±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œè®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´ã€‚\n\n**_ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥_**\nä½¿ç”¨å¤åˆ¶ç®—æ³•çš„ Minor GC éœ€è¦è€å¹´ä»£çš„å†…å­˜ç©ºé—´ä½œæ‹…ä¿ï¼Œå¦‚æœæ‹…ä¿å¤±è´¥ä¼šæ‰§è¡Œä¸€æ¬¡ Full GCã€‚\n\n**_JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³_**\nåœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºæ˜¯ç”¨æ°¸ä¹…ä»£å®ç°çš„ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„ä¸ºä¸€äº› Class çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®\nå½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨ CMS GC çš„æƒ…å†µä¸‹ä¹Ÿ\nä¼šæ‰§è¡Œ Full GCã€‚å¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŠ›å‡º java.lang.OutOfMemoryErrorã€‚\nä¸ºé¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§æ°¸ä¹…ä»£ç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨ CMS GCã€‚\n\n**_Concurrent Mode Failure_**\næ‰§è¡Œ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼ˆå¯èƒ½æ˜¯ GC è¿‡ç¨‹ä¸­æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸è¶³ï¼‰ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘ Full GCã€‚\n\n## å‚è€ƒ\n\n**å‘¨å¿—æ˜ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹**\n\n[CYCå¤§ä½¬çš„åšå®¢ğŸ™](https://cyc2018.github.io/CS-Notes/#/notes/Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA?id=minor-gc-%e5%92%8c-full-gc)","tags":["JVM"],"categories":["JVM"]},{"title":"è‡ªæ—‹é”ï¼ŒCLHé”ï¼ŒMCSé”","url":"/2019/08/10/zi-xuan-suo-clh-suo-mcs-suo/","content":"\n- [è‡ªæ—‹é”](#è‡ªæ—‹é”)\n  - [ç®€å•è‡ªæ—‹é”](#ç®€å•è‡ªæ—‹é”)\n  - [Ticket Lock](#ticket-lock)\n- [CLHé”](#clhé”)\n- [MCSé”](#mcsé”)\n- [æ€»ç»“](#æ€»ç»“)\n- [å‚è€ƒ](#å‚è€ƒ)\n\n## è‡ªæ—‹é”\n\nè‡ªæ—‹é”(spin lock)æ˜¯ä¸€ä¸ªå…¸å‹çš„å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥æ‰‹æ®µï¼Œè‡ªæ—‹é”æ˜¯åŸºäºCASåŸè¯­çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯è½»é‡çº§çš„åŒæ­¥æ“ä½œï¼Œå®ƒçš„åç§°æ¥æºäºå®ƒçš„ç‰¹æ€§ã€‚è‡ªæ—‹é”æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœè¯¥é”å·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œå°±ä¸€ç›´å¾ªç¯æ£€æµ‹é”æ˜¯å¦è¢«é‡Šæ”¾ï¼Œè€Œä¸æ˜¯è¿›å…¥çº¿ç¨‹æŒ‚èµ·æˆ–ç¡çœ çŠ¶æ€ã€‚ç”±äºè‡ªæ—‹é”åªä¸è¿›è¡Œçº¿ç¨‹çŠ¶æ€çš„æ”¹å˜ï¼ˆæŒ‚èµ·çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥å½“çº¿ç¨‹ç«äº‰ä¸æ¿€çƒˆæ—¶ï¼Œå®ƒçš„å“åº”é€Ÿåº¦æå¿«ï¼ˆå› ä¸º`é¿å…äº†çº¿ç¨‹è°ƒåº¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢`ï¼‰ã€‚è‡ªæ—‹é”é€‚ç”¨äºé”ä¿æŠ¤çš„ä¸´ç•ŒåŒºå¾ˆå°çš„æƒ…å†µï¼Œçº¿ç¨‹ç«äº‰ä¸æ¿€çƒˆçš„åœºæ™¯ä¸‹ã€‚å¦‚æœçº¿ç¨‹ä¹‹é—´ç«äº‰æ¿€çƒˆæˆ–è€…ä¸´ç•ŒåŒºçš„æ“ä½œç‰¹åˆ«è€—æ—¶ï¼Œé‚£ä¹ˆçº¿ç¨‹çš„è‡ªæ—‹æ“ä½œå°±ä¼šè€—è´¹å¤§é‡çš„cpuèµ„æºï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æ€§èƒ½å°±ä¼šä¸‹é™æ˜æ˜¾ã€‚\n\n###  ç®€å•è‡ªæ—‹é”\n\n```java\npublic class SimpleSpinLock {\n    private AtomicReference<Thread> owner = new AtomicReference<Thread>();\n\n    public void lock() {\n        Thread currentThread = Thread.currentThread();\n        // å¦‚æœé”æœªè¢«å ç”¨ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºé”çš„æ‹¥æœ‰è€…\n        // åé¢è§£é”çš„å°±åªèƒ½æ˜¯å½“å‰çº¿ç¨‹\n        while (!owner.compareAndSet(null, currentThread)) {\n        }\n    }\n\n    public void unlock() {\n        Thread currentThread = Thread.currentThread();\n        // åªæœ‰é”çš„æ‹¥æœ‰è€…æ‰èƒ½é‡Šæ”¾é”\n        owner.compareAndSet(currentThread, null);\n    }\n}\n```\n\n**ç¼ºç‚¹**\n\n- CASæ“ä½œéœ€è¦ç¡¬ä»¶çš„é…åˆï¼ˆç°ä»£å¤„ç†å™¨å¤§å¤šéƒ½æ”¯æŒï¼‰\n\n- ä¿è¯å„ä¸ªCPUçš„ç¼“å­˜ï¼ˆL1ã€L2ã€L3ã€è·¨CPU Socketã€ä¸»å­˜ï¼‰çš„æ•°æ®ä¸€è‡´æ€§ï¼Œé€šè®¯å¼€é”€å¾ˆå¤§ï¼Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šæ›´ä¸¥é‡ï¼ˆè¿™æ˜¯ç”±äºAtomicçš„volatileå˜é‡å¯¼è‡´çš„ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯å¿…é¡»çš„ï¼‰\n\n- æ²¡æ³•ä¿è¯å…¬å¹³æ€§ï¼Œä¸ä¿è¯ç­‰å¾…è¿›ç¨‹/çº¿ç¨‹æŒ‰ç…§FIFOé¡ºåºè·å¾—é”ã€‚\n\n### Ticket Lock\n\n```java\npublic class TicketLock {\n    private AtomicInteger serviceNum = new AtomicInteger(); // æœåŠ¡å·\n    private AtomicInteger ticketNum = new AtomicInteger(); // æ’é˜Ÿå·\n\n    public int lock() {\n        // é¦–å…ˆåŸå­æ€§åœ°è·å¾—ä¸€ä¸ªæ’é˜Ÿå·\n        int myTicketNum = ticketNum.getAndIncrement();\n\n        // åªè¦å½“å‰æœåŠ¡å·ä¸æ˜¯è‡ªå·±çš„å°±ä¸æ–­è½®è¯¢\n        while (serviceNum.get() != myTicketNum) {\n        }\n        return myTicketNum;\n    }\n\n    public void unlock(int myTicket) {\n        // è§£é”ååªæœ‰æ‹¥æœ‰è¯¥çº¿ç¨‹çš„ä¸‹ä¸€ä¸ªæ’é˜Ÿå·çº¿ç¨‹æ‰èƒ½åŠ é”,ä¿è¯äº†å…¬å¹³æ€§,ä¸ä¼šæœ‰æ’é˜Ÿçš„æƒ…å†µ\n        int next = myTicket + 1;\n        // åªæœ‰å½“å‰çº¿ç¨‹æ‹¥æœ‰è€…æ‰èƒ½é‡Šæ”¾é”\n        serviceNum.compareAndSet(myTicket, next);\n    }\n}\n```\n\n**ç¼ºç‚¹**\n\nTicket Lock è™½ç„¶è§£å†³äº†å…¬å¹³æ€§çš„é—®é¢˜ï¼Œä½†æ˜¯å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹å ç”¨çš„å¤„ç†å™¨éƒ½åœ¨è¯»å†™åŒä¸€ä¸ªå˜é‡serviceNum ï¼Œæ¯æ¬¡è¯»å†™æ“ä½œéƒ½å¿…é¡»åœ¨å¤šä¸ªå¤„ç†å™¨ç¼“å­˜ä¹‹é—´è¿›è¡Œç¼“å­˜åŒæ­¥ï¼Œè¿™ä¼šå¯¼è‡´ç¹é‡çš„ç³»ç»Ÿæ€»çº¿å’Œå†…å­˜çš„æµé‡ï¼Œå¤§å¤§é™ä½ç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½ã€‚\n\n## CLHé”\n\nCLHçš„å‘æ˜äººæ˜¯ï¼šCraigï¼ŒLandin and Hagerstenï¼Œä¸‰ä¸ªäººçš„åå­—åˆç§°\n\nCLHé”æ˜¯ä¸€ç§åŸºäºéšå¼é“¾è¡¨ï¼ˆèŠ‚ç‚¹é‡Œé¢æ²¡æœ‰nextæŒ‡é’ˆï¼‰çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ï¼Œç”³è¯·çº¿ç¨‹åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œå®ƒä¸æ–­è½®è¯¢å‰é©±çš„çŠ¶æ€ï¼Œå¦‚æœå‘ç°å‰é©±é‡Šæ”¾äº†é”å°±ç»“æŸè‡ªæ—‹ã€‚\n\n```java\npublic class CLHLock {\n    public static class CLHNode {\n        private volatile boolean isLocked = true; // é»˜è®¤æ˜¯åœ¨ç­‰å¾…é”\n    }\n\n    private volatile CLHNode tail ;\n\n    private static final AtomicReferenceFieldUpdater<CLHLock, CLHNode> UPDATER = AtomicReferenceFieldUpdater\n            . newUpdater(CLHLock.class, CLHNode .class , \"tail\" );\n\n    public void lock(CLHNode currentThreadNode) {\n        //è·å–ä¹‹å‰çš„å°¾ç»“ç‚¹, ç„¶åå°†è‡ªå·±è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹\n        CLHNode preNode = UPDATER.getAndSet( this, currentThreadNode);\n        if(preNode != null) {//å·²æœ‰çº¿ç¨‹å ç”¨äº†é”ï¼Œè¿›å…¥è‡ªæ—‹\n            while(preNode.isLocked ) {\n            }\n        }\n    }\n\n    public void unlock(CLHNode currentThreadNode) {\n        // å¦‚æœé˜Ÿåˆ—é‡Œåªæœ‰å½“å‰çº¿ç¨‹ï¼Œåˆ™é‡Šæ”¾å¯¹å½“å‰çº¿ç¨‹çš„å¼•ç”¨ï¼ˆfor GCï¼‰ã€‚\n        // å°è¯•è®¾ç½®å°¾èŠ‚ç‚¹ä¸ºè‡ªå·±, ä¼ å…¥çš„æœŸæœ›å€¼æ˜¯è‡ªå·±,æˆåŠŸå°±ä»£è¡¨é˜Ÿåˆ—ä¸­åªæœ‰å®ƒä¸€ä¸ª\n        if (!UPDATER.compareAndSet(this, currentThreadNode, null)) {\n            // è¿˜æœ‰åç»­çº¿ç¨‹\n            currentThreadNode.isLocked = false ;// æ”¹å˜çŠ¶æ€ï¼Œè®©åç»­çº¿ç¨‹ç»“æŸè‡ªæ—‹\n        }\n    }\n}\n```\n\nè¿™é‡Œç”¨åˆ°äº†`åŸå­å­—æ®µæ›´æ–°å™¨`ï¼Œè®©tailå˜é‡å¯ä»¥å…·æœ‰CASçš„åŠŸèƒ½ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« [CASä¸åŸå­å˜é‡](http://imlgw.top/2019/04/22/cas-yu-yuan-zi-bian-liang/#%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E5%99%A8)\n\n**ç¼ºç‚¹**\n\nå…ˆè¯´ä¸€ä¸‹`NUMA`å’Œ`SMP`ä¸¤ç§å¤„ç†å™¨ç»“æ„\nSMP(Symmetric Multi-Processor)ï¼Œå³å¯¹ç§°å¤šå¤„ç†å™¨ç»“æ„ï¼ŒæŒ‡æœåŠ¡å™¨ä¸­å¤šä¸ªCPUå¯¹ç§°å·¥ä½œï¼Œæ¯ä¸ªCPUè®¿é—®å†…å­˜åœ°å€æ‰€éœ€æ—¶é—´ç›¸åŒã€‚å…¶ä¸»è¦ç‰¹å¾æ˜¯å…±äº«ï¼ŒåŒ…å«å¯¹CPUï¼Œå†…å­˜ï¼ŒI/Oç­‰è¿›è¡Œå…±äº«ã€‚SMPçš„ä¼˜ç‚¹æ˜¯`èƒ½å¤Ÿä¿è¯å†…å­˜ä¸€è‡´æ€§`ï¼Œç¼ºç‚¹æ˜¯è¿™äº›å…±äº«çš„èµ„æºå¾ˆå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œéšç€CPUæ•°é‡çš„å¢åŠ ï¼Œæ¯ä¸ªCPUéƒ½è¦è®¿é—®ç›¸åŒçš„å†…å­˜èµ„æºï¼Œå¯èƒ½å¯¼è‡´å†…å­˜è®¿é—®å†²çªï¼Œå¯èƒ½ä¼šå¯¼è‡´CPUèµ„æºçš„æµªè´¹ã€‚å¸¸ç”¨çš„PCæœºå°±å±äºè¿™ç§ã€‚\n\nNUMA(Non-Uniform Memory Access)éä¸€è‡´å­˜å‚¨è®¿é—®ï¼Œå°†CPUåˆ†ä¸ºCPUæ¨¡å—ï¼Œæ¯ä¸ªCPUæ¨¡å—ç”±å¤šä¸ªCPUç»„æˆï¼Œå¹¶ä¸”å…·æœ‰ç‹¬ç«‹çš„æœ¬åœ°å†…å­˜ã€I/Oæ§½å£ç­‰ï¼Œæ¨¡å—ä¹‹é—´å¯ä»¥é€šè¿‡äº’è”æ¨¡å—ç›¸äº’è®¿é—®ï¼Œ`è®¿é—®æœ¬åœ°å†…å­˜çš„é€Ÿåº¦å°†è¿œè¿œé«˜äºè®¿é—®è¿œåœ°å†…å­˜(ç³»ç»Ÿå†…å…¶å®ƒèŠ‚ç‚¹çš„å†…å­˜)çš„é€Ÿåº¦`ï¼Œè¿™ä¹Ÿæ˜¯éä¸€è‡´å­˜å‚¨è®¿é—®NUMAçš„ç”±æ¥ã€‚NUMAä¼˜ç‚¹æ˜¯å¯ä»¥è¾ƒå¥½åœ°è§£å†³åŸæ¥SMPç³»ç»Ÿçš„æ‰©å±•é—®é¢˜ï¼Œç¼ºç‚¹æ˜¯ç”±äºè®¿é—®è¿œåœ°å†…å­˜çš„å»¶æ—¶è¿œè¿œè¶…è¿‡æœ¬åœ°å†…å­˜ï¼Œå› æ­¤å½“CPUæ•°é‡å¢åŠ æ—¶ï¼Œç³»ç»Ÿæ€§èƒ½æ— æ³•çº¿æ€§å¢åŠ ã€‚\n\n**CLHé”çš„ç¼ºç‚¹æ˜¯åœ¨NUMAç³»ç»Ÿç»“æ„ä¸‹æ€§èƒ½å¾ˆå·®ï¼Œåœ¨è¿™ç§ç³»ç»Ÿç»“æ„ä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å†…å­˜ï¼Œå¦‚æœå‰è¶‹ç»“ç‚¹çš„å†…å­˜ä½ç½®æ¯”è¾ƒè¿œï¼Œè‡ªæ—‹åˆ¤æ–­å‰è¶‹ç»“ç‚¹çš„lockedåŸŸï¼Œæ€§èƒ½å°†å¤§æ‰“æŠ˜æ‰£ï¼Œåœ¨SMPæ¶æ„ä¸‹èƒ½å¤Ÿä¿è¯å†…å­˜ä¸€è‡´æ€§æ‰€ä»¥è‡ªæ—‹åˆ¤æ–­è¾ƒå¿«**\n\n## MCSé”\n\nMCS Spinlockæ˜¯ä¸€ç§åŸºäºæ˜¾å¼é“¾è¡¨ï¼ˆèŠ‚ç‚¹é‡Œé¢æ‹¥æœ‰nextæŒ‡é’ˆï¼‰çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å…¬å¹³çš„è‡ªæ—‹é”ï¼Œç”³è¯·çº¿ç¨‹åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œç”±ç›´æ¥å‰é©±è´Ÿè´£é€šçŸ¥å…¶ç»“æŸè‡ªæ—‹ï¼ˆä¸CLHè‡ªæ—‹é”ä¸åŒçš„åœ°æ–¹ï¼Œä¸åœ¨è½®è¯¢å‰é©±çš„çŠ¶æ€ï¼Œè€Œæ˜¯ç”±å‰é©±ä¸»åŠ¨é€šçŸ¥ï¼‰ï¼Œä»è€Œæå¤§åœ°å‡å°‘äº†ä¸å¿…è¦çš„å¤„ç†å™¨ç¼“å­˜åŒæ­¥çš„æ¬¡æ•°ï¼Œé™ä½äº†æ€»çº¿å’Œå†…å­˜çš„å¼€é”€ã€‚è€ŒMCSæ˜¯åœ¨è‡ªå·±çš„ç»“ç‚¹çš„lockedåŸŸä¸Šè‡ªæ—‹ç­‰å¾…ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå®ƒè§£å†³äº†CLHåœ¨NUMAç³»ç»Ÿæ¶æ„ä¸­è·å–lockedåŸŸçŠ¶æ€å†…å­˜è¿‡è¿œçš„é—®é¢˜ã€‚\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/8/10 21:49\n */\npublic class MCSLock {\n    public static class MCSNode {\n        //æŒæœ‰åç»§è€…çš„å¼•ç”¨\n        volatile MCSNode next;\n        // é»˜è®¤æ˜¯åœ¨ç­‰å¾…é”\n        volatile boolean block = true;\n    }\n\n    volatile MCSNode tail;// æŒ‡å‘æœ€åä¸€ä¸ªç”³è¯·é”çš„MCSNode\n\n    private static final AtomicReferenceFieldUpdater<MCSLock, MCSNode> UPDATER = AtomicReferenceFieldUpdater\n            .newUpdater(MCSLock.class, MCSNode.class, \"tail\");\n\n    public void lock(MCSNode currentThreadMcsNode) {\n        //æ›´æ–°tailä¸ºæœ€æ–°åŠ å…¥çš„çº¿ç¨‹èŠ‚ç‚¹ï¼Œå¹¶å–å‡ºä¹‹å‰çš„èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å½“å‰èŠ‚ç‚¹çš„å‰é©±ï¼‰\n        MCSNode predecessor = UPDATER.getAndSet(this, currentThreadMcsNode);\n        if (predecessor != null) {\n            //è¿æ¥åœ¨tailçš„å°¾éƒ¨\n            predecessor.next = currentThreadMcsNode;\n            //è½®è¯¢è‡ªå·±çš„isLockedå±æ€§\n            while (currentThreadMcsNode.block) {\n\n            }\n        } else {\n            //å‰é©±èŠ‚ç‚¹ä¸ºç©ºç›´æ¥è·å–é”,è‡ªå·±æ˜¯ç¬¬ä¸€ä¸ª\n            currentThreadMcsNode.block = false;\n        }\n    }\n\n    public void unlock(MCSNode currentThreadMcsNode) {\n        if (currentThreadMcsNode.block) {\n            return;\n        }\n        //åˆ¤æ–­æ˜¯ä¸æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹\n        if (currentThreadMcsNode.next == null) {\n            //CAS å°†tailè®¾ç½®ä¸ºç©º\n            if (UPDATER.compareAndSet(this, currentThreadMcsNode, null)) {\n                // è®¾ç½®æˆåŠŸè¿”å›ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹ç­‰å¾…é”\n                return;\n            } else {\n                //CASæ›´æ–°tailå¤±è´¥,æœ‰çº¿ç¨‹æŠ¢å…ˆä¸€æ­¥æ‰§è¡Œlockæ›´æ–°äº†tail\n                //ä½†æ˜¯å¯èƒ½è¿˜æ²¡æœ‰è¿æ¥åœ¨ ä¹‹å‰çš„tail(å½“å‰èŠ‚ç‚¹)å\n                while (currentThreadMcsNode.next == null) {\n                    //ç­‰å¾… predecessor.next = currentThreadMcsNodeæ‰§è¡Œ\n                    //å¦åˆ™åé¢ä¼šæŠ¥NPE\n                }\n            }\n        }\n        //ä¿®æ”¹åç»§è€…çš„isLocked,é€šçŸ¥åç»§è€…ç»“æŸè‡ªæ—‹\n        currentThreadMcsNode.next.block = false;\n        currentThreadMcsNode.next = null;// for GC\n    }\n}\n```\n\n## æ€»ç»“\n\nä¼ ç»Ÿçš„`Spin lock` å’Œ `Ticket Lock`éƒ½åœ¨åŒä¸€ä¸ªå…±äº«å˜é‡ä¸Šç«äº‰ï¼ˆä¾‹å¦‚SimpleSpinLockä¸­çš„ownerã€Ticket Lockä¸­çš„serviceNumï¼‰ï¼Œè¿™æ ·å¯¹ç»™CPUä¿è¯ç¼“å­˜ä¸€è‡´æ€§å¸¦æ¥çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œæ¯æ¬¡è¯»å†™éƒ½éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰çš„çº¿ç¨‹ï¼Œè€ŒMCSå’ŒCLHæœ€å¤§çš„ä¼˜åŒ–ç‚¹åœ¨äºæŠŠä¸Šè¿°åŒä¸€ä¸ªç‚¹ä¸Šçš„ç«äº‰åˆ†æ•£åˆ°é˜Ÿåˆ—çš„æ¯ä¸ªèŠ‚ç‚¹ä¸­å»äº†ã€‚\n\n## å‚è€ƒ\n\n[è‡ªæ—‹é”ã€æ’é˜Ÿè‡ªæ—‹é”ã€MCSé”ã€CLHé”](https://coderbee.net/index.php/concurrent/20131115/577)","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"é˜»å¡é˜Ÿåˆ—","url":"/2019/08/07/zu-sai-dui-lie/","content":"\n## é˜»å¡é˜Ÿåˆ—\n\né˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚\n\n**éé˜»å¡é˜Ÿåˆ—ä¸­çš„å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š**\n\n- `add(E e)`:å°†å…ƒç´ eæ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸\n\n-  `remove()`:ç§»é™¤é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥ç§»é™¤æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœç§»é™¤å¤±è´¥ï¼ˆé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸\n\n- `offer(E e)`ï¼šå°†å…ƒç´ eæ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™è¿”å›false\n\n- `poll()`ï¼šç§»é™¤å¹¶è·å–é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å›null\n\n- `peek()`ï¼šè·å–é˜Ÿé¦–å…ƒç´ ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å›null\n\nå¯¹äºéé˜»å¡é˜Ÿåˆ—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨offerã€pollå’Œpeekä¸‰ä¸ªæ–¹æ³•ï¼Œä¸å»ºè®®ä½¿ç”¨addå’Œremoveæ–¹æ³•ã€‚å› ä¸ºä½¿ç”¨offerã€pollå’Œpeekä¸‰ä¸ªæ–¹æ³•å¯ä»¥é€šè¿‡è¿”å›å€¼åˆ¤æ–­æ“ä½œæˆåŠŸä¸å¦ï¼Œè€Œä½¿ç”¨addå’Œremoveæ–¹æ³•å´ä¸èƒ½è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚æ³¨æ„ï¼Œéé˜»å¡é˜Ÿåˆ—ä¸­çš„æ–¹æ³•éƒ½æ²¡æœ‰è¿›è¡ŒåŒæ­¥æªæ–½ã€‚\n\n**é˜»å¡é˜Ÿåˆ—ä¸­çš„å‡ ä¸ªä¸»è¦æ–¹æ³•ï¼š**\n\né˜»å¡é˜Ÿåˆ—åŒ…æ‹¬äº†éé˜»å¡é˜Ÿåˆ—ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œä¸Šé¢åˆ—ä¸¾çš„5ä¸ªæ–¹æ³•åœ¨é˜»å¡é˜Ÿåˆ—ä¸­éƒ½å­˜åœ¨ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™5ä¸ªæ–¹æ³•åœ¨é˜»å¡é˜Ÿåˆ—ä¸­éƒ½è¿›è¡Œäº†**åŒæ­¥æªæ–½**ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé˜»å¡é˜Ÿåˆ—æä¾›äº†å¦å¤–4ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼š\n\n- `put(E e)`æ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…\n\n- `take()`æ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ç­‰å¾…\n\n- `offer(E e,long timeout, TimeUnit unit)`æ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›falseï¼›å¦åˆ™è¿”å›true\n\n- `poll(long timeout, TimeUnit unit)`æ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ç©ºï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœæ²¡å–åˆ°ï¼Œåˆ™è¿”å›nullï¼›å¦åˆ™è¿”å›å–å¾—çš„å…ƒç´ \n\n###  Javaé‡Œçš„é˜»å¡é˜Ÿåˆ—\n\n- **ArrayBlockingQueue** ï¼šä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\n- **LinkedBlockingQueue** ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\n- **PriorityBlockingQueue** ï¼šä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\n- **DelayQueue**ï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\n- **SynchronousQueue**ï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚\n- **LinkedTransferQueue**ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\n- **LinkedBlockingDeque**ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚\n\n> é™¤äº†è¿™å‡ ä¸ªå¤–è¿˜æœ‰ä¸€ä¸ª `ScheduledThreadPoolExecutor.DelayedWorkQueue`è¿™ä¸ªå…¶å®æ˜¯DelayQueueçš„ä¼˜åŒ–\n\n### ArrayBlockingQueue\n\nArrayBlockingQueueæ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯è®¿é—®è€…å…¬å¹³çš„è®¿é—®é˜Ÿåˆ—ï¼Œæ‰€è°“å…¬å¹³è®¿é—®é˜Ÿåˆ—æ˜¯æŒ‡é˜»å¡çš„æ‰€æœ‰ç”Ÿäº§è€…çº¿ç¨‹æˆ–æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå½“é˜Ÿåˆ—å¯ç”¨æ—¶ï¼Œå¯ä»¥æŒ‰ç…§é˜»å¡çš„å…ˆåé¡ºåºè®¿é—®é˜Ÿåˆ—ï¼Œå³å…ˆé˜»å¡çš„ç”Ÿäº§è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆå¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œå…ˆé˜»å¡çš„æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ ã€‚é€šå¸¸æƒ…å†µä¸‹ä¸ºäº†ä¿è¯å…¬å¹³æ€§ä¼šé™ä½ååé‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªå…¬å¹³çš„é˜»å¡é˜Ÿåˆ—ï¼š\n\n`ArrayBlockingQueue fairQueue = new ArrayBlockingQueue(1000,true);`\n\nè®¿é—®è€…çš„å…¬å¹³æ€§æ˜¯ä½¿ç”¨å¯é‡å…¥é”å®ç°çš„\n\n### LinkedBlockingQueue\n\nLinkedBlockingQueueæ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„**æœ‰ç•Œ**é˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚\n\nå®¹æ˜“è¢«è¯¯è§£ä¸ºæ— è¾¹ç•Œï¼Œä½†å…¶å®å…¶è¡Œä¸ºå’Œå†…éƒ¨ä»£ç éƒ½æ˜¯åŸºäºæœ‰ç•Œçš„é€»è¾‘å®ç°çš„ï¼Œåªä¸è¿‡å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶å°±æŒ‡å®šå®¹é‡ï¼Œé‚£ä¹ˆå…¶å®¹é‡é™åˆ¶å°±è‡ªåŠ¨è¢«\nè®¾ç½®ä¸º Integer.MAX_VALUE ï¼Œæˆä¸ºäº†æ— ç•Œé˜Ÿåˆ—ã€‚\n\n### PriorityBlockingQueue\n\nPriorityBlockingQueueæ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜Ÿåˆ—ã€‚åº•å±‚é‡‡ç”¨æ•°ç»„å®ç°äº†äºŒå‰å †ï¼Œç›¸æ¯”PriorityQueueå…¶å®å°±æ˜¯å°†é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡å–è‡ªç„¶é¡ºåºæ’åˆ—ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¯”è¾ƒå™¨comparatoræ¥æŒ‡å®šå…ƒç´ çš„æ’åºè§„åˆ™ã€‚\n\n### DelayQueue\n\nè¿™ä¸ªé˜Ÿåˆ—è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼ŒDelayQueueæ˜¯ä¸€ä¸ªæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚å†…éƒ¨ä½¿ç”¨PriorityQueueæ¥å­˜å‚¨å…ƒç´ ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ ã€‚åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡æ—¶æ‰èƒ½ä»é˜Ÿåˆ—ä¸­**å–å‡º**å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥å°†DelayQueueè¿ç”¨åœ¨ä»¥ä¸‹åº”ç”¨åœºæ™¯ï¼š\n\n- ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡ï¼šå¯ä»¥ç”¨DelayQueueä¿å­˜ç¼“å­˜å…ƒç´ çš„æœ‰æ•ˆæœŸï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¾ªç¯æŸ¥è¯¢DelayQueueï¼Œä¸€æ—¦èƒ½ä»DelayQueueä¸­è·å–(åˆ é™¤)å…ƒç´ æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæœŸåˆ°äº†ã€‚\n- å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚ä½¿ç”¨DelayQueueä¿å­˜å½“å¤©å°†ä¼šæ‰§è¡Œçš„ä»»åŠ¡å’Œæ‰§è¡Œæ—¶é—´ï¼Œä¸€æ—¦ä»DelayQueueä¸­è·å–åˆ°ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œï¼Œä»æ¯”å¦‚TimerQueueå°±æ˜¯ä½¿ç”¨DelayQueueå®ç°çš„ã€‚\n\né˜Ÿåˆ—ä¸­çš„Delayedå¿…é¡»å®ç°compareToæ¥æŒ‡å®šå…ƒç´ çš„é¡ºåºã€‚æ¯”å¦‚è®©å»¶æ—¶æ—¶é—´æœ€é•¿çš„æ”¾åœ¨é˜Ÿåˆ—çš„æœ«å°¾ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š\n\n**å¦‚ä½•å®ç°Delayedæ¥å£**\n\næˆ‘ä»¬å¯ä»¥å‚è€ƒScheduledThreadPoolExecutoré‡ŒScheduledFutureTaskç±»ã€‚è¿™ä¸ªç±»å®ç°äº†Delayedæ¥å£ã€‚\n\nç„¶åä½¿ç”¨getDelayå¯ä»¥æŸ¥è¯¢å½“å‰å…ƒç´ è¿˜éœ€è¦å»¶æ—¶å¤šä¹…ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```java\npublic long getDelay(TimeUnit unit) {\n    return unit.convert(time - now(), TimeUnit.NANOSECONDS);\n}\n```\n\né€šè¿‡æ„é€ å‡½æ•°å¯ä»¥çœ‹å‡ºå»¶è¿Ÿæ—¶é—´å‚æ•°nsçš„å•ä½æ˜¯çº³ç§’ï¼Œè‡ªå·±è®¾è®¡çš„æ—¶å€™æœ€å¥½ä½¿ç”¨çº³ç§’ï¼Œå› ä¸ºgetDelayæ—¶å¯ä»¥æŒ‡å®šä»»æ„å•ä½ï¼Œä¸€æ—¦ä»¥çº³ç§’ä½œä¸ºå•ä½ï¼Œè€Œå»¶æ—¶çš„æ—¶é—´åˆç²¾ç¡®ä¸åˆ°çº³ç§’å°±éº»çƒ¦äº†ã€‚ä½¿ç”¨æ—¶è¯·æ³¨æ„å½“timeå°äºå½“å‰æ—¶é—´æ—¶ï¼ŒgetDelayä¼šè¿”å›è´Ÿæ•°ã€‚\n\n**å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—**\n\nå»¶æ—¶é˜Ÿåˆ—çš„å®ç°å¾ˆç®€å•ï¼Œå½“æ¶ˆè´¹è€…ä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ æ—¶ï¼Œå¦‚æœå…ƒç´ æ²¡æœ‰è¾¾åˆ°å»¶æ—¶æ—¶é—´ï¼Œå°±é˜»å¡å½“å‰çº¿ç¨‹ã€‚\n\n```java\nimport java.util.concurrent.Delayed;\nimport java.util.concurrent.TimeUnit;\n\npublic class DelayedEle implements Delayed {\n\n    private final long delayTime; //å»¶è¿Ÿæ—¶é—´\n    private final long expire;  //åˆ°æœŸæ—¶é—´\n    private String data;   //æ•°æ®\n\n    public DelayedEle(long delay, String data) {\n        delayTime = delay;\n        this.data = data;\n        expire = System.currentTimeMillis() + delay;\n    }\n\n    /**\n     * å‰©ä½™æ—¶é—´=åˆ°æœŸæ—¶é—´-å½“å‰æ—¶é—´\n     */\n    @Override\n    public long getDelay(TimeUnit unit) {\n        return unit.convert(this.expire - System.currentTimeMillis() , TimeUnit.MILLISECONDS);\n    }\n\n    /**\n     * ä¼˜å…ˆé˜Ÿåˆ—é‡Œé¢ä¼˜å…ˆçº§è§„åˆ™\n     */\n    @Override\n    public int compareTo(Delayed o) {\n        //æ ¹æ®delayæ—¶é—´\n        return (int) (this.getDelay(TimeUnit.MILLISECONDS) -o.getDelay(TimeUnit.MILLISECONDS));\n    }\n\n    @Override\n    public String toString() {\n        final StringBuilder sb = new StringBuilder(\"DelayedElement{\");\n        sb.append(\"delay=\").append(delayTime);\n        sb.append(\", expire=\").append(expire);\n        sb.append(\", data='\").append(data).append('\\'');\n        sb.append('}');\n        return sb.toString();\n    }\n}\n```\n\n**æµ‹è¯•**\n\n```java\nimport java.util.concurrent.DelayQueue;\n\n/**\n * @author imlgw.top\n * @date 2019/8/7 17:55\n */\npublic class DelayedQueueTest {\n    public static void main(String[] args) throws InterruptedException {\n        DelayQueue<DelayedEle> delayQueue = new DelayQueue<DelayedEle>();\n\n        DelayedEle element1 = new DelayedEle(3000,\"lgw\");\n        DelayedEle element2 = new DelayedEle(3000,\"top\");\n\n        delayQueue.offer(element1);\n        delayQueue.offer(element2);\n        long l = System.currentTimeMillis();\n\n        System.out.println(l);\n        element1 =  delayQueue.take();\n        System.out.println(System.currentTimeMillis()-l);\n\n        System.out.println(element1);\n    }\n}\n\n/** æµ‹è¯•ç»“æœ\n *  1565176036796\n *  3016\n *  DelayedElement{delay=3000, expire=1565176039796, data='lgw'}\n */\n \n```\n\n### SynchronousQueue\n\nSynchronousQueueæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸€ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚SynchronousQueueå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªä¼ çƒæ‰‹ï¼Œè´Ÿè´£æŠŠç”Ÿäº§è€…çº¿ç¨‹å¤„ç†çš„æ•°æ®ç›´æ¥ä¼ é€’ç»™æ¶ˆè´¹è€…çº¿ç¨‹ã€‚é˜Ÿåˆ—æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œéå¸¸é€‚åˆäºä¼ é€’æ€§åœºæ™¯,æ¯”å¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®ï¼Œä¼ é€’ç»™å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼ŒSynchronousQueueçš„ååé‡é«˜äºLinkedBlockingQueue å’Œ ArrayBlockingQueueã€‚\n\n> çº¿ç¨‹æ± å·¥å‚æ–¹æ³• **newCachedThreadPool** åº•å±‚å°±æ˜¯ç”¨çš„Synchronized\n\n### LinkedTransferQueue\n\nTransferQueueç›¸æ¯”SynchronousQueueç”¨å¤„æ›´å¹¿ã€æ›´å¥½ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥å†³å®šæ˜¯ä½¿ç”¨BlockingQueueçš„æ–¹æ³•ï¼ˆè¯‘è€…æ³¨ï¼šä¾‹å¦‚putæ–¹æ³•ï¼‰è¿˜æ˜¯ç¡®ä¿ä¸€æ¬¡ä¼ é€’å®Œæˆï¼ˆè¯‘è€…æ³¨ï¼šå³transferæ–¹æ³•ï¼‰ã€‚åœ¨é˜Ÿåˆ—ä¸­å·²æœ‰å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨transferæ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿é˜Ÿåˆ—ä¸­è¢«ä¼ é€’å…ƒç´ ä¹‹å‰çš„æ‰€æœ‰å…ƒç´ éƒ½èƒ½è¢«å¤„ç†ã€‚[Doug Leaè¯´](http://cs.oswego.edu/pipermail/concurrency-interest/2009-February/005888.html)ä»åŠŸèƒ½è§’åº¦æ¥è®²ï¼ŒLinkedTransferQueueå®é™…ä¸Šæ˜¯ConcurrentLinkedQueueã€SynchronousQueueï¼ˆå…¬å¹³æ¨¡å¼ï¼‰å’ŒLinkedBlockingQueueçš„è¶…é›†ã€‚è€Œä¸”LinkedTransferQueueæ›´å¥½ç”¨ï¼Œå› ä¸ºå®ƒä¸ä»…ä»…ç»¼åˆäº†è¿™å‡ ä¸ªç±»çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ›´é«˜æ•ˆçš„å®ç°ã€‚\n\nLinkedTransferQueueæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜»å¡é˜Ÿåˆ—LinkedTransferQueueå¤šäº†tryTransferå’Œtransferæ–¹æ³•ã€‚\n\nLinkedTransferQueueä¸SynchronousQueueä¸­å…¬å¹³æ¨¡å¼çš„å®ç°TransferQueueæ˜¯ä¸€æ ·çš„ï¼Œé˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä¸æ˜¯æ•°æ®ï¼Œè€Œæ˜¯æ“ä½œï¼ˆå–å‡ºæ•°æ®çš„æ“ä½œtakeå’Œæ”¾å…¥æ•°æ®çš„æ“ä½œputï¼‰é˜Ÿåˆ—ä¸­æ—¢å¯ä»¥å­˜æ”¾takeæ“ä½œä¹Ÿå¯ä»¥å­˜æ”¾putæ“ä½œï¼Œä½†æ˜¯é˜Ÿåˆ—ä¸­ä¸èƒ½åŒæ—¶å­˜åœ¨ä¸¤ç§ä¸åŒçš„æ“ä½œï¼Œå› ä¸ºä¸åŒçš„æ“ä½œä¼šè§¦å‘é˜Ÿåˆ—è¿›è¡Œé…å¯¹ï¼ˆæ“ä½œå‡ºé˜Ÿï¼‰ã€‚\n\n**transferæ–¹æ³•**ã€‚å¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…æ­£åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼ˆæ¶ˆè´¹è€…ä½¿ç”¨take()æ–¹æ³•æˆ–å¸¦æ—¶é—´é™åˆ¶çš„poll()æ–¹æ³•æ—¶ï¼‰ï¼Œtransferæ–¹æ³•å¯ä»¥æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç«‹åˆ»transferï¼ˆä¼ è¾“ï¼‰ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œtransferæ–¹æ³•ä¼šå°†å…ƒç´ å­˜æ”¾åœ¨é˜Ÿåˆ—çš„tailèŠ‚ç‚¹ï¼Œå¹¶ç­‰åˆ°è¯¥å…ƒç´ è¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚transferæ–¹æ³•çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š\n\n```java\nprivate E xfer(E e, boolean haveData, int how, long nanos) {\n    if (haveData && (e == null))\n        throw new NullPointerException();\n    Node s = null;                        // the node to append, if needed\n\n    retry:\n    for (;;) {                            // restart on append race\n\n        for (Node h = head, p = h; p != null;) { // find & match first node\n            boolean isData = p.isData;\n            Object item = p.item;\n            if (item != p && (item != null) == isData) { // unmatched\n                if (isData == haveData)   // can't match\n                    break;\n                if (p.casItem(item, e)) { // match\n                    for (Node q = p; q != h;) {\n                        Node n = q.next;  // update by 2 unless singleton\n                        if (head == h && casHead(h, n == null ? q : n)) {\n                            h.forgetNext();\n                            break;\n                        }                 // advance and retry\n                        if ((h = head)   == null ||\n                            (q = h.next) == null || !q.isMatched())\n                            break;        // unless slack < 2\n                    }\n                    LockSupport.unpark(p.waiter);\n                    return LinkedTransferQueue.<E>cast(item);\n                }\n            }\n            Node n = p.next;\n            p = (p != n) ? n : (h = head); // Use head if p offlist\n        }\n\n        if (how != NOW) {                 // No matches available\n            if (s == null)\n                s = new Node(e, haveData);\n            //ï¼ˆ1ï¼‰å°è¯•æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨\n            Node pred = tryAppend(s, haveData);\n            if (pred == null)\n                continue retry;           // lost race vs opposite mode\n            if (how != ASYNC)\n            //ï¼ˆ2ï¼‰ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹\n                return awaitMatch(s, pred, e, (how == TIMED), nanos);\n        }\n        return e; // not waiting\n    }\n}\n```\n\nï¼ˆ1ï¼‰ä»£ç æ˜¯è¯•å›¾æŠŠå­˜æ”¾å½“å‰å…ƒç´ çš„sèŠ‚ç‚¹ä½œä¸ºtailèŠ‚ç‚¹ã€‚ï¼ˆ2ï¼‰ä»£ç æ˜¯è®©CPUè‡ªæ—‹ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹å…ƒç´ ã€‚å› ä¸ºè‡ªæ—‹ä¼šæ¶ˆè€—CPUï¼Œæ‰€ä»¥è‡ªæ—‹ä¸€å®šçš„æ¬¡æ•°åä½¿ç”¨Thread.yield()æ–¹æ³•æ¥æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚\n\n**tryTransferæ–¹æ³•**ã€‚åˆ™æ˜¯ç”¨æ¥è¯•æ¢ä¸‹ç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ æ˜¯å¦èƒ½ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œåˆ™è¿”å›falseã€‚å’Œtransferæ–¹æ³•çš„åŒºåˆ«æ˜¯tryTransferæ–¹æ³•æ— è®ºæ¶ˆè´¹è€…æ˜¯å¦æ¥æ”¶ï¼Œæ–¹æ³•ç«‹å³è¿”å›ã€‚è€Œtransferæ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚\n\nå¯¹äºå¸¦æœ‰æ—¶é—´é™åˆ¶çš„tryTransfer(E e, long timeout, TimeUnit unit)æ–¹æ³•ï¼Œåˆ™æ˜¯è¯•å›¾æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥å…ƒç´ åˆ™ç­‰å¾…æŒ‡å®šçš„æ—¶é—´å†è¿”å›ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æ¶ˆè´¹å…ƒç´ ï¼Œåˆ™è¿”å›falseï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ¶ˆè´¹äº†å…ƒç´ ï¼Œåˆ™è¿”å›trueã€‚\n\n**å®ä¾‹**\n\n```java\npackage juc_study.collection.blocking;\n\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.LinkedTransferQueue;\n\npublic class LinkedTransferQueueDemo {\n    static LinkedTransferQueue<String> lnkTransQueue = new LinkedTransferQueue<String>();\n    public static void main(String[] args) {\n        ExecutorService exService = Executors.newFixedThreadPool(2);\n        Producer producer = new LinkedTransferQueueDemo().new Producer();\n        Consumer consumer = new LinkedTransferQueueDemo().new Consumer();\n        exService.execute(producer);\n        exService.execute(consumer);\n        exService.shutdown();\n    }\n    class Producer implements Runnable{\n        @Override\n        public void run() {\n            for(int i=0;i<3;i++){\n                try {\n                    System.out.println(\"Producer is waiting to transfer...\");\n                    lnkTransQueue.transfer(\"A\"+i);\n                    System.out.println(\"producer transfered element: A\"+i);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n    class Consumer implements Runnable{\n        @Override\n        public void run() {\n            for(int i=0;i<3;i++){\n                try {\n                    System.out.println(\"Consumer is waiting to take element...\");\n                    String s= lnkTransQueue.take();\n                    System.out.println(\"Consumer received Element: \"+s);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n```\n\n### LinkedBlockingDeque\n\nLinkedBlockingDequeæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚æ‰€è°“åŒå‘é˜Ÿåˆ—æŒ‡çš„ä½ å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œç§»å‡ºå…ƒç´ ã€‚åŒç«¯é˜Ÿåˆ—å› ä¸ºå¤šäº†ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—çš„å…¥å£ï¼Œåœ¨å¤šçº¿ç¨‹åŒæ—¶å…¥é˜Ÿæ—¶ï¼Œä¹Ÿå°±å‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚ç›¸æ¯”å…¶ä»–çš„é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedBlockingDequeå¤šäº†addFirstï¼ŒaddLastï¼ŒofferFirstï¼ŒofferLastï¼ŒpeekFirstï¼ŒpeekLastç­‰æ–¹æ³•ï¼Œä»¥Firstå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–ï¼ˆpeekï¼‰æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä»¥Lastå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚å¦å¤–æ’å…¥æ–¹æ³•addç­‰åŒäºaddLastï¼Œç§»é™¤æ–¹æ³•removeç­‰æ•ˆäºremoveFirstã€‚ä½†æ˜¯takeæ–¹æ³•å´ç­‰åŒäºtakeFirstï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯Jdkçš„bugï¼Œä½¿ç”¨æ—¶è¿˜æ˜¯ç”¨å¸¦æœ‰Firstå’ŒLaståç¼€çš„æ–¹æ³•æ›´æ¸…æ¥šã€‚åœ¨åˆå§‹åŒ–LinkedBlockingDequeæ—¶å¯ä»¥åˆå§‹åŒ–é˜Ÿåˆ—çš„å®¹é‡ï¼Œç”¨æ¥é˜²æ­¢å…¶å†æ‰©å®¹æ—¶è¿‡æ¸¡è†¨èƒ€ã€‚å¦å¤–åŒå‘é˜»å¡é˜Ÿåˆ—å¯ä»¥è¿ç”¨åœ¨â€œå·¥ä½œçªƒå–â€æ¨¡å¼ä¸­ã€‚\n\n## å‚è€ƒ\n\n[å¹¶å‘å®¹å™¨å­¦ä¹ â€”LinkedTransferQueue](https://my.oschina.net/bzhangpoorman/blog/3044802)\n\n[é˜»å¡é˜Ÿåˆ—ä¹‹LinkedTransferQueue](https://blog.csdn.net/YJian2008/article/details/16951811)\n\n[å¹¶å‘é˜Ÿåˆ—-æ— ç•Œé˜»å¡å»¶è¿Ÿé˜Ÿåˆ—DelayQueueåŸç†æ¢ç©¶](https://www.jianshu.com/p/2659eb72134b)\n\n[å¹¶å‘ç¼–ç¨‹ç½‘](http://ifeve.com/blocking-queues/)\n\n[Java 7ä¸­çš„TransferQueue](http://ifeve.com/java-transfer-queue/)","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"ThreadPoolExecutoræºç è§£æ","url":"/2019/07/30/threadpoolexecutor-yuan-ma-jie-xi/","content":"\n## æ·±å…¥ThreadPoolExecutoræºç \n\n### ç±»ç»“æ„\n\n![mark](http://static.imlgw.top/blog/20190802/wTkHh1NbyM8K.png?imageslim)\n\nè¿™é‡Œä¸»è¦è¦è¯´çš„æ˜¯ `ThreadPoolExecutor`ç±»\n\n### çº¿ç¨‹æ± çŠ¶æ€\n\næ‰“å¼€æºç æ˜ å…¥çœ¼å¸˜çš„å°±æ˜¯è¿™å‡ ä¸ªå­—æ®µå’Œæ–¹æ³•ï¼Œå¯¹åº”çš„å°±æ˜¯çº¿ç¨‹æ± çš„ä¸€äº›è¿è¡ŒçŠ¶æ€å’Œç›¸å…³æ–¹æ³•\n\n```java\n//æ§åˆ¶çº¿ç¨‹æ± ä¸­æ•°é‡å’ŒçŠ¶æ€çš„å­—æ®µ,ç”¨AtomicIntegerä¿å­˜\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\n//count bité¡¾åæ€ä¹‰å°±æ˜¯ workerCountçš„ä½æ•°ï¼Œè¿™é‡Œæ˜¯29\nprivate static final int COUNT_BITS = Integer.SIZE - 3;\n//1<<29 -1 == 1111....1111(29ä¸ª1) çº¿ç¨‹æ•°(workerCount)ä¸Šé™ å¤§çº¦5äº¿\nprivate static final int CAPACITY   = (1 << COUNT_BITS) - 1;\n\n// runState is stored in the high-order bits\n//é«˜ä¸‰ä½å­˜æ”¾çŠ¶æ€ï¼Œç›¸åº”çš„ä½29ä½å°±æ˜¯workerCount\nprivate static final int RUNNING    = -1 << COUNT_BITS;\nprivate static final int SHUTDOWN   =  0 << COUNT_BITS;\nprivate static final int STOP       =  1 << COUNT_BITS;\nprivate static final int TIDYING    =  2 << COUNT_BITS;\nprivate static final int TERMINATED =  3 << COUNT_BITS;\n\n// Packing and unpacking ctl\n// æ‹†è§£ctlè·å–çŠ¶æ€å’Œæ•°é‡\nprivate static int runStateOf(int c)     { return c & ~CAPACITY; }\nprivate static int workerCountOf(int c)  { return c & CAPACITY; }\n// æ‹¼æ¥çŠ¶æ€å’Œæ•°é‡å¾—åˆ°ctl\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }\n```\n\n#### çŠ¶æ€è½¬æ¢è¿‡ç¨‹\n\n![mark](http://static.imlgw.top/blog/20190802/EWlphYbCMVjv.png?imageslim)\n\nğŸ’¡ **RUNNING** ï¼šèƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›\n\nğŸ’¡ **SHUTDOWN**ï¼šå…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å´å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡ã€‚åœ¨çº¿ç¨‹æ± å¤„äº `RUNNING` çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ `shutdown()`æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚ï¼ˆ`finalize()` æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šè°ƒç”¨shutdown()æ–¹æ³•è¿›å…¥è¯¥çŠ¶æ€ï¼‰\n\nğŸ’¡ **STOP**ï¼šä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº `RUNNING` æˆ– `SHUTDOWN` çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ `shutdownNow()` æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€\n\nğŸ’¡ **TIDYING**ï¼šå¦‚æœæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼ŒworkerCount (æœ‰æ•ˆçº¿ç¨‹æ•°) ä¸º0ï¼Œçº¿ç¨‹æ± è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒç”¨ terminated() æ–¹æ³•è¿›å…¥TERMINATED çŠ¶æ€\n\nğŸ’¡ **TERMINATED**ï¼šåœ¨terminated() æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€ï¼Œé»˜è®¤terminated()æ–¹æ³•ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚\n\nè¿›å…¥`TERMINATED`çš„æ¡ä»¶å¦‚ä¸‹ï¼š\n\n- çº¿ç¨‹æ± ä¸æ˜¯RUNNINGçŠ¶æ€ï¼›\n- çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯TIDYINGçŠ¶æ€æˆ–TERMINATEDçŠ¶æ€ï¼›\n- å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ˜¯SHUTDOWNå¹¶ä¸”workerQueueä¸ºç©ºï¼›\n- workerCountä¸º0ï¼›\n- è®¾ç½®TIDYINGçŠ¶æ€æˆåŠŸã€‚\n\n### æˆå‘˜å˜é‡\n\nå†å¾€ä¸‹ï¼Œå°±ä¼šçœ‹è§ä¸€äº›å¾ˆé‡è¦çš„æˆå‘˜å˜é‡\n\n```java\n//ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œå­˜æ”¾å¾…æ‰§è¡Œçš„ä»»åŠ¡\nprivate final BlockingQueue<Runnable> workQueue; \n//å¯é‡å…¥é”ï¼Œçº¿ç¨‹æ± ä¸»è¦çš„é”\nprivate final ReentrantLock mainLock = new ReentrantLock();\n//çº¿ç¨‹é›†åˆ(çº¿ç¨‹æ± çš„workersé›†åˆ)\nprivate final HashSet<Worker> workers = new HashSet<Worker>();\n//å¯¹åº”çš„æ¡ä»¶å˜é‡\nprivate final Condition termination = mainLock.newCondition(); \n//ç”¨æ¥è®°å½•çº¿ç¨‹æ± ä¸­æ›¾ç»å‡ºç°è¿‡çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå’Œçº¿ç¨‹æ± å®¹é‡æ²¡æœ‰å…³ç³»\nprivate int largestPoolSize;\n//ç”¨æ¥è®°å½•å·²ç»æ‰§è¡Œå®Œæ¯•çš„ä»»åŠ¡ä¸ªæ•°\nprivate long completedTaskCount; \n//å·¥å‚æ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹\nprivate volatile ThreadFactory threadFactory; \n//æ‹’ç»ç­–ç•¥\nprivate volatile RejectedExecutionHandler handler; \n//çº¿ç¨‹é—²ç½®æ—¶å€™çš„æœ€å¤§å­˜æ´»æ—¶é—´\nprivate volatile long keepAliveTime; \n//æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹é—²ç½®çš„æ—¶å€™è¶…æ—¶\nprivate volatile boolean allowCoreThreadTimeOut; \n//æ ¸å¿ƒçº¿ç¨‹æ•°\nprivate volatile int corePoolSize; \n//æœ€å¤§çº¿ç¨‹æ•°\nprivate volatile int maximumPoolSize; \n//é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼šAbortPolicyç›´æ¥æ‹’ç»å¹¶æŠ›å¼‚å¸¸\nprivate static final RejectedExecutionHandler defaultHandler = new AbortPolicy();\n```\n\n### execute()\n\n **æºç åˆ†æ**\n\n```java\npublic void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();\n\n    //è·å–çº¿ç¨‹æ± çš„çŠ¶æ€å’Œçº¿ç¨‹æ•°é‡\n    int c = ctl.get();\n    if (workerCountOf(c) < corePoolSize) { //workerCountå°äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡\n        //å°†ä»»åŠ¡æ·»åŠ åˆ°workersä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨æ˜¯å¦æ ¹æ®corePoolSizeæ¥æ·»åŠ çº¿ç¨‹ï¼Œfalseåˆ™æ ¹æ®maxPoolSize\n        if (addWorker(command, true))\n            return;\n        //æ·»åŠ å¤±è´¥ï¼Œé‡æ–°è·å–ctl\n        c = ctl.get();\n    }\n    \n    //ä¸Šé¢æ·»åŠ åˆ°workersä¸­å¤±è´¥ï¼Œæœ‰å¯èƒ½æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¸å¤Ÿç”¨äº†æˆ–è€…çº¿ç¨‹æ± ä¸æ˜¯è¿è¡ŒçŠ¶æ€\n    //å¦‚æœçº¿ç¨‹æ± æ˜¯RunningçŠ¶æ€ å°è¯•æ·»åŠ ä»»åŠ¡åˆ°é˜»å¡é˜Ÿåˆ—ä¸­\n    if (isRunning(c) && workQueue.offer(command)) {\n        //æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—æˆåŠŸï¼Œé‡æ–°è·å–ctl\n        int recheck = ctl.get();\n        //å¦‚æœçº¿ç¨‹æ± ä¸æ˜¯RunningçŠ¶æ€å°±ä»ç­‰å¾…é˜Ÿåˆ—ä¸­removeè¿™ä¸ªä»»åŠ¡\n        if (! isRunning(recheck) && remove(command))\n            reject(command); //é‡‡ç”¨æ‹’ç»ç­–ç•¥æ‹’ç»è¯¥ä»»åŠ¡\n        else if (workerCountOf(recheck) == 0)\n            //çº¿ç¨‹æ± Runningä½†æ˜¯æ²¡æœ‰çº¿ç¨‹\n            //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä½†æ˜¯ä¸ä¼ å…¥Runnable(å·²ç»åœ¨é˜»å¡é˜Ÿåˆ—ä¸­äº†)\n            addWorker(null, false);\n    }\n    //ä¸¤ç§æƒ…å†µ\n    //1. çº¿ç¨‹æ± ä¸æ˜¯RunningçŠ¶æ€å¹¶ä¸”commandä¸ä¸ºnullï¼ŒaddWorkerä¼šç›´æ¥falseç„¶åæ‹’ç»è¿™ä¸ªä»»åŠ¡\n    //2. æ·»åŠ åˆ°workQueue(é˜»å¡é˜Ÿåˆ—)å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯ queueæ»¡äº†ï¼Œå¯èƒ½æ˜¯éœ€è¦æ‰©å®¹äº†\n    //   æ‰€ä»¥åé¢çš„å‚æ•°æ˜¯falseï¼Œæ·»åŠ å¤±è´¥ä¹Ÿä¼šç›´æ¥æ‹’ç»\n    else if (!addWorker(command, false))\n        reject(command);\n}\n```\n\nè¿™é‡Œè¦ç†è§£addWorkerçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œtrueåˆ™ä»£è¡¨å½“å‰çº¿ç¨‹æ± çš„**ä¸Šç•Œ**ä»ç„¶æ˜¯corePoolSizeï¼Œåé¢çš„addWorkerä¼šæ ¹æ®ä¸Šç•Œæ¥åˆ¤æ–­æ˜¯å¦å¢åŠ çº¿ç¨‹ï¼Œfalseåˆ™ä»£è¡¨**ä¸Šç•Œ**æ˜¯maximumPoolSizeï¼Œè¿™ä¸€ç‚¹åœ¨åé¢çš„åˆ†æä¸­ä¼šçœ‹åˆ°ã€‚\n\n**Executorå¤§è‡´æ‰§è¡Œæµç¨‹**\n\n![mark](http://static.imlgw.top/blog/20190803/j3xQrmOkc3Kl.png?imageslim)\n\n### addWorker()\n\n`addWorker()` çš„ä½œç”¨å°±æ˜¯åˆ›å»ºçº¿ç¨‹(Worker)å¹¶ä¸”æ·»åŠ åˆ°Workersé›†åˆä¸­ï¼Œç„¶åå¯åŠ¨çº¿ç¨‹\n\n**æºç åˆ†æ**\n\n```java\nprivate boolean addWorker(Runnable firstTask, boolean core) {\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // rs>=SHUTDOWNè¯´æ˜ä¸æ˜¯RUNNINGçŠ¶æ€\n        if (rs >= SHUTDOWN && !(rs == SHUTDOWN && firstTask == null &&!workQueue.isEmpty()))\n            return false;\n        \n        for (;;) {\n            int wc = workerCountOf(c);\n            //å¦‚æœå¤§äºå¯å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œæˆ–è€…å¤§äºå½“å‰çš„çº¿ç¨‹æ± çš„ä¸Šç•Œï¼Œç›´æ¥false\n            //ä¸Šé¢ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°çš„ä½œç”¨ä½“ç°å‡ºæ¥äº†ï¼Œä¸ºtrueä¸Šç•Œåˆ™æ˜¯corePoolSize\n            if (wc >= CAPACITY || wc >= (core ? corePoolSize : maximumPoolSize))\n                return false;\n            //åˆ©ç”¨CASè‡ªå¢ å¢å¤§workCountçº¿ç¨‹æ•°ï¼ŒæˆåŠŸåå°±è·³å‡ºå¾ªç¯\n            if (compareAndIncrementWorkerCount(c))\n                break retry;\n            //CASå¤±è´¥ï¼Œé‡æ–°è·å–ctl\n            c = ctl.get();  // Re-read ctl\n            //åˆ¤æ–­è¿˜æ˜¯ä¸æ˜¯RunningçŠ¶æ€(èƒ½åˆ°è¿™é‡Œè¯´æ˜rs==RunningçŠ¶æ€)ï¼Œä¸æ˜¯çš„è¯å°±è·³å‡ºå»é‡æ–°æ¥è¿‡\n            if (runStateOf(c) != rs)\n                continue retry;\n            // else CAS failed due to workerCount change; retry inner loop\n            // CASå¤±è´¥å¹¶ä¸”è¿˜æ˜¯RunningçŠ¶æ€ï¼Œç»§ç»­è‡ªæ—‹å°è¯•è‡ªå¢\n        }\n    }\n    //çº¿ç¨‹æ˜¯å¦å¯åŠ¨ï¼Œä»¥åŠçº¿ç¨‹æ˜¯å¦æ·»åŠ \n    boolean workerStarted = false;\n    boolean workerAdded = false;\n    Worker w = null;\n    try {\n        //åˆ›å»ºä¸€ä¸ªWorker(å¯¹çº¿ç¨‹çš„å°è£…)\n        w = new Worker(firstTask);\n        final Thread t = w.thread;\n        if (t != null) {\n            final ReentrantLock mainLock = this.mainLock;\n            mainLock.lock();\n            try {\n                // Recheck while holding lock.\n                // Back out on ThreadFactory failure or if\n                // shut down before lock acquired.\n                int rs = runStateOf(ctl.get());\n\t\t\t\t//æ˜¯RUNNINGçŠ¶æ€ æˆ–è€… æ˜¯SHUTDOWNçŠ¶æ€ä¸”æ²¡æœ‰æäº¤ä»»åŠ¡(SHUTDOWNçŠ¶æ€è¿˜å¯ä»¥æ‰§è¡Œé˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡)\n                if (rs < SHUTDOWN ||\n                    (rs == SHUTDOWN && firstTask == null)) {\n                    if (t.isAlive()) // precheck that t is startable\n                        throw new IllegalThreadStateException();\n                    //æ·»åŠ åˆ°å·¥ä½œé›†ä¸­\n                    workers.add(w);\n                    int s = workers.size();\n                    if (s > largestPoolSize)\n                        largestPoolSize = s; //è®°å½•æœ€å¤§å€¼\n                    workerAdded = true; //æ·»åŠ æˆåŠŸ\n                }\n            } finally {\n                mainLock.unlock();\n            }\n            if (workerAdded) {\n                //å¯åŠ¨çº¿ç¨‹ï¼Œæ‰§è¡ŒWorkerçš„runæ–¹æ³•\n                t.start(); \n                workerStarted = true; //å¯åŠ¨æˆåŠŸ\n            }\n        }\n    } finally {\n        if (! workerStarted)\n            //å¯åŠ¨å¤±è´¥ï¼Œå›æ»šworkerså¹¶å°è¯•å…³é—­çº¿ç¨‹æ± \n            addWorkerFailed(w);\n    }\n    return workerStarted;\n}\n```\n\nğŸ”¸ é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦é€‚åˆç»§ç»­addWorkerï¼Œåˆ†æè¿™é‡Œçš„ifæ¡ä»¶ï¼ŒRUNNINGä¸ä¼šfalse ï¼ŒSTOPï¼ŒTIDYINGï¼ŒTERMINATEDç›´æ¥falseï¼ŒSHUTDOWNçŠ¶æ€å¦‚æœfirstTaskä¸ºç©º é˜»å¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡çš„æ—¶å€™ä¸ä¼šfalseï¼Œå…¶ä»–æƒ…å†µéƒ½falseã€‚\n\nğŸ”¸ è·å–å½“å‰çš„workerCountåˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†å½“å‰çš„ä¸Šç•Œï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†ç¬¬äºŒä¸ªå‚æ•°\n\nğŸ”¸ ç„¶ååˆ©ç”¨CASè‡ªæ—‹å¢åŠ workerCount\n\nğŸ”¸ åˆ›å»ºWorkerå¯¹è±¡ï¼Œè·å–mainLockå¹¶åŠ é”ï¼Œå› ä¸ºworkersæ˜¯HashSetå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„\n\nğŸ”¸ å†æ¬¡è·å–çº¿ç¨‹æ± è½¬å°å¹¶åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œåˆæ³•å°±æ·»åŠ åˆ°workersä¸­ï¼Œç„¶ååœ¨finallyå—ä¸­é‡Šæ”¾é”\n\nğŸ”¸ æ ¹æ®å‰é¢çš„workerAdded åˆ¤æ–­æ˜¯å¦å¯åŠ¨çº¿ç¨‹\n\nğŸ”¸ åœ¨æœ€ç»ˆçš„finallyå—ä¸­æ ¹æ®æ˜¯å¦å¯åŠ¨æˆåŠŸæ¥å†³å®šæ˜¯å¦å›æ»š\n\n### addWorkerFailed()\n\nå¯åŠ¨å¤±è´¥ï¼Œå›æ»šä¹‹å‰çš„æ·»åŠ æ“ä½œ\n\n```java\nprivate void addWorkerFailed(Worker w) {\n    final ReentrantLock mainLock = this.mainLock;\n    //è·å–é”\n    mainLock.lock();\n    try {\n        if (w != null)\n            //ä»workersä¸­ç§»é™¤\n            workers.remove(w);\n        //å‡å°‘workerCount\n        decrementWorkerCount();\n        //å°è¯•å…³é—­çº¿ç¨‹æ± \n        tryTerminate();\n    } finally {\n        mainLock.unlock();\n    }\n}\n```\n\n### Workerç±»\n\nå°è£…äº†çº¿ç¨‹å¯¹è±¡ï¼Œçº¿ç¨‹æ± ç»´æŠ¤çš„å°±æ˜¯è¿™äº›worker\n\n```java\nprivate final class Worker extends AbstractQueuedSynchronizer implements Runnable\n{\n    /**\n     * This class will never be serialized, but we provide a\n     * serialVersionUID to suppress a javac warning.\n     */\n    private static final long serialVersionUID = 6138294804551838833L;\n\n    /** Thread this worker is running in.  Null if factory fails. */\n    final Thread thread;\n    /** Initial task to run.  Possibly null. */\n    Runnable firstTask; //ä¼ å…¥çš„ä»»åŠ¡\n    /** Per-thread task counter */\n    volatile long completedTasks;\n\n    /**\n     * Creates with given first task and thread from ThreadFactory.\n     * @param firstTask the first task (null if none)\n     */\n    Worker(Runnable firstTask) {\n        setState(-1); // è®¾ç½®çŠ¶æ€ä¸º -1\n        this.firstTask = firstTask;\n        //æ ¹æ®å·¥å‚æ–¹æ³•åˆ›å»ºçº¿ç¨‹\n        //å°†Workerä¼ é€’è¿›å»ï¼Œä½œä¸ºThreadçš„å‚æ•°\n        //new Thread(Worker worker);\n        this.thread = getThreadFactory().newThread(this);\n    }\n\n    /** Delegates main run loop to outer runWorker  */\n    public void run() {\n        runWorker(this);\n    }\n\n    // Lock methods\n    //\n    // The value 0 represents the unlocked state.\n    // The value 1 represents the locked state.\n    // æ˜¯å¦è·å–åˆ°äº†é”\n    protected boolean isHeldExclusively() {\n        return getState() != 0; \n    }\n\n    protected boolean tryAcquire(int unused) {\n        //åˆ©ç”¨CASè®¾ç½®state\n        //å¾ˆæ˜æ˜¾è¿™é‡Œæ˜¯ä¸ªä¸å¯é‡å…¥çš„ç‹¬å é”ï¼Œå…·ä½“å¯ä»¥å¯¹æ¯”ReentrantLockçš„å®ç°æ–¹æ³•\n        if (compareAndSetState(0, 1)) {\n            //ç»§æ‰¿è‡ªAbstractOwnableSynchronizer\n            //ä¿å­˜å½“å‰çš„æŒæœ‰é”çš„çº¿ç¨‹\n            setExclusiveOwnerThread(Thread.currentThread());\n            return true;\n        }\n        return false;\n    }\n    \n    //é‡Šæ”¾é”è®¾ç½®state=0\n    protected boolean tryRelease(int unused) {\n        //è®¾ç½®ç‹¬å é”çº¿ç¨‹ä¸ºç©º\n        setExclusiveOwnerThread(null);\n        setState(0);\n        return true;\n    }\n\n    public void lock()        { acquire(1); } //æœ€ç»ˆä¼šè°ƒç”¨tryAcquire(1);\n    public boolean tryLock()  { return tryAcquire(1); }\n    public void unlock()      { release(1); } //æœ€ç»ˆä¼šè°ƒç”¨tryRelease(1);\n    public boolean isLocked() { return isHeldExclusively(); }\n\n    //æ‰“æ–­å·²ç»å¯åŠ¨çš„çº¿ç¨‹\n    void interruptIfStarted() {\n        Thread t;\n        if (getState() >= 0 && (t = thread) != null && !t.isInterrupted()) {\n            try {\n                t.interrupt();\n            } catch (SecurityException ignore) {\n            }\n        }\n    }\n}\n```\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°Workerç»§æ‰¿äº†AQSå¹¶ä¸”å®ç°äº†Runnableæ¥å£ï¼Œç„¶åå€ŸåŠ©AQSå®ç°äº†ä¸€ä¸ª`ç‹¬å çš„ä¸å¯é‡å…¥çš„é”`ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯å¾ˆå·§å¦™çš„ä¸€ç‚¹ï¼ˆè¿™é‡Œæˆ‘å’Œåšå®¢ä¸Šçš„ç†è§£æœ‰ç‚¹å‡ºå…¥ï¼‰ã€‚\n\nåˆ°è¿™é‡Œå¤§å®¶è‚¯å®šä¼šæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¦å®ç°AQSç„¶åå®ç°ä¸€ä¸ªé”ï¼Ÿæ—¢ç„¶è¦åˆä¸ºä»€ä¹ˆè¦å®ç°ä¸€ä¸ªä¸å¯é‡å…¥çš„ï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨`ReentrantLock` é‚£ä¸æ˜¯æ›´åŠ æ–¹ä¾¿ä¹ˆï¼Ÿï¼Ÿé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªå°ç»†èŠ‚å°±æ˜¯æ„é€ å™¨é‡Œé¢ä¸ºä»€ä¹ˆ`setState(-1)`  è¿™æ ·ä¸å°±è·å–ä¸åˆ°é”äº†ä¹ˆï¼Ÿï¼Ÿ\n\nå…¶å®è¿™æ˜¯ä¸ºäº†åé¢`shutdown`çš„æ—¶å€™`interruptIdleWorkers`èƒ½åˆ¤æ–­å‡ºçº¿ç¨‹æ˜¯å¦åœ¨å·¥ä½œï¼Œä»è€Œæ‰“æ–­é‚£äº›ç©ºé—²çš„çº¿ç¨‹ã€‚å¦‚æœä½¿ç”¨å¯é‡å…¥é”çš„è¯å°±æ— æ³•é€šè¿‡`tryLock()` æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœ¨å·¥ä½œã€‚è€Œ`setState(-1)` åˆ™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨ä»»åŠ¡æ²¡æœ‰å¼€å§‹å‰è¢«æ‰“æ–­\n\n### runWorker()\n\nåœ¨ä¸Šé¢`AddWorker()`æœ€åæ·»åŠ æˆåŠŸåä¼šå¯åŠ¨Workerçº¿ç¨‹ï¼Œè€Œåœ¨workerçº¿ç¨‹ä¸­runæ–¹æ³•åˆä¼šè°ƒç”¨ä¸€ä¸ª`runWorker()`æ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯å…·ä½“æ‰§è¡Œä»»åŠ¡çš„åœ°æ–¹\n\n```java\nfinal void runWorker(Worker w) {\n    //å½“å‰æ‰§è¡Œçº¿ç¨‹\n    Thread wt = Thread.currentThread();\n    //æ‹¿åˆ°ä»»åŠ¡\n    Runnable task = w.firstTask; \n    w.firstTask = null;\n    //å‰é¢æ„é€ workerçš„æ—¶å€™è®¾ç½®äº†state=-1\n    //è®¾ç½®stateä¸º0ï¼ŒtryRelease(1)\n    //å…¶å®è¿™æ ·æ˜¯ä¸ºäº†åœ¨è¿™ä¹‹å‰ä¸ä¼šè¢«æ‰“æ–­ï¼ˆè¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼‰\n    w.unlock(); // allow interrupts\n    boolean completedAbruptly = true; //æ˜¯å¦å› ä¸ºå¼‚å¸¸è€Œé€€å‡ºï¼Ÿ\n    try {\n        //taskä¸ºç©ºå°±ä»é˜»å¡é˜Ÿåˆ—ä¸­æ‹¿ä»»åŠ¡\n        while (task != null || (task = getTask()) != null) {\n            //åŠ é”ï¼Œä½†æ˜¯è¿™ä¸ªé”ä¸ä¼šå’Œå…¶ä»–çš„Workeräº’æ–¥ï¼Œè¿™ä¸ªé”åªæ˜¯ç”¨æ¥åˆ¤æ–­workeræ˜¯å¦åœ¨å·¥ä½œ\n            w.lock();\n            // If pool is stopping, ensure thread is interrupted;\n            // if not, ensure thread is not interrupted.  This\n            // requires a recheck in second case to deal with\n            // shutdownNow race while clearing interrupt\n            if ((runStateAtLeast(ctl.get(), STOP) ||\n                 (Thread.interrupted() &&\n                  runStateAtLeast(ctl.get(), STOP))) &&\n                !wt.isInterrupted())\n                //æ‰“æ–­å½“å‰æ‰§è¡Œçº¿ç¨‹wt\n                wt.interrupt();\n            try {\n                //ç©ºæ–¹æ³•äº¤ç»™å­ç±»å»å®ç°\n                beforeExecute(wt, task);\n                Throwable thrown = null;\n                try {\n                    task.run(); //æ‰§è¡Œä»»åŠ¡\n                } catch (RuntimeException x) {\n                    thrown = x; throw x;\n                } catch (Error x) {\n                    thrown = x; throw x;\n                } catch (Throwable x) {\n                    thrown = x; throw new Error(x);\n                } finally {\n                    //ç©ºæ–¹æ³•äº¤ç»™å­ç±»å»å®ç°\n                    afterExecute(task, thrown);\n                }\n            } finally {\n                task = null;\n                w.completedTasks++; //å®Œæˆä»»åŠ¡æ•°++\n                w.unlock();\n            }\n        }\n        completedAbruptly = false; //ä¸‹é¢çš„æ”¶å°¾å·¥ä½œä¼šæ ¹æ®è¿™ä¸ªåˆ¤æ–­æ˜¯å¦è°ƒæ•´çº¿ç¨‹æ•°\n    } finally {\n        processWorkerExit(w, completedAbruptly); //æ”¶å°¾å·¥ä½œ\n    }\n}\n```\n\nğŸ”¸ é¦–å…ˆè·å–äº†å‚æ•°ä¼ é€’è¿›æ¥çš„workeræºå¸¦çš„ä»»åŠ¡\n\nğŸ”¸ ç„¶åæ‰§è¡Œäº†w.unlock()ï¼Œå®é™…ä¸Šè¿™é‡Œå°±å¯¹åº”äº†ä¸Šé¢Workerç±»æ„é€ å™¨ä¸­çš„setState(-1)ï¼Œæ­£å› ä¸ºå‰é¢è®¾ç½®äº†stateä¸º -1 æ‰€ä»¥åœ¨unlock()ä¹‹å‰ï¼Œè·å¾—é”çš„CASæ“ä½œè‚¯å®šéƒ½ä¼šå¤±è´¥ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ä¸ºäº†åœ¨ä»»åŠ¡å¯åŠ¨å‰ä¸ä¼šè¢«æ‰“æ–­ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œunlock()å°±åˆå°†stateè®¾ç½®ä¸ºäº†0 ä¹Ÿå°±è¡¨ç¤ºå¯ä»¥é€šè¿‡CASè·å¾—é”äº†ï¼Œä¹Ÿå¯ä»¥è¢«shutdownæ‰“æ–­äº†ã€‚\n\nğŸ”¸ ç„¶åè¿™ä¸ªçº¿ç¨‹å°±ä¼šæ‰§è¡Œworkerä¸­çš„ä»»åŠ¡ï¼Œå¦‚æœworkerä¸­ä»»åŠ¡ä¸ºç©ºå°±ä¼šä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡\n\nğŸ”¸ è·å–åˆ°ä»»åŠ¡åè¿›å…¥å¾ªç¯å…ˆè¿›è¡Œ lock() æ“ä½œï¼Œè¿™å°±ä»£è¡¨å·²ç»å¼€å§‹æ‰§è¡Œä»»åŠ¡äº†ï¼Œè¿™ä¸ªæ—¶å€™shutdownå°±æ— æ³•å‘é€ä¸­æ–­ä¿¡å·ä¸­æ–­è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œ (æ³¨æ„è¿™ä¸ªlockå¹¶ä¸ä¼šå’Œå…¶ä»–çš„workeräº’æ–¥ï¼Œå› ä¸ºæ¯ä¸ªWorkeréƒ½æ˜¯æ–°newå‡ºæ¥çš„ï¼Œå®Œå…¨ä¸ç›¸å…³çš„ï¼Œä»–ä»¬çš„stateçŠ¶æ€éƒ½æ˜¯ç‹¬ç«‹çš„)\n\nğŸ”¸ `runStateAtLeast(ctl.get(), STOP)` è¿”å›`ctl.get() >= STOP`  ï¼Œåˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦æ­£åœ¨å…³é—­å¦‚æœæ˜¯å°±æ‰“æ–­è¯¥çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯éœ€è¦ç¡®ä¿çº¿ç¨‹ä¸æ˜¯InterruptçŠ¶æ€\n\n`If pool is stopping, ensure thread is interrupted;  if not, ensure thread is not interrupted.`\n\nğŸ”¸`beforeExecute()` å’Œ`afterExecute()` éƒ½æ˜¯ç©ºæ–¹æ³•äº¤ç»™å­ç±»å»å®ç°çš„ã€‚\n\nğŸ”¸ åˆ°finallyå—é‡Œé¢å°±ä»£è¡¨è¿™ä¸ªå·¥ä½œçº¿ç¨‹å·²ç»å¿«è¦ç»“æŸäº†ï¼Œ`processWorkerExit()`  å°±æ˜¯å¤„ç†ä¸€äº›\"åäº‹\"çš„\n\n### getTask()\n\nè¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡çš„ï¼Œå¦‚æœ `getTask()` è¿”å›nullï¼Œåœ¨`runWorker()` é‡Œé¢æ¥æ”¶åˆ°`null` åå°±ä¼š**è·³å‡ºå¾ªç¯**è¿›è€Œæ‰§è¡Œ`finally` å—é‡Œé¢çš„`processWorkerExit()` ã€‚è€Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªçº¿ç¨‹`æ‰§è¡Œç»“æŸ`äº†ï¼Œä¸ä¼šåœ¨æ‰§è¡Œä»»åŠ¡äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç­‰å¾…JVMå›æ”¶è¿™ä¸ªçº¿ç¨‹ã€‚\n\n```java\nprivate Runnable getTask() {\n    //æ˜¯å¦è¶…æ—¶ï¼Ÿå’ŒkeepAliveTimeç›¸å…³\n    boolean timedOut = false; // Did the last poll() time out?\n\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // Check if queue empty only if necessary.\n        // å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—æ²¡ä»»åŠ¡ æˆ–è€… çº¿ç¨‹çŠ¶æ€>=STOP\n        if (rs >= SHUTDOWN && (rs >= STOP || workQueue.isEmpty())) {\n            decrementWorkerCount();\n            return null;\n        }\n\n        int wc = workerCountOf(c);\n\n        // Are workers subject to culling?\n        // æ˜¯å¦å…è®¸çº¿ç¨‹è¶…æ—¶ å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶(ä¸»åŠ¨è¶…æ—¶)ï¼Ÿ æˆ–è€…wcå¤§äºäº†æ ¸å¿ƒçº¿ç¨‹æ•°(è¢«åŠ¨è¶…æ—¶)\n        boolean timed = allowCoreThreadTimeOut || wc > corePoolSize;\n\t\t//æ­¤æ—¶éœ€è¦å›æ”¶å¤šä½™çš„çº¿ç¨‹\n        if ((wc > maximumPoolSize || (timed && timedOut))\n            && (wc > 1 || workQueue.isEmpty())) {\n            if (compareAndDecrementWorkerCount(c)) //caså‡å°‘çº¿ç¨‹æ•°\n                return null; //è¿”å›null\n            continue; //caså¤±è´¥ ç»§ç»­å¾ªç¯\n        }\n\n        try {\n            //æ ¹æ®timedåˆ¤æ–­æ˜¯é™æ—¶è·å–è¿˜æ˜¯ç›´æ¥è·å–\n            Runnable r = timed ?\n                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :\n                workQueue.take(); //é˜»å¡çš„è·å–\n            if (r != null)\n                return r;\n            //æ²¡è·å–åˆ°ï¼Œè¶…æ—¶äº†\n            timedOut = true;\n        } catch (InterruptedException retry) {\n            timedOut = false;\n        }\n    }\n}\n```\n\nğŸ”¸ è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—æ²¡ä»»åŠ¡ æˆ–è€… çº¿ç¨‹çŠ¶æ€>=STOP å°±é€šè¿‡CASè‡ªæ—‹å‡å°‘çº¿ç¨‹æ•°ï¼Œç„¶åè¿”å›null\n\nğŸ”¸ åˆ¤æ–­æ˜¯å¦å…è®¸å½“å‰çº¿ç¨‹è·å–ä»»åŠ¡è¶…æ—¶ï¼Œå¦‚æœå…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶å°±ä»£è¡¨æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¶…æ—¶é™åˆ¶ï¼Œåˆæˆ–è€…æ˜¯å½“å‰çº¿ç¨‹æ•°è¶…è¿‡äº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡äº†æ‰©å®¹ï¼Œæ‰€ä»¥æ ¸å¿ƒçº¿ç¨‹ä¹‹å¤–çš„çº¿ç¨‹éƒ½æ˜¯æœ‰è¶…æ—¶é™åˆ¶çš„ã€‚\n\nğŸ”¸ å¦‚æœ â‘  wcè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°  â‘¡æ²¡è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯è¶…æ—¶äº†å¹¶ä¸”æ­¤æ—¶wc>1(ç•™ä¸€ä¸ªå¤„ç†ä»»åŠ¡)â‘¢æ²¡è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯è¶…æ—¶äº†å¹¶ä¸”é˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œæ­¤æ—¶éœ€è¦å›æ”¶å¤šä½™çš„çº¿ç¨‹\n\nğŸ”¸ æ ¹æ®timedé€‰å–ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡çš„æ–¹å¼ï¼Œè¦ä¹ˆæ˜¯é™æ—¶è·å–çš„pollæˆ–è€…ä¸€ç›´é˜»å¡çš„takeï¼Œè·å–åˆ°äº†ä¹‹åè¿”å›\n\n### processWorkerExit()\n\nçœ‹åå­—å°±çŸ¥é“æ˜¯ä¸€ä¸ªæ”¶å°¾çš„æ–¹æ³•ï¼Œæ‰§è¡Œçº¿ç¨‹ç»“æŸåçš„ä¸€äº›å¿…è¦æ”¶å°¾å·¥ä½œã€‚\n\n```java\nprivate void processWorkerExit(Worker w, boolean completedAbruptly) {\n    if (completedAbruptly) // If abrupt, then workerCount wasn't adjusted\n        //å¦‚æœæ˜¯å› ä¸ºå¼‚å¸¸è€Œé€€å‡ºåˆ™ getTask() æ²¡æœ‰æœºä¼šå»è°ƒæ•´çº¿ç¨‹æ•°æ‰€ä»¥éœ€è¦åœ¨è¿™é‡Œè°ƒæ•´\n        decrementWorkerCount();  // wc--\n\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        //å®Œæˆä»»åŠ¡æ€»æ•°+=è¯¥workerå®Œæˆçš„ä»»åŠ¡æ•°\n        completedTaskCount += w.completedTasks;\n        //ç§»é™¤å‡ºçº¿ç¨‹é›†workers\n        workers.remove(w);\n    } finally {\n        mainLock.unlock();\n    }\n    \n    //å°è¯•ç»“æŸçº¿ç¨‹æ± \n    tryTerminate();\n    \n    //è·å–ctl\n    int c = ctl.get();\n    if (runStateLessThan(c, STOP)) {\n        //éå¼‚å¸¸ç»“æŸ\n        if (!completedAbruptly) {\n            //æœ€å°å€¼æ ¹æ®æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶æ¥åˆ¤æ–­\n            int min = allowCoreThreadTimeOut ? 0 : corePoolSize;\n            if (min == 0 && ! workQueue.isEmpty())\n                min = 1; //å¦‚æœæœ€å°ä¸º0å¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºåˆ™ä¿è¯çº¿ç¨‹æ± ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™äº›ä»»åŠ¡\n            if (workerCountOf(c) >= min)\n                return; // replacement not needed\n        }\n        //1.å¼‚å¸¸ç»“æŸï¼Œæ–°å¢åŠ ä¸€ä¸ªçº¿ç¨‹åˆ°çº¿ç¨‹æ± ,ç›¸å½“äºæ›¿æ¢äº†å¼‚å¸¸çš„çº¿ç¨‹\n        //2.éå¼‚å¸¸ç»“æŸï¼Œå·¥ä½œçº¿ç¨‹å°äºæ ¸å¿ƒçº¿ç¨‹ï¼Œå¢åŠ çº¿ç¨‹ï¼Œç¡®ä¿åœ¨ä¸å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶çš„æƒ…å†µä¸‹çº¿ç¨‹æ•°ä¸å°äºcorePoolSize\n        addWorker(null, false);\n    }\n}\n```\n\n`runStateLessThan`  c < STOP è¿”å›trueå°±è¯´æ˜æ˜¯`SHUTDOWN` æˆ–è€…`RUNNING` ï¼Œåˆ°è¿™é‡Œè¯¥å·¥ä½œçº¿ç¨‹ï¼ˆWorkerï¼‰çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ã€‚\n\n### å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ\n\n![mark](http://static.imlgw.top/blog/20190803/NbjiMxDqJlu4.png?imageslim)\n\n### tryTerminate()\n\nåœ¨ä¸Šé¢çš„å¤„ç†æ”¶å°¾å·¥ä½œçš„`processWorkerExit()` çš„æ—¶å€™ä¸­é—´è°ƒç”¨äº†ä¸€ä¸ª `tryTerminate()` æ–¹æ³•\n\n```java\nfinal void tryTerminate() {\n    for (;;) {\n        int c = ctl.get();\n        //å¦‚æœæ˜¯åœ¨RUNNINGçŠ¶æ€ ç›´æ¥return\n        //å¦‚æœå·²ç»æ˜¯TIDYINGæˆ–è€…TERMINATEDçŠ¶æ€ ç›´æ¥return\n        //å¦‚æœæ˜¯SHUTDOWNçŠ¶æ€å¹¶ä¸”é˜»å¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ ç›´æ¥return\n        //returnå°±è¯´æ˜çº¿ç¨‹æ± è¿˜ä¸åˆ°å…³é—­çš„æ—¶å€™\n        if (isRunning(c) ||\n            runStateAtLeast(c, TIDYING) ||\n            (runStateOf(c) == SHUTDOWN && ! workQueue.isEmpty()))\n            return;\n        //åˆ°è¿™é‡Œå°±è¯´æ˜è¦ä¹ˆæ˜¯STOPçŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯SHUTDOWNçŠ¶æ€é˜»å¡é˜Ÿåˆ—ä¹Ÿæ²¡ä»»åŠ¡äº†\n        if (workerCountOf(c) != 0) { // Eligible to terminate\n            //ä¸­æ–­ä¸€ä¸ªç©ºé—²çš„workerçº¿ç¨‹\n            interruptIdleWorkers(ONLY_ONE);\n            return;\n        }\n\t\t\n        //wc==0 æ²¡æœ‰çº¿ç¨‹å­˜æ´»äº†\n        final ReentrantLock mainLock = this.mainLock;\n        mainLock.lock();\n        try {\n            //CASè‡ªæ—‹ ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ä¸ºTIDYING\n            if (ctl.compareAndSet(c, ctlOf(TIDYING, 0))) {\n                try {\n                    terminated(); //ç©ºæ–¹æ³•,äº¤ç»™å­ç±»å»å®ç°çš„\n                } finally {\n                    //è®¾ç½®çŠ¶æ€ä¸º TERMINATED\n                    ctl.set(ctlOf(TERMINATED, 0));\n                    //å”¤é†’terminationä¸Šawiatçš„çº¿ç¨‹\n                    termination.signalAll();\n                }\n                return;\n            }\n        } finally {\n            mainLock.unlock();\n        }\n        // else retry on failed CAS\n    }\n}\n```\n\nè¿™é‡Œæœ€åçš„`termination.signalAll()` å®é™…ä¸Šæ˜¯å”¤é†’çš„`awaitTermination()` æ–¹æ³•é˜»å¡çš„çº¿ç¨‹\n\n```java\npublic boolean awaitTermination(long timeout, TimeUnit unit)\n    throws InterruptedException {\n    long nanos = unit.toNanos(timeout);\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        for (;;) {\n            if (runStateAtLeast(ctl.get(), TERMINATED))\n                return true;\n            if (nanos <= 0)\n                return false;\n            //é™æ—¶ç­‰å¾…\n            nanos = termination.awaitNanos(nanos);\n        }\n    } finally {\n        mainLock.unlock();\n    }\n}\n```\n\n### shutdown()\n\n```java\npublic void shutdown() {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        //CASè‡ªæ—‹è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸º SHUTDOWN\n        advanceRunState(SHUTDOWN);\n        //æ‰“æ–­idle(ç©ºé—²)çš„worker\n        interruptIdleWorkers(); \n        onShutdown(); // hook for ScheduledThreadPoolExecutor\n    } finally {\n        mainLock.unlock();\n    }\n    tryTerminate();\n}\n```\n\nè¿™é‡Œå…³é”®çš„å°±æ˜¯è¿™ä¸ªæ‰“æ–­ç©ºé—²çº¿ç¨‹çš„æ“ä½œã€‚\n\n### interruptIdleWorkers()\n\næ‰“æ–­ç©ºé—²çš„workerï¼Œè¿™é‡Œçš„ç©ºé—²çº¿ç¨‹å…¶å®æŒ‡çš„å°±æ˜¯åœ¨é˜»å¡é˜Ÿåˆ—ä¸Šè·å–ä¸åˆ°ä»»åŠ¡è€Œé˜»å¡çš„çº¿ç¨‹\n\nç»è¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“Workerä¼šä¸æ–­çš„ä»é˜»å¡é˜Ÿåˆ—ä¸­å»æ‹¿ä»»åŠ¡ä¹Ÿå°±æ˜¯ `getTask()` æ–¹æ³•ï¼Œå¦‚æœé˜»å¡é˜Ÿåˆ—ä¸ºç©ºå°±ä¼šé˜»å¡ä½ ç›´åˆ°æœ‰ä»»åŠ¡æäº¤åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…æ‰§è¡Œçº¿ç¨‹è¢«ä¸­æ–­ã€‚\n\nè¿™é‡Œæˆ‘ä»¬æ˜¯è¦SHUTDOWNé‚£é˜»å¡é˜Ÿåˆ—ä¸­è‚¯å®šæ˜¯ä¸ä¼šå†æœ‰ä»»åŠ¡æäº¤ï¼Œæ‰€ä»¥`take()` ä¼šé˜»å¡ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½é€šè¿‡æ‰“æ–­æ‰§è¡Œçº¿ç¨‹çš„æ–¹å¼æ¥æ‰“æ–­`take()` æ“ä½œï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ï¼Œçº¿ç¨‹æ± æ— æ³•å…³é—­ã€‚\n\n```java\nprivate void interruptIdleWorkers(boolean onlyOne) {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock(); //åŠ é”ï¼Œå› ä¸ºWokersæ˜¯HashSetæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„\n    try {\n        for (Worker w : workers) {\n            Thread t = w.thread;\n            //æ²¡æœ‰è¢«æ‰“æ–­å¹¶ä¸”æ²¡æœ‰åœ¨å·¥ä½œ(ç©ºé—²)\n            if (!t.isInterrupted() && w.tryLock()) {\n                try {\n                    //æ‰“æ–­Workeré‡Œé¢çš„çº¿ç¨‹\n                    t.interrupt();\n                } catch (SecurityException ignore) {\n                } finally {\n                    w.unlock();\n                }\n            }\n            //åªæ‰“æ–­ä¸€ä¸ªå°±ç›´æ¥break\n            if (onlyOne)\n                break;\n        }\n    } finally {\n        mainLock.unlock();\n    }\n}\n```\n\nğŸ”¸é¦–å…ˆè·å–äº†mainLockä¿è¯äº†workersçš„çº¿ç¨‹å®‰å…¨é¿å…äº§ç”Ÿå¹¶å‘ä¿®æ”¹å¼‚å¸¸ã€‚\n\nğŸ”¸ç„¶åéå†workersï¼Œæ‰“æ–­é‚£äº›æ²¡æœ‰è¢«æ‰“æ–­å¹¶ä¸”æ²¡æœ‰å·¥ä½œçš„çº¿ç¨‹ï¼Œé‚£è¿™é‡Œæ€ä¹ˆçŸ¥é“çº¿ç¨‹æ˜¯ä¸æ˜¯åœ¨å·¥ä½œå‘¢ï¼Ÿ\n\nåˆ«å¿˜äº†å‰é¢æåˆ°çš„Workerç±»å€ŸåŠ©AQSå®ç°äº†ä¸€ä¸ª`ä¸å¯é‡å…¥`çš„`lock` æ–¹æ³•ï¼Œè€Œåœ¨workeræ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ä¼šæ‰§è¡Œ `lock` åŠ é”ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œ`tryLock()` å¦‚æœè¿”å›`true`åˆ™è¯´æ˜ å¹¶æ²¡æœ‰åœ¨å·¥ä½œå¯ä»¥æ‰“æ–­ï¼Œåä¹‹å¦‚æœæ­£åœ¨å·¥ä½œ`tryLock()` ä¸å¯é‡å…¥ï¼Œæ— æ³•è·å–åˆ°è‡ªå·±æŒæœ‰çš„é”è¿”å›falseï¼Œæ‰€ä»¥çº¿ç¨‹è‚¯å®šæ˜¯åœ¨å·¥ä½œçŠ¶æ€æ‰€ä»¥ä¸åº”è¯¥æ‰“æ–­ï¼Œè¿™äº›çº¿ç¨‹ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åè‡ªè¡Œäº†æ–­ï¼Œå› ä¸ºçº¿ç¨‹æ± çŠ¶æ€å·²ç»è®¾ç½®ä¸º`SHUTDOWN` å½“ç„¶å‰ææ˜¯è¿™äº›ä»»åŠ¡æ˜¯**å¯ç»ˆæ­¢çš„**\n\nğŸ”¸æ‰“æ–­åé‡Šæ”¾`tryLock()`è·å–åˆ°çš„é”\n\nğŸ”¸å¦‚æœåªæ‰“æ–­ä¸€ä¸ªå°±ç›´æ¥breakï¼Œå¦åˆ™å°±ç»§ç»­ä¸‹ä¸€è½®å¾ªç¯\n\nğŸ”¸é‡Šæ”¾mianLock\n\n> ççŒœ: è¿™é‡Œå¯ä»¥é€šè¿‡getStateåˆ¤æ–­çº¿ç¨‹çŠ¶æ€ä½†æ˜¯æœ‰å¯èƒ½åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿‡ä¸­é˜»å¡\n\n### shutdownNow()\n\nå’Œä¸Šé¢çš„shutdown()ä¸€æ ·éƒ½æ˜¯ç”¨æ¥å…³é—­çº¿ç¨‹æ± çš„ä½†æ˜¯çœ‹æ–¹æ³•åå°±çŸ¥é“è¿™ä¸ªæ¯”è¾ƒç²—æš´ï¼ŒshutdownNowç«‹åˆ»é©¬ä¸Šå…³é—­ï¼Œä¸€ç‚¹æƒ…é¢éƒ½ä¸ç»™ğŸ˜‚ï¼Œè™½ç„¶è¯´æ˜¯æ‰“æ–­æ‰€æœ‰çš„çº¿ç¨‹ä½†æ˜¯æ¯•ç«Ÿä½¿ç”¨çš„æ˜¯`Interrupt` ï¼Œä¹Ÿè®¸åˆ«äººæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ ¹æœ¬å°±ä¸ä¼šç†ä½ ğŸ˜‚ï¼Œæ‰€ä»¥åœ¨æäº¤ä»»åŠ¡çš„æ—¶å€™è¦å¯¹ä»»åŠ¡è¿›è¡Œæ­£ç¡®çš„interruptå“åº”ï¼Œæˆ–è€…ç¡®ä¿çº¿ç¨‹ä¸ä¼šä¸€ç›´é˜»å¡å¦åˆ™çº¿ç¨‹æ± å°±æ— æ³•æ­£å¸¸å…³é—­\n\n```java\npublic List<Runnable> shutdownNow() {\n    List<Runnable> tasks;\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        //CASè‡ªæ—‹è®¾ç½®çŠ¶æ€ä¸ºSTOP\n        advanceRunState(STOP);\n        //æ‰“æ–­æ‰€æœ‰çš„çº¿ç¨‹åŒ…æ‹¬æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹\n        interruptWorkers();\n        //æ’å¹²é˜»å¡é˜Ÿåˆ—ï¼Œå› ä¸ºå·²ç»STOPäº†ä¸ä¼šå†æ‰§è¡Œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡äº†\n        tasks = drainQueue();\n    } finally {\n        mainLock.unlock();\n    }\n    //å°è¯•å…³é—­çº¿ç¨‹æ± \n    tryTerminate();\n    return tasks;\n}\n```\n\n### interruptWorkers()\n\n```java\nprivate void interruptWorkers() {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        for (Worker w : workers)\n            //æ‰“æ–­æ‰€æœ‰å¯åŠ¨çš„çº¿ç¨‹\n            w.interruptIfStarted();\n    } finally {\n        mainLock.unlock();\n    }\n}\n```\n\næ‰“æ–­äº†æ‰€æœ‰çš„å¯åŠ¨çš„çº¿ç¨‹ï¼Œå³ä½¿ä»–ä»¬å¯èƒ½ä¸ä¼šå“åº”è¿™ä¸ªInterruptedä¿¡å·ï¼Œä½†æ˜¯ç”±äºçº¿ç¨‹æ± çŠ¶æ€å·²ç»å˜ä¸ºäº†STOPï¼Œæ‰€ä»¥ä»–ä»¬ä¹Ÿæ´»ä¸é•¿äº†(å½“ç„¶å‰ææ˜¯æ‰§è¡Œçš„ä»»åŠ¡æ˜¯å¯ä»¥ç»“æŸçš„)ï¼Œåœ¨ä¸‹ä¸€æ¬¡è·å–ä»»åŠ¡çš„æ—¶å€™å°±ä¼šç›´æ¥return ã€‚\n\n## ç»†èŠ‚æ˜¯é­”é¬¼\n\nåœ¨ç¾¤é‡Œé¢çœ‹è§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆçº¿ç¨‹æ± è¦ç”¨ çº¿ç¨‹ä¸å®‰å…¨çš„ `HashSet` ç„¶åè®¾ç½®äº†ä¸€ä¸ª `mainLock` æ§åˆ¶å¹¶å‘ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å¹¶å‘é›†åˆï¼Ÿ\n\nè¿™ä¸€ç‚¹å…¶å®åœ¨æºç çš„æ³¨é‡Šä¸­å·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼Œä¹‹å‰ä¸€ç›´æ²¡æœ‰æ³¨æ„åˆ°\n\n```java\n    /**\n     * Lock held on access to workers set and related bookkeeping.\n     * While we could use a concurrent set of some sort, it turns out\n     * to be generally preferable to use a lock. Among the reasons is\n     * that this serializes interruptIdleWorkers, which avoids\n     * unnecessary interrupt storms, especially during shutdown.\n     * Otherwise exiting threads would concurrently interrupt those\n     * that have not yet interrupted. It also simplifies some of the\n     * associated statistics bookkeeping of largestPoolSize etc. We\n     * also hold mainLock on shutdown and shutdownNow, for the sake of\n     * ensuring workers set is stable while separately checking\n     * permission to interrupt and actually interrupting.\n     */\n    private final ReentrantLock mainLock = new ReentrantLock();\n\n```\n\nä¸€å¼€å§‹è¿˜æŒºæŠ—æ‹’çš„ï¼Œæ„Ÿè§‰æœ‰çš„åœ°æ–¹æœ‰çš„çœ‹ä¸æ‡‚ï¼ˆè‹±è¯­æ¸£æ¸£ç•™ä¸‹çœ¼æ³ªï¼‰ç„¶åå»stackoverflowerä¸Šçœ‹äº†ä¸€ä¸‹æ‰¾åˆ°äº†ä¸€ä¸ªç­”æ¡ˆ  [Using ReentrantLock in ThreadPoolExecutor to ensure thread-safe workers](https://stackoverflow.com/questions/31942117/using-reentrantlock-in-threadpoolexecutor-to-ensure-thread-safe-workers) \n\nå¤§æ¦‚æ€»ç»“ä¸€ä¸‹å°±æ˜¯ä¸¤ç‚¹\n\n1. é¿å… â€œä¸­æ–­é£æš´â€ ï¼Œå¦‚æœæ˜¯ç”¨çš„æ˜¾å¼é”é‚£ä¹ˆå¦‚æœæœ‰10ä¸ªçº¿ç¨‹åŒæ—¶å»æ‰§è¡Œshutdownæ–¹æ³•ï¼Œé‚£ä¹ˆ10ä¸ªçº¿ç¨‹ä¼šæ’é˜Ÿå»æ‰§è¡Œ`interruptIdleWorkers` ï¼Œå¦‚æœä½¿ç”¨å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—çš„è¯ï¼Œåœ¨10ä¸ªçº¿ç¨‹åŒæ—¶å»æ‰§è¡Œshutdownæ–¹æ³•ï¼Œé‚£ä¹ˆè‚¯å®šä¼šåŒæ—¶å» `interruptIdleWorkers` ä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¸­æ–­é£æš´\n\n   > [ä¸­æ–­é£æš´(ç»´åŸºç™¾ç§‘)](https://en.wikipedia.org/wiki/Interrupt_storm) ä¸­æ–‡å‡ ä¹æœä¸åˆ°ç›¸å…³èµ„æ–™ï¼Œå…¶å®å°±æ˜¯å­—é¢æ„æ€ï¼Œè€Œå¤ªå¤šçš„ä¸­æ–­è¯·æ±‚ä¼šçš„å½±å“ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ï¼Œä¸å¾—ä¸è¯´å¤§å¸ˆå°±æ˜¯å¤§å¸ˆï¼Œç»†èŠ‚ä¹‹å¤„åˆ™æ›´èƒ½ä½“ç°æ°´å¹³ï¼Œæˆ‘ç­‰ä¹Ÿåªèƒ½è†œæ‹œäº†\n\n2. å¦ä¸€ç‚¹å°±æ˜¯ä¸ºäº†æ–¹ä¾¿ç»Ÿè®¡çº¿ç¨‹æ± çš„ä¸€äº›ä¿¡æ¯æ¯”å¦‚ `largestPoolSize` ç­‰ï¼Œè¿™ç‚¹ä¹Ÿå¥½ç†è§£ï¼Œä½¿ç”¨å¹¶å‘çš„Setåªèƒ½ä¿è¿™ä¸ªsetçš„å¹¶å‘å®‰å…¨ï¼Œè€Œå¯¹äºå…¶ä»–çš„ä¸€äº›çº¿ç¨‹æ± çš„ç›¸å…³çš„ä¿¡æ¯ç»Ÿè®¡èµ·æ¥å°±æ¯”è¾ƒéº»çƒ¦ï¼Œå¯èƒ½åˆéœ€è¦å¦å¤–çš„åŠ é”ï¼Œæ‰€ä»¥ç´¢æ€§å°±ç›´æ¥æä¸€ä¸ªå…¨å±€çš„é”ï¼Œä¸€ä¸¾ä¸¤å¾—\n\n## ThreadPoolExecutorä½¿ç”¨\n\n### æ„é€ æ–¹æ³•\n\n```java\npublic ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue<Runnable> workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler) {\n    if (corePoolSize < 0 ||\n        maximumPoolSize <= 0 ||\n        maximumPoolSize < corePoolSize ||\n        keepAliveTime < 0)\n        throw new IllegalArgumentException();\n    if (workQueue == null || threadFactory == null || handler == null)\n        throw new NullPointerException();\n    this.acc = System.getSecurityManager() == null ?\n            null :\n            AccessController.getContext();\n    this.corePoolSize = corePoolSize;\n    this.maximumPoolSize = maximumPoolSize;\n    this.workQueue = workQueue;\n    this.keepAliveTime = unit.toNanos(keepAliveTime);\n    this.threadFactory = threadFactory;\n    this.handler = handler;\n}\n```\n\nå…¶å®ä»ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºå¯¹å„ä¸ªå‚æ•°çš„ä¸€äº›é™åˆ¶ã€‚\n\n**corePoolSizeï¼š**æ ¸å¿ƒæ± çš„å¤§å°ï¼Œè¿™ä¸ªå‚æ•°ä¸åé¢è®²è¿°çš„çº¿ç¨‹æ± çš„å®ç°åŸç†æœ‰éå¸¸å¤§çš„å…³ç³»ã€‚åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­å¹¶æ²¡æœ‰ä»»ä½•çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…æœ‰ä»»åŠ¡åˆ°æ¥æ‰åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œé™¤éè°ƒç”¨äº†`prestartAllCoreThreads()`æˆ–è€…`prestartCoreThread()`æ–¹æ³•ï¼Œä»è¿™2ä¸ªæ–¹æ³•çš„åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œæ˜¯é¢„åˆ›å»ºçº¿ç¨‹çš„æ„æ€ï¼Œå³åœ¨æ²¡æœ‰ä»»åŠ¡åˆ°æ¥ä¹‹å‰å°±åˆ›å»ºcorePoolSizeä¸ªçº¿ç¨‹æˆ–è€…ä¸€ä¸ªçº¿ç¨‹ã€‚`é»˜è®¤æƒ…å†µä¸‹`ï¼Œåœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼Œå½“æœ‰ä»»åŠ¡æ¥ä¹‹åï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeåï¼Œå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“å­˜é˜Ÿåˆ—å½“ä¸­\n\n**maximumPoolSizeï¼š**çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œå®ƒè¡¨ç¤ºåœ¨çº¿ç¨‹æ± ä¸­æœ€å¤šå…è®¸åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹\n\n**keepAliveTime**ï¼šè¡¨ç¤ºçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶æœ€å¤šä¿æŒå¤šä¹…æ—¶é—´ä¼šç»ˆæ­¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å½“`çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶`ï¼ŒkeepAliveTimeæ‰ä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºcorePoolSizeï¼šå³å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äº`corePoolSize`æ—¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹ç©ºé—²çš„æ—¶é—´è¾¾åˆ°keepAliveTimeï¼Œåˆ™ä¼šç»ˆæ­¢ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸è¶…è¿‡corePoolSizeï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨äº†`allowCoreThreadTimeOut(boolean)`æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºcorePoolSizeæ—¶ï¼ŒkeepAliveTimeå‚æ•°ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼Œè¿™äº›å†…å®¹å…¶å®åœ¨ä¸Šé¢çš„æ·±å…¥æºç ä¸­éƒ½æœ‰è¿‡åˆ†æã€‚\n\n**unitï¼š**å‚æ•°keepAliveTimeçš„æ—¶é—´å•ä½\n\n**workQueue**ï¼šä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™ä¸ªå‚æ•°çš„é€‰æ‹©ä¼šå¯¹çº¿ç¨‹æ± çš„è¿è¡Œè¿‡ç¨‹äº§ç”Ÿé‡å¤§å½±å“\n\n**threadFactory**ï¼šçº¿ç¨‹å·¥å‚ï¼Œä¸»è¦ç”¨æ¥åˆ›å»ºçº¿ç¨‹(æ ¹æ®ä¼ è¿›æ¥çš„Runnable/Callable)\n\n**handler**ï¼šè¡¨ç¤ºå½“æ‹’ç»å¤„ç†ä»»åŠ¡æ—¶çš„ç­–ç•¥ï¼Œæœ‰ä»¥ä¸‹å››ç§å–å€¼\n\n- **ThreadPoolExecutor.AbortPolicy** ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ \n- **ThreadPoolExecutor.DiscardPolicy** ä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ \n- **ThreadPoolExecutor.DiscardOldestPolicy** ä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰\n- **ThreadPoolExecutor.CallerRunsPolicy**  ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ \n\n### çº¿ç¨‹æ± çš„å…³é—­\n\n`shutdown()`  `shutdownNow()` ï¼Œä¸Šé¢å·²ç»åˆ†æè¿‡äº†ï¼Œå°±ä¸å†è¿‡å¤šä»‹ç»äº†ã€‚\n\n### å·¥å‚æ–¹æ³•\n\nä¸Šé¢çš„æ„é€ å™¨ä¸­ä¸€å…±æœ‰7ä¸ªå‚æ•°ï¼Œå¯è§è¦æ„é€ ä¸€ä¸ªçº¿ç¨‹æ± å¹¶éé‚£ä¹ˆå®¹æ˜“ï¼Œæ‰€ä»¥jdk åœ¨`Executors` ç±»ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ„é€ ä¸€äº›ç‰¹å®šçš„çº¿ç¨‹æ± ã€‚\n\n**newCachedThreadPool()**\n\n```java\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\n```\n\nå¯ä»¥çœ‹åˆ°`core`ä¸º0ï¼Œæœ€å¤§å€¼ä¸º`Integer.MAX_VALUE`ï¼Œä»»åŠ¡é˜Ÿåˆ—ä½¿ç”¨çš„`SynchronousQueue` ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸€ä¸ªå¾ˆå¥‡è‘©çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®é™…ä¸Šå®ƒä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œæ¯ä¸ªåˆ é™¤æ“ä½œéƒ½è¦ç­‰å¾…æ’å…¥æ“ä½œï¼Œåä¹‹æ¯ä¸ªæ’å…¥æ“ä½œä¹Ÿéƒ½è¦ç­‰å¾…åˆ é™¤åŠ¨ä½œï¼Œåªæœ‰ä¸¤ä¸ªéƒ½å‡†å¤‡å¥½çš„æ—¶å€™æ‰ä¸ä¼šé˜»å¡ï¼Œæ‰€ä»¥å®ƒå†…éƒ¨ä¸ä¼šä¸ºé˜Ÿåˆ—å…ƒç´ ç»´æŠ¤ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶ä¸ä¼šç¼“å­˜ä»»åŠ¡ï¼Œä¸€æ—¦æäº¤äº†(put)ä»»åŠ¡ï¼Œè¦ä¹ˆå°±ç”±ç©ºé—²çº¿ç¨‹å»æ‰§è¡Œ(take)ï¼Œè¦ä¹ˆåˆ›å»ºä¸€æ¡æ–°çº¿ç¨‹å»æ‰§è¡Œ(take)ã€‚\n\n**newFixedThreadPool()**\n\n```java\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads,\n                                  0L, TimeUnit.MILLISECONDS,\n                                  new LinkedBlockingQueue<Runnable>());\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæœ€å¤§å€¼å’Œcoreéƒ½æ˜¯ `nThread` ï¼Œä¹Ÿå°±æ˜¯æœ€å¤š`nThread`ä¸ªçº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—é‡‡ç”¨ `LinkedBlockQueue` \n\n**newSingleThreadExecutor()**\n\n```java\npublic static ExecutorService newSingleThreadExecutor() {\n    return new FinalizableDelegatedExecutorService\n        (new ThreadPoolExecutor(1, 1,\n                                0L, TimeUnit.MILLISECONDS,\n                                new LinkedBlockingQueue<Runnable>()));\n}\n```\n\nç­‰ä»·äº`newFixedThreadPool(1)` ï¼Œä½†æ˜¯è¿™é‡Œçš„è¿”å›å€¼ç»è¿‡äº†ä¸€å±‚åŒ…è£… è¿”å›çš„ä¸å†æ˜¯`ThreadPoolExecutor` ä¹Ÿå°±æ˜¯ä¸ä¼šå†æœ‰é‚£äº›æ‰©å±•çš„monitoræ–¹æ³•\n\n> A wrapper class that exposes only the ExecutorService methods  of an ExecutorService implementation.\n>\n\nç±»ä¼¼çš„æ–¹æ³•å…¶å®è¿˜æœ‰ä¸€äº›ï¼Œåƒ`newWorkStealingPool` ç­‰ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±å»æŸ¥ä¸€æŸ¥ã€‚\n\nå…¶å®è¿™é‡Œé˜¿é‡Œå·´å·´Javaå¼€å‘è§„èŒƒå¹¶ä¸å»ºè®®ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºçº¿ç¨‹\n\n![mark](http://static.imlgw.top/blog/20190806/lMVPdlPqEPNO.png?imageslim)\n\næ‰€ä»¥å»ºè®®è¿˜æ˜¯é€šè¿‡æ„é€ å™¨çš„æ–¹å¼å»åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ ·ä¹Ÿæ›´åŠ çµæ´»æ›´åŠ å¯æ§ã€‚","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"JUCå¹¶å‘å·¥å…·åŒ…","url":"/2019/07/24/bing-fa-gong-ju-bao/","content":"\n## CountDownLatch\n\nç»“åˆå‰é¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“`Thread.join()`å¯ä»¥å®ç°ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹`ç»“æŸ`å†æ‰§è¡Œï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½å¹¶ä¸éœ€è¦ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ç»“æŸï¼Œåªéœ€è¦ç­‰å¾…ç‰¹å®šçš„æ“ä½œç»“æŸåå°±å¯ä»¥ï¼Œå¯èƒ½æœ‰äººä¼šè¯´å¯ä»¥é€šè¿‡`wait/notify`æ¨¡å‹æ¥å®ç°ï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ›´åŠ æ–¹ä¾¿çš„å·¥å…·ç±»ä¹Ÿå°±æ˜¯ `java.util.concurrent.CountDownLatch`ã€‚\n\n| Constructor and Description                                  |\n| ------------------------------------------------------------ |\n| `CountDownLatch(int count)`   æ„é€ ä¸€ä¸ªä»¥ç»™å®šè®¡æ•° `CountDownLatch` CountDownLatchã€‚ |\n\n**æ¡ˆä¾‹**\n\n```java\npublic class CountDownLatchTest {\n\n    private static Random random=new Random(System.currentTimeMillis());\n\n    private static ExecutorService executor=Executors.newFixedThreadPool(2);\n\n    private static  CountDownLatch latch;\n\n\n    public static void main(String[] args) throws InterruptedException {\n        int  []data=query();\n        //æ„é€ å™¨çš„å‚æ•°ä»£è¡¨éœ€è¦æ‰§è¡Œçš„å…ˆå†³æ¡ä»¶çš„æ•°é‡\n        latch=new CountDownLatch(data.length);\n        for (int i = 0; i <data.length ; i++) {\n            executor.execute(new SimpleRunnable(data,i,latch));\n        }\n        latch.await();\n        //å¼‚æ­¥å…³é—­\n        executor.shutdown();\n        System.out.println(\"all of works done \");\n\n    }\n\n    static class SimpleRunnable implements Runnable{\n        private final int []data;\n        private final int index;\n        private final CountDownLatch latch;\n\n\n        public SimpleRunnable(int[] data, int index, CountDownLatch latch) {\n            this.data = data;\n            this.index = index;\n            this.latch=latch;\n        }\n\n        @Override\n        public void run() {\n            try {\n                Thread.sleep(random.nextInt(2000));\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            int value=data[index];\n            if (value%2==0) {\n                data[index]=2*value;\n            }else{\n                data[index]=10*value;\n            }\n            System.out.println(Thread.currentThread().getName()+\" finished\");\n            latch.countDown();\n        }\n    }\n    \n    private static int[] query(){\n        return new int[]{1,2,3,4,5,6,7,8,9,10};\n    }\n}\n```\n\n`CountDownLatch`å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªæœªæ‰§è¡Œæ“ä½œçš„è®¡æ•°å™¨ `count`è¿™ä¸ªcountéœ€è¦é€šè¿‡æ„é€ å™¨ä¼ å…¥ï¼ŒCountDownLatch å®ä¾‹çš„countdownæ–¹æ³•æ¯æ‰§è¡Œä¸€æ¬¡`count` å°±ä¼šå‡ä¸€ ï¼Œåœ¨`count` å‡ä¸º0ä¹‹å‰`await` æ–¹æ³•çš„æ‰§è¡Œçº¿ç¨‹ä¼šè¢«æš‚åœï¼Œ\n\nç›´åˆ°`count`å‡ä¸º0çš„æ—¶å€™æ‰ä¼šè¢«å”¤é†’ç»§ç»­æ‰§è¡Œã€‚\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/24 15:09\n */\npublic class CountDownLatchTest2 {\n    private static int data;\n\n    public static void main(String[] args) throws InterruptedException {\n        final CountDownLatch latch=new CountDownLatch(4);\n\n        new Thread(() -> {\n            for (int i = 1; i <10; i++) {\n                data=i;\n                latch.countDown();\n                try {\n                    Thread.sleep(new Random().nextInt(1000));\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }).start();\n        latch.await();\n        System.out.println(\"data:\"+data);\n    }\n}\n```\n\nCountDownLatchä¼ å…¥çš„countä¸º4ï¼Œå¾ªç¯æ‰§è¡Œäº†10æ¬¡ï¼Œç»“æœæ˜¯å¤šå°‘ï¼Ÿå½“ç„¶æ˜¯4äº†ï¼Œå½“å‡ä¸º0çš„æ—¶å€™awaitè°ƒç”¨å°±ä¼šè¿”å›ä¸ä¼šå†ç­‰å¾…ï¼Œåé¢å³ä½¿countå·²ç»å‡ä¸º0å†å‡ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚\n\n### API\n\n| Modifier and Type | Method and Description                                       |\n| ----------------- | ------------------------------------------------------------ |\n| `void`            | `await()`   å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰åˆ°é”å­˜å™¨è®¡æ•°åˆ°é›¶ï¼Œé™¤éçº¿ç¨‹æ˜¯ interrupted ã€‚ |\n| `boolean`         | `await(long timeout,  TimeUnit unit)`  ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°é”å­˜å™¨è®¡æ•°åˆ°é›¶ä¸ºæ­¢ï¼Œé™¤éçº¿ç¨‹ä¸º interruptedæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚ |\n| `void`            | `countDown()`   å‡å°‘é”å­˜å™¨çš„è®¡æ•°ï¼Œå¦‚æœè®¡æ•°è¾¾åˆ°é›¶ï¼Œé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚ |\n| `long`            | `getCount()`   è¿”å›å½“å‰è®¡æ•°ã€‚                                |\n| `String`          | `toString()`   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤é”å­˜å™¨çš„å­—ç¬¦ä¸²åŠå…¶çŠ¶æ€ã€‚        |\n\n## CyclicBarrier\n\næœ‰æ—¶å€™å¤šä¸ªçº¿ç¨‹å¯èƒ½éœ€è¦ç›¸äº’ç­‰å¾…å¯¹æ–¹æ‰§è¡Œåˆ°æŸä¸€æ­¥ç„¶åå†æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚ç”Ÿæ´»ä¸­å°±æœ‰å¾ˆå¤šè¿™æ ·çš„æƒ…å½¢ï¼Ÿæ¯”å¦‚ç›¸çº¦çˆ¬å±±ï¼šå¤§å®¶çº¦å®šå¥½é›†åˆçš„åœ°ç‚¹ç„¶åç­‰æ‰€æœ‰äººåˆ°è¾¾æŒ‡å®šçš„é›†åˆåœ°ç‚¹åå†ä¸€èµ·å»ï¼Œå…ˆåˆ°è¾¾çš„äººéœ€è¦ç­‰å¾…ååˆ°è¾¾çš„äººï¼Œåªæœ‰æ‰€æœ‰äººåˆ°é½åæ‰ä¼šå‡ºå‘å»çˆ¬å±±ã€‚\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/24 15:54\n */\npublic class CyclicbarrierTest1 {\n    public static void main(String[] args){\n        CyclicBarrier cyclicBarrier=new CyclicBarrier(2);\n        new Thread(()->{\n            try {\n                //do something\n                Thread.sleep(2000);\n                System.out.println(\"t1 finished\");\n                cyclicBarrier.await();\n                System.out.println(\"other thread is done too\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } catch (BrokenBarrierException e) {\n                e.printStackTrace();\n            }\n        }).start();\n\n        new Thread(()->{\n            try {\n                //do something\n                Thread.sleep(6000);\n                System.out.println(\"t2 finished\");\n                cyclicBarrier.await();\n                System.out.println(\"other thread is done too\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } catch (BrokenBarrierException e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n```\n\nä¸Šé¢çš„ä»£ç å°±ä½“ç°äº†è¿™ç§æƒ…å†µï¼Œä¸¤ä¸ªçº¿ç¨‹å¼€å§‹å…ˆåˆ†åˆ«åšå„è‡ªçš„äº‹æƒ…ï¼Œç„¶ååˆ°è¾¾ä¸€ä¸ªç‚¹ä¹‹åï¼Œéœ€è¦ç›¸äº’ç­‰å¾…ï¼Œå…ˆåˆ°è¾¾çš„ç­‰å¾…ååˆ°è¾¾çš„ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­å¾ˆæ˜¾ç„¶ `t1` å…ˆåˆ°è¾¾å®ƒéœ€è¦ç­‰å¾…`t2` åˆ°è¾¾åæ‰èƒ½ç»§ç»­è¿è¡Œã€‚\n\nåŒæ—¶ï¼Œå¦‚æœå¤–ç•Œæ˜¯æƒ³è¦çŸ¥é“è¿™ä¸ªCyclicBarrierçš„ä»»åŠ¡æ‰§è¡Œæƒ…å†µå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­åŠ å…¥ä¸€ä¸ªå›è°ƒçš„`Runnable`\n\n```java\nCyclicBarrier cyclicBarrier=new CyclicBarrier(2,()->{\n    System.out.println(\"t1,t2 both arrived\");\n});\n```\n\nè¿™æ ·çš„æ–¹å¼è¿˜æ˜¯å¾ˆä¼˜é›…çš„ã€‚\n\nå¦‚æœç»†å¿ƒçš„è¯å…¶å®ä½ è¿˜ä¼šå‘ç°ç›¸æ¯”ä¸Šé¢çš„CountDownå¤šäº†ä¸€ä¸ªBrokenBarrierExceptionï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹doc\n\nå¦‚æœæœ‰çº¿ç¨‹æ­£åœ¨waitingè€Œ Barrierå·²ç»è¢«resetäº†\n\n> If the barrier is {@link #reset} while any thread is waiting\n>\n> or if the barrier {@linkplain #isBroken is broken} when\n>\n> {@code await} is invoked, or while any thread is waiting, then\n>\n> {@link BrokenBarrierException} is thrown.\n\nå¦‚æœæŸä¸€ä¸ªçº¿ç¨‹åœ¨waitingçš„æ—¶å€™è¢«æ‰“æ–­äº†ï¼Œé‚£ä¹ˆå…¶ä»–çš„waitingçº¿ç¨‹å°†ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸\n\n>If any thread is {@linkplain Thread#interrupt interrupted} while waiting\n>\n>then all other waiting threads will throw\n>\n>{@link BrokenBarrierException} and the barrier is placed in the broken\n>\n>state.\n\n**æºç è§£æ**\n\n`CyclicBarrier`å¹¶æ²¡æœ‰å€ŸåŠ©AQSè€Œæ˜¯åˆ©ç”¨`Condition`æ¡ä»¶å˜é‡æ¥å®ç°çš„ï¼Œå…³äº`Condition`åé¢ä¼šä»‹ç»ã€‚\n\n**doAwait()**\n\n```java\nprivate int dowait(boolean timed, long nanos)\n    throws InterruptedException, BrokenBarrierException,\n           TimeoutException {\n    final ReentrantLock lock = this.lock;\n    lock.lock(); //åŠ é”\n    try {\n        final Generation g = generation;\n\n        if (g.broken)\n            throw new BrokenBarrierException();\n\n        if (Thread.interrupted()) {\n            breakBarrier();\n            throw new InterruptedException();\n        }\n\n        int index = --count; //å’ŒcountDownLatchç±»ä¼¼\n        if (index == 0) {  // tripped æ‰€æœ‰çº¿ç¨‹éƒ½æŠµè¾¾äº†\n            boolean ranAction = false;\n            try {\n                final Runnable command = barrierCommand; \n                if (command != null)\n                    command.run(); //æ‰§è¡Œæ„é€ å™¨ä¸­ä¼ å…¥çš„CallBack\n                ranAction = true;\n                nextGeneration(); //ä¸‹ä¸€ä¸ªè½®å›\n                return 0;\n            } finally {\n                if (!ranAction)\n                    breakBarrier();\n            }\n        }\n\n        // loop until tripped, broken, interrupted, or timed out\n        for (;;) {\n            try {\n                if (!timed)\n                    trip.await();\n                else if (nanos > 0L)\n                    nanos = trip.awaitNanos(nanos);\n            } catch (InterruptedException ie) {\n                if (g == generation && ! g.broken) {\n                    breakBarrier();\n                    throw ie;\n                } else {\n                    // We're about to finish waiting even if we had not\n                    // been interrupted, so this interrupt is deemed to\n                    // \"belong\" to subsequent execution.\n                    Thread.currentThread().interrupt();\n                }\n            }\n\n            if (g.broken)\n                throw new BrokenBarrierException();\n\n            if (g != generation)\n                return index;\n\n            if (timed && nanos <= 0L) {\n                breakBarrier();\n                throw new TimeoutException();\n            }\n        }\n    } finally {\n        lock.unlock();\n    }\n}\n```\n **nextGeneration()** \n\n```java\nprivate void nextGeneration() {\n    // signal completion of last generation\n    trip.signalAll(); //å”¤é†’è¿™ä¸ªbarrierä¸Šæ‰€æœ‰çš„ç­‰å¾…çº¿ç¨‹ï¼Œtripæ˜¯ä¸€ä¸ªcondition\n    // set up next generation\n    count = parties; //countå¤ä½\n    generation = new Generation();\n}\n```\n\nå…¶å®ä¹Ÿå¯ä»¥ç”¨CountDownLatchå®ç°å’ŒCyclicBarrierç±»ä¼¼çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸å†æ¼”ç¤ºã€‚\n\n### API\n\n| Modifier and Type | Method and Description                                       |\n| ----------------- | ------------------------------------------------------------ |\n| `int`             | `await()`   ç­‰å¾…æ‰€æœ‰ partiesåˆ°è¾¾å±éšœï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªéšœç¢ä¸Šè°ƒç”¨`await` ã€‚ |\n| `int`             | `await(long timeout,  TimeUnit unit)`  ç­‰å¾…æ‰€æœ‰ partieså·²ç»åœ¨æ­¤å±éšœä¸Šè°ƒç”¨  `await` ï¼Œæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚ |\n| `int`             | `getNumberWaiting()`   è¿”å›ç›®å‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹çš„æ•°é‡ã€‚        |\n| `int`             | `getParties()`   è¿”å›parties                                 |\n| `boolean`         | `isBroken()`   æŸ¥è¯¢è¿™ä¸ªéšœç¢æ˜¯å¦å¤„äºBroken                    |\n| `void`            | `reset()`   å°†å±éšœé‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚                           |\n\n### åŒºåˆ«\n\n- `CountDownLatch`ä¸èƒ½`reset`ï¼ˆé€’å‡åˆ°0åä¸èƒ½å¤åŸï¼‰ï¼Œ`CyclicBarrier`æ­£å¦‚å…¶åæ˜¯å¯ä»¥å¾ªç¯ä½¿ç”¨çš„ã€‚\n\n- `CountDownLatch`å·¥ä½œçº¿ç¨‹ä¹‹é—´äº’ä¸å…³å¿ƒï¼Œ`CyclicBarrier`æ‰€æœ‰çº¿ç¨‹å¿…é¡»åˆ°è¾¾ä¸€ä¸ªå…±åŒçš„ç‚¹æ‰ä¼šç»§ç»­æ‰§è¡Œ\n\n## Exchanger\n\nJDK1.5å¼•å…¥çš„ï¼Œçœ‹åå­—å°±çŒœå¾—åˆ°å¤§æ¦‚æ˜¯å¹²å˜›çš„ï¼Œä¸»è¦å°±æ˜¯ç”¨äº`ä¸¤ä¸ªçº¿ç¨‹` ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œå…¶å®ä¹Ÿå°±ç›¸å½“äºåªæœ‰ä¸¤ä¸ªå‚ä¸æ–¹çš„`CyclicBarrier` å½“ä¸¤ä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°`exchanger point` (é›†åˆç‚¹) å°±ä¼šè¿›è¡Œæ•°æ®çš„äº¤æ¢ï¼Œ`ä¸€æ‰‹äº¤é’±ï¼Œä¸€æ‰‹äº¤è´§` æ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿè¦æ³¨æ„ä¸¤ä¸ªçº¿ç¨‹èƒ½å¦æ­£ç¡®çš„åˆ°è¾¾`exchanger point` å¦‚æœæœ‰ä¸€æ–¹æ— æ³•åˆ°è¾¾åˆ™å¦ä¸€æ–¹å°±ä¼šé™·å…¥ç­‰å¾…ï¼Œå½“ç„¶ä½ å¯ä»¥åŠ ä¸Štimeoutã€‚å¦å¤–è¿™ä¸ªåªé€‚ç”¨ä¸ä¸¤ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæœ‰2ä¸ªä»¥ä¸Šçš„çº¿ç¨‹å‚ä¸å°†ä¼šé€ æˆæ•°æ®ä¼ è¾“æ··ä¹±ï¼Œæ— æ³•æ§åˆ¶ã€‚\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/25 13:54\n */\npublic class ExchangerTest1 {\n    public static void main(String[] args) {\n        final Exchanger<String> exchanger=new Exchanger<>();\n        new Thread(()->{\n            System.out.println(Thread.currentThread().getName()+\" start\");\n            try {\n                String res = exchanger.exchange(\"i am  A\",10,TimeUnit.SECONDS);\n                System.out.println(\"back msg=\" +res);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } catch (TimeoutException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName()+\"done\");\n        }).start();\n\n\n        new Thread(()->{\n            System.out.println(Thread.currentThread().getName()+\" start\");\n            try {\n                String res = exchanger.exchange(\"i am  B\");\n                System.out.println(\"back msg=\" +res);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName()+\"done\");\n        });\n    }\n}\n```\n\n### çº¿ç¨‹å®‰å…¨é—®é¢˜\n\nç¡®å®Exchangerå¦‚æœä½¿ç”¨ä¸å½“ä¼šé€ æˆå¾ˆå¤šé—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦è°¨æ…ï¼Œé¦–å…ˆå®ƒåªé€‚ç”¨ä¸ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œå…¶æ¬¡è¿™é‡Œä¼ è¾“çš„å¯¹è±¡æ˜¯`åŒä¸€ä¸ª` ï¼Œä¹Ÿå°±æ˜¯è¯´å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„å¯¹è±¡å†…å­˜åœ°å€æ˜¯ä¸€æ ·çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/25 15:14\n */\npublic class ExchangerTest2 {\n    public static void main(String[] args) {\n        final Exchanger<Simple> exchanger=new Exchanger<>();\n        new Thread(()->{\n            Simple simple = new Simple(1);\n            System.out.println(Thread.currentThread().getName()+\" start. send to B\"+simple);\n            try {\n                Simple res = exchanger.exchange(simple);\n                //ä¼‘çœ 10s\n                TimeUnit.SECONDS.sleep(3);\n                System.out.println(\"A receive from B obj:\"+res +\" data:\"+res.a);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName()+\" done\");\n        },\"A\").start();\n\n        new Thread(()->{\n            Simple simple = new Simple(2);\n            System.out.println(Thread.currentThread().getName()+\" start. send to A:\"+simple);\n            try {\n                Simple res = exchanger.exchange(simple);\n                //ä¿®æ”¹å‘é€å‡ºå»çš„obj\n                simple.setA(100000);\n                System.out.println(\"B receive from A obj:\"+res +\" data:\"+res.a);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName()+\" done\");\n        },\"B\").start();\n    }\n\n    static class Simple{\n        private int a;\n\n        public Simple(int a) {\n            this.a = a;\n        }\n\n        public int getA() {\n            return a;\n        }\n\n        public void setA(int a) {\n            this.a = a;\n        }\n    }\n}\n```\n\n**ç»“æœ**\n\n```java\nA start. send to Bjuc_study.tools.Exchanger.ExchangerTest2$Simple@72d6db17\nB start. send to A:juc_study.tools.Exchanger.ExchangerTest2$Simple@4295c176\nB receive from A obj:juc_study.tools.Exchanger.ExchangerTest2$Simple@72d6db17 data:1\nB done\nA receive from B obj:juc_study.tools.Exchanger.ExchangerTest2$Simple@4295c176 data:100000\nA done\n```\n\nä¸¤ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡å¹¶ä¸æ˜¯æ‹·è´ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶çš„å»æ“ä½œè¿™ä¸ªå¯¹è±¡è¿™å…¶å®æ˜¯å¾ˆå±é™©çš„å¾ˆæœ‰å¯èƒ½å°±ä¼šäº§ç”Ÿä¸€äº›çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„\n\n## Semaphore\n\nä¿¡å·é‡ï¼Œç›¸ä¿¡å­¦è¿‡æ“ä½œç³»ç»Ÿçš„åŒå­¦è‚¯å®šå¯¹è¿™ä¸ªå¾ˆç†Ÿæ‚‰äº†ï¼Œç†Ÿæ‚‰PVæ“ä½œçš„è¯è¿™ä¸ªä¸€çœ‹å°±æ‡‚äº†ã€‚\n\n| Constructor and Description                                  |\n| ------------------------------------------------------------ |\n| `Semaphore(int permits)`   åˆ›å»ºä¸€ä¸ª `Semaphore`ä¸ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œé»˜è®¤éå…¬å¹³é” |\n| `Semaphore(int permits,  boolean fair)`  åˆ›å»ºä¸€ä¸ª `Semaphore`ä¸ç»™å®šæ•°é‡çš„è®¸å¯è¯å’Œæ˜¯å¦å…¬å¹³ |\n\n### Semaphoreå®ç°ä¸€ä¸ªæ˜¾ç¤ºé”\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/25 15:48\n */\npublic class SemaphoreTest1 {\n    public static void main(String[] args) {\n        final SemaphoreLock semaphoreLock=new SemaphoreLock();\n\n        new Thread(()->{\n            try {\n                semaphoreLock.lock();\n                System.out.println(Thread.currentThread().getName()+\" get the lock\");\n                TimeUnit.SECONDS.sleep(4);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }finally {\n                semaphoreLock.unlock();\n                System.out.println(Thread.currentThread().getName()+\"release the lock\");\n            }\n\n        }).start();\n\n        new Thread(()->{\n            try {\n                semaphoreLock.lock();\n                System.out.println(Thread.currentThread().getName()+\" get the lock\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }finally {\n                semaphoreLock.unlock();\n                System.out.println(Thread.currentThread().getName()+\"release the lock\");\n            }\n\n        }).start();\n    }\n\n    static class SemaphoreLock{\n        private final  Semaphore semaphore =new Semaphore(1);\n\n        private void lock() throws InterruptedException {\n            semaphore.acquire();\n        }\n\n        public void unlock(){\n            semaphore.release();\n        }\n    }\n}\n```\n\n### å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹\n\nç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹å…¶å®ä¹ŸæŒºé‡è¦çš„ï¼Œæœ‰æ—¶å€™é¢è¯•ä¼šè®©ä½ æ‰‹å†™ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å…¶å®æœ‰å®ç°è¿‡ä¸€ä¸ªä½†æ˜¯é‚£ä¸ªå…¶å®è¿˜æ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªï¼Œé‚£ä¸ªæ˜¯æ²¡æœ‰Bufferçš„ï¼Œä¸‹é¢è¿™ä¸ªç”¨ä¿¡å·é‡å®ç°çš„å°±æ˜¯æœ‰Bufferçš„ï¼Œåé¢ä¼šå•ç‹¬æ•´ç†å‡ºæ‰€æœ‰çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„å®ç°æ–¹æ³•ã€‚\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/25 16:43\n */\npublic class ProduceConsumerV4 {\n    public static void main(String[] args) {\n        ProduceConsumerV4 pc = new ProduceConsumerV4();\n        Stream.of(\"Produce1\", \"Produce2\", \"Produce3\", \"Produce4\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.produce();\n                }\n            }, n).start();\n        });\n        Stream.of(\"Consumer1\", \"Consumer2\", \"Consumer3\", \"Consumer4\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.consumer();\n                }\n            }, n).start();\n        });\n    }\n\t\n    //bufferè½½ä½“\n    private LinkedList<Object> buffer=new LinkedList<>();\n\n    private final Semaphore full = new Semaphore(0);\n\t\n    //bufferæœ€å¤§å€¼\n    private final Semaphore empty = new Semaphore(3);\n\n    //äº’æ–¥é”\n    private final Semaphore mutex= new Semaphore(1);\n\n    public void produce() {\n        //å·²ç»ç”Ÿäº§äº†\n        try {\n            empty.acquire();\n            //ä¸èƒ½å’Œä¸Šé¢çš„ä¿¡å·é‡äº¤æ¢\n            mutex.acquire();\n            buffer.add(new Object());\n            System.out.println(Thread.currentThread().getName() + \" produce a obj , current list size:\" +buffer.size());\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            mutex.release();\n            full.release();\n        }\n    }\n\n    public void consumer() {\n        try {\n            full.acquire();\n            mutex.acquire();\n            //ç§»é™¤æœ€åä¸€ä¸ª\n            buffer.removeLast();\n            System.out.println(Thread.currentThread().getName() + \" consumer a obj, current size: \" + buffer.size());//consumer\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            mutex.release();\n            empty.release();\n        }\n    }\n}\n```\n\n### API\n\n| Modifier and Type              | Method and Description                                       |\n| ------------------------------ | ------------------------------------------------------------ |\n| `void`                         | `acquire()`   ä»è¯¥ä¿¡å·é‡è·å–è®¸å¯è¯ï¼Œé˜»å¡ç›´åˆ°è·å–åˆ°ï¼Œå¯ä»¥è¢«interrupt |\n| `void`                         | `acquire(int permits)`   ä»è¯¥ä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œé˜»å¡ç›´åˆ°è·å–åˆ°å¯ä»¥è¢«interrupt |\n| `void`                         | `acquireUninterruptibly()`  ä»è¯¥ä¿¡å·é‡è·å–è®¸å¯è¯ï¼Œé˜»å¡ç›´åˆ°è·å–åˆ°ï¼Œæ— è§†interruptï¼Œä¸ä¼šè¢«interrupt |\n| `void`                         | `acquireUninterruptibly(int permits)`   ä»è¯¥ä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œé˜»æ­¢ç›´åˆ°è·å–åˆ°ï¼Œä¸å¯è¢«interruptã€‚ |\n| `int`                          | `availablePermits()`   è¿”å›æ­¤ä¿¡å·é‡ä¸­å½“å‰å¯ç”¨çš„è®¸å¯æ•°ã€‚      |\n| `int`                          | `drainPermits()`   è·å–å¹¶è¿”å›æ‰€æœ‰å¯ç«‹å³è·å¾—çš„è®¸å¯è¯ã€‚        |\n| `protected Collection<Thread>` | `getQueuedThreads()`   è¿”å›ä¸€ä¸ªåŒ…å«`å¯èƒ½`æ­£åœ¨ç­‰å¾…è·å–çš„çº¿ç¨‹çš„é›†åˆã€‚ |\n| `int`                          | `getQueueLength()`   è¿”å›ç­‰å¾…è·å–çš„çº¿ç¨‹æ•°çš„ä¼°è®¡å€¼ã€‚          |\n| `boolean`                      | `hasQueuedThreads()`   æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹ç­‰å¾…è·å–ã€‚              |\n| `boolean`                      | `isFair()`   æ˜¯ä¸æ˜¯å…¬å¹³é”                                    |\n| `protected void`               | `reducePermits(int reduction)`   ç¼©å°å¯ç”¨è®¸å¯è¯çš„æ•°é‡ã€‚      |\n| `void`                         | `release()`   é‡Šæ”¾è®¸å¯è¯ï¼Œå°†å…¶è¿”å›åˆ°ä¿¡å·é‡ã€‚(0çš„æ—¶å€™ä¹Ÿå¯ä»¥release) |\n| `void`                         | `release(int permits)`   é‡Šæ”¾ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œå°†å…¶è¿”å›åˆ°ä¿¡å·é‡ã€‚ |\n| `String`                       | `toString()`   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤ä¿¡å·é‡çš„å­—ç¬¦ä¸²åŠå…¶çŠ¶æ€ã€‚        |\n| `boolean`                      | `tryAcquire()`   ä»è¿™ä¸ªä¿¡å·é‡è·å¾—è®¸å¯è¯ï¼Œç«‹å³è¿”å›ï¼Œä¸ä¼šé˜»å¡ã€‚ |\n| `boolean`                      | `tryAcquire(int permits)`   ä»è¿™ä¸ªä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œä¸ä¼šé˜»å¡ |\n| `boolean`                      | `tryAcquire(int permits,  long timeout, TimeUnit unit)`  ä»è¯¥ä¿¡å·é‡è·å–ç»™å®šæ•°é‡çš„è®¸å¯è¯ï¼Œå¦‚æœåœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´è·å–åˆ°ï¼Œå°±è¿”å›trueï¼Œå¯ä»¥è¢«æ‰“æ–­ |\n| `boolean`                      | `tryAcquire(long timeout,  TimeUnit unit)`  ä»è¯¥ä¿¡å·é‡è·å–è®¸å¯è¯ï¼Œå¦‚æœåœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´è·å–åˆ°ï¼Œå°±è¿”å›trueï¼Œå¯ä»¥è¢«æ‰“æ–­ |\n\n## Lock\n\né€šå¸¸è¢«ç§°ä¸ºæ˜¾å¼é”ï¼Œä¸ä¹‹å¯¹åº”çš„`synchroized` åˆ™è¢«ç§°ä¸ºå†…éƒ¨é”ï¼Œæ˜¾å¼é”æ˜¯jdk1.5å¼•å…¥çš„é”ï¼Œä»–çš„ä½œç”¨ä¸å†…éƒ¨é”ç›¸åŒï¼Œä½†æ˜¯å®ƒçš„åŠŸèƒ½æ¯”å†…éƒ¨é”æ›´åŠ å¼ºå¤§ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å†…éƒ¨é”çš„æ›¿ä»£å“ï¼Œå…¶å®åœ¨ä¹‹å‰çš„ [Javaå¤šçº¿ç¨‹åŸºç¡€](http://imlgw.top/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/#LOCK%E6%8E%A5%E5%8F%A3)  ä¸€æ–‡ä¸­å°±æ‰‹å†™è¿‡ä¸€ä¸ªå¸¦æœ‰`é™æ—¶ç­‰å¾…`çš„é” ï¼Œé‚£ä¸ªå…¶å®å°±æ˜¯æ¨¡ä»¿çš„`Lock` æ¥å£\n\n### ReentrantLock\n\nReentrantLockæ˜¯Lockæ¥å£çš„ä¸€ä¸ªå®ç°ç±»ä¹Ÿæ˜¯ç”¨çš„æœ€å¤šçš„ä¸€ä¸ªå®ç°ç±»ï¼Œ`Reentrant` æœ¬æ„å°±æ˜¯ å¯é‡å…¥çš„ï¼Œå¯å†å…¥çš„ï¼Œ è¡¨ç¤ºå½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å–ä¸€ä¸ªå®ƒå·²ç»è·å–çš„é”æ—¶ï¼Œè¿™ä¸ªè·å–åŠ¨ä½œå°±è‡ªåŠ¨æˆåŠŸï¼Œ`synchnorized`ä¹Ÿæ˜¯å¯é‡å…¥çš„ã€‚\n\n| Constructor and Description                                  |\n| ------------------------------------------------------------ |\n| `ReentrantLock()`   åˆ›å»ºä¸€ä¸ª `ReentrantLock`çš„å®ä¾‹ã€‚         |\n| `ReentrantLock(boolean fair)`   æ ¹æ®ç»™å®šçš„å…¬å¹³ç­–ç•¥åˆ›å»ºä¸€ä¸ª `ReentrantLock`çš„å®ä¾‹ã€‚ |\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/25 20:07\n */\npublic class ReentrantLockTest1 {\n\n    private static final ReentrantLock lock = new ReentrantLock();\n\n    public static void main(String[] args) throws InterruptedException {\n        Thread thread0 = new Thread(() -> needLock() );\n        Thread thread1 = new Thread(() -> needLock() );\n        thread0.start();\n        thread1.start();\n        TimeUnit.SECONDS.sleep(3);\n        thread1.interrupt();\n    }\n\n    public static void needLock() {\n        try {\n            //å¯æ‰“æ–­çš„è·å–é”\n            lock.lockInterruptibly();\n            System.out.println(Thread.currentThread().getName()+\" is get the lock\");\n            while (true){\n\t\t\t\t//ç©ºè½¬\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }finally {\n            lock.unlock(); //ç¡®ä¿é”çš„é‡Šæ”¾\n        }\n    }\n}\n```\n\n**æµ‹è¯•ç»“æœ**\n\n```java\nThread-0 is get the lock\njava.lang.InterruptedException\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchronizer.java:898)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1222)\n\tat java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:335)\n\tat juc_study.tools.Lock.ReentrantLockTest1.needLock(ReentrantLockTest1.java:26)\n\tat juc_study.tools.Lock.ReentrantLockTest1.lambda$main$1(ReentrantLockTest1.java:16)\n\tat java.lang.Thread.run(Thread.java:748)\nException in thread \"Thread-1\" java.lang.IllegalMonitorStateException\n\tat java.util.concurrent.locks.ReentrantLock$Sync.tryRelease(ReentrantLock.java:151)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.release(AbstractQueuedSynchronizer.java:1261)\n\tat java.util.concurrent.locks.ReentrantLock.unlock(ReentrantLock.java:457)\n\tat juc_study.tools.Lock.ReentrantLockTest1.needLock(ReentrantLockTest1.java:34)\n\tat juc_study.tools.Lock.ReentrantLockTest1.lambda$main$1(ReentrantLockTest1.java:16)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n\n#### API\n\n| Modifier and Type              | Method and Description                                       |\n| ------------------------------ | ------------------------------------------------------------ |\n| `int`                          | `getHoldCount()`  å½“å‰çº¿ç¨‹è°ƒç”¨lock()çš„æ¬¡æ•° (é‡å…¥çš„æ¬¡æ•°)      |\n| `protected Thread`             | `getOwner()`   è¿”å›å½“å‰æ‹¥æœ‰æ­¤é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¿”å› `null` ã€‚ |\n| `protected Collection<Thread>` | `getQueuedThreads()`   è¿”å›åŒ…å«å¯èƒ½æ­£åœ¨ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹çš„é›†åˆã€‚ |\n| `int`                          | `getQueueLength()`   è¿”å›ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹æ•°çš„ä¼°è®¡å€¼ã€‚      |\n| `protected Collection<Thread>` | `getWaitingThreads(Condition condition)`   è¿”å›åŒ…å«å¯èƒ½åœ¨ä¸æ­¤é”ç›¸å…³è”çš„ç»™å®šæ¡ä»¶ä¸‹ç­‰å¾…çš„çº¿ç¨‹çš„é›†åˆã€‚ |\n| `int`                          | `getWaitQueueLength(Condition condition)`   è¿”å›ä¸æ­¤é”ç›¸å…³è”çš„ç»™å®šæ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹æ•°çš„ä¼°è®¡ã€‚ |\n| `boolean`                      | `hasQueuedThread(Thread thread)`  æŸ¥è¯¢ç»™å®šçº¿ç¨‹æ˜¯å¦ç­‰å¾…è·å–æ­¤é”ã€‚ |\n| `boolean`                      | `hasQueuedThreads()`   æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–æ­¤é”ã€‚      |\n| `boolean`                      | `hasWaiters(Condition condition)`   æŸ¥è¯¢ä»»ä½•çº¿ç¨‹æ˜¯å¦ç­‰å¾…ä¸æ­¤é”ç›¸å…³è”çš„ç»™å®šæ¡ä»¶ã€‚ |\n| `boolean`                      | `isFair()`   å¦‚æœæ­¤é”çš„å…¬å¹³è®¾ç½®ä¸ºtrueï¼Œåˆ™è¿”å› `true` ã€‚      |\n| `boolean`                      | `isHeldByCurrentThread()`   æŸ¥è¯¢æ­¤é”æ˜¯å¦ç”±å½“å‰çº¿ç¨‹æŒæœ‰ã€‚     |\n| `boolean`                      | `isLocked()`   æŸ¥è¯¢æ­¤é”æ˜¯å¦ç”±ä»»ä½•çº¿ç¨‹æŒæœ‰ã€‚                  |\n| `void`                         | `lock()`   è·å¾—é”ï¼Œä¸èƒ½è¢«æ‰“æ–­                                |\n| `void`                         | `lockInterruptibly()`   è·å¾—é”ï¼Œå¯ä»¥è¢«æ‰“æ–­                   |\n| `Condition`                    | `newCondition()`   è¿”å›`Condition`ç”¨äºè¿™ç§ç”¨é€”å®ä¾‹`Lock`å®ä¾‹ã€‚ |\n| `String`                       | `toString()`   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤é”çš„å­—ç¬¦ä¸²ä»¥åŠå…¶é”å®šçŠ¶æ€ã€‚      |\n| `boolean`                      | `tryLock()`   å°è¯•è·å–è¯¥é”ï¼Œä¸ä¼šé˜»å¡ï¼Œç›´æ¥è¿”å›ï¼Œ             |\n| `boolean`                      | `tryLock(long timeout,  TimeUnit unit)`  å°è¯•åœ¨ç»™å®šæ—¶é—´å†…è·å–é”ï¼Œå¯ä»¥è¢«æ‰“æ–­ |\n| `void`                         | `unlock()`   é‡Šæ”¾é”ã€‚                                        |\n\n### ReadWriteLock\n\nçœ‹åå­—å°±çŸ¥é“æ˜¯å¹²å•¥çš„äº†ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨ [å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼](http://imlgw.top/2019/04/09/java-duo-xian-cheng-li-mian-de-she-ji-mo-shi/#%E8%AF%BB%E5%86%99%E9%94%81%E5%88%86%E7%A6%BB%E6%A8%A1%E5%BC%8F) ä¸­ä¹Ÿæåˆ°äº†è¯»å†™é”ï¼Œå¹¶ä¸”å®ç°äº†ä¸€ä¸ªç®€æ˜“çš„è¯»å†™é”ã€‚\n\n**è¯»å†™é”æ¡ˆä¾‹**\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/26 12:15\n */\npublic class ReadWriteLockTest1 {\n\n    private final static ReentrantReadWriteLock readWriteLock=new ReentrantReadWriteLock(false);\n\n    private final static Lock readLock=readWriteLock.readLock();\n\n    private final static Lock writeLock=readWriteLock.writeLock();\n\n    private  static final List<Long> data=new ArrayList<>();\n\n    public static void main(String[] args) {\n        Thread thread0 = new Thread(() -> write());\n        thread0.start();\n\n        Thread thread1 = new Thread(() -> read());\n        thread1.start();\n\n        Thread thread2 = new Thread(() -> read());\n        thread2.start();\n    }\n\n    public static void write(){\n        try {\n            writeLock.lock();\n            data.add(System.currentTimeMillis());\n            TimeUnit.SECONDS.sleep(5);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            writeLock.unlock();\n        }\n    }\n\n    public static void read(){\n        try {\n            readLock.lock();\n            data.forEach(System.out::println);\n            TimeUnit.SECONDS.sleep(5);\n            System.out.println(Thread.currentThread().getName()+\" ====\");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            readLock.unlock();\n        }\n    }\n}\n```\n\n### æ˜¾å¼é”å¯¹æ¯”å†…éƒ¨é”\n\næ˜¾å¼é”å’Œå†…éƒ¨é”éƒ½å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œè°ä¹Ÿä¸èƒ½æ›¿ä»£è°ï¼ˆè¿™é‡Œçš„æ˜¾å¼é”ä¸»è¦æŒ‡`ReentrantLock`ï¼‰ã€‚\n\n**ç‰¹æ€§ä¸Š**\n\n- æ˜¾å¼é”æ”¯æŒå…¬å¹³é”ï¼ˆæ˜¾å¼é”ï¼Œå†…éƒ¨é”é»˜è®¤éƒ½æ˜¯éå…¬å¹³çš„ï¼‰\n- æ˜¾å¼é”å¯ä»¥`tryLock()`æ— éœ€ç­‰å¾…ï¼Œå†…éƒ¨é”åªèƒ½ä¸€ç›´ç­‰å¾…é”é‡Šæ”¾\n\n- æ˜¾å¼é”æœ‰å¸¦è¶…æ—¶çš„`tryLock(long timeout,  TimeUnit unit)`ã€‚\n- æ˜¾å¼é”å¯ä»¥å“åº”ä¸­æ–­è¯·æ±‚ `lockInterruptibly()`\n- æ˜¾å¼é”æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å¯¹é”çš„ç›¸å…³ä¿¡æ¯ç›‘æ§ï¼Œå†…éƒ¨é”åˆ™æ²¡æœ‰\n- .........\n\n**æ€§èƒ½ä¸Š**\n\nå…¶å®å¾ˆå¤šäººä¼šè®¤ä¸º`synchronized`æ€§èƒ½å¾ˆå·®ï¼Œä¸å¦‚æ˜¾å¼é”\n\n- jdk1.5ä¸­ï¼Œåœ¨é«˜äº‰ç”¨çš„æƒ…å†µä¸‹ï¼Œç¡®å®æ˜¾å¼é”è¦ä¼˜äºå†…éƒ¨é”\n- jdk1.5ä¹‹åï¼Œ å¯¹å†…éƒ¨é”è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ **é”æ¶ˆé™¤**ï¼Œ**é”ç²—åŒ–**ï¼Œ**åå‘é”**ï¼Œå’Œ**é€‚åº”æ€§é”** (è¿™äº›ä¼˜åŒ–åé¢çš„æ–‡ç« ä¼šå†åšè§£é‡Š) ã€‚è¿™äº›ä¼˜åŒ–ä½¿å¾—å†…éƒ¨é”çš„æ€§èƒ½æå‡äº†å¾ˆå¤šï¼Œç”šè‡³åœ¨ä½äº‰ç”¨æƒ…å†µä¸‹æ€§èƒ½è¿˜è¦ä¼˜äº æ˜¾å¼é”ã€‚\n\n**ä½¿ç”¨ä¸Š**\n\n- Lockä¸æ˜¯Javaè¯­è¨€å†…ç½®çš„ï¼Œsynchronizedæ˜¯Javaè¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ã€‚Lockæ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—®ã€‚\n\n- Lockå’Œsynchronizedæœ‰ä¸€ç‚¹éå¸¸å¤§çš„ä¸åŒï¼Œé‡‡ç”¨synchronizedä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“synchronizedæ–¹æ³•æˆ–è€…synchronizedä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ï¼Œè€ŒLockåˆ™å¿…é¡»è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡ã€‚\n\nå…¶å®å¾ˆæ˜æ˜¾å†…éƒ¨é”ç›¸æ¯”æ˜¾å¼é”ä½¿ç”¨èµ·æ¥è¦ç®€å•æ˜“ç”¨ï¼Œæ‰€ä»¥ä¿å®ˆä¸€ç‚¹é»˜è®¤ä¼˜å…ˆä½¿ç”¨å†…éƒ¨é”ï¼Œåœ¨éœ€è¦æ˜¾å¼é”çš„ç‰¹æ€§çš„æ—¶å€™å†é€‰ç”¨æ˜¾å¼é”ã€‚\n\n## Condition\n\nConditionå¯¹åº”çš„å…¶å®å°±æ˜¯æ˜¾å¼é”çš„é€šä¿¡æ–¹æ³•ï¼Œ`Lock.newCondition()` è¿”å›çš„å°±æ˜¯ä¸€ä¸ªConditionå®ä¾‹ \n\n`Condition`æ¥å£çš„`await()/signal()`  å…¶å®å°±å¯¹åº”äº† `synchronize` çš„ `wait()/notify()` ï¼Œä½†æ˜¯ç›¸å¯¹äº `wait()/notify()`  Conditionæ¥å£è§£å†³äº† **è¿‡æ—©å”¤é†’**  é—®é¢˜ä»¥åŠ `Object.wait(time)` æ— æ³•åŒºåˆ†æ˜¯å¦æ˜¯ç”±äºç­‰å¾…è¶…æ—¶è¿˜æ˜¯è¢«å”¤é†’çš„é—®é¢˜ã€‚\n\n`Object.wait()/notify()`è¦æ±‚æ‰§è¡Œçº¿ç¨‹æŒæœ‰æ‰€å±å¯¹è±¡çš„å†…éƒ¨é”ï¼ŒåŒæ ·`Condition.await()/notify()`ä¹Ÿéœ€è¦çº¿ç¨‹æŒæœ‰**åˆ›å»º**è¯¥Conditionçš„æ˜¾å¼é”ï¼Œ`æ¯ä¸ªCondition`å®ä¾‹å†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œä¸åŒçš„Conditionä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œè¿™æ ·ä¸€æ¥å°±è§£å†³äº†è¿‡æ—©å”¤é†’çš„é—®é¢˜ï¼Œå¯¹äºç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ç»™æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…åˆ›å»ºä¸€ä¸ªConditionï¼Œç”Ÿäº§è€…é€šçŸ¥æ¶ˆè´¹è€…æ—¶å€™åªä¼šå”¤é†’æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…é€šçŸ¥ç”Ÿäº§è€…çš„æ—¶å€™ä¹Ÿåªä¼šé€šçŸ¥ç”Ÿäº§è€…ã€‚\n\n### è§£å†³è¿‡æ—©å”¤é†’\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/26 15:09\n */\npublic class ConditionTest1 {\n\n    private static final ReentrantLock LOCK = new ReentrantLock();\n\n    private static final Condition pCondition = LOCK.newCondition();\n\n    private static final Condition cCondition = LOCK.newCondition();\n\n    private static LinkedList<Long> buffer = new LinkedList<>();\n\n    private static final Integer MAX_BUFFER = 5;\n\n    public static void main(String[] args) {\n        ConditionTest1 conditionTest1 = new ConditionTest1();\n        Stream.of(\"p1\", \"p2\", \"p3\", \"p4\", \"p5\", \"p6\", \"p7\", \"p8\", \"p9\", \"p10\", \"p11\").forEach(name -> {\n            new Thread(() -> conditionTest1.produce(), name).start();\n        });\n\n        Stream.of(\"c1\", \"c2\", \"c3\", \"c4\", \"c5\", \"c6\", \"c7\", \"c8\", \"c9\", \"c10\", \"c11\").forEach(name -> {\n            new Thread(() -> conditionTest1.consumer(), name).start();\n        });\n    }\n\n    public void produce() {\n        try {\n            LOCK.lock();\n            while (buffer.size() >= MAX_BUFFER) {\n                pCondition.await();\n            }\n            long l = System.currentTimeMillis();\n            buffer.add(l);\n            System.out.println(Thread.currentThread().getName() + \" produced \" + l + \" ,current buffer size \" + buffer.size());\n            //é€šçŸ¥æ¶ˆè´¹è€…\n            cCondition.signalAll();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            LOCK.unlock();\n        }\n    }\n\n    public void consumer() {\n        try {\n            LOCK.lock();\n            while (buffer.size() == 0) {\n                cCondition.await();\n            }\n            Long aLong = buffer.removeLast();\n            System.out.println(Thread.currentThread().getName() + \" consumer \" + aLong + \" ,current buffer size \" + buffer.size());\n            //é€šçŸ¥ç”Ÿäº§è€…\n            pCondition.signalAll();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            LOCK.unlock();\n        }\n    }\n}\n```\n\n### è§£å†³Object.wait()æ— æ³•åŒºåˆ†å…¶è¿”å›åŸå› \n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/26 17:48\n */\npublic class ConditionTest2 {\n    private static final Object obj = new Object();\n\n    private static final ReentrantLock LOCK = new ReentrantLock();\n\n    private static final Condition condition = LOCK.newCondition();\n\n    private static boolean isReady = false;\n\n    public static void main(String[] args) throws InterruptedException {\n\n        new Thread(() -> {\n            //3s+\n            Date date = new Date(System.currentTimeMillis() + 3000);\n            try {\n                LOCK.lock();\n                while (!isReady) {\n                    boolean b = condition.awaitUntil(date);\n                    if (!b) {\n                        System.out.println(\"Fucking t0!!!!!, i am timeout\");\n                        return;\n                    }\n                    System.out.println(\"oh i get the lock!!!\");\n                }\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                LOCK.unlock();\n            }\n        }, \"t1\").start();\n\n        TimeUnit.SECONDS.sleep(5);\n        \n        new Thread(() -> {\n            try {\n                LOCK.lock();\n                isReady = true;\n                condition.signal();\n            } finally {\n                LOCK.unlock();\n            }\n        }, \"t0\").start();\n    }\n}\n```\n\nå¯è§**awaitUntil()** æ˜¯æœ‰ä¸€ä¸ªè¿”å›å€¼çš„ï¼Œè¿”å›trueåˆ™è¡¨ç¤ºåœ¨ç­‰å¾…æ—¶é—´å†…è·å–åˆ°äº†é”ï¼Œåä¹‹åˆ™æ˜¯å› ä¸ºè¶…æ—¶.\n\n> å†™è¿™ä¸ªDemoçš„æ—¶å€™æ˜¯æ‹¿ä¹‹å‰çš„æ”¹çš„ï¼Œç„¶åæœ‰ä¸€ä¸ªåœ°æ–¹çš„notifyå¿˜äº†æ”¹æˆsignalï¼Œç„¶åä¸€ç›´æŠ›å¼‚å¸¸ã€‚ã€‚ã€‚å› ä¸ºconditioné‡Œé¢ä¹Ÿæœ‰wait/notifyæ–¹æ³•æ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ä¸è¦è°ƒé”™äº†ã€‚\n\n### API\n\n| Modifier and Type | Method and Description                                       |\n| ----------------- | ------------------------------------------------------------ |\n| `void`            | `await()`   ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­                 |\n| `boolean`         | `await(long time,  TimeUnit unit)`  ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­ï¼Œæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚ |\n| `long`            | `awaitNanos(long nanosTimeout)`   ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­ï¼Œæˆ–æŒ‡å®šçš„ç­‰å¾…æ—¶é—´è¿‡å»ã€‚ |\n| `void`            | `awaitUninterruptibly()`   ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·ã€‚      |\n| `boolean`         | `awaitUntil(Date deadline)`  ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å‘å‡ºä¿¡å·æˆ–ä¸­æ–­ï¼Œæˆ–è€…æŒ‡å®šçš„æœ€åæœŸé™åˆ°è¾¾ã€‚ |\n| `void`            | `signal()`   å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚                              |\n| `void`            | `signalAll()`   å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚                           |\n\n## StampedLock\n\n`StampedLock`æ˜¯`Java8`å¼•å…¥çš„ä¸€ç§æ–°çš„é”æœºåˆ¶ï¼Œæ˜¯å¯¹è¯»å†™é”`ReentrantReadWriteLock`çš„å¢å¼ºï¼Œè¯»å†™é”è™½ç„¶åˆ†ç¦»äº†è¯»å’Œå†™çš„åŠŸèƒ½ï¼Œä½¿å¾—è¯»ä¸è¯»ä¹‹é—´ä¸äº’æ–¥ï¼Œä½†æ˜¯è¯»å’Œå†™ä¹‹é—´ä¾ç„¶æ˜¯äº’æ–¥çš„ï¼Œæœ¬è´¨ä¸Šä»ç„¶æ˜¯æ‚²è§‚é”ï¼Œå¦‚æœæœ‰å¤§é‡çš„è¯»çº¿ç¨‹å°±ä¼šå¼•èµ·å†™çº¿ç¨‹çš„é¥¥é¥¿ï¼Œè€Œ`StampedLock`åˆ™æä¾›äº†ä¸€ç§ä¹è§‚çš„è¯»ç­–ç•¥,è¿™ç§ä¹è§‚ç­–ç•¥çš„é”éå¸¸ç±»ä¼¼äºæ— é”çš„æ“ä½œï¼Œä½¿å¾—ä¹è§‚é”å®Œå…¨ä¸ä¼šå†™çº¿ç¨‹\n\n### æ‚²è§‚é”ç­–ç•¥\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/28 13:47\n */\npublic class StampedLockTest1 {\n    \n    private static final StampedLock stampedLock = new StampedLock();\n\n    private final static List<Long> shareData = new ArrayList<>();\n\n    public static void main(String[] args) {\n        final ExecutorService executorService = Executors.newFixedThreadPool(10);\n        Runnable readRunnable = () -> {\n            while (true) {\n                read();\n            }\n        };\n\n        Runnable writeRunnable = () -> {\n            while (true) {\n                write();\n            }\n        };\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n        executorService.submit(readRunnable);\n\n        executorService.submit(writeRunnable);\n\n    }\n\n    private static void read() {\n        long stamped = -1;\n        try {\n            stamped = stampedLock.readLock();\n            System.out.println(Thread.currentThread().getName() + \" read \" + shareData);\n            TimeUnit.SECONDS.sleep(1);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            stampedLock.unlockRead(stamped);\n        }\n    }\n\n    private static void write() {\n        long stamp = -1;\n        try {\n            stamp = stampedLock.writeLock();\n            shareData.add(System.currentTimeMillis());\n            System.out.println(Thread.currentThread().getName() + \" Write \");\n            TimeUnit.SECONDS.sleep(1);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            stampedLock.unlockWrite(stamp);\n        }\n    }\n}\n```\n\nå…¶å®è¿™ç§æ–¹å¼å°±å’Œ`ReadWriteLock` æ˜¯ç­‰ä»·çš„äº†ã€‚\n\n### ä¹è§‚è¯»ç­–ç•¥\n\nç›¸å¯¹ä¸Šé¢çš„æ–¹å¼ï¼Œå…¶å®å°±æ˜¯æ”¹å˜äº†è¯»çš„ç­–ç•¥\n\n```java\n    private static void read() {\n        long stamp = stampedLock.tryOptimisticRead(); //éé˜»å¡\n        //æš‚å­˜res\n        String res=Thread.currentThread().getName() + \" read \" + shareData;\n        if (!stampedLock.validate(stamp)) {\n            try {\n                //éªŒè¯å¤±è´¥,è¯´æ˜æœ‰çº¿ç¨‹è¿›è¡Œäº†å†™æ“ä½œ,å¯èƒ½é€ æˆæ•°æ®ä¸ä¸€è‡´\n                //è¿›è¡Œé”å‡çº§,è·å–å…±äº«è¯»é”\n                stamp = stampedLock.readLock();\n                //è¦†ç›–res\n                res=Thread.currentThread().getName() + \" read \" + shareData;\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                stampedLock.unlockRead(stamp);\n            }\n        }\n        System.out.println(res);\n    }\n```\n\nå…ˆå°è¯•è·å–ä¹è§‚è¯»é”ï¼ˆéé˜»å¡ï¼‰è¿”å›ä¸€ä¸ªæˆ³ï¼Œç„¶åè¿›è¡Œè¯»æ“ä½œï¼Œç¼“å­˜è¯»çš„ç»“æœï¼Œç„¶åæ ¹æ®å‰é¢è¿”å›çš„æˆ³éªŒè¯åœ¨æ­¤è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰å†™çº¿ç¨‹è¢«å ç”¨è¿‡ï¼Œå¦‚æœè¢«å ç”¨è¿‡å°±è¡¨ç¤ºæ•°æ®å¯èƒ½ä¸ä¸€è‡´äº†ï¼Œå°±éœ€è¦è½¬æ¢æˆæ™®é€šçš„`å…±äº«è¯»é”` ï¼Œå†æ¬¡è¯»å–æ•°æ®åˆ·æ–°ç»“æœï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæœ€åé‡Šæ”¾é”ã€‚\n\nè¿™é‡Œä¸€å¼€å§‹è¢«è§†é¢‘é‡Œé¢è®²çš„ææ‡µäº†ä»–å†™çš„æ˜¯è¿™æ ·çš„\n\n```java\n    private static void read() {\n        long stamp = stampedLock.tryOptimisticRead(); //éé˜»å¡\n        if (stampedLock.validate(stamp)) {\n            try {\n                stamp = stampedLock.readLock();\n                System.out.println(Thread.currentThread().getName() + \" read \" + shareData);\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                stampedLock.unlockRead(stamp);\n            }\n        }\n    }\n```\n\nç„¶åå°±è¯´è¿™æ ·æ¯”ReadWriteLockæ•ˆç‡é«˜å¾ˆå¤šï¼Œæˆ‘è¶Šçœ‹è¶Šè§‰å¾—ä¸å¯¹åŠ²ï¼Œç„¶åè‡ªå·±æŸ¥äº†ä¸‹ï¼Œçœ‹äº†ä¸‹å®˜æ–¹çš„Demoå‘ç°ä»–å†™çš„ç¡®å®æ˜¯é”™çš„ã€‚ã€‚ã€‚\n\nAPIä»€ä¹ˆçš„å°±ä¸å¤šè¯´äº†ï¼Œè¿™é‡Œå¦‚æœæƒ³äº†è§£æ›´å¤šå¯ä»¥çœ‹çœ‹[è¿™ç¯‡æ–‡ç« ](https://segmentfault.com/a/1190000015808032#articleHeader20)\n\nå¦å¤–å¦‚æœæƒ³çœ‹çœ‹æ€§èƒ½å¯¹æ¯”çš„å¯ä»¥çœ‹çœ‹ [è¿™ç¯‡æ–‡ç« ](http://ifeve.com/java-8-stampedlocks-vs-readwritelocks-and-synchronized/)\n\n> è¿™é‡Œè¿˜è¦å­˜ä¸ªç–‘ï¼Œæœ€åçš„é‡Šæ”¾è¯»é”ä¹‹ååˆ°æœ€åä¸€æ­¥çš„æ—¶å€™ä¸æ˜¯ä¹Ÿæœ‰å¯èƒ½æœ‰å†™çº¿ç¨‹è¿›å…¥ä¹ˆï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µä¹ˆï¼Ÿ å› ä¸ºæºç ä¸Šæ³¨é‡Šçš„Demoä¹Ÿæ˜¯è¿™æ ·å†™çš„æ‰€ä»¥è¿™é‡Œè¿˜æ˜¯æœ‰ç‚¹ç–‘é—®çš„ã€‚\n\n### éœ€è¦æ³¨æ„çš„åœ°æ–¹\n\n- æ‰€æœ‰è·å–é”çš„æ–¹æ³•ï¼Œéƒ½è¿”å›ä¸€ä¸ªé‚®æˆ³ï¼ˆStampï¼‰ï¼ŒStampä¸º0è¡¨ç¤ºè·å–å¤±è´¥ï¼Œå…¶ä½™éƒ½è¡¨ç¤ºæˆåŠŸï¼›\n- æ‰€æœ‰é‡Šæ”¾é”çš„æ–¹æ³•ï¼Œéƒ½éœ€è¦ä¸€ä¸ªé‚®æˆ³ï¼ˆStampï¼‰ï¼Œè¿™ä¸ªStampå¿…é¡»æ˜¯å’ŒæˆåŠŸè·å–é”æ—¶å¾—åˆ°çš„Stampä¸€è‡´ï¼›\n\n-  StampedLockæ˜¯ä¸å¯é‡å…¥çš„ (å¦‚æœä¸€ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰äº†å†™é”ï¼Œå†å»è·å–å†™é”çš„è¯å°±ä¼šé€ æˆæ­»é”)ï¼Œæ‰€ä»¥è¿™å°±è¦æˆ‘ä»¬å¼€å‘äººå‘˜ä¸è¦å»ä¿®æ”¹è¿”å›çš„æˆ³æˆ–è€…è®©å®ƒé€ƒé€¸å‡ºå»\n-  StampedLock ä¸æ”¯æŒCondition\n\n## ForkJoin\n\nForkJoinæ˜¯Java7æä¾›çš„åŸç”Ÿå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†æ¡†æ¶ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯å°†å¤§ä»»åŠ¡åˆ†å‰²æˆå°ä»»åŠ¡ï¼Œæœ€åå°†å°ä»»åŠ¡èšåˆèµ·æ¥å¾—åˆ°ç»“æœã€‚forkæ˜¯åˆ†è§£çš„æ„æ€, joinæ˜¯æ”¶é›†çš„æ„æ€. å®ƒéå¸¸ç±»ä¼¼äºHADOOPæä¾›çš„MapReduceæ¡†æ¶ï¼Œåªæ˜¯MapReduceçš„ä»»åŠ¡å¯ä»¥é’ˆå¯¹é›†ç¾¤å†…çš„æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨é›†ç¾¤çš„èƒ½åŠ›å®Œæˆè®¡ç®—ä»»åŠ¡ã€‚ForkJoinæ›´åŠ ç±»ä¼¼äºå•æœºç‰ˆçš„MapReduceã€‚\n\n### RecursiveTask\n\n**è®¡ç®—sumå’Œ**\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/30 11:58\n */\npublic class RecursiveTest1 {\n\t\n    //è¿™ä¸ªå€¼ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§æ•°æ®ï¼Œä¸èƒ½å¤ªå°ä¹Ÿä¸èƒ½å¤ªå¤§\n    private final static int MAX_THRESHOLD=3;\n\n    public static void main(String[] args) {\n        final ForkJoinPool forkJoinPool=new ForkJoinPool();\n        ForkJoinTask<Integer> submit = forkJoinPool.submit(new CaculateRecursiveTask(0, 100));\n        try {\n            Integer integer = submit.get();\n            System.out.println(integer);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } catch (ExecutionException e) {\n            e.printStackTrace();\n        }\n    }\n\n    private static class CaculateRecursiveTask extends RecursiveTask<Integer>{\n\n        private final int start;\n        private final int end;\n\n        private CaculateRecursiveTask(int start, int end) {\n            this.start = start;\n            this.end = end;\n        }\n\n        @Override\n        protected Integer compute() {\n            if(end-start<=MAX_THRESHOLD){\n                return IntStream.rangeClosed(start,end).sum();\n            }else{\n                int mid=(start+end)/2;\n                CaculateRecursiveTask leftTask=new CaculateRecursiveTask(start,mid);\n                CaculateRecursiveTask rightTask=new CaculateRecursiveTask(mid+1,end);\n                //é˜»å¡\n                leftTask.fork();\n                rightTask.fork();\n                //è¿”å›ç»“æœ\n                return leftTask.join()+rightTask.join();\n            }\n        }\n    }\n}\n```\n\n### RecursiveAction\n\n**è®¡ç®—sumå’Œ**\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/30 13:08\n */\npublic class RecursiveActionTest1 {\n\n    private final static int MAX_THRESHOLD=3;\n\n    private static AtomicInteger SUM=new AtomicInteger(0);\n\n    public static void main(String[] args) throws InterruptedException {\n        final ForkJoinPool forkJoinPool=new ForkJoinPool();\n        forkJoinPool.submit(new CalculateRecursiveAction(0, 100));\n        TimeUnit.SECONDS.sleep(3);\n        System.out.println(SUM.get());\n    }\n\n    private static class CalculateRecursiveAction extends RecursiveAction{\n\n        private final int start;\n        private final int end;\n\n        private CalculateRecursiveAction(int start, int end) {\n            this.start = start;\n            this.end = end;\n        }\n\n        @Override\n        protected void compute() {\n\n            if(end-start<=MAX_THRESHOLD){\n                SUM.addAndGet(IntStream.rangeClosed(start,end).sum());\n            }else{\n                int mid=(start+end)/2;\n                CalculateRecursiveAction leftTask=new CalculateRecursiveAction(start,mid);\n                CalculateRecursiveAction rightTask=new CalculateRecursiveAction(mid+1,end);\n                //é˜»å¡\n                leftTask.fork();\n                rightTask.fork();\n            }\n        }\n    }\n}\n```\n\n## Phaser\n\nCountDownLatchå’ŒCyclicBarrieréƒ½æ˜¯JDK 1.5å¼•å…¥çš„ï¼Œè€ŒPhaseræ˜¯JDK 1.7å¼•å…¥çš„ã€‚Phaserçš„åŠŸèƒ½ä¸CountDownLatchå’ŒCyclicBarrieræœ‰éƒ¨åˆ†é‡å ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ›´ä¸°å¯Œçš„è¯­ä¹‰å’Œæ›´çµæ´»çš„ç”¨æ³•ã€‚\n\nPhaseré¡¾åæ€ä¹‰ï¼Œä¸é˜¶æ®µç›¸å…³ã€‚Phaseræ¯”è¾ƒé€‚åˆè¿™æ ·ä¸€ç§åœºæ™¯ï¼Œä¸€ç§ä»»åŠ¡å¯ä»¥åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œç°å¸Œæœ›å¤šä¸ªçº¿ç¨‹å»å¤„ç†è¯¥æ‰¹ä»»åŠ¡ï¼Œå¯¹äºæ¯ä¸ªé˜¶æ®µï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘è¿›è¡Œï¼Œä½†æ˜¯å¸Œæœ›ä¿è¯åªæœ‰å‰é¢ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å®Œæˆä¹‹åæ‰èƒ½å¼€å§‹åé¢çš„ä»»åŠ¡ã€‚è¿™ç§åœºæ™¯å¯ä»¥ä½¿ç”¨å¤šä¸ªCyclicBarrieræ¥å®ç°ï¼Œæ¯ä¸ªCyclicBarrierè´Ÿè´£ç­‰å¾…ä¸€ä¸ªé˜¶æ®µçš„ä»»åŠ¡å…¨éƒ¨å®Œæˆã€‚ä½†æ˜¯ä½¿ç”¨CyclicBarrierçš„ç¼ºç‚¹åœ¨äºï¼Œéœ€è¦æ˜ç¡®çŸ¥é“æ€»å…±æœ‰å¤šå°‘ä¸ªé˜¶æ®µï¼ŒåŒæ—¶å¹¶è¡Œçš„ä»»åŠ¡æ•°éœ€è¦æå‰é¢„å®šä¹‰å¥½ï¼Œä¸”æ— æ³•åŠ¨æ€ä¿®æ”¹ã€‚è€ŒPhaserå¯åŒæ—¶è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/30 13:44\n */\npublic class PhaserTest1 {\n    public static void main(String[] args) {\n        final Phaser phaser = new Phaser();\n\n        Stream.of(\"t1\", \"t2\", \"t3\", \"t4\", \"t5\").forEach(name -> new Thread(new Task(phaser), name).start());\n        //æ³¨å†Œmainçº¿ç¨‹\n        phaser.register();\n        phaser.arriveAndAwaitAdvance();\n        System.out.println(\"all of work finished\");\n    }\n\n    static class Task implements Runnable {\n        private final Phaser phaser;\n\n        Task(Phaser phaser) {\n            this.phaser = phaser;\n            //åŠ¨æ€å¢åŠ \n            this.phaser.register();\n        }\n\n        @Override\n        public void run() {\n            System.out.println(Thread.currentThread().getName() + \" is working\");\n            try {\n                TimeUnit.SECONDS.sleep(2);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            //\n            phaser.arriveAndAwaitAdvance();\n        }\n    }\n}\n```\n\n### API\n\n| Modifier and Type   | Method and Description                                       |\n| ------------------- | ------------------------------------------------------------ |\n| `int`               | `arrive()`   æŠµè¾¾è¿™ä¸ªç§»ç›¸å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…åˆ«äººåˆ°è¾¾ã€‚            |\n| `int`               | `arriveAndAwaitAdvance()`   åˆ°è¾¾è¿™ä¸ªç§»ç›¸å™¨ï¼Œç­‰å¾…å…¶ä»–äººã€‚     |\n| `int`               | `arriveAndDeregister()`   åˆ°è¾¾è¿™ä¸ªç§»ç›¸å™¨å¹¶ä»å…¶ä¸­æ³¨é”€ï¼Œè€Œæ— éœ€ç­‰å¾…åˆ«äººåˆ°è¾¾ã€‚ |\n| `int`               | `awaitAdvance(int phase)`   ç­‰å¾…è¯¥ç›¸ä½å™¨çš„ç›¸ä½ä»ç»™å®šç›¸ä½å€¼å‰è¿›ï¼Œå¦‚æœå½“å‰ç›¸ä½ä¸ç­‰äºç»™å®šç›¸ä½å€¼ï¼Œåˆ™ç«‹å³è¿”å›ï¼Œæˆ–è€…è¯¥ç›¸ä½å™¨è¢«ç»ˆæ­¢ã€‚ |\n| `int`               | `awaitAdvanceInterruptibly(int phase)`   ç­‰å¾…è¯¥ç§»ç›¸å™¨çš„é˜¶æ®µä»ç»™å®šçš„ç›¸ä½å€¼æ¨è¿›ï¼Œå¦‚æœåœ¨ç­‰å¾…æ—¶ `InterruptedException`åˆ™æŠ›å‡º  `InterruptedException` ï¼Œæˆ–è€…å¦‚æœå½“å‰ç›¸ä½ä¸ç­‰äºç»™å®šçš„ç›¸ä½å€¼æˆ–è€…è¯¥ç›¸ä½å™¨è¢«ç»ˆæ­¢ï¼Œåˆ™ç«‹å³è¿”å›ã€‚ |\n| `int`               | `awaitAdvanceInterruptibly(int phase,  long timeout, TimeUnit unit)`  ç­‰å¾…è¯¥ç§»ç›¸å™¨çš„é˜¶æ®µä»ç»™å®šçš„ç›¸ä½å€¼æˆ–ç»™å®šçš„è¶…æ—¶æ—¶é—´  `InterruptedException`åˆ°ç­‰å¾…æ—¶æŠ›å‡º `InterruptedException`  ï¼Œå¦‚æœå½“å‰ç›¸ä½ä¸ç­‰äºç»™å®šçš„ç›¸ä½å€¼ï¼Œåˆ™ç«‹å³è¿”å›ï¼Œæˆ–è€…è¯¥ç›¸ä½å™¨è¢«ç»ˆæ­¢ã€‚ |\n| `int`               | `bulkRegister(int parties)`   å¢åŠ ç»™å®šæ•°é‡çš„æ–°çš„æœ‰äº‰è®®çš„æ´¾å¯¹åˆ°è¿™ä¸ªç§»ç›¸å™¨ã€‚ |\n| `void`              | `forceTermination()`   å¼ºåˆ¶æ­¤ç§»ç›¸å™¨è¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚            |\n| `int`               | `getArrivedParties()`   è¿”å›åœ¨æ­¤ç§»ç›¸å™¨çš„å½“å‰é˜¶æ®µåˆ°è¾¾çš„å·²æ³¨å†Œæ–¹çš„æ•°é‡ã€‚ |\n| `Phaser`            | `getParent()`   è¿”å›æ­¤ç§»ç›¸å™¨çš„çˆ¶çº§ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å› `null` ã€‚ |\n| `int`               | `getPhase()`   è¿”å›å½“å‰ç›¸ä½æ•°ã€‚                              |\n| `int`               | `getRegisteredParties()`   è¿”å›åœ¨æ­¤ç§»åŠ¨è®¾å¤‡ä¸Šæ³¨å†Œçš„å„æ–¹æ•°é‡ã€‚ |\n| `Phaser`            | `getRoot()`   è¿”å›æ­¤ç§»ç›¸å™¨çš„æ ¹ç¥–å…ˆï¼Œå¦‚æœå®ƒæ²¡æœ‰çˆ¶ä»£ï¼Œåˆ™ä¸è¯¥ç§»ç›¸å™¨ç›¸åŒã€‚ |\n| `int`               | `getUnarrivedParties()`   è¿”å›å°šæœªåˆ°è¾¾æ­¤ç§»ç›¸å™¨å½“å‰é˜¶æ®µçš„å·²æ³¨å†Œæ–¹çš„æ•°é‡ã€‚ |\n| `boolean`           | `isTerminated()`   è¿”å› `true`å¦‚æœç§»ç›¸å™¨å·²è¢«ç»ˆæ­¢ã€‚           |\n| `protected boolean` | `onAdvance(int phase,  int registeredParties)`  åœ¨å³å°†è¿›è¡Œçš„ç›¸ä½æå‰æ‰§è¡ŒåŠ¨ä½œçš„å¯è¦†ç›–æ–¹æ³•ï¼Œå¹¶æ§åˆ¶ç»ˆæ­¢ã€‚ |\n| `int`               | `register()`   æ·»åŠ ä¸€ä¸ªæ–°çš„unririved partyåˆ°è¿™ä¸ªç§»ç›¸å™¨ã€‚     |\n| `String`            | `toString()`   è¿”å›ä¸€ä¸ªæ ‡è¯†æ­¤ç§»ç›¸å™¨çš„å­—ç¬¦ä¸²åŠå…¶çŠ¶æ€ã€‚        |\n\n## æ€»ç»“\n\nå¤§è‡´å½’çº³äº†ä¸€äº›å¸¸è§çš„å¹¶å‘å·¥å…·ï¼Œå½“ç„¶åªæ˜¯æµ…æ˜¾çš„è®°å½•äº†ä¸€ä¸‹æ€æ ·ä½¿ç”¨ï¼ŒåŸç†éƒ¨åˆ†è¿˜æ²¡æœ‰æ·±å…¥çš„äº†è§£ï¼Œåç»­è‚¯å®šä¼šå»ç ”ç©¶åº•å±‚å®ç°æºç åŒ…æ‹¬`AQS`å’Œ`LockSupport`ç­‰ç­‰ï¼Œå…¶å®è¶Šå¾€åå­¦å°±è¶Šæƒ³çŸ¥é“åˆ°åº•å±‚æ˜¯æ€æ ·ä¸ªè¿‡ç¨‹ï¼Œåˆ°åº•æ˜¯å¦‚ä½•åŠ é”å¦‚ä½•è§£é”ï¼ŸCASåˆèµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ï¼ŸSynchnorizedåº•å±‚åˆæ˜¯å¦‚ä½•å®ç°ï¼Ÿ...å­¦æ— æ­¢å¢ƒå•Š. JUCé™¤äº†è¿™äº›å¹¶å‘å·¥å…·å¤–è¿˜æœ‰**çº¿ç¨‹æ± ** ï¼Œ**é˜»å¡é˜Ÿåˆ—** è¿˜æ²¡ä»‹ç»ï¼Œåé¢ä¼šç»§ç»­ä»‹ç»ã€‚","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"LeetCodeæ»‘åŠ¨çª—å£","url":"/2019/07/20/leetcode-hua-dong-chuang-kou/","content":"\n## LeetCode æ»‘åŠ¨çª—å£\n\næ»‘åŠ¨é—®é¢˜åŒ…å«ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ä¸€ä¸ªå¤§æ•°ç»„ä¸Šçš„å­åˆ—è¡¨ï¼Œè¯¥æ•°ç»„æ˜¯ä¸€ä¸ªåº•å±‚å…ƒç´ é›†åˆã€‚å‡è®¾æœ‰æ•°ç»„ [a b c d e f g h ]ï¼Œä¸€ä¸ªå¤§å°ä¸º 3 çš„ **æ»‘åŠ¨çª—å£** åœ¨å…¶ä¸Šæ»‘åŠ¨ï¼Œåˆ™æœ‰ï¼š\n\n```java\n[a b c]\n  [b c d]\n    [c d e]\n      [d e f]\n        [e f g]\n          [f g h]\n```\n\nä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯ä½¿ç”¨è¿™ä¸ªçª—å£åœ¨æ•°ç»„çš„ **åˆæ³•åŒºé—´** å†…è¿›è¡Œæ»‘åŠ¨ï¼ŒåŒæ—¶ **åŠ¨æ€åœ°**è®°å½•ä¸€äº›æœ‰ç”¨çš„æ•°æ®ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæå¤§åœ°æé«˜ç®—æ³•åœ°æ•ˆç‡ã€‚\n\n## [239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼](https://leetcode-cn.com/problems/sliding-window-maximum/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ *nums*ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º *k* çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£ *k* å†…çš„æ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚\n\nè¿”å›æ»‘åŠ¨çª—å£æœ€å¤§å€¼ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: nums = [1,3,-1,-3,5,3,6,7], å’Œ k = 3\nè¾“å‡º: [3,3,5,5,6,7] \nè§£é‡Š: \n\n  æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼\n---------------               -----\n[1  3  -1] -3  5  3  6  7       3\n 1 [3  -1  -3] 5  3  6  7       3\n 1  3 [-1  -3  5] 3  6  7       5\n 1  3  -1 [-3  5  3] 6  7       5\n 1  3  -1  -3 [5  3  6] 7       6\n 1  3  -1  -3  5 [3  6  7]      7\n```\n\n**æ³¨æ„ï¼š**\n\nä½ å¯ä»¥å‡è®¾ *k* æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œ1 â‰¤ k â‰¤ è¾“å…¥æ•°ç»„çš„å¤§å°ï¼Œä¸”è¾“å…¥æ•°ç»„ä¸ä¸ºç©ºã€‚\n\n**è¿›é˜¶ï¼š**\n\nä½ èƒ½åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦å†…è§£å†³æ­¤é¢˜å—ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\n```java\npublic static int[] maxSlidingWindow2(int[] nums, int k) {\n    //é¢˜ç›®ä¸Šè¯´çš„ä¸ä¸ºç©ºï¼Œè¿˜æ˜¯ç»™æˆ‘æ¥äº†ä¸ªç©ºã€‚ã€‚ã€‚ã€‚\n    if(nums.length==0){\n        return new int[]{};\n    }\n    if(k==1) return nums;\n    LinkedList<Integer> list=new LinkedList<Integer>();\n    int []res=new int[nums.length-k+1];\n    int index=0;\n    list.add(0);\n    for (int i=1;i<nums.length;i++) {\n        while(!list.isEmpty() && nums[list.getLast()]<nums[i]){\n            //å°äºnums[i]çš„å…ƒç´ ,ä»å³è¾¹(å°¾)å‡ºé˜Ÿåˆ— ,æ§åˆ¶æœ€å·¦è¾¹(å¤´)æœ€å¤§\n            list.removeLast();\n        }\n        //ç„¶åå°†å®ƒåŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä»å³è¾¹(å°¾)\n        list.addLast(i);\n        //å¦‚æœé˜Ÿåˆ—æº¢å‡ºäº†å°±ä»å³è¾¹ç§»é™¤ä¸€ä¸ªï¼ˆå¤´ï¼‰\n        if(i-list.getFirst()==k){\n            list.removeFirst();\n        }\n        if(i>=k-1){\n            res[index++]=nums[list.getFirst()];\n        }\n    }\n    return res;\n}\n```\n\n> 2020.2.9 å›å¤´çœ‹äº†ä¸‹ï¼Œè¿™ä¸æ˜¯å•è°ƒé˜Ÿåˆ—ä¹ˆğŸ˜‚ï¼ˆç”¨å †ä¹Ÿå¯ä»¥å•¦ï¼Œä¸è¿‡æ—¢ç„¶è¦åœ¨å¤´å°¾éƒ½æ“ä½œï¼Œç›´æ¥ç”¨é˜Ÿåˆ—ä¼šæ›´æ–¹ä¾¿ï¼‰\n\nå…¶å®å¼€å§‹æˆ‘ä¹Ÿä¸ä¼šåšï¼Œçœ‹äº†æç¤ºåæäº†åŠå¤©æ‰å¼„å‡ºæ¥ï¼Œ23msï¼Œ70%å·¦å³ï¼Œæ€è·¯å°±æ˜¯åˆ©ç”¨ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—(å¤´å°¾éƒ½å¯ä»¥è¿›å‡º)ï¼Œé˜Ÿåˆ—ä¸­å­˜**æ•°ç»„ä¸‹æ ‡**ï¼Œç„¶åéå†æ•°ç»„ï¼Œåœ¨è¿›å…¥é˜Ÿåˆ—æ—¶ä»å³å‘å·¦éå†é˜Ÿå°¾ï¼Œå°†**å°äºå½“å‰å…ƒç´ **çš„é˜Ÿå°¾å…ƒç´ å»é™¤(å› ä¸ºå·²ç»æ²¡ç”¨äº†ï¼Œåé¢çš„æœ€å¤§å€¼ä¸å¯èƒ½æ˜¯å®ƒä»¬)ï¼Œä¸¾ä¸ªä¾‹å­\n\n> [2ï¼Œ1ï¼Œ-1ï¼Œ3ï¼Œ......]  k=3 ï¼Œå½“è¯»åˆ°**3**è¿™ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œçª—å£å†å‘å³ç§»åŠ¨æœ€å¤§å€¼è‚¯å®šä¸ä¼šæ˜¯å³è¾¹çš„å…ƒç´ äº†ï¼Œæ‰€ä»¥ç›´æ¥å‰”é™¤ä»–ä»¬ï¼Œåœ¨çº¸ä¸Šç”»ä¸€ç”»å°±æ˜ç™½äº†\n\nç„¶åå¾ˆå…³é”®çš„ä¸€æ­¥å°±æ˜¯ä»€ä¹ˆæ—¶å€™ç§»é™¤æœ€å·¦è¾¹çš„å…ƒç´ ï¼Œå…¶å®æŒ‰ç…§äººçš„æ€è·¯æ¥æƒ³å°±æ˜¯æœ€å·¦è¾¹çš„å…ƒç´ ä¸åœ¨çª—å£å†…çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œè¯»åˆ°**3**çš„æ—¶å€™ï¼Œ**2**å…¶å®å°±åº”è¯¥å‰”é™¤äº†å› ä¸ºå®ƒå·²ç»ä¸åœ¨çª—å£å†…äº†ã€‚ç”¨ä»£ç æ¥æè¿°å°±æ˜¯\n\n`i-list.getFirst()==k`ï¼Œiä»£è¡¨**å½“å‰å…ƒç´ ä¸‹æ ‡**ï¼Œä¸Šé¢çš„ä¾‹å­**3**å¯¹åº”çš„**i**å°±æ˜¯**3**ï¼Œ**list.getFirst()=0**ï¼Œåˆšå¥½å·®ä¸ºkï¼Œå°±ä»£è¡¨**2**å·²ç»è¶…å‡ºçª—å£äº†åº”è¯¥ç§»é™¤äº†ã€‚\n\nå…¶å®è¿™é‡Œæˆ‘å¼€å§‹ä¸æ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘åœ¨é˜Ÿåˆ—é‡Œé¢å­˜çš„ä¸æ˜¯å…ƒç´ ç´¢å¼•ï¼Œæˆ‘å­˜çš„æ˜¯å…ƒç´ ï¼Œç„¶ååœ¨åˆ¤æ–­ä»€ä¹ˆæ—¶å€™ç§»é™¤çš„æ—¶å€™å‘ç°åˆ¤æ–­ä¸äº†ï¼Œ**index**ä¹Ÿåªæ˜¯ç»“æœå…ƒç´ çš„ä¸‹æ ‡ï¼Œå¹¶ä¸èƒ½ä»£è¡¨é˜Ÿåˆ—æœ€å·¦å…ƒç´ çš„ä¸‹æ ‡ï¼Œå¯¹äºæ•°ç»„å­˜ä¸‹æ ‡ä¼˜å…ˆäºå­˜å…ƒç´ ï¼Œå¤šä¸€ä¸ªå·²çŸ¥é‡æœ‰æ—¶å€™è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„\n\n**è§£æ³•äºŒ**\n\nå±äºå¯¹æš´åŠ›æ³•çš„ä¼˜åŒ–å§ï¼Œæœ€åæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦`O(NK)`ï¼Œæ¯”å¦‚å®Œå…¨é€†åºçš„æƒ…å†µï¼ˆ2020.2.9å›é¡¾fixï¼‰\n\n```java\npublic static int[] maxSlidingWindow3(int[] nums, int k) {\n    //é¢˜ç›®ä¸Šè¯´çš„ä¸ä¸ºç©ºï¼Œè¿˜æ˜¯ç»™æˆ‘æ¥äº†ä¸ªç©ºã€‚ã€‚ã€‚ã€‚\n    int len = nums.length;\n    if (len == 0) return new int[]{};\n    if (len == 1) return new int[]{nums[0]};\n    int localMax = Integer.MIN_VALUE;\n    int[] result = new int[len - k + 1];\n    for (int i = 0; i < k; i++) {\n        //æ‰¾åˆ°ç¬¬ä¸€ä¸ªçª—å£çš„æœ€å¤§å€¼\n        localMax = max(nums[i], localMax);\n    }\n    result[0] = localMax;\n    for (int i = 1; i < len - k + 1; i++) {\n        //çª—å£çš„ä¸‹ä¸€ä¸ªå…ƒç´  k=3 , i=1 ä¸‹ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡ä¸º 3\n        if (nums[i + k - 1] > localMax) {\n            //åˆ¤æ–­å½“å‰çª—å£æœ€å¤§å€¼å’Œä¸‹ä¸€ä¸ªå…ƒç´ çš„å¤§å°\n            //å¦‚æœæ¯”å½“å‰çª—å£çš„æœ€å¤§å€¼è¿˜è¦å¤§ å°±ä¸ç”¨æ‰¾äº† å°±æ˜¯å®ƒäº†\n            localMax = nums[i + k - 1];\n        } else if (nums[i - 1] == localMax) {\n            //ä¸‹ä¸€ä¸ªå…ƒç´ æ¯”å½“å‰çª—å£æœ€å¤§å€¼å° è€Œä¸”å¾ˆä¸å·§\n            //å½“å‰æœ€å¤§å€¼åˆšå¥½æ˜¯å½“å‰çª—å£çš„æœ€å·¦è¾¹çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯é©¬ä¸Šè¦è¶…è¿‡çª—å£çš„å…ƒç´ \n            localMax = nums[i];\n            //æ‰€ä»¥å°±è¦é‡æ–°æ‰¾æœ€å¤§å€¼\n            for (int x = i; x < i + k; x++) {\n                localMax = max(nums[x], localMax);\n            }\n        }\n        //å‰©ä¸‹çš„è¯·å†µå°±æ˜¯ æ¯”å½“å‰æœ€å¤§å€¼å°ï¼Œå¹¶ä¸”æœ€å¤§å€¼ä¸æ˜¯æœ€å·¦è¾¹çš„å…ƒç´ (è¿˜æ²¡æœ‰å‡ºç•Œ)ï¼Œæœ€å¤§å€¼ä¸å˜\n        //copyåˆ°ç»“æœä¸­\n        result[i] = localMax;\n    }\n    return result;\n}\n\n//å…¶å®å¯ä»¥ç”¨Math.max()\npublic static int max(int a,int b){\n    if(a>=b)return a;\n    return b;\n}\n```\n\n2msï¼Œ99%  æäº¤è®°å½•è¿™ç§åšæ³•æ˜¯æœ€å¿«çš„ğŸ˜‚ï¼Œæ—¶é—´å¤æ‚åº¦æœ€ååº”è¯¥æ˜¯`O(NK)`\n\n## [5312. å¤§å°ä¸º K ä¸”å¹³å‡å€¼å¤§äºç­‰äºé˜ˆå€¼çš„å­æ•°ç»„æ•°ç›®](https://leetcode-cn.com/problems/number-of-sub-arrays-of-size-k-and-average-greater-than-or-equal-to-threshold/) \n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `arr` å’Œä¸¤ä¸ªæ•´æ•° `k` å’Œ `threshold` ã€‚\n\nè¯·ä½ è¿”å›é•¿åº¦ä¸º `k` ä¸”å¹³å‡å€¼å¤§äºç­‰äº `threshold` çš„å­æ•°ç»„æ•°ç›®ã€‚\n\n **ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [2,2,2,2,5,5,5,8], k = 3, threshold = 4\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šå­æ•°ç»„ [2,5,5],[5,5,5] å’Œ [5,5,8] çš„å¹³å‡å€¼åˆ†åˆ«ä¸º 4ï¼Œ5 å’Œ 6 ã€‚å…¶ä»–é•¿åº¦ä¸º 3 çš„å­æ•°ç»„çš„å¹³å‡å€¼éƒ½å°äº 4 ï¼ˆthreshold çš„å€¼)ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [1,1,1,1,1], k = 1, threshold = 0\nè¾“å‡ºï¼š5\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [11,13,17,23,29,31,7,5,2,3], k = 3, threshold = 5\nè¾“å‡ºï¼š6\nè§£é‡Šï¼šå‰ 6 ä¸ªé•¿åº¦ä¸º 3 çš„å­æ•°ç»„å¹³å‡å€¼éƒ½å¤§äº 5 ã€‚æ³¨æ„å¹³å‡å€¼ä¸æ˜¯æ•´æ•°ã€‚\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [7,7,7,7,7,7,7], k = 7, threshold = 7\nè¾“å‡ºï¼š1\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šarr = [4,4,4,4], k = 4, threshold = 1\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n- `1 <= arr.length <= 10^5`\n- `1 <= arr[i] <= 10^4`\n- `1 <= k <= arr.length`\n- `0 <= threshold <= 10^4`\n\n**è§£æ³•ä¸€**\n\n19åŒå‘¨èµ›çš„ç¬¬2é¢˜ï¼Œå¾ˆç®€å•çš„æ»‘åŠ¨çª—å£ï¼Œæšä¸¾æ‰€æœ‰çª—å£è®¡æ•°å°±è¡Œäº†\n\n```java\npublic int numOfSubarrays(int[] arr, int k, int threshold) {\n    threshold*=k;\n    int sum=0;\n    int count=0;\n    for (int i=0;i<k;i++) {\n        sum+=arr[i];\n    }\n    for (int i=k;i<arr.length;i++) {\n        if (sum>=threshold) {\n            count++;\n        }\n        //0 1 2 3\n        sum+=arr[i];\n        sum-=arr[i-k];\n    }\n    return count;\n}\n```\n\n## [3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²](https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ **æœ€é•¿å­ä¸²** çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"abcabcbb\"\nè¾“å‡º: 3 \nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"abc\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"bbbbb\"\nè¾“å‡º: 1\nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"b\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: \"pwwkew\"\nè¾“å‡º: 3\nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"wke\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\n     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ\"pwke\" æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®å¾ˆä¹…ä»¥å‰(åŠå¹´å‰)åšè¿‡ä¸€æ¬¡ï¼Œå½“æ—¶ç”¨çš„æ–¹æ³•å¾ˆlowğŸ˜‚\n\n![mark](http://static.imlgw.top///20190503/zQ9MBrOhQm4S.png?imageslim)\n\n```java\npublic int lengthOfLongestSubstring(String s) {\n    char [] chars = s.toCharArray();\n    if (chars.length == 0) {\n        return 0;\n    }\n    int length = 1;\n    String temp=new String();\n    for (int i = 0; i <s.length()-1; i++) {\n        if(chars[i] != chars[i+1]) {\n            temp=s.substring(i, i+2);\n        } else continue;\n        for (int j = i+2; j < s.length(); j++) {\n            if (!temp.contains(chars[j]+\"\")) {\n                temp = s.substring(i, j+1);\n            } else break;\n        }\n        //Breakå‡ºæ¥ååˆ¤æ–­æ˜¯å¦æ˜¯æœ€é•¿çš„k\n        length=temp.length()>length?temp.length():length;\n    }\n    return length;\n}\n```\n\næˆ‘è¿™ç§å®Œå…¨å°±æ˜¯åˆ©ç”¨apiæš´åŠ›æ³•ï¼Œå±…ç„¶è¿˜è·‘è¿‡äº†ï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯O(N3)ï¼Œè¿™é¢˜çš„acç‡è¿˜æ˜¯æŒºä½çš„åªæœ‰ 29.3%\n\n**è§£æ³•äºŒ**\n\nä¸‹é¢çš„æ˜¯æˆ‘ä¸‹åˆé‡æ–°åšçš„\n\n```java\npublic static int lengthOfLongestSubstring4(String s) {\n    //è¾¹ç•Œé—®é¢˜æ°¸è¿œä¸èƒ½å¿½ç•¥\n    //LinkedList<Integer> list=new LinkedList<>();\n    int length=s.length();\n    if(length==0) return 0;\n    int head=0,tail=0;\n    int max=1;\n    for (int i=1;i<length;i++) {\n        int index=i-1; //å½“å‰å…ƒç´ å‰ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡\n        while(index>=head){\n            if(s.charAt(i)!=s.charAt(index)){\n                index--;\n            }else{\n                //æŒ‰æ€è·¯åº”è¯¥æ˜¯æŠŠç›¸ç­‰å‰æ‰€æœ‰å…ƒç´ ç§»é™¤ï¼Œä½†æ˜¯é‚£æ ·æ•ˆç‡å¥½ä½ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å†³å®šç”¨æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—\n                head=index+1;\n                tail++;\n                break;\n            }\n            //ä»å°¾éå†åˆ°å¤´ä»ç„¶æ²¡æœ‰ç›¸ç­‰ï¼Œå¯ä»¥æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­\n            if(index==head-1){\n                tail++;\n                break;\n            }\n        }\n        //æ¯æ¬¡ç»“æŸå¾ªç¯å å°¾index-å¤´index\n        max=tail-head+1 > max?tail-head+1:max;\n        //System.out.println(max);\n    }\n    return max;\n}\n```\n\n20mså·¦å³80%å·¦å³ï¼Œæ€è·¯ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œéå†å­—ç¬¦ä¸²ï¼Œç„¶åä»åå¾€å‰éå†å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å½“å‰å­—ç¬¦ä¸²åœ¨å‰é¢æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯å°±å°†å‰é¢ç›¸ç­‰é‚£ä¸ªå…ƒç´ (index)å‰çš„å…ƒç´ éƒ½ç§»é™¤ï¼ˆçª—å£å³ç§»ï¼‰\n\neg: `[head...index....tail] i`  å‘å³ç§»åŠ¨`....index [head ... i]`\n\næŠŠå½“å‰å…ƒç´ æ·»åŠ è¿›æ¥ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N^2)ï¼Œæ¯”ä¸Šé¢å•çº¯çš„æš´åŠ›æ³•è¦å¿«å¤šäº†ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æœ€ä¼˜è§£\n\n**è§£æ³•ä¸‰**\n\nä¸Šé¢çš„ç®—æ³•ï¼Œå…¶å®è¿˜å¯ä»¥ä¼˜åŒ–ï¼Œæ¯æ¬¡åˆ¤æ–­å‰é¢æœ‰æ²¡æœ‰é‡å¤å…ƒç´ çš„æ—¶å€™å¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªå¤§å°256çš„æ‰©å±•ASCIIç è¡¨æ•°ç»„æ¥åˆ¤æ–­ï¼ˆå‰ææ˜¯è¿™äº›å­—ç¬¦éƒ½åœ¨æ ‡å‡†çš„ASCIIå­—ç¬¦ä¸­ï¼‰ï¼Œ`freq[s.charAt(i)]` ä»£è¡¨çš„å°±æ˜¯s.charAt(i)è¿™ä¸ªå­—ç¬¦åœ¨çª—å£å†…å‡ºç°è¿‡æ²¡æœ‰ï¼Œå‡ºç°è¿‡å°±ä¸º1ï¼Œå¦åˆ™å°±æ˜¯0ï¼Œè¿™é‡Œå¦‚æœASCIIä¸å¤Ÿå…¶å®ä¹Ÿå¯ä»¥ç”¨HashMapï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¹Ÿå¾ˆé«˜æ¥è¿‘O(1)\n\n```java\npublic int lengthOfLongestSubstring(String s) {\n    int length=s.length();\n    if(length==0) return 0;\n    int[] freq=new int[256]; //ASCIIç è¡¨\n    freq[s.charAt(0)]=1;\n    int head=0,tail=0;\n    int max=1;\n    while(head<length){\n        if(tail+1<length&&freq[s.charAt(tail+1)]==0){\n            //æ²¡æœ‰é‡å¤ï¼Œå³è¾¹ç•Œå³ç§»\n            tail++;\n            freq[s.charAt(tail)]++;\n        }else{\n            //é€æ¸ç¼©å‡å·¦è¾¹ç•Œï¼Œç›´åˆ°ä¸å†æœ‰é‡å¤å…ƒç´ \n            freq[s.charAt(head)]--;\n            head++;\n        }\n        max=max<tail-head+1?tail-head+1:max;\n    }\n    return max;\n}\n```\nè¿™ç§åšæ³•æœ€åæƒ…å†µï¼ˆæ²¡æœ‰é‡å¤çš„å­—ç¬¦ï¼‰ä¸‹å…¶å®ä¼šéå†ä¸¤éæ•°ç»„tailå…ˆç§»åŠ¨åˆ°å°¾éƒ¨headéšåæœ‰ç§»åŠ¨åˆ°å°¾éƒ¨ï¼Œä½†æ˜¯æ¯”è¾ƒå¥½ç†è§£ï¼Œè§£æ³•å››å®é™…ä¸Šå°±æ˜¯å¯¹è¿™é‡Œçš„ä¼˜åŒ–ï¼Œheadæ¯æ¬¡ç§»åŠ¨éƒ½æ˜¯ç›´æ¥ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªé‡å¤å…ƒç´ çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„å‘å³ç§»\n\n**è§£æ³•å››**\n\næäº¤è®°å½•ä¸Šæœ€å¿«çš„æ–¹æ³•ï¼Œç†è§£èµ·æ¥æœ‰ç‚¹è´¹åŠ²ï¼Œç°åœ¨å›å¤´çœ‹åˆçœ‹ä¸æ‡‚äº†ã€‚ã€‚ã€‚\n\n```java\npublic int lengthOfLongestSubstring(String s) {\n    int n = s.length(), ans = 0;\n    //ç´¢å¼•ä¸ºå…ƒç´ å€¼ï¼Œè¿™é‡Œå› ä¸ºå…ƒç´ éƒ½æ˜¯å­—ç¬¦è½¬è¿‡æ¥å°±æ˜¯askllç ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿™æ ·\n    int[] index = new int[128];\n    for (int j = 0, i = 0; j < n; j++) {\n        //å¦‚æœå­—ç¬¦ char åœ¨æ²¡æœ‰å‡ºç°è¿‡ï¼Œindex[char]ä¸º0ï¼Œå‡ºç°åˆ™index[char]æ˜¯éå†å‡ºç°çš„æœ€åçš„charçš„ä½ç½®\n        // index[s.charAt(j)] æ˜¯å½“å‰å­—ç¬¦ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®(ä»1å¼€å§‹)\n        i = Math.max(i,index[s.charAt(j)]);\n        //j - i + 1 å°±æ˜¯èˆå¼ƒs.charAt(j)é‡å¤å‡ºç°ä¹‹å‰å­—ç¬¦çš„é•¿åº¦  å¦‚abca,å½“s.charAt(j) == aæ—¶ï¼Œj - i + 1å°±æ˜¯bcaçš„é•¿åº¦\n        //æ±‚æœ€å¤§å€¼å¸¸è§„æ“ä½œ\n        ans = Math.max(ans, j - i + 1);\n        index[s.charAt(j)] = j + 1;\n        // ä»1å¼€å§‹\n    }\n    return ans;\n}\n```\n\nè¿™é‡Œæœ€ä¸»è¦å°±æ˜¯è¿™ä¸ª**i**çš„ç†è§£\n\n![mark](http://static.imlgw.top///20190503/Qcj2l3E0v5sN.png?imageslim)\n\nè¿™ä¸ªiä¸ä¸€å®šæ˜¯å½“å‰å…ƒç´ ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç¦»**å½“å‰**å…ƒç´ ä»å³å‘å·¦**æœ€è¿‘**çš„**é‡å¤å­—ç¬¦**çš„_ä½ç½®_ã€‚è€Œindexä¸­å­˜çš„å°±æ˜¯è¿™ä¸ªå…ƒç´ çš„ç´¢å¼•ä½ç½®+1ï¼Œä¸ºä»€ä¹ˆè¦åŠ 1ï¼Ÿ\n\n![mark](http://static.imlgw.top///20190503/N4GzYaft0suh.png?imageslim)\n\nä¸»è¦æ˜¯å› ä¸ºiçš„é»˜è®¤å€¼æ˜¯0è€Œæ•°ç»„é»˜è®¤å€¼ä¹Ÿæ˜¯0ï¼Œå¦‚æœä»¥0å¼€å§‹å°±ä¼šå‡ºç°ä¸Šé¢çš„æƒ…å†µã€‚\n\nå…¶å®è¿™ä¸¤ç§ç®—æ³•ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œåªæ˜¯åé¢åˆ¤æ–­å­—ç¬¦æ˜¯å¦å‡ºç°è¿‡çš„æ–¹å¼ä¸åŒï¼Œå‰è€…æ˜¯ç›´æ¥éå†è¿™ä¸ªå­ä¸²ï¼Œåè€…æ˜¯åˆ©ç”¨å­—ç¬¦ä¸ºç´¢å¼•ï¼Œå…¶å€¼å°±æ˜¯ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®(+1)ï¼Œå€Ÿæ­¤æ¥è®¡ç®—é•¿åº¦ã€‚\n\n**å›é¦–æ**\n\n19/9/14ï¼Œåœ¨ç½‘é¡µä¸Šåˆå†™äº†ä¸€ç§ä¸åŒçš„è§£æ³•ï¼Œå±äºè§£æ³•4çš„å˜ä½“ï¼ˆåšçš„æ—¶å€™å¹¶æ²¡æœ‰æƒ³åˆ°è§£æ³•4ï¼‰ï¼Œ`freq[]` æ•°ç»„ç´¢å¼•æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å€¼æ˜¯è¯¥å­—ç¬¦åœ¨sä¸­å¯¹åº”çš„ç´¢å¼•ï¼Œä¸ä¼šéå†ä¸¤éæ•°ç»„ï¼Œleftå¯ä»¥é€šè¿‡ç´¢å¼•ç›´æ¥è·³åˆ°ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®\n\n```java\npublic static int lengthOfLongestSubstring6(String s) {\n    if(s==null||s.length()<1) return 0;\n    if(s.length()==1) return 1;\n    int[] freq=new int[256];\n    int left=0,right=0,res=0;\n    Arrays.fill(freq,-1);\n    while(right<s.length()){\n        char sr=s.charAt(right);\n        //å·²ç»å­˜åœ¨,å¹¶ä¸”åœ¨çª—å£å†…\n        if(freq[sr]!=-1 && freq[sr]>=left){\n            //System.out.println(left+\",\"+right+\",\"+freq[sr]);\n            res=Math.max(res,right-left);\n            left=freq[sr]+1;\n            freq[sr]=right;\n        }else{\n            res=Math.max(res,right-left+1);\n            freq[sr]=right;\n        }\n        right++;\n    }\n    return res;\n}\n```\n**å›é¦–æ2**\n\n```java\npublic static int lengthOfLongestSubstring7(String s) {\n    if(s==null||s.length()<1) return 0;\n    if(s.length()==1) return 1;\n    int[] freq=new int[256];\n    int left=0,right=0,res=0;\n    //Arrays.fill(freq,-1);\n    while(right<s.length()){\n        char sr=s.charAt(right);\n        //å·²ç»å­˜åœ¨(å‡ºç°è¿‡),å¹¶ä¸”ä¸Šä¸€æ¬¡å‡ºç°åœ¨çª—å£å†…\n        if(freq[sr]!=0 && freq[sr]>=left){\n            //è¿™é‡Œä¸åŒ…å«right,æ‰€ä»¥ä¸ç”¨åŠ 1\n            res=Math.max(res,right-left);\n            //leftç§»åŠ¨åˆ°é‡å¤ä½ç½®å…ƒç´ çš„ä¸‹ä¸€ä¸ª\n            //å› ä¸ºfreqçš„å€¼æ˜¯å­˜çš„ç´¢å¼•+1æ‰€ä»¥è¿™é‡Œä¸ç”¨+1\n            left=freq[sr];\n        }else{\n            //è¿™é‡ŒåŒ…å«rightæ‰€ä»¥éœ€è¦åŠ 1\n            res=Math.max(res,right-left+1);\n        }\n        //åŠ 1æ˜¯ä¸ºäº†åŒºåˆ«sçš„ç¬¬ä¸€ä¸ªå­—ç¬¦\n        freq[sr]=right+1;\n        right++;\n    }\n    return res;\n}\n```\næ„Ÿè§‰å¯¹è¿™é¢˜æœ‰å¾ˆæ·±çš„æ‰§å¿µğŸ˜…ï¼Œå¯¹ä¸Šé¢å³ä¼˜åŒ–äº†ä¸€ä¸‹ï¼Œä½†æ˜¯å…¶å®è¿˜æ˜¯ä¸Šé¢çš„è§£æ³•ä¸‰æ¯”è¾ƒç®€å•ï¼Œè¯´åˆ°è§£æ³•ä¸‰ï¼Œæˆ‘åˆæŠ½é£æ”¹äº†ä¸€ä¸ªbooleanæ•°ç»„ç‰ˆæœ¬çš„\n\n```java\n//update: 2020.4.13 é‡å†™äº†ä¸€éï¼Œä»£ç æ›´ç®€æ´äº†\npublic int lengthOfLongestSubstring(String s) {\n    if(s==null ||s.length()<=0) return 0;\n    boolean[] freq=new boolean[128];\n    int left=0,right=0;\n    int max=0;\n    while(left<=right && right<s.length()){\n        if(!freq[s.charAt(right)]){\n            max=Math.max(max,right-left+1);\n            freq[s.charAt(right++)]=true;\n        }else{\n            freq[s.charAt(left++)]=false;\n        }\n    }\n    return max;\n}\n```\n**_ä»¥ä¸Šè§£æ³•å…¨éƒ¨ä½œåºŸ_**\n\nç»Ÿä¸€ä½¿ç”¨`for-while`ç»“æ„ï¼Œèƒ½ç”¨`for-if`çš„ä¸€å®šå¯ä»¥ç”¨`for-while`ï¼Œåè¿‡æ¥å°±ä¸è¡Œ\n\n```java\n//2020.5.5æ ¹æ®è‡ªå·±æ€»ç»“çš„æ»‘çª—æ¨¡æ¿é‡å†™\npublic int lengthOfLongestSubstring(String s) {\n    if(s==null || s.length()<=0) {\n        return 0;\n    }\n    int n=s.length();\n    int left=0;\n    int res=1;\n    boolean[] freq=new boolean[128];\n    for(int right=0;right<n;right++){\n        while(freq[s.charAt(right)]){\n            freq[s.charAt(left++)]=false; //leftä¸ç”¨é™åˆ¶\n        }\n        freq[s.charAt(right)]=true;\n        res=Math.max(res,right-left+1);\n    }\n    return res;\n}\n```\n**æœ€ä¼˜è§£**\n\nmapè®°å½•å…ƒç´ æœ€åå‡ºç°çš„ä½ç½®ï¼Œå½“é‡å¤çš„æ—¶å€™æ›´æ–°èµ·ç‚¹ï¼Œåªç”¨éå†ä¸€é\n```go\nfunc lengthOfLongestSubstring(s string) int {\n    if len(s)==0{\n        return 0\n    }\n    m:=make(map[rune]int)\n    start:=0\n    res:=0\n    for i,ch:=range s{\n        if idx,ok:=m[ch];ok && idx+1>start{\n            start=idx+1\n        }\n        m[ch]=i\n        res=Max(res,i-start+1)\n    }\n    return res\n}\n\nfunc Max(a,b int) int{\n    if a>b{\n        return a\n    }\n    return b\n}\n```\n\n## [219. å­˜åœ¨é‡å¤å…ƒç´  II](https://leetcode-cn.com/problems/contains-duplicate-ii/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° *k*ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• *i* å’Œ *j*ï¼Œä½¿å¾— **nums [i] = nums [j]**ï¼Œå¹¶ä¸” *i* å’Œ *j* çš„å·®çš„ç»å¯¹å€¼æœ€å¤§(ä¸è¶…è¿‡)ä¸º *k*ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums = [1,2,3,1], k = 3\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums = [1,0,1,1], k = 1\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: nums = [1,2,3,1,2,3], k = 2\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å»ºè®®åŒºçœ‹çœ‹åŸç‰ˆçš„è‹±æ–‡é¢˜ï¼Œè¿™é‡Œç¿»è¯‘è¿‡æ¥æœ‰ç‚¹è¯¯å¯¼äººï¼Œåº”è¯¥æ˜¯ä¸è¶…è¿‡kï¼Œå†™ä¸ªæœ€å¤§æå¾—æˆ‘æœ‰ç‚¹æ‡µ\n\n```java\npublic static Boolean containsNearbyDuplicate2(int[] nums, int k) {\n    int len=nums.length;\n    //if(k==35000) return false; å“ˆå“ˆå“ˆå“ˆ\n    if(len==0||k==0)return false;\n    for (int i=1;i<len;i++) {\n        int index=i-1;\n        while(i-index<=k){\n            //kæ­¥ä¹‹å†…\n            if(index<0){\n                break;\n            }\n            if(nums[i]==nums[index--]){\n                return true;\n            }\n        }\n    }\n    return false;\n}\n```\n\næš´åŠ›æ³•ï¼Œæƒ¨ä¸å¿ç¹ï¼Œ600msï¼Œ15%beats ã€‚è¿™é¢˜æœ€å¥½çš„åšæ³•è¿˜æ˜¯å€ŸåŠ©hashè¡¨\n\n**è§£æ³•äºŒ**\n\n```java\npublic static Boolean containsNearbyDuplicate3(int[] nums, int k) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    int len=nums.length;\n    if(len==0||k==0) return false;\n    for (int i=0;i<len;i++) {\n        if(map.containsKey(nums[i])){\n            int index=map.get(nums[i]);\n            if(i-index<=k) {\n                return true;\n            } else {\n                //å¤§äºkäº†é‚£å‰é¢é‚£ä¸ªæ²¡ç”¨äº†\n                map.replace(nums[i],i);\n            }\n        } else {\n            map.put(nums[i],i);\n        }\n    }\n    return false;\n}\n```\n\n12msï¼Œ90%ï¼Œå…¶å®æ•ˆç‡çš„å·®è·å°±åœ¨æŸ¥æ‰¾å­ä¸²é‡Œæœ‰æ²¡æœ‰è¿™ä¸ªå­—ç¬¦ä¸Šï¼ŒHashMapçš„containsKeyçš„æ•ˆç‡æ¯”æˆ‘ä»¬éå†çš„ä¸çŸ¥é“é«˜åˆ°é‚£é‡Œå»äº†ï¼Œåº•å±‚æºç æš‚æ—¶è¿˜çœ‹ä¸å¤ªæ‡‚ï¼Œä»¥åçœ‹çš„æ—¶å€™å†ä¸“é—¨æ¥è®²\n\n19.9.14åˆåšäº†ä¸€éï¼Œç›´æ¥åœ¨ç½‘é¡µä¸Šå†™çš„ï¼Œæœ¬æ¥åº”è¯¥æ˜¯bugfreeçš„ï¼Œç»“æœå‡åäº†ã€‚ã€‚ã€‚\n\n```java\npublic static boolean containsNearbyDuplicate4(int[] nums, int k) {\n\tHashMap<Integer,Integer> hashMap=new HashMap<>();\n\tint left=0,right=0;\n\twhile(right<nums.length){\n\t\tif(hashMap.containsKey(nums[right])){\n\t\t\t//md,é‡æ–°åšçš„æ—¶å€™è¿™é‡Œå‡åäº†çœŸæ˜¯ä¸ªzz\n\t\t\tif(right-hashMap.get(nums[right])<=k){\n\t\t\t\treturn true;\n\t\t\t} else{\n\t\t\t\thashMap.put(nums[right],right);\n\t\t\t}\n\t\t}else{\n\t\t\thashMap.put(nums[right],right);\n\t\t}\n\t\tright++;\n\t}\n\treturn false;\n}\n```\n19.9.15åˆåšäº†ä¸€éï¼Œè¿™æ¬¡ä»£ç å†™çš„å¾ˆç®€æ´ï¼Œæ€è·¯ä¹Ÿä¸åŒäº†ï¼Œç›´æ¥åˆ©ç”¨seté›†åˆï¼Œç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„è¿ç»­set(çª—å£)\n\n```java\npublic boolean containsNearbyDuplicate(int[] nums, int k) {\n    HashSet<Integer> set=new HashSet<>();\n    for (int i=0;i<nums.length;i++) {\n        if (!set.add(nums[i])) {\n            return true;\n        }\n        if (set.size()>k) {\n            set.remove(nums[i-k]);\n        }\n    }\n    return false;\n}\n```\n\n## [209. é•¿åº¦æœ€å°çš„å­æ•°ç»„](https://leetcode-cn.com/problems/minimum-size-subarray-sum/)\n\nç»™å®šä¸€ä¸ªå«æœ‰ **n** ä¸ªæ­£æ•´æ•°çš„æ•°ç»„å’Œä¸€ä¸ªæ­£æ•´æ•° **s ï¼Œ**æ‰¾å‡ºè¯¥æ•°ç»„ä¸­æ»¡è¶³å…¶å’Œ **â‰¥ s** çš„é•¿åº¦æœ€å°çš„è¿ç»­å­æ•°ç»„**ã€‚**å¦‚æœä¸å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„è¿ç»­å­æ•°ç»„ï¼Œè¿”å› 0ã€‚\n\n**ç¤ºä¾‹:** \n\n```java\nè¾“å…¥: s = 7, nums = [2,3,1,2,4,3]\nè¾“å‡º: 2\nè§£é‡Š: å­æ•°ç»„ [4,3] æ˜¯è¯¥æ¡ä»¶ä¸‹çš„é•¿åº¦æœ€å°çš„è¿ç»­å­æ•°ç»„ã€‚\n```\n\n**è¿›é˜¶:**\n\nå¦‚æœä½ å·²ç»å®Œæˆäº†*O*(*n*) æ—¶é—´å¤æ‚åº¦çš„è§£æ³•, è¯·å°è¯• *O*(*n* log *n*) æ—¶é—´å¤æ‚åº¦çš„è§£æ³•ã€‚\n\n**è§£æ³•ä¸€**\n\nè€è§„çŸ©å…ˆä¸Šä¸ªæ…¢çš„\n\n```java\npublic static int minSubArrayLen(int s, int[] nums) {\n    int len=nums.length;\n    if(len==0)return 0;\n    int minLen=Integer.MAX_VALUE;\n    for (int i=1;i<len;i++){\n        if(nums[i-1]>=s) return 1;\n        int index=i-1;\n        int sum=nums[i];\n        //ç´¯åŠ å‰é¢çš„å…ƒç´ ï¼Œç›´åˆ°å¤§äºsæˆ–è€…index<0\n        while(sum<s&&index>=0){\n            sum+=nums[index--];\n        }\n        if(sum>=s){\n            minLen=minLen>i-index?i-index:minLen;\n        } else if(i==len-1){\n            return 0;\n        }\n    }\n    return minLen;\n}\n```\n\nè¿™ä¸ªæ˜¯æœ€å¼€å§‹æƒ³åˆ°äº†æ€è·¯æ¯”è¾ƒæ¸…æ™°ï¼Œéå†æ•°ç»„ç„¶åé€†åºæ±‚å’Œç›´åˆ°å¤§äºSï¼Œè¦æ³¨æ„è¾¹ç•Œï¼Œæ¯”è¾ƒæ…¢ï¼Œä¸»è¦å°±æ˜¯é‚£ä¸ªå¾ªç¯ç´¯åŠ å‰é¢çš„å…ƒç´ ä¼šå¾ˆè€—è´¹æ—¶é—´ï¼Œ111msï¼Œ14% beatsğŸ¤£\n\n**è§£æ³•äºŒ**\n\n```java\npublic static int minSubArrayLen2(int s, int[] nums) {\n    int len =nums.length;\n    if(len==0)return 0;\n    //çª—å£å·¦å³è¾¹ç•Œ\n    int head=0,tail=-1;\n    int minLen=Integer.MAX_VALUE;\n    int sum=0;\n    // 2,3,1,2,4,3 | 7\n    while (tail<len) {\n        if(sum>=s){\n            minLen=minLen>tail-head+1?tail-head+1:minLen;\n            //System.out.println(minLen);\n            //åˆ é™¤å¤´èŠ‚ç‚¹ï¼ˆå·¦è¾¹ç•Œå·¦ç§»ï¼‰\n            sum-=nums[head++];\n        } else{\n            //å°¾æŒ‡é’ˆåˆ°è¾¾è¾¹ç•Œäº†\n            if(tail==len-1) break;\n            //å°¾èŠ‚ç‚¹++ï¼Œ(å³è¾¹ç•Œå³ç§»)\n            sum+=nums[++tail];\n            //å¦‚æœæœ‰å…ƒç´ å¤§äºsç›´æ¥è¿”å›ï¼ŒèŠ‚çº¦æ—¶é—´\n            if(nums[tail]>=s){\n                return 1;\n            }\n        }\n    }\n    return minLen==Integer.MAX_VALUE?0:minLen;\n}\n```\n\n2ms ï¼Œ99%beatsï¼Œä¸€å¯¹æ¯”å·®è·å°±å‡ºæ¥äº†ï¼Œä¸Šé¢è¿™ç§åšæ³•å°±æ˜¯åˆ©ç”¨äº†æ»‘åŠ¨çª—å£çš„æ€æƒ³ï¼Œå¾ˆå·§å¦™çš„åˆ©ç”¨äº†ä¸Šä¸€æ¬¡è®¡ç®—çš„å€¼ï¼Œä¸ç”¨é‡å¤çš„è®¡ç®—ç´¯åŠ å’Œï¼Œä¸Šé¢çš„é‚£ç§æ–¹æ³•æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®—ç´¯åŠ å’Œï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ˜¯é‡å¤çš„è®¡ç®—ï¼Œæ‰€ä»¥æµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼Œè¦æ³¨æ„è¾¹ç•Œæ¡ä»¶\n\n`2 3 1 2 4 3  s=7`\n\n![mark](http://static.imlgw.top///20190504/U9BTOJMRVhDO.jpg?imageslim)\n\nè‡ªå·±åœ¨çº¸ä¸Šç”»ä¸€ä¸‹å°±æ‡‚äº†\n\n**è§£æ³•ä¸‰**\n\n~~æ‰¾åˆ°ä¸€ä¸ªæ¨¡æ¿ï¼Œç»Ÿä¸€ä¸€ä¸‹å†™æ³•~~\n\n```java\npublic static int minSubArrayLen3(int s, int[] nums) {\n    int len =nums.length-1;\n    if(len==0)return 0;\n    int head=0,tail=-1;\n    int minLen=Integer.MAX_VALUE;\n    int sum=0;\n    // 2,3,1,2,4,3 | 7\n    while (head<=len) {\n        if(tail+1<=len && sum<s){\n            sum+=nums[++tail];\n        }else{\n            sum-=nums[head++];\n        }\n        if(sum>=s){\n            minLen=minLen>tail-head+1?tail-head+1:minLen;\n        }\n    }\n    return minLen==Integer.MAX_VALUE?0:minLen;\n}\n```\n\n**Update(2020.5.4)**\n\nä¸Šé¢çš„è¿™ä¹Ÿé…å«æ¨¡æ¿ï¼Ÿä¸‹é¢çš„æ˜¯é‡åšçš„æ—¶å€™ç»Ÿä¸€çš„å†™æ³•\n\n```go\nvar INF = 1 << 31\n\nfunc minSubArrayLen(s int, nums []int) int {\n    left := 0\n    sum := 0\n    res := INF\n    for right := 0; right < len(nums); right++ {\n        sum += nums[right]\n        for sum >= s {\n            res = Min(res, right-left+1)\n            sum -= nums[left]\n            left++\n        }\n    }\n    if res == INF {\n        return 0\n    }\n    return res\n}\n\nfunc Min(a, b int) int {\n    if a < b {\n        return a\n    }\n    return b\n}\n```\n\n## [é¢è¯•é¢˜57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—](https://leetcode-cn.com/problems/he-wei-sde-lian-xu-zheng-shu-xu-lie-lcof/) \n\nè¾“å…¥ä¸€ä¸ªæ­£æ•´æ•° target ï¼Œè¾“å‡ºæ‰€æœ‰å’Œä¸º target çš„è¿ç»­æ­£æ•´æ•°åºåˆ—ï¼ˆè‡³å°‘å«æœ‰ä¸¤ä¸ªæ•°ï¼‰ã€‚\n\nåºåˆ—å†…çš„æ•°å­—ç”±å°åˆ°å¤§æ’åˆ—ï¼Œä¸åŒåºåˆ—æŒ‰ç…§é¦–ä¸ªæ•°å­—ä»å°åˆ°å¤§æ’åˆ—ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼štarget = 9\nè¾“å‡ºï¼š[[2,3,4],[4,5]]\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼štarget = 15\nè¾“å‡ºï¼š[[1,2,3,4,5],[4,5,6],[7,8]]\n```\n\n**é™åˆ¶ï¼š**\n\n- `1 <= target <= 10^5`\n\n**è§£æ³•ä¸€**\n\næ»‘åŠ¨çª—å£ï¼Œæ ¹æ®ç­‰å·®æ•°åˆ—å‰né¡¹å’Œæ±‚sumï¼Œç„¶åé€æ­¥çš„ç¼©åœˆï¼Œå³ç§»\n\n```java\npublic int[][] findContinuousSequence(int target) {\n    List<int[]> res=new ArrayList<>();\n    int left=1,right=2;\n    int sum=0;\n    //9 rightæœ€å¤šåˆ°5\n    while(left<=right && right<=(target+1)/2){\n        //ç­‰å·®æ•°åˆ—å‰né¡¹å’Œ\n        int n=right-left+1;\n        sum=left*n+n*(n-1)/2;\n        if(sum>target){\n            left++; //å‰”é™¤ä¸€ä¸ªå°çš„\n        }else if(sum<target){\n            right++; //æ·»åŠ ä¸€ä¸ªå¤§çš„\n        }else{ //buildç»“æœé›†\n            res.add(build(left,right));\n            left++;//çª—å£å·¦ç§»,å‰”é™¤ä¸€ä¸ªå°çš„\n            right++; //å›å¤´é‡å†™å‘ç°è¿™é‡Œè¿˜å¯ä»¥ä¼˜åŒ–,å³è¾¹ç•Œä¹Ÿå¯ä»¥æ‰©å¤§\n        }\n    }\n    return res.toArray(new int[0][0]);\n}\n\npublic int[] build(int left,int right){\n    int[] res=new int[right-left+1];\n    for(int i=left;i<=right;i++){\n        res[i-left]=i;\n    }\n    return res;\n}\n```\nè¿™é‡Œå…¶å®å¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œè¿˜æœ‰æ›´å¥½çš„æ•°å­¦è§£æ³•ï¼Œç›´æ¥æ ¹æ®æ±‚å’Œå…¬å¼ï¼Œæšä¸¾æ‰€æœ‰çš„é•¿åº¦ï¼Œé€†å‘æ±‚å‡ºæ‰€æœ‰çš„é¦–é¡¹ï¼Œè¿™é‡Œåé¢æœ‰æ—¶é—´å†æ¥å®ç°\n\n## [480. æ»‘åŠ¨çª—å£ä¸­ä½æ•°](https://leetcode-cn.com/problems/sliding-window-median/)\n\nä¸­ä½æ•°æ˜¯æœ‰åºåºåˆ—æœ€ä¸­é—´çš„é‚£ä¸ªæ•°ã€‚å¦‚æœåºåˆ—çš„å¤§å°æ˜¯å¶æ•°ï¼Œåˆ™æ²¡æœ‰æœ€ä¸­é—´çš„æ•°ï¼›æ­¤æ—¶ä¸­ä½æ•°æ˜¯æœ€ä¸­é—´çš„ä¸¤ä¸ªæ•°çš„å¹³å‡æ•°ã€‚\n\nä¾‹å¦‚ï¼š\n\n```java\n[2,3,4]ï¼Œä¸­ä½æ•°æ˜¯ 3\n[2,3]ï¼Œä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5\n```\n\nç»™å‡ºä¸€ä¸ªæ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º *k* çš„çª—å£ä»æœ€å·¦ç«¯æ»‘åŠ¨åˆ°æœ€å³ç«¯ã€‚çª—å£ä¸­æœ‰ k ä¸ªæ•°ï¼Œæ¯æ¬¡çª—å£ç§»åŠ¨ 1 ä½ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ‰¾å‡ºæ¯æ¬¡çª—å£ç§»åŠ¨åå¾—åˆ°çš„æ–°çª—å£ä¸­å…ƒç´ çš„ä¸­ä½æ•°ï¼Œå¹¶è¾“å‡ºç”±å®ƒä»¬ç»„æˆçš„æ•°ç»„ã€‚\n\nä¾‹å¦‚ï¼š\n\nç»™å‡º *nums* = `[1,3,-1,-3,5,3,6,7]`ï¼Œä»¥åŠ *k* = 3ã€‚\n\n```java\nçª—å£ä½ç½®                      ä¸­ä½æ•°\n---------------               -----\n[1  3  -1] -3  5  3  6  7       1\n 1 [3  -1  -3] 5  3  6  7       -1\n 1  3 [-1  -3  5] 3  6  7       -1\n 1  3  -1 [-3  5  3] 6  7       3\n 1  3  -1  -3 [5  3  6] 7       5\n 1  3  -1  -3  5 [3  6  7]      6\n```\n\n å› æ­¤ï¼Œè¿”å›è¯¥æ»‘åŠ¨çª—å£çš„ä¸­ä½æ•°æ•°ç»„ `[1,-1,-1,3,5,6]`ã€‚\n\n**æç¤ºï¼š**\nå‡è®¾`k`æ˜¯åˆæ³•çš„ï¼Œå³ï¼š`k` å§‹ç»ˆå°äºè¾“å…¥çš„éç©ºæ•°ç»„çš„å…ƒç´ ä¸ªæ•°.\n\nheadé¢˜ï¼Œç†æ¸…æ¥šæ€è·¯åä¹Ÿä¸éš¾ã€‚\n\n```java\npublic static double[] medianSlidingWindow(int[] nums, int k) {\n    //çœ‹äº†ä¸€åœˆè¯„è®ºåŒºï¼Œå¤§æ¦‚çŸ¥é“æ€è·¯äº†ï¼Œè¿˜æ˜¯è¦æ’åº\n    //List<Integer> list=new ArrayList<>(); ç”¨é“¾è¡¨è¿˜æ˜¯ä¸æ–¹ä¾¿å•Š\n    int [] queue=new int[k];\n    int head=0,tail=k-1;\n    //å¤´å°¾\n    double [] res=new double[nums.length-k+1];\n    for (int i=0;i<k;i++) {\n        queue[i]=nums[i];\n    }\n    Arrays.sort(queue);\n    printArray(queue);\n    if (k%2==0) {\n        res[0]=queue[(k-1)/2]/2.0+queue[(k-1)/2+1]/2.0;\n        //æ³¨æ„é™¤å°æ•° .ã€‚ã€‚ã€‚ã€‚è¿™é‡Œçš„æµ‹è¯•ç”¨ä¾‹Integeræœ€å¤§å€¼ï¼Œç›´æ¥ç›¸åŠ /2ä¼šè¶Šç•Œ\n    } else {\n        res[0]=queue[k/2];\n    }\n    for (int i=k;i<nums.length;i++) {\n        //æ’å…¥ä¹‹å‰è¦ç§»é™¤ä¸Šä¸€æ¬¡çš„å¤´å…ƒç´ ï¼Œè¿™é‡Œç”¨æ•°ç»„ä¸å¥½æå•Šå•Š\n        //System.out.println(nums[i-k]);\n        deleHead(queue,nums[i-k]);\n        tail--;\n        //printArray(queue);\n        //äºŒåˆ†æ‰¾æ’å…¥ç‚¹\n        int index=binarySearch(queue,0,tail,nums[i]);\n        System.out.println(index);\n        tail++;\n        //æ’å…¥å…ƒç´ ï¼Œtail++;\n        for (int j=tail;j>index;j--) {\n            //åä¸€ä¸ªç­‰äºå‰ä¸€ä¸ªï¼Œç»™æ’å…¥çš„å…ƒç´ è…¾å‡ºä½ç½®\n            queue[j]=queue[j-1];\n        }\n        queue[index]=nums[i];\n        //æ±‚ä¸­ç‚¹\n        if (k%2==0) {\n            res[i-k+1]=queue[head+(tail-head)/2]/2.0+queue[head+(tail-head)/2+1]/2.0;\n        } else {\n            res[i-k+1]=queue[head+(tail-head)/2];\n        }\n    }\n    return res;\n}\n\npublic static void deleHead(int []nums,int target){\n    for (int j=0,i=0;j<nums.length;j++,i++) {\n        if(nums[j]==target){\n            if (i==nums.length-1) {\n                return;\n            }\n            while(i<nums.length-1){\n                nums[i]=nums[i+1];\n                i++;\n            }\n            return;\n        }\n    }\n}\n\npublic  static int binarySearch(int []nums,int lo,int hi,int target){\n    while(lo<=hi){\n        int mid=lo+(hi-lo)/2;\n        if(nums[mid]<target){\n            lo=mid+1;\n        } else if(nums[mid]>target){\n            hi=mid-1;\n        } else{\n            return mid;\n        }\n    }\n    return lo;\n}\n```\n\næ ¹æ®è¯„è®ºåŒºæä¾›çš„æ€è·¯ï¼Œç”¨æ•°ç»„å®ç°äº†ä¸€éï¼Œå½“æ—¶å°±æ„Ÿè§‰æœ‰é—®é¢˜ï¼Œç¡®å®ï¼Œæœ€å 164ms ï¼Œ27%ï¼Œå¾ˆæ…¢äº†ï¼Œæˆ‘è§‰å¾—ä¸»è¦é—®é¢˜å°±æ˜¯é‚£ä¸ªåˆ é™¤å¤´çš„æ“ä½œï¼Œä½†æ˜¯æ¯•ç«Ÿæ•°ç»„ï¼Œæ²¡åŠæ³•ï¼Œéšå³æ”¹ç”¨é“¾è¡¨\n\n```java\npublic static double[] medianSlidingWindow2(int[] nums, int k) {\n    //çœ‹äº†ä¸€åœˆè¯„è®ºåŒºï¼Œå¤§æ¦‚çŸ¥é“æ€è·¯äº†ï¼Œè¿˜æ˜¯è¦æ’åº\n    List<Integer> list=new ArrayList<>();\n    int head=0,tail=k-1;\n    //å¤´å°¾\n    double [] res=new double[nums.length-k+1];\n    //Arrays.sort(nums,0,k);\n    int []temp=new int[k];\n    for (int i=0;i<k;i++) {\n        temp[i]=nums[i];\n    }\n    Arrays.sort(temp);\n    for (int i=0;i<k;i++) {\n        list.add(temp[i]);\n    }\n    if (k%2==0) {\n        res[0]=list.get((k-1)/2)/2.0+list.get((k-1)/2+1)/2.0;\n    } else {\n        res[0]=list.get(k/2);\n    }\n    for (int i=k;i<nums.length;i++) {\n        //æ’å…¥ä¹‹å‰è¦ç§»é™¤ä¸Šä¸€æ¬¡çš„å¤´å…ƒç´ ï¼Œè¿™é‡Œç”¨æ•°ç»„ä¸å¥½æå•Šå•Š\n        //list.remove((Object)nums[i-k]); ç›´æ¥åˆ å¤ªæ…¢äº†\n        int dele=binarySearch(list,0,k-1,nums[i-k]);\n        list.remove(dele);\n        //System.out.println(list);\n        //äºŒåˆ†æ‰¾æ’å…¥ç‚¹ï¼Œæ‰¾çš„åŒºé—´ä¸º [i-k+1, i-1]\n        //int head=i-k+1,tail=i-1;\n        int index=binarySearch(list,0,k-2,nums[i]);\n        System.out.println(index);\n        list.add(-1);\n        for (int j=k-1;j>index;j--) {\n            //åä¸€ä¸ªç­‰äºå‰ä¸€ä¸ªï¼Œç»™æ’å…¥çš„å…ƒç´ è…¾å‡ºä½ç½®\n            list.set(j,list.get(j-1));\n        }\n        list.set(index,nums[i]);\n        System.out.println(list);\n        //æ±‚ä¸­ç‚¹\n        if (k%2==0) {\n            res[i-k+1]=list.get((k-1)/2) / 2.0 + list.get((k-1)/2+1)/2.0;\n        } else {\n            res[i-k+1]=list.get(k/2);\n        }\n    }\n    return res;\n}\npublic  static int binarySearch(List<Integer> list,int lo,int hi,int target){\n    while(lo<=hi){\n        int mid=lo+(hi-lo)/2;\n        if(list.get(mid)<target){\n            lo=mid+1;\n        } else if(list.get(mid)>target){\n            hi=mid-1;\n        } else{\n            return mid;\n        }\n    }\n    return lo;\n}\n```\n\n47msï¼Œ70%å·¦å³ï¼Œåˆ é™¤çš„æ—¶å€™åˆ©ç”¨äºŒåˆ†åˆ é™¤ï¼Œå¦‚æœç›´æ¥æ ¹æ®å…ƒç´ å»åˆ å°±è·Ÿæ•°ç»„æ•ˆç‡å·®ä¸å¤šäº†ã€‚\n\n## [76. æœ€å°è¦†ç›–å­ä¸²](https://leetcode-cn.com/problems/minimum-window-substring/)\n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² Sã€ä¸€ä¸ªå­—ç¬¦ä¸² Tï¼Œè¯·åœ¨å­—ç¬¦ä¸² S é‡Œé¢æ‰¾å‡ºï¼šåŒ…å« T æ‰€æœ‰å­—æ¯çš„æœ€å°å­ä¸²ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥: S = \"ADOBECODEBANC\", T = \"ABC\"\nè¾“å‡º: \"BANC\"\n```\n\n**è¯´æ˜ï¼š**\n\n- å¦‚æœ S ä¸­ä¸å­˜è¿™æ ·çš„å­ä¸²ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² \"\"ã€‚\n- å¦‚æœ S ä¸­å­˜åœ¨è¿™æ ·çš„å­ä¸²ï¼Œæˆ‘ä»¬ä¿è¯å®ƒæ˜¯å”¯ä¸€çš„ç­”æ¡ˆã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic static String minWindow(String s, String t) {\n    int slen=s.length();\n    int tlen=t.length();\n    int l=0,r=0; //åˆå§‹éƒ½ä¸º0\n    int[] target=new int[256]; //A:1 B:1 C:1\n    int[] window=new int[256];\n    int count=0; //ä¸åŒå­—ç¬¦çš„æ•°é‡\n    for (int i=0;i<tlen;i++) {\n        target[t.charAt(i)]++;\n    }\n    for (int a:target) {\n        if (a!=0) {\n            count++; //ç»Ÿè®¡ä¸åŒå­—ç¬¦å‡ºç°çš„æ¬¡æ•°\n        }\n    }\n    int match=0; //matchä»£è¡¨å·²ç»åŒ¹é…çš„å­—ç¬¦\n    int[] res=new int[]{0,Integer.MAX_VALUE};\n    while(r<slen){\n        char c=s.charAt(r); \n        if(target[c]!=0){ //åœ¨ç›®æ ‡å­ä¸²ä¸­å­˜åœ¨\n            window[c]++; //windowå¯¹åº”çš„char++\n            if(window[c]==target[c]){ //åˆ°è¾¾äº†ç›®æ ‡ä¸²ä¸­è¯¥charæ‰€éœ€çš„æ•°é‡\n                match++;\n            }\n        }\n        r++;\n        while(l<r&&count==match) { //æ»¡è¶³ç›®æ ‡ä¸²ï¼Œæ³¨æ„åˆ«è¶Šç•Œ\n            char d=s.charAt(l);\n            if (r-l<res[1]-res[0]) { //ç»Ÿè®¡æœ€å°å€¼\n                res[0]=l;\n                res[1]=r;\n            }\n            l++;\n            if (target[d]!=0) {\n                window[d]--;\n                if (window[d]<target[d]) {//å·¦è¾¹ç•Œå·¦ç§»åä¸å†æ»¡è¶³ç›®æ ‡ä¸²\n                    match--;\n                }\n            }\n        }\n    }\n    return res[1]==Integer.MAX_VALUE?\"\":s.substring(res[0],res[1]);\n}\n```\n10ms 86%ï¼ŒHardé¢˜ï¼Œå…¶å®å¤§è‡´çš„æ€è·¯è¿˜æ˜¯æœ‰çš„ï¼Œä¸»è¦æ˜¯ä¸çŸ¥é“æ€ä¹ˆå»å’Œç›®æ ‡ä¸²å¯¹æ¯”ï¼Œæ²¡æƒ³åˆ°ç”¨ä¸€ä¸ª`window`æ•°ç»„å»å¯¹æ¯”ï¼Œä¸€è‡´æƒ³çš„æ˜¯åœ¨ç›®æ ‡ä¸²çš„æ•°ç»„ä¸Šåšæ‰‹è„šï¼Œä½†æ˜¯è¶Šæƒ³è¶Šå¤æ‚ã€‚ã€‚ã€‚å¤ªè ¢äº†ğŸ˜…ï¼Œè¿™é¢˜å…¶å®ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªHashMapæ¥åšï¼Œä½†æ˜¯æˆ‘çœ‹äº†ä¸‹æäº¤è®°å½•ä¸Šçš„æ™®ééƒ½æ˜¯7,80msï¼Œç›¸å¯¹éƒ½æ¯”è¾ƒæ…¢ï¼Œå®é™…ä¸Šé¢˜ç›®æ²¡æœ‰æ˜ç¡®çš„è¯´æ˜æœ‰ç‰¹æ®Šå­—ç¬¦çš„è¯éƒ½æ˜¯å¯ä»¥ç”¨ä¸€ä¸ª**ASCII**æ•°ç»„æ¥å……å½“HashMapçš„ï¼Œå½“ç„¶æˆ‘è¿™é‡Œç”¨æ•°ç»„çš„æ—¶å€™ç›¸æ¯”HashMapè¦å¤šäº†ä¸€æ­¥ï¼Œéœ€è¦ç»Ÿè®¡ä¸åŒå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œä¸è¿‡è¿™ä¸ªæ“ä½œä¹Ÿæ˜¯å¸¸æ•°çº§åˆ«çš„æ“ä½œï¼Œå¹¶ä¸è€—æ—¶ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦O(N+M)ï¼ŒNMåˆ†åˆ«ä»£è¡¨ç›®æ ‡å­ä¸²`t` å’Œæºå­—ç¬¦ä¸² `p`çš„é•¿åº¦ï¼Œé¦–å…ˆéå†äº†`t` ç„¶åæ»‘åŠ¨çª—å£ï¼Œåé¢çš„æ»‘åŠ¨çª—å£å·¦å³è¾¹ç•Œæœ€å¤šç§»åŠ¨2Mæ¬¡\n\n**Update**\n\n2020.4.15ï¼Œåœ¨ç„äº†ä¸€çœ¼ä¹‹å‰åšçš„ä¹‹åæŒ‰ç…§ä¹‹å‰çš„æ€è·¯é‡å†™äº†ä¸€éï¼Œæ„Ÿè§‰è¿˜è¡Œï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹WAäº†ä¸€æ¬¡\n\n```java\n//update: 2020.4.15\npublic String minWindow(String s, String t) {\n    if(s==null || t==null) return \"\";\n    int[] needMap=new int[128]; //éœ€è¦çš„å­—ç¬¦map\n    int[] curMap=new int[128];  //å·²ç»åŒ¹é…çš„å­—ç¬¦map\n    int needCount=0; //éœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸ªæ•°\n    for(int i=0;i<t.length();i++){\n        if(needMap[t.charAt(i)]==0){\n            needCount++;\n        }\n        needMap[t.charAt(i)]++;\n    }\n    int matchCount=0; //å·²ç»åŒ¹é…çš„ä¸ªæ•°\n    int left=0,right=0;\n    int minLeft=0,maxRight=Integer.MAX_VALUE;\n    while(left<=right && right<s.length()){\n        char c=s.charAt(right);\n        if(needMap[c]!=0){\n            curMap[c]++;\n            if(curMap[c]==needMap[c]){\n                matchCount++;\n            }\n        }\n        while(left<=right && right<s.length() && matchCount==needCount){\n            if(right-left<maxRight-minLeft){\n                maxRight=right;\n                minLeft=left;\n            }\n            char cl=s.charAt(left);\n            if(curMap[cl]!=0){\n                curMap[cl]--;\n                //è¿™é‡Œæ³¨æ„ï¼ŒWAç‚¹ï¼Œå¼€å§‹å†™çš„=0\n                if(curMap[cl]<needMap[cl]){\n                    matchCount--;\n                }\n            }\n            left++;\n        }\n        right++;\n    }\n    return Integer.MAX_VALUE==maxRight?\"\":s.substring(minLeft,maxRight+1);\n}\n```\n> åˆ·é¢˜çš„æ—¶å€™å‘ç°æœ‰ä¸€é“å¾ˆç±»ä¼¼çš„é¢˜ï¼Œ[æœ€å°çª—å£å­åºåˆ—](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#857-%E6%9C%80%E5%B0%8F%E7%9A%84%E7%AA%97%E5%8F%A3%E5%AD%90%E5%BA%8F%E5%88%97%EF%BC%88LintCode%EF%BC%89)å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯è¿™é“é¢˜è¦æ±‚æœ‰åºï¼ˆå­åºåˆ—ï¼‰\n\n## [632. æœ€å°åŒºé—´](https://leetcode-cn.com/problems/smallest-range-covering-elements-from-k-lists/)\n\nDifficulty: **å›°éš¾**\n\n\nä½ æœ‰Â `k`Â ä¸ªå‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ã€‚æ‰¾åˆ°ä¸€ä¸ª**æœ€å°**åŒºé—´ï¼Œä½¿å¾—Â `k`Â ä¸ªåˆ—è¡¨ä¸­çš„æ¯ä¸ªåˆ—è¡¨è‡³å°‘æœ‰ä¸€ä¸ªæ•°åŒ…å«åœ¨å…¶ä¸­ã€‚\n\næˆ‘ä»¬å®šä¹‰å¦‚æœÂ `b-a < d-c`Â æˆ–è€…åœ¨Â `b-a == d-c`Â æ—¶Â `a < c`ï¼Œåˆ™åŒºé—´ [a,b] æ¯” [c,d] å°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:[[4,10,15,24,26], [0,9,12,20], [5,18,22,30]]\nè¾“å‡º: [20,24]\nè§£é‡Š: \nåˆ—è¡¨ 1ï¼š[4, 10, 15, 24, 26]ï¼Œ24 åœ¨åŒºé—´ [20,24] ä¸­ã€‚\nåˆ—è¡¨ 2ï¼š[0, 9, 12, 20]ï¼Œ20 åœ¨åŒºé—´ [20,24] ä¸­ã€‚\nåˆ—è¡¨ 3ï¼š[5, 18, 22, 30]ï¼Œ22 åœ¨åŒºé—´ [20,24] ä¸­ã€‚\n```\n\n**æ³¨æ„:**\n\n1.  ç»™å®šçš„åˆ—è¡¨å¯èƒ½åŒ…å«é‡å¤å…ƒç´ ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå‡åºè¡¨ç¤º >= ã€‚\n2.  1 <= `k` <= 3500\n3.  -10<sup>5</sup> <= `å…ƒç´ çš„å€¼`Â <= 10<sup>5</sup>\n\n\n**è§£æ³•ä¸€**\n\n```golang\nfunc smallestRange(nums [][]int) []int {\n    var n = len(nums)\n    //åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ k,å­˜åœ¨äºé‚£äº›æ•°ç»„ä¸­\n    var m = make(map[int][]int)\n    var Max = func (a, b int) int {if a > b {return a}; return b}\n    var Min = func (a, b int) int {if a < b {return a}; return b}\n    //è®°å½•æœ€å¤§æœ€å°å€¼ï¼Œç„¶ååœ¨åŒºé—´å†…æ»‘çª—ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†æ‰€æœ‰æ•°ç»„å½’å¹¶æ’ä¸€ä¸‹ï¼Œç„¶åæ»‘çª—ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæ‡’å¾—å†™äº†\n    //æ‰€ä»¥ä¸‹é¢çš„åšæ³•å®é™…ä¸Šæ˜¯å’Œå¾ªåºæ— å…³çš„ï¼Œæ²¡æœ‰ç”¨åˆ°æœ‰åºè¿™ä¸ªæ¡ä»¶\n    var maxV = math.MinInt32\n    var minV = math.MaxInt32\n    for i :=0; i < n; i++ {\n        for j := 0; j < len(nums[i]); j++ {\n            m[nums[i][j]] = append(m[nums[i][j]], i)\n            maxV = Max(maxV, nums[i][j])\n            minV = Min(minV, nums[i][j])\n        }\n    }\n    //åŒ 76.æœ€å°è¦†ç›–å­ä¸²ï¼Œè¿™é¢˜å¯èƒ½æ€ç»´çš„è½¬æ¢æ¯”è¾ƒé‡è¦\n    var count = 0\n    var freq = make([]int, n+1)\n    var res =[]int{minV, maxV}\n    var left = minV\n    for right := minV; right <= maxV; right++ {\n        if lis, ok := m[right]; ok {\n            for _, numIdx := range lis {\n                freq[numIdx]++\n                if freq[numIdx] == 1{\n                    count++\n                }\n            }\n        }\n        for count == n && left <= right {\n            if right-left < res[1]-res[0] {\n                res[0] = left\n                res[1] = right\n            }\n            if lis, ok := m[left]; ok{\n                for _, numIdx := range lis {\n                    freq[numIdx]--\n                    if freq[numIdx] < 1 {\n                        count--\n                    }\n                }\n            }\n            left++\n        }\n    }\n    return res\n}\n```\n**è§£æ³•äºŒ**\n\nä¸Šé¢çš„è§£æ³•å¹¶ä¸æ˜¯æœ€å¥½çš„è§£æ³•ï¼Œæ²¡æœ‰ç”¨åˆ°æœ‰åºçš„æ¡ä»¶ï¼Œæ¯”è¾ƒå¥½çš„è§£æ³•åº”è¯¥æ˜¯å°æ ¹å †ï¼ˆæœ¬æ¥æ‰“ç®—ç”¨Goæ’¸ä¸€ä¸ªçš„ï¼Œå†™ä¸€åŠæ„Ÿè§‰å¤ªéº»çƒ¦äº†ï¼Œä¸è¿‡æ•´ä½“å°æ ¹å †çš„é€»è¾‘å®ç°æ˜¯å¯¹çš„ï¼Œå°±æ˜¯æ²¡æœ‰æ³›å‹è¦æ”¹å¾ˆå¤šä¸œè¥¿ï¼Œä¸å¤ªæ–¹ä¾¿ï¼‰\n![](https://i.loli.net/2020/11/30/Q5KsxNi3MquZtWE.png)\nç»´æŠ¤ä¸¤ä¸ªæœ€å€¼ï¼Œä¸€ä¸ªæ˜¯æ‰¾åˆ°ä¸€ä¸ªèƒ½è¦†ç›–å½“å‰æ‰€æœ‰åˆ—è¡¨çš„æœ€å°çš„å³ç«¯ç‚¹ï¼ˆmaxï¼‰ï¼Œä¸€ä¸ªæ˜¯å½“å‰åˆ—è¡¨æœ€å°çš„é‚£ä¸ªå…ƒç´ ï¼ˆæœ€å·¦çš„ç«¯ç‚¹ï¼‰ï¼Œç„¶åä¸æ–­ç¼©å‡å·¦ç«¯ç‚¹æ±‚æœ€å°åŒºé—´\n```java\nclass Node {\n    int i, j;\n    public Node (int i, int j) {\n        this.i = i;\n        this.j = j;\n    }\n}\n\n//kç»„é“¾è¡¨ï¼Œå¹³å‡mä¸ªå…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ O(kmlog(k))\npublic int[] smallestRange(List<List<Integer>> nums) {\n    PriorityQueue<Node> pq = new PriorityQueue<>((a, b) -> nums.get(a.i).get(a.j)-nums.get(b.i).get(b.j));\n    int INF = (int) 1e5+1;\n    int max = Integer.MIN_VALUE;\n    for (int i = 0; i < nums.size(); i++) {\n        pq.add(new Node(i, 0));\n        max = Math.max(max, nums.get(i).get(0));\n    }\n    int [] res = {-INF, INF};\n    while (true) {\n        Node cur = pq.poll();\n        //åº”è¯¥æŠŠvalä¹Ÿå­˜è¿›å»çš„ï¼Œæ‡’å¾—æ”¹äº†\n        if (max-nums.get(cur.i).get(cur.j) < res[1]-res[0]) {\n            res[0] = nums.get(cur.i).get(cur.j);\n            res[1] = max;\n        }\n        if (cur.j+1 >= nums.get(cur.i).size()) {\n            break;\n        }\n        pq.add(new Node(cur.i, cur.j+1));\n        max = Math.max(max, nums.get(cur.i).get(cur.j+1));\n    }\n    return res;\n}\n```\n\n## [438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯](https://leetcode-cn.com/problems/find-all-anagrams-in-a-string/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² **s** å’Œä¸€ä¸ªéç©ºå­—ç¬¦ä¸² **p**ï¼Œæ‰¾åˆ° **s** ä¸­æ‰€æœ‰æ˜¯ **p** çš„å­—æ¯å¼‚ä½è¯çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚\n\nå­—ç¬¦ä¸²åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”å­—ç¬¦ä¸² **s** å’Œ **p** çš„é•¿åº¦éƒ½ä¸è¶…è¿‡ 20100ã€‚\n\n**è¯´æ˜ï¼š**\n\n- å­—æ¯å¼‚ä½è¯æŒ‡å­—æ¯ç›¸åŒï¼Œä½†æ’åˆ—ä¸åŒçš„å­—ç¬¦ä¸²ã€‚\n- ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\ns: \"cbaebabacd\" p: \"abc\"\nè¾“å‡º:\n[0, 6]\n\nè§£é‡Š:\nèµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ \"cba\", å®ƒæ˜¯ \"abc\" çš„å­—æ¯å¼‚ä½è¯ã€‚\nèµ·å§‹ç´¢å¼•ç­‰äº 6 çš„å­ä¸²æ˜¯ \"bac\", å®ƒæ˜¯ \"abc\" çš„å­—æ¯å¼‚ä½è¯ã€‚\n```\n\n **ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\ns: \"abab\" p: \"ab\"\n\nè¾“å‡º:\n[0, 1, 2]\n\nè§£é‡Š:\nèµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ \"ab\", å®ƒæ˜¯ \"ab\" çš„å­—æ¯å¼‚ä½è¯ã€‚\nèµ·å§‹ç´¢å¼•ç­‰äº 1 çš„å­ä¸²æ˜¯ \"ba\", å®ƒæ˜¯ \"ab\" çš„å­—æ¯å¼‚ä½è¯ã€‚\nèµ·å§‹ç´¢å¼•ç­‰äº 2 çš„å­ä¸²æ˜¯ \"ab\", å®ƒæ˜¯ \"ab\" çš„å­—æ¯å¼‚ä½è¯ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å’Œä¸Šé¢ä¸€é¢˜å…¶å®ä¸€æ ·ï¼Œåªæ˜¯è¿™é‡Œè¦æ±‚æ˜¯è¿ç»­çš„ï¼Œåœ¨ä¸Šé¢ä¸€é¢˜çš„åŸºç¡€ä¸Šåœ¨æ·»åŠ ç»“æœçš„æ—¶å€™åˆ¤æ–­ä¸‹é•¿åº¦å°±OK\n\n```java\npublic List<Integer> findAnagrams(String s, String p) {\n    int[] target=new int[256];\n    int[] window=new int[256];\n    int l=0,r=0;\n    int plen=p.length();\n    int slen=s.length();\n    int count=0,match=0;\n    List<Integer> res=new ArraysList<>();\n    for (int i=0;i<plen;i++) {\n        target[p.charAt(i)]++;\n    }\n    for (int a:target) {\n        if(a!=0){\n            count++;\n        }\n    }\n\n    while(r<slen){\n        char right=s.charAt(r);\n        if (target[right]!=0) {\n            window[right]++;\n            if (window[right]==target[right]) {\n                match++;\n            }\n        }\n        r++;\n        while(l<r && count==match){\n            char left=s.charAt(l);\n            if (r-l==res) {\n                res.add(l);\n            }\n            l++;\n            if (target[left]!=0) {\n                window[left]--;\n                //ä¸æ»¡è¶³äº†\n                if (window[left]<target[left]) {\n                    match--;\n                }\n            }\n        }\n    }\n    return res;\n}\n```\n**UPDATE:2020.7.23**\n\nç”¨æ¨¡æ¿é‡å†™äº†ä¸‹\n```golang\nfunc findAnagrams(s string, p string) []int {\n    var target = make([]int, 128)\n    var window = make([]int, 128)\n    var match = 0\n    for _, sp := range p {\n        if target[sp] == 0 {\n            match++\n        }\n        target[sp]++\n    }\n    var left = 0\n    var count = 0\n    var res []int\n    for right := 0; right < len(s); right++ {\n        if target[s[right]] > 0 {\n            window[s[right]]++\n            if window[s[right]] == target[s[right]] {\n                count++\n            }\n        }\n        for count == match && left <= right {\n            if right-left+1 == len(p) {\n                res = append(res, left)\n            }\n            if window[s[left]] > 0 {\n                window[s[left]]--\n                if window[s[left]] < target[s[left]] {\n                    count--\n                }\n            }\n            left++\n        }\n    }\n    return res\n}\n```\n15msï¼Œ86%æ—¶é—´å¤æ‚åº¦`O(M+N)`ï¼Œå…¶å®æ˜¯å®Œå…¨å¥—çš„ä¹‹å‰æœ€å°è¦†ç›–å­ä¸²çš„æ¨¡æ¿ï¼Œä¸å¦‚è‚¯å®šä¸å¥½å†™è¿™ä¹ˆé•¿\n\n**è§£æ³•äºŒ**\n\næ­£å¸¸çš„åšæ³•ï¼Œå®é™…ä¸Šä¸Šé¢çš„è§£æ³•ä¸€ç›´åœ¨é¿å…ç›´æ¥æ¯”è¾ƒtargetå’Œwindowï¼Œä½†æ˜¯å®é™…ä¸Šæ¯”è¾ƒè¿™ä¸¤ä¸ªæ•°ç»„çš„æˆæœ¬æ˜¯å¾ˆä½çš„ï¼Œä¸¤ä¸ªæ•°ç»„é•¿åº¦å›ºå®šï¼Œæ¯”è¾ƒæ—¶é—´å¤æ‚åº¦O(1)ï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œä¸è¿‡å¥—æ¨¡æ¿å‡ ä¹æ˜¯é€šç”¨çš„\n```golang\nfunc findAnagrams(s string, p string) []int {\n    var left = 0\n    //-'a'çœ‹èµ·æ¥å¤ªä¸‘äº†ï¼Œç›´æ¥128\n    var target [128]int //æ³¨æ„ç”¨æ•°ç»„ï¼Œå¯ä»¥ç›´æ¥æ¯”è¾ƒ\n    var window [128]int\n    for _, sp := range p {\n        target[sp]++\n    }\n    var res []int\n    for right := 0; right < len(s); right++ {\n        if target[s[right]] > 0 {\n            window[s[right]]++\n        }\n        for right-left+1 > len(p) {\n            if window[s[left]] > 0 {\n                window[s[left]]--\n            }\n            left++\n        }\n        if window == target {\n            res = append(res, left)\n        }\n    }\n    return res\n}\n```\n\n## [567. å­—ç¬¦ä¸²çš„æ’åˆ—](https://leetcode-cn.com/problems/permutation-in-string/)\n\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² **s1** å’Œ **s2**ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ **s2** æ˜¯å¦åŒ…å« **s1** çš„æ’åˆ—ã€‚\n\næ¢å¥è¯è¯´ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ’åˆ—ä¹‹ä¸€æ˜¯ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„å­ä¸²ã€‚\n\n**ç¤ºä¾‹1:**\n\n```java\nè¾“å…¥: s1 = \"ab\" s2 = \"eidbaooo\"\nè¾“å‡º: True\nè§£é‡Š: s2 åŒ…å« s1 çš„æ’åˆ—ä¹‹ä¸€ (\"ba\").\n```\n\n**ç¤ºä¾‹2:**\n\n```java\nè¾“å…¥: s1= \"ab\" s2 = \"eidboaoo\"\nè¾“å‡º: False\n```\n\n**æ³¨æ„ï¼š**\n\n1. è¾“å…¥çš„å­—ç¬¦ä¸²åªåŒ…å«å°å†™å­—æ¯\n2. ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦éƒ½åœ¨ [1, 10,000] ä¹‹é—´\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®æ˜¯ [76.æœ€å°è¦†ç›–å­ä¸²](#76-æœ€å°è¦†ç›–å­ä¸²) çš„å¼±åŒ–ç‰ˆæœ¬ï¼Œå¥—è·¯æ»‘çª—ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„\n\n```java\npublic boolean checkInclusion(String s1, String s2) {\n    if(s1==null || s2==null || s1.length()>s2.length()){\n        return false;\n    }\n    int n1=s1.length();\n    int n2=s2.length();\n    int[] freq=new int[26];\n    int count=0;\n    for(int i=0;i<n1;i++){\n        int c=s1.charAt(i)-'a';\n        if(freq[c]==0){\n            count++;\n        }\n        freq[c]++;\n    }\n    int[] window=new int[26];\n    int match=0;\n    int left=0;\n    for(int right=0;right<n2;right++){\n        int cr=s2.charAt(right)-'a';\n        if(freq[cr]>0){\n            window[cr]++;\n            if(window[cr]==freq[cr]){\n                match++;\n            }\n        }\n        while(right-left+1>n1){\n            int cl=s2.charAt(left)-'a';\n            if(freq[cl]>0){\n                //WAç‚¹ï¼Œå¼€å§‹å†™é”™äº†\n                //window[cl]--;\n                if(window[cl]==freq[cl]){\n                    match--; //match--çš„å‰ææ˜¯åŸæœ¬æ˜¯åŒ¹é…çš„\n                }\n                window[cl]--;\n            }\n            left++;\n        } \n        if(match==count){\n            return true;\n        }\n    }\n    return false;\n}\n```\n\nä¸€å¼€å§‹å†™å®Œäº†ï¼Œæµ‹è¯•äº†ç”¨ä¾‹å‘ç°éƒ½æ˜¯å¯¹çš„ï¼Œå¿ƒé‡Œä¸€å–œï¼Œéš¾é“åˆbugfreeäº†ï¼Ÿæäº¤ï¼Œç»“æœè¿˜æ˜¯WAäº†ğŸ¤£ï¼Œdebugäº†åŠå¤©ï¼Œæ ¹æ®é”™è¯¯çš„å“ªä¸ªé•¿caseè‡ªå·±æ„é€ äº†ä¸€ä¸ªçŸ­caseï¼ˆé•¿çš„ä¸å¥½debugï¼‰ï¼Œç„¶åå‘ç°äº†é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘çœ‹è§è¯„è®ºåŒºä¹Ÿæœ‰äººé—®åˆ°ï¼Œé¡ºæ‰‹è¿˜å›äº†ä¸€ä¸‹ğŸ˜ï¼Œå…¶å®é”™è¯¯çš„åŸå› å°±æ˜¯å¥—æ¨¡æ¿æ²¡å¥—å¥½ï¼Œæ²¡ç†è§£æ¨¡æ¿çš„ç»†èŠ‚\n\nè¿™é‡Œçš„æ ¸å¿ƒé—®é¢˜å°±æ˜¯`match--`çš„æ—¶å€™æœ‰ä¸€ä¸ªå¤§å‰æï¼š`cl`å­—ç¬¦å·²ç»åŒ¹é…å¥½äº†ï¼Œä¹Ÿå°±æ˜¯`window[cl]==freq[cl]`\n\nè¿™ä¸ªæ—¶å€™ä½ `left++`å°†`cl`ç§»é™¤çª—å£ï¼Œæ‰èƒ½åš`match--`æ“ä½œï¼Œå¦åˆ™åƒä¹‹å‰çš„æ¨¡æ¿ä¸­\n\n```java\nif (target[left]!=0) {\n    window[left]--;\n    //ä¸æ»¡è¶³äº†\n    if (window[left]<target[left]) {\n        match--;\n    }\n}\n```\n\nè¿™æ ·å†™å°±æœ‰å¯èƒ½window[left]è¿˜æ²¡æœ‰åŒ¹é…ä¸Šï¼Œè¿™ä¸ªæ—¶å€™ç›´æ¥å‡å°±é”™äº†ï¼Œä¹‹å‰çš„æ¨¡æ¿ä¸­ç¼©åœˆéƒ½æ˜¯åœ¨match==countçš„å‰æä¸‹ç¼©åœˆçš„ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ï¼Œéƒ½æ˜¯åŒ¹é…çš„ï¼Œå…¶å®ä¹Ÿå¯ä»¥åƒä¹‹å‰çš„æ¨¡æ¿ä¸€æ ·å†™ï¼Œå°±åƒä¸‹é¢è¿™æ ·\n\n```java\npublic boolean checkInclusion(String s1, String s2) {\n    if(s1==null || s2==null || s1.length()>s2.length()){\n        return false;\n    }\n    int n1=s1.length();\n    int n2=s2.length();\n    int[] freq=new int[26];\n    int count=0;\n    for(int i=0;i<n1;i++){\n        int c=s1.charAt(i)-'a';\n        if(freq[c]==0){\n            count++;\n        }\n        freq[c]++;\n    }\n    int[] window=new int[26];\n    int match=0;\n    int left=0;\n    for(int right=0;right<n2;right++){\n        int cr=s2.charAt(right)-'a';\n        if(freq[cr]>0){\n            window[cr]++;\n            if(window[cr]==freq[cr]){\n                match++;\n            }\n        }\n        //****************************\n        //ä¸»è¦å°±æ˜¯è¿™é‡Œä¸ä¸€æ ·\n        while(match==count){\n            if(right-left+1==n1) return true;\n            int cl=s2.charAt(left)-'a';\n            if(freq[cl]>0){\n                window[cl]--;\n                if(window[cl]<freq[cl]){\n                    match--;\n                }\n            }\n            left++;\n        } \n        //****************************\n    }\n    return false;\n}\n```\nè¿™æ ·å°±ä¸ç”¨è€ƒè™‘å…ˆå‡è¿˜æ˜¯åå‡çš„é—®é¢˜äº†\n\n**è§£æ³•äºŒ**\n\nè¿™é¢˜å…¶å®è¿˜å¯ä»¥æš´åŠ›åšï¼Œçª—å£å¤§å°å›ºå®šï¼Œæ¯æ»‘åŠ¨ä¸€æ¬¡å°±åˆ¤æ–­çª—å£å’Œ`freq`æ˜¯ä¸æ˜¯ç›¸ç­‰ï¼Œå› ä¸ºé¢˜ç›®è¯´äº†éƒ½æ˜¯å°å†™å­—æ¯æ‰€ä»¥ä¹Ÿæ˜¯è¡Œå¾—é€šçš„ï¼Œåªæ˜¯å¸¸æ•°ä¼šå¤§ä¸€äº›ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†™äº†ï¼Œç¬”è¯•æ¨èè¿™æ ·å†™ï¼Œä»£ç å¥½å†™ä¸€ç‚¹\n\n## [é¢è¯•é¢˜ 17.18. æœ€çŸ­è¶…ä¸²](https://leetcode-cn.com/problems/shortest-supersequence-lcci/)\n\nå‡è®¾ä½ æœ‰ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªé•¿ä¸€ä¸ªçŸ­ï¼ŒçŸ­çš„å…ƒç´ å‡ä¸ç›¸åŒã€‚æ‰¾åˆ°é•¿æ•°ç»„ä¸­åŒ…å«çŸ­æ•°ç»„æ‰€æœ‰çš„å…ƒç´ çš„æœ€çŸ­å­æ•°ç»„ï¼Œå…¶å‡ºç°é¡ºåºæ— å…³ç´§è¦ã€‚\n\nè¿”å›æœ€çŸ­å­æ•°ç»„çš„å·¦ç«¯ç‚¹å’Œå³ç«¯ç‚¹ï¼Œå¦‚æœ‰å¤šä¸ªæ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ï¼Œè¿”å›å·¦ç«¯ç‚¹æœ€å°çš„ä¸€ä¸ªã€‚è‹¥ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºæ•°ç»„ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\nbig = [7,5,9,0,2,1,3,5,7,9,1,1,5,8,8,9,7]\nsmall = [1,5,9]\nè¾“å‡º: [7,10]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\nbig = [1,2,3]\nsmall = [4]\nè¾“å‡º: []\n```\n\n**æç¤ºï¼š**\n\n- `big.length <= 100000`\n- `1 <= small.length <= 100000`\n\n**è§£æ³•ä¸€**\n\nä¹Ÿæ˜¯å±äº [76.æœ€å°è¦†ç›–å­ä¸²](#76-æœ€å°è¦†ç›–å­ä¸²)çš„å¼±åŒ–ï¼Œè™½ç„¶è§£æ³•éƒ½ä¸€æ ·ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œæ³¨æ„ç»†èŠ‚\n\n```java\n//æ²¡å•¥å¥½è¯´çš„ï¼Œå¥—æ¨¡æ¿å°±è¡Œäº†\npublic int[] shortestSeq(int[] big, int[] small) {\n    if(big==null || big.length<=0) {\n        return new int[0];\n    }\n    int slen=small.length;\n    int blen=big.length;\n    int[] res=new int[2];\n    res[0]=-1;res[1]=-1;\n    int min=Integer.MAX_VALUE;\n    HashSet<Integer> set=new HashSet<>();\n    for(int i:small) set.add(i);\n    HashMap<Integer,Integer> window=new HashMap<>();\n    int match=0;\n    int left=0;\n    for(int right=0;right<blen;right++){\n        int wr=big[right];\n        if(set.contains(wr)){\n            window.put(wr,window.getOrDefault(wr,0)+1);\n            if(window.get(wr)==1){\n                match++;\n            }\n        }\n        while(match==slen){\n            if(right-left+1<min){\n                res[0]=left;\n                res[1]=right;\n                min=right-left+1;\n            }\n            int wl=big[left];\n            if(set.contains(wl)){\n                window.put(wl,window.get(wl)-1);\n                if(window.get(wl)==0){\n                    match--;\n                }\n            }\n            left++;\n        }\n    }\n    return res[0]==-1?new int[0]:res;\n}\n```\n\n## [1004. æœ€å¤§è¿ç»­1çš„ä¸ªæ•° III](https://leetcode-cn.com/problems/max-consecutive-ones-iii/)\n\nç»™å®šä¸€ä¸ªç”±è‹¥å¹² `0` å’Œ `1` ç»„æˆçš„æ•°ç»„ `A`ï¼Œæˆ‘ä»¬æœ€å¤šå¯ä»¥å°† `K` ä¸ªå€¼ä» 0 å˜æˆ 1 ã€‚\n\nè¿”å›ä»…åŒ…å« 1 çš„æœ€é•¿ï¼ˆè¿ç»­ï¼‰å­æ•°ç»„çš„é•¿åº¦ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šA = [1,1,1,0,0,0,1,1,1,1,0], K = 2\nè¾“å‡ºï¼š6\nè§£é‡Šï¼š \n[1,1,1,0,0,1,1,1,1,1,1]\nç²—ä½“æ•°å­—ä» 0 ç¿»è½¬åˆ° 1ï¼Œæœ€é•¿çš„å­æ•°ç»„é•¿åº¦ä¸º 6ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šA = [0,0,1,1,0,0,1,1,1,0,1,1,0,0,0,1,1,1,1], K = 3\nè¾“å‡ºï¼š10\nè§£é‡Šï¼š\n[0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1]\nç²—ä½“æ•°å­—ä» 0 ç¿»è½¬åˆ° 1ï¼Œæœ€é•¿çš„å­æ•°ç»„é•¿åº¦ä¸º 10ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `1 <= A.length <= 20000`\n2. `0 <= K <= A.length`\n3. `A[i]` ä¸º `0` æˆ– `1` \n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å…¶å®ä¸‹é¢ä¸€é¢˜[424. æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦](#424-æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦)çš„å¼±åŒ–ç‰ˆæœ¬\n\n```java\n//ç®€å•çš„æ»‘çª—\npublic int longestOnes(int[] A, int K) {\n    if(A==null || A.length<=0) return 0;\n    int N=A.length;\n    int left=0,res=0,countA=0;\n    for(int right=0;right<N;right++){\n        countA+=(A[right]&1);\n        //ifä¹Ÿå¯ä»¥ï¼Œä¸ªäººå–œæ¬¢whileé€šç”¨æ€§æ›´å¼º\n        while(right-left+1-countA>K){ \n            countA-=(A[left++]&1);\n        }\n        res=Math.max(res,right-left+1);\n    }\n    return res;\n}\n```\næŒ‰ç…§æ¨¡æ¿æ¥å†™ç®€ç›´æ˜¯ä¿¡æ‰‹æ‹ˆæ¥ï¼ˆå…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ¨¡æ¿ï¼Œå°±æ˜¯è§„èŒƒäº†å†™æ³•è€Œå·²ï¼‰\n\n## [5434. åˆ æ‰ä¸€ä¸ªå…ƒç´ ä»¥åå…¨ä¸º 1 çš„æœ€é•¿å­æ•°ç»„](https://leetcode-cn.com/problems/longest-subarray-of-1s-after-deleting-one-element/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„Â `nums`Â ï¼Œä½ éœ€è¦ä»ä¸­åˆ æ‰ä¸€ä¸ªå…ƒç´ ã€‚\n\nè¯·ä½ åœ¨åˆ æ‰å…ƒç´ çš„ç»“æœæ•°ç»„ä¸­ï¼Œè¿”å›æœ€é•¿çš„ä¸”åªåŒ…å« 1 çš„éç©ºå­æ•°ç»„çš„é•¿åº¦ã€‚\n\nå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å­æ•°ç»„ï¼Œè¯·è¿”å› 0 ã€‚\n\n**æç¤º 1ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [1,1,0,1]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šåˆ æ‰ä½ç½® 2 çš„æ•°åï¼Œ[1,1,1] åŒ…å« 3 ä¸ª 1 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [0,1,1,1,0,1,1,0,1]\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šåˆ æ‰ä½ç½® 4 çš„æ•°å­—åï¼Œ[0,1,1,1,1,1,0,1] çš„æœ€é•¿å…¨ 1 å­æ•°ç»„ä¸º [1,1,1,1,1] ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```\nè¾“å…¥ï¼šnums = [1,1,1]\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šä½ å¿…é¡»è¦åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [1,1,0,0,1,1,1,0,1]\nè¾“å‡ºï¼š4\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šnums = [0,0,0]\nè¾“å‡ºï¼š0\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= nums.length <= 10^5`\n*   `nums[i]`Â è¦ä¹ˆæ˜¯Â `0`Â è¦ä¹ˆæ˜¯Â `1` ã€‚\n\n**è§£æ³•ä¸€**\n\n29thåŒå‘¨èµ›çš„t3ï¼Œç§’åˆ‡ï¼Œå…¶å®æ˜¯ä¸Šä¸€é¢˜[1004. æœ€å¤§è¿ç»­1çš„ä¸ªæ•° III](#1004-æœ€å¤§è¿ç»­1çš„ä¸ªæ•°-iii)çš„å¼±åŒ–\n```java\nÂ  Â public int longestSubarray(int[] nums) {\nÂ  Â  Â  Â int res=0, sum=0;\nÂ  Â  Â  Â int left=0;\nÂ  Â  Â  Â for(int right=0;right<nums.length;right++){\nÂ  Â  Â  Â  Â  Â sum+=(nums[right]&1);\nÂ  Â  Â  Â  Â  Â //åŒºé—´å’Œå°äºright-left-1è¯´æ˜ä¸­é—´ä¸æ­¢ä¸€ä¸ª0éœ€è¦ç¼©å‡çª—å£\nÂ  Â  Â  Â  Â  Â while(left<right && sum<= right-left-1){\nÂ  Â  Â  Â  Â  Â  Â  Â if(nums[left] == 1){\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â sum--;\nÂ  Â  Â  Â  Â  Â  Â   }\nÂ  Â  Â  Â  Â  Â  Â  Â left++;\nÂ  Â  Â  Â  Â   }\nÂ  Â  Â  Â  Â  Â //è‡³å°‘åˆ é™¤ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸ç”¨+1\nÂ  Â  Â  Â  Â  Â res = Math.max(res,right-left);\nÂ  Â  Â   }\nÂ  Â  Â  Â return res;\nÂ   }\n```\nå¾ˆå¯æƒœè¿™æ¬¡å‰3é¢˜15åˆ†é’Ÿå°±åšå®Œäº†ï¼Œéƒ½æ˜¯ç›´æ¥webä¸Šå†™çš„ï¼Œæœ¬ä»¥ä¸ºæœ‰æœºä¼šAKï¼Œæœ€åä¸€é¢˜æäº†åŠå¤©æœ€åäº¤äº†ä¸€å‘è¿˜æ˜¯æ²¡è¿‡ï¼Œè²Œä¼¼å¾ˆå¤šäººå†™äº†å‡ç®—æ³•ï¼Œè´ªå¿ƒè½è¿‡äº†ï¼ˆlcæ•°æ®å¤ªå¼±äº†ï¼‰\n![UTOOLS1593333299362.png](https://upload.cc/i1/2020/06/28/mhTiQ9.png)\n\n## [424. æ›¿æ¢åçš„æœ€é•¿é‡å¤å­—ç¬¦](https://leetcode-cn.com/problems/longest-repeating-character-replacement/)\n\nç»™ä½ ä¸€ä¸ªä»…ç”±å¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥å°†ä»»æ„ä½ç½®ä¸Šçš„å­—ç¬¦æ›¿æ¢æˆå¦å¤–çš„å­—ç¬¦ï¼Œæ€»å…±å¯æœ€å¤šæ›¿æ¢ k æ¬¡ã€‚åœ¨æ‰§è¡Œä¸Šè¿°æ“ä½œåï¼Œæ‰¾åˆ°åŒ…å«é‡å¤å­—æ¯çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚\n\n**æ³¨æ„:**\nå­—ç¬¦ä¸²é•¿åº¦ å’Œ k ä¸ä¼šè¶…è¿‡ 104ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\ns = \"ABAB\", k = 2\nè¾“å‡º:\n4\nè§£é‡Š:\nç”¨ä¸¤ä¸ª'A'æ›¿æ¢ä¸ºä¸¤ä¸ª'B',åä¹‹äº¦ç„¶ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\ns = \"AABABBA\", k = 1\nè¾“å‡º:\n4\nè§£é‡Š:\nå°†ä¸­é—´çš„ä¸€ä¸ª'A'æ›¿æ¢ä¸º'B',å­—ç¬¦ä¸²å˜ä¸º \"AABBBBA\"\nå­ä¸² \"BBBB\" æœ‰æœ€é•¿é‡å¤å­—æ¯, ç­”æ¡ˆä¸º 4\n```\n\n**è§£æ³•ä¸€**\n\nä¸Šé¢ä¸€é¢˜çš„åŠ å¼ºç‰ˆ\n\n```java\npublic int characterReplacement(String s, int k) {\n    int max = 0, start = 0, end = 0, cur = -1;\n    int[] count = new int[256];\n    while (end < s.length()) {\n        //å½“å‰çª—å£å‡ºç°æœ€å¤šçš„å­—ç¬¦\n        cur = Math.max(cur, ++count[s.charAt(end)]);\n        //ä¸èƒ½æ›¿æ¢äº†,ä¸åŒå­—ç¬¦å¤ªå¤šäº†,éœ€è¦ç¼©å‡çª—å£\n        while (end - start + 1 - cur > k){\n            //ç¼©å‡å·¦è¾¹ç•Œçš„count\n            count[s.charAt(start)]--;\n            start++;//ä¸èƒ½æ›¿æ¢äº†ï¼Œstart++\n        }\n        //ç»Ÿè®¡æœ€å¤§å€¼\n        max = Math.max(max, end - start + 1);\n        end++;\n    }\n    return max;\n}\n```\n\n**UPDATE: (2020.5.5)**\n\næŒ‰ç…§æ¨¡æ¿é‡å†™ï¼Œæœç„¶æ»‘çª—çš„é¢˜éƒ½æ˜¯ä¸€æ ·çš„\n\n```java\npublic int characterReplacement(String s, int k) {\n    if(s==null || s.length()<=0){\n        return 0;\n    }\n    int n=s.length();\n    int res=1;\n    int left=0;\n    int[] freq=new int[128];\n    int maxFreq=0;\n    for(int right=0;right<n;right++){\n        char c=s.charAt(right);\n        freq[c]++;\n        maxFreq=Math.max(maxFreq,freq[c]);\n        while((right-left+1-maxFreq)>k){\n            freq[s.charAt(left)]--;\n            left++; //è¿™é‡Œå®é™…ä¸Šåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ”¹æˆifä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡ä¸ºäº†ç»Ÿä¸€å†™æ³•å°±ä¸æ”¹äº†\n        }\n        res=Math.max(res,right-left+1);\n    }\n    return res;\n}\n```\n\né‡å†™è¿™é¢˜çš„æ—¶å€™å‘ç°è¿™é¢˜è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè¿™ä¸ªé‡Œé¢çš„`maxFreq`æ˜¯ä¸€ä¸ªåªå¢ä¸å‡çš„é‡ï¼Œæ˜¯ä¸€ä¸ªå†å²æœ€å¤§å€¼ï¼Œåªæœ‰å½“å‡ºç°æ›´å¤§çš„freqçš„æ—¶å€™æ‰ä¼šæ›´æ–°`maxFreq`ï¼Œå½“`maxFreq`ä¿æŒä¸å˜çš„æ—¶å€™ç»“æœä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰å‡ºç°äº†æ›´å¤§freqçš„æ—¶å€™æ‰æœ‰å¯èƒ½ä¼šä½¿ç»“æœå˜å¤§\n\n> [æ‹·è´è‡ªé¢˜è§£åŒº](https://leetcode-cn.com/problems/longest-repeating-character-replacement/solution/hua-dong-chuang-kou-chang-gui-tao-lu-by-xiaoneng/) \n>\n> å› ä¸ºæˆ‘ä»¬åªå¯¹æœ€é•¿æœ‰æ•ˆçš„å­å­—ç¬¦ä¸²æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ»‘åŠ¨çª—å£ä¸éœ€è¦æ”¶ç¼©ï¼Œå³ä½¿çª—å£å¯èƒ½è¦†ç›–æ— æ•ˆçš„å­å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å³è¾¹æ·»åŠ ä¸€ä¸ªå­—ç¬¦æ¥æ‰©å±•çª—å£ï¼Œæˆ–è€…å°†æ•´ä¸ªçª—å£å‘å³è¾¹ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ã€‚è€Œä¸”æˆ‘ä»¬åªåœ¨æ–°å­—ç¬¦çš„è®¡æ•°è¶…è¿‡å†å²æœ€å¤§è®¡æ•°(æ¥è‡ªè¦†ç›–æœ‰æ•ˆå­å­—ç¬¦ä¸²çš„å‰ä¸€ä¸ªçª—å£)æ—¶æ‰å¢é•¿çª—å£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç²¾ç¡®çš„å½“å‰çª—å£çš„æœ€å¤§è®¡æ•°;æˆ‘ä»¬åªå…³å¿ƒæœ€å¤§è®¡æ•°æ˜¯å¦è¶…è¿‡å†å²æœ€å¤§è®¡æ•°;è¿™åªä¼šå› ä¸ºæ–°å­—ç¬¦è€Œå‘ç”Ÿã€‚\n\n**è§£æ³•äºŒ**\n\næ†¨æ†¨çš„è§£æ³•ï¼Œä¸è¿‡ç»å¯¹æ˜¯èƒ½ACçš„ï¼Œæ—¶é—´å¤æ‚åº¦å¹¶æ²¡æœ‰é—®é¢˜ï¼Œä¾ç„¶æ˜¯`O(N)`\n\n```java\npublic int characterReplacement(String s, int k) {\n    if(s==null || s.length()<=0){\n        return 0;\n    }\n    int n=s.length();\n    int res=1;\n    for(int c='A';c<='Z';c++){\n        int[] freq=new int[128];\n        int temp=1;\n        int left=0;\n        for(int right=0;right<n;right++){\n            if(s.charAt(right)==c){\n                freq[c]++;\n            }\n            while((right-left+1-freq[c])>k){\n                if(s.charAt(left)==c){\n                    freq[c]--;\n                }\n                left++;\n            }\n            temp=Math.max(temp,right-left+1);\n        }\n        res=Math.max(res,temp);\n    }\n    return res;\n}\n```\næ—¢ç„¶é¢˜ç›®è¯´äº†åªæœ‰å¤§å†™å­—æ¯ï¼Œé‚£å°±ç›´æ¥æšä¸¾æ‰€æœ‰çš„å­—ç¬¦ç„¶åæ»‘çª—å°±è¡Œäº†ğŸ˜‚ï¼Œç®€å•ç›´ç™½\n\n## [1234. æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/replace-the-substring-for-balanced-string/)\n\næœ‰ä¸€ä¸ªåªå«æœ‰ `'Q', 'W', 'E', 'R'` å››ç§å­—ç¬¦ï¼Œä¸”é•¿åº¦ä¸º n çš„å­—ç¬¦ä¸²ã€‚\n\nå‡å¦‚åœ¨è¯¥å­—ç¬¦ä¸²ä¸­ï¼Œè¿™å››ä¸ªå­—ç¬¦éƒ½æ°å¥½å‡ºç° `n/4` æ¬¡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚\n\nç»™ä½ ä¸€ä¸ªè¿™æ ·çš„å­—ç¬¦ä¸² `s`ï¼Œè¯·é€šè¿‡ã€Œæ›¿æ¢å­ä¸²ã€çš„æ–¹å¼ï¼Œä½¿åŸå­—ç¬¦ä¸² s å˜æˆä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚\n\nä½ å¯ä»¥ç”¨å’Œã€Œå¾…æ›¿æ¢å­ä¸²ã€é•¿åº¦ç›¸åŒçš„ ä»»ä½• å…¶ä»–å­—ç¬¦ä¸²æ¥å®Œæˆæ›¿æ¢ã€‚\n\nè¯·è¿”å›å¾…æ›¿æ¢å­ä¸²çš„æœ€å°å¯èƒ½é•¿åº¦ã€‚\n\nå¦‚æœåŸå­—ç¬¦ä¸²è‡ªèº«å°±æ˜¯ä¸€ä¸ªå¹³è¡¡å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› 0 \n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"QWER\"\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šs å·²ç»æ˜¯å¹³è¡¡çš„äº†ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"QQWE\"\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šæˆ‘ä»¬éœ€è¦æŠŠä¸€ä¸ª 'Q' æ›¿æ¢æˆ 'R'ï¼Œè¿™æ ·å¾—åˆ°çš„ \"RQWE\" (æˆ– \"QRWE\") æ˜¯å¹³è¡¡çš„ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"QQQW\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æŠŠå‰é¢çš„ \"QQ\" æ›¿æ¢æˆ \"ER\"ã€‚ \n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"QQQQ\"\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æ›¿æ¢å 3 ä¸ª 'Q'ï¼Œä½¿ s = \"QWER\"ã€‚\n```\n\n**æç¤ºï¼š**\n\n- 1 <= s.length <= 10^5\n- s.length æ˜¯ 4 çš„å€æ•°\n- s ä¸­åªå«æœ‰ 'Q', 'W', 'E', 'R' å››ç§å­—ç¬¦\n\n**è§£æ³•ä¸€**\n\nå‘¨èµ›é¢˜ï¼Œè¯´å®è¯ä¸å¤šåšåšç«èµ›çœŸä¸çŸ¥é“è‡ªå·±å¤šèœ\n\n(update: 2020.4.15)\n\næˆ‘æ‹¿åˆ°è¿™é¢˜ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯æ— è„‘å¥—è·¯æ»‘çª—ï¼Œæ—¢ç„¶è¦ä¿è¯å¹³è¡¡ï¼Œé‚£ä¹ˆæ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°éƒ½åº”è¯¥æ˜¯`N/4`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»Ÿè®¡ä¸‹å¤šå‡ºæ¥çš„æœ‰å‡ ä¸ªï¼Œæ¯”å¦‚`QQQW`ï¼Œé‚£ä¹ˆå¤šå‡ºæ¥çš„å°±æ˜¯2ä¸ª**`Q`**ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦æ±‚çš„çª—å£å†…**è‡³å°‘**æœ‰2ä¸ªQï¼Œè¿™æ ·é—®é¢˜å…¶å®å°±è½¬æ¢æˆäº† [76. æœ€å°è¦†ç›–å­ä¸²](#76-æœ€å°è¦†ç›–å­ä¸²)ï¼ˆè¿™æ˜æ˜æ˜¯ä¸ªmidé¢˜ï¼Œä½ å’‹è¿˜ç»™è½¬æ¢æˆhardäº†ï¼Œä½ æ˜¯ä¸æ˜¯å‚»ğŸ¤£ï¼‰\n\nå…¶å®æœ€å°è¦†ç›–å­ä¸²çœ‹èµ·æ¥å¥½åƒæŒºéš¾ï¼Œä½†æ˜¯æ˜¯æœ‰å¥—è·¯çš„ï¼Œæˆ‘ä»¬ç›´æ¥å¥—æ¨¡æ¿å°±å¯ä»¥äº†\n\n```java\npublic int balancedString(String s) {\n    if(s==null || s.length()<=0) return -1;\n    int N=s.length();\n    //è¿™é‡Œç”¨26æœ‰çš„æµªè´¹,ä¸ºäº†æ–¹ä¾¿å†™ä»£ç ,å°±è¿™æ ·å§\n    int[] need=new int[26];\n    //åˆå§‹åŒ–ä¸º-N/4è¿™æ ·æœ€åå¾—åˆ°çš„å¤§äº0çš„å€¼å°±æ˜¯å¤šå‡ºæ¥çš„\n    Arrays.fill(need,-N/4);\n    int[] cur=new int[26];\n    for(int i=0;i<N;i++){\n        need[s.charAt(i)-'A']++;\n    }\n    //æœ‰å‡ ä¸ªå­—ç¬¦å¤šå‡ºæ¥äº†\n    int needCount=0; \n    for(int i=0;i<need.length;i++){\n        if(need[i]>0) needCount++;\n    } \n    if(needCount==0) return 0;\n    int res=N;\n    int left=0,right=0;\n    int matchCount=0;\n    //æ— è„‘å¥—è·¯æ»‘çª—\n    while(right<s.length()){\n        char c=s.charAt(right);\n        if(need[c-'A']>0){\n            cur[c-'A']++;\n            if(cur[c-'A']==need[c-'A']){\n                matchCount++;\n            }\n        }\n        while(left<=right && matchCount==needCount){\n            res=Math.min(right-left+1,res);\n            char cl=s.charAt(left);\n            if(need[cl-'A']>0){\n                cur[cl-'A']--;\n                if(cur[cl-'A']<need[cl-'A']){\n                    matchCount--;\n                }\n            }\n            left++;\n        }\n        right++;\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\nä¸Šé¢çš„è§£æ³•æ˜¯è€ƒè™‘`çª—å£å†…`çš„å…ƒç´ ç»„æˆï¼Œçª—å£å†…è‡³å°‘åº”è¯¥æœ‰å“ªäº›å…ƒç´ ï¼Œåè¿‡æ¥æƒ³ï¼Œæˆ‘ä»¬çª—å£å†…çš„å…ƒç´ æ˜¯å¤šå‡ºæ¥çš„å…ƒç´ ï¼Œæˆ‘ä»¬æ˜¯æŠŠå¤šçš„å…ƒç´ æ”¾åˆ°çª—å£ä¸­ï¼Œé‚£ä¹ˆçª—å£å¤–çš„å…ƒç´ å°±è‚¯å®šéƒ½æ˜¯`å°äºç­‰äºN/4`çš„äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œæ»‘çª—ï¼Œç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„çª—å£çš„æœ€å°å€¼ï¼Œè¿™æ ·ä»£ç å°±ä¼šç®€æ´å¾ˆå¤š\n\n```java\n//codeåˆ æ‰äº†ï¼Œä¹‹å‰çš„ä»£ç æœ‰ç‚¹é—®é¢˜ï¼Œæœ€åçš„è¿”å›å€¼æœ‰äº›æƒ…å†µè¿‡ä¸å»ï¼Œlcçš„caseå¤ªå¼±äº†ï¼Œè®©æˆ‘è¿‡äº†\n```\n\n**UPDATE: (2020.5.4)**\n\næŒ‰ç…§å…ˆå‰çš„æ¨¡æ¿æ¥åˆ†æä¸‹ï¼Œè¿™é‡Œè¦æ±‚çš„æ˜¯æœ€å°çš„ä¿®æ”¹æ¬¡æ•°ï¼Œå¾ˆæ˜æ˜¾ä¸èƒ½ç”¨`for-if`ï¼Œæ‰€ä»¥é‡‡ç”¨`for-while`çš„ç»“æ„ï¼Œ`for-while`æœ€åŸºæœ¬çš„ç»“æ„å°±æ˜¯å¤–å±‚æšä¸¾æ‰€æœ‰`right`ï¼Œå†…å±‚æ ¹æ®é¢˜ç›®è¦æ±‚ç¼©å‡`left`ï¼Œä½†æ˜¯è¿™é¢˜leftä¹Ÿéœ€è¦æ§åˆ¶è¾¹ç•Œï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯`left<=right` ä½†æ˜¯å®é™…ä¸Šè¿™æ ·ä¼šæœ‰ä¸€ç±»caseç»“æœä¸å¯¹ï¼Œæ¯”å¦‚\"QWER\"è¿™æ ·çš„ï¼Œè¿”å›çš„ç»“æœæ˜¯1ï¼Œ~~æˆ‘ä¸Šé¢åœ¨æœ€ååšäº†ç‰¹åˆ¤~~ï¼ˆä¸Šé¢çš„ç‰¹åˆ¤æ˜¯é”™çš„ï¼Œæ¯”å¦‚â€œQWEEâ€è¿™æ ·çš„å°±è¿”å›0ï¼‰ï¼Œå…¶å®è¿™é‡Œè¿˜å¯ä»¥ä¿®æ”¹ä¸‹è¾¹ç•Œï¼Œæ”¹æˆ`left<N`ï¼Œè¿™æ ·å°±æ²¡é—®é¢˜äº†ï¼Œè¿™æ ·leftå°±å¯ä»¥è¶…è¿‡rightè¾¾åˆ°right+1ï¼Œè¿™æ ·å¯¹â€QWER\"å°±èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œå¹¶ä¸”æ ¹æ®é¢˜ç›®ä¿¡æ¯å½“`left=right+1`ä¹‹å`left`å°±ä¸ä¼šå†å¢åŠ äº†ï¼Œwhileæ¡ä»¶å°±æ— æ³•æ»¡è¶³äº†ï¼Œä½†æ˜¯æœ‰çš„é¢˜ç›®`left`æ˜¯ä¸ç”¨è®¾ç½®é™åˆ¶çš„ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨è¾¾åˆ°right+1ä¹‹åå°±ä¸ä¼šç»§ç»­å¢åŠ äº†\n\n```java\nclass Solution {\n    public int balancedString(String s) {\n        if(s==null || s.length()<=0){\n            return 0;\n        }\n        int N=s.length();\n        int left=0;\n        int res=N;\n        int[] freq=new int[26];\n        for(int i=0;i<N;i++) {\n            freq[s.charAt(i)-'A']++;\n        }\n        for(int right=0;right<N;right++){\n            freq[s.charAt(right)-'A']--;\n            while(left<N && freq['Q'-'A']<=N/4 && freq['W'-'A']<=N/4 && freq['E'-'A']<=N/4 && freq['R'-'A']<=N/4){\n                res=Math.min(res,right-left+1);\n                freq[s.charAt(left++)-'A']++;\n            }\n        }\n        return res;\n    }\n}\n```\n\n## [1358. åŒ…å«æ‰€æœ‰ä¸‰ç§å­—ç¬¦çš„å­å­—ç¬¦ä¸²æ•°ç›®](https://leetcode-cn.com/problems/number-of-substrings-containing-all-three-characters/)  \n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œå®ƒåªåŒ…å«ä¸‰ç§å­—ç¬¦ a, b å’Œ c ã€‚\n\nè¯·ä½ è¿”å› aï¼Œb å’Œ c éƒ½ **è‡³å°‘** å‡ºç°è¿‡ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²æ•°ç›®ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"abcabc\"\nè¾“å‡ºï¼š10\nè§£é‡Šï¼šåŒ…å« aï¼Œb å’Œ c å„è‡³å°‘ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²ä¸º \"abc\", \"abca\", \"abcab\", \"abcabc\", \"bca\", \"bcab\", \"bcabc\", \"cab\", \"cabc\" å’Œ \"abc\" (ç›¸åŒå­—ç¬¦ä¸²ç®—å¤šæ¬¡)ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"aaacb\"\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šåŒ…å« aï¼Œb å’Œ c å„è‡³å°‘ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²ä¸º \"aaacb\", \"aacb\" å’Œ \"acb\" ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"abc\"\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n- 3 <= s.length <= 5 x 10^4\n- s åªåŒ…å«å­—ç¬¦ aï¼Œb å’Œ c ã€‚\n\n**è§£æ³•ä¸€**\n\n20åŒå‘¨èµ›T3\n\n```java\npublic int numberOfSubstrings(String s) {\n    int[] freq=new int[3];\n    int left=0,right=-1,slen=s.length();\n    int res=0;\n    //abc\n    while(left<slen-2){\n        while(right+1<slen && !valid(freq)){\n            freq[s.charAt(++right)-'a']++;\n        }\n        res+=valid(freq)?(slen-right):0;\n        freq[s.charAt(left)-'a']--;\n        left++;\n    }\n    return res;\n}\n\npublic boolean valid(int[] freq){\n    return freq[0]!=0 && freq[1]!=0 && freq[2]!=0;\n}\n```\næšä¸¾æ‰€æœ‰çš„å·¦è¾¹ç•Œï¼Œç„¶åæ‰¾åˆ°æœ€çŸ­çš„å¯ä»¥æ»¡è¶³çš„å³è¾¹ç•Œï¼Œé‚£ä¹ˆåŒ…æ‹¬å³è¾¹ç•Œå’Œä¹‹åçš„æ‰€æœ‰çš„éƒ½æ»¡è¶³æ¡ä»¶ï¼Œç›´æ¥è®¡ç®—å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(N)`\n\n**è§£æ³•äºŒ**\n\n2020.5.4 ç”¨è‡ªå·±æ€»ç»“çš„æ»‘çª—æ¨¡æ¿é‡å†™ï¼Œä¹Ÿæ˜¯`for-while`ç»“æ„ï¼Œrightå’Œleftä¸èƒ½åŒæ—¶æ‰©å±•ã€‚æ¯”å¦‚`\"aaacb\"`è¿™æ ·çš„case\n\n```java\npublic int numberOfSubstrings(String s) {\n    int left=0;\n    int res=0;\n    int n=s.length();\n    int[] freq=new int[3];\n    for(int right=0;right<n;right++){\n        freq[s.charAt(right)-'a']++;\n        while(freq[0]>0 && freq[1]>0 && freq[2]>0){\n            res+=n-right; //åé¢çš„éƒ½ç¬¦åˆæ¡ä»¶\n            freq[s.charAt(left)-'a']--;\n            left++;\n        }\n    }\n    return res;\n}\n```\n## [1423. å¯è·å¾—çš„æœ€å¤§ç‚¹æ•°](https://leetcode-cn.com/problems/maximum-points-you-can-obtain-from-cards/)\n\nå‡ å¼ å¡ç‰Œ **æ’æˆä¸€è¡Œ**ï¼Œæ¯å¼ å¡ç‰Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç‚¹æ•°ã€‚ç‚¹æ•°ç”±æ•´æ•°æ•°ç»„ `cardPoints` ç»™å‡ºã€‚\n\næ¯æ¬¡è¡ŒåŠ¨ï¼Œä½ å¯ä»¥ä»è¡Œçš„å¼€å¤´æˆ–è€…æœ«å°¾æ‹¿ä¸€å¼ å¡ç‰Œï¼Œæœ€ç»ˆä½ å¿…é¡»æ­£å¥½æ‹¿ `k` å¼ å¡ç‰Œã€‚\n\nä½ çš„ç‚¹æ•°å°±æ˜¯ä½ æ‹¿åˆ°æ‰‹ä¸­çš„æ‰€æœ‰å¡ç‰Œçš„ç‚¹æ•°ä¹‹å’Œã€‚\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `cardPoints` å’Œæ•´æ•° `k`ï¼Œè¯·ä½ è¿”å›å¯ä»¥è·å¾—çš„æœ€å¤§ç‚¹æ•°ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šcardPoints = [1,2,3,4,5,6,1], k = 3\nè¾“å‡ºï¼š12\nè§£é‡Šï¼šç¬¬ä¸€æ¬¡è¡ŒåŠ¨ï¼Œä¸ç®¡æ‹¿å“ªå¼ ç‰Œï¼Œä½ çš„ç‚¹æ•°æ€»æ˜¯ 1 ã€‚ä½†æ˜¯ï¼Œå…ˆæ‹¿æœ€å³è¾¹çš„å¡ç‰Œå°†ä¼šæœ€å¤§åŒ–ä½ çš„å¯è·å¾—ç‚¹æ•°ã€‚æœ€ä¼˜ç­–ç•¥æ˜¯æ‹¿å³è¾¹çš„ä¸‰å¼ ç‰Œï¼Œæœ€ç»ˆç‚¹æ•°ä¸º 1 + 6 + 5 = 12 ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šcardPoints = [2,2,2], k = 2\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šæ— è®ºä½ æ‹¿èµ·å“ªä¸¤å¼ å¡ç‰Œï¼Œå¯è·å¾—çš„ç‚¹æ•°æ€»æ˜¯ 4 ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šcardPoints = [9,7,7,9,7,7,9], k = 7\nè¾“å‡ºï¼š55\nè§£é‡Šï¼šä½ å¿…é¡»æ‹¿èµ·æ‰€æœ‰å¡ç‰Œï¼Œå¯ä»¥è·å¾—çš„ç‚¹æ•°ä¸ºæ‰€æœ‰å¡ç‰Œçš„ç‚¹æ•°ä¹‹å’Œã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šcardPoints = [1,1000,1], k = 1\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šä½ æ— æ³•æ‹¿åˆ°ä¸­é—´é‚£å¼ å¡ç‰Œï¼Œæ‰€ä»¥å¯ä»¥è·å¾—çš„æœ€å¤§ç‚¹æ•°ä¸º 1 ã€‚ \n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šcardPoints = [1,79,80,1,1,1,200,1], k = 3\nè¾“å‡ºï¼š202\n```\n\n**æç¤ºï¼š**\n\n- `1 <= cardPoints.length <= 10^5`\n- `1 <= cardPoints[i] <= 10^4`\n- `1 <= k <= cardPoints.length`\n\n**è§£æ³•ä¸€**\n\n186å‘¨èµ›T2ï¼Œå¾ˆæ˜æ˜¾çš„æ»‘åŠ¨çª—å£ï¼Œå‰åæ‹¿Kå¼ æœ€å¤§ï¼Œåªéœ€è¦æ±‚ä¸€ä¸ªæœ€å°çš„`[n-k]`åŒºé—´å€¼å°±è¡Œäº†ï¼Œä¹Ÿå¯ä»¥ç”¨å‰ç¼€å’Œï¼Œæ€è·¯éƒ½ä¸€æ ·\n\n```go\nfunc maxScore(cardPoints []int, k int) int {\n    if cardPoints == nil || len(cardPoints) == 0 {\n        return 0\n    }\n    n := len(cardPoints)\n    left := 0\n    right := n - k - 1\n    sum := 0\n    windowSum := 0\n    for i, num := range cardPoints {\n        sum += num\n        if i == right {\n            windowSum = sum\n        }\n    }\n    if k == n {\n        return sum\n    }\n    minWin := windowSum\n    for right+1 < n {\n        windowSum += (cardPoints[right+1] - cardPoints[left])\n        minWin = min(windowSum, minWin)\n        right++\n        left++\n    }\n    return sum - minWin\n}\n\nfunc min(a, b int) int {\n    if a < b {\n        return a\n    }\n    return b\n}\n\n```\n\nTagé‡Œé¢æœ‰dpï¼Œç¡®å®è¿™é¢˜å’Œå‰é¢çš„[çŸ³å­æ¸¸æˆ](http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/#877-%E7%9F%B3%E5%AD%90%E6%B8%B8%E6%88%8F)æœ‰ä¸€ç‚¹åƒï¼Œä½†æ˜¯è¿˜æ˜¯æ»‘çª—æ¥çš„æ¯”è¾ƒç›´æ¥ã€‚ã€‚\n\n## [1208. å°½å¯èƒ½ä½¿å­—ç¬¦ä¸²ç›¸ç­‰](https://leetcode-cn.com/problems/get-equal-substrings-within-budget/)\n\nç»™ä½ ä¸¤ä¸ªé•¿åº¦ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œ`s` å’Œ `t`ã€‚\n\nå°† `s` ä¸­çš„ç¬¬ `i` ä¸ªå­—ç¬¦å˜åˆ° `t` ä¸­çš„ç¬¬ `i` ä¸ªå­—ç¬¦éœ€è¦ `|s[i] - t[i]|` çš„å¼€é”€ï¼ˆå¼€é”€å¯èƒ½ä¸º 0ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—ç¬¦çš„ ASCII ç å€¼çš„å·®çš„ç»å¯¹å€¼ã€‚\n\nç”¨äºå˜æ›´å­—ç¬¦ä¸²çš„æœ€å¤§é¢„ç®—æ˜¯ `maxCost`ã€‚åœ¨è½¬åŒ–å­—ç¬¦ä¸²æ—¶ï¼Œæ€»å¼€é”€åº”å½“å°äºç­‰äºè¯¥é¢„ç®—ï¼Œè¿™ä¹Ÿæ„å‘³ç€å­—ç¬¦ä¸²çš„è½¬åŒ–å¯èƒ½æ˜¯ä¸å®Œå…¨çš„ã€‚\n\nå¦‚æœä½ å¯ä»¥å°† `s` çš„å­å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå®ƒåœ¨ `t` ä¸­å¯¹åº”çš„å­å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›å¯ä»¥è½¬åŒ–çš„æœ€å¤§é•¿åº¦ã€‚\n\nå¦‚æœ `s` ä¸­æ²¡æœ‰å­å­—ç¬¦ä¸²å¯ä»¥è½¬åŒ–æˆ `t` ä¸­å¯¹åº”çš„å­å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› `0`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"abcd\", t = \"bcdf\", cost = 3\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šs ä¸­çš„ \"abc\" å¯ä»¥å˜ä¸º \"bcd\"ã€‚å¼€é”€ä¸º 3ï¼Œæ‰€ä»¥æœ€å¤§é•¿åº¦ä¸º 3ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"abcd\", t = \"cdef\", cost = 3\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šs ä¸­çš„ä»»ä¸€å­—ç¬¦è¦æƒ³å˜æˆ t ä¸­å¯¹åº”çš„å­—ç¬¦ï¼Œå…¶å¼€é”€éƒ½æ˜¯ 2ã€‚å› æ­¤ï¼Œæœ€å¤§é•¿åº¦ä¸º 1ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"abcd\", t = \"acde\", cost = 0\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šä½ æ— æ³•ä½œå‡ºä»»ä½•æ”¹åŠ¨ï¼Œæ‰€ä»¥æœ€å¤§é•¿åº¦ä¸º 1ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= s.length, t.length <= 10^5`\n- `0 <= maxCost <= 10^6`\n- `s` å’Œ `t` éƒ½åªå«å°å†™è‹±æ–‡å­—æ¯ã€‚\n\n**è§£æ³•ä¸€**\n\n```go\nfunc equalSubstring(s string, t string, maxCost int) int {\n    left := 0\n    cost := 0\n    res := 0\n    for right := 0; right < len(s); right++ {\n        cost += getCost(s[right], t[right])\n        if cost <= maxCost {\n            res = max(res, right-left+1)\n        } else {\n            cost -= getCost(s[left], t[left])\n            left++\n        }\n    }\n    return res\n}\n\nfunc getCost(a, b byte) int {\n    if a < b { //a-b<0 byteæ˜¯uint8ç›´æ¥è¿™æ ·å‡ä¼šå˜æˆæ­£æ•°\n        return int(b - a)\n    }\n    return int(a - b)\n}\n\nfunc max(a, b int) int {\n    if a > b {\n        return a\n    }\n    return b\n}\n```\n\nè¿™ä¸ªé¢˜æœ¬èº«ä¸éš¾ï¼Œä¸»è¦æ˜¯ä¸ºäº†å­¦ä¹ æ»‘çª—ç±»å‹çš„é¢˜ï¼Œè¿™é¢˜æˆ‘åˆæ”¹äº†å¥½é•¿æ—¶é—´ï¼Œæœç„¶åšæ»‘çª—çš„é¢˜è¿˜æ˜¯æœ‰ç‚¹ä¹±ï¼Œä¸è¿‡åšäº†è¿™ä¸€é¢˜ä¹‹åå·²ç»æœ‰ç‚¹æ„Ÿè§‰äº†ï¼Œç›®å‰æ‰“ç®—æŠŠæ‰€æœ‰çš„æ»‘çª—éƒ½é‡åšä¸€éï¼Œç„¶åæ€»ç»“ä¸€ä¸‹å¥—è·¯\n\n**æ€è€ƒ**\n\nä¸‹é¢`for-while`çš„ç»“æ„ä¼¼ä¹æ›´åŠ ç»Ÿä¸€ï¼Œä¸Šé¢`for-if`çš„ç»“æ„åªèƒ½ç”¨åœ¨æ±‚**æœ€é•¿ï¼Œæœ€å¤§**çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ—¶å€™`left`å’Œ`right`å…è®¸åŒæ—¶åŠ åŠ ï¼Œæ‰€ä»¥ç”¨`if`ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ±‚æœ€çŸ­çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸Šé¢[209. é•¿åº¦æœ€å°çš„å­æ•°ç»„](#209-é•¿åº¦æœ€å°çš„å­æ•°ç»„)å°±ä¸èƒ½ç”¨`for-if` ï¼Œå½“rightåˆ°è¾¾è¾¹ç•Œçš„æ—¶å€™leftå¯èƒ½è¿˜éœ€è¦ç»§ç»­ç§»åŠ¨ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨`if`\n\n```go\nfunc equalSubstring(s string, t string, maxCost int) int {\n    left := 0\n    cost := 0\n    res := 0\n    for right := 0; right < len(s); right++ {\n        cost += getCost(s[right], t[right])\n        for cost > maxCost {\n            cost -= getCost(s[left], t[left])\n            left++\n        }\n        res = max(res, right-left+1)\n    }\n    return res\n}\n```\n\n## [1052. çˆ±ç”Ÿæ°”çš„ä¹¦åº—è€æ¿](https://leetcode-cn.com/problems/grumpy-bookstore-owner/)\n\nä»Šå¤©ï¼Œä¹¦åº—è€æ¿æœ‰ä¸€å®¶åº—æ‰“ç®—è¯•è¥ä¸š `customers.length` åˆ†é’Ÿã€‚æ¯åˆ†é’Ÿéƒ½æœ‰ä¸€äº›é¡¾å®¢ï¼ˆ`customers[i]`ï¼‰ä¼šè¿›å…¥ä¹¦åº—ï¼Œæ‰€æœ‰è¿™äº›é¡¾å®¢éƒ½ä¼šåœ¨é‚£ä¸€åˆ†é’Ÿç»“æŸåç¦»å¼€ã€‚\n\nåœ¨æŸäº›æ—¶å€™ï¼Œä¹¦åº—è€æ¿ä¼šç”Ÿæ°”ã€‚ å¦‚æœä¹¦åº—è€æ¿åœ¨ç¬¬ `i` åˆ†é’Ÿç”Ÿæ°”ï¼Œé‚£ä¹ˆ `grumpy[i] = 1`ï¼Œå¦åˆ™ `grumpy[i] = 0`ã€‚ å½“ä¹¦åº—è€æ¿ç”Ÿæ°”æ—¶ï¼Œé‚£ä¸€åˆ†é’Ÿçš„é¡¾å®¢å°±ä¼šä¸æ»¡æ„ï¼Œä¸ç”Ÿæ°”åˆ™ä»–ä»¬æ˜¯æ»¡æ„çš„ã€‚\n\nä¹¦åº—è€æ¿çŸ¥é“ä¸€ä¸ªç§˜å¯†æŠ€å·§ï¼Œèƒ½æŠ‘åˆ¶è‡ªå·±çš„æƒ…ç»ªï¼Œå¯ä»¥è®©è‡ªå·±è¿ç»­ `X` åˆ†é’Ÿä¸ç”Ÿæ°”ï¼Œä½†å´åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚\n\nè¯·ä½ è¿”å›è¿™ä¸€å¤©è¥ä¸šä¸‹æ¥ï¼Œæœ€å¤šæœ‰å¤šå°‘å®¢æˆ·èƒ½å¤Ÿæ„Ÿåˆ°æ»¡æ„çš„æ•°é‡ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```\nè¾“å…¥ï¼šcustomers = [1,0,1,2,1,1,7,5], grumpy = [0,1,0,1,0,1,0,1], X = 3\nè¾“å‡ºï¼š16\nè§£é‡Šï¼š\nä¹¦åº—è€æ¿åœ¨æœ€å 3 åˆ†é’Ÿä¿æŒå†·é™ã€‚\næ„Ÿåˆ°æ»¡æ„çš„æœ€å¤§å®¢æˆ·æ•°é‡ = 1 + 1 + 1 + 1 + 7 + 5 = 16.\n```\n\n**æç¤ºï¼š**\n\n- `1 <= X <= customers.length == grumpy.length <= 20000`\n- `0 <= customers[i] <= 1000`\n- `0 <= grumpy[i] <= 1`\n\n**è§£æ³•ä¸€**\n\næ»‘åŠ¨çª—å£çš„æ„Ÿè§‰æ¥äº†ï¼Œè¶Šæ¥è¶Šç†Ÿç»ƒäº†ï¼Œè¿™é¢˜ç›´æ¥bugfreeäº†ğŸ˜\n\n```java\npublic int maxSatisfied(int[] customers, int[] grumpy, int X) {\n    if(grumpy==null || grumpy.length<0) return 0;\n    int N=grumpy.length;\n    int left=0;\n    int window=0;//çª—å£å†…åè½¬äººæ•°\n    int max=0; //æœ€å¤šåè½¬äººæ•°\n    for(int right=0;right<N;right++){\n        if(grumpy[right]==1){\n            window+=customers[right];\n        }\n        //whileå’Œiféƒ½å¯ä»¥,ä¸ªäººæ¯”è¾ƒå–œæ¬¢whileé€šç”¨æ€§æ¯”è¾ƒå¼º\n        while(right-left+1>X){\n            if(grumpy[left]==1){\n                window-=customers[left];\n            }\n            left++;\n        }\n        max=Math.max(window,max);\n    }\n    int res=0;\n    for(int i=0;i<N;i++){\n        res+=(grumpy[i]==0?customers[i]:0);\n    }\n    return res+max;\n}\n```\nå¯ä»¥çœ‹åˆ°ä»ç„¶æ˜¯å‰é¢æ€»ç»“çš„`for-while`ç»“æ„ï¼Œç­‰æˆ‘æŠŠæ‰€æœ‰çš„æ»‘çª—tagåšå®Œäº†å†æ¥æ€»ç»“ä¸€æ³¢\n\n## [1040. ç§»åŠ¨çŸ³å­ç›´åˆ°è¿ç»­ II](https://leetcode-cn.com/problems/moving-stones-until-consecutive-ii/)\n\nåœ¨ä¸€ä¸ªé•¿åº¦**æ— é™**çš„æ•°è½´ä¸Šï¼Œç¬¬ `i` é¢—çŸ³å­çš„ä½ç½®ä¸º `stones[i]`ã€‚å¦‚æœä¸€é¢—çŸ³å­çš„ä½ç½®æœ€å°/æœ€å¤§ï¼Œé‚£ä¹ˆè¯¥çŸ³å­è¢«ç§°ä½œ**ç«¯ç‚¹çŸ³å­**ã€‚\n\næ¯ä¸ªå›åˆï¼Œä½ å¯ä»¥å°†ä¸€é¢—ç«¯ç‚¹çŸ³å­æ‹¿èµ·å¹¶ç§»åŠ¨åˆ°ä¸€ä¸ªæœªå ç”¨çš„ä½ç½®ï¼Œä½¿å¾—è¯¥çŸ³å­ä¸å†æ˜¯ä¸€é¢—ç«¯ç‚¹çŸ³å­ã€‚\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœçŸ³å­åƒ `stones = [1,2,5]` è¿™æ ·ï¼Œä½ å°†**æ— æ³•**ç§»åŠ¨ä½äºä½ç½® 5 çš„ç«¯ç‚¹çŸ³å­ï¼Œå› ä¸ºæ— è®ºå°†å®ƒç§»åŠ¨åˆ°ä»»ä½•ä½ç½®ï¼ˆä¾‹å¦‚ 0 æˆ– 3ï¼‰ï¼Œè¯¥çŸ³å­éƒ½ä»ç„¶ä¼šæ˜¯ç«¯ç‚¹çŸ³å­ã€‚\n\nå½“ä½ æ— æ³•è¿›è¡Œä»»ä½•ç§»åŠ¨æ—¶ï¼Œå³ï¼Œè¿™äº›çŸ³å­çš„ä½ç½®è¿ç»­æ—¶ï¼Œæ¸¸æˆç»“æŸã€‚\n\nè¦ä½¿æ¸¸æˆç»“æŸï¼Œä½ å¯ä»¥æ‰§è¡Œçš„æœ€å°å’Œæœ€å¤§ç§»åŠ¨æ¬¡æ•°åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ ä»¥é•¿åº¦ä¸º 2 çš„æ•°ç»„å½¢å¼è¿”å›ç­”æ¡ˆï¼š`answer = [minimum_moves, maximum_moves]` ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[7,4,9]\nè¾“å‡ºï¼š[1,2]\nè§£é‡Šï¼š\næˆ‘ä»¬å¯ä»¥ç§»åŠ¨ä¸€æ¬¡ï¼Œ4 -> 8ï¼Œæ¸¸æˆç»“æŸã€‚\næˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç§»åŠ¨ä¸¤æ¬¡ 9 -> 5ï¼Œ4 -> 6ï¼Œæ¸¸æˆç»“æŸã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[6,5,4,3,10]\nè¾“å‡ºï¼š[2,3]\nè§£é‡Šï¼š\næˆ‘ä»¬å¯ä»¥ç§»åŠ¨ 3 -> 8ï¼Œæ¥ç€æ˜¯ 10 -> 7ï¼Œæ¸¸æˆç»“æŸã€‚\næˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç§»åŠ¨ 3 -> 7, 4 -> 8, 5 -> 9ï¼Œæ¸¸æˆç»“æŸã€‚\næ³¨æ„ï¼Œæˆ‘ä»¬æ— æ³•è¿›è¡Œ 10 -> 2 è¿™æ ·çš„ç§»åŠ¨æ¥ç»“æŸæ¸¸æˆï¼Œå› ä¸ºè¿™æ˜¯ä¸åˆè¦æ±‚çš„ç§»åŠ¨ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[100,101,104,102,103]\nè¾“å‡ºï¼š[0,0]\n```\n\n**æç¤ºï¼š**\n\n1. `3 <= stones.length <= 10^4`\n2. `1 <= stones[i] <= 10^9`\n3. `stones[i]` çš„å€¼å„ä¸ç›¸åŒã€‚\n\n**è§£æ³•ä¸€**\n\næ‡µé€¼ï¼ŒæŸæ¬¡å‘¨èµ›çš„T4ï¼Œå—¯æŠ„ï¼Œä¸ä¼šåšï¼Œé¢˜ç›®éƒ½å·®ç‚¹æ²¡çœ‹æ‡‚\n\n```java\npublic int[] numMovesStonesII(int[] stones) {\n    if(stones==null || stones.length<=0){\n        return new int[2];\n    }\n    //0 1 2 3 4 5 6 7 8 9 10\n    //      0 1 2 3        4\n    int N=stones.length;\n    Arrays.sort(stones);\n    int left=0;\n    int[] res=new int[2];\n    res[0]=Integer.MAX_VALUE;\n    for(int right=0;right<N;right++){\n        //æ•´ä¸ªåŒºé—´èŒƒå›´å¤§äºNäº†éœ€è¦ç¼©å°åŒºé—´\n        while(stones[right]-stones[left]+1>N){ \n            left++;\n        }\n        int windowStones=right-left+1;\n        if(windowStones==N-1&&stones[right]-stones[left]+1==N-1){\n            res[0]=Math.min(2,res[0]);\n        }else{\n            res[0]=Math.min(res[0],N-windowStones);\n        }\n    }\n    res[1]=Math.max(stones[N-1]-stones[1]-N+2,stones[N-2]-stones[0]-N+2);\n    return res;\n}\n```\n\n## [1456. å®šé•¿å­ä¸²ä¸­å…ƒéŸ³çš„æœ€å¤§æ•°ç›®](https://leetcode-cn.com/problems/maximum-number-of-vowels-in-a-substring-of-given-length/)\n\nç»™ä½ å­—ç¬¦ä¸² s å’Œæ•´æ•° k ã€‚\n\nè¯·è¿”å›å­—ç¬¦ä¸² s ä¸­é•¿åº¦ä¸º k çš„å•ä¸ªå­å­—ç¬¦ä¸²ä¸­å¯èƒ½åŒ…å«çš„æœ€å¤§å…ƒéŸ³å­—æ¯æ•°ã€‚\n\nè‹±æ–‡ä¸­çš„ å…ƒéŸ³å­—æ¯ ä¸ºï¼ˆa, e, i, o, uï¼‰ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"abciiidef\", k = 3\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šå­å­—ç¬¦ä¸² \"iii\" åŒ…å« 3 ä¸ªå…ƒéŸ³å­—æ¯ã€‚\n```\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"aeiou\", k = 2\nè¾“å‡ºï¼š2\nè§£é‡Šï¼šä»»æ„é•¿åº¦ä¸º 2 çš„å­å­—ç¬¦ä¸²éƒ½åŒ…å« 2 ä¸ªå…ƒéŸ³å­—æ¯ã€‚\n```\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"leetcode\", k = 3\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š\"lee\"ã€\"eet\" å’Œ \"ode\" éƒ½åŒ…å« 2 ä¸ªå…ƒéŸ³å­—æ¯ã€‚\n```\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"rhythms\", k = 4\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šå­—ç¬¦ä¸² s ä¸­ä¸å«ä»»ä½•å…ƒéŸ³å­—æ¯ã€‚\n```\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"tryhard\", k = 4\nè¾“å‡ºï¼š1\n```\n\n**æç¤ºï¼š**\n\n- 1 <= s.length <= 10^5\n- s ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ\n- 1 <= k <= s.length\n\n**è§£æ³•ä¸€**\n\nå¥½ä¹…æ²¡å†™æ»‘çª—çš„é¢˜äº†ï¼Œå›é¡¾ä¸‹ä¹‹å‰çš„æ¨¡æ¿ï¼Œ`for-while`ç»“æ„\n```java\npublic int maxVowels(String s, int k) {\n    int left=0;\n    int res=0;\n    int count=0;\n    for(int right=0;right<s.length();right++){\n        if(vowel(s.charAt(right))){\n            count++;\n        }\n        while(right-left >= k){\n            if(vowel(s.charAt(left))){\n                count--;\n            }\n            left++;\n        }\n        res=Math.max(res,count);\n    }\n    return res;\n}\n\npublic boolean vowel(char ch){\n    return ch=='a' || ch=='e' || ch=='i' || ch=='o' || ch=='u';\n}\n\n```\n\n## [1461. æ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æ‰€æœ‰é•¿åº¦ä¸º K çš„äºŒè¿›åˆ¶å­ä¸²](https://leetcode-cn.com/problems/check-if-a-string-contains-all-binary-codes-of-size-k/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²Â `s`Â å’Œä¸€ä¸ªæ•´æ•°Â `k`Â ã€‚\n\nå¦‚æœæ‰€æœ‰é•¿åº¦ä¸º `k`Â çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²éƒ½æ˜¯ `s`Â çš„å­ä¸²ï¼Œè¯·è¿”å› True ï¼Œå¦åˆ™è¯·è¿”å› False ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"00110110\", k = 2\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šé•¿åº¦ä¸º 2 çš„äºŒè¿›åˆ¶ä¸²åŒ…æ‹¬ \"00\"ï¼Œ\"01\"ï¼Œ\"10\" å’Œ \"11\"ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ s ä¸­ä¸‹æ ‡ä¸º 0ï¼Œ1ï¼Œ3ï¼Œ2 å¼€å§‹çš„é•¿åº¦ä¸º 2 çš„å­ä¸²ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"00110\", k = 2\nè¾“å‡ºï¼štrue\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"0110\", k = 1\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šé•¿åº¦ä¸º 1 çš„äºŒè¿›åˆ¶ä¸²åŒ…æ‹¬ \"0\" å’Œ \"1\"ï¼Œæ˜¾ç„¶å®ƒä»¬éƒ½æ˜¯ s çš„å­ä¸²ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"0110\", k = 2\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šé•¿åº¦ä¸º 2 çš„äºŒè¿›åˆ¶ä¸² \"00\" æ²¡æœ‰å‡ºç°åœ¨ s ä¸­ã€‚\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```go\nè¾“å…¥ï¼šs = \"0000000001011100\", k = 4\nè¾“å‡ºï¼šfalse\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= s.length <= 5 * 10^5`\n*   `s` ä¸­åªå« 0 å’Œ 1 ã€‚\n*   `1 <= k <= 20`\n\n\n**è§£æ³•ä¸€**\n\næŸæ¬¡å‘¨èµ›çš„T2è¿˜æ˜¯T3ï¼Œå¿˜äº†ï¼Œæˆ‘ç”¨äº†æœ€æš´åŠ›çš„æ–¹æ³•ï¼Œç›´æ¥å›æº¯ç”Ÿæˆäº†æ‰€æœ‰çš„äºŒè¿›åˆ¶ä¸²ï¼Œç„¶åå¯¹æ¯”çš„ï¼Œå†™çš„å¾ˆå¿«ï¼Œä¹ŸACäº†ï¼Œä½†æ˜¯ä½†æ˜¯åé¢ä¸€ç›´æ²¡æ—¶é—´é‡å†™ï¼Œä»Šå¤©å¶ç„¶å‘ç°äº†è¿™é“é¢˜ï¼Œé‡å†™ä¸‹\n\nç»å…¸for-whileç»“æ„\n```golang\nfunc hasAllCodes(s string, k int) bool {\n Â  Â var set = make(map[int]bool)\n Â  Â var left = 0\n Â  Â var cur = 0\n Â  Â for right := 0; right < len(s); right++{\n Â  Â  Â  Â cur = cur * 2 + int(s[right] & 1)\n Â  Â  Â  Â for right - left + 1 > k{\n Â  Â  Â  Â  Â  Â cur &= ^(1 << k) //å°†é¦–ä½ç½®ä¸º0\n Â  Â  Â  Â  Â  Â left++\n Â  Â  Â   }\n Â  Â  Â  Â if right - left + 1 == k{\n Â  Â  Â  Â  Â  Â set[cur] = true Â  \n Â  Â  Â   }\n Â   }\n Â  Â return len(set) == 1 << k\n}\n```\nè¿™ä¸ªé¢˜ä¹Ÿå¯ä»¥ç›´æ¥å­˜å­—ç¬¦ä¸²è¿›å»ï¼Œä½†æ˜¯å­˜å­—ç¬¦ä¸²çš„æ—¶é—´å¤æ‚åº¦å°±ä¸æ˜¯O(N)äº†(Nä¸ºå­—ç¬¦é•¿åº¦)ï¼Œè€Œæ˜¯O(KN)ï¼Œå› ä¸ºå­—ç¬¦ä¸²Hashçš„å¤æ‚åº¦æ˜¯O(K)ï¼Œä½†æ˜¯è¿™é‡ŒKå¾ˆå°ï¼Œæ‰€ä»¥å…¶å®ä¹Ÿæ— æ‰€è°“ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦è¿½æ±‚æ›´åŠ ä¼˜ç§€çš„è§£æ³•ï¼Œæ‰€ä»¥æœ€å¥½çš„åšæ³•è¿˜æ˜¯å°†å…¶è½¬æ¢æˆæ•°å­—ï¼Œç„¶åå­˜åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œè¿™é‡Œçœ‹äº†åˆ«äººçš„è§£æ³•åˆå­¦åˆ°äº†ä¸€æ‰‹ä½è¿ç®—çš„å°æŠ€å·§ï¼Œ`cur & ^(1<<k)`ï¼ˆkä¸ºcuré•¿åº¦-1ï¼‰å¯ä»¥å°†curé¦–ä½ç½®ä¸º0ï¼Œä¹Ÿå°±æ˜¯æ¶ˆå»é¦–ä½ï¼ŒåŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†\n\n## [1498. æ»¡è¶³æ¡ä»¶çš„å­åºåˆ—æ•°ç›®](https://leetcode-cn.com/problems/number-of-subsequences-that-satisfy-the-given-sum-condition/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `target` ã€‚\n\nè¯·ä½ ç»Ÿè®¡å¹¶è¿”å› `nums` ä¸­èƒ½æ»¡è¶³å…¶æœ€å°å…ƒç´ ä¸æœ€å¤§å…ƒç´ çš„ **å’Œ** å°äºæˆ–ç­‰äº `target` çš„ **éç©º** å­åºåˆ—çš„æ•°ç›®ã€‚\n\nç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·å°†ç»“æœå¯¹ 10^9 + 7 å–ä½™åè¿”å›ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [3,5,6,7], target = 9\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šæœ‰ 4 ä¸ªå­åºåˆ—æ»¡è¶³è¯¥æ¡ä»¶ã€‚\n[3] -> æœ€å°å…ƒç´  + æœ€å¤§å…ƒç´  <= target (3 + 3 <= 9)\n[3,5] -> (3 + 5 <= 9)\n[3,5,6] -> (3 + 6 <= 9)\n[3,6] -> (3 + 6 <= 9)\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [3,3,6,8], target = 10\nè¾“å‡ºï¼š6\nè§£é‡Šï¼šæœ‰ 6 ä¸ªå­åºåˆ—æ»¡è¶³è¯¥æ¡ä»¶ã€‚ï¼ˆnums ä¸­å¯ä»¥æœ‰é‡å¤æ•°å­—ï¼‰\n[3] , [3] , [3,3], [3,6] , [3,6] , [3,3,6]\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [2,3,3,4,6,7], target = 12\nè¾“å‡ºï¼š61\nè§£é‡Šï¼šå…±æœ‰ 63 ä¸ªéç©ºå­åºåˆ—ï¼Œå…¶ä¸­ 2 ä¸ªä¸æ»¡è¶³æ¡ä»¶ï¼ˆ[6,7], [7]ï¼‰\næœ‰æ•ˆåºåˆ—æ€»æ•°ä¸ºï¼ˆ63 - 2 = 61ï¼‰\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [5,2,4,1,7,6,8], target = 16\nè¾“å‡ºï¼š127\nè§£é‡Šï¼šæ‰€æœ‰éç©ºå­åºåˆ—éƒ½æ»¡è¶³æ¡ä»¶ (2^7 - 1) = 127\n```\n\n**æç¤ºï¼š**\n\n*   `1 <= nums.length <= 10^5`\n*   `1 <= nums[i] <= 10^6`\n*   `1 <= target <= 10^6`\n\n**è§£æ³•ä¸€**\n\nåŒæŒ‡é’ˆæ»‘çª—ï¼Œå¾ˆå…³é”®çš„ä¸€æ­¥å°±æ˜¯æ’åºï¼Œå› ä¸ºæˆ‘ä»¬åªå…³å¿ƒæœ€å¤§æœ€å°å€¼ï¼Œè€Œä¸”æ˜¯å­åºåˆ—ï¼Œä¸é¡ºåºæ— å…³\n```java\n//åŒæŒ‡é’ˆ\npublic int numSubseq(int[] nums, int target) {\n    Arrays.sort(nums);\n    int MOD = (int)(1e9+7);\n    int n = nums.length;\n    //é¢„å¤„ç†å‡ºå¹‚å€¼è¡¨\n    int[] pow = new int[n];\n    pow[0] = 1;\n    for (int i = 1; i < n; i++){\n        pow[i] = (pow[i-1] << 1) % MOD;\n    }\n    int left = 0, right = n-1;\n    long count = 0;\n    while(left <= right){\n        while(left <= right && nums[left] + nums[right] > target) {\n            right--;\n        }\n        if (left <= right) {\n            //nums[left] + nums[right] <>= target \n            //åŒ…å«leftçš„å­åºåˆ—ä¸ªæ•°: leftå›ºå®šï¼Œåœ¨[left+1,right]é€‰è‹¥å¹²ä¸ªï¼Œå°±æœ‰ 2^(right-left) ç§é€‰æ³•\n            count = (count + pow[right-left]) % MOD ;\n        }\n        left++;\n    }\n    return (int)count%MOD;\n}\n```\n**è§£æ³•äºŒ**\n\näºŒåˆ†\n```java\n//äºŒåˆ†\npublic int numSubseq(int[] nums, int target) {\n    Arrays.sort(nums);\n    int MOD = (int)(1e9+7);\n    int n = nums.length;\n    //é¢„å¤„ç†å‡ºå¹‚å€¼è¡¨\n    int[] pow = new int[n];\n    pow[0] = 1;\n    for (int i = 1; i < n; i++){\n        pow[i] = (pow[i-1] << 1) % MOD;\n    }\n    long count = 0;\n    for (int i = 0; i < n; i++) {\n        if (target-nums[i] < 0){\n            break;\n        }\n        int right = search(nums, target-nums[i]);\n        if (right >= i){\n            count = (count + pow[right-i]) % MOD;\n        }\n    }\n    return (int) count % MOD;\n}\n\n//æœç´¢æœ€åä¸€ä¸ªå°äºç­‰äºtargetçš„å€¼\npublic int search(int[] nums, int target){\n    int left = 0, right = nums.length-1;\n    int res = -1;\n    while (left <= right) {\n        int mid = left + (right-left)/2;\n        if (nums[mid] <= target){\n            res = mid;\n            left = mid + 1;\n        }else{\n            right = mid - 1;\n        }\n    }\n    return res;\n}\n```\n## [904. æ°´æœæˆç¯®](https://leetcode-cn.com/problems/fruit-into-baskets/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nåœ¨ä¸€æ’æ ‘ä¸­ï¼Œç¬¬ `i` æ£µæ ‘äº§ç”ŸÂ `tree[i]` å‹çš„æ°´æœã€‚  \nä½ å¯ä»¥**ä»ä½ é€‰æ‹©çš„ä»»ä½•æ ‘å¼€å§‹**ï¼Œç„¶åé‡å¤æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n\n1.  æŠŠè¿™æ£µæ ‘ä¸Šçš„æ°´æœæ”¾è¿›ä½ çš„ç¯®å­é‡Œã€‚å¦‚æœä½ åšä¸åˆ°ï¼Œå°±åœä¸‹æ¥ã€‚\n2.  ç§»åŠ¨åˆ°å½“å‰æ ‘å³ä¾§çš„ä¸‹ä¸€æ£µæ ‘ã€‚å¦‚æœå³è¾¹æ²¡æœ‰æ ‘ï¼Œå°±åœä¸‹æ¥ã€‚\n\nè¯·æ³¨æ„ï¼Œåœ¨é€‰æ‹©ä¸€é¢—æ ‘åï¼Œä½ æ²¡æœ‰ä»»ä½•é€‰æ‹©ï¼šä½ å¿…é¡»æ‰§è¡Œæ­¥éª¤ 1ï¼Œç„¶åæ‰§è¡Œæ­¥éª¤ 2ï¼Œç„¶åè¿”å›æ­¥éª¤ 1ï¼Œç„¶åæ‰§è¡Œæ­¥éª¤ 2ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´è‡³åœæ­¢ã€‚\n\nä½ æœ‰ä¸¤ä¸ªç¯®å­ï¼Œæ¯ä¸ªç¯®å­å¯ä»¥æºå¸¦ä»»ä½•æ•°é‡çš„æ°´æœï¼Œä½†ä½ å¸Œæœ›æ¯ä¸ªç¯®å­åªæºå¸¦ä¸€ç§ç±»å‹çš„æ°´æœã€‚  \nç”¨è¿™ä¸ªç¨‹åºä½ èƒ½æ”¶é›†çš„æ°´æœæ€»é‡æ˜¯å¤šå°‘ï¼Ÿ\n> æ„Ÿè§‰è¿™é‡Œæƒ³è¡¨è¾¾çš„åº”è¯¥æ˜¯æ°´æœæ ‘çš„æ•°é‡\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š[1,2,1]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æ”¶é›† [1,2,1]ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š[0,1,2,2]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æ”¶é›† [1,2,2].\nå¦‚æœæˆ‘ä»¬ä»ç¬¬ä¸€æ£µæ ‘å¼€å§‹ï¼Œæˆ‘ä»¬å°†åªèƒ½æ”¶é›†åˆ° [0, 1]ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼š[1,2,3,2,2]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æ”¶é›† [2,3,2,2].\nå¦‚æœæˆ‘ä»¬ä»ç¬¬ä¸€æ£µæ ‘å¼€å§‹ï¼Œæˆ‘ä»¬å°†åªèƒ½æ”¶é›†åˆ° [1, 2]ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼š[3,3,3,1,2,1,1,2,3,3,4]\nè¾“å‡ºï¼š5\nè§£é‡Šï¼šæˆ‘ä»¬å¯ä»¥æ”¶é›† [1,2,1,1,2].\nå¦‚æœæˆ‘ä»¬ä»ç¬¬ä¸€æ£µæ ‘æˆ–ç¬¬å…«æ£µæ ‘å¼€å§‹ï¼Œæˆ‘ä»¬å°†åªèƒ½æ”¶é›†åˆ° 4 ä¸ªæ°´æœã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  `1 <= tree.length <= 40000`\n2.  `0 <= tree[i] < tree.length`\n\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®æ„æ€å…¶å®å°±æ˜¯æ±‚åªåŒ…å«2ä¸ªå…ƒç´ çš„æœ€é•¿å­ä¸²ï¼Œé¢˜ç›®è¡¨è¿°çš„ä¸å¤ªæ¸…æ¥šï¼Œå·²ç»åé¦ˆäº†\n```golang\nfunc totalFruit(tree []int) int {\n    var left = 0\n    var Max = func (a, b int) int {if a>b {return a};return b}\n    var n = len(tree)\n    var freq [40001]int\n    var res, count = 0, 0\n    for right := 0; right < n; right++ {\n        if freq[tree[right]] == 0 {\n            count++\n        }\n        freq[tree[right]]++\n        for count > 2 {\n            freq[tree[left]]--\n            if freq[tree[left]] == 0 {\n                count--\n            }\n            left++\n        }\n        res = Max(res, right-left+1)\n    }\n    return res\n}\n```\n## [NC562.ç‰›ç‰›çš„é­”æ³•å¡](https://www.nowcoder.com/practice/9b6fe52a68904c77aa81502f57ceac86)\n\nç‰›ç‰›ä»å°å°±æœ‰æ”¶é›†é­”æ³•å¡çš„ä¹ æƒ¯ï¼Œä»–æœ€å¤§çš„æ„¿æœ›å°±æ˜¯èƒ½å¤Ÿé›†é½ k ç§ä¸åŒç§ç±»çš„é­”æ³•å¡ï¼Œç°åœ¨æœ‰ n å¼ é­”æ³•å¡ï¼Œè¿™ n å¼ é­”æ³•å¡å­˜åœ¨äºä¸€ç»´åæ ‡ç‚¹ä¸Šï¼Œ\næ¯å¼ é­”æ³•å¡å¯èƒ½å±äºæŸä¸€ç§ç±»ã€‚ç‰›ç‰›å¦‚æœæƒ³æ”¶é›†é­”æ³•å¡å°±éœ€è¦ä»å½“å‰åæ ‡ç‚¹è·³è·ƒåˆ°å¦å¤–ä¸€ä¸ªé­”æ³•å¡æ‰€åœ¨çš„åæ ‡ç‚¹ï¼ŒèŠ±è´¹çš„ä»£ä»·æ˜¯ä¸¤ä¸ªè·³è·ƒåæ ‡ç‚¹ä¹‹é—´çš„è·ç¦»å·®ã€‚\nç‰›ç‰›å¯ä»¥ä»ä»»æ„çš„åæ ‡ç‚¹å‡ºå‘ï¼Œç‰›ç‰›æƒ³çŸ¥é“ä»–é›†é½ k ç§é­”æ³•å¡æ‰€èŠ±è´¹çš„æœ€å°ä»£ä»·æ˜¯å¤šå°‘ï¼Œå¦‚æœé›†ä¸é½ k ç§é­”æ³•å¡ï¼Œè¾“å‡º-1ã€‚\nç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ•´æ•° n,k, åˆ†åˆ«è¡¨ç¤ºé­”æ³•å¡çš„ä¸ªæ•°å’Œç§ç±»ä¸ªæ•°ã€‚\næ¥ä¸‹æ¥æœ‰nè¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•°xï¼Œy åˆ†åˆ«è¡¨ç¤ºå±äºå“ªä¸€ç§é­”æ³•å¡å’Œé­”æ³•å¡æ‰€åœ¨çš„åæ ‡\n\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥: 7,3,[[0,1],[0,2],[1,5],[1,1],[0,7],[2,8],[1,3]]\nè¾“å‡º: 3\nè¯´æ˜: \næ ·ä¾‹ä¸€ï¼šç‰›ç‰›ä»åæ ‡ç‚¹5å‡ºå‘ï¼Œç»è¿‡7ã€8ä¸¤ä¸ªç‚¹å°±æ”¶é›†äº†3å¼ ä¸åŒç§ç±»çš„é­”æ³•å¡ï¼Œè¾¾æˆæˆå°±ã€‚æ‰€éœ€ä»£ä»· ï¼ˆ7-5ï¼‰+ï¼ˆ8-7ï¼‰ = 3\n```\n**å¤‡æ³¨:**\n- 1<=n<=10^6\n- 1<=k<=50 0<=x<k\n- 0 <= y <= 1e9\n\n**è§£æ³•ä¸€**\n\ntagæ˜¯äºŒåˆ†ï¼Œä½†æ˜¯æƒ³äº†ä¸€ä¼šå„¿æ„Ÿè§‰å¥½åƒæ²¡å•¥å¥½çš„äºŒåˆ†çš„æ€è·¯ï¼ŒäºŒåˆ†ç­”æ¡ˆè²Œä¼¼å¯è¡Œï¼Œä¸è¿‡è¿™é¢˜æ»‘çª—çš„æ€è·¯æ›´ç®€å•ï¼Œç±»ä¼¼[76-æœ€å°è¦†ç›–å­ä¸²](#76-æœ€å°è¦†ç›–å­ä¸²)æ»‘å°±å®Œäº‹å„¿äº†\n```java\npublic int solve (int n, int k, int[][] card) {\n    // write code here\n    Arrays.sort(card, (c1,c2)->c1[1]-c2[1]);\n    int INF = Integer.MAX_VALUE;\n    int left = 0;\n    int count = 0;\n    int[] freq = new int[k+1];\n    int res = INF;\n    for (int right = 0; right < n; right++) {\n        if (freq[card[right][0]] == 0) {\n            count++;\n        }\n        freq[card[right][0]]++;\n        while(left<=right && count == k){\n            res = Math.min(res, card[right][1] - card[left][1]);\n            freq[card[left][0]]--;\n            if (freq[card[left][0]]==0) {\n                count--;\n            }\n            left++;\n        }\n    }\n    if (res == INF) {\n        return -1;\n    }\n    return res;\n}\n```\n## [1870. å…¨é›¶å­ä¸²çš„æ•°é‡ï¼ˆLintCodeï¼‰](https://www.lintcode.com/problem/number-of-substrings-with-all-zeroes/description)\n\nç»™å‡ºä¸€ä¸ªåªåŒ…å«0æˆ–1çš„å­—ç¬¦ä¸²str,è¯·è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²ä¸­å…¨ä¸º0çš„å­å­—ç¬¦ä¸²çš„ä¸ªæ•° 1<=|str|<=30000\n\n**ä¾‹1:**\n```go\nè¾“å…¥:\"00010011\"\nè¾“å‡º:9\nè§£é‡Š:\n\"0\"å­å­—ç¬¦ä¸²æœ‰5ä¸ª,\n\"00\"å­å­—ç¬¦ä¸²æœ‰3ä¸ª,\n\"000\"å­å­—ç¬¦ä¸²æœ‰1ä¸ªã€‚\næ‰€ä»¥è¿”å›9\n```\n**ä¾‹2:**\n```go\nè¾“å…¥:\"010010\"\nè¾“å‡º:5\n```\n**è§£æ³•ä¸€**\n\nç›´æ¥æ»‘å°±è¡Œäº†ï¼Œç»Ÿè®¡æ‰€æœ‰0åŒºé—´çš„é•¿åº¦ï¼Œæ³¨æ„ç»„åˆæ•°çš„è®¡ç®—å°±è¡Œäº†\n```java\n// 1 1 1 1 1 (5+4+3+2+1) = n(n-1)/2 + n or n(n+1)/2\npublic int stringCount(String str) {\n    // Write your code here.\n    int left = 0, right = 0;\n    int res = 0;\n    while (right < str.length()) {\n        while(right < str.length() && str.charAt(right) == '0'){\n            right++;\n        }\n        // (0  0  0) 1 1\n        //  l  n     r\n        int n = right-left;\n        //C(n+1,2)/2\n        res += n*(n+1)/2;\n        right++;\n        left = right;\n    }\n    return res;\n}\n```\n\n## [1529. ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„ä¸‰å…ƒå­æ•°ç»„ï¼ˆLintCode](https://www.lintcode.com/problem/triplet-subarray-with-absolute-diff-less-than-or-equal-to-limit/description)ï¼‰\n\nç»™å®šä¸€ä¸ªé€’å¢çš„æ•´æ•°æ•°ç»„numsï¼Œå’Œä¸€ä¸ªè¡¨ç¤ºé™åˆ¶çš„æ•´æ•°limitï¼Œè¯·ä½ è¿”å›æ»¡è¶³æ¡ä»¶çš„ä¸‰å…ƒå­æ•°ç»„çš„ä¸ªæ•°ï¼Œä½¿å¾—è¯¥å­æ•°ç»„ä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„ç»å¯¹å·®å°äºæˆ–è€…ç­‰äºlimitã€‚\n\nå¦‚æœä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ï¼Œåˆ™è¿”å› 0 ã€‚\n\n**æ•°æ®èŒƒå›´ï¼š** 1 â‰¤â€‰len(nums) â‰¤â€‰1e4ï¼Œ1 â‰¤â€‰limit â‰¤â€‰1e6ï¼Œ0 â‰¤â€‰nums[i] â‰¤â€‰1e6\nç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·è¿”å›å®ƒå¯¹99997867å–ä½™åçš„ç»“æœã€‚\n\n**æ ·ä¾‹ 1:**\n```go\nè¾“å…¥ï¼š[1, 2, 3, 4], 3\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šå¯é€‰æ–¹æ¡ˆæœ‰(1, 2, 3), (1, 2, 4), (1, 3, 4), (2, 3, 4)ã€‚å› æ­¤ï¼Œæ»¡è¶³æ¡ä»¶çš„ä¸‰å…ƒç»„æœ‰4ä¸ªã€‚\n```\n\n**æ ·ä¾‹ 2:**\n```go\nè¾“å…¥ï¼š[1, 10, 20, 30, 50], 19\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šå”¯ä¸€å¯è¡Œçš„ä¸‰å…ƒç»„æ˜¯(1, 10, 20)ï¼Œæ‰€ä»¥ç­”æ¡ˆä¸º1ã€‚\n```\n**æŒ‘æˆ˜**\nä½ å¯ä»¥åªç”¨O(n)çš„æ—¶é—´å¤æ‚åº¦è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\næˆ‘ä¸€å¼€å§‹çœ‹è§æ˜¯Hardæƒ³çš„æŒºå¤æ‚çš„ï¼Œä»€ä¹ˆå•è°ƒæ ˆéƒ½æå‡ºæ¥äº†ï¼Œä½†æ˜¯ä»”ç»†çœ‹é¢˜ä¼šå‘ç°é¢˜ç›®ç»™çš„æ•°ç»„æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ç›´æ¥æ»‘çª—ç„¶åç»Ÿè®¡å°±è¡Œäº†ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„è®¡ç®—çš„æ–¹å¼ï¼Œé¿å…ç®—é‡\n```java\n//LintCodeä¸Šå±…ç„¶æ˜¯Hardï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆéš¾\npublic int tripletSubarray(int[] nums, int limit) {\n    // write your code here\n    int n = nums.length;\n    int left = 0, right = 0;\n    int res = 0;\n    while (left <= right) {\n        //æ‰¾åˆ°æœ€è¿œçš„åˆæ³•right\n        while (right < n && nums[right]-nums[left] <= limit) {\n            right++;\n        }\n        //  1  (2 3 4)  5\n        //left   len  right\n        int len = right-left-1;\n        left++;\n        if (len < 2) continue;\n        //C(len,2) æ±‚ä»¥leftå¼€å¤´ï¼ŒåŒ…å«leftçš„æ‰€æœ‰3å…ƒç»„ï¼Œè¿™æ ·ä¸ä¼šé‡å¤\n        res += len*(len-1)/2;\n    }\n    return res;\n}\n```\n> æ„Ÿè§‰è‡ªå·±é™ä¸‹å¿ƒæ¥æƒ³çš„è¯å¾ˆå¤šé¢˜ç›®è¿˜æ˜¯å¯ä»¥è‡ªå·±åšå‡ºæ¥çš„ï¼Œä½†æ˜¯å°±æ˜¯æƒ³çš„å¯èƒ½æœ‰ç‚¹æ…¢ï¼Œç‰¹åˆ«æ˜¯ç«èµ›ä¸­ï¼Œè§„å®šäº†æ—¶é—´åä¸€æ…Œå°±æ›´æ…¢äº†ã€‚ã€‚çœ‹æ¥è¿˜æ˜¯ç»ƒå°‘äº†\n\n## [1375. è‡³å°‘Kä¸ªä¸åŒå­—ç¬¦çš„å­ä¸²ï¼ˆLintCodeï¼‰](https://www.lintcode.com/problem/substring-with-at-least-k-distinct-characters/description)\n\nç»™å®šä¸€ä¸ªä»…åŒ…å«å°å†™å­—æ¯çš„å­—ç¬¦ä¸² S.\n\nè¿”å› S ä¸­è‡³å°‘åŒ…å« k ä¸ªä¸åŒå­—ç¬¦çš„å­ä¸²çš„æ•°é‡.\n\n- 10 â‰¤ length(S) â‰¤ 1,000,000\n- 1 â‰¤ k â‰¤ 26\n\n**æ ·ä¾‹ 1:**\n```go\nè¾“å…¥: S = \"abcabcabca\", k = 4\nè¾“å‡º: 0\nè§£é‡Š: å­—ç¬¦ä¸²ä¸­ä¸€å…±å°±åªæœ‰ 3 ä¸ªä¸åŒçš„å­—ç¬¦.\n```\n**æ ·ä¾‹ 2:**\n```go\nè¾“å…¥: S = \"abcabcabcabc\", k = 3\nè¾“å‡º: 55\nè§£é‡Š: ä»»æ„é•¿åº¦ä¸å°äº 3 çš„å­ä¸²éƒ½å«æœ‰ a, b, c è¿™ä¸‰ä¸ªå­—ç¬¦.\n    æ¯”å¦‚,é•¿åº¦ä¸º 3 çš„å­ä¸²å…±æœ‰ 10 ä¸ª, \"abc\", \"bca\", \"cab\" ... \"abc\"\n    é•¿åº¦ä¸º 4 çš„å­ä¸²å…±æœ‰ 9 ä¸ª, \"abca\", \"bcab\", \"cabc\" ... \"cabc\"\n    ...\n    é•¿åº¦ä¸º 12 çš„å­ä¸²æœ‰ 1 ä¸ª, å°±æ˜¯ S æœ¬èº«.\n    æ‰€ä»¥ç­”æ¡ˆæ˜¯ 1 + 2 + ... + 10 = 55.\n```\n\n**è§£æ³•ä¸€**\n\nç»å…¸æ»‘çª—ï¼Œéå¸¸å¥—è·¯ï¼Œæƒ³å¥½æ€ä¹ˆç»Ÿè®¡å°±è¡Œäº†\n```java\npublic long kDistinctCharacters(String s, int k) {\n    int n = s.length();\n    int left = 0;\n    int[] freq = new int[128];\n    int count = 0;\n    long res = 0;\n    for (int right = 0; right < n; right++) {\n        char cr = s.charAt(right);\n        if (freq[cr] == 0) {\n            count++;\n        }\n        freq[cr]++;\n        while (count >= k && left <= right) {\n            // abc | abcabcabc\n            // l r(2)          n(12)\n            //ç»Ÿè®¡ä»¥s[left,right]å¼€å¤´çš„æ‰€æœ‰å­ä¸²\n            //10+9+8+7+...+1\n            res += n-right;\n            char cl = s.charAt(left);\n            freq[cl]--;\n            if (freq[cl] <= 0) {\n                count--;\n            }\n            left++;\n        }\n    }\n    return res;\n}\n```\n\n## [386. æœ€å¤šæœ‰kä¸ªä¸åŒå­—ç¬¦çš„æœ€é•¿å­å­—ç¬¦ä¸²(LintCode)](https://www.lintcode.com/problem/longest-substring-with-at-most-k-distinct-characters/description)\n\nç»™å®šå­—ç¬¦ä¸²Sï¼Œæ‰¾åˆ°æœ€å¤šæœ‰kä¸ªä¸åŒå­—ç¬¦çš„æœ€é•¿å­ä¸²Tã€‚\n\n**æ ·ä¾‹ 1:**\n```go\nè¾“å…¥: S = \"eceba\" å¹¶ä¸” k = 3\nè¾“å‡º: 4\nè§£é‡Š: T = \"eceb\"\n```\n**æ ·ä¾‹ 2:**\n```go\nè¾“å…¥: S = \"WORLD\" å¹¶ä¸” k = 4\nè¾“å‡º: 4\nè§£é‡Š: T = \"WORL\" æˆ– \"ORLD\"\n```\n**æŒ‘æˆ˜**ï¼š O(n) æ—¶é—´å¤æ‚åº¦\n\n**è§£æ³•ä¸€**\n\næ— è„‘æ»‘çª—å°±è¡Œäº†ï¼Œå¤ªå¥—è·¯äº†\n```java\npublic int lengthOfLongestSubstringKDistinct(String s, int k) {\n    // write your code here\n    int n = s.length();\n    int left = 0;\n    int res = 0;\n    int[] freq = new int[128];\n    int count = 0;\n    for (int right = 0; right < n; right++) {\n        char cr = s.charAt(right);\n        if (freq[cr] == 0) {\n            count++;\n        }\n        freq[cr]++;\n        while (left <= right && count > k) {\n            char cl = s.charAt(left);\n            freq[cl]--;\n            if (freq[cl] <= 0) {\n                count--;\n            }\n            left++;\n        }\n        res = Math.max(res, right-left+1);\n    }\n    return res;\n}\n```\n## [1675. æ•°ç»„çš„æœ€å°åç§»é‡](https://leetcode-cn.com/problems/minimize-deviation-in-array/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™ä½ ä¸€ä¸ªç”± `n` ä¸ªæ­£æ•´æ•°ç»„æˆçš„æ•°ç»„ `nums` ã€‚\n\nä½ å¯ä»¥å¯¹æ•°ç»„çš„ä»»æ„å…ƒç´ æ‰§è¡Œä»»æ„æ¬¡æ•°çš„ä¸¤ç±»æ“ä½œï¼š\n\n*   å¦‚æœå…ƒç´ æ˜¯å¶æ•° ï¼Œé™¤ä»¥ `2`\n    *   ä¾‹å¦‚ï¼Œå¦‚æœæ•°ç»„æ˜¯ `[1,2,3,4]` ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¯¹æœ€åä¸€ä¸ªå…ƒç´ æ‰§è¡Œæ­¤æ“ä½œï¼Œä½¿å…¶å˜æˆ `[1,2,3,2]`\n*   å¦‚æœå…ƒç´ æ˜¯å¥‡æ•° ï¼Œä¹˜ä¸Š `2`\n    *   ä¾‹å¦‚ï¼Œå¦‚æœæ•°ç»„æ˜¯ `[1,2,3,4]` ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ æ‰§è¡Œæ­¤æ“ä½œï¼Œä½¿å…¶å˜æˆ `[2,2,3,4]`\n\næ•°ç»„çš„ **åç§»é‡** æ˜¯æ•°ç»„ä¸­ä»»æ„ä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„ **æœ€å¤§å·®å€¼** ã€‚\n\nè¿”å›æ•°ç»„åœ¨æ‰§è¡ŒæŸäº›æ“ä½œä¹‹åå¯ä»¥æ‹¥æœ‰çš„ **æœ€å°åç§»é‡** ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [1,2,3,4]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šä½ å¯ä»¥å°†æ•°ç»„è½¬æ¢ä¸º [1,2,3,2]ï¼Œç„¶åè½¬æ¢æˆ [2,2,3,2]ï¼Œåç§»é‡æ˜¯ 3 - 2 = 1\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [4,1,5,20,3]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šä¸¤æ¬¡æ“ä½œåï¼Œä½ å¯ä»¥å°†æ•°ç»„è½¬æ¢ä¸º [4,2,5,5,3]ï¼Œåç§»é‡æ˜¯ 5 - 2 = 3\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼šnums = [2,10,8]\nè¾“å‡ºï¼š3\n```\n\n**æç¤ºï¼š**\n\n*   n == nums.length\n*   2 <= n <= 10<sup><span style=\"display: inline;\">5</span></sup>\n*   1 <= nums[i] <= 10<sup>9</sup>\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢[632-æœ€å°åŒºé—´](#632-æœ€å°åŒºé—´)ä¸€æ ·ï¼Œå°†æ•°æ®å˜æˆå’Œæœ€å°åŒºé—´ä¸€æ ·çš„å½¢å¼ï¼Œç„¶åç›´æ¥å¥—ç”¨\n```java\npublic int minimumDeviation(int[] nums) {\n    PriorityQueue<int[]> pq = new PriorityQueue<>((a, b)->a[2]-b[2]);\n    List<List<Integer>> lis = new ArrayList<>();\n    int max = 0;\n    for (int i = 0; i < nums.length; i++) {\n        ArrayList<Integer> tmp = new ArrayList<>();\n        if (nums[i] % 2 == 1) {\n            pq.add(new int[]{i, 0, nums[i]});\n            max = Math.max(max, nums[i]);\n            tmp.add(nums[i]);\n            tmp.add(nums[i] * 2);\n        } else {\n            tmp.add(nums[i]);\n            while (nums[i] % 2 == 0) {\n                tmp.add(nums[i]/2);\n                nums[i]/=2;\n            }\n            pq.add(new int[]{i, 0, nums[i]});\n            max = Math.max(max, nums[i]);\n            Collections.reverse(tmp);\n        }\n        lis.add(tmp);\n    }\n    int res = Integer.MAX_VALUE;\n    while (true) {\n        int[] min = pq.poll();\n        res = Math.min(res, max-min[2]);\n        if (min[1]+1 >= lis.get(min[0]).size()) {\n            break;\n        }\n        int next = lis.get(min[0]).get(min[1]+1);\n        pq.add(new int[]{min[0], min[1]+1, next});\n        max = Math.max(max, next);\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\n```java\n    public int minimumDeviation2(int[] nums) {\n        int INF = 0x3f3f3f3f;\n        PriorityQueue<Integer> pq = new PriorityQueue<>((a, b)->b-a);\n        int min = INF;\n        for (int i = 0; i < nums.length; i++) {\n            if ((nums[i] & 1) == 1) {\n                nums[i] <<= 1;\n            }\n            min = Math.min(min, nums[i]);\n            pq.add(nums[i]);\n        }\n        int res = INF;\n        while (true) {\n            int max = pq.poll();\n            res = Math.min(res, max-min);\n            if ((max&1)==1) {\n                break;\n            }\n            pq.add(max/2);\n            min = Math.min(min, max/2);\n        }\n        return res;\n    }\n```","tags":["LeetCode","æ»‘åŠ¨çª—å£"],"categories":["ç®—æ³•"]},{"title":"Socketç½‘ç»œç¼–ç¨‹","url":"/2019/07/19/socket-wang-luo-bian-cheng/","content":"\n### Socketæ¦‚è¿°\n\nâ€‹\tå¥—æ¥å­—ï¼ˆsocketï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œå¯å¯¹å…¶è¿›è¡Œåƒå¯¹æ–‡ä»¶ä¸€æ ·çš„æ‰“å¼€ã€è¯»å†™å’Œå…³é—­ç­‰æ“ä½œã€‚å¥—æ¥å­—å…è®¸åº”ç”¨ç¨‹åºå°†I/Oæ’å…¥åˆ°ç½‘ç»œä¸­ï¼Œå¹¶ä¸ç½‘ç»œä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ç½‘ç»œå¥—æ¥å­—æ˜¯IPåœ°å€ä¸ç«¯å£çš„ç»„åˆã€‚socketæä¾›çš„å‡½æ•°æ˜¯**æ“ä½œç³»ç»Ÿå†…æ ¸å°†â€œTCP/IPåè®®æ ˆ + åº•å±‚ç½‘å¡â€æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªä¸ªç”¨æˆ·å‹å¥½çš„å‡½æ•°ï¼Œç”¨äºæ“çºµæœ¬åœ°çš„â€œTCP/IPåè®®æ ˆ + åº•å±‚ç½‘å¡â€ä¸è¿œç«¯çš„æœåŠ¡å™¨/ä¸»æœºå®Œæˆé€šä¿¡çš„ä»»åŠ¡ã€‚**\n\n### TCP\n\nğŸ”¸ TCPæ˜¯é¢å‘è¿æ¥çš„é€šä¿¡åè®®\n\nğŸ”¸ é€šè¿‡`ä¸‰æ¬¡æ¡æ‰‹`å»ºç«‹è¿æ¥ï¼Œé€šè®¯å®Œæˆæ—¶è¦æ‹†é™¤è¿æ¥\n\nğŸ”¸ ç”±äºTCPæ˜¯é¢å‘è¿æ¥çš„æ‰€ä»¥åªèƒ½ç”¨äºç«¯åˆ°ç«¯çš„é€šè®¯\n\nğŸ”¸ ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹\n\nğŸ”¸ å…·æœ‰æ ¡éªŒæœºåˆ¶ï¼Œå¯é ï¼Œæ•°æ®ä¼ è¾“ç¨³å®š\n\n#### ç®€å•çš„Socketå°æ¡ˆä¾‹\n\n**Socketå®¢æˆ·ç«¯**\n\n```java\npackage TcpDemo;\nimport java.io.*;\nimport java.net.*;\nimport java.util.Scanner;\n\n/**\n * @author imlgw.top\n * @date 2019/7/7 9:45\n */\npublic class Client {\n    private static final int REMOTE_PORT = 20000;\n\n    private static final int LOCAL_PORT = 30000;\n\n    public static void main(String[] args) throws IOException {\n        Socket socket = creatSocket();\n        initSocket(socket);\n        //setRecessAddresså‰\n        socket.bind(new InetSocketAddress(InetAddress.getLocalHost(), LOCAL_PORT));\n        //è¿æ¥è¿œç¨‹server\n        socket.connect(new InetSocketAddress(InetAddress.getLocalHost(), REMOTE_PORT), 3000);\n        System.out.println(\"å®¢æˆ·ç«¯å·²ç»å‘èµ·è¿æ¥\");\n        System.out.println(\"å®¢æˆ·ç«¯ä¿¡æ¯:\" + socket.getLocalAddress() + \"port:\" + socket.getLocalPort());\n        System.out.println(\"æœåŠ¡ç«¯ä¿¡æ¯\" + socket.getInetAddress() + \"port:\" + socket.getPort());\n        try {\n            sendMsg(socket);\n        } catch (Exception e) {\n            System.err.println(\"è¿æ¥å¼‚å¸¸å…³é—­ï¼ï¼ï¼ï¼\");\n            e.printStackTrace();\n        } finally {\n            socket.close();\n        }\n    }\n\n    private static void initSocket(Socket socket) throws SocketException {\n        socket.setSoTimeout(3000);\n        //æ˜¯å¦å¤ç”¨æœªå®Œå…¨å…³é—­åçš„ç«¯å£(TIME_WAITçŠ¶æ€)ï¼Œå¿…é¡»åœ¨bindå‰ï¼Œæ‰€ä»¥å°±ä¸èƒ½é€šè¿‡æ„é€ å™¨æ¥ç»‘å®šæœ¬åœ°ç«¯å£\n        socket.setReuseAddress(true);\n        //æ˜¯å¦å¼€å¯Nagleç®—æ³•(é»˜è®¤å¼€å¯) https://baike.baidu.com/item/Nagle%E7%AE%97%E6%B3%95\n        socket.setTcpNoDelay(false);\n        //é•¿æ—¶é—´æ— æ•°æ®ç›¸åº”çš„æ—¶å€™å‘é€ç¡®è®¤æ•°æ®ï¼ˆå¿ƒè·³åŒ…ï¼‰æ—¶é—´å¤§çº¦ä¸¤ä¸ªå°æ—¶\n        socket.setKeepAlive(true);\n        \n        /*\n          closeå…³é—­åçš„å¤„ç†\n          è¿™ä¸ªSocketé€‰é¡¹å¯ä»¥å½±å“closeæ–¹æ³•çš„è¡Œä¸ºã€‚\n          false 0 é»˜è®¤æƒ…å†µ å…³é—­åç«‹å³è¿”å›ï¼Œåº•å±‚ç³»ç»Ÿæ¥ç®¡è¾“å‡ºæµï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å‘é€å®Œæˆ\n          true 0 å…³é—­åç›´æ¥è¿”å› ç¼“å†²åŒºæ•°æ®ç›´æ¥æŠ›å¼ƒ ç›´æ¥å‘é€RESç»“æŸå‘½ä»¤åˆ°å¯¹æ–¹ï¼Œæ— éœ€ç»è¿‡2MSLç­‰å¾…\n          true 200 å…³é—­æ—¶æœ€é•¿é˜»å¡200s éšåæŒ‰ç¬¬äºŒæƒ…å†µå¤„ç†\n          (æ˜¯sä¸æ˜¯ms,å¼€å§‹æé”™äº† è®¾ç½®äº†20é‡å¯å°±ä¼šç«¯å£å ç”¨ã€‚ã€‚ã€‚ã€‚)\n        */\n        socket.setSoLinger(true, 0);\n       \n        /*\n        è®¾ç½®ç´§æ€¥æ•°æ®æ˜¯å¦å†…æ•›,å¦‚æœè¿™ä¸ªSocketé€‰é¡¹æ‰“å¼€ï¼Œ\n        å¯ä»¥é€šè¿‡Socketç±»çš„sendUrgentDataæ–¹æ³•\n        å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå•å­—èŠ‚çš„æ•°æ® è¿™ä¸ªå•å­—èŠ‚æ•°æ®å¹¶ä¸ç»è¿‡è¾“å‡ºç¼“å†²åŒºï¼Œè€Œæ˜¯ç«‹å³å‘å‡ºã€‚\n        è™½ç„¶åœ¨å®¢æˆ·ç«¯å¹¶ä¸æ˜¯ä½¿ç”¨OutputStreamå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œ\n        ä½†åœ¨æœåŠ¡ç«¯ç¨‹åºä¸­è¿™ä¸ªå•å­—èŠ‚çš„æ•°æ®æ˜¯å’Œå…¶å®ƒçš„æ™®é€šæ•°æ®æ··åœ¨ä¸€èµ·çš„\n        å› æ­¤ï¼Œåœ¨æœåŠ¡ç«¯ç¨‹åºä¸­å¹¶ä¸çŸ¥é“ç”±å®¢æˆ·\n        ç«¯å‘è¿‡æ¥çš„æ•°æ®æ˜¯ç”±OutputStream\n        è¿˜æ˜¯ç”±sendUrgentDataå‘è¿‡æ¥çš„\n        */\n        socket.setOOBInline(true);\n        //è®¾ç½®æ”¶å‘ç¼“å†²å™¨å¤§å°ï¼Œé»˜è®¤32K\n        socket.setReceiveBufferSize(64*1024);\n        socket.setSendBufferSize(64*1024);\n        //è®¾ç½®æ€§èƒ½å‚æ•°çš„ ä¼˜å…ˆçº§  çŸ­é“¾æ¥ å»¶è¿Ÿ å¸¦å®½\n        socket.setPerformancePreferences(1,1,1);\n    }\n    @SuppressWarnings(\"all\")\n    private static Socket creatSocket() throws IOException {\n        /*\n        //æ— ä»£ç†æ¨¡å¼, ç›¸å½“äºç©ºæ„é€ å‡½æ•°\n        Socket socket = new Socket(Proxy.NO_PROXY);\n        //HTTPä»£ç†æ¨¡å¼ä¼ è¾“çš„æ•°æ®å°†é€šè¿‡www.imlgw.topè½¬å‘\n        socket = new Socket(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(Inet4Address.getByName(\"www.imlgw.top\"), 80)));\n\n        //ä¸‹é¢ä¸¤ç§æ–¹å¼å›åœ¨åˆ›å»ºçš„æ—¶å€™å°±å»é“¾æ¥è¿œç¨‹çš„æœåŠ¡å™¨(å…·ä½“çœ‹æºç ),ç„¶è€Œä¸€èˆ¬æƒ…å†µä¸‹å…¶å®åœ¨è¿æ¥ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€äº›å‚æ•°\n        //æ–°å»ºä¸€ä¸ªå¥—æ¥å­— é“¾æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å’Œç«¯å£ï¼ˆæœ¬åœ°ç«¯å£ä¸ºç³»ç»Ÿåˆ†é…ï¼‰\n        socket = new Socket(\"imlgw.top\", REMOTE_PORT);\n        //æ–°å»ºå¥—æ¥å­—ç›´æ¥é“¾æ¥åˆ°è¿œç¨‹ç«¯å£ å¹¶ç»‘å®šæœ¬åœ°ç«¯å£\n        socket=new Socket(\"imlgw.top\",REMOTE_PORT,InetAddress.getLocalHost(),LOCAL_PORT);\n        */\n\n        //æ–°å»ºsocketç„¶åç»‘å®šåˆ°æœ¬åœ°ç«¯å£\n        Socket socket = new Socket();\n        return socket;\n    }\n\n\n    private static void sendMsg(Socket socket) throws IOException {\n        //é”®ç›˜çš„è¾“å…¥æµ\n        Scanner scanner = new Scanner(System.in);\n        //æ‹¿åˆ°socketçš„è¾“å‡ºæµ\n        OutputStream socketOutputStream = socket.getOutputStream();\n        //è½¬æ¢ä¸ºæ‰“å°æµ\n        PrintStream printStream = new PrintStream(socketOutputStream);\n        //socketçš„è¾“å…¥æµ\n        InputStream inputStream = socket.getInputStream();\n        //è½¬æ¢ä½bufferæµ\n        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));\n\n        boolean flag = true;\n        do {\n            //å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯\n            printStream.println(scanner.nextLine());\n            //æœåŠ¡ç«¯çš„å“åº”\n            String s = bufferedReader.readLine();\n            if (\"bye\".equals(s)) {\n                flag = false;\n            } else {\n                System.out.println(\"æœåŠ¡ç«¯å“åº”ï¼š\" + s);\n            }\n        } while (flag);\n        bufferedReader.close();\n        printStream.close();\n        scanner.close();\n    }\n}\n```\n\n**SocketæœåŠ¡ç«¯**\n\n è¿™é‡Œä¸ºäº†åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è®¾è®¡æˆäº†**å¤šçº¿ç¨‹**å¼‚æ­¥çš„æ¨¡å¼\n\n```java\npackage TcpDemo;\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.io.PrintStream;\nimport java.net.*;\n\n/**\n * @author imlgw.top\n * @date 2019/7/7 9:46\n */\npublic class Server {\n\n    private static final int SERVER_PORT = 20000;\n\n    public static void main(String[] args) throws IOException {\n        ServerSocket server = creatServerSocket();\n        initServerSocket(server);\n        //åˆå§‹åŒ–ä¹‹åå†ç»‘å®šï¼Œä¸ç„¶ä¸€äº›è®¾ç½®ä¼šå¤±æ•ˆï¼Œæ¯”å¦‚ setReuseAddress\n        server.bind(new InetSocketAddress(InetAddress.getLocalHost(), SERVER_PORT), 50);\n        System.out.println(\"æœåŠ¡å™¨å‡†å¤‡å°±ç»ª\");\n        System.out.println(\"æœåŠ¡ç«¯ä¿¡æ¯\" + server.getInetAddress() + \" port:\" + server.getLocalPort());\n        //ç›‘å¬å®¢æˆ·ç«¯çš„æ¶ˆæ¯\n        while (true) {\n            //é˜»å¡æ–¹æ³•\n            Socket client = server.accept();\n            ClientHandle clientHandle = new ClientHandle(client);\n            new Thread(clientHandle).start();\n        }\n    }\n\n    private static void initServerSocket(ServerSocket server) throws SocketException {\n        //åŒclient\n        server.setReuseAddress(true);\n        //è®¾ç½®acceptçš„buffer\n        server.setReceiveBufferSize(64 * 1024);\n        //è®¾ç½®timeout\n        //server.setSoTimeout(2000);\n        //è®¾ç½®æ€§èƒ½å‚æ•°,è¿æ¥å‰è®¾ç½®\n        server.setPerformancePreferences(1, 1, 1);\n    }\n\n    private static ServerSocket creatServerSocket() throws IOException {\n        ServerSocket server = new ServerSocket();\n        //ç»‘å®šç«¯å£ backlog:æ–°è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶,ä¸æ˜¯é“¾æ¥çš„æ•°é‡,æ˜¯å…è®¸ç­‰å¾…çš„é˜Ÿåˆ—é•¿åº¦\n        //server.bind(new InetSocketAddress(InetAddress.getLocalHost(),SERVER_PORT),50);\n        //server =new ServerSocket(SERVER_PORT,50); ç­‰æ•ˆæ–¹æ¡ˆ\n        //server =new ServerSocket(SERVER_PORT,50,InetAddress.getLocalHost());\n        return server;\n    }\n\n    private static class ClientHandle implements Runnable {\n        private Socket socket;\n\n        ClientHandle(Socket client) {\n            this.socket = client;\n        }\n\n        //æ¥æ”¶æ¶ˆæ¯\n        public void run() {\n            System.out.println(\"æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š\" + socket.getInetAddress() + \"portï¼š\" + socket.getPort());\n            try {\n                //è¾“å…¥æµè·å–ä¿¡æ¯\n                BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream()));\n                //è¾“å‡ºæµå“åº”å®¢æˆ·ç«¯\n                PrintStream printStream = new PrintStream(socket.getOutputStream());\n                boolean flag = true;\n                do {\n                    String s = reader.readLine();\n                    if (\"bye\".equalsIgnoreCase(s)) {\n                        flag = false;\n                        System.out.println(\"å®¢æˆ·ç«¯å…³é—­äº†è¿æ¥\");\n                        printStream.println(\"bye\");\n                    } else {\n                        System.out.println(s);\n                        printStream.println(\"å­—ç¬¦ä¸²é•¿åº¦#\" + s.length());\n                    }\n                } while (flag);\n                reader.close();\n                printStream.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            } finally {\n                try {\n                    socket.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n```\n\n> å…·ä½“çš„ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•è§£é‡Šéƒ½åœ¨ä»£ç çš„æ³¨é‡Šä¸­ [å‚è€ƒ](https://elf8848.iteye.com/blog/1739598)\n\n![mark](http://static.imlgw.top/image/20190707/eBKfzShaiIHU.png?imageslim)\n\n#### ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹\n\nä¸Šé¢çš„å“ªä¸ªå°æ¡ˆä¾‹ä¼ é€çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿè®¸æœ‰åŒå­¦ä¼šè¯´è¿™äº›åŸºæœ¬ç±»å‹ä¸éƒ½æ˜¯å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥ä¼ å—ï¼Ÿä¸ºä»€ä¹ˆè¦è´¹é‚£ä¸ªåŠ²å»ä¼ è¿™äº›åŸºæœ¬ç±»å‹ï¼Ÿå…¶å®ä¸ç„¶ï¼Œè¿™é‡Œå‡è®¾è¦ä¼ é€çš„æ˜¯ intç±»å‹çš„12345678 ï¼Œå¦‚æœé€šè¿‡ `int` æ¥ä¼ è¾“åªè¦åœ¨èŒƒå›´å†…éƒ½æ˜¯**4**ä¸ªå­—èŠ‚å¤§å°å›ºå®šï¼Œç„¶è€Œé€šè¿‡`String`ä¼ é€å°†ä¼šæ˜¯\"12345678\" ä¹Ÿå°±æ˜¯**8**ä¸ªå­—èŠ‚ï¼Œæ¶ˆè€—è¦æ¯”ä½¿ç”¨`int`è¦å¤§ï¼Œè€Œä¸”é•¿åº¦ä¸å›ºå®šï¼Œä¸æ–¹ä¾¿åæœŸæ¥å—çš„é•¿åº¦åˆ¤æ–­ã€‚\n\n **`int` ç±»å‹**  \n\nåœ¨ç½‘ç»œä¸Šä¼ è¾“çš„éƒ½æ˜¯ä»¥**Byte**ä¸ºåŸºæœ¬å•ä½ï¼Œå¦‚æœè¦ä¼ é€**int**æˆ‘ä»¬å°±éœ€è¦å°†**int**è½¬æ¢ä¸º**byte**ï¼Œä¸€ä¸ª**int**æ˜¯4ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª**byte[]**æ•°ç»„ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç \n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/11 13:23\n */\npublic class ByteTools {\n    public static byte[] int2byte(int a) {\n        //æ— ç¬¦å·å³ç§»\n        return new byte[]{\n                (byte) (a >>> 24),\n                (byte) (a >>> 16),\n                (byte) (a >>> 8),\n                (byte) (a)\n        };\n    }\n    public static int byte2int(byte[] a) {\n        //&0xff-->è½¬æ¢ä¸ºint å°†é«˜ä½è¡¥0,ä½8ä½ä¸å˜\n        //-127 ï¼š10000001(è¡¥) &0xff --> 00000000 00000000 00000000 10000001\n        return a[3] & 0xff | (a[2] & 0xff) << 8 | (a[1] & 0xff) << 16 | (a[0] & 0xff) << 24;\n    }\n}\n```\n\nä¸ºä»€ä¹ˆè¿™æ ·åšçš„ä¸€äº›ç»†èŠ‚å¯ä»¥å‚è€ƒ [è¿™ç¯‡åšå®¢](https://www.cnblogs.com/think-in-java/p/5527389.html)\n\næœ‰äº†è¿™ä¸ªå·¥å…·ç±»æˆ‘ä»¬å°±å¯ä»¥å°†**int**è½¬æ¢ä¸º**byte[]**åè¿›è¡Œä¼ è¾“ï¼ŒåŒæ—¶æ¥æ”¶ç«¯ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•å°†æ•°æ®è¿˜åŸã€‚\n\nç­‰ç­‰ğŸ™„ ï¼Œè¿™æ ·ä¸€æ¥ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹å¯¹åº”çš„éƒ½è¦å»å†™ä¸ªè¿™æ ·çš„è½¬æ¢çš„æ–¹æ³•ï¼Ÿé‚£è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œæ‰€ä»¥è¿™æ ·çš„äº‹æƒ…**JDK**å¸®æˆ‘ä»¬åšäº†\n\n**`ByteBuffer`**ï¼šnioä¸­çš„ä¸€ä¸ªåŒ…ï¼Œè¿™é‡Œæˆ‘è¿˜ä¸å¤ªç†Ÿæ‚‰è¿™ä¸ªå…·ä½“çš„ä½œç”¨ï¼Œç›®å‰åªçŸ¥é“å¯ä»¥ç”¨æ¥åŒ…è£…**byte[]**ï¼Œç„¶åå¯ä»¥å®ç°ä¸Šé¢çš„ç±»å‹è½¬æ¢\n\n**Clientå‘é€ç«¯**\n\n```java\nbyte[] buffer=new byte[256];\n//åŒ…è£…buffer (è£…é¥°å™¨æ¨¡å¼ï¼Ÿ\nByteBuffer byteBuffer = ByteBuffer.wrap(buffer);\n//byte  1\nbyteBuffer.put((byte) 126);\n//int ç±»å‹ 4\nbyteBuffer.putInt(123);\n//char 2(unicode)\nbyteBuffer.putChar('A');\n//long 8\nbyteBuffer.putLong(323333231234124321L);\nboolean isOk=true;\n//byte 1\nbyteBuffer.put((byte) (isOk?1:0));\n//float 4\nbyteBuffer.putFloat(123.2132F);\n//double 8 =28\nbyteBuffer.putDouble(231.1412421321);\n//String 10\nbyteBuffer.put(\"HelloWorld\".getBytes());\n//å‘é€ 38 Byte \nsocketOutputStream.write(buffer,0,byteBuffer.position());\n```\n\néœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯æœ€å**write**çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªå‚æ•°**len**ï¼Œç›´æ¥ä¼ **position()**,å°±å¯ä»¥äº†ï¼Œä¸ç”¨+1ï¼Œè¿™ä¸ªpositionæ˜¯ä¸‹ä¸€ä¸ªå­—èŠ‚ä½ç½®\n\n> è¿™é‡Œå…¶å®æˆ‘çœ‹çš„æ•™ç¨‹è¿™é‡Œæ˜¯åŠ 1äº†çš„ï¼Œæœ€åæ¥æ”¶è¿‡æ¥çš„æ•°æ®é•¿åº¦æ­»æ´»å¯¹ä¸ä¸Šï¼Œæˆ‘å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä»€ä¹ˆ**å†…å­˜å¯¹é½**ï¼Œä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„ç„¶åæ‰å‘ç°æ˜¯è¿™é‡Œæœ‰é—®é¢˜ã€‚ã€‚ã€‚\n\n**Serveræ¥æ”¶ç«¯**\n\nåŸºæœ¬ç±»å‹çš„è¯»å–ä¸ä¸Šé¢å¯¹åº”çš„**get**ï¼Œæœ€åä¸€ä¸ªStringéœ€è¦æ³¨æ„ï¼Œç›´æ¥ç”¨åŸå§‹çš„**buffer**å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å€ŸåŠ©**ByteBuffer**ï¼Œè¿™é‡ŒåŒæ ·åé¢ä¸ç”¨-1\n\n```java\nString str = new String(buffer, byteBuffer.position(), readByteCount-byteBuffer.position());\n```\n\n**æµ‹è¯•ç»“æœ**\n\n```java\næœåŠ¡å™¨å‡†å¤‡å°±ç»ª\næœåŠ¡ç«¯ä¿¡æ¯LAPTOP-V5R5ABUJ/192.168.25.1 port:20000\næ–°å®¢æˆ·ç«¯è¿æ¥ï¼š/192.168.25.1portï¼š30000\nå½“å‰ä¸‹æ ‡28\næ¥å—åˆ°Clientæ•°æ®é•¿åº¦(byte)ï¼š38\nClientå‘é€çš„æ•°æ®:\n126\n123\nA\n323333231234124321\ntrue\n123.2132\n231.1412421321\nHelloWorld\n```\n\n### UDP\n\nğŸ”¸  UDPæ˜¯æ— è¿æ¥çš„ï¼Œå³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚\n\nğŸ”¸  UDPä½¿ç”¨å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨ã€‚\n\nğŸ”¸   UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡ã€‚\n\nğŸ”¸   UDPæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ã€‚å¾ˆå¤šçš„å®æ—¶åº”ç”¨ï¼ˆå¦‚IPç”µè¯ã€å®æ—¶è§†é¢‘ä¼šè®®ç­‰ï¼‰è¦å»æºä¸»æœºä»¥æ’å®šçš„é€Ÿç‡å‘é€æ•°æ®ï¼Œå¹¶ä¸”å…è®¸åœ¨ç½‘ç»œå‘ç”Ÿæ‹¥å¡æ—¶ä¸¢å¤±ä¸€äº›æ•°æ®ï¼Œä½†å´ä¸å…è®¸æ•°æ®æœ‰å¤ªå¤šçš„æ—¶å»¶ã€‚UDPæ­£å¥½ç¬¦åˆè¿™ç§è¦æ±‚ã€‚\n\nğŸ”¸   UDPæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚\n\nğŸ”¸   UDPçš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ¯”TCPçš„20ä¸ªå­—èŠ‚çš„é¦–éƒ¨è¦çŸ­ã€‚\n\n#### å•æ’­\n\n**æ¶ˆæ¯æ¥æ”¶è€…**\n\n```java\nimport java.io.IOException;\nimport java.net.DatagramPacket;\nimport java.net.DatagramSocket;\nimport java.net.SocketAddress;\n/**\n * @author imlgw.top\n * @date 2019/7/7 21:31\n */\npublic class UDPProvide {\n    public static void main(String[] args) throws IOException {\n        //ç›‘å¬20000ç«¯å£\n        DatagramSocket socket=new DatagramSocket(20000);\n        System.out.println(\"UDPProvide is start....\");\n        final byte[] buf=new byte[512];\n        //æ„å»ºæ¥å—çš„DatagramPacket\n        DatagramPacket udp_receive=new DatagramPacket(buf,buf.length);\n        //æ„å»ºæ¥å—çš„DatagramPacket (é˜»å¡)\n        socket.receive(udp_receive);\n        //è·å–å‘é€äººçš„SocketAddress\n        SocketAddress socketAddress = udp_receive.getSocketAddress();\n        int datalen = udp_receive.getLength();\n        //è·å–å‘é€çš„æ•°æ®\n        String receive=new String(udp_receive.getData(),0,datalen);\n        System.out.println(\"receive from the: \"+socketAddress);\n        System.out.println(\"receive data: \"+ receive);\n        //æ„å»ºå“åº”çš„DatagramPacket\n        byte[] bytes = (\"provider receive the data success \"+datalen).getBytes();\n        DatagramPacket udp_sendBack=new DatagramPacket(bytes,bytes.length,socketAddress);\n        socket.send(udp_sendBack);\n        //ç»“æŸ\n        System.out.println(\"UDPProvide Finished.\");\n        socket.close();\n    }\n}\n```\n\n**æ¶ˆæ¯å‘é€è€…**\n\n```java\nimport java.io.IOException;\nimport java.net.DatagramPacket;\nimport java.net.DatagramSocket;\nimport java.net.InetAddress;\n/**\n * @author imlgw.top\n * @date 2019/7/7 21:31\n */\n\npublic class UDPSearch {\n    public static void main(String[] args) throws IOException {\n        System.out.println(\"UDPSearch is ready...\");\n        //æ„å»ºsocket\n        DatagramSocket socket = new DatagramSocket();\n        byte[] buff= \"hello world\".getBytes();\n        //æ„å»ºå‘é€æ®µ\n        DatagramPacket udp_send=new DatagramPacket(buff,buff.length);\n        //æŒ‡å®šå¯¹æ–¹ip\n        udp_send.setAddress(InetAddress.getLocalHost());\n        udp_send.setPort(20000);\n        socket.send(udp_send);\n        //è·å–å“åº”æ®µ\n        final byte[] buf=new byte[512];\n        DatagramPacket udp_receive=new DatagramPacket(buf,buf.length);\n        socket.receive(udp_receive);\n        String s = new String(udp_receive.getData(), 0, udp_receive.getLength());\n        System.out.println(s);\n        System.out.println(\"UDPSearch is over\");\n        socket.close();\n    }\n}\n```\n\n#### å¤šæ’­&å¹¿æ’­\n\n**æ¶ˆæ¯å»ºé€ å™¨**\n\n```java\n/**\n * @author imlgw.top\n * @date 2019/7/8 8:48\n */\npublic class MessageCreator {\n    private static final String SN_HEADER = \"æ”¶åˆ°æš—å·,æˆ‘æ˜¯SN:\";\n    private static final String PORT_HEADER = \"è¿™æ˜¯æš—å·,è¯·å›é€åˆ°è¯¥ç«¯å£:\";\n\n    public static String buildWithPort(int port) {\n        return PORT_HEADER + port;\n    }\n\n    public static int parsePort(String sn) {\n        if (sn.startsWith(PORT_HEADER)) {\n            return Integer.parseInt(sn.substring(PORT_HEADER.length()));\n        }\n        return  -1;\n    }\n\n    public static String buildWithSn(String sn){\n        return SN_HEADER+sn;\n    }\n\n    public static String parseSn(String sn){\n        if(sn.startsWith(SN_HEADER)){\n            return sn.substring(SN_HEADER.length());\n        }\n        return null;\n    }\n}\n```\n\n**æ¶ˆæ¯æ¥å—è€…**\n\n```java\npackage UdpDemo2;\nimport java.io.IOException;\nimport java.net.*;\nimport java.util.UUID;\n\n/**\n * @author imlgw.top\n * @date 2019/7/7 21:31\n */\npublic class UDPProvide {\n    public static int PROVIDE_LISTEN_PORT = 20000;\n\n    public static void main(String[] args) throws IOException {\n        String sn = UUID.randomUUID().toString();\n        Provider provider = new Provider(sn);\n        new Thread(provider).start();\n        System.in.read();\n        provider.shutdown();\n    }\n\n    public static class Provider implements Runnable {\n        public volatile boolean isDone = false;\n        public DatagramSocket socket = null;\n        public final String sn;\n\n        public Provider(String sn) {\n            this.sn = sn;\n        }\n\n        public void run() {\n            System.out.println(\"UDPProvide is start....\");\n            try {\n                socket = new DatagramSocket(PROVIDE_LISTEN_PORT);\n                while (!isDone) {\n                    final byte[] buf = new byte[512];\n                    //æ„å»ºæ¥å—çš„DatagramPacket\n                    DatagramPacket udp_receive = new DatagramPacket(buf, buf.length);\n                    //æ¥å—DatagramPacket (é˜»å¡)\n                    socket.receive(udp_receive);\n                    //è·å–å‘é€äººçš„SocketAddress\n                    InetSocketAddress socketAddress = (InetSocketAddress) udp_receive.getSocketAddress();\n                    int datalen = udp_receive.getLength();\n                    //è·å–å‘é€è¿‡æ¥çš„æ•°æ®\n                    String receive = new String(udp_receive.getData(), 0, datalen);\n                    //æ‰“å°è·å–åˆ°çš„æ•°æ®\n                    System.out.println(\"receive from the: \" + socketAddress);\n                    System.out.println(\"receive data: \" + receive);\n                    //è§£æsn,è·å–éœ€è¦å›é€çš„ç«¯å£\n                    int port = MessageCreator.parsePort(receive);\n                    if (port != -1) {\n                        //æ„å»ºå›é€çš„DatagramPacket\n                        byte[] responseBody = MessageCreator.buildWithSn(sn).getBytes();\n                        DatagramPacket udp_sendBack = new DatagramPacket(responseBody, 0, responseBody.length, socketAddress.getAddress(), port);\n                        socket.send(udp_sendBack);\n                    }\n                }\n            } catch (IOException e) {\n                // e.printStackTrace();\n            } finally {\n                closeRes();\n            }\n            //ç»“æŸ\n            System.out.println(\"UDPProvide Finished.\");\n        }\n\n        public void shutdown() {\n            isDone = true;\n            //è¿™é‡Œä»…ä»…isDone=true è¿œè¿œä¸å¤Ÿ,å› ä¸ºsocket.receiveæ˜¯ä¸€ä¸ªæ°¸ä¹…é˜»å¡çš„æ–¹æ³•\n            //æ‰€ä»¥ä¸‹é¢è¿˜è¦closeè¿™ä¸ªsocketè¿™æ ·å°±ä¼šæ•è·åˆ°ä¸€ä¸ªå¼‚å¸¸ç„¶åç»“æŸ\n            closeRes();\n        }\n\n        private void closeRes() {\n            if (socket != null) {\n                socket.close();\n                socket = null;\n            }\n        }\n    }\n}\n```\n\nä¸ä¸Šé¢ä¸åŒçš„æ˜¯è¿™é‡Œä¸ºäº†éšæ—¶å¯ä»¥åœæ­¢å°†å…¶æ„å»ºæˆäº†å¼‚æ­¥çº¿ç¨‹ï¼Œå½“æ¥å—åˆ°ç»ˆæ­¢ä¿¡å·çš„æ—¶å€™å°±ä¼šæ”¹å˜çŠ¶æ€é‡ï¼Œå¹¶closeèµ„æºï¼Œç„¶ååˆ©ç”¨å¼‚å¸¸åœæ­¢çº¿ç¨‹ã€‚\n\n**æ¶ˆæ¯å‘é€è€…**\n\n```java\npackage UdpDemo2;\n\nimport java.io.IOException;\nimport java.net.*;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.concurrent.CountDownLatch;\n\n/**\n * @author imlgw.top\n * @date 2019/7/7 21:31\n */\n\npublic class UDPSearch {\n    private static final int SEARCH_LISTEN_PORT = 30000;\n    private static DatagramSocket socket = null;\n    public static void main(String[] args) throws IOException, InterruptedException {\n        System.out.println(\"UDPSearch is start...\");\n        Listener listen = listen();\n        sendBoard();\n        System.in.read();\n        List<Device> devices = listen.closeAndGetDeviceList();\n        for (Device device : devices) {\n            System.out.println(device);\n        }\n    }\n\n    private static Listener listen() throws InterruptedException {\n        System.out.println(\"UDPSearch Listener is start\");\n        CountDownLatch countDownLatch=new CountDownLatch(1);\n        Listener listener=new Listener(SEARCH_LISTEN_PORT,countDownLatch);\n        new Thread(listener).start();\n        countDownLatch.await();\n        return listener;\n    }\n\n    public static void sendBoard() throws IOException {\n        //ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„ç«¯å£\n        DatagramSocket socket = new DatagramSocket();\n        //æ„å»ºsocket\n        byte[] buff = MessageCreator.buildWithPort(SEARCH_LISTEN_PORT).getBytes();\n        //æ„å»ºå‘é€æ®µ\n        DatagramPacket udp_send = new DatagramPacket(buff, buff.length);\n        //å¹¿æ’­åœ°å€\n        udp_send.setAddress(InetAddress.getByName(\"255.255.255.255\"));\n        //æ¥æ”¶æ–¹çš„ç«¯å£\n        udp_send.setPort(UDPProvide.PROVIDE_LISTEN_PORT);\n        socket.send(udp_send);\n        socket.close();\n        System.out.println(\"UDPSearch Board is over\");\n    }\n\n    private static class Device {\n        int port;\n        String ip;\n        String sn;\n\n        public Device(int port, String ip, String sn) {\n            this.port = port;\n            this.ip = ip;\n            this.sn = sn;\n        }\n        @Override\n        public String toString() {\n            return \"Device{\" +\n                    \"port=\" + port +\n                    \", ip='\" + ip + '\\'' +\n                    \", sn='\" + sn + '\\'' +\n                    '}';\n        }\n    }\n\n    public static class Listener implements Runnable {\n        private final int listenPort;\n        private final CountDownLatch countDownLatch;\n        private final List<Device> deviceList = new ArrayList<Device>();\n        //private static DatagramSocket socket = null;\n\n        private boolean isDone = false;\n\n        public Listener(int listenPort, CountDownLatch countDownLatch) {\n            this.listenPort = listenPort;\n            this.countDownLatch = countDownLatch;\n        }\n\n        public void run() {\n            //é€šçŸ¥å·²ç»å¯åŠ¨\n            countDownLatch.countDown();\n            try {\n                socket = new DatagramSocket(listenPort);\n                while (!isDone) {\n                    final byte[] buf = new byte[512];\n                    //æ„å»ºæ¥å—çš„DatagramPacket\n                    DatagramPacket udp_receive = new DatagramPacket(buf, buf.length);\n                    //æ¥å—DatagramPacket (é˜»å¡)\n                    socket.receive(udp_receive);\n                    //è·å–å‘é€äººçš„SocketAddress\n                    InetSocketAddress socketAddress = (InetSocketAddress) udp_receive.getSocketAddress();\n                    int datalen = udp_receive.getLength();\n                    //è·å–å‘é€è¿‡æ¥çš„æ•°æ®\n                    String sn = new String(udp_receive.getData(), 0, datalen);\n                    System.out.println(\"back from theï¼š\" + socketAddress);\n                    System.out.println(\"back dataï¼š\" + sn);\n                    sn=MessageCreator.parseSn(sn);\n                    if (sn != null) {\n                        deviceList.add(new Device(socketAddress.getPort(), socketAddress.getAddress().toString(), sn));\n                    }\n                }\n            } catch (IOException e) {\n               //e.printStackTrace();\n            } finally {\n                closeRes();\n            }\n            System.out.println(\"UDPSearch Listener is Finished...\");\n        }\n\n        public void closeRes() {\n            if (socket != null) {\n                socket.close();\n                socket = null;\n            }\n        }\n\n        List<Device> closeAndGetDeviceList() {\n            isDone = true;\n            closeRes();\n            return deviceList;\n        }\n    }\n}\n\n```\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯å¹¿æ’­çš„åœ°å€**255.255.255.255**\n\n> å¦‚æœæ˜¯åœ¨å±€åŸŸç½‘å†…å’Œå…¶ä»–æœºå™¨é€šä¿¡éœ€è¦å…³é—­è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œä¸ç„¶æ˜¯èµ°çš„è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œå…¶ä»–æœºå™¨æ¥æ”¶ä¸åˆ°ã€‚(æˆ‘è¯´æ€ä¹ˆå‘é€çš„**IP**ä¸æ˜¯æˆ‘çš„æœ¬æœºçš„**IP**)\n\nğŸ”¸UDPæ˜¯é¢å‘æ— è¿æ¥çš„é€šè®¯åè®®ï¼ŒåŸºäºç”¨æˆ·æ•°æ®æŠ¥çš„åè®®\n\nğŸ”¸UDPæ•°æ®åŒ…æ‹¬ç›®çš„ç«¯å£å·å’Œæºç«¯å£å·ä¿¡æ¯\n\nğŸ”¸é€šè®¯ä¸éœ€è¦è¿æ¥ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¹¿æ’­å‘é€ï¼Œå¹¶ä¸å±€é™äºç«¯åˆ°ç«¯\n\nğŸ”¸ç»“æ„ç®€å•ï¼Œæ— æ ¡éªŒï¼Œé€Ÿåº¦å¿«ï¼Œå®¹æ˜“ä¸¢åŒ…ï¼Œå¯å¹¿æ’­\n\nğŸ”¸ä»–ä¸€æ—¦æŠŠåº”ç”¨ç¨‹åºå‘ç»™ç½‘ç»œå±‚çš„æ•°æ®å‘é€å‡ºå»å°±ä¸ä¿ç•™æ•°æ®å¤‡ä»½\n\n### UDPè¾…åŠ©TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“\n\nå®¢æˆ·ç«¯å…ˆåˆ©ç”¨`UDP`å‘å±€åŸŸç½‘å‘é€å¹¿æ’­ï¼Œç„¶åå¯¹åº”çš„æœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åå°±ä¼šå°†å¯¹åº”çš„`TCP`çš„ç«¯å£å›é€ç»™å®¢æˆ·ç«¯ï¼Œç„¶åäºŒè€…è¿›è¡ŒTCPçš„åŒå‘é€šä¿¡ï¼Œä»£ç å¤ªå¤šè¿™é‡Œå°±åªæ”¾ä¸€ä¸‹`Server`ç«¯çš„`Handler`\n\n```java\npackage udp_tcp_concurrency.server.handle;\n\nimport udp_tcp_concurrency.utils.CloseUtils;\n\nimport java.io.*;\nimport java.net.Socket;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\n/**\n * ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„ç±»\n * @author imlgw.top\n * @date 2019/7/17 11:48\n */\npublic  class ClientHandler {\n\n    private final Socket socket;\n    private final ServerReadHandler serverReadHandler;\n    private final ServerWriterHandler serverWriterHandle;\n\n    private final CloseNotify closeNotify;\n\n    public ClientHandler(Socket socket, CloseNotify closeNotify) throws IOException {\n        this.socket = socket;\n        this.serverReadHandler = new ServerReadHandler(socket.getInputStream());\n        this.serverWriterHandle = new ServerWriterHandler(socket.getOutputStream());\n        this.closeNotify = closeNotify;\n        System.out.println(\"æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š\" + socket.getInetAddress() + \"portï¼š\" + socket.getPort());\n    }\n\n    public void send(String str) {\n        serverWriterHandle.send(str);\n    }\n\n    //ä»å¤–ç•Œå…³é—­\n    public void stop() {\n        serverReadHandler.stopRead();\n        serverWriterHandle.stopWriter();\n        CloseUtils.close(socket);\n        System.out.println(\"å®¢æˆ·ç«¯å·²ç»é€€å‡º\");\n        System.out.println(\"address:\" + socket.getInetAddress() + \",port:\" + socket.getPort());\n    }\n\n    //è‡ªæˆ‘å…³é—­--->è‡ªé—­\n    private void stopByMyself() {\n        stop();\n        closeNotify.onSelfClosed(this);\n    }\n\n    //è¯»å–å¹¶æ‰“å°åˆ°å±å¹•(å¯åŠ¨ClientReadHandleçº¿ç¨‹)\n    public void read2Print() {\n        new Thread(serverReadHandler).start();\n    }\n\n    /**\n     *  å°†å·²ç»å…³é—­çš„handleæš´éœ²ç»™TCPServerç„¶åä»listä¸­ç§»é™¤\n     */\n    public interface CloseNotify{\n        void onSelfClosed(ClientHandler clientHandler);\n    }\n\n    /**\n     * å¤„ç†æœåŠ¡ç«¯ç”¨äºè¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯çš„ Handle\n     */\n    class ServerReadHandler implements Runnable {\n        private boolean done = false;\n        private final InputStream inputStream;\n\n        public ServerReadHandler(InputStream inputStream) {\n            this.inputStream = inputStream;\n        }\n\n        public void run() {\n            try {\n                //è¾“å…¥æµè·å–ä¿¡æ¯\n                BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));\n                do {\n                    String s = reader.readLine();\n                    if (s == null) {\n                        System.out.println(\"å®¢æˆ·ç«¯å·²ç»æ— æ³•å‘é€æ•°æ®\");\n                        //ç»“æŸå½“å‰Handle\n                        ClientHandler.this.stopByMyself();\n                        break;\n                    }\n                    //æ‰“å°åˆ°å±å¹•\n                    System.out.println(s);\n                } while (!done);\n            } catch (IOException e) {\n                if (!done) {\n                    //éæ­£å¸¸å…³é—­\n                    System.err.println(\"è¿æ¥å¼‚å¸¸æ–­å¼€\"+e.getMessage());\n                    ClientHandler.this.stopByMyself();\n                }\n            } finally {\n                CloseUtils.close(inputStream);\n            }\n        }\n\n        public void stopRead() {\n            done = true;\n            CloseUtils.close(inputStream);\n        }\n    }\n\n    /**\n     * å¤„ç†æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„Handle\n     */\n    class ServerWriterHandler  {\n        private boolean done = false;\n        private final PrintStream printStream;\n        //çº¿ç¨‹æ± \n        private final ExecutorService executorService;\n\n        public ServerWriterHandler(OutputStream outputStream) {\n            this.printStream = new PrintStream(outputStream);\n            //å•ä¾‹çº¿ç¨‹æ± \n            executorService = Executors.newSingleThreadExecutor();\n        }\n\n        public void send(String str) {\n            //è¿™é‡Œå¦‚æœä¸ç”¨çº¿ç¨‹æ± \n            executorService.submit(new WriteRunnable(str));\n        }\n\n        //çº¿ç¨‹æ± çš„Runnable\n        class WriteRunnable implements Runnable {\n            private final String msg;\n\n            public WriteRunnable(String msg) {\n                this.msg = msg;\n            }\n\n            @Override\n            public void run() {\n                if(ServerWriterHandler.this.done){\n                    return;\n                }\n                try {\n                    ServerWriterHandler.this.printStream.println(msg);\n                }catch (Exception e){\n                    System.out.println(\"write å¼‚å¸¸é€€å‡ºï¼š\"+e.getMessage());\n                }\n            }\n        }\n        \n        public void stopWriter() {\n            done = true;\n            CloseUtils.close(printStream);\n            executorService.shutdownNow();\n        }\n    }\n}\n\n```\n\nå®Œæ•´ä»£ç æ”¾åœ¨ [github](https://github.com/imlgw/socketDemo) æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç”¨äº†ä¸€ä¸ªå•çº¿ç¨‹æ± å»å¤„ç†æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œè¿™é‡Œå…¶å®ç”¨çº¿ç¨‹é€šä¿¡æœºåˆ¶`wait/notify`ä¹Ÿå¯ä»¥åšåˆ°ä½†æ˜¯ç›¸æ¯”ä½¿ç”¨çº¿ç¨‹æ± ä¼šå¤æ‚è®¸å¤šã€‚\n\n### å±€åŸŸç½‘èŠå¤©å®¤å®ç°\n\n> è¿™é‡Œçš„èŠå¤©å®¤ï¼Œå…¶å®å…³é”®çš„åœ°æ–¹å°±åœ¨äºå¯¹å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯äº¤ç”±æœåŠ¡ç«¯è¿›è¡Œè½¬å‘ã€‚\n\nåŸºäºä¸Šé¢çš„è¿›è¡Œæ”¹é€ \n\n```java\n/**\n* å›è°ƒæ¥å£\n*/\npublic interface ClientHandleCallBack {\n    /**\n    * å°†å·²ç»å…³é—­çš„handleæš´éœ²ç»™TCPServerç„¶åä»listä¸­ç§»é™¤\n    */\n\tvoid onSelfClosed(ClientHandler clientHandler);\n\n\n    /**\n    * å°†æ¶ˆæ¯äº¤ç»™æœåŠ¡å™¨è½¬å‘\n    * @param clientHandler\n    * @param msg\n    */\n\tvoid onNewMessageArrived(ClientHandler clientHandler,String msg);\n}\n```\n\nå¢åŠ ä¸€ä¸ªæ¶ˆæ¯æŠµè¾¾çš„æ¥å£ï¼Œç„¶åä¸ºäº†é¿å…é˜»å¡äº¤ç»™å¼‚æ­¥çš„å•çº¿ç¨‹æ± å»å¤„ç†\n\n```java\n\t@Override\n    public void onNewMessageArrived(ClientHandler clientHandler, String msg) {\n        System.out.println(\"Receive from:\"+clientHandler.getClientInfo()+\" msg:\"+msg);\n        forwardThreadPool.submit(()->{\n            for (ClientHandler clientHandle : clientHandles) {\n                //è·³è¿‡è‡ªå·±\n                if(clientHandle.equals(clientHandler)){\n                    continue;\n                }\n                //å¯¹å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯\n                clientHandle.send(msg);\n            }\n        });\n    }\n```\n\nè¯¦ç»†ä»£ç  è§[Github](https://github.com/imlgw/socketDemo)\n\n","tags":["Socket"],"categories":["ç½‘ç»œç¼–ç¨‹"]},{"title":"JMeterå‹æµ‹","url":"/2019/06/06/jmeter-ya-ce-gong-ju/","content":"\n## JMeterå…¥é—¨\n\n[å®˜ç½‘åœ°å€](http://jmeter.apache.org/) ä¸‹è½½å¥½ä¹‹åç›´æ¥è¿è¡ŒjaråŒ… \n\n### ç®€å•ä¸Šæ‰‹\n\n**æ·»åŠ çº¿ç¨‹ç»„**\n\n![mark](http://static.imlgw.top/image/20190529/wBWwVD5chqtc.png?imageslim)\n\n**è®¾ç½®çº¿ç¨‹ä¸ªæ•°å’Œé…ç½®**\n\n![mark](http://static.imlgw.top/image/20190529/KonWE6pHVdMz.png?imageslim)\n\nRamp-Upå°±æ˜¯å¤šé•¿æ—¶é—´å†…å¯åŠ¨è¿™äº›çº¿ç¨‹è®¾ç½®ä½0å°±æ˜¯åŒæ—¶å¯åŠ¨ã€‚\n\n**è®¾ç½®HTTPè¯·æ±‚é»˜è®¤å€¼**\n\n![mark](http://static.imlgw.top/image/20190529/73A4su1jMAWM.png?imageslim)\n\nè®¾ç½®å¥½åå†æ·»åŠ å…·ä½“çš„è¯·æ±‚çš„æ—¶å€™å°±ä¸ç”¨å†å†™è¿™ä¸ªäº†\n\n![mark](http://static.imlgw.top/image/20190529/Uwy5zrWzFsji.png?imageslim)\n\n**æ·»åŠ HTTPè¯·æ±‚**\n\n![mark](http://static.imlgw.top/image/20190529/iVbmgkdG7D88.png?imageslim)\n\nè¿™é‡Œå¯¹æˆ‘ä»¬çš„ç§’æ€å•†å“åˆ—è¡¨è¿›è¡Œå‹æµ‹ã€‚\n\n**æ·»åŠ ç›‘å¬å™¨**\n\n![mark](http://static.imlgw.top/image/20190529/yVm6imNhWYKe.png?imageslim)\n\nè¿™é‡Œæ·»åŠ æ¯”è¾ƒå¸¸ç”¨çš„èšåˆæŠ¥å‘Šå°±å¯ä»¥äº†\n\n**ç»“æœ**\n\n![mark](http://static.imlgw.top/image/20190531/C3pwAwyh7BhG.png?imageslim)\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥éœ€è¦å…³æ³¨çš„å°±æ˜¯ååé‡è¿™ä¸ªå‚æ•°ï¼Œä¸€å¼€å§‹å¯èƒ½ä¼šä¸å¤ªå‡†å¤šæµ‹å‡ æ¬¡ã€‚\n\nåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨Linuxçš„`top`å‘½ä»¤æŸ¥çœ‹å½“å‰CPUçš„åˆ©ç”¨ç‡ã€‚\n\n### æ·»åŠ è‡ªå®šä¹‰å‚æ•°\n\n![mark](http://static.imlgw.top/image/20190601/VQ9adD8KBfvA.png?imageslim)\n\n![mark](http://static.imlgw.top/image/20190601/j1XB0mewqvJG.png?imageslim)\n\n```java\n17362363659,3d3ae96d381d4376b87cb7ebf14aadb6\n12012341234,fbb11e35f16b4a54be1315a0a1619193\n11012341234,58d63f1d9482472f907829da2ae3b4ff\n10012341234,09fe09587b924c49b6db64f763c1ad10\n```\n\n**æ•ˆæœ**\n\n![mark](http://static.imlgw.top/image/20190601/5up85aDbSTWM.png?imageslim)\n\n### ç”Ÿæˆtoken\n\næ–¹ä¾¿åé¢çš„å‹æµ‹ï¼Œå¯ä»¥ç›´æ¥å†™ä¸€ä¸ªå·¥å…·ç±»ç”Ÿæˆtokenä¾›åé¢çš„redisä½¿ç”¨\n\n```java\n@RunWith(SpringJUnit4ClassRunner.class)\n@SpringBootTest\npublic class TokenUtils {\n\n    @Autowired\n    private SpikeUserService spikeUserService;\n\n    static String str=\"0123456789\";\n\n    static  Random random = new Random();\n\n    static HttpServletResponse resp;\n\n    @Test\n    public  void test() throws IOException {\n        FileOutputStream outputStream=new FileOutputStream(new File(\"D:\\\\AliyunKey\\\\config.txt\"));\n        for (int i=0;i<20000;i++){\n            String phone = creatPhone();\n            RegisterVo registerVo = new RegisterVo(phone,\"123456\",\"user-\"+i);\n            spikeUserService.register(registerVo);\n            //éœ€è¦åœ¨serviceå±‚tokenè¿”å›å‡ºæ¥\n            String token= spikeUserService.login(resp, new LoginVo(registerVo.getMobile(), registerVo.getPassword()));\n            outputStream.write((phone+\",\"+token+\"\\n\").getBytes());\n        }\n    }\n\n    public  String creatPhone(){\n        String res=\"1\";\n        for (int i=0;i<10;i++){\n            res+=str.charAt(random.nextInt(10));\n        }\n        return res;\n    }\n}\n```\n\n### Rediså‹æµ‹\n\nâ‘ redis-benchmark -h 127.0.0.1 -p 6379 -c 100 -n 100000\n\n100ä¸ªå¹¶å‘ï¼Œåä¸‡ä¸ªè¯·æ±‚ï¼Œå¯¹å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤è¿›è¡Œæµ‹è¯•\n\n![mark](http://static.imlgw.top/image/20190601/oPkioXCFgL8R.png?imageslim)\n\nâ‘¡redis-benchmark -h 127.0.0.1 -p 6379 -q -d 100\n\n100 bytes payload \n\n-q æ˜¯quietè¾“å‡ºä¿¡æ¯è¾ƒå°‘\n\nâ‘¢ redis-benchmark -n 100000 -q script load \"redis.call('set','foo','bar')\"\n\nå¯¹ç‰¹å®šçš„è¯­å¥å‹æµ‹\n\n\n\n##  æ­å»ºå‹æµ‹ç¯å¢ƒ\n\n### å‘½ä»¤è¡Œå‹æµ‹\n\nå…¶å®è¿˜æ˜¯éœ€è¦å€ŸåŠ©å›¾å½¢ç•Œé¢æ¥å½•å¥½jmxæ–‡ä»¶ç„¶åä¸Šä¼ åˆ°Linuxä¸Šï¼Œç„¶åæ‰§è¡Œ\n\nsh jmeter.sh -n -t Xxx.jmx -l result.jtl\n\nç„¶åå†ç”¨å›¾å½¢ç•Œé¢å¯¼å…¥result.jtlå°±å¯ä»¥çœ‹åˆ°ç»“æœ\n\n> ä¸Šé¢çš„æµ‹è¯•éƒ½æ˜¯åœ¨æˆ‘çš„å¼€å‘æœº(win)ä¸Šè¿›è¡Œçš„ï¼Œå‹æµ‹å’ŒæœåŠ¡éƒ½åœ¨æœ¬åœ°ï¼Œç»“æœå¯èƒ½å¹¶ä¸å‡†ç¡®ï¼Œè¿™é‡Œä¸ºäº†éš”ç¦»ç¯å¢ƒæˆ‘å¼€äº†äº†2ä¸ªè™šæ‹Ÿæœºï¼Œä¸€ä¸ªæ˜¯éƒ¨ç½²æœåŠ¡çš„æœºå™¨ï¼ˆ2G 4æ ¸ï¼‰ï¼Œä¸€ä¸ªæ˜¯éƒ¨ç½²mysqlå’Œredisçš„æœºå™¨ï¼ˆ2G 4æ ¸ï¼‰ï¼Œè¿™é‡Œåœ¨Linuxä¸Šè¿è¡Œéƒ¨ç½²é¡¹ç›®æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æ‰“æˆwaråŒ…æ”¾åœ¨tomcatç›®å½•ä¸‹ï¼Œä¸€ç§æ˜¯æ‰“æˆjaråŒ…ç›´æ¥è¿è¡Œã€‚\n\n### ç¯å¢ƒ\n\nâœ” 192.168.25.123   Centos6  mysql+redis  2G4æ ¸\n\nâœ” 192.168.25.4     Centos7   SpikeServer+å‹æµ‹  2.5G 4æ ¸\n\nâœ”~~win10å¼€å‘æœº     Jmeterå‹æµ‹ SpikeServer~~ \n\nâœ”~~192.168.25.129 Centos7 å‹æµ‹è®¾å¤‡ 2G4æ ¸~~\n\n### SpringBootæ‰“waråŒ…\n\n**æ·»åŠ tomcatä¾èµ–(ç¼–è¯‘æ—¶ä¾èµ–)**\n\n```java\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-tomcat</artifactId>\n\t<scope>provided</scope>\n</dependency>\n```\n\n**æ·»åŠ ä¸€ä¸ªmavenæ’ä»¶**\n\n```java\n<plugin>\n    <groupId>org.apache.maven.plugins</groupId>\n    <artifactId>maven-war-plugin</artifactId>\n\t<configuration>\n    \t<failOnMissingWebXml>false</failOnMissingWebXml>\n\t</configuration>\n</plugin>\n```\n\n**ä¿®æ”¹pomæ‰“åŒ…æ–¹å¼ä½war**\n\n```java\n<packaging>war</packaging>\n```\n\n**bootç±»æ·»åŠ ä¸€ä¸ªæ–¹æ³•**\n\n```java\n@SpringBootApplication\npublic class SpikeApplication extends SpringBootServletInitializer {\n    public static void main(String[] args) {\n        SpringApplication.run(SpikeApplication.class, args);\n    }\n    /**\n     * @param builder\n     * @return æ‰“ waråŒ…\n     */\n    @Override\n    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {\n        return builder.sources(SpikeApplication.class);\n    }\n}\n```\n\nç„¶ååœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ`mvn clean package`å°±ä¼šåœ¨targetç›®å½•ä¸‹ç”ŸæˆwaråŒ…ï¼Œç„¶åå°†waråŒ…æ‹·åˆ°tomcaté‡Œé¢å°±å¯ä»¥ç›´æ¥è¿è¡Œäº†ã€‚\n\n### SpringBootæ‰“jaråŒ…\n\n**pomé‡Œçš„æ‰“åŒ…æ–¹å¼æ”¹ä¸ºjar(é»˜è®¤å°±æ˜¯jar)**\n\n```java\n<packaging>war</packaging>\n```\n\n**æ·»åŠ ä¸€ä¸ªmavenæ’ä»¶**\n\n```java\n<!--æ‰“jaråŒ…çš„æ’ä»¶-->\n<plugin>\n    <groupId>org.springframework.boot</groupId>\n\t<artifactId>spring-boot-maven-plugin</artifactId>\n</plugin>\n```\n\n**æ‰§è¡Œmvn clean package**\n\nåŒä¸Šä¼šåœ¨targetç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªjaråŒ…ï¼ŒjaråŒ…å†…å®¹å¤§è‡´å¦‚ä¸‹\n\n```java\nManifest-Version: 1.0\nImplementation-Title: Spike\nImplementation-Version: 1.0-SNAPSHOT\nBuilt-By: priva\nImplementation-Vendor-Id: top.imlgw\nSpring-Boot-Version: 2.1.2.RELEASE\nMain-Class: org.springframework.boot.loader.JarLauncher\nStart-Class: top.imlgw.spike.SpikeApplication\nSpring-Boot-Classes: BOOT-INF/classes/\nSpring-Boot-Lib: BOOT-INF/lib/\nCreated-By: Apache Maven 3.5.3\nBuild-Jdk: 1.8.0_172\nImplementation-URL: https://projects.spring.io/spring-boot/#/spring-bo\n ot-starter-parent/Spike\n```\n\nå¦‚æœç¡®å°‘ä¸€äº›ä¿¡æ¯æ¯”å¦‚Main-Classå’ŒStart-Classï¼Œè¯´æ˜jaråŒ…æ‰“çš„æœ‰é—®é¢˜ï¼Œè¿è¡Œä¼šæŠ¥`æ²¡æœ‰ä¸»æ¸…å•å±æ€§`ï¼Œæˆ‘ä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œæˆ‘çš„`plugins`ä¸Šå±‚è¿˜æœ‰ä¸ª`pluginmanagement`æ’ä»¶æ ¹æœ¬æ²¡åŠ è½½è¿›æ¥ï¼Œå»æ‰å°±è¡Œäº†ã€‚\n\n## å¼€å§‹å‹æµ‹\n\n### å‹æµ‹å•†å“åˆ—è¡¨é¡µé¢\n\n```java\n@RequestMapping(\"/to_list\")\npublic String tolist(Model model,SpikeUser spikeUser) {\n    List<GoodsVo> goodsVos = goodsService.goodsVoList();\n    model.addAttribute(\"user\", spikeUser);\n    model.addAttribute(\"goodsList\",goodsVos);\n\treturn \"goods_list\";\n}\n```\n\nè¿™ä¸ªæ¥å£ä¸»è¦å°±åšäº†ä¸€ä¸ªæŸ¥è¯¢çš„mysqlçš„æ“ä½œï¼Œæ²¡æœ‰cookieæ‰€ä»¥ä¸ä¼šå»æ“ä½œredis\n\n### é‡åˆ°çš„é—®é¢˜\n\nä¸€å¼€å§‹ç›´æ¥è®¾ç½®äº† 5000*10 çš„å¹¶å‘ï¼Œç„¶åæœåŠ¡ç«¯æŠ¥äº†   æ‰“å¼€æ–‡ä»¶è¿‡å¤šçš„é”™è¯¯\n\n```java\njava.io.IOException: æ‰“å¼€çš„æ–‡ä»¶è¿‡å¤š\n        at sun.nio.ch.ServerSocketChannelImpl.accept0(Native Method) ~[na:1.8.0_171]\n        at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422) ~[na:1.8.0_171]\n        at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250) ~[na:1.8.0_171]\n        at org.apache.tomcat.util.net.NioEndpoint.serverSocketAccept(NioEndpoint.java:448) ~[tomcat-embed-core-9.0.14.jar!/:9.0.14]\n        at org.apache.tomcat.util.net.NioEndpoint.serverSocketAccept(NioEndpoint.java:70) ~[tomcat-embed-core-9.0.14.jar!/:9.0.14]\n        at org.apache.tomcat.util.net.Acceptor.run(Acceptor.java:95) ~[tomcat-embed-core-9.0.14.jar!/:9.0.14]\n        at java.lang.Thread.run(Thread.java:748) [na:1.8.0_171]\n```\n\ngoogleåå‘ç°æ˜¯å¥æŸ„å¤ªå°‘çš„åŸå› ï¼ŒLinuxé»˜è®¤æ˜¯1024ï¼Œè€Œæˆ‘ä»¬åŒæ—¶èµ·äº†5000ä¸ªçº¿ç¨‹è‡ªç„¶å°±å‡ºé—®é¢˜äº†ã€‚\n\né€šè¿‡`ulimit -a` å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰çš„æœ€å¤§å¥æŸ„æ•°`open files` ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `ulimit -n 2048`ä¸´æ—¶çš„è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼Œä½†æ˜¯é‡å¯åå°±ä¼šå¤±æ•ˆã€‚\n\n```java\ncore file size          (blocks, -c) 0\ndata seg size           (kbytes, -d) unlimited\nscheduling priority             (-e) 0\nfile size               (blocks, -f) unlimited\npending signals                 (-i) 14707\nmax locked memory       (kbytes, -l) 64\nmax memory size         (kbytes, -m) unlimited\nopen files                      (-n) 1024\npipe size            (512 bytes, -p) 8\nPOSIX message queues     (bytes, -q) 819200\nreal-time priority              (-r) 0\nstack size              (kbytes, -s) 8192\ncpu time               (seconds, -t) unlimited\nmax user processes              (-u) 14707\nvirtual memory          (kbytes, -v) unlimited\nfile locks                      (-x) unlimited\n```\n\nè¿™é‡Œæœ€å¥½æ˜¯ç›´æ¥ä¿®æ”¹  /etc/security/limits.conf\n\n```java\n*  soft nofile  32768\n*  hard nofile 65536\n```\n\nå°±å¯ä»¥å°†æ–‡ä»¶å¥æŸ„é™åˆ¶ç»Ÿä¸€æ”¹æˆè½¯32768ï¼Œç¡¬65536ã€‚é…ç½®æ–‡ä»¶æœ€å‰é¢çš„æ˜¯æŒ‡domainï¼Œè®¾ç½®ä¸ºæ˜Ÿå·ä»£è¡¨å…¨å±€ï¼Œå¦å¤–ä½ ä¹Ÿå¯ä»¥é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·åšå‡ºä¸åŒçš„é™åˆ¶ã€‚\n\næ³¨æ„ï¼šè¿™ä¸ªå½“ä¸­çš„ç¡¬é™åˆ¶æ˜¯å®é™…çš„é™åˆ¶ï¼Œè€Œè½¯é™åˆ¶ï¼Œæ˜¯warnningé™åˆ¶ï¼Œåªä¼šåšå‡ºwarningï¼Œå…¶å®ulimitå‘½ä»¤æœ¬èº«å°±æœ‰åˆ†è½¯ç¡¬è®¾ç½®ï¼ŒåŠ -Hå°±æ˜¯ç¡¬ï¼ŒåŠ -Så°±æ˜¯è½¯\n\nä¿®æ”¹åè®°å¾—é‡å¯æ‰ä¼šç”Ÿæ•ˆ [å‚è€ƒèµ„æ–™](https://www.cnblogs.com/ibook360/archive/2012/05/11/2495405.html) \n\nä¸€å¼€å§‹æ˜¯æ‰“ç®—ç›´æ¥ç”¨winå¼€å‘æœºåšå‹æµ‹çš„ï¼Œä½†æ˜¯å‘ç°åœ¨è¿›ç¨‹å¼€å¤§äº†ä¹‹åè€æ˜¯è·‘ä¸å®Œï¼Œè·‘ä¸€åŠå°±åœäº†ï¼ˆå¯èƒ½æ˜¯å†…å­˜ç»™å°äº†ï¼‰ï¼Œè€Œä¸”æ•°æ®å‡ºå…¥ä¹Ÿæ¯”è¾ƒå¤§ï¼Œç„¶åæ”¹ç”¨ç§’æ€æœåŠ¡çš„é‚£æ¡æœºå™¨æ¥å‹æµ‹ï¼Œä¸€å¼€å§‹åªå¢å¤§äº†è·‘ç§’æ€æœåŠ¡çš„è™šæ‹Ÿæœºï¼Œå‘ç°è¿˜æ˜¯ä¼šæœ‰å¼‚å¸¸ï¼Œç„¶åæˆ‘æŠŠmysqlå’Œredisçš„è™šæ‹Ÿæœºä¹Ÿè°ƒå¤§äº†å°±æ²¡æŠ¥å¼‚å¸¸äº†ï¼Œä½†æ˜¯åœ¨å‹æµ‹çš„æ—¶å€™ç§’æ€æœåŠ¡çš„è™šæ‹Ÿæœºcpué£™åˆ°äº† `9.0+`ï¼Œ4æ ¸çš„æœºå­ï¼Œcpué£™åˆ°è¿™ä¹ˆé«˜å°±æœ‰ç‚¹é—®é¢˜äº†ä¸€èˆ¬æ¥è¯´åº”è¯¥ç»´æŒåœ¨ `4*0.7` å·¦å³ã€‚\n\n![mark](http://static.imlgw.top/image/20190604/LedMcRvfSXeb.png?imageslim)\n\n![mark](http://static.imlgw.top/image/20190604/UbcTCaTGiEJ9.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°å¹³å‡ç­‰å¾…æ—¶é—´éƒ½åœ¨2sä»¥ä¸Šã€‚\n\nä¸ºäº†æ›´å‡†ç¡®çš„æ¨¡æ‹Ÿï¼Œæˆ‘åˆå¼€äº†ä¸€å°~~1G2æ ¸~~ 2G4æ ¸çš„è™šæ‹Ÿæœºä¸“é—¨æ¥åšå‹æµ‹ï¼ˆ8Gå†…å­˜åƒä¸æ¶ˆäº†ï¼‰ã€‚\n\n![mark](http://static.imlgw.top/image/20190604/pr4yMAE2Jamf.png?imageslim)\n\nè¿™é‡Œç”¨topè§‚å¯Ÿäº†ä¸¤å°è™šæ‹Ÿæœºçš„æƒ…å†µå‘ç°mysqlçš„é‚£å°æœºå™¨è´Ÿè½½ä¸€ç›´å¾ˆä½ï¼ŒSpikeServeré‚£å°æœºå™¨ï¼ˆ1GåŒæ ¸ï¼‰è´Ÿè½½ä¸€è·¯é£™åˆ°6.0+ã€‚ååç‡ä¹Ÿæ˜æ˜¾çš„ä¸‹é™äº†ï¼Œè¿™é‡Œæˆ‘è¿ç»­æµ‹è¯•äº†ä¸¤æ¬¡éƒ½æ˜¯400å¤šã€‚\n\n### æœ€ç»ˆé…ç½®\n\nç»è¿‡ä¸€ä¸Šåˆçš„æŠ˜è…¾ï¼Œæˆ‘å†³å®šè¿˜æ˜¯å€¼åˆ©ç”¨ä¸¤å°ä½ è™šæ‹Ÿæœºï¼Œä¸€å°è·‘SpikeServerå’Œå‹æµ‹ï¼Œå¦å¤–ä¸€å°è·‘mysqlå’Œredisï¼Œå†å¯åŠ¨ä¸€å°æˆæœ¬å¤ªå¤§äº†ï¼Œè¿™é‡Œä¸»è¦æ ¹æ®è¿™ä¸ªåšä¸€ä¸ªæ ‡å‡†é‡ï¼ŒåæœŸä¼˜åŒ–åæ‹¿æ¥å¯¹æ¯”\n\n#### ç»“æœ\n\n![mark](http://static.imlgw.top/image/20190604/IEGxtWU8pujI.png?imageslim)\n\nåé¢åœ¨è°ƒæ•´æœºå™¨æˆ–è¿ç»­æµ‹è¯•äº†5ï¼Œ6æ¬¡ åœ¨5000çš„å¹¶å‘ä¸‹QPSå¤§æ¦‚æ˜¯1000å·¦å³çš„æ ·å­ï¼Œå°äº1000ã€‚\n\n### å‹æµ‹RedisæŸ¥è¯¢çš„æ€§èƒ½\n\nä¸Šé¢çš„goods_listå®é™…ä¸Šåªå¯¹mysqlè¿›è¡Œäº†ä¸€ä¸ªæŸ¥è¯¢æ“ä½œï¼Œè€Œmysqlçš„å¹¶å‘é‡å¹¶ä¸å¤§ã€‚\n\nä¸‹é¢æˆ‘ä»¬å•ç‹¬å¯¹redisåšä¸€ä¸‹å‹æµ‹ï¼Œçœ‹ä¸‹ç³»ç»Ÿçš„QPSï¼ˆè¿™é‡Œï¼‰\n\n![mark](http://static.imlgw.top/image/20190604/h2NOJszwC7Lo.png?imageslim)\n\n#### ç»“æœ\n\nä¸€å¼€æµ‹è¯•å¿˜äº†è°ƒå¤§redisé“¾æ¥æ± çš„å¤§å°ï¼Œä¸€ç›´è·‘ä¸å‡ºæ¥ï¼Œåæ¥æ”¹å¤§ä¹‹åæµ‹äº†4ï¼Œ5æ¬¡ï¼ŒåŒæ ·çš„5000å¹¶å‘10æ¬¡ï¼ŒQPSå¤§æ¦‚åœ¨3000å·¦å³\n\n![mark](http://static.imlgw.top/image/20190606/58L5ieKaxR7a.png?imageslim)\n\nå¯ä»¥è¯´æ˜¯ç›¸å½“å¿«äº†ï¼Œè€Œä¸”`top`è§‚å¯Ÿredisé‚£å°æœºå™¨å‘ç°è´Ÿè½½ä¾ç„¶å¾ˆä½ï¼Œè¯´æ˜è¿™ç‚¹å¹¶å‘ç¡®å®å¯¹redisæ¥è¯´æ˜¯å°æ„æ€ï¼Œå‰é¢å…¶å®ä¹Ÿå•ç‹¬å¯¹redisç”¨å®ƒè‡ªå¸¦çš„å‹æµ‹å·¥å…·æµ‹è¯•è¿‡ï¼Œå¤§æ¦‚æ¯ç§’10 0000çš„GETæ˜¯æ²¡é—®é¢˜çš„\n\n### é‡å¤´æˆâ€”å‹æµ‹do_spikeæ¥å£\n\n```java\n @RequestMapping(\"/do_spike\")\n public String do_spike(Model model, SpikeUser spikeUser, @RequestParam(\"goodsId\") long goodsId) {\n        if (spikeUser==null) { //æ²¡æœ‰ç™»å½•\n            return \"login\";\n        }\n        //æ£€æŸ¥åº“å­˜\n        GoodsVo goodsVo= goodsService.getGoodsVoByGoodsId(goodsId);\n        int stock=goodsVo.getStockCount(); //è¿™é‡Œæ‹¿çš„ç§’æ€å•†å“é‡Œé¢çš„åº“å­˜,ä¸æ˜¯å•†å“é‡Œé¢çš„åº“å­˜\n        if(stock<=0){\n            model.addAttribute(\"failMsg\",CodeMsg.STOCK_EMPTY);\n            return \"spike_fail\";\n        }\n        //çœ‹æ˜¯å¦é‡å¤ç§’æ€\n        SpikeOrder spikeOrder=spikeService.getGoodsVoByUserIdAndGoodsId(spikeUser.getId(), goodsId);\n        if(spikeOrder!=null){\n            model.addAttribute(\"failMsg\",CodeMsg.SKIPE_REPEAT);\n            return \"spike_fail\";\n        }\n        OrderInfo orderInfo=spikeService.doSpike(spikeUser.getId(),goodsVo);\n        model.addAttribute(\"orderInfo\",orderInfo);\n        model.addAttribute(\"goods\",goodsVo);\n        return \"order_detail\";\n }\n```\n\næ­¥éª¤éƒ½è·Ÿä¸Šé¢ä¸€æ ·ï¼Œä¸è¿‡è¦å¤šåŠ ä¸€ä¸ªå•†å“idçš„å‚æ•°ï¼Œè¿™é‡Œä¾ç„¶æ˜¯5000çš„å¹¶å‘10æ¬¡ï¼Œå…¶å®è¿™é‡Œæµ‹å‡ºæ¥çš„ç»“æœå’Œä¸Šé¢çš„å•†å“åˆ—è¡¨å·®ä¸å¤ªå¤šï¼Œå·®ä¸å¤š950å·¦å³QPSï¼Œæ¯•ç«Ÿè¿™é‡Œæœ‰åˆ¤æ–­åº“å­˜çš„æ“ä½œï¼Œä¸€æ—¦å°äº0ä¹‹åå°±ä¸ä¼šå¯¹mysqlå†è¿›è¡Œæ“ä½œï¼Œè¿›è¡Œå¤æ‚çš„**å‡åº“å­˜**å’Œ**ç”Ÿæˆè®¢å•**æ“ä½œ\n\n#### è¶…å–é—®é¢˜\n\næœ¬æ¥åªæœ‰10ä»¶å•†å“ï¼Œç¡¬ç”Ÿç”Ÿç»™å‡æˆäº†è´Ÿæ•°ğŸ˜‚\n\n![mark](http://static.imlgw.top/image/20190606/m5RhIzmdXRV1.png?imageslim)\n\nå¯ä»¥çœ‹åˆ°æœ‰16ä¸ªäººç§’æ€åˆ°äº†è¿™ä¸ªå•†å“è¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„\n\n![mark](http://static.imlgw.top/image/20190606/nJmnvKvVzAHt.png?imageslim)\n\nè¿™ä¸ªé—®é¢˜ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­æå‡ºè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸€ç¯‡ä¸»è¦ç†Ÿæ‚‰ä¸‹å‹æµ‹ã€‚","tags":["JMeter","ç§’æ€"],"categories":["Web"]},{"title":"WebMvcConfigurerå°ç»“","url":"/2019/05/20/webmvcconfigurer/","content":"\n## èµ·æº\n\nåˆ©ç”¨Redisåšåˆ†å¸ƒå¼sessionï¼Œå› ä¸ºæ²¡æœ‰å€ŸåŠ©Spring-sessionæˆ–è€…å…¶ä»–çš„sessionå…±äº«æ–¹æ¡ˆï¼Œæ‰‹åŠ¨å¤„ç†sessionçš„å­˜å–ï¼Œåœ¨æ§åˆ¶å±‚è·å–cookieä¸­çš„æ•°æ®æ˜¯è¾ƒä¸ºéº»çƒ¦ï¼Œæ‰€ä»¥å¸Œæœ›ç›´æ¥å°†cookieçš„æ•°æ®è½¬åŒ–ä¸ºéœ€è¦çš„beanç„¶åç»‘å®šåˆ°å‚æ•°ä¸­ï¼Œè¿™é‡Œå°±å¯ä»¥å€ŸåŠ©**WebMvcConfigurer**æ¥å®ç°è¿™ä¸ªéœ€æ±‚ç®€åŒ–ä»£ç \n\n## WebMvcConfigureræ˜¯å¹²å˜›çš„ï¼Ÿ\n\nSpringæŠŠå®ç°äº†WebMvcConfigureræ¥å£çš„beanéƒ½çœ‹ä½œä¸ºSpringMvcçš„**æ‰©å±•é…ç½®**ï¼Œå¦‚æœæ—¢æƒ³è¦ä½¿ç”¨SpringBootå¯¹SpringMvcçš„è‡ªåŠ¨é…ç½®ï¼Œåˆæƒ³è¦å¯¹è‡ªåŠ¨é…ç½®è¿›è¡Œæ‰©å±•ï¼Œæ·»åŠ ä¸€äº›ç”¨æˆ·è‡ªå·±çš„é…ç½®ï¼Œåƒæ‹¦æˆªå™¨ï¼Œæ¶ˆæ¯è½¬æ¢å™¨æˆ–è€…ä¸‹æ–‡ä¸­çš„å‚æ•°ç»‘å®šï¼Œåªéœ€è¦å†™ä¸€ä¸ªå®ç°äº†WebMvcConfigureræ¥å£çš„é…ç½®ç±»ï¼Œå®ç°ç›¸å…³æ–¹æ³•å°±èƒ½å¤Ÿæ·»åŠ è‡ªå·±çš„é…ç½®äº†ã€‚\n\n> SpringBoot2.0ä¹‹å‰ä¹Ÿå°±æ˜¯Spring5ä¹‹å‰å¯ä»¥ç›´æ¥ç»§æ‰¿**WebMvcConfigurationAdapter**+**@EnableWebMvc**æ³¨è§£æ¥å®ç°ä¸Šè¿°éœ€æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•åœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­å¼ƒç”¨äº†(è¿˜å¯ä»¥ç”¨ä½†æ˜¯ä¸å¤ªå¥½)ï¼Œå› ä¸ºjdk8ä¹‹åçš„æ¥å£ä¸­å¯ä»¥æœ‰**é»˜è®¤æ–¹æ³•**äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæŠ½è±¡ç±»å°±å¹¶æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†\n\n### WebMvcConfigurationSupport\n\nå…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯ç›´æ¥ç»§æ‰¿è¿™ä¸ªWebMvcConfigurationSupportï¼Œä¸Šé¢çš„WebMvcConfigureråªæ˜¯æ‰©å±•é…ç½®ï¼Œå¦‚æœç›´æ¥ç»§æ‰¿WebMvcConfigurationSupportï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡å†™é»˜è®¤çš„é…ç½®ï¼Œå¦‚æœå¯¹åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šçš„å¼€å‘è€…ä¸å°å¿ƒé‡å†™é”™äº†é»˜è®¤çš„é…ç½®ï¼Œspringmvcå¯èƒ½ç›¸å…³åŠŸèƒ½å°±æ— æ³•ç”Ÿæ•ˆã€‚\n\n## WebMvcConfigurerå†…çš„æ–¹æ³•\n\n```java\npublic interface WebMvcConfigurer {\n    default void configurePathMatch(PathMatchConfigurer configurer) {\n    }\n\n    default void configureContentNegotiation(ContentNegotiationConfigurer configurer) {\n    }\n\n    default void configureAsyncSupport(AsyncSupportConfigurer configurer) {\n    }\n\n    default void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {\n    }\n\n    default void addFormatters(FormatterRegistry registry) {\n    }\n\t\n    //æ·»åŠ æ‹¦æˆªå™¨\n    default void addInterceptors(InterceptorRegistry registry) {\n    }\n\t//æ·»åŠ èµ„æºå¤„ç†å™¨\n    default void addResourceHandlers(ResourceHandlerRegistry registry) {\n    }\n\n    default void addCorsMappings(CorsRegistry registry) {\n    }\n\t//è§†å›¾æ§åˆ¶å™¨\n    default void addViewControllers(ViewControllerRegistry registry) {\n    }\n\n    default void configureViewResolvers(ViewResolverRegistry registry) {\n    }\n\t//æ·»åŠ å‚æ•°è§£æå™¨\n    default void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {\n    }\n\n    default void addReturnValueHandlers(List<HandlerMethodReturnValueHandler> handlers) {\n    }\n\t//æ¶ˆæ¯è½¬æ¢å™¨\n    default void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n    }\n\n    default void extendMessageConverters(List<HttpMessageConverter<?>> converters) {\n    }\n\n    default void configureHandlerExceptionResolvers(List<HandlerExceptionResolver> resolvers) {\n    }\n\n    default void extendHandlerExceptionResolvers(List<HandlerExceptionResolver> resolvers) {\n    }\n\n    @Nullable\n    default Validator getValidator() {\n        return null;\n    }\n\n    @Nullable\n    default MessageCodesResolver getMessageCodesResolver() {\n        return null;\n    }\n}\n```\n\n## æ³¨æ„äº‹é¡¹\n\nåœ¨**SpringBoot**ä¸‹è‡ªå®šä¹‰çš„WebMvcConfigurerå®ç°é…ç½®ç±»ä¸Šæ˜¯ä¸éœ€è¦æ·»åŠ **@EnableWebMvc**çš„ï¼Œå› ä¸º**SpringBoot**å·²ç»å®ä¾‹åŒ–äº†WebMvcConfigurationSupportï¼Œå¦‚æœæ·»åŠ äº†è¯¥æ³¨è§£ï¼Œé»˜è®¤çš„WebMvcConfigurationSupporté…ç½®ç±»å°±ä¼šå¤±æ•ˆï¼Œmvcé»˜è®¤çš„é…ç½®ä¼šå¤±æ•ˆï¼Œä¹Ÿå°±æ˜¯ä»¥ç”¨æˆ·å®šä¹‰çš„ä¸ºä¸»ï¼Œä¸€èˆ¬å»ºè®®è¿˜æ˜¯ä¸è¦†ç›–é»˜è®¤çš„å¥½ã€‚\n\nè¿™ç‚¹å¯ä»¥ä»SpringBootçš„**WebMvcAutoConfiguration**ä¸­çœ‹åˆ°ã€‚ï¼ˆ@EnableWebMvcä¼šå¯¼å…¥ä¸€ä¸ªWebMvcConfigurationSupportçš„å­ç±»ï¼Œå« DelegatingWebMvcConfigurationï¼‰ã€‚\n\n![mark](http://static.imlgw.top///20190520/p5I6RuWHJPMy.png?imageslim)\n\nå½“æ²¡æœ‰WebMvcConfigurationSupportçš„æ—¶å€™è‡ªåŠ¨é…ç½®æ‰ä¼šç”Ÿæ•ˆ\n\n> [å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-auto-configuration)\n>\n> If you want to keep Spring Boot MVC features and you want to add additional [MVC configuration](https://docs.spring.io/spring/docs/5.0.4.RELEASE/spring-framework-reference/web.html#mvc) (interceptors, formatters, view controllers, and other features), you can add your own `@Configuration` class of type `WebMvcConfigurer` but **without** `@EnableWebMvc`. If you wish to provide custom instances of `RequestMappingHandlerMapping`, `RequestMappingHandlerAdapter`, or `ExceptionHandlerExceptionResolver`, you can declare a `WebMvcRegistrationsAdapter` instance to provide such components.\n\n## å®ä¾‹\n\n### Controllerå‚æ•°ç»‘å®š\n\nåœ¨SpringMVCé‡Œé¢å¯ä»¥è½»æ¾çš„æŠŠè¡¨å•çš„æ•°æ®æ˜ å°„åˆ°å¯¹åº”çš„beanä¸­ï¼Œä½†æ˜¯æœ‰æ—¶å€™è¿™å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚\n\n```java\n@RequestMapping(\"/to_list\")\npublic String tolist(HttpServletResponse response, Model model,\n                         @CookieValue(value = SpikeUserService.COOK1_NAME_TOKEN, required = false) String cookie,\n                         @RequestParam(value = SpikeUserService.COOK1_NAME_TOKEN, required = false) String param) {\n        /*æ‰‹æœºæµè§ˆå™¨ï¼Œæœ‰å¯èƒ½å°†cookieæ”¾åœ¨å‚æ•°ä¸­*/\n        if (param == null && cookie == null) {\n            return \"login\";\n        }\n        String cook = cookie != null ? cookie : param;\n        SpikeUser user = spikeUserService.getUserByToken(response, cook);\n        System.out.println(user);\n        model.addAttribute(\"user\", user);\n        return \"goods_list\";\n }\n```\n\nå¯ä»¥çœ‹åˆ°è¿™é‡Œä¸ºäº†è·å–è¿™ä¸ª**SpikeUser**å¯¹è±¡å¹¶ä¸èƒ½ç›´æ¥ä»è¡¨å•ä¸­è·å–ï¼Œéœ€è¦å€ŸåŠ©cookieç„¶åä»redisé‡Œé¢æŸ¥è¯¢ï¼Œå¦‚æœä¸‹é¢è¿˜æœ‰ä¸€äº›å…¶ä»–çš„controlleréœ€è¦è·å–è¿™ä¸ªå¯¹è±¡ï¼Œåˆè¦å†™å¾ˆå¤šé‡å¤çš„ä»£ç ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸Šé¢ä»‹ç»çš„WebMvcConfigureræ¥å®ç°ç®€åŒ–ä»£ç ã€‚\n\n####  é‡å†™addArgumentResolvers\n\n```java\n@Configuration\npublic class WebConfig implements WebMvcConfigurer {\n    \n    @Autowired //æ³¨å…¥æˆ‘ä»¬çš„å‚æ•°è§£æå™¨\n    SpikeUserArgumentResolver spikeUserArgumentResolver;\n\n    @Override\n    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> argumentResolvers) {\n        argumentResolvers.add(spikeUserArgumentResolver);\n    }\n}\n```\n\nè¿™é‡Œåªéœ€è¦å®ç°**addArgumentResolvers**å°±å¯ä»¥äº†ï¼Œæ³¨æ„åŠ ä¸Š**@Configuration**æ³¨è§£å°†WebConfigæ‰˜ä»˜ç»™Springï¼Œä½¿æˆ‘ä»¬æ·»åŠ çš„å‚æ•°è§£æå™¨ç”Ÿæ•ˆã€‚\n\n#### å®ç°HandlerMethodArgumentResolver\n\n```java\n@Service\npublic class SpikeUserArgumentResolver implements HandlerMethodArgumentResolver {\n\n    @Autowired\n    SpikeUserService userService;\n\n    public boolean supportsParameter(MethodParameter parameter) {\n        Class<?> clazz = parameter.getParameterType();\n        //å¤„ç†SpikeUserç±»å‹çš„\n        return clazz==SpikeUser.class;\n    }\n\n\n    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer,\n                                  NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {\n        HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);\n        HttpServletResponse response = webRequest.getNativeResponse(HttpServletResponse.class);\n\n        String paramToken = request.getParameter(SpikeUserService.COOK1_NAME_TOKEN);\n        String cookieToken = getCookieValue(request, SpikeUserService.COOK1_NAME_TOKEN);\n        if(StringUtils.isEmpty(cookieToken) && StringUtils.isEmpty(paramToken)) {\n            return null;\n        }\n        String token = StringUtils.isEmpty(paramToken)?cookieToken:paramToken;\n        return userService.getUserByToken(response,token);\n    }\n\n    private String getCookieValue(HttpServletRequest request, String cookiName) {\n        Cookie[]  cookies = request.getCookies();\n        for(Cookie cookie : cookies) {\n            if(cookie.getName().equals(cookiName)) {\n                return cookie.getValue();\n            }\n        }\n        return null;\n    }\n}\n```\n\nç„¶åå°±å¯ä»¥ç›´æ¥åœ¨åœ¨æ§åˆ¶å™¨ä¸­æ‹¿åˆ°SpikeUseräº†ï¼Œä»£ç å˜å¾—æ¸…çˆ½ç®€æ´\n\n```java\n\t@RequestMapping(\"/to_list\")\n    public String tolist(Model model,SpikeUser spikeUser) {\n        if (spikeUser==null) {\n            return \"login\";\n        }\n        model.addAttribute(\"user\", spikeUser);\n        return \"goods_list\";\n    }\n\n\t//æœªä¼˜åŒ–\n    @SuppressWarnings(\"all\")\n    @RequestMapping(\"/to_list0\")\n    @Deprecated\n    public String tolist0(HttpServletResponse response, Model model,\n                         @CookieValue(value = SpikeUserService.COOK1_NAME_TOKEN, required = false) String cookie,\n                         @RequestParam(value = SpikeUserService.COOK1_NAME_TOKEN, required = false) String param) {\n                            //æ‰‹æœºæµè§ˆå™¨ï¼Œæœ‰å¯èƒ½å°†cookieæ”¾åœ¨å‚æ•°ä¸­\n        System.out.println(\"cookie:\" +cookie);\n        System.out.println(\"param \" +param);\n        if (param == null && cookie == null) {\n            return \"login\";\n        }\n        String cook = cookie != null ? cookie : param;\n        SpikeUser user = spikeUserService.getUserByToken(response, cook);\n        System.out.println(user);\n        model.addAttribute(\"user\", user);\n        return \"goods_list\";\n    }\n\n```\n\nè¿™ä¹Ÿç®—æ˜¯å¯¹SpringMVCåŸç†çš„åˆæ¬¡æ¥è§¦å§ï¼Œåé¢å…³äºæ¡†æ¶è¿˜æ˜¯å¤šçœ‹æºç å•Šã€‚\n\nå…³äº**Spring-Session**çš„å†…å®¹åé¢ç”¨åˆ°å†æ¥ä»‹ç»ã€‚\n\n### æ‹¦æˆªå™¨\n\nä¾ç„¶æ˜¯SpringBoot2ï¼Œæ‰€ä»¥è¿˜æ˜¯å®ç°çš„**WebMvcConfigurer**æ¥å£\n\nå…ˆçœ‹ä¸‹æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹\n\n![æ¥è‡ªæ…•è¯¾](http://static.imlgw.top/image/20190609/vUv7FDoickvl.png?imageslim)\n\n#### è‡ªå®šä¹‰æ³¨è§£\n\n```java\npackage top.imlgw.spike.intercept;\n\nimport java.lang.annotation.*;\n\n/**\n * @author imlgw.top\n * @date 2019/6/9 15:13\n */\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface NeedLogin {\n    boolean needLogin() default true;\n}\n```\n\n#### é‡å†™HandlerInterceptor\n\n```java\npackage top.imlgw.spike.intercept;\n\nimport org.apache.commons.lang3.StringUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.method.HandlerMethod;\nimport org.springframework.web.servlet.HandlerInterceptor;\nimport top.imlgw.spike.entity.SpikeUser;\nimport top.imlgw.spike.service.SpikeUserService;\nimport top.imlgw.spike.utils.UserContext;\n\nimport javax.servlet.http.Cookie;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n/**\n * @author imlgw.top\n * @date 2019/6/8 23:22\n */\n@Component\npublic class LoginIntercept implements HandlerInterceptor {\n\n    @Autowired\n    SpikeUserService spikeUserService;\n\n    /**\n     * @param request\n     * @param response\n     * @param handler\n     * @return åœ¨ç™»é™†å‰æ‹¦æˆª\n     * @throws Exception\n     */\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        if(!(handler instanceof HandlerMethod)){\n            return true;\n        }\n        HandlerMethod hm=(HandlerMethod) handler;\n        SpikeUser spikeUser = getSpikeUser(request, response);\n        //æœ‰çš„é¡µé¢ä¸éœ€è¦ç™»é™†(äºŒæ¬¡ç™»é™†)ä½†æ˜¯éœ€è¦ç”¨æˆ·ä¿¡æ¯(è®¢å•é¡µé¢...)ï¼Œæ‰€ä»¥éœ€è¦å…ˆå­˜è¿›å»\n        UserContext.setUser(spikeUser);\n        //è·å–æ–¹æ³•ä¸Šçš„æ³¨è§£\n        NeedLogin needLogin = hm.getMethodAnnotation(NeedLogin.class);\n        if(needLogin==null || ! needLogin.needLogin()){\n            //æ²¡æœ‰æ³¨è§£åè€…æ³¨è§£ä¸ºfalse,å°±ç›´æ¥æ”¾è¿‡\n            return true;\n        }\n        //æœ‰æ³¨è§£ï¼Œæ²¡ç™»é™†\n        if(spikeUser==null){\n            return false;\n        }\n        return true;\n    }\n\n\n    /** è§†å›¾æ¸²æŸ“å®Œæ¯•åè°ƒç”¨(æ”¶å°¾å·¥ä½œ)\n     * @param request\n     * @param response\n     * @param handler\n     * @param ex\n     * @throws Exception\n     */\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        //åˆ é™¤ThreadLocalä¸­çš„Userå¦åˆ™ä¼šäº§ç”Ÿé”™ä¹±\n        UserContext.removeUser();\n    }\n\n\t\n    private SpikeUser getSpikeUser(HttpServletRequest request,HttpServletResponse response){\n        //æ‹¿å‚æ•°ä¸­çš„token\n        String paramToken = request.getParameter(SpikeUserService.COOK_NAME_TOKEN);\n        //æ‹¿cookieä¸­çš„token\n        String cookieToken = getCookieValue(request, SpikeUserService.COOK_NAME_TOKEN);\n        if(StringUtils.isEmpty(cookieToken) && StringUtils.isEmpty(paramToken)) {\n            //æ²¡ç™»é™†cookieä¸ºç©º\n            return null;\n        }\n        String token = StringUtils.isEmpty(paramToken)?cookieToken:paramToken;\n        SpikeUser user = spikeUserService.getUserByToken(response, token);\n        return user;\n    }\n\n\n    /*\n     * è·å–cookieä¸­çš„User\n     * */\n    private String getCookieValue(HttpServletRequest request, String cookieName) {\n        Cookie[]  cookies = request.getCookies();\n        if(cookies == null || cookies.length <= 0){\n            return null;\n        }\n        for(Cookie cookie : cookies) {\n            if(cookie.getName().equals(cookieName)) {\n                return cookie.getValue();\n            }\n        }\n        return null;\n    }\n}\n```\n\n#### WebConfigé‡Œé¢æ·»åŠ æ‹¦æˆªå™¨\n\n```java\npackage top.imlgw.spike.config;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.method.support.HandlerMethodArgumentResolver;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.ViewControllerRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\nimport top.imlgw.spike.intercept.LoginIntercept;\nimport java.util.List;\n\n@Configuration\npublic class WebConfig implements WebMvcConfigurer{\n\t//è‡ªåŠ¨è£…é…æˆ–è€… æ‰‹åŠ¨åˆ›å»ºbean,åŠ åˆ°Iocå®¹å™¨ä¸­ï¼Œå¦åˆ™å–ä¸åˆ°service\n    @Autowired\n    SpikeUserArgumentResolver spikeUserArgumentResolver;\n\n    @Autowired\n    LoginIntercept loginIntercept;\n\n    @Override\n    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> argumentResolvers) {\n        argumentResolvers.add(spikeUserArgumentResolver);\n    }\n    \n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(loginIntercept).addPathPatterns(\"/**\").\n            excludePathPatterns(\"/login/*\");\n    }\n}\n```\n\n### è§†å›¾è§£æå™¨\n\nä¸ç”¨ä¸ºäº†è·³è½¬é¡µé¢è€Œä¸“é—¨å†™ä¸€ä¸ª**controller**\n\n```java\n@Override\npublic void addViewControllers(ViewControllerRegistry registry) {\n    //è¿™é‡Œå¦‚æœæ˜¯ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œå°±åªèƒ½æ˜¯æ¨¡æ¿å¼•æ“templateé‡Œé¢çš„æ–‡ä»¶\n    //è¿™é‡Œåé¢é»˜è®¤æŒ‡çš„æ˜¯staticé‡Œé¢çš„æ–‡ä»¶ï¼Œåç¼€ä¸ºhtml\n    registry.addViewController(\"/\").setViewName(\"login\");\n    registry.addViewController(\"/goodslist\").setViewName(\"goods_list\");\n    registry.addViewController(\"/register\").setViewName(\"register\");\n}\n```\n\n> å…¶ä»–çš„ä»¥åç”¨åˆ°ä¼šç»§ç»­è¡¥å……\n\n","tags":["SpringMVC"],"categories":["Web"]},{"title":"æ•°æ®åº“å¤§ä½œä¸š","url":"/2019/05/20/shu-ju-ku-da-zuo-ye/","content":"\n## å‡†å¤‡å·¥ä½œ\n\n### ç¯å¢ƒ\n\n- JDK(å»ºè®®1.8ä»¥ä¸Š)\n- å¼€å‘å·¥å…·ï¼ŒEclipseæˆ–è€…idea ...\n- **mysql**æˆ–è€…**mssql**(æˆ‘æ˜¯ç”¨çš„**mysql5.7.17**ï¼Œç»™çš„demoæ˜¯mysqlçš„)\n\n### æµ‹è¯•ç»™çš„Demo \n\nâ‘ è£…å¥½mysqlä¹‹åå¯åŠ¨å®ƒï¼Œç„¶åç”¨ç®¡ç†å·¥å…·æˆ‘ç”¨çš„æ˜¯**navicat**ï¼Œæ‰“å¼€ç„¶åå°†ç»™çš„demoé‡Œé¢çš„sqlè„šæœ¬å¯¼å…¥è¿›å»(å¯¼å…¥ä¸å¥½çš„å¯ä»¥æ‰‹åŠ¨å»ºç«‹ä¸€ä¸ªï¼Œç”¨è„šæœ¬æ–‡ä»¶å¯¼å…¥åçš„åå­—æ˜¯tb_demoï¼Œæˆ‘è¿™é‡Œæ˜¯æ‰‹åŠ¨å»ºçš„)\n\n<video controls=\"controls\" src=\"http://static.imlgw.top/image/20190530/M2IOTaKdyaQO.mp4\" width=\"100%\"></video>\n\n\n\n\n\n![mark](http://static.imlgw.top/image/20190524/oNHeEFJhHEYX.png?imageslim)\n\n\n\næœ€åå·®ä¸å¤šæ˜¯è¿™æ ·çš„ç»“æ„\n\nâ‘¡åœ¨**Eclipse**é‡Œé¢**import**é¡¹ç›®ï¼Œè¿™é‡Œæˆ‘**import**ä¼šæœ‰ä¸ªæ„Ÿå¹å·ï¼Œ**æœ€å¥½é‡æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä¸ç„¶å¯èƒ½ä¼šæœ‰å¥‡æ€ªçš„é”™è¯¯**ä¸‹é¢æ˜¯**å¦‚ä½•æ–°å»ºçš„æ­¥éª¤è§†é¢‘**\n\n<video controls=\"controls\" src=\"http://static.imlgw.top/f0xim-iyaow.mp4\" width=\"100%\"></video>\n\nè¿™é‡Œè¦æ”¹çš„åœ°æ–¹å°±æ˜¯DbUtilé‡Œé¢æ•°æ®åº“é…ç½®\n\n```java\npublic class DbUtil {\n\t//com.microsoft.sqlserver.jdbc.SQLServerDriver\n    //æ•°æ®åº“é©±åŠ¨çš„åå­—ï¼ˆ1.6è¿˜æ˜¯1.8ä¹‹åå°±ä¸éœ€è¦äº†ï¼Œè¿™é‡Œè¿˜æ˜¯åŠ ä¸Šå§ï¼‰\n\tString driverName = \"com.mysql.jdbc.Driver\";\n\t//jdbc:sqlserver://127.0.0.1:1433;DatabaseName=demo\n    //è¿æ¥æ•°æ®åº“çš„åœ°å€ï¼Œå‰é¢çš„ä¸ç”¨æ”¹ï¼Œè¿™é‡Œè¦æ”¹çš„å°±æ˜¯åé¢çš„ demo æ¢æˆä½ çš„æ•°æ®åº“åå­—ï¼ˆæˆ‘ä¸Šé¢çš„æ˜¯demoï¼‰\n\tString dbURL = \"jdbc:mysql://localhost:3306/demo\";\n    //ä½ çš„æ•°æ®åº“çš„å¸å·\n\tString userName = \"root\";\n    //è£…mysqlæ—¶è®¾ç½®çš„å¯†ç \n\tString userPwd = \"admin\"; \n\n\tpublic Connection getCon() throws ClassNotFoundException, SQLException {\n\t\tClass.forName(driverName);\n\t\tConnection conn = DriverManager.getConnection(dbURL, userName, userPwd);\n\t\treturn conn;\n\t}\n\n\tpublic void closeCon(Connection conn) throws SQLException {\n\t\tif (conn != null)\n\t\t\tconn.close();\n\t}\n\n\tpublic static void main(String[] args) {\n\t\tDbUtil dbUtil = new DbUtil();\n\t\ttry {\n\t\t\tdbUtil.getCon();\n\t\t\tSystem.out.println(\"è¿æ¥æˆåŠŸ\");\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n}\n```\n\n#### æ³¨æ„äº‹é¡¹\n\n```java\n\t//com.microsoft.sqlserver.jdbc.SQLServerDriver\n    //æ•°æ®åº“é©±åŠ¨çš„åå­—ï¼ˆ1.6è¿˜æ˜¯1.8ä¹‹åå°±ä¸éœ€è¦äº†ï¼Œè¿™é‡Œè¿˜æ˜¯åŠ ä¸Šå§ï¼‰\n\tString driverName = \"com.mysql.jdbc.Driver\";\n\t//jdbc:sqlserver://127.0.0.1:1433;DatabaseName=demo\n    //è¿æ¥æ•°æ®åº“çš„åœ°å€ï¼Œè¿™é‡Œè¦æ”¹çš„å°±æ˜¯åé¢çš„ demo æ¢æˆä½ çš„æ•°æ®åº“åå­—ï¼ˆæˆ‘ä¸Šé¢çš„æ˜¯demoï¼‰\n\tString dbURL = \"jdbc:mysql://localhost:3306/demo\";\n    //ä½ çš„æ•°æ®åº“çš„å¸å·\n\tString userName = \"root\";\n    //å¯†ç \n\tString userPwd = \"admin\"; \n```\n\nè¦æ”¹çš„å·®ä¸å¤šå°±æ˜¯è¿™4ä¸ªé…ç½®\n\nâ‘ å¦‚æœæ˜¯**mysql**å¹¶ä¸”ç‰ˆæœ¬æ˜¯8ä»¥ä¸‹çš„ï¼Œé‚£ä¹ˆ**driverName** å¯ä»¥ä¸ç”¨æ”¹ï¼Œå¦‚æœæ˜¯8ä»¥ä¸Šçš„ï¼ˆç¾¤é‡Œé¢é‚£ä¸ªæ˜¯8ä»¥ä¸Šçš„ï¼‰å°±éœ€è¦æ”¹æˆ\n\n**com.mysql.cj.jdbc.Driver**ï¼Œå¹¶ä¸”**æ‰¾åˆ°é€‚åˆç‰ˆæœ¬çš„é©±åŠ¨æ‹·è´åˆ°libç›®å½•ç„¶åå³é”®bulidpath**ï¼ˆåœ¨è¿™ä¹‹å‰å…ˆå°†è€çš„é©±åŠ¨åˆ æ‰ï¼Œbulidpathçš„ä½œç”¨æ˜¯å°†jaråŒ…**çœŸæ­£çš„**åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­å»ï¼‰\n\n- 8 ä»¥ä¸Š é©±åŠ¨ä¸‹è½½åœ°å€ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1WXjAAHX5gQC6v5pfiTOqmQ  æå–ç ï¼š5lf5 \n\n- sqlServeréœ€è¦æ”¹çš„åœ°æ–¹æˆ‘ä¹Ÿæ³¨é‡Šåœ¨ä¸Šé¢ä½†æ˜¯æˆ‘ç”µè„‘ä¸Šæ²¡sqlserveræˆ‘æ²¡æœ‰æµ‹è¯•ï¼Œè€å¸ˆç»™çš„åŒ…é‡Œé¢æœ‰sqlserverçš„é©±åŠ¨\n\nâ‘¡**dbURL**ï¼Œå‰é¢çš„ä¸ç”¨æ”¹ï¼Œè¿™é‡Œåªéœ€è¦æ”¹ä¸€ä¸‹åé¢çš„æ•°æ®åº“åå­—ï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢å»ºçš„æ•°æ®åº“åå­—æ˜¯**demo**,åé¢å°±åº”è¯¥æ˜¯**/demo**ï¼ˆå¦‚æœç”¨è„šæœ¬ç›´æ¥å¯¼å…¥ç”Ÿæˆçš„æ•°æ®åº“åå­—æ˜¯db_demoï¼Œè¿™é‡Œå°±è¦æ”¹æˆjdbc:mysql://localhost:3306/db_demo\n\n- å¯¹åº”sqlserverçš„æˆ‘ä¹Ÿæ”¾åœ¨ä¸Šé¢ä½†æ˜¯æˆ‘æ²¡è£…sqlserveræ‰€ä»¥æ²¡æµ‹è¯•ã€‚\n\nâ‘¢**userName**ï¼Œæ•°æ®åº“è´¦å·ï¼ˆä¸€èˆ¬é»˜è®¤å°±æ˜¯rootï¼‰\n\nâ‘£**password**ï¼Œæ•°æ®åº“å¯†ç \n\n### å¯åŠ¨\n\nåœ¨viewåŒ…ä¸‹çš„**MainPage**ï¼Œè¿™æ˜¯ç”¨javaçš„swingç»„ä»¶å¼€å‘çš„ä¸€ä¸ªGUIé¡µé¢ï¼Œæœ€ä¸‹é¢æœ‰ä¸€ä¸ªmainå‡½æ•°ç›´æ¥å¯åŠ¨å®ƒå°±è¡Œï¼Œï¼ˆå¦‚æœæœ‰ä¹±ç ï¼Œéœ€è¦å°†eclipesçš„å·¥ä½œç©ºé—´çš„ç¼–ç æ–¹å¼æ¢ä¸º**utf-8**ï¼‰ï¼Œåˆ°æ­¤ç¯å¢ƒå°±åŸºæœ¬okäº†ï¼Œåé¢çš„å°±æ˜¯å†™ä»£ç çš„äº‹äº†ã€‚\n\n### æ”¹ç”¨è‡ªå·±çš„æ•°æ®åº“\n\n> åé¢çš„éƒ¨åˆ†ä¸»è¦æ˜¯ä»£ç çš„é—®é¢˜äº†ï¼Œæ¯ä¸ªäººæ•°æ®åº“ä¸åŒä¹Ÿä¼šæœ‰ä¸€äº›å·®è·\n\n- å¯¼å…¥è‡ªå·±çš„æ•°æ®\n\n  æ•°æ®åº“åå­—ï¼Œå­—æ®µåä¸è¦ç”¨ä¸­æ–‡ï¼\n\n  æ•°æ®åº“åå­—ï¼Œå­—æ®µåä¸è¦ç”¨ä¸­æ–‡ ï¼\n\n  æ•°æ®åº“åå­—ï¼Œå­—æ®µåä¸è¦ç”¨ä¸­æ–‡ï¼\n\n- å®ä½“ç±»æ”¹æˆè‡ªå·±çš„\n\n```java\nimport java.util.Date;\n\npublic class StuInfo {\n\n\tprivate Long stuId;\n\tprivate String stuName;\n\tprivate String stuSex;\n\tprivate Date stuDob;\n\tprivate String stuMajor;\n\t\n\tpublic Long getStuId() {\n\t\treturn stuId;\n\t}\n\n\tpublic void setStuId(Long stuId) {\n\t\tthis.stuId = stuId;\n\t}\n\n\tpublic String getStuName() {\n\t\treturn stuName;\n\t}\n\n\tpublic void setStuName(String stuName) {\n\t\tthis.stuName = stuName;\n\t}\n\n\tpublic String getStuSex() {\n\t\treturn stuSex;\n\t}\n\n\tpublic void setStuSex(String stuSex) {\n\t\tthis.stuSex = stuSex;\n\t}\n\n\tpublic Date getStuDob() {\n\t\treturn stuDob;\n\t}\n\n\tpublic void setStuDob(Date stuDob) {\n\t\tthis.stuDob = stuDob;\n\t}\n\n\tpublic String getStuMajor() {\n\t\treturn stuMajor;\n\t}\n\n\tpublic void setStuMajor(String stuMajor) {\n\t\tthis.stuMajor = stuMajor;\n\t}\n\t\n\tpublic StuInfo() {\n\n\t}\n\n\tpublic StuInfo(String stuName, String stuSex, Date stuDob, String stuMajor) {\n\t\tthis.stuName = stuName;\n\t\tthis.stuSex = stuSex;\n\t\tthis.stuDob = stuDob;\n\t\tthis.stuMajor = stuMajor;\n\t}\n}\n```\n\nè¿™é‡Œå®ä½“ç±»æ˜¯å’Œæ•°æ®åº“çš„è¡¨å’Œå­—æ®µå¯¹åº”çš„ï¼Œä¸€ä¸ªStuInfoå¯¹è±¡å°±å¯¹åº”ä¸€æ¡æ•°æ®ã€‚\n\n- å¢åˆ æ”¹æŸ¥çš„ä¿®æ”¹\n\n```java\n\npublic class UserDao {\n\tpublic ResultSet getUsers(User user, Connection con) throws SQLException {\n\t\tStringBuffer sql = new StringBuffer(\"select * from t_user \");\n\t\tif (user.getUserName()!= null) {\n\t\t\tsql.append(\" where userName like '%\"+user.getUserName()+\"%'\");\n\t\t}\n\t\tPreparedStatement ps = con.prepareStatement(sql.toString());\n\t\treturn ps.executeQuery();\n\t}\n\t\n\tpublic int delete(User user, Connection con) throws SQLException{\n\t\tString sql=\"delete from t_user where userName='\"+user.getUserName()+\"'\";\n\t\tPreparedStatement ps = con.prepareStatement(sql);\n\t\treturn ps.executeUpdate();\n\t}\n\t\n\tpublic int add(User user, Connection con) throws SQLException{\n\t\tString sql=\"insert into t_user  values(?,?)\";\n\t\tPreparedStatement ps = con.prepareStatement(sql);\n\t\tps.setString(1, user.getUserName());\n\t\tps.setString(2, user.getTel());\n\t\treturn ps.executeUpdate();\n\t}\n\t\n\tpublic int modify(User user, Connection con) throws SQLException{\n\t\tString sql=\"update t_user  set userName=?, tel=? where userName = '\"+user.getUserName()+\"'\";\n\t\tPreparedStatement ps = con.prepareStatement(sql);\n\t\tps.setString(1, user.getUserName());\n\t\tps.setString(2, user.getTel());\n\t\tSystem.out.println(sql);\n\t\treturn ps.executeUpdate();\n\t}\n}\n\n```\n\næœ€ç»ˆéƒ½æ˜¯é€šè¿‡è°ƒç”¨è¿™ä¸ªDaoç±»å®ç°çš„å¢åˆ æ”¹æŸ¥ã€‚\n\n- é¡µé¢çš„ä¿®æ”¹\n\næŒ‰ç…§è€å¸ˆçš„è¦æ±‚æ˜¯å¯¹æˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®åº“åšå¢åˆ æ”¹æŸ¥ï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ•°æ®åº“å’Œç»™çš„demoçš„è¡¨ç»“æ„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹MainPageï¼Œè¿™ä¸ªæ˜¯ç”¨javaçš„swingå†™çš„ä¸€ä¸ªGUIï¼Œæ‰€ä»¥éœ€è¦æ”¹è¿™äº›ç•Œé¢ä¸Šçš„ä¸€äº›å…ƒç´ ï¼Œæˆ‘è®°çš„å¥½åƒæœ‰ä¸ªæ’ä»¶å¯ä»¥ç›´æ¥æ‹–åŠ¨ç”Ÿæˆswingè¿™äº›ç•Œé¢çš„(çœ‹è§åˆ˜å‹‡ç”¨è¿‡)ï¼Œæˆ‘å¯¹swingä¸ç†Ÿæ‚‰ï¼ˆæ—©å°±è¿‡æ—¶äº†ï¼Œæ²¡æœ‰å­¦çš„æ„ä¹‰ï¼‰ï¼Œæˆ‘ç”¨webå†™çš„ç•Œé¢\n\n![mark](http://static.imlgw.top/image/20190530/96gB7wwVz4Xj.png?imageslim)\n\n### Mysql\n\n[Mysql5.7è§£å‹ç‰ˆçš„å®‰è£…å’Œå¸è½½åŠå¸¸è§é—®é¢˜](https://blog.csdn.net/mr_green1024/article/details/53222526?tdsourcetag=s_pcqq_aiomsg)\n\n","tags":["å·¥å…·"],"categories":["å·¥å…·"]},{"title":"JSR303-å‚æ•°æ£€éªŒ","url":"/2019/05/13/jsr303-can-shu-xiao-yan/","content":"\n## JSR303\n\nç›®å‰æœ€æ–°çš„è§„èŒƒå·²ç»æ˜¯JSR380äº†ï¼Œä¹Ÿå°±æ˜¯Bean Validation 2.0.\n\n![mark](http://static.imlgw.top///20190513/qa5DNu5Nsq26.png?imageslim)\n\n\n\nå‚æ•°æ ¡éªŒæ˜¯ä¸€ä¸ªæˆç†Ÿçš„ç½‘ç«™å¿…é¡»çš„åŠŸèƒ½ï¼Œç„¶è€Œæœ‰çš„æ—¶å€™ä¸ºäº†æ ¡éªŒå‚æ•°ä¹Ÿè¦è´¹å¥½å¤§çš„åŠ²ï¼Œå…ä¸äº†å†™å¾ˆå¤šif-elseï¼Œä¸€ç‚¹ä¹Ÿä¸ä¼˜é›…ã€‚\n\n## ä¸Šæ‰‹\n\n### å¼•å…¥ä¾èµ–\n\n```java\n <!--SpringBootWeb è¿™ä¸ªåŒ…é‡Œé¢è‡ªå¸¦äº†hibernateçš„æ ¡éªŒåŒ…-->\n<dependency>\n\t<groupId>org.springframework.boot</groupId>\n\t<artifactId>spring-boot-starter-web</artifactId>\n</dependency>\n```\n\n### JSRæä¾›çš„æ³¨è§£\n\n```java\n@Null   è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null    \n@NotNull    è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null    \n@AssertTrue     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true    \n@AssertFalse    è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false    \n@Min(value)     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼    \n@Max(value)     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼    \n@DecimalMin(value)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼    \n@DecimalMax(value)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼    \n@Size(max=, min=)   è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…    \n@Digits (integer, fraction)     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…    \n@Past   è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ    \n@Future     è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ    \n@Pattern(regex=,flag=)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼\n```\n\n### Hibernateæä¾›çš„\n\n```\n@NotBlank(message =)   éªŒè¯å­—ç¬¦ä¸²énullï¼Œä¸”é•¿åº¦å¿…é¡»å¤§äº0    \n@Email  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ç®±åœ°å€    \n@Length(min=,max=)  è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…    \n@NotEmpty   è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¿…é¡»éç©º    \n@Range(min=,max=,message=)  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…\n```\n\n### è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£\n\n**@IsMobileæ³¨è§£**\n\n```java\npackage top.imlgw.spike.validator;\nimport javax.validation.Constraint;\nimport javax.validation.Payload;\nimport java.lang.annotation.*;\n/**\n * @author imlgw.top\n * @date 2019/5/13 17:50\n */\n@Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Constraint(\n        validatedBy = {IsMobileValidator.class} //æŒ‡å®šçœŸæ­£æ ¡éªŒçš„ç±»\n)\npublic @interface IsMobile {\n    boolean required() default true;\n\n    String message() default \"å·ç æ ¼å¼é”™è¯¯\";\n\n    Class<?>[] groups() default {};\n\n    Class<? extends Payload>[] payload() default {};\n\n}\n```\n\n**IsMobileValidatorç±»**\n\n> è‡ªå®šä¹‰çš„æ ¡éªŒå™¨è¦å®ç° ConstraintValidatoræ¥å£\n\n```java\npackage top.imlgw.spike.validator;\n\nimport org.apache.commons.lang3.StringUtils;\nimport top.imlgw.spike.utils.ValidatorUtil;\n\nimport javax.validation.ConstraintValidator;\nimport javax.validation.ConstraintValidatorContext;\n\n/**\n * @author imlgw.top\n * @date 2019/5/13 18:12\n */\npublic class IsMobileValidator implements ConstraintValidator<IsMobile, String> {\n\n    private boolean required=false;\n\n    @Override\n    public void initialize(IsMobile constraintAnnotation) {\n        required=constraintAnnotation.required();\n    }\n\n    @Override\n    public boolean isValid(String s, ConstraintValidatorContext constraintValidatorContext) {\n        if(required){\n            return  ValidatorUtil.isMobile(s);\n        }else {\n            if(StringUtils.isEmpty(s)){\n                return true;\n            }else {\n                return  ValidatorUtil.isMobile(s);\n            }\n        }\n    }\n}\n```\n\n### å­—æ®µä¸ŠåŠ æ³¨è§£\n\n```java\npackage top.imlgw.spike.entity;\nimport org.hibernate.validator.constraints.Length;\nimport javax.validation.constraints.NotNull;\n/**\n * @author imlgw.top\n * @date 2019/5/11 15:56\n */\npublic class User {\n    @NotNull(message = \"idä¸èƒ½ä¸ºç©º\")\n    private Integer id;\n    @NotNull(message = \"åå­—ä¸èƒ½ä¸ºç©º\")\n    private String name;\n    private Integer age;\n    @Length(min = 6,message = \"å¯†ç é•¿åº¦è‡³å°‘6ä½\")\n    private String password;\n\n    @Override\n    public String toString() {\n        return \"User{\" +\n                \"id=\" + id +\n                \", name='\" + name + '\\'' +\n                \", age=\" + age +\n                \", password='\" + password + '\\'' +\n                '}';\n    }\n\n    public User(Integer id, String name, Integer age, String password) {\n        this.name = name;\n        this.age = age;\n        this.password = password;\n        this.id=id;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public Integer getAge() {\n        return age;\n    }\n\n    public void setAge(Integer age) {\n        this.age = age;\n    }\n\n    public long getId() {\n        return id;\n    }\n\n    public void setId(Integer id) {\n        this.id = id;\n    }\n}\n```\n\n**@Valid åŠ BindingResult**\n\n![mark](http://static.imlgw.top///20190513/ILDAz6Bdj3cz.png?imageslim)\n\nåœ¨Controlleå±‚å¾…æ ¡éªŒçš„çš„å‚æ•°ä¸ŠåŠ ä¸Š`@Valid`æ³¨è§£ï¼Œç„¶ååœ¨åé¢ç´§è·Ÿä¸€ä¸ª `BindingResult`ï¼Œæ ¡éªŒçš„ç»“æœä¼šå°è£…åœ¨è¿™ä¸ªå¯¹è±¡é‡Œé¢ï¼ŒBindingResult çš„ä½œç”¨æ˜¯å½“å‚æ•°ä¸åˆæ³•æ—¶èƒ½å¤Ÿæ•æ‰åˆ°é”™è¯¯ï¼Œä¸ä¼šç›´æ¥æŠ›å¼‚å¸¸ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ã€‚\n\n**@ValidåŠ å…¨å±€å¼‚å¸¸æ•è·**\n\nä¸Šé¢çš„æ–¹æ³•å¦‚æœä¸åŠ åé¢çš„BindingResultåœ¨æ ¡éªŒå¤±è´¥åå°±ä¼šæŠ›ä¸€ä¸ªBindException\n\n```java\norg.springframework.validation.BindException: org.springframework.validation.BeanPropertyBindingResult: 1 errors\nField error in object 'user' on field 'id': rejected value [null]; codes [NotNull.user.id,NotNull.id,NotNull.long,NotNull]; arguments .......\n```\n\né‚£æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨`@ControllerAdvice+@ExceptionHandler`æ¥å®šä¹‰ä¸€ä¸ªå…¨å±€çš„å¼‚å¸¸å¤„ç†å™¨æ¥å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œ`@ExceptionHandle`ï¼Œé’ˆå¯¹çš„ä»…ä»…æ˜¯å•ä¸ªcontrollerï¼ŒåŠ ä¸Š`@ControllerAdvice`å°±å¯ä»¥å¯¹æ‰€æœ‰çš„Controllerå±‚å¼‚å¸¸è¿›è¡Œæ•è·ï¼Œè¿™é‡Œçš„å…¨å±€ä»…ä»…æŒ‡çš„æ˜¯controllerå±‚ã€‚\n\n### è‡ªå®šä¹‰å¼‚å¸¸\n\n```java\npackage top.imlgw.spike.exception;\nimport top.imlgw.spike.result.CodeMsg;\n\n/**\n * å…¨å±€é€šç”¨å¼‚å¸¸\n * @author imlgw.top\n * @date 2019/5/14 20:51\n */\npublic class GlobalException extends RuntimeException {\n    private static final long serialVersionUID = 1L;\n    private CodeMsg cm;\n\n    public GlobalException(CodeMsg cm) {\n        super(cm.toString());\n        this.cm = cm;\n    }\n\n    public CodeMsg getCm() {\n        return cm;\n    }\n\n}\n\n```\n\n### å…¨å±€å¼‚å¸¸å¤„ç†å™¨\n\n```java\n/**\n * Controllerå±‚å¼‚å¸¸å¤„ç†å™¨\n *\n * @author imlgw.top\n * @date 2019/5/13 18:21\n */\n@ControllerAdvice\n@ResponseBody //ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦jsonçš„è½¬æ¢\npublic class GlobalExceptionHandler {\n    @ExceptionHandler(value = Exception.class) //å¤„ç†controllerå±‚æ‰€æœ‰å¼‚å¸¸\n    public Result<String> exceptionHandle(HttpServletRequest request, Exception e) {\n        e.printStackTrace();\n        if (e instanceof GlobalException) {\n            //å…¨å±€å¼‚å¸¸\n            GlobalException ex = (GlobalException) e;\n            return Result.error(ex.getCm());\n        } else if (e instanceof BindException) {\n            //@Validated æ£€éªŒå™¨çš„å¼‚å¸¸\n            BindException ex = (BindException) e;\n            List<ObjectError> errors = ex.getAllErrors();\n            ObjectError error = errors.get(0);\n            String msg = error.getDefaultMessage();\n            return Result.error(CodeMsg.BIND_ERROR.fillArgs(msg));\n        } else {\n            return Result.error(CodeMsg.SERVER_ERROR);\n        }\n    }\n\n    //æµ‹è¯•Demo çœ‹å…ˆå¤„ç†é‚£ä¸ª\n    @ExceptionHandler(value = GlobalException.class) //å¤„ç†controllerå±‚æ‰€æœ‰å¼‚å¸¸\n    public Result<String> GLe(HttpServletRequest request, Exception e) {\n        System.out.println(\"ä¼˜å…ˆå¤„ç†äº†è¿™ä¸ªGlobalException\");\n        e.printStackTrace();\n        //å…¨å±€å¼‚å¸¸\n        GlobalException ex = (GlobalException) e;\n        return Result.error(ex.getCm());\n    }\n}\n```\n\nè¿™é‡Œä¹Ÿåšäº†ä¸ªå°æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å®šä¹‰äº†ä¸¤ä¸ª@ExceptionHandleï¼Œä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„å­ç±»ï¼Œçœ‹ä¼šå…ˆå¤„ç†é‚£ä¸ªï¼Œæµ‹è¯•åå‘ç°ä¼šå…ˆå¤„ç†å°å¼‚å¸¸ï¼Œé‚£ä¸ªæœ€å¤§çš„å¼‚å¸¸å…¶å®ç›¸å½“äº''å…œåº•''çš„ã€‚å…¶å®åé¢æˆ‘ä¸ºäº†è·Ÿç²¾ç»†çš„å¤„ç†ï¼Œå°†ç»‘å®šå¼‚å¸¸å’Œè‡ªå®šä¹‰çš„å¼‚å¸¸åˆ†å¼€å¤„ç†äº†ã€‚\n\n> @ControllerAdvice :\n>\n> It is typically used to define {@link ExceptionHandler **@ExceptionHandler**},\n>\n> {@link InitBinder **@InitBinder**}, and {@link ModelAttribute **@ModelAttribute**}\n>\n> methods that **apply to all** {@link RequestMapping **@RequestMapping**} methods.\n>\n> @author Rossen Stoyanchev\n>\n> @since 3.2\n\n### åˆ†ç»„æ ¡éªŒ\n\nåªéœ€è¦åœ¨voé‡ŒåŠ ä¸Šå¯¹åº”åˆ†ç»„çš„æ¥å£ç„¶ååœ¨æ³¨è§£ä¸ŠåŠ ä¸Šå°±å¯ä»¥äº†\n\n```java\npublic class LoginVo {\n    @NotNull(message = \"æ‰‹æœºå·ä¸èƒ½ä¸ºç©º\")\n    @IsMobile(groups = Test1.class) //åªæœ‰åœ¨Test1åˆ†ç»„ä¸‹æ‰ç”Ÿæ•ˆ\n    private String mobile;\n\n    @NotNull(message = \"å¯†ç ä¸èƒ½ä¸ºç©º\")\n    @Length(min=6 ,groups = Test2.class,message = \"å¯†ç é•¿åº¦è¿‡çŸ­\") //åªæœ‰åœ¨Test2åˆ†ç»„ä¸‹æ‰ç”Ÿæ•ˆ\n    private String password;\n\n    public String getMobile() {\n        return mobile;\n    }\n    public void setMobile(String mobile) {\n        this.mobile = mobile;\n    }\n    public String getPassword() {\n        return password;\n    }\n    public void setPassword(String password) {\n        this.password = password;\n    }\n    @Override\n    public String toString() {\n        return \"LoginVo [mobile=\" + mobile + \", password=\" + password + \"]\";\n    }\n\n    public interface Test1{}\n\n    public interface Test2{}\n}\n```\n\nä½¿ç”¨æ—¶æ³¨æ„ç”¨`@Validated`ï¼Œè¿™ä¸ªå…¶å®æ˜¯Springå¯¹Hibernateçš„äºŒæ¬¡å°è£…ï¼Œå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚\n\n```java\n@RequestMapping(\"/jsr303-2\")\n@ResponseBody\npublic void testJSR(@Validated({LoginVo.Test2.class}) LoginVo vo){\n\t  //........\t\n}\n```\n\nè¿™æ ·åœ¨è¿™ä¸ªControlleré‡Œpostå¯†ç å°±æ²¡æœ‰é•¿åº¦çš„é™åˆ¶äº†ã€‚\n\n> å…¶å®è¿˜æœ‰ä¸€äº›æ ¡éªŒçš„æ–¹æ³•ï¼ŒåŸºäºæ–¹æ³•æ ¡éªŒï¼ŒåŸºäºå°‘é‡å‚æ•°çš„æ ¡éªŒï¼Œä»¥åç”¨åˆ°å†æ¥è®°å½•\n\n","tags":["å‚æ•°æ ¡éªŒ","JSR"],"categories":["Web"]},{"title":"LeetCodeæ•°ç»„","url":"/2019/05/04/leetcode-shu-zu/","content":"\n## LeetCode æ•°ç»„\n\n> å–„ç”¨ctrl+f\n\n## [167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„](https://leetcode-cn.com/problems/two-sum-ii-input-array-is-sorted/)\n\nç»™å®šä¸€ä¸ªå·²æŒ‰ç…§**å‡åºæ’åˆ—** çš„æœ‰åºæ•°ç»„ï¼Œæ‰¾åˆ°ä¸¤ä¸ªæ•°ä½¿å¾—å®ƒä»¬ç›¸åŠ ä¹‹å’Œç­‰äºç›®æ ‡æ•°ã€‚\n\nå‡½æ•°åº”è¯¥è¿”å›è¿™ä¸¤ä¸ªä¸‹æ ‡å€¼ index1 å’Œ index2ï¼Œå…¶ä¸­ index1 å¿…é¡»å°äº index2*ã€‚*\n\n**è¯´æ˜:**\n\n- è¿”å›çš„ä¸‹æ ‡å€¼ï¼ˆindex1 å’Œ index2ï¼‰ä¸æ˜¯ä»é›¶å¼€å§‹çš„ã€‚\n- ä½ å¯ä»¥å‡è®¾æ¯ä¸ªè¾“å…¥åªå¯¹åº”å”¯ä¸€çš„ç­”æ¡ˆï¼Œè€Œä¸”ä½ ä¸å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„å…ƒç´ ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: numbers = [2, 7, 11, 15], target = 9\nè¾“å‡º: [1,2]\nè§£é‡Š: 2 ä¸ 7 ä¹‹å’Œç­‰äºç›®æ ‡æ•° 9 ã€‚å› æ­¤ index1 = 1, index2 = 2 ã€‚\n```\n\nä¸¤æ•°ä¹‹å’Œçš„å˜ç§ï¼Œçœ‹è§**æœ‰åº**å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨äºŒåˆ†æ¥åšï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æ˜¯`O(NlogN)`ï¼Œç›¸å¯¹è¾ƒé«˜\n\n```java\npublic int[] twoSum(int[] numbers, int target) {\n    if(numbers==null||numbers.length<=0){\n        return null;\n    }\n    int left=0,right=numbers.length-1;\n    while(right>left){\n        int sum=numbers[right]+numbers[left];\n        if(sum==target){\n            return new int[]{left+1,right+1};\n        }if(sum<target){\n            left++;\n        }else{\n            right--;\n        }\n    }\n    return null;\n}\n```\n\n**å¯¹æ’æŒ‡é’ˆ**ï¼Œå¾ˆåŸºç¡€çš„é¢˜ã€‚\n\n## [11. ç››æœ€å¤šæ°´çš„å®¹å™¨](https://leetcode-cn.com/problems/container-with-most-water/)\n\nç»™å®š *n* ä¸ªéè´Ÿæ•´æ•° *a*1ï¼Œ*a*2ï¼Œ...ï¼Œ*a*nï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹ (*i*, *ai*) ã€‚åœ¨åæ ‡å†…ç”» *n* æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ *i* çš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º (*i*, *ai*) å’Œ (*i*, 0)ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ *x* è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚\n\n**è¯´æ˜ï¼š**ä½ ä¸èƒ½å€¾æ–œå®¹å™¨ï¼Œä¸” *n* çš„å€¼è‡³å°‘ä¸º 2ã€‚\n\n![mark](http://static.imlgw.top///20190505/1uze479AHHLo.png?imageslim)\n\nå›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„ [1,8,6,2,5,4,8,3,7]ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º 49ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [1,8,6,2,5,4,8,3,7]\nè¾“å‡º: 49\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic int maxArea(int[] height) {\n        int len=height.length;\n        if(len==0){\n            return 0;\n        }\n        int max=Integer.MIN_VALUE;\n        for(int i=0;i<len-1;i++){\n            for(int j=i+1;j<len;j++){\n                int minHight=height[i]>height[j]?height[j]:height[i];\n                max=max>(j-i)*minHight ? max:(j-i)*minHight;\n            }\n        }\n        return max;\n }\n```\n\n522msï¼Œ13% å«åº•äº†ï¼Œåˆ«é—®ï¼Œé—®å°±æ˜¯æš´åŠ›ğŸ¤£\n\n```java\npublic int maxArea(int[] height) {\n        int len=height.length;\n        if(len==0){\n            return 0;\n        }\n        int head=0,tail=len-1;\n        int max=Integer.MIN_VALUE;\n        while(head<len){\n            tail=len-1; //å¼€å§‹æ”¹çš„æ—¶å€™è¿™ä¸€å¥å¿˜äº†åŠ \n            while(head!=tail){\n                int minHight=height[tail]>height[head]?height[head]:height[tail];\n                max=max>(tail-head)*minHight ? max:(tail-head)*minHight;\n                if(height[head]<=height[tail]){\n                    break;\n                }else{\n                    tail--;\n                }\n            }\n            head++;\n        }\n        return max;\n}\n```\n\n212msï¼Œ40%ï¼Œåˆ©ç”¨åŒæŒ‡é’ˆç¨å¾®ä¼˜åŒ–äº†ä¸‹ï¼Œä¾ç„¶æ˜¯éå†æ‰¾æ¯ä¸ªæŸ±çš„æœ€å¤§å€¼ï¼Œä½†æ˜¯å°¾æŒ‡é’ˆåœ¨ç§»åŠ¨æ—¶å…ˆåˆ¤æ–­ä¸‹ï¼Œå¦‚æœæ¯”å¤´æŒ‡é’ˆå¤§å°±ç›´æ¥breakï¼Œå› ä¸º**å·²ç»æ˜¯æœ€å¤§å€¼**äº†ï¼Œtailæ˜¯ä»å³å‘å·¦ç§»åŠ¨çš„\n\n> å¼€å§‹æ”¹çš„æ—¶å€™å¿˜äº†å°†å°¾æŒ‡é’ˆå½’ä½ï¼Œç»“æœè¿˜å¯¹äº†ï¼Œè€Œä¸”90%çš„beats.....å“ˆå“ˆå“ˆï¼Œè¯¯æ‰“è¯¯æ’æäº†ä¸ªæœ€ä¼˜è§£å‡ºæ¥ã€‚\n\n**è§£æ³•äºŒ**\n\nä¸Šé¢ä¸¤ç§å…¶å®éƒ½æ˜¯æš´åŠ›ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½å¾ˆé«˜\n\n```java\n//update: 2020.4.18\npublic int maxArea(int[] height) {\n    if(height==null || height.length<=0) return 0;\n    int left=0,right=height.length-1;\n    int max=0;\n    while(left<right){\n        max=Math.max((right-left)*Math.min(height[left],height[right]),max);\n        //if(left<right){ éšçº¦è®°å¾—ä¹‹å‰ä¹Ÿè¿™æ ·å†™è¿‡ã€‚ã€‚ã€‚æ²¡æƒ³åˆ°è¿™æ¬¡åˆåœ¨è¿™é‡ŒWAäº†\n        if(height[left]<height[right]){\n            left++;\n        }else{\n            right--;\n        }\n    }\n    return max;\n}\n```\n\n**æ ‡å‡†**çš„æœ€ä¼˜è§£ï¼Œè¿™é¢˜ä¸»è¦è€ƒå¯Ÿçš„å°±æ˜¯åŒæŒ‡é’ˆï¼Œä¸¤ä¸ªæŒ‡é’ˆä¸€å¤´ä¸€å°¾ï¼Œå…ˆç®—å‡ºè¿™ä¸ªå¤´å°¾çš„é¢ç§¯å¤§å°ï¼Œç„¶åä¸‹ä¸€æ­¥æ€è€ƒæ€ä¹ˆæ‰©å¤§è¿™ä¸ªåŒºåŸŸçš„é¢ç§¯ï¼Œç»“åˆé¢˜ä¸Šé¢çš„å›¾ï¼ˆæœ€å·¦è¾¹ä¸ºå¤´ï¼Œæœ€å³è¾¹ä¸ºå°¾ï¼‰\n\n![mark](http://static.imlgw.top///20190505/1uze479AHHLo.png?imageslim)\n\nè¿™ä¸ªæ—¶å€™å¦‚æœç§»åŠ¨å°¾æŒ‡é’ˆï¼Œæ˜æ˜¾é¢ç§¯åªå¯èƒ½å‡å°ï¼Œæ‰€ä»¥åªæœ‰ç§»åŠ¨å¤´æŒ‡é’ˆæ‰æœ‰å¯èƒ½å¢å¤§è¿™ä¸ªåŒºåŸŸçš„é¢ç§¯ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥çœæ‰å¾ˆå¤šæ²¡å¿…è¦çš„è®¡ç®—ï¼Œæœ‰ç‚¹åƒè´ªå¿ƒï¼Œæ—¶é—´å¤æ‚åº¦O(N)\n\n## [42. æ¥é›¨æ°´](https://leetcode-cn.com/problems/trapping-rain-water/)\n\nç»™å®š *n* ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚\n\n![rainwatertrap.png](https://i.loli.net/2019/05/14/5cda71129045d93180.png)\n\n\n\n\nä¸Šé¢æ˜¯ç”±æ•°ç»„ `[0,1,0,2,1,0,1,3,2,1,2,1]` è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [0,1,0,2,1,0,1,3,2,1,2,1]\nè¾“å‡º: 6\n```\n\n**è§£æ³•ä¸€**\n\n> æˆ‘æœ€å¼€å§‹æ€è·¯æ˜¯å¡«æ»¡åç”¨æ€»é¢ç§¯å‡æ•°ç»„å’Œï¼Œè·‘è¿‡äº†130+ä¸ªï¼Œæœ‰ä¸€ç§ç‰¹æ®Šçš„è·‘ä¸è¿‡äº†ï¼Œæ‡’å¾—å»å¤„ç†é‚£ä¸ªè¾¹ç•Œäº†ï¼Œä¸å¤ªä¼˜é›…\n\nè¿™ä¸ªé¢˜ç›®çš„å…³é”®å°±æ˜¯æ¯ä¸ªæŸ±å­èƒ½æ¥çš„æ°´æ˜¯**å·¦å³æœ€é•¿æŸ±å­(éƒ½å¤§äºå½“å‰æŸ±å­)ä¸­çš„è¾ƒå°çš„é‚£ä¸ªå‡å»å½“å‰æŸ±å­**ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜å‚¨æ¯ä¸ªæŸ±å­å·¦å³çš„æœ€é•¿æŸ±å­ï¼ˆåšé¢„å¤„ç†ï¼‰ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ä¸€ç§æœ‰ç‚¹åŠ¨æ€è§„åˆ’æ„æ€çš„è§£æ³•\n\n```java\npublic static int trap(int []height){\n    if (height==null || height.length<=0) {\n        return 0;\n    }\n    int len=height.length;\n    int[] leftMax=new int[len];\n    leftMax[0]=height[0];\n    int[] rightMax=new int[len];\n    rightMax[len-1]=height[len-1];\n    int res=0;\n    //å·¦å³æœ€å¤§æŸ±å­åŒ…å«å½“å‰æŸ±å­\n    for (int i=1;i<len;i++) {\n        leftMax[i]=Math.max(leftMax[i-1],height[i]);\n    }\n    for (int i=len-2;i>=0;i--) {\n        rightMax[i]=Math.max(rightMax[i+1],height[i]);\n    }\n    for (int i=0;i<len;i++) {\n        res+=Math.min(rightMax[i],leftMax[i])-height[i];\n    }\n    return res;\n}\n```\n\nåˆ©ç”¨**åŒæŒ‡é’ˆ**å°±è¡Œç©ºé—´çš„ä¼˜åŒ–\n\n```java\npublic static int trap(int []height){\n    if (height==null || height.length<=0) {\n        return 0;\n    }\n    int len=height.length;\n    int leftMax=0,rightMax=0;\n    int left=0,right=len-1,res=0;\n    while(left<=right){\n        leftMax=Math.max(leftMax,height[left]);\n        rightMax=Math.max(rightMax,height[right]);\n        //leftMaxå°äºrightMax,é‚£ä¹ˆé è¿‘leftMaxçš„æŸ±å­leftå¯ä»¥æ¥çš„é›¨æ°´å°±å¯ä»¥ç¡®å®šäº†\n        if (leftMax<rightMax) {\n            res+=leftMax-height[left]; \n            left++;\n        }else{ //åä¹‹leftMaxå¤§äºrightMax,é‚£ä¹ˆè€ƒè¿‘rightMaxçš„æŸ±å­rightå¯ä»¥æ¥çš„æœ€å¤šçš„é›¨æ°´å°±å¯ä»¥iç¡®å®šäº†\n            res+=rightMax-height[right];\n            right--;\n        }\n    }\n    return res;\n}\n```\n\nä¸ªäººæ„Ÿè§‰è¿™ä¸ªæ˜¯æœ€å¥½ç†è§£çš„ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œæœ€å¼€å§‹çš„å“ªä¸ªç‰ˆæœ¬ä¸æ˜¯è¿™æ ·å†™çš„ï¼Œå½“æ—¶è‡ªå·±è‚¯å®šä¹Ÿæ²¡ææ‡‚ï¼ŒåŒ…æ‹¬ç°åœ¨æˆ‘ä¹Ÿæ²¡ææ‡‚é‚£ç§å†™æ³•\n\n![[å›¾ç‰‡æ¥è‡ªliweiwei1419å¤§ä½¬](https://leetcode-cn.com/u/liweiwei1419/)](http://static.imlgw.top/blog/20200129/Dy8M19G4XwSn.png?imageslim)\n\nè¿™ä¸¤ç§æƒ…å†µå¯¹åº”çš„å°±æ˜¯å¾ªç¯ä¸­çš„ifçš„ä¸¤ä¸ªåˆ†æ”¯ï¼ŒåŒæŒ‡é’ˆå‘ä¸­é—´é æ‹¢ï¼Œå½“`leftMax`å°äº`rightMax`çš„æ—¶å€™æˆ‘ä»¬ä¸ç”¨å»è€ƒè™‘å½“å‰`left`æŸ±å­å³è¾¹å®é™…çš„æœ€å¤§çš„å³è¾¹çš„æŸ±å­æ˜¯è°ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“`left`æŸ±å­ å·¦è¾¹æœ€å¤§å€¼`leftMax`çš„å€¼å°±okï¼Œå› ä¸ºæ­¤æ—¶`left` æŸ±å­èƒ½æ¥æ°´çš„é‡æ˜¯ç”±`leftMax`å†³å®šçš„ï¼Œåä¹‹å¯¹åº”ç¬¬äºŒç§æƒ…å†µï¼Œ`right`æŸ±å­çš„æ¥æ°´é‡åˆ™æ˜¯ç”±`rightMax` å†³å®šçš„ï¼Œæœ€åéå†å®Œæ‰€æœ‰çš„æŸ±å­å°±å¯ä»¥ç¡®å®šæ•´ä½“çš„æ¥æ°´é‡\n\n> è¿™é‡Œçš„ifåˆ†æ”¯çš„æ¡ä»¶æœ‰çš„è§£æ³•ä¸­å†™çš„æ˜¯leftMax < nums[right]ç”šè‡³nums[left] < nums[right] è¿™ä¹Ÿæ˜¯æˆ‘ä¸Šé¢è¯´çš„ä¸ç†è§£çš„åœ°æ–¹ï¼Œå› ä¸ºè¿™æ ·å†™ä¹Ÿæ˜¯å¯ä»¥ACçš„ğŸ˜…ï¼Œåé¢æœ‰æ—¶é—´å†å›å¤´çœ‹çœ‹å§\n\n**è§£æ³•äºŒ**\n\nè¿˜æœ‰ä¸€ç§å¾ˆå·§å¦™çš„æ–¹æ³•ï¼Œä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œæ‰¾åˆ°æœ€å¤§å€¼ï¼Œç„¶ååˆ†åˆ«å¯¹ä¸¤è¾¹çš„æŸ±å­è¿›è¡Œéå†ï¼Œå¦‚æœå½“å‰çš„æŸ±å­å°äºå‰é¢æŸ±å­çš„æœ€å¤§å€¼ï¼Œå°±è¯´æ˜ä¸€å®šå¯ä»¥æ¥åˆ°æ°´ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è®°å½•æŸ±å­å·¦è¾¹å’Œå³è¾¹çš„æœ€å¤§å€¼ï¼Œç”¨äºè®¡ç®—å¯ä»¥æ¥æ°´çš„é‡ï¼Œæœ€åè®¡ç®—æ€»å’Œ\n\n```java\npublic static int trap5(int []height){\n    //\n    int n=height.length,idx=0,lefth=0,righth=0,area=0;\n    for (int i=0;i<n;i++) idx=height[idx]<=height[i]?i:idx;\n    for (int i=0;i<idx;i++){\n        if(height[i]<lefth) area+=lefth-height[i]; \n        else lefth=height[i]; //æ›´æ–°æœ€å¤§å€¼\n    }\n    for (int i=n-1;i>idx;i--){\n        if(height[i]<righth) area+=righth-height[i]; \n        else righth=height[i]; //æ›´æ–°æœ€å¤§å€¼\n    }\n    return area;\n}\n```\n\n**è§£æ³•ä¸‰**\n\nåˆ©ç”¨æ ˆçš„\n\n```java\npublic static int trap6(int[] height) {\n    if (height == null || height.length == 0) return 0;\n    Deque<Integer> stack = new ArrayDeque<>(); //æ ˆé‡Œé¢ç»´æŠ¤ä¸€ä¸ªé€’å‡åºåˆ—\n    int res = 0;\n    for (int i = 0; i < height.length; i++){\n        while ( ! stack.isEmpty() && height[stack.peek()] < height[i]) { //å½“éå†çš„å…ƒç´ å¤§äºæ ˆé¡¶å…ƒç´ \n            int tmp = stack.pop(); //æ ˆé¡¶å¼¹å‡ºæ¥\n            if (stack.isEmpty()) break;\n            res += (Math.min(height[i],height[stack.peek()]) - height[tmp]) * (i - stack.peek() - 1);\n        }\n        //ç»´æŠ¤é€’å‡åºåˆ—\n        stack.push(i);\n    }\n    return res;\n}\n```\n\nè¿™ç§æœ‰ç‚¹ä¸å¥½ç†è§£ï¼Œå…¶å®æ˜¯æŒ‰ç…§å±‚æ¥è®¡ç®—çš„ï¼Œæ ˆé‡Œé¢æ˜¯é€’å‡çš„å…ƒç´ ï¼Œå¦‚æœè¯»åˆ°æ¯”æ ˆé¡¶å¤§çš„å…ƒç´ å°±**æŒ‰å±‚**è®¡ç®—é€’å‡æ ˆ**åº•éƒ¨å…ƒç´ **åˆ°**å½“å‰å…ƒç´ **èƒ½è“„æ°´çš„é¢ç§¯ã€‚\n\n> 2020/1/29å›é¡¾\n>\n> è¿™ä¸ªè§£æ³•å…¶å®å°±æ˜¯å•è°ƒæ ˆğŸ˜‚ï¼Œå½“æ—¶è¿˜æ˜¯èœé¸Ÿæ ¹æœ¬å°±ä¸æ‡‚ï¼Œç°åœ¨å›å¤´ä¸€çœ‹å°±æ‡‚äº†hahaha~ \n>\n> æ”¾åˆ°[å•è°ƒæ ˆä¸“é¢˜](http://imlgw.top/2019/10/01/leetcode-zhan-dui-lie/#%E5%8D%95%E8%B0%83%E6%A0%88)é‡Œé¢è§£é‡Šäº†\n\n## [15. ä¸‰æ•°ä¹‹å’Œ](https://leetcode-cn.com/problems/3sum/)\n\nç»™å®šä¸€ä¸ªåŒ…å« *n* ä¸ªæ•´æ•°çš„æ•°ç»„ `nums`ï¼Œåˆ¤æ–­ `nums` ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  *aï¼Œbï¼Œc ï¼Œ*ä½¿å¾— *a + b + c =* 0 ï¼Ÿæ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚\n\n**æ³¨æ„ï¼š**ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚\n\n```java\nä¾‹å¦‚, ç»™å®šæ•°ç»„ nums = [-1, 0, 1, 2, -1, -4]ï¼Œ\n\næ»¡è¶³è¦æ±‚çš„ä¸‰å…ƒç»„é›†åˆä¸ºï¼š\n[\n  [-1, 0, 1],\n  [-1, -1, 2]\n]\n```\n\n**è§£æ³•ä¸€**\n\næƒ³å¤ªå¤šäº†ï¼Œæ²¡åšå‡ºæ¥ï¼Œçœ‹äº†è¯„è®ºæ‰åšå‡ºæ¥ã€‚\n\n```java\npublic static List<List<Integer>> threeSum(int[] nums) {\n    List<List<Integer>> list = new ArrayList();\n    Arrays.sort(nums);\n    // å…ˆæ’åº  o(nlogn)\n    int len = nums.length;\n    if(nums == null || len < 3) return list;\n    // å®Œå¤‡æ€§\n    for (int i = 0; i < len-2; i++) {\n        if(nums[i]>0){\n            //å¤§äº0äº†ï¼Œåé¢çš„å’ŒåŠ èµ·æ¥è‚¯å®š>0äº†\n            break;\n        }\n        //éå†æ•°ç»„ï¼Œç›¸åŒçš„å…ƒç´ åªéœ€è¦éå†ä¸€éï¼Œä¸ç„¶ä¼šé‡å¤\n        if(i > 0 && nums[i] == nums[i-1]) continue;\n        // ä¸€æ¬¡å»é‡ä¼˜åŒ–\n        //å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚\n        int L = i+1;\n        //å°¾å…ƒç´ \n        int R = len-1;\n        while(L<R){\n            int sum = nums[i] + nums[L] + nums[R];\n            if(sum == 0){\n                list.add(Arrays.asList(nums[i],nums[L],nums[R]));\n                //-4 -1 -1 0 1 2\n                while (L<R && nums[L] == nums[L+1]) L++;\n                //äºŒæ¬¡å»é‡ä¼˜åŒ–\n                while (L<R && nums[R] == nums[R-1]) R--;\n                L++;\n                R--;\n            } else if (sum < 0){ //å°äº0æ‰€ä»¥è¦å¢å¤§L,é€¼è¿‘0 else R--;\n                 L++;   \n            } else R--; //å¤§äº0å°±å‡å°R\n        }\n    }\n    return list;\n}\n```\n\nä»£ç æ€è·¯å°±æ˜¯éå†æ•°ç»„ï¼Œç„¶åä»**i**ä½ç½®åé¢çš„æ•°ç»„ä¸­æ‰¾èƒ½å’Œ**i**å‡‘æˆä¸€å¯¹çš„å…ƒç´ ï¼Œè¿™é‡Œå…³é”®å°±æ˜¯è¿™é‡Œæ€ä¹ˆæ‰¾è¿™ä¸¤ä¸ªå…ƒç´  æ»¡è¶³nums[L]+nums[R]=-nums[i]ï¼Œé—®é¢˜å°±è½¬åŒ–æˆäº†ä¸Šé¢çš„**ä¸¤æ•°ä¹‹å’Œ**ï¼Œä½†æ˜¯è¿™é‡Œç”¨æš´åŠ›æ³•è‚¯å®šæ˜¯è¿‡ä¸äº†çš„ï¼ŒhashMapè¿™é‡Œä¹Ÿä¸å¥½ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥å…ˆç»™æ•°ç»„æ’ä¸ªåºï¼Œç„¶ååˆ©ç”¨**åŒæŒ‡é’ˆå¯¹æ’**ï¼Œé€æ¸é€¼è¿‘0ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯äºŒæ¬¡å»é‡ï¼Œå¦‚ä¸‹å›¾\n\n![mark](http://static.imlgw.top///20190505/5YlNbCLe57fb.png?imageslim)\n\nå½“æ‰¾åˆ°ä¸€ç»„æ—¶æœ‰å¯èƒ½Lï¼ŒRçš„ä¸‹ä¸€ä¸ªä½ç½®çš„å€¼æ²¡å˜è¿™æ ·å°±ä¼šå¯¼è‡´é‡å¤ã€‚\n\n## [16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ](https://leetcode-cn.com/problems/3sum-closest/)\n\nç»™å®šä¸€ä¸ªåŒ…æ‹¬ *n* ä¸ªæ•´æ•°çš„æ•°ç»„ `nums` å’Œ ä¸€ä¸ªç›®æ ‡å€¼ `target`ã€‚æ‰¾å‡º `nums` ä¸­çš„ä¸‰ä¸ªæ•´æ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œä¸ `target` æœ€æ¥è¿‘ã€‚è¿”å›è¿™ä¸‰ä¸ªæ•°çš„å’Œã€‚å‡å®šæ¯ç»„è¾“å…¥åªå­˜åœ¨å”¯ä¸€ç­”æ¡ˆã€‚\n\n```java\nä¾‹å¦‚ï¼Œç»™å®šæ•°ç»„ nums = [-1ï¼Œ2ï¼Œ1ï¼Œ-4], å’Œ target = 1.\n\nä¸ target æœ€æ¥è¿‘çš„ä¸‰ä¸ªæ•°çš„å’Œä¸º 2. (-1 + 2 + 1 = 2).\n```\n\n**è§£æ³•ä¸€**\n\nè·Ÿä¸Šé¢çš„é¢˜å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸»è¦æ—¶ä¸ºäº†æ£€æµ‹ä¸‹è‡ªå·±ä¸Šé¢çš„ææ‡‚äº†æ²¡\n\n```java\npublic int threeSumClosest(int[] nums, int target) {\n    int len=nums.length;\n    if(nums==null||len<3) return 0;\n    Arrays.sort(nums);\n    int closest=nums[0]+nums[1]+nums[2];\n    for (int i=0;i<len-2;i++) {\n        if(i!=0&&nums[i]==nums[i-1])continue;\n        //è·³è¿‡é‡å¤å…ƒç´ æé«˜æ•ˆç‡\n        int L=i+1;\n        int R=len-1;\n        while(L<R){\n            int sum=nums[L]+nums[R]+nums[i];\n            closest=Math.abs(closest-target)>Math.abs(sum-target)?sum:closest;\n            if(sum==target){\n                return target;\n            } else if(sum>target){\n                while(L<R && nums[R]==nums[R-1])R--;\n                R--;\n            } else{\n                while(L<R && nums[L]==nums[L+1])L++;\n                L++;\n            }\n        }\n    }\n    return closest;\n}\n```\n\nä¸€é**bugfree**ï¼Œå…¶å®éƒ½æŒºç®€å•ï¼Œè¿™ä¸¤é¢˜æˆ‘ä¸€ç›´åœ¨è€ƒè™‘åˆ«çš„ç®—æ³•ï¼Œæˆ‘æƒ³çš„æ˜¯æ’åºåä»ä¸¤éå‘ä¸­é—´ç„¶å...å°±ä¸bbäº†ï¼Œåä¹‹å¾ˆå¤šæ²¡è€ƒè™‘åˆ°çš„åœ°æ–¹ã€‚\n\n## [18. å››æ•°ä¹‹å’Œ](https://leetcode-cn.com/problems/4sum/)\n\nç»™å®šä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ `nums` å’Œä¸€ä¸ªç›®æ ‡å€¼ `target`ï¼Œåˆ¤æ–­ `nums` ä¸­æ˜¯å¦å­˜åœ¨å››ä¸ªå…ƒç´  aï¼Œbï¼Œc å’Œ d ï¼Œä½¿å¾— `a + b + c + d` çš„å€¼ä¸ `target` ç›¸ç­‰ï¼Ÿæ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„å››å…ƒç»„ã€‚\n\n**æ³¨æ„ï¼š**\n\nç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„å››å…ƒç»„ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nç»™å®šæ•°ç»„ nums = [1, 0, -1, 0, -2, 2]ï¼Œå’Œ target = 0ã€‚\n\næ»¡è¶³è¦æ±‚çš„å››å…ƒç»„é›†åˆä¸ºï¼š\n[\n  [-1,  0, 0, 1],\n  [-2, -1, 1, 2],\n  [-2,  0, 0, 2]\n]\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸‰æ•°ä¹‹å’Œä¸€æ ·ï¼Œä½†æ˜¯æ›´åŠ ç¹çäº†ï¼Œæäº¤äº†5ï¼Œ6æ¬¡æ‰ACï¼Œè¿˜æ˜¯çœ‹äº†åˆ«äººçš„ä»£ç çš„\n\n```java\npublic static List<List<Integer>> fourSum(int[] nums, int target) {\n    List<List<Integer>> res=new ArrayList<>();\n    Arrays.sort(nums);\n    int n=nums.length;\n    //0 0 -1 1\n    for (int i=0;i<n-3;i++) {\n        //è¿™é‡Œæˆ‘å¼€å§‹å†™çš„æ˜¯å’Œåä¸€ä¸ªæ¯”è¾ƒï¼Œ0ï¼Œ0ï¼Œ0ï¼Œ0è¿™ç§è¿‡ä¸äº†\n        if(i>0 && nums[i]==nums[i-1])continue;\n        if (nums[i]+nums[i+1]+nums[i+2]+nums[i+3]>target) break;\n        if (nums[i]+nums[n-1]+nums[n-2]+nums[n-3]<target) continue;\n        for (int j=i+1;j<n-2;j++) {\n            //åŒä¸Š\n            if(j>i+1&&nums[j]==nums[j-1])continue;\n            if (nums[i]+nums[j]+nums[j+2]+nums[j+1]>target) break;\n            if (nums[i]+nums[j]+nums[n-2]+nums[n-1]<target) continue;\n            int two=nums[i]+nums[j];\n            //å·¦å³è¾¹ç•Œ\n            int left=j+1,right=n-1;\n            while(left<right){\n                if (target-two==nums[left]+nums[right]) {\n                    res.add(Arrays.asList(nums[i],nums[j],nums[left],nums[right]));\n                    //æƒ³æ¸…æ¥šä»€ä¹ˆæ—¶å€™è·³,æ”¾å¤–é¢å°±é”™äº†\n                    while(left<right && nums[left]==nums[left+1]){left++;};\n                    while(left<right && nums[right]==nums[right-1]){right--;};\n                    left++;\n                    right--;\n                }else if (target-two>nums[left]+nums[right]) {\n                    left++;\n                }else{\n                    right--;\n                }\n            }\n        }\n    }\n    return res;\n}\n```\n\n\n## [26. åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/)\n\nç»™å®šä¸€ä¸ªæ’åºæ•°ç»„ï¼Œä½ éœ€è¦åœ¨**åŸåœ°**åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚\n\nä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨**åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„**å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nç»™å®šæ•°ç»„ nums = [1,1,2], \n\nå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2ã€‚ \n\nä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nç»™å®š nums = [0,0,1,1,1,2,2,3,3,4],\n\nå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 1, 2, 3, 4ã€‚\n\nä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nå®ä¸ç›¸ç’ï¼Œè¿™é¢˜ä¸€å¼€å§‹æˆ‘æš´åŠ›åšçš„ï¼Œå†’æ³¡çš„æ€æƒ³ï¼Œå¤ªè ¢äº†ğŸ˜… ï¼Œæ³¨æ„é¢˜ç›®è¦æ±‚ç©ºé—´å¤æ‚åº¦O(1)\n\n```java\npublic int removeDuplicates(int[] nums) {\n    if (nums.length == 0) return 0;\n    int i = 0;\n    for (int j = 1; j < nums.length; j++) {\n        if (nums[j] != nums[i]) {\n            nums[i++] = nums[j];\n        }\n    }\n    return i + 1;\n}\n```\n\nåŒæŒ‡é’ˆï¼ŒçœŸçš„ç”¨çš„æŒºå¤šçš„ã€‚\n\n## [80. åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array-ii/)\n\nç»™å®šä¸€ä¸ªæ’åºæ•°ç»„ï¼Œä½ éœ€è¦åœ¨**åŸåœ°**åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚\n\nä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨**åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„**å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nç»™å®š nums = [1,1,1,2,2,3],\n\nå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = 5, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 1, 2, 2, 3 ã€‚\n\nä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nç»™å®š nums = [0,0,1,1,1,1,2,3,3],\n\nå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = 7, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 0, 1, 1, 2, 3, 3 ã€‚\n\nä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n```\n\n**è¯´æ˜:**\n\nä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢?\n\nè¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥**â€œå¼•ç”¨â€**æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚\n\nä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:\n\n```java\n// nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´\nint len = removeDuplicates(nums);\n\n// åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚\n// æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­è¯¥é•¿åº¦èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚\nfor (int i = 0; i < len; i++) {\n    print(nums[i]);\n}\n```\n\n**è§£æ³•ä¸€**\n\nä¸Šé¢é¢˜ç›®åŠ ä¸€ç‚¹ï¼Œåœ¨å‰åç›¸ç­‰çš„æ—¶å€™åˆ¤æ–­indexå‰æ˜¯å¦å·²ç»æœ‰ä¸¤ä¸ªç›¸ç­‰\n\n```java\npublic int removeDuplicates(int[] nums) {\n    int index=2;\n    for (int i=2;i<nums.length;i++){\n        if(nums[i]!=nums[i-1] || (nums[i]==nums[i-1] && nums[index-2]!=nums[index-1])){\n            nums[index++]=nums[i];\n        }\n    }\n    return index;\n}\n```\n\n## [27. ç§»é™¤å…ƒç´ ](https://leetcode-cn.com/problems/remove-element/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ *nums* å’Œä¸€ä¸ªå€¼ *val*ï¼Œä½ éœ€è¦**åŸåœ°**ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº *val* çš„å…ƒç´ ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚\n\nä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨**åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„**å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚\n\nå…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nç»™å®š nums = [3,2,2,3], val = 3,\n\nå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚\n\nä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nç»™å®š nums = [0,1,2,2,3,0,4,2], val = 2,\n\nå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚\n\næ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚\n\nä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nç›®æ ‡å…ƒç´ å¤šæ—¶\n\n```java\npublic int removeElement(int[] nums, int val) {\n    int i = 0;\n    for (int j = 0; j < nums.length; j++) {\n        if (nums[j] != val) {\n            nums[i++] = nums[j];\n        }\n    }\n    return i;\n}\n```\n\nç›®æ ‡å…ƒç´ å°‘æ—¶\n\n```java\npublic int removeElement2(int[] nums, int val) {\n    int i = 0;\n    int n = nums.length;\n    while (i < n) {\n        if (nums[i] == val) {\n            nums[i] = nums[--n];\n        } else {\n            i++;\n        }\n    }\n    return n;\n}\n```\n\n## [283. ç§»åŠ¨é›¶](https://leetcode-cn.com/problems/move-zeroes/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ `nums`ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ `0` ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [0,1,0,3,12]\nè¾“å‡º: [1,3,12,0,0]\n```\n\n**è¯´æ˜**:\n\n- å¿…é¡»åœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼Œä¸èƒ½æ‹·è´é¢å¤–çš„æ•°ç»„ã€‚\n\n- å°½é‡å‡å°‘æ“ä½œæ¬¡æ•°ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic void moveZeroes(int[] nums) {\n    if(nums==null||nums.length<=1){\n        return;\n    }\n    int index=0;\n    for(int i=0;i<nums.length;i++){\n        if(nums[i]!=0){\n            nums[index++]=nums[i];\n        }\n    }\n    for(int i=index;i<nums.length;i++){\n        nums[i]=0;\n    }\n}\n```\n\nå…¶å®å°±æ˜¯å€ŸåŠ©ä¸Šé¢é¢˜ç›®çš„æ€è·¯ï¼Œæœ€åå†è¡¥0å°±okäº†ï¼Œå…¶å®ä¹Ÿè¿˜å¯ä»¥ä¼˜åŒ–ä¸‹\n\n**è§£æ³•äºŒ**\n\nä¿æŒ`[0,m)` ä¸ºé0å…ƒç´ ï¼Œé‡åˆ°é0å…ƒç´ å°±å’Œå³è¾¹ç•Œè¿›è¡Œäº¤æ¢\n\n```java\npublic void moveZeroes(int[] nums) {\n    int m=0; //[0,m)ä¸ºé0å…ƒç´ \n    for(int i=0;i<nums.length;i++){\n        if(nums[i]!=0){\n            if(i!=m){\n                int temp=nums[i];\n                nums[i]=nums[m];\n                nums[m]=temp;   \n            }\n            m++;\n        }\n    }\n}\n```\n\n## [31. ä¸‹ä¸€ä¸ªæ’åˆ—](https://leetcode-cn.com/problems/next-permutation/)\n\nå®ç°è·å–ä¸‹ä¸€ä¸ªæ’åˆ—çš„å‡½æ•°ï¼Œç®—æ³•éœ€è¦å°†ç»™å®šæ•°å­—åºåˆ—é‡æ–°æ’åˆ—æˆå­—å…¸åºä¸­ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ã€‚\n\nå¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ï¼Œåˆ™å°†æ•°å­—é‡æ–°æ’åˆ—æˆæœ€å°çš„æ’åˆ—ï¼ˆå³å‡åºæ’åˆ—ï¼‰ã€‚\n\nå¿…é¡»**åŸåœ°**ä¿®æ”¹ï¼Œåªå…è®¸ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼Œè¾“å…¥ä½äºå·¦ä¾§åˆ—ï¼Œå…¶ç›¸åº”è¾“å‡ºä½äºå³ä¾§åˆ—ã€‚\n\n```java\n1,2,3 â†’ 1,3,2\n3,2,1 â†’ 1,2,3\n1,1,5 â†’ 1,5,1\n```\n\n**è§£æ³•ä¸€**\n\nç›´æ¥ä¸Šæœ€ä¼˜è§£å§ï¼Œè¿™é¢˜æš´åŠ›æ³•O(N!)ï¼Œç©ºé—´ä¹Ÿè¶…è¿‡äº†\n\n```java\npublic void nextPermutation(int[] nums) {\n    int len=nums.length;\n    if(nums==null||len<=1){\n        return;\n    }\n    for (int i=len-2;i>=0;i--) {\n        while(i>=0 &&nums[i]>=nums[i+1]){\n            //æ‰¾åˆ°ç¬¬ä¸€ä¸ªå³°å€¼å·¦ç›¸é‚»çš„å…ƒç´ ï¼ˆä»å·¦åˆ°å³ï¼‰\n            i--;\n        }\n        //é€†åºçš„, æ²¡æœ‰æœ€å¤§å€¼\n        if(i==-1){\n            reverse(nums,0);\n            return;\n        }\n        //æ‰¾åˆ°å³°å€¼å³è¾¹ [i+1 , len-1] æœ€åä¸€ä¸ªæ¯”i å¤§çš„å…ƒç´ \n        for (int j=len-1;j>i;j--) {\n            if(nums[j]>nums[i]){\n                swap(nums,j,i);\n                reverse(nums,i+1);\n                return;\n            }\n        }\n    }\n}\n\n//ç¿»è½¬æ•°ç»„\nprivate void reverse(int[] nums, int start) {\n    for (int i=start,j=nums.length-1;i<j;i++,j--) {\n        swap(nums,i,j);\n    }\n}\n\nprivate  static void swap(int[] nums, int i, int j) {\n    int temp = nums[i];\n    nums[i] = nums[j];\n    nums[j] = temp;\n}\n```\n\n- ç¬¬ä¸€æ­¥ï¼Œé€†åºæ‰¾åˆ°ç¬¬ä¸€ä¸ªå³°å€¼çš„å·¦è¾¹ç¬¬ä¸€ä¸ªå…ƒç´  `a[i-1]`ã€‚\n\n- å°†å³°å€¼å³è¾¹çš„**æœ€å°çš„**æ¯”`a[i-1]`å¤§çš„`a[j]`(å…¶å®å°±æ˜¯`å³è¾¹æœ€åä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ `)å…ƒç´ ä¸**a[i-1]**äº¤æ¢ã€‚\n- ç¿»è½¬åˆšåˆšè°ƒæ•´è¿‡`a[i-1]`åé¢çš„é€†åºçš„æ•°ç»„(`a[i]-->a[len-1]`)ã€‚\n\n![mark](http://static.imlgw.top/blog/20190728/G6uqlPyjPLdV.png?imageslim)\n\nè‡³äºä¸ºä»€ä¹ˆè¿™æ ·åšè‡ªå·±æ¨¡æ‹Ÿä¸‹å°±æ‡‚äº†ï¼Œé€†åºéƒ¨åˆ†æ˜¯æ²¡æœ‰ä¸‹ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ’åˆ—çš„ï¼Œæ‰€ä»¥å¦‚æœæƒ³è®©æ•´ä¸ªæ’åˆ—å˜å¤§åªèƒ½ä»è¿™ä¸ªé€†åºçš„æ’åˆ—é‡Œé¢é€‰ä¸€ä¸ªæ¯”é€†åºå‰æœ€åä¸€ä¸ª''ç¨å¾®''å¤§ä¸€ç‚¹çš„å…ƒç´ ä¸ä¹‹äº¤æ¢ï¼Œç„¶åå°†æ•´ä¸ªé€†åºçš„éƒ¨åˆ†ç¿»è½¬å°±æ˜¯ä¸‹ä¸€ä¸ªæ’åˆ—ï¼Œè¿™é¢˜çœ‹äº†é¢˜è§£åå¤„ç†è¾¹ç•Œåˆå¤„ç†äº†åŠå¤©ï¼Œ**å¾ªç¯é‡Œé¢çš„å¾ªç¯è¾¹ç•Œæ¡ä»¶ä¸€å®šè¦æ³¨æ„**\n\n## [556. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  III](https://leetcode-cn.com/problems/next-greater-element-iii/)\n\nç»™å®šä¸€ä¸ª32ä½æ­£æ•´æ•° nï¼Œä½ éœ€è¦æ‰¾åˆ°æœ€å°çš„32ä½æ•´æ•°ï¼Œå…¶ä¸ n ä¸­å­˜åœ¨çš„ä½æ•°å®Œå…¨ç›¸åŒï¼Œå¹¶ä¸”å…¶å€¼å¤§äºnã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„32ä½æ•´æ•°ï¼Œåˆ™è¿”å›-1ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 12\nè¾“å‡º: 21\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 21\nè¾“å‡º: -1\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢é‚£ä¸€é¢˜ä¸€æ ·ï¼Œæƒå½“å¤ä¹ äº†ä¸€ä¸‹\n\n```java\npublic int nextGreaterElement(int n) {\n    StringBuilder sb=new StringBuilder();\n    while(n/10>0){\n        sb.append(n%10);\n        n/=10;\n    }\n    sb.append(n);\n    System.out.println(sb);\n    char[] nums=sb.reverse().toString().toCharArray();\n    int len=nums.length;\n    for (int i=len-1;i>0;i--) {\n        if (nums[i]>nums[i-1]) { //é€†åºçš„å³°å€¼i\n            if (i==0) return -1; \n            for (int j=len-1;j>=i;j--) {\n                if (nums[j]>nums[i-1]) {\n                    swap(nums,j,i-1);\n                    reverse(nums,i,len-1);\n                    return Long.valueOf(new String(nums))>Integer.MAX_VALUE?-1:Integer.valueOf(new String(nums));\n                }\n            }\n        }\n    }\n    return -1;\n}\n\npublic void reverse(char[] nums,int begin,int end){\n    for (int i=begin,j=end;i<j;i++,j--) {\n        swap(nums,i,j);\n    }\n}\n\npublic void swap(char[] nums,int a,int b){\n    char temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\n## [169. å¤šæ•°å…ƒç´ ](https://leetcode-cn.com/problems/majority-element/)\n\nç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚\n\nä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [3,2,3]\nè¾“å‡º: 3\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [2,2,1,1,1,2,2]\nè¾“å‡º: 2\n```\n\n**è§£æ³•ä¸€**\n\nåˆ†æ²»æ³•ï¼Œ (`HashMap`æˆ–è€…æ’åºä»€ä¹ˆçš„æ–¹æ³•å°±ä¸è¯´äº†ï¼Œç¬”è¯•å¯ä»¥é‚£æ ·å†™ï¼Œé¢è¯•å°±ä¸èƒ½è¿™æ ·äº†)\n\n```java\npublic int majorityElement(int[] nums) {\n    return majorityElement(nums,0,nums.length-1);\n}\n\npublic int majorityElement(int[] nums,int lo,int hi) {\n    if (lo==hi) {\n        return nums[lo];\n    }\n    int mid=lo+(hi-lo)/2;\n    int leftMode=majorityElement(nums,lo,mid);\n    int rightMode=majorityElement(nums,mid+1,hi);\n    if (leftMode==rightMode) {\n        return rightMode;\n    }\n    return countMode(nums,lo,mid,leftMode)>countMode(nums,mid+1,hi,rightMode)?leftMode:rightMode;\n}\n\npublic int countMode(int[] nums,int left,int right,int mode){\n    int count=0;\n    for (int i=left;i<=right;i++) {\n        if (mode==nums[i]) {\n            count++;\n        }\n    }\n    return count;\n}\n```\n\nå¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œæ—¶é—´å¤æ‚åº¦`O(NlogN)`ï¼Œåªæ˜¯ä¸€ç§æ€è·¯å§ï¼Œè€Œä¸”æ˜¯é€šç”¨çš„æ±‚ä¼—æ•°çš„æ–¹æ³•\n\n**è§£æ³•äºŒ**\n\næ‘©å°”æŠ•ç¥¨æ³•\n\n```java\npublic int majorityElement(int[] nums) {\n    int sum=1;\n    int res=nums[0]; \n    for (int i=1;i<nums.length;i++) {\n        if (sum==0) {\n            res=nums[i];\n        }\n        //å°†ä¼—æ•°çœ‹åš1,å…¶ä»–çš„çœ‹ä½œ-1,æœ€åå’Œä¸€å®šæ˜¯å¤§äº0çš„\n        if (res!=nums[i]) {\n            sum--;\n        }else{\n            sum++;\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•ä¸‰**\n\nåˆšåˆšçœ‹è§ä¸€ç§è§£æ³•ï¼Œå½“ä½œæ±‚ç¬¬kå¤§ï¼Œç”¨å¿«é€‰å°±è¡Œäº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(N)`\n\n## [229. æ±‚ä¼—æ•° II](https://leetcode-cn.com/problems/majority-element-ii/)\n\nç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­æ‰€æœ‰å‡ºç°è¶…è¿‡ âŒŠ n/3 âŒ‹ æ¬¡çš„å…ƒç´ ã€‚\n\n**è¯´æ˜:** è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1)ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [3,2,3]\nè¾“å‡º: [3]\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [1,1,1,3,3,2,2,2]\nè¾“å‡º: [1,2]\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢çš„æ–¹æ³•ä¸€æ ·ï¼ŒæŠµæ¶ˆå»é™¤ä¸‰ä¸ªä¸åŒçš„å…ƒç´ å¯¹ä¼—æ•°æ²¡æœ‰ä»»ä½•å½±å“ï¼Œä½†æ˜¯æœ€åéœ€è¦åˆ¤æ–­æ˜¯å¦éƒ½æ˜¯ç¬¦åˆæ¡ä»¶çš„\n\n```go\n//updateï¼š2020.4.23 ç”¨goåœ¨webä¸Šéšæ‰‹å†™äº†ä¸€ä¸ªï¼Œæ„Ÿè§‰æ¯”ä¹‹å‰javaå†™çš„å“ªä¸ªå¥½ç†è§£\nfunc majorityElement(nums []int) []int {\n    var res []int\n    //è¶…è¿‡n/3çš„å…ƒç´ æœ€å¤š2ä¸ª\n    cand1:=-1 //è®¾ç½®æˆnumsä¸­ä¸å­˜åœ¨çš„å€¼æ¯”è¾ƒå¥½,æ¯”å¦‚-1\n    count1:=0\n    cand2:=-1\n    count2:=0\n    for _,num:=range nums{\n        if num==cand1{ //æŠ•1\n            count1++\n        }else if num==cand2{ //æŠ•2\n            count2++\n        }else { //éƒ½ä¸æŠ•\n            if count1==0 {\n                cand1=num\n                count1=1\n            }else if count2==0{\n                cand2=num\n                count2=1\n            }else{\n                count1--\n                count2--\n            }\n        }\n    }\n    temp1:=0\n    temp2:=0\n    for _,num:= range nums{\n        if num==cand1{\n            temp1++\n        }\n        if num==cand2{\n            temp2++\n        }\n    }\n\n    if temp1>len(nums)/3 {\n        res=append(res,cand1)\n    }\n    if temp2>len(nums)/3 {\n        res=append(res,cand2)\n    }\n    return res\n}\n```\n\n## [41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°](https://leetcode-cn.com/problems/first-missing-positive/)\n\nç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­æ²¡æœ‰å‡ºç°çš„æœ€å°çš„æ­£æ•´æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,0]\nè¾“å‡º: 3\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [3,4,-1,1]\nè¾“å‡º: 2\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [7,8,9,11,12]\nè¾“å‡º: 1\n```\n\n**è§£æ³•ä¸€**\n\nHeadé¢˜ï¼Œæƒ³åˆ°äº†æ¡¶æ’åºï¼Œä½†æ˜¯ç©ºé—´ä¸ç¬¦åˆè¦æ±‚ï¼Œçœ‹äº†è¯„è®ºæ‰£äº†åŠå¤©è¾¹ç•Œä¹Ÿæ²¡æŠ å‡ºæ¥\n\n```java\npublic int firstMissingPositive(int[] nums) {\n    if(nums==null||nums.length<=0){\n        return 1;\n    }\n    for (int i=0;i<nums.length;++i){\n        //å°†æ¯ä¸ªå…ƒç´ å½’ä½ï¼Œæˆ‘å¼€å§‹åªæœ‰ä¸€å±‚å¾ªç¯ï¼Œé‚£æ ·ä¼šæ¼æ‰å¾ˆå¤šå…ƒç´ ï¼ˆå¯èƒ½è¢«äº¤æ¢çš„å…ƒç´ åé¢ä¹Ÿéœ€è¦äº¤æ¢ï¼‰ï¼Œè¿™æ ·çš„å°±æ˜¯ä¸€æ¬¡ç›´æ¥åˆ°ä½ã€‚\n        while(nums[i]>=1&&nums[i]<=nums.length&&nums[nums[i]-1]!=nums[i])\n        {\n            int temp=nums[nums[i]-1];\n            nums[nums[i]-1]=nums[i];\n            nums[i]=temp;\n        }\n    }\n    for (int i=0;i<nums.length;++i){\n        if(nums[i]!=i+1)\n            return i+1;\n    }\n    return nums.length+1;\n}\n```\n\nå…¶å®ä¹Ÿæ˜¯æ¡¶æ’åºçš„æ€æƒ³ï¼Œä¸è¿‡è¿™é‡Œæ˜¯åˆ©ç”¨äº¤æ¢æ¥å®šä½æ¯ä¸ªå…ƒç´ ï¼Œé¦–ç›¸æˆ‘ä»¬å°†åŸæ•°ç»„çœ‹ä½œæ¡¶ï¼Œé¢˜ç›®è¦æ±‚çš„æ­£æ•´æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¡¶ä¸­å­˜çš„åº”è¯¥æ˜¯`ã€1ï¼Œnums.lengthã€‘`ï¼Œä¹Ÿå°±æ˜¯0ä½ç½®åº”è¯¥å­˜æ”¾çš„æ˜¯1ï¼Œ1ä½ç½®å­˜æ”¾çš„åº”è¯¥æ˜¯2....å†å½’ä½åé‡æ–°éå†æ•°ç»„ï¼Œå¦‚æœæŸä¸ªä½ç½®çš„`nums[i]!=i+1` å°±è¯´æ˜è¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªç¼ºå¤±çš„æ­£æ•°ï¼Œéå†å®Œäº†ä¹‹åæ²¡æœ‰æ‰¾åˆ°ï¼Œå…¨éƒ¨å¯¹åº”ä¸Šäº†ï¼Œé‚£å°±è¯´æ˜æˆ‘ä»¬ç¼ºå°‘çš„ç¬¬ä¸€ä¸ªæ­£æ•°æ˜¯`nums.length+1`\n\n**Update:2020.6.27**\n```golang\nfunc firstMissingPositive(nums []int) int {\n    for i:=0;i<len(nums);i++{\n        for nums[i]>0 && nums[i]<len(nums) && nums[i]!=i+1 && nums[nums[i]-1]!=nums[i]{\n            nums[nums[i]-1],nums[i]=nums[i],nums[nums[i]-1]\n        }\n    }\n    for i,n := range nums{\n        if n!=i+1{\n            return i+1\n        }\n    }\n    return len(nums)+1\n}\n```\n\n**è§£æ³•äºŒ**\n\nä¸è€ƒè™‘ç©ºé—´å¤æ‚åº¦åˆ©ç”¨æ¡¶æ’åºçš„æ€æƒ³\n\n```java\npublic int firstMissingPositive2(int[] nums) {\n        if(nums==null||nums.length<=0){\n            return 1;\n        }\n        int [] bucket=new int[nums.length];\n        for(int i=0;i<nums.length;++i){\n            if(nums[i]>0 && nums[i]<=nums.length){\n                bucket[nums[i]-1]=1; //ä»£è¡¨è¿™ä¸ªæ¡¶æœ‰å…ƒç´ äº†\n            }\n        }\n        for(int i=0;i<bucket.length;++i){\n            if(bucket[i]==0)\n                return i+1;\n        }\n        return nums.length+1;\n}\n```\n\nlcä¸Šæäº¤åçš„ç©ºé—´æ¶ˆè€—å±…ç„¶æ¯”ä¸Šé¢çš„è¿˜å°ä¸€ç‚¹ğŸ˜‚\n\n## [442. æ•°ç»„ä¸­é‡å¤çš„æ•°æ®](https://leetcode-cn.com/problems/find-all-duplicates-in-an-array/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ aï¼Œå…¶ä¸­1 â‰¤ a[i] â‰¤ n ï¼ˆnä¸ºæ•°ç»„é•¿åº¦ï¼‰, å…¶ä¸­æœ‰äº›å…ƒç´ å‡ºç°ä¸¤æ¬¡è€Œå…¶ä»–å…ƒç´ å‡ºç°ä¸€æ¬¡ã€‚\n\næ‰¾åˆ°æ‰€æœ‰å‡ºç°ä¸¤æ¬¡çš„å…ƒç´ ã€‚\n\nä½ å¯ä»¥ä¸ç”¨åˆ°ä»»ä½•é¢å¤–ç©ºé—´å¹¶åœ¨O(n)æ—¶é—´å¤æ‚åº¦å†…è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥:\n[4,3,2,7,8,2,3,1]\n\nè¾“å‡º:\n[2,3]\n```\n\n**è§£æ³•ä¸€**\n\nåŒä¸Šï¼ŒæŠ½å±‰åŸç†ï¼Œç›´æ¥ç§’æ‰è¿™ä¸‰é¢˜ hardï¼Œmidï¼Œeasy\n\n```java\npublic List<Integer> findDuplicates(int[] nums) {\n    for (int i=0;i<nums.length;i++) {\n        while(nums[i]!=i+1 && nums[i]!=nums[nums[i]-1]){\n            int temp=nums[nums[i]-1];\n            nums[nums[i]-1]=nums[i];\n            nums[i]=temp;\n        }\n    }\n    List<Integer> res=new LinkedList<>();\n    for (int i=0;i<nums.length;i++) {\n        if (nums[i]!=i+1) {\n            res.add(nums[i]);\n        }\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\næŠ€å·§æ€§çš„æ€è·¯ï¼Œå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œå°†å¯¹åº”ä½ç½®ç½®åï¼Œå¦‚æœé‡åˆ°å·²ç»ç½®åçš„å°±è¯´æ˜å½“å‰ä½ç½®é‡å¤äº†\n\n```java\n//5 1 1 3 2\npublic List<Integer> findDuplicates(int[] nums) {\n    List<Integer> res=new LinkedList<>();\n    for (int i=0;i<nums.length;i++) {\n        if (nums[Math.abs(nums[i])-1]<0) {\n            res.add(Math.abs(nums[i]));\n        }\n        nums[Math.abs(nums[i])-1]=-Math.abs(nums[Math.abs(nums[i])-1]);\n    }\n    return res;\n}\n```\n\n## [448. æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—](https://leetcode-cn.com/problems/find-all-numbers-disappeared-in-an-array/)\n\nç»™å®šä¸€ä¸ªèŒƒå›´åœ¨  1 â‰¤ a[i] â‰¤ n ( n = æ•°ç»„å¤§å° ) çš„ æ•´å‹æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ ä¸€äº›å‡ºç°äº†ä¸¤æ¬¡ï¼Œå¦ä¸€äº›åªå‡ºç°ä¸€æ¬¡ã€‚\n\næ‰¾åˆ°æ‰€æœ‰åœ¨ [1, n] èŒƒå›´ä¹‹é—´æ²¡æœ‰å‡ºç°åœ¨æ•°ç»„ä¸­çš„æ•°å­—ã€‚\n\næ‚¨èƒ½åœ¨ä¸ä½¿ç”¨é¢å¤–ç©ºé—´ä¸”æ—¶é—´å¤æ‚åº¦ä¸ºO(n)çš„æƒ…å†µä¸‹å®Œæˆè¿™ä¸ªä»»åŠ¡å—? ä½ å¯ä»¥å‡å®šè¿”å›çš„æ•°ç»„ä¸ç®—åœ¨é¢å¤–ç©ºé—´å†…ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥:\n[4,3,2,7,8,2,3,1]\n\nè¾“å‡º:\n[5,6]\n```\n\n**è§£æ³•ä¸€**\n\né¦–å…ˆæƒ³åˆ°çš„è§£æ³•ï¼Œåˆ©ç”¨çš„å’Œä¸Šé¢ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°ä¸€æ ·çš„æ€è·¯ï¼ŒæŠ½å±‰åŸç†ï¼Œå½’ä½æ¯ä¸ªæ•°å­—ï¼Œæœ€åæ²¡æœ‰å½’ä¸ºçš„indexå°±æ˜¯æ¶ˆå¤±çš„æ•°å­—\n\n```java\npublic List<Integer> findDisappearedNumbers(int[] nums) {\n    //nums[i]=i+1\n    for (int i=0;i<nums.length;i++) {\n        while(nums[i]!=i+1 && nums[nums[i]-1]!=nums[i]){\n            int temp=nums[i];\n            nums[i]=nums[temp-1];\n            nums[temp-1]=temp;\n            //nums[i]=nums[nums[i]-1]; æœ€å¼€å§‹çš„é”™è¯¯å†™æ³•\n            //nums[nums[i]-1]=temp;\n        }\n    }\n    List<Integer> res=new LinkedList<>();\n    for (int i=0;i<nums.length;i++) {\n        if (nums[i]!=i+1) {\n            res.add(i+1);\n        }\n    }\n    return res;\n}\n```\n\nä¸­é—´å†™å‡ºäº†ä¸€ä¸ªå°`bug`ï¼Œäº¤æ¢ä¸¤ä¸ªå…ƒç´ çš„æ—¶å€™å…ˆäº¤æ¢äº†`nums[i]`ï¼Œå¯¼è‡´äº†åé¢çš„`nums[nums[i]+1]` å‘ç”Ÿäº†å˜åŒ–ï¼Œç„¶åå°±æ­»å¾ªç¯äº†ğŸ˜‚ï¼Œè°ƒè¯•äº†ä¸€ä¸‹æ‰çœ‹å‡ºæ¥ï¼Œå¤ªèœäº†\n\n**è§£æ³•äºŒ**\n\nå¾ˆå·§å¦™çš„æ–¹æ³•\n\n```java\n//å¾ˆå·§å¦™\npublic List<Integer> findDisappearedNumbers(int[] nums) {\n    //nums[i]=i+1\n    //5 1 4 2 3\n    for (int i=0;i<nums.length;i++) {\n        nums[Math.abs(nums[i])-1]=-Math.abs(nums[Math.abs(nums[i])-1]);\n    }\n    List<Integer> res=new LinkedList<>();\n    for (int i=0;i<nums.length;i++) {\n        if (nums[i]>0) {\n            res.add(i+1);\n        }\n    }\n    return res;\n}\n```\n\né¢˜ç›®ç»™å®šäº†æ•°å€¼çš„èŒƒå›´å°±æ˜¯`[1,n]`æ‰€ä»¥å¯ä»¥éå†æ¯ä¸ªå…ƒç´ ï¼Œå°†è¯¥å…ƒç´ æ­£ç¡®ä½ç½®çš„å€¼å–åç½®ä¸ºè´Ÿæ•°\n\næ¯”å¦‚ `5 1 1 3 2` éå†åˆ°5çš„æ—¶å€™å°±ä¼šå°†æœ«å°¾çš„2å˜ä¸º-2ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæœ€åå¾—åˆ°çš„å°±æ˜¯`[-5,-1,-1,3,-2]` ï¼Œæœ€åå†éå†ä¸€éï¼Œå…¶ä¸­å€¼ä¸ºæ­£æ•°çš„å…ƒç´ çš„ç´¢å¼•+1å°±æ˜¯æ¶ˆå¤±çš„æ•°å­—\n\n## [75. é¢œè‰²åˆ†ç±»](https://leetcode-cn.com/problems/sort-colors/)\n\nç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ï¼Œä¸€å…± *n* ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œ**åŸåœ°**å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚\n\næ­¤é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚\n\n**æ³¨æ„:**\nä¸èƒ½ä½¿ç”¨ä»£ç åº“ä¸­çš„æ’åºå‡½æ•°æ¥è§£å†³è¿™é“é¢˜ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [2,0,2,1,1,0]\nè¾“å‡º: [0,0,1,1,2,2]\n```\n\n**è¿›é˜¶ï¼š**\n\n- ä¸€ä¸ªç›´è§‚çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è®¡æ•°æ’åºçš„ä¸¤è¶Ÿæ‰«æç®—æ³•ã€‚\n  é¦–å…ˆï¼Œè¿­ä»£è®¡ç®—å‡º0ã€1 å’Œ 2 å…ƒç´ çš„ä¸ªæ•°ï¼Œç„¶åæŒ‰ç…§0ã€1ã€2çš„æ’åºï¼Œé‡å†™å½“å‰æ•°ç»„ã€‚\n- ä½ èƒ½æƒ³å‡ºä¸€ä¸ªä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´çš„ä¸€è¶Ÿæ‰«æç®—æ³•å—ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®ä¸Šå·²ç»æœ‰äº†æç¤ºï¼Œå¾ˆç›´è§‚çš„åšæ³•å°±æ˜¯åˆ©ç”¨æ¡¶æ’åºçš„æ–¹æ³•\n\n```java\npublic static void sortColors(int[] nums) {\n    int [] bucket=new int[3];\n    //åŸºäºæ¡¶æ’åº\n    for (int i=0;i<nums.length;i++){\n        bucket[nums[i]]++;\n    }\n    int index=0;\n    //é‡æ–°æ„é€ å‡ºæ¥\n    for (int i=0;i<nums.length;i++) {\n        while (bucket[index]<=0) {\n            index++;\n        }\n        nums[i]=index;\n        bucket[index]--;\n    }\n}\n```\n\nå½“ç„¶è¿˜æœ‰æ›´ä¼˜ç§€çš„åšæ³•ï¼Œåˆ©ç”¨**ä¸‰å‘åˆ‡åˆ†å¿«æ’**çš„æ€æƒ³(è·å…°å›½æ——é—®é¢˜)\n\n```java\npublic static void sortColors(int[] nums) {\n    int less=-1,more=nums.length-1;\n    int l=0;\n    while(l<=more){\n        if(nums[l]<1){\n            swap(nums,++less,l++);\n        } else if(nums[l]>1){\n            swap(nums,more--,l);\n        } else{ \n            l++;\n        }\n    }\n}\n\npublic static swap(int []nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\n## [125. éªŒè¯å›æ–‡ä¸²](https://leetcode-cn.com/problems/valid-palindrome/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œåªè€ƒè™‘å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œå¯ä»¥å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚\n\n**è¯´æ˜ï¼š**æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†ç©ºå­—ç¬¦ä¸²å®šä¹‰ä¸ºæœ‰æ•ˆçš„å›æ–‡ä¸²ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"A man, a plan, a canal: Panama\"\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"race a car\"\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\neasyé¢˜ï¼Œå¯¹æ’æŒ‡é’ˆ\n\n```java\npublic Boolean isPalindrome(String s) {\n    if(s==null||s.length()<=1){\n        return true;\n    }\n    s=s.toLowerCase();\n    int left=0,right=s.length()-1;\n    while(left<right){\n        char lch=s.charAt(left);\n        char rch=s.charAt(right);\n        if(isNumOrchar(lch) && isNumOrchar(rch)){\n            //System.out.println(lch+\",\"+rch);\n            if(lch==rch){\n                left++;\n                right--;\n            } else{\n                return false;\n            }\n        } else if((!isNumOrchar(lch)) && isNumOrchar(rch)){\n            left++;\n        } else if(isNumOrchar(lch) && !isNumOrchar(rch)){\n            right--;\n        } else{\n            left++;\n            right--;\n        }\n    }\n    return true;\n}\n\npublic Boolean isNumOrchar(char ch){\n    if((ch>='0' && ch<='9') || (ch>='a' && ch<='z') || (ch>='A' &&  ch<='Z')){\n        return true;\n    }\n    return false;\n}\n```\n\nä»£ç å†™å¤šäº†ï¼Œä¸å¤Ÿç®€æ´ï¼Œå…¶å®å¯ä»¥ç›´æ¥ç”¨**Character**çš„API\n\n```java\npublic Boolean isPalindrome(String s) {\n    if (s == null) return false;\n    if (s.length() == 0) return true;\n    int i = 0;\n    int j = s.length() - 1;\n    while (i < j) {\n        while (i < j && !Character.isLetterOrDigit(s.charAt(i))) i++;\n        while (i < j && !Character.isLetterOrDigit(s.charAt(j))) j--;\n        if (Character.toLowerCase(s.charAt(i)) != Character.toLowerCase(s.charAt(j))){\n            return false;\n        }\n        i++;\n        j--;\n    }\n    return true;\n}\n```\n\n\n\n## [345. åè½¬å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯](https://leetcode-cn.com/problems/reverse-vowels-of-a-string/)\n\nWrite a function that takes a string as input and reverse only the vowels of a string.\n\n**Example 1:**\n\n```\nInput: \"hello\"\nOutput: \"holle\"\n```\n\n**Example 2:**\n\n```\nInput: \"leetcode\"\nOutput: \"leotcede\"\n```\n\n**Note:**\nThe vowels does not include the letter \"y\".\n\n```java\npublic String reverseVowels(String s) {\n    if(s==null||s.length()<=0){\n        return s;\n    }\n    char[] ss=s.toCharArray();\n    int left=0,right=s.length()-1;\n    while(left<right){\n        while(left<right && !isYy(ss[left])){\n            left++;\n        }\n        while(left<right && !isYy(ss[right])){\n            right--;\n        }\n        swap(left++,right--,ss);\n    }\n    return new String(ss);\n}\n\npublic Boolean isYy(char ch){\n    char temp=Character.toLowerCase(ch);\n    return temp=='a'|| temp=='e'||temp=='i'||temp=='o'||temp=='u';\n}\n\npublic void swap(int a,int b,char[] s){\n    char temp=s[a];\n    s[a]=s[b];\n    s[b]=temp;\n}\n```\n\nå¾ˆç®€å•çš„å¯¹æ’æŒ‡é’ˆé¢˜\n\n## [88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„](https://leetcode-cn.com/problems/merge-sorted-array/)\n\nGiven two sorted integer arrays *nums1* and *nums2*, merge *nums2* into *nums1* as one sorted array.\n\n**Note:**\n\n- The number of elements initialized in *nums1* and *nums2* are *m* and *n* respectively.\n- You may assume that *nums1* has enough space (size that is greater or equal to *m* + *n*) to hold additional elements from *nums2*.\n\n**Example:**\n\n```java\nInput:\nnums1 = [1,2,3,0,0,0], m = 3\nnums2 = [2,5,6],       n = 3\n\nOutput: [1,2,2,3,5,6]\n```\n\n**è§£æ³•ä¸€**\n\nå…¸å‹çš„äºŒè·¯å½’å¹¶\n\n```java\npublic static void merge(int[] nums1, int m, int[] nums2, int n) {\n    if(nums1.length<=0||nums2.length<=0){\n        return;\n    }\n    int []res=new int[m+n];\n    int i1=0,i2=0;\n    for (int i=0;i1<m&&i2<n;i++) {\n        if(nums1[i1]<=nums2[i2]) {\n            res[i]=nums1[i1++];\n        } else if(nums1[i1]>nums2[i2] ){\n            res[i]=nums2[i2++];\n        }\n    }\n    if(i1>=m){\n        System.arraycopy(nums2,i2,res,i2+m,n-i2);\n    } else{\n        System.arraycopy(nums1,i1,res,i1+n,m-i1);\n    }\n    System.arraycopy(res,0,nums1,0,res.length);\n}\n```\n\n1ms ï¼Œ98%beats.\n\n**è§£æ³•äºŒ**\n\nçœ‹äº†ä¸‹è¯„è®ºåŒºå‘ç°è‡ªå·±è¿˜æ˜¯å¤ªå¹´è½»äº†ï¼ŒåŸæ¥è¿™é¢˜æ˜¯å¯ä»¥åœ¨**O(1)**çš„ç©ºé—´å¤æ‚åº¦ä¸‹å®Œæˆçš„\n\n```java\npublic static void merge3(int[] nums1, int m, int[] nums2, int n) {\n    if(nums1.length<=0||nums2.length<=0){\n        return;\n    }\n    int i1=m-1,i2=n-1;\n    for (int i=m+n-1;i>=0;i--) {\n        if(i1<0){\n            nums1[i]=nums2[i2--];\n        } else if(i2<0){\n            nums1[i]=nums1[i1--];\n        } else if(nums1[i1]>nums2[i2]) {\n            nums1[i]=nums1[i1--];\n        } else if(nums1[i1]<=nums2[i2] ){\n            nums1[i]=nums2[i2--];\n        }\n    }\n}\n```\n\nåˆå¹¶åçš„é•¿åº¦ç¡®å®šï¼Œnums1çš„ç©ºé—´ä¹Ÿè¶³å¤Ÿï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥ä»åå¾€å‰ï¼Œä»å¤§åˆ°å°ï¼Œä»è€Œé¿å…äº†ä½¿ç”¨é¢å¤–çš„ç©ºé—´å‚¨å­˜ç»“æœï¼Œå­¦åˆ°äº†å­¦åˆ°äº†ğŸ‘\n\n**è§£æ³•ä¸‰**\n\næ—¶éš”å¤šå¹´ï¼ŒLeetCodeæ‰“å¡åˆåšäº†ä¸€éï¼Œè¿™æ¬¡ç›´æ¥æƒ³åˆ°äº†æœ€ä¼˜è§£ï¼Œè€Œä¸”ä»£ç å¾ˆç®€æ´\n\n```java\npublic void merge(int[] A, int m, int[] B, int n) {\n    if(n==0 )  return;\n    int len=A.length,ai=m-1,bi=n-1,i=len-1;\n    while(ai>=0 && bi>=0) A[i--]=A[ai] > B[bi] ? A[ai--]:B[bi--];\n    while(bi>=0) A[i--]=B[bi--];\n    //aiå‰©ä½™çš„ä¸ç”¨ç®¡\n}\n```\n## [532. é€†åºå¯¹](https://www.lintcode.com/problem/reverse-pairs/description)\n\nï¼ˆæ¥è‡ªé¢†æ‰£ï¼‰\n\nåœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—å¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚ç»™ä½ ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­é€†åºå¯¹çš„æ€»æ•°ã€‚\næ¦‚æ‹¬ï¼šå¦‚æœa[i] > a[j] ä¸” i < jï¼Œ a[i] å’Œ a[j] æ„æˆä¸€ä¸ªé€†åºå¯¹ã€‚\n\n**æ ·ä¾‹1**\n\n```java\nè¾“å…¥: A = [2, 4, 1, 3, 5]\nè¾“å‡º: 3\nè§£é‡Š:\n(2, 1), (4, 1), (4, 3) æ˜¯é€†åºå¯¹\n```\n\n**æ ·ä¾‹2**\n\n```java\nè¾“å…¥: A = [1, 2, 3, 4]\nè¾“å‡º: 0\nè§£é‡Š:\næ²¡æœ‰é€†åºå¯¹\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic long reversePairs(int[] A) {\n    if (A==null || A.length<=0) {\n        return 0;\n    }\n    return reversePairs(A,0,A.length-1);\n}\n\npublic long reversePairs(int[] A,int left,int right) {\n    if (left == right) {\n        return 0;\n    }\n    int mid=left+(right-left)/2;\n    long l=reversePairs(A,left,mid);\n    long r=reversePairs(A,mid+1,right);\n    return merge(A,left,mid,right)+l+r;\n}\n\npublic long merge(int[] nums,int left,int mid,int right){\n    long res=0;\n    int[] help=new int[right-left+1];\n    int i=left,j=mid+1;\n    int index=0;\n    while(i<=mid && j<=right){\n        //å°äºç­‰äºçš„æ—¶å€™è®©iå…ˆè¿›æ ˆ\n        //help[index++]=nums[i]<=nums[j] ? nums[i++]:nums[j++];\n        if (nums[i]<=nums[j]) {\n            help[index++] = nums[i++];\n        }else{\n            help[index++] = nums[j++];\n            res+= mid-i+1; //jå’Œi-midé—´çš„æ‰€æœ‰å…ƒç´ å½¢æˆé€†åºå¯¹\n        }\n    }\n    while(i<=mid){\n        help[index++]=nums[i++];\n    }\n    while(j<=right){\n        help[index++]=nums[j++];\n    }\n\n    for (int k=0;k<help.length;k++) {\n        nums[left+k]=help[k];\n    }\n    return res;\n}\n```\n\nå½’å¹¶æ’åºçš„æ€è·¯ï¼Œæœ€å¼€å§‹æˆ‘æ˜¯åœ¨æ¯æ¬¡i>jå’Œæœ€åæ”¶å°¾çš„æ—¶å€™res++ï¼Œç„¶åç»“æœæ€»æ˜¯ä¸å¯¹ï¼Œç„¶åå–æŸ¥äº†ç­”æ¡ˆæ‰æ„è¯†åˆ°ä¸èƒ½è¿™æ ·ç®—ï¼Œå½“`nums[i] > nums[j]` çš„æ—¶å€™ï¼Œ`i~j` å½¢æˆçš„é€†åºå¯¹å…¶å®ä¸åªä¸€ä¸ªï¼Œè€Œæ˜¯`[i,mid]` åŒºé—´çš„æ‰€æœ‰å…ƒç´ ï¼Œå¦‚æœä½ åªæ˜¯+1çš„è¯å°±ä¼šæ¼æ‰è®¸å¤šæƒ…å†µï¼Œå› ä¸ºä¸‹ä¸€æ­¥ `j++` å°±ä¼šå°† `j` å‘åç§»åŠ¨ï¼Œé‚£äº›æƒ…å†µå°±è€ƒè™‘ä¸åˆ°äº†\n\n## [315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼ŒæŒ‰è¦æ±‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ countsã€‚æ•°ç»„ counts æœ‰è¯¥æ€§è´¨ï¼š counts[i] çš„å€¼æ˜¯  nums[i] å³ä¾§å°äº nums[i] çš„å…ƒç´ çš„æ•°é‡ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [5,2,6,1]\nè¾“å‡º: [2,1,1,0] \nè§£é‡Š:\n5 çš„å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„å…ƒç´  (2 å’Œ 1).\n2 çš„å³ä¾§ä»…æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1).\n6 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1).\n1 çš„å³ä¾§æœ‰ 0 ä¸ªæ›´å°çš„å…ƒç´ .\n```\n\n**é”™è¯¯è§£æ³•ä¸€**\n\nè¿™ä¸ªbugæˆ‘å¤§æ¦‚çœ‹äº†æœ‰ä¸¤ä¸‰ä¸ªå°æ—¶ï¼Œäººéƒ½çœ‹å‚»äº†ï¼Œå¿…é¡»æ”¾ä¸Šæ¥çºªå¿µä¸‹\n\n```go\nimport(\n    \"fmt\"\n)\ntype Element struct{\n    idx int\n    val int\n}\n\nfunc countSmaller(nums []int) []int {\n    n:=len(nums)\n    count:=make([]int,n)\n    elements:=make([]Element,n)\n    for i,num:=range nums{\n        elements[i].idx=i\n        elements[i].val=num\n    }\n    fmt.Println(elements);\n    mergeSort(elements,0,n-1,count)\n    return count\n}\n\nfunc mergeSort(num []Element,left int,right int,count []int){\n    if left>=right{\n        return\n    }\n    mid:=left+(right-left)/2\n    mergeSort(num,left,mid,count)\n    mergeSort(num,mid+1,right,count)\n    merge(num,left,mid,right,count)\n}\n\nfunc merge(num []Element,left int,mid int,right int,count []int){\n    help:=make([]int,right-left+1)\n    i:=left\n    j:=mid+1\n    index:=0\n    for i<=mid && j<=right {\n        if num[i].val<=num[j].val{ //è¯´æ˜jå‰é¢çš„å…ƒç´ éƒ½å°äºi\n            count[num[i].idx]+=(j-mid-1)\n            help[index]=num[i].val\n            i++\n        }else{\n            help[index]=num[j].val\n            j++\n        }\n        index++\n    }\n    for i<=mid{\n        count[num[i].idx]+=(j-mid-1)\n        help[index]=num[i].val\n        index++\n        i++\n    }\n    for j<=right{\n        help[index]=num[j].val\n        index++\n        j++\n    }\n    for i:=left;i<=right;i++{\n        num[i].val=help[i-left]\n    }\n}\n```\n\nä¸€å¼€å§‹ç”¨goå†™çš„ï¼Œè°ƒäº†åŠå¤©æ²¡è°ƒå‡ºæ¥ï¼Œæˆ‘ä»¥ä¸ºæ˜¯goçš„å•¥é—®é¢˜ï¼ˆåˆšå­¦goä¸å¤ªç†Ÿï¼‰ç„¶åç”¨Javaåˆå†™äº†ä¸€é\n\n```java\nclass Solution {\n    public List<Integer> countSmaller(int[] nums) {\n        Pair[] pair=new Pair[nums.length];\n        for(int i=0;i<nums.length;i++){\n            pair[i]=new Pair(i,nums[i]);\n        }\n        int[] count=new int[nums.length];\n        mergeSort(pair,0,nums.length-1,count);\n        List<Integer> res=new ArrayList<>();\n        for(int i=0;i<count.length;i++){\n            res.add(count[i]);\n        }\n        return res;\n    }\n\n    public void mergeSort(Pair[] nums,int left,int right,int[] count){\n        if(left>=right){\n            return;\n        }\n        int mid=left+(right-left)/2;\n        mergeSort(nums,left,mid,count);\n        mergeSort(nums,mid+1,right,count);\n        merge(nums,left,mid,right,count);\n    }\n\n    public void merge(Pair [] nums,int left,int mid,int right,int[] count){\n        int i=left,j=mid+1;\n        //å‡ºBugçš„åœ°æ–¹ï¼Œåº”è¯¥ç”¨ Pair[] \n        int[] helper=new int[right-left+1];\n        int index=0;\n        while(i<=mid && j<=right){\n            if(nums[i].value>nums[j].value){\n                helper[index++]=nums[j++].value;\n            }else{\n                count[nums[i].index]+=j-mid-1;\n                helper[index++]=nums[i++].value;\n            }\n        }\n        while(i<=mid){\n            count[nums[i].index]+=j-mid-1;\n            helper[index++]=nums[i++].value;\n        }\n        while(j<=right){\n            helper[index++]=nums[j++].value;\n        }\n        for(int k=0;k<helper.length;k++){\n            //è¿™é‡Œæ— å½¢ä¹‹ä¸­å°†ç´¢å¼•å’Œæ•°æ®çš„å¯¹åº”å…³ç³»æ‰“ä¹±äº†ã€‚ã€‚ã€‚ã€‚ã€‚\n            nums[left+k].value=helper[k];\n        }\n    }\n\n    class Pair{\n        int index;\n        int value;\n        public Pair(int i,int v){\n            index=i;\n            value=v;\n        }\n    }\n}\n```\n\nè¿˜æ˜¯ä¸å¯¹ï¼Œå’Œä¹‹å‰goçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè¿™æ®µä»£ç æˆ‘åå¤åœ°çœ‹äº†3ä¸ªå°æ—¶ï¼Œæ¥æ˜¯æ²¡çœ‹å‡ºæ¥å“ªé‡Œå†™é”™äº†ï¼Œæˆ‘æ˜¯çœŸçš„èœå•Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n\n**è§£æ³•ä¸€**\n\nå…¶å®å’Œé€†åºå¯¹çš„è§£æ³•æ˜¯ç±»ä¼¼çš„ï¼Œæ€è·¯éƒ½åœ¨æ³¨é‡Šä¸­\n\n```java\npublic List<Integer> countSmaller(int[] nums) {\n    Pair[] pair=new Pair[nums.length];\n    for(int i=0;i<nums.length;i++){\n        pair[i]=new Pair(i,nums[i]);\n    }\n    int[] count=new int[nums.length];\n    mergeSort(pair,0,nums.length-1,count);\n    List<Integer> res=new ArrayList<>();\n    for(int i=0;i<count.length;i++){\n        res.add(count[i]);\n    }\n    return res;\n}\n\npublic void mergeSort(Pair[] nums,int left,int right,int[] count){\n    if(left>=right){\n        return;\n    }\n    int mid=left+(right-left)/2;\n    mergeSort(nums,left,mid,count);\n    mergeSort(nums,mid+1,right,count);\n    merge(nums,left,mid,right,count);\n}\n\npublic void merge(Pair [] nums,int left,int mid,int right,int[] count){\n    int i=left,j=mid+1;\n    Pair[] helper=new Pair[right-left+1];\n    int index=0;\n    while(i<=mid && j<=right){\n        if(nums[i].value>nums[j].value){\n            helper[index++]=nums[j++];\n        }else{\n            //i<=j é‚£ä¹ˆmid+1~j-1çš„è‚¯å®šéƒ½æ¯”iå°\n            //(j-1)-(mid+1)+1=j-mid-1\n            count[nums[i].index]+=j-mid-1;\n            helper[index++]=nums[i++];\n        }\n    }\n    while(i<=mid){\n        //jæ²¡äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„jçš„å…ƒç´ éƒ½æ¯”iå°\n        //ç­‰ä»·äºright-mid\n        count[nums[i].index]+=j-mid-1;\n        helper[index++]=nums[i++];\n    }\n    while(j<=right){\n        helper[index++]=nums[j++];\n    }\n    for(int k=0;k<helper.length;k++){\n        nums[left+k]=helper[k];\n    }\n}\n\nclass Pair{\n    int index;\n    int value;\n    public Pair(int i,int v){\n        index=i;\n        value=v;\n    }\n}\n```\n\n> è¿™é¢˜è¿˜å¯ä»¥ç”¨**æ ‘çŠ¶æ•°ç»„**è§£ï¼Œä½†æ˜¯æˆ‘æš‚æ—¶è¿˜ä¸ä¼šï¼Œåé¢æœ‰æ—¶é—´å­¦äº†å†æ¥è¡¥å……ï¼Œå…¶å®è¿˜å¯ä»¥ç”¨çº¿æ®µæ ‘ï¼ŒäºŒå‰æœç´¢æ ‘ç­‰ç­‰ï¼Œæœ‰ç‚¹éº»çƒ¦ï¼Œç®—äº†\n\n## [118. æ¨è¾‰ä¸‰è§’](https://leetcode-cn.com/problems/pascals-triangle/)\n\nGiven a non-negative integer *numRows*, generate the first *numRows* of Pascal's triangle.\n\n![img](https://upload.wikimedia.org/wikipedia/commons/0/0d/PascalTriangleAnimated2.gif)\nIn Pascal's triangle, each number is the sum of the two numbers directly above it.\n\n**Example:**\n\n```java\nInput: 5\nOutput:\n[\n     [1],\n    [1,1],\n   [1,2,1],\n  [1,3,3,1],\n [1,4,6,4,1]\n]\n```\n\né€’å½’ä¸“é¢˜é‡Œé¢çš„é¢˜ç›®ï¼Œæ‰€ä»¥ç›´æ¥ç”¨é€’å½’æ¥å®ç°äº†ä¸‹ã€‚\n\n```java\npublic static List<List<Integer>> generate(int numRows) {\n    if(numRows<=0) {\n        return new ArrayList();\n    }\n    List<List<Integer>> res = new ArrayList<>();\n    res.add(new ArrayList<Integer>() {\n        {\n            add(1);\n        }\n    }\n    );\n    generate(1, res.get(0), res, numRows);\n    return res;\n}\n\npublic static void generate(int numRow, List<Integer> preRow, List<List<Integer>> res, int rowMax) {\n    if (rowMax == numRow) {\n        return;\n    }\n    List<Integer> row = new ArrayList<>();\n    row.add(1);\n    for (int i = 1; i < preRow.size(); i++) {\n        row.add(preRow.get(i - 1) + preRow.get(i));\n    }\n    row.add(1);\n    res.add(row);\n    generate(numRow + 1,row,res,rowMax);\n}\n```\n\nå°¾é€’å½’ï¼Œå¾ˆé¸¡è‚‹ã€‚\n\n## [119. æ¨è¾‰ä¸‰è§’ II](https://leetcode-cn.com/problems/pascals-triangle-ii/)\n\nGiven a non-negative index *k* where *k* â‰¤ 33, return the *k*th index row of the Pascal's triangle.\n\nNote that the row index starts from 0.\n\n![img](https://upload.wikimedia.org/wikipedia/commons/0/0d/PascalTriangleAnimated2.gif)\nIn Pascal's triangle, each number is the sum of the two numbers directly above it.\n\n**Example:**\n\n```java\nInput: 3\nOutput: [1,3,3,1]\n```\n\n**Follow up:**\n\nCould you optimize your algorithm to use only *O*(*k*) extra space?\n\n```java\n public List<Integer> getRow(int rowIndex) {\n        List<Integer> res=new ArrayList<>();\n        long cur=1;\n        res.add((int)cur);\n        for(int i=1;i<=rowIndex;i++){\n            cur=cur*(rowIndex-i+1)/i;\n            res.add((int)cur);\n        }\n        return res;\n }\n```\n\nç›´æ¥åˆ©ç”¨ç»„åˆæ•°çš„å…¬å¼ï¼Œmåˆ—ç¬¬nä¸ªå…ƒç´ ç­‰äºC(n-1,M-1)\n\n## [54. èºæ—‹çŸ©é˜µ](https://leetcode-cn.com/problems/spiral-matrix/)\n\nç»™å®šä¸€ä¸ªåŒ…å« m x n ä¸ªå…ƒç´ çš„çŸ©é˜µï¼ˆm è¡Œ, n åˆ—ï¼‰ï¼Œè¯·æŒ‰ç…§é¡ºæ—¶é’ˆèºæ—‹é¡ºåºï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n[\n [ 1, 2, 3 ],\n [ 4, 5, 6 ],\n [ 7, 8, 9 ]\n]\nè¾“å‡º: [1,2,3,6,9,8,7,4,5]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥:\n[\n  [1, 2, 3, 4],\n  [5, 6, 7, 8],\n  [9,10,11,12]\n]\nè¾“å‡º: [1,2,3,4,8,12,11,10,9,5,6,7]\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å¾ˆä¹…ä¹‹å‰åšè¿‡ï¼Œè¿™æ¬¡åˆæ¥åšçš„æ—¶å€™è¿˜æ˜¯æ²¡åšå‡ºæ¥ï¼Œå¿˜äº†ä¹‹å‰å’‹åšçš„äº†ï¼Œç”¨æ¨¡æ‹Ÿçš„æ–¹æ³•æäº†åŠå¤©ï¼Œæ²¡æå‡ºæ¥ï¼Œç„¶åç„äº†ä¸€çœ¼ä¹‹å‰å†™çš„æ‰å†™å‡ºæ¥....\n\n```java\npublic static List<Integer> spiralOrder2(int[][] matrix) {\n    List<Integer> res=new ArrayList<>();\n    if(matrix.length<=0){\n        return res;\n    }\n    //a: è¡Œ\n    //b: åˆ—\n    int la=0,lb=0,ra=matrix.length-1,rb=matrix[0].length-1;\n    //ç»ˆæ­¢æ¡ä»¶\n    while(lb<=rb && la<=ra){\n        //ç¼“å­˜å„ä¸ªåæ ‡\n        int tla=la,tlb=lb,tra=ra,trb=rb;\n        //ç‰¹æ®Šæƒ…å†µï¼Œç‰¹æ®Šå¤„ç†\n        if(tla==tra){//åŒä¸€è¡Œ\n            while(tlb<=trb){\n                res.add(matrix[tla][tlb++]);\n            }\n            return res;\n        }else if(tlb==trb){//åŒä¸€åˆ—\n            while(tla<=tra){\n                res.add(matrix[tla++][tlb]);\n            }\n            return res;\n        }else{\n            //å‘å·¦\n            while(tlb<rb){\n                res.add(matrix[tla][tlb++]);\n            }\n\t\t\t//å‘ä¸‹\n            while(tla<ra){\n                res.add(matrix[tla++][tlb]);\n            }\n\t\t\t//å‘å³\n            while(trb>lb){\n                res.add(matrix[tra][trb--]);\n            }\n\t\t\t//å‘ä¸Š\n            while(tra>la){\n                res.add(matrix[tra--][trb]);\n            }\n        }\n        //å‘å†…é æ‹¢(ç¼©åœˆ)\n        la++;\n        lb++;\n        ra--;\n        rb--;\n    }\n    return res;\n}\n```\n\næ¨¡æ‹Ÿçš„æ–¹å¼ç›¸å¯¹è¦å¤æ‚ç‚¹ï¼Œéœ€è¦è®°å½•æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦è®¿é—®ç„¶ååœ¨é€‰æ‹©ï¼Œè¿™é‡Œçš„æ–¹å¼å°±å¾ˆå·§å¦™ï¼Œç›´æ¥æŒ‰å±‚éå†ï¼Œç”±å¤–åˆ°å†…ï¼Œä¸ç”¨è€ƒè™‘é‚£ä¹ˆå¤šã€‚æ—¶é—´å¤æ‚åº¦`O(NM)`ç©ºé—´å¤æ‚åº¦`O(NM)`ã€‚\n\n## [59. èºæ—‹çŸ©é˜µ II](https://leetcode-cn.com/problems/spiral-matrix-ii/)\n\nç»™å®šä¸€ä¸ªæ­£æ•´æ•° nï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å« 1 åˆ° n^2 æ‰€æœ‰å…ƒç´ ï¼Œä¸”å…ƒç´ æŒ‰é¡ºæ—¶é’ˆé¡ºåºèºæ—‹æ’åˆ—çš„æ­£æ–¹å½¢çŸ©é˜µã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: 3\nè¾“å‡º:\n[\n [ 1, 2, 3 ],\n [ 8, 9, 4 ],\n [ 7, 6, 5 ]\n]\n```\n\n**è§£æ³•ä¸€**\n> UPDATE(2020.12.17)ï¼šæ›´æ–°äº†é€šç”¨çš„è§£æ³•ï¼Œå¯¹åº”[AcWing756.è›‡å½¢çŸ©é˜µ](https://www.acwing.com/problem/content/description/758/)ï¼Œç¾åŒ–äº†ä¸‹ä»£ç \n```java\nimport java.io.*;\nimport java.util.*;\n\nclass Main {\n\n    public static void main(String... args) {\n        Scanner sc = new Scanner(System.in);\n        int n = sc.nextInt();\n        int m = sc.nextInt();\n        int v = 1;\n        int[][] res = new int[n][m];\n        int la = 0, lb = 0;\n        int ra = n-1, rb = m-1;\n        while (la <= ra && lb <= rb) {\n            int tla = la, tlb = lb;\n            int tra = ra, trb = rb;\n            if (la == ra) {\n                while (tlb <= rb) res[la][tlb++] = v++;\n                break;\n            }\n            if (lb == rb) {\n                while (tla <= ra) res[tla++][rb] = v++;\n                break;\n            }\n            while (tlb < rb) res[la][tlb++] = v++;\n            while (tla < ra) res[tla++][rb] = v++;\n            while (trb > lb) res[ra][trb--] = v++;\n            while (tra > la) res[tra--][lb] = v++;\n            la++; lb++;\n            ra--; rb--;\n        }\n        \n        for (int i = 0; i < n; i++) {\n            for (int j = 0; j < m; j++) {\n                System.out.print(res[i][j] + \" \");\n            }\n            System.out.println();\n        }\n    } \n}\n```\n\nä¸Šä¸€é¢˜çš„ç®€åŒ–ç‰ˆï¼Œ2020.2.11ç™½æ¿å†™çš„ï¼Œè¿˜è¡Œ\n\n## [48. æ—‹è½¬å›¾åƒ](https://leetcode-cn.com/problems/rotate-image/)\n\nç»™å®šä¸€ä¸ª *n* Ã— *n* çš„äºŒç»´çŸ©é˜µè¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚\n\nå°†å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚\n\n**è¯´æ˜ï¼š**\n\nä½ å¿…é¡»åœ¨**åŸåœ°**æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚**è¯·ä¸è¦**ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚\n\n**Example 1:**\n\n```java\nGiven input matrix = \n[\n  [1,2,3],\n  [4,5,6],\n  [7,8,9]\n],\n\nrotate the input matrix in-place such that it becomes:\n[\n  [7,4,1],\n  [8,5,2],\n  [9,6,3]\n]\n```\n\n**Example 2:**\n\n```java\nGiven input matrix =\n[\n  [ 5, 1, 9,11],\n  [ 2, 4, 8,10],\n  [13, 3, 6, 7],\n  [15,14,12,16]\n], \n\nrotate the input matrix in-place such that it becomes:\n[\n  [15,13, 2, 5],\n  [14, 3, 4, 1],\n  [12, 6, 8, 9],\n  [16, 7,10,11]\n]\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å’Œä¸Šé¢å“ªä¸€é¢˜æ”¾åœ¨ä¸€èµ·å¾ˆæœ‰å¿…è¦ï¼Œå¾ˆç±»ä¼¼çš„é¢˜å‹\n\n```java\npublic void rotate(int[][] matrix) {\n    if (matrix==null || matrix.length==0) {\n        return;\n    }\n    int len=matrix.length-1;\n    int lx=0,ly=0,rx=len,ry=len;\n    while(lx<=rx){\n        //len=ry-ly;\n        for (int i=0;i<len;i++) {\n            int temp=matrix[lx][ly+i];\n            matrix[lx][ly+i]=matrix[rx-i][ly];\n            matrix[rx-i][ly]=matrix[rx][ry-i];\n            matrix[rx][ry-i]=matrix[lx+i][ry];\n            matrix[lx+i][ry]=temp;\n        }\n        //ç¼©åœˆ\n        len-=2; //å†™ry-lyå¯èƒ½ä¼šå¥½ä¸€ç‚¹ï¼Œæ— æ‰€è°“\n        lx++;ly++;\n        rx--;ry--;\n    }\n}\n```\nå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯ä»æ•´ä½“å‡ºå‘ï¼Œä»å¤–å±‚åˆ°å†…å±‚ï¼Œè€ƒè™‘æ¯ä¸€å±‚çš„å‰`n-1`ä¸ªèŠ‚ç‚¹çš„æ—‹è½¬è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦è‡ªå·±åœ¨çº¸ä¸Šç”»ä¸€ç”»ï¼Œç©ºæƒ³å®¹æ˜“æé”™\n\n**è§£æ³•äºŒ**\n\næ–°å­¦åˆ°çš„è§£æ³•ï¼ŒæŒºæœ‰æ„æ€çš„ï¼Œæ•´ä½“æ²¿å¯¹è§’çº¿äº¤æ¢ï¼Œç„¶åæ¯è¡Œæ²¿ä¸­ç‚¹äº¤æ¢ï¼Œè¿™ä¸ªå…¶å®å¯ä»¥é€šè¿‡è§‚å¯Ÿæ•°ç»„ç»“æ„å¾—åˆ°\n\n```java\npublic void rotate(int[][] matrix) {\n    if(matrix==null || matrix.length<=0) return;\n    int N=matrix.length;\n    for(int i=0;i<N;i++){\n        for(int j=i+1;j<N;j++){\n            int temp=matrix[i][j];\n            matrix[i][j]=matrix[j][i];\n            matrix[j][i]=temp;\n        }\n    }\n\n    for(int i=0;i<N;i++){\n        for(int j=0,k=N-1;j<k;j++,k--){\n            int temp=matrix[i][j];\n            matrix[i][j]=matrix[i][k];\n            matrix[i][k]=temp;\n        }\n    }\n}\n```\n\n## [498. å¯¹è§’çº¿éå†](https://leetcode-cn.com/problems/diagonal-traverse/)\n\nç»™å®šä¸€ä¸ªå«æœ‰ M x N ä¸ªå…ƒç´ çš„çŸ©é˜µï¼ˆM è¡Œï¼ŒN åˆ—ï¼‰ï¼Œè¯·ä»¥å¯¹è§’çº¿éå†çš„é¡ºåºè¿”å›è¿™ä¸ªçŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯¹è§’çº¿éå†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n**ç¤ºä¾‹:**\n\n```\nè¾“å…¥:\n[\n [ 1, 2, 3 ],\n [ 4, 5, 6 ],\n [ 7, 8, 9 ]\n]\n\nè¾“å‡º:  [1,2,4,7,5,3,6,8,9]\n```\n\n ![JXlfOg.png](https://s1.ax1x.com/2020/05/01/JXlfOg.png)\n\n**è¯´æ˜:**\n\n1. ç»™å®šçŸ©é˜µä¸­çš„å…ƒç´ æ€»æ•°ä¸ä¼šè¶…è¿‡ 100000 ã€‚\n\n**è§£æ³•ä¸€**\n\nå› ä¸ºæ˜¯å…ˆåšçš„ä¸‹é¢çš„é‚£ä¸€é¢˜ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç›´æ¥å»¶ç”¨äº†å‰é¢çš„æ€è·¯ï¼Œå€ŸåŠ©äº†mapé¢å¤–çš„ç©ºé—´ï¼Œå…¶å®åšå¤æ‚äº†\n\n```go\n//å€ŸåŠ©é¢å¤–ç©ºé—´\nfunc findDiagonalOrder(matrix [][]int) []int {\n    var res []int\n    m := len(matrix)\n    if matrix == nil || m == 0 {\n        return res\n    }\n    n := len(matrix[0])\n    hmap := make(map[int][]int)\n    flagRow := false //è¡Œå¼€å¤´æ ‡å¿—ä½\n    for i, row := range matrix {\n        flagColumn := flagRow //åˆ—æ ‡å¿—ä½\n        for j, num := range row {\n            if flagColumn {\n                hmap[i+j] = append(hmap[i+j], num)\n            } else {\n                hmap[i+j] = append([]int{num}, hmap[i+j]...)\n            }\n            flagColumn = !flagColumn\n        }\n        flagRow = !flagRow\n    }\n    for i := 0; i <= m*n; i++ {\n        res = append(res, hmap[i]...)\n    }\n    return res\n}\n```\n\n**è§£æ³•äºŒ**\n\næ¨¡æ‹Ÿï¼Œä¸è¿‡æ˜¯ä»æ•´ä½“ä¸Šæ¨¡æ‹Ÿï¼Œæ¯”è¾ƒå¥½çš„è§£æ³•ï¼Œä¸å€ŸåŠ©map\n\n```go\n//æ¯”è¾ƒå¥½çš„è§£æ³•\nfunc findDiagonalOrder(matrix [][]int) []int {\n    var res []int\n    m := len(matrix)\n    if matrix == nil || m == 0 {\n        return res\n    }\n    n := len(matrix[0])\n    leftX := 0\n    leftY := 0\n    rightX := 0\n    rightY := 0\n    flag := true\n    //å·¦å³ç«¯ç‚¹æ²¿ç€çŸ©å½¢è¾¹ç¼˜ç§»åŠ¨å°±è¡Œäº†\n    for leftX < m && leftY < n {\n        help(matrix, leftX, leftY, rightX, rightY, flag, &res)\n        if leftX == m-1 { //å·¦ç«¯ç‚¹åˆ°è¾¾è¾¹ç•Œ\n            leftY++\n        } else {\n            leftX++\n        }\n        if rightY == n-1 { //å³ç«¯ç‚¹åˆ°è¾¾è¾¹ç•Œ\n            rightX++\n        } else {\n            rightY++\n        }\n        flag = !flag //åè½¬\n    }\n    return res\n}\n\n//è·å– (lx,ly) å’Œ (rx,ry)ä¹‹é—´çš„ç‚¹\nfunc help(matrix [][]int, lx, ly, rx, ry int, flag bool, res *[]int) {\n    for lx >= rx && ly <= ry {\n        if flag {\n            *res = append(*res, matrix[lx][ly])\n            lx--\n            ly++\n        } else {\n            *res = append(*res, matrix[rx][ry])\n            rx++\n            ry--\n        }\n    }\n}\n```\n\n## [1424. å¯¹è§’çº¿éå† II](https://leetcode-cn.com/problems/diagonal-traverse-ii/)\n\nç»™ä½ ä¸€ä¸ªåˆ—è¡¨ `nums` ï¼Œé‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ•´æ•°åˆ—è¡¨ã€‚è¯·ä½ ä¾ç…§ä¸‹é¢å„å›¾çš„è§„åˆ™ï¼ŒæŒ‰é¡ºåºè¿”å› `nums` ä¸­å¯¹è§’çº¿ä¸Šçš„æ•´æ•°ã€‚\n\n \n\n**ç¤ºä¾‹ 1ï¼š**\n\n![JOOOEt.png](https://s1.ax1x.com/2020/05/01/JOOOEt.png)\n\n```java\nè¾“å…¥ï¼šnums = [[1,2,3],[4,5,6],[7,8,9]]\nè¾“å‡ºï¼š[1,4,2,7,5,3,8,6,9]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![JOXkEq.png](https://s1.ax1x.com/2020/05/01/JOXkEq.png)\n\n```go\nè¾“å…¥ï¼šnums = [[1,2,3,4,5],[6,7],[8],[9,10,11],[12,13,14,15,16]]\nè¾“å‡ºï¼š[1,6,2,8,7,3,9,4,12,10,5,13,11,14,15,16]\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [[1,2,3],[4],[5,6,7],[8],[9,10,11]]\nè¾“å‡ºï¼š[1,4,2,5,3,8,6,9,7,10,11]\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šnums = [[1,2,3,4,5,6]]\nè¾“å‡ºï¼š[1,2,3,4,5,6]\n```\n\n**æç¤ºï¼š**\n\n- `1 <= nums.length <= 10^5`\n- `1 <= nums[i].length <= 10^5`\n- `1 <= nums[i][j] <= 10^9`\n- `nums` ä¸­æœ€å¤šæœ‰ `10^5` ä¸ªæ•°å­—ã€‚\n\n**è§£æ³•ä¸€**\n\n186thå‘¨èµ›çš„t3ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè¿™é¢˜æˆ‘æ‹¿åˆ°çš„ç¬¬ä¸€æƒ³æ³•å…¶å®æ˜¯æ‰¾ä¸€ä¸‹å…³ç³»ç›´æ¥æ’åºï¼Œä½†æ˜¯å®é™…ä¸Šæœ‰æ›´å¥½çš„æ–¹æ³•\n\n```go\nfunc findDiagonalOrder(nums [][]int) []int {\n    //æœ€å¤§çš„è¡Œåˆ—å€¼\n    n := 0\n    m := make(map[int][]int)\n    for i, row := range nums {\n        for j, num := range row {\n            //é€†åºæ·»åŠ \n            m[i+j] = append([]int{num}, m[i+j]...)\n            n = max(n, i+j)\n        }\n    }\n    //res := make([]int, n)\n    var res []int\n    for i := 0; i <= n; i++ {\n        res = append(res, m[i]...)\n    }\n    return res\n}\n\nfunc max(a, b int) int {\n    if a < b {\n        return b\n    }\n    return a\n}\n```\n\nä¸Šé¢çš„è§£æ³•å…¶å®å’ŒNçš‡åé‡Œé¢å¯¹è¡Œåˆ—çš„å¤„ç†æ˜¯ä¸€æ ·çš„ï¼Œä¸¤æ¡å¯¹è§’çº¿ï¼Œä¸€æ¡è¡Œåˆ—å’Œç›¸ç­‰ï¼Œä¸€æ¡è¡Œåˆ—å·®ç›¸ç­‰\n\n> è¿™é¢˜æˆ‘è¿˜çœ‹åˆ°äº†è‡³å°‘3ç§ä¸åŒçš„æ–¹æ³•ï¼Œæœ‰ä¸€ç§æŠŠè¿™ä¸ªæ•°ç»„æ—‹è½¬ä¸€ä¸‹ï¼Œç„¶åå½“æˆäºŒå‰æ ‘ï¼Œç›´æ¥åšBFSå±‚æ¬¡éå†ğŸ˜‚ï¼Œè„‘æ´æŒºå¤§çš„\n\n## [215.æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ](https://leetcode-cn.com/problems/kth-largest-element-in-an-array/)\n\nFind the **k**th largest element in an unsorted array. Note that it is the kth largest element in the sorted order, not the kth distinct element.\n\n**Example 1:**\n\n```\nInput: [3,2,1,5,6,4] and k = 2\nOutput: 5\n```\n\n**Example 2:**\n\n```\nInput: [3,2,3,1,2,4,5,5,6] and k = 4\nOutput: 4\n```\n\n**Note:** \nYou may assume k is always valid, 1 â‰¤ k â‰¤ array's length.\n\n> è¿™é¢˜å¿…é¡»å¤šè¯´å‡ å¥\n\n**è§£æ³•ä¸€**\n\nå¤§æ ¹å †çš„åšæ³•ï¼ˆé¦–å…ˆæƒ³åˆ°çš„æ–¹æ³•ï¼Œä¸æ˜¯å¸¸è§„ç”¨å †çš„åšæ³•ï¼‰\n\n```java\npublic static int findKthLargest(int[] nums, int k) {\n    //æ„å»ºäº†å¤§æ ¹å †\n    for (int i=0;i<nums.length;i++){\n        siftUp(nums,i);\n    }\n    int size=nums.length-1;\n    for (int i=0;i<k-1;i++) {\n        swap(nums,0,size);//å’Œå †é¡¶äº¤æ¢Kæ¬¡\n        siftDown(nums,0,--size);//é‡æ–°è°ƒæ•´å †\n    }\n    return nums[0];\n}\n\npublic static void siftUp(int[] nums,int i){\n    while(nums[i]>nums[(i-1)/2]){\n        swap(nums,i,(i-1)/2);\n        i=(i-1)/2;\n    }\n}\n\n//i å˜å° ä¸‹æ²‰\npublic static void siftDown(int[] nums,int i,int size){\n    //åˆ¤æ–­æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆå·¦å­©å­ï¼‰\n    int left=i*2+1;\n    while(left<size){\n        int right=left+1;\n        //å·¦å³èŠ‚ç‚¹æœ€å¤§å€¼\n        int larger=left+1<size && nums[left]<nums[left+1] ?left+1:left;\n        if(nums[larger]>nums[i]){\n            swap(nums,larger,i);\n            i=larger;\n            left=larger*2+1;\n        } else{\n            break;\n        }\n    }\n}\n\npublic static  void  swap(int []nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\n70%å·¦å³çš„beatï¼Œå½“æ—¶æ„Ÿè§‰è¿˜è¡Œï¼Œæ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯`O(KlogN)`ï¼Œåæ¥è¶Šæƒ³è¶Šä¸å¯¹ï¼Œåˆå»çœ‹äº†ä¸‹å †æ’åºï¼Œå‘ç°æˆ‘ä¹‹å‰å†™çš„å †æ’åºéƒ½æ˜¯æœ‰é—®é¢˜çš„\n\n**ä¼˜åŒ–åçš„å¤§æ ¹å †åšæ³•**\n\n```java\npublic static int findKthLargest(int[] nums, int k) {\n    int last=nums.length-1;\n    for (int i=nums.length/2-1;i>=0;i--) {\n        siftDown(nums,i,last);\n    }\n    for (int i=0;i<k-1;i++) {\n        swap(nums,0,last);\n        siftDown(nums,0,--last);\n    }\n    return nums[0];\n}\n\n//i å˜å° ä¸‹æ²‰\npublic static void siftDown(int[] nums,int i,int last){\n    //åˆ¤æ–­æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆå·¦å­©å­ï¼‰\n    int left=i*2+1;\n    while(left<=last){\n        int right=left+1;\n        //å·¦å³èŠ‚ç‚¹æœ€å¤§å€¼\n        int larger=right<=last && nums[right] > nums[left]?right:left;\n        if(nums[larger]>nums[i]){\n            swap(nums,larger,i);\n            i=larger;\n            left=larger*2+1;\n        } else{\n            break;\n        }\n    }\n}\n\npublic static  void  swap(int []nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\n95% beatï¼Œæ¯”ä¸Šé¢çš„è¦å¿«å¾ˆå¤šï¼Œç›¸æ¯”ä¹‹å‰çš„æ–¹æ³•ï¼Œæ„é€ å †çš„æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸Šé¢é‚£ç§é€šè¿‡è‡ªä¸Šè€Œä¸‹çš„insertæ–¹å¼æ—¶é—´å¤æ‚åº¦æ˜¯O(NlogN)ï¼Œå…¶å®æƒ³æƒ³ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯å®Œå…¨ç›¸åçš„ï¼Œinsertçš„æ–¹å¼ï¼Œæœ€åä¸€å±‚æ¯ä¸ªå…ƒç´ æœ€åéƒ½å¯èƒ½è°ƒæ•´`logN`æ¬¡ï¼Œè€Œæœ€åä¸€å±‚ä¹Ÿæ˜¯å…ƒç´ æœ€å¤šçš„ä¸€å±‚ï¼Œè¿™æ ·ä¸€æ¥å¤æ‚åº¦å°±ä¼šå¤§å¤§å¢åŠ ï¼Œç›¸åå¦‚æœé‡‡ç”¨ä»åº•å‘ä¸Šçš„`swim`æ–¹å¼æœ€åä¸€å±‚éƒ½åªéœ€è¦è°ƒæ•´`1`æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹éœ€è¦è°ƒæ•´`logN`æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œæ—¶é—´å¤æ‚åº¦å°±ä¼šå¤§å¤§é™ä½ï¼Œæœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯`O(N)`ï¼Œ[å…·ä½“æ¨ç®—å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ](https://www.zhihu.com/question/20729324)ï¼Œ ç°åœ¨çš„æ—¶é—´å¤æ‚åº¦æ‰çœŸçš„æ˜¯`O(KlogN)`\n\n![mark](http://static.imlgw.top/image/20190617/kVuvnMfjuSns.png?imageslim)\n\n> ğŸ’¥ğŸ’¥ ä¸Šé¢è¿™ä¸¤ç§åšæ³•æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¤±å»äº†ç”¨å †çš„ä¼˜åŠ¿ï¼Œå¤§æ ¹å †çš„åšæ³•å¿…é¡»è¦é˜¿å°†æ•´ä¸ªå †æ„å»ºå®Œæˆåæ‰èƒ½å»æ‰¾topkè¿™æ ·çš„è¯å†…å­˜æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œåº”è¯¥ç»´æŠ¤ä¸€ä¸ªå°æ ¹å †ï¼Œè¿™æ ·å¦‚æœæ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ä¸ç”¨å…¨è¯»å…¥å†…å­˜ä¸­ï¼Œ  è¿™é¢˜å› ä¸ºæ˜¯æˆ‘è‡ªå·±å®ç°çš„å †ï¼Œæ‰€ä»¥å»ºå †çš„å¤æ‚åº¦æ˜¯O(N)ï¼ˆå¦‚æœä½¿ç”¨å®˜æ–¹çš„APIï¼Œå»ºå †çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯NlogNï¼‰ï¼Œæœ€ç»ˆå¤§æ ¹å †å°æ ¹å †å¤æ‚åº¦å–å†³äºKå’ŒNçš„å¤§å°å…³ç³»ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™æœ€å¥½ä¸è¦è¯´ç”¨å¤§æ ¹å †çš„åšæ³•\n\n**è§£æ³•äºŒ**\n\nå°æ ¹å †çš„åšæ³•\n\n```java\npublic int findKthLargest(int[] nums, int k) {\n    int size=nums.length;\n    //å…ˆç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„å°æ ¹å † ,è¿™é‡Œè¦æ³¨æ„kä¸æ˜¯ä¸‹æ ‡ï¼Œk=index+1\n    for (int i = k/2; i >=0; i--) {\n        heapIfy(nums,i,k);\n    }\n\t//å†ä»kå¼€å§‹å‘é‡Œé¢æ’å…¥å…ƒç´ \n    for (int i=k;i<size;i++) {\n        if(nums[i]>nums[0]) { //å¤§äºå°æ ¹å †å †é¡¶,è¿›å–ä»£å®ƒ\n            //å°æ ¹å †æ±‚ç¬¬Kå¤§,ä¿è¯è¿™ä¸ªå †çš„å…ƒç´ æ˜¯æ•´ä¸ªå †çš„å‰kå¤§çš„å…ƒç´ ï¼Œå †é¡¶å°±æ˜¯ç¬¬kå¤§\n            swap(nums,i,0);\n            heapIfy(nums,0,k);\n        }\n        //å°äºå †é¡¶å°±ä¸ç”¨ç®¡äº†\n    }\n    return nums[0];\n}\n\n//å°æ ¹å †è°ƒæ•´\npublic  void heapIfy(int[] nums, int i, int size) {\n    int left = 2 * i + 1;\n    while (left < size) {\n        int right = left + 1;\n        int small = right < size && nums[right] < nums[left] ? right: left;\n        if(nums[small]<nums[i]) {\n            swap(nums,small,i);\n            i=small;\n            left=2*i+1;\n        } else {\n            return;\n        }\n    }\n}\n\nprivate  void swap(int[] nums, int l, int r) {\n    int temp = nums[l];\n    nums[l] = nums[r];\n    nums[r] = temp;\n}\n```\n\n2msï¼Œ99%beatï¼Œä¸€èˆ¬æƒ…å†µä¸‹çš„topKé—®é¢˜ï¼Œå¦‚æœç”¨å †è§£å†³çš„è¯åº”è¯¥éƒ½æ˜¯é‡‡ç”¨**å°æ ¹å †**è¿™ç§åšæ³•æ¥åšï¼Œæ—¶é—´å¤æ‚åº¦ä¸º`O(NlogK)`ï¼Œç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„å°æ ¹å †ï¼Œç„¶åå†éå†åé¢n-kä¸ªå…ƒç´ ï¼Œä¾æ¬¡å’Œå½“å‰æœ€å°å †çš„å †é¡¶æ¯”è¾ƒï¼ˆå½“å‰topKä¸­çš„æœ€å°å…ƒç´ ï¼Œå †é¡¶ï¼‰ï¼Œå¦‚æœæ¯”å®ƒå°å°±å’Œå®ƒäº¤æ¢ç„¶åè°ƒæ•´å †ï¼Œè¿™æ ·å°±å§‹ç»ˆä¿æŒäº†è¿™ä¸ªå †æ˜¯å½“å‰çš„topKå°ï¼Œæœ€åçš„å †é¡¶å°±æ˜¯ç¬¬Kå¤§çš„å…ƒç´ ã€‚\n\n_å…³äºèŠ‚çœç©ºé—´çš„é—®é¢˜ï¼Œå…¶å®å¾ˆå¥½ç†è§£ï¼Œå»æ‰¾ä¸€ä¸ªOJè¯•ä¸€ä¸‹å°±æ‡‚äº†_\n\n```java\nimport java.util.*;\npublic class Main{\n    public static void main(String[] args){\n        Scanner sc=new Scanner(System.in);\n        int N=sc.nextInt();\n        int K=sc.nextInt();\n        PriorityQueue<Integer> queue=new PriorityQueue<>((a,b)->b-a);\n        for(int i=0;i<N;i++){\n            int num=sc.nextInt(); //ä¸€ä¸ªä¸ªçš„è¯»å…¥,è€Œä¸æ˜¯ä¸€èµ·è¯»å…¥\n            queue.add(num);\n            if(queue.size()>K){\n                queue.poll();\n            }\n        }\n        System.out.println(queue.peek());\n    }\n}\n```\n\n**è§£æ³•ä¸‰**\n\nå…¶å®è¿˜æœ‰ä¸€ç±»åšæ³•ï¼Œåˆ©ç”¨`å¿«æ’+äºŒåˆ†`çš„æ€æƒ³ï¼Œä¸€èˆ¬ä¹Ÿè¢«ç§°ä¸ºå¿«é€‰\n\n```java\npublic static int findKthLargest(int[] nums, int k) {\n    int n=nums.length;\n    int left=0,right=nums.length-1;\n    while(left<=right){\n        //åˆ†æ²»\n        int base=partion(nums,left,right); //æ‹¿åˆ°åˆ’åˆ†ç‚¹\n        if(base<n-k){\n            left=base+1;\n        } else if(base>n-k){\n            right=base-1;\n        } else{\n            return nums[base];\n        }\n    }\n    return -1;\n}\n\npublic static int partion(int []nums,int left,int right){\n    //éšæœºå–å€¼\n    swap(nums,left,left+(int) (Math.random() * (right - left + 1)));\n    int base=left;\n    while(left<right){\n        while(left<right&&nums[right]>nums[base]){\n            right--;\n        }\n        while(left<right&&nums[left]<=nums[base]){\n            left++;\n        }\n        if(left<right){\n            swap(nums,left,right);\n        }\n    }\n    //å½’ä½\n    swap(nums,left,base);\n    return left;\n}\n\npublic static  void  swap(int []nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\nè¿™é‡Œæœ€å¥½ç”¨**éšæœº**çš„**partition**ï¼Œæˆ‘è¯•äº†ä¸‹**ä¸éšæœº**å¤§æ¦‚`50+ms 30%beat`ï¼Œè¿™ç§éšæœºçš„å¤§æ¦‚`3ms 97%beats `ï¼Œå·®è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯**O(N)**\n\n> è‡³äºä¸ºä»€ä¹ˆæ˜¯O(N)ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸‹ï¼Œè¿™é‡Œ**å‡è®¾æ¯æ¬¡åˆ’åˆ†éƒ½æ˜¯å·®ä¸å¤šä¸­ç‚¹çš„ä½ç½®**ï¼Œå¦‚æœæ˜¯å¿«æ’ï¼Œé‚£ä¹ˆåœ¨**partition**ä¹‹åä¾ç„¶éœ€è¦ä¸¤è¾¹çš„å­æ•°ç»„è¿›è¡Œ**partition**ï¼Œåˆ†æ²»æ•´ä¸ªé€’å½’æ ˆçš„é«˜åº¦å°±æ˜¯`logN`ï¼Œæ¯å±‚éƒ½æ˜¯Nï¼Œæ‰€ä»¥æ•´ä½“çš„å¤æ‚åº¦å°±**O(NlogN)**....æ‰¯è¿œäº†ï¼Œå›åˆ°æ­£é¢˜\n>\n> æ¥è¯´è¯´æˆ‘ä»¬è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯O(N)ï¼Œè¿™é‡Œæˆ‘ä»¬æ²¿ç”¨å‰é¢çš„åˆ†æè¿‡ç¨‹ï¼Œé€’å½’æ ˆæ·±åº¦ä¾ç„¶æ˜¯`logN`ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œç¬¬ä¸€æ¬¡ç¡®å®šåˆ’åˆ†ç‚¹çš„ç›¸å¯¹**k**çš„ä½ç½®åï¼Œä¸‹ä¸€æ­¥**åªéœ€è¦åˆ’åˆ†å…¶ä¸­ä¸€è¾¹çš„å…ƒç´ ï¼Œä¸ç”¨å¯¹å¦ä¸€è¾¹çš„å…ƒç´ ç»§ç»­**ï¼Œä¹Ÿå°±æ˜¯n/2ï¼Œå†å¾€ä¸‹å°±æ˜¯n/4ï¼Œn/8ï¼Œn/16 ....   è€Œ `(1+1/2+1/4+1/8+......1/2^n)n <=2n` ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä½“çš„å¤æ‚åº¦æ˜¯ä½äºO(2N)çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¤æ‚åº¦å°±æ˜¯O(N)\n\n**ä¸‰åˆ‡åˆ†å¿«æ’ä¼˜åŒ–**\n\nACWingä¸Šäº¤çš„ï¼Œwaäº†å¥½å‡ æ¬¡ï¼Œå‘ç°æ˜¯äºŒåˆ†å†™é”™äº†ï¼Œå“ï¼ŒäºŒåˆ†çœŸéš¾ï¼Œå…¶å®è¿˜å¯ä»¥åšä¸€ä¸‹éšæœºå¤„ç†\n\n```java\nimport java.util.*;\npublic class Main{\n    public static void main(String[] args){\n        Scanner sc=new Scanner(System.in);\n        int N=sc.nextInt();\n        int K=sc.nextInt()-1;\n        int[] nums=new int[N];\n        for(int i=0;i<N;i++) nums[i]=sc.nextInt();\n        int left=0,right=N-1;\n        while(left<right){\n            int[] equ=partition(nums,left,right);\n            if(K>equ[1]){\n                left=equ[1]+1;\n            }else if(K<equ[0]){\n                right=equ[0]-1;\n            }else{\n                System.out.println(nums[equ[0]]);\n                return;\n            }\n        }\n        System.out.println(nums[left]);\n    }\n\n    public static int[] partition(int[] nums,int left,int right){\n        int less=left-1,more=right,base=nums[right];\n        int i=left;\n        while(i<more){\n            if(nums[i]<base){\n                swap(nums,++less,i++);\n            }else if(nums[i]>base){\n                swap(nums,--more,i);\n            }else{\n                i++;\n            }\n        }\n        //å½’ä½\n        swap(nums,right,more++);\n        return new int[]{less+1,more-1}; //è¿”å›ç­‰äºåŒºåŸŸ\n    }\n\n    public static void swap(int[] nums,int a,int b){\n        int temp=nums[a];\n        nums[a]=nums[b];\n        nums[b]=temp;\n    }\n}\n```\n\n**Update: 2020.6.28**\n\nç”¨goé‡å†™ä¸‹ï¼Œåˆå†™äº†åŠå¤©ã€‚ã€‚ã€‚çœŸçš„èœï¼Œä¸»è¦æ˜¯æœ€ååˆ’åˆ†å…ƒç´ çš„æ—¶å€™ï¼ŒåŒºé—´åªæœ‰1ä¹Ÿåº”è¯¥ç»§ç»­åˆ’åˆ†ï¼Œä¹Ÿå°±æ˜¯`left <= right`ï¼Œä¸Šé¢çš„è§£æ³•å°±æ²¡è€ƒè™‘è¿™ä¸ªï¼Œè€Œæ˜¯åœ¨å¾ªç¯é€€å‡ºåè¿”å›leftï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯å¥½æ–¹æ³•ã€‚ã€‚ã€‚ï¼ˆåé¢è¿˜æ˜¯ä¼šå†å†™çš„ï¼Œå°½é‡ç¼©çŸ­codeæ—¶é—´ï¼‰\n```golang\n//1 2 3 4 5 6\nfunc findKthLargest(nums []int, k int) int {\n    k = len(nums) - k //è½¬æ¢ä¸‹\n    var left = 0\n    var right = len(nums)-1\n    for left <= right{ //ç¬¬ä¸€ä¸ªWAç‚¹ï¼Œè¿™é‡Œæ˜¯æœ€å®¹æ˜“å†™é”™çš„\n        mid := partition(nums, left, right)\n        if mid[1] < k{\n            left = mid[1]+1 //WAç‚¹\n        }else if mid[0] > k{\n            right = mid[0]-1 //WAç‚¹\n        }else{\n            return nums[mid[0]]\n        }\n    }\n    return -1\n}\n\nfunc partition(nums []int, left int, right int) []int{\n    base := left\n    var less = left\n    var more = right+1 //WAç‚¹\n    var i = left\n    for i < more{ //WAç‚¹\n        if nums[i] < nums[base]{\n            less++\n            nums[less], nums[i] = nums[i], nums[less]\n            i++\n        }else if nums[i] > nums[base]{\n            more--\n            nums[more], nums[i] = nums[i], nums[more]\n        }else{\n            i++\n        }\n    }\n    nums[less], nums[base] = nums[base], nums[less]\n    return []int{less,more-1} //WAç‚¹ï¼Œæ³¨æ„é…åˆä¸Šé¢çš„äºŒåˆ†\n}\n```\n\n**è§£æ³•å››**\n\n[BFPRTç®—æ³•](https://zhuanlan.zhihu.com/p/31498036) å¤§ä½¬ä»¬æå‡ºæ¥çš„æ ¹æ®ä¸Šé¢å¿«æ’æ”¹è¿›è€Œæ¥ï¼Œå…¶å®é¢è¯•æŠŠå°æ ¹å †å’Œå¿«æ’çš„è§£æ³•ç­”å‡ºæ¥åº”è¯¥å°±å·®ä¸å¤šäº†ï¼Œè¿™ä¸ªè§£æ³•è¿˜æ˜¯æœ‰äº›ä¸å®¹æ˜“å†™å‡ºæ¥\n\n```java\npublic static int findKthLargest(int []nums,int k){\n    return findKthLargest(nums,0,nums.length-1,k);\n}\n\npublic static int findKthLargest(int[] nums,int l,int r,int k) {\n    int mid=findMid(nums,l,r);\n    swap(nums,mid,l);\n    int m=partition(nums,l,r);\n    if(m==nums.length-k){\n        return nums[m];\n    }\n    //ä¸‹é¢çš„ç±»ä¼¼äº†\n    if(m>nums.length-k){\n        return findKthLargest(nums,l,m-1,k);\n    }\n    return findKthLargest(nums,m+1,r,k);\n}\n\n//ä¸­ä½æ•°çš„ä¸­ä½æ•°ï¼Œä¸»è¦çš„æ ¸å¿ƒå°±æ˜¯åœ¨è¿™é‡Œ\npublic static int  findMid(int []nums,int l,int r){\n    int leftSub=l;\n    //åˆ†ç»„æ±‚ä¸­ä½æ•°ï¼Œ5ç­‰åˆ†\n    for (int i=l;i<r-4;i+=5) {\n        insertSort(nums,i,i+4);\n        //å°†æ¯ä¸€ç»„çš„ä¸­ä½æ•°ç»Ÿä¸€æ”¾åˆ°å·¦ä¾§ï¼Œç”¨äºé€’å½’\n        swap(nums,leftSub++,i+2);\n    }\n    //å¤„ç†å‰©ä¸‹çš„ä¸è¶³5ä¸ªçš„\n    if (r-l<4) {\n        insertSort(nums,l,r);\n        swap(nums,leftSub,l+(r-l)/2);\n    }\n    //æ‰¾åˆ°äº†\n    if(l==leftSub){\n        return l;\n    }\n    return findMid(nums,l,leftSub);\n}\n\n//äº”ç­‰åˆ†çš„æ’å…¥\npublic static void insertSort(int []nums,int l,int r){\n    for (int i=0;i<r;i++) {\n        for (int j=i+1;j>=l&&nums[j]<nums[i];j--) {\n            swap(nums,j,i);\n        }\n    }\n}\n\n//å¿«æ’partition\npublic static int partition(int []nums,int left,int right){\n    int base=left;\n    while(left<right){\n        while(left<right&&nums[right]>nums[base]){\n            right--;\n        }\n        while(left<right&&nums[left]<=nums[base]){\n            left++;\n        }\n        if(left<right){\n            swap(nums,left,right);\n        }\n    }\n    //å½’ä½\n    swap(nums,left,base);\n    return left;\n}\n\npublic static void swap(int []nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\n[å…·ä½“çš„æ—¶é—´å¤æ‚åº¦è¯æ˜](https://zhuanlan.zhihu.com/p/31498036)ï¼Œå½“nå–5æ—¶å€™ï¼Œåœ¨åˆ’åˆ†çš„æ—¶å€™**è‡³å°‘**ä¼šå¤§äº**3n/10**çš„å…ƒç´ ï¼Œé¿å…äº†æç«¯æƒ…å†µï¼Œä¿è¯åœ¨æœ€åæƒ…å†µä¸‹ä¹Ÿä¸ä¼šå¤ªåã€‚\n\n![mark](http://static.imlgw.top/image/20190617/Lc4M5f2qkegH.png?imageslim)\n\nå¦‚ä¸Šå›¾ï¼Œæ¯ä¸€åˆ—ä¸ºåˆ†å¥½çš„ä¸€ç»„å…ƒç´ ï¼Œä¸­é—´é»„è‰²éƒ¨åˆ†ä¸ºæ¯ç»„çš„ä¸­ä½æ•°ï¼Œçº¢è‰²å—ä¸º**ä¸­ä½æ•°çš„ä¸­ä½æ•°**ï¼Œè¿™ä¸ªä¸­ä½æ•°è‡³å°‘ä¼šå¤§äºç­‰äºå·¦ä¸Šè§’é»‘æ¡†æ¡†ä½çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨åˆ’åˆ†çš„æ—¶å€™ä¼šä¿è¯è‡³å°‘å‡å°å¤§çº¦3n/10 çš„è§„æ¨¡ã€‚\n\næ‰€ä»¥æ—¶é—´å¤æ‚åº¦   `T(N)<=T(n/5)+T( 7n/10)+c*n`  æ€»ä½“æ—¶é—´å¤æ‚åº¦**O(N)**ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–çš„å…ƒç´ å¯ä»¥çœ‹çœ‹ä¸Šé¢çš„é‚£ç¯‡æ–‡ç« ã€‚\n\n## [347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ ](https://leetcode-cn.com/problems/top-k-frequent-elements/)\n\nç»™å®šä¸€ä¸ªéç©ºçš„æ•´æ•°æ•°ç»„ï¼Œè¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: nums = [1,1,1,2,2,3], k = 2\nè¾“å‡º: [1,2]\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: nums = [1], k = 1\nè¾“å‡º: [1]\n```\n\n**è¯´æ˜ï¼š**\n\n```java\nä½ å¯ä»¥å‡è®¾ç»™å®šçš„ k æ€»æ˜¯åˆç†çš„ï¼Œä¸” 1 â‰¤ k â‰¤ æ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°ã€‚\nä½ çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¿…é¡»ä¼˜äº O(n log n) , n æ˜¯æ•°ç»„çš„å¤§å°ã€‚\n```\n\nä¹Ÿæ˜¯TopKé—®é¢˜ï¼Œä½†æ˜¯è¿™é¢˜å…¶å®è¿˜æœ‰ä¸ªæ¡ä»¶ï¼Œ`ä¸ä¼šç»™å‡ºæœ‰æ­§ä¹‰çš„æ•°æ®` ï¼Œä¸¾ä¸ªä¾‹å­\n\n`nums=[1,1,1,2,2,2,3,3,3] ï¼Œk=2` è¿™æ ·çš„å°±æ˜¯æœ‰æ­§ä¹‰çš„\n\nä½†æ˜¯é¢˜ç›®ä¸­ä¹Ÿæ²¡æœ‰è§„å®šè¿™æ ·çš„å¦‚ä½•å¤„ç†ï¼Œç»è¿‡æµ‹è¯•ï¼Œå‘ç°å®˜æ–¹çš„è§£åœ¨é‡åˆ°è¿™ç§æƒ…å†µä¼šæŠ›ä¸€ä¸ªå¼‚å¸¸ã€‚\n\n**è§£æ³•ä¸€**\n\nå¤§æ ¹å †çš„åšæ³•\n\n```java\npublic static List<Integer> topKFrequent(int[] nums, int k) {\n    if(nums==null||nums.length<=0){\n        return null;\n    }\n    HashMap<Integer,Integer> fre=new HashMap<>();\n    for (int i=0;i<nums.length;i++) {\n        //fre.get(i) nums[i]å‡ºç°çš„é¢‘æ¬¡\n        fre.put(nums[i],fre.getOrDefault(nums[i],0)+1);\n    }\n    //1:3,2:3,3:1\n    PriorityQueue<HashMap.Entry<Integer,Integer>> pq=new PriorityQueue(new ComparatorMap());\n    for (HashMap.Entry ent:fre.entrySet()) {\n        pq.add(ent);\n    }\n    ArrayList<Integer> res=new ArrayList<>();\n    for (int i=0;i<k;i++) {\n        res.add(pq.poll().getKey());\n    }\n    return res;\n}\n\n//æ¯”è¾ƒå™¨\nstatic class ComparatorMap implements Comparator<HashMap.Entry<Integer,Integer>>{\n    @Override\n    public int compare(Map.Entry<Integer, Integer> o1, Map.Entry<Integer, Integer> o2) {\n        return o2.getValue()-o1.getValue();\n    }\n}\n```\nç”¨å¤§æ ¹å †ä¸å¤ªå¥½ï¼Œå®¹æ˜“çˆ†å†…å­˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸€é¢˜å¯ä»¥ä¿è¯é¡ºåºï¼Œ`ä½†æ˜¯é¢˜ç›®å¹¶æ²¡æœ‰è¦æ±‚é¡ºåº`ï¼Œæ—¶é—´å¤æ‚åº¦~~O(KlogN)~~\n\nè¿™é‡Œé”™äº†ï¼Œå»ºå †çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯`O(NlogN)`äº†ï¼Œåªæœ‰è‡ªå·±æ‰‹å†™çš„å †ï¼Œé‡‡ç”¨è‡ªåº•å‘ä¸Šçš„æ–¹å¼å»ºå †æ—¶é—´å¤æ‚åº¦æ‰æ˜¯O(N) ï¼Œå¯ä»¥å‚è€ƒ [ä¹‹å‰çš„æ–‡ç« ](http://imlgw.top/2018/12/11/chang-jian-pai-xu-suan-fa-zong-jie/#%E5%A0%86%E6%8E%92%E5%BA%8F%E6%9B%B4%E4%BC%98%E7%9A%84%E5%81%9A%E6%B3%95) ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šé¢topKé—®é¢˜ä¸­æåˆ°çš„\n\n**è§£æ³•äºŒ**\n\nå°æ ¹å †çš„åšæ³•\n\n```java\n//UPDATEï¼š2020.9.7ä¹‹å‰çš„è§£æ³•å¤ªä¸‘é™‹äº†\npublic int[] topKFrequent(int[] nums, int k) {\n    HashMap<Integer,Integer> freq = new HashMap<>();\n    for (int i = 0; i < nums.length; i++) {\n        freq.put(nums[i], freq.getOrDefault(nums[i], 0)+1);\n    }\n    //int[0]: count int[1]: val \n    PriorityQueue<int[]> pq = new PriorityQueue<>((a, b)->a[0]-b[0]);\n    //freq.forEach();\n    for (int key : freq.keySet()) {\n        pq.offer(new int[]{freq.get(key), key});\n        if (pq.size() > k) {\n            pq.poll();\n        }\n    }\n    int[] res = new int[k];\n    int i = 0;\n    while (!pq.isEmpty()) {\n        res[i++] = pq.poll()[1];\n    }\n    return res;\n}\n```\n\næ—¶é—´å¤æ‚åº¦`O(NlogK)`å› ä¸ºåªç»´æŠ¤äº†ä¸€ä¸ªKå¤§å°çš„å°æ ¹å † ï¼Œæ—¶é—´å¤æ‚åº¦å’Œå¤§æ ¹å †~~O(KlogN)~~ `O(NlogN)`ç›¸æ¯”ä¼šå¿«å¾ˆå¤šï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœNå’ŒKå¾ˆæ¥è¿‘çš„è¯å¯ä»¥è€ƒè™‘`O(Nlog(N-K))` çš„åšæ³•ï¼Œç»´æŠ¤ä¸€ä¸ªN-Kçš„å¤§æ ¹å †ï¼Œé‡Œé¢å­˜é¢‘ç‡æœ€ä½çš„é‚£äº›å…ƒç´ ï¼Œæœ€åè¿”å›å…¶ä»–çš„å…ƒç´ ï¼ˆno codeï¼Œ just talkï¼‰\n\n**è§£æ³•ä¸‰**\n\næ¡¶æ’åºï¼Œè¿™é¢˜çš„æœ€ä¼˜è§£åº”è¯¥å°±æ˜¯æ¡¶æ’åº\n\n```java\npublic static List<Integer> topKFrequent(int[] nums, int k) {\n    if(nums==null||nums.length<=0){\n        return null;\n    }\n    HashMap<Integer,Integer> fre=new HashMap<>();\n    for (int i=0;i<nums.length;i++) {\n        //è®°å½•nums[i]å‡ºç°çš„é¢‘æ¬¡\n        fre.put(nums[i],fre.getOrDefault(nums[i],0)+1);\n    }\n    ArrayList<Integer> [] bucket=new ArrayList[nums.length+1];\n    for (Integer num:fre.keySet()) {\n        if(bucket[fre.get(num)]==null){\n            bucket[fre.get(num)]=new ArrayList<>();\n        }\n        //æ¡¶æ’åº\n        bucket[fre.get(num)].add(num); //æ‰€æœ‰å‡ºç°fre.get(num)æ¬¡çš„å…ƒç´ æ„æˆä¸€æ¡é“¾è¡¨\n    }\n    ArrayList<Integer> res=new ArrayList<>();\n    int topk=bucket.length-1;\n    while (true) {\n        //ä»åå‘å‰éå†ï¼ˆä»é¢‘æ¬¡å¤§åˆ°å°ï¼‰\n        //æŒ‡é’ˆç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®\n        while(bucket[topk]==null&&topk>0){\n            topk--;\n        }\n        res.addAll(bucket[topk--]);\n        if(res.size()==k){\n            return res;\n        }\n    }\n}\n```\n\næ¡¶æ’åºçš„æ€è·¯ï¼Œæ—¶é—´å¤æ‚åº¦`O(N)`ï¼Œç©ºé—´å¤æ‚åº¦ä¹Ÿæ˜¯`O(N)`ï¼Œåœ¨leetcodeæäº¤ä¸‰ç§æ–¹æ³•çš„å·®è·ä¸å¤§ï¼Œå¯èƒ½æ˜¯æ•°æ®é‡å¤ªå°‘äº†\n\n**è§£æ³•å››** (UPDATE:2020.9.7)\n\nåŸºäºå¿«é€‰çš„åšæ³•ï¼Œæ—¶é—´å¤æ‚åº¦O(N)ï¼Œä¹‹å‰ä¸€ç›´æ‡’å¾—å†™ï¼Œä»Šå¤©è¡¥ä¸€ä¸‹\n```golang\ntype Node struct {\n    Val   int\n    Count int\n}\n\nfunc topKFrequent(nums []int, k int) []int {\n    var n = len(nums)\n    var freq = make(map[int]int)\n    for i := 0; i < n; i++ {\n        freq[nums[i]]++\n    }\n    var nodes []*Node\n    for val, count := range freq {\n        nodes = append(nodes, &Node{val, count})\n    }\n    //7 0 1 2 9 10\n    var res []int\n    var left, right = 0, len(nodes) - 1\n    for left <= right {\n        mid := partition(nodes, left, right)\n        if mid == k-1 {\n            for i := 0; i <= mid; i++ {\n                res = append(res, nodes[i].Val)\n            }\n            return res\n        }\n        if mid > k-1 {\n            right = mid - 1\n        } else {\n            left = mid + 1\n        }\n    }\n    return res\n}\n\nfunc partition(nums []*Node, i int, j int) int {\n    //7 9 10 0 1 2\n    //éšæœºä¸‹ä¼šå¥½ä¸€ç‚¹\n    var base = i\n    for i < j {\n        for i < j && nums[j].Count <= nums[base].Count {\n            j--\n        }\n        for i < j && nums[i].Count >= nums[base].Count {\n            i++\n        }\n        nums[i], nums[j] = nums[j], nums[i]\n    }\n    nums[i], nums[base] = nums[base], nums[i]\n    return i\n}\n```\n\n\n## [295. æ•°æ®æµçš„ä¸­ä½æ•°](https://leetcode-cn.com/problems/find-median-from-data-stream/)\n\nä¸­ä½æ•°æ˜¯æœ‰åºåˆ—è¡¨ä¸­é—´çš„æ•°ã€‚å¦‚æœåˆ—è¡¨é•¿åº¦æ˜¯å¶æ•°ï¼Œä¸­ä½æ•°åˆ™æ˜¯ä¸­é—´ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ã€‚\n\nä¾‹å¦‚ï¼Œ\n\n[2,3,4] çš„ä¸­ä½æ•°æ˜¯ 3\n\n[2,3] çš„ä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5\n\nè®¾è®¡ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œçš„æ•°æ®ç»“æ„ï¼š\n\n- void addNum(int num) - ä»æ•°æ®æµä¸­æ·»åŠ ä¸€ä¸ªæ•´æ•°åˆ°æ•°æ®ç»“æ„ä¸­ã€‚\n- double findMedian() - è¿”å›ç›®å‰æ‰€æœ‰å…ƒç´ çš„ä¸­ä½æ•°ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\naddNum(1)\naddNum(2)\nfindMedian() -> 1.5\naddNum(3) \nfindMedian() -> 2\n```\n\n\n**è¿›é˜¶:**\n\n- å¦‚æœæ•°æ®æµä¸­æ‰€æœ‰æ•´æ•°éƒ½åœ¨ 0 åˆ° 100 èŒƒå›´å†…ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ\n- å¦‚æœæ•°æ®æµä¸­ 99% çš„æ•´æ•°éƒ½åœ¨ 0 åˆ° 100 èŒƒå›´å†…ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å¾ˆä¹…ä¹‹å‰å°±å¬äººè®²è¿‡ï¼Œä¸è¿‡å¿˜è®°äº†ï¼Œæœ€ä½³ç­–ç•¥å°±æ˜¯åˆ©ç”¨å°æ ¹å †+å¤§æ ¹å †ï¼Œåˆ†åˆ«ç»´æŠ¤å‰åŠéƒ¨åˆ†å’ŒååŠéƒ¨åˆ†çš„æœ€å€¼\n\n```java\n/** initialize your data structure here. */\nPriorityQueue<Integer> minQue=null;\n\nPriorityQueue<Integer> maxQue=null;\n\npublic MedianFinder295() {\n    minQue=new PriorityQueue<>();\n    maxQue=new PriorityQueue<>((a,b)->b-a);\n}\n\npublic void addNum(int num) {\n    minQue.add(num);\n    maxQue.add(minQue.poll());\n    if(minQue.size()<maxQue.size()){\n        minQue.add(maxQue.poll());\n    }\n}\n\npublic double findMedian() {\n    if(minQue.size()==maxQue.size()){\n        return (minQue.peek()+maxQue.peek())/2.0;\n    }\n    return minQue.peek();\n}\n```\n\nå‰åŠéƒ¨åˆ†ç”¨å¤§è·Ÿå †ï¼ŒååŠéƒ¨åˆ†å°æ ¹å †ï¼Œæ¯æ¬¡å°†ä¸€ä¸ªå †çš„æœ€å€¼æ”¾åˆ°å¦ä¸€ä¸ªå †ä¸­ï¼Œè¿™æ ·ä¿è¯äº†å¤§è·Ÿå †çš„æœ€å¤§å€¼ä¸€å®šå°äºå°æ ¹å †çš„æœ€å°å€¼ï¼Œå¦å¤–æˆ‘ä»¬è¿˜éœ€è¦ä¿è¯ä¸¤ä¸ªå †çš„å·®è·ä¸èƒ½å¤§äº1ï¼Œè¿™é‡Œæˆ‘å°†å¤šçš„æ”¾åˆ°å°æ ¹å †ä¸­ï¼Œæœ€ååœ¨å¥‡æ•°çš„æ—¶å€™å°†å°æ ¹å †çš„å †é¡¶å¼¹å‡ºå°±å¯ä»¥äº†\n\n## [66. åŠ ä¸€](https://leetcode-cn.com/problems/plus-one/)\n\nç»™å®šä¸€ä¸ªç”±**æ•´æ•°**ç»„æˆçš„**éç©º**æ•°ç»„æ‰€è¡¨ç¤ºçš„éè´Ÿæ•´æ•°ï¼Œåœ¨è¯¥æ•°çš„åŸºç¡€ä¸ŠåŠ ä¸€ã€‚\n\næœ€é«˜ä½æ•°å­—å­˜æ”¾åœ¨æ•°ç»„çš„é¦–ä½ï¼Œ æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åªå­˜å‚¨**å•ä¸ª**æ•°å­—ã€‚\n\nä½ å¯ä»¥å‡è®¾é™¤äº†æ•´æ•° 0 ä¹‹å¤–ï¼Œè¿™ä¸ªæ•´æ•°ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3]\nè¾“å‡º: [1,2,4]\nè§£é‡Š: è¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 123ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [4,3,2,1]\nè¾“å‡º: [4,3,2,2]\nè§£é‡Š: è¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 4321ã€‚\n```\n\n**è§£æ³•ä¸€**\n\næ¨¡æ‹Ÿè¿›ä½\n\n```go\nfunc plusOne(digits []int) []int {\n    n := len(digits) - 1\n    carry := 1\n    for n >= 0 {\n        digits[n] += carry\n        carry = digits[n] / 10\n        digits[n] %= 10\n        n--\n    }\n    if carry == 1 {\n        digits = append([]int{1}, digits...)\n    }\n    return digits\n}\n```\n\n## [67. äºŒè¿›åˆ¶æ±‚å’Œ](https://leetcode-cn.com/problems/add-binary/) \n\nç»™å®šä¸¤ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿”å›ä»–ä»¬çš„å’Œï¼ˆç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚\n\nè¾“å…¥ä¸ºéç©ºå­—ç¬¦ä¸²ä¸”åªåŒ…å«æ•°å­— 1 å’Œ 0ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: a = \"11\", b = \"1\"\nè¾“å‡º: \"100\"\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: a = \"1010\", b = \"1011\"\nè¾“å‡º: \"10101\"\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜å’Œä¸‹é¢çš„é¢˜ç›®æ˜¯æˆ‘æœ‰æ„æ”¾åœ¨ä¸€èµ·çš„ï¼Œè¿™é¢˜ä¹Ÿå¯ä»¥ä½œä¸ºå¤§æ•°ç›¸åŠ çš„æ¨¡æ¿\n\n```java\npublic String addBinary(String a, String b) {\n    StringBuilder res=new StringBuilder(); \n    int idxA=a.length()-1;\n    int idxB=b.length()-1;\n    boolean carry=false;\n    //int carry=0;\n    while(idxA >=0 || idxB >=0){\n        char bina=idxA>=0?a.charAt(idxA):'0';\n        char binb=idxB>=0?b.charAt(idxB):'0';\n        if(bina == '1' && binb =='1'){\n            res.append(carry?1:0);\n            carry=true;\n        }else if((bina == '1' && binb =='0') ||(bina == '0' && binb =='1')){\n            res.append(carry?0:1);\n        }else{\n            res.append(carry?1:0);\n            carry=false;\n        }\n        idxA--;idxB--;\n    }\n    if(carry) res.append(1);\n    return res.reverse().toString();\n}\n```\n\n\n**è§£æ³•äºŒ**\n\nä¸Šé¢çš„è§£æ³•æ˜¯å®Œå…¨çš„æ¨¡æ‹Ÿè§£æ³•ï¼Œä¸å¤Ÿä¼˜é›…\n```java\npublic String addBinary(String a, String b) {\n    StringBuilder res=new StringBuilder(); \n    int idxA=a.length()-1;\n    int idxB=b.length()-1;\n    int carry=0;\n    while(idxA >=0 || idxB >=0){\n        int sum=carry;\n        sum+=idxA>=0?a.charAt(idxA)-48:0;\n        sum+=idxB>=0?b.charAt(idxB)-48:0;\n        res.append(sum%2);\n        carry=sum/2;\n        idxA--;idxB--;\n    }\n    if(carry==1) res.append(1);\n    return res.reverse().toString();\n}\n```\n## [415. å­—ç¬¦ä¸²ç›¸åŠ ](https://leetcode-cn.com/problems/add-strings/)\n\nç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„éè´Ÿæ•´æ•° `num1` å’Œ`num2` ï¼Œè®¡ç®—å®ƒä»¬çš„å’Œã€‚\n\n**æ³¨æ„ï¼š**\n\n1. num1 å’Œnum2 çš„é•¿åº¦éƒ½å°äº 5100.\n2. num1 å’Œnum2 éƒ½åªåŒ…å«æ•°å­— 0-9.\n3. num1 å’Œnum2 éƒ½ä¸åŒ…å«ä»»ä½•å‰å¯¼é›¶ã€‚\n4. ä½ ä¸èƒ½ä½¿ç”¨ä»»ä½•å…§å»º BigInteger åº“ï¼Œ ä¹Ÿä¸èƒ½ç›´æ¥å°†è¾“å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°å½¢å¼ã€‚\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹æ²¡æ‰¾åˆ°è¿™é¢˜ï¼Œåé¢å¶ç„¶å‘ç°çš„ï¼Œéšæ‰‹å†™ä¸€ä¸‹\n\n```java\npublic String addStrings(String num1, String num2) {\n    StringBuilder sb=new StringBuilder();\n    int m=num1.length()-1;\n    int n=num2.length()-1;\n    int carry=0;\n    while(n>=0 || m>=0){\n        int a= m>=0?num1.charAt(m)-48:0;\n        int b= n>=0?num2.charAt(n)-48:0;\n        int sum=a+b+carry;\n        carry=sum/10;\n        sb.append(sum%10);\n        m--;n--;\n    }\n    if (carry==1) {\n        sb.append(\"1\");\n    }\n    return sb.reverse().toString();\n}\n```\n\n## [43. å­—ç¬¦ä¸²ç›¸ä¹˜](https://leetcode-cn.com/problems/multiply-strings/)\n\nç»™å®šä¸¤ä¸ªä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºçš„éè´Ÿæ•´æ•° num1 å’Œ num2ï¼Œè¿”å› num1 å’Œ num2 çš„ä¹˜ç§¯ï¼Œå®ƒä»¬çš„ä¹˜ç§¯ä¹Ÿè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å½¢å¼ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: num1 = \"2\", num2 = \"3\"\nè¾“å‡º: \"6\"\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: num1 = \"123\", num2 = \"456\"\nè¾“å‡º: \"56088\"\n```\n\n\n**è¯´æ˜ï¼š**\n\n1. num1 å’Œ num2 çš„é•¿åº¦å°äº110ã€‚\n2. num1 å’Œ num2 åªåŒ…å«æ•°å­— 0-9ã€‚\n3. num1 å’Œ num2 å‡ä¸ä»¥é›¶å¼€å¤´ï¼Œé™¤éæ˜¯æ•°å­— 0 æœ¬èº«ã€‚\n4. ä¸èƒ½ä½¿ç”¨ä»»ä½•æ ‡å‡†åº“çš„å¤§æ•°ç±»å‹ï¼ˆæ¯”å¦‚ BigIntegerï¼‰æˆ–ç›´æ¥å°†è¾“å…¥è½¬æ¢ä¸ºæ•´æ•°æ¥å¤„ç†ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic static String multiply2(String num1, String num2) {\n    // 1 2 3 \n    // 4 5 6\n    // 501 6\n    int n1=num1.length();\n    int n2=num2.length();\n    //n1*n2 ç»“æœæœ€é•¿ä¸º n1+n2\n    int[] res=new int[n1+n2];\n    for (int i=n1-1;i>=0;i--) {\n        for (int j=n2-1;j>=0;j--) {\n            //ä¸»è¦å°±æ˜¯å¯¹è¿™ä¸ªi+j+1çš„ç†è§£\n            res[i+j+1]+=(num1.charAt(i)-48)*(num2.charAt(j)-48);\n        }\n    }\n    //å¤„ç†è¿›ä½\n    for(int i=res.length-1;i>=0;i--) {\n        if(res[i]>=10){\n            res[i-1]+=res[i]/10;\n            res[i]%=10;\n        }\n    }\n    //å»æ‰å‰é¢å¤šä½™çš„0\n    int index=0;\n    while (index<res.length-1&&res[index]==0) { \n        index++;\n    }\n    StringBuilder sb=new StringBuilder();\n    for (int i=index;i<res.length;i++) {\n        sb.append(res[i]);\n    }\n    return sb.toString();\n}\n```\nå…¶å®å°±æ˜¯æ¨¡æ‹Ÿçš„æ‰‹ç®—çš„è¿‡ç¨‹ï¼Œå…³é”®çš„åœ°æ–¹å°±æ˜¯ `i+j+1` çš„ç†è§£\n\n![mark](http://static.imlgw.top/blog/20190928/4xnHi4yd4hwA.png?imageslim)\n\n**è§£æ³•äºŒ**\n\nå…¶å®ä»”ç»†åˆ†æï¼Œä¼šå‘ç°ä¸Šé¢çš„ä»£ç å…¶å®æœ‰å¾ˆå¤šå¤šä½™çš„æ“ä½œï¼Œæ¯”å¦‚å»æ‰å‰é¢çš„0ï¼Œå› ä¸ºä¸¤ä¸ª**é0çš„æ•°ç›¸ä¹˜**ï¼Œæœ€åçš„ç»“æœæœ€å¤šn1+n2ä½ï¼Œæœ€å°‘n1+n2-1ä½ï¼Œæ‰€ä»¥å‰é¢çš„0**æœ€å¤šå°±ä¸€ä¸ª**\n\n```java\npublic static String multiply(String num1, String num2) {\n    if (num1.equals(\"0\") || num2.equals(\"0\")) {\n        return \"0\";\n    }\n    int n1=num1.length();\n    int n2=num2.length();\n    int[] res=new int[n1+n2];\n    for (int i=n1-1;i>=0;i--) {\n        for (int j=n2-1;j>=0;j--) {\n            //æ³¨æ„è¿™é‡Œçš„i+j+1\n            res[i+j+1]+=(num1.charAt(i)-48)*(num2.charAt(j)-48);\n        }\n    }\n    //å¤„ç†è¿›ä½(å…¶å®è¿™é‡Œres[0]æ˜¯ä¸å¯èƒ½å¤§äº10çš„)ï¼Œæ¨¡æ‹Ÿä¸‹çŸ¥é“äº†\n    for(int i=res.length-1;i>=0;i--) {\n        if(res[i]>=10){\n            res[i-1]+=res[i]/10;\n            res[i]%=10;\n        }\n    }\n    StringBuilder sb=new StringBuilder();\n    for (int i=0;i<res.length;i++) {\n        //å‰é¢æœ€å¤šåªæœ‰ä¸€ä¸ª0(é™¤äº†ä¸¤ä¸ªæ•°ä¸­æœ‰ä¸€ä¸ªä¸º0çš„æ—¶å€™)\n        if (i==0 && res[i]==0) continue;\n        sb.append(res[i]);\n    }\n    return sb.toString();\n}\n```\n**è§£æ³•ä¸‰**\n\nå…¶å®ä¸Šé¢çš„è¿›ä½å’Œè®¡ç®—å¯¹åº”ä½ç½®çš„å€¼å¯ä»¥åŒæ—¶å¤„ç†ï¼Œè¿™æ˜¯æœ€æ¥è¿‘äººæ‰‹ç®—çš„æ€è·¯äº†\n\n```java\n//update: 2020.4.16 åœ¨webä¸Šé‡æ–°æ¨äº†ä¸€é\n//idx : 0 1 2\n//i :   4 5 6\n//j :   1 2 3\n//   â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n//    1 3 6 8 (i+j+1)\n//    9 1 2\n//  4 5 6\n//  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n//0 1 2 3 4 5\n//0 5 6 0 8 8  \npublic String multiply(String num1, String num2) {\n    if(num1==null || num2==null) return num1;\n    int n1=num1.length(),n2=num2.length();\n    int[] res=new int[n1+n2];\n    //å¦‚æœæƒ³åŒæ—¶å¤„ç†è¿›ä½çš„è¯å°±å¿…é¡»å€’æ¨\n    for(int i=n1-1;i>=0;i--){\n        for(int j=n2-1;j>=0;j--){\n            int sum=res[i+j+1]+(num1.charAt(i)-48)*(num2.charAt(j)-48);\n            res[i+j+1]=sum%10;\n            //res[i+j]ä¼šè¶…è¿‡10,ä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯å€’æ¨çš„,æ‰€ä»¥è¿™ä¸ªä¼šåœ¨ä¸‹ä¸€è½®è¿›è¡Œå¤„ç†,å¦åˆ™å°±æ— æ³•å¤„ç†äº†\n            res[i+j]+=sum/10; \n        }\n    }   \n    //n*mä½æ•° ä¹˜ç§¯åº”è¯¥æ˜¯ (m+n-1 ~ m+n)ä½\n    //å‰ä¸¤ä¸ªä¸º0ä¸€å®šæ˜¯0\n    if(res[0]==0 && res[1]==0) return \"0\";\n    //å»é™¤å‰å¯¼0ï¼ˆæœ€å¤šä¸€ä¸ªï¼‰\n    StringBuilder sb=new StringBuilder();\n    for(int i=0;i<res.length;i++){\n        if(res[i]==0 && i==0)continue;\n        sb.append(res[i]);\n    }\n    return sb.toString();\n}\n```\n\n## [8. å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)](https://leetcode-cn.com/problems/string-to-integer-atoi/)\n\nè¯·ä½ æ¥å®ç°ä¸€ä¸ª `atoi` å‡½æ•°ï¼Œä½¿å…¶èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°ã€‚\n\né¦–å…ˆï¼Œè¯¥å‡½æ•°ä¼šæ ¹æ®éœ€è¦ä¸¢å¼ƒæ— ç”¨çš„å¼€å¤´ç©ºæ ¼å­—ç¬¦ï¼Œç›´åˆ°å¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªéç©ºæ ¼çš„å­—ç¬¦ä¸ºæ­¢ã€‚\n\nå½“æˆ‘ä»¬å¯»æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦ä¸ºæ­£æˆ–è€…è´Ÿå·æ—¶ï¼Œåˆ™å°†è¯¥ç¬¦å·ä¸ä¹‹åé¢å°½å¯èƒ½å¤šçš„è¿ç»­æ•°å­—ç»„åˆèµ·æ¥ï¼Œä½œä¸ºè¯¥æ•´æ•°çš„æ­£è´Ÿå·ï¼›å‡å¦‚ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦æ˜¯æ•°å­—ï¼Œåˆ™ç›´æ¥å°†å…¶ä¸ä¹‹åè¿ç»­çš„æ•°å­—å­—ç¬¦ç»„åˆèµ·æ¥ï¼Œå½¢æˆæ•´æ•°ã€‚\n\nè¯¥å­—ç¬¦ä¸²é™¤äº†æœ‰æ•ˆçš„æ•´æ•°éƒ¨åˆ†ä¹‹åä¹Ÿå¯èƒ½ä¼šå­˜åœ¨å¤šä½™çš„å­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦å¯ä»¥è¢«å¿½ç•¥ï¼Œå®ƒä»¬å¯¹äºå‡½æ•°ä¸åº”è¯¥é€ æˆå½±å“ã€‚\n\næ³¨æ„ï¼šå‡å¦‚è¯¥å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªéç©ºæ ¼å­—ç¬¦ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆæ•´æ•°å­—ç¬¦ã€å­—ç¬¦ä¸²ä¸ºç©ºæˆ–å­—ç¬¦ä¸²ä»…åŒ…å«ç©ºç™½å­—ç¬¦æ—¶ï¼Œåˆ™ä½ çš„å‡½æ•°ä¸éœ€è¦è¿›è¡Œè½¬æ¢ã€‚\n\nåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œè‹¥å‡½æ•°ä¸èƒ½è¿›è¡Œæœ‰æ•ˆçš„è½¬æ¢æ—¶ï¼Œè¯·è¿”å› 0ã€‚\n\n**è¯´æ˜ï¼š**\n\nå‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å­˜å‚¨ 32 ä½å¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œé‚£ä¹ˆå…¶æ•°å€¼èŒƒå›´ä¸º `[âˆ’231,  231 âˆ’ 1]`ã€‚å¦‚æœæ•°å€¼è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œè¯·è¿”å›  `INT_MAX (231 âˆ’ 1)` æˆ– `INT_MIN (âˆ’231)` \n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"42\"\nè¾“å‡º: 42\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"   -42\"\nè¾“å‡º: -42\nè§£é‡Š: ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦ä¸º '-', å®ƒæ˜¯ä¸€ä¸ªè´Ÿå·ã€‚\n     æˆ‘ä»¬å°½å¯èƒ½å°†è´Ÿå·ä¸åé¢æ‰€æœ‰è¿ç»­å‡ºç°çš„æ•°å­—ç»„åˆèµ·æ¥ï¼Œæœ€åå¾—åˆ° -42 ã€‚\n```\n\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: \"4193 with words\"\nè¾“å‡º: 4193\nè§£é‡Š: è½¬æ¢æˆªæ­¢äºæ•°å­— '3' ï¼Œå› ä¸ºå®ƒçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸ä¸ºæ•°å­—ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nä¹‹å‰ä¸€ç›´å¾ˆæ’æ–¥è¿™é“é¢˜ï¼ŒçŸ¥é“è¿™æ¬¡æœ‹å‹é˜¿é‡Œé¢è¯•é—®äº†è¿™é“é¢˜ã€‚ã€‚ã€‚\n\n```java\npublic int myAtoi(String str) {\n    if(str==null || str.length()<=0) return 0;\n    int MAX=Integer.MAX_VALUE,MIN=Integer.MIN_VALUE;\n    int res=0,index=0;\n    //è¿‡æ»¤ç©ºæ ¼\n    while(index<str.length()&&str.charAt(index)==' ')index++;\n    if(index==str.length()) return 0;\n    //å–æ­£è´Ÿå·\n    char firstChar=str.charAt(index);\n    boolean positive=true;\n    if(!isDigit(firstChar)){\n        if(firstChar!='+'&&firstChar!='-') return 0;\n        index++;\n        positive = firstChar!='-';\n    }\n    //æ­£è´Ÿæ•°çš„è¾¹ç•Œ\n    int limit=positive?-MAX:MIN;\n    //è¿‡æ»¤0\n    while(index<str.length()&&str.charAt(index)=='0')index++;\n    //å–æ¯ä¸€ä½,åœ¨éå­—ç¬¦æˆªæ­¢\n    while(index<str.length()&&isDigit(str.charAt(index))){\n        int digit=str.charAt(index++)-'0';\n        if(res<(limit+digit)/10){\n            return positive?MAX:MIN;\n        }\n        //è¿™é‡Œçš„res>=limit\n        res=res*10-digit;\n    }\n    //if(index!=str.length()) return 0; //ä¸­é€”é‡åˆ°éæ•°å­—(ä¹Ÿæ˜¯åˆæ³•çš„)\n    return positive?-res:res;\n}\n\npublic boolean isDigit(char c){\n    return c>='0' && c<='9';\n}\n```\n\nå‚è€ƒäº†`Integer.parseInt(String s, int radix)`æ–¹æ³•å¯¹è¾¹ç•Œçš„å¤„ç†æ–¹å¼, **ç”¨è´Ÿæ•°æ¥è¡¨ç¤ºæ­£è´Ÿæ•°çš„è¾¹ç•Œ**\n\n1. è¿™æ ·æ­£æ•°çš„è¾¹ç•Œå°±æ˜¯`-INT_MAX`,è´Ÿæ•°æ˜¯`INT_MIN`\n\n2. ç„¶åæˆ‘ä»¬åŒæ ·ä¹Ÿç”¨è´Ÿæ•°æ¥ä¿å­˜ç»“æœ, `res=res\\*10-digit`\n\n3. æˆ‘ä»¬éœ€è¦ä¿è¯è¿™ä¸ªå€¼æ˜¯åœ¨`INT`èŒƒå›´å†…çš„, ä¹Ÿå°±æ˜¯ res*10-digit>=limit (è´Ÿè¾¹ç•Œ)\n\n4. æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹`res`åšåˆ¤æ–­,ä½†æ˜¯ç›´æ¥åˆ¤æ–­å¯èƒ½ä¼šæº¢å‡º,æ‰€ä»¥è¿›è¡Œç§»é¡¹,å˜æ¢ä¸º `res<(limit+digit)/10`\n\n5. æœ€åå¦‚æœæ˜¯æ­£æ•°å°±è¿”å› `-res`,è´Ÿæ•°å°±è¿”å›`res`\n\nè¿˜æ˜¯ååˆ†å·§å¦™çš„ ğŸ‘ğŸ‘\n\n## [1071. å­—ç¬¦ä¸²çš„æœ€å¤§å…¬å› å­](https://leetcode-cn.com/problems/greatest-common-divisor-of-strings/)\n\nå¯¹äºå­—ç¬¦ä¸² S å’Œ Tï¼Œåªæœ‰åœ¨ S = T + ... + Tï¼ˆT ä¸è‡ªèº«è¿æ¥ 1 æ¬¡æˆ–å¤šæ¬¡ï¼‰æ—¶ï¼Œæˆ‘ä»¬æ‰è®¤å®š â€œT èƒ½é™¤å°½ Sâ€ã€‚\n\nè¿”å›æœ€é•¿å­—ç¬¦ä¸² Xï¼Œè¦æ±‚æ»¡è¶³ X èƒ½é™¤å°½ str1 ä¸” X èƒ½é™¤å°½ str2ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šstr1 = \"ABCABC\", str2 = \"ABC\"\nè¾“å‡ºï¼š\"ABC\"\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šstr1 = \"ABABAB\", str2 = \"ABAB\"\nè¾“å‡ºï¼š\"AB\"\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šstr1 = \"LEET\", str2 = \"CODE\"\nè¾“å‡ºï¼š\"\"\n```\n\n**è§£æ³•ä¸€**\n\né¦–å…ˆæƒ³åˆ°çš„æ–¹æ³•ï¼Œå…¶å®ä¹Ÿæ˜¯æ ¹æ®è¾—è½¬ç›¸é™¤æ³•æ¥çš„ï¼ˆè¿™ç§å¥½åƒå«æ›´ç›¸å‡æŸæœ¯ ?ï¼‰\n\n```java\n//6 4 gcd(6,4)=gcd(4,2)=gcd(2,0) return 2\npublic String gcdOfStrings(String str1, String str2) {\n    if(str1.equals(str2)){\n        return str1;\n    }\n    int index1=0,index2=0;\n    //ç”¨å‡æ³•æ›¿ä»£é™¤æ³•æ±‚ä½™æ•°\n    while(str1.length()>=str2.length() && index1<str1.length() && index2<str2.length()){\n        if(str1.charAt(index1)!=str2.charAt(index2)) return \"\";\n        index2++;\n        index1++;\n    }\n    //gcd(str2,ä½™æ•°)\n    return gcdOfStrings(str2,str1.substring(index1,str1.length()));\n}\n```\n**è§£æ³•äºŒ**\n\næ•°å­¦æ–¹æ³•ï¼Œæ¯”è¾ƒå·§å¦™\n\n```java\npublic String gcdOfStrings(String str1, String str2) {\n    if(!(str1+str2).equals(str2+str1)){\n        return \"\";\n    }\n    return str1.substring(gcd(str1.length(),str2.length()));\n}\n\npublic int gcd(int a,int b){\n    if(b==0) return a;\n    return gcd(b,a%b);\n}\n```\nç¬¬ä¸€ä¸ªæ¡ä»¶å……åˆ†æ€§çš„è¯æ˜è¿˜æ˜¯æœ‰ç‚¹ä¸å¤ªç†è§£ï¼Œä¸è¿‡åé¢çš„æœ€å¤§å…¬å› å­çš„é•¿åº¦å°±æ˜¯str1å’Œstr2é•¿åº¦å€’æ˜¯å¯ä»¥é€šè¿‡åè¯æ¥è¯æ˜å‡ºæ¥ï¼Œè¿™é‡Œç›´æ¥copyé¢˜è§£[å¤§ä½¬](https://leetcode-cn.com/problems/greatest-common-divisor-of-strings/solution/tan-tan-zheng-ming-wei-shi-yao-liang-zi-fu-chuan-c/) çš„è¯æ˜\n\nå‡è®¾ä¸¤å­—ç¬¦ä¸²çš„é•¿åº¦åˆ†åˆ«ä¸ºl1, l2, ä»–ä»¬çš„æœ€å¤§å…¬çº¦æ•°æ˜¯kã€‚\nç°å·²çŸ¥é“ä¸¤å­—ç¬¦ä¸²å­˜åœ¨æœ€å¤§å…¬å› å­ï¼ˆç¬¬ä¸€è¡Œä»£ç ï¼‰ï¼Œå‡è®¾è¯¥å­—ä¸²çš„é•¿åº¦ä¸º`k'`ã€‚\n\nä¸‹é¢å¼€å§‹åè¯ï¼Œ\nè‹¥`k' < k`ï¼Œè€Œæ ¹æ®é¢˜æ„`k'`ä¹Ÿä¸º`l1, l2` çš„å…¬çº¦æ•°ï¼Œåˆ™`k'`å¿…èƒ½è¢«`k`æ•´é™¤ï¼Œè¿™è¯´æ˜æˆ‘ä»¬å¯ä»¥å°†è¯¥å­—ä¸²çš„é•¿åº¦æ‰©å……åˆ°`k`ï¼ŒåŒæ—¶ä¿æŒå®ƒä»ç„¶ä¸º`str1`å’Œ`str2`çš„å…¬å› å­ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¿™ä¸ªé•¿åº¦ä¸º`k`çš„å…¬å› å­å°±ä¸æ˜¯æœ€å¤§å…¬å› å­ã€‚\nè‹¥`k' > k`ï¼Œ æ ¹æ®é¢˜æ„`k'`ä¸º`l1`, `l2` çš„å…¬çº¦æ•°ï¼Œ è€Œkä¸ºæœ€å¤§å…¬çº¦æ•°ï¼Œè€Œè¿™æ—¶å‡ºç°äº†ä¸€ä¸ªæ¯”æœ€å¤§å…¬çº¦æ•°è¿˜å¤§çš„å…¬çº¦æ•°ï¼Œè¿™æ˜¯çŸ›ç›¾çš„ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¹Ÿæ˜¯ä¸å¯èƒ½çš„ã€‚\n\nç»¼åˆä»¥ä¸Šï¼Œæœ€å¤§å…¬å› å­çš„é•¿åº¦å¿…ç„¶ç­‰äºä¸¤ä¸²é•¿åº¦çš„æœ€å¤§å…¬çº¦æ•°ã€‚\n\n## [914. å¡ç‰Œåˆ†ç»„](https://leetcode-cn.com/problems/x-of-a-kind-in-a-deck-of-cards/)\n\nç»™å®šä¸€å‰¯ç‰Œï¼Œæ¯å¼ ç‰Œä¸Šéƒ½å†™ç€ä¸€ä¸ªæ•´æ•°ã€‚\n\næ­¤æ—¶ï¼Œä½ éœ€è¦é€‰å®šä¸€ä¸ªæ•°å­— Xï¼Œä½¿æˆ‘ä»¬å¯ä»¥å°†æ•´å‰¯ç‰ŒæŒ‰ä¸‹è¿°è§„åˆ™åˆ†æˆ 1 ç»„æˆ–æ›´å¤šç»„ï¼š\n\n- æ¯ç»„éƒ½æœ‰ X å¼ ç‰Œã€‚\n- ç»„å†…æ‰€æœ‰çš„ç‰Œä¸Šéƒ½å†™ç€ç›¸åŒçš„æ•´æ•°ã€‚\n\nä»…å½“ä½ å¯é€‰çš„ X >= 2 æ—¶è¿”å› trueã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[1,2,3,4,4,3,2,1]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šå¯è¡Œçš„åˆ†ç»„æ˜¯ [1,1]ï¼Œ[2,2]ï¼Œ[3,3]ï¼Œ[4,4]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[1,1,1,2,2,2,3,3]\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šæ²¡æœ‰æ»¡è¶³è¦æ±‚çš„åˆ†ç»„ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[1]\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šæ²¡æœ‰æ»¡è¶³è¦æ±‚çš„åˆ†ç»„ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼š[1,1]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šå¯è¡Œçš„åˆ†ç»„æ˜¯ [1,1]\n```\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼š[1,1,2,2,2,2]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šå¯è¡Œçš„åˆ†ç»„æ˜¯ [1,1]ï¼Œ[2,2]ï¼Œ[2,2]\n```\n\n**æç¤ºï¼š**\n\n- `1 <= deck.length <= 10000`\n- `0 <= deck[i] < 10000`\n\n**è§£æ³•ä¸€**\n\n```java\npublic boolean hasGroupsSizeX(int[] deck) {\n    HashMap<Integer,Integer> map=new HashMap<>();\n    for(int i=0;i<deck.length;i++){\n        map.put(deck[i],map.getOrDefault(deck[i],0)+1);\n    }\n    int g=-1;\n    for (Integer key:map.keySet()) {\n        int freq=map.get(key);\n        if(g==-1) {\n            g=freq;\n        }else{\n            if(freq<2) return false;\n            g=gcd(freq,g);\n        }\n    }\n    return g>=2;\n}\n\npublic int gcd(int a,int b){\n    if(b==0) return a;\n    return gcd(b,a%b);\n}\n```\nwaä¸€æ¬¡å°±çŸ¥é“å’‹åšäº†ï¼Œä¸€å¼€å§‹ä»¥ä¸ºåªè¦æ‰€æœ‰å…ƒç´ å‡ºç°æ¬¡æ•°å¯ä»¥æ•´é™¤å°±è¡Œäº†ï¼Œwaäº†ä¹‹åå°±æ„è¯†åˆ°åªè¦æ±‚ä¸€ä¸ªæœ€å¤§å…¬çº¦æ•°å°±å¯ä»¥äº†\n\n**è§£æ³•äºŒ**\n\nç»™å®šäº†èŒƒå›´ï¼Œç›´æ¥ç”¨æ•°ç»„æ¨¡æ‹Ÿ\n\n```java\npublic int gcd(int a,int b){\n    if(b==0) return a;\n    return gcd(b,a%b);\n}\n\npublic boolean hasGroupsSizeX2(int[] deck) {\n    int[] hash=new int[10001];\n    for(int i=0;i<deck.length;i++){\n        hash[deck[i]]++;\n    }\n    int g=-1;\n    for (int i=0;i<hash.length-1;i++) {\n        if(hash[i]!=0){\n            if(hash[i]<2) return false;\n            g= g!=-1?gcd(g,hash[i]):hash[i];\n            if(g==1) return false; //ä¼˜åŒ–,æå‰ç»ˆæ­¢\n        }\n    }\n    return g>=2;\n}\n```\n## [165. æ¯”è¾ƒç‰ˆæœ¬å·](https://leetcode-cn.com/problems/compare-version-numbers/)\n\næ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬å· version1 å’Œ version2ã€‚\nå¦‚æœ `version1 > version2` è¿”å› 1ï¼Œå¦‚æœ `version1 < version2` è¿”å› -1ï¼Œ é™¤æ­¤ä¹‹å¤–è¿”å› 0ã€‚\n\nä½ å¯ä»¥å‡è®¾ç‰ˆæœ¬å­—ç¬¦ä¸²éç©ºï¼Œå¹¶ä¸”åªåŒ…å«æ•°å­—å’Œ . å­—ç¬¦ã€‚\n\n . å­—ç¬¦ä¸ä»£è¡¨å°æ•°ç‚¹ï¼Œè€Œæ˜¯ç”¨äºåˆ†éš”æ•°å­—åºåˆ—ã€‚\n\nä¾‹å¦‚ï¼Œ`2.5`  ä¸æ˜¯â€œä¸¤ä¸ªåŠâ€ï¼Œä¹Ÿä¸æ˜¯â€œå·®ä¸€åŠåˆ°ä¸‰â€ï¼Œè€Œæ˜¯ç¬¬äºŒç‰ˆä¸­çš„ç¬¬äº”ä¸ªå°ç‰ˆæœ¬ã€‚\n\nä½ å¯ä»¥å‡è®¾ç‰ˆæœ¬å·çš„æ¯ä¸€çº§çš„é»˜è®¤ä¿®è®¢ç‰ˆå·ä¸º 0ã€‚ä¾‹å¦‚ï¼Œç‰ˆæœ¬å· 3.4 çš„ç¬¬ä¸€çº§ï¼ˆå¤§ç‰ˆæœ¬ï¼‰å’Œç¬¬äºŒçº§ï¼ˆå°ç‰ˆæœ¬ï¼‰ä¿®è®¢å·åˆ†åˆ«ä¸º 3 å’Œ 4ã€‚å…¶ç¬¬ä¸‰çº§å’Œç¬¬å››çº§ä¿®è®¢å·å‡ä¸º 0ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: version1 = \"0.1\", version2 = \"1.1\"\nè¾“å‡º: -1\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: version1 = \"1.0.1\", version2 = \"1\"\nè¾“å‡º: 1\n```\n\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: version1 = \"7.5.2.4\", version2 = \"7.5.3\"\nè¾“å‡º: -1\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šversion1 = \"1.01\", version2 = \"1.001\"\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šå¿½ç•¥å‰å¯¼é›¶ï¼Œâ€œ01â€ å’Œ â€œ001â€ è¡¨ç¤ºç›¸åŒçš„æ•°å­— â€œ1â€ã€‚\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼šversion1 = \"1.0\", version2 = \"1.0.0\"\nè¾“å‡ºï¼š0\nè§£é‡Šï¼šversion1 æ²¡æœ‰ç¬¬ä¸‰çº§ä¿®è®¢å·ï¼Œè¿™æ„å‘³ç€å®ƒçš„ç¬¬ä¸‰çº§ä¿®è®¢å·é»˜è®¤ä¸º â€œ0â€ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. ç‰ˆæœ¬å­—ç¬¦ä¸²ç”±ä»¥ç‚¹ ï¼ˆ.ï¼‰ åˆ†éš”çš„æ•°å­—å­—ç¬¦ä¸²ç»„æˆã€‚è¿™ä¸ªæ•°å­—å­—ç¬¦ä¸²å¯èƒ½æœ‰å‰å¯¼é›¶ã€‚\n2. ç‰ˆæœ¬å­—ç¬¦ä¸²ä¸ä»¥ç‚¹å¼€å§‹æˆ–ç»“æŸï¼Œå¹¶ä¸”å…¶ä¸­ä¸ä¼šæœ‰ä¸¤ä¸ªè¿ç»­çš„ç‚¹ã€‚\n\n**è§£æ³•ä¸€**\n\nè²Œä¼¼ç¬”è¯•å–œæ¬¢å‡ºè¿™é¢˜ï¼ŒæŒºç®€å•çš„ï¼Œç”¨javaåˆ†å‰²çš„æ—¶å€™è¦æ³¨æ„ `\".\"` æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å¦‚æœè¦å°†å®ƒçœ‹ä½œä¸€ä¸ªæ™®é€šå­—ç¬¦éœ€è¦åŠ ä¸ŠåŒæ–œçº¿`\"\\\\.\"`\n\n```java\npublic int compareVersion(String version1, String version2) {\n    String[] v1=version1.split(\"\\\\.\");\n    String[] v2=version2.split(\"\\\\.\");\n    int len1=v1.length,len2=v2.length;\n    int i=0,j=0;\n    while(i<len1 || j<len2) {\n        int a=Integer.valueOf(i<len1?v1[i++]:\"0\");\n        int b=Integer.valueOf(j<len2?v2[j++]:\"0\");\n        if (a<b) {\n            return -1;\n        }else if (a>b){\n            return 1;\n        }\n    }\n    return 0;\n}\n```\n\n## [6. Z å­—å½¢å˜æ¢](https://leetcode-cn.com/problems/zigzag-conversion/)\n\nå°†ä¸€ä¸ªç»™å®šå­—ç¬¦ä¸²æ ¹æ®ç»™å®šçš„è¡Œæ•°ï¼Œä»¥ä»ä¸Šå¾€ä¸‹ã€ä»å·¦åˆ°å³è¿›è¡Œ Z å­—å½¢æ’åˆ—ã€‚\n\næ¯”å¦‚è¾“å…¥å­—ç¬¦ä¸²ä¸º `\"LEETCODEISHIRING\"` è¡Œæ•°ä¸º 3 æ—¶ï¼Œæ’åˆ—å¦‚ä¸‹ï¼š\n\n```java\nL   C   I   R\nE T O E S I I G\nE   D   H   N\n```\n\n\nä¹‹åï¼Œä½ çš„è¾“å‡ºéœ€è¦ä»å·¦å¾€å³é€è¡Œè¯»å–ï¼Œäº§ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼š\"LCIRETOESIIGEDHN\"ã€‚\n\nè¯·ä½ å®ç°è¿™ä¸ªå°†å­—ç¬¦ä¸²è¿›è¡ŒæŒ‡å®šè¡Œæ•°å˜æ¢çš„å‡½æ•°ï¼š\n\n```java\nstring convert(string s, int numRows);\n```\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: s = \"LEETCODEISHIRING\", numRows = 3\nè¾“å‡º: \"LCIRETOESIIGEDHN\"\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: s = \"LEETCODEISHIRING\", numRows = 4\nè¾“å‡º: \"LDREOEIIECIHNTSG\"\nè§£é‡Š:\nL     D     R\nE   O E   I I\nE C   I H   N\nT     S     G\n```\n\n**è§£æ³•ä¸€**\n\næ¯”è¾ƒè„‘æ®‹ï¼Œä½†æ˜¯å‹‰å¼ºè¿˜æ˜¯è¿‡äº†\n\n```java\npublic String convert(String s, int numRows) {\n    if (s==null || s.length()<=0 || numRows==1) {\n        return s;\n    }\n    int len=s.length();\n    //è¶³å¤Ÿçš„ç©ºé—´\n    int[][] strs=new int[((len/((numRows-1)*2))+1)*(numRows-1)][numRows];\n    int index=0,x=0,y=0;\n    boolean flag=false;\n    while(index < s.length()) {\n        if (!flag) {\n            strs[x][y++]=s.charAt(index++);\n            if (y==numRows-1) {\n                flag=true;\n            }\n        }else{\n            strs[x++][y--]=s.charAt(index++);\n            if (y==0) {\n                flag=false;\n            }\n        }\n    }\n    StringBuilder sb=new StringBuilder();\n    for (int j=0;j<strs[0].length;j++) {\n        for (int i=0;i<strs.length;i++) {\n            if (strs[i][j]!=0) {\n                sb.append((char)strs[i][j]);\n            }\n        }\n    }\n    return sb.toString();\n}\n```\n\nå°±æ˜¯å°†å­—ç¬¦æŒ‰ç…§ä¹‹å­—å½¢å¡«å…¥ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼Œç„¶åæŒ‰è§„åˆ™å–å‡ºæ¥å°±okï¼Œæœ€ä¼˜è§£çœ‹äº†ï¼Œæ˜å¤©å†æ¥å†™ï¼\n\n**è§£æ³•äºŒ**\n\nä»Šå¤©è¿˜æ˜¯ä¸å¤Ÿæ¸…æ™°ï¼Œåå¤©å†å†™\n\n## [392. åˆ¤æ–­å­åºåˆ—](https://leetcode-cn.com/problems/is-subsequence/)\n\nç»™å®šå­—ç¬¦ä¸² s å’Œ t ï¼Œåˆ¤æ–­ s æ˜¯å¦ä¸º t çš„å­åºåˆ—ã€‚\n\nä½ å¯ä»¥è®¤ä¸º s å’Œ t ä¸­ä»…åŒ…å«è‹±æ–‡å°å†™å­—æ¯ã€‚å­—ç¬¦ä¸² t å¯èƒ½ä¼šå¾ˆé•¿ï¼ˆé•¿åº¦ ~= 500,000ï¼‰ï¼Œè€Œ s æ˜¯ä¸ªçŸ­å­—ç¬¦ä¸²ï¼ˆé•¿åº¦ <=100ï¼‰ã€‚\n\nå­—ç¬¦ä¸²çš„ä¸€ä¸ªå­åºåˆ—æ˜¯åŸå§‹å­—ç¬¦ä¸²åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å­—ç¬¦è€Œä¸æ”¹å˜å‰©ä½™å­—ç¬¦ç›¸å¯¹ä½ç½®å½¢æˆçš„æ–°å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å¦‚ï¼Œ`\"ace\"`æ˜¯`\"abcde\"`çš„ä¸€ä¸ªå­åºåˆ—ï¼Œè€Œ`\"aec\"`ä¸æ˜¯ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\ns = \"abc\", t = \"ahbgdc\"\nè¿”å› true.\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\ns = \"axc\", t = \"ahbgdc\"\nè¿”å› false.\n```\n\n**åç»­æŒ‘æˆ˜ :**\n\nå¦‚æœæœ‰å¤§é‡è¾“å…¥çš„ Sï¼Œç§°ä½œS1, S2, ... , Sk å…¶ä¸­ k >= 10äº¿ï¼Œä½ éœ€è¦ä¾æ¬¡æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸º T çš„å­åºåˆ—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šæ€æ ·æ”¹å˜ä»£ç ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\n```java\npublic boolean isSubsequence(String s, String t) {\n    if (s==null || t==null) {\n        return false;\n    }\n    int sindex=0,tindex=0;\n    while(sindex<s.length()) {\n        while(tindex<t.length() && sindex<s.length()){\n            if (s.charAt(sindex)==t.charAt(tindex)) {\n                sindex++;\n            }\n            tindex++;\n        }\n        if (tindex==t.length()) {\n            break; \n        }\n    }\n    return sindex==s.length();\n}\n```\nå¯ä»¥æ”¹æˆé€’å½’ï¼ˆå¤šç»ƒä¹ é€’å½’ï¼‰\n\n```java\npublic boolean isSubsequence(String s,String t){\n    return subsequence(s,t,0,0);\n}\n\npublic boolean subsequence(String s,String t,int sindex,int tindex){\n    if (sindex == s.length()) {\n        return true;\n    }\n    //ä¸Šä¸‹ifä¸èƒ½äº¤æ¢,å¯èƒ½æœ€åä¸€ä¸ªæ‰ç›¸ç­‰\n    if (tindex == t.length()) {\n        return false;\n    }\n    return s.charAt(sindex)==t.charAt(tindex)?subsequence(s,t,sindex+1,tindex+1):subsequence(s,t,sindex,tindex+1);\n}\n```\n**è§£æ³•äºŒ**\n\n```java\n//å¤§é‡çš„så­—ç¬¦ä¸² å¤„ç†\npublic boolean isSubsequence3(String s, String t) {\n    //é¢„å¤„ç†\n    ArrayList<ArrayList<Integer>> hash=new ArrayList<>();\n    for (int i=0;i<26;i++) {\n        hash.add(new ArrayList());\n    }\n    for (int i=0;i<t.length();i++) {\n        hash.get(t.charAt(i)-'a').add(i);\n    }\n    //ç»è¿‡ä¸Šé¢çš„é¢„å¤„ç†,åé¢çš„å¤„ç†å°±ä¼šå¾ˆå¿«,ä¸ç”¨å†éå†tå­—ç¬¦ä¸²\n    int lastIndex=-1;\n    for (int i=0;i<s.length();i++) {\n        List<Integer> indexList=hash.get(s.charAt(i)-'a');\n        int temp=binarySearch(indexList,lastIndex);\n        if (temp==indexList.size()) {\n            return false;\n        }\n        lastIndex=indexList.get(temp);\n    }\n    return true;\n}\n\n//æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”targetå¤§çš„å…ƒç´ \npublic int binarySearch(List<Integer> list,int target){\n    int left=0,right=list.size()-1;\n    while(left<=right){\n        int mid=left+(right-left)/2;\n        if (list.get(mid)>target) {\n            right=mid-1;\n        }else{\n            left=mid+1;\n        }\n    }\n    return left;\n}\n```\n\n## [189. æ—‹è½¬æ•°ç»„](https://leetcode-cn.com/problems/rotate-array/)\n\nç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3,4,5,6,7] å’Œ k = 3\nè¾“å‡º: [5,6,7,1,2,3,4]\nè§£é‡Š:\nå‘å³æ—‹è½¬ 1 æ­¥: [7,1,2,3,4,5,6]\nå‘å³æ—‹è½¬ 2 æ­¥: [6,7,1,2,3,4,5]\nå‘å³æ—‹è½¬ 3 æ­¥: [5,6,7,1,2,3,4]\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [-1,-100,3,99] å’Œ k = 2\nè¾“å‡º: [3,99,-1,-100]\nè§£é‡Š: \nå‘å³æ—‹è½¬ 1 æ­¥: [99,-1,-100,3]\nå‘å³æ—‹è½¬ 2 æ­¥: [3,99,-1,-100]\n```\n\n**è¯´æ˜:**\n\n- å°½å¯èƒ½æƒ³å‡ºæ›´å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n- è¦æ±‚ä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸º O(1) çš„ **åŸåœ°** ç®—æ³• \n\n**è§£æ³•ä¸€**\n\nå¸¸è§„è§£æ³•ï¼Œæ¯æ¬¡ä¿ç•™æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»åå¾€å‰å°†æ¯ä¸ªå…ƒç´ èµ‹å€¼ä¸ºå‰ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œè¿™æ ·å°±ç›¸å½“äºå°†æ•°ç»„æ•´ä½“å‘åå¾ªç¯ç§»åŠ¨ä¸€æ¬¡ï¼Œå¾ªç¯ç§»åŠ¨kæ¬¡å°±æ˜¯æœ€åçš„ç»“æœ\n\n```java\npublic void rotate(int[] nums, int k) {\n    if(nums==null||nums.length<=1||k==0){\n        return;\n    }\n    int len=nums.length;\n    k=k%len;\n    for (int i=0;i<k;i++) {\n        int temp=nums[len-1];\n        for (int j=len-1;j>=0;j--) {\n            nums[j]=nums[j-1];\n        }\n        nums[0]=temp;\n    }\n}\n```\næ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œ`O(NK)` Javaå¯ä»¥è¿‡ï¼Œä½†æ˜¯C/C++å¯èƒ½è¿‡ä¸äº†\n\n**è§£æ³•äºŒ**\n\nè¿™ä¸ªåšæ³•å°±ç›¸å½“å·§å¦™äº†ï¼Œä¸‰æ¬¡ç¿»è½¬ğŸ‚ğŸº\n\n```java\n//ç¿»è½¬çš„æ–¹æ³•\npublic void rotate(int[] nums, int k) {\n    if(nums==null||nums.length<=1||k==0){\n        return;\n    }\n    int len=nums.length;\n    k=k%len;\n    if(k==0)return;\n    reverse(nums,0,len-k-1);\n    reverse(nums,len-k,len-1);\n    reverse(nums,0,nums.length-1);\n}\n\npublic void reverse(int []nums,int left,int right){\n    while(left<right){\n        swap(nums,left++,right--);\n    }\n}\n\npublic void swap(int []nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n`O(N)` åº”è¯¥æ˜¯æœ€ä¼˜è§£äº†\n\n## [1232. ç¼€ç‚¹æˆçº¿](https://leetcode-cn.com/problems/check-if-it-is-a-straight-line/)\n\nåœ¨ä¸€ä¸ª XY åæ ‡ç³»ä¸­æœ‰ä¸€äº›ç‚¹ï¼Œæˆ‘ä»¬ç”¨æ•°ç»„ coordinates æ¥åˆ†åˆ«è®°å½•å®ƒä»¬çš„åæ ‡ï¼Œå…¶ä¸­ coordinates[i] = [x, y] è¡¨ç¤ºæ¨ªåæ ‡ä¸º xã€çºµåæ ‡ä¸º y çš„ç‚¹ã€‚\n\nè¯·ä½ æ¥åˆ¤æ–­ï¼Œè¿™äº›ç‚¹æ˜¯å¦åœ¨è¯¥åæ ‡ç³»ä¸­å±äºåŒä¸€æ¡ç›´çº¿ä¸Šï¼Œæ˜¯åˆ™è¿”å› `true`ï¼Œå¦åˆ™è¯·è¿”å›  `false`\n\n**è§£æ³•ä¸€**\n\n10.20ç«èµ›ç¬¬ä¸€é¢˜ï¼Œåˆ¤æ–­ç»™å®šçš„ç‚¹æ˜¯ä¸æ˜¯å†ä¸€æ¡ç›´çº¿ä¸Šï¼Œåˆ¤æ–­å’Œå‰ä¸¤ä¸ªç‚¹æ˜¯ä¸æ˜¯åœ¨ä¸€æ¡ç›´çº¿ä¸Šï¼Œæ³¨æ„ä¸è¦ç›´æ¥é™¤ç®—æ–œç‡ï¼Œé‚£æ ·æ˜¯ä¸å‡†ç¡®çš„\n\n```java\npublic boolean checkStraightLine(int[][] coordinates) {\n    for (int i=2;i<coordinates.length;i++) {\n        if((coordinates[i][1]-coordinates[i-1][1])*(coordinates[i-1][0]-coordinates[i-2][0])!=\n           (coordinates[i][0]-coordinates[i-1][0])*(coordinates[i-1][1]-coordinates[i-2][1])){\n            return false;\n        }\n    }\n    return true;\n}\n```\n\n## [1233. åˆ é™¤å­æ–‡ä»¶å¤¹](https://leetcode-cn.com/problems/remove-sub-folders-from-the-filesystem/)\n\nä½ æ˜¯ä¸€ä½ç³»ç»Ÿç®¡ç†å‘˜ï¼Œæ‰‹é‡Œæœ‰ä¸€ä»½æ–‡ä»¶å¤¹åˆ—è¡¨ folderï¼Œä½ çš„ä»»åŠ¡æ˜¯è¦åˆ é™¤è¯¥åˆ—è¡¨ä¸­çš„æ‰€æœ‰ å­æ–‡ä»¶å¤¹ï¼Œå¹¶ä»¥ ä»»æ„é¡ºåº è¿”å›å‰©ä¸‹çš„æ–‡ä»¶å¤¹ã€‚\n\næˆ‘ä»¬è¿™æ ·å®šä¹‰ã€Œå­æ–‡ä»¶å¤¹ã€ï¼š\n\n- å¦‚æœæ–‡ä»¶å¤¹ `folder[i]` ä½äºå¦ä¸€ä¸ªæ–‡ä»¶å¤¹ `folder[j]` ä¸‹ï¼Œé‚£ä¹ˆ `folder[i]` å°±æ˜¯ `folder[j]` çš„å­æ–‡ä»¶å¤¹ã€‚\n  æ–‡ä»¶å¤¹çš„ã€Œè·¯å¾„ã€æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‰ä»¥ä¸‹æ ¼å¼ä¸²è”å½¢æˆçš„å­—ç¬¦ä¸²ï¼š\n\n- `/` åè·Ÿä¸€ä¸ªæˆ–è€…å¤šä¸ªå°å†™è‹±æ–‡å­—æ¯ã€‚\n  ä¾‹å¦‚ï¼Œ`/leetcode` å’Œ `/leetcode/problems` éƒ½æ˜¯æœ‰æ•ˆçš„è·¯å¾„ï¼Œè€Œç©ºå­—ç¬¦ä¸²å’Œ `/` ä¸æ˜¯ã€‚\n\n **ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šfolder = [\"/a\",\"/a/b\",\"/c/d\",\"/c/d/e\",\"/c/f\"]\nè¾“å‡ºï¼š[\"/a\",\"/c/d\",\"/c/f\"]\nè§£é‡Šï¼š\"/a/b/\" æ˜¯ \"/a\" çš„å­æ–‡ä»¶å¤¹ï¼Œè€Œ \"/c/d/e\" æ˜¯ \"/c/d\" çš„å­æ–‡ä»¶å¤¹ã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šfolder = [\"/a\",\"/a/b/c\",\"/a/b/d\"]\nè¾“å‡ºï¼š[\"/a\"]\nè§£é‡Šï¼šæ–‡ä»¶å¤¹ \"/a/b/c\" å’Œ \"/a/b/d/\" éƒ½ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ \"/a\" çš„å­æ–‡ä»¶å¤¹ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šfolder = [\"/a/b/c\",\"/a/b/d\",\"/a/b/ca\"]\nè¾“å‡ºï¼š[\"/a/b/c\",\"/a/b/ca\",\"/a/b/d\"]\n```\n\n**æç¤ºï¼š**\n\n- 1 <= folder.length <= 4 * 10^4\n- 2 <= folder[i].length <= 100\n- folder[i] åªåŒ…å«å°å†™å­—æ¯å’Œ /\n- folder[i] æ€»æ˜¯ä»¥å­—ç¬¦ / èµ·å§‹\n- æ¯ä¸ªæ–‡ä»¶å¤¹åéƒ½æ˜¯å”¯ä¸€çš„\n\n**è§£æ³•ä¸€**\n\n`2019.10.20`çš„ç«èµ›é¢˜ï¼Œå½“æ—¶æ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚ä¸€ç›´è¶…æ—¶ï¼Œå¤ªèœäº†\n\n```java\npublic List<String> removeSubfolders(String[] folder) {\n    Arrays.sort(folder);\n    List<String> res=new LinkedList<>();\n    int root=0;\n    res.add(folder[0]);\n    for (int i=1;i<folder.length;i++) {\n        if (!folder[i].startsWith(folder[root]+\"/\")) {\n            res.add(folder[i]);\n            root=i;\n        }\n    }\n    return res;\n}\n```\nå½“æ—¶æˆ‘æƒ³åˆ°äº†æ’åºï¼Œä½†æ˜¯å¹¶æ²¡å¤„ç†å¥½ï¼Œæ’åºä¹‹åè¿˜æ˜¯å‚»å‚»çš„ä¸€ä¸ªä¸ªå»å¯¹æ¯”ï¼Œå…¶å®æ’åºåå°±å¾ˆæ¸…æ¥šäº†\n\n`folder = [\"/a\",\"/a/b\",\"/c/d\",\"/c/d/e\",\"/c/f\"]` é¢˜ç›®å…¶å®ä¹Ÿåœ¨æš—ç¤ºæˆ‘ä»¬è¦æ’åºï¼Œç»™çš„caseéƒ½æ˜¯æ’å¥½åºçš„\n\nå½“ç„¶è¿™é‡Œå¾ˆç²¾é«“çš„ä¸€æ­¥å°±æ˜¯åœ¨å¯¹æ¯”çš„æ—¶å€™åœ¨ `folder[root]` åé¢åŠ ä¸Šä¸€ä¸ª `\"/\"` ï¼Œè¿™æ ·å°±ä¸ä¼šå°† `a/b/c` åˆ¤æ–­ä¸º `a/b/ca` çš„æ ¹ç›®å½•äº†~\n\n## [5. æœ€é•¿å›æ–‡å­ä¸²](https://leetcode-cn.com/problems/longest-palindromic-substring/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s çš„æœ€å¤§é•¿åº¦ä¸º 1000ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: \"babad\"\nè¾“å‡º: \"bab\"\næ³¨æ„: \"aba\" ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆã€‚\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: \"cbbd\"\nè¾“å‡º: \"bb\"\n```\n\n**è§£æ³•ä¸€**\n\næ˜¯é¢è¯•ç»å¸¸è€ƒçš„ä¸€é¢˜ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œé™¤äº†è¿™ä¸ªè¿˜æœ‰å‡ é“å›æ–‡çš„é¢˜æˆ‘æ”¾åœ¨åŠ¨æ€è§„åˆ’ä¸“é¢˜ä¸­\n\n```java\npublic String longestPalindrome(String s) {\n    if (s==null || s.length()<=0) {\n        return \"\";\n    }\n    String res=s.charAt(0)+\"\";//åªæœ‰1ä¸ªå­—ç¬¦\n    for (int i=1;i<s.length();i++) {\n        String even=palindrome(s,i-1,i); //å¶æ•°é•¿åº¦å›æ–‡,ä»ä¸¤ä¸ªå­—ç¬¦ä¸­é—´å¼€å§‹æ‰©æ•£\n        String odd=palindrome(s,i,i); //å¥‡æ•°é•¿åº¦å›æ–‡,ä»æŸä¸€ä¸ªå­—ç¬¦å¼€å§‹æ‰©æ•£\n        String temp=odd.length()>even.length()?odd:even;\n        if (temp.length()>res.length()) {\n            res=temp;\n        }\n    }\n    return res;\n}\n\npublic String palindrome(String s,int i,int j){\n    while(i>=0 && j<=s.length()-1 && s.charAt(i)==s.charAt(j)){\n        i--;\n        j++;\n    }\n    return s.substring(i+1,j);\n}\n```\nå¦‚æœé‡‡ç”¨æš´åŠ›æ³•çš„è¯å°±æ˜¯æšä¸¾æ‰€æœ‰å­ä¸²ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯å›æ–‡ä¸²ï¼Œæœ€åæ±‚ä¸ªæœ€é•¿çš„ï¼Œæ—¶é—´å¤æ‚åº¦`O(N^3)` ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å›æ–‡çš„ç‰¹å¾ï¼Œåˆ©ç”¨ä¸­å¿ƒæ‰©æ•£æ³•ï¼Œä»¥`str`çš„**å„ä¸ªä½ç½®**ä½œä¸ºä¸­å¿ƒï¼Œå‘ä¸¤è¾¹æ‰©æ•£ï¼Œæœ€åæ±‚å¾—æœ€å¤§å€¼ï¼Œæ³¨æ„å¾—è¿™é‡Œè¯´çš„æ˜¯**å„ä¸ªä½ç½®**ï¼Œè¿™ä¸ªé‡Œé¢å…¶å®å°±åŒ…å«äº†å…ƒç´ ä¹‹é—´çš„é—´éš™ï¼Œå…¶å®æ•´ä½“æ€è·¯è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä½†ç»è¿‡æˆ‘ä»¬å°å°çš„è½¬æ¢æ€è·¯ï¼Œæ—¶é—´å¤æ‚åº¦å°±é™ä½åˆ°äº†`O(N^2)`ï¼Œå½“ç„¶ï¼Œè¿™é‡Œè¿˜ä¸æ˜¯æœ€ä¼˜è§£ï¼Œæœ€ä¼˜åº”è¯¥æ˜¯[Manacher](https://oi-wiki.org/string/manacher/) ï¼ˆé©¬æ‹‰è½¦ï¼‰ç®—æ³•ï¼Œç­‰åé¢æœ‰æ—¶é—´æˆ‘å†æ¥ç ”ç©¶è¿™ç§ç®—æ³•\n\n## [336. å›æ–‡å¯¹](https://leetcode-cn.com/problems/palindrome-pairs/)\n\nDifficulty: **å›°éš¾**\n\n\nç»™å®šä¸€ç»„ **äº’ä¸ç›¸åŒ** çš„å•è¯ï¼Œ æ‰¾å‡ºæ‰€æœ‰**ä¸åŒ**çš„ç´¢å¼•å¯¹`(i, j)`ï¼Œä½¿å¾—åˆ—è¡¨ä¸­çš„ä¸¤ä¸ªå•è¯ï¼ŒÂ `words[i] + words[j]`Â ï¼Œå¯æ‹¼æ¥æˆå›æ–‡ä¸²ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼š[\"abcd\",\"dcba\",\"lls\",\"s\",\"sssll\"]\nè¾“å‡ºï¼š[[0,1],[1,0],[3,2],[2,4]] \nè§£é‡Šï¼šå¯æ‹¼æ¥æˆçš„å›æ–‡ä¸²ä¸º [\"dcbaabcd\",\"abcddcba\",\"slls\",\"llssssll\"]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼š[\"bat\",\"tab\",\"cat\"]\nè¾“å‡ºï¼š[[0,1],[1,0]] \nè§£é‡Šï¼šå¯æ‹¼æ¥æˆçš„å›æ–‡ä¸²ä¸º [\"battab\",\"tabbat\"]\n```\n\n**è§£æ³•ä¸€**\n\næšä¸¾å•è¯çš„æ‰€æœ‰å‰ç¼€oråç¼€ï¼Œå¦‚æœé™¤äº†å‰ç¼€oråç¼€å‰©ä½™éƒ¨åˆ†æ˜¯å›æ–‡ä¸²ï¼Œå¹¶ä¸”åœ¨dictä¸­å­˜åœ¨å‰ç¼€oråç¼€çš„ç¿»è½¬ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå•è¯å°±èƒ½æ„æˆå›æ–‡å¯¹\n```golang\nfunc palindromePairs(words []string) [][]int {\n    var dict = make(map[string]int)\n    for i := 0; i < len(words); i++ {\n        dict[reverse(words[i])] = i\n    }\n    var res [][]int\n    for i := 0; i < len(words); i++ {\n        for j := 0; j <= len(words[i]); j++ {\n            if idx, ok := dict[words[i][:j]]; ok && idx != i && isPalindrome(words[i][j:]) {\n                res = append(res, []int{i, idx})\n            }\n            //è¿™é‡Œéœ€è¦åˆ¤æ–­ä¸‹j!=0ï¼Œé¿å…é‡å¤çš„åˆ¤æ–­ï¼Œs[0:] == s[:len(s)]\n            if idx, ok := dict[words[i][j:]]; j != 0 && ok && idx != i && isPalindrome(words[i][:j]) {\n                res = append(res, []int{idx, i})\n            }\n        }\n    }\n    return res\n}\n\nfunc reverse(s string) string {\n    var bs = []byte(s)\n    for i, j := 0, len(bs)-1; i < j; i, j = i+1, j-1 {\n        bs[i], bs[j] = bs[j], bs[i]\n    }\n    return string(bs)\n}\n\nfunc isPalindrome(s string) bool {\n    for i, j := 0, len(s)-1; i < j; i, j = i+1, j-1 {\n        if s[i] != s[j] {\n            return false\n        }\n    }\n    return true\n}\n```\nå±äºæ¯”è¾ƒæš´åŠ›çš„è§£æ³•ï¼Œè¿™é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨é©¬æ‹‰è½¦&å­—å…¸æ ‘ï¼Œè¿™é‡Œæˆ‘å°±ä¸å¤šå†™äº†\n## [409. æœ€é•¿å›æ–‡ä¸²](https://leetcode-cn.com/problems/longest-palindrome/)\n\nç»™å®šä¸€ä¸ªåŒ…å«å¤§å†™å­—æ¯å’Œå°å†™å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°é€šè¿‡è¿™äº›å­—æ¯æ„é€ æˆçš„æœ€é•¿çš„å›æ–‡ä¸²ã€‚\n\nåœ¨æ„é€ è¿‡ç¨‹ä¸­ï¼Œè¯·æ³¨æ„åŒºåˆ†å¤§å°å†™ã€‚æ¯”å¦‚ `\"Aa\"` ä¸èƒ½å½“åšä¸€ä¸ªå›æ–‡å­—ç¬¦ä¸²ã€‚\n\n**æ³¨æ„:**\nå‡è®¾å­—ç¬¦ä¸²çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 1010ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥:\n\"abccccdd\"\n\nè¾“å‡º:\n7\n\nè§£é‡Š:\næˆ‘ä»¬å¯ä»¥æ„é€ çš„æœ€é•¿çš„å›æ–‡ä¸²æ˜¯\"dccaccd\", å®ƒçš„é•¿åº¦æ˜¯ 7ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nå’Œä¸Šé¢çš„é¢˜ç›®åå­—ä¸€æ ·ï¼Œä½†æ˜¯è¯·æ³¨æ„å®¡é¢˜ï¼ï¼ï¼\n\n```java\npublic int longestPalindrome(String s) {\n    if(s==null || s.length()<=0) return 0;\n    int[] hash=new int[128];\n    for(int i=0;i<s.length();i++){\n        hash[s.charAt(i)]++;\n    }\n    //Arrays.sort(hash);\n    int res=0;boolean flag=false;\n    for(int i=hash.length-1;i>=0;i--){\n        if(hash[i]!=0){\n            if(hash[i]%2==0){\n                res+=hash[i]; //å¶æ•°ç›´æ¥åŠ \n            }else{\n                flag=true;\n                res+=(hash[i]-1); //å¥‡æ•°å‡ä¸€å†åŠ \n            }\n        }\n    }\n    return flag?res+1:res;\n}\n```\n\n## [680. éªŒè¯å›æ–‡å­—ç¬¦ä¸² â…¡](https://leetcode-cn.com/problems/valid-palindrome-ii/)\n\nç»™å®šä¸€ä¸ªéç©ºå­—ç¬¦ä¸² `s`ï¼Œ**æœ€å¤š**åˆ é™¤ä¸€ä¸ªå­—ç¬¦ã€‚åˆ¤æ–­æ˜¯å¦èƒ½æˆä¸ºå›æ–‡å­—ç¬¦ä¸²ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"aba\"\nè¾“å‡º: True\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"abca\"\nè¾“å‡º: True\nè§£é‡Š: ä½ å¯ä»¥åˆ é™¤cå­—ç¬¦ã€‚\n```\n\n**æ³¨æ„:**\n\n1. å­—ç¬¦ä¸²åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦æ˜¯50000ã€‚\n\n**è§£æ³•ä¸€**\n\næ¨¡æ‹Ÿå°±è¡Œäº†\n\n```java\npublic boolean validPalindrome(String s) {\n    if(s==null || s.length()<=0) return true;\n    int left=0,right=s.length()-1;\n    while(left<right){\n        if(s.charAt(left)==s.charAt(right)){\n            left++;right--;\n        }else{\n            return valid(s,left+1,right) || valid(s,left,right-1);\n        }\n    }\n    return true;\n}\n\npublic boolean valid(String s,int left,int right){\n    while(left<=right){\n        if(s.charAt(left)==s.charAt(right)){\n            left++;right--;\n        }else{\n            return false;\n        }\n    }\n    return true;\n}\n```\n\n## [1332. åˆ é™¤å›æ–‡å­åºåˆ—](https://leetcode-cn.com/problems/remove-palindromic-subsequences/)\n\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œå®ƒä»…ç”±å­—æ¯ 'a' å’Œ 'b' ç»„æˆã€‚æ¯ä¸€æ¬¡åˆ é™¤æ“ä½œéƒ½å¯ä»¥ä» s ä¸­åˆ é™¤ä¸€ä¸ªå›æ–‡ **å­åºåˆ—**ã€‚\n\nè¿”å›åˆ é™¤ç»™å®šå­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—ç¬¦ï¼ˆå­—ç¬¦ä¸²ä¸ºç©ºï¼‰çš„æœ€å°åˆ é™¤æ¬¡æ•°ã€‚\n\nã€Œå­åºåˆ—ã€å®šä¹‰ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡åˆ é™¤åŸå­—ç¬¦ä¸²æŸäº›å­—ç¬¦è€Œä¸æ”¹å˜åŸå­—ç¬¦é¡ºåºå¾—åˆ°ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯åŸå­—ç¬¦ä¸²çš„ä¸€ä¸ªå­åºåˆ—ã€‚\n\nã€Œå›æ–‡ã€å®šä¹‰ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å‘åå’Œå‘å‰è¯»æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªå›æ–‡ã€‚ \n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"ababa\"\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šå­—ç¬¦ä¸²æœ¬èº«å°±æ˜¯å›æ–‡åºåˆ—ï¼Œåªéœ€è¦åˆ é™¤ä¸€æ¬¡ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"abb\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š\"abb\" -> \"bb\" -> \"\". \nå…ˆåˆ é™¤å›æ–‡å­åºåˆ— \"a\"ï¼Œç„¶åå†åˆ é™¤ \"bb\"ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"baabb\"\nè¾“å‡ºï¼š2\nè§£é‡Šï¼š\"baabb\" -> \"b\" -> \"\". \nå…ˆåˆ é™¤å›æ–‡å­åºåˆ— \"baab\"ï¼Œç„¶åå†åˆ é™¤ \"b\"ã€‚\n```\n\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"\"\nè¾“å‡ºï¼š0\n```\n\n**æç¤ºï¼š**\n\n- `0 <= s.length <= 1000`\n- `s` ä»…åŒ…å«å­—æ¯ 'a'  å’Œ 'b'\n\n**è§£æ³•ä¸€**\n\næŸä¸€æ¬¡å‘¨èµ›çš„ç¬¬ä¸€é¢˜ï¼Œä¹ä¸€çœ‹æœ€é•¿å›æ–‡å­ä¸²ï¼Ÿæœ€é•¿å›æ–‡åºåˆ—ï¼Ÿè¿™é¢˜å½“æ—¶è¿˜æ˜¯éš¾åˆ°äº†ä¸å°‘äººï¼Œæˆ‘é‚£æ¬¡æ²¡å‚åŠ ï¼Œåå°å¬è¯´äº†ç¬¬ä¸€é¢˜æ˜¯ä¸ªå‘ï¼Œç„¶åè¿™é‡Œå®¡é¢˜çš„æ—¶å€™å°±å¾ˆæ³¨æ„ï¼Œæ²¡è¸©å‘ğŸ˜\n\n```java\npublic int removePalindromeSub(String s) {\n    if (s==null || s.length()<=0) {\n        return 0;\n    }\n    for(int i=0,j=s.length()-1;i<=j;i++,j--){\n        if (s.charAt(i)!=s.charAt(j)) {\n            return 2;\n        }\n    }\n    return 1;\n}\n```\n\né¢˜ç›®è¯´äº†åªæœ‰ä¸¤ä¸ªå­—æ¯aå’Œbï¼Œè€Œä¸”è¦åˆ é™¤çš„æ˜¯**å›æ–‡å­åºåˆ—**ï¼Œè¿™æ ·ä¸€è¯´å°±æ¸…æ¥šäº†ï¼Œè¿™æ‰æ˜¯ç®€å•é¢˜çš„æ°´å‡†å‘~è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè„‘ç­‹æ€¥è½¬å¼¯hahaha\n\n\n## [435. æ— é‡å åŒºé—´](https://leetcode-cn.com/problems/non-overlapping-intervals/)\n\nç»™å®šä¸€ä¸ªåŒºé—´çš„é›†åˆï¼Œæ‰¾åˆ°éœ€è¦ç§»é™¤åŒºé—´çš„æœ€å°æ•°é‡ï¼Œä½¿å‰©ä½™åŒºé—´äº’ä¸é‡å ã€‚\n\næ³¨æ„:\n\n- å¯ä»¥è®¤ä¸ºåŒºé—´çš„ç»ˆç‚¹æ€»æ˜¯å¤§äºå®ƒçš„èµ·ç‚¹ã€‚\n- åŒºé—´ [1,2] å’Œ [2,3] çš„è¾¹ç•Œç›¸äº’â€œæ¥è§¦â€ï¼Œä½†æ²¡æœ‰ç›¸äº’é‡å ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [ [1,2], [2,3], [3,4], [1,3] ]\n\nè¾“å‡º: 1\n\nè§£é‡Š: ç§»é™¤ [1,3] åï¼Œå‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [ [1,2], [1,2], [1,2] ]\n\nè¾“å‡º: 2\n\nè§£é‡Š: ä½ éœ€è¦ç§»é™¤ä¸¤ä¸ª [1,2] æ¥ä½¿å‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: [ [1,2], [2,3] ]\n\nè¾“å‡º: 0\n\nè§£é‡Š: ä½ ä¸éœ€è¦ç§»é™¤ä»»ä½•åŒºé—´ï¼Œå› ä¸ºå®ƒä»¬å·²ç»æ˜¯æ— é‡å çš„äº†ã€‚\n```\n\n**è§£æ³•ä¸€**\n\nåŠ¨æ€è§„åˆ’ï¼Œå…¶å®å’Œæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ä¸€æ ·çš„\n\n```java\npublic int eraseOverlapIntervals(int[][] intervals) {\n    if (intervals==null || intervals.length<=0) {\n        return 0;\n    }\n    Arrays.sort(intervals,(a,b)->a[0]-b[0]);\n    int[]dp=new int[intervals.length];\n    int max=-1;\n    for (int i=0;i<intervals.length;i++) {\n        dp[i]=1;\n        for (int j=0;j<i;j++) {\n            if(intervals[i][0]>=intervals[j][1]){\n                dp[i]=Math.max(dp[j]+1,dp[i]);\n            }\n        }\n        max=Math.max(max,dp[i]);\n    }\n    return intervals.length-max;\n}\n```\n171msï¼Œ8%ï¼Œæ„Ÿè§‰å¿«è¦è¿‡ä¸äº†äº†ã€‚ã€‚ã€‚æœ¬æ¥æ˜¯æ˜¯å†™çš„è®°å¿†åŒ–é€’å½’çš„ï¼Œç»“æœè¿‡ä¸äº†ã€‚ã€‚ã€‚å¡åœ¨å€’æ•°ç¬¬äºŒä¸ªcaseä¸Š\n\n```java\nHashMap<Pair,Integer> cache=new HashMap<>();//TLE\n\npublic int eraseOverlapIntervals2(int[][] intervals) {\n    Arrays.sort(intervals,(a,b)->a[0]-b[0]);\n    return intervals.length-dfs(intervals,0,Integer.MIN_VALUE);\n}\n\n//èƒŒåŒ…é—®é¢˜,è¿”å›æœ€å¤šå¯ä»¥ç•™ä¸‹çš„åŒºé—´\npublic int dfs(int[][] intervals,int index,int prev) {\n    if (index==intervals.length) {\n        return 0;\n    }\n    Pair key=new Pair(index,prev);\n    if (cache.containsKey(key)) {\n        return cache.get(key);\n    }\n    int res=dfs(intervals,index+1,prev);\n    if (intervals[index][0]>=prev) {\n        res=Math.max(res,dfs(intervals,index+1,intervals[index][1])+1);\n    }\n    cache.put(key,res);\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nè´ªå¿ƒï¼Œæ—¶é—´å¤æ‚åº¦é™ä½ä¸ºçº¿æ€§\n\n```java\npublic int eraseOverlapIntervals(int[][] intervals) {\n    if (intervals==null || intervals.length<=0) {\n        return 0;\n    }\n    //æŒ‰ç…§èµ·ç‚¹æ’åº,é‡å çš„æ—¶å€™é€‰æ‹©ä¿ç•™ç»“å°¾å°çš„é‚£ä¸€ä¸ª\n    //Arrays.sort(intervals,(a,b)->a[0]-b[0]); lambdaåˆå§‹åŒ–æ•ˆç‡ä¼šä½ä¸€ç‚¹\n    Arrays.sort(intervals,new Comparator<int[]>(){\n        @Override\n        public int compare(int[] a,int[] b){\n            return a[0]-b[0];\n        }\n    });\n    int res=1;\n    int prev=0;\n    for (int i=1;i<intervals.length;i++) {\n        if (intervals[i][0]>=intervals[prev][1]) {\n            res++;\n            prev=i;\n        }else if(intervals[i][1]<intervals[prev][1]){\n            prev=i; //é€‰æ‹©ç»“å°¾å°çš„é‚£ä¸€ä¸ª\n        }\n    }\n    return intervals.length-res;\n}\n```\næŒ‰ç…§èµ·ç‚¹æ’åºï¼Œåœ¨é‡å çš„æ—¶å€™ä¼˜å…ˆé€‰æ‹©ç»“å°¾å°çš„å“ªä¸€ä¸ªï¼Œè¿™æ ·å°±å¯èƒ½å¾—åˆ°æ›´å¤šçš„åŒºé—´ç»„åˆï¼Œå…³äºè¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§æˆ‘å°±ä¸è¯æ˜äº†\n\n\n\n## [263. ä¸‘æ•°](https://leetcode-cn.com/problems/ugly-number/)\n\nç¼–å†™ä¸€ä¸ªç¨‹åºåˆ¤æ–­ç»™å®šçš„æ•°æ˜¯å¦ä¸ºä¸‘æ•°ã€‚\n\nä¸‘æ•°å°±æ˜¯åªåŒ…å«è´¨å› æ•° 2, 3, 5 çš„æ­£æ•´æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 6\nè¾“å‡º: true\nè§£é‡Š: 6 = 2 Ã— 3\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 8\nè¾“å‡º: true\nè§£é‡Š: 8 = 2 Ã— 2 Ã— 2\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: 14\nè¾“å‡º: false \nè§£é‡Š: 14 ä¸æ˜¯ä¸‘æ•°ï¼Œå› ä¸ºå®ƒåŒ…å«äº†å¦å¤–ä¸€ä¸ªè´¨å› æ•° 7ã€‚\n```\n\n**è¯´æ˜ï¼š**\n\n1. `1` æ˜¯ä¸‘æ•°ã€‚\n2. è¾“å…¥ä¸ä¼šè¶…è¿‡ `32` ä½æœ‰ç¬¦å·æ•´æ•°çš„èŒƒå›´: `[âˆ’231,  231 âˆ’ 1]`ã€‚\n\n**è§£æ³•ä¸€**\n\nç›´æ¥æš´åŠ›ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•\n\n```java\npublic boolean isUgly(int num) {\n    if (num<=0) {\n        return false;\n    }\n    if(num==1) {\n        return true;\n    }\n    return num%2==0?isUgly(num/2):false || num%3==0?isUgly(num/3):false || num%5==0?isUgly(num/5):false;\n}\n```\n\n## [1333. é¤å…è¿‡æ»¤å™¨](https://leetcode-cn.com/problems/filter-restaurants-by-vegan-friendly-price-and-distance/)\n\nç»™ä½ ä¸€ä¸ªé¤é¦†ä¿¡æ¯æ•°ç»„ `restaurants`ï¼Œå…¶ä¸­  `restaurants[i] = [idi, ratingi, veganFriendlyi, pricei, distancei]`ã€‚ä½ å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªè¿‡æ»¤å™¨æ¥è¿‡æ»¤è¿™äº›é¤é¦†ä¿¡æ¯ã€‚\n\nå…¶ä¸­ç´ é£Ÿè€…å‹å¥½è¿‡æ»¤å™¨ `veganFriendly` çš„å€¼å¯ä»¥ä¸º `true` æˆ–è€… `false`ï¼Œå¦‚æœä¸º `true` å°±æ„å‘³ç€ä½ åº”è¯¥åªåŒ…æ‹¬ `veganFriendlyi` ä¸º `true` çš„é¤é¦†ï¼Œä¸º `false` åˆ™æ„å‘³ç€å¯ä»¥åŒ…æ‹¬ä»»ä½•é¤é¦†ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰æœ€å¤§ä»·æ ¼ `maxPrice` å’Œæœ€å¤§è·ç¦» `maxDistance` ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼Œå®ƒä»¬åˆ†åˆ«è€ƒè™‘é¤å…çš„ä»·æ ¼å› ç´ å’Œè·ç¦»å› ç´ çš„æœ€å¤§å€¼ã€‚\n\nè¿‡æ»¤åè¿”å›é¤é¦†çš„ `id`ï¼ŒæŒ‰ç…§ `rating` ä»é«˜åˆ°ä½æ’åºã€‚å¦‚æœ `rating` ç›¸åŒï¼Œé‚£ä¹ˆæŒ‰ `id` ä»é«˜åˆ°ä½æ’åºã€‚ç®€å•èµ·è§ï¼Œ `veganFriendlyi` å’Œ `veganFriendly` ä¸º `true` æ—¶å–å€¼ä¸º 1ï¼Œä¸º `false` æ—¶ï¼Œå–å€¼ä¸º 0 ã€‚\n\n**ç¤ºä¾‹ä¸€**\n\n```java\nè¾“å…¥ï¼šrestaurants = [[1,4,1,40,10],[2,8,0,50,5],[3,8,1,30,4],[4,10,0,10,3],[5,1,1,15,1]], veganFriendly = 1, maxPrice = 50, maxDistance = 10\nè¾“å‡ºï¼š[3,1,5] \nè§£é‡Šï¼š \nè¿™äº›é¤é¦†ä¸ºï¼š\né¤é¦† 1 [id=1, rating=4, veganFriendly=1, price=40, distance=10]\né¤é¦† 2 [id=2, rating=8, veganFriendly=0, price=50, distance=5]\né¤é¦† 3 [id=3, rating=8, veganFriendly=1, price=30, distance=4]\né¤é¦† 4 [id=4, rating=10, veganFriendly=0, price=10, distance=3]\né¤é¦† 5 [id=5, rating=1, veganFriendly=1, price=15, distance=1] \nåœ¨æŒ‰ç…§ veganFriendly = 1, maxPrice = 50 å’Œ maxDistance = 10 è¿›è¡Œè¿‡æ»¤åï¼Œæˆ‘ä»¬å¾—åˆ°äº†é¤é¦† 3, é¤é¦† 1 å’Œ é¤é¦† 5ï¼ˆæŒ‰è¯„åˆ†ä»é«˜åˆ°ä½æ’åºï¼‰ã€‚ \n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šrestaurants = [[1,4,1,40,10],[2,8,0,50,5],[3,8,1,30,4],[4,10,0,10,3],[5,1,1,15,1]], veganFriendly = 0, maxPrice = 50, maxDistance = 10\nè¾“å‡ºï¼š[4,3,2,1,5]\nè§£é‡Šï¼šé¤é¦†ä¸ç¤ºä¾‹ 1 ç›¸åŒï¼Œä½†åœ¨ veganFriendly = 0 çš„è¿‡æ»¤æ¡ä»¶ä¸‹ï¼Œåº”è¯¥è€ƒè™‘æ‰€æœ‰é¤é¦†ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼šrestaurants = [[1,4,1,40,10],[2,8,0,50,5],[3,8,1,30,4],[4,10,0,10,3],[5,1,1,15,1]], veganFriendly = 0, maxPrice = 30, maxDistance = 3\nè¾“å‡ºï¼š[4,5]\n```\n\n**æç¤ºï¼š**\n\n- `1 <= restaurants.length <= 10^4`\n- `restaurants[i].length == 5`\n- `1 <= idi, ratingi, pricei, distancei <= 10^5`\n- `1 <= maxPrice, maxDistance <= 10^5`\n- `veganFriendlyi` å’Œ `veganFriendly` çš„å€¼ä¸º 0 æˆ– 1 ã€‚\n- æ‰€æœ‰ `idi` å„ä¸ç›¸åŒã€‚\n\n**è§£æ³•ä¸€**\n\nçœ‹åˆ°è¿™ä¸ªé¢˜ï¼Œjavaerä¸ç”¨streamå¯å¤ªå¯æƒœäº†hahaha\n\n```java\npublic List<Integer> filterRestaurants(int[][] restaurants, int veganFriendly, int maxPrice, int maxDistance) {\n    return Stream.of(restaurants)\n        .filter(r-> (veganFriendly==1?r[2]==veganFriendly:true) && r[4]<=maxDistance && r[3]<=maxPrice)\n        .sorted((r1,r2)->r1[1]!=r2[1]?r2[1]-r1[1]:r2[0]-r1[0])\n        .map(r->r[0])\n        .collect(Collectors.toList());\n}\n```\n\n## [5313. æ—¶é’ŸæŒ‡é’ˆçš„å¤¹è§’](https://leetcode-cn.com/problems/angle-between-hands-of-a-clock/)\n\nç»™ä½ ä¸¤ä¸ªæ•° `hour` å’Œ `minutes` ã€‚è¯·ä½ è¿”å›åœ¨æ—¶é’Ÿä¸Šï¼Œç”±ç»™å®šæ—¶é—´çš„æ—¶é’ˆå’Œåˆ†é’ˆç»„æˆçš„è¾ƒå°è§’çš„è§’åº¦ï¼ˆ60 å•ä½åˆ¶ï¼‰ã€‚\n\nè¿™é¢˜å°±æ‡’å¾—copyäº†ï¼Œ19åœºåŒå‘¨èµ›çš„ç¬¬ä¸‰é¢˜ï¼Œä¸åº”è¯¥æ˜¯midé¢˜çš„ã€‚ã€‚ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic double angleClock(int hour, int minutes) {\n    double m=minutes/60.0 * 360;\n    double h=((hour/12.0)*360)%360 + 30*minutes/60.0;\n    return Math.min(Math.abs(m-h),360-Math.abs(m-h));\n}\n```\n\nåŒ–ç®€ä¸€ä¸‹æ˜¯ **hæ—¶måˆ†çš„å¤¹è§’ä¸ºï¼š5.5m-30h**\n\n## [5169. æ—¥æœŸä¹‹é—´éš”å‡ å¤©](https://leetcode-cn.com/problems/number-of-days-between-two-dates/)\n\nè¯·ä½ ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´éš”äº†å¤šå°‘å¤©ã€‚\n\næ—¥æœŸä»¥å­—ç¬¦ä¸²å½¢å¼ç»™å‡ºï¼Œæ ¼å¼ä¸º `YYYY-MM-DD`ã€‚\n\n**è§£æ³•ä¸€**\n\n177å‘¨èµ›çš„T1\n\n```java\nimport java.time.*;\nimport java.time.temporal.ChronoUnit;\nclass Solution {\n    public int daysBetweenDates(String date1, String date2) {\n        return (int)Math.abs(LocalDate.parse(date1).until(LocalDate.parse(date2),ChronoUnit.DAYS));\n    }\n}\n```\n\nåšLeetCodeå°‘æ•°å¯¼åŒ…äº†çš„é¢˜ğŸ¤£\n\n**è§£æ³•äºŒ**\n\ncopyå¤§ä½¬çš„åŸç”Ÿè§£æ³•\n\n```java\n\nprivate int[] months = new int[]{0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};\n\npublic int daysBetweenDates(String date1, String date2) {\n    String[] d1 = date1.split(\"-\");\n    String[] d2 = date2.split(\"-\");\n    int day1 = getYears(Integer.valueOf(d1[0]) - 1) + getMonths(Integer.valueOf(d1[0]), Integer.valueOf(d1[1]) - 1) + Integer.valueOf(d1[2]);\n    int day2 = getYears(Integer.valueOf(d2[0]) - 1) + getMonths(Integer.valueOf(d2[0]), Integer.valueOf(d2[1]) - 1) + Integer.valueOf(d2[2]);\n    return Math.abs(day1 - day2);\n}\n\nprivate int getYears(int year) {\n    int sum = (year - 1971) * 365;\n    for (int i = 1971; i <= year; ++i) {\n        if (isRun(i)) {\n            ++sum;\n        }\n    }\n    return sum;\n}\n\nprivate int getMonths(int year, int month) {\n    int sum = 0;\n    for (int i = 1; i <= month; ++i) {\n        sum += months[i];\n    }\n    if (isRun(year) && month >= 2) {\n        ++sum;\n    }\n    return sum;\n}\n\nprivate boolean isRun(int year) {\n    return (year % 4 == 0 && year % 100 != 0) || (year % 400 == 0);\n}\n```\n\n## [557. åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯ III](https://leetcode-cn.com/problems/reverse-words-in-a-string-iii/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½ éœ€è¦åè½¬å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå•è¯çš„å­—ç¬¦é¡ºåºï¼ŒåŒæ—¶ä»ä¿ç•™ç©ºæ ¼å’Œå•è¯çš„åˆå§‹é¡ºåºã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"Let's take LeetCode contest\"\nè¾“å‡º: \"s'teL ekat edoCteeL tsetnoc\" \n```\n\n**æ³¨æ„ï¼š**åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œæ¯ä¸ªå•è¯ç”±å•ä¸ªç©ºæ ¼åˆ†éš”ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²ä¸­ä¸ä¼šæœ‰ä»»ä½•é¢å¤–çš„ç©ºæ ¼\n\n**è§£æ³•ä¸€**\n\nåŸç”Ÿçš„åšæ³•\n\n```java\npublic String reverseWords(String s) {\n    s+=\" \";//ç»Ÿä¸€æ“ä½œ\n    char[] cs=s.toCharArray();\n    int start=0;\n    for (int i=0;i<cs.length;i++) {\n        if (cs[i]==' ') {\n            reverse(cs,start,i-1);\n            start=i+1;\n        }\n    }\n    return new String(cs,0,cs.length-1);\n}\n\npublic void reverse(char[] s,int left,int right){\n    for (int i=left,j=right;i<j;i++,j--) {\n        char temp=s[i];\n        s[i]=s[j];\n        s[j]=temp;\n    }\n}\n```\n\n## [151. ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯](https://leetcode-cn.com/problems/reverse-words-in-a-string/)\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€ä¸ªç¿»è½¬å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå•è¯ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: \"the sky is blue\"\nè¾“å‡º: \"blue is sky the\"\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: \"  hello world!  \"\nè¾“å‡º: \"world! hello\"\nè§£é‡Š: è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯åè½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥: \"a good   example\"\nè¾“å‡º: \"example good a\"\nè§£é‡Š: å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚\n```\n\n**è¯´æ˜ï¼š**\n\n- æ— ç©ºæ ¼å­—ç¬¦æ„æˆä¸€ä¸ªå•è¯ã€‚\n- è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥åœ¨å‰é¢æˆ–è€…åé¢åŒ…å«å¤šä½™çš„ç©ºæ ¼ï¼Œä½†æ˜¯åè½¬åçš„å­—ç¬¦ä¸èƒ½åŒ…æ‹¬ã€‚\n- å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚\n\n**è¿›é˜¶ï¼š**\n\nè¯·é€‰ç”¨ C è¯­è¨€çš„ç”¨æˆ·å°è¯•ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¤æ‚åº¦çš„åŸåœ°è§£æ³•ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic String reverseWords(String s) {\n    if(s==null || s.length()<=0) return \"\";\n    Deque<String> stack=new ArrayDeque<>();\n    for(int i=0;i<s.length();i++){\n        if(s.charAt(i)==' '){\n            continue;\n        }\n        int j=i;\n        while(i<s.length() && s.charAt(i)!=' '){\n            i++;\n        }\n        stack.push(s.substring(j,i));\n    }\n    if(stack.isEmpty()) return \"\";\n    StringBuilder sb=new StringBuilder();\n    sb.append(stack.pop());\n    while(!stack.isEmpty()){\n        sb.append(\" \"+stack.pop());\n    }\n    return sb.toString();\n}\n```\næ¯”è¾ƒåŸç”Ÿçš„åšæ³•ï¼Œæœ€å¼€å§‹å†™çš„å€ŸåŠ©splitç­‰æ–¹æ³•çš„ï¼Œæ¯”è¾ƒç®€å•å°±ä¸å¤šè¯´äº†\n\n**è§£æ³•äºŒ**\n\nåŸåœ°çš„åšæ³•ï¼Œæ¯”è¾ƒç¹çï¼Œåé¢æœ‰æ—¶é—´å†æ¥å®ç°ä¸‹\n\n1. ç¿»è½¬æ•´ä¸ªå­—ç¬¦\n2. ç¿»è½¬å•ä¸ªå­—ç¬¦\n3. å»é™¤å¤šä½™ç©ºæ ¼\n\n## [é¢è¯•é¢˜ 01.06. å­—ç¬¦ä¸²å‹ç¼©](https://leetcode-cn.com/problems/compress-string-lcci/)\n\nå­—ç¬¦ä¸²å‹ç¼©ã€‚åˆ©ç”¨å­—ç¬¦é‡å¤å‡ºç°çš„æ¬¡æ•°ï¼Œç¼–å†™ä¸€ç§æ–¹æ³•ï¼Œå®ç°åŸºæœ¬çš„å­—ç¬¦ä¸²å‹ç¼©åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œå­—ç¬¦ä¸²aabcccccaaaä¼šå˜ä¸ºa2b1c5a3ã€‚è‹¥â€œå‹ç¼©â€åçš„å­—ç¬¦ä¸²æ²¡æœ‰å˜çŸ­ï¼Œåˆ™è¿”å›åŸå…ˆçš„å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥å‡è®¾å­—ç¬¦ä¸²ä¸­åªåŒ…å«å¤§å°å†™è‹±æ–‡å­—æ¯ï¼ˆaè‡³zï¼‰ã€‚\n\ncaseå°±ä¸ç²˜äº†\n\n**è§£æ³•ä¸€**\n\nç›´æ¥å†™å°±è¡Œäº†\n\n```java\npublic String compressString(String S) {\n    StringBuilder sb=new StringBuilder();\n    int index=0;\n    while(index<S.length()){\n        sb.append(S.charAt(index));\n        int r=1;\n        while(index<S.length()-1&&S.charAt(index)==S.charAt(index+1)){\n            ++index;\n            r++;\n        }\n        sb.append(r);\n        index++;\n    }\n    return sb.length()<S.length()?sb.toString():S;\n}\n```\n## [238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯](https://leetcode-cn.com/problems/product-of-array-except-self/)\n\nç»™å®šé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ numsï¼Œå…¶ä¸­ n > 1ï¼Œè¿”å›è¾“å‡ºæ•°ç»„ output ï¼Œå…¶ä¸­ output[i] ç­‰äº nums ä¸­é™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: [1,2,3,4]\nè¾“å‡º: [24,12,8,6]\nè¯´æ˜: è¯·ä¸è¦ä½¿ç”¨é™¤æ³•ï¼Œä¸”åœ¨ O(n) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ­¤é¢˜ã€‚\n```\n\n**è¿›é˜¶ï¼š**\nä½ å¯ä»¥åœ¨å¸¸æ•°ç©ºé—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸ªé¢˜ç›®å—ï¼Ÿï¼ˆ å‡ºäºå¯¹ç©ºé—´å¤æ‚åº¦åˆ†æçš„ç›®çš„ï¼Œè¾“å‡ºæ•°ç»„ä¸è¢«è§†ä¸ºé¢å¤–ç©ºé—´ã€‚ï¼‰\n\n**è§£æ³•ä¸€**\n\nè¿˜è¡Œï¼Œç‹¬ç«‹çš„æƒ³åˆ°äº†è§£æ³•ï¼Œæ²¡å•¥å¥½è¯´çš„\n\n```java\npublic int[] productExceptSelf(int[] nums) {\n    if (nums==null || nums.length<=0) {\n        return new int[0];\n    }\n    int[] left=new int[nums.length+1]; \n    left[0]=1;//left[i]: [0 ~ i-1]çš„ç´¯ç§¯\n    int[] right=new int[nums.length+1];\n    right[nums.length]=1; //right[i]: [i ~ nums.length-1]çš„ç´¯ç§¯\n    for (int i=1;i<=nums.length;i++) {\n        left[i]=left[i-1]*nums[i-1];\n    }\n    for (int i=nums.length-1;i>=0;i--) {\n        right[i]=right[i+1]*nums[i];\n    }\n    int[] res=new int[nums.length];\n    //1 2 3\n    res[0]=right[1];\n    for (int i=1;i<nums.length;i++) {\n        res[i]=left[i]*right[i+1];\n    }\n    return res;\n}\n```\n\n**è§£æ³•äºŒ**\n\nO(1)è¿›é˜¶ç‰ˆæœ‰æ—¶é—´å†æ¥è¡¥\n\n## [5341. æœ€å K ä¸ªæ•°çš„ä¹˜ç§¯](https://leetcode-cn.com/problems/product-of-the-last-k-numbers/)\n\nè¯·ä½ å®ç°ä¸€ä¸ªã€Œæ•°å­—ä¹˜ç§¯ç±»ã€`ProductOfNumbers`ï¼Œè¦æ±‚æ”¯æŒä¸‹è¿°ä¸¤ç§æ–¹æ³•ï¼š\n\n1. add(int num)\n\n- å°†æ•°å­— num æ·»åŠ åˆ°å½“å‰æ•°å­—åˆ—è¡¨çš„æœ€åé¢ã€‚\n\n2. getProduct(int k)\n\n- è¿”å›å½“å‰æ•°å­—åˆ—è¡¨ä¸­ï¼Œæœ€å k ä¸ªæ•°å­—çš„ä¹˜ç§¯ã€‚\n- ä½ å¯ä»¥å‡è®¾å½“å‰åˆ—è¡¨ä¸­å§‹ç»ˆ è‡³å°‘ åŒ…å« k ä¸ªæ•°å­—ã€‚\n- é¢˜ç›®æ•°æ®ä¿è¯ï¼šä»»ä½•æ—¶å€™ï¼Œä»»ä¸€è¿ç»­æ•°å­—åºåˆ—çš„ä¹˜ç§¯éƒ½åœ¨ 32-bit æ•´æ•°èŒƒå›´å†…ï¼Œä¸ä¼šæº¢å‡ºã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š\n[\"ProductOfNumbers\",\"add\",\"add\",\"add\",\"add\",\"add\",\"getProduct\",\"getProduct\",\"getProduct\",\"add\",\"getProduct\"]\n[[],[3],[0],[2],[5],[4],[2],[3],[4],[8],[2]]\n\nè¾“å‡ºï¼š\n[null,null,null,null,null,null,20,40,0,null,32]\n\nè§£é‡Šï¼š\nProductOfNumbers productOfNumbers = new ProductOfNumbers();\nproductOfNumbers.add(3);        // [3]\nproductOfNumbers.add(0);        // [3,0]\nproductOfNumbers.add(2);        // [3,0,2]\nproductOfNumbers.add(5);        // [3,0,2,5]\nproductOfNumbers.add(4);        // [3,0,2,5,4]\nproductOfNumbers.getProduct(2); // è¿”å› 20 ã€‚æœ€å 2 ä¸ªæ•°å­—çš„ä¹˜ç§¯æ˜¯ 5 * 4 = 20\nproductOfNumbers.getProduct(3); // è¿”å› 40 ã€‚æœ€å 3 ä¸ªæ•°å­—çš„ä¹˜ç§¯æ˜¯ 2 * 5 * 4 = 40\nproductOfNumbers.getProduct(4); // è¿”å›  0 ã€‚æœ€å 4 ä¸ªæ•°å­—çš„ä¹˜ç§¯æ˜¯ 0 * 2 * 5 * 4 = 0\nproductOfNumbers.add(8);        // [3,0,2,5,4,8]\nproductOfNumbers.getProduct(2); // è¿”å› 32 ã€‚æœ€å 2 ä¸ªæ•°å­—çš„ä¹˜ç§¯æ˜¯ 4 * 8 = 32 \n```\n\n**æç¤ºï¼š**\n\n```java\nadd å’Œ getProduct ä¸¤ç§æ“ä½œåŠ èµ·æ¥æ€»å…±ä¸ä¼šè¶…è¿‡ 40000 æ¬¡ã€‚\n0 <= num <= 100\n1 <= k <= 40000\n```\n\n**è§£æ³•ä¸€**\n\n176å‘¨èµ›çš„ç¬¬äºŒé¢˜ï¼Œæ€è·¯å€’æ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œç»´æŠ¤ä¸€ä¸ªå‰ç¼€ç§¯ï¼Œç„¶åç”¨å…¨ç§¯é™¤ä»¥å¯¹åº”kä½ç½®çš„å°±è¡Œäº†ï¼Œä½†æ˜¯ç»†èŠ‚çš„å¤„ç†å‡ºäº†å¤§é—®é¢˜haha~\n\n```java\nLinkedList<Integer> product=null;\n\npublic ProductOfNumbers() {\n    product=new LinkedList<>();\n    product.add(1);\n}\n\npublic void add(int num) {\n    if(num==0){ //é‡æ–°æ„å»º\n        product=new LinkedList<>();\n        product.add(1);\n    }else{\n        product.add(num*product.getLast());\n    }\n}\n\n//1| 1 0 2 3  k=3\npublic int getProduct(int k) {\n    if(k>=product.size()){\n        return 0;\n    }\n    return product.getLast()/product.get(product.size()-k-1);\n}\n```\nä¸€å¼€å§‹ç»´æŠ¤äº†æ‰€æœ‰çš„å‰ç¼€ç§¯ï¼Œç»“æœåé¢çš„caseè¿‡ä¸äº†ï¼Œå‡ºç°äº†é™¤0å¼‚å¸¸ï¼Œå¾ˆæ˜¾ç„¶æŠŠ0æ¢æˆ1ï¼Œåé¢çš„caseå¤§äº†ä¹‹åç´¯ä¹˜çš„ç»“æœå¤ªå¤§äº†ï¼Œæº¢å‡ºä¸º0äº†ã€‚\n\nä¸Šé¢ä»£ç çš„å¤„ç†æ–¹å¼æ˜¯å‚è€ƒäº†å¤§ä½¬çš„è§£æ³•ï¼Œé‡åˆ°0çš„æ—¶å€™å°±ç›´æ¥é‡ç½®é˜Ÿåˆ—ï¼Œæœ€åå¦‚æœkå¤§äºé˜Ÿåˆ—é•¿åº¦è¯´æ˜è¿™ä¸ªåºåˆ—è‚¯å®šæ˜¯åŒ…å«äº†0ï¼Œç›´æ¥è¿”å›0å°±å¯ä»¥äº†\n\n## [é¢è¯•é¢˜64. æ±‚1+2+â€¦+n](https://leetcode-cn.com/problems/qiu-12n-lcof/)\n\næ±‚ `1+2+...+n` ï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨ä¹˜é™¤æ³•ã€forã€whileã€ifã€elseã€switchã€caseç­‰å…³é”®å­—åŠæ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆA?B:Cï¼‰ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: n = 3\nè¾“å‡º: 6\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: n = 9\nè¾“å‡º: 45\n```\n\n**é™åˆ¶ï¼š**\n\n- 1 <= n <= 10000\n\n**è§£æ³•ä¸€**\n\næˆ‘ä¸€å¼€å§‹æƒ³çš„æ˜¯æŠŠ `n*(n-1)/2`  å±•å¼€ï¼Œå˜æˆå¹³æ–¹ï¼Œç”¨powä»£æ›¿ï¼Œé™¤2ç”¨ç§»ä½ä»£æ›¿ï¼Œä½†æ˜¯æƒ³äº†æƒ³æ„Ÿè§‰powåº•å±‚åº”è¯¥ä¹Ÿæ˜¯ç”¨äº†ä¹˜\n\næ‰€ä»¥è¿˜æ˜¯å¾—ç”¨é€’å½’ï¼Œä½†æ˜¯é€’å½’å¿…é¡»æœ‰å‡ºå£ï¼Œè¿™é‡Œçš„å…³é”®å°±æ˜¯æ€ä¹ˆåœæ­¢\n\n```java\npublic int sumNums(int n) {\n    int sum = n;\n    //é€»è¾‘ä¸çŸ­è·¯\n    boolean ans = (n > 0) && ((sum += sumNums(n - 1)) > 0);\n    return sum;\n}\n```\n\n## [470. ç”¨ Rand7() å®ç° Rand10()](https://leetcode-cn.com/problems/implement-rand10-using-rand7/)\n\nå·²æœ‰æ–¹æ³• rand7 å¯ç”Ÿæˆ 1 åˆ° 7 èŒƒå›´å†…çš„å‡åŒ€éšæœºæ•´æ•°ï¼Œè¯•å†™ä¸€ä¸ªæ–¹æ³• rand10 ç”Ÿæˆ 1 åˆ° 10 èŒƒå›´å†…çš„å‡åŒ€éšæœºæ•´æ•°ã€‚\n\nä¸è¦ä½¿ç”¨ç³»ç»Ÿçš„ Math.random() æ–¹æ³•ã€‚\n\n**è§£æ³•ä¸€**\n\næ‹’ç»é‡‡æ ·ï¼Œä¸¤æ¬¡Rand7()æ‹’ç»å¤§äº40çš„æƒ…å†µ\n\n```java\npublic int rand10() {\n    int a,b,idx;\n    do{\n        a=rand7();\n        b=rand7();\n        idx=a+(b-1)*7;\n    }while(idx>40);\n    return 1+(idx-1)%10;\n}\n```\n\næ¦‚ç‡è®ºé‡Œé¢å­¦è¿‡çš„ï¼Œéƒ½å¿˜äº†\n\n![38nhYn.png](https://s2.ax1x.com/2020/02/24/38nhYn.png)\n\næœŸæœ›å…¶å®è¿˜å¯ä»¥æ›´ä½ï¼Œè¿™é‡Œåé¢æœ‰æ—¶é—´å†æ¥ç ”ç©¶\n\n## [384. æ‰“ä¹±æ•°ç»„](https://leetcode-cn.com/problems/shuffle-an-array/)\n\næ‰“ä¹±ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„æ•°ç»„ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\n// ä»¥æ•°å­—é›†åˆ 1, 2 å’Œ 3 åˆå§‹åŒ–æ•°ç»„ã€‚\nint[] nums = {1,2,3};\nSolution solution = new Solution(nums);\n\n// æ‰“ä¹±æ•°ç»„ [1,2,3] å¹¶è¿”å›ç»“æœã€‚ä»»ä½• [1,2,3]çš„æ’åˆ—è¿”å›çš„æ¦‚ç‡åº”è¯¥ç›¸åŒã€‚\nsolution.shuffle();\n\n// é‡è®¾æ•°ç»„åˆ°å®ƒçš„åˆå§‹çŠ¶æ€[1,2,3]ã€‚\nsolution.reset();\n\n// éšæœºè¿”å›æ•°ç»„[1,2,3]æ‰“ä¹±åçš„ç»“æœã€‚\nsolution.shuffle();\n```\n\n**è§£æ³•ä¸€**\n\næ´—ç‰Œç®—æ³•ï¼Œç¡®ä¿è‡³å°‘ä¼šå‡ºç°`N!`ç§æƒ…å†µï¼Œä¸”æ¯ç§æƒ…å†µå‡ºç°çš„æ¦‚ç‡æ˜¯ç›¸åŒçš„\n\n```java\nint[] origin=null;\n\nint[] nums=null;\n\nRandom random=new Random();\n\npublic Solution(int[] nums) {\n    this.nums=nums;\n    origin=nums.clone();\n}\n\n/** Resets the array to its original configuration and return it. */\npublic int[] reset() {\n    return origin;\n}\n\n/** Returns a random shuffling of the array. */\npublic int[] shuffle() {\n    for (int i=nums.length-1;i>=0;i--) {\n        //ä»å°¾éƒ¨å¼€å§‹è¿™æ ·å¯¹äºJavaä¼šç®€å•ä¸€ç‚¹ç‚¹\n        int rand=(int)(random.nextInt(i+1)); //éšæœºã€0,iã€‘çš„å…ƒç´ \n        swap(nums,i,rand);\n    }\n    return nums;\n}\n\npublic void swap(int[] nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\n## [é¢è¯•é¢˜61. æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­](https://leetcode-cn.com/problems/bu-ke-pai-zhong-de-shun-zi-lcof/)\n\nä»æ‰‘å…‹ç‰Œä¸­éšæœºæŠ½5å¼ ç‰Œï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªé¡ºå­ï¼Œå³è¿™5å¼ ç‰Œæ˜¯ä¸æ˜¯è¿ç»­çš„ã€‚2ï½10ä¸ºæ•°å­—æœ¬èº«ï¼ŒAä¸º1ï¼ŒJä¸º11ï¼ŒQä¸º12ï¼ŒKä¸º13ï¼Œè€Œå¤§ã€å°ç‹ä¸º 0 ï¼Œå¯ä»¥çœ‹æˆä»»æ„æ•°å­—ã€‚A ä¸èƒ½è§†ä¸º 14ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [1,2,3,4,5]\nè¾“å‡º: True\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: [0,0,1,2,5]\nè¾“å‡º: True\n```\n\n**é™åˆ¶ï¼š**\n\næ•°ç»„é•¿åº¦ä¸º 5 \n\næ•°ç»„çš„æ•°å–å€¼ä¸º [0, 13] .\n\n**è§£æ³•ä¸€**\n\nåªæœ‰5å¼ ç‰Œï¼Œå…ˆæ’é™¤å¯¹å­ï¼Œç„¶åæ±‚æœ€å¤§å’Œæœ€å°çš„ç‰Œé¢ä¹‹å·®å°±è¡Œäº†ï¼Œå°äºç­‰äº4å°±è‚¯å®šæ˜¯é¡ºå­\n\n```java\npublic boolean isStraight(int[] nums) {\n    int[] bucket=new int[14];\n    for(int i=0;i<5;i++){\n        bucket[nums[i]]++;\n        //æœ‰é0çš„å¯¹å­,ç›´æ¥false\n        if(nums[i]!=0 && bucket[nums[i]] >1 ){\n            return false;\n        }\n    }\n    //è®°å½•èµ·æ‰‹ç‰Œå’Œæœ€å¤§ç‰Œ\n    int start=-1,end=-1;\n    for(int i=1,j=13;end==-1||start==-1;i++,j--){\n        if(bucket[i]==1 && start==-1) start=i;\n        if(bucket[j]==1 && end==-1) end=j;\n    }\n    //å°äºç­‰äº4å°±è¡Œ,å¤šçš„ç”¨0è¡¥\n    return end-start<=4;\n}\n```\nä»£ç å¯ä»¥ä¼˜åŒ–æˆä¸€ä¸ªå¾ªç¯å†…\n\n```java\n//ç¼©å‡æˆä¸€ä¸ªå¾ªç¯\npublic boolean isStraight(int[] nums) {\n    int[] bucket=new int[14];\n    int min=14,max=-1;\n    for(int i=0;i<nums.length;i++){\n        if(nums[i]==0) continue;\n        if(bucket[nums[i]]==1) return false;\n        bucket[nums[i]]++;\n        min=Math.min(min,nums[i]);\n        max=Math.max(max,nums[i]);\n    }\n    return max-min<=4;\n}\n```\n## [1103. åˆ†ç³–æœ II](https://leetcode-cn.com/problems/distribute-candies-to-people/)\n\næ’æ’åï¼Œåˆ†ç³–æœã€‚\n\næˆ‘ä»¬ä¹°äº†ä¸€äº›ç³–æœ candiesï¼Œæ‰“ç®—æŠŠå®ƒä»¬åˆ†ç»™æ’å¥½é˜Ÿçš„ n = num_people ä¸ªå°æœ‹å‹ã€‚\n\nç»™ç¬¬ä¸€ä¸ªå°æœ‹å‹ 1 é¢—ç³–æœï¼Œç¬¬äºŒä¸ªå°æœ‹å‹ 2 é¢—ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç»™æœ€åä¸€ä¸ªå°æœ‹å‹ n é¢—ç³–æœã€‚\n\nç„¶åï¼Œæˆ‘ä»¬å†å›åˆ°é˜Ÿä¼çš„èµ·ç‚¹ï¼Œç»™ç¬¬ä¸€ä¸ªå°æœ‹å‹ n + 1 é¢—ç³–æœï¼Œç¬¬äºŒä¸ªå°æœ‹å‹ n + 2 é¢—ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç»™æœ€åä¸€ä¸ªå°æœ‹å‹ 2 * n é¢—ç³–æœã€‚\n\né‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼ˆæ¯æ¬¡éƒ½æ¯”ä¸Šä¸€æ¬¡å¤šç»™å‡ºä¸€é¢—ç³–æœï¼Œå½“åˆ°è¾¾é˜Ÿä¼ç»ˆç‚¹åå†æ¬¡ä»é˜Ÿä¼èµ·ç‚¹å¼€å§‹ï¼‰ï¼Œç›´åˆ°æˆ‘ä»¬åˆ†å®Œæ‰€æœ‰çš„ç³–æœã€‚æ³¨æ„ï¼Œå°±ç®—æˆ‘ä»¬æ‰‹ä¸­çš„å‰©ä¸‹ç³–æœæ•°ä¸å¤Ÿï¼ˆä¸æ¯”å‰ä¸€æ¬¡å‘å‡ºçš„ç³–æœå¤šï¼‰ï¼Œè¿™äº›ç³–æœä¹Ÿä¼šå…¨éƒ¨å‘ç»™å½“å‰çš„å°æœ‹å‹ã€‚\n\nè¿”å›ä¸€ä¸ªé•¿åº¦ä¸º num_peopleã€å…ƒç´ ä¹‹å’Œä¸º candies çš„æ•°ç»„ï¼Œä»¥è¡¨ç¤ºç³–æœçš„æœ€ç»ˆåˆ†å‘æƒ…å†µï¼ˆå³ ans[i] è¡¨ç¤ºç¬¬ i ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœæ•°ï¼‰ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šcandies = 7, num_people = 4\nè¾“å‡ºï¼š[1,2,3,1]\nè§£é‡Šï¼š\nç¬¬ä¸€æ¬¡ï¼Œans[0] += 1ï¼Œæ•°ç»„å˜ä¸º [1,0,0,0]ã€‚\nç¬¬äºŒæ¬¡ï¼Œans[1] += 2ï¼Œæ•°ç»„å˜ä¸º [1,2,0,0]ã€‚\nç¬¬ä¸‰æ¬¡ï¼Œans[2] += 3ï¼Œæ•°ç»„å˜ä¸º [1,2,3,0]ã€‚\nç¬¬å››æ¬¡ï¼Œans[3] += 1ï¼ˆå› ä¸ºæ­¤æ—¶åªå‰©ä¸‹ 1 é¢—ç³–æœï¼‰ï¼Œæœ€ç»ˆæ•°ç»„å˜ä¸º [1,2,3,1]ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šcandies = 10, num_people = 3\nè¾“å‡ºï¼š[5,2,3]\nè§£é‡Šï¼š\nç¬¬ä¸€æ¬¡ï¼Œans[0] += 1ï¼Œæ•°ç»„å˜ä¸º [1,0,0]ã€‚\nç¬¬äºŒæ¬¡ï¼Œans[1] += 2ï¼Œæ•°ç»„å˜ä¸º [1,2,0]ã€‚\nç¬¬ä¸‰æ¬¡ï¼Œans[2] += 3ï¼Œæ•°ç»„å˜ä¸º [1,2,3]ã€‚\nç¬¬å››æ¬¡ï¼Œans[0] += 4ï¼Œæœ€ç»ˆæ•°ç»„å˜ä¸º [5,2,3]ã€‚\n```\n\n**æç¤ºï¼š**\n\n- `1 <= candies <= 10^9`\n- `1 <= num_people <= 1000`\n\n**è§£æ³•ä¸€**\n\n```java\n//æš´åŠ›æ¨¡æ‹Ÿ\npublic int[] distributeCandies(int candies, int num_people) {\n    int[] res=new int[num_people];\n    int index=0;\n    for (int i=1;candies>0;i++) {\n        res[index%num_people]+=Math.min(candies,i);\n        candies-=i;\n        index++;\n    }\n    return res;\n}\n```\næ•°å­¦çš„æ–¹æ³•ï¼šæ¯ä¸ªäººå¾—åˆ°çš„ç³–æœåˆ†æ‰¹æ¬¡çš„éƒ½æ˜¯ä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œå¯ä»¥é€šè¿‡æ±‚å’Œå…¬å¼ç›´æ¥ç®—ï¼Œè¿‡ç¨‹æœ‰ç‚¹ç¹çï¼Œåé¢æœ‰æ—¶é—´å†æ¥ç ”ç©¶\n\n## [1013. å°†æ•°ç»„åˆ†æˆå’Œç›¸ç­‰çš„ä¸‰ä¸ªéƒ¨åˆ†](https://leetcode-cn.com/problems/partition-array-into-three-parts-with-equal-sum/) \n\n  ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ Aï¼Œåªæœ‰å¯ä»¥å°†å…¶åˆ’åˆ†ä¸ºä¸‰ä¸ªå’Œç›¸ç­‰çš„éç©ºéƒ¨åˆ†æ—¶æ‰è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚\n\nå½¢å¼ä¸Šï¼Œå¦‚æœå¯ä»¥æ‰¾å‡ºç´¢å¼• i+1 < j ä¸”æ»¡è¶³ (A[0] + A[1] + ... + A[i] == A[i+1] + A[i+2] + ... + A[j-1] == A[j] + A[j-1] + ... + A[A.length - 1]) å°±å¯ä»¥å°†æ•°ç»„ä¸‰ç­‰åˆ†ã€‚\n\n **ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å‡ºï¼š[0,2,1,-6,6,-7,9,1,2,0,1]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼š0 + 2 + 1 = -6 + 6 - 7 + 9 + 1 = 2 + 0 + 1\n```\n\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[0,2,1,-6,6,7,9,-1,2,0,1]\nè¾“å‡ºï¼šfalse\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[3,3,6,5,-2,2,5,1,-9,4]\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼š3 + 3 = 6 = 5 - 2 + 2 + 5 + 1 - 9 + 4\n```\n\n**æç¤ºï¼š**\n\n1. 3 <= A.length <= 50000\n2. -10^4 <= A[i] <= 10^4\n\n**è§£æ³•ä¸€**\n\nè¿™ä¸ªè§£æ³•ç®—æ˜¯è¢«ç¾¤å‹è¯¯å¯¼äº†çš„ï¼Œç¾¤é‡Œé¢æœ‰äººè¯´è¿™é¢˜æ˜¯å‰ç¼€å’Œï¼Œç„¶åæˆ‘å°±å¾€å“ªä¸ªä¸Šé¢æƒ³çš„ï¼Œå…¶å®æ²¡å¿…è¦\n\n```java\npublic boolean canThreePartsEqualSum(int[] A) {\n    int[] preSum=new int[A.length+1];\n    preSum[0]=0;\n    for(int i=1;i<=A.length;i++){\n        preSum[i]=preSum[i-1]+A[i-1];\n    }\n    for(int i=1;i<preSum.length-2;i++){ //ä¿è¯å‰©ä¸‹2ä¸ª\n        if(preSum[A.length]-preSum[i]==preSum[i]*2){\n            for(int j=i+1;j<preSum.length-1;j++){ //ä¿è¯å‰©ä¸‹1ä¸ª\n                if(preSum[A.length]-preSum[i]==(preSum[j]-preSum[i])*2){\n                    //System.out.println(i+\" \"+j);\n                    return true;\n                }\n            }\n            return false;\n        }\n    }\n    return false;\n}\n```\n**è§£æ³•äºŒ**\n\nè¿™æ‰æ˜¯æ­£å¸¸çš„æ€è·¯\n\n```java\npublic boolean canThreePartsEqualSum(int[] A) {\n    int sum=0;\n    for(int i=0;i<A.length;i++) sum+=A[i];\n    if(sum%3!=0) return false;\n    int count=0,tempSum=0;\n    //iåˆ°è¾¾A.length-1ä¿è¯æœ‰ç¬¬3æ®µ,å¦åˆ™æœ‰å¯èƒ½target=0 åªåˆ†ä¸ºä¸¤æ®µå°±æ²¡äº†\n    for(int i=0;i<A.length-1;i++){ \n        tempSum+=A[i];\n        if(tempSum==sum/3){\n            ++count;\n            if(count==2) return true;\n            tempSum=0;\n        }\n    }\n    return false;\n}\n```\nè¿™é¢˜çš„WAç‚¹å°±æ˜¯ sum=0çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½æŒ‰ç…§åˆ’åˆ†çš„é€»è¾‘åªå°†æ•°ç»„åˆ’åˆ†ä¸ºä¸¤æ®µï¼Œæ‰€ä»¥è¦æ³¨æ„è¾¹ç•Œ\n\n## [è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢ï¼ˆç‰›å®¢ï¼‰](https://www.nowcoder.com/practice/beb5aa231adc45b2a5dcc5b62c93f593?tpId=13&&tqId=11166&rp=2&ru=/activity/oj&qru=/ta/coding-interviews/question-ranking)\n\nè¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå®ç°ä¸€ä¸ªå‡½æ•°æ¥è°ƒæ•´è¯¥æ•°ç»„ä¸­æ•°å­—çš„é¡ºåºï¼Œä½¿å¾—æ‰€æœ‰çš„å¥‡æ•°ä½äºæ•°ç»„çš„å‰åŠéƒ¨åˆ†ï¼Œæ‰€æœ‰çš„å¶æ•°ä½äºæ•°ç»„çš„ååŠéƒ¨åˆ†ï¼Œå¹¶ä¿è¯å¥‡æ•°å’Œå¥‡æ•°ï¼Œå¶æ•°å’Œå¶æ•°ä¹‹é—´çš„ç›¸å¯¹ä½ç½®ä¸å˜ã€‚\n\n**è§£æ³•ä¸€**\n\nå…¶å®å°±æ˜¯ç¨³å®šçš„æ’åºï¼Œæ’å…¥ï¼Œå†’æ³¡ï¼Œå½’å¹¶éƒ½å¯ä»¥\n\n```java\npublic void reOrderArray(int [] array) {\n    for(int i=0;i<array.length;i++){\n        for(int j=i;j>=1;j--){\n            if(array[j]%2==1 && array[j-1]%2==0){\n                swap(array,j,j-1);\n            }\n        }\n    }\n}\n\npublic void swap(int[] array,int a,int b){\n    int temp=array[a];\n    array[a]=array[b];\n    array[b]=temp;\n}\n```\n## [836. çŸ©å½¢é‡å ](https://leetcode-cn.com/problems/rectangle-overlap/)\n\nçŸ©å½¢ä»¥åˆ—è¡¨ `[x1, y1, x2, y2]` çš„å½¢å¼è¡¨ç¤ºï¼Œå…¶ä¸­ `(x1, y1)` ä¸ºå·¦ä¸‹è§’çš„åæ ‡ï¼Œ`(x2, y2)` æ˜¯å³ä¸Šè§’çš„åæ ‡ã€‚\n\nå¦‚æœç›¸äº¤çš„é¢ç§¯ä¸ºæ­£ï¼Œåˆ™ç§°ä¸¤çŸ©å½¢é‡å ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œåªåœ¨è§’æˆ–è¾¹æ¥è§¦çš„ä¸¤ä¸ªçŸ©å½¢ä¸æ„æˆé‡å ã€‚\n\nç»™å‡ºä¸¤ä¸ªçŸ©å½¢ï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦é‡å å¹¶è¿”å›ç»“æœã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šrec1 = [0,0,2,2], rec2 = [1,1,3,3]\nè¾“å‡ºï¼štrue\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼šrec1 = [0,0,1,1], rec2 = [1,0,2,1]\nè¾“å‡ºï¼šfalse\n```\n\n**æç¤ºï¼š**\n\n1. ä¸¤ä¸ªçŸ©å½¢ `rec1` å’Œ `rec2` éƒ½ä»¥å«æœ‰å››ä¸ªæ•´æ•°çš„åˆ—è¡¨çš„å½¢å¼ç»™å‡ºã€‚\n2. çŸ©å½¢ä¸­çš„æ‰€æœ‰åæ ‡éƒ½å¤„äº `-10^9` å’Œ `10^9` ä¹‹é—´ã€‚\n3. `x` è½´é»˜è®¤æŒ‡å‘å³ï¼Œ`y` è½´é»˜è®¤æŒ‡å‘ä¸Šã€‚\n4. ä½ å¯ä»¥ä»…è€ƒè™‘çŸ©å½¢æ˜¯æ­£æ”¾çš„æƒ…å†µã€‚\n\n**è§£æ³•ä¸€**\n\næ†¨æ†¨è§£æ³•ï¼Œæœ€åè¿˜è¢«ä¸€ä¸ªå¤§caseè¶Šç•Œç»™å¡äº†\n\n```java\npublic boolean isRectangleOverlap(int[] rec1, int[] rec2) {\n    int x=Math.max(rec2[2]-rec1[0],rec1[2]-rec2[0]);\n    int y=Math.max(rec2[3]-rec1[1],rec1[3]-rec2[1]);\n    long maxX=((long)rec1[2]-(long)rec1[0]+(long)rec2[2]-(long)rec2[0]);\n    long maxY=((long)rec1[3]-(long)rec1[1]+(long)rec2[3]-(long)rec2[1]);\n    return x<maxX && y <maxY;\n}\n```\n**è§£æ³•äºŒ**\n\n```java\npublic boolean isRectangleOverlap(int[] rec1, int[] rec2) {\n    return !(rec1[3]<=rec2[1]||rec2[3]<=rec1[1]||rec1[2]<=rec2[0]||rec2[2]<=rec1[0]);\n}\n```\n## [892. ä¸‰ç»´å½¢ä½“çš„è¡¨é¢ç§¯](https://leetcode-cn.com/problems/surface-area-of-3d-shapes/)\n\nåœ¨ N * N çš„ç½‘æ ¼ä¸Šï¼Œæˆ‘ä»¬æ”¾ç½®ä¸€äº› 1 * 1 * 1  çš„ç«‹æ–¹ä½“ã€‚\n\næ¯ä¸ªå€¼ v = grid[i][j] è¡¨ç¤º v ä¸ªæ­£æ–¹ä½“å æ”¾åœ¨å¯¹åº”å•å…ƒæ ¼ (i, j) ä¸Šã€‚\n\nè¯·ä½ è¿”å›æœ€ç»ˆå½¢ä½“çš„è¡¨é¢ç§¯ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[[2]]\nè¾“å‡ºï¼š10\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[[1,2],[3,4]]\nè¾“å‡ºï¼š34\n```\n\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[[1,0],[0,2]]\nè¾“å‡ºï¼š16\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```java\nè¾“å…¥ï¼š[[1,1,1],[1,0,1],[1,1,1]]\nè¾“å‡ºï¼š32\n```\n\n\n**ç¤ºä¾‹ 5ï¼š**\n\n```java\nè¾“å…¥ï¼š[[2,2,2],[2,1,2],[2,2,2]]\nè¾“å‡ºï¼š46\n```\n\n**æç¤ºï¼š**\n\n- `1 <= N <= 50`\n- `0 <= grid[i][j] <= 50` \n\n**è§£æ³•ä¸€**\n\nåšåŠ æ³•\n\n```java\n//åŠ æ³•æ€è·¯\npublic int surfaceArea(int[][] grid) {\n    if(grid==null || grid.length<=0 ) return 0;\n    int N=grid.length;\n    int res=0;\n    for (int i=0;i<N;i++) {\n        for (int j=0;j<N;j++) {\n            //æ­£é¢,èƒŒé¢æš´éœ²çš„é¢ç§¯\n            res+= Math.max(j<N-1?grid[i][j+1]-grid[i][j]:grid[i][j],0);\n            res+= Math.max(j>0?grid[i][j-1]-grid[i][j]:grid[i][j],0);\n            //å·¦å’Œå³è¾¹æš´éœ²çš„é¢ç§¯\n            res+= Math.max(i<N-1?grid[i+1][j]-grid[i][j]:grid[i][j],0);\n            res+= Math.max(i>0?grid[i-1][j]-grid[i][j]:grid[i][j],0);\n            //ä¸Šå’Œä¸‹çš„é¢ç§¯\n            res+= grid[i][j]!=0?2:0;\n        }\n    }\n    return res;\n}\n```\næˆ‘å¤ªè ¢äº†ï¼Œå¼€å§‹ç›´æ¥åˆ†åˆ«ç®—6ä¸ªé¢ï¼Œç„¶åå‘ç°æœ‰å‘ï¼Œåˆå»ç®—å‘çš„é¢ç§¯ã€‚ã€‚ã€‚ç»“æœå°±é™·è¿›å»äº†\n\n**è§£æ³•äºŒ**\n\nå·§å¦™çš„å‡æ³•æ€è·¯ï¼Œç®—è´´åˆçš„æ—¶å€™çš„é‡åˆçš„é¢ç§¯\n\n```java\n//å·§å¦™çš„å‡æ³•æ€è·¯\npublic int surfaceArea(int[][] grid) {\n    if(grid==null || grid.length<=0 ) return 0;\n    int N=grid.length;\n    int x=0,y=0,count=0;\n    for (int i=0;i<N;i++) {\n        for (int j=0;j<N;j++) {\n            if(grid[i][j]!=0){\n                x+=grid[i][j]-1;\n                count+=grid[i][j];\n            }\n            if(i>=1 && grid[i-1][j]!=0){\n                y+=Math.min(grid[i][j],grid[i-1][j]);\n            }\n            if(j>=1 && grid[i][j-1]!=0){\n                y+=Math.min(grid[i][j],grid[i][j-1]);\n            }\n        }\n    }\n    return count*6-2*x-2*y;\n}\n```\n## [463. å²›å±¿çš„å‘¨é•¿](https://leetcode-cn.com/problems/island-perimeter/)\n\nç»™å®šä¸€ä¸ªåŒ…å« 0 å’Œ 1 çš„äºŒç»´ç½‘æ ¼åœ°å›¾ï¼Œå…¶ä¸­ 1 è¡¨ç¤ºé™†åœ° 0 è¡¨ç¤ºæ°´åŸŸã€‚\n\nç½‘æ ¼ä¸­çš„æ ¼å­æ°´å¹³å’Œå‚ç›´æ–¹å‘ç›¸è¿ï¼ˆå¯¹è§’çº¿æ–¹å‘ä¸ç›¸è¿ï¼‰ã€‚æ•´ä¸ªç½‘æ ¼è¢«æ°´å®Œå…¨åŒ…å›´ï¼Œä½†å…¶ä¸­æ°å¥½æœ‰ä¸€ä¸ªå²›å±¿ï¼ˆæˆ–è€…è¯´ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ç¤ºé™†åœ°çš„æ ¼å­ç›¸è¿ç»„æˆçš„å²›å±¿ï¼‰ã€‚\n\nå²›å±¿ä¸­æ²¡æœ‰â€œæ¹–â€ï¼ˆâ€œæ¹–â€ æŒ‡æ°´åŸŸåœ¨å²›å±¿å†…éƒ¨ä¸”ä¸å’Œå²›å±¿å‘¨å›´çš„æ°´ç›¸è¿ï¼‰ã€‚æ ¼å­æ˜¯è¾¹é•¿ä¸º 1 çš„æ­£æ–¹å½¢ã€‚ç½‘æ ¼ä¸ºé•¿æ–¹å½¢ï¼Œä¸”å®½åº¦å’Œé«˜åº¦å‡ä¸è¶…è¿‡ 100 ã€‚è®¡ç®—è¿™ä¸ªå²›å±¿çš„å‘¨é•¿ã€‚\n\n**ç¤ºä¾‹ :**\n\n```java\nè¾“å…¥:\n[[0,1,0,0],\n [1,1,1,0],\n [0,1,0,0],\n [1,1,0,0]]\n\nè¾“å‡º: 16\n```\n\n**è§£æ³•ä¸€**\n\nå¶ç„¶ç¿»åˆ°çš„é¢˜ï¼Œå‘ç°å’Œä¸Šé¢çš„æ˜¯ä¸€æ ·çš„\n\n```java\n//å’Œ892ç±»ä¼¼çš„è§£æ³•ï¼Œç®€åŒ–ç‰ˆ\npublic int islandPerimeter(int[][] grid) {\n    int count=0;\n    int left=0,up=0;\n    for(int i=0;i<grid.length;i++){\n        for(int j=0;j<grid[0].length;j++){\n            if(grid[i][j]==1){\n                if(i-1>=0 && grid[i-1][j]==1){\n                    up++;\n                }\n                if(j-1>=0 && grid[i][j-1]==1){\n                    left++;\n                }\n                count++;\n            }\n        }\n    }\n    return count*4-(up+left)*2;\n}\n```\n> çœ‹åˆ°é¢˜è§£åŒºæœ‰å¤§ä½¬dfsçš„ï¼Œé€šè¿‡æ–¹æ ¼çš„å˜åŒ–ç»Ÿè®¡æœ‰æ•ˆçš„è¾¹ï¼Œæ¯”å¦‚ä»1->0å°±å¯ä»¥å¢åŠ ä¸€æ¡è¾¹ï¼Œè€Œä»1->è¾¹ç•Œåˆå¯ä»¥å¢åŠ ä¸€æ¡è¾¹ï¼Œè¿˜æ˜¯æŒºç§’çš„\n\n## [999. è½¦çš„å¯ç”¨æ•è·é‡](https://leetcode-cn.com/problems/available-captures-for-rook/)\n\né¢˜ç›®å¤ªé•¿ï¼Œä¸æƒ³å¤åˆ¶äº†ï¼Œæ¨¡æ‹Ÿé¢˜ï¼Œé¢˜ç›®æ„æ€ææ¸…æ¥šå°±è¡Œäº†\n\n```java\npublic int numRookCaptures(char[][] board) {\n    int[][] direction=new int[][]{{-1,0},{0,-1},{1,0},{0,1}};\n    int res=0;\n    for (int i=0;i<board.length;i++) {\n        for (int j=0;j<board[0].length;j++) {\n            if(board[i][j]=='R'){\n                for (int k=0;k<4;k++) {\n                    int nx=i+direction[k][0];\n                    int ny=j+direction[k][1];\n                    while(nx>=0 && nx<board.length && ny>=0 && ny<board[0].length){\n                        if(board[nx][ny]=='B'){\n                            break;\n                        }\n                        if(board[nx][ny]=='p'){\n                            res++;\n                            break;\n                        }\n                        nx+=direction[k][0];\n                        ny+=direction[k][1];\n                    }\n                }\n                return res;\n            }\n        }\n    }\n    return 0;\n}\n```\n## [289. ç”Ÿå‘½æ¸¸æˆ](https://leetcode-cn.com/problems/game-of-life/)\n\næ ¹æ® ç™¾åº¦ç™¾ç§‘ ï¼Œç”Ÿå‘½æ¸¸æˆï¼Œç®€ç§°ä¸ºç”Ÿå‘½ï¼Œæ˜¯è‹±å›½æ•°å­¦å®¶çº¦ç¿°Â·ä½•é¡¿Â·åº·å¨åœ¨ 1970 å¹´å‘æ˜çš„ç»†èƒè‡ªåŠ¨æœºã€‚\n\nç»™å®šä¸€ä¸ªåŒ…å« m Ã— n ä¸ªæ ¼å­çš„é¢æ¿ï¼Œæ¯ä¸€ä¸ªæ ¼å­éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç»†èƒã€‚æ¯ä¸ªç»†èƒéƒ½å…·æœ‰ä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼š1 å³ä¸ºæ´»ç»†èƒï¼ˆliveï¼‰ï¼Œæˆ– 0 å³ä¸ºæ­»ç»†èƒï¼ˆdeadï¼‰ã€‚æ¯ä¸ªç»†èƒä¸å…¶å…«ä¸ªç›¸é‚»ä½ç½®ï¼ˆæ°´å¹³ï¼Œå‚ç›´ï¼Œå¯¹è§’çº¿ï¼‰çš„ç»†èƒéƒ½éµå¾ªä»¥ä¸‹å››æ¡ç”Ÿå­˜å®šå¾‹ï¼š\n\n1. å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®çš„æ´»ç»†èƒæ•°å°‘äºä¸¤ä¸ªï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›\n\n2. å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒä»ç„¶å­˜æ´»ï¼›\n\n3. å¦‚æœæ´»ç»†èƒå‘¨å›´å…«ä¸ªä½ç½®æœ‰è¶…è¿‡ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ´»ç»†èƒæ­»äº¡ï¼›\n\n4. å¦‚æœæ­»ç»†èƒå‘¨å›´æ­£å¥½æœ‰ä¸‰ä¸ªæ´»ç»†èƒï¼Œåˆ™è¯¥ä½ç½®æ­»ç»†èƒå¤æ´»ï¼›\n\næ ¹æ®å½“å‰çŠ¶æ€ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—é¢æ¿ä¸Šæ‰€æœ‰ç»†èƒçš„ä¸‹ä¸€ä¸ªï¼ˆä¸€æ¬¡æ›´æ–°åçš„ï¼‰çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯é€šè¿‡å°†ä¸Šè¿°è§„åˆ™åŒæ—¶åº”ç”¨äºå½“å‰çŠ¶æ€ä¸‹çš„æ¯ä¸ªç»†èƒæ‰€å½¢æˆçš„ï¼Œå…¶ä¸­ç»†èƒçš„å‡ºç”Ÿå’Œæ­»äº¡æ˜¯åŒæ—¶å‘ç”Ÿçš„ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š \n[\n  [0,1,0],\n  [0,0,1],\n  [1,1,1],\n  [0,0,0]\n]\nè¾“å‡ºï¼š\n[\n  [0,0,0],\n  [1,0,1],\n  [0,1,1],\n  [0,1,0]\n]\n```\n\n**è¿›é˜¶ï¼š**\n\n- ä½ å¯ä»¥ä½¿ç”¨åŸåœ°ç®—æ³•è§£å†³æœ¬é¢˜å—ï¼Ÿè¯·æ³¨æ„ï¼Œé¢æ¿ä¸Šæ‰€æœ‰æ ¼å­éœ€è¦åŒæ—¶è¢«æ›´æ–°ï¼šä½ ä¸èƒ½å…ˆæ›´æ–°æŸäº›æ ¼å­ï¼Œç„¶åä½¿ç”¨å®ƒä»¬çš„æ›´æ–°åçš„å€¼å†æ›´æ–°å…¶ä»–æ ¼å­ã€‚\n- æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºé¢æ¿ã€‚åŸåˆ™ä¸Šï¼Œé¢æ¿æ˜¯æ— é™çš„ï¼Œä½†å½“æ´»ç»†èƒä¾µå äº†é¢æ¿è¾¹ç•Œæ—¶ä¼šé€ æˆé—®é¢˜ã€‚ä½ å°†å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\nbugfree\n\n```java\nint[][] dir={{1,0},{0,1},{-1,0},{0,-1},{1,1},{-1,-1},{-1,1},{1,-1}};\n\npublic void gameOfLife(int[][] board) {\n    if(board==null || board.length<=0) return;\n    int m=board.length,n=board[0].length;\n    boolean[][] change=new boolean[m][n];\n    for(int i=0;i<m;i++){\n        for(int j=0;j<n;j++){\n            if(board[i][j]==0 && aliveCell(board,i,j,change)==3){\n                board[i][j]=1;\n                change[i][j]=true;\n            }else if(board[i][j]==1){\n                int alive=aliveCell(board,i,j,change);\n                if(alive<2 || alive>3){\n                    board[i][j]=0;\n                    change[i][j]=true;\n                }\n            }\n        }\n    }\n}\n\npublic int aliveCell(int[][] board,int x,int y,boolean[][] change){\n    int alive=0;\n    for(int k=0;k<dir.length;k++){\n        int nx=x+dir[k][0];\n        int ny=y+dir[k][1];\n        if(valid(board,nx,ny)&&(board[nx][ny]==1 && !change[nx][ny] || (board[nx][ny]==0 && change[nx][ny]))){\n            alive++;\n        }\n    }\n    return alive;\n}\n\npublic boolean valid(final int[][] board,int x,int y){\n    return x>=0 && x<board.length && y>=0 && y<board[0].length;\n}\n```\næˆ‘ç†è§£çš„åŸåœ°å°±æ˜¯åœ¨åŸæ•°ç»„ä¸Šåšä¿®æ”¹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¯´ä¸èƒ½ç”¨é¢å¤–ç©ºé—´å§ã€‚ã€‚ã€‚ä½†æ˜¯çœ‹äº†è¯„è®ºåŒºå¤§ä½¬ä»¬éƒ½ä¸æ˜¯è¿™æ ·å†™çš„ï¼Œéƒ½æ˜¯ç”¨çš„ä½è¿ç®—ï¼Œç”¨intç©ºçš„ä½ä¿å­˜çŠ¶æ€ï¼Œæœ€åç§»ä½ï¼Œæ‡’å¾—å†™äº†ï¼Œæ„Ÿè§‰æ²¡å•¥æ„æ€ï¼Œæ°´é¢˜\n\n## [204. è®¡æ•°è´¨æ•°](https://leetcode-cn.com/problems/count-primes/)\n\nç»Ÿè®¡æ‰€æœ‰å°äºéè´Ÿæ•´æ•° *n* çš„è´¨æ•°çš„æ•°é‡ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥: 10\nè¾“å‡º: 4\nè§£é‡Š: å°äº 10 çš„è´¨æ•°ä¸€å…±æœ‰ 4 ä¸ª, å®ƒä»¬æ˜¯ 2, 3, 5, 7 ã€‚\n```\n\n**è§£æ³•ä¸€**\n\n[å„æ‹‰å¤šå¡ç­›æ³•](https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes) ç®€ç§°åŸƒå¼ç­›\n\n```java\npublic int countPrimes(int n) {\n    boolean[] prime=new boolean[n];\n    //ä¸ºäº†ä¸é‚£ä¹ˆåˆ«æ‰­\n    Arrays.fill(prime,true);\n    for(int i=2;i*i<n;i++){\n        if(prime[i]){\n            //ä»i*iå¼€å§‹,i*(i-1)å·²ç»è¢«å‰é¢çš„ç»Ÿè®¡äº†\n            for(int j=i*i;j<n;j+=i){\n                prime[j]=false;\n            }\n        }\n    }\n    int res=0;\n    for(int i=2;i<prime.length;i++){\n        if(prime[i]) res++;\n    }\n    return res;\n}\n```\n## [171. Excelè¡¨åˆ—åºå·](https://leetcode-cn.com/problems/excel-sheet-column-number/)\n\nç»™å®šä¸€ä¸ªExcelè¡¨æ ¼ä¸­çš„åˆ—åç§°ï¼Œè¿”å›å…¶ç›¸åº”çš„åˆ—åºå·ã€‚\n\nä¾‹å¦‚ï¼Œ\n\n    A -> 1\n    B -> 2\n    C -> 3\n    ...\n    Z -> 26\n    AA -> 27\n    AB -> 28 \n    ...\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \"A\"\nè¾“å‡º: 1\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \"AB\"\nè¾“å‡º: 28\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: \"ZY\"\nè¾“å‡º: 701\n```\n\n**è§£æ³•ä¸€**\n\næœ‹å‹ä½œä¸šå¸®é¢è¯•é—®äº†è¿™é“é¢˜ï¼Œå…¶å®å°±æ˜¯è¿›åˆ¶çš„è½¬æ¢ï¼Œå†™äº†ä¸ªå›è½¬çš„\n\n```java\n//26è¿›åˆ¶è½¬10è¿›åˆ¶\npublic int titleToNumber(String s) {\n    if(s==null || s.length()<=0) return 0;\n    int res=0,n=s.length();\n    int temp=1;\n    for (int i=n-1;i>=0;i--) {\n        res+=(s.charAt(i)-'A'+1)*temp;\n        temp*=26;\n    }\n    return res;\n}\n\n//10è¿›åˆ¶è½¬26è¿›åˆ¶\npublic String numberToTitle(int s) {\n    StringBuilder res=new StringBuilder();\n    while(s!=0){\n        //è¿™ä¸ªs-1è¦æ³¨æ„å•Šwoc\n        res.append((char)((s-1)%26+65));\n        s=(s-1)/26;\n    }\n    return res.reverse().toString();\n}\n```\n## [168. Excelè¡¨åˆ—åç§°](https://leetcode-cn.com/problems/excel-sheet-column-title/)\n\nç»™å®šä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¿”å›å®ƒåœ¨ Excel è¡¨ä¸­ç›¸å¯¹åº”çš„åˆ—åç§°ã€‚\n\nä¾‹å¦‚ï¼Œ\n\n```java\n1 -> A\n2 -> B\n3 -> C\n...\n26 -> Z\n27 -> AA\n28 -> AB \n...\n```\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 1\nè¾“å‡º: \"A\"\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 28\nè¾“å‡º: \"AB\"\n```\n\n**ç¤ºä¾‹ 3:**\n\n```java\nè¾“å…¥: 701\nè¾“å‡º: \"ZY\"\n```\n\n**è§£æ³•ä¸€**\n\n```java\npublic String numberToTitle(int s) {\n    StringBuilder res=new StringBuilder();\n    while(s!=0){\n        //è¿™ä¸ªs-1è¦æ³¨æ„å•Šwoc\n        res.append((char)((s-1)%26+65));\n        s=(s-1)/26;\n    }\n    return res.reverse().toString();\n}\n```\n\ngoå†™æ³•\n\n```go\nfunc convertToTitle(n int) string {\n    var res string\n    for n>0{\n        res=string((n-1)%26+'A')+res\n        n=(n-1)/26\n    }\n    return res\n}\n```\n\n## [724. å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒç´¢å¼•](https://leetcode-cn.com/problems/find-pivot-index/)\n\nç»™å®šä¸€ä¸ªæ•´æ•°ç±»å‹çš„æ•°ç»„ `nums`ï¼Œè¯·ç¼–å†™ä¸€ä¸ªèƒ½å¤Ÿè¿”å›æ•°ç»„**â€œä¸­å¿ƒç´¢å¼•â€**çš„æ–¹æ³•ã€‚\n\næˆ‘ä»¬æ˜¯è¿™æ ·å®šä¹‰æ•°ç»„**ä¸­å¿ƒç´¢å¼•**çš„ï¼šæ•°ç»„ä¸­å¿ƒç´¢å¼•çš„å·¦ä¾§æ‰€æœ‰å…ƒç´ ç›¸åŠ çš„å’Œç­‰äºå³ä¾§æ‰€æœ‰å…ƒç´ ç›¸åŠ çš„å’Œã€‚\n\nå¦‚æœæ•°ç»„ä¸å­˜åœ¨ä¸­å¿ƒç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥è¿”å› -1ã€‚å¦‚æœæ•°ç»„æœ‰å¤šä¸ªä¸­å¿ƒç´¢å¼•ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥è¿”å›æœ€é è¿‘å·¦è¾¹çš„é‚£ä¸€ä¸ªã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: \nnums = [1, 7, 3, 6, 5, 6]\nè¾“å‡º: 3\nè§£é‡Š: \nç´¢å¼•3 (nums[3] = 6) çš„å·¦ä¾§æ•°ä¹‹å’Œ(1 + 7 + 3 = 11)ï¼Œä¸å³ä¾§æ•°ä¹‹å’Œ(5 + 6 = 11)ç›¸ç­‰ã€‚\nåŒæ—¶, 3 ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„ä¸­å¿ƒç´¢å¼•ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: \nnums = [1, 2, 3]\nè¾“å‡º: -1\nè§£é‡Š: \næ•°ç»„ä¸­ä¸å­˜åœ¨æ»¡è¶³æ­¤æ¡ä»¶çš„ä¸­å¿ƒç´¢å¼•ã€‚\n```\n\n**è¯´æ˜:**\n\n- `nums` çš„é•¿åº¦èŒƒå›´ä¸º `[0, 10000]`ã€‚\n- ä»»ä½•ä¸€ä¸ª `nums[i]` å°†ä¼šæ˜¯ä¸€ä¸ªèŒƒå›´åœ¨ `[-1000, 1000]`çš„æ•´æ•°ã€‚\n\n**è§£æ³•ä¸€**\n\nå”‰ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œç›´æ¥å†™äº†ä¸ªå‰ç¼€åç¼€å’Œåˆ¤æ–­çš„ï¼Œå¾ˆæš´åŠ›ç›´ç™½çš„æ€è·¯ï¼Œå’‹å°±æƒ³ä¸åˆ°ç®€å•çš„æ€è·¯ï¼Ÿ\n\n```go\nfunc pivotIndex(nums []int) int {\n    //å‰ç¼€å’Œï¼Œåç¼€å’Œ\n    n:=len(nums)\n    if n==0{\n        return -1\n    }\n    pre:=make([]int,n+1) //iä¹‹å‰çš„å…ƒç´ å’Œ,ä¸åŒ…å«i\n    pre[0]=0\n    last:=make([]int,n+1) //(i-1)ä¹‹åå…ƒç´ å’Œ,ä¸åŒ…å«(i-1)\n    last[n]=0\n    for i,j := 1,n-1;i<=n && j>=0; i,j = i+1,j-1 {\n        //è¿™é‡Œå…¶å®åªè¦ä»£å…¥å€¼éªŒè¯ç¬¬ä¸€æ¬¡çš„è½¬ç§»æ˜¯æ­£ç¡®çš„å°±è¡Œäº†,ä¸ç”¨è€ƒè™‘å¤ªå¤š\n        pre[i]=pre[i-1]+nums[i-1]\n        last[j]=last[j+1]+nums[j]\n    }\n    for i:=0;i<n;i++{\n        //è”ç³»ä¸Šé¢æ•°ç»„çš„å®šä¹‰æ€è€ƒè¿™é‡Œçš„åˆ¤æ–­\n        if pre[i]==last[i+1]{\n            return i;\n        }\n    }\n    return -1\n}\n```\n\n**è§£æ³•äºŒ**\n\nç®€å•çš„æ€è·¯ï¼Œè„‘å­ç“¦ç‰¹äº†ä¸€ä¸‹æ²¡æƒ³åˆ°\n\n```go\nfunc pivotIndex(nums []int) int {\n    n:=len(nums)\n    if n==0{\n        return -1\n    }\n    sum:=0\n    for _,num:= range nums{\n        sum+=num\n    }\n    temp:=0 //åŒ…å«äº†è¾¹ç•Œ0\n    for i:=0;i<n;i++{\n        if temp*2+nums[i]==sum{\n            return i\n        }\n        temp+=nums[i]\n    }\n    return -1\n}\n```\n\n## [945. ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡](https://leetcode-cn.com/problems/minimum-increment-to-make-array-unique/)\n\nç»™å®šæ•´æ•°æ•°ç»„ Aï¼Œæ¯æ¬¡ *move* æ“ä½œå°†ä¼šé€‰æ‹©ä»»æ„ `A[i]`ï¼Œå¹¶å°†å…¶é€’å¢ `1`ã€‚\n\nè¿”å›ä½¿ `A` ä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥ï¼š[1,2,2]\nè¾“å‡ºï¼š1\nè§£é‡Šï¼šç»è¿‡ä¸€æ¬¡ move æ“ä½œï¼Œæ•°ç»„å°†å˜ä¸º [1, 2, 3]ã€‚\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥ï¼š[3,2,1,2,1,7]\nè¾“å‡ºï¼š6\nè§£é‡Šï¼šç»è¿‡ 6 æ¬¡ move æ“ä½œï¼Œæ•°ç»„å°†å˜ä¸º [3, 4, 1, 2, 5, 7]ã€‚\nå¯ä»¥çœ‹å‡º 5 æ¬¡æˆ– 5 æ¬¡ä»¥ä¸‹çš„ move æ“ä½œæ˜¯ä¸èƒ½è®©æ•°ç»„çš„æ¯ä¸ªå€¼å”¯ä¸€çš„ã€‚\n```\n\n**æç¤ºï¼š**\n\n1. `0 <= A.length <= 40000`\n2. `0 <= A[i] < 40000`\n\n**è§£æ³•ä¸€**\n\nä¹‹å‰å†™äº†ï¼Œæ²¡è®°å½•ï¼Œè¿™æ¬¡PDDç¬”è¯•è€ƒäº†è¿™é¢˜\n\n```java\npublic int minIncrementForUnique(int[] A) {\n    Arrays.sort(A);\n    int move=0;\n    for(int i=1;i<A.length;i++){\n        if(A[i]<=A[i-1]){\n            move+=A[i-1]-A[i];\n            A[i]=A[i-1]+1;\n        }\n    }\n    return move;\n}\n```\n\næš´åŠ›çš„è§£æ³•å¾ˆå¥½æƒ³ï¼Œé¦–å…ˆè‚¯å®šè¦æ’åºï¼Œç„¶åé‡åˆ°å°äºç­‰äºå‰é¢çš„æ—¶å€™å°±`move+1`ï¼Œç›´åˆ°ä¸ç›¸ç­‰ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œä¸€æ¬¡æ¬¡çš„åŠ æ²¡æœ‰å•¥æ„ä¹‰ï¼Œå¯ä»¥ç›´æ¥ä¸€æ­¥åˆ°ä½ç›´æ¥ä»`A[i]`å¢åŠ åˆ°`A[i-1]+1`\n\n> è¿™é¢˜è¿˜æœ‰ä¸€äº›æ–¹æ³•ä¼˜åŒ–ï¼Œé¦–å…ˆæ˜¯æ’åºå¯ä»¥ç”¨æ¡¶æ’åºï¼Œç„¶åè¿˜å¯ä»¥ç”¨å¹¶æŸ¥é›†ï¼ˆæ¯”è¾ƒéº»çƒ¦ï¼‰ï¼Œæˆ–è€…ä¹Ÿæœ‰æ•°å­¦åˆ†ææ‰¾è§„å¾‹çš„æ–¹æ³•\n\n## [é¢è¯•é¢˜05. æ›¿æ¢ç©ºæ ¼](https://leetcode-cn.com/problems/ti-huan-kong-ge-lcof/)\n\nè¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸² `s` ä¸­çš„æ¯ä¸ªç©ºæ ¼æ›¿æ¢æˆ\"%20\"ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼šs = \"We are happy.\"\nè¾“å‡ºï¼š\"We%20are%20happy.\"\n```\n\n**é™åˆ¶ï¼š**\n\n```java\n0 <= s çš„é•¿åº¦ <= 10000\n```\n\n**è§£æ³•ä¸€**\n\nè¿™é¢˜çš„æ ‡å‡†åšæ³•\n\n```java\npublic String replaceSpace(String s) {\n    char[] res=new char[s.length()*3];\n    int idx=0;\n    for(int i=0;i<s.length();i++){\n        if(s.charAt(i)==' '){\n            res[idx++]='%';\n            res[idx++]='2';\n            res[idx++]='0';\n        }else{\n            res[idx++]=s.charAt(i);\n        }\n    }\n    return new String(res,0,idx);\n}\n```\n\n**è§£æ³•äºŒ**\n\nåŸé¢˜æ˜¯è¦æ±‚O(1)ç©ºé—´çš„ï¼Œè¿™é‡Œè™½ç„¶æ— æ³•åšåˆ°ï¼Œä½†æ˜¯å¯ä»¥æ¨¡æ‹Ÿä¸‹\n\n```java\n//åŸé¢˜ç›®çš„è¦æ±‚åº”è¯¥æ˜¯åœ¨O(1)ç©ºé—´ä¸‹,ä½†æ˜¯Javaçš„Stringæ˜¯ä¸å¯å˜çš„\n//æ‰€ä»¥ä¸å¯èƒ½O(1),æˆ‘ä»¬éœ€è¦æ”¹ä¸€ä¸‹å‡½æ•°ç­¾å\npublic String replaceSpace(/*StringBuilder*/ String ss) {\n    StringBuilder s=new StringBuilder(ss); //è¿™é‡Œæ˜¯ä¸ºäº†éªŒè¯\n    int oldLen=s.length();\n    for (int i=0;i<oldLen;i++) {\n        if(s.charAt(i)==' ') s.append(\"xx\"); //æ‰©å……å­—ç¬¦é•¿åº¦\n    }\n    int newLen=s.length();\n    //é€†åº,é¿å…è¦†ç›–\n    int i=oldLen-1,j=newLen-1;\n    while(i>=0){\n        char c=s.charAt(i--);\n        if(c==' '){\n            s.setCharAt(j--,'0');\n            s.setCharAt(j--,'2');\n            s.setCharAt(j--,'%');\n        }else{\n            s.setCharAt(j--,c);\n        }\n    }\n    return s.toString();\n}\n```\n\n## [é¢è¯•é¢˜45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°](https://leetcode-cn.com/problems/ba-shu-zu-pai-cheng-zui-xiao-de-shu-lcof/)\n\nè¾“å…¥ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ï¼ŒæŠŠæ•°ç»„é‡Œæ‰€æœ‰æ•°å­—æ‹¼æ¥èµ·æ¥æ’æˆä¸€ä¸ªæ•°ï¼Œæ‰“å°èƒ½æ‹¼æ¥å‡ºçš„æ‰€æœ‰æ•°å­—ä¸­æœ€å°çš„ä¸€ä¸ªã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [10,2]\nè¾“å‡º: \"102\"\n```\n**ç¤ºä¾‹Â 2:**\n\n```java\nè¾“å…¥: [3,30,34,5,9]\nè¾“å‡º: \"3033459\"\n```\n\n**æç¤º:**\n- `0 < nums.length <= 100`\n\n**è¯´æ˜:**\n\nè¾“å‡ºç»“æœå¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥ä½ éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯æ•´æ•°ï¼›æ‹¼æ¥èµ·æ¥çš„æ•°å­—å¯èƒ½ä¼šæœ‰å‰å¯¼ 0ï¼Œæœ€åç»“æœä¸éœ€è¦å»æ‰å‰å¯¼ 0\n\n**è§£æ³•ä¸€**\n\nä¸€å¼€å§‹è´¼sbï¼Œæƒ³äº†ä¸€å¤§å †æœ‰çš„æ²¡çš„ğŸ˜…\n![UTOOLS1592838604659.png](https://upload.cc/i1/2020/06/22/zOQcTL.png)\n```java\npublic String minNumber(int[] nums) {\n    String[] strs=new String[nums.length];\n    for(int i=0;i<nums.length;i++) strs[i]=nums[i]+\"\";\n    Arrays.sort(strs,(a,b)->(a+b).compareTo(b+a));\n    StringBuilder sb=new StringBuilder();\n    for(String i:strs) sb.append(i);\n    return sb.toString();\n}\n```\nè™½ç„¶ç»•äº†ä¸€å¤§åœˆï¼Œæ‰€å¹¸è¿˜æ˜¯è‡ªå·±åšå‡ºæ¥äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™æ ·å°±æ˜¯å¯¹çš„å‘¢ï¼Ÿå…¶å®è¿™é‡Œæˆ‘ä¹Ÿæ˜¯æƒ³å½“ç„¶äº†ï¼Œä¸¥è°¨çš„åº”è¯¥å¯¹è¿™ä¸ªæ’åºè§„åˆ™çš„ä¼ é€’æ€§è¿›è¡Œè¯æ˜ï¼Œä¹Ÿå°±æ˜¯`xy>yx && yz>zy ==> xz>xz ?`è¿™ä¸ªæˆç«‹ï¼Œæ’åºçš„ç»“æœæ‰æ˜¯å¯¹çš„ï¼Œè¿™é‡Œæˆ‘å°±ä¸copyäº†ï¼Œè¯æ˜ä¹Ÿä¸æ˜¯å¾ˆéš¾ï¼Œå¤§å®¶å¯ä»¥å»åŸé¢˜[é¢˜è§£åŒº](https://leetcode-cn.com/problems/ba-shu-zu-pai-cheng-zui-xiao-de-shu-lcof/solution/mian-shi-ti-45-ba-shu-zu-pai-cheng-zui-xiao-de-s-4/378553)çœ‹çœ‹\n\n## [179. æœ€å¤§æ•°](https://leetcode-cn.com/problems/largest-number/)\n\nç»™å®šä¸€ç»„éè´Ÿæ•´æ•°ï¼Œé‡æ–°æ’åˆ—å®ƒä»¬çš„é¡ºåºä½¿ä¹‹ç»„æˆä¸€ä¸ªæœ€å¤§çš„æ•´æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: [10,2]\nè¾“å‡º: 210\n```\n**ç¤ºä¾‹Â 2:**\n\n```java\nè¾“å…¥: [3,30,34,5,9]\nè¾“å‡º: 9534330\nè¯´æ˜: è¾“å‡ºç»“æœå¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥ä½ éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯æ•´æ•°ã€‚\n```\n**è§£æ³•ä¸€**\n\nå’Œä¸Šä¸€é¢˜ä¸€æ‘¸ä¸€æ ·ï¼Œå€Ÿæœºå­¦ä¹ ä¸‹golangçš„è‡ªå®šä¹‰æ’åº\n```golang\ntype StringSlice []string\n\nfunc (p StringSlice) Len() int           { return len(p) }\nfunc (p StringSlice) Less(i, j int) bool { return p[i]+p[j] > p[j]+p[i] }\nfunc (p StringSlice) Swap(i, j int)      { p[i], p[j] = p[j], p[i] }\n\nfunc largestNumber(nums []int) string {\n    strs := make([]string, len(nums))\n    for i, n := range nums {\n        strs[i] = strconv.Itoa(n)\n    }\n    sort.Sort(StringSlice(strs))\n    //return strings.Join(strs,\"\") è¦å»å‰å¯¼0...\n    // var res = \"\"\n    // var idx = 0\n    // for idx < len(strs)-1 && strs[idx] == \"0\" {\n    //     idx++\n    // }\n    // for idx < len(strs) {\n    //     res += strs[idx]\n    //     idx++\n    // }\n    res := strings.Join(strs, \"\")\n    if res[0] == '0' { //ç¬¬ä¸€ä¸ªä¸º0è‚¯å®šå°±å…¨éƒ¨æ˜¯0äº†...å‰é¢çš„å†™æ³•æ˜æ˜¾æ²¡åŠ¨è„‘å­\n        return \"0\"\n    }\n    return res\n}\n```\nçœ‹äº†å¤§ä½¬ä»¬çš„æäº¤è®°å½•å‘ç°go 1.8åœ¨sortåŒ…ä¸­å¼•å…¥äº†\n\n`func Slice(slice interface{}, less func(i, j int) bool)`\n\né€šè¿‡è¿™ä¸ªå°±ä¸ç”¨å¾ˆéº»çƒ¦çš„å»å®ç°3ä¸ªå‡½æ•°äº†ï¼Œåªéœ€è¦å®ç°`Less`æ¯”è¾ƒå™¨å°±å¯ä»¥äº†ï¼ˆå…¶å®è¿™æ‰æ˜¯æ­£å¸¸çš„åšæ³•ï¼Œå…¶ä»–è¯­è¨€ä¸­ä¹Ÿéƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå…¶ä»–ä¸¤ä¸ª`len`å’Œ`swap`æ„Ÿè§‰æ„ä¹‰ä¸å¤§ï¼Œä¸€èˆ¬ä¸ä¼šæ”¹è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå®Œå…¨å¯ä»¥è‡ªåŠ¨ç”Ÿæˆï¼‰\n> çœ‹è¯„è®ºåŒºåˆçœ‹åˆ°ä¸€ä¸ªå¾ˆå¥½çš„[åè¯çš„æ€è·¯](https://leetcode-cn.com/problems/largest-number/solution/zui-da-shu-bi-jiao-gui-ze-chuan-di-xing-yi-ji-suan/344160)ï¼Œå¤§è‡´æ„æ€å°±æ˜¯ï¼šå‡è®¾å­˜åœ¨åºåˆ—`\"...ab...\"`ä¸ºæœ€å¤§æ•°ï¼Œä¸”ä¸æ»¡è¶³è¯¥æ’åºè§„åˆ™`ab>ba`ï¼Œä¹Ÿå°±æ˜¯è¯´`ab<ba`ï¼Œé‚£æˆ‘ä»¬äº¤æ¢åºåˆ—ä¸­abçš„ä½ç½®å˜ä¸º`\"...ba...\"`å¾ˆæ˜æ˜¾`\"...ba...\"`>`\"...ab...\"`ï¼Œä¸å‡è®¾çŸ›ç›¾ï¼Œæ‰€ä»¥æœ€å¤§æ•°ä¸€å®šæ»¡è¶³è¯¥æ’åºè§„åˆ™\n\n## [334. é€’å¢çš„ä¸‰å…ƒå­åºåˆ—](https://leetcode-cn.com/problems/increasing-triplet-subsequence/)\n\nDifficulty: **ä¸­ç­‰**\n\n\nç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•°ç»„ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨é•¿åº¦ä¸º 3 çš„é€’å¢å­åºåˆ—ã€‚\n\næ•°å­¦è¡¨è¾¾å¼å¦‚ä¸‹:\n\n> å¦‚æœå­˜åœ¨è¿™æ ·çš„Â _i, j, k,Â _Â ä¸”æ»¡è¶³Â 0 â‰¤ _i_ < _j_ < _k_ â‰¤ _n_-1ï¼Œ  \n> ä½¿å¾—Â _arr[i]_ < _arr[j]_ < _arr[k]_ ï¼Œè¿”å› true ;Â å¦åˆ™è¿”å› false ã€‚\n\n**è¯´æ˜:** è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(_n_)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(_1_) ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: [1,2,3,4,5]\nè¾“å‡º: true\n```\n\n**ç¤ºä¾‹ 2:**\n\n```go\nè¾“å…¥: [5,4,3,2,1]\nè¾“å‡º: false\n```\n\n**è§£æ³•ä¸€**\n\né¢˜ç›®é™åˆ¶äº†ç©ºé—´å¤æ‚åº¦O(1)æ—¶é—´å¤æ‚åº¦O(N)ï¼Œæ‰€ä»¥åˆ©ç”¨é¢å¤–ç©ºé—´çš„æ–¹æ¡ˆå°±ä¸é€‚ç”¨äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•å½“å‰å…ƒç´ **ä¹‹å‰çš„æœ€å°å€¼**ï¼Œå’Œæœ€å°å€¼**å³è¾¹çš„æ¬¡å°å€¼**å°±okäº†ï¼Œåœ¨å¾ªç¯ä¸­ä¸æ–­çš„æ›´æ–°è¿™ä¸¤ä¸ªå€¼\n```golang\nfunc increasingTriplet(nums []int) bool {\n Â  Â var INT_MAX = int(^uint(0)>>1)\n Â  Â var n = len(nums)\n Â  Â var a = INT_MAX\n Â  Â var b = INT_MAX\n Â  Â for i := 0; i < n; i++{\n Â  Â  Â  Â if nums[i] <= a{\n Â  Â  Â  Â  Â  Â a = nums[i]\n Â  Â  Â  Â  Â  Â //b = a è¿™é‡Œä¸ç”¨æ›´æ–°æ¬¡å°å€¼ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¿è¯aåœ¨bå‰é¢\n Â  Â  Â   }else if nums[i] <= b{\n Â  Â  Â  Â  Â  Â b = nums[i]\n Â  Â  Â   }else{\n Â  Â  Â  Â  Â  Â return true\n Â  Â  Â   }\n Â   }\n Â  Â return false\n}\n```\nå¾ˆå¯æƒœæ˜¯åœ¨çœ‹äº†é¢˜è§£åŒºæ‰æ˜ç™½ï¼ŒçœŸçš„èœå•Šï¼Œä¸€å¼€å§‹æƒ³åŠˆå‰äº†ï¼Œæˆ‘ä¸€ç›´åœ¨è€ƒè™‘ä¸­é—´çš„å…ƒç´ ï¼Œæƒ³æ€ä¹ˆæ±‚å·¦å³çš„æœ€å°æœ€å¤§å€¼ã€‚ã€‚ã€‚\n\n## [172. é˜¶ä¹˜åçš„é›¶](https://leetcode-cn.com/problems/factorial-trailing-zeroes/)\n\nDifficulty: **ç®€å•**\n\n\nç»™å®šä¸€ä¸ªæ•´æ•° _n_ï¼Œè¿”å› _n_! ç»“æœå°¾æ•°ä¸­é›¶çš„æ•°é‡ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```go\nè¾“å…¥: 3\nè¾“å‡º: 0\nè§£é‡Š:Â 3! = 6, å°¾æ•°ä¸­æ²¡æœ‰é›¶ã€‚\n```\n\n**ç¤ºä¾‹Â 2:**\n\n```go\nè¾“å…¥: 5\nè¾“å‡º: 1\nè§£é‡Š:Â 5! = 120, å°¾æ•°ä¸­æœ‰ 1 ä¸ªé›¶.\n```\n\n**è¯´æ˜:** ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”ä¸ºÂ _O_(logÂ _n_)ã€‚\n\n**è§£æ³•ä¸€**\n\né¦–å…ˆéœ€è¦æ˜ç¡®é¢˜ç›®è¦æ±‚ä»€ä¹ˆï¼Œ`n!`ç»“å°¾0çš„ä¸ªæ•°ï¼Œç›´æ¥ç®—é˜¶ä¹˜çš„å€¼æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œå€¼ä¼šå¾ˆå¤§å¾ˆå®¹æ˜“æº¢å‡ºï¼Œè€Œä¸”å¤§æ•°ç›¸ä¹˜çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿå¾ˆé«˜\n\næˆ‘ä»¬è€ƒè™‘ä¸‹æœ«å°¾çš„0æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ•°x10ï¼Œæœ«å°¾å°±ä¼šå¤šä¸€ä¸ª0ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ±‚çš„å°±æ˜¯åœ¨é˜¶ä¹˜çš„è¿‡ç¨‹ä¸­ä¹˜äº†å¤šå°‘ä¸ª10ï¼Œé‚£ä¹ˆ10ä»å“ªé‡Œæ¥å‘¢ï¼Ÿ\n\næˆ‘ä»¬å°†10æ‹†è§£æˆ`2*5`ï¼Œé—®é¢˜å°±åˆè½¬åŒ–æˆäº†ï¼Œé˜¶ä¹˜ä¸­äº§ç”Ÿäº†å¤šå°‘å¯¹`2*5`çš„å› å­ï¼Œæ³¨æ„è¿™ä¸ªå¹¶ä¸æ˜¯å•çº¯æŒ‡1~nä¸­æŸä¸€ä¸ªå€¼2ï¼Œæˆ–è€…5ï¼Œè€Œæ˜¯ä¸­é—´æ¯ä¸ªæ•°æ‹†åˆ†å‡ºæ¥çš„å› å­ï¼Œæ¯”å¦‚15å°±æ‹†åˆ†æˆ3*5ï¼Œä¸­é—´å°±æœ‰ä¸€ä¸ª5çš„å› å­ï¼Œç°åœ¨é—®é¢˜æ˜ç¡®äº†ï¼Œæˆ‘ä»¬å¦‚ä½•å»æ±‚2æˆ–è€…5çš„å› å­ä¸ªæ•°å‘¢ï¼Ÿ\n\næ ¹æ®**çŸ­æ¿ç†è®º**ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸¤ä¸ªå› å­æˆ‘ä»¬åªéœ€è¦æ±‚å…¶ä¸­**ä¸ªæ•°è¾ƒå°‘**çš„é‚£ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œå°‘çš„é‚£ä¸ªä¸€å®šå¯ä»¥æ‰¾åˆ°é…å¯¹çš„å¦ä¸€ä¸ªå› å­ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬`n!`ä¸­äº§ç”Ÿäº†2ä¸ª**5çš„å› å­**ï¼Œå’Œ5ä¸ª**2çš„å› å­**ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾æœ€åæˆ‘ä»¬æœ€åé…å¯¹çš„`2x5`åªæœ‰2å¯¹ï¼Œä¹Ÿå°±æ˜¯ç»“å°¾ä¼šæœ‰2ä¸ª0ï¼Œé‚£ä¹ˆ2å’Œ5æˆ‘ä»¬æ±‚å“ªä¸€ä¸ªå‘¢ï¼Ÿæˆ–è€…è¯´2å’Œ5çš„å› å­æ•°é‡ä¸€å®šä¼šæœ‰å›ºå®šçš„å¤§å°å…³ç³»ä¹ˆï¼Ÿ\n\nå…¶å®ä¸Šé¢çš„é—®é¢˜å‡­ç›´è§‰å°±èƒ½çœ‹å‡ºæ¥ï¼Œæ˜æ˜¾5çš„ä¸ªæ•°ä¼šå°‘ä¸€äº›ï¼Œåº”è¯¥æ±‚5çš„ä¸ªæ•°ï¼Œä½†æ˜¯ç§‰æ‰¿ç€ä¸¥è°¨çš„æ€åº¦ï¼Œæˆ‘ä»¬è¿˜æ˜¯åº”è¯¥å®é™…çš„ç®—ä¸€ç®—ï¼Œè€Œä¸”åé¢codeçš„æ—¶å€™ä¹Ÿæ˜¯éœ€è¦ç®—çš„\n\né¦–å…ˆçœ‹2çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬æ¯éš”2ä¸ªæ•°å°±ä¼šäº§ç”Ÿä¸€ä¸ª2çš„å› å­ï¼Œæ¯”å¦‚2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10...ï¼Œä½†æ˜¯åŒæ—¶æœ‰çš„æ•°ä¼šæœ‰å¤šä¸ªå› å­ï¼Œè¿™ä¸ªé‡Œé¢ä¹Ÿä¼šäº§ç”Ÿ2ï¼Œæ¯”å¦‚4å°±å¯ä»¥æ‹†è§£æˆ`2x2`ï¼Œä¹Ÿå°±æ˜¯æ¯éš”`4`ä¸ªå…ƒç´ ï¼ŒæŠ›å¼€åŸæ¥æ¯éš”`2`ä¸ªå…ƒç´ äº§ç”Ÿçš„2ï¼Œä¼šé¢å¤–çš„å†äº§ç”Ÿä¸€ä¸ª2çš„å› å­ï¼ŒåŒç†8å¯ä»¥æ‹†è§£æˆ`2x2x2`ï¼Œä¹Ÿå°±æ˜¯æ‰€æ¯éš”8ä¸ªå…ƒç´ åˆä¼šäº§ç”Ÿä¸€ä¸ªé¢å¤–çš„2ï¼Œæ‰€ä»¥æ€»ä½“çš„n!ä¸­ï¼ŒåŒ…å«2çš„å› å­ä¸ªæ•°æ˜¯ `n/2 + n/4 + n/8 + ...`ï¼ŒåŒç†ä¹Ÿå¯æ¨å‡º5çš„å› å­ä¸ªæ•°ï¼Œå¦‚ä¸‹ï¼š\n![mark](http://static.imlgw.top/blog/20200630/lFrypQIJu57J.png?imageslim)\nå¾ˆæ˜æ˜¾åŒæ ·é¡¹æ•°mçš„æƒ…å†µä¸‹ï¼Œ5çš„å› å­çš„ä¸ªæ•°è¦æ›´å°‘ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ±‚å› å­5çš„ä¸ªæ•°å°±è¡Œäº†\n\næœ‰äº†ä¸Šé¢çš„ç»“è®ºï¼Œä»£ç å°±å¾ˆå®¹æ˜“å†™äº†ï¼Œç›´æ¥æ¨¡æ‹Ÿå°±è¡Œäº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(log(5,N))`\n```golang\nfunc trailingZeroes(n int) int {\n Â  Â var count = 0\n Â  Â for n > 0{\n Â  Â  Â  Â n /= 5\n Â  Â  Â  Â count += n\n Â   }\n Â  Â return count\n}\n```\n\n## [793. é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶](https://leetcode-cn.com/problems/preimage-size-of-factorial-zeroes-function/)\n\nDifficulty: **å›°éš¾**\n\n\nÂ `f(x)`Â æ˜¯Â `x!`Â æœ«å°¾æ˜¯0çš„æ•°é‡ã€‚ï¼ˆå›æƒ³ä¸€ä¸‹Â `x! = 1 * 2 * 3 * ... * x`ï¼Œä¸”`0! = 1`ï¼‰\n\nä¾‹å¦‚ï¼ŒÂ `f(3) = 0`Â ï¼Œå› ä¸º3! = 6çš„æœ«å°¾æ²¡æœ‰0ï¼›è€ŒÂ `f(11) = 2`Â ï¼Œå› ä¸º11!= 39916800æœ«ç«¯æœ‰2ä¸ª0ã€‚ç»™å®šÂ `K`ï¼Œæ‰¾å‡ºå¤šå°‘ä¸ªéè´Ÿæ•´æ•°`x`Â ï¼Œæœ‰Â `f(x) = K`Â çš„æ€§è´¨ã€‚\n\n```golang\nç¤ºä¾‹ 1:\nè¾“å…¥:K = 0\nè¾“å‡º:5\nè§£é‡Š:Â 0!, 1!, 2!, 3!, and 4!Â å‡ç¬¦åˆ K = 0 çš„æ¡ä»¶ã€‚\n\nç¤ºä¾‹ 2:\nè¾“å…¥:K = 5\nè¾“å‡º:0\nè§£é‡Š:æ²¡æœ‰åŒ¹é…åˆ°è¿™æ ·çš„ x!ï¼Œç¬¦åˆK = 5 çš„æ¡ä»¶ã€‚\n```\n\n**æ³¨æ„ï¼š**\n\n*   `K`æ˜¯èŒƒå›´åœ¨Â `[0, 10^9]`Â çš„æ•´æ•°**ã€‚**\n\n**è§£æ³•ä¸€**\n\nä¸Šä¸€é¢˜çš„é€†å‘ï¼ŒæŒºæœ‰æ„æ€çš„ï¼Œå¯æƒœäº†ï¼Œä¸€å¼€å§‹æ²¡æƒ³å‡ºæ¥ï¼Œæˆ‘çŸ¥é“ç­”æ¡ˆè‚¯å®šæ˜¯0 or 5ä½†æ˜¯ä¸çŸ¥é“å’‹éªŒè¯äº†ã€‚ã€‚ã€‚æ˜æ˜ä¸Šä¸€é¢˜ä¹‹å‰å°±åšè¿‡äº†ï¼ŒçœŸèœå•Šï¼Œçœ‹äº†è¯„è®ºåŒºæ‰æç„¶å¤§æ‚Ÿ\n```golang\n//ans: 0 or 5\nfunc preimageSizeFZF(K int) int {\n Â  Â //n/5 + n/25 + ... +  = K ==> n < 5*K\n Â  Â var left = 0 \n Â  Â var right = 5*K+1\n Â  Â for left <= right {\n Â  Â  Â  Â mid := left + (right-left)/2\n Â  Â  Â  Â var zero = trailingZeroes(mid)\n Â  Â  Â  Â if zero == K {\n Â  Â  Â  Â  Â  Â return 5\n Â  Â  Â   }\n Â  Â  Â  Â if zero > K {\n Â  Â  Â  Â  Â  Â right = mid - 1\n Â  Â  Â   }else{\n Â  Â  Â  Â  Â  Â left = mid + 1\n Â  Â  Â   }\n Â   }\n Â  Â return 0\n}\nâ€‹\n//172.é˜¶ä¹˜åçš„0\nfunc trailingZeroes(n int) int {\n Â  Â var count = 0\n Â  Â for n > 0 {\n Â  Â  Â  Â n/=5\n Â  Â  Â  Â count += n\n Â   }\n Â  Â return count\n}\n```\n\n## [73. çŸ©é˜µç½®é›¶](https://leetcode-cn.com/problems/set-matrix-zeroes/)\n\nDifficulty: **ä¸­ç­‰**\n\nç»™å®šä¸€ä¸ªÂ m*n çš„çŸ©é˜µï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ ä¸º 0ï¼Œåˆ™å°†å…¶æ‰€åœ¨è¡Œå’Œåˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½è®¾ä¸º 0ã€‚è¯·ä½¿ç”¨åŸåœ°ç®—æ³•ã€‚\n\n**ç¤ºä¾‹Â 1:**\n\n```go\nè¾“å…¥: \n[\nÂ  [1,1,1],\nÂ  [1,0,1],\nÂ  [1,1,1]\n]\nè¾“å‡º: \n[\nÂ  [1,0,1],\nÂ  [0,0,0],\nÂ  [1,0,1]\n]\n```\n\n**ç¤ºä¾‹Â 2:**\n\n```go\nè¾“å…¥: \n[\nÂ  [0,1,2,0],\nÂ  [3,4,5,2],\nÂ  [1,3,1,5]\n]\nè¾“å‡º: \n[\nÂ  [0,0,0,0],\nÂ  [0,4,5,0],\nÂ  [0,3,1,0]\n]\n```\n\n**è¿›é˜¶:**\n\n*   ä¸€ä¸ªç›´æ¥çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Â O(mn)Â çš„é¢å¤–ç©ºé—´ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆã€‚\n*   ä¸€ä¸ªç®€å•çš„æ”¹è¿›æ–¹æ¡ˆæ˜¯ä½¿ç”¨ O(m+n) çš„é¢å¤–ç©ºé—´ï¼Œä½†è¿™ä»ç„¶ä¸æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚\n*   ä½ èƒ½æƒ³å‡ºä¸€ä¸ªå¸¸æ•°ç©ºé—´çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ\n\n\n**è§£æ³•ä¸€**\n\nå‚»é€¼é¢˜\n```golang\nfunc setZeroes(matrix [][]int)  {\n Â  Â r, c := false, false\n Â  Â for j := 0; j < len(matrix[0]); j++{\n Â  Â  Â  Â if matrix[0][j] == 0{\n Â  Â  Â  Â  Â  Â r = true\n Â  Â  Â  Â  Â  Â break\n Â  Â  Â   }\n Â   }\n Â  Â for i := 0; i < len(matrix); i++{\n Â  Â  Â  Â if matrix[i][0] == 0{\n Â  Â  Â  Â  Â  Â c = true\n Â  Â  Â  Â  Â  Â break\n Â  Â  Â   }\n Â   }\n Â  Â \n Â  Â for i :=1; i < len(matrix); i++{\n Â  Â  Â  Â for j := 1; j < len(matrix[0]); j++{\n Â  Â  Â  Â  Â  Â if matrix[i][j] == 0{\n Â  Â  Â  Â  Â  Â  Â  Â matrix[i][0] = 0\n Â  Â  Â  Â  Â  Â  Â  Â matrix[0][j] = 0\n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â   }\n Â  Â for j :=1; j < len(matrix[0]); j++{\n Â  Â  Â  Â if matrix[0][j] == 0{\n Â  Â  Â  Â  Â  Â for i :=0; i < len(matrix);i++{\n Â  Â  Â  Â  Â  Â  Â  Â matrix[i][j] = 0\n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â   }\n Â  Â for i :=1; i < len(matrix); i++{\n Â  Â  Â  Â if matrix[i][0] == 0{\n Â  Â  Â  Â  Â  Â for j :=0; j < len(matrix[0]); j++{\n Â  Â  Â  Â  Â  Â  Â  Â matrix[i][j] = 0 Â  \n Â  Â  Â  Â  Â   }\n Â  Â  Â   }\n Â   }\n Â  Â if r {\n Â  Â  Â  Â for j :=0; j < len(matrix[0]); j++{\n Â  Â  Â  Â  Â  Â matrix[0][j] = 0\n Â  Â  Â   }\n Â   }\n Â  Â if c {\n Â  Â  Â  Â for i :=0; i < len(matrix); i++{\n Â  Â  Â  Â  Â  Â matrix[i][0] = 0\n Â  Â  Â   }\n Â   }\n}\n```\n\n## [é¢è¯•é¢˜ 16.11. è·³æ°´æ¿](https://leetcode-cn.com/problems/diving-board-lcci/)\n\nDifficulty: **ç®€å•**\n\n\nä½ æ­£åœ¨ä½¿ç”¨ä¸€å †æœ¨æ¿å»ºé€ è·³æ°´æ¿ã€‚æœ‰ä¸¤ç§ç±»å‹çš„æœ¨æ¿ï¼Œå…¶ä¸­é•¿åº¦è¾ƒçŸ­çš„æœ¨æ¿é•¿åº¦ä¸º`shorter`ï¼Œé•¿åº¦è¾ƒé•¿çš„æœ¨æ¿é•¿åº¦ä¸º`longer`ã€‚ä½ å¿…é¡»æ­£å¥½ä½¿ç”¨`k`å—æœ¨æ¿ã€‚ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œç”Ÿæˆè·³æ°´æ¿æ‰€æœ‰å¯èƒ½çš„é•¿åº¦ã€‚\n\nè¿”å›çš„é•¿åº¦éœ€è¦ä»å°åˆ°å¤§æ’åˆ—ã€‚\n\n**ç¤ºä¾‹ï¼š**\n\n```go\nè¾“å…¥ï¼š\nshorter = 1\nlonger = 2\nk = 3\nè¾“å‡ºï¼š {3,4,5,6}\n```\n\n**æç¤ºï¼š**\n\n*   0 < shorter <= longer\n*   0 <= k <= 100000\n\n**è§£æ³•ä¸€**\n\ntagé‡Œé¢æœ‰é€’å½’ï¼Œè®°å¿†åŒ–ä»€ä¹ˆçš„ã€‚ã€‚ã€‚åŠ ä¸Šçœ‹è§ç¾¤å‹çš„è®¨è®ºï¼Œåˆå…ˆå…¥ä¸ºä¸»äº†ï¼Œå”‰ï¼Œå†™äº†åŠå¤©çš„å›æº¯ï¼Œæƒ³ç€æ€ä¹ˆå»é‡ï¼Œçªç„¶æ„è¯†åˆ°ç›´æ¥ä¸€ä¸ªå¾ªç¯å°±èƒ½è§£å†³äº†ã€‚ã€‚ã€‚èœå•Š\n```golang\nfunc divingBoard(shorter int, longer int, k int) []int {\n Â  Â if k == 0{\n Â  Â  Â  Â return []int{}\n Â   }\n Â  Â if shorter == longer{\n Â  Â  Â  Â return []int{ k * shorter}\n Â   }\n Â  Â var res []int\n Â  Â for i := 0; i <= k; i++{\n Â  Â  Â  Â res = append(res, i * longer + (k - i) * shorter)\n Â   }\n Â  Â return res\n}\n```\n\n## [NC82.è‹¹æœæ ‘](https://www.nowcoder.com/practice/145b8d917c1e44c0b2b2462433b3029d?tpId=110&&tqId=33503&rp=1&ru=/ta/job-code&qru=/ta/job-code/question-ranking)\nç‰›ç‰›æœ‰ä¸€ä¸ªè‹¹æœå›­ã€‚åˆåˆ°äº†ä¸€å¹´ä¸€åº¦çš„æ”¶è·å­£ï¼Œç‰›ç‰›ç°åœ¨è¦å»é‡‡æ‘˜è‹¹æœä¹°ç»™å¸‚åœºçš„æ‘Šè´©ä»¬ã€‚\nç‰›ç‰›çš„æœå›­é‡Œé¢æœ‰næ£µè‹¹æœæ ‘ï¼Œç¬¬iæ£µè‹¹æœæ ‘ä¸Šæœ‰a[i]ä¸ªæœå­ã€‚\nç‰›ç‰›ä¸ºäº†ä¿è¯æœå­çš„æ–°é²œç¨‹åº¦ï¼Œæ¯å¤©éƒ½ä¼šå»è‹¹æœæ ‘ä¸Šé‡‡æ‘˜æœå­ã€‚\nç‰›ç‰›ç‰¹æ„å®‰æ’ä¸€ä¸ªè®¡åˆ’è¡¨ï¼š\n\nè®¡åˆ’må¤©å»é‡‡æ‘˜æœå­ã€‚å¯¹äºç¬¬iå¤©ï¼Œå®ƒä¼šå»æ‰€æœ‰æœæ ‘ä¸Šè½®æµé‡‡æ‘˜b[i]ä¸ªæœå­ã€‚\nå¦‚æœå¯¹äºç¬¬iå¤©ï¼ŒæŸæ£µæœæ ‘ä¸Šæ²¡æœ‰b[i]ä¸ªæœå­ï¼Œé‚£ä¹ˆå®ƒåªä¼šæŠŠå½“å‰æœæ ‘ä¸Šçš„æœå­é‡‡æ‘˜å®Œã€‚\n\nç‰›ç‰›æƒ³çŸ¥é“å®ƒæ¯å¤©èƒ½ä¾›åº”å¤šå°‘ä¸ªè‹¹æœç»™å¸‚åœºçš„æ‘Šè´©ä»¬ã€‚\n\n**è¾“å…¥**\n\n- 1 <= a[i] , b[i] <= 1e9\n- 1 <= len(a), len(b) <= 1e5\n\n**ç¤ºä¾‹1**\n```go\nè¾“å…¥ : [10,20,10],[5,7,2]\nè¾“å‡º : [15,17,2]\nè¯´æ˜ :\nè‹¹æœæ ‘ä¸Šçš„æœå­å˜åŒ–[10,20,10]-->[5,15,5]-->[0,8,0]-->[0,6,0]\n```\n\n**è§£æ³•ä¸€**\n\nåœ¨ç‰›å®¢çœ‹è§æ˜¯å¤´æ¡äºŒé¢çš„ä¸€é“é¢˜ï¼Œæ‰¾åˆ°äº†ç‰›å®¢å¯¹åº”çš„é¢˜ç›®ï¼Œå°è¯•äº†ä¸‹ï¼Œé¦–å…ˆå†™äº†æ¥¼ä¸»çš„ å‰ç¼€å’Œ+äºŒåˆ†çš„è§£æ³•\n\nå¾ˆå¯æƒœé€šè¿‡ç‡0ï¼ŒæŠ¥é”™çš„æ•°æ®å¾ˆå¤§ï¼Œä¸€çœ‹å°±çŸ¥é“æº¢å‡ºäº†\n```java\n//å‰ç¼€å’Œ+äºŒåˆ†çš„åšæ³•ï¼ˆå®¹æ˜“æº¢å‡ºï¼Œrandomç¨å¾®è°ƒå¤§ç‚¹å°±æº¢å‡ºäº†ï¼Œè¿‡ä¸äº†OJï¼‰\npublic static long[] solve2 (int[] a, int[] b) {\n    if(a==null || a.length==0){\n        return new long[0];\n    }\n    // write code here\n    Arrays.sort(a);\n    int d = b.length;\n    int al = a.length;\n    long sum = 0;\n    long[] preSum = new long[al];\n    preSum[0] = a[0];\n    for(int i = 1; i < al; i++){\n        preSum[i] = preSum[i-1] + a[i];\n    }\n    long[] res = new long[d];\n    int sb = 0;\n    for(int i = 0; i < d; i++){\n        sb += b[i];\n        int idx = search(a, sb);\n        if(idx == -1){\n            res[i] = sb * al - sum;\n        }else{\n            res[i] = preSum[idx] + sb * (al-idx-1) - sum;\n        }\n        sum += res[i];\n    }\n    return res;\n}\n\n//å°äºtargetçš„æœ€åä¸€ä¸ª\npublic static int search(int[] a, int target){\n    int left = 0;\n    int right = a.length-1;\n    int res = -1;\n    while(left <= right){\n        int mid = left + (right - left)/2;\n        if(a[mid] < target){\n            res = mid;\n            left = mid + 1;\n        }else{\n            right = mid - 1;\n        }\n    }\n    return res;\n}\n```\n**è§£æ³•äºŒ**\n\nåŒæŒ‡é’ˆçš„è§£æ³•ï¼Œè¿˜æ˜¯å¾ˆå·§å¦™çš„ï¼Œè¿™é¢˜å¦‚æœè€ƒè™‘å»å‡æ‰æ¯æ£µæ ‘çš„æœå­å…¶å®å°±èµ°è¿œäº†ï¼Œé‚£æ ·æ—¶é—´å¤æ‚åº¦è‚¯å®šæ˜¯O(N^2)çš„ï¼Œå…¶å®æˆ‘ä»¬å®Œå…¨ä¸ç”¨æ¯æ¬¡éƒ½æŠŠæœå­çš„æ•°é‡ç»™å‡æ‰ï¼Œé¦–å…ˆæˆ‘ä»¬å¯¹æœæ ‘è¿›è¡Œæ’åºï¼Œè¿™æ ·æ–¹ä¾¿è¿›è¡ŒåŒºé—´çš„æ‘˜å–ï¼Œå¯¹æ•´ä½“åˆ†åŒºå˜ä¸º `æ— å‰©ä½™ | å‰©ä½™ä¸è¶³ | å‰©ä½™è¶³å¤Ÿ`ä¸‰ä¸ªåŒºé—´\n\næ¯æ¬¡æ‘˜å–éƒ½æ˜¯å°†å‰nå¤©çš„åˆå¹¶èµ·æ¥ä¸€èµ·æ‘˜ï¼Œç„¶åçœ‹**å‰©ä½™ä¸è¶³**å’Œ**å‰©ä½™è¶³å¤Ÿ**åˆ†ç•Œçº¿åœ¨å“ªé‡Œï¼Œå‰©ä½™ä¸è¶³çš„éƒ¨åˆ†å°±ç›´æ¥åŠ èµ·æ¥ï¼Œç„¶åå‡å»å‰`n-1`å¤©åœ¨è¯¥æœæ ‘ä¸Šé‡‡æ‘˜çš„æ•°é‡ï¼Œå¾—åˆ°å°±æ˜¯å‰©ä¸‹çš„å½“å¤©å¯ä»¥é‡‡æ‘˜çš„æ•°é‡ï¼Œä¹‹åè¿™éƒ¨åˆ†**å‰©ä½™ä¸è¶³**çš„å°±å˜æˆäº†**æ— å‰©ä½™**\n\næœ€åï¼Œåœ¨åˆ†ç•Œçº¿ä»¥åçš„éƒ¨åˆ†å°±éƒ½æ˜¯å‰©ä½™è¶³å¤Ÿçš„éƒ¨åˆ†ï¼Œç›´æ¥ä¹˜æ³•è®¡ç®—å°±è¡Œäº†ï¼ˆå°å¿ƒæº¢å‡ºï¼‰\n\n```java\n//æ­£è§£ åŒæŒ‡é’ˆï¼Œæ—¶é—´å¤æ‚åº¦O(m+n)\npublic static long[] solve (int[] a, int[] b) {\n    Arrays.sort(a);\n    int p = 0;\n    int sb = 0;\n    long[] res = new long[b.length];\n    for (int i = 0; i < b.length; i++) {\n        sb += b[i];\n        while(p < a.length && a[p] < sb){\n            //è¯¥æœæ ‘æœå­ä¸å¤Ÿäº†ï¼Œæ‹¿å–å‰©ä¸‹æ‰€æœ‰çš„\n            res[i] += (a[p] - (sb - b[i]));\n            //ä¸‹ä¸€é¢—æœæ ‘\n            p++;\n        }\n        //åé¢çš„éƒ½å¤Ÿ\n        res[i]+=(a.length - p) * (long)b[i];\n    }\n    return res;\n}\n```\n> å…¶å®å’Œè§£æ³•ä¸€çš„æ€è·¯ç±»ä¼¼ï¼Œä½†æ˜¯è¿™ç§åšæ³•ä¸è€ƒè™‘æº¢å‡ºä¸”æ—¶é—´å¤æ‚åº¦æ›´ä½\n\n## [453. æœ€å°ç§»åŠ¨æ¬¡æ•°ä½¿æ•°ç»„å…ƒç´ ç›¸ç­‰](https://leetcode-cn.com/problems/minimum-moves-to-equal-array-elements/)\n\nDifficulty: **ç®€å•**\n\n\nç»™å®šä¸€ä¸ªé•¿åº¦ä¸º _n_ çš„**éç©º**æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°è®©æ•°ç»„æ‰€æœ‰å…ƒç´ ç›¸ç­‰çš„æœ€å°ç§»åŠ¨æ¬¡æ•°ã€‚æ¯æ¬¡ç§»åŠ¨å°†ä¼šä½¿ _n_ - 1 ä¸ªå…ƒç´ å¢åŠ  1ã€‚\n\n**ç¤ºä¾‹:**\n\n```go\nè¾“å…¥:\n[1,2,3]\n\nè¾“å‡º:\n3\n\nè§£é‡Š:\nåªéœ€è¦3æ¬¡ç§»åŠ¨ï¼ˆæ³¨æ„æ¯æ¬¡ç§»åŠ¨ä¼šå¢åŠ ä¸¤ä¸ªå…ƒç´ çš„å€¼ï¼‰ï¼š\n\n[1,2,3]  =>  [2,3,3]  =>  [3,4,3]  =>  [4,4,4]\n```\n\n**è§£æ³•ä¸€**\n\nn-1ä¸ªå…ƒç´ +1ï¼Œå°±ç›¸å½“äº1ä¸ªå…ƒç´ -1ï¼Œæ€ç»´çš„è½¬æ¢ï¼Œé¢˜ç›®å°±å˜å¾—ç®€å•äº†\n```golang\nfunc minMoves(nums []int) int {\n Â  Â var min = math.MaxInt32\n Â  Â for i := 0; i < len(nums); i++ {\n Â  Â  Â  Â if nums[i] < min {\n Â  Â  Â  Â  Â  Â min = nums[i]\n Â  Â  Â   }\n Â   }\n Â  Â var res = 0\n Â  Â for i := 0; i < len(nums); i++ {\n Â  Â  Â  Â res += (nums[i]-min)\n Â   }\n Â  Â return res\n}\n```\n\n## [696. è®¡æ•°äºŒè¿›åˆ¶å­ä¸²](https://leetcode-cn.com/problems/count-binary-substrings/)\n\nDifficulty: **ç®€å•**\n\n\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²Â `s`ï¼Œè®¡ç®—å…·æœ‰ç›¸åŒæ•°é‡0å’Œ1çš„éç©º(è¿ç»­)å­å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œå¹¶ä¸”è¿™äº›å­å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰0å’Œæ‰€æœ‰1éƒ½æ˜¯ç»„åˆåœ¨ä¸€èµ·çš„ã€‚\n\né‡å¤å‡ºç°çš„å­ä¸²è¦è®¡ç®—å®ƒä»¬å‡ºç°çš„æ¬¡æ•°ã€‚\n\n**ç¤ºä¾‹ 1 :**\n\n```golang\nè¾“å…¥: \"00110011\"\nè¾“å‡º: 6\nè§£é‡Š: æœ‰6ä¸ªå­ä¸²å…·æœ‰ç›¸åŒæ•°é‡çš„è¿ç»­1å’Œ0ï¼šâ€œ0011â€ï¼Œâ€œ01â€ï¼Œâ€œ1100â€ï¼Œâ€œ10â€ï¼Œâ€œ0011â€ å’Œ â€œ01â€ã€‚\n\nè¯·æ³¨æ„ï¼Œä¸€äº›é‡å¤å‡ºç°çš„å­ä¸²è¦è®¡ç®—å®ƒä»¬å‡ºç°çš„æ¬¡æ•°ã€‚\n\nå¦å¤–ï¼Œâ€œ00110011â€ä¸æ˜¯æœ‰æ•ˆçš„å­ä¸²ï¼Œå› ä¸ºæ‰€æœ‰çš„0ï¼ˆå’Œ1ï¼‰æ²¡æœ‰ç»„åˆåœ¨ä¸€èµ·ã€‚\n```\n\n**ç¤ºä¾‹ 2 :**\n\n```golang\nè¾“å…¥: \"10101\"\nè¾“å‡º: 4\nè§£é‡Š: æœ‰4ä¸ªå­ä¸²ï¼šâ€œ10â€ï¼Œâ€œ01â€ï¼Œâ€œ10â€ï¼Œâ€œ01â€ï¼Œå®ƒä»¬å…·æœ‰ç›¸åŒæ•°é‡çš„è¿ç»­1å’Œ0ã€‚\n```\n\n**æ³¨æ„ï¼š**\n\n*   `s.length`Â åœ¨1åˆ°50,000ä¹‹é—´ã€‚\n*   `s`Â åªåŒ…å«â€œ0â€æˆ–â€œ1â€å­—ç¬¦ã€‚\n\n**è§£æ³•ä¸€**\n\nå°†å­—ç¬¦è½¬æ¢ä¸ºè¿ç»­å­—ç¬¦ä¸ªæ•°çš„æ’åˆ—ï¼Œæ¯”å¦‚111100011000-->4323ï¼Œç„¶åæˆ‘ä»¬å°†ç›¸é‚»ä¸¤ä¸ªæ•°çš„æœ€å°å€¼åŠ å…¥ç»“æœé›†å°±è¡Œäº†ï¼Œ3+2+2=7ï¼Œä¸‹é¢çš„è§£æ³•åˆå¹¶äº†ä¸¤æ­¥æ“ä½œ\n```golang\nfunc countBinarySubstrings(s string) int {\n Â  Â var n = len(s)\n Â  Â var last, cur = 0, 0\n Â  Â var res = 0\n Â  Â var Min = func (a, b int) int {if a<b {return a};return b}\n Â  Â var p = 0\n Â  Â for p < n {\n Â  Â  Â  Â c := s[p]\n Â  Â  Â  Â for p < n && s[p] == c {\n Â  Â  Â  Â  Â  Â p++\n Â  Â  Â  Â  Â  Â cur++\n Â  Â  Â   }\n Â  Â  Â  Â res += Min(cur, last)\n Â  Â  Â  Â last = cur\n Â  Â  Â  Â cur = 0\n Â   }\n Â  Â return res\n}\n```\n\n## [844. æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/backspace-string-compare/)\n\nDifficulty: **ç®€å•**\n\nç»™å®š <code>S</code> å’Œ <code>T</code> ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå½“å®ƒä»¬åˆ†åˆ«è¢«è¾“å…¥åˆ°ç©ºç™½çš„æ–‡æœ¬ç¼–è¾‘å™¨åï¼Œåˆ¤æ–­äºŒè€…æ˜¯å¦ç›¸ç­‰ï¼Œå¹¶è¿”å›ç»“æœã€‚ <code>#</code> ä»£è¡¨é€€æ ¼å­—ç¬¦ã€‚</p>\n\n<p>\n\nç»™å®š `S` å’Œ `T` ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå½“å®ƒä»¬åˆ†åˆ«è¢«è¾“å…¥åˆ°ç©ºç™½çš„æ–‡æœ¬ç¼–è¾‘å™¨åï¼Œåˆ¤æ–­äºŒè€…æ˜¯å¦ç›¸ç­‰ï¼Œå¹¶è¿”å›ç»“æœã€‚ `#` ä»£è¡¨é€€æ ¼å­—ç¬¦ã€‚\n\n**æ³¨æ„**ï¼šå¦‚æœå¯¹ç©ºæ–‡æœ¬è¾“å…¥é€€æ ¼å­—ç¬¦ï¼Œæ–‡æœ¬ç»§ç»­ä¸ºç©ºã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```go\nè¾“å…¥ï¼šS = \"ab#c\", T = \"ad#c\"\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šS å’Œ T éƒ½ä¼šå˜æˆ â€œacâ€ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```go\nè¾“å…¥ï¼šS = \"ab##\", T = \"c#d#\"\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šS å’Œ T éƒ½ä¼šå˜æˆ â€œâ€ã€‚\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```go\nè¾“å…¥ï¼šS = \"a##c\", T = \"#a#c\"\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šS å’Œ T éƒ½ä¼šå˜æˆ â€œcâ€ã€‚\n```\n\n**ç¤ºä¾‹ 4ï¼š**\n\n```go\nè¾“å…¥ï¼šS = \"a#c\", T = \"b\"\nè¾“å‡ºï¼šfalse\nè§£é‡Šï¼šS ä¼šå˜æˆ â€œcâ€ï¼Œä½† T ä»ç„¶æ˜¯ â€œbâ€ã€‚\n```\n\n**æç¤ºï¼š**\n\n1.  `1 <= S.length <= 200`\n2.  `1 <= T.length <= 200`\n3.  `S` å’Œ `T` åªå«æœ‰å°å†™å­—æ¯ä»¥åŠå­—ç¬¦ `'#'`ã€‚\n\n**è¿›é˜¶ï¼š**\n\n*   ä½ å¯ä»¥ç”¨ `O(N)` çš„æ—¶é—´å¤æ‚åº¦å’Œ `O(1)` çš„ç©ºé—´å¤æ‚åº¦è§£å†³è¯¥é—®é¢˜å—ï¼Ÿ\n\n\n\n**è§£æ³•ä¸€**\n\nOï¼ˆNï¼‰ç©ºé—´çš„å°±ä¸å†™äº†ï¼Œéšä¾¿ææå°±è¡Œäº†ï¼Œå…³é”®æ˜¯O(1)ç©ºé—´çš„è§£æ³•ï¼Œè¿™é‡Œæ ¸å¿ƒå°±æ˜¯åŒæŒ‡é’ˆä»åæƒ³å‰æ‰«æï¼Œç„¶åæ³¨æ„è¾¹ç•Œå°±okäº†\n```java\npublic boolean backspaceCompare(String S, String T) {\n    int i = S.length()-1;\n    int j = T.length()-1;\n    while (i >= 0 || j >= 0) {\n        i = back(S, i);\n        j = back(T, j);\n        //éƒ½åŒ¹é…å®Œäº†\n        if (i < 0 && j < 0) {\n            return true;\n        }\n        //åªæœ‰ä¸€ä¸ªåŒ¹é…å®Œäº†ï¼Œä¸¤ä¸ªå¯¹ä½å­—ç¬¦ä¸åŒ¹é…\n        if (i < 0 || j < 0 || S.charAt(i) != T.charAt(j)) {\n            return false;\n        }\n        i--; j--;\n    }\n    //éƒ½åŒ¹é…å®Œäº†\n    return i < 0 && j < 0;\n}\n\npublic int back(String s, int i) {\n    if (i < 0 || s.charAt(i) != '#') {\n        return i;\n    }\n    int cnt = 0;\n    while (i >= 0) {\n        if (s.charAt(i) == '#') {\n            cnt++;\n        } else {\n            if (cnt==0) break;\n            cnt--;\n        }\n        i--;\n    }\n    return i;\n}\n```","tags":["LeetCode","æ•°ç»„"],"categories":["ç®—æ³•"]},{"title":"JNIåˆæ¢","url":"/2019/05/02/jni-chu-tan/","content":"\n## JNIç®€ä»‹\n\n> JNIæ˜¯**Java Native Interface**çš„ç¼©å†™ï¼Œå®ƒæä¾›äº†è‹¥å¹²çš„APIå®ç°äº†Javaå’Œå…¶ä»–è¯­è¨€çš„é€šä¿¡ï¼ˆä¸»è¦æ˜¯[C](https://baike.baidu.com/item/C/7252092)&[C++](https://baike.baidu.com/item/C%2B%2B)ï¼‰ã€‚ä»Java1.1å¼€å§‹ï¼ŒJNIæ ‡å‡†æˆä¸ºjavaå¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸Javaä»£ç å’Œå…¶ä»–è¯­è¨€å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚JNIä¸€å¼€å§‹æ˜¯ä¸ºäº†æœ¬åœ°å·²ç¼–è¯‘è¯­è¨€ï¼Œå°¤å…¶æ˜¯Cå’ŒC++è€Œè®¾è®¡çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å¦¨ç¢ä½ ä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œåªè¦è°ƒç”¨çº¦å®šå—æ”¯æŒå°±å¯ä»¥äº†ã€‚ä½¿ç”¨javaä¸æœ¬åœ°å·²ç¼–è¯‘çš„ä»£ç äº¤äº’ï¼Œé€šå¸¸ä¼šä¸§å¤±å¹³å°å¯ç§»æ¤æ€§ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹è¿™æ ·åšæ˜¯å¯ä»¥æ¥å—çš„ï¼Œç”šè‡³æ˜¯å¿…é¡»çš„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸€äº›æ—§çš„åº“ï¼Œä¸ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œæˆ–è€…ä¸ºäº†æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚JNIæ ‡å‡†è‡³å°‘è¦ä¿è¯æœ¬åœ°ä»£ç èƒ½å·¥ä½œåœ¨ä»»ä½•Java è™šæ‹Ÿæœºç¯å¢ƒã€‚\n\nç›¸ä¿¡å¤§å®¶åœ¨çœ‹æºç çš„æ—¶å€™éƒ½çœ‹è§è¿‡ç”¨**native**ä¿®é¥°çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°±æ˜¯ç”¨C/C++è¯­è¨€å®ç°çš„ï¼Œé‚£åˆ°åº•javaæ˜¯å¦‚ä½•è°ƒç”¨çš„è¿™äº›æ–¹æ³•çš„å‘¢ï¼Ÿ\n\n## ä¸Šæ‰‹\n\n**å‡†å¤‡å·¥ä½œ**\n\n> æ–‡ä¸­ç¯å¢ƒä¸ºLinuxä¸‹Centos6ç‰ˆæœ¬\n\nâœ… é¦–å…ˆéœ€è¦æœ‰`JDK`(æˆ‘çš„æ˜¯jdk1.7)ï¼Œç¼–è¯‘java\n\nâœ… ç„¶åéœ€è¦`gcc` ç”¨æ¥ç¼–è¯‘C/C++\n\n**Javaä»£ç **\n\n```java\npublic class JniTest {\n\n    public static void main(String[] args) {\n        new JniTest().hi();\n    }\n\t\n    static {\n        //åŠ è½½ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“\n        System.loadLibrary(\"jniTest\");\n    }\n\n    private native void hi();\n}\n```\n\nåœ¨é™æ€ä»£ç å—é‡Œé¢åŠ è½½äº†ä¸€ä¸ª[åŠ¨æ€é“¾æ¥åº“](https://baike.baidu.com/item/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93%E6%96%87%E4%BB%B6)\n\nç¼–å†™å®Œä¹‹åç›´æ¥`javac JniTest.java`ç¼–è¯‘ä¸€ä¸‹ï¼Œç„¶åæ‰§è¡Œ`javah -jni  JniTest`ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª`JniTest.h`çš„å¤´æ–‡ä»¶å¦‚ä¸‹\n\n```c\n/* DO NOT EDIT THIS FILE - it is machine generated */\n#include <jni.h>\n/* Header for class JniTest */\n\n#ifndef _Included_JniTest\n#define _Included_JniTest\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n/*\n * Class:     JniTest\n * Method:    hi\n * Signature: ()V\n */\nJNIEXPORT void JNICALL Java_JniTest_hi\n  (JNIEnv *, jobject);\n\n#ifdef __cplusplus\n}\n#endif\n#endif\n```\n\n**Cä»£ç **\n\n```java\n#include<stdio.h>\n#include \"JniTest.h\"\n#include <jni.h>\n//è¿™ä¸€æ®µæ¥è‡ªä¸Šé¢çš„å¤´æ–‡ä»¶\nJNIEXPORT void JNICALL Java_JniTest_hi\n  (JNIEnv *env, jobject o){\n        printf(\"you  successfully called the c code\\n\");\n}\n```\n\n- `JNIEnv*`ï¼šç”¨äºå¼•ç”¨JNIç¯å¢ƒï¼Œè¯¥æŒ‡é’ˆå˜é‡å¯ä»¥è®¿é—®æ‰€æœ‰JNIå‡½æ•°\n- `jobject`ï¼šå¼•ç”¨`this` Javaå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç”¨æ¥è®¿é—®å½“å‰javaè°ƒç”¨è€…\n\nå†™å®Œä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç¼–è¯‘å®ƒ\n\n```java\ngcc -fPIC -D_REENTRANT  -I\"$JAVA_HOME/include\"  -I\"$JAVA_HOME/include/linux\" -c JniTest.c\n```\n\nä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª`JniTest.o`çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\n\nç„¶åæ‰§è¡Œ\n\n`gcc -shared JniTest.o -o libjniTest.so`\n\næ³¨æ„`linux`ä¸ŠåŠ¨æ€é“¾æ¥åº“å¿…é¡»ä»¥`lib`å¼€å¤´ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯`libjniTest`åé¢çš„æ˜¯å‰é¢`java`ä»£ç ä¸­åŠ è½½çš„å“ªä¸ªåŠ¨æ€é“¾æ¥åº“åç§°`jniTest`ï¼Œæœ€åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª`libjniTest.so`çš„åŠ¨æ€åº“\n\n**æ‰§è¡Œ**\n\né¦–å…ˆç»™`libjniTest.so`èµ‹äºˆå¯æ‰§è¡Œæƒé™\n\n`chmod 777 libjniTest.so`\n\nå› ä¸ºæˆ‘è¿™é‡Œæ²¡æœ‰è®¾ç½®`java.library.path`æ‰€ä»¥éœ€è¦åœ¨è¿è¡Œçš„æ—¶å€™åŠ ä¸Šè·¯å¾„\n\n`java -Djava.library.path=/usr/jnitest JniTest`\n\n**ç»“æœ**\n\n![mark](http://static.imlgw.top///20190502/rKdNPEwUmstf.png?imageslim)\n\n>  ç¯‡æ–‡ç« ä¸­åªæ˜¯ç®€å•çš„è°ƒç”¨äº†Cè¯­è¨€çš„ä»£ç ï¼Œå…³äºå¦‚ä½•ä¼ é€’å‚æ•°ï¼Œå¦‚ä½•è¿”å›å€¼ï¼Œåé¢é‡åˆ°ä¹‹å†åšè®°å½•","tags":["JNI"],"categories":["JVM"]},{"title":"Volatileå…³é”®å­—è¯¦è§£","url":"/2019/04/29/volatile-guan-jian-zi/","content":"\n## JMM&CPUç¼“å­˜\n\n### CPUç¼“å­˜\n\nå…¶å®è¿™ä¸ªå¹¶ä¸æ˜¯æŒ‡æŸä¸€ä¸ªå…·ä½“çš„éƒ¨ä»¶ï¼Œ`å¯„å­˜å™¨(Register)`ï¼Œ`é«˜é€Ÿç¼“å­˜(Cache)`ï¼Œ`å†™ç¼“å†²å™¨(Store Buffer)`ï¼Œ`æ— æ•ˆåŒ–é˜Ÿåˆ—(Invalidate Queue)`ç­‰ç­‰éƒ½å¯ä»¥ç§°ä¸º CPUç¼“å­˜ã€‚\n\n#### ä¸ºä»€ä¹ˆè¦æœ‰CPUç¼“å­˜ï¼Ÿ\n\n`ç¼“å­˜`é€šå¸¸æ„ä¹‰ä¸‹éƒ½æ˜¯ä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œè¿™é‡ŒåŒæ ·ä¹Ÿæ˜¯ï¼Œå› ä¸ºCPUçš„é€Ÿåº¦æ¯”`ä¸»å†…å­˜(RAM)`å¿«å¾ˆå¤šï¼Œ`ä¸»å†…å­˜`ä¼šæ‹–CPUåè…¿å½±å“æ•´ä½“çš„æ•ˆç‡ï¼Œæ‰€ä»¥ç¼“å­˜å°±å‡ºç°äº†ï¼Œç¼“å­˜çš„é€Ÿåº¦æ¯”`ä¸»å†…å­˜`å¿«å¾ˆå¤š(é€ ä»·é«˜)CPUä¼šç›´æ¥é€šè¿‡ç¼“å­˜æ¥å¯¹ä¸»å†…å­˜è¿›è¡Œè¯»å†™æ“ä½œï¼Œæ‰€ä»¥ç¼“å­˜é‡Œé¢å®é™…ä¸Šç›¸å½“äºæ˜¯`ä¸»å†…å­˜`çš„å‰¯æœ¬ã€‚\n\n#### ä½¿ç”¨CPUç¼“å­˜å¸¦æ¥çš„é—®é¢˜\n\næ­£å¸¸æƒ…å†µä¸‹CPUæ‰§è¡Œè®¡ç®—çš„è¿‡ç¨‹å¦‚ä¸‹\n\n1ï¸âƒ£ç¨‹åºä»¥åŠæ•°æ®è¢«åŠ è½½åˆ°ä¸»å†…å­˜\n\n2ï¸âƒ£æŒ‡ä»¤å’Œæ•°æ®è¢«åŠ è½½åˆ°CPUç¼“å­˜\n\n3ï¸âƒ£CPUæ‰§è¡ŒæŒ‡ä»¤ï¼ŒæŠŠç»“æœå†™åˆ°é«˜é€Ÿç¼“å­˜\n\n4ï¸âƒ£é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å†™å›ä¸»å†…å­˜\n\nå¦‚æœæ˜¯å•æ ¸CPUï¼Œä¸Šé¢çš„æ­¥éª¤æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†å¦‚æœæ˜¯å¤šæ ¸CPUå°±å¯èƒ½ä¼šå‡ºç°ä¸€äº›æ„æ–™ä¹‹å¤–çš„é—®é¢˜ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªæ ¸\n\nä¸‹é¢è¿™ç§æƒ…å†µä¹Ÿæ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„\n\n1ï¸âƒ£æ ¸0è¯»å–äº†ä¸€ä¸ªå­—èŠ‚ï¼Œæ ¹æ®å±€éƒ¨æ€§åŸç†ï¼Œå®ƒç›¸é‚»çš„å­—èŠ‚åŒæ ·è¢«è¢«è¯»å…¥æ ¸0çš„ç¼“å­˜\n\n2ï¸âƒ£æ ¸1åšäº†ä¸Šé¢åŒæ ·çš„å·¥ä½œï¼Œè¿™æ ·æ ¸0ä¸æ ¸1çš„ç¼“å­˜æ‹¥æœ‰åŒæ ·çš„æ•°æ®\n\n3ï¸âƒ£æ ¸0ä¿®æ”¹äº†é‚£ä¸ªå­—èŠ‚ï¼Œè¢«ä¿®æ”¹åï¼Œé‚£ä¸ªå­—èŠ‚è¢«å†™å›æ ¸0çš„ç¼“å­˜ï¼Œä½†æ˜¯è¯¥ä¿¡æ¯å¹¶æ²¡æœ‰å†™å›ä¸»å­˜\n\n4ï¸âƒ£æ ¸1è®¿é—®è¯¥å­—èŠ‚ï¼Œç”±äºæ ¸0å¹¶æœªå°†æ•°æ®å†™å›ä¸»å­˜ï¼Œæ•°æ®ä¸åŒæ­¥\n\n#### è§£å†³æ–¹æ¡ˆ\n\nğŸ”¶LOCK# æ€»çº¿é”ï¼Œæ•ˆç‡å¾ˆä½ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªCPUå¯¹å†…å­˜æ“ä½œï¼Œå…¶ä»–çš„CPUåªèƒ½å¹²ç­‰ç€\n\nğŸ”¶ç¼“å­˜ä¸€è‡´æ€§`åè®®`ï¼Œç¼“å­˜ä¸€è‡´æ€§åè®®æœ‰å¤šç§ï¼Œ`MESI`åè®®æ˜¯å½“å‰æœ€ä¸»æµçš„ç¼“å­˜ä¸€è‡´æ€§åè®®\n\n![MESIçŠ¶æ€](http://static.imlgw.top///20190411/GYdTPdVBGCQB.png?imageslim)æ—¥å¸¸å¤„ç†çš„å¤§å¤šæ•°è®¡ç®—æœºè®¾å¤‡éƒ½å±äº`å—…æ¢(snooping)`åè®®ï¼ŒCPUç¼“å­˜ä¸ä»…ä»…åœ¨åšå†…å­˜ä¼ è¾“çš„æ—¶å€™æ‰ä¸æ€»çº¿æ‰“äº¤é“ï¼Œè€Œæ˜¯ä¸åœåœ¨å—…æ¢æ€»çº¿ä¸Šå‘ç”Ÿçš„æ•°æ®äº¤æ¢ï¼Œè·Ÿè¸ªå…¶ä»–ç¼“å­˜åœ¨åšä»€ä¹ˆã€‚æ‰€ä»¥å½“ä¸€ä¸ªç¼“å­˜ä»£è¡¨å®ƒæ‰€å±çš„å¤„ç†å™¨å»`è¯»å†™å†…å­˜`æ—¶ï¼Œå…¶å®ƒå¤„ç†å™¨éƒ½ä¼šå¾—åˆ°é€šçŸ¥ï¼Œå®ƒä»¬ä»¥æ­¤æ¥ä½¿è‡ªå·±çš„ç¼“å­˜ä¿æŒåŒæ­¥ã€‚åªè¦æŸä¸ªå¤„ç†å™¨ä¸€`å†™å†…å­˜`ï¼Œå…¶å®ƒå¤„ç†å™¨é©¬ä¸ŠçŸ¥é“è¿™å—å†…å­˜åœ¨å®ƒä»¬çš„ç¼“å­˜æ®µä¸­`å·²å¤±æ•ˆ(Invaid)`ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æœ‰å¤„ç†å™¨æƒ³`è¯»å†…å­˜`(ä¼šè¢«ç«‹å³å¯Ÿè§‰åˆ°ï¼Œå› ä¸ºä¸€ç›´åœ¨å—…æ¢æ€»çº¿)ï¼Œé‚£ä¹ˆå·²ä¿®æ”¹çš„ç¼“å­˜è¡Œ(Cache line)å°±ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å­˜ä¸­ï¼Œç„¶åè®¾ç½®ä¸º`Share`çŠ¶æ€ï¼Œè¿™æ ·ä¸€æ¥è¯»å–åˆ°çš„æ•°æ®å°±ä¸æ˜¯è„æ•°æ®äº†ã€‚\n\nå†æ”¾ä¸€å¼  å¤„ç†å™¨&ç¼“å­˜&ä¸»å†…å­˜äº¤äº’çš„å›¾ï¼ˆæ¥è‡ªç»„æˆåŸç†ä¹¦ä¸Šçš„å›¾ï¼‰\n\n![CacheåŸºæœ¬ç»“æ„](http://static.imlgw.top///20190415/lJzPTl3yQWBn.jpg?imageslim)\n\næ—¢ç„¶æœ‰äº†MESIåè®®ï¼Œæ˜¯ä¸æ˜¯å°±ä¸éœ€è¦volatileçš„å¯è§æ€§è¯­ä¹‰äº†ï¼Ÿå½“ç„¶ä¸æ˜¯\n\n- **å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶æ¶æ„éƒ½æä¾›äº†ç›¸åŒçš„ä¸€è‡´æ€§ä¿è¯ï¼ŒJVMéœ€è¦volatileç»Ÿä¸€è¯­ä¹‰**ï¼ˆå°±ç®—æ˜¯MESIï¼Œä¹Ÿåªè§£å†³CPUç¼“å­˜å±‚é¢çš„é—®é¢˜ï¼Œæ²¡æœ‰æ¶‰åŠå…¶ä»–å±‚é¢ï¼‰ã€‚\n- å¯è§æ€§é—®é¢˜ä¸ä»…ä»…å±€é™äºCPUç¼“å­˜å†…ï¼ŒJVMè‡ªå·±ç»´æŠ¤çš„`å†…å­˜æ¨¡å‹`ä¸­ä¹Ÿæœ‰å¯è§æ€§é—®é¢˜ã€‚ä½¿ç”¨volatileåšæ ‡è®°ï¼Œå¯ä»¥è§£å†³JVMå±‚é¢çš„å¯è§æ€§é—®é¢˜ã€‚\n- [è¿™ä¸ªå›ç­”åº”è¯¥å¾ˆå¥½çš„è§£é‡Šäº†](https://www.zhihu.com/question/277395220) å¤§æ¦‚å°±æ˜¯ç¼“å­˜ä¸€è‡´æ€§åè®®å¹¶ä¸èƒ½ä¿è¯å®æ—¶æ€§ï¼Œè€Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¿è¯ä¸¥æ ¼çš„å®æ—¶æ€§\n\n### Javaå†…å­˜æ¨¡å‹(JMM)\n\n> ä¸ºäº†å±è”½å„ä¸ªæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„å·®å¼‚ï¼Œä½¿å¾— Java ç¨‹åºåœ¨æ‰€æœ‰å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœï¼Œæ‰€ä»¥ Java è™šæ‹Ÿæœºå®šä¹‰äº†ä¸€ç§ Java å†…å­˜æ¨¡å‹ã€‚\n\nJavaå†…å­˜æ¨¡å‹(å³Java Memory Modelï¼Œç®€ç§°JMM)æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ç»„è§„åˆ™æˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„è§„èŒƒå®šä¹‰äº†ç¨‹åºä¸­å„ä¸ªå˜é‡ï¼ˆåŒ…æ‹¬å®ä¾‹å­—æ®µï¼Œé™æ€å­—æ®µå’Œæ„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ ï¼‰çš„è®¿é—®æ–¹å¼ã€‚ï¼ˆè¿™é‡Œçš„å˜é‡ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡å’Œæ–¹æ³•å‚æ•°ï¼Œå› ä¸ºé‚£æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸ä¼šäº§ç”Ÿç«äº‰ï¼‰\n\nJava è™šæ‹Ÿæœºè§„å®šæ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œçº¿ç¨‹ï¼ˆWork Memory æœ‰äº›åœ°æ–¹ç§°ä¸ºçº¿ç¨‹æ ˆï¼‰ã€‚\n\nçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œæ˜¯åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œé¦–å…ˆè¦å°†å˜é‡ä»ä¸»å†…å­˜æ‹·è´çš„è‡ªå·±çš„å·¥ä½œå†…å­˜ç©ºé—´ï¼Œç„¶åå¯¹å˜é‡è¿›è¡Œæ“ä½œï¼Œæ“ä½œå®Œæˆåå†å°†å˜é‡å†™å›ä¸»å†…å­˜ï¼Œè€Œä¸èƒ½ç›´æ¥å¯¹ä¸»å†…å­˜çš„å˜é‡è¿›è¡Œè¯»å–èµ‹å€¼ã€‚\n\nä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œéœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥è¿›è¡Œä¼ é€’ã€‚\n\n![JMM](http://static.imlgw.top///20190411/PjL8vV724vXx.png?imageslim)\n\nï¼ˆæ¥è‡ª [zejian](https://blog.csdn.net/javazejian/article/details/72772461)ï¼‰\n\nå·¥ä½œå†…å­˜å®é™…ä¸Šå°±æ˜¯å¯¹ä¸Šé¢**CPUç¼“å­˜**çš„æŠ½è±¡ã€‚\n\n#### å†…å­˜é—´äº¤äº’\n\nJava å†…å­˜æ¨¡å‹å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’æ“ä½œã€‚\nreadï¼šæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ä¸­\nloadï¼šåœ¨ read ä¹‹åæ‰§è¡Œï¼ŒæŠŠ read å¾—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­\nuseï¼šæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“\nassignï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡\nstoreï¼šæŠŠå·¥ä½œå†…å­˜çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­\nwriteï¼šåœ¨ store ä¹‹åæ‰§è¡Œï¼ŒæŠŠ store å¾—åˆ°çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­\nlockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡\nunlockï¼šå¯¹åº”lock\n\n**JMM**è¿˜å®šä¹‰äº†ä¸€äº›å…³äº`happens-before`å…³ç³»çš„è§„åˆ™å¦‚ä¸‹\n\n- ä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œç¼–å†™åœ¨å‰é¢çš„å‘ç”Ÿåœ¨ç¼–å†™åœ¨åé¢çš„ã€‚\n\n- unlock å¿…é¡»å‘ç”Ÿåœ¨lockä¹‹å\n\n- volatile ä¿®é¥°çš„ å†™æ“ä½œå…ˆå‘ç”Ÿåœ¨è¯»ä¹‹å‰\n\n- ä¼ é€’è§„åˆ™ ï¼ŒA å…ˆäºB Bå…ˆäºC Aè‚¯å®šå…ˆäºC\n\n- çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼Œstartè‚¯å®šç°åœºå‘ç”Ÿä¸run\n\n- çº¿ç¨‹ä¸­æ–­æ–¹æ³•ï¼Œinterrupt å¿…é¡»å‘ç”Ÿåœ¨æ•è·ä¹‹å‰\n\n- å¯¹è±¡çš„åˆå§‹åŒ–å¿…é¡»å‘ç”Ÿåœ¨finalizeå‰\n\n- çº¿ç¨‹ç»ˆç»“è§„åˆ™ï¼Œæ‰€æœ‰æ“ä½œéƒ½å‘ç”Ÿåœ¨çº¿ç¨‹æ­»äº¡å‰\n\n[å‚è€ƒ](https://www.logicbig.com/tutorials/core-java-tutorial/java-multi-threading/happens-before.html)\n\n## Volatileå¹²äº†ä»€ä¹ˆï¼Ÿ\n\n### ä¿è¯å¯è§æ€§\n\nè¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„Demoã€‚\n\n```java\n//çº¿ç¨‹1\nboolean stop = false;\nwhile(!stop){\n    //doSomething();\n}\n \n//çº¿ç¨‹2\nstop = true;\n```\n\nå…¶å®åœ¨ä¸Šä¸€ç¯‡ [Javaå¤šçº¿ç¨‹åŸºç¡€](<http://imlgw.top/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/>) é‡Œé¢ \"ä¼˜é›…çš„ç»“æŸçº¿ç¨‹\" é‡Œé¢æœ‰ç±»ä¼¼çš„ä»£ç \n\n![mark](http://static.imlgw.top///20190428/LQuwmhuMiwxp.png?imageslim)\n\nå½“æ—¶æ²¡æœ‰è¯´æ˜ä¸ºå•¥è¦åŠ `Volatile`ï¼Œå…¶å®è¿™é‡Œä¸Šé¢çš„ä»£ç å¦‚æœä¸ç»™çŠ¶æ€é‡åŠ ä¸Š `volatile`  å¹¶ä¸”ç”¨`server`æ¨¡å¼è¿è¡Œæœ‰å¯èƒ½å°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œå³ä½¿åœ¨ä¸»çº¿ç¨‹é‡Œé¢å°†`isCancel`ä¿®æ”¹ä¸º`true`ä»ç„¶æ— æ³•ç»“æŸï¼Œçº¿ç¨‹é™·å…¥äº†æ­»å¾ªç¯ï¼Œæ°¸è¿œæ— æ³•åœæ­¢ï¼ï¼!ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿï¼Ÿï¼Ÿ\n\n![mark](http://static.imlgw.top///20190410/nCcFbqyGiqIz.png?imageslim)\n\nğŸ”¸ åœ¨`server`æ¨¡å¼ä¸‹JITå¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ç”¨serveræ¨¡å¼è¿è¡Œçš„åŸå› ï¼Œ**Client VMçš„ç¼–è¯‘å™¨æ²¡æœ‰åƒServer VMä¸€æ ·æ‰§è¡Œè®¸å¤šå¤æ‚çš„ä¼˜åŒ–ç®—æ³•**ï¼‰ã€‚å®ƒä¼šå°†ä»£ç ä¼˜åŒ–ä¸ºç±»ä¼¼ä¸‹é¢è¿™æ ·çš„æ•ˆæœ\n\n```java\nif(!stop){\n \twhile (stop){\n\t\t//do something....\n \t}\n}\n```\n\n`JIT`è®¤ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…é‡å¤çš„è¯»å–çŠ¶æ€å˜é‡`stop`å°±å°†ä»£ç è¿›è¡Œäº† [å¾ªç¯ä¸å˜è¡¨è¾¾å¼å¤–æ](https://zh.wikipedia.org/wiki/%E5%BE%AA%E7%8E%AF%E4%B8%8D%E5%8F%98%E4%BB%A3%E7%A0%81%E5%A4%96%E6%8F%90)ï¼ˆwikipediaï¼‰ï¼Œè€Œè¿™æ°æ°å¯¼è‡´äº†æ­»å¾ªç¯\n\nğŸ”¸å¦ä¸€æ–¹é¢ï¼Œä¹Ÿå’Œè®¡ç®—æœºçš„å‚¨å­˜ç³»ç»Ÿæœ‰å…³ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢`CPUç¼“å­˜`çš„é—®é¢˜ä¸­æåˆ°çš„ï¼Œè¿™é‡Œ `stop`å°±æ˜¯å…±äº«å˜é‡ï¼Œå½“çº¿ç¨‹â‘ å’Œâ‘¡è¿è¡Œçš„æ—¶å€™å…ˆå°†ä¸»å†…å­˜çš„`stop`æ‹·è´äº†ä¸€ä»½åˆ°`å·¥ä½œå†…å­˜`ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†`stop`çš„å€¼ä½†æ˜¯å…¶ä»–çš„çº¿ç¨‹æ— æ³•æ„ŸçŸ¥åˆ°è¿™ä¸ªå˜åŒ–å°±å¯èƒ½ä¼šé™·å…¥æ­»å¾ªç¯ã€‚\n\nğŸ“¢ `volatile`åœ¨è¿™é‡Œèµ·åˆ°çš„ä½œç”¨å°±æ˜¯\n\nâ‘  é˜»æ­¢`JIT`çš„å¼‚å¸¸ä¼˜åŒ–\n\nâ‘¡ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†`volatile`ä¿®é¥°çš„å…±äº«å˜é‡åä¼š**ç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜**å½“ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º_å†²åˆ·å¤„ç†å™¨ç¼“å­˜_ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨è¯»`voaltile`ä¿®é¥°çš„å˜é‡å°±ä¼šä½¿ç›¸åº”çš„å¤„ç†å™¨**å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¿›è¡ŒåŒæ­¥**ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸º_åˆ·æ–°å¤„ç†å™¨ç¼“å­˜_ï¼Œä»è€Œä¿è¯äº†å¯è§æ€§ï¼Œé€šä¿—çš„è®²å°±æ˜¯`è¯»å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¯»ï¼Œå†™å¿…é¡»åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­`ã€‚\n\n### ä¿è¯æœ‰åºæ€§\n\n**é‡æ’åº**\n\næåˆ°æœ‰åºæ€§å°±ä¸å¾—ä¸è¯´é‡æ’åºï¼Œå…ˆæ¥çœ‹ä¸€ä¸ª`Demo`\n\n```java\nprivate boolean isReady=false;\n\npublic void writer(){\n    int data=getFromXxx(); //â‘ \n    isReady=true \t\t//â‘¡\n}\n\npublic void reader(){\n    if(isReady){\n        //doSth\n    }\n}\n```\n\nè¿™ä¸€çœ‹ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œwriterçº¿ç¨‹å®Œæˆåå¼€å§‹readï¼Œé—®é¢˜å°±å‡ºæ¥è¿™é‡Œï¼Œ**æœ‰å¯èƒ½dataæ•°æ®è¿˜æ²¡è·å–åˆ°ï¼ŒisReadyå°±å·²ç»æ˜¯trueäº†**ä¹Ÿå°±æ˜¯è¯´â‘¡å’Œâ‘ çš„æ‰§è¡Œäº¤æ¢äº†é¡ºåºï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„**é‡æ’åº**ï¼Œè¿™æ ·çš„é‡æ’åºå°†ä¼šå¯¼è‡´ä¸å¯é¢„çŸ¥çš„é”™è¯¯ï¼Œè€Œå¯¼è‡´è¿™ç§ç°è±¡çš„æ¥æºå¾ˆå¤šï¼Œæ¯”å¦‚ç¼–è¯‘å™¨(JIT)ï¼Œå¤„ç†å™¨å’Œå­˜å‚¨å­ç³»ç»Ÿ(Cache)ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦é‡æ’åºï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†æå‡æ€§èƒ½ï¼Œå½“ç„¶é‡æ’åºå¯¹å•çº¿ç¨‹æ¥è®²æ˜¯æ²¡æœ‰å½±å“çš„(æœ‰å½±å“é‚£è¿˜å¾—äº†ğŸ˜‚)\n\n**å…¶å®ä¸åªæ˜¯ä¸Šé¢é‚£ç§æ¯”è¾ƒæ˜¾è€Œæ˜“è§çš„é‡æ’åºï¼Œè¿˜æœ‰ä¸‹é¢è¿™ç§æ¯”è¾ƒéšå«çš„**\n\n```java\npublic class SingletonObjectPlus {\n    private static  SingletonObjectPlus singletonObjectPlus =null;\n    public static SingletonObjectPlus getSingletonObject3(){\n    \tif(singletonObjectPlus==null){\n        \tsynchronized(SingletonObject.class){\n            \tif(singletonObjectPlus==null){\n                \tsingletonObjectPlus= new SingletonObjectPlus();\n            \t}\n        \t}\n    \t}\n     \treturn singletonObjectPlus;\n\t}\n}\n```\n\nç†Ÿæ‚‰çš„æœ‹å‹å¯èƒ½çœ‹å‡ºæ¥äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªDCLå•ä¾‹ï¼Œé‚£å®ƒæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå®ƒä¹Ÿä¼šè¢«é‡æ’åºä¹ˆï¼Ÿé‚£ä¹ˆä¼šåœ¨å“ªé‡Œé‡æ’åºå‘¢ï¼Ÿ\n\nä¸Šè¿°ä»£ç ç¡®å®æœ‰é—®é¢˜ï¼Œé—®é¢˜åœ¨**new SingletonObjectPlus();**é‡Œé¢ï¼Œå®é™…ä¸Šnewè¿™ä¸ªæ“ä½œå¯ä»¥åˆ’åˆ†ä¸ºå¦‚ä¸‹å¥½å‡ æ­¥\n\n1. åˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´ `objRef=allocate(SingleObjectPlus.class);`\n2. åˆå§‹åŒ–å¼•ç”¨çš„å¯¹è±¡ `invokeConstructor(objRef);`\n3. è®¾ç½®`singletonObjectPlus`æŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€`singletonObjectPlus=objRef`\n\nè€Œè¿™äº›æ­¥éª¤æœ‰å¯èƒ½å°±ä¼šè¢«é‡æ’åºï¼Œæ¯”å¦‚å°†â‘¢æ’åˆ°â‘¡ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆå°±ä¼šè¢«è¿”å›(å·²ç»åˆ†é…ç©ºé—´äº†ï¼Œå°±ä¸ä¸ºnulläº†)ï¼Œè¿™æ ·åœ¨`æœ€å¤–å±‚if`åˆ¤æ–­çš„æ—¶å€™å°±å¯èƒ½ä¼šç›´æ¥è¿”å›ä¸€ä¸ªåˆå§‹åŒ–æœªå®Œæˆçš„å¯¹è±¡\n\n> å‘ç”Ÿè¿™æ ·é‡æ’åºçš„æ¦‚ç‡å¾ˆä½ï¼Œå¹¶ä¸æ˜¯å¿…ç„¶å‡ºç°çš„ï¼Œé‡æ’åºä¹Ÿä¸æ˜¯éšæ„çš„é¡ºåºè°ƒæ•´ï¼Œè€Œæ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å»é‡æ’åºï¼Œä¿è¯ä¸ä¼šå¯¹å•çº¿ç¨‹ç¨‹åºè¿è¡Œç»“æœé€ æˆå½±å“ï¼Œæ˜¾è€Œæ˜“è§ï¼Œå¦‚æœä¸¤æ¡è¯­å¥ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œè‚¯å®šæ˜¯ä¸ä¼šé‡æ’åºçš„ï¼Œå…·ä½“å°±æ˜¯ä¸¤æ¡è¯­å¥è®¿é—®åŒä¸€ä¸ªå˜é‡åœ°å€ï¼Œè‡³å°‘æœ‰ä¸€æ¡ä¸ºå†™æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸¤æ¡æŒ‡ä»¤å°±å­˜åœ¨ä¾èµ–å…³ç³»å°±ä¸ä¼šè¢«é‡æ’åºæ¯”å¦‚ x=1;x=2;è¿™æ ·çš„ å°±ä¸ä¼šè¢«é‡æ’åºã€‚\n\nå…¶å®ä¸Šé¢çš„é—®é¢˜éƒ½å¾ˆå¥½è§£å†³ï¼Œåªè¦åœ¨**isReady**å’Œ**singletonObjectPlus**ä¸ŠåŠ ä¸Š`volatile`å°±okäº†ï¼Œåœ¨è¿™é‡Œvolatileä¼šç¦æ­¢æŒ‡ä»¤çš„é‡æ’åºï¼ˆåº•å±‚é€šè¿‡è°ƒç”¨å¤„ç†å™¨æä¾›çš„å†…å­˜å±éšœï¼‰\n\n### ä¿éšœLong/Doubleå˜é‡å†™çš„åŸå­æ€§\n\nè¿™ä¸€ç‚¹å…¶å®å¾ˆå®¹æ˜“è¢«é—å¿˜ï¼Œå®é™…ä¸ŠJavaå¯¹æ‰€æœ‰é™¤äº†Longå’ŒDoubleçš„å˜é‡çš„**è¯»å†™**æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒ…æ‹¬åŸºç¡€ç±»å‹(byteï¼Œbooleanï¼Œshortï¼Œfloatï¼Œå’Œint)å’Œå¼•ç”¨ç±»å‹ã€‚å› ä¸ºDoubleå’ŒLongç±»å‹çš„å˜é‡ä¼šå ç”¨64ä½ï¼Œå¦‚æœåœ¨`32ä½æœºå™¨`ä¸ŠJVMå¯¹è¿™ç§å˜é‡çš„è¯»å†™å¯èƒ½å°±æ˜¯ä¼šè¢«åˆ†è§£ä¸ºä¸¤ä¸ªæ“ä½œè€Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å°±ä¼šå‡ºç°é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ï¼ŒçŸ¥é“æœ‰è¿™ä¹ˆä¸ªäº‹å°±è¡Œäº†ã€‚åœ¨åŠ ä¸Š`Volatile`ä¹‹åå°±å¯ä»¥ä¿è¯è¯¥æ“ä½œçš„åŸå­æ€§äº†ã€‚\n\n### æ³¨æ„\n\n> volatileåœ¨ä¿éšœå¯è§æ€§çš„æ—¶å€™ä»…ä»…åªèƒ½ä¿éšœèƒ½å¤Ÿè¯»å–åˆ°è¯¥å…±äº«å˜é‡çš„ç›¸å¯¹æ–°å€¼ï¼Œå¯¹äºå¼•ç”¨ç±»å‹å˜é‡å’Œæ•°ç»„ç±»å‹çš„å˜é‡ï¼Œvolatileèƒ½ä¿è¯çš„ä¹Ÿä»…ä»…æ˜¯è¯¥å˜é‡æœ¬èº«çš„å¯è§æ€§ï¼Œè€Œå¯¹äºæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¼•ç”¨ç±»å‹ä¸­çš„å­—æ®µï¼ˆå®ä¾‹å˜é‡ï¼Œé™æ€å˜é‡ï¼‰åˆ™æ— æ³•ä¿è¯å…¶å¯è§æ€§ï¼Œå¯¹äºè¿™äº›å˜é‡å¯è§æ€§çš„ä¿éšœå¯ä»¥åˆ©ç”¨JUCå·¥å…·åŒ…ä¸­çš„`AtomicåŸå­ç±»`ã€‚\n\n## å†…å­˜å±éšœ\n\nå…ˆç®€å•äº†è§£ä¸¤ä¸ªæŒ‡ä»¤ï¼š\n\n- Storeï¼šå°†å¤„ç†å™¨ç¼“å­˜çš„æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ã€‚\n- Loadï¼šå°†å†…å­˜å­˜å‚¨çš„æ•°æ®æ‹·è´åˆ°å¤„ç†å™¨çš„ç¼“å­˜ä¸­ã€‚\n\n| å±éšœç±»å‹            | æŒ‡ä»¤ç¤ºä¾‹                   | è¯´æ˜                                                         |\n| ------------------- | -------------------------- | ------------------------------------------------------------ |\n| LoadLoad Barriers   | Load1;`LoadLoad`;Load2     | è¯¥å±éšœç¡®ä¿Load1æ•°æ®çš„è£…è½½å…ˆäºLoad2åŠå…¶åæ‰€æœ‰è£…è½½æŒ‡ä»¤çš„çš„æ“ä½œ |\n| StoreStore Barriers | Store1;`StoreStore`;Store2 | è¯¥å±éšœç¡®ä¿Store1ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜(ä½¿å…¶å¯¹å…¶ä»–å¤„ç†å™¨å¯è§)çš„æ“ä½œå…ˆäºStore2åŠå…¶åæ‰€æœ‰å­˜å‚¨æŒ‡ä»¤çš„æ“ä½œ |\n| LoadStore Barriers  | Load1;`LoadStore`;Store2   | ç¡®ä¿Load1çš„æ•°æ®è£…è½½å…ˆäºStore2åŠå…¶åæ‰€æœ‰çš„å­˜å‚¨æŒ‡ä»¤åˆ·æ–°æ•°æ®åˆ°å†…å­˜çš„æ“ä½œ |\n| StoreLoad Barriers  | Store1;`StoreLoad`;Load2   | è¯¥å±éšœç¡®ä¿Store1ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜çš„æ“ä½œå…ˆäºLoad2åŠå…¶åæ‰€æœ‰è£…è½½æŒ‡ä»¤çš„æ“ä½œã€‚å®ƒä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤(å­˜å‚¨æŒ‡ä»¤å’Œè®¿é—®æŒ‡ä»¤)å®Œæˆä¹‹å,æ‰æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤ |\n\nStoreLoad BarriersåŒæ—¶å…·å¤‡å…¶ä»–ä¸‰ä¸ªå±éšœçš„æ•ˆæœï¼Œå› æ­¤ä¹Ÿç§°ä¹‹ä¸º`å…¨èƒ½å±éšœ`ï¼ˆmfenceï¼‰ï¼Œæ˜¯ç›®å‰å¤§å¤šæ•°å¤„ç†å™¨æ‰€æ”¯æŒçš„ï¼›ä½†æ˜¯ç›¸å¯¹å…¶ä»–å±éšœï¼Œè¯¥å±éšœçš„å¼€é”€ç›¸å¯¹æ˜‚è´µ\n\n- æŒ‰ç…§å¯è§æ€§åˆ’åˆ†ï¼Œå†…å­˜å±éšœå¯ä»¥åˆ†ä¸º**åŠ è½½å±éšœ**(Load Barrier)ï¼Œå’Œ**å­˜å‚¨å±éšœ**(Store Barrier)\n\n- æŒ‰ç…§æœ‰åºæ€§åˆ’åˆ†å¯åˆ†ä¸º**è·å–å±éšœ**(Acquire Barrier)å’Œ**é‡Šæ”¾å±éšœ**(Release Barrier)\n\nå…·ä½“é‚£ä¸ªå……å½“åŠ è½½å±éšœï¼Œé‚£ä¸ªå……å½“å­˜å‚¨å±éšœï¼Œæˆ‘å¹¶ä¸æƒ³è®¨è®ºï¼Œå„ç§åšå®¢å„ç§èµ„æ–™å„æœ‰å„çš„è¯´æ³•ï¼Œå…¶å®å…³äºç©¶ç«Ÿåº•å±‚æ˜¯å¦‚ä½•å®ç°ï¼Œå¦‚ä½•æ’å…¥ï¼Œæ’å…¥çš„å“ªä¸€ç§è¿™äº›ç»†èŠ‚æˆ‘ä»¬ä¸ç”¨å»å…³å¿ƒï¼Œä¸åŒçš„CPUä¸åŒçš„æ¶æ„å®ç°çš„æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œå¤ªè¿‡æ·±å…¥ä¹Ÿæ²¡æœ‰å¤šå¤§çš„æ„ä¹‰ï¼Œå¾ˆå¤šåšå®¢ä»‹ç»çš„ä¹Ÿ`å®Œå…¨ä¸åŒ`ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“å¤§æ¦‚çš„åŸç†å°±è¡Œäº†ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šå¯ä»¥å‚è€ƒä¸‹åˆ—æ–‡ç« \n\n[èŠèŠåŸå­å˜é‡ã€é”ã€å†…å­˜å±éšœé‚£ç‚¹äº‹](http://www.0xffffff.org/2017/02/21/40-atomic-variable-mutex-and-memory-barrier/)\n\n[ä¸€æ–‡è§£å†³å†…å­˜å±éšœ](https://monkeysayhi.github.io/2017/12/28/%E4%B8%80%E6%96%87%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C/)\n\n[é¢è¯•å¿…é—®çš„volatileï¼Œä½ äº†è§£å¤šå°‘ï¼Ÿ](https://www.jianshu.com/p/506c1e38a922)\n\n[æ·±å…¥ç†è§£ Java å†…å­˜æ¨¡å‹ï¼ˆå››ï¼‰â€”â€”volatile](https://www.infoq.cn/article/java-memory-model-4/?utm_source=infoq&%253Butm_medium=related_content_link&%253Butm_campaign=relatedContent_articles_clk)\n\n### é”ä¸å†…å­˜å±éšœ\n\nç”¨**OneNote**ç”»äº†å‡ å¼ å›¾\n\n![mark](http://static.imlgw.top///20190428/EUPpWHTPnlH8.png?imageslim)\n\n\n\nå®é™…ä¸Šé”å°±æ˜¯é€šè¿‡**å†…å­˜å±éšœ**æ¥ä¿è¯äº†æœ‰åºæ€§å’Œå¯è§æ€§ï¼Œé€šè¿‡**äº’æ–¥æ’å®ƒ**æ¥ä¿è¯äº†åŸå­æ€§\n\n### Volatileå’Œå†…å­˜å±éšœ\n\n**Volatileå†™æ“ä½œå’Œå†…å­˜å±éšœ**\n\n![volatileå˜é‡çš„å†™æ“ä½œ](http://static.imlgw.top///20190428/PImPUeLGqau6.png?imageslim)\n\nğŸ”” å†™çº¿ç¨‹å¯¹äº`volatileå˜é‡çš„å†™æ“ä½œ`ä¼šäº§ç”Ÿç±»ä¼¼äº`é”é‡Šæ”¾`çš„æ•ˆæœã€‚åœ¨å†™å®Œæˆåä¼š`å†²åˆ·å¤„ç†å™¨ç¼“å­˜`å°†ç»“æœç«‹å³åˆ·æ–°åˆ°ä¸»å­˜ä¸­è®©å…¶ä»–å¤„ç†å™¨å¯¹åº”çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œè®©å…¶ä»–å¤„ç†å™¨å¯åŒæ­¥è¯¥æ•°æ®\n\n> volatileå˜é‡åœ¨åŸå­æ€§æ–¹é¢ä»…ä»…ä¿è¯å¯¹è¢«ä¿®é¥°çš„å˜é‡çš„è¯»å†™`æœ¬èº«`çš„åŸå­æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ“ä½œä¸èƒ½æ¶‰åŠä»»ä½•å…±äº«å˜é‡(åŒ…æ‹¬volatileå˜é‡æœ¬èº«)çš„è®¿é—®ï¼Œæ¯”å¦‚ volatile1=volatile2+1ï¼Œvolatile++ è¿™æ ·çš„æ“ä½œæ— æ³•ä¿è¯å®ƒçš„åŸå­æ€§ï¼Œå¦å¤–ï¼Œvoaltileå¯ä»¥ä¿è¯`long`å’Œ`double`å˜é‡åœ¨`32ä½`æœºä¸Šå†™çš„åŸå­æ€§\n\nè¿™é‡Œæˆ‘ä»¬å†å›å¤´çœ‹çœ‹å‰é¢çš„å•ä¾‹çš„ä¾‹å­\n\nâ‘ åˆ†é…å¯¹è±¡æ‰€éœ€çš„ç©ºé—´ objRef=allocate(SingleObjectPlus.class);\n\nâ‘¡åˆå§‹åŒ–å¼•ç”¨çš„å¯¹è±¡ invokeConstructor(objRef);\n\nâ‘¢è®¾ç½®singletonObjectPlusæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ singletonObjectPlus=objRef\n\nè™½ç„¶è¿™é‡Œvolatileå­ä¿è¯äº†å­æ“ä½œâ‘¢çš„åŸå­æ€§ ä½†æ˜¯â‘ â‘¡æ“ä½œåªæ¶‰åŠåˆ°äº†å±€éƒ¨å˜é‡æ²¡æœ‰æ¶‰åŠåˆ°å…±äº«å˜é‡ï¼Œç”±äºå†…å­˜å±éšœçš„ä½œç”¨â‘ â‘¡æ“ä½œä¸å¯èƒ½é‡æ’åºåˆ°â‘¢ä¹‹åï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯åœ¨å¾—åˆ°è¿”å›ä¹‹å‰å¯¹è±¡ä¸€å®šå·²ç»åˆå§‹åŒ–å®Œæ¯•äº†ï¼Œä¸ä¼šå‡ºç°æ²¡åˆå§‹åŒ–å®Œæ¯•å°±è¿”å›çš„æƒ…å†µ\n\n**Volatileè¯»æ“ä½œå’Œå†…å­˜å±éšœ**\n\n![volatileå˜é‡çš„è¯»æ“ä½œ](http://static.imlgw.top///20190428/tJcC98zgp532.png?imageslim)\n\nğŸ”” è¯»çº¿ç¨‹å¯¹äº`volatileå˜é‡çš„è¯»æ“ä½œ`ä¼šäº§ç”Ÿç±»ä¼¼äº`è·å¾—é”`çš„æ•ˆæœã€‚è¯»volatileå˜é‡å‰ä¼šå…ˆ`åˆ·æ–°å¤„ç†å™¨ç¼“å­˜`ä»ä¸»å­˜æˆ–å…¶ä»–å¤„ç†å™¨ç¼“å­˜ä¸­`åŒæ­¥`è¯¥æ•°æ®\n\n> volatileåªèƒ½ä¿è¯è¯»çº¿ç¨‹è¯»åˆ°å…±äº«å˜é‡çš„ç›¸å¯¹æ–°å€¼ï¼Œå¯¹äºå¼•ç”¨ç±»å‹å’Œæ•°ç»„ç±»å‹çš„å¹¶ä¸èƒ½ä¿è¯å®ä¾‹çš„å­—æ®µæˆ–æ•°ç»„çš„å…ƒç´ çš„ç›¸å¯¹æ–°å€¼ï¼Œåªæ˜¯ä¿éšœäº†`å¼•ç”¨åœ°å€`çš„ç›¸å¯¹æ–°å€¼(`ç›¸å¯¹æ–°å€¼`è¡¨ç¤ºè¯»çš„è¿‡ç¨‹ä¸­å…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½æ›´æ”¹äº†è¿™ä¸ªå€¼ï¼Œå¯¹åº”çš„è¿˜æœ‰`æœ€æ–°å€¼`ï¼Œè¯»çš„è¿‡ç¨‹ä¸­å†™çº¿ç¨‹æ— æ³•æ›´æ”¹)\n\n### Volatileå˜é‡çš„å¼€é”€&åœºæ™¯\n\n**å¼€é”€**\n\nvolatileå˜é‡çš„è¯»å†™éƒ½ä¸ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥å¼€é”€æ¯”é”è¦å°ï¼Œä»ä¸Šé¢çš„ä»‹ç»ä¸­å¯ä»¥çœ‹å‡º å†™ä¸€ä¸ªvoaltileä¼šä½¿è¯¥æ“ä½œå’Œè¯¥æ“ä½œå‰çš„æ‰€æœ‰å†™æ“ä½œå¯¹åé¢çš„çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œæ‰€ä»¥å®ƒçš„æˆæœ¬ä¼šæ¯”æ™®é€šå˜é‡å¤§ä¸€äº›ä½†æ˜¯æ¯”é”å°ä¸€ç‚¹ï¼Œè¯»ä¸€ä¸ªvolatileå˜é‡ä¹Ÿä¼šæ¯”é”å°ï¼Œä½†æ˜¯ä¼šæ¯”æ™®é€šå˜é‡å¤§å› ä¸ºå˜é‡éƒ½ä¼šä»å†…å­˜æˆ–å…¶ä»–å¤„ç†å™¨é«˜é€Ÿç¼“å­˜ä¸­å»æ‹¿æ— æ³•ç›´æ¥ä»å¯„å­˜å™¨ä¸­å»æ‹¿ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå¿«äº†ã€‚\n\n**åº”ç”¨åœºæ™¯**\n\nğŸ”¶ ä½¿ç”¨volatileå˜é‡ä½œä¸ºçŠ¶æ€æ ‡å¿—ä½ï¼Œåº”ç”¨ç¨‹åºçš„æŸä¸ªçŠ¶æ€ç”±ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè¯»å–è¯¥çŠ¶æ€ä½œä¸ºåé¢æ“ä½œçš„ä¾æ®ï¼Œæ­¤æ—¶ç”¨volatileä½œä¸ºåŒæ­¥æœºåˆ¶å¥½å¤„å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŠæ—¶\"é€šçŸ¥\"å¦ä¸€ä¸ªçº¿ç¨‹æŸç§äº‹ä»¶(ä¾‹å¦‚æ‰çº¿é‡è¿)è€Œé¿å…ä½¿ç”¨é”é€ æˆè¾ƒå¤§å¼€é”€\n\nğŸ”¶ä½¿ç”¨volatileä¿éšœå¯è§æ€§ï¼Œä¸€ä¸ªçº¿ç¨‹æ›´æ–°äº†å…±äº«å˜é‡å…¶ä»–çº¿ç¨‹æ— éœ€åŠ é”ä¹Ÿå¯ä»¥çœ‹åˆ°è¯¥æ›´æ–°\n\nğŸ”¶volatile beanæ¨¡å¼ï¼ˆä¸‹é¢æ˜¯æˆ‘çš„ä¸ªäººç†è§£å¯ä»¥ç›´æ¥è·³è¿‡ï¼‰\n\n```java\npublic class Person {\n    private volatile String firstName;\n    private volatile String lastName;\n    private volatile int age;\n    \n    public Person(String firstName,String lastName,int age){\n        this.firstName = firstName;\n        this.lastName = lastName;\n        this.age = age;\n    }\n\tpublic String getFirstName() { return firstName; }\n\tpublic String getLastName() { return lastName; }\n\tpublic int getAge() { return age; }\n \n\tpublic void setFirstName(String firstName) { \n    \tthis.firstName = firstName;\n\t}\n \n\tpublic void setLastName(String lastName) { \n    \tthis.lastName = lastName;\n\t}\n \n\tpublic void setAge(int age) { \n    \tthis.age = age;\n\t}\n}\n```\n\nå…³äºè¿™ä¸ªåœºæ™¯çš„æˆ‘ç†è§£çš„å°±æ˜¯ä¼šä¿è¯ç±»ä¼¼volatile Person  preson=new Person(xx,xx,xx,xx);è¿™æ ·çš„æ“ä½œå…·æœ‰å¯è§æ€§æˆ–è€…è¯´å®Œæ•´æ€§ï¼Œä¸ä¼šåˆå§‹åŒ–ä¸€åŠå°±è¿”å›å¯¹è±¡è¦ä¹ˆä¸ºnullè¦ä¹ˆå°±åˆå§‹åŒ–å®Œæ¯•ï¼Œç±»ä¼¼äºä¸Šé¢çš„æåˆ°çš„dclå•ä¾‹çš„ä¾‹å­ã€‚\n\nğŸ”¶ç®€æ˜“è¯»å†™é”\n\nå…è®¸è¯»çº¿ç¨‹è¯»å–çš„æ—¶å€™å†™çº¿ç¨‹è¿›è¡Œæ›´æ–°ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯å®ç°ä¸€ä¸ªè®¡æ•°å™¨å¦‚ä¸‹\n\n```java\npublic class Counter {\n    private volatile int value;\n    public int getValue() { return value; }\n    public synchronized int increment() {\n        return value++;\n    }  \t\n}\n```\n\næƒ³äº†è§£æ›´å¤šå»çœ‹çœ‹IBMè¿™ç¯‡æ–‡ç« [Java ç†è®ºä¸å®è·µ:æ­£ç¡®ä½¿ç”¨ Volatile å˜é‡](https://www.ibm.com/developerworks/cn/java/j-jtp06197.html)\n\n## ä¸€ä¸ªå°é—®é¢˜\n\n![å¯è§æ€§çš„ä¾‹å­](http://static.imlgw.top///20190428/4CYfervOyHH3.png?imageslim)\n\nä¸Šé¢å¯è§æ€§çš„é—®é¢˜ï¼Œå›¾ä¸­çš„ä»£ç å¦‚æœå¾ªç¯é‡Œé¢åŠ ä¸Šå›¾ä¸­æ¡†å†…ç±»ä¼¼çš„ä»£ç ï¼Œä¼šå‘ç°å³ä½¿å…±äº«å˜é‡ä¸Šé¢ä¸åŠ **volatile**ç¨‹åºä¾ç„¶å¯ä»¥æ­£å¸¸é€€å‡ºï¼Œä¸Šé¢å‡ºç°çš„æ­»å¾ªç¯å¹¶æ²¡æœ‰å‡ºç° (æˆ‘çš„JDKç‰ˆæœ¬æ˜¯1.8ï¼Œä¸åŒçš„ç‰ˆæœ¬æƒ…å†µå¯èƒ½ä¸ä¸€æ ·)ï¼Œé‚£æ˜¯ä¸æ˜¯è¯´è¿™äº›æ“ä½œä¹Ÿè¾¾åˆ°äº†ä¿è¯å¯è§æ€§çš„ä½œç”¨å‘¢ï¼Ÿå…¶å®ä»”ç»†åˆ†æè¿™å‡ è¡Œä»£ç ï¼Œåé¢ä¸‰ç§éƒ½ä¼šåˆ·æ–°æˆ–å†²åˆ·å¤„ç†å™¨ç¼“å­˜(printé‡Œé¢ä¹Ÿæ˜¯åŠ é”äº†çš„)ï¼Œæˆ‘ä¸€å¼€å§‹è§‰å¾—å¯èƒ½æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´çš„ï¼Œä½†æ˜¯æŒ‰é“ç†åº”è¯¥æ˜¯åªä¼šä¿è¯åŒæ­¥å—å†…éƒ¨çš„å˜é‡çš„å¯è§æ€§ï¼Œä½†æ˜¯sleepå¹¶æ²¡æœ‰åŠ é”ï¼Œæ˜¯ä¸ªæœ¬åœ°æ–¹æ³•ä¸ºå•¥è¿˜æ˜¯ä¼šå¯¼è‡´è¿™æ ·çš„ç»“æœå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä¹Ÿä¸æƒ³æ·±ç©¶äº†ï¼Œæˆ‘æ„Ÿè§‰ä¹Ÿæ²¡å•¥å¿…è¦äº†ï¼Œå…·ä½“çš„åœºæ™¯ä¸‹è¯¥åŠ **volatile**è¿˜æ˜¯è€è€å®å®åŠ **volatile**ï¼Œå¦‚æœç»§ç»­æ¢ç©¶ä¸‹å¯ä»¥çœ‹ä¸‹[è¿™ç¯‡æ–‡ç«  ](http://www.importnew.com/19434.html)ã€‚\n\n## å‚è€ƒèµ„æ–™\n\n- ã€ŠJavaå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜æŒ‡å—ï¼šæ ¸å¿ƒç¯‡ã€‹\n\n- [javazejian](https://blog.csdn.net/javazejian/article/details/72772461)\n\n- ...","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"CASä¸åŸå­å˜é‡","url":"/2019/04/22/cas-yu-yuan-zi-bian-liang/","content":"\n## CAS\n\n_è¿™ä¸ª**CAS**å¯ä¸æ˜¯å•ç‚¹ç™»é™†çš„é‚£ä¸ªCASğŸ˜„!!!_\n\n> CASï¼ˆCompare-and-Swapï¼‰ï¼Œæ˜¯å¯¹ä¸€ç§å¤„ç†å™¨æŒ‡ä»¤çš„ç§°å‘¼ï¼Œå¾ˆå¤šJavaå¤šçº¿ç¨‹ç›¸å…³çš„ç±»åº“çš„æœ€ç»ˆå®ç°éƒ½ä¼šå€ŸåŠ©CAS\n\nâ€‹\tä»æ‰€å‘¨çŸ¥ï¼Œç±»ä¼¼`i++`è‡ªå¢è¿™æ ·çš„æ“ä½œå¹¶ä¸æ˜¯åŸå­çš„ï¼Œæ˜¯ä¸€ä¸ª`read-modify-write`çš„æ“ä½œ ï¼Œå¦‚æœè¦ä¿è¯è¿™ç§æ“ä½œçš„åŸå­æ€§æŒ‰ç…§ä¹‹å‰çš„åšæ³•å¯ä»¥ä½¿ç”¨`synchronized`å†…éƒ¨é”æ¥è§£å†³ï¼Œä½†æ˜¯è¿™æ ·ä¼¼ä¹æœ‰ç‚¹å¤ªå°é¢˜å¤§åšäº†ï¼Œé”ç¡®å®å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å‰é¢çš„æ–‡ç« ä¹Ÿæåˆ°è¿‡ï¼Œé”æ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½çš„ï¼Œå¹¶ä¸æ˜¯æœ€å¥½çš„åšæ³•ï¼Œæ¯”è¾ƒå¥½çš„åšæ³•å°±æ˜¯**CAS**ï¼Œå®ƒèƒ½å¤Ÿå°†è¿™äº›æ“ä½œè½¬æ¢ä¸ºåŸå­æ“ä½œã€‚\n\nâ€‹\tCompare and Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ç§`if-then-act`çš„æ“ä½œï¼Œè€Œè¿™ä¸ªæ“ä½œçš„åŸå­æ€§ç”±`å¤„ç†å™¨`ä¿è¯(ç¡¬ä»¶é”)ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³è¦å°†å˜é‡Vçš„å€¼ç”±Aå˜ä¸ºBï¼Œå€ŸåŠ©CASå°±ä¼šäº§ç”Ÿç±»ä¼¼ä¸‹é¢ä»£ç çš„ä½œç”¨\n\n```java\nboolean comapreAndSet(Variable V,Object A,Objext B){\n    if(V.get()==A){ //åˆ¤æ–­æ˜¯å¦å’Œå½“å‰Vçš„å€¼ç›¸åŒï¼ˆæ˜¯å¦è¢«ä¿®æ”¹ï¼‰\n        V.set(B);   //æ²¡è¢«ä¿®æ”¹å°±æ›´æ–°\n        return true;\n    }\n    return false; //è¢«ä¿®æ”¹è¿‡å°±ç›´æ¥return\n}\n```\n\nè¿™æ ·ä¸€æ¥å°±æ˜¯å…ˆä¸‹æ‰‹ä¸ºå¼ºäº†ï¼Œå½“ä½ æœ€å…ˆä¿®æ”¹äº†Vçš„å€¼ï¼Œåé¢çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç›´æ¥å¤±è´¥ï¼Œæ‰€ä»¥å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§å¿«é€Ÿå¤±è´¥ç­–ç•¥ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å°è¯•å†æ¬¡è¯·æ±‚ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚\n\n## åŸå­å˜é‡ç±»\n\n_åŸå­å˜é‡ç±»_æ˜¯åŸºäºCASå®ç°çš„ä¸€ç»„ä¿è¯å…±äº«å˜é‡`read-modify-write`æ“ä½œ(ä¾‹å¦‚è‡ªå¢)åŸå­æ€§çš„å·¥å…·ç±»\n\n| åˆ†ç»„         | ç±»                                                           |\n| ------------ | ------------------------------------------------------------ |\n| åŸºç¡€æ•°æ®ç±»å‹ | AtomicIntegerï¼ŒAtomicLongï¼ŒAtomicBoolean                     |\n| æ•°ç»„ç±»       | AtomicIntegerArrayï¼ŒAtomicLongArrayï¼ŒAtomicReferenceArray    |\n| å­—æ®µæ›´æ–°å™¨   | AtomicIntegerFieldUpdaterï¼ŒAtomicLongFieldUpdaterï¼ŒAtomicReferenceFieldUpdater |\n| å¼•ç”¨å‹       | AtomicReferenceï¼ŒAtomicStampedReferenceï¼ŒAtomicMarkableReference |\n\nå…³äºæ€ä¹ˆä½¿ç”¨å°±ä¸å¤šä»‹ç»ï¼ŒAPIä¸Šéƒ½å†™çš„æ˜æ˜ç™½ç™½ï¼Œè¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œæ•°ç»„ç±»å•çº¯çš„GET/SETå¹¶ä¸æ˜¯åŸå­æ“ä½œã€‚\n\n### åˆ©ç”¨CASå†™ä¸€ä¸ªé”\n\n[å‰é¢çš„æ–‡ç« ](http://imlgw.top/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/)  åˆ©ç”¨å†…éƒ¨é”å®ç°è¿‡ä¸€ä¸ª**BooleanLock**ï¼Œè¿™é‡Œåˆ©ç”¨CASå†å®ç°ä¸€ä¸ªç®€æ˜“çš„é”\n\n**getLockException**\n\n```java\npublic class GetLockException extends Exception{\n    public GetLockException(String message) {\n        super(message);\n    }\n\n    public GetLockException() {\n        super();\n    }\n}\n```\n\n**CASLock** \n\n```java\npublic class CASLock {\n    private static final AtomicInteger value = new AtomicInteger();\n\n    private Thread lockedThread;\n\n    public void trylock() throws GetLockException {\n        boolean success = value.compareAndSet(0, 1);\n        if (!success) {\n            throw new GetLockException(\"è·å¾—é”å¤±è´¥\");\n        }\n        lockedThread = Thread.currentThread();\n    }\n\n    public void unlock() {\n        if (0 == value.get()) {\n            return;\n        }\n        if (lockedThread == Thread.currentThread()) {\n            //è§£é“ƒè¿˜é¡»ç³»é“ƒäºº\n            boolean success = value.compareAndSet(1, 0);\n            System.out.println(Thread.currentThread().getName() + \" é‡Šæ”¾äº†é”\");\n        }\n    }\n}\n```\n\nå…¶å®æŒºç®€å•çš„ï¼Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹å°±æ˜¯é‡Šæ”¾é”çš„æ—¶å€™åˆ«å¿˜äº†åˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹åŠ çš„é”ï¼Œè§£é“ƒè¿˜é¡»ç³»é“ƒäººğŸ˜‚\n\n### ABAé—®é¢˜\n\n> ä»æ‰€å‘¨çŸ¥ï¼ŒCASæˆç«‹çš„æ¡ä»¶å°±æ˜¯å…±äº«å˜é‡å½“å‰å€¼å’Œå½“å‰çº¿ç¨‹æ‰€æä¾›çš„æ—§å€¼ç›¸åŒï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¯¹äºä¸€ä¸ªå…±äº«å˜é‡**V**ï¼Œå¦‚æœå½“å‰çº¿ç¨‹çœ‹åˆ°å®ƒçš„æ—¶å€™å®ƒçš„å€¼æ˜¯Aï¼Œå½“å®ƒæƒ³æ‰§è¡ŒCASä¿®æ”¹è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†**V**çš„å€¼ä»A-->B-->Aï¼Œé‚£ä¹ˆè¿™æ—¶å½“å‰çº¿ç¨‹å†æ¥æ‰§è¡ŒCASçš„æ—¶å€™ï¼Œæ˜¯å¦å¯ä»¥è®¤ä¸ºå˜é‡**V**æ²¡æœ‰è¢«ä¿®æ”¹è¿‡å‘¢ï¼Ÿè¿™é‡Œæ‰§è¡Œè‚¯å®šæ˜¯ä¼šæˆåŠŸçš„ï¼Œä½†æ˜¯è¿™æ ·ç»“æœæ˜¯å¦å¯ä»¥æ¥å—å‘¢ ?\n\n#### æ— æ³•æ¥å—çš„ä¾‹å­\n\n![mark](http://static.imlgw.top///20190423/vakfPgUQChGb.png?imageslim)\n\nä¸Šå›¾ä¸ºç”¨**å•é“¾è¡¨**å®ç°çš„æ ˆç»“æ„ï¼Œè‹¥T2å…ˆæŠ¢åˆ°äº†æ‰§è¡Œæƒï¼Œå°†Aï¼ŒBå¼¹å‡ºæ ˆï¼Œç„¶åä¾æ¬¡`push`äº†Dï¼ŒCï¼ŒAï¼Œç„¶åT1æ‰§è¡Œï¼Œåˆ©ç”¨CASï¼Œhead.compareAndSet(Aï¼ŒB)ï¼Œæ‰§è¡ŒæˆåŠŸï¼Œæ ˆé¡¶å˜ä¸ºBï¼Œç„¶è€ŒBå°±æ˜¯ä¸ªå­¤å„¿èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸€æ¥Cï¼ŒDèŠ‚ç‚¹å°±è¢«è«åå…¶å¦™è¢«ä¸¢æ‰äº†è¿™æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„\n\n#### å¦‚ä½•è§£å†³ABAé—®é¢˜\n\nå…¶å®ABAé—®é¢˜å¹¶éå®Œå…¨æ— æ³•æ¥å—ï¼Œè¦è€ƒè™‘å…·ä½“çš„åœºæ™¯ï¼Œå½“ç„¶Javaä¸­ä¹Ÿæä¾›äº†è§£å†³çš„æ–¹æ¡ˆ:\n\n`AtomicStampedReference` è¿™ä¸ªç±»çœ‹åå­—å°±çŸ¥é“æ˜¯å¸¦äº†æˆ³çš„ï¼Œå¸¦äº†ä¸€ä¸ªç±»ä¼¼ç‰ˆæœ¬å·çš„ä¸œè¥¿ï¼Œç›´æ¥ä¸Šæºç å§ã€‚\n\n```java\npublic class AtomicStampedReference<V> {\n    private static class Pair<T> {\n        final T reference;\n        final int stamp;\n        private Pair(T reference, int stamp) {\n            this.reference = reference;\n            this.stamp = stamp;\n        }\n        static <T> Pair<T> of(T reference, int stamp) {\n            return new Pair<T>(reference, stamp);\n        }\n    }\n\n    private volatile Pair<V> pair;\n\n    public AtomicStampedReference(V initialRef, int initialStamp) {\n        pair = Pair.of(initialRef, initialStamp);\n    }\n\n    /**\n     * Returns the current value of the reference.\n     *\n     * @return the current value of the reference\n     */\n    public V getReference() {\n        return pair.reference;\n    }\n\n    public int getStamp() {\n        return pair.stamp;\n    }\n\n    public V get(int[] stampHolder) {\n        Pair<V> pair = this.pair;\n        stampHolder[0] = pair.stamp;\n        return pair.reference;\n    }\n\n    public boolean weakCompareAndSet(V   expectedReference,\n                                     V   newReference,\n                                     int expectedStamp,\n                                     int newStamp) {\n        return compareAndSet(expectedReference, newReference,\n                             expectedStamp, newStamp);\n    }\n\n    /**\n     * Atomically sets the value of both the reference and stamp\n     * to the given update values if the\n     * current reference is {@code ==} to the expected reference\n     * and the current stamp is equal to the expected stamp.\n     *\n     * @param expectedReference the expected value of the reference\n     * @param newReference the new value for the reference\n     * @param expectedStamp the expected value of the stamp\n     * @param newStamp the new value for the stamp\n     * @return {@code true} if successful\n     */\n    public boolean compareAndSet(V   expectedReference,\n                                 V   newReference,\n                                 int expectedStamp,\n                                 int newStamp) {\n        Pair<V> current = pair;\n        return\n            expectedReference == current.reference && //æœŸæœ›å€¼å’Œå½“å‰å€¼ç›¸ç­‰\n            expectedStamp == current.stamp &&\t//æœŸæœ›çš„æˆ³å’Œå½“å‰çš„æˆ³ä¸€è‡´\n            ((newReference == current.reference && //æ–°çš„å€¼æ˜¯ä¸æ˜¯å’Œå½“å‰çš„å€¼ä¸€æ ·\n              newStamp == current.stamp) ||\t\t//æ–°çš„æˆ³æ˜¯ä¸æ˜¯å’Œå½“å‰çš„æˆ³ä¸€æ ·\n             casPair(current, Pair.of(newReference, newStamp))); //å¦‚æœä¸ä¸€æ ·å°±åˆ©ç”¨CASè®¾ç½®æ–°å€¼\n    }\n\n    public void set(V newReference, int newStamp) {\n        Pair<V> current = pair;\n        if (newReference != current.reference || newStamp != current.stamp)\n            this.pair = Pair.of(newReference, newStamp);\n    }\n\n    public boolean attemptStamp(V expectedReference, int newStamp) {\n        Pair<V> current = pair;\n        return\n            expectedReference == current.reference &&\n            (newStamp == current.stamp ||\n             casPair(current, Pair.of(expectedReference, newStamp)));\n    }\n\n    // Unsafe mechanics åº•å±‚è°ƒç”¨unsafeçš„æ–¹æ³•\n    private static final sun.misc.Unsafe UNSAFE = sun.misc.Unsafe.getUnsafe();\n    private static final long pairOffset =objectFieldOffset(UNSAFE, \"pair\", AtomicStampedReference.class);\n    //casè®¾ç½®æ–°å€¼\n    private boolean casPair(Pair<V> cmp, Pair<V> val) {\n        return UNSAFE.compareAndSwapObject(this, pairOffset, cmp, val);\n    }\n\n    static long objectFieldOffset(sun.misc.Unsafe UNSAFE,\n                                  String field, Class<?> klazz) {\n        try {\n            return UNSAFE.objectFieldOffset(klazz.getDeclaredField(field));\n        } catch (NoSuchFieldException e) {\n            // Convert Exception to corresponding Error\n            NoSuchFieldError error = new NoSuchFieldError(field);\n            error.initCause(e);\n            throw error;\n        }\n    }\n}\n```\n\n\nè¿™é‡Œåˆ æ‰äº†éƒ¨åˆ†æ³¨é‡Šï¼Œ å¯ä»¥çœ‹åˆ°é‡Œé¢å°è£…äº†ä¸€ä¸ª`Pair`é‡Œé¢æœ‰å¯¹è±¡çš„å¼•ç”¨å’Œä¸€ä¸ªæˆ³ï¼Œåœ¨è¿›è¡ŒCASçš„æ—¶å€™ä¼šåˆ¤æ–­`æœŸæœ›çš„å¼•ç”¨`ï¼ˆä¼ è¿›æ¥çš„å¼•ç”¨ï¼‰å’Œ`å½“å‰å®é™…çš„å¼•ç”¨`æ˜¯ä¸æ˜¯ä¸€è‡´ï¼Œ`æœŸæœ›çš„æˆ³`ï¼ˆä¼ è¿›æ¥çš„æˆ³ï¼‰å’Œ`å½“å‰å®é™…çš„æˆ³`æ˜¯ä¸æ˜¯ä¸€è‡´çš„ï¼Œä¸ä¸€è‡´å°±ä¼šç›´æ¥`fail`ï¼Œå…³é”®çš„CASä»£ç ï¼š\n\n```java\npublic boolean compareAndSet(V   expectedReference,\n                                 V   newReference,\n                                 int expectedStamp,\n                                 int newStamp) {\n        Pair<V> current = pair;\n        return  \n            expectedReference == current.reference && //æœŸæœ›å€¼å’Œå½“å‰å€¼ç›¸ç­‰\n            expectedStamp == current.stamp &&\t//æœŸæœ›çš„æˆ³å’Œå½“å‰çš„æˆ³ä¸€è‡´\n            ((newReference == current.reference && //æ–°çš„å€¼æ˜¯ä¸æ˜¯å’Œå½“å‰çš„å€¼ä¸€æ ·\n              newStamp == current.stamp) ||\t\t//æ–°çš„æˆ³æ˜¯ä¸æ˜¯å’Œå½“å‰çš„æˆ³ä¸€æ ·\n             casPair(current, Pair.of(newReference, newStamp))); //å¦‚æœä¸ä¸€æ ·å°±åˆ©ç”¨CASè®¾ç½®æ–°å€¼\n }\n```\n\n**æµ‹è¯•AtomicStampedReference**\n\n```java\npublic class AtomicRefStampedTest {\n   static AtomicStampedReference<Integer> reference=new AtomicStampedReference<>(100,0);\n\n    public static void main(String[] args) {\n        //ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒABAæ“ä½œ\n        new Thread(()->{\n            try {\n                TimeUnit.SECONDS.sleep(1);\n                System.out.println(\"t1 \"+reference.compareAndSet(100, 101, reference.getStamp(), reference.getStamp()+1));\n                System.out.println(reference.getStamp()+\",\"+reference.getReference());\n                System.out.println(\"t1 \"+ reference.compareAndSet(101, 100,reference.getStamp() , reference.getStamp()+1));\n            } catch (InterruptedException e) {\n\n            }\n\n        }).start();\n\n\t\t//ç¬¬äºŒä¸ªçº¿ç¨‹ç­‰å¾…ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œ\n        new Thread(()->{\n            try {\n                int stamp = reference.getStamp();\n                //å‡è®¾æ‰§è¡Œåˆ°è¿™é‡Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢\n                System.out.println(\"Before sleep:stamp=\"+stamp);\n                TimeUnit.SECONDS.sleep(5);\n                System.out.println(\"After sleep:stamp=\"+reference.getStamp());\n                boolean b = reference.compareAndSet(100, 101, stamp, stamp + 1);\n                System.out.println(b);\n            } catch (InterruptedException e) {\n\n            }\n        }).start();\n    }\n}\n/**\n\tBefore sleep:stamp=0\n\tt1 true\n\t1,101\n\tt1 true\n\tAfter sleep:stamp=2\n\tfalse\n**/\n```\n\nç»“æœè‚¯å®šæ˜¯t2æ‰§è¡Œå¤±è´¥äº†ï¼Œæ¯•ç«Ÿæˆ³ä¸ä¸€æ ·äº†ï¼Œå°±ç®—å¼•ç”¨ä¸€æ ·ä¹Ÿæ²¡ç”¨ã€‚\n\n#### å°æ’æ›²(Integerç¼“å­˜)\n\nè¿™é‡Œä¸€å¼€å§‹å‘ç”Ÿäº†ä¸€ä¸ªå°æ’æ›²ï¼Œé¦–å…ˆè¿™é‡Œæ˜¯çš„å¼•ç”¨ç±»å‹æ˜¯ `Integer`ç±»å‹çš„ï¼Œç„¶åæˆ‘åœ¨è¿›è¡ŒCASçš„æ—¶å€™ä»100--->200 ,ç„¶ååˆä»200-->100ï¼Œå¯èƒ½ç»†å¿ƒçš„æœ‹å‹å·²ç»çŸ¥é“å•¥é—®é¢˜äº†ï¼Œåé¢çš„ä»200-->100ä¼šå¤±è´¥ï¼Œä¸ºå•¥ï¼Ÿè¿™ä¸ª200å’Œå‰é¢çš„200ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¼•ç”¨ä¸ä¸€æ ·ï¼Œé‚£ä¸ºå•¥101å°±å¯ä»¥å‘¢ï¼Ÿå¯¹ï¼ŒIntegeræœ‰ä¸€ä¸ªç¼“å†²æ± ï¼Œå¤§å°åœ¨-128--127ä¹‹é—´çš„æ•°ï¼Œå¯ä»¥ç›´æ¥ä»ç¼“å†²æ± ä¸­æ‹¿ï¼Œæˆ‘å¼€å§‹åœ¨è¿™é‡Œçº ç»“äº†å¥½ä¸€ä¼šå„¿ğŸ˜‚\n\n### å­—æ®µæ›´æ–°å™¨\n\nå¦‚æœæˆ‘ä»¬åªéœ€è¦æŸä¸ªç±»é‡Œçš„æŸä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´è®©æ™®é€šçš„å˜é‡ä¹Ÿäº«å—åŸå­æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨åŸå­æ›´æ–°å­—æ®µç±»ï¼Œå¦‚åœ¨æŸäº›æ—¶å€™ç”±äºé¡¹ç›®å‰æœŸè€ƒè™‘ä¸å‘¨å…¨ï¼Œé¡¹ç›®éœ€æ±‚åˆå‘ç”Ÿå˜åŒ–ï¼Œä½¿å¾—æŸä¸ªç±»ä¸­çš„å˜é‡éœ€è¦æ‰§è¡Œå¤šçº¿ç¨‹æ“ä½œï¼Œç”±äºè¯¥å˜é‡å¤šå¤„ä½¿ç”¨ï¼Œæ”¹åŠ¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”åŸæ¥ä½¿ç”¨çš„åœ°æ–¹æ— éœ€ä½¿ç”¨çº¿ç¨‹å®‰å…¨ï¼Œåªè¦æ±‚æ–°åœºæ™¯éœ€è¦ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å€ŸåŠ©åŸå­æ›´æ–°å™¨å¤„ç†è¿™ç§åœºæ™¯ï¼ŒJavaä¸­æä¾›äº†å‡ ç§å­—æ®µæ›´æ–°å™¨`AtomicIntegerFieldUpdater`ï¼Œ`AtomicLongFieldUpdater`ï¼Œ`AtomicReferenceFieldUpdater`ï¼Œçœ‹åå­—å°±çŸ¥é“æ˜¯å¯¹åº”å•¥çš„\n\n#### AtomicIntegerFieldUpdateræµ‹è¯•\n\n```java\npublic class AtomicIntegerFieldUpdaterTest {\n    public static void main(String[] args) {\n        AtomicIntegerFieldUpdater updater = AtomicIntegerFieldUpdater.newUpdater(TestUpdate.class, \"num\");\n        TestUpdate testUpdate = new TestUpdate();\n        Stream.of(\"t1\", \"t2\", \"t3\", \"t4\", \"t5\").forEach(s -> {\n            new Thread(() -> {\n                int MAX = 100;\n                for (int i = 0; i < MAX; i++) {\n                    System.out.println(updater.getAndIncrement(testUpdate));\n                }\n            }, s).start();\n        });\n    }\n\n\n    static class TestUpdate {\n        volatile int num;\n    }\n}\n```\n\nè¿™æ ·å°±ä¿è¯äº†Integerå­—æ®µè‡ªå¢æ“ä½œçš„åŸå­æ€§ï¼Œå¦å¤–ä¸¤ä¸ªä¸ä¹‹ç±»ä¼¼ã€‚\n\n**éœ€è¦æ³¨æ„çš„åœ°æ–¹**\n\n- æ“ä½œçš„å­—æ®µä¸èƒ½æ˜¯staticç±»å‹ã€‚\n\n- æ“ä½œçš„å­—æ®µä¸èƒ½æ˜¯finalç±»å‹çš„ï¼Œå› ä¸ºfinalæ ¹æœ¬æ²¡æ³•ä¿®æ”¹ã€‚\n\n- å­—æ®µå¿…é¡»æ˜¯volatileä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯æ•°æ®æœ¬èº«æ˜¯è¯»ä¸€è‡´çš„ã€‚\n\n- å±æ€§å¿…é¡»å¯¹å½“å‰çš„Updateræ‰€åœ¨çš„åŒºåŸŸæ˜¯å¯è§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºä½•æ—¶éƒ½åº”è¯¥ä¿è¯æ“ä½œç±»ä¸è¢«æ“ä½œç±»é—´çš„å¯è§æ€§ã€‚\n\n![mark](http://static.imlgw.top///20190430/hIuzU4rePaAe.png?imageslim)\n\n> ä½¿ç”¨å­—æ®µæ›´æ–°å™¨æ¯”èµ·ç›´æ¥ä½¿ç”¨åŸå­ç±»è¦èŠ‚çº¦å†…å­˜ï¼Œä½†æ˜¯æ“ä½œèµ·æ¥ä¸æ–¹ä¾¿\n\n## UnsafeåŒåˆƒå‰‘\n\n**Unsafe**ç±»ï¼Œçœ‹åå­—å°±çŸ¥é“ä¸å®‰å…¨ï¼Œå¹¶ä¸æ˜¯å®ƒå†™çš„ä¸å®‰å…¨ï¼Œè€Œæ˜¯ç”¨èµ·æ¥ä¸å®‰å…¨ï¼Œå› ä¸ºå®ƒå¯ä»¥åƒc/c++ä¸€æ ·å»æ“ä½œå†…å­˜åœ°å€ï¼Œ**unsafe**é‡Œé¢çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯**native**çš„ï¼Œåº•å±‚éƒ½æ˜¯c/c++å®ç°çš„ï¼Œç›´æ¥ä¸æ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œä¸Šé¢CASæ‰§è¡Œä¹Ÿä¾èµ–äº**unsafe**ç±»ä¸­çš„æ–¹æ³•ï¼Œå…¶å®æ•´ä¸ªå¹¶å‘åŒ…é‡Œçš„ç±»éƒ½ä¾èµ–äº**unsafe**ï¼Œä½†æ˜¯å®˜æ–¹å¹¶ä¸å»ºè®®ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªç±»\n\n- Unsafeæœ‰å¯èƒ½åœ¨æœªæ¥çš„Jdkç‰ˆæœ¬ç§»é™¤æˆ–è€…ä¸å…è®¸Javaåº”ç”¨ä»£ç ä½¿ç”¨ï¼Œè¿™ä¸€ç‚¹å¯èƒ½å¯¼è‡´ä½¿ç”¨äº†Unsafeçš„åº”ç”¨æ— æ³•è¿è¡Œåœ¨é«˜ç‰ˆæœ¬çš„Jdk\n- Unsafeçš„ä¸å°‘æ–¹æ³•ä¸­å¿…é¡»æä¾›åŸå§‹åœ°å€(å†…å­˜åœ°å€)å’Œè¢«æ›¿æ¢å¯¹è±¡çš„åœ°å€ï¼Œåç§»é‡è¦è‡ªå·±è®¡ç®—ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜å°±æ˜¯JVMå´©æºƒçº§åˆ«çš„å¼‚å¸¸ï¼Œä¼šå¯¼è‡´æ•´ä¸ªJVMå®ä¾‹å´©æºƒï¼Œè¡¨ç°ä¸ºåº”ç”¨ç¨‹åºç›´æ¥å´©æ‰ã€‚\n- Unsafeæä¾›çš„ç›´æ¥å†…å­˜è®¿é—®çš„æ–¹æ³•ä¸­ä½¿ç”¨çš„å†…å­˜ä¸å—JVMç®¡ç†(æ— æ³•è¢«GC)ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼Œä¸€æ—¦å‡ºç°ç–å¿½å¾ˆæœ‰å¯èƒ½æˆä¸ºå†…å­˜æ³„æ¼çš„æºå¤´ã€‚\n\n### è·å–Unsafe\n\n```java\n    //è·å–Unsafe\n    public static Unsafe getUnsafe() {\n        Field f = null;\n        try {\n            f = Unsafe.class.getDeclaredField(\"theUnsafe\");\n            f.setAccessible(true);\n            return (Unsafe)f.get(null);\n        } catch (Exception e) {\n            throw new RuntimeException();\n        }\n    }\n```\n\n### CASç›¸å…³\n\nJavaä¸­çš„CASå®ç°è°ƒç”¨çš„å°±æ˜¯ä¸‰ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨çš„å°±æ˜¯å®ä¾‹å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨éœ€è¦CASå­—æ®µåœ¨è¯¥å®ä¾‹ä¸Šçš„åç§»é‡ï¼ˆä¸ç”¨è‡ªå·±è®¡ç®—ï¼ŒUnsafeæä¾›äº†æ–¹æ³•è®¡ç®—åç§»é‡ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯æœŸæœ›å€¼ï¼Œæœ€åä¸€ä¸ªå‚æ•°å°±æ˜¯æ›´æ–°çš„å€¼\n\n```java\npublic final native boolean compareAndSwapObject(Object var1, long var2, Object var4, Object var5);\n\npublic final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5);\n\npublic final native boolean compareAndSwapLong(Object var1, long var2, long var4, long var6);\n```\n\n### åˆ©ç”¨Unsafeè‡ªå·±å†™ä¸€ä¸ªåŸå­Counter\n\n```java\nclass CASCounter implements Counter {\n    private volatile long counter = 0;\n\n    public CASCounter() throws NoSuchFieldException {\n        unsafe = getUnsafe();\n        //è·å–counterå­—æ®µçš„å†…å­˜åç§»é‡\n        offset= unsafe.objectFieldOffset(CASCounter.class.getDeclaredField(\"counter\"));\n        System.out.println(offset);\n    }\n\t\n    private Unsafe unsafe;\n    private long offset;\n    \n    public static Unsafe getUnsafe() {\n        Field f = null;\n        try {\n            f = Unsafe.class.getDeclaredField(\"theUnsafe\");\n            f.setAccessible(true);\n            return (Unsafe)f.get(null);\n        } catch (Exception e) {\n            throw new RuntimeException();\n        }\n    }\n\n    @Override\n    public void increment() {\n        long current=counter;\n        while (!unsafe.compareAndSwapLong(this,offset,current,current+1)){\n            current=counter;\n        }\n    }\n\n    @Override\n    public long getCounter() {\n        return counter;\n    }\n}\n\ninterface Counter {\n    void increment();\n\n    long getCounter();\n}\n```\n\n### Unsafeçš„éªšæ“ä½œ\n\n**ç»•è¿‡æ„é€ å™¨åˆ›å»ºå¯¹è±¡**\n\n```java\npublic class UnsafeFooTest {\n    public static void main(String[] args) throws ClassNotFoundException,InstantiationException, NoSuchFieldException {\n        Unsafe unsafe = UnsafeTest.getUnsafe();\n        //ç»•è¿‡æ„é€ å™¨åˆ›å»ºå¯¹è±¡\n        Simple simple = (Simple) unsafe.allocateInstance(Simple.class);\n        System.out.println(simple.get()); //null\n        System.out.println(simple.getClass().getClassLoader());\n    }\n\n    static class Simple {\n        private String a = \"a\";\n        public Simple() {\n            a = \"new\";\n            System.out.println(\"============== \");\n        }\n\n        public String get() {\n            return a;\n        }\n        static {\n            System.out.println(\"é™æ€ä»£ç å—\");\n        }\n    }\n}\n```\n\n**ä¿®æ”¹å­—æ®µåœ¨å†…å­˜ä¸­çš„å€¼**\n\n```java\npublic class UnsafeFooTest {\n    public static void main(String[] args) throws ClassNotFoundException, InstantiationException, NoSuchFieldException {\n        Unsafe unsafe = UnsafeTest.getUnsafe();\n        Permission permission = new Permission();\n        permission.doSth();\n        //é€šè¿‡åå°„ä¹Ÿå¯ä»¥åšåˆ°ï¼Œä½†æ˜¯unsafeç›´æ¥æ˜¯åˆ°å†…å­˜åœ°å€ä¸­å°†å€¼ä¿®æ”¹äº†\n        Field access_allow = permission.getClass().getDeclaredField(\"ACCESS_ALLOW\");\n        //è·å–å­—æ®µå†å¯¹è±¡ä¸­çš„å†…å­˜åç§»é‡ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæŒ‡é’ˆï¼ˆå†…å­˜åœ°å€ï¼‰\n        unsafe.putLong(permission,unsafe.objectFieldOffset(access_allow),-1);\n        permission.doSth();\n    }\n}\n\nclass Permission {\n    private int ACCESS_ALLOW = 0;\n\n    private boolean isAllow() {\n        return  ACCESS_ALLOW==-1;\n    }\n\n    public void doSth() {\n        if (isAllow()) {\n            System.out.println(\"i am workind\");\n        }\n    }\n}\n```\n\n**defindClassåŠ è½½ç±»æ–‡ä»¶**\n\n```java\npublic class UnsafeFooTest {\n\n    public static void main(String[] args) throws ClassNotFoundException, InstantiationException, NoSuchFieldException, IllegalAccessException, NoSuchMethodException, InvocationTargetException {\n        Unsafe unsafe = UnsafeTest.getUnsafe();\n        byte[] bytes = loadClassContent();\n        Class<?> aClass = unsafe.defineClass(null, bytes, 0, bytes.length, ClassLoader.getSystemClassLoader(), null);\n        int get = (int) aClass.getMethod(\"get\").invoke(aClass.newInstance(), null);\n        System.out.println(get);\n    }\n    \n    //å°†classå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­\n    public static byte[] loadClassContent() {\n        File f = new File(\"D:\\\\ClassLoaderTest\\\\Res.class\");\n        FileInputStream stream = null;\n        byte[] bytes=null;\n        try {\n            stream = new FileInputStream(f);\n             bytes = new byte[(int) f.length()];\n            stream.read(bytes);\n            stream.close();\n        } catch (FileNotFoundException e) {\n            e.printStackTrace();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return bytes;\n    }\n}\n```\n\nå°†ç¼–è¯‘å¥½çš„classæ–‡ä»¶æ”¾åˆ°å¯¹åº”çš„ç›®å½•ä¸‹\n\n```java\npublic class Res {\n    private int i=0;\n\n    public Res(){\n        this.i=1;\n    }\n\n    public int get() {\n        return i;\n    }\n}\n```\n\n**ç»“æœ**ï¼Œæ˜¯ä¸æ˜¯å¾ˆç‰›çš®ï¼ŸğŸ‚ğŸºæ˜¯ğŸ‚ğŸºä½†æ˜¯è¿™ä¸ªç©æ„å°½é‡çš„åˆ«ç”¨ã€‚ã€‚\n\n![mark](http://static.imlgw.top/blog/20190720/zLJJUhQ6GAdc.png?imageslim)\n\n**Unsafe**é‡Œé¢çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šè¿™é‡Œå°±ä¸éƒ½åˆ—ä¸¾äº†ï¼Œæ¯•ç«Ÿæš‚æ—¶è¿˜ç”¨ä¸åˆ°ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šå¯ä»¥çœ‹çœ‹è¿™å‡ ç¯‡æ–‡ç« \n\n- [JAVAä¸­ç¥å¥‡çš„åŒåˆƒå‰‘--Unsafe](https://www.cnblogs.com/throwable/p/9139947.html)\n\n- [Rå¤§å…³äºUnsafeçš„ä½¿ç”¨å»ºè®®](https://www.zhihu.com/question/29266773?sort=created)\n\n- [Javaé­”æ³•ç±»ï¼šUnsafeåº”ç”¨è§£æ](https://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.html)","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"Javaå¤šçº¿ç¨‹ä¹‹è®¾è®¡æ¨¡å¼","url":"/2019/04/09/java-duo-xian-cheng-li-mian-de-she-ji-mo-shi/","content":"\n## è§‚å¯Ÿè€…æ¨¡å¼\n\n>  è§‚å¯Ÿè€…è®¢é˜…è¢«è§‚å¯Ÿè€…çš„çŠ¶æ€ï¼Œå½“è¢«è§‚å¯Ÿè€…çŠ¶æ€æ”¹å˜çš„æ—¶å€™ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…çš„è§‚å¯Ÿè€…çš„è¿‡ç¨‹\n\n**è§‚å¯Ÿè€…æ¥å£**\n\n```java\npublic  abstract class Observer {\n    protected Subject subject;\n\n    public Observer(Subject subject){\n        this.subject=subject;\n        subject.attach(this);\n    }\n\n    public  abstract  void update();\n}\n```\n\n**è§‚å¯Ÿè€…1**\n\n```java\npublic class BinaryObserver extends Observer{\n\n    public BinaryObserver(Subject subject) {\n        super(subject);\n    }\n\n    @Override\n    public void update() {\n        System.out.println(\"Binarry String :\"+ Integer.toBinaryString(subject.getState()));\n    }\n}\n```\n\n**è§‚å¯Ÿè€…2**\n\n```java\npublic class OctalOberver extends Observer{\n    public OctalOberver(Subject subject) {\n        super(subject);\n    }\n\n    @Override\n    public void update() {\n        System.out.println(\"Octal String:\"+Integer.toOctalString(subject.getState()));\n    }\n}\n```\n\n**è¢«è§‚å¯Ÿè€…**\n\n```java\npublic class Subject {\n    //è§‚å¯Ÿè€…ä»¬\n    private  List<Observer> observers = new ArrayList<>();\n\n    private int state;\n\n    public int getState(){\n        return this.state;\n    }\n\t\n    //æ³¨å†Œè§‚å¯Ÿè€…\n    public void attach(Observer observer){\n        observers.add(observer);\n    }\n\n    public void setState(int state){\n        if(state==this.state){\n            return;\n        }\n        this.state=state;\n        notifyAllObserver();\n    }\n    //é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çº¿ç¨‹\n    private  void  notifyAllObserver(){\n        observers.stream().forEach(Observer::update);\n    }\n}\n```\n\n**æµ‹è¯•**\n\n```java\npublic class ObserverCLi {\n    public static void main(String[] args) {\n        final Subject subject=new Subject();\n        BinaryObserver binary=new BinaryObserver(subject);\n        OctalOberver octalOberver = new OctalOberver(subject);\n        System.out.println(\"==================\");\n        subject.setState(10);\n        System.out.println(\"==================\");\n        subject.setState(12);\n    }\n}\n```\n\n## è¯»å†™é”åˆ†ç¦»æ¨¡å¼\n\n```java\npublic class ReadWriteLock {\n    private int readingR = 0;\n    private int waitingR = 0;\n    private int writingW = 0;\n    private int waitingW = 0;\n\n    public synchronized void readLock() throws InterruptedException{\n        this.waitingR++;\n        try {\n            //å¦‚æœæœ‰çº¿ç¨‹åœ¨å†™å°±ä¸èƒ½è¯»\n            while (writingW > 0) {\n                this.wait();\n            }\n            this.readingR++;\n        }finally {\n            this.waitingR--;\n        }\n    }\n\n    public synchronized void readUnlock() throws InterruptedException{\n        this.readingR--;\n        notifyAll();\n    }\n\n    public synchronized void writeLock() throws InterruptedException{\n        this.waitingW++;\n        try {\n            while (readingR>0||writingW>0){\n                this.wait();\n            }\n            this.writingW++;\n        }finally {\n            this.waitingW--;\n        }\n    }\n\n    public synchronized void writeUnlock() throws InterruptedException{\n        this.writingW--;\n        notifyAll();\n    }\n\n}\n```\n\nåªæœ‰è¯»çš„æ—¶å€™ä¸åŠ é”ï¼Œå…¶ä»–çš„æ—¶å€™åŠ é”ï¼Œåœ¨è¯»çš„æ“ä½œå¤šäºå†™çš„æ“ä½œæ—¶ï¼Œæ•ˆç‡æå‡æ˜æ˜¾ã€‚\n\n## ä¸å¯å˜å¯¹è±¡è®¾è®¡æ¨¡å¼\n\nè¿™ä¸ªè®¾è®¡æ¨¡å¼è¿˜æ˜¯å¾ˆé‡è¦ä¹Ÿå¾ˆå¸¸è§çš„ï¼Œ`ä¸å¯å˜`é¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨è¢«åˆ›å»ºåå¯¹è±¡æ‰€æœ‰çš„çŠ¶æ€å’Œå±æ€§éƒ½åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚\n\n> ä¸å¯å˜å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„(é‡Œé¢çš„ä»»ä½•å±æ€§æˆ–è€…åº”ç”¨ç±»å‹çš„éƒ½ä¸èƒ½è¢«ä¿®æ”¹)ï¼Œå¯å˜å¯¹è±¡ä¸ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„(SrtingBuffer)ã€‚J2EEé‡Œé¢ï¼ŒServletå°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œstruts1çš„Actionä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n\né€šå¸¸æ¥è¯´ï¼Œåˆ›å»ºä¸å¯å˜ç±»åŸåˆ™æœ‰ä»¥ä¸‹å‡ æ¡ï¼š\n\nâ‘  æ‰€æœ‰æˆå‘˜å˜é‡å¿…é¡»æ˜¯`private`\n\nâ‘¡ æœ€å¥½åŒæ—¶ç”¨`final`ä¿®é¥°(éå¿…é¡»)\n\nâ‘¢ ä¸æä¾›èƒ½å¤Ÿä¿®æ”¹åŸæœ‰å¯¹è±¡çŠ¶æ€çš„æ–¹æ³•\n\n- æœ€å¸¸è§çš„æ–¹å¼æ˜¯ä¸æä¾›setteræ–¹æ³•\n\n- å¦‚æœæä¾›ä¿®æ”¹æ–¹æ³•ï¼Œéœ€è¦æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶åœ¨æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šè¿›è¡Œä¿®æ”¹\n\nâ‘£ é€šè¿‡æ„é€ å™¨åˆå§‹åŒ–æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œå¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡å¿…é¡»è¿›è¡Œæ·±æ‹·è´(deep copy)\n\nâ‘¤ getteræ–¹æ³•ä¸èƒ½å¯¹å¤–æ³„éœ²thiså¼•ç”¨ä»¥åŠæˆå‘˜å˜é‡çš„å¼•ç”¨\n\nâ‘¥ æœ€å¥½ä¸å…è®¸ç±»è¢«ç»§æ‰¿(éå¿…é¡»)\n\nã€€ã€€JDKä¸­æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬åˆ›å»ºä¸å¯å˜é›†åˆï¼Œå¦‚ï¼š\n\n`Collections.unmodifiableList(List<? extends T> list)`\n\n```java\nfinal public class Person {\n    //å®šä¹‰æˆfinal\n    private final String name;\n    private final String address;\n\n    public Person(final String name,final String address) {\n        this.name = name;\n        this.address = address;\n    }\n\n    public String getAddress() {\n\n        return address;\n    }\n\n    public String getName() {\n\n        return name;\n    }\n\n    @Override\n    public String toString() {\n        return \"Person{\" +\n                \"name='\" + name + '\\'' +\n                \", address='\" + address + '\\'' +\n                '}';\n    }\n}\n\n```\n\nè™½ç„¶è¯´æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œä½†æ˜¯å…¶å®é€šè¿‡åå°„ç­‰æ–¹æ³•è¿˜æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚\n\n```java\npublic class StringTest {\n    public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException {\n        /*String s=\"Hello\";\n        String s1=s.replace(\"l\",\"K\");\n        System.out.println(s.hashCode());\n        System.out.println(s1.hashCode());*/\n        String s = \"Hello World\";\n        System.out.println(\"s = \" + s);//Hello World\n\t\t//Stringç±»é‡Œé¢çš„char[]\n        Field valueFieldOfString = String.class.getDeclaredField(\"value\");\n        valueFieldOfString.setAccessible(true);\n\n        char[] value = (char[]) valueFieldOfString.get(s);\n        value[5] = '_';\n        System.out.println(\"s = \" + s); //Hello_World\n    }\n}\n```\n\n## Futureè®¾è®¡æ¨¡å¼(å¼‚æ­¥)\n\n`Future`æ¥å£\n\n```java\npublic interface Future<T> {\n    T get() throws InterruptedException;\n}\n\n```\n\n`FutureTask`æ¥å£\n\n```java\npublic interface FutureTask<T> {\n    T call();\n}\n```\n\n`AsynFuture`å¼‚æ­¥\n\n```java\npublic class AsynFuture<T> implements Future<T> {\n    private volatile boolean done = false;\n\n    private T result;\n\n    public void done(T result) {\n        synchronized (this) {\n            this.result = result;\n            this.done = true;\n            //å®Œæˆä»»åŠ¡é€šçŸ¥è°ƒç”¨è€…\n            this.notifyAll();\n        }\n    }\n\n    @Override\n    public T get() throws InterruptedException {\n        synchronized (this) {\n            while (!done) {\n                this.wait();\n            }\n        }\n        return result;\n    }\n}\n```\n\n`FutureService`è¿æ¥`Future`å’Œ`FutureTask`\n\n```java\npublic class FutureService {\n\n    public <T> Future<T> submit(final FutureTask<T> task) {\n        AsynFuture<T> asynFuture = new AsynFuture<>();\n        new Thread(() -> {\n            T result = task.call();\n            asynFuture.done(result);\n        }).start();\n        return asynFuture;\n    }\n\n    //java8 å›è°ƒ callback\n    public <T> Future<T> submit(final FutureTask<T> task, final Consumer<T> consumer) {\n        AsynFuture<T> asynFuture = new AsynFuture<>();\n        new Thread(() -> {\n            T result = task.call();\n            asynFuture.done(result);\n            consumer.accept(result);\n        }).start();\n        return asynFuture;\n    }\n}\n```\næµ‹è¯•`Future`\n\n```java\npublic class SyncInvoker {\n    public static void main(String[] args) throws InterruptedException {\n\n        FutureService futureService = new FutureService();\n        Future<String> submit = futureService.submit(() -> {\n            try {\n                Thread.sleep(10000l);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            return \"FINISH\";\n        },System.out::println);\n\n        System.out.println(\"===========\");\n        System.out.println(\" do other thing.\");\n        Thread.sleep(1000);\n        System.out.println(\"===========\");\n    }\n\n    private static String get()\n            throws InterruptedException {\n        Thread.sleep(10000l);\n        return \"FINISH\";\n    }\n}\n```\n\n> Future   ->æœªæ¥çš„ç¥¨æ®\n>\n> FutureTask   ->å®é™…æ‰§è¡Œçš„ä»»åŠ¡\n>\n> FutureService  ->æ¡¥æ¥Futureå’ŒFutureTask\n\n## Guarded Suspensionè®¾è®¡æ¨¡å¼\n\n`ä¿æŠ¤æ€§æš‚æŒ‚æ¨¡å¼`\n\nGuardedæ˜¯è¢«å®ˆæŠ¤çš„æ„æ€ã€‚Suspensionæ˜¯æš‚åœçš„æ„æ€ï¼ŒGuarded Suspensionæ¨¡å¼é€šè¿‡è®©çº¿ç¨‹ç­‰å¾…æ¥ä¿è¯å®ä¾‹çš„å®‰å…¨æ€§ã€‚\n\n> æ ¸å¿ƒæ€æƒ³: å¦‚æœæŸä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šçš„æ“ä½œå‰éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œåˆ™åœ¨è¯¥æ¡ä»¶æœªæ»¡è¶³æ—¶å°†çº¿ç¨‹æš‚åœè¿è¡Œï¼ˆå³æš‚æŒ‚çº¿ç¨‹ï¼Œä½¿å…¶å¤„äºç­‰å¾…ï¼ˆwaitingï¼‰çŠ¶æ€ï¼Œç›´åˆ°è¯¥æ¡ä»¶æ»¡è¶³æ—¶æ‰ç»§ç»­è¿è¡Œï¼‰\n\n**Requestå¯¹è±¡**\n\n```java\npublic class Request {\n    final private String value;\n\n    public Request(String value) {\n        this.value = value;\n    }\n\n    public String getValue() {\n        return value;\n    }\n}\n```\n\n**RequestQueue**\n\n```java\npublic class RequestQueue {\n    private final LinkedList<Request> queue = new LinkedList<>();\n\n    public Request getRequest() {\n        synchronized (queue) {\n            while (queue.size() <= 0) {\n                try {\n                    //é˜Ÿåˆ—ä¸ºç©ºç­‰ä¸€ä¸‹\n                    queue.wait();\n                } catch (InterruptedException e) {\n                    return null;\n                }\n            }\n            Request request = queue.removeFirst();\n            return request;\n        }\n    }\n\n    public void putRequest(Request request) {\n        synchronized (queue) {\n            queue.addLast(request);\n            queue.notifyAll();\n        }\n    }\n}\n```\n\n**Server**\n\n```java\npublic class ServerThread extends Thread{\n    private final RequestQueue queue;\n\n    private final Random random;\n\n    private volatile boolean closed = false;\n\n    public ServerThread(RequestQueue queue) {\n        this.queue = queue;\n        random = new Random(System.currentTimeMillis());\n    }\n\n    @Override\n    public void run() {\n        while (!closed) {\n            Request request = queue.getRequest();\n            //getå¯èƒ½ä¼šè¿”å›null\n            if (null == request) {\n                System.out.println(\"Received the empty request.\");\n                break;\n            }\n            System.out.println(\"Server ->\" + request.getValue());\n            try {\n                Thread.sleep(random.nextInt(1000));\n            } catch (InterruptedException e) {\n                //æ‰“æ–­åç›´æ¥return\n                return;\n            }\n        }\n    }\n\n    public void close() {\n        this.closed = true;\n        this.interrupt();\n    }\n}\n```\n\n**Client**\n\n```java\npublic class ClientThread extends Thread {\n    private final RequestQueue queue;\n\n    private final Random random;\n\n    private final String sendValue;\n\n    public ClientThread(RequestQueue queue, String sendValue) {\n        this.queue = queue;\n        this.sendValue = sendValue;\n        random = new Random(System.currentTimeMillis());\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            System.out.println(\"Client -> request \" + sendValue);\n            //å®¢æˆ·ç«¯å‘é€è¯·æ±‚\n            queue.putRequest(new Request(sendValue));\n            try {\n                Thread.sleep(random.nextInt(1000));\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n```\n\n**æµ‹è¯•**\n\n```java\npublic class SuspensionClient {\n    public static void main(String[] args) throws InterruptedException {\n        final RequestQueue queue = new RequestQueue();\n        new ClientThread(queue, \"Shaw\").start();\n        ServerThread serverThread = new ServerThread(queue);\n        serverThread.start();\n        //serverThread.join(); joinä½äº†åé¢è¿˜å’‹closeï¼Ÿï¼Ÿï¼Ÿ\n        Thread.sleep(10000);\n        serverThread.close();\n    }\n}\n```\n\n\n\n## ThreadLocal\n\nçº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹ä¿é™©ç®±ï¼Œä»¥`Thread`ä½œä¸º`key`\n\n> This class provides `thread-local variables`. These variables differ from their normal counterparts in that each thread that accesses one (via its `get` or `set` method) has its own, independently initialized copy of the variable.\n\næ¨¡æ‹Ÿ`ThreadLocal`\n\n```java\npublic class ThreadLocalSimulator<T> {\n    private final Map<Thread,T> threadMap=new HashMap<>();\n\n    public void set(T t){\n        Thread currentThread=Thread.currentThread();\n        synchronized (threadMap){\n            threadMap.put(currentThread,t);\n        }\n    }\n\n\n    public T get(){\n        Thread currentThread =Thread.currentThread();\n        if(threadMap.get(currentThread)==null){\n             threadMap.put(currentThread,initVal());\n        }\n        return threadMap.get(currentThread);\n    }\n\n    protected T initVal() {\n        return null;\n    }\n}\n```\n\n\n\n## Balkingè®¾è®¡æ¨¡å¼\n\n>æ ¸å¿ƒæ€æƒ³ï¼šå½“ä¸å†é€‚åˆæˆ–è€…æ²¡æœ‰å¿…è¦è¿›è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œå°±ç›´æ¥æ”¾å¼ƒè¿›è¡Œè¿™ä¸ªæ“ä½œè€Œç›´æ¥è¿”å›ï¼Œä¸éœ€è¦å°±ç®—äº†\n\n```java\npublic class BalkingData {\n    private final String fileName;\n\n    private String content;\n\n    private boolean changed;\n\n    public BalkingData(String fileName, String content, boolean changed) {\n        this.fileName = fileName;\n        this.content = content;\n        this.changed = changed;\n    }\n\n    public synchronized void change(String newContent) {\n        this.content = newContent;\n        this.changed = true;\n    }\n\n    public synchronized void save() throws IOException {\n        if (!changed) {\n            //é¡¾å®¢æ²¡æœ‰æœåŠ¡è¯·æ±‚ï¼Œé‚£ä¹ˆæ”¾å¼ƒæä¾›æœåŠ¡æ“ä½œï¼Œç›´æ¥è¿”å›ã€‚\n            return;\n        }\n        doSave();\n        this.changed = false;\n    }\n\n    private void doSave() throws IOException {\n        System.out.println(Thread.currentThread().getName() + \" call  do save content\");\n        try(Writer writer = new FileWriter(fileName, true)) {\n            writer.write(content);\n            writer.write(\"\\n\");\n            writer.flush();\n        }\n    }\n}\n```\n\n**CustomerThread**\n\n```java\npublic class CustomerThread extends Thread {\n\n    private final BalkingData balkingData;\n\n    private final Random random = new Random(System.currentTimeMillis());\n\n    public CustomerThread(BalkingData balkingData) {\n        super(\"Customer\");\n        this.balkingData = balkingData;\n    }\n\n    @Override\n    public void run() {\n        try {\n            balkingData.save();\n            for (int i = 0; i < 20; i++) {\n                balkingData.change(\"No.\" + i);\n                Thread.sleep(random.nextInt(1000));\n                balkingData.save();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n**WaiterThread**\n\n```java\npublic class WaiterThread extends Thread {\n\n    private final BalkingData balkingData;\n\n    public WaiterThread(BalkingData balkingData) {\n        super(\"Waiter\");\n        this.balkingData = balkingData;\n    }\n\n    @Override\n    public void run() {\n        for (int i = 0; i < 200; i++) {\n            try {\n                balkingData.save();\n                Thread.sleep(1_000L);\n            } catch (IOException e) {\n                e.printStackTrace();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n```\n\n## CountDownè®¾è®¡æ¨¡å¼\n\n**CountDown**\n\n```java\npublic class CountDown {\n    private final int total;\n\n    //è®¡æ•°å™¨\n    private int counter;\n\n    public CountDown(int total) {\n        this.total = total;\n    }\n\n    public void down(){\n        synchronized (this){\n            this.counter++;\n            this.notifyAll();\n        }\n    }\n\n    public void await() throws InterruptedException {\n        synchronized (this){\n            while (counter!=total){\n                this.wait();\n            }\n        }\n    }\n}\n```\n\n**æµ‹è¯•**\n\n```java\npublic class JDKCountDown {\n\n    private static final Random random = new Random(System.currentTimeMillis());\n\n\n    public static void main(String[] args) throws InterruptedException {\n        //JDKçš„CountDown\n        //final CountDownLatch latch=new CountDownLatch(5);\n        final CountDown latch=new CountDown(5);\n\n        System.out.println(\"å‡†å¤‡å¤šçº¿ç¨‹å¤„ç†ä»»åŠ¡\");\n        //the first phase\n        IntStream.range(0,5).forEach(i->{\n            new Thread(()->{\n                System.out.println(Thread.currentThread().getName()+\" is working\");\n                try {\n                    Thread.sleep(5000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                latch.down();\n            },String.valueOf(i)).start();\n        });\n        latch.await();\n        //the second phase\n        System.out.println(\"å¤šçº¿ç¨‹ä»»åŠ¡å…¨éƒ¨ç»“æŸï¼Œå‡†å¤‡ç¬¬äºŒé˜¶æ®µä»»åŠ¡\");\n        System.out.println(\"........\");\n        System.out.println(\"Finish\");\n    }\n}\n```\n\n## å•ä¾‹æ¨¡å¼\n\n### Double check\n\n```java\npublic class SingletonObjectPlus {\n    private static volatile  SingletonObjectPlus singletonObjectPlus =null;\n    public static SingletonObjectPlus getSingletonObject3(){\n    \tif(singletonObjectPlus==null){\n        \tsynchronized(SingletonObject.class){\n            \tif(singletonObjectPlus==null){\n                \tsingletonObjectPlus= new SingletonObjectPlus();\n            \t}\n        \t}\n    \t}\n     \treturn singletonObjectPlus;\n\t}\n}\n```\n\n> è¿™ç§æ–¹å¼åœ¨å®ä¾‹å¯¹è±¡ä¸Šè¦åŠ ä¸Š `volatile`ï¼Œé¿å…å®ä¾‹å¯¹è±¡æ²¡æœ‰åˆå§‹åŒ–å®Œæˆå°±è¿”å›\n\n### InstanceHolder\n\n```java\npublic class SingleGraceful {\n    private SingleGraceful(){\n\n    }\n    //privateé™æ€å†…éƒ¨ç±»\n    private static class InstanceHolder{\n        //åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡\n        private final static SingleGraceful instance=new SingleGraceful();\n    }\n\n    public static SingleGraceful getInstance(){\n        return SingleGraceful.InstanceHolder.instance;\n    }\n}\n```\n\nJVMåªä¼šä¸ºstaticå˜é‡åˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œä¹Ÿå°±æ˜¯åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œè€Œå†…éƒ¨ç±»ä¸ä¼šåœ¨å…¶å¤–éƒ¨ç±»è¢«åŠ è½½çš„åŒæ—¶è¢«åŠ è½½ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆç®€æ´å¾ˆä¼˜ç§€çš„å•ä¾‹\n\n### Enum\n\n```java\npublic class SingleGraceful2 {\n    private SingleGraceful2() {}\n    \n    private enum Singleton {\n        INSTANCE;\n        \n        private final SingleGraceful2 instance;\n\n        Singleton() {\n            instance = new SingleGraceful2();\n        }\n\n        public SingleGraceful2 getInstance() {\n            return instance;\n        }\n    }\n    public static SingleGraceful2 getInstance() {\n        return Singleton.INSTANCE.getInstance();\n    }\n}\n```\n\n- æšä¸¾ç±»æ„é€ å‡½æ•°æ˜¯`private`ç±»å‹çš„\n- æšä¸¾ç±»çš„åŸŸ(field)(`INSTANCE`)å…¶å®æ˜¯ç›¸åº”çš„enumç±»å‹(`Singleton`)çš„ä¸€ä¸ªé™æ€å®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œæ„é€ å™¨ä¹Ÿåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡\n- æšä¸¾å•ä¾‹å¯ä»¥é˜²æ­¢`ååºåˆ—åŒ–` ï¼Œ`åå°„`ï¼Œ`å…‹éš†`å¯¹å•ä¾‹çš„ç ´åï¼Œæ‰€ä»¥æ˜¯ä¸€ç§æå…¶ä¼˜ç§€çš„å•ä¾‹å®ç°ã€‚\n\n\n\n> è¿™é‡Œå…¶å®è¿˜æœ‰å¾ˆå¤šæ²¡æœ‰ä»‹ç»å‡ºæ¥ï¼Œè®¾è®¡æ¨¡å¼è¿™äº›ä¸œè¥¿æ²¡æœ‰å®é™…çš„åœºæ™¯å»ç”¨ç¡®å®éš¾ä»¥ä½“ä¼šåˆ°å®ƒçš„ç²¾é«“ï¼Œéœ€è¦æ…¢æ…¢çš„ç§¯ç´¯ç»éªŒæ‰è¡Œã€‚\n\n","tags":["å¤šçº¿ç¨‹","è®¾è®¡æ¨¡å¼"],"categories":["å¹¶å‘"]},{"title":"Javaå¤šçº¿ç¨‹åŸºç¡€","url":"/2019/04/07/java-duo-xian-cheng-xue-xi-bi-ji/","content":"## 1.çº¿ç¨‹ä¸è¿›ç¨‹åŒºåˆ«\n\næ¯ä¸ªæ­£åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„ç¨‹åºéƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹åŒ…å«ä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹æ˜¯ä¸€ç»„æŒ‡ä»¤çš„é›†åˆï¼Œæˆ–è€…æ˜¯ç¨‹åºçš„ç‰¹æ®Šæ®µï¼Œå®ƒå¯ä»¥åœ¨ç¨‹åºé‡Œç‹¬ç«‹æ‰§è¡Œã€‚ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä»£ç è¿è¡Œçš„ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥çº¿ç¨‹åŸºæœ¬ä¸Šæ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œå®ƒè´Ÿè´£åœ¨å•ä¸ªç¨‹åºé‡Œæ‰§è¡Œå¤šä»»åŠ¡ã€‚é€šå¸¸ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å¤šä¸ªçº¿ç¨‹çš„è°ƒåº¦å’Œæ‰§è¡Œã€‚\n\nä½¿ç”¨çº¿ç¨‹å¯ä»¥æŠŠå æ®æ—¶é—´é•¿çš„ç¨‹åºä¸­çš„ä»»åŠ¡æ”¾åˆ°åå°å»å¤„ç†ï¼Œç¨‹åºçš„è¿è¡Œé€Ÿåº¦å¯èƒ½åŠ å¿«ï¼Œåœ¨ä¸€äº›ç­‰å¾…çš„ä»»åŠ¡å®ç°ä¸Šå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶è¯»å†™å’Œç½‘ç»œæ”¶å‘æ•°æ®ç­‰ï¼Œçº¿ç¨‹å°±æ¯”è¾ƒæœ‰ç”¨äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥é‡Šæ”¾ä¸€äº›çè´µçš„èµ„æºå¦‚å†…å­˜å ç”¨ç­‰ç­‰ã€‚\n\nå¦‚æœæœ‰å¤§é‡çš„çº¿ç¨‹,ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ï¼Œæ›´å¤šçš„çº¿ç¨‹éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹çš„ä¸­æ­¢éœ€è¦è€ƒè™‘å…¶å¯¹ç¨‹åºè¿è¡Œçš„å½±å“ã€‚é€šå¸¸å—æ¨¡å‹æ•°æ®æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«çš„ï¼Œéœ€è¦é˜²æ­¢çº¿ç¨‹æ­»é”æƒ…å†µçš„å‘ç”Ÿã€‚\n\næ€»ç»“:è¿›ç¨‹æ˜¯æ‰€æœ‰çº¿ç¨‹çš„é›†åˆï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚\n\n## 2.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿå¤šçº¿ç¨‹åº”ç”¨åœºæ™¯ï¼Ÿ\n\nç­”:ä¸»è¦èƒ½ä½“ç°åˆ°å¤šçº¿ç¨‹æé«˜ç¨‹åºæ•ˆç‡ã€‚\n\nä¸¾ä¾‹: è¿…é›·å¤šçº¿ç¨‹ä¸‹è½½ã€æ•°æ®åº“è¿æ¥æ± ã€åˆ†æ‰¹å‘é€çŸ­ä¿¡ç­‰ã€‚\n\n## 3.çº¿ç¨‹åˆ›å»ºæ–¹å¼\n\n### ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•\n\n```java\nclass PlayGame extends Thread {\n\tpublic void run() {\n\t\tfor (int i = 0; i < 50; i++) {\n\t\t\tSystem.out.println(\"PlayGame\" + (i + 1));\n\t\t}\n\t}\n\t//void say() {}\n}\n\nclass ListenMusic extends Thread {\n\tpublic void run() {\n\t\tfor (int i = 0; i < 50; i++) {\n\t\t\tSystem.out.println(\"ListenMusic\" + (i + 1));//åº•å±‚æ“ä½œå±…ç„¶æ˜¯ç”¨çš„StringBuilder\n\t\t}\n\t}\n}\n\npublic class ThreadDemo {\n\tpublic static void main(String[] args)\n\t{\n\t\tThread music = new ListenMusic();\n\t\tThread pg = new PlayGame();\n\t\tmusic.start(); //ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡ŒæŠ¢å èµ„æº\n\t\ttry {\n\t\t\tpg.start();\n\t\t\tfor (int i = 0; i < 50; i++) {\n\t\t\t\tSystem.out.println(\"    mainæ–¹æ³•:\" + (i + 1));\n\t\t\t}\n\t\t\tpg.start();\n\t\t} catch (Exception e) {\n\t\t\tSystem.out.println(\"å‡ºç°äº†IllegalThreadStateExceptionå¼‚å¸¸\");\t  //çº¿ç¨‹åªèƒ½å¯åŠ¨ä¸€æ¬¡\n\t\t}\n\t}\n}\n\n```\nè¿™ç§æ–¹æ³•å®˜æ–¹ä¹Ÿä¸æ¨èä½¿ç”¨å› ä¸ºJavaæ˜¯å•ç»§æ‰¿çš„ç»§æ‰¿äº†Threadç±»ä¹‹åå°±ä¸èƒ½ç»§æ‰¿å…¶ä»–çš„ç±»\n\n### å®ç°Runnableæ¥å£\n\n```java\nclass CreateRunnable implements Runnable {\n\n\t@Override\n\tpublic void run() {\n\t\tfor (inti = 0; i< 10; i++) {\n\t\t\tSystem.out.println(\"i:\" + i);\n\t\t}\n\t}\n\n}\n\npublic class ThreadDemo2 {\n\tpublic static void main(String[] args) {\n\t\tSystem.out.println(\"-----å¤šçº¿ç¨‹åˆ›å»ºå¼€å§‹-----\");\n\t\t// 1.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹\n\t\tCreateRunnable createThread = new CreateRunnable();\n\t\t// 2.å¼€å§‹æ‰§è¡Œçº¿ç¨‹ æ³¨æ„ å¼€å¯çº¿ç¨‹ä¸æ˜¯è°ƒç”¨runæ–¹æ³•ï¼Œè€Œæ˜¯startæ–¹æ³•\n\t\tSystem.out.println(\"-----å¤šçº¿ç¨‹åˆ›å»ºå¯åŠ¨-----\");\n\t\tThread thread = new Thread(createThread);\n\t\tthread.start();\n\t\tSystem.out.println(\"-----å¤šçº¿ç¨‹åˆ›å»ºç»“æŸ-----\");\n\t}\n}\n\n```\n### åŒ¿åå†…éƒ¨ç±»\n\n```java\npublic class InClass {\n\tpublic static void main(String[] args) {\n\t\t Thread thread = new Thread(new Runnable() {\n\t\t\t\tpublic void run() {\n\t\t\t\t\tfor (int i = 0; i< 100; i++) {\n\t\t\t\t\t\tSystem.out.println(\"i:\" + i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\tthread.start();\n\n\t\t //lambdaè¡¨è¾¾å¼è¿˜æ˜¯æ¯”è¾ƒç®€æ´\n\t\t new Thread(()-> {for (int i = 0; i <100; i++) {System.out.println(\"lambda:\" +i);}}).start();\n\t}\n}\n\n```\nçº¿ç¨‹åˆ›å»ºæ–¹å¼ä¸åªè¿™äº›è¿˜æœ‰å¾ˆå¤šï¼Œåé¢å†ä»‹ç»\n\n### Thread ç±»ä¸­çš„start() å’Œ run() æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\nè¿™ä¸ªé—®é¢˜ç»å¸¸è¢«é—®åˆ°ï¼Œä½†è¿˜æ˜¯èƒ½ä»æ­¤åŒºåˆ†å‡ºé¢è¯•è€…å¯¹Javaçº¿ç¨‹æ¨¡å‹çš„ç†è§£ç¨‹åº¦ã€‚`start()`æ–¹æ³•è¢«ç”¨æ¥å¯åŠ¨æ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œè€Œä¸”`start()`å†…éƒ¨nativeæ–¹æ³•`start0()`è°ƒç”¨äº†run()æ–¹æ³•ï¼Œè¿™å’Œç›´æ¥è°ƒç”¨`run()`æ–¹æ³•çš„æ•ˆæœä¸ä¸€æ ·ã€‚å½“ä½ è°ƒç”¨`run()`æ–¹æ³•çš„æ—¶å€™ï¼Œåªä¼šæ˜¯åœ¨åŸæ¥çš„çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œæ²¡æœ‰æ–°çš„çº¿ç¨‹å¯åŠ¨ï¼Œ`start()`æ–¹æ³•æ‰ä¼šå¯åŠ¨æ–°çº¿ç¨‹\n\n## 4.Threadæ„é€ å‡½æ•°\n\n| **å¸¸ç”¨çº¿ç¨‹apiæ–¹æ³•**| |\n|:--|---|\n| start()| å¯åŠ¨çº¿ç¨‹|\n| currentThread()| è·å–å½“å‰çº¿ç¨‹å¯¹è±¡|\n| getID()| è·å–å½“å‰çº¿ç¨‹ID   Thread-ç¼–å· è¯¥ç¼–å·ä»0å¼€å§‹|\n| getName()| è·å–å½“å‰çº¿ç¨‹åç§°|\n| sleep(long mill)| ä¼‘çœ çº¿ç¨‹|\n| Stopï¼ˆï¼‰| åœæ­¢çº¿ç¨‹,|\n| **å¸¸ç”¨çº¿ç¨‹æ„é€ å‡½æ•°** | |\n| Threadï¼ˆï¼‰| åˆ†é…ä¸€ä¸ªæ–°çš„ Thread å¯¹è±¡|\n| Threadï¼ˆString nameï¼‰| åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡ï¼Œå…·æœ‰æŒ‡å®šçš„ nameæ­£å¦‚å…¶åã€‚|\n| Threadï¼ˆRunnable rï¼‰| åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡|\n| Threadï¼ˆRunable r, String nameï¼‰| åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡ï¼Œå…·æœ‰æŒ‡å®šçš„ nameæ­£å¦‚å…¶åã€‚|\n| Thread(ThreadGroup group, Runnable target) | åˆ†é…ä¸€ä¸ªæ–°çš„ Threadå¯¹è±¡ï¼Œå¦‚æœä¸ä¼ `ThreadGroup`é»˜è®¤åŠ å…¥å½“å‰çº¿ç¨‹çš„`ThreadGroup`ä¸­ |\n| Thread(ThreadGroup group, Runnable target, String name) | åˆ†é…ä¸€ä¸ªæ–°çš„ `Thread`å¯¹è±¡ï¼Œä½¿å…¶å…·æœ‰  `target`ä½œä¸ºå…¶è¿è¡Œå¯¹è±¡ï¼Œå…·æœ‰æŒ‡å®šçš„ `name`ä½œä¸ºå…¶åç§°ï¼Œå±äº  `group`å¼•ç”¨çš„çº¿ç¨‹ç»„ã€‚ |\n| Thread(ThreadGroup group, Runnable target, String name,  long stackSize) | åˆ†é…ä¸€ä¸ªæ–°çš„ `Thread`å¯¹è±¡ï¼Œä»¥ä¾¿å®ƒå…·æœ‰  `target`ä½œä¸ºå…¶è¿è¡Œå¯¹è±¡ï¼Œå°†æŒ‡å®šçš„ `name`æ­£å¦‚å…¶åï¼Œä»¥åŠå±äºè¯¥çº¿ç¨‹ç»„ç”±ç§°ä½œ  `group` ï¼Œå¹¶å…·æœ‰æŒ‡å®šçš„ *å †æ ˆå¤§å°* |\n\n### Threadæ„é€ æ–¹æ³•çš„ä¸€äº›ç»†èŠ‚\n\nç›´æ¥ä¸Šæºç \n\n```java\nprivate void init(ThreadGroup g, Runnable target, String name,\n                  long stackSize, AccessControlContext acc,\n                  boolean inheritThreadLocals) {\n    if (name == null) {\n        throw new NullPointerException(\"name cannot be null\");\n    }\n\n    this.name = name;\n\n    Thread parent = currentThread();\n    SecurityManager security = System.getSecurityManager();\n    if (g == null) {\n        /* Determine if it's an applet or not */\n\n        /* If there is a security manager, ask the security manager\n               what to do. */\n        if (security != null) {\n            g = security.getThreadGroup();\n        }\n\n        /* If the security doesn't have a strong opinion of the matter\n               use the parent thread group. */\n        if (g == null) {\n            g = parent.getThreadGroup();\n        }\n    }\n\n    /* checkAccess regardless of whether or not threadgroup is\n           explicitly passed in. */\n    g.checkAccess();\n\n    /*\n         * Do we have the required permissions?\n         */\n    if (security != null) {\n        if (isCCLOverridden(getClass())) {\n            security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);\n        }\n    }\n\n    g.addUnstarted();\n    this.group = g;\n    //è¿™é‡Œç»§æ‰¿äº†çˆ¶ç±»çš„ä¸€äº›å±æ€§\n    this.daemon = parent.isDaemon();\n    this.priority = parent.getPriority();\n\n    if (security == null || isCCLOverridden(parent.getClass()))\n        this.contextClassLoader = parent.getContextClassLoader();\n    else\n        this.contextClassLoader = parent.contextClassLoader;\n    this.inheritedAccessControlContext =\n        acc != null ? acc : AccessController.getContext();\n    //ä¼ å…¥çš„Runnableæ¥å£\n    this.target = target;\n    setPriority(priority);\n    if (inheritThreadLocals && parent.inheritableThreadLocals != null)\n        this.inheritableThreadLocals =\n        ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);\n    /* Stash the specified stack size in case the VM cares */\n    this.stackSize = stackSize;\n\n    /* Set thread ID */\n    tid = nextThreadID();\n}\n```\n\nâ‘  åˆ›å»ºçš„çº¿ç¨‹ä¼šç»§æ‰¿çˆ¶çº¿ç¨‹çš„ä¸€äº›å±æ€§ï¼Œæ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ ï¼Œå’Œä¼˜å…ˆçº§ã€‚\n\nâ‘¡ä½¿ç”¨Thread(Runnable r)åˆ›å»ºçº¿ç¨‹æ—¶`this.target = target`ä¼ å…¥çš„`Runnable`æ¥å£åœ¨è¿™é‡Œèµ‹å€¼ç„¶åä¼šåœ¨`runæ–¹æ³•`ä¸­è¢«è°ƒç”¨ã€‚\n\nâ‘¢`stacksize`è¿™ä¸ªå‚æ•°ä¼šå½±å“`è™šæ‹Ÿæœºæ ˆ`çš„å¤§å°ï¼Œè¿™ä¸ªå€¼è¶Šå¤§èƒ½å­˜æ”¾çš„`æ ˆå¸§`å°±è¶Šå¤šï¼Œå¯è¾¾åˆ°çš„é€’å½’æ·±åº¦è¶Šæ·±ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°ä¸ä¸€å®šæœ‰æ•ˆï¼Œæœ‰çš„å¹³å°å¯èƒ½å¹¶æ²¡æœ‰æ•ˆæœï¼Œå…·ä½“çš„`JVM`åº•å±‚çš„çŸ¥è¯†ç­‰åé¢å­¦åˆ°å†æ¥ç»†åŒ–\n\nâ‘£ä¸€ç§å¥‡æ€ªçš„å†™æ³•ï¼Œè¿™é‡Œåªä¼šæ‰§è¡Œé‡å†™`Thread`çš„`run`æ–¹æ³•ï¼Œè¿™é‡Œä»æºç ä¸Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¼ é€’`Runnable`æ¥å£å…¶å®æ˜¯åœ¨Threadçš„runæ–¹æ³•ä¸­è°ƒç”¨äº†`target`çš„`run`æ–¹æ³•ï¼Œå¦‚æœåŒæ—¶å†`ç»§æ‰¿`Threadç±»ï¼Œé‡å†™`run`æ–¹æ³•ï¼Œè°ƒç”¨çš„å°±ä¸å†æ˜¯Threadç±»çš„runæ–¹æ³•ï¼Œè€Œæ˜¯åŒ¿åThreadå­ç±»é‡å†™çš„runæ–¹æ³•\n\n```java\nThread t = new Thread(() -> {\n    System.out.println(\"Runnable\");\n}) {\n    @Override\n    public void run() {\n        System.out.println(\"Thread\");\n    }\n};\n```\n\nâ‘£çº¿ç¨‹`tid`é€šè¿‡`threadSeqNumber`ä»0è‡ªå¢çš„æ¥ï¼Œmainçº¿ç¨‹æ˜¯ç¬¬`10`ä¸ªçº¿ç¨‹å› ä¸ºä¼šæœ‰ä¸€äº›å®ˆæŠ¤çº¿ç¨‹ä¼šåœ¨mainå¯åŠ¨å‰å¯åŠ¨.\n\n## 5.å®ˆæŠ¤çº¿ç¨‹\n\nJavaä¸­æœ‰ä¸¤ç§çº¿ç¨‹ï¼Œä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå¦ä¸€ç§æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚\n\nç”¨æˆ·çº¿ç¨‹æ˜¯æŒ‡ç”¨æˆ·è‡ªå®šä¹‰åˆ›å»ºçš„çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹åœæ­¢ï¼Œç”¨æˆ·çº¿ç¨‹ä¸ä¼šåœæ­¢\n\n- å®ˆæŠ¤çº¿ç¨‹é¡¾åæ€ä¹‰å½“çˆ¶çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šè¢«åœæ­¢ã€‚\n- JVMåªæœ‰åœ¨æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹ç»“æŸåæ‰ä¼šé€€å‡º\n- åœ¨çº¿ç¨‹startå‰`setDaemon(true)`æ–¹æ³•è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™\n- çˆ¶çº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå­çº¿ç¨‹é»˜è®¤æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚\n\n```java\nclass Daemon implements Runnable {\n    public void run() {\n        for(int i=0;i<500;i++) {\n            System.out.println(Thread.currentThread().getName()+i);\n        }\n    }\n}\n\npublic class DaemonDemo {\n    public static void main(String[]args) {\n        System.out.println(Thread.currentThread().getPriority());\n        Thread r1=new Thread(new Daemon(),\"åå°çº¿ç¨‹\");     //è®¾ç½®è¯¥çº¿ç¨‹ä¸ºåå°çº¿ç¨‹\n        r1.setDaemon(true);                        //å‰å°çº¿ç¨‹æŒ‚æ‰åï¼Œåå°çº¿ç¨‹å°±ä¼šæŒ‚æ‰\n        for(int i=0;i<50;i++) {                   \n            System.out.println(\"main\"+i);\n            if(i==10) {\n                r1.start();\n            }\n        }\n        System.out.println(\"ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•\");\n    }\n}\n```\n\n### åº”ç”¨åœºæ™¯\n\n`å¿ƒè·³æ£€æµ‹`ï¼Œåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¼šéœ€è¦åˆ¤æ–­å¯¹æ–¹æ˜¯å¦åœ¨çº¿ï¼Œä¼šéœ€è¦åˆ›å»ºä¸€æ¡çº¿ç¨‹å»åšè¿™äº›äº‹æƒ…ï¼Œä½†æ˜¯å¦‚æœè¿™æ ·ä¼šå¯¼è‡´`ä¸»çº¿ç¨‹åœæ­¢å·¥ä½œ`äº†ï¼Œä½†æ˜¯æ£€æµ‹å¿ƒè·³çš„çº¿ç¨‹ä»ç„¶åœ¨ç»§ç»­å·¥ä½œï¼ŒJVMå°±æ— æ³•åœä¸‹æ¥ï¼Œæ˜¾ç„¶è¿™æ ·æ—¶ä¸åˆç†çš„ï¼Œè¿™æ—¶å°±å¯ä»¥æŠŠæ£€æµ‹å¿ƒè·³çš„çº¿ç¨‹è®¾ç½®ä¸º`å®ˆæŠ¤çº¿ç¨‹`ï¼Œè¿™æ ·å½“å®ƒä¸»çº¿ç¨‹åœæ­¢å·¥ä½œæ—¶å®ƒçš„å®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šéšä¹‹åœæ­¢ã€‚\n\n```java\n//å¿ƒè·³æ£€æµ‹MOCK\npublic static void main(String[] args) throws InterruptedException {\n        Thread t = new Thread(() -> {\n            Thread inThread = new Thread(() -> {\n                while (true) {\n                    System.out.println(\"start heart check\");\n                    try {\n                        Thread.sleep(1_00);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            });\n            //å°†å­çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹\n            inThread.setDaemon(true);\n            inThread.start();\n            try {\n                Thread.sleep(1_000);\n                System.err.println(\"Thread finish done...\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n        t.start();\n        //ä¸»çº¿ç¨‹(main)-->t-->inThread\n    }\n```\n\n## 6.çº¿ç¨‹çš„çŠ¶æ€\n\nçº¿ç¨‹ä»åˆ›å»ºã€è¿è¡Œåˆ°ç»“æŸæ€»æ˜¯å¤„äºä¸‹é¢äº”ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼šæ–°å»ºçŠ¶æ€ã€å°±ç»ªçŠ¶æ€ã€è¿è¡ŒçŠ¶æ€ã€é˜»å¡çŠ¶æ€åŠæ­»äº¡çŠ¶æ€ã€‚\n\n![mark](http://static.imlgw.top///20181226/WXPYz3SiidMT.png?imageslim)\n\n- æ–°å»ºçŠ¶æ€\n  å½“ç”¨newæ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œ ä¾‹å¦‚new Thread(r)ï¼Œçº¿ç¨‹è¿˜æ²¡æœ‰å¼€å§‹è¿è¡Œï¼Œæ­¤æ—¶çº¿ç¨‹å¤„åœ¨æ–°å»ºçŠ¶æ€ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹å¤„äºæ–°ç”ŸçŠ¶æ€æ—¶ï¼Œç¨‹åºè¿˜æ²¡æœ‰å¼€å§‹è¿è¡Œçº¿ç¨‹ä¸­çš„ä»£ç \n\n- å°±ç»ªçŠ¶æ€\n  ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹å¹¶ä¸è‡ªåŠ¨å¼€å§‹è¿è¡Œï¼Œè¦æ‰§è¡Œçº¿ç¨‹ï¼Œå¿…é¡»è°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•ã€‚å½“çº¿ç¨‹å¯¹è±¡è°ƒç”¨start()æ–¹æ³•å³å¯åŠ¨äº†çº¿ç¨‹ï¼Œstart()æ–¹æ³•åˆ›å»ºçº¿ç¨‹è¿è¡Œçš„ç³»ç»Ÿèµ„æºï¼Œå¹¶è°ƒåº¦çº¿ç¨‹è¿è¡Œrun()æ–¹æ³•ã€‚å½“start()æ–¹æ³•è¿”å›åï¼Œçº¿ç¨‹å°±å¤„äºå°±ç»ªçŠ¶æ€ã€‚\n  å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹å¹¶ä¸ä¸€å®šç«‹å³è¿è¡Œrun()æ–¹æ³•ï¼Œçº¿ç¨‹è¿˜å¿…é¡»åŒå…¶ä»–çº¿ç¨‹ç«äº‰CPUæ—¶é—´ï¼Œåªæœ‰è·å¾—CPUæ—¶é—´æ‰å¯ä»¥è¿è¡Œçº¿ç¨‹ã€‚å› ä¸ºåœ¨å•CPUçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œä¸å¯èƒ½åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªæ—¶åˆ»ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å› æ­¤æ­¤æ—¶å¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€ã€‚å¯¹å¤šä¸ªå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹æ˜¯ç”±`Java`è¿è¡Œæ—¶ç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ç¨‹åº(*thread scheduler*)æ¥è°ƒåº¦çš„ã€‚\n\n- è¿è¡ŒçŠ¶æ€\n  å½“çº¿ç¨‹è·å¾—CPUæ—¶é—´åï¼Œå®ƒæ‰è¿›å…¥è¿è¡ŒçŠ¶æ€ï¼ŒçœŸæ­£å¼€å§‹æ‰§è¡Œrun()æ–¹æ³•.\n\n- é˜»å¡çŠ¶æ€\n  çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ç”±äºå„ç§åŸå› è¿›å…¥é˜»å¡çŠ¶æ€:\n  1>çº¿ç¨‹é€šè¿‡è°ƒç”¨sleepæ–¹æ³•è¿›å…¥ç¡çœ çŠ¶æ€ï¼›\n  2>çº¿ç¨‹è°ƒç”¨ä¸€ä¸ªåœ¨I/Oä¸Šè¢«é˜»å¡çš„æ“ä½œï¼Œå³è¯¥æ“ä½œåœ¨è¾“å…¥è¾“å‡ºæ“ä½œå®Œæˆä¹‹å‰ä¸ä¼šè¿”å›åˆ°å®ƒçš„è°ƒç”¨è€…ï¼›\n  3>çº¿ç¨‹è¯•å›¾å¾—åˆ°ä¸€ä¸ªé”ï¼Œè€Œè¯¥é”æ­£è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼›\n  4>çº¿ç¨‹åœ¨ç­‰å¾…æŸä¸ªè§¦å‘æ¡ä»¶ï¼›\n\n- æ­»äº¡çŠ¶æ€\n\n  æœ‰ä¸¤ä¸ªåŸå› ä¼šå¯¼è‡´çº¿ç¨‹æ­»äº¡ï¼š\n\n  1) runæ–¹æ³•æ­£å¸¸é€€å‡ºè€Œè‡ªç„¶æ­»äº¡ï¼Œ\n\n  2) ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº†runæ–¹æ³•è€Œä½¿çº¿ç¨‹çŒæ­»ã€‚ ä¸ºäº†ç¡®å®šçº¿ç¨‹åœ¨å½“å‰æ˜¯å¦å­˜æ´»ç€ï¼ˆå°±æ˜¯è¦ä¹ˆæ˜¯å¯è¿è¡Œçš„ï¼Œè¦ä¹ˆæ˜¯è¢«é˜»å¡äº†ï¼‰ï¼Œéœ€è¦ä½¿ç”¨`isAlive`æ–¹æ³•ã€‚å¦‚æœæ˜¯å¯è¿è¡Œæˆ–è¢«é˜»å¡ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›trueï¼› å¦‚æœçº¿ç¨‹ä»æ—§æ˜¯newçŠ¶æ€ä¸”ä¸æ˜¯å¯è¿è¡Œçš„ï¼Œ æˆ–è€…çº¿ç¨‹æ­»äº¡äº†ï¼Œåˆ™è¿”å›false.\n\n## 7.join()æ–¹æ³•\n\n### æºç è§£æ\n\n```java\n public final synchronized void join(long millis) throws InterruptedException {\n        long base = System.currentTimeMillis();\n        long now = 0;\n        if (millis < 0) {\n            throw new IllegalArgumentException(\"timeout value is negative\");\n        }\n        if (millis == 0) {\n            while (isAlive()) {\n                wait(0);\n            }\n        } else {\n            while (isAlive()) {\n                long delay = millis - now;\n                if (delay <= 0) {\n                    break;\n                }\n                wait(delay);\n                now = System.currentTimeMillis() - base;\n            }\n        }\n    }\n```\n\nâ‘ `thread.join()`æ²¡æœ‰å‚æ•°ä¼šé»˜è®¤è°ƒç”¨`join(0)`ç„¶åå›è½®è¯¢æ£€æŸ¥è°ƒç”¨`join()`çš„çº¿ç¨‹ä¹Ÿå°±æ˜¯æ˜¯`thread`çº¿ç¨‹æ˜¯å¦`isAlive()`å¦‚æœthreadä¾ç„¶å­˜æ´»å°±å›é‡Šæ”¾`å½“å‰çº¿ç¨‹`çš„CPUæ‰§è¡Œæƒï¼Œç„¶åç»§ç»­è½®è¯¢ï¼ŒçŸ¥é“`thread`è¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚\n\nâ‘¡`join(long millis)` å‚æ•°çš„ä½œç”¨å°±æ˜¯å½“å‰çº¿ç¨‹æœ€å¤šç­‰å¾…æ—¶é—´ï¼Œé™æ—¶ç­‰å¾…ï¼Œé¿å…æ— æ­¢å¢ƒçš„ç­‰å¾…ã€‚\n\nâ‘¢ä¸€ä¸ªçº¿ç¨‹è‡ªå·±è°ƒç”¨è‡ªå·±çš„`join`æ–¹æ³•è¯¥çº¿ç¨‹å°±å›ä¸€ç›´`wait`ä¸‹å»å› ä¸ºä»–è‡ªå·±è¦ä¸€ç›´ç­‰è‡ªå·±ğŸ˜„\n\n### åº”ç”¨åœºæ™¯\n\n>  å¤šçº¿ç¨‹åŒæ—¶é‡‡é›†æ•°æ®ï¼Œæœ€åå°†ç»Ÿè®¡çš„æ€»æ—¶é—´ç­‰ä¿¡æ¯å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå¦‚æœä¸jionå°±æ— æ³•ç»Ÿä¸€ç»“æŸçš„æ—¶é—´\n\n```java\npublic class ThreadJoin3 {\n    public static void main(String[] args) throws InterruptedException {\n        long l1 = System.currentTimeMillis();\n        Thread t0 = new Thread(new CaptureMachine(\"M0\", 1000));\n        Thread t1 = new Thread(new CaptureMachine(\"M1\", 2000));\n        Thread t2 = new Thread(new CaptureMachine(\"M2\", 4000));\n        t0.start();\n        t1.start();\n        t2.start();\n        //è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ç»“æŸç„¶åç»Ÿè®¡æœ€åæ€»ä½“ç»“æŸçš„æ—¶é—´\n        t0.join();\n        t1.join();\n        t2.join();\n        long l = System.currentTimeMillis();\n        System.out.println(\"end save begin timestamp:\" + l1 + \"end timestamp\" + l);\n    }\n}\n\nclass CaptureMachine implements Runnable {\n    private String machineId;\n\n    private long spentTime;\n\n    public CaptureMachine(String machineId, long spentTime) {\n        this.machineId = machineId;\n        this.spentTime = spentTime;\n    }\n\n    @Override\n    public void run() {\n        try {\n            Thread.sleep(spentTime);\n            System.out.println(machineId + \" capture done\");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n## 8.ä¼˜å…ˆçº§\n\nç°ä»£æ“ä½œç³»ç»ŸåŸºæœ¬é‡‡ç”¨æ—¶åˆ†çš„å½¢å¼è°ƒåº¦è¿è¡Œçš„çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ†é…å¾—åˆ°çš„æ—¶é—´ç‰‡çš„å¤šå°‘å†³å®šäº†çº¿ç¨‹ä½¿ç”¨å¤„ç†å™¨èµ„æºçš„å¤šå°‘ï¼Œä¹Ÿå¯¹åº”äº†çº¿ç¨‹ä¼˜å…ˆçº§è¿™ä¸ªæ¦‚å¿µã€‚åœ¨JAVAçº¿ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªint priorityæ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼ŒèŒƒå›´ä¸º1-10ï¼Œå…¶ä¸­10æœ€é«˜ï¼Œé»˜è®¤å€¼ä¸º5ã€‚ä¸‹é¢æ˜¯Demoï¼ˆåŸºäº1.8ï¼‰ä¸­å…³äºpriorityçš„ä¸€äº›é‡å’Œæ–¹æ³•ã€‚\n\n```java\npublic class ThreadSimpleAPI2 {\n    public static void main(String[] args) {\n        Thread t0 = new Thread(() -> {\n            for (int i = 0; i < 1000; i++) {\n                Optional.of(Thread.currentThread().getName() + \"-index\" + i).ifPresent(System.out::println);\n            }\n        });\n        t0.setPriority(Thread.MAX_PRIORITY);\n        Thread t1 = new Thread(() -> {\n            for (int i = 0; i < 1000; i++) {\n                Optional.of(Thread.currentThread().getName() + \"-index\" + i).ifPresent(System.out::println);\n            }\n        });\n        t1.setPriority(Thread.NORM_PRIORITY);\n        Thread t2 = new Thread(() -> {\n            for (int i = 0; i < 1000; i++) {\n                Optional.of(Thread.currentThread().getName() + \"-index\" + i).ifPresent(System.out::println);\n            }\n        });\n        t2.setPriority(Thread.MIN_PRIORITY);\n        t0.start();\n        t1.start();\n        t2.start();\n    }\n}\n```\n\n## 9.Interruptæ–¹æ³• \n\n### çœ‹çœ‹æºç \n\n```java\npublic void interrupt() {\n        if (this != Thread.currentThread())\n            checkAccess();\n\n        synchronized (blockerLock) {\n            Interruptible b = blocker;\n            if (b != null) {\n                interrupt0();           // Just to set the interrupt flag\n                b.interrupt(this);\n                return;\n            }\n        }\n        interrupt0();\n}\n```\n\nåœ¨çŸ¥ä¹ä¸Šçœ‹è§ä¸€ä¸ªå¥½çš„å›ç­”ï¼šé¦–å…ˆï¼Œä¸€ä¸ªçº¿ç¨‹ä¸åº”è¯¥ç”±å…¶ä»–çº¿ç¨‹æ¥å¼ºåˆ¶ä¸­æ–­æˆ–åœæ­¢ï¼Œè€Œæ˜¯åº”è¯¥ç”±çº¿ç¨‹è‡ªå·±`è‡ªè¡Œåœæ­¢`ã€‚æ‰€ä»¥ï¼Œ`Thread.stop()` ,`Thread.suspend()`,`Thread.resume()`éƒ½å·²ç»è¢«åºŸå¼ƒäº†ã€‚è€Œ`Thread.interrupt()`çš„ä½œç”¨ä¹Ÿä¸æ˜¯ä¸­æ–­çº¿ç¨‹ï¼Œ_è€Œæ˜¯é€šçŸ¥çº¿ç¨‹è¯¥ç»“æŸäº†_ å…·ä½“ä¸­æ–­è¿˜æ˜¯ç»§ç»­è¿è¡Œè¿˜æ˜¯ç”±è¢«é€šçŸ¥çš„çº¿ç¨‹è‡ªå·±å¤„ç†ã€‚å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨`interrupt()`æ—¶\n\nâ‘ å¦‚æœçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€(sleep,wait,joinç­‰)ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†~~ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€~~å¹¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸(2019.8.10 fix)\n\n> è¿™é‡Œå…¶å®æ˜¯æœ‰ç‚¹é—®é¢˜çš„ï¼Œåœ¨æœ‰åŒæ­¥é”å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¸€å®šä¼šç«‹å³é€€å‡ºè¢«é˜»å¡çš„çŠ¶æ€ï¼Œå³ä½¿æŠ›å‡ºå¼‚å¸¸ä¹Ÿè¦ç­‰åˆ°å†æ¬¡æ‹¿åˆ°é”ä¹‹åæ‰èƒ½æŠ›å‡ºï¼ŒåŒæ—¶ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„é˜»å¡æ“ä½œéƒ½ä¼šå“åº”ä¸­æ–­ä¿¡å·ï¼Œæ¯”å¦‚IOæ“ä½œä¹‹ç±»çš„éƒ½ä¸ä¼šå“åº”ä¸­æ–­ä¿¡å·\n\n**éªŒè¯Demo**\n\n```java\npublic class WaitNotify {\n\n    public static void main(String[] args) {\n\n        Object object = new Object();\n\n        Thread thread1 = new Thread(new Runnable() {\n            @Override\n            public void run() {\n                synchronized (object) {\n                    System.out.println(\"çº¿ç¨‹1 è·å–åˆ°ç›‘è§†å™¨é”\");\n                    try {\n                        object.wait();\n                        System.out.println(\"çº¿ç¨‹1 æ¢å¤å•¦ã€‚æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆä¹…æ‰æ¢å¤ï¼Œå› ä¸ºnotifyæ–¹æ³•è™½ç„¶æ—©å°±å‘ç”Ÿäº†ï¼Œå¯æ˜¯æˆ‘è¿˜è¦è·å–é”æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚\");\n                    } catch (InterruptedException e) {\n                        System.out.println(\"çº¿ç¨‹1 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸ï¼Œå³ä½¿æ˜¯å¼‚å¸¸ï¼Œæˆ‘ä¹Ÿæ˜¯è¦è·å–åˆ°ç›‘è§†å™¨é”äº†æ‰ä¼šæŠ›å‡º\");\n                    }\n                }\n            }\n        }, \"çº¿ç¨‹1\");\n        thread1.start();\n\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                synchronized (object) {\n                    System.out.println(\"çº¿ç¨‹2 æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºçº¿ç¨‹1 åœ¨ wait æ–¹æ³•çš„æ—¶å€™ä¼šè‡ªåŠ¨é‡Šæ”¾é”\");\n                    System.out.println(\"çº¿ç¨‹2 è®¾ç½®çº¿ç¨‹1 ä¸­æ–­\");\n                    thread1.interrupt();\n                    System.out.println(\"çº¿ç¨‹2 æ‰§è¡Œå®Œäº† ä¸­æ–­ï¼Œå…ˆä¼‘æ¯3ç§’å†è¯´ã€‚\");\n                    try {\n                        Thread.sleep(3000);\n                        System.out.println(\"çº¿ç¨‹2 ä¼‘æ¯å®Œå•¦ã€‚æ³¨æ„äº†ï¼Œè°ƒsleepæ–¹æ³•å’Œwaitæ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸ä¼šé‡Šæ”¾ç›‘è§†å™¨é”\");\n                    } catch (InterruptedException e) {\n\n                    }\n                    System.out.println(\"çº¿ç¨‹2 ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸæ“ä½œ\");\n                }\n            }\n        }, \"çº¿ç¨‹2\").start();\n    }\n}\n```\n\nâ‘¡å¦‚æœçº¿ç¨‹å¤„äºæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„`ä¸­æ–­æ ‡å¿—ä½`è®¾ç½®ä¸ºtrueï¼Œä»…æ­¤è€Œå·²ï¼Œè¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œä¸å—å½±å“ã€‚\n\nâ‘¢å¯¹å·²ç»ç»“æŸçš„çº¿ç¨‹è°ƒç”¨`interupt`æ²¡æœ‰ä»»ä½•æ•ˆæœ\n\nä¸Šé¢åªæ˜¯ç®€å•çš„åˆ†æï¼Œå…¶å®æƒ…å†µè¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œåé¢å†æ¥æ€»ç»“\n\n**å…·ä½“çš„å°æ¡ˆä¾‹**\n\n```java\npublic class ThreadInterrup2 {\n    public static void main(String[] args) {\n        Thread main=Thread.currentThread();\n\n        Thread t=new Thread(()->{\n            while (true){\n\n            }\n        });\n        t.start();\n\t\n        Thread t2 = new Thread(() -> {\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            //t.interrupt(); è¿™é‡Œæ‰“æ–­çš„æ˜¯tçº¿ç¨‹ä½†æ˜¯é˜»å¡çš„æ˜¯mainçº¿ç¨‹æ‰€ä»¥æ‰“æ–­ä¸äº†ï¼Œæ•è·ä¸åˆ°å¼‚å¸¸\n            main.interrupt();\n            System.out.println(\"æ‰“æ–­ main çº¿ç¨‹\");\n        });\n        t2.start();\n\n        try {\n            //è¿™é‡Œé˜»å¡çš„æ˜¯mainçº¿ç¨‹\n            t.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n```\n\nçœ‹æ‡‚è¿™ä¸ªå°æ¡ˆä¾‹åº”è¯¥å°±ç†è§£interruptäº†ã€‚\n\n### å¦‚ä½•ä¼˜é›…çš„ç»“æŸçº¿ç¨‹\n\n**1. ä½¿ç”¨â€œå¼€å…³â€**\n\n```java\npublic class ThreadCloseGraceful {\n    public static void main(String[] args) throws InterruptedException {\n        Worker worker=new Worker();\n        worker.start();\n        Thread.sleep(10000); //ç­‰å¾…10s\n        worker.shutdown();\n    }\n}\n\nclass Worker extends Thread{\n    //ä¼˜é›…çš„åœæ­¢çº¿ç¨‹-----å¼€å…³\n    private volatile boolean start = true;\n\n    @Override\n    public void run() {\n        while (start){\n\n        }\n    }\n\n    public void shutdown(){\n        this.start=false;\n    }\n}\n```\n\n> ä¸ºäº†åŠæ—¶çš„æ„ŸçŸ¥åˆ°å¼€å…³çš„å˜åŒ– startéœ€è¦å£°æ˜ä¸º volatileï¼ˆåé¢è®²Volatileçš„æ—¶å€™ä¼šè¯´åˆ°ï¼‰\n\n**2. è½®è¯¢ä¸­æ–­æ ‡å¿—ä½**\n\n```java\npublic class ThreadCloseGraceful2 {\n    public static void main(String[] args) throws InterruptedException {\n        Worker2 worker2 = new Worker2();\n        worker2.start();\n        Thread.sleep(5000);\n        worker2.interrupt();\n    }\n}\n\nclass Worker2 extends Thread{\n    //ä¼˜é›…çš„åœæ­¢çº¿ç¨‹2-----æ‰“æ–­\n    @Override\n    public void run() {\n        while (true){\n            /*try {\n                Thread.sleep(1);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n                break; //return ä¼šç›´æ¥é€€å‡º\n            }*/\n            //ä»£ç æœ‰å¯èƒ½åœ¨æ‰§è¡ŒisInterruptedä¹‹å‰å°±Blockäº†\n            if(isInterrupted()){\n                break;\n            }\n        }\n        //-----------\n    }\n}\n```\n\n**3. åˆ©ç”¨å®ˆæŠ¤çº¿ç¨‹**\n\nä¸Šé¢çš„ä»£ç å·²ç»æåˆ°äº†ï¼Œæœ‰å¯èƒ½åœ¨è½®è¯¢`å¼€å…³` æˆ–è€… è½®è¯¢`ä¸­æ–­æ ‡å¿—ä½`ä¹‹å‰å°±å µå¡äº†ï¼Œè¿™æ—¶ä¹Ÿä¸èƒ½ä¸€ç›´ç­‰è¯¥ä¸‹å»æ‰€ä»¥å°±éœ€è¦å¼ºåˆ¶ç»“æŸçº¿ç¨‹çš„æ–¹æ³•ï¼Œ`ï¼ˆå½“ç„¶ä¸ä¼šæ˜¯stopï¼‰` è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨å®ˆæŠ¤çº¿ç¨‹çš„ç‰¹æ€§å»å®Œæˆè¿™ä»¶äº‹\n\n```java\npublic class ThreadService {\n    private  Thread executeThread;\n\n    private  volatile  boolean finished=false;\n\n    public void execute(Runnable task){\n        executeThread =new Thread(()->{\n            //å­çº¿ç¨‹\n            Thread t=new Thread(()->{\n                task.run();\n            });\n            t.setDaemon(true);\n            t.start();\n\n            try {\n                t.join(); //è¿™é‡Œé˜»å¡çš„æ˜¯executeThread\n                finished=true;\n                //åˆ°è¿™é‡Œè¯´æ˜executeThreadå·²ç»ä¸é˜»å¡äº†,å­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œäº†ï¼Œæ²¡æœ‰è¶…æ—¶\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n                System.out.println(\"TLEï¼ŒexecuteThread execution was interrupted\");\n            }\n        });\n        executeThread.start();\n    }\n\n    public void shutdown(long mills){\n        long base=System.currentTimeMillis();\n        while (!finished){ //è½®è¯¢æ£€æŸ¥æ ‡å¿—ä½ï¼Œçœ‹æ˜¯å¦å·²ç»ç»“æŸ\n            if(System.currentTimeMillis()-base>=mills){\n                //è¶…æ—¶äº†æ²¡æœ‰å®Œæˆ\n                System.out.println(\"TLE, will end it now\");\n                executeThread.interrupt(); //æ‰“æ–­executeThread\n                break;\n            }\n            //æ²¡è¶…æ—¶\n            try {\n                executeThread.sleep(10);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n                System.out.println(\"executeThread was interrupted when shutdown\");\n            }\n        }\n        //æ ‡å¿—ä½å¤åŸ\n        finished=false;\n    }\n}\n```\n\nå°†å¾…æ‰§è¡Œçš„`task`ä¼ é€’åˆ°`ThreadService`ä¸­ç„¶åä¼šåˆ›å»ºä¸€ä¸ª`executeThread`çš„çº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œ`task`çš„`run`æ–¹æ³•ç„¶åå°†å­çº¿ç¨‹è®¾ç½®ä¸º`executeThread`çš„å®ˆæŠ¤çº¿ç¨‹ç„¶å`join`é˜»å¡`executeThread`çº¿ç¨‹ï¼ŒåŒæ—¶ä¼šè°ƒç”¨`ThreadService`çš„`shutdown`æ–¹æ³•ä¼ å…¥ä¸€ä¸ªæœ€é•¿ç­‰å¾…æ—¶é—´ç„¶å`è½®è¯¢æ ‡å¿—ä½`æ£€æŸ¥æ˜¯å¦ç»“æŸï¼Œå¦‚æœè¶…æ—¶å°±ä¼šæ‰“æ–­`executeThread`è¿›è€Œç»“æŸ`executeThread`çš„å­çº¿ç¨‹ä¹Ÿå°±æ˜¯`task`\n\n### Thread.interrupted()\n\nè¿™ä¸ªæ–¹æ³•å’Œ`isInterrupt()`ç±»ä¼¼ä½†æ˜¯ä»–ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ä¸º`false`æ–¹ä¾¿ä¹‹åçš„ä¸­æ–­æ“ä½œè€Œä¸”è¿™ä¸ªæ˜¯`é™æ€æ–¹æ³•`ï¼Œæ‰€ä»¥ä½ ç”¨çº¿ç¨‹å®ä¾‹å»è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå®ƒè¿™é‡Œæ˜¯ç”¨æ¥åˆ¤æ–­**å½“å‰æ‰§è¡Œçº¿ç¨‹**æ˜¯å¦ `interrupt` ï¼Œå¹¶ä¸”è®¾ç½®ä¸­æ–­æ ‡å¿—ä½ä¸º`false`\n\n```html\n/**\n * Tests whether the current thread has been interrupted.  The\n * <i>interrupted status</i> of the thread is cleared by this method.  In\n * other words, if this method were to be called twice in succession, the\n * second call would return false (unless the current thread were\n * interrupted again, after the first call had cleared its interrupted\n * status and before the second call had examined it).\n *\n * <p>A thread interruption ignored because a thread was not alive\n * at the time of the interrupt will be reflected by this method\n * returning false.\n *\n * @return  <code>true</code> if the current thread has been interrupted;\n *          <code>false</code> otherwise.\n * @see #isInterrupted()\n * @revised 6.0\n */\n```\n\nåŒæ—¶åœ¨æŠ›å‡º`InterruptedException` ä¹‹åä¸­æ–­çŠ¶æ€ä¹Ÿä¼šè¢«è‡ªåŠ¨æ¸…é™¤ä¸ºfalse\n\n> if any thread has interrupted the current thread. The <i>interrupted status</i> of the current thread is cleared when this exception is thrown.     ----Thread.sleepæ³¨é‡Š\n\n## 10.Yieldæ–¹æ³•\n\nThread.yield()æ–¹æ³•çš„ä½œç”¨ï¼šæš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚ï¼ˆå¯èƒ½æ²¡æœ‰æ•ˆæœï¼‰\nyield()è®©å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å›åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä»¥å…è®¸å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶ä»–çº¿ç¨‹è·å¾—è¿è¡Œçš„æœºä¼šã€‚å› æ­¤ï¼Œä½¿ç”¨yield()çš„ç›®çš„æ˜¯è®©å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹‹é—´èƒ½å¤Ÿé€‚å½“çš„è½®æ¢æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå®é™…ä¸­æ— æ³•ä¿è¯yield()è¾¾åˆ°è®©æ­¥çš„ç›®çš„ï¼Œå› ä¸ºï¼Œè®©æ­¥çš„çº¿ç¨‹å¯èƒ½è¢«çº¿ç¨‹è°ƒåº¦ç¨‹åºå†æ¬¡é€‰ä¸­ã€‚\nç»“è®ºï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œyield()å°†å¯¼è‡´çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä½†æœ‰å¯èƒ½æ²¡æœ‰æ•ˆæœã€‚\n\n## 11.Synchronizedå…³é”®å­— \n\n### çº¿ç¨‹å®‰å…¨é—®é¢˜\n\n```java\npublic class TicketRunnable implements Runnable {\n    \n    private final static int MAX_NO = 500;\n\n    private int index = 1;\n\n    @Override\n    public void run() {\n        while (true) {\n                if (index > MAX_NO) {\n                    return;\n                }\n                try {\n                    Thread.sleep(5);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(Thread.currentThread().getName() + \"ç¬¬ï¼š\" + index++);\n        }\n    }\n}\n```\n\nç”¨è¿™ä¸ªåˆ›å»ºå¤šä¸ª`Thread`ç„¶åè¿è¡Œ\n\n> äºŒå·çª—å£ç¬¬ï¼š497\n> ä¸‰å·çª—å£ç¬¬ï¼š499\n> ä¸€å·çª—å£ç¬¬ï¼š498\n> ä¸€å·çª—å£ç¬¬ï¼š500\n> äºŒå·çª—å£ç¬¬ï¼š`502`\n> ä¸‰å·çª—å£ç¬¬ï¼š`501`\n\nå¯ä»¥çœ‹å‡ºæ‰“å°å‡ºäº†501ï¼Œ502æ˜æ˜¾ä¸å¯¹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§é—®é¢˜å‘¢ï¼Ÿå…¶å®ä»”ç»†æƒ³æƒ³ä¹Ÿå¾ˆå®¹æ˜“ç†è§£\n\n![mark](http://static.imlgw.top///20190326/zSGNeiCW2zc1.png?imageslim)\n\nå½“ä¸¤ä¸ªçº¿ç¨‹å¦‚å›¾æ‰€ç¤ºçš„æƒ…å†µï¼Œ2å·çº¿ç¨‹`index=500`ç„¶å`index++`ç„¶å 1å·çº¿ç¨‹è¯»å–åˆ°`index`çš„å€¼å°±ä¼šäº§ç”Ÿè¿™ä¸ªé—®é¢˜ã€‚\n\n### åŒæ­¥ä»£ç å—\n\n**è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜**\n\n```java\npublic class TicketRunnable implements Runnable {\n\n    private final static int MAX_NO = 500;\n    \n    private int index = 1;\n\n    private final Object MONITOR = new Object();\n\n    @Override\n    public void run() {\n        while (true) {\n            synchronized (MONITOR) {\n                //å•çº¿ç¨‹\n                if (index > MAX_NO) {\n                    return;\n                }\n                try {\n                    Thread.sleep(5);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(Thread.currentThread().getName() + \"ç¬¬ï¼š\" + index++);\n            }\n        }\n    }\n}\n```\n\nåˆ©ç”¨`MONITOR`å¯¹è±¡ä½œä¸ºåŒæ­¥é”åŒæ­¥ä¹‹åçš„éƒ¨åˆ†å°±ç›¸å½“äºå•çº¿ç¨‹ï¼Œ`MONITOR`é”å¯¹è±¡ä¸€èˆ¬è®¾ç½®ä¸º`final`çš„é¿å…åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹`MONITOR`å¯¹è±¡è¿›è¡Œæ”¹å˜è€Œäº§ç”Ÿæ— æ³•é¢„æ–™çš„åæœ\n\n### åŒæ­¥æ–¹æ³•\n\n```java\npublic class SynchronizeRunnable implements Runnable {\n\n    private final static int MAX_NO = 500;\n\n    private int index = 1;\n\n    @Override\n    public  void run() {\n        //thisé”\n        while (true) {\n            if (ticket()) {\n                return;\n            }\n\n        }\n    }\n\n    private synchronized boolean ticket(){\n        //synchronized (this) {\n            //1.getFiled\n            if (index > MAX_NO) {\n                return true;\n            }\n            try {\n                Thread.sleep(5);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            // getFiled index\n            // index=index+1\n            // putFiled index\n            //åŒæ­¥ä»£ç å—å°±æ˜¯ä¿æŠ¤å…±äº«æ•°æ®index, MAX_NOä¸æ˜¯,ä»–æ˜¯åªè¯»æ•°æ®\n            System.out.println(Thread.currentThread().getName() + \"ç¬¬ï¼š\" + index++);\n            return false;\n       // }\n    }\n}\n```\n\né»˜è®¤åŠ çš„æ˜¯`this`é”\n\n**è¯æ˜thisé”çš„å­˜åœ¨**\n\n```java\npublic class SynchronizedThis {\n    public static void main(String[] args) {\n        ThisLock thisLock = new ThisLock();\n        Thread thread = new Thread(() -> thisLock.m1(), \"Thread0\");\n        thread.start();\n        Thread thread1 = new Thread(() -> thisLock.m2(), \"Thread1\");\n        thread1.start();\n        Thread thread2 = new Thread(() -> thisLock.m3(), \"Thread2\");\n        thread2.start();\n    }\n}\n\nclass ThisLock {\n\n    private final Object LOCK = new Object();\n\n    public synchronized void m1() {\n        System.out.println(Thread.currentThread().getName());\n        try {\n            Thread.sleep(10_000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public synchronized void m2() {\n        System.out.println(Thread.currentThread().getName());\n        try {\n            Thread.sleep(10_000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public void m3() {\n        synchronized (LOCK) {\n            System.out.println(Thread.currentThread().getName());\n            try {\n                Thread.sleep(10_000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n```\n\nè¿è¡Œä¸Šé¢çš„ä»£ç ä¼šå‘ç°`Thread0`å’Œ`Thread2`ä¼šå…ˆæ‰“å°å‡ºæ¥å› ä¸ºä»–ä»¬ä¸æ˜¯åŒä¸€ä¸ªé”ä¸ç”¨ç­‰å¾…å¯¹æ–¹ï¼Œè€Œ`Thread1`ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´åæ‰ä¼šæ‰§è¡Œå› ä¸ºå®ƒéœ€è¦ç­‰å¾…`Thread0`é‡Šæ”¾é”è€Œè¿™ä¸ªé”åªèƒ½æ˜¯`thisé”`\n\n**è¯æ˜classé”çš„å­˜åœ¨**\n\n```java\npublic class SynchronizedClass {\n    public static void main(String[] args) {\n        Thread thread0 = new Thread(() -> ClassLock.m1(), \"Thread0\");\n        thread0.start();\n        Thread thread1 = new Thread(() -> ClassLock.m2(), \"Thread1\");\n        thread1.start();\n        Thread thread2 = new Thread(() -> ClassLock.m3(), \"Thread2\");\n        thread2.start();\n    }\n}\n\nclass ClassLock {\n    static {\n        synchronized (ClassLock.class) {\n            System.out.println(\"static\" + Thread.currentThread().getName());\n            try {\n                Thread.sleep(10_000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    public static synchronized void m1() {\n        System.out.println(Thread.currentThread().getName());\n        try {\n            Thread.sleep(10_000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static synchronized void m2() {\n        System.out.println(Thread.currentThread().getName());\n        try {\n            Thread.sleep(10_000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void m3() {\n        System.out.println(Thread.currentThread().getName());\n        try {\n            Thread.sleep(10_000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nè¿è¡Œä¸Šé¢çš„ä»£ç ä¼šå‘ç°æœ€å¼€å§‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå»æ‰§è¡Œé™æ€ä»£ç å¿«ï¼Œåœ¨é™æ€ä»£ç å¿«æ‰§è¡Œå®Œä¹‹å`Thread2`ä¼šå’Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼Œè¯´æ˜ä¸€å¼€å§‹`Thread2`å›å’Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æŠ¢`Classé”`æ‰§è¡Œé™æ€ä»£ç å—ï¼ˆé™æ€ä»£ç å—åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼‰\n\n### æ­»é”\n\n> ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŒæœ‰å¤šä¸ªé”ï¼Œè€Œè¿™æ ·å°±å¯èƒ½ä¼šå¯¼è‡´`æ­»é”`çš„äº§ç”Ÿ\n\n**æ­»é”ç¤ºä¾‹**\n\n```java\npublic class Service1 {\n    private  final Object LOCK=new Object();\n\n    private Service2 service2;\n\n    public  void s1(){\n        synchronized (LOCK){\n            System.out.println(\"s1==============\");\n        }\n    }\n\n    public void s2(){\n        synchronized (LOCK){\n            System.out.println(\"s2==============\");\n            service2.m2();\n        }\n    }\n\n    public void setService2(Service2 service2) {\n        this.service2 = service2;\n    }\n}\n---------------------------------------------------\npublic class Service2 {\n    private Service1 service1;\n\n    public Service2(Service1 service1) {\n        this.service1 = service1;\n    }\n\n    private  final  Object LOCK=new Object();\n\n    public  void  m1(){\n        synchronized (LOCK){\n            System.out.println(\"m1\");\n            service1.s1();\n        }\n    }\n\n    public  void  m2(){\n        synchronized (LOCK){\n            System.out.println(\"m2\");\n        }\n    }\n}\n-------------------------------------------------\npublic class DeadLockTest {\n    public static void main(String[] args) {\n        Service1 service1=new Service1();\n        Service2 service2 =new Service2(service1);\n        service1.setService2(service2);\n\n        new Thread(()->{\n            while (true){\n                service2.m1();\n            }\n        }).start();\n\n        new Thread(()->{\n            while (true){\n                service1.s2();\n            }\n        }).start();\n    }\n}\n```\n\næ‰§è¡Œä¸Šé¢ä»£ç å°±ä¼šå‘ç°åœ¨è¿è¡Œä¸€æ®µæ—¶é—´åä¸¤ä¸ªçº¿ç¨‹éƒ½`é˜»å¡`äº†ï¼Œè¿™å°±æ˜¯`æ­»é”`\n\n- `jps`&`jstack`  åˆ†ææ­»é”\n\n![mark](http://static.imlgw.top///20190328/BG9eU9Rq8ae0.png?imageslim)\n\nä¸¤ä¸ªçº¿ç¨‹éƒ½éœ€è¦å¯¹æ–¹æ‰‹ä¸Šçš„çš„é”ï¼Œé™·å…¥åƒµæŒçŠ¶æ€ï¼Œå°±ä¼šäº§ç”Ÿæ­»é”ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`jconsole`å›¾å½¢åŒ–ç•Œé¢æ¥åˆ†æ\n\n## 12.çº¿ç¨‹é—´é€šè®¯\n\nåœ¨Javaå¹³å°ä¸­ï¼ŒObject.wait()/notify() ç­‰æ–¹æ³•å¯ç”¨äºå®ç°çº¿ç¨‹çš„ç­‰å¾…å’Œé€šçŸ¥ï¼Œwaitå°†å½“å‰çº¿ç¨‹æš‚åœç”Ÿå‘½å‘¨æœŸå˜ä¸º **WAITING** ï¼Œè€Œnotify() åˆ™å¯ä»¥å”¤é†’ä¸€ä¸ªè¢«æš‚åœçš„çº¿ç¨‹ä»è€Œå®ç°é€šçŸ¥ï¼Œä¸€èˆ¬æ¥è¯´wait() ä»£ç æ¨¡æ¿ç±»ä¼¼ä¸‹é¢\n\n```java\nsynchronized(someObj){\n    while(ä¿æŠ¤æ¡ä»¶ä¸æˆç«‹){\n        //ç­‰å¾…\n        someObj.wait();\n    }\n    //ä¿æŠ¤æ¡ä»¶æ»¡è¶³\n    doAction();\n}\n```\n\nè€Œ`notify()` å¯¹åº”ä»£ç æ¨¡æ¿å¦‚ä¸‹\n\n```java\nsynchronized(someObj){\n    //æ›´æ–°ç­‰å¾…çº¿ç¨‹çš„ä¿æŠ¤æ¡ä»¶è®¾è®¡çš„å…±äº«å˜é‡\n    updateSharedDate();\n    //å”¤é†’å…¶ä»–çº¿ç¨‹\n    someObj,notify();\n}\n```\n\n### ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹\n\n**é”™è¯¯ç¤ºä¾‹**\n\n```java\npublic class ProduceConsumerVersion1 {\n    public static void main(String[] args) {\n        ProduceConsumerVersion1 pc = new ProduceConsumerVersion1();\n        new Thread(() -> {\n            while (true) {\n                pc.produce();\n            }\n        }, \"Produce\").start();\n        new Thread(() -> {\n            while (true) {\n                pc.consumer();\n            }\n        }, \"Consumer\").start();\n    }\n\n    private int i = 0;\n\n    private final Object LOCK = new Object();\n\n    public void produce() {\n        synchronized (LOCK) {\n            System.out.println(\"Produce->\" + (i++));\n        }\n    }\n\n    public void consumer() {\n        synchronized (LOCK) {\n            System.out.println(\"Consumer->\" + (i));\n        }\n    }\n}\n```\n\nè¿™ç§æ¨¡å‹å½“ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯åŠ¨åä¼šå‘ç°ä¸¤ä¸ªçº¿ç¨‹æ— æ³•åä½œï¼Œç”Ÿäº§è€…ä¸æ–­ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…`ä¸æ¶ˆè´¹`æˆ–è€…`é‡å¤æ¶ˆè´¹`\n\n**å•ç”Ÿäº§è€…&å•æ¶ˆè´¹è€…**\n\n```java\npublic class ProduceConsumerVersion2 {\n    public static void main(String[] args) {\n        ProduceConsumerVersion2 pc = new ProduceConsumerVersion2();\n        Stream.of(\"Produce1\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.produce();\n                }\n            }, n).start();\n        });\n        Stream.of(\"Consumer1\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.consumer();\n                }\n            }, n).start();\n        });\n    }\n\n    private int i = 0;\n\n    private final Object LOCK = new Object();\n\n    private volatile boolean isProduced = false;\n\n    public void produce() {\n        synchronized (LOCK) {\n            if (isProduced) {\n                //å·²ç»ç”Ÿäº§äº†\n                try {\n                    LOCK.wait();//ç­‰å¾…æ¶ˆè´¹è€…å”¤é†’\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            System.out.println(Thread.currentThread().getName() + \"-->\" + (++i));//produce\n            isProduced = true;\n            LOCK.notify();\n        }\n    }\n\n    public void consumer() {\n        synchronized (LOCK) {\n            if (!isProduced) {\n                try {\n                    LOCK.wait();//ç­‰å¾…ç”Ÿäº§è€…å”¤é†’\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            System.out.println(Thread.currentThread().getName() + \"-->\" + (i));//consumer\n            isProduced = false;\n            LOCK.notify();\n        }\n    }\n}\n```\n\n**wait()ï¼š** å½“å‰çº¿ç¨‹`é‡Šæ”¾é”`è¿›å…¥è¯¥é”å¯¹è±¡çš„`ç­‰å¾…é˜Ÿåˆ—` \n\n> Causes the current thread to wait until another thread invokes the\n>\n> {@link java.lang.Object#notify()} method or the\n>\n> {@link java.lang.Object#notifyAll()} method for this object.\n>\n> In other words, this method behaves exactly as if it simply\n>\n> performs the call {@code `wait(0)`}.\n>\n> The current thread `must own this object's monitor.` The thread\n>\n> `releases` ownership of this monitor and waits until another thread\n>\n> notifies threads waiting on this object's monitor to wake up\n>\n> either through a call to the {@code notify} method or the\n>\n> {@code notifyAll} method. The thread then waits until it can\n>\n> re-obtain ownership of the monitor and resumes execution.\n\n**wait(long timeout)ï¼š**`wait()`çš„é‡è½½æ–¹æ³•å¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯å¹²å•¥çš„âœ”\n\n> Causes the current thread to wait until either another thread invokes the\n>\n> {@link java.lang.Object#notify()} method or the\n>\n> {@link java.lang.Object#notifyAll()} method for this object, or a\n>\n> `specified amount of time has elapsed.`\n>\n> The current thread must own this object's monitor.\n>\n> @throws  `IllegalArgumentException`  if the value of timeout is negative.\n\n**notify()ï¼š** å”¤é†’è¯¥`é”å¯¹è±¡`çš„`ç­‰å¾…é˜Ÿåˆ—`çš„çº¿ç¨‹ï¼Œå”¤é†’æ–¹æ³•ä¸åŒçš„è™šæ‹Ÿæœºå®ç°ä¸åŒæœ‰çš„å¯èƒ½æ˜¯`FCFS`æœ‰çš„å¯èƒ½æ˜¯`SJF` ç­‰ç­‰....æ‰€ä»¥å”¤é†’çš„æ˜¯é‚£ä¸ªçº¿ç¨‹æ˜¯æ— æ³•ç¡®å®šçš„\n\n> Wakes up a single thread that is `waiting on this object's`\n>\n> `monitor`. If any threads are waiting on this object, one of them\n>\n> is chosen to be awakened. `The choice is arbitrary and occurs at`\n>\n> `the discretion of the implementation`. A thread waits on an object's\n>\n> monitor by calling one of the {@code wait} methods.\n>\n> The awakened thread will not be able to proceed until the current\n>\n> thread `relinquishes` the lock on this object. The awakened thread will\n>\n> compete in the usual manner with any other threads that might be\n>\n> actively competing to synchronize on this object; for example, the\n>\n> awakened thread enjoys no reliable privilege or disadvantage in being\n>\n> the next thread to lock this object.\n\nç”Ÿäº§è€…ç”Ÿäº§ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€ä¸ªï¼Œæ²¡æ¯›ç—…ï¼Œä½†æ˜¯ä¸Šé¢çš„ä»£ç ä»…ä»…é€‚ç”¨äº`å•ç”Ÿäº§è€…&æ¶ˆè´¹è€…`å¯¹äºå¤šä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…å°±ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå…·ä½“é—®é¢˜å¦‚ä¸‹\n\n**æµ‹è¯•å¤šæ¶ˆè´¹è€…&ç”Ÿäº§è€…**\n\næ²¿ç”¨ä¸Šé¢single p&cçš„ä»£ç ï¼Œæµ‹è¯•å¤šæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…\n\n```java\n    public static void main(String[] args) {\n        ProduceConsumerVersion3 pc = new ProduceConsumerVersion3();\n        Stream.of(\"Produce1\", \"Produce2\", \"Produce3\", \"Produce4\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.produce();\n                }\n            }, n).start();\n        });\n        Stream.of(\"Consumer1\", \"Consumer2\", \"Consumer3\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.consumer();\n                }\n            }, n).start();\n        });\n    }\n```\n\nè¿è¡Œä¼šå‘ç°ç¨‹åºè¿›å…¥`â€æ­»é”â€œ`çŠ¶æ€ï¼Œç”¨`jps&jstack`åˆ†æ\n\n![mark](http://static.imlgw.top///20190328/pzXBY0ertEVV.png?imageslim)\n\nç¨‹åºå¹¶æ²¡æœ‰å‘ç°æ­»é”âï¼Œè¿™å°±æ˜¯å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…ä¼šäº§ç”Ÿçš„`å‡æ­»`çŠ¶æ€ï¼Œå®é™…ä¸Šæ˜¯æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¿›å…¥äº†`wait()`çŠ¶æ€éƒ½æ”¾å¼ƒäº†`CPU`çš„æ‰§è¡Œæƒ\n\n**å‡æ­»åŸå› åˆ†æ**\n\n```java\nProduce1-->1\tnotify C1 wait\nConsumer1-->1\tnotify P1 wait\nProduce1-->2    notify C2 wait\nConsumer2-->2   notify P2 wait\nProduce2-->3\tnotify P1 wait ---> Produce1-->wait\n```\n\nä¸Šé¢æ˜¯å…¶ä¸­ä¸€ç§æƒ…å†µï¼Œå¤§è‡´åˆ†æä¸‹ï¼šå‰ä¸¤æ¬¡ç”Ÿäº§æ¶ˆè´¹éƒ½æ­£å¸¸ä¸€ä¸ª`æ¶ˆè´¹è€…`å”¤é†’ä¸€ä¸ª`ç”Ÿäº§è€…`ï¼Œå‰ä¸¤æ¬¡æ‰§è¡Œå®Œä¹‹å`P1 C1 C2`éƒ½è¿›å…¥`wait`çŠ¶æ€ç„¶åç¬¬ä¸‰æ¬¡ç”Ÿäº§çš„æ—¶å€™`P2`å”¤é†’äº†ä¸€ä¸ªä¸è¯¥å”¤é†’çš„äººğŸ˜‚ å”¤é†’äº†`P1`ç„¶å`wait`äº†ï¼Œ`P1`é†’æ¥åå‘ç°å·²ç»ç”Ÿäº§äº†ç„¶åä¹Ÿ`wait`å»äº†ï¼Œè‡³æ­¤æ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨è¿›å…¥`wait`çŠ¶æ€å°±é€ æˆäº†å‡æ­»ã€‚è¿™ä¸ªé—®é¢˜è®°å¾—å¤§ä¸€çš„æ—¶å€™è¿˜é—®è¿‡è€å¸ˆå½“æ—¶ç‰¹åˆ«çº ç»“ä¸ºå•¥ä¼šæ­»é”ï¼Œç°åœ¨çœ‹çœ‹å…¶å®ä¹Ÿæ²¡å•¥ï¼Œä¸»è¦å°±æ˜¯`notify`å”¤é†’çš„çº¿ç¨‹æ˜¯ä¸ç¡®å®šçš„ï¼Œæ˜¯ç”±`JVM`å†³å®šçš„æ¯ç§`JDK`çš„å®ç°ä¹Ÿä¸å¤ªä¸€æ ·ï¼Œæ— æ³•ä¿è¯æ¶ˆè´¹è€…ä¸€å®šå”¤é†’ç”Ÿäº§è€…ï¼Œåä¹‹äº¦ç„¶ã€‚\n\n**å¤šç”Ÿäº§è€…&å¤šæ¶ˆè´¹è€…**\n\n```java\nimport java.util.stream.Stream;\npublic class ProduceConsumerVersion3 {\n    public static void main(String[] args) {\n        ProduceConsumerVersion3 pc = new ProduceConsumerVersion3();\n        Stream.of(\"Produce1\", \"Produce2\", \"Produce3\", \"Produce4\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.produce();\n                }\n            }, n).start();\n        });\n        Stream.of(\"Consumer1\", \"Consumer2\", \"Consumer3\").forEach(n -> {\n            new Thread(() -> {\n                while (true) {\n                    pc.consumer();\n                }\n            }, n).start();\n        });\n    }\n\n    private int i = 0;\n\n    private final Object LOCK = new Object();\n\n    private volatile boolean isProduced = false;\n\n    public void produce() {\n        synchronized (LOCK) {\n            while (isProduced) {\n                //å·²ç»ç”Ÿäº§äº†\n                try {\n                    LOCK.wait(); //åŠ å…¥LOCKé”çš„waité˜Ÿåˆ—\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            System.out.println(Thread.currentThread().getName() + \"-->\" + (++i));//produce\n            isProduced = true;\n            LOCK.notifyAll();\n        }\n    }\n\n    public void consumer() {\n        synchronized (LOCK) {\n            while (!isProduced) {\n                try {\n                    LOCK.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            System.out.println(Thread.currentThread().getName() + \"-->\" + (i));//consumer\n            isProduced = false;\n            LOCK.notifyAll();\n        }\n    }\n}\n```\n\n**notifyAll()ï¼š**å”¤é†’å½“å‰é”å¯¹è±¡ç­‰å¾…é˜Ÿåˆ—ä¸Šçš„`æ‰€æœ‰`çº¿ç¨‹\n\n> Wakes up `all threads` that are waiting on `this object's monitor`. A\n>\n> thread waits on an object's monitor by calling one of the\n>\n> {@code wait} methods.\n>\n> The awakened threads will not be able to proceed until the current\n>\n> thread relinquishes the lock on this object. The awakened threads\n>\n> will `compete in the usual manner` with any other threads that might\n>\n> be actively competing to synchronize on this object; for example,\n>\n> the awakened threads enjoy `no reliable privilege or disadvantage` in\n>\n> being the next thread to lock this object.\n\nâ‘  ä¸ºäº†è§£å†³ä¸Šé¢çš„`å‡æ­»`é—®é¢˜è¿™é‡Œä½¿ç”¨äº†`notifyAll()`æ¥å”¤é†’`ç­‰å¾…é˜Ÿåˆ—`çš„çº¿ç¨‹ï¼Œçœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ–¹æ³•ä¼šå”¤é†’æ‰€æœ‰çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆä¸Šé¢çš„å‡æ­»é—®é¢˜å°±è‡ªç„¶è§£å†³äº†ã€‚\n\nâ‘¡ è¿˜æœ‰ä¸€ç‚¹ä¸åŒçš„æ˜¯è¿™é‡Œåˆ¤æ–­ç”Ÿäº§çŠ¶æ€æ—¶ç”¨çš„æ˜¯`while`è€Œä¸æ˜¯`if`ä¸ºä»€ä¹ˆä¸ç”¨`if`? å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£å¦‚æœæœ‰å¤šä¸ªç”Ÿäº§è€…æˆ–è€…æ¶ˆè´¹è€…åŒæ—¶åœ¨`ç­‰å¾…é˜Ÿåˆ—`ä¸­ï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªæŠ¢åˆ°é”åæ‰§è¡Œï¼Œæ‰§è¡Œå®Œç”Ÿäº§åå”¤é†’äº†æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå‡è®¾å”¤é†’çš„æ˜¯`ç”Ÿäº§è€…`çš„è¯ï¼Œå› ä¸ºæ˜¯`ifè¯­å¥`æ§åˆ¶çš„è¢«å”¤é†’çš„ç”Ÿäº§è€…æŠ¢åˆ°é”ä¹‹åå°±ç›´æ¥é¡ºç€æ‰§è¡Œä¸‹å»äº†ï¼Œå°±ç›´æ¥å»ç”Ÿäº§äº†ï¼Œå°±ä¼šé€ æˆ`é‡å¤çš„ç”Ÿäº§`å½“ç„¶ç”¨`else`è¯­å¥è²Œä¼¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯é‚£ä¼šå½±å“æ•ˆç‡ï¼ˆä¸ªäººæ„Ÿè§‰ï¼‰ï¼Œè€Œä¸”å¾ˆåˆ«æ‰­ï¼ˆè¢«å”¤é†’äº†ç›´æ¥é€€å‡ºï¼Ÿï¼Ÿï¼Ÿï¼‰. æ‰€ä»¥è¿™é‡Œç”¨`while`æ¥è¿›è¡Œ`äºŒæ¬¡æ£€æµ‹`é¿å…è¿™ç§æƒ…å†µï¼Œè¿™ç§whileå¾ªç¯ä¹Ÿè¢«ç§°ä¸º`è‡ªæ—‹é”` è¿™ä¸€å—åé¢çš„æ–‡ç« ä¼šå†è¯¦ç»†çš„è®²ã€‚\n\n### ä¸ºä»€ä¹ˆwaitå’Œnotifyå¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ \n\nè¿™æ˜¯`é˜¿é‡Œå·´å·´`çš„ä¸€é“é¢è¯•é¢˜\n\nâ‘  é¦–å…ˆä»è¯­æ³•å±‚é¢è®²ï¼Œå¦‚æœä¸åœ¨åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—ä¸­è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åŠ é”ï¼Œè‡ªç„¶å°±ä¸ç”¨è°ˆæ˜¯ä¸æ˜¯`é”å¯¹è±¡çš„æŒæœ‰è€…` ï¼Œå°±ä¼šæŠ¥`IllegalMonitorStateException`.\n\n> @throws  `IllegalMonitorStateException`  if the current thread is not\n>\n> the owner of the object's monitor.\n\nâ‘¡è®¾æƒ³ä¸‹å¦‚æœä¸åŠ é”å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿæ‰€è°“çš„`ç«æ€æ¡ä»¶`ï¼Œå‡è®¾`wait()`,`notify()`,`notifyAll()`æ–¹æ³•ä¸éœ€è¦åŠ é”å°±èƒ½å¤Ÿè¢«è°ƒç”¨ã€‚æ­¤æ—¶æ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨`wait()`æ­£åœ¨è¿›å…¥çŠ¶æ€å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—(è¯‘è€…æ³¨:å¯èƒ½è¿˜æœªè¿›å…¥)ã€‚åœ¨åŒä¸€æ—¶åˆ»ï¼Œç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨`notify()`æ–¹æ³•æ‰“ç®—å‘æ¶ˆè´¹è€…çº¿ç¨‹é€šçŸ¥çŠ¶æ€æ”¹å˜ã€‚é‚£ä¹ˆæ­¤æ—¶æ¶ˆè´¹è€…çº¿ç¨‹å°†é”™è¿‡è¿™ä¸ªé€šçŸ¥å¹¶ä¸€ç›´é˜»å¡ã€‚å› æ­¤ï¼Œå¯¹è±¡çš„`wait()`,`notify()`,`notifyAll()`æ–¹æ³•å¿…é¡»åœ¨è¯¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­è¢«äº’æ–¥åœ°è°ƒç”¨ã€‚\n\n> è®¡ç®—çš„æ­£ç¡®æ€§å–å†³äºå¤šä¸ªçº¿ç¨‹çš„äº¤æ›¿æ‰§è¡Œæ—¶åºæ—¶å°±ä¼šäº§ç”Ÿç«æ€æ¡ä»¶\n\n### wait()åè¢«å”¤é†’ä¼šæ€ä¹ˆæ ·ï¼Ÿ\n\nä¸Šé¢è¯´åˆ°è¢«å”¤é†’åä¼šå»æŠ¢é”ï¼Œä½†æ˜¯è¿™é‡Œæœ‰äººå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œå»æŠ¢é”ä¼šä¸ä¼šå›åˆ°åŒæ­¥çš„èµ·ç‚¹å»äº‰æŠ¢é”ï¼Œç„¶åæŠŠwaitå‰çš„é€»è¾‘å†æ‰§è¡Œä¸€éï¼Ÿè¿™é‡Œè‚¯å®šäº‹ä¸ä¼šçš„ï¼Œç¡®å®æ˜¯è¦æŠ¢é”ä½†æ˜¯ä¼šæœ‰è®°å½•ä¼šç»§ç»­é¡ºç€waitæ–¹æ³•èµ°ä¸‹å»ã€‚\n\n### notifyå’Œä¸­æ–­çš„ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç°è±¡\n\n```java\npublic class NotifyInter {\n\n    volatile int a = 0;\n\n    public static void main(String[] args) {\n\n        Object object = new Object();\n\n        NotifyInter waitNotify = new NotifyInter();\n\n        Thread thread1 = new Thread(new Runnable() {\n            @Override\n            public void run() {\n\n                synchronized (object) {\n                    System.out.println(\"çº¿ç¨‹1 è·å–åˆ°ç›‘è§†å™¨é”\");\n                    try {\n                        object.wait();\n                        System.out.println(\"çº¿ç¨‹1 æ­£å¸¸æ¢å¤å•¦ã€‚ä½†æ˜¯ isInterrupt = \"+ Thread.currentThread().isInterrupted());\n                    } catch (InterruptedException e) {\n                        System.out.println(\"çº¿ç¨‹1 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸\");\n                    }\n                }\n            }\n        }, \"çº¿ç¨‹1\");\n        thread1.start();\n\n        Thread thread2 = new Thread(new Runnable() {\n            @Override\n            public void run() {\n\n                synchronized (object) {\n                    System.out.println(\"çº¿ç¨‹2 è·å–åˆ°ç›‘è§†å™¨é”\");\n                    try {\n                        object.wait();\n                        System.out.println(\"çº¿ç¨‹2 æ­£å¸¸æ¢å¤å•¦ã€‚\");\n                    } catch (InterruptedException e) {\n                        System.out.println(\"çº¿ç¨‹2 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸\");\n                    }\n                }\n            }\n        }, \"çº¿ç¨‹2\");\n        thread2.start();\n\n        // è¿™é‡Œè®© thread1 å’Œ thread2 å…ˆèµ·æ¥ï¼Œç„¶åå†èµ·åé¢çš„ thread3\n       try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n        }\n\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                synchronized (object) {\n                    System.out.println(\"çº¿ç¨‹3 æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚\");\n                    System.out.println(\"çº¿ç¨‹3 è®¾ç½®çº¿ç¨‹1ä¸­æ–­\");\n                    thread1.interrupt(); // 1\n                    //waitNotify.a = 1; // è¿™è¡Œæ˜¯ä¸ºäº†ç¦æ­¢ä¸Šä¸‹çš„ä¸¤è¡Œä¸­æ–­å’Œnotifyä»£ç é‡æ’åº\n                    System.out.println(\"çº¿ç¨‹3 è°ƒç”¨notify\");\n                    object.notify(); //2\n                    System.out.println(\"çº¿ç¨‹3 è°ƒç”¨å®Œnotifyåï¼Œä¼‘æ¯ä¸€ä¼š\");\n                    try {\n                        Thread.sleep(1000);\n                    } catch (InterruptedException e) {\n                    }\n                    System.out.println(\"çº¿ç¨‹3 ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸåŒæ­¥ä»£ç å—\");\n                }\n            }\n        }, \"çº¿ç¨‹3\").start();\n    }\n}\n```\n\nå¤šæ‰§è¡Œå‡ æ¬¡å¯èƒ½å°±å¯èƒ½ä¼šå‘ç”Ÿå¦‚ä¸‹æƒ…å†µï¼Œçº¿ç¨‹1è¢«æ‰“æ–­åå±…ç„¶æ­£å¸¸çš„è¿”å›äº†ï¼ï¼ï¼ï¼çº¿ç¨‹2è¢«é˜»å¡ä½äº†\n\n```java\nçº¿ç¨‹1 è·å–åˆ°ç›‘è§†å™¨é”\nçº¿ç¨‹2 è·å–åˆ°ç›‘è§†å™¨é”\nçº¿ç¨‹3 æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚\nçº¿ç¨‹3 è®¾ç½®çº¿ç¨‹1ä¸­æ–­\nçº¿ç¨‹3 è°ƒç”¨notify\nçº¿ç¨‹3 è°ƒç”¨å®Œnotifyåï¼Œä¼‘æ¯ä¸€ä¼š\nçº¿ç¨‹3 ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸåŒæ­¥ä»£ç å—\nçº¿ç¨‹1 æ­£å¸¸æ¢å¤å•¦ã€‚ä½†æ˜¯ isInterrupt = true\n```\n\nå…¶å®è¿™é‡Œä¸»è¦é—®é¢˜å°±æ˜¯ `notify()` å’Œ`interrupt()` æ‰§è¡Œé¡ºåºçš„é—®é¢˜\n\n- å¦‚æœå…ˆè¢«æ‰“æ–­ï¼Œé‚£ä¹ˆåç»­çš„notifyä¼šè¿™ä¸ªçº¿ç¨‹æ— æ•ˆï¼Œä¾ç„¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœè¿™æ˜¯è¯¥é”å®ä¾‹ä¸Šä»ç„¶æœ‰å…¶ä»–çº¿ç¨‹å¤„äºwaitçŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªnotifyä¼šå”¤é†’å…¶ä¸­çš„ä¸€ä¸ªï¼Œä¸èƒ½è™šå‘ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ [Javaè¯­è¨€è§„èŒƒæ–‡æ¡£17.2.4](https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.2.4)\n\n  > The above specifications allow us to determine several properties having to do with the interaction of waits, notification, and interruption.\n  >\n  > If a thread is both notified and interrupted while waiting, it may either:\n  >\n  > - return normally from `wait`, while still having a pending interrupt (in other words, a call to `Thread.interrupted` would return true)\n  > - return from `wait` by throwing an `InterruptedException`\n  >\n  > The thread may not reset its interrupt status and return normally from the call to `wait`.\n  >\n  > Similarly, notifications cannot be lost due to interrupts. Assume that a set *s* of threads is in the wait set of an object *m*, and another thread performs a `notify` on *m*. Then either:\n  >\n  > - at least one thread in *s* must return normally from `wait`, or\n  > - all of the threads in *s* must exit `wait` by throwing `InterruptedException`\n  >\n  > Note that if a thread is both interrupted and woken via `notify`, and that thread returns from `wait` by throwing an `InterruptedException`, then some other thread in the wait set must be notified.\n\n- å¦‚æœå…ˆè¢«notify()ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šä»waitä¸­é†’æ¥ï¼Œç„¶åä¸­æ–­ï¼Œè®¾ç½®ä¸­æ–­æ ‡å¿—ä½ä¸º trueï¼Œä½†ä¸ä¼šåœ¨è¿™ä¸ªwaitä¸ŠæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¼šå½±å“åé¢çš„é˜»å¡æ“ä½œï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„Demo\n\n  ```java\n  public class NotifyInter {\n      volatile int a = 0;\n      public static void main(String[] args) {\n          Object object = new Object();\n          NotifyInter waitNotify = new NotifyInter();\n          Thread thread1 = new Thread(new Runnable() {\n              @Override\n              public void run() {\n                  synchronized (object) {\n                      System.out.println(\"çº¿ç¨‹1 è·å–åˆ°ç›‘è§†å™¨é”\");\n                      try {\n                          object.wait();\n                          System.out.println(\"çº¿ç¨‹1 æ­£å¸¸æ¢å¤å•¦ã€‚ä½†æ˜¯ isInterrupt = \"+ Thread.currentThread().isInterrupted());\n                      } catch (InterruptedException e) {\n                          System.out.println(\"çº¿ç¨‹1 waitæ–¹æ³•æŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸\");\n                      }\n  \n                      try {\n                          TimeUnit.SECONDS.sleep(3);\n                      } catch (InterruptedException e) {\n                          e.printStackTrace();\n                          System.out.println(\"åœ¨sleepä¸­è¢«ä¸­æ–­\");\n                      }\n                  }\n              }\n          }, \"çº¿ç¨‹1\");\n          thread1.start();\n          // è¿™é‡Œè®© thread1 å’Œ thread2 å…ˆèµ·æ¥ï¼Œç„¶åå†èµ·åé¢çš„ thread3\n         try {\n              Thread.sleep(1000);\n          } catch (InterruptedException e) {\n          }\n  \n          new Thread(new Runnable() {\n              @Override\n              public void run() {\n                  synchronized (object) {\n                      System.out.println(\"çº¿ç¨‹3 æ‹¿åˆ°äº†ç›‘è§†å™¨é”ã€‚\");\n                      System.out.println(\"çº¿ç¨‹3 è®¾ç½®çº¿ç¨‹1ä¸­æ–­\");\n                      object.notify(); //2\n                      waitNotify.a = 1; // è¿™è¡Œæ˜¯ä¸ºäº†ç¦æ­¢ä¸Šä¸‹çš„ä¸¤è¡Œä¸­æ–­å’Œnotifyä»£ç é‡æ’åº\n                      thread1.interrupt(); // 1\n                      System.out.println(\"çº¿ç¨‹3 è°ƒç”¨notify\");\n                      System.out.println(\"çº¿ç¨‹3 è°ƒç”¨å®Œnotifyåï¼Œä¼‘æ¯ä¸€ä¼š\");\n                      try {\n                          Thread.sleep(1000);\n                      } catch (InterruptedException e) {\n                      }\n                      System.out.println(\"çº¿ç¨‹3 ä¼‘æ¯å¤Ÿäº†ï¼Œç»“æŸåŒæ­¥ä»£ç å—\");\n                  }\n              }\n          }, \"çº¿ç¨‹3\").start();\n      }\n  }\n  ```\n\n### wait()å’Œsleep()çš„åŒºåˆ«\n\nè¿™ä¹Ÿæ˜¯ä¸€é“é¢è¯•å¸¸é—®çš„é¢˜\n\nâ‘  é¦–å…ˆ`sleep()`æ˜¯çº¿ç¨‹Threadçš„é™æ€æ–¹æ³•ï¼Œ`wait()`æ˜¯`Object`ç±»çš„å®ä¾‹æ–¹æ³•\n\nâ‘¡`sleep()`ä¸ä¼šé‡Šæ”¾é”å¯¹è±¡ï¼Œ`wait()`ä¼šé‡Šæ”¾é”å¯¹è±¡ï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒé‡è¦\n\nâ‘¢ æ‰¿æ¥ç¬¬äºŒç‚¹ï¼Œ`wait()`ä¼šé‡Šæ”¾é”ï¼Œä½†æ˜¯è¦æ˜¯ä½ æ²¡æœ‰é”å‘¢ï¼Ÿå…¶å®å°±æ˜¯ä¸Šé¢è¯­æ³•å±‚é¢è¯´åˆ°çš„ï¼Œæ‰€ä»¥è°ƒç”¨`wait()`å¿…é¡»è¦`æŒæœ‰`é”å¯¹è±¡å¦åˆ™å°±ä¼šæŠ¥`IllegalMonitorStateException`\n\nâ‘£`sleep()`ä¸éœ€è¦è¢«å”¤é†’`timeout`åä¼šè‡ªåŠ¨é†’æ¥ï¼Œè€Œ`wait()`éœ€è¦è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ï¼ˆ`wait(long time)`é™¤å¤–ï¼‰\n\n### çº¿ç¨‹é€šè®¯ç»¼åˆæ¡ˆä¾‹\n\næ§åˆ¶åŒä¸€æ—¶é—´æ‰§è¡ŒåŒä¸€æ–¹æ³•çº¿ç¨‹çš„æ•°é‡\n\n```java\npublic class ControlThreadNum {\n\n    private static final LinkedList THREADS = new LinkedList<>();\n\n    private final static int MAX_THREAD = 5;\n\n    public static void main(String[] args) {\n        long start = System.currentTimeMillis();\n        List<Thread> worker = new ArrayList();\n        //åˆ›å»ºäº†åä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯æ§åˆ¶æ¯æ¬¡æœ€å¤šåŒæ—¶è¿è¡Œçš„åªæœ‰5ä¸ª\n        Arrays.asList(\"M1\", \"M2\", \"M3\", \"M4\", \"M5\", \"M6\", \"M7\", \"M8\", \"M9\", \"M10\").stream().map(ControlThreadNum::captureThread).forEach(t -> {\n            t.start();\n            worker.add(t);\n        });\n        //mainçº¿ç¨‹ç­‰å¾…workerçš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ\n        worker.stream().forEach(thread -> {\n            try {\n                thread.join();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n        Optional.of(\"All capture is done\").ifPresent(System.out::println);\n        Optional.of(System.currentTimeMillis() - start).ifPresent(System.out::println);\n    }\n\n    private static Thread captureThread(String name) {\n        return new Thread(() -> {\n            Optional.of(\"Thread \" + Thread.currentThread().getName() + \"  is begin\").ifPresent(System.out::println);\n            synchronized (THREADS) {\n                while (THREADS.size() >= MAX_THREAD) {\n                    try {\n                        THREADS.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                //THREADS åªæ˜¯ç”¨æ¥æ§åˆ¶æ•°é‡&é” å…ƒç´ æ˜¯ä»€ä¹ˆå¹¶ä¸é‡è¦\n                THREADS.addLast(1);\n            }\n            //åˆ°è¿™é‡Œæ˜¯å¹¶è¡Œ\n            Optional.of(\"Thread \" + Thread.currentThread().getName() + \"  is running\").ifPresent(System.out::println);\n            try {\n                Thread.sleep(10000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n\n            synchronized (THREADS) {\n                Optional.of(\"Thread \" + Thread.currentThread().getName() + \"  is end\").ifPresent(System.out::println);\n                THREADS.removeLast();\n                THREADS.notifyAll();\n            }\n        }, name);\n    }\n}\n```\n\nè¿™é‡Œä¸€å¼€å§‹ä¸€å…±åˆ›å»ºäº†10ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ—¶å€™ä¼šæ§åˆ¶`running`çš„ä¸ªæ•°å°äº5ä¸ªï¼Œ`runnning`çº¿ç¨‹ä¸ªæ•°ç”¨ä¸€ä¸ª`LinkList`è®°å½•ï¼Œè‹¥`size()>=5`å°±è¿›å…¥`wait`ç„¶åå¦‚æœæœ‰çº¿ç¨‹`end`å°±ä¼š`notifyAll`å”¤é†’è¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚\n\n```java\nThread M2  is begin\nThread M3  is begin\nThread M2  is running\nThread M1  is begin\nThread M1  is running\nThread M3  is running\nThread M4  is begin\nThread M4  is running\nThread M5  is begin\nThread M6  is begin\nThread M5  is running\nThread M7  is begin\nThread M8  is begin\nThread M9  is begin\nThread M10  is begin\nThread M3  is `end`\nThread M10  is running\nThread M5  is `end`\nThread M1  is `end`\nThread M2  is `end`\nThread M4  is `end`\nThread M6  is running\nThread M7  is running\nThread M9  is running\nThread M8  is running\nThread M10  is end\nThread M8  is end\nThread M9  is end\nThread M7  is end\nThread M6  is end\nAll capture is done\n20124\n```\n\nè¿™æ ·å°±æ˜¯å…¶å®å°±æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œçº¿ç¨‹å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œçº¿ç¨‹åˆ›å»ºå¤ªå¤šï¼Œå°±ä¼šè¾¾åˆ°ç“¶é¢ˆï¼Œæ•ˆç‡åè€Œä¼šé™ä½ï¼Œå› ä¸ºæ—¶é—´éƒ½æ¶ˆè€—åœ¨äº†`çº¿ç¨‹åˆ‡æ¢`ä¸Šäº†ï¼Œå½“ç„¶è¿™æ˜¯åœ¨æ²¡æœ‰`çº¿ç¨‹æ± `çš„æƒ…å†µä¸‹ï¼Œåé¢ç”¨`çº¿ç¨‹æ± `å°±ä¸ä¼šè¿™ä¹ˆéº»çƒ¦äº†ã€‚\n\n### wait()/notifyçš„å¼€é”€åŠé—®é¢˜\n\n**è¿‡æ—©å”¤é†’** \n\n æ¯”å¦‚ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ä¸­ç”Ÿäº§è€…ç”Ÿäº§åå”¤é†’äº†ç”Ÿäº§è€…ï¼Œå…¶å®å°±æ˜¯è¿‡æ—©å”¤é†’äº†ï¼Œè¿‡æ—©å”¤é†’ä½¿å¾—é‚£äº›æœ¬æ¥æ— é¡»è¢«å”¤é†’çš„ç­‰å¾…çº¿ç¨‹ä¹Ÿè¢«å”¤é†’äº†ï¼Œä»è€Œé€ æˆèµ„æºæµªè´¹ã€‚è¿™å°±å¥½æ¯”ä½ åœ¨äººç¾¤é‡Œå¤§å–Šä¸€å£°â€œç¾å¥³â€ï¼Œä¾¿ä¼šæœ‰è®¸å¤šè‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½çš„å¥³æ€§å›å¤´ä¸€æ ·â€”â€”å°½ç®¡ä½ è¦å–Šçš„ä»…ä»…æ˜¯å…¶ä¸­æŸä¸€ä¸ªäººï¼Œä½†å¤§å®¶å´éƒ½ä»¥ä¸ºä½ æ˜¯åœ¨å–Šè‡ªå·±ã€‚è¿‡æ—©å”¤é†’é—®é¢˜å¯ä»¥åˆ©ç”¨JDK\n1.5å¼•å…¥çš„`java.util.concurrent.locks.Condition`æ¥å£æ¥è§£å†³ï¼Œåé¢çš„æ–‡ç« ä¼šè®²åˆ°ã€‚\n\n**ä¿¡å·ä¸¢å¤±**\n\nä¿¡å·ä¸¢å¤±ï¼ˆMissed Signalï¼‰é—®é¢˜ã€‚å¦‚æœç­‰å¾…çº¿ç¨‹åœ¨æ‰§è¡Œ`Object.wait()`å‰æ²¡æœ‰å…ˆåˆ¤æ–­ä¿æŠ¤æ¡ä»¶æ˜¯å¦å·²ç„¶æˆç«‹ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å½¢â€”â€”é€šçŸ¥çº¿ç¨‹åœ¨è¯¥ç­‰å¾…çº¿ç¨‹è¿›äººä¸´ç•ŒåŒºä¹‹å‰å°±å·²ç»æ›´æ–°äº†ç›¸å…³å…±äº«å˜é‡ï¼Œä½¿å¾—ç›¸åº”çš„ä¿æŠ¤æ¡ä»¶æˆç«‹å¹¶è¿›è¡Œäº†é€šçŸ¥ï¼Œä½†æ˜¯æ­¤æ—¶ç­‰å¾…çº¿ç¨‹è¿˜æ²¡æœ‰è¢«æš‚åœï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ‰€è°“å”¤é†’äº†ã€‚è¿™å°±å¯èƒ½é€ æˆç­‰å¾…çº¿ç¨‹ç›´æ¥æ‰§è¡Œ`Object.wait()`è€Œè¢«æš‚åœçš„æ—¶å€™ï¼Œè¯¥çº¿ç¨‹ç”±äºæ²¡æœ‰å…¶ä»–çº¿ç¨‹è¿›è¡Œé€šçŸ¥è€Œä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚è¿™ç§ç°è±¡å°±ç›¸å½“äºç­‰å¾…çº¿ç¨‹é”™è¿‡äº†ä¸€ä¸ªæœ¬æ¥â€œå‘é€â€ç»™å®ƒçš„â€œä¿¡å·â€ï¼Œå› æ­¤è¢«ç§°ä¸ºä¿¡å·ä¸¢å¤±ï¼ˆMissed Signalï¼‰ã€‚åªè¦å°†å¯¹ä¿æŠ¤æ¡ä»¶çš„åˆ¤æ–­å’Œ`Object.wait()`è°ƒç”¨æ”¾åœ¨ä¸€ä¸ªå¾ªç¯è¯­å¥ä¹‹ä¸­å°±å¯ä»¥é¿å…ä¸Šè¿°åœºæ™¯çš„ä¿¡å·ä¸¢å¤±ã€‚ä¿¡å·ä¸¢å¤±çš„å¦å¤–ä¸€ä¸ªè¡¨ç°æ˜¯åœ¨åº”è¯¥è°ƒç”¨`Object.notifyAll()` çš„åœ°æ–¹å´è°ƒç”¨äº†`Object.notify()`ã€‚æ¯”å¦‚ï¼Œå¯¹äºä½¿ç”¨åŒä¸€ä¸ªä¿æŠ¤æ¡ä»¶çš„å¤šä¸ªç­‰å¾…çº¿ç¨‹ï¼Œå¦‚æœé€šçŸ¥çº¿ç¨‹åœ¨ä¾¦æµ‹åˆ°è¿™ä¸ªä¿æŠ¤æ¡ä»¶æˆç«‹åè°ƒç”¨çš„æ˜¯`Object.notify()`ï¼Œé‚£ä¹ˆè¿™äº›ç­‰å¾…çº¿ç¨‹æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å”¤é†’ï¼Œç”šè‡³ä¸€ä¸ªä¹Ÿæ²¡æœ‰è¢«å”¤é†’â€”â€”è¢«å”¤é†’çš„çº¿ç¨‹æ˜¯`Object.notify()`æ‰€å±å¯¹è±¡ä¸Šä½¿ç”¨å…¶ä»–ä¿æŠ¤æ¡ä»¶çš„ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡é€šçŸ¥çº¿ç¨‹åœ¨è°ƒç”¨`Object.notify()`å‰å¯èƒ½è€ƒè™‘ï¼ˆåˆ¤æ–­ï¼‰äº†æŸä¸ªç‰¹å®šçš„ä¿æŠ¤æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œä½†æ˜¯`Object.notify()`æœ¬èº«åœ¨å…¶å”¤é†’çº¿ç¨‹æ—¶æ˜¯ä¸è€ƒè™‘ä»»ä½•ä¿æŠ¤æ¡ä»¶çš„ï¼è¿™å°±å¯èƒ½ä½¿å¾—é€šçŸ¥çº¿ç¨‹æ‰§è¡Œ`Object.notify()`è¿›è¡Œçš„é€šçŸ¥å¯¹äºä½¿ç”¨ç›¸åº”ä¿æŠ¤æ¡ä»¶çš„ç­‰å¾…çº¿ç¨‹æ¥è¯´ä¸¢å¤±äº†ã€‚è¿™ç§æƒ…å½¢ä¸‹ï¼Œé¿å…ä¿¡å·ä¸¢å¤±çš„ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨å¿…è¦çš„æ—¶å€™ä½¿ç”¨`Object.notifyAll()`æ¥é€šçŸ¥ã€‚æ€»çš„æ¥è¯´ï¼Œä¿¡å·ä¸¢å¤±æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä»£ç é”™è¯¯ï¼Œè€Œä¸æ˜¯Javaæ ‡å‡†åº“APIè‡ªèº«çš„é—®é¢˜ã€‚\n\n**æ¬ºéª—æ€§å”¤é†’**\n\nç”±äºè«åå…¶å¦™çš„åŸå› ï¼Œçº¿ç¨‹æœ‰å¯èƒ½åœ¨æ²¡æœ‰è°ƒç”¨è¿‡`notify()`å’Œ`notifyAll()`çš„æƒ…å†µä¸‹é†’æ¥ã€‚è¿™å°±æ˜¯æ‰€è°“çš„å‡å”¤é†’ï¼ˆspurious wakeupsï¼‰ï¼Œæ— ç«¯ç«¯åœ°é†’è¿‡æ¥äº†ï¼Œç„¶è€Œæ­¤æ—¶å¯èƒ½ä¿æŠ¤æ¡ä»¶å¹¶æ²¡æœ‰æˆç«‹ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³åŒæ ·æ˜¯è®² ä¿æŠ¤æ¡ä»¶å’Œwaitæ”¾åœ¨ä¸´ç•ŒåŒºå†…åŒä¸€ä¸ªå¾ªç¯ä½“å†…å°±å¯ä»¥äº†ã€‚\n\n**ä¸Šä¸‹æ–‡åˆ‡æ¢**\n\nâ€‹\té¦–å…ˆï¼Œç­‰å¾…çº¿ç¨‹æ‰§è¡Œ`Object.wait()`è‡³å°‘ä¼šå¯¼è‡´è¯¥çº¿ç¨‹å¯¹ç›¸åº”å¯¹è±¡å†…éƒ¨é”çš„ä¸¤æ¬¡ç”³è¯·ä¸é‡Šæ”¾ã€‚é€šçŸ¥çº¿ç¨‹åœ¨æ‰§è¡Œ`Object.notify()/notifyAll()`æ—¶éœ€è¦æŒæœ‰ç›¸åº”å¯¹è±¡çš„å†…éƒ¨é”ï¼Œå› æ­¤`Object.notify()/notifyAll()`è°ƒç”¨ä¼šå¯¼è‡´ä¸€æ¬¡é”çš„ç”³è¯·ã€‚è€Œé”çš„ç”³è¯·ä¸é‡Šæ”¾å¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\n\nâ€‹\tå…¶æ¬¡ï¼Œç­‰å¾…çº¿ç¨‹ä»è¢«æš‚åœåˆ°å”¤é†’è¿™ä¸ªè¿‡ç¨‹æœ¬èº«å°±ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\n\nâ€‹\tå†æ¬¡ï¼Œè¢«å”¤é†’çš„ç­‰å¾…çº¿ç¨‹åœ¨ç»§ç»­è¿è¡Œæ—¶éœ€è¦å†æ¬¡ç”³è¯·ç›¸åº”å¯¹è±¡çš„å†…éƒ¨é”ï¼Œæ­¤æ—¶ç­‰å¾…çº¿ç¨‹å¯èƒ½éœ€è¦å’Œç›¸åº”å¯¹è±¡çš„å…¥å£é›†ä¸­çš„å…¶ä»–çº¿ç¨‹ä»¥åŠå…¶ä»–æ–°æ¥çš„æ´»è·ƒçº¿ç¨‹ï¼ˆå³ç”³è¯·ç›¸åº”çš„å†…éƒ¨é”ä¸”å¤„äºRUNNABLEçŠ¶æ€çš„çº¿ç¨‹ï¼‰äº‰ç”¨ç›¸åº”çš„å†…éƒ¨é”ï¼Œè€Œè¿™åˆå¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\næœ€åï¼Œè¿‡æ—©å”¤é†’é—®é¢˜ä¹Ÿä¼šå¯¼è‡´é¢å¤–çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™æ˜¯å› ä¸ºè¢«è¿‡æ—©å”¤é†’çš„çº¿ç¨‹ä»ç„¶éœ€è¦ç»§ç»­ç­‰å¾…ï¼Œå³å†æ¬¡ç»å†è¢«æš‚åœå’Œå”¤é†’çš„è¿‡ç¨‹ã€‚\n\n[æ›´å¤šå‚è€ƒ](http://ifeve.com/thread-signaling/)\n\n## 13.æ‰‹å†™ä¸€ä¸ªBooleanLock\n\n`Synchronized`çš„ç¼ºç‚¹å…¶å®å¾ˆæ˜æ˜¾ï¼Œå½“å¤šä¸ªçº¿ç¨‹ç«äº‰é”çš„æ—¶å€™ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°é”åå…¶ä»–çš„çº¿ç¨‹åªèƒ½å‚»å‚»çš„ç­‰ç€ï¼Œè¿™æ ·ä¼šå½±å“æ•ˆç‡ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è‡ªå·±ç®€å•æ‰‹å†™ä¸€ä¸ªé™åˆ¶ç­‰å¾…æ—¶é—´çš„é”ã€‚\n\n### LOCKæ¥å£\n\n```java\npublic interface Lock {\n\n    class TimeOutException extends Exception {\n        public TimeOutException(String message) {\n            super(message);\n        }\n    }\n\n    void lock() throws InterruptedException;\n\n    void lock(long time) throws InterruptedException,TimeOutException;\n\n    void unLock() throws InterruptedException;\n\n    Collection<Thread> getBlockThread();\n}\n```\n\nå®šä¹‰äº†ä¸€ä¸ª`TimeOutException`\n\n### BooleanLockå®ç°ç±»\n\n```java\npublic class BooleanLock implements Lock {\n\n    //false indicated free\n    private boolean initValue;\n    //åŠ é”çš„çº¿ç¨‹\n    private Thread lockedThread;\n\n    private Collection<Thread> blockThreadCollection = new ArrayList<>();\n\n    public BooleanLock() {\n        this.initValue = false;\n    }\n\n    @Override\n    public synchronized void lock() throws InterruptedException {\n        while (initValue) {\n            blockThreadCollection.add(Thread.currentThread());\n            System.out.println(Thread.currentThread().getName() + \" is wait\");\n            this.wait();\n        }\n        blockThreadCollection.remove(Thread.currentThread());\n        this.initValue = true;\n        this.lockedThread = Thread.currentThread();\n    }\n\n    @Override\n    public synchronized void lock(long time) throws InterruptedException, TimeOutException {\n        if (time <= 0) lock();\n        long remainTime=time;\n        long endTime=System.currentTimeMillis()+time;\n        while (initValue){\n            if(remainTime<=0){\n                throw new TimeOutException(\"time is out\");\n            }\n            blockThreadCollection.add(Thread.currentThread());\n            this.wait(time);\n            remainTime=endTime-System.currentTimeMillis();\n        }\n        this.initValue=true;\n        this.lockedThread=Thread.currentThread();\n        blockThreadCollection.remove(Thread.currentThread());\n    }\n\n    @Override\n    public synchronized void unLock() {\n        //åˆ¤æ–­æ˜¯ä¸æ˜¯åŠ é”çš„çº¿ç¨‹\n        if (lockedThread == Thread.currentThread()) {\n            this.initValue = false;\n            this.notifyAll();\n            Optional.of(Thread.currentThread().getName() + \"  release the lock monitor\").ifPresent(System.out::println);\n        }\n    }\n\n    @Override\n    public Collection<Thread> getBlockThread() {\n        return Collections.unmodifiableCollection(blockThreadCollection);\n    }\n}\n```\n\n### æµ‹è¯•BooleanLockçš„æ•ˆæœ\n\n```java\npublic class LockTest {\n    public static void main(String[] args) {\n        final BooleanLock booleanLock = new BooleanLock();\n        Stream.of(\"t0\", \"t1\", \"t2\").forEach(name -> {\n            new Thread(() -> {\n                try {\n                    booleanLock.lock(10);\n                    Optional.of(Thread.currentThread().getName() + \" get the lock\").ifPresent(System.out::println);\n                    doSomething();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                } catch (Lock.TimeOutException e) {\n                    System.out.println(Thread.currentThread().getName()+\" Time out\");\n                    e.printStackTrace();\n                } finally {\n                    booleanLock.unLock();\n                }\n            }, name).start();\n        });\n        //mainçº¿ç¨‹é‡Šæ”¾é”ï¼Œä¸åº”è¯¥ï¼Œè°åŠ çš„é”åº”è¯¥ç”±è°å»é‡Šæ”¾é”\n        //booleanLock.unLock();\n    }\n\n    private static void doSomething() {\n        Optional.of(Thread.currentThread().getName() + \" is working...\").ifPresent(System.out::println);\n        try {\n            Thread.sleep(5000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nè¿™é‡Œè®¾ç½®åœ¨æŠ¢ä¸åˆ°é”çš„æ—¶å€™ï¼Œåªç­‰å¾…`10ms`ï¼Œç„¶å`doSomething`ä¼š`sleep`5000msï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŠ¢åˆ°é”åé¢çš„éƒ½ä¼šè¶…æ—¶ throw `TimeOutException`å…¸å‹çš„`é™æ—¶ç­‰å¾…`æ¨¡å‹\n\n```java\nt0 get the lock\nt0 is working...\n`base_thread_study.chaper10.Lock$TimeOutException: time is out`\n\tat base_thread_study.chaper10.BooleanLock.lock(BooleanLock.java:41)\n\tat base_thread_study.chaper10.LockTest.lambda$null$0(LockTest.java:12)\n\tat java.lang.Thread.run(Thread.java:748)\n`base_thread_study.chaper10.Lock$TimeOutException: time is out`\n\tat base_thread_study.chaper10.BooleanLock.lock(BooleanLock.java:41)\n\tat base_thread_study.chaper10.LockTest.lambda$null$0(LockTest.java:12)\n\tat java.lang.Thread.run(Thread.java:748)\nt2 Time out\nt1 Time out\nt0  release the lock monitor\n```\n\n## 14.ç»™åº”ç”¨ç¨‹åºæ³¨å…¥é’©å­Hook\n\nå…³äº`Hook`æ˜¯ä»€ä¹ˆå°±ä¸å¤šä»‹ç»äº†ï¼Œè¿™é‡Œçš„é’©å­å’Œ`git`,`svn`é‡Œé¢çš„æ˜¯ä¸€æ ·çš„ï¼Œç±»ä¼¼çš„åœ¨ä½¿ç”¨`Tomcat`ç­‰æœåŠ¡çš„æ—¶å€™ï¼Œåœ¨ä½ å…³é—­å®ƒä¹‹åå®ƒä»ç„¶ä¼šæ‰“å°æ—¥å¿—å’Œé‡Šæ”¾ä¸€äº›èµ„æºï¼Œè¿™å°±æ˜¯`Hook`çš„ä¸€ç§ï¼Œå½“ç„¶`Hook`æœ‰å¤šç§ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§ã€‚\n\n```java\npublic class ExitCap{\n\tpublic static void main(String []arg){\n\tint i=0;\n\tRuntime.getRuntime().addShutdownHook(new Thread(()->{\n   \t    System.out.println(\"The test app will shutdown\");\n\t    notifyAndRelease();\n\t}));\n\twhile(true){\n\t\ttry{\n\t\tThread.sleep(1000);\n\t\tSystem.out.println(\"i am working\");\n\t\t}catch(Exception e){\n\t\t //donothing\n\t\t}\n\t\tif(i>10){\n\t\t   throw new RuntimeException();\n\t\t}\n\t\ti++;    \n\t}\n    }\n\n    public static void notifyAndRelease(){\n\tSystem.out.println(\"notify to admin\");\n    \t\n\ttry{\n\tThread.sleep(1000);\n\t}catch(Exception e){}\n\t\n\tSystem.out.println(\"release the resources(socker. file, connection.)\");\n\t\n\ttry{\n        Thread.sleep(1000);\n        }catch(Exception e){}\n\t\n\tSystem.out.println(\"release and notify done\");\n    }\n}\n\n```\n\nè¿™é‡Œæ˜¯åœ¨`Linux`ä¸Šè¿›è¡Œçš„æµ‹è¯•ï¼Œå› ä¸ºæ•ˆæœæ¯”è¾ƒæ˜æ˜¾ï¼Œé¡ºä¾¿ä¹Ÿç†Ÿæ‚‰ä¸‹`Linux`çš„å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„é’©å­å°±æ˜¯é€šè¿‡`Runtime.getRuntime().addShutdownHook()`æ³¨å…¥äº†ä¸€ä¸ª`Thread`è¿›å»çš„ï¼Œè¿™æ ·å°±ä¼šæ£€æµ‹åˆ°ç¨‹åºçš„é€€å‡ºå¹¶è§¦å‘`Hook`åšä¸€äº›é‡Šæ”¾èµ„æºä¹‹ç±»çš„å·¥ä½œã€‚\n\n```java\ni am working\ni am working\ni am working\ni am working\ni am working\ni am working\ni am working\ni am working\ni am working\ni am working\ni am working\nException in thread \"main\" java.lang.RuntimeException\n\tat base_thread_study.chaper10.ExitCap.main(ExitCap.java:18)\ni am working\n`The test app will shutdown`\n`notify to admin`\n`release the resources(socker. file, connection.)`\n`release and notify done`\n```\n\nä¸Šé¢æ˜¯åœ¨æ­£å¸¸æƒ…å†µä¸‹ç»ˆæ­¢çº¿ç¨‹æ¯”å¦‚ `å¼‚å¸¸`ï¼Œ`ctrl C`æˆ–è€… `kill pid`å¦‚æœä½¿ç”¨ `kill -9 pid`å°±ä¸ä¼šè§¦å‘é’©å­ï¼Œå¼ºåˆ¶åœæ­¢ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®ç”¨`kill -9`\n\n## 15.æ•è·çº¿ç¨‹çš„Runtimeå¼‚å¸¸\n\nåœ¨Javaå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä¸å…è®¸æŠ›å‡ºæœªæ•è·çš„`checked exception`(æ¯”å¦‚sleepçš„InterruptException)ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªçº¿ç¨‹å¿…é¡»è‡ªå·±æŠŠè‡ªå·±çš„`checked exception`å¤„ç†æ‰ï¼Œä½†æ˜¯å¦‚æœæ˜¯`unchecked exception `å‘¢ï¼Ÿä¸»è¦å°±æ˜¯æŒ‡`RuntimeException`æ­¤ç±»å¼‚å¸¸æŠ›å‡ºæ—¶è¯¥çº¿ç¨‹ä¼š`shutdown`ä½†æ˜¯å…¶å®ƒçº¿ç¨‹ä¸å—å½±å“ä¹Ÿæ— æ³•æ„ŸçŸ¥åˆ°è¿™ä¸ªå¼‚å¸¸ï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­\n\n```java\npublic class ThreadException {\n    public static void main(String[] args) {\n        Thread thread = null;\n        try {\n            thread=new Thread(()->{\n                int res=1/0;\n            });\n            thread.start();\n        }catch (Exception e){\n            System.out.println(\"æ•è·åˆ°å¼‚å¸¸\");\n        }\n    }\n}\n```\n\næ§åˆ¶å°è¾“å‡º`mainçº¿ç¨‹`å¹¶æ²¡æœ‰æ•è·åˆ°å¼‚å¸¸ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„ç†å¿µï¼Œæ¯ä¸ªçº¿ç¨‹çš„äº‹æƒ…åº”è¯¥ç”±çº¿ç¨‹è‡ªå·±å»å¤„ç†ä¸åº”è¯¥ç”±å…¶ä»–çº¿ç¨‹å»å¹²æ‰°ï¼Œæ­£å¦‚`stop/resume/suspend`è¿™äº›æ–¹æ³•è¢«å¼ƒç”¨çš„åŸå› ã€‚ä½†æ˜¯è¿™äº›å¼‚å¸¸å¦‚æœä¸å»å¤„ç†å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸¥é‡çš„åæœï¼ŒJDK1.5ä¹‹åå®˜æ–¹ä¹Ÿæä¾›äº†APIå»å¤„ç†çº¿ç¨‹çš„å¼‚å¸¸ã€‚setDefaultUncaughtExceptionHandler()å’ŒsetUncaughtExceptionHandler()å‰è€…æ˜¯`Thread`çš„é™æ€æ–¹æ³•ï¼Œç”¨äºç»™æ‰€æœ‰çš„çº¿ç¨‹è®¾ç½®é»˜è®¤çš„å¼‚å¸¸å¤„ç†ï¼Œåè€…æ˜¯å®ä¾‹æ–¹æ³•ï¼Œé’ˆå¯¹æ¯ä¸ªçº¿ç¨‹ä¼šç»™æ¯ä¸ªçº¿ç¨‹åŠ ä¸Šä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œå¦‚ä¸‹Demo\n\n```java\npublic class ThreadException {\n    private static int A = 10;\n    private static int B = 0;\n\n    public static void main(String[] args) {\n        Thread thread = new Thread(() -> {\n              int res = A / B;\n            }\n        );\n        //æœ€å¥½åœ¨startå‰è®¾ç½®å¼‚å¸¸å¤„ç†å™¨ï¼Œæ”¾åœ¨åé¢å¯èƒ½ä¼šèµ·ä¸åˆ°ä½œç”¨ã€‚\n        thread.setUncaughtExceptionHandler((t, e) -> {\n            System.out.println(t.getName());\n            System.out.println(e);\n        });\n        thread.start();\n    }\n}\n```\n\n> `Thread-0`\n> `java.lang.ArithmeticException: / by zero`\n\nå¯ä»¥çœ‹åˆ°å·²ç»æ•è·åˆ°äº†è¿™ä¸ªå¼‚å¸¸ï¼Œå½“çº¿ç¨‹é‡åˆ°æœªæ•è·çš„å¼‚å¸¸è€Œç»“æŸæ—¶ä¼šè°ƒç”¨`UncaughtExceptionHandler` å¤„ç†ä¸€äº›\"åäº‹\"å’Œé‡Šæ”¾ä¸€äº›å®è´µçš„èµ„æºï¼Œ`setUncaughtExceptionHandler`å»ºè®®æ”¾åœ¨çº¿ç¨‹startä¹‹å‰ï¼Œä¸ç„¶å¯èƒ½èµ·ä¸åˆ°ä½œç”¨ã€‚\n\n## 16.ThreadGroupçº¿ç¨‹ç»„\n\n### è·å–çº¿ç¨‹ç»„ä¿¡æ¯\n\n```java\npublic class ThreadGroupAPI {\n    public static void main(String[] args) {\n        ThreadGroup tgp = new ThreadGroup(\"TGP1\");\n        Thread t = new Thread(tgp, \"t0\") {\n            @Override\n            public void run() {\n                while (true) {\n                    try {\n                        System.out.println(getThreadGroup().getName());\n                        System.out.println(getThreadGroup().getParent());\n                        //å¯ä»¥è®¿é—®ï¼Œæ–‡æ¡£ä¸Šè¯´ä¸è¡Œ\n                        System.out.println(getThreadGroup().getParent().activeCount());\n                        Thread.sleep(10000);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n        };\n        t.start();\n\n        ThreadGroup tgp2 = new ThreadGroup(\"TGP2\");\n        Thread t1 = new Thread(tgp2, \"t0\") {\n            @Override\n            public void run() {\n                System.out.println(tgp.getName());\n                System.out.println(tgp.activeCount());\n                Thread[] threads=new Thread[tgp.activeCount()];\n                tgp.enumerate(threads);\n                //ä¹Ÿå¯ä»¥è®¿é—®\n                Arrays.asList(threads).forEach(System.out::println);\n            }\n        };\n        t1.start();\n        //System.out.println(tgp2.getName());\n        //System.out.println(tgp2.getParent().getName());\n    }\n}\n```\n\næ–‡æ¡£ä¸Šè¯´çš„ä¸èƒ½è®¿é—®å…¶ä»–çº¿ç¨‹ç»„çš„ä¿¡æ¯ï¼Œè¿™é‡Œæµ‹è¯•çš„å‡ ä¸ªéƒ½å¯ä»¥ï¼Œå¯èƒ½æè¿°æœ‰ç‚¹é—®é¢˜ï¼Œ`çº¿ç¨‹ç»„`çš„åˆ›å»ºç±»ä¼¼äº`çº¿ç¨‹`çš„åˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®šçº¿ç¨‹ç»„éƒ½ä¼šé»˜è®¤åŠ åˆ°çˆ¶çº¿ç¨‹çš„çº¿ç¨‹ç»„ä¸­ã€‚\n\n### æ‰“æ–­çº¿ç¨‹ç»„interrupt()\n\n> Interrupts all threads in this thread group.\n>\n> First, the <code>checkAccess</code> method of this thread group is\n>\n> called with no arguments; this may result in a security exception.\n>\n> This method then calls the <code>interrupt</code> method on all the\n>\n> threads in this thread group and in `all of its subgroups.`\n\næ‰“æ–­è¯¥çº¿ç¨‹ç»„é‡Œé¢æ‰€æœ‰çš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬å­çº¿ç¨‹ç»„çš„çº¿ç¨‹ã€‚\n\n### çº¿ç¨‹ç»„setDaemon()\n\nå’Œçº¿ç¨‹çš„`setDaemon`ä¸ä¸€æ ·ã€‚\n\n> Changes the daemon status of this thread group.\n>\n> First, the <code>checkAccess</code> method of this thread group is\n>\n> called with no arguments; this may result in a security exception.\n>\n> A daemon thread group is `automatically` `destroyed` when its last\n>\n> thread is stopped or its `last thread group is destroyed`.\n\nå½“æœ€åä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨é”€æ¯çº¿ç¨‹ç»„ï¼Œå½“ç„¶ä¸å…¶å¯¹åº”çš„ä¹Ÿæœ‰æ‰‹åŠ¨é”€æ¯çš„æ–¹æ³•`destroy()`è¿™ä¸ªæ–¹æ³•å¦‚æœçº¿ç¨‹æ²¡æ‰§è¡Œå®Œæ¯•å°±è°ƒç”¨ä¼šæŠ›`IllegalThreadStateException`ï¼Œå…¶ä»–çš„æ–¹æ³•è¯¦ç»†å¯ä»¥å‚è€ƒæ–‡æ¡£ã€‚\n\n## 17.çº¿ç¨‹æ± \n\n### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± \n\n åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¼€é”€å¤§ï¼Œåˆ©ç”¨å¥½çº¿ç¨‹æ± å¯ä»¥é¿å…cpuèŠ±è´¹ä¸å¿…è¦çš„æ—¶é—´åœ¨è¿™ä¸Šé¢ï¼Œä»è€Œä¸“æ³¨äºå…·ä½“çš„ä»»åŠ¡:)\n\nåŸºæœ¬çš„çº¿ç¨‹æ± åŒ…æ‹¬ä¸‹é¢å‡ éƒ¨åˆ†ï¼š\n\nâ‘ ä»»åŠ¡é˜Ÿåˆ—\n\nâ‘¡æ‹’ç»ç­–ç•¥(æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥ä¸¢å¼ƒï¼Œé˜»å¡ï¼Œä¸´æ—¶é˜Ÿåˆ—)\n\nâ‘¢`init`(`min`)åˆå§‹å¤§å°\n\nâ‘£`active`ä¸­é—´å¸¸æ€å¤§å°\n\nâ‘¤`max`æœ€å¤§ä¸ªæ•°ï¼Œè¶…è¿‡å°±ä¼šåŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡å°±ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥\n\n> min<=active<=max\n\n### æ‰‹å†™çº¿ç¨‹æ± \n\n#### ä¸´æ—¶é˜Ÿåˆ—\n\n```java\npublic class SimpleThreadPool {\n    //çº¿ç¨‹æ± å¤§å°\n    private final int size;\n    //é»˜è®¤å¤§å°\n    private final static int DEFAULT_SIZE = 10;\n\t//ä»»åŠ¡é˜Ÿåˆ—\n    private final static LinkedList<Runnable> TASK_QUEUE = new LinkedList<>();\n\t//çº¿ç¨‹åºå·\n    private static volatile int seq = 0;\n\t//çº¿ç¨‹ç»„\n    private final static ThreadGroup GROUP = new ThreadGroup(\"Pool_Group\");\n\t//çº¿ç¨‹å‰ç¼€å\n    private final static String THREAD_PREFIX = \"SIMPLE_THREAD_POOL-\";\n\t//çº¿ç¨‹é˜Ÿåˆ—\n    private final static List<MyThread> THREAD_QUEUE = new ArrayList<>();\n\n    public SimpleThreadPool(int size) {\n        this.size = size;\n        init();\n    }\n\n    public SimpleThreadPool() {\n        this(DEFAULT_SIZE);\n    }\n\n    private void init() {\n        for (int i = 0; i < size; i++) {\n            createThreadQueue();\n        }\n    }\n\t\n    //æš´éœ²å¯¹å¤–çš„æ¥å£ï¼Œæäº¤ä»»åŠ¡é˜Ÿåˆ—\n    public void submit(Runnable runnable) {\n        synchronized (TASK_QUEUE) {\n            TASK_QUEUE.addLast(runnable);\n            //å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹\n            TASK_QUEUE.notifyAll();\n        }\n    }\n\n    private void createThreadQueue() {\n        MyThread thread = new MyThread(GROUP, THREAD_PREFIX + (seq++));\n        thread.start();\n        THREAD_QUEUE.add(thread);\n    }\n\n    private enum ThreadState {\n        FREE, RUNNING, BLOCKED, DEAD\n    }\n\t\n    //åŒ…è£…çš„çº¿ç¨‹ç±»\n    private static class MyThread extends Thread {\n        private volatile ThreadState threadState = ThreadState.FREE;\n\n        public ThreadState getThreadState() {\n            return this.threadState;\n        }\n\n        public MyThread(ThreadGroup group, String name) {\n            super(group, name);\n        }\n\n        @Override\n        public void run() {\n            OUTER:\n            while (this.threadState != ThreadState.DEAD) {\n                //å½“å‰çº¿ç¨‹æ²¡æœ‰dead\n                Runnable runnable;\n                synchronized (TASK_QUEUE) {\n                    while (TASK_QUEUE.isEmpty()) {\n                        //ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå…¨å‘˜wait\n                        try {\n                            this.threadState = ThreadState.BLOCKED;\n                            TASK_QUEUE.wait();\n                        } catch (InterruptedException e) {\n                            System.out.println(\"break\");\n                            break OUTER;\n                        }\n                    }\n                    runnable = TASK_QUEUE.removeFirst();\n                }\n                //è¿™é‡Œåº”è¯¥å¹¶è¡Œ\n                Optional.of(runnable).ifPresent(t -> {\n                    this.threadState = ThreadState.RUNNING;\n                    t.run();\n                    this.threadState = ThreadState.FREE;\n                });\n            }\n        }\n\n        public void close() {\n            this.threadState = ThreadState.DEAD;\n        }\n    }\n}\n```\n\næœ€å¼€å§‹å®ç°çš„æ—¶å€™`synchronized`çš„èŒƒå›´å¤ªå¤§ï¼Œå°†å…·ä½“çš„æ‰§è¡Œ`run`çš„è¿‡ç¨‹ä¹ŸåŒæ­¥äº†èµ·æ¥ï¼Œè¿™æ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼Œåªéœ€è¦åŒæ­¥å…±äº«å˜é‡å°±å¯ä»¥äº†ï¼ŒåŒæ­¥äº†åé¢çš„ä»£ç é‚£å°±è·Ÿå•çº¿ç¨‹ä¸€æ ·äº†ã€‚\n\n#### å…³é—­çº¿ç¨‹æ± &æ‹’ç»ç­–ç•¥\n\n```java\npublic class SimpleThreadPool {\n    //çº¿ç¨‹æ± å¤§å°\n    private final int size;\n\t//ä»»åŠ¡é˜Ÿåˆ—å¤§å°\n    private final int queueSize;\n\t//é»˜è®¤çº¿ç¨‹æ± å¤§å°\n    private final static int DEFAULT_SIZE = 10;\n\t//çº¿ç¨‹æ± ä¸­çº¿ç¨‹ç¼–å·\n    private static volatile int seq = 0;\n\t//é»˜è®¤ä»»åŠ¡é˜Ÿåˆ—çš„å¤§å°\n    private final static int DEFAULT_TASK_QUEUE_SIZE = 2000;\n\t//çº¿ç¨‹ç»„\n    private final static ThreadGroup GROUP = new ThreadGroup(\"Pool_Group\");\n\t//çº¿ç¨‹åå‰ç¼€\n    private final static String THREAD_PREFIX = \"SIMPLE_THREAD_POOL-\";\n\t//ä»»åŠ¡é˜Ÿåˆ—\n    private final static LinkedList<Runnable> TASK_QUEUE = new LinkedList<>();\n\t//çº¿ç¨‹é˜Ÿåˆ—\n    private final static List<MyThread> THREAD_QUEUE = new ArrayList<>();\n\t//æ‹’ç»ç­–ç•¥\n    private final DiscardPolicy discardPolicy;\n\t//çº¿ç¨‹æ¬¡æ˜¯å¦é”€æ¯\n    private volatile boolean destroy = false;\n\t//é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼ˆæŠ›å¼‚å¸¸ï¼‰\n    public final static DiscardPolicy DEFAULT_DISCARD_POLICY = () -> {\n        throw new DiscardException(\"Discard this Task!!!!(Default Policy)\");\n    };\n    public SimpleThreadPool(int size, int queueSize, DiscardPolicy discardPolicy) {\n        this.size = size;\n        this.queueSize = queueSize;\n        this.discardPolicy = discardPolicy;\n        init();\n    }\n\n    public SimpleThreadPool() {\n        this(DEFAULT_SIZE, DEFAULT_TASK_QUEUE_SIZE, DEFAULT_DISCARD_POLICY);\n    }\n\n    private void init() {\n        for (int i = 0; i < size; i++) {\n            createThreadQueue();\n        }\n    }\n\n    public void submit(Runnable runnable) {\n        if (destroy) {\n            throw new IllegalStateException(\"The Pool is shutdown , you can't submit now ! !\");\n        }\n        synchronized (TASK_QUEUE) {\n            if (TASK_QUEUE.size() > queueSize) {\n                discardPolicy.discard();\n            }\n            TASK_QUEUE.addLast(runnable);\n            //å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹\n            TASK_QUEUE.notifyAll();\n        }\n    }\n\n    public void shutdown() throws InterruptedException {\n        //åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º\n        while (!TASK_QUEUE.isEmpty()) {\n            Thread.sleep(50);\n        }\n        int initVal = THREAD_QUEUE.size();\n        while (initVal > 0) {\n            for (MyThread thread : THREAD_QUEUE) {\n                if (thread.getThreadState() == ThreadState.BLOCKED) {\n                    thread.close();\n                    thread.interrupt();\n                    initVal--;\n                } else {\n                    Thread.sleep(10);\n                }\n            }\n        }\n        this.destroy = true;\n        System.out.println(\"My Thread pool is shutdown\");\n    }\n\n    public boolean isDestroy() {\n        return this.destroy;\n    }\n\n    private void createThreadQueue() {\n        MyThread thread = new MyThread(GROUP, THREAD_PREFIX + (seq++));\n        thread.start();\n        THREAD_QUEUE.add(thread);\n    }\n\n\n    private enum ThreadState {\n        FREE, RUNNING, BLOCKED, DEAD\n    }\n\n    public static class DiscardException extends RuntimeException {\n        public DiscardException(String message) {\n            super(message);\n        }\n    }\n\n    @FunctionalInterface\n    public interface DiscardPolicy {\n        void discard() throws DiscardException;\n    }\n\n    private static class MyThread extends Thread {\n        private volatile ThreadState threadState = ThreadState.FREE;\n\n        public ThreadState getThreadState() {\n            return this.threadState;\n        }\n\n        public MyThread(ThreadGroup group, String name) {\n            super(group, name);\n        }\n\n        @Override\n        public void run() {\n            OUTER:\n            while (this.threadState != ThreadState.DEAD) {\n                Runnable runnable;\n                synchronized (TASK_QUEUE) {\n                    while (TASK_QUEUE.isEmpty()) {\n                        try {\n                            this.threadState = ThreadState.BLOCKED;\n                            TASK_QUEUE.wait();\n                        } catch (InterruptedException e) {\n                            System.out.println(Thread.currentThread().getName() + \" is dead\");\n                            break OUTER;\n                        }\n                    }\n                    runnable = TASK_QUEUE.removeFirst();\n                }\n                Optional.of(runnable).ifPresent(t -> {\n                    this.threadState = ThreadState.RUNNING;\n                    t.run();\n                    this.threadState = ThreadState.FREE;\n                });\n            }\n        }\n\n        private void close() {\n            this.threadState = ThreadState.DEAD;\n        }\n    }\n}\n\n```\n\n- `shutdown`æ–¹æ³•å®ç°\n\nâ‘ å…ˆè½®è¯¢ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºå°±ä¼šè®©`å½“å‰çº¿ç¨‹`ç­‰å¾…`çº¿ç¨‹é˜Ÿåˆ—`çš„çº¿ç¨‹æ‰§è¡Œå®Œæ‰€æœ‰ä»»åŠ¡ã€‚\n\nâ‘¡å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œéå†`çº¿ç¨‹é˜Ÿåˆ—`ï¼Œç„¶åæ‰“æ–­`BLOCK`çš„çº¿ç¨‹å¹¶ä¸”è®¾ç½®ä¸º`DEAD`çŠ¶æ€è·³å‡ºå¾ªç¯ï¼Œå› ä¸º`ä»»åŠ¡é˜Ÿåˆ—`ä¸ºç©º`çº¿ç¨‹é˜Ÿåˆ—`é‡Œé¢çš„çº¿ç¨‹éƒ½ä¼šåœ¨`TASK_QUEUE`ä¸Šé¢`BLOCK`ä½ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ç‰¹æ®Šæƒ…å†µï¼Œå¯èƒ½æŸä¸ªçº¿ç¨‹åˆšæ‹¿åˆ°æœ€åä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥ç¨å¾®ç­‰ä¸€ä¸‹ï¼Œç­‰å®ƒ`BLOCK`ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸ª`lg(N)-lg(N2)`çš„æ–¹æ³•\n\nâ‘¢è®¾ç½®`destory`çŠ¶æ€ä¸ºtrueï¼Œç„¶ååœ¨`submit`çš„æ—¶å€™ä¼šæ ¹æ®è¿™ä¸ªå˜é‡æ¥åˆ¤æ–­æ˜¯å¦å·²ç»é”€æ¯ï¼Œå¦‚æœå·²ç»é”€æ¯å°±ä¼šæŠ›å‡ºä¸€ä¸ª`RunntimeException`\n\n- `æ‹’ç»ç­–ç•¥`å®ç°\n\nè¿™é‡Œå®ç°äº†ä¸€ä¸ªÂ·é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨submitçš„æ—¶å€™åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä¸æ˜¯æ»¡çš„ï¼Œå¦‚æœæ»¡äº†å°±ç›´æ¥æŠ›å¼‚å¸¸ï¼Œè¿™é‡Œå¦‚æœç”¨è¿™ç§æ–¹å¼æ‹’ç»ï¼Œä¸€ä½†å‡ºç°å¼‚å¸¸`å½“å‰çº¿ç¨‹`å°±ä¼š`ç›´æ¥ç»“æŸ`å¯èƒ½å°±æ— æ³•å…³é—­è¿æ¥æ± ã€‚\n\n#### è‡ªåŠ¨æ‰©å®¹&é—²æ—¶å›æ”¶\n\n```java\npublic class SimpleThreadPool extends Thread {\n    //çº¿ç¨‹æ± å¤§å°\n    private int size;\n    //çº¿ç¨‹å¤§å°å˜åŒ–å€¼\n    private int min;\n    private int active;\n    private int max;\n    //é»˜è®¤å€¼\n    private final static int MIN = 4;\n    private final static int ACTIVE = 8;\n    private final static int MAX = 12;\n    //ä»»åŠ¡é˜Ÿåˆ—å¤§å°\n    private final int queueSize;\n\n    public int getMin() {\n        return min;\n    }\n\n    public int getActive() {\n        return active;\n    }\n\n    public int getMax() {\n        return max;\n    }\n\n    //çº¿ç¨‹æ± ä¸­çº¿ç¨‹ç¼–å·\n    private static volatile int seq = 0;\n    //é»˜è®¤ä»»åŠ¡é˜Ÿåˆ—çš„å¤§å°\n    private final static int DEFAULT_TASK_QUEUE_SIZE = 2000;\n\n    //çº¿ç¨‹ç»„\n    private final static ThreadGroup GROUP = new ThreadGroup(\"Pool_Group\");\n    //çº¿ç¨‹åå‰ç¼€\n    private final static String THREAD_PREFIX = \"SIMPLE_THREAD_POOL-\";\n    //ä»»åŠ¡é˜Ÿåˆ—\n    private final static LinkedList<Runnable> TASK_QUEUE = new LinkedList<>();\n    //çº¿ç¨‹é˜Ÿåˆ—\n    private final static List<MyThread> THREAD_QUEUE = new ArrayList<>();\n    //æ‹’ç»ç­–ç•¥\n    private final DiscardPolicy discardPolicy;\n    //çº¿ç¨‹æ± æ˜¯å¦é”€æ¯\n    private volatile boolean destroy = false;\n    //é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼ˆæŠ›å¼‚å¸¸ï¼‰\n    public final static DiscardPolicy DEFAULT_DISCARD_POLICY = () -> {\n        throw new DiscardException(\"Discard this Task!!!!(Default Policy)\");\n    };\n\n    public SimpleThreadPool(int min, int active, int max, int queueSize, DiscardPolicy discardPolicy) {\n        this.queueSize = queueSize;\n        this.discardPolicy = discardPolicy;\n        this.min = min;\n        this.active = active;\n        this.max = max;\n        init();\n    }\n\n    public SimpleThreadPool() {\n        this(MIN, ACTIVE, MAX, DEFAULT_TASK_QUEUE_SIZE, DEFAULT_DISCARD_POLICY);\n    }\n\n    //çº¿ç¨‹æ± çš„çº¿ç¨‹ï¼Œç»´æŠ¤æ•´ä¸ªçº¿ç¨‹\n    @Override\n    public void run() {\n        while (!destroy) {\n            System.err.printf(\"Pool#min:%d,active:%d,max:%d,currentSize:%d,taskRemain:%d\\n\",\n                    this.min, this.active, this.max, this.size, TASK_QUEUE.size());\n            try {\n                Thread.sleep(5000);\n                if (TASK_QUEUE.size() > active && size < active) {\n                    for (int i = size; i < active; i++) {\n                        createThreadQueue();\n                    }\n                    System.out.println(\"increment to active success\");\n                    this.size = active;\n                } else if (TASK_QUEUE.size() > max && size < MAX) {\n                    for (int i = size; i < max; i++) {\n                        createThreadQueue();\n                    }\n                    System.out.println(\"increment to max success\");\n                    this.size = max;\n                }\n                if (TASK_QUEUE.isEmpty() && size > active) {\n                    System.out.println(\"==================reduce=================\");\n                    //é˜²æ­¢å¹¶å‘ä¿®æ”¹ï¼Œåœ¨shutdownçš„æ—¶å€™reduce\n                    synchronized (THREAD_QUEUE) {\n                        int release = size - active;\n                        //Itertorå¯ä»¥åœ¨éå†çš„è¿‡ç¨‹ä¸­remove\n                        for (Iterator<MyThread> it = THREAD_QUEUE.iterator(); it.hasNext(); ) {\n                            if (release <= 0)\n                                break;\n                            MyThread mt = it.next();\n                            //å¦‚æœè¯¥çº¿ç¨‹åœ¨å·¥ä½œå°±ä¸è¦æ‰“æ–­å®ƒ\n                            if(mt.getThreadState()==ThreadState.RUNNING){\n                                continue;\n                            }\n                            mt.close();\n                            mt.interrupt();\n                            it.remove();\n                            release--;\n                        }\n                        this.size = active;\n                    }\n\n                }\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    private void init() {\n        /*    for (int i = 0; i < size; i++) {\n            createThreadQueue();\n        }*/\n        for (int i = 0; i < this.min; i++) {\n            createThreadQueue();\n        }\n        this.size = min;\n        this.start();\n    }\n\n    public void submit(Runnable runnable) {\n        if (destroy) {\n            throw new IllegalStateException(\"The Pool is shutdown , you can't submit now ! !\");\n        }\n        synchronized (TASK_QUEUE) {\n            if (TASK_QUEUE.size() > queueSize) {\n                discardPolicy.discard();\n            }\n            TASK_QUEUE.addLast(runnable);\n            //å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹\n            TASK_QUEUE.notifyAll();\n        }\n    }\n\n    public void shutdown() throws InterruptedException {\n        while (!TASK_QUEUE.isEmpty()) {\n            Thread.sleep(50);\n        }\n        int initVal = THREAD_QUEUE.size();\n        synchronized (THREAD_QUEUE) {\n            while (initVal > 0) {\n                for (MyThread thread : THREAD_QUEUE) {\n                    if (thread.getThreadState() == ThreadState.BLOCKED) {\n                        //è®¾ç½®ä¸ºDEADçŠ¶æ€\n                        thread.close();\n                        thread.interrupt();\n                        initVal--;\n                    } else {\n                        Thread.sleep(10);\n                    }\n                }\n            }\n        }\n        this.destroy = true;\n        System.out.println(\"My Thread pool is shutdown\");\n    }\n\n    public boolean isDestroy() {\n        return this.destroy;\n    }\n\n    private void createThreadQueue() {\n        MyThread thread = new MyThread(GROUP, THREAD_PREFIX + (seq++));\n        thread.start();\n        THREAD_QUEUE.add(thread);\n    }\n\n\n    private enum ThreadState {\n        FREE, RUNNING, BLOCKED, DEAD\n    }\n\n    public static class DiscardException extends RuntimeException {\n        public DiscardException(String message) {\n            super(message);\n        }\n    }\n\n    @FunctionalInterface\n    public interface DiscardPolicy {\n        void discard() throws DiscardException;\n    }\n\n    private static class MyThread extends Thread {\n        private volatile ThreadState threadState = ThreadState.FREE;\n\n        public ThreadState getThreadState() {\n            return this.threadState;\n        }\n\n        public MyThread(ThreadGroup group, String name) {\n            super(group, name);\n        }\n\n        @Override\n        public void run() {\n            OUTER:\n            while (this.threadState != ThreadState.DEAD) {\n                Runnable runnable;\n                synchronized (TASK_QUEUE) {\n                    while (TASK_QUEUE.isEmpty()) {\n                        try {\n                            this.threadState = ThreadState.BLOCKED;\n                            TASK_QUEUE.wait();\n                        } catch (InterruptedException e) {\n                            System.out.println(Thread.currentThread().getName() + \" is dead\");\n                            break OUTER;\n                        }\n                    }\n                    runnable = TASK_QUEUE.removeFirst();\n                }\n                Optional.of(runnable).ifPresent(t -> {\n                    this.threadState = ThreadState.RUNNING;\n                    t.run();\n                    this.threadState = ThreadState.FREE;\n                });\n            }\n        }\n\n        private void close() {\n            this.threadState = ThreadState.DEAD;\n        }\n    }\n}\n```\n\nç›¸æ¯”ä¸Šé¢å›ºå®šçš„sizeè¿™ä¸ªç‰ˆæœ¬\n\nâ‘  å¢åŠ äº†ä¸‰ä¸ªå­—æ®µç”¨äºåŠ¨æ€çš„æ‰©å®¹ï¼Œå› ä¸ºéœ€è¦ç®¡ç†è¿™äº›çº¿ç¨‹ï¼Œæ‰€ä»¥å°†æ•´ä¸ªçº¿ç¨‹æ± ä¹Ÿç»§æ‰¿äº†`Thread`å¹¶å®ç°äº†runæ–¹æ³•ï¼Œä¸»è¦å°±æ˜¯åˆ¤æ–­`TASK_QUEUE.size() > active && size < active`å½“å‰ä»»åŠ¡é˜Ÿåˆ—ä»»åŠ¡å¤šäº`active`å¹¶ä¸”å½“å‰çº¿ç¨‹é˜Ÿåˆ—çº¿ç¨‹æ•°å°äº`active`ï¼Œå°±å¯ä»¥æ‰©å®¹åˆ°activeï¼ŒmaxåŒç†\n\nâ‘¡`TASK_QUEUE.isEmpty() && size > active` é—²æ—¶å›æ”¶ï¼Œä»»åŠ¡é˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡ï¼Œä½†æ˜¯çº¿ç¨‹é˜Ÿåˆ—çº¿ç¨‹è¿˜å¾ˆå¤šï¼Œæµªè´¹äº†èµ„æºï¼Œæ‰€ä»¥éœ€è¦`reduce`ä¸€äº›ç©ºé—²çš„çº¿ç¨‹ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªå°ç»†èŠ‚ï¼Œ1.åœ¨reduceå’Œshutdownçš„æ—¶å€™éœ€è¦åŒæ­¥`çº¿ç¨‹é˜Ÿåˆ—`ä¸ç„¶åœ¨`reduce`çš„æ—¶å€™`shutdown`ä¼šäº§ç”Ÿ`å¹¶å‘ä¿®æ”¹å¼‚å¸¸`ï¼ˆä¸€ä¸ªåœ¨éå†ï¼Œä¸€ä¸ªåœ¨removeï¼‰ã€‚\n\n### æµ‹è¯•çº¿ç¨‹æ± \n\n```java\npublic class ThreadPoolTest {\n    public static void main(String[] args) throws InterruptedException {\n        SimpleThreadPool threadPool= new SimpleThreadPool();\n        IntStream.rangeClosed(0, 40)\n                .forEach(i -> {\n                    threadPool.submit(() -> {\n                        System.out.println(\"The task \" + i + \"  runnable by thread \" + Thread.currentThread().getName() + \" start\");\n                        try {\n                            Thread.sleep(5000);\n                        } catch (InterruptedException e) {\n                            e.printStackTrace();\n                        }\n                        System.out.println(\"The task \" + i + \"  runnable by thread \" + Thread.currentThread().getName() + \" end\");\n                    });\n                    System.out.println(\"submit \" + i);\n                });\n        threadPool.shutdown();\n    }\n}\n```\n\n## å‚è€ƒèµ„æ–™\n\n- ã€ŠJavaå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜æŒ‡å—ã€‹ \n- [å¹¶å‘ç¼–ç¨‹ç½‘](http://ifeve.com)\n- [Javaè¯­è¨€è§„èŒƒ](https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.2.4)\n\n","tags":["å¤šçº¿ç¨‹","å¹¶å‘ç¼–ç¨‹"],"categories":["å¹¶å‘"]},{"title":"LeetCodeé“¾è¡¨","url":"/2019/02/27/leetcode-lian-biao/","content":"\n> é“¾è¡¨ä¸“é¢˜æ˜¯æœ€å¼€å§‹å­¦ç®—æ³•çš„æ—¶å€™å†™çš„ï¼Œå¾ˆå¤šä»£ç éƒ½å†™å¾—å¾ˆçƒ‚ï¼Œç›®å‰æ­£åœ¨æ…¢æ…¢çš„é‡å†™ï¼Œu1s1é“¾è¡¨çš„é¢˜è¿˜æ˜¯å¾ˆè€ƒéªŒç»†å¿ƒçš„ï¼Œç¨ä¸æ³¨æ„å°±è¿é”™äº†\n\n##  [2. ä¸¤æ•°ç›¸åŠ ](https://leetcode-cn.com/problems/add-two-numbers)\n\nç»™å‡ºä¸¤ä¸ª **éç©º** çš„é“¾è¡¨ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å…¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„ä½æ•°æ˜¯æŒ‰ç…§ **é€†åº** çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ **ä¸€ä½** æ•°å­—ã€‚\n å¦‚æœï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ•°ç›¸åŠ èµ·æ¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥è¡¨ç¤ºå®ƒä»¬çš„å’Œã€‚\næ‚¨å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚\n\nè¾“å…¥ï¼š(2 -> 4 -> 3) + (5 -> 6 -> 4)\n\nè¾“å‡ºï¼š7 -> 0 -> 8\n\nåŸå› ï¼š342 + 465 = 807\n\n**è§£æ³•ä¸€**\n\n```java\n//æ¯”è¾ƒæ¨èçš„å†™æ³•ï¼Œç®€æ´ä¸€ç‚¹ï¼Œåœ¨lcä¸Šæäº¤åŒºåˆ«ä¸å¤§\npublic ListNode addTwoNumbers(ListNode l1, ListNode l2) {\n    ListNode dummyNode=new ListNode(-1);\n    ListNode temp=dummyNode;\n    dummyNode.next=temp;\n    int carry=0;\n    while(l1!=null || l2!=null){\n        int sum= (l1!=null?l1.val:0) + (l2!=null?l2.val:0)+ carry;\n        temp.next=new ListNode(sum%10);\n        temp=temp.next;\n        carry=sum/10;\n        l1=l1!=null?l1.next:null;\n        l2=l2!=null?l2.next:null;\n    }\n    if(carry!=0) temp.next=new ListNode(1);\n    return dummyNode.next;\n}\n```\n~~å¾ˆä¹…ä¹‹å‰å†™çš„ä»£ç äº†ï¼Œä»£ç å¾ˆä¹±ï¼Œç”¨0è¡¥é½çŸ­çš„é‚£ä¸ªç„¶åå¯¹åº”ç›¸åŠ æ³¨æ„è¿›ä½å°±è¡Œäº†~~\n\n2020.3.22 æŠŠä¹‹å‰çš„ä»£ç åˆ äº†ï¼Œä¸€å¹´å‰çš„ä»£ç ï¼Œå†™çš„å¤ªä¸‘äº†\n\n**è§£æ³•äºŒ**\n\n2020.3.22 æ–°å¢äº†ä¸€ä¸ªè§£æ³•ï¼Œæœ‰ç‚¹åï¼Œæ²¡å•¥æ„æ€ï¼Œä¸è¿‡ç†Ÿæ‚‰ä¸‹é“¾è¡¨è¿˜æ˜¯å¯ä»¥\n\n```java\n//è¿™ä¸ªè§£æ³•æœ‰ç‚¹åäº†,ä¸ºäº†ä¸newèŠ‚ç‚¹ç›´æ¥åœ¨åŸé“¾è¡¨ä¸Šä¿®æ”¹çš„\npublic ListNode addTwoNumbers(ListNode l1, ListNode l2) {\n    ListNode dummyNode=new ListNode(-1);\n    dummyNode.next=l1;\n    int carry=0;\n    ListNode last=l1;\n    while(l1!=null && l2!=null){\n        int sum= l1.val + l2.val+ carry;\n        l1.val=sum%10;\n        carry=sum/10;\n        last=l1;\n        l1=l1.next;\n        l2=l2.next;\n    }\n    while(l1!=null && carry!=0){\n        int sum = l1.val + carry;\n        l1.val=sum%10;\n        carry=sum/10;\n        last=l1;\n        l1=l1.next;\n    }\n    if(l2!=null){\n        last.next=l2;\n        while(l2!=null && carry!=0){\n            int sum = l2.val + carry;\n            l2.val=sum%10;\n            carry=sum/10;\n            last=l2;\n            l2=l2.next;\n        }\n    }\n    if(carry!=0) last.next=new ListNode(1);\n    return dummyNode.next;\n}\n```\n## [445. ä¸¤æ•°ç›¸åŠ â…¡](https://leetcode-cn.com/problems/add-two-numbers-ii)\n\nç»™å®šä¸¤ä¸ª**éç©º**é“¾è¡¨æ¥ä»£è¡¨ä¸¤ä¸ªéè´Ÿæ•´æ•°ã€‚æ•°å­—æœ€é«˜ä½ä½äºé“¾è¡¨å¼€å§‹ä½ç½®ã€‚å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨å•ä¸ªæ•°å­—ã€‚å°†è¿™ä¸¤æ•°ç›¸åŠ ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚\nä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°å­—éƒ½ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚\n\nè¿›é˜¶:\nå¦‚æœè¾“å…¥é“¾è¡¨ä¸èƒ½ä¿®æ”¹è¯¥å¦‚ä½•å¤„ç†ï¼Ÿæ¢å¥è¯è¯´ï¼Œä½ ä¸èƒ½å¯¹åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹è¿›è¡Œç¿»è½¬ã€‚\n\nè¾“å…¥: (7 -> 2 -> 4 -> 3) + (5 -> 6 -> 4)\n\nè¾“å‡º: 7 -> 8 -> 0 -> 7\n\n```java\npublic static ListNode addTwoNumbers(ListNode l1, ListNode l2) {\n    BigInteger b1 = new BigInteger(list2num(l1));\n    BigInteger b2 = new BigInteger(list2num(l2));\n    String resStr=b1.add(b2).toString();\n    //å†å˜æˆå­—ç¬¦ä¸²å­˜åˆ°è¿è¡¨é‡Œé¢\n    ListNode res=new ListNode(1);\n    ListNode real=res;\n    for (int i=0;i<resStr.length();i++) {\n        real.next=new ListNode(Integer.valueOf(resStr.charAt(i)-48));\n        real=real.next;\n    }\n    return res.next;\n}\npublic static String  list2num(ListNode l){\n    String num=\"\";\n    while(l!=null){\n        num=num+l.val;\n        l=l.next;\n    }\n    return num;\n}\n```\nè¿™ä¸¤é¢˜æ–¹æ³•å¾ˆå¤šï¼Œä¸‹é¢é‚£é¢˜å®é™…ä¸Šæ˜¯ä¸Šé¢é‚£ä¸€é¢˜åè¿‡æ¥çš„ï¼Œä½†æ˜¯é¢˜ç›®è¦æ±‚ä¸æ”¹å˜é“¾è¡¨æ‰€ä»¥å¯ä»¥åˆ©ç”¨æ ˆæ¥åè½¬ï¼Œç„¶åå°±è·Ÿä¸Šé¢çš„ç±»ä¼¼äº†ï¼Œç„¶åè¿™é‡Œæˆ‘å·äº†ä¸ªæ‡’ç”¨çš„`BigInteger`æçš„é€Ÿåº¦ä¹Ÿè¿˜è¡Œ 77%beatã€‚\n\n**è§£æ³•äºŒ**\n\nï¼ˆupdate: 2020.4.14ï¼‰ä¸Šé¢çš„è§£æ³•ç¬”è¯•è¿™æ ·å†™å€’æ˜¯æ— æ‰€è°“ï¼Œé¢è¯•è¿™æ ·å†™è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå’±è¿˜æ˜¯å¾—è§„è§„çŸ©çŸ©çš„å†™\n\n```java\npublic  ListNode addTwoNumbers(ListNode l1, ListNode l2) {\n    //ç”¨æ•°ç»„çš„è¯ä¸çŸ¥é“æœ‰å¤šé•¿,éœ€è¦å¤šéå†ä¸¤é\n    Deque<Integer> stack1=new ArrayDeque<>();\n    Deque<Integer> stack2=new ArrayDeque<>();\n    ListNode res=new ListNode(-1);\n    while(l1!=null){\n        stack1.push(l1.val);\n        l1=l1.next;\n    }\n    while(l2!=null){\n        stack2.push(l2.val);\n        l2=l2.next;\n    }\n    int carry=0;\n    while(!stack1.isEmpty() || !stack2.isEmpty() || carry>0){\n        int temp=(stack1.isEmpty()?0:stack1.pop())+(stack2.isEmpty()?0:stack2.pop())+carry;\n        //å¤´æ’æ³•\n        ListNode next=res.next;\n        ListNode newNode=new ListNode(temp%10);\n        res.next=newNode;\n        newNode.next=next;\n        carry=temp/10;\n    }\n    return res.next;\n}\n```\n\næœ€åçš„å¤´æ’æ³•è¿˜æ˜¯æŒºå¥½çš„ï¼Œæˆ‘å¼€å§‹è¿˜æƒ³ç€ç¿»è½¬ä¸€ä¸‹çš„ï¼Œæˆ‘çœ‹è§è¯„è®ºåŒºæœ‰äººç”¨é€’å½’å†™ï¼Œæˆ‘è¯•äº†ä¸‹ï¼Œè¿˜æ˜¯ç®—äº†ï¼Œå¤ªéº»çƒ¦äº†ï¼Œè¿˜æ²¡ä¸Šé¢çš„ç®€æ´ï¼Œå†™ä¸€å¤§å¨åˆå§‹åŒ–ï¼Œç„¶åå†é€’å½’ï¼Œä»£ç ä¸€ç‚¹éƒ½ä¸ç®€æ´ï¼Œæ²¡å•¥æ„ä¹‰\n\n## [876. é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹](https://leetcode-cn.com/problems/middle-of-the-linked-list)\n\n```java\npublic static ListNode middleNode(ListNode head) {\n        if(head==null||head.next==null)return head;\n        ListNode fast=head;\n        ListNode slow=head;\n        // 1 2 3 4 5 6 7\n        while(fast!=null&&fast.next!=null){\n            fast=fast.next.next;\n            slow=slow.next;\n        }\n        return slow;\n}\n```\n> `å¿«æ…¢æŒ‡é’ˆ`ï¼Œå¾ˆå¸¸è§å¾ˆç»å…¸çš„åšæ³•åé¢å¾ˆå¤šé¢˜ä¼šç”¨åˆ°è¿™ä¸ªã€‚\n\n## [206. åè½¬é“¾è¡¨](https://leetcode-cn.com/problems/reverse-linked-list)\nåè½¬ä¸€ä¸ªå•é“¾è¡¨ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\n//é€’å½’\npublic static ListNode reverseList(ListNode head) {\n    if (head == null || head.next == null) {\n        return head;\n    }\n    ListNode newHead = reverseList(head.next);\n    //ä»åå¾€å‰\n    head.next.next = head;\n    head.next = null;\n    return newHead;\n}\n```\n**è§£æ³•äºŒ**\n\n```java\n//ä¸‰æŒ‡é’ˆè¿­ä»£\npublic static ListNode reverseList2(ListNode head) {\n    if(head==null)return head;\n    ListNode pre=head;\n    ListNode cur=head.next;\n    ListNode temp;\n    while(cur!=null){\n        temp=cur.next;\n        cur.next=pre;\n        pre=cur;\n        cur=temp;\n    }\n    head.next=null;\n    return pre;\n}\n```\n## [92. åè½¬é“¾è¡¨â…¡](https://leetcode-cn.com/problems/reverse-linked-list-ii)\nåè½¬ä»ä½ç½® _m_ åˆ° _n_ çš„é“¾è¡¨ã€‚è¯·ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®Œæˆåè½¬ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\npublic static ListNode reverseBetween(ListNode head, int m, int n) {\n    if(m==n) return head;\n    //ç”¨æ¥éå†\n    ListNode pre=head;\n    ListNode mid=head.next;\n    ListNode rear=null;\n    //åœ¨éå†çš„ä¸­é—´è¿æ¥è¿™ä¸ªè¡¨ æ—¶é—´å¤æ‚åšåº¦O(N)\n    //æ‰€ä»¥éœ€è¦å…ˆä¿å­˜ må‰çš„èŠ‚ç‚¹ç”¨äºåé¢åˆ°nçš„æ—¶å€™è¿æ¥nå’Œå‰é¢çš„éƒ¨åˆ† preM\n    //è¿˜è¦ä¿å­˜mèŠ‚ç‚¹ï¼Œåœ¨åé¢éå†åˆ°nçš„æ—¶å€™å°†MèŠ‚ç‚¹å’Œåé¢çš„éƒ¨åˆ†è¿æ¥\n    //ä¸­é—´æ®µçš„å‰åèŠ‚ç‚¹ \n    ListNode preM =null;\n    ListNode valM=head;\n    //ListNode nNext=null;\n    int count =1;\n    while(count <=n-1){\n        //countçš„ä½ç½®å®é™…ä¸Šæ˜¯æŒ‡çš„preçš„ä½ç½®å› ä¸ºåªæœ‰preæ˜¯ä»headå¼€å§‹èµ°çš„\n        //å°¾æŒ‡é’ˆåç§»\n        rear=mid.next;\n        if(count==m-1){\n            //ä¿å­˜Mç‚¹å‰é¢çš„èŠ‚ç‚¹å’ŒMèŠ‚ç‚¹\n            preM=pre;\n            valM=mid;\n            //System.out.println(\"preM :\"+preM.val);\n        }\n        if(count==n-1){\n            //è¿æ¥nåé¢èŠ‚ç‚¹çš„å€¼\n            valM.next=rear;\n            //åœ¨è¿™é‡Œåˆ¤æ–­ä¸‹må‰æœ‰æ²¡æœ‰å…ƒç´ \n            if(m==1){\n                head=mid;\n            } else{\n                preM.next=mid;\n            }\n        }\n        if(count >= m && count <=n-1){\n            //åªæœ‰midçš„ä½ç½®å¤§äºmå°äºç­‰äºnæ‰ä¼šå°†èŠ‚ç‚¹nextåŸŸåè½¬\n            mid.next=pre;\n        }\n        //å…¶ä»–ä¸¤ä¸ªæŒ‡é’ˆä¹Ÿå‘åç§»åŠ¨\n        pre=mid;\n        mid=rear;\n        count++;\n    }\n    return head;\n}\n```\nä»£ç å†™çš„æ¯”è¾ƒçƒ‚ä½†æ˜¯æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°ï¼Œåªæ‰«æäº†ä¸€éé“¾è¡¨ 2ms beat 100%ï¼Œä½†æ˜¯åˆ›å»ºçš„æŒ‡é’ˆæœ‰ç‚¹å¤šï¼ŒæŠ è¾¹ç•Œè¦ç»†å¿ƒã€‚\n\n**è§£æ³•äºŒ**\n\nè¢«æœ¬æ¥æ˜¯åƒæŠŠä¸Šé¢çš„è§£æ³•åˆ æ‰çš„ï¼Œæƒ³äº†ä¸€ä¸‹è¿˜æ˜¯ç•™ç€ï¼Œæé†’ä¸‹è‡ªå·±ï¼Œä¸Šé¢çš„è§£æ³•ä¸å¤Ÿé€šç”¨ï¼Œå±äºä¸€æ¬¡æ€§çš„è§£æ³•ï¼Œç»†èŠ‚ä¹Ÿå¾ˆå¤šï¼Œå½“åˆå¯èƒ½æ˜¯è¿½æ±‚åœ¨ä¸€ä¸ªå¾ªç¯å†…å†™å®Œï¼Œæ‰€ä»¥å¯èƒ½å†™çš„æ¯”è¾ƒéš¾çœ‹\n\n```go\nfunc reverseBetween2(head *ListNode, m int, n int) *ListNode {\n    dummyNode := &ListNode{\n        Val:  -1,\n        Next: head,\n    }\n    mpre := dummyNode //mèŠ‚ç‚¹å‰çš„èŠ‚ç‚¹\n    for i := m; i > 1; i-- {\n        mpre = mpre.Next\n    }\n    pre := mpre\n    cur := mpre.Next\n    //  2   4\n    //1 2 3 4 5\n    for i := m; i <= n; i++ {\n        next := cur.Next\n        cur.Next = pre\n        pre = cur\n        cur = next\n    }\n    mpre.Next.Next = cur //2.next=5\n    mpre.Next = pre      //1.next=4\n    return dummyNode.Next\n}\n```\n\nè¿™ä¸ªè§£æ³•å®é™…ä¸Šå°±æ˜¯æ™®é€šä¸€ä¸ªç¿»è½¬ï¼Œç„¶åå¤„ç†ç¿»è½¬éƒ¨åˆ†çš„å¤´å°¾èŠ‚ç‚¹è¿æ¥ï¼Œä½†æ˜¯ä»£ç æ¯”ä¸Šé¢çš„ç®€æ´å¤šäº†\n\n**è§£æ³•ä¸‰**\n\nå¤´æ’æ³•çš„åº”ç”¨ï¼Œå°†ç¿»è½¬éƒ¨åˆ†èŠ‚ç‚¹ç”¨å¤´æ’æ³•æ’å…¥preåï¼Œä¹ŸæŒºä¸é”™\n\n```go\n//å¤´æ’æ³•\nfunc reverseBetween(head *ListNode, m int, n int) *ListNode {\n    dummyNode := &ListNode{\n        Val:  -1,\n        Next: head,\n    }\n    mpre := dummyNode //mèŠ‚ç‚¹å‰çš„èŠ‚ç‚¹\n    for i := m; i > 1; i-- {\n        mpre = mpre.Next\n    }\n    cur := mpre.Next\n    //1 |2 3 4| 5\n    for i := m; i < n; i++ {\n        //é™¤ém=n=lenä¸ç„¶nextè‚¯å®šä¸ä¸ºç©º,ä½†æ˜¯è¿™ç§æƒ…å†µå·²ç»è¢«å¾ªç¯çš„æ¡ä»¶è¿‡æ»¤äº†\n        next := cur.Next\n        cur.Next = next.Next\n        next.Next = mpre.Next\n        mpre.Next = next\n    }\n    return dummyNode.Next\n}\n```\n\n## [725. åˆ†éš”é“¾è¡¨](https://leetcode-cn.com/problems/split-linked-list-in-parts/)\n\nGiven a (singly) linked list with head node `root`, write a function to split the linked list into `k` consecutive linked list \"parts\".\n\nThe length of each part should be as equal as possible: no two parts should have a size differing by more than 1. This may lead to some parts being null.\n\nThe parts should be in order of occurrence in the input list, and parts occurring earlier should always have a size greater than or equal parts occurring later.\n\nReturn a List of ListNode's representing the linked list parts that are formed.\n\nExamples 1->2->3->4, k = 5 // 5 equal parts [ [1], [2], [3], [4], null ]\n\n**Example 1:**\n\n```java\nInput: \nroot = [1, 2, 3], k = 5\nOutput: [[1],[2],[3],[],[]]\nExplanation:\nThe input and each element of the output are ListNodes, not arrays.\nFor example, the input root has root.val = 1, root.next.val = 2, \\root.next.next.val = 3, and root.next.next.next = null.\nThe first element output[0] has output[0].val = 1, output[0].next = null.\nThe last element output[4] is null, but it's string representation as a ListNode is [].\n```\n\n**Example 2:**\n\n```java\nInput: \nroot = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], k = 3\nOutput: [[1, 2, 3, 4], [5, 6, 7], [8, 9, 10]]\nExplanation:\nThe input has been split into consecutive parts with size difference at most 1, and earlier parts are a larger size than the later parts.\n```\n\n**Note:**\n\nThe length of `root` will be in the range `[0, 1000]`.\n\nEach value of a node in the input will be an integer in the range `[0, 999]`.\n\n`k` will be an integer in the range `[1, 50]`.\n\n**è§£æ³•ä¸€**\n\n```java\npublic static ListNode[] splitListToParts(ListNode root, int k) {\n    //å…ˆè¦è·å–ä¸‹é“¾è¡¨çš„é•¿åº¦\n    ListNode temp=root;\n    ListNode next=root;\n    ListNode [] result=new ListNode[k];\n    int count=0;\n    while(temp!=null){\n        temp=temp.next;\n        count++;\n    }\n    temp=root;\n    //ä»»æ„ä¸¤éƒ¨åˆ†å·®è·ä¸èƒ½å¤§äº1ï¼Œå¤§çš„åœ¨å‰ï¼Œå°çš„åœ¨åé¢\n    //å…¶å®å°±æ˜¯å¯¹countè¿›è¡Œåˆ†é…\n    //æ³¨æ„: æœ‰nullçš„æƒ…å†µä¸€å®šæ˜¯ k>count ç›´æ¥æŒ‰ 1 åˆ‡åˆ†å°±å®Œäº‹äº†\n    //k<countçš„æƒ…å†µåªè¦åœ¨ count/k çš„å‰å‡ ä¸ªå…ƒç´ ä¸ŠåŠ ä¸Š count/k çš„ä½™æ•°å°±è¡Œäº†\n    int size=count/k;\n    int num=count%k;\n    result[0]=root;\n    int index=1;\n    if(k<=count){\n        for (int i=1;temp!=null && index < k;i++){\n            next=temp.next;\n            if(i<=(size+1)*num && i%(size+1)==0){\n                //å‰å‡ ä¸ªresçš„åˆ†å‰²ç‚¹\n                result[index++]=next;\n                //åˆ‡æ–­\n                temp.next=null;\n            } else if(i>(size+1)*num && (i-num)%size==0){\n                result[index++]=next;\n                temp.next=null;\n            }\n            temp=next;\n        }\n    } else{\n        //å‰©ä¸‹çš„æƒ…å†µå°±æ˜¯åé¢è¦è¡¥nullçš„æƒ…å†µ\n        // è¿™é‡Œä¸¤ç§æƒ…å†µåº”è¯¥æ˜¯å¯ä»¥åˆå¹¶çš„ï¼Œä½†æ˜¯k>count num>0 æ‡’å¾—å»æŠ è¾¹ç•Œ\n        for (int i=1;i<k;i++){\n            if(temp==null){\n                //è¿™ä¸ªifå…¶å®æ²¡å¿…è¦\n                result[i]=null;\n            } else{\n                next=temp.next;\n                result[i]=next;\n                temp.next=null;\n                temp=next;\n            }\n        }\n    }\n    return result;\n}\n```\n3ms beat 89% è¿™é¢˜ä¹Ÿæ¯”è¾ƒç®€å•ä¸»è¦æ˜¯è¾¹ç•Œè¦æŠ å¥½\n\n## [86. åˆ†éš”(å‰²)é“¾è¡¨](https://leetcode-cn.com/problems/partition-list)\nç»™å®šä¸€ä¸ªé“¾è¡¨å’Œä¸€ä¸ªç‰¹å®šå€¼`x`ï¼Œå¯¹é“¾è¡¨è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ‰€æœ‰å°äº`x`çš„èŠ‚ç‚¹éƒ½åœ¨å¤§äºæˆ–ç­‰äº`x`çš„èŠ‚ç‚¹ä¹‹å‰ã€‚\n\nä½ åº”å½“ä¿ç•™ä¸¤ä¸ªåˆ†åŒºä¸­æ¯ä¸ªèŠ‚ç‚¹çš„åˆå§‹ç›¸å¯¹ä½ç½®ã€‚\n\n**è¾“å…¥:** head = 1->4->3->2->5->2, _x_ = 3\n\n**è¾“å‡º:** 1->2->2->4->3->5\n\n**è§£æ³•ä¸€**\n\n```java\npublic ListNode partition(ListNode head, int x) {\n    //å…ˆåœ¨å¤´éƒ¨åŠ ä¸€ä¸ªdummyèŠ‚ç‚¹ç»Ÿä¸€æ“ä½œ\n    ListNode dummyNode=new ListNode(-1);\n    dummyNode.next=head;\n    //åˆ†å‰²ç‚¹\n    ListNode pre=cutNode=dummyNode;\n    ListNode cur=head;\n    int cut=0;\n    while(cur!=null){\n        if(cur.val>=x&&cut==0){\n            //åªä¼šæ‰§è¡Œä¸€æ¬¡åœ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªval>=xçš„èŠ‚ç‚¹çš„æ—¶å€™---ä¿å­˜åˆ†å‰²ç‚¹\n            cutNode=pre;\n            cut=1;\n        } else if(cur.val<x && cut==1){\n            //æ‰¾åˆ°åˆ†å‰²ç‚¹å éå†åˆ°val<xçš„èŠ‚ç‚¹çš„æƒ…å†µ---å°†curè¿æ¥åˆ°cutNodeçš„åé¢ å¤„ç†å¥½curç›¸é‚»çš„ä¸¤ä¸ªèŠ‚ç‚¹\n            //å…ˆå¤„ç†å¥½curç›¸é‚»çš„èŠ‚ç‚¹\n            pre.next=cur.next;\n            //è¿æ¥cutNode\n            cur.next=cutNode.next;\n            cutNode.next=cur;\n            //cutNodeåç§»\n            cutNode=cur;\n        }\n        pre=cur;\n        cur=cur.next;\n    }\n    return dummyNode.next\n}\n```\nè¿™é¢˜ä¹ŸæŒºç®€å•å’Œä¸Šé¢çš„é‚£é¢˜åå­—ä¸€æ ·æ˜¯åœ¨æ•´ç†è¿™ç¯‡åšå®¢çš„æ—¶å€™ç°åœºåšçš„(2019.2.27)å‰åå¤§æ¦‚åŠä¸ªå°æ—¶orzã€‚ã€‚ã€‚æ¯”è¾ƒèœï¼Œä½†æ˜¯è¿™ä¸ªæˆ‘æ²¡æœ‰åœ¨æœ¬åœ°è·‘ç›´æ¥åœ¨LeetCodeä¸Šæäº¤çš„ç„¶åå°±è¿‡äº† 1ms beat84% æ„Ÿè§‰æ€è·¯æ¯”è¾ƒæ¸…æ™°å°±æ²¡æœ‰æœ¬åœ°è·‘ï¼Œæäº¤è®°å½•ä¸Šæœ€å¿«çš„å±…ç„¶æ˜¯ç”¨äº†é¢å¤–ç©ºé—´newäº†ä¸¤ä¸ªé“¾è¡¨ç„¶åè¿èµ·æ¥çš„ã€‚ã€‚ã€‚é†‰äº†å¯èƒ½æ˜¯æµ‹è¯•ç”¨ä¾‹å¤ªå°‘äº†ã€‚\n\n\n## [160. ç›¸äº¤é“¾è¡¨](https://leetcode-cn.com/problems/intersection-of-two-linked-lists)\nç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾åˆ°ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚\nå¦‚ä¸‹é¢çš„ä¸¤ä¸ªé“¾è¡¨ï¼š\n![mark](http://static.imlgw.top///20190303/NVEXndTcF1R6.png?imageslim)\n\nåœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n![mark](http://static.imlgw.top///20190303/ymln2djUVieT.png?imageslim)\n\n**è¾“å…¥**: intersectVal = 8, listA = [4,1,8,4,5], listB = [5,0,1,8,4,5], skipA = 2, skipB = 3\n**è¾“å‡º**: Reference of the node with value = 8\n**è¾“å…¥è§£é‡Š**:ç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ 2ï¼š**\n\n![mark](http://static.imlgw.top///20190303/2F7qqhkUIWog.png?imageslim)\n**è¾“å…¥**:intersectVal = 2, listA = [0,9,1,2,4], listB = [3,2,4], skipA = 3, skipB = 1\n**è¾“å‡º**:Reference of the node with value = 2\n**è¾“å…¥è§£é‡Š**:ç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 2 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [0,9,1,2,4]ï¼Œé“¾è¡¨ B ä¸º [3,2,4]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 1 ä¸ªèŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹ 3ï¼š**\n\n![mark](http://static.imlgw.top///20190303/hKSAelGSE1TY.png?imageslim)\n\n**è¾“å…¥**:intersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3, skipB = 2\n**è¾“å‡º**:null\n**è¾“å…¥è§£é‡Š**:ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [2,6,4]ï¼Œé“¾è¡¨ B ä¸º [1,5]ã€‚ç”±äºè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ intersectVal å¿…é¡»ä¸º 0ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚\n**è§£é‡Š**:è¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å› nullã€‚\n\n**æ³¨æ„ï¼š**\n\n*   å¦‚æœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å› `null`.\n*   åœ¨è¿”å›ç»“æœåï¼Œä¸¤ä¸ªé“¾è¡¨ä»é¡»ä¿æŒåŸæœ‰çš„ç»“æ„ã€‚\n*   å¯å‡å®šæ•´ä¸ªé“¾è¡¨ç»“æ„ä¸­æ²¡æœ‰å¾ªç¯ã€‚\n*   ç¨‹åºå°½é‡æ»¡è¶³ O(_n_) æ—¶é—´å¤æ‚åº¦ï¼Œä¸”ä»…ç”¨ O(_1_) å†…å­˜ã€‚\n\n**è§£æ³•ä¸€ï¼š**\n\n```java\npublic static ListNode getIntersectionNode(ListNode headA, ListNode headB) {\n    ListNode pA=headA;\n    ListNode pB=headB;\n    //è®¡ç®—ä¸¤ä¸ªé“¾è¡¨é•¿åº¦ç„¶åè®¡ç®—å·®è·ç„¶åå‘åå¯¹é½\n    int lenA=0;\n    int lenB=0;\n    while(pA!=null){\n        pA=pA.next;\n        lenA++;\n    }\n    while(pB!=null){\n        pB=pB.next;\n        lenB++;\n    }\n    int dis=lenB>lenA?lenB-lenA:lenA-lenB;\n    if(lenB>lenA){\n        while(dis-->0){\n            headB=headB.next;\n        }\n    } else{\n        while(dis-->0){\n            headA=headA.next;\n        }\n    }\n    //ä¸ç›¸ç­‰å°±ä¸€ç›´å‘åç§»\n    while(headA!=headB){\n        //å¦‚æœæœ‰ä¸€æ¡ä¸ºç©ºè¯´æ˜æ²¡æœ‰äº¤ç‚¹\n        if(headA.next==null){\n            return null;\n        }\n        headA=headA.next;\n        headB=headB.next;\n    }\n    return headA;\n}\n```\nè¿™ç§æ–¹æ³•æ¯”è¾ƒç›´æ¥ç›´æ¥è®¡ç®—ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ç„¶åè®¡ç®—å·®å€¼ç„¶åå°†é•¿çš„é‚£ä¸ªç§»åŠ¨åˆ°å¯¹åº”çš„ä½ç½®è®©`ä¸¤æ¡é“¾è¡¨å°¾å¯¹é½`ç„¶åä¸€èµ·å‘åç§»åŠ¨\n**è§£æ³•äºŒï¼š**\n\n```java\n//æ–¹æ³•äºŒ \npublic static ListNode getIntersectionNode2(ListNode headA, ListNode headB) {\n    //å½“ä¸€ä¸ªæŒ‡é’ˆåˆ°ç»“å°¾æ—¶è½¬åˆ°å¦ä¸€ä¸ªé“¾è¡¨å¤´å†å‘åç§»åŠ¨ ï¼Œè¿™æ ·åšçš„ç›®çš„å’Œå°±æ˜¯å¯ä»¥ç›´æ¥æ¶ˆé™¤é“¾è¡¨ä¹‹é—´çš„é•¿åº¦å·®ï¼Œå‘åå¯¹é½ï¼Œæ–¹æ³•è¿˜æ˜¯å¾ˆå·§å¦™çš„ã€‚\n    ListNode pA=headA;\n    ListNode pB=headB;\n    if(headB==null || headA==null)\n                 return null;\n    //while(pA!=null && pB!=null ){\n    while(pA!=pB){\n        //è¦ä¿è¯ä¸¤ä¸ª==nullçš„æ—¶å€™éƒ½åªèƒ½æ‰§è¡Œä¸€æ¬¡ä¸ç„¶å¦‚æœæ²¡æœ‰äº¤ç‚¹å°±ä¼šæ­»å¾ªç¯\n        //æ”¹å˜whileçš„æ¡ä»¶\n        //æ”¹å˜pAï¼ŒpBè·³è½¬çš„æ¡ä»¶\n        //è¿™æ ·å°±å¯ä»¥ä¿è¯æœ€åæ²¡äº¤ç‚¹çš„æ—¶å€™ ç¬¬äºŒéå¾ªç¯pAå’ŒpBæœ€åä¼šåŒæ—¶ç­‰äºnullä¼šæœ‰å‡ºå£ä¸ä¼šæ­»å¾ªç¯\n        pA=pA==null?headB:pA.next;\n        pB=pB==null?headA:pB.next;\n    }\n    return pA;\n}\n```\n>  åŒæ—¶éå†ä¸¤ä¸ªé“¾è¡¨ï¼Œå½“ä¸€ä¸ªæŒ‡é’ˆåˆ°ç»“å°¾æ—¶è½¬åˆ°å¦ä¸€ä¸ªé“¾è¡¨å¤´å†å‘åç§»åŠ¨ ï¼Œè¿™æ ·åšçš„ç›®çš„å’Œå°±æ˜¯å¯ä»¥ç›´æ¥æ¶ˆé™¤é“¾è¡¨ä¹‹é—´çš„é•¿åº¦å·®ï¼Œä½¿ä¹‹å°¾å¯¹é½ï¼Œæ–¹æ³•è¿˜æ˜¯å¾ˆå·§å¦™çš„ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒç®€æ´ã€‚\n\n\n## [234. å›æ–‡é“¾è¡¨](https://leetcode-cn.com/problems/palindrome-linked-list)\nè¯·åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n**è¾“å…¥:** 1->2\n**è¾“å‡º:** false\n\n**ç¤ºä¾‹ 2:**\n\n**è¾“å…¥:** 1->2->2->1\n**è¾“å‡º:** true\n\n**è¿›é˜¶ï¼š**\nä½ èƒ½å¦ç”¨ O(n) æ—¶é—´å¤æ‚åº¦å’Œ O(1) ç©ºé—´å¤æ‚åº¦è§£å†³æ­¤é¢˜ï¼Ÿ\n\n```java\npublic boolean isPalindrome(ListNode head) {\n    if(head==null || head.next==null){\n        return true;\n    }\n    // åˆ©ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­ç‚¹\n    ListNode fast = head;\n    ListNode slow = head;\n    while (fast.next != null) {\n        fast = fast.next.next == null ? fast.next : fast.next.next;\n        slow = slow.next;\n    }\n    // å¦‚æœæ˜¯å¶æ•°èŠ‚ç‚¹ï¼Œslowå°±æ˜¯åå³çš„é‚£ä¸ª å¥‡æ•°å°±æ˜¯æ­£ä¸­é—´çš„ å¥‡æ•°åœ¨æ­£ä¸­é—´ä¸ç”¨ç®¡\n    // fastæ˜¯å°¾èŠ‚ç‚¹ 1 1 1 1 1 1\n    resverList(slow);\n    //slow.next==null\n    // check\n    while (fast != null && head != null) {\n        if (fast.val != head.val) {\n            return false;\n        }\n        fast = fast.next;\n        head = head.next;\n    }\n    return true;\n\n}\n\npublic static void resverList(ListNode node) {\n    ListNode cur = node;\n    ListNode pre = null;\n    ListNode next = node;\n    while (cur != null) {\n        next = next.next;\n        cur.next = pre;\n        pre = cur;\n        cur = next;\n    }\n}\n```\nè¿™é¢˜å°±ç”¨åˆ°äº†ä¸Šé¢çš„ç¿»è½¬é“¾è¡¨çš„æ–¹æ³•ï¼Œä¸è¿‡è¿™é‡Œåªç¿»è½¬äº†ä¸€åŠï¼Œç¿»è½¬äº†ååŠæ®µç„¶åä»ä¸¤è¾¹åˆ°ä¸­é—´é€ä¸ªèŠ‚ç‚¹å¯¹æ¯”\n\n\n## [237. åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹](https://leetcode-cn.com/problems/delete-node-in-a-linked-list)\nè¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶å¯ä»¥åˆ é™¤æŸä¸ªé“¾è¡¨ä¸­ç»™å®šçš„ï¼ˆéæœ«å°¾ï¼‰èŠ‚ç‚¹ï¼Œä½ å°†åªè¢«ç»™å®šè¦æ±‚è¢«åˆ é™¤çš„èŠ‚ç‚¹ã€‚\n\nç°æœ‰ä¸€ä¸ªé“¾è¡¨ -- head = [4,5,1,9]ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºä¸º:\n\n![mark](http://static.imlgw.top///20190303/9MUvMzlcAN0G.png?imageslim)\n\n**ç¤ºä¾‹ 1:**\n\n**è¾“å…¥:** head = [4,5,1,9], node = 5\n**è¾“å‡º:** [4,1,9]\n**è§£é‡Š:** ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 5 çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -> 1 -> 9.\n\n**ç¤ºä¾‹ 2:**\n\n**è¾“å…¥:** head = [4,5,1,9], node = 1\n**è¾“å‡º:** [4,5,9]\n**è§£é‡Š:** ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 1 çš„ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -> 5 -> 9.\n\n**è¯´æ˜:**\n\n*   é“¾è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ã€‚\n*   é“¾è¡¨ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚\n*   ç»™å®šçš„èŠ‚ç‚¹ä¸ºéæœ«å°¾èŠ‚ç‚¹å¹¶ä¸”ä¸€å®šæ˜¯é“¾è¡¨ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹ã€‚\n*   ä¸è¦ä»ä½ çš„å‡½æ•°ä¸­è¿”å›ä»»ä½•ç»“æœã€‚\n\n**äºŒè´§åšæ³•**\n\n```java\npublic  static void deleteNodelow(ListNode node) {\n    //æ€è·¯å°±æ˜¯å’Œnodeåé¢çš„å…ƒç´ ä¸€ç›´äº¤æ¢ï¼Œå°±åƒå†’æ³¡æ’åºä¸€æ ·\n    ListNode next;\n    ListNode temp=new ListNode(0);\n    ListNode pre=temp;\n    while(node.next!=null){\n        next=node.next;\n        if(node.next.next==null){\n            pre=node;\n        }\n        //å…ˆä¿å­˜æœ€åä¸€ä¸ªèŠ‚ç‚¹å‰çš„èŠ‚ç‚¹\n        //äº¤æ¢å½“å‰èŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹\n        temp.val=node.val;\n        node.val=next.val;\n        next.val=temp.val;\n        node=next;\n    }\n    pre.next=null;\n}\n```\né¦–å…ˆæƒ³åˆ°çš„æ„šè ¢çš„åšæ³•,æ€ä¹ˆè¿™ä¹ˆè ¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ\n\n**æ­£ç¡®åšæ³•**\n\n```java\n  public  static void deleteNode(ListNode node) {\n        node.val=node.next.val;\n        node.next=node.next.next;\n  }\n```\n\n## [203. ç§»é™¤é“¾è¡¨å…ƒç´ ](https://leetcode-cn.com/problems/remove-linked-list-elements)\nåˆ é™¤é“¾è¡¨ä¸­ç­‰äºç»™å®šå€¼ val çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹:**\n\n**è¾“å…¥:** 1->2->6->3->4->5->6, _**val**_ = 6\n**è¾“å‡º:** 1->2->3->4->5\n\n**è§£æ³•ä¸€ï¼š**\nåŒæŒ‡é’ˆ + è™šæ‹Ÿå¤´èŠ‚ç‚¹\n\n```java\n public static ListNode removeElements(ListNode head, int val) {\n        if (head == null) return null;\n        ListNode dummyHead = new ListNode(0);\n        //å†å¤´æ¥å¾…ä½ ä¹‹å‰åŠ äº†æ–°çš„èŠ‚ç‚¹\n        dummyHead.next = head;\n        ListNode pre = dummyHead, cur = head;\n        while (cur != null) {\n            if (cur.val == val) {\n                pre.next = cur.next;\n            } else {\n                //ä¸æ˜¯ç›¸ç­‰çš„å€¼å°±å‘åç§»åŠ¨\n                pre = cur;\n            }\n            cur = cur.next;\n        }\n        return dummyHead.next;\n    }\n```\n**è§£æ³•äºŒï¼š**\n\né€’å½’æ–¹æ³•æ¯”è¾ƒç®€æ´\n\n```java\n//é€’å½’\npublic static ListNode removeElements2(ListNode head, int val){\n    if (head == null)\n       return null;\n    //å°†ä¸‹ä¸€ä¸ªå…ƒç´ æ”¾è¿›é€’å½’å¦‚æœæ˜¯==valçš„å°±ä¼šæŠŠä¸‹ä¸€ä¸ªçš„ä¸‹ä¸€ä¸ªå…ƒç´ è¿”å›è¿æ¥åˆ°å½“å‰å…ƒç´ \n    head.next = removeElements2(head.next, val);\n    return head.val == val ? head.next : head;\n}\n```\n\n## [19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹](https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list)\nç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚\nç¤ºä¾‹ï¼š\nç»™å®šä¸€ä¸ªé“¾è¡¨: 1->2->3->4->5, å’Œ n = 2.\nå½“åˆ é™¤äº†å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹åï¼Œé“¾è¡¨å˜ä¸º 1->2->3->5.\nè¯´æ˜ï¼š\nç»™å®šçš„ n ä¿è¯æ˜¯æœ‰æ•ˆçš„ã€‚\nè¿›é˜¶ï¼š\nä½ èƒ½å°è¯•ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®ç°å—ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\n```java\npublic ListNode removeNthFromEnd(ListNode head, int n) {\n    if(head==null&&head.next==null) return null;\n    //åŒæŒ‡é’ˆ ä¸»è¦æ˜¯å¤´å’Œå°¾çš„åˆ é™¤éœ€è¦æŠ ä¸€ä¸‹è¾¹ç•Œ\n    //  -1 | 1 2 3 4 5 6\n    ListNode fast=head;\n    ListNode dummyNode=new ListNode(-1);\n    dummyNode.next=head;\n    ListNode slow=dummyNode;\n    //åŠ äº†å“‘èŠ‚ç‚¹ï¼Œç›´æ¥å…ˆåŠ 1\n    int count=1;\n    while(fast!=null){\n        fast=fast.next;\n        slow=count<n?slow:slow.next;\n        count++;\n        if(fast.next==null){\n            //slowåˆ°è¾¾éœ€è¦åˆ é™¤çš„ä½ç½®çš„å‰ä¸€ä¸ª\n            slow.next=slow.next.next;\n            return dummyNode.next;\n        }\n    }\n    return dummyNode.next;\n}\n```\nçœ‹äº†è¯„è®ºæ‰çŸ¥é“å’‹ä¸€éå¾ªç¯ï¼Œä¸»è¦å°±æ˜¯æ§åˆ¶slowæŒ‡é’ˆèµ°`length-n`æ­¥ï¼Œè®©å¿«æŒ‡é’ˆå…ˆèµ°næ­¥ï¼Œç„¶åå¿«æ…¢ä¸€èµ·èµ°ï¼Œå¿«æŒ‡é’ˆåˆ°å¤´æ—¶æ…¢æŒ‡é’ˆå°±åˆ°`length-n`çš„ä½ç½®äº†ï¼Œè¿™é¢˜ä¹Ÿå¯ä»¥ç”¨Listä¿å­˜æ¯ä¸ªèŠ‚ç‚¹è®©ç„¶åæŠŠå¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å‰ä¸€ä¸ªæ‹¿å‡ºæ¥æ“ä½œï¼Œéå†ä¸¤éçš„æ–¹æ³•æ¯”è¾ƒç®€å•å°±ä¸å†™äº†ï¼Œæ„Ÿè§‰è¿™ç§æ–¹æ³•æ¯”è¾ƒå¥½ , è¿™é¢˜çš„OJ caseæ¯”è¾ƒå°‘æ‰€ä»¥æ²¡ä»€ä¹ˆå¯æ¯”æ€§ , å‰å‡ ä¸ªéƒ½æ˜¯è·‘äº†ä¸¤éçš„ï¼Œæˆ‘æŠŠæœ€å¿«çš„æ‹·è¿‡æ¥è·‘çš„æ¯”æˆ‘è¿˜æ…¢ã€‚ã€‚ã€‚ã€‚ç„¶åæˆ‘åˆæäº¤äº†ä¸€æ¬¡ beat 90%.......\n\n\n## [82. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ â…¡](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list-ii)\nç»™å®šä¸€ä¸ªæ’åºé“¾è¡¨ï¼Œåˆ é™¤æ‰€æœ‰å«æœ‰é‡å¤æ•°å­—çš„èŠ‚ç‚¹ï¼Œåªä¿ç•™åŸå§‹é“¾è¡¨ä¸­**æ²¡æœ‰é‡å¤å‡ºç°**çš„æ•°å­—ã€‚\n\n**ç¤ºä¾‹ 1:**\n\nè¾“å…¥: 1->2->3->3->4->4->5\nè¾“å‡º: 1->2->5\n\n**ç¤ºä¾‹ 2:**\n\nè¾“å…¥: 1->1->1->2->3\nè¾“å‡º: 2->3\n\n**è§£æ³•ä¸€**\n\nä¹ä¸€çœ‹è·Ÿä¸Šé¢é‚£ä¸€é¢˜ä¸€æ ·ï¼Ÿè¿™é¢˜æ˜¯æ’åºé“¾è¡¨ä¸Šé¢é‚£é¢˜æ˜¯æ— åºçš„ï¼Œè€Œä¸”è¿™é¢˜ä¸ç»™å®šå…ƒç´ \n\n```java\npublic  static ListNode deleteDuplicates(ListNode head) {\n    if(head==null)return null;\n    //é¦–å…ˆæƒ³åˆ°çš„æ€è·¯æ˜¯3æŒ‡é’ˆï¼Œç„¶åéå†çš„è¿‡ç¨‹ä¸­åé¢çš„æŒ‡é’ˆé‡åˆ°==valçš„æƒ…å†µå°±è®©åé¢çš„æŒ‡é’ˆä¸€ç›´åç§»èµ°åˆ°ï¼=val\n    //å…ˆæ·»åŠ ä¸ªå“‘èŠ‚ç‚¹\n    ListNode dummyNode=new ListNode(-1);\n    dummyNode.next=head;\n    ListNode cur=head;\n    ListNode next=head.next;\n    ListNode pre=dummyNode;\n    while(next!=null){\n        while(next.val==cur.val){\n            next=next.next;\n            if(next==null){\n                pre.next=null;\n                return dummyNode.next;\n            }\n            if(next.val!=cur.val){\n                pre.next=next;\n                //curè·Ÿä¸Š\n                cur=next;\n                break;\n            }\n        }\n        //å…³é”®å°±æ˜¯preç§»åŠ¨è¿™é‡Œæœ‰å‘ ä¸èƒ½ç›´æ¥å°†preç§»åˆ°cur,å› ä¸ºä¼šæœ‰è¿ç»­çš„è¿ç»­å­˜åœ¨\n        pre=cur.next!=null&&cur.val==cur.next.val?pre:cur;\n        cur=next;\n        next=next.next;\n    }\n    return dummyNode.next;\n}\n```\næ•´ä½“æ¥è¯´è¿˜æ˜¯æŒºç®€å•çš„åªè·‘äº†ä¸€è¶Ÿ 1ms beta98%ï¼Œè¯„è®ºé‡Œé¢å¤§éƒ½åªç”¨äº†ä¸¤ä¸ªæŒ‡é’ˆæˆ‘ç”¨äº†ä¸‰ä¸ªè¿™æ ·æ„Ÿè§‰æ¯”è¾ƒæ¸…æ™°\næ€ä¹ˆå¥½ç†è§£æ€ä¹ˆæ¥ã€‚è²Œä¼¼æœ€å¿«çš„æ˜¯ä¸€ä¸ªé€’å½’çš„ï¼Œé€’å½’å†™èµ·æ¥ç¡®å®ç„å­¦è¿˜è¦å¤šç»ƒç»ƒå•Š\n\n**è§£æ³•äºŒ**\n\n2020.4.2é‡å†™äº†ä¸€ä¸ªé€’å½’çš„ï¼Œæ„Ÿè§‰è‰¯å¥½\n\n```java\npublic ListNode deleteDuplicates(ListNode head) {\n    if(head==null || head.next==null) return head;\n    if(head.val==head.next.val){\n        while(head!=null && head.next!=null && head.val==head.next.val){\n            head=head.next;\n        }\n        return deleteDuplicates(head.next); //å»é‡\n    }\n    head.next=deleteDuplicates(head.next);\n    return head;\n}\n```\n## [83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ ](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list/)\n\nç»™å®šä¸€ä¸ªæ’åºé“¾è¡¨ï¼Œåˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 1->1->2\nè¾“å‡º: 1->2\n```\n\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 1->1->2->3->3\nè¾“å‡º: 1->2->3\n```\n\n**è§£æ³•ä¸€**\n\nè€é¢˜æ–°å†™\n\n```java\n//é€’å½’\npublic ListNode deleteDuplicates(ListNode head) {\n    if(head==null || head.next==null) return head;\n    ListNode node=deleteDuplicates(head.next);\n    if(head.val==node.val) {\n        head.next=node.next;\n    }\n    return head;\n}\n```\n**è§£æ³•äºŒ**\n\n```java\n//è¿­ä»£\npublic ListNode deleteDuplicates(ListNode head) {\n    ListNode temp = head;\n    while (temp != null){\n        if (temp.next == null){\n            break;\n        }\n        if (temp.next.val == temp.val){\n            temp.next = temp.next.next;\n        }else {\n            temp = temp.next;\n        }\n\n    }\n    return head;\n}\n```\n\n## [é¢è¯•é¢˜ 02.01\\. ç§»é™¤é‡å¤èŠ‚ç‚¹](https://leetcode-cn.com/problems/remove-duplicate-node-lcci/)\n\nç¼–å†™ä»£ç ï¼Œç§»é™¤æœªæ’åºé“¾è¡¨ä¸­çš„é‡å¤èŠ‚ç‚¹ã€‚ä¿ç•™æœ€å¼€å§‹å‡ºç°çš„èŠ‚ç‚¹ã€‚\n\n**ç¤ºä¾‹1:**\n\n```java\n è¾“å…¥ï¼š[1, 2, 3, 3, 2, 1]\n è¾“å‡ºï¼š[1, 2, 3]\n```\n\n**ç¤ºä¾‹2:**\n\n```java\n è¾“å…¥ï¼š[1, 1, 1, 1, 2]\n è¾“å‡ºï¼š[1, 2]\n```\n\n**æç¤ºï¼š**\n\n1.  é“¾è¡¨é•¿åº¦åœ¨[0, 20000]èŒƒå›´å†…ã€‚\n2.  é“¾è¡¨å…ƒç´ åœ¨[0, 20000]èŒƒå›´å†…ã€‚\n\n**è¿›é˜¶ï¼š**\n\nå¦‚æœä¸å¾—ä½¿ç”¨ä¸´æ—¶ç¼“å†²åŒºï¼Œè¯¥æ€ä¹ˆè§£å†³ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\næ— åºé“¾è¡¨ï¼Œå’Œå‰é¢ä¸å¤ªä¸€æ ·ï¼Œå¼€ä¸ª20000çš„æ•°ç»„åˆ¤æ–­æ˜¯å¦é‡å¤å°±è¡Œäº†\n```golang\n/**\n * Definition for singly-linked list.\n * type ListNode struct {\n * Â  Â  Val int\n * Â  Â  Next *ListNode\n * }\n */\nfunc removeDuplicateNodes(head *ListNode) *ListNode {\n Â  Â var set = make([]bool,20001)\n Â  Â var dummyNode = &ListNode{Next:head}\n Â  Â var pre = dummyNode\n Â  Â for head!=nil{\n Â  Â  Â  Â if !set[head.Val]{\n Â  Â  Â  Â  Â  Â set[head.Val]=true\n Â  Â  Â  Â  Â  Â pre=head\n Â  Â  Â   }else{\n Â  Â  Â  Â  Â  Â pre.Next=head.Next\n Â  Â  Â   }\n Â  Â  Â  Â head=head.Next\n Â   }\n Â  Â return dummyNode.Next\n}\n```\n> è¿™ä¸ªè¿›é˜¶æˆ–è®¸åº”è¯¥ç§°ä¹‹ä¸ºé€€é˜¶ã€‚ã€‚ã€‚è¿›é˜¶çš„åº”è¯¥åªèƒ½æš´åŠ›O(N^2)è€Œä¸”è¿™ä¸ªæ•°æ®é‡è‚¯å®šä¼šTï¼Œæ’åºçš„è¯å¹¶æ²¡æœ‰åˆé€‚çš„æ’åºæ–¹æ³•\n\n## [143. é‡æ’é“¾è¡¨](https://leetcode-cn.com/problems/reorder-list/)\n\nç»™å®šä¸€ä¸ªå•é“¾è¡¨ _L_ï¼šL0â†’L1â†’â€¦â†’Ln-1â†’Ln \nå°†å…¶é‡æ–°æ’åˆ—åå˜ä¸ºï¼š L0â†’Lnâ†’L1â†’Ln-1â†’L2â†’Ln-2â†’â€¦\n\nä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚\n\n**ç¤ºä¾‹ 1:**\n\nç»™å®šé“¾è¡¨ 1->2->3->4, é‡æ–°æ’åˆ—ä¸º 1->4->2->3.\n\n**ç¤ºä¾‹ 2:**\n\nç»™å®šé“¾è¡¨ 1->2->3->4->5, é‡æ–°æ’åˆ—ä¸º 1->5->2->4->3.\n\n> è¿™é¢˜å’Œä¸Šé¢çš„å›æ–‡é“¾è¡¨æœ‰ç‚¹ç±»ä¼¼ï¼Œéƒ½æ˜¯å¿«æ…¢æŒ‡é’ˆä¸è¿‡è¿™é¢˜ç¨å¾®å¤æ‚ç‚¹\n\n**è§£æ³•ä¸€**\n\n```java\npublic static void reorderList(ListNode head) {\n    if(head==null){\n        return;\n    }\n    ListNode right = head;\n    ListNode slow = head;\n    // 1 1 1 1 1 1 1\n    while (right.next != null) {\n        right = right.next.next != null ? right.next.next : right.next;\n        slow = slow.next;\n    }\n    // ä»slowå¼€å§‹ç¿»è½¬\n    res(slow);\n    //å·¦åŠéƒ¨åˆ†\n    ListNode left = head;\n    //ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n    ListNode rnext = right;\n    ListNode lnext = left;\n    // 1 2 3 4 5 6 7 8 \n    // 1 8 2 7 3 6 4 5\n    while (right != null && left != null) {\n        // è¦ä¿å­˜rightçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ , leftä¹Ÿéœ€è¦,ä¸ç„¶æ— æ³•å¯¼èˆªåˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n        lnext = lnext.next;\n        rnext = rnext.next;\n        // å¶æ•°ä¸ªæ•°èŠ‚ç‚¹,å¦‚æœéå†åˆ°righté“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹\n        // å¶æ•°çš„è¯righté“¾è¡¨ä¼šçŸ­ä¸€ç‚¹ æœ€åè¿æ¥çš„æ—¶å€™\n        // left: 1->2->3->4->5 right: 8->7->6->5   \n        // åƒè¿™æ ·ä¼šå°†5åŠ åˆ°leftçš„4å’Œ5ä¹‹é—´,ä½†æ˜¯æ˜æ˜¾åªæœ‰ä¸€ä¸ª5è¿™æ ·æ·»åŠ å°±æ˜¯æœ‰é—®é¢˜çš„\n        if(right.next==null){\n            //æ‰€ä»¥è¿™é‡Œå§lnextèµ‹å€¼ä¸ºnull,åé¢å°±ä¸ä¼šé‡å¤è¿æ¥5è¿™ä¸ªèŠ‚ç‚¹\n            lnext=null;\n        }\n        //å¥‡æ•°ä¸ªæ•°çš„æ—¶å€™è¿™æ ·è¿æ¥æ²¡é—®é¢˜\n        // 1 2 3 4 5 \n        // 9 8 7 6 5\n        //5.next=5\n        left.next = right;\n        //å¦‚æœå¥‡æ•°ä¸ªæ•°åˆ°æœ€åè¿™ä¸€æ­¥ rightå’Œleftæ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¸ºå€¼æ˜¯5çš„èŠ‚ç‚¹\n        //æ‰€ä»¥è¿™é‡Œä¸‹é¢çš„ç›´æ¥è¦†ç›–äº†ä¸Šé¢çš„\n        //5.next=null\n        right.next = lnext;\n        left = lnext;\n        right = rnext;\n    }\n}\n\n//åè½¬\npublic static void res(ListNode node) {\n    ListNode pre = null;\n    ListNode cur = node;\n    ListNode nex = node;\n    while (cur != null) {\n        nex = nex.next;\n        cur.next = pre;\n        pre = cur;\n        cur = nex;\n    }\n}\n```\n\nä¹Ÿæ˜¯ä¹‹å‰çš„ä»£ç äº†ï¼Œå†™çš„æ¯”è¾ƒçƒ‚ï¼Œä½†æ˜¯æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œè¾¹ç•Œéœ€è¦æ³¨æ„ï¼Œé€Ÿåº¦è¿˜è¡Œ 4ms  77% ã€‚\n\n\n## [21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨](https://leetcode-cn.com/problems/merge-two-sorted-lists/)\n\nå°†ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ \n\n**ç¤ºä¾‹ï¼š**\n\n```java\nè¾“å…¥ï¼š 1->2->4, 1->3->4\nè¾“å‡ºï¼š 1->1->2->3->4->4\n```\n\n**è§£æ³•ä¸€**\n\nå¸¸è§„è¿­ä»£çš„åšæ³•\n\n```java\n public ListNode mergeTwoLists(ListNode l1, ListNode l2) {\n        ListNode temp=new ListNode(0);\n        ListNode res=temp;\n        while(l1!=null&&l2!=null){\n            if(l2.val<l1.val){\n                temp.next=l2;\n                l2=l2.next;\n                temp=temp.next;\n            }else{\n                temp.next=l1;\n                l1=l1.next;\n                temp=temp.next;\n            }\n        }\n        temp.next=l1==null?l2:l1;\n        return res.next;\n}\n```\nå½’å¹¶åˆ†æ²»çš„æ€æƒ³ï¼ŒæœŸæœ«è€ƒè¯•çš„ä¸€é“é¢˜\n\n**è§£æ³•äºŒ**\n\né€’å½’çš„åšæ³•\n\n```java\npublic ListNode mergeTwoLists(ListNode l1, ListNode l2) {\n    ListNode dummyNode=new ListNode(-1);\n    mergeTwoLists(l1,l2,dummyNode);\n    return dummyNode.next;\n}\n\npublic void mergeTwoLists(ListNode l1, ListNode l2,ListNode res) {\n    if(l1==null){\n        res.next=l2;\n        return;\n    }\n\n    if(l2==null){\n        res.next=l1;\n        return;\n    }\n\n    if(l1.val>l2.val){\n        res.next=l2;\n        mergeTwoLists(l1,l2.next,res.next);\n    }else{\n        res.next=l1;\n        mergeTwoLists(l1.next,l2,res.next);\n    }\n}\n```\n\nä¸Šé¢æ˜¯æˆ‘ä¸€å¼€å§‹è‡ªå·±å†™çš„ï¼Œä¸€ç‚¹ä¹Ÿä¸é€’å½’\n\n```java\npublic ListNode mergeTwoLists(ListNode l1, ListNode l2) {\n    if(l1==null) return l2;\n    if(l2==null) return l1;\n    ListNode dummyNode=new ListNode(-1);\n    if(l1.val<l2.val){\n        l1.next=mergeTwoLists(l1.next,l2);\n        return l1;\n    }else{\n        l2.next=mergeTwoLists(l1,l2.next);\n        return l2;\n    }\n}\n```\n\nè¿™ç§çœ‹ç€å°±å¾ˆç®€æ´\n\n---\n## [23. åˆå¹¶Kä¸ªæ’åºé“¾è¡¨](https://leetcode-cn.com/problems/merge-k-sorted-lists/)\n\nåˆå¹¶ k ä¸ªæ’åºé“¾è¡¨ï¼Œè¿”å›åˆå¹¶åçš„æ’åºé“¾è¡¨ã€‚è¯·åˆ†æå’Œæè¿°ç®—æ³•çš„å¤æ‚åº¦ã€‚\n\n**ç¤ºä¾‹:**\n\n```java\nè¾“å…¥:\n[\n  1->4->5,\n  1->3->4,\n  2->6\n]\nè¾“å‡º: 1->1->2->3->4->4->5->6\n```\n\n**è§£æ³•ä¸€ï¼š**\n\n```java\npublic ListNode mergeKLists(ListNode[] lists) {\n    if(lists.length==0)return null;\n    ListNode temp=lists[0];\n    for (int i=0;i<lists.length-1;i++){\n        temp=merge2List(temp,lists[i+1]);\n    }\n    return temp;\n}\n\npublic static ListNode merge2List(ListNode headA,ListNode headB){\n    ListNode dummyNode=new ListNode(-1);\n    ListNode res=dummyNode;\n    ListNode tempA=headA;\n    ListNode tempB=headB;\n    while(tempB!=null&&tempA!=null){\n        if(tempB.val>tempA.val){\n            res.next=tempA;\n            tempA=tempA.next;\n        } else{\n            res.next=tempB;\n            tempB=tempB.next;\n        }\n        res=res.next;\n    }\n    res.next=tempA==null?tempB:tempA;\n    return dummyNode.next;\n}\n```\næœ€å…ˆæƒ³åˆ°çš„æ–¹æ³•ï¼Œå’Œå‰é¢çš„äºŒè·¯å½’å¹¶ä¸€æ ·ï¼ŒæŠŠå‰ä¸¤ä¸ªå½’å¹¶çš„ç»“æœå’Œåé¢çš„ç»§ç»­å½’å¹¶ã€‚é€Ÿåº¦å¤ªæ…¢äº†200mså·¦å³.....æ—¶é—´å¤æ‚åº¦æ˜¯`O(N^2)`.\n**è§£æ³•äºŒï¼š**\n\n```java\npublic ListNode mergeKLists2(ListNode[] lists) {\n    if(lists.length==0)return null;\n    return divide(lists,0,lists.length-1);\n}\n\npublic static ListNode divide(ListNode[] lists,int left,int right){\n    if(left>=right)return lists[left];\n    int mid=left+((right-left)>>1);\n    ListNode l = divide(lists,left,mid);\n    ListNode r = divide(lists,mid+1,right);\n    return merge2List(l,r);\n}\n\npublic static ListNode merge2List(ListNode headA,ListNode headB){\n    if(headA==null)return headB;\n    if(headB==null)return headA;\n    ListNode dummyNode=new ListNode(-1);\n    ListNode res=dummyNode;\n    ListNode tempA=headA;\n    ListNode tempB=headB;\n    while(tempB!=null&&tempA!=null){\n        if(tempB.val>tempA.val){\n            res.next=tempA;\n            tempA=tempA.next;\n        } else{\n            res.next=tempB;\n            tempB=tempB.next;\n        }\n        res=res.next;\n    }\n    res.next=tempA==null?tempB:tempA;\n    return dummyNode.next;\n}\n```\nçœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿï¼Ÿæ²¡é”™å°±æ˜¯å½’å¹¶æ’åºçš„æ€è·¯ï¼Œåˆ©ç”¨åˆ†æ²»çš„æ€æƒ³ï¼Œå…ˆå½’å¹¶å·¦è¾¹ï¼Œå†å½’å¹¶å³è¾¹ï¼Œç„¶åmergeå·¦å³çš„ç»“æœï¼Œæ—¶é—´å¤æ‚åº¦ä¸º`O(NlogK)` (é€’å½’æ ‘æ·±åº¦ä¸ºlogKï¼Œå½’å¹¶æ¯ä¸€å±‚æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯N)ï¼Œ 10mså·¦å³ï¼ŒNæ˜¯æ‰€æœ‰é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°ï¼ŒKæ˜¯é“¾è¡¨ä¸ªæ•°ã€‚è€Œä¸”å› ä¸ºæ˜¯é“¾è¡¨ç©ºé—´å¤æ‚åº¦ä¹Ÿä¸é«˜ã€‚å¦å¤–è¿™é¢˜ä¹Ÿå¯ä»¥æ”¹æˆéé€’å½’çš„æ–¹å¼å¦‚ä¸‹:\n```java\npublic ListNode mergeKLists3(ListNode [] lists){\n    if (lists.length == 0) {\n        return null;\n    }\n    int k = lists.length;\n    while (k > 1) {\n        for (int i = 0; i < k / 2; i++) {\n            //ä¸¤ä¸¤åˆå¹¶å°†ç»“æœä¿å­˜åœ¨å‰åŠéƒ¨åˆ†çš„èŠ‚ç‚¹ä¸­ç„¶åç¼©å°ä¸€åŠçš„èŒƒå›´\n            lists[i] = merge2Lists(lists[i], lists[i + (k + 1) / 2]);\n        }\n        //ç¼©å°ä¸€åŠçš„èŒƒå›´\n        k = (k + 1) / 2;\n    }\n    return lists[0];\n}\n```\n**è§£æ³•ä¸‰ï¼š**\n\n```java\n//å°æ ¹å †çš„æ–¹æ³•\npublic ListNode mergeKLists4(ListNode[] lists) {\n    //åˆ©ç”¨ä¸€ä¸ªæŒ‰èŠ‚ç‚¹å€¼æœ€å°æ¬¡åºæ’åˆ—çš„ä¼˜å…ˆé˜Ÿåˆ—, æ¯æ¬¡å–æœ€å°çš„èŠ‚ç‚¹åŠ å…¥è¿”å›é“¾è¡¨ä¸­\n    if(lists.length < 1) return null;\n    Queue<ListNode> pq = new PriorityQueue<>((a, b) -> (a.val - b.val));\n    ListNode head = new ListNode(0);\n    ListNode cur = head;\n    for (ListNode p : lists){\n        if(p != null)\n        pq.offer(p);\n    }\n    while(!pq.isEmpty()) {\n        cur.next = pq.poll();\n        cur = cur.next;\n        if(cur.next != null)\n        //è®²å½“å‰èŠ‚ç‚¹åä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—\n        pq.offer(cur.next);\n    }\n    return head.next;\n}\n```\n\nåˆ©ç”¨äº†å°æ ¹å †ï¼ŒJavaé‡Œé¢æœ‰å°æ ¹å †å¯ä»¥ç›´æ¥ç”¨ï¼Œæ€è·¯å°±æ˜¯æ¯æ¬¡æŠŠæ¯æ¡é“¾è¡¨çš„å¤´å…ƒç´ éƒ½æ”¾è¿›å°æ ¹å †é‡Œé¢ç„¶åæ‰¾å‡ºæœ€å°çš„åŠ åˆ°æ–°é“¾è¡¨ä¸­ç„¶åï¼Œæœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹çš„é“¾è¡¨å‘åç§»å†åŠ åˆ°å°æ ¹å †é‡Œé¢ï¼Œæ–¹æ³•è¿˜æ˜¯ç›¸å½“ç®€æ´çš„ã€‚ä½†æ˜¯ç”¨äº†90mså·¦å³æ¯”è¾ƒæ…¢ï¼Œæ—¶é—´å¤æ‚åº¦`O(NlogK)`å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œæ¯æ¬¡è°ƒæ•´æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯`logK`ï¼Œéœ€è¦è°ƒæ•´`N`æ¬¡(Kä¸ºé“¾è¡¨æ•°é‡ï¼ŒNä¸ºæ‰€æœ‰é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ `O(K)`\n\n## [355. è®¾è®¡æ¨ç‰¹](https://leetcode-cn.com/problems/design-twitter/)\n\nè®¾è®¡ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ¨ç‰¹(Twitter)ï¼Œå¯ä»¥è®©ç”¨æˆ·å®ç°å‘é€æ¨æ–‡ï¼Œå…³æ³¨/å–æ¶ˆå…³æ³¨å…¶ä»–ç”¨æˆ·ï¼Œèƒ½å¤Ÿçœ‹è§å…³æ³¨äººï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰çš„æœ€è¿‘åæ¡æ¨æ–‡ã€‚ä½ çš„è®¾è®¡éœ€è¦æ”¯æŒä»¥ä¸‹çš„å‡ ä¸ªåŠŸèƒ½ï¼š\n\n1. **postTweet(userId, tweetId):** åˆ›å»ºä¸€æ¡æ–°çš„æ¨æ–‡\n2. **getNewsFeed(userId):** æ£€ç´¢æœ€è¿‘çš„åæ¡æ¨æ–‡ã€‚æ¯ä¸ªæ¨æ–‡éƒ½å¿…é¡»æ˜¯ç”±æ­¤ç”¨æˆ·å…³æ³¨çš„äººæˆ–è€…æ˜¯ç”¨æˆ·è‡ªå·±å‘å‡ºçš„ã€‚æ¨æ–‡å¿…é¡»æŒ‰ç…§æ—¶é—´é¡ºåºç”±æœ€è¿‘çš„å¼€å§‹æ’åºã€‚\n3. **follow(followerId, followeeId):** å…³æ³¨ä¸€ä¸ªç”¨æˆ·\n4. **unfollow(followerId, followeeId):** å–æ¶ˆå…³æ³¨ä¸€ä¸ªç”¨æˆ·\n\n**å®ä¾‹**\n\n```java\nTwitter twitter = new Twitter();\n\n// ç”¨æˆ·1å‘é€äº†ä¸€æ¡æ–°æ¨æ–‡ (ç”¨æˆ·id = 1, æ¨æ–‡id = 5).\ntwitter.postTweet(1, 5);\n\n// ç”¨æˆ·1çš„è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªidä¸º5çš„æ¨æ–‡.\ntwitter.getNewsFeed(1);\n\n// ç”¨æˆ·1å…³æ³¨äº†ç”¨æˆ·2.\ntwitter.follow(1, 2);\n\n// ç”¨æˆ·2å‘é€äº†ä¸€ä¸ªæ–°æ¨æ–‡ (æ¨æ–‡id = 6).\ntwitter.postTweet(2, 6);\n\n// ç”¨æˆ·1çš„è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæ¨æ–‡ï¼Œidåˆ†åˆ«ä¸º -> [6, 5].\n// æ¨æ–‡id6åº”å½“åœ¨æ¨æ–‡id5ä¹‹å‰ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨5ä¹‹åå‘é€çš„.\ntwitter.getNewsFeed(1);\n\n// ç”¨æˆ·1å–æ¶ˆå…³æ³¨äº†ç”¨æˆ·2.\ntwitter.unfollow(1, 2);\n\n// ç”¨æˆ·1çš„è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªidä¸º5çš„æ¨æ–‡.\n// å› ä¸ºç”¨æˆ·1å·²ç»ä¸å†å…³æ³¨ç”¨æˆ·2.\ntwitter.getNewsFeed(1);\n```\n\n**è§£æ³•ä¸€**\n\nå…¶å®æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªkè·¯é“¾è¡¨çš„å½’å¹¶ï¼Œè¿™é‡Œç›´æ¥ç”¨çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œç„¶åç”¨java8çš„æ–°ç‰¹æ€§ç®€åŒ–äº†ä»£ç \n\n```java\nclass Twitter {\n    //å…¨å±€æ—¶é—´æˆ³\n    private  int timeStamp=0;\n    //Tweetæ˜¯æœ‰åºé“¾è¡¨,æŒ‰ç…§æ—¶é—´æˆ³æ¥æ’åº\n    private  Map<Integer,Tweet> userTweetMap=new HashMap<>();\n    //followMap\n    private  Map<Integer,Set<Integer>> userFollowMap=new HashMap<>();;\n\n    public Twitter() {}\n\n    public void postTweet(int userId, int tweetId) {\n        Tweet oldHead=userTweetMap.get(userId);\n        userTweetMap.compute(userId,(k,v)->new Tweet(tweetId,++timeStamp)).next=oldHead;\n    }\n\n    public List<Integer> getNewsFeed(int userId) {\n        PriorityQueue<Tweet> pq=new PriorityQueue<>((t1,t2)->t2.time-t1.time);\n        List<Integer> feed=new ArrayList<>();\n        follow(userId,userId);\n        userFollowMap.get(userId).forEach(followerId->Optional.ofNullable(userTweetMap.get(followerId)).ifPresent(tw->pq.offer(tw)));\n        int count=0;\n        while(!pq.isEmpty() && count<10){\n            Tweet tw=pq.poll();\n            feed.add(tw.twId);\n            if(tw.next!=null){\n                pq.offer(tw.next);\n            }\n            count++;\n        }\n        return feed;\n    }\n\n    /** Follower follows a followee. If the operation is invalid, it should be a no-op. */\n    public void follow(int followerId, int followeeId) {\n        userFollowMap.computeIfAbsent(followerId,k->new HashSet<>()).add(followeeId);\n    }\n\n    /** Follower unfollows a followee. If the operation is invalid, it should be a no-op. */\n    public void unfollow(int followerId, int followeeId) {\n        Optional.ofNullable(userFollowMap.get(followerId)).ifPresent(set->set.remove(followeeId));\n    }\n}\n\nclass Tweet{\n    int twId;\n    int time;\n    Tweet next;\n    public Tweet(int twId,int time){\n        this.twId=twId;\n        this.time=time;\n    }\n}\n```\n\n## [430. æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨](https://leetcode-cn.com/problems/flatten-a-multilevel-doubly-linked-list)\n\næ‚¨å°†è·å¾—ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œé™¤äº†ä¸‹ä¸€ä¸ªå’Œå‰ä¸€ä¸ªæŒ‡é’ˆä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå­æŒ‡é’ˆï¼Œå¯èƒ½æŒ‡å‘å•ç‹¬çš„åŒå‘é“¾è¡¨ã€‚è¿™äº›å­åˆ—è¡¨å¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå·±çš„å­é¡¹ï¼Œä¾æ­¤ç±»æ¨ï¼Œç”Ÿæˆå¤šçº§æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚\n\næ‰å¹³åŒ–åˆ—è¡¨ï¼Œä½¿æ‰€æœ‰ç»“ç‚¹å‡ºç°åœ¨å•çº§åŒé“¾è¡¨ä¸­ã€‚æ‚¨å°†è·å¾—åˆ—è¡¨ç¬¬ä¸€çº§çš„å¤´éƒ¨ã€‚\n\n**ç¤ºä¾‹:**\n\nè¾“å…¥:\n 1---2---3---4---5---6--NULL\n         |\n         7---8---9---10--NULL\n             |\n             11--12--NULL\n\nè¾“å‡º:\n1-2-3-7-8-11-12-9-10-4-5-6-NULL\n\n**è¯´æ˜:**\n\nç»™å‡ºä»¥ä¸‹å¤šçº§åŒå‘é“¾è¡¨:\n\n![mark](http://static.imlgw.top///20190303/DqC2qKF5h63V.png?imageslim)\n\næˆ‘ä»¬åº”è¯¥è¿”å›å¦‚ä¸‹æ‰€ç¤ºçš„æ‰å¹³åŒå‘é“¾è¡¨:\n\n![mark](http://static.imlgw.top///20190303/qOSn0TLmMuCt.png?imageslim)\n\n**è§£æ³•ä¸€ï¼š**\n\n```java\n/*\n        è¿™ç§è§£æ³•æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„\n        æ¯æ¬¡æœ‰å­é“¾çš„æ—¶å€™å°±ç›´æ¥æŠŠå­é“¾éå†åˆ°å°¾ ç„¶åæ·»åŠ åˆ°é“¾è¡¨ä¸­å½¢æˆæ–°ä¸»é“¾ æŠŠå­é“¾çš„å…¥å£èŠ‚ç‚¹childæŒ‡å®šä¸ºnull\n        ç„¶åä¸»é“¾ç»§ç»­å‘åéå†æ‰€ä»¥æ•´ä¸ªéå†çš„æ¬¡æ•°å°±æ˜¯æ•´ä¸ªé“¾è¡¨å…ƒç´ çš„ä¸ªæ•° O(M)\n*/\npublic static Node flatten1(Node head) {\n    if(head==null || head.next==null&&head.child==null){\n        return head;\n    }\n    Node cur=head;\n    Node nNext;\n    Node child;\n    while(cur!=null){\n        if(cur.child!=null){\n            //æœ‰å­é“¾è¡¨\n            child=cur.child;\n            //å­é“¾è¡¨çš„è¡¨å¤´\n            nNext=cur.next;\n            //ä¸»é“¾çš„ä¸‹ä¸€èŠ‚ç‚¹\n            //è¿æ¥å­é“¾è¡¨\n            cur.next=child;\n            //ä¸»é“¾çš„ä¸‹ä¸€èŠ‚ç‚¹ä¸ºå­é“¾è¡¨å¤´\n            child.prev=cur;\n            //å­é“¾è¡¨çš„å‰é©±èŠ‚ç‚¹\n            //å·²ç»æ‹¼æ¥åˆ°ä¸»é“¾ï¼Œå­©å­é“¾ç½®ä¸ºç©º ï¼ˆè¿™æ­¥è¿˜å¾ˆå…³é”®æˆ‘å¼€å§‹ä¸€ç›´å¿˜è®¾ç½®ä¸ºnullï¼‰\n            cur.child=null;\n            if(nNext==null){\n                //éå†åˆ°ä¸»é“¾æœ€åä¸€ä¸ªäº†\n                //æ‰€ä»¥æ²¡æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåé¢çš„æ­¥éª¤ä¸ç”¨ç»§ç»­ä½†æ˜¯ä¹Ÿä¸èƒ½Break å› ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹æœ‰å¯èƒ½è¿˜æœ‰å­é“¾è¡¨\n                continue;\n            }\n            while(child.next!=null){\n                //æ‰¾åˆ°æ–°ä¸»é“¾çš„ä¸‹ä¸€èŠ‚ç‚¹ (å­é“¾çš„æœ€åä¸€ä¸ª)\n                child=child.next;\n            }\n            //è¿æ¥ä»¥å‰çš„ä¸»é“¾\n            child.next=nNext;\n            nNext.prev=child;\n        }\n        //ä¸»é“¾è¡¨å‘åç§»åŠ¨\n        cur=cur.next;\n    }\n    return head;\n}\n```\n**è§£æ³•äºŒï¼š**\n\n```java\n    //æ ‡å‡†çš„DFS\n    public static Node flatten2(Node node) {\n       if(node==null){\n            return node;\n        }\n        Node head = node;\n        while (head!=null){\n            //æˆ‘æ„Ÿè§‰è¿™æ ·ä¼šå¿«ä¸€äº›\n             Node next = head.next;\n            if(head.child!=null){\n                next = head.next;\n                //å­é“¾è¡¨æ‰å¹³åŒ– è¿”å›å¤´èŠ‚ç‚¹\n                Node nextLayer = flatten2(head.child);//å­é“¾è¡¨çš„å¤´èŠ‚ç‚¹\n                //è¿æ¥å­é“¾è¡¨å¤´å’Œä¸»é“¾\n                head.next = nextLayer;\n                nextLayer.prev = head;\n                //ç„¶åå­é“¾è¡¨ç½®ä¸ºnull\n                head.child = null;\n                //éå†åˆ°å­é“¾è¡¨çš„ç»“å°¾\n                while (nextLayer.next!=null){\n                    nextLayer = nextLayer.next;\n                }\n                //è¿æ¥å­é“¾è¡¨çš„å°¾éƒ¨\n                nextLayer.next = next;\n                if(next!=null){\n                    next.prev = nextLayer;\n                }\n            }\n            //è¿™é‡Œå°±ç›´æ¥è·³è¿‡å­é“¾è¡¨ ä¹‹å‰çš„æ˜¯head=head.next; ä½†æ˜¯å› ä¸ºä¹‹å‰çš„å­é“¾è¡¨å·²ç»åŠ åˆ°ä¸»é“¾è¡¨ä¸­æ‰€ä»¥ä¼šæµªè´¹ä¸€äº›æ—¶é—´ï¼ˆå­é“¾è¡¨è‚¯å®šæ˜¯å·²ç»æ‰å¹³åŒ–çš„è‚¯å®šéƒ½æ²¡æœ‰å­é“¾è¡¨ï¼‰\n            head = next;\n        }\n        return node;\n    }\n```\n\nä¸¤ç§æ–¹æ³•éƒ½æ˜¯çœ‹çš„è¯„è®ºé‡Œé¢çš„ç¬¬äºŒç§æˆ‘ç¨å¾®æ”¹äº†ä¸‹ï¼Œç›´æ¥è·³è¿‡å­é“¾è¡¨æ•ˆç‡ä¼šé«˜å¾ˆå¤šï¼Œä¸è¿‡è¿™é¢˜caseä¹Ÿæ¯”è¾ƒå°‘çœ‹ä¸å‡ºå·®å¼‚ã€‚\n\n---\n## [141. ç¯å½¢é“¾è¡¨](https://leetcode-cn.com/problems/linked-list-cycle)\n\nç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚\n\nä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° `pos` æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ `pos` æ˜¯ `-1`ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```c\nè¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1\nè¾“å‡ºï¼štrue\nè§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚\n```\n![mark](http://static.imlgw.top///20190303/H2wmyaG9uoiz.png?imageslim)\n\n**ç¤ºä¾‹ 2ï¼š**\n```c\nè¾“å…¥ï¼š head = [1,2], pos = 0\nè¾“å‡ºï¼š true\nè§£é‡Šï¼š é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚\n\n```\n![mark](http://static.imlgw.top///20190303/UqIc2XWwtxbo.png?imageslim)\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```c\nè¾“å…¥ï¼š head = [1], pos = -1\nè¾“å‡ºï¼š false\nè§£é‡Šï¼š é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚\n\n```\n![mark](http://static.imlgw.top///20190303/dAg8QrxqJJga.png?imageslim)\n\n**è¿›é˜¶ï¼š**\n\nä½ èƒ½ç”¨O(1)ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ\n\n**è§£æ³•ä¸€**\n\næœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µåº”è¯¥æ˜¯ä¸è€ƒè™‘çš„ç›´æ¥ false\n```java\npublic static Boolean hasCycle(ListNode head) {\n    if (head == null || head.next == null)\n                  return false;\n    //å¿«æ…¢æŒ‡é’ˆ ç›¸é‡çš„æ—¶å€™å¿«æŒ‡é’ˆå›åˆ°å¤´éƒ¨stepæ”¹ä¸º1 å†æ¬¡ç›¸é‡çš„æ—¶å€™å°±æ˜¯ç¯çš„pos\n    //è¿™é¢˜åªæ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰ç¯æ‰€ä»¥åªè¦ç›¸é‡å°±æœ‰ç¯\n    ListNode slow=head;\n    ListNode fast=head.next;\n    while(slow!=fast){\n        //æœ‰ç¯æ˜¯ä¸ä¼šèµ°åˆ°å°½å¤´çš„\n        if(fast.next==null || fast.next.next==null){\n            return false;\n        }\n        fast=fast.next.next;\n        slow=slow.next;\n    }\n    return true;\n}\n```\n\n## [141. ç¯å½¢é“¾è¡¨â…¡](https://leetcode-cn.com/problems/linked-list-cycle-ii/)\n\nç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› `null`ã€‚\n\nä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° `pos` æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ `pos` æ˜¯ `-1`ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚\n\n**è¯´æ˜ï¼š** ä¸å…è®¸ä¿®æ”¹ç»™å®šçš„é“¾è¡¨ã€‚ ps:ä¸Šé¢˜çš„åŸºç¡€ä¸Šè¿”å›å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹\n\n```golang\n//UPDATEï¼š2020.9.7 å®è¡Œé‡å†™æ‰€æœ‰é“¾è¡¨é¢˜çš„è®¡åˆ’\n// A-->B-->C-->D   Bä¸ºå…¥ç¯ç‚¹ï¼ŒDä¸ºç›¸é‡ç‚¹ï¼Œç›¸é‡æ—¶slow = AD, fast = AD+DB+BD\n// fast = 2*slow ==> AD = DB + BD ==> AB+BD = DB+BD ==> AB = DB\nfunc detectCycle(head *ListNode) *ListNode {\n    var fast, slow = head, head\n    for fast!=nil && fast.Next!=nil {\n        fast = fast.Next.Next\n        slow = slow.Next\n        if fast == nil { //æ— ç¯\n            return nil\n        }\n        if fast == slow { //æœ‰ç¯ï¼Œnextä¸€å®šä¸ä¸ºnull\n            for head!=fast {\n                head = head.Next\n                fast = fast.Next\n            }\n            return head\n        }\n    }\n    return nil\n}\n```\n> è¿™ç§è§£æ³•è¿˜æ˜¯æŒºæœ‰æ„æ€çš„`å¿«æ…¢æŒ‡é’ˆ`ï¼Œå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤æ­¥æ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€æ­¥åœ¨ç¯ä¸Šç›¸é‡çš„æ—¶å€™å¿«æŒ‡é’ˆå›åˆ°å¤´èŠ‚ç‚¹æ­¥æ•°è°ƒæ•´ä¸º1ï¼Œå†>æ¬¡ç›¸é‡çš„>æ—¶å€™ï¼ˆè¿™é‡Œæœ‰å¯èƒ½é‡åˆï¼Œå½“å¤´èŠ‚ç‚¹å°±æ˜¯å…¥ç¯èŠ‚ç‚¹çš„æ—¶å€™ï¼‰å°±æ˜¯å…¥ç¯èŠ‚ç‚¹ã€‚\n> åŸç† :\n> A---->B---->C      åˆ†åˆ«ä¸º`å¤´èŠ‚ç‚¹`ï¼Œ`å…¥ç¯èŠ‚ç‚¹`ï¼Œ`ç¬¬ä¸€æ¬¡ç›¸é‡çš„èŠ‚ç‚¹`\n> åˆ†æç¬¬ä¸€æ¬¡ç›¸é‡æ—¶å¿«æ…¢æŒ‡é’ˆèµ°è¿‡çš„è·¯å¾„å¯å¾—\n> AB+BC+CB+BC=2(AB+BC)  å¿«æŒ‡é’ˆèµ°è¿‡çš„è·¯ç¨‹è‚¯å®šæ˜¯æ…¢æŒ‡é’ˆçš„ä¸¤å€\n> åŒ–ç®€æœ€åå°±å¾—åˆ°AB=CB æ‰€ä»¥ä»–ä»¬`å†æ¬¡ç›¸é‡`å°±æ˜¯å…¥ç¯çš„èŠ‚ç‚¹\n\n---\n## [61.æ—‹è½¬é“¾è¡¨](https://leetcode-cn.com/problems/rotate-list/)\nç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œæ—‹è½¬é“¾è¡¨ï¼Œå°†é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹å‘å³ç§»åŠ¨  kä¸ªä½ç½®ï¼Œå…¶ä¸­ kæ˜¯éè´Ÿæ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n```java\nè¾“å…¥: 1->2->3->4->5->NULL, k = 2\nè¾“å‡º: 4->5->1->2->3->NULL\nè§£é‡Š:\nå‘å³æ—‹è½¬ 1 æ­¥: 5->1->2->3->4->NULL\nå‘å³æ—‹è½¬ 2 æ­¥: 4->5->1->2->3->NULL\n```\n\n**ç¤ºä¾‹ 2:**\n\n```java\nè¾“å…¥: 0->1->2->NULL, k = 4\nè¾“å‡º: 2->0->1->NULL\nè§£é‡Š:\nå‘å³æ—‹è½¬ 1 æ­¥: 2->0->1->NULL\nå‘å³æ—‹è½¬ 2 æ­¥: 1->2->0->NULL\nå‘å³æ—‹è½¬ 3 æ­¥: 0->1->2->NULL\nå‘å³æ—‹è½¬ 4 æ­¥: 2->0->1->NULL\n```\n\n**è§£æ³•ä¸€**\n\n\n```java\npublic static ListNode rotateRight(ListNode head, int k) {\n    if(head==null||head.next==null){\n        return head;\n    }\n    //å…ˆè·å–ä¸‹é“¾è¡¨çš„é•¿åº¦ï¼Œé¡ºä¾¿è®°å½•tailçš„å€¼\n    ListNode temp=head;\n    ListNode tail=head;\n    int length=0;\n    while(temp!=null){\n        length++;\n        if(temp.next==null){\n            tail=temp;\n            break;\n        }\n        temp=temp.next;\n    }\n    //å°†KåŒ–ç®€\n    k=k%length;\n    if(k==0) return head;\n    temp=head;\n    int count=0;\n    //ç„¶åå†éå†ä¸€éé“¾è¡¨åœ¨ length-k çš„åœ°æ–¹æ–­å¼€\n    while(temp!=null){\n        if(count==(length-k-1)){\n            tail.next=head;\n            head=temp.next;\n            temp.next=null;\n            return head;\n        }\n        count++;\n        temp=temp.next;\n    }\n    return head;\n}\n```\nè™½ç„¶éš¾åº¦æ˜¯midï¼Œä½†æ˜¯æ„Ÿè§‰è¿™é¢˜è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œæˆ‘çœ‹è§æœ‰ä¸€ç§æ¯”è¾ƒå¥½ç‚¹çš„æ–¹æ³•æ˜¯åœ¨ç¬¬ä¸€éå¾ªç¯å®Œä¹‹åå°†é“¾è¡¨è½¬æ¢ä¸º`åŒå‘é“¾è¡¨`ç„¶åå†ç§»åŠ¨è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„\n\n## [328. å¥‡å¶é“¾è¡¨](https://leetcode-cn.com/problems/odd-even-linked-list)\nç»™å®šä¸€ä¸ªå•é“¾è¡¨ï¼ŒæŠŠæ‰€æœ‰çš„å¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹åˆ†åˆ«æ’åœ¨ä¸€èµ·ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„å¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹æŒ‡çš„æ˜¯èŠ‚ç‚¹ç¼–å·çš„å¥‡å¶æ€§ï¼Œè€Œä¸æ˜¯èŠ‚ç‚¹çš„å€¼çš„å¥‡å¶æ€§ã€‚\n\nè¯·å°è¯•ä½¿ç”¨åŸåœ°ç®—æ³•å®Œæˆã€‚ä½ çš„ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦åº”ä¸º O(1)ï¼Œæ—¶é—´å¤æ‚åº¦åº”ä¸º O(nodes)ï¼Œnodes ä¸ºèŠ‚ç‚¹æ€»æ•°ã€‚\n\n**ç¤ºä¾‹ 1:**\n\nè¾“å…¥: `1->2->3->4->5->NULL`\nè¾“å‡º: `1->3->5->2->4->NULL`\n\n**ç¤ºä¾‹ 2:**\n\nè¾“å…¥: `2->1->3->5->6->4->7->NULL`\nè¾“å‡º: `2->3->6->7->1->5->4->NULL`\n\n**è¯´æ˜:**\n\nåº”å½“ä¿æŒå¥‡æ•°èŠ‚ç‚¹å’Œå¶æ•°èŠ‚ç‚¹çš„ç›¸å¯¹é¡ºåºã€‚\né“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è§†ä¸ºå¥‡æ•°èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹è§†ä¸ºå¶æ•°èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\n//å¥‡å¶é“¾è¡¨\npublic static ListNode oddEvenList(ListNode head) {\n    if(head==null||head.next==null||head.next.next==null)return head;\n    // 1 2 3 4 5 6 7\n    // 1 2 3 4 5 6\n    ListNode pOdd=head;\n    ListNode pEven=head.next;\n    ListNode temp=pEven;\n    while(pEven!=null&&pEven.next!=null){\n        pOdd.next=pEven.next;\n        //å¥‡æ•°å…ˆèµ°\n        pOdd=pOdd.next;\n        pEven.next=pOdd.next;\n        pEven=pEven.next;\n    }\n    pOdd.next=temp;\n    return head;\n}\n```\nå¾ˆåƒè¸©çŸ³å¤´è¿‡æ²³çš„æ¸¸æˆï¼Œä¸€é“å¾ˆç®€å•çš„midï¼Œä¸çŸ¥é“ä¸ºå•¥ä¸€å¼€å§‹æŠ äº†åŠå¤©çš„è¾¹ç•Œã€‚ã€‚ã€‚æœç„¶\n> è¿˜æ˜¯ä¸ç†Ÿæ‚‰å•Šã€‚Add oil ! ! !\n\n\n## [147. å¯¹é“¾è¡¨è¿›è¡Œæ’å…¥æ’åº](https://leetcode-cn.com/problems/insertion-sort-list)\n\næ’å…¥æ’åºçš„åŠ¨ç”»æ¼”ç¤ºå¦‚ä¸Šç¯‡æ–‡ç« ã€‚\næ¯æ¬¡è¿­ä»£æ—¶ï¼Œä»è¾“å…¥æ•°æ®ä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼ˆç”¨çº¢è‰²è¡¨ç¤ºï¼‰ï¼Œå¹¶åŸåœ°å°†å…¶æ’å…¥åˆ°å·²æ’å¥½åºçš„é“¾è¡¨ä¸­ã€‚\næ’å…¥æ’åºç®—æ³•ï¼š\næ’å…¥æ’åºæ˜¯è¿­ä»£çš„ï¼Œæ¯æ¬¡åªç§»åŠ¨ä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å¯ä»¥å½¢æˆä¸€ä¸ªæœ‰åºçš„è¾“å‡ºåˆ—è¡¨ã€‚\næ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ’å…¥æ’åºåªä»è¾“å…¥æ•°æ®ä¸­ç§»é™¤ä¸€ä¸ªå¾…æ’åºçš„å…ƒç´ ï¼Œæ‰¾åˆ°å®ƒåœ¨åºåˆ—ä¸­é€‚å½“çš„ä½ç½®ï¼Œå¹¶å°†å…¶æ’å…¥ã€‚\né‡å¤ç›´åˆ°æ‰€æœ‰è¾“å…¥æ•°æ®æ’å…¥å®Œä¸ºæ­¢ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: 4->2->1->3\nè¾“å‡º: 1->2->3->4\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: -1->5->3->4->0\nè¾“å‡º: -1->0->3->4->5\n```\n\n**è§£æ³•ä¸€**\n\n```java\n//beat 50%\npublic static  ListNode insertionSortList(ListNode head) {\n    if(head==null||head.next==null)return head;\n    //å“‘èŠ‚ç‚¹\n    ListNode dummyNode=new ListNode(Integer.MIN_VALUE);\n    System.out.println(dummyNode.val);\n    dummyNode.next=head;\n    ListNode tempNode=head;\n    //å¤–å¾ªç¯å†…çš„æŒ‡é’ˆ\n    ListNode loopVariable=head.next;\n    ListNode loopPre=head;\n    //å†…å¾ªç¯çš„æŒ‡é’ˆ\n    ListNode tempPre=dummyNode;\n    while(loopVariable!=null){\n        //å¤´æ’æ³•\n        for (tempNode=dummyNode;tempNode!=loopVariable;tempNode=tempNode.next){\n            if(tempNode.val>loopVariable.val){\n                //System.out.println(loopVariable.val);\n                //printList(dummyNode.next);\n                //å…ˆå¤„ç†å¥½loopVariableçš„å‰åèŠ‚ç‚¹\n                loopPre.next=loopVariable.next;\n                //å†å¤„ç†tempNodeå‰åçš„èŠ‚ç‚¹\n                loopVariable.next=tempNode;\n                tempPre.next=loopVariable;\n                //loopVariable å½’ä½\n                loopVariable=loopPre;\n                break;\n            }\n            tempPre=tempNode;\n        }\n        loopPre=loopVariable;\n        loopVariable=loopVariable.next;\n    }\n    return dummyNode.next;\n}\n```\nä¸Šé¢çš„æ˜¯æˆ‘å¼€å§‹è‡ªå·±å†™çš„ï¼Œä½†æ˜¯æäº¤åå‘ç°é€Ÿåº¦æœ‰ç‚¹æ…¢40ms 50%å·¦å³ ç„¶åæˆ‘æœ‰ç‚¹ä¸ä¿¡æŠŠæ¯”è¾ƒé å‰çš„æ‹·äº†ä¸€ä¸ª 10msğŸ˜‚å‰å‡ å10msä»¥å†…çš„éƒ½æ˜¯ç”¨çš„æ–¹æ³•ä¸æ˜¯æ’å…¥....\nåœ¨ç ”ç©¶åˆ«äºº10msçš„ä»£ç æ—¶çªç„¶æ„è¯†åˆ°äº†é—®é¢˜æ‰€åœ¨ æˆ‘åœ¨è¿›è¡Œæ’å…¥çš„æ—¶å€™æ²¡æœ‰åˆ¤æ–­å°±æ—¶æ²¡æœ‰å…³å¿ƒæ˜¯ä¸æ˜¯åº”è¯¥è¿›è¡Œæ’å…¥æ“ä½œï¼Œå¯¹äºæ•°ç»„çš„æ’å…¥æ’åºæ˜¯ä¸ç”¨å…³å¿ƒè¿™ä¸ªé—®é¢˜çš„ï¼Œå› ä¸ºæ˜¯åå‘éå†çš„ è€Œè¿™é‡Œæ˜¯é“¾è¡¨åªèƒ½æ­£å‘çš„éå†å¦‚æœä¸åˆ¤æ–­å°±ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´\n\n```java\n// 16ms  beat  70% å¼€å§‹å°‘å†™äº†ä¸€ä¸ªifåˆ¤æ–­\npublic static  ListNode insertionSortList(ListNode head) {\n    if(head==null||head.next==null)return head;\n    //å“‘èŠ‚ç‚¹\n    ListNode dummyNode=new ListNode(Integer.MIN_VALUE);\n    System.out.println(dummyNode.val);\n    dummyNode.next=head;\n    ListNode tempNode=head;\n    //å¤–å¾ªç¯å†…çš„æŒ‡é’ˆ\n    ListNode loopVariable=head.next;\n    ListNode loopPre=head;\n    //å†…å¾ªç¯çš„æŒ‡é’ˆ\n    ListNode tempPre=dummyNode;\n    while(loopVariable!=null){\n        //å¤´æ’æ³•\n        if(loopVariable.val<loopPre.val){\n            for (tempNode=dummyNode;tempNode!=loopVariable;tempNode=tempNode.next){\n                if(tempNode.val>loopVariable.val){\n                    //System.out.println(loopVariable.val);\n                    //printList(dummyNode.next);\n                    //å…ˆå¤„ç†å¥½loopVariableçš„å‰åèŠ‚ç‚¹\n                    loopPre.next=loopVariable.next;\n                    //å†å¤„ç†tempNodeå‰åçš„èŠ‚ç‚¹\n                    loopVariable.next=tempNode;\n                    tempPre.next=loopVariable;\n                    //loopVariable å½’ä½\n                    loopVariable=loopPre;\n                    break;\n                }\n                tempPre=tempNode;\n            }\n        }\n        loopPre=loopVariable;\n        loopVariable=loopVariable.next;\n    }\n    return dummyNode.next;\n}\n```\nè¿™é¢˜æ•´ä½“æ€è·¯å°±æ˜¯æŒ‰ç…§æ’å…¥æ’åºçš„æ€è·¯æ¥çš„ï¼Œå€¼å¾—æ³¨æ„çš„å°±æ˜¯é“¾è¡¨åªèƒ½æ­£å‘éå†ï¼Œè€Œä¸”éœ€è¦è€ƒè™‘ä¿å­˜çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªï¼Œæ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªï¼Œä»¥åŠå¾…æ’å…¥çš„å‰ä¸€ä¸ª(å¤´æ’æ³•)ã€‚\n\n## [148. æ’åºé“¾è¡¨](https://leetcode-cn.com/problems/sort-list)\n\nåœ¨ O(n log n) æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦ä¸‹ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ’åºã€‚\n\n**ç¤ºä¾‹ 1:**\n\nè¾“å…¥: 4->2->1->3\nè¾“å‡º: 1->2->3->4\nç¤ºä¾‹ 2:\n\nè¾“å…¥: -1->5->3->4->0\nè¾“å‡º: -1->0->3->4->5\n\n>ä¸Šé¢é‚£é¢˜æ—¶é—´å¤æ‚åº¦æ˜æ˜¾æ˜¯O(n2)æœ€åï¼Œè¿™é¢˜è¦æ±‚æ˜¯O(nlogn)å’Œå¸¸æ•°ç©ºé—´ä¸Šé¢çš„æ’å…¥è‚¯å®šä¸é€‚åˆäº†\n\n**è§£æ³•ä¸€**\n\n```java\n//å½’å¹¶æ’æ³•\npublic static  ListNode sortList(ListNode head) {\n    if(head==null||head.next==null)return null;\n    return mergeSort(head);\n}\n\npublic static ListNode mergeSort(ListNode head){\n    if(head.next==null){\n        return head;\n    }\n    ListNode fast=head;\n    ListNode slow=head;\n    ListNode pre=head;\n    while(fast!=null&&fast.next!=null){\n        pre=slow;\n        fast=fast.next.next;\n        slow=slow.next;\n    }\n    pre.next=null;\n    //è¿™é‡Œè¦æ³¨æ„æ–­å¼€ä¸¤æ¡é“¾è¡¨ä¸ç„¶åé¢ä¸æ–¹ä¾¿æ‰¾ä¸­ç‚¹\n    ListNode left = mergeSort(head);\n    //å½’å¹¶å·¦è¾¹\n    ListNode right = mergeSort(slow);\n    //å½’å¹¶å³è¾¹\n    return merge2list(left,right);\n    //è¿”å› å·¦å³ä¸¤æ¡é“¾è¡¨å½’å¹¶ç»“æœ\n}\n\npublic static ListNode merge2list(ListNode headA,ListNode headB){\n    if(headA==null)return headB;\n    if(headB==null)return headA;\n    ListNode dummyNode=new ListNode(-1);\n    dummyNode.next=headA;\n    ListNode temp=dummyNode;\n    while(headA!=null&&headB!=null){\n        if(headA.val>headB.val){\n            temp.next=headB;\n            headB=headB.next;\n        } else{\n            temp.next=headA;\n            headA=headA.next;\n        }\n        temp=temp.next;\n    }\n    temp.next=headA==null?headB:headA;\n    return dummyNode.next;\n}\n```\n\n4ms 85%  æ ‡å‡†çš„`å½’å¹¶æ“ä½œ`åˆ†æ²»çš„æ€æƒ³ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ‰£äº†å¥½é•¿æ—¶é—´ï¼Œæœ€åè¿˜æ˜¯çœ‹äº†åˆ«äººçš„ä»£ç æ‰çŸ¥é“ï¼Œå…¶å®ä¸€å¼€å§‹å°±æƒ³åˆ°äº†`å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹`ä½†æ˜¯æ„Ÿè§‰æ—¶é—´å¤æ‚åº¦å¯èƒ½ä¼šå˜å¾—æ›´é«˜å°±æ²¡é‚£æ ·åšã€‚ã€‚ã€‚è¿˜æ˜¯å¤ªèœäº†æ—¶é—´å¤æ‚åº¦éƒ½ä¸ä¼šåˆ†æã€‚ã€‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå°åœ°æ–¹å°±æ˜¯æ‰¾åˆ°ä¸­ç‚¹ä¹‹åè¦è®°å¾—æ–­å¼€ä¸­ç‚¹å’Œåé¢é“¾è¡¨çš„è¿æ¥ï¼Œè¿™æ ·ä¼šæ–¹ä¾¿åé¢å½’å¹¶ï¼Œä¸ç„¶å°±éœ€è¦ä¼ é€’ä¸€ä¸ªè¾¹ç•Œçš„æŒ‡é’ˆé‚£æ ·åˆä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼ˆæ²¡é”™æˆ‘å¼€å§‹å°±æ˜¯è¿™ä¹ˆåšçš„ğŸ˜­ï¼‰\n\nä¸‹é¢è¿™ç§æ˜¯åæ¥åˆå†™çš„`ç»å…¸å¿«æ’`ï¼Œ400msï¼Œ12% æˆ‘éƒ½æ€€ç–‘æˆ‘åˆ°åº•å†™äº†ä¸ªå•¥ï¼Ÿåæ¥æŠŠæ’å…¥æ‹¿æ¥è¯•äº†ä¸‹884+msç„¶ååˆçœ‹äº†ä¸€éæ‰ç›¸ä¿¡æˆ‘å†™çš„æ˜¯å¿«æ’ã€‚\n\n```java\n//æˆ‘è‡ªå·±å†™çš„å¿«æ’\npublic static ListNode sortList4(ListNode head){\n    if(head==null||head.next==null)return head;\n    sortList(head,null);\n    return head;\n}\n\n//å¿«æ’å®ç°\npublic static void sortList(ListNode head,ListNode tail) {\n    if(tail==head){\n        return;\n    }\n    //ç¡®å®šæ¢çº½å…ƒç´ \n    ListNode base=partion(head,tail);\n    sortList(head,base);\n    sortList(base.next,tail);\n}\n\n//çœ‹äº†ä¸‹åˆ«äººçš„åšå®¢ä¹Ÿå­¦åˆ°äº†ä¸€ç§å¿«æ’çš„æ–°æ€è·¯\n//æ…¢æŒ‡é’ˆå·¦è¾¹éƒ½æ˜¯å°äºbaseæ¢çº½å…ƒç´ çš„ï¼Œå¿«æŒ‡é’ˆå’Œæ…¢æŒ‡é’ˆä¸­é—´éƒ½æ˜¯å¤§äºç­‰äºbaseæ¢çº½å…ƒç´ çš„\n//æ…¢æŒ‡é’ˆåé¢çš„éƒ½æ˜¯æœªçŸ¥åŒºåŸŸ\npublic static ListNode partion(ListNode head,ListNode tail){\n    ListNode base=head;\n    ListNode fast=head.next;\n    ListNode slow=head;\n    // 3  1  3  2  5  -1 0\n    //    s  f\n    while(fast!=tail){\n        if(fast.val<=base.val){\n            //äº¤æ¢ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼\n            swap(fast,slow.next);\n            slow=slow.next;\n        }\n        fast=fast.next;\n    }\n    //å½’ä½\n    swap(head,slow);\n    //åº”è¯¥å¯ä»¥è¯•è¯•è¿”å›åŒºé—´\n    return slow;\n}\n\npublic static void swap(ListNode a,ListNode b){\n    int temp=a.val;\n    a.val=b.val;\n    b.val=temp;\n}\n```\n\n> å®é™…ä¸Šå¿«æ’ç¡®å®ä¸é€‚åˆé“¾è¡¨ï¼ˆä¸‹é¢å…‰é€Ÿæ‰“è„¸ï¼‰å› ä¸ºæ¯•ç«Ÿä¸æ˜¯æ•°ç»„å¯ä»¥ä»ä¸¤è¾¹å¼€å§‹éå†ï¼Œé“¾è¡¨æ¯æ¬¡éƒ½éœ€è¦éå†æ•´ä¸ªé“¾è¡¨æ‰èƒ½åˆ’åˆ†å¥½åŸºå‡†ä½ç½®ã€‚\n\nçœ‹äº†ä¸‹å‰å‡ çš„ä»£ç å‘ç°äº†è¿™ä¸ªï¼Œ`éæ ‡å‡†çš„ä¸‰å‘åˆ‡åˆ†çš„å¿«æ’`ï¼Œä¸ºå•¥è¯´æ˜¯éæ ‡å‡†å‘¢ï¼Ÿçœ‹ä¸‹é¢ä»£ç å°±çŸ¥é“äº†ï¼Œæˆ‘ç»™åŠ äº†æ³¨é‡Š\n\n```java\npublic static ListNode sortList3(ListNode head) {\n    ListNode node = new ListNode(0);\n    node.next = head;\n    sort(node, null);\n    return node.next;\n}\n\nprivate  static void sort(ListNode from, ListNode to) {\n    if (from == null || from == to || from.next == to || from.next.next == to)return;\n    int v = from.next.val;\n    //åŸºå‡†å…ƒç´ \n    ListNode mid = from;\n    //åˆ‡åˆ†ç‚¹æŒ‡é’ˆ\n    ListNode equal = from.next;\n    //ç­‰äºåŒºåŸŸå³è¾¹ç•Œ\n    ListNode node = from.next;\n    //éå†ç”¨çš„æŒ‡é’ˆ\n    while (node.next != to) {\n        //nodeä¸åˆ°å¤´  å·¦å¼€å³å¼€åŒºé—´ï¼ˆfrom,toï¼‰\n        if (node.next.val < v) {\n            //å°äºåŸºå‡†ä½ç½®å…ƒç´ \n            //ä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œç”¨äºæ’å…¥èŠ‚ç‚¹\n            //å°äºåŸºå‡†å…ƒç´ çš„èŠ‚ç‚¹\n            ListNode currentNext = node.next.next;\n            //ä¿å­˜åˆ‡åˆ†ç‚¹çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä½œç”¨åŒä¸Š\n            ListNode midNext = mid.next;\n            //äº¤æ¢node.nextå’Œmid\n            //çº¸ä¸Šç”»ä¸€ä¸‹å°±äº†è§£äº†\n            mid.next = node.next;\n            node.next.next = midNext;\n            node.next = currentNext;\n            //åˆ‡åˆ†ç‚¹åç§»\n            mid = mid.next;\n        } else if (node.next.val == v) {\n            //nodeçš„ä¸‹ä¸€ä¸ªç­‰äºåŸºå‡†å…ƒç´ \n            //3 1 2 3 4 5 6\n            if (equal == node) {\n                //ç­‰äºåŒºåŸŸå’Œnode.next==valç›¸é‚»äº†ï¼Œç›´æ¥è·³è¿‡\n                equal = node.next;\n                node = node.next;\n            } else {\n                //å°†node.nextæ’å…¥equalåé¢\n                //ç„¶åequalå‘åç§»åŠ¨\n                //å’Œä¸Šé¢çš„ç±»ä¼¼\n                ListNode nodeNext = node.next.next;\n                ListNode equalNext = equal.next;\n                equal.next = node.next;\n                node.next.next = equalNext;\n                node.next = nodeNext;\n                equal = equal.next;\n            }\n        } else {\n            //å¤§äºç›´æ¥è·³è¿‡\n            node = node.next;\n        }\n    }\n    // [mid.next---equal] ä¸ºç­‰äºvalçš„èŠ‚ç‚¹\n    sort(from, mid.next);\n    sort(equal, to);\n}\n```\n\næ•´ä½“æ€è·¯å°±æ˜¯ä¸€å…±æœ‰ä¸‰ä¸ªæŒ‡é’ˆï¼Œ`mid`(åˆ‡åˆ†ç‚¹)  `equal`(ç­‰äºåŒº) `node`(éå†æŒ‡é’ˆ) nodeä»froméå†åˆ°toï¼Œæ³¨æ„è¿™é‡Œæ˜¯`å·¦å¼€å³å¼€åŒºé—´` å°±æ˜¯è¯´å¤´fromå’Œå°¾toéƒ½å–ä¸åˆ°ï¼Œç„¶åå°†å°ä¸baseçš„èŠ‚ç‚¹æ’å…¥åˆ°midçš„åé¢ï¼Œç„¶åmidåç§»ï¼Œç­‰äºåŒºæ’å…¥åˆ°equalçš„åé¢ï¼Œæœ€åå½¢æˆçš„å°±æ˜¯`[mid.next---equal]` ä¸ºç­‰äºvalçš„èŠ‚ç‚¹ï¼Œç„¶åå¯¹å­åŒºåŸŸé€’å½’å°±okäº†ï¼Œè¿™ä¸ªç”¨æ—¶ `4ms` ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è¿˜è¦ç»§ç»­åŠ æ²¹å•Šï¼ï¼ï¼\n\n\n## [138.å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨](https://leetcode-cn.com/problems/copy-list-with-random-pointer)\n\nç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚\n\nè¦æ±‚è¿”å›è¿™ä¸ªé“¾è¡¨çš„æ·±æ‹·è´ã€‚ \n\n**ç¤ºä¾‹ï¼š**\n\n![mark](http://static.imlgw.top///20190308/tR8e3eu2yqaq.png?imageslim)\n\n```c\nè¾“å…¥ï¼š\n`{\"$id\":\"1\",\"next\":{\"$id\":\"2\",\"next\":null,\"random\":{\"$ref\":\"2\"},\"val\":2},\"random\":{\"$ref\":\"2\"},\"val\":1}`\nè§£é‡Šï¼š\nèŠ‚ç‚¹ 1 çš„å€¼æ˜¯ 1ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆå’ŒéšæœºæŒ‡é’ˆéƒ½æŒ‡å‘èŠ‚ç‚¹ 2 ã€‚\nèŠ‚ç‚¹ 2 çš„å€¼æ˜¯ 2ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ nullï¼ŒéšæœºæŒ‡é’ˆæŒ‡å‘å®ƒè‡ªå·±ã€‚\n```\n**æç¤ºï¼š**\n\nä½ å¿…é¡»è¿”å›ç»™å®šå¤´çš„æ‹·è´ä½œä¸ºå¯¹å…‹éš†åˆ—è¡¨çš„å¼•ç”¨ã€‚\n\n**è§£æ³•ä¸€** \n\nåˆ©ç”¨Mapä¿å­˜åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨çš„å¯¹åº”å…³ç³»\n\n```java\npublic static Node copyRandomList(Node head) {\n    Map<Node,Node> copNode =new HashMap<>();\n    Node temp=head;\n    while(temp!=null){\n        //å»ºç«‹å¯¹åº”å…³ç³»\n        copNode.put(temp,new Node(temp.val,null,null));\n        temp=temp.next;\n    }\n    //å†å¾ªç¯ä¸€æ¬¡å¤åˆ¶nextå’ŒRadomèŠ‚ç‚¹\n    temp=head;\n    while(temp!=null){\n        copNode.get(temp).next=copNode.get(temp.next);\n        copNode.get(temp).random=copNode.get(temp.random);\n        temp=temp.next;\n    }\n    return copNode.get(head);\n}\n```\nç¬¬ä¸€ä¸ªå¾ªç¯åˆ©ç”¨Mapå°†åŸé“¾è¡¨å’Œæ‹·è´é“¾è¡¨å½¢æˆå¯¹åº”å…³ç³»ï¼Œç¬¬äºŒä¸ªå¾ªç¯å°±æ˜¯ç›´æ¥ç»™æ‹·è´é“¾è¡¨çš„nextåŸŸå’ŒrandomåŸŸèµ‹å€¼ã€‚\n\n**è§£æ³•äºŒ**\n\nå¥¥ä¹‰ å½±åˆ†èº«\n\n```java\npublic static Node copyRandomList2(Node head) {\n    if(head==null)return head;\n    Node temp=head;\n    //é“¾è¡¨  å¥¥ä¹‰ - å½±åˆ†èº«\n    while(temp!=null){\n        //è¿™é‡Œç›´æ¥å°†nextåŸŸä¼ å…¥æ„é€ å™¨å®Œæˆå’Œåé¢å…ƒç´ çš„è¿æ¥\n        temp.next=new Node(temp.val,temp.next,null);\n        temp=temp.next.next;\n    }\n    temp=head;\n    //è¿æ¥randomåŸŸ\n    while(temp!=null){\n        if(temp.random!=null){\n            temp.next.random=temp.random.next;\n        }\n        temp=temp.next.next;\n    }\n    temp=head;\n    // åˆ†ç¦»\n    Node newHead=head.next;\n    Node next=null;\n    while(temp!=null){ //=å°†æ¯ä¸ªå…ƒç´ çš„nextæŒ‡å‘ä¸‹ä¸€ä¸ªçš„ä¸‹ä¸€ä¸ª\n        next=temp.next;\n        if(next!=null){\n            temp.next=next.next;\n        }\n        temp=next;\n    }\n    return newHead;\n}\n```\nä¸ºå•¥è¦å«å½±åˆ†èº«ï¼Ÿå› ä¸ºå¸…...è¿™ç§æ–¹æ³•æ¯”ä¸Šé¢çš„è¦å¿«ä¸€ç‚¹å¯èƒ½æ˜¯åˆ›å»ºhashMapæ¯”è¾ƒè€—æ—¶é—´ï¼Œå…¶å®åˆ†æè¿™ä¸¤ç§æ–¹æ³•å…¶å®éƒ½æ˜¯å…ˆæŠŠé“¾è¡¨æ‹·è´äº†ä¸€ä»½ï¼Œç„¶åé€šè¿‡å¯¹åº”å…³ç³»æ¥è¿æ¥æ‹·è´é“¾è¡¨çš„nextå’ŒrandomåŸŸï¼Œmapæ˜¯é€šè¿‡é”®å€¼å¯¹çš„æ–¹å¼å¯¹åº”æ‹·è´é“¾è¡¨ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿çš„é€šè¿‡åŸé“¾è¡¨æ‰¾åˆ°æ‹·è´é“¾è¡¨çš„random. ç„¶åä¸Šé¢è¿™ç§æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·ï¼Œåœ¨åŸé“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹åé¢copyä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„randomæ¥æ‰¾æ‹·è´èŠ‚ç‚¹çš„random(å‰ä¸€ä¸ªèŠ‚ç‚¹çš„randomçš„next) ä¸»è¦å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”å…³ç³».\n\n> tips: è¿™é¢˜OJä¸Šçš„0msæ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™é¢˜æœ¬æ„è‚¯å®šä¹Ÿä¸æ˜¯è¿™ä¸ª\n>\n> \n>\n> ![mark](http://static.imlgw.top///20190308/p1GPgJVYaURp.png?imageslim)\n\næœ€å¼€å§‹èƒ½é€šè¿‡ä¸»è¦æ˜¯OJåå°åªåˆ¤æ–­äº†valçš„å€¼ï¼Œå¯ä»¥çœ‹å‡ºç°åœ¨é¢˜ç›®å·²ç»æ”¹äº†ã€‚ç°åœ¨è‚¯å®šæ˜¯è·‘ä¸è¿‡çš„ï¼Œå¯èƒ½æ˜¯åˆ¤æ–­äº†randomæ˜¯ä¸æ˜¯newå‡ºæ¥çš„(æˆ‘è¯•äº†ä¸‹çœ‹äº†ä¸‹è¿”å›è¿™ä¸ª)\nè¾“å…¥\n`{\"$id\":\"1\",\"next\":{\"$id\":\"2\",\"next\":null,\"random\":{\"$ref\":\"2\"},\"val\":2},\"random\":{\"$ref\":\"2\"},\"val\":1}`\nè¾“å‡º\n`{\"$id\":\"1\",\"next\":{\"$id\":\"2\",\"next\":null,\"random\":`\n\n`{\"$id\":\"3\",\"next\":null,\"random\":null,\"val\":2},\"val\":2},`\n\n`\"random\":{\"$id\":\"4\",\"next\":null,\"random\":null,\"val\":2},\"val\":1}`\né¢„æœŸç»“æœ\n`{\"$id\":\"1\",\"next\":{\"$id\":\"2\",\"next\":null,\"random\":{\"$ref\":\"2\"},\"val\":2},\"random\":{\"$ref\":\"2\"},\"val\":1}`\n\n**è§£æ³•ä¸‰**\n\né‡å†™äº†ä¸€éï¼Œé¢˜ç›®æ”¹äº†ä¸€ç‚¹\n\n```java\npublic Node copyRandomList(Node head) {\n    if(head==null) return null;\n    Node temp=head;\n    while(temp!=null){\n        Node next=temp.next;\n        Node newNode=new Node(temp.val);\n        temp.next=newNode;\n        newNode.next=next;\n        temp=next;\n    }\n    temp=head;\n    //é‡å†™çš„æ—¶å€™æƒ³æŠŠrandomè¿æ¥å’Œåˆ†ç¦»ä¸€èµ·åš\n    //ç„¶åå°±é”™äº†ã€‚ã€‚ã€‚\n    //è¿™é‡ŒnextåŸŸçš„å˜åŒ–å°±ä¼šå¯¼è‡´åé¢randomåŸŸçš„å˜åŒ–ï¼Œæœ€åç»“æœå°±é”™äº†\n    while(temp!=null){\n        Node next=temp.next.next;\n        if(temp.random!=null){\n            temp.next.random=temp.random.next;\n        }\n        temp=next;\n    }\n    Node newHead=head.next;\n    temp=head;\n    //å°†æ¯ä¸ªå…ƒç´ çš„nextåŸŸæŒ‡å‘ä¸‹ä¸€ä¸ªçš„ä¸‹ä¸€ä¸ªå°±è¡Œäº†\n    while(temp!=null){\n        Node next=temp.next;\n        if(next!=null){\n            temp.next=next.next;\n        }\n        temp=next;\n    }\n    return newHead;\n}\n```\n\n## [24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹](https://leetcode-cn.com/problems/swap-nodes-in-pairs/)\nç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›äº¤æ¢åçš„é“¾è¡¨ã€‚\n\nä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚\n\n**ç¤ºä¾‹:**\n\nç»™å®š 1->2->3->4, ä½ åº”è¯¥è¿”å› 2->1->4->3.\n\n**è§£æ³•ä¸€**\n\n```java\npublic ListNode swapPairs(ListNode head) {\n    if(head==null||head.next==null)return head;\n    ListNode dummyNode=new ListNode(-1);\n    dummyNode.next=head;\n    ListNode nex=head.next;\n    ListNode cur=head;\n    ListNode pre=dummyNode;\n    // -1|1 2 3 4\n    while(nex!=null){\n        pre.next=nex;\n        cur.next=nex.next;\n        nex.next=cur;\n        pre=cur;\n        if(cur.next==null){\n            return dummyNode.next;\n        }\n        cur=cur.next;\n        nex=cur.next;\n    }\n    return dummyNode.next;\n}\n```\nå…¶å®è·Ÿåè½¬é“¾è¡¨æ˜¯ä¸€æ ·çš„ï¼Œä¸‰ä¸ªæŒ‡é’ˆåˆ†åˆ«è®°å½•å‰ ä¸­ åä¸‰ä¸ªèŠ‚ç‚¹ç„¶åé€†åºï¼Œåªä¸è¿‡æ­¥é•¿ä¸ä¸€æ ·ï¼Œè¿™é‡Œstepä¸º2ï¼Œä¸€æ¬¡èµ°ä¸¤æ­¥ï¼Œ æˆ‘ä¸Šé¢çš„ä»£ç å¯èƒ½å†™çš„æœ‰äº›ä¹±ï¼Œæ€è·¯è¿˜æ˜¯ä¸€æ ·çš„\n\n**è§£æ³•äºŒ**\n\n```java\n//é€’å½’ç‰ˆæœ¬\npublic ListNode swapPairs(ListNode head) {\n    if(head==null||head.next==null){\n        return head;\n    }\n    ListNode next=head.next;\n    head.next=swapPairs(next.next);\n    next.next=head;\n    return next;\n}\n```\né€’å½’æ˜¯çœŸçš„ç®€æ´ï¼Œæˆ‘æœ€å¼€å§‹å†™åè½¬é“¾è¡¨çš„é€’å½’å°±æ˜¯è¿™ä¹ˆå†™çš„ğŸ˜‚\n\n\n## [25.Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨](https://leetcode-cn.com/problems/reverse-nodes-in-k-group/)\n\nç»™å‡ºä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ k ä¸ªèŠ‚ç‚¹ä¸€ç»„è¿›è¡Œç¿»è½¬ï¼Œå¹¶è¿”å›ç¿»è½¬åçš„é“¾è¡¨ã€‚\n\nk æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå®ƒçš„å€¼å°äºæˆ–ç­‰äºé“¾è¡¨çš„é•¿åº¦ã€‚å¦‚æœèŠ‚ç‚¹æ€»æ•°ä¸æ˜¯ k çš„æ•´æ•°å€ï¼Œé‚£ä¹ˆå°†æœ€åå‰©ä½™èŠ‚ç‚¹ä¿æŒåŸæœ‰é¡ºåºã€‚\n\n**ç¤ºä¾‹ :**\n\n```java\nç»™å®šè¿™ä¸ªé“¾è¡¨ï¼š1->2->3->4->5\nå½“ k = 2 æ—¶ï¼Œåº”å½“è¿”å›: 2->1->4->3->5\nå½“ k = 3 æ—¶ï¼Œåº”å½“è¿”å›: 3->2->1->4->5\n```\n\n**è¯´æ˜ :**\n\n- ä½ çš„ç®—æ³•åªèƒ½ä½¿ç”¨å¸¸æ•°çš„é¢å¤–ç©ºé—´ã€‚\n- ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚\n\n**è§£æ³•ä¸€**\n\n```java\n//éé€’å½’ï¼Œç†ä¸€ä¸‹æ€è·¯ï¼š è®°å½•æ¯æ¬¡ç¿»è½¬å‰åçš„èŠ‚ç‚¹ ç„¶åç¿»è½¬è¿”å›å¤´ å°†æ¯ K ä¸ªå…ƒç´ å½“æˆä¸€ä¸ªæ•´ä½“\npublic static ListNode reverseKGroup(ListNode head,int k) {\n    if(head==null||head.next==null)return head;\n    ListNode dummyNode=new ListNode(-1);\n    dummyNode.next=head;\n    ListNode pre=dummyNode;\n    ListNode cur=head;\n    ListNode next=head;\n    ListNode temp;\n    while(next!=null){\n        //temp ä¿å­˜ cur æ–¹ä¾¿åé¢è¿æ¥  K+1ä½ç½®çš„å…ƒç´ \n        temp=cur;\n        //k ä¸ªä¸€ç»„ç¿»è½¬\n        int step=k;\n        while(step>0 && next!=null){\n            //nextèµ°åˆ° K+1 ä½ç½®èŠ‚ç‚¹\n            next=next.next;\n            step--;\n            //å°ç»†èŠ‚ k>é“¾è¡¨é•¿åº¦æ—¶åº”è¯¥ç›´æ¥è¿”å›ï¼ˆæˆ‘è®¤ä¸ºï¼‰ç­‰ä¸‹æäº¤äº†çœ‹çœ‹\n            //æ‰€ä»¥ç›´æ¥åº”è¯¥ç›´æ¥è¿”å› (æ‰äº†kçš„å€¼åˆ¤æ–­ å› ä¸ºæœ‰å¯èƒ½åˆšå¥½æœ‰kä¸ªå…ƒç´ )\n            if(next==null&& step!=0){\n                return dummyNode.next;\n            }\n        }\n        //ç¿»è½¬ cur--next.prev è¿”å›å¤´èŠ‚ç‚¹\n        //è¿æ¥ åè½¬åçš„å¤´èŠ‚ç‚¹\n        pre.next=reverse(cur,k);\n        temp.next=next;\n        //pre tempå‘åç§»åŠ¨\n        pre=temp;\n        cur=next;\n    }\n    return dummyNode.next;\n}\n\n// -1| 1 2 3 | 4 5 6 | 7 8\n//ç¿»è½¬é“¾è¡¨å¹¶è¿”å›å­é“¾è¡¨\npublic static ListNode reverse(ListNode node,int k){\n    ListNode pre=null;\n    ListNode cur=node;\n    ListNode next=node;\n    while(k>0&&next!=null){\n        next=next.next;\n        cur.next=pre;\n        pre=cur;\n        cur=next;\n        k--;\n    }\n    //è¿”å›åè½¬åçš„å¤´èŠ‚ç‚¹\n    System.out.println(\"å¤´\"+pre.val);\n    return pre;\n}\n```\n\n7ms 74% ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€é“åšå‡ºæ¥çš„å›°éš¾é¢˜ï¼Œ[ä¸Šä¸€é“å›°éš¾é¢˜è¶…æ—¶äº†](http://imlgw.top/2018/10/31/%E4%B8%80%E9%81%93LeetCode%E5%BC%95%E5%8F%91%E7%9A%84%E6%83%A8%E6%A1%88/)\n\nè¿™é¢˜è™½ç„¶è¯´æ˜¯å›°éš¾é¢˜ä½†æ˜¯å…¶å®ä¹Ÿä¸éš¾ï¼Œæ„Ÿè§‰å°±midå·¦å³çš„æ°´å¹³ï¼Œç¡®å®æ¯”ä¸Šä¸€é¢˜è¦å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯åªè¦æ€è·¯ç†æ¸…æ¥šå…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œä¸‹é¢æ˜¯æˆ‘ç”¨OneNoteç”»çš„ä¸€å¼ å›¾ç‰‡ã€‚\n\n4ä¸ªæŒ‡é’ˆåˆ†åˆ«å¯¹åº” K é“¾è¡¨çš„ å‰ä¸€ä¸ª(pre)  Ké“¾è¡¨çš„å¤´èŠ‚ç‚¹(cur) æ²¡æœ‰ç¿»è½¬å‰çš„Ké“¾è¡¨çš„å¤´èŠ‚ç‚¹and**ç¿»è½¬åçš„å°¾èŠ‚ç‚¹(temp)**   Ké“¾è¡¨çš„åä¸€ä¸ªèŠ‚ç‚¹(next)ã€‚ç„¶åå…¶å®å°±ç®€å•äº†ï¼Œå†™ä¸€ä¸ªç¿»è½¬é“¾è¡¨çš„å‡½æ•°ç„¶åè¿”å›å¤´èŠ‚ç‚¹(ä¹Ÿå¯ä»¥å¤šåŠ ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘**ç¿»è½¬å‰çš„å¤´èŠ‚ç‚¹**)ï¼Œç„¶åå°±ç®€å•äº†ï¼ŒnextæŒ‡é’ˆä¸€æ¬¡èµ°Kæ­¥ï¼Œèµ°åˆ° K+1 ä½ç½® åŒæ—¶ä¹Ÿæ˜¯**ä¸‹ä¸€æ¬¡Ké“¾è¡¨çš„å¤´èŠ‚ç‚¹**ï¼Œè€Œtempåˆ™ä¸ºä¸‹ä¸€æ¬¡Ké“¾è¡¨çš„pre...ç„¶åå¾ªç¯è¿™ä¸ªè¿‡ç¨‹å°±è¡Œäº†ï¼Œå…¶å®å†™æˆé€’å½’ä¼šå¾ˆç®€æ´ï¼Œä½†æ˜¯æˆ‘æ˜¯çœŸçš„ä¸ä¼šå†™é€’å½’ï¼Œå¤ªèœäº†Orz\n\n![mark](http://static.imlgw.top///20190312/jl7moiy7PbjH.png?imageslim)\n\n**è§£æ³•äºŒ**\n\n2020.2.23 æ—¶éš”å¤šå¹´ç°åœ¨å›å¤´é‡æ–°å†™äº†ä¸€ä¸ªé€’å½’çš„å†™æ³•ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€æ´çš„\n\n```java\n//æ—¶éš”ä¸€å¹´,å›å¤´è‡ªå·±å†™äº†ä¸€ä¸ªé€’å½’çš„è§£æ³•\npublic ListNode reverseKGroup(ListNode head, int k) {\n    if(head==null || k==1) return head;\n    int sum=0;\n    ListNode temp=head;\n    //é¢„å…ˆè®¡ç®—é“¾è¡¨çš„é•¿åº¦\n    while(temp!=null){\n        temp=temp.next;\n        sum++;\n    }\n    return reverse(head,k,sum);\n}\n\npublic ListNode reverse(ListNode head, int k,int remain) {\n    if(remain<k) return head; //ramainä¸è¶³kä¸ªreturn \n    if(head==null) return head;\n    //æ­£å¸¸çš„ç¿»è½¬æ“ä½œ\n    ListNode cur=head,pre=null,last=head;\n    int count=k;\n    while(count-- >0){\n        last=cur.next;\n        cur.next=pre;\n        pre=cur;\n        cur=last;\n    }\n    //ä¸‹ä¸€æ¬¡ä»lastå¼€å§‹ç¿»è½¬,remain-k\n    head.next=reverse(last,k,remain-k);\n    return pre;\n}\n```\n**è§£æ³•ä¸‰**\n\nè¿™é¢˜é€’å½’æ˜æ˜¾æ˜¯ä¸å¤ªç¬¦åˆè¦æ±‚çš„ï¼Œç©ºé—´å¤æ‚åº¦ä¸æ˜¯å¸¸æ•°çš„ï¼Œå¦‚æœæœ‰è¦æ±‚è¿˜æ˜¯è¦å†™ä¸‹é¢çš„è§£æ³•\n\n```go\nfunc reverseKGroup(head *ListNode, k int) *ListNode {\n    dummyNode := &ListNode{\n        Next: head,\n        Val:  -1,\n    }\n    pre := dummyNode\n    cur := head\n    //-1 | 1 2 3 4 5\n    for cur != nil {\n        for i := 0; i < k-1 && cur != nil; i++ {\n            cur = cur.Next\n        }\n        if cur == nil { //ä¸è¶³kä¸ª\n            break\n        }\n        next := cur.Next\n        cur.Next = nil \n        start := pre.Next\n        pre.Next = reverse(start)\n        start.Next = next\n        //è¿™é‡Œè¦æ³¨æ„pre=start\n        pre = start\n        cur = next\n    }\n    return dummyNode.Next\n}\n\nfunc reverse(head *ListNode) *ListNode {\n    var pre *ListNode\n    var cur = head\n    for cur != nil {\n        next := cur.Next\n        cur.Next = pre\n        pre = cur\n        cur = next\n    }\n    return pre\n}\n```\néš”ä¸€æ®µæ—¶é—´å°±ä¼šé‡æ–°å†™ä¸€éï¼Œå†™è‚¯å®šå†™çš„å‡ºæ¥ï¼Œå°±æ˜¯è¦æƒ³æ¸…æ¥šï¼Œæœ€å¥½æä¸ªcaseåœ¨ä¸Šé¢ï¼Œä¸€è¾¹æ¨¡æ‹Ÿä¸€è¾¹å†™\n> åšé“¾è¡¨çš„é¢˜å°±æ˜¯å¾—ç»†å¿ƒå•Šï¼Œå®¹æ˜“æŠŠè‡ªå·±ç»•è¿›å»ï¼Œä¸Šé¢çš„è§£æ³•å°±æ˜¯çœ‹äº†é¢˜è§£æ‰å†™å‡ºæ¥çš„\n\n## [817. é“¾è¡¨ç»„ä»¶](https://leetcode-cn.com/problems/linked-list-components)\n\nç»™å®šä¸€ä¸ªé“¾è¡¨ï¼ˆé“¾è¡¨ç»“ç‚¹åŒ…å«ä¸€ä¸ªæ•´å‹å€¼ï¼‰çš„å¤´ç»“ç‚¹ headã€‚\nåŒæ—¶ç»™å®šåˆ—è¡¨ Gï¼Œè¯¥åˆ—è¡¨æ˜¯ä¸Šè¿°é“¾è¡¨ä¸­æ•´å‹å€¼çš„ä¸€ä¸ªå­é›†ã€‚\nè¿”å›åˆ—è¡¨ G ä¸­ç»„ä»¶çš„ä¸ªæ•°ï¼Œè¿™é‡Œå¯¹ç»„ä»¶çš„å®šä¹‰ä¸ºï¼šé“¾è¡¨ä¸­ä¸€æ®µæœ€é•¿è¿ç»­ç»“ç‚¹çš„å€¼ï¼ˆè¯¥å€¼å¿…é¡»åœ¨åˆ—è¡¨ G ä¸­ï¼‰æ„æˆçš„é›†åˆã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥: \nhead: 0->1->2->3\nG = [0, 1, 3]\nè¾“å‡º: 2\nè§£é‡Š: \né“¾è¡¨ä¸­,0 å’Œ 1 æ˜¯ç›¸è¿æ¥çš„ï¼Œä¸” G ä¸­ä¸åŒ…å« 2ï¼Œæ‰€ä»¥ [0, 1] æ˜¯ G çš„ä¸€ä¸ªç»„ä»¶ï¼ŒåŒç† [3] ä¹Ÿæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œæ•…è¿”å› 2ã€‚\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥: \nhead: 0->1->2->3->4\nG = [0, 3, 1, 4]\nè¾“å‡º: 2\nè§£é‡Š: \né“¾è¡¨ä¸­ï¼Œ0 å’Œ 1 æ˜¯ç›¸è¿æ¥çš„ï¼Œ3 å’Œ 4 æ˜¯ç›¸è¿æ¥çš„ï¼Œæ‰€ä»¥ [0, 1] å’Œ [3, 4] æ˜¯ä¸¤ä¸ªç»„ä»¶ï¼Œæ•…è¿”å› 2ã€‚\n```\n\n**æ³¨æ„:**\n\n- å¦‚æœ N æ˜¯ç»™å®šé“¾è¡¨ head çš„é•¿åº¦ï¼Œ1 <= N <= 10000ã€‚\n- é“¾è¡¨ä¸­æ¯ä¸ªç»“ç‚¹çš„å€¼æ‰€åœ¨èŒƒå›´ä¸º [0, N - 1]ã€‚\n- 1 <= G.length <= 10000\n- G æ˜¯é“¾è¡¨ä¸­æ‰€æœ‰ç»“ç‚¹çš„å€¼çš„ä¸€ä¸ªå­é›†.\n\n**è§£æ³•ä¸€**\n\n```java\npublic int numComponents(ListNode head, int[] G) {\n    if(head==null||head.next==null) return head;\n    ListNode temp=head;\n    int res=0;\n    while(temp!=null){\n        if(isInG(temp.val,G)){\n            while(temp!=null&&isInG(temp.val,G)){\n                temp=temp.next;\n            }\n            res++;\n            if(temp==null){\n                return res;\n            }\n        }\n        temp=temp.next;\n    }\n    return res;\n}\n\npublic static Boolean isInG(int val,int[] G){\n    for (int i=0;i<G.length;i++){\n        if(G[i]==val){\n            return true;\n        }\n    }\n    return false;\n}\n```\né¦–å…ˆæƒ³åˆ°çš„æ–¹æ³• 91ms 19%..... æœ‰ç‚¹æ…¢äº†ï¼Œç„¶åæˆ‘ç¨å¾®æ”¹äº†ä¸‹ã€‚\n\n```java\npublic int numComponents2(ListNode head, int[] G) {\n    ListNode temp=head;\n    int res=0;\n    Boolean [] isInG=new Boolean[10000];\n    int j=0;\n    while(temp!=null){\n        for (int i=0;i<G.length;i++){\n            if(G[i]==temp.val){\n                isInG[j]=true;\n                break;\n            }\n        }\n        j++;\n        temp=temp.next;\n    }\n    temp=head;\n    for (int i=0;temp!=null;temp=temp.next,i++){\n        if(isInG[i]){\n            while(temp!=null&&isInG[i]){\n                temp=temp.next;\n                i++;\n            }\n            res++;\n            if(temp==null){\n                return res;\n            }\n        }\n    }\n    return res;\n}\n```\n   ç”¨äº†ä¸€ä¸ªæ•°ç»„ä¿å­˜äº†æ¯ä¸ªä½ç½®çš„çŠ¶æ€é€Ÿåº¦è·Ÿå‰é¢çš„å·®ä¸å¤šã€‚ã€‚ã€‚ä¸»è¦é—®é¢˜å°±æ˜¯é‚£ä¸ªæ•°ç»„çš„åˆ›å»ºï¼Œè¿™ç§åˆ›å»ºæ–¹å¼ç”¨è¿ç»­çš„ä¸‹æ ‡æ¥å¯¹åº”è¿ç»­çš„é“¾è¡¨çš„æ¯ä¸ªå…ƒç´ ï¼Œæ¯æ¬¡éƒ½è¦éå†Gæ‰çŸ¥é“å½“å‰ä½ç½®æ˜¯ä¸æ˜¯åœ¨Gä¸­ã€‚\n\n   å…¶å®å¯ä»¥ç›´æ¥æŠŠå½“å‰èŠ‚ç‚¹çš„valä½œä¸ºæ•°ç»„çš„ä¸‹æ ‡è¿™æ ·æ—¢æœ‰äº†å¯¹åº”å…³ç³»ä¹Ÿä¸ç”¨éå†G.å¯ä»¥è¯´æ˜¯å¾ˆä¼˜ç§€äº†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™æ ·åšæ˜¯æœ‰å‰ææ¡ä»¶çš„é‚£å°±æ˜¯é“¾è¡¨ä¸­çš„å…ƒç´ å€¼åº”è¯¥`æ²¡æœ‰è´Ÿæ•°`ï¼Œè¿˜æ˜¯é¢˜åšå°‘äº†å•Š Orzã€‚\n\n```java\npublic int numComponents3(ListNode head, int[] G) {\n    ListNode temp=head;\n    int res=0;\n    Boolean [] isInG=new Boolean[10000];\n    int j=0;\n    //æ¢ä¸€ç§æ–¹å¼ ä»¥node.valä½œä¸ºæ•°ç»„çš„ä¸‹æ ‡\n    for (int i:G){\n        isInG[i]=true;\n    }\n    while(temp!=null){\n        if(isInG[temp.val]){\n            while(temp!=null&&isInG[temp.val]){\n                temp=temp.next;\n            }\n            res++;\n            if(temp==null){\n                return res;\n            }\n        }\n        temp = temp.next;\n    }\n    return res;\n}\n```\n\n## [1019. é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªæ›´å¤§èŠ‚ç‚¹](https://leetcode-cn.com/problems/next-greater-node-in-linked-list/)\n\nç»™å‡ºä¸€ä¸ªä»¥å¤´èŠ‚ç‚¹ `head` ä½œä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾è¡¨ã€‚é“¾è¡¨ä¸­çš„èŠ‚ç‚¹åˆ†åˆ«ç¼–å·ä¸ºï¼š`node_1, node_2, node_3, ...` ã€‚\n\næ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½æœ‰ä¸‹ä¸€ä¸ªæ›´å¤§å€¼ï¼ˆnext larger **value**ï¼‰ï¼šå¯¹äº `node_i`ï¼Œå¦‚æœå…¶ `next_larger(node_i)` æ˜¯ `node_j.val`ï¼Œé‚£ä¹ˆå°±æœ‰ `j > i` ä¸”  `node_j.val > node_i.val`ï¼Œè€Œ `j` æ˜¯å¯èƒ½çš„é€‰é¡¹ä¸­æœ€å°çš„é‚£ä¸ªã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„ `j`ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ›´å¤§å€¼ä¸º `0` ã€‚\n\nè¿”å›æ•´æ•°ç­”æ¡ˆæ•°ç»„ `answer`ï¼Œå…¶ä¸­ `answer[i] = next_larger(node_{i+1})` ã€‚\n\n**æ³¨æ„ï¼š** åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯¸å¦‚ `[2,1,5]` è¿™æ ·çš„**è¾“å…¥**ï¼ˆä¸æ˜¯è¾“å‡ºï¼‰æ˜¯é“¾è¡¨çš„åºåˆ—åŒ–è¡¨ç¤ºï¼Œå…¶å¤´èŠ‚ç‚¹çš„å€¼ä¸º 2ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹å€¼ä¸º 1ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹å€¼ä¸º 5 ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n```java\nè¾“å…¥ï¼š[2,1,5]\nè¾“å‡ºï¼š[5,5,0]\n```\n\n**ç¤ºä¾‹ 2ï¼š**\n\n```java\nè¾“å…¥ï¼š[2,7,4,3,5]\nè¾“å‡ºï¼š[7,0,5,5,0]\n```\n\n**ç¤ºä¾‹ 3ï¼š**\n\n```java\nè¾“å…¥ï¼š[1,7,5,1,9,2,5,1]\nè¾“å‡ºï¼š[7,9,9,9,0,5,0,0]\n```\n\n**æç¤ºï¼š**\n\n1. å¯¹äºé“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œ`1 <= node.val <= 10^9`\n2. ç»™å®šåˆ—è¡¨çš„é•¿åº¦åœ¨ `[0, 10000]` èŒƒå›´å†…\n\n**è§£æ³•ä¸€**\n\n```java\npublic static int[] nextLargerNodes(ListNode head) {\n    //listé‡Œé¢å­˜å…ƒç´ \n    ArrayList<Integer> A = new ArrayList<>();\n    for (ListNode node = head; node != null; node = node.next)\n                A.add(node.val);\n    int[] res = new int[A.size()];\n    //æ ˆé‡Œé¢å­˜ç´¢å¼•\n    Stack<Integer> stack = new Stack<>();\n    for (int i = 0; i < A.size(); ++i) {\n        while (!stack.isEmpty() && A.get(stack.peek()) < A.get(i))\n             res[stack.pop()] = A.get(i);\n        stack.push(i);\n    }\n    return res;\n}\n```\n\næ–°é¢˜ï¼Œç£¨äº†å¥½é•¿æ—¶é—´ï¼Œæ²¡åšå‡ºæ¥ã€‚ã€‚ã€‚çœŸæ˜¯èœå•Š Orzï¼Œ70msï¼Œå› ä¸ºè·‘ä¸¤éã€‚ä¸‹é¢è¿™ä¸ª`14ms`å¯ä»¥è¯´æ˜¯ç›¸å½“å¿«äº†ï¼Œä½†ï¼Œæ—¶é—´å¯èƒ½è€—è´¹åœ¨å»ºç«‹æ ˆå’Œlistä¸Šäº†ï¼Œçœ‹äº†ä¸‹æäº¤ä¸Šçš„å‰å‡ ä¸ªéƒ½æ˜¯ç”¨çš„æ•°ç»„ï¼Œç”¨æ•°ç»„æ¨¡æ‹Ÿçš„æ ˆã€‚\n\n```java\n//å’Œä¸Šé¢çš„æ–¹æ³•å·®ä¸å¤š,ä½†è¿™ä¸ªæ›´å¿«ï¼Œä¸Šé¢é‚£ä¸ªè·‘äº†ä¸¤é\npublic static int[] nextLargerNodes3(ListNode head) {\n    int[] stack = new int[10000];\n    int[] res = new int[10000];\n    //tempæ˜¯é“¾è¡¨çš„å‰¯æœ¬ï¼Œç›¸å½“äºä¸Šé¢çš„list\n    int[] temp = new int[10000];\n    //top æ ˆé¡¶\n    int top = -1, i = 0;\n    ListNode node = head;\n    while (node != null) {\n        while (top != -1 && temp[stack[top]] < node.val){\n            //åä¸€ä¸ªå¤§äºå½“å‰èŠ‚ç‚¹, æ ˆä¸ä¸ºç©º\n            //popå‡ºæ¯”å®ƒå°çš„å…ƒç´ å¹¶èµ‹å€¼resï¼Œé‡æ–°ç”Ÿæˆå•è°ƒæ ˆ\n            res[stack[top--]] = node.val;\n        }\n        stack[++top] = i;\n        temp[i++] = node.val;\n        node = node.next;\n    }\n    return Arrays.copyOf(res, i);\n}\n```\n\næ€è·¯å°±æ˜¯åˆ©ç”¨`å•è°ƒæ ˆ`ï¼Œæ ˆé‡Œé¢å­˜çš„ç´¢å¼•å¯¹åº”çš„å…ƒç´ éƒ½æ˜¯å•è°ƒé€’å‡çš„ï¼Œé‡åˆ°ä¸é€’å‡çš„å°±ä¼šä¸€ç›´pop()ç›´åˆ°å†æ¬¡å•è°ƒé€’å‡ã€‚è¿™æ ·å¾ˆå®¹æ˜“å°±æ‰¾åˆ°äº†æ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæœ€å¤§å…ƒç´ äº†ã€‚\n\n19.7.21 é‡æ–°åšäº†ä¸€éè¿™é“é¢˜ï¼Œç¬¬ä¸€éè¿˜æ˜¯æ²¡æƒ³å‡ºæ¥ï¼Œè¿˜æ˜¯çœ‹äº†ä¹‹å‰çš„ä»£ç \n\n```java\npublic static int[] nextLargerNodes5(ListNode head) {\n        List<Integer> list=new ArrayList<>();\n        ListNode temp=head;\n        while(temp!=null){\n            list.add(temp.val);\n            temp=temp.next;\n        }\n        int [] stack=new int[10000];\n        int stackIndex=-1;\n        int [] res=new int[10000];\n        for (int i=0;i<list.size();i++) {\n            while(stackIndex!=-1 && list.get(i)>list.get(stack[stackIndex])){\n                res[stack[stackIndex--]]=list.get(i);\n            }\n            //ç»´æŠ¤ä¸€ä¸ªé€’å‡çš„æ ˆ\n            stack[++stackIndex]=i;\n        }\n        return  Arrays.copyOf(res, list.size());\n}\n```\n\nç›¸æ¯”ä¸Šé¢çš„æ–¹æ³•ä¸€ï¼Œé‡‡ç”¨äº†æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—(æ•°æ®èŒƒå›´å·²ç»ç»™å®šäº†)ï¼Œ30msï¼Œ80% ã€‚ä»”ç»†çœ‹çœ‹ä»£ç å‘ç°å…¶å®ç¬¬ä¸€ä¸ªå¾ªç¯å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œå¯ä»¥ä¸€è¾¹éå†ä¸€è¾¹å­˜è¿›å»ã€‚\n\n**ä¸€æ¬¡éå†**\n\n```java\npublic static int[] nextLargerNodes6(ListNode head) {\n    List<Integer> list=new ArrayList<>();\n    ListNode temp=head;\n    int [] stack=new int[10000];\n    int stackIndex=-1;\n    int [] res=new int[10000];\n\n    for (int i=0;temp!=null;i++) {\n        list.add(temp.val);\n        while(stackIndex!=-1 && list.get(i)>list.get(stack[stackIndex])){\n            res[stack[stackIndex--]]=list.get(i);\n        }\n        //ç»´æŠ¤ä¸€ä¸ªé€’å‡çš„æ ˆ\n        stack[++stackIndex]=i;\n        temp=temp.next;\n    }\n    return  Arrays.copyOf(res, list.size());\n}\n```\n\nä¼˜åŒ–åå‘ç°æ¯”ä¹‹å‰è¿˜æ…¢äº†ã€‚ã€‚ã€‚\n\n**æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨**\n\n```java\n public static int[] nextLargerNodes7(ListNode head) {\n        int [] list=new int[10000];\n        ListNode temp=head;\n        int [] stack=new int[10000];\n        int stackIndex=-1;\n        int [] res=new int[10000];\n\n        int i;\n        for ( i=0;temp!=null;i++) {\n            list[i]=temp.val;\n            while(stackIndex!=-1 && list[i]>list[stack[stackIndex]]){\n                res[stack[stackIndex--]]=list[i];\n            }\n            //ç»´æŠ¤ä¸€ä¸ªé€’å‡çš„æ ˆ\n            stack[++stackIndex]=i;\n            temp=temp.next;\n        }\n        return  Arrays.copyOf(res, i);\n  }\n```\n\nè¿™æ¬¡æäº¤äº†å‡ æ¬¡ç›´æ¥ 8ms 100%äº†ã€‚ã€‚ã€‚\n\n","tags":["LeetCode","é“¾è¡¨"],"categories":["ç®—æ³•"]},{"title":"å¸¸è§çš„æ’åºç®—æ³•æ€»ç»“","url":"/2018/12/11/chang-jian-pai-xu-suan-fa-zong-jie/","content":"\n## å¸¸è§æ’åºç®—æ³•æ€»ç»“\nå…³äºæ’åºçš„éƒ¨åˆ†ä¸€ç›´æƒ³æ€»ç»“ä¸‹ä¸€ç›´æ²¡æ—¶é—´ï¼Œç°åœ¨æ¥æ€»ç»“ä¸‹å§ã€‚gifå›¾æ¥è‡ªå¾®ä¿¡ä¸Šçš„æ–‡ç«  (**äº”åˆ†é’Ÿå­¦ç®—æ³•**çš„å…¬ä¼—å·ï¼ŒæŒºä¸é”™å¹²è´§æŒºå¤šçš„)ï¼ŒåŸç†æ€§çš„ä¸œè¥¿å°±ä¸è®²äº†ï¼Œå›¾è®²çš„æ¯”æˆ‘å¥½ã€‚å¦‚æœè¿˜æ˜¯ä¸æ‡‚å¯ä»¥çœ‹çœ‹ã€Šç®—æ³•ã€‹é‡Œé¢çš„è½¨è¿¹å›¾ï¼Œé‚£ä¸ªä¹Ÿå¾ˆç›´è§‚ \n\n### å†’æ³¡æ’åº \n\n  ![weixin](http://static.imlgw.top/f02ace7b7fb9b810274e683c2be54a02_640_wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1.gif)\n\n```java\n//å†’æ³¡æ’åº\nprivate static void MaoPaoSort(int []nums){\n    for (int i=nums.length-1;i>=0;i--){\n        for (int j=0;j<i;j++){\n            if(nums[j]>nums[j+1]){\n                swap(nums,j,j+1);\n            }\n        }\n    }\n}\n```\n### é€‰æ‹©æ’åº\n\n![weixin](http://static.imlgw.top/640.gif)\n\n```java\n//é€‰æ‹©æ’åº\nprivate static void SelectSort(int []nums){\n    for (int i=0;i<nums.length;i++){\n        int min=nums[i];\n        for (int j=i+1;j<nums.length;j++){\n            if(nums[j]<min){\n                min=nums[j];\n                swap(nums,j,i);\n            }\n        }\n    }\n}\n```\n\n### ç›´æ¥æ’å…¥æ’åº\n\n![weixin](http://static.imlgw.top/640%20%281%29.gif)\n\n```java\n//ç›´æ¥æ’å…¥æ’åº\nprivate static void InsertSort(int []nums){\n    for (int i=1;i<nums.length;i++){\n        for (int j=i;j>0&&nums[j]<nums[j-1];j--){\n            swap(nums,j,j-1);\n        }\n    }\n}\n```\n\n### å½’å¹¶æ’åº\n\n![weixin](http://static.imlgw.top/640%20%282%29.gif)\n\n#### å›¾ä¸Šé¢çš„æ˜¯é€’å½’ç‰ˆæœ¬çš„å½’å¹¶ï¼Œå®ç°å¦‚ä¸‹\n\n```java\n//å½’å¹¶æ’åº\nprivate static void MergerSort(int []nums){\n    help=new int[nums.length];\n    MergerSort(nums,0,nums.length-1);\n}\n\nprivate static void MergerSort(int []nums,int left,int right){\n    if(left>=right){\n        return;\n    }\n    //ä¸èƒ½ç›´æ¥åœ¨è¿™é‡Œåˆ›å»ºæ•°ç»„ï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¯ä»¥åœ¨ä¸Šé¢å†å¥—ä¸€å±‚æ–¹æ³•ï¼Œæˆ–è€…é‡‡ç”¨merger2çš„æ–¹å¼(ä¹Ÿä¸å¥½ï¼Œåº”è¯¥ä¿è¯è¾…åŠ©æ•°ç»„åªåˆå§‹åŒ–ä¸€æ¬¡)\n    //help=new int[nums.length];\n    int mid=left+((right-left)>>1);\n    MergerSort(nums,left,mid);\n    MergerSort(nums,mid+1,right);\n    merger(nums,left,mid,right);\n}\n\n//è¾…åŠ©æ•°ç»„\nprivate static int []help;\n\n//å½’å¹¶æ“ä½œ\nprivate static void merger(int []nums ,int left,int mid,int right){\n    int i=left,j=mid+1;\n    //å…¶å®æ²¡åŒºåˆ«ç©ºé—´å¤æ‚åº¦ï¼Œéƒ½æ˜¯O(N) åé¢è¿™ä¸ªä¼šæ›´åŠ è€—è´¹æ—¶é—´\n    //int []help=new int[right-left+1];\n    for (int k=left;k<=right;k++){\n        //ä¸€è¾¹çš„åˆ°è¾¾å°½å¤´,å…ˆåˆ¤æ–­ä¸¤ä¸ªè¾¹ç•Œ,ä¸ç„¶å°±è¦æƒ³ä¸‹é¢é‚£æ ·å†™\n        if(i>mid){\n            help[k]=nums[j++];\n        } else if(j>right){\n            help[k]=nums[i++];\n        } else if(nums[i]>nums[j]){\n            help[k]=nums[j++];\n        } else{\n            //ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§\n            help[k]=nums[i++];\n        }\n        /*// 2 \n            if( i<=mid &&j<=right && nums[i]>nums[j]){\n                help[k]=nums[j++];\n            }else if( i<=mid &&j<=right && nums[i]<=nums[j]){\n                //ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§\n                help[k]=nums[i++];\n            }else if(i>mid){\n                help[k]=nums[j++];\n            }else if(j>right){ \n                help[k]=nums[i++];\n            }*/\n    }\n    //å¤åˆ¶\n    for (int k=left;k<=right;k++){\n        nums[k]=help[k];\n    }\n\n    /*while (p1 <= m && p2 <= r) {\n            help[i++] = arr[p1] < arr[p2] ? arr[p1++] : arr[p2++];\n        }\n        while (p1 <= m) {\n            help[i++] = arr[p1++];\n        }\n        while (p2 <= r) {\n            help[i++] = arr[p2++];\n        }\n        for (i = 0; i < help.length; i++) {\n            arr[l + i] = help[i];\n        }*/\n}\n```\n\n#### éé€’å½’ç‰ˆæœ¬\n\n```java\n//å½’å¹¶æ’åºï¼ˆéé€’å½’ï¼Œæ–¹å‘ä¸ä¸€æ ·ï¼Œæ—¶é—´å¤æ‚åº¦ä¸€æ ·éƒ½ä¸ºO(NlogN)\nprivate static void MergerSortNoRecurse(int []nums){\n    help=new int[nums.length];\n    //æ§åˆ¶åˆå¹¶çš„é•¿åº¦ \n    for (int sz=1;sz<nums.length;sz*=2){\n        //æ§åˆ¶åˆå¹¶çš„å‘åç§»åŠ¨\n        for (int i=0;i<nums.length-sz;i+=2*sz){\n            int r=i+2*sz-1<nums.length-1?i+2*sz-1:nums.length-1;\n            merger(nums,i,i+sz-1,r);\n        }\n    }\n}\n```\n\n### ä¸‰å‘åˆ‡åˆ†çš„å¿«æ’(è·å…°å›½æ——é—®é¢˜)\n\n![weixin](http://static.imlgw.top/640%20%283%29.gif)\n\n```java\n//å¿«æ’ (ä¸å…·æœ‰ç¨³å®šæ€§æˆ–è€…éš¾ä»¥å®ç°)\nprivate static void QuickSort(int []nums,int l,int r){\n    if(l>r){\n        return;\n    }\n    //éšæœºä¸€ä¸ªæ•°å’Œräº¤æ¢ ---éšæœºå¿«æ’\n    swap(nums, l + (int) (Math.random() * (r - l + 1)), r);\n    int []index=partition2(nums,l,r);\n    QuickSort(nums,l,index[0]-1);\n    QuickSort(nums,index[1]+1,r);\n}\n\npublic static int partition1(int []nums ,int l,int r){\n    int base = l;\n    //åŒæŒ‡é’ˆ\n    int lo = l, hi = r;\n    //è¿™ç§partitionçš„å®ç°ç»†èŠ‚æœ‰ç‚¹ä¸å¥½ç†è§£\n    //è¿™ç§partitionä¸èƒ½éšæœºåŸºå‡†å…ƒç´ ã€‚ã€‚ã€‚ã€‚\n    //å‚ç…§äº†å·¦ç¥çš„ä»£ç å‘ç°å…¶å®å¯ä»¥åœ¨partitionä¹‹å‰éšæœºä¸€ä¸ªå˜é‡å’Œloäº¤æ¢ï¼Œä¹Ÿæœ‰åŒæ ·çš„æ•ˆæœä¹Ÿæ¶ˆé™¤äº†è¾“å…¥çš„å½±å“\n    while (lo < hi) {\n        //å¿…é¡»å…ˆä»å³å¾€å·¦,ä¸»è¦æ˜¯ä¸ºäº†å½’ä½çš„æ—¶å€™ä¸å‡ºç°é—®é¢˜\n        //æ¯”å¦‚è¿™é‡Œé€‰å–çš„åŸºå‡†å…ƒç´ æ˜¯ lo ä¹Ÿå°±æ˜¯å­æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœå…ˆä»å·¦å¾€å³æœ€åäº¤æ¢çš„å°±æ˜¯loå’Œä¸€ä¸ªæ¯”loå¤§çš„æ•°ç„¶è€Œæ¯”loå¤§çš„æ•°åº”è¯¥æ”¾åœ¨å³è¾¹\n        //åä¹‹å¦‚æœé€‰çš„æ˜¯hiä¸ºåŸºå‡†å°±è¦å…ˆä»å·¦å¾€å³\n        // 7  0  1  2    10  11  22\n        while (nums[hi] >= nums[base] && lo < hi) {\n            hi--;\n        }\n        while (nums[lo] <= nums[base] && lo < hi) {\n            lo++;\n        }\n        if (lo < hi) {\n            swap(nums, lo, hi);\n        }\n    }\n    //å½’ä½ lo==hi\n    swap(nums, hi, base);\n    return lo;\n}\n\n//è·å…°å›½æ——ä¼˜åŒ–çš„å¿«æ’\npublic static int[] partition2(int []arr ,int l,int r){\n    // 7  0  1  2    10  11  22        \n    //å°äºåŒºä¸ºç©º\n    int less=l-1;\n    //l ----> more ä¸ºå¾…å®šåŒº\n    int more=r;\n    while(l<more){\n        if(arr[l]<arr[r]){\n            swap(arr,++less,l++);\n        } else if(arr[l]>arr[r]){\n            //å¤§äºåŸºå‡†æ—¶ , å¤§äºåŒºæ‰©å¤§(å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ å’Œå½“å‰å…ƒç´ äº¤æ¢ï¼Œä½†æ˜¯ä¸çŸ¥é“å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œæ‰€ä»¥ä¸èƒ½l++)\n            swap(arr,--more,l);\n        } else{\n            l++;\n        }\n    }\n    //å’Œå¤§äºåŒºé—´çš„ç¬¬ä¸€ä¸ªäº¤æ¢ ä¿è¯å½’ä½æ­£ç¡®,å¦‚æœé€‰å–çš„æ˜¯ä»¥æœ€å·¦è¾¹ä¸ºåŸºå‡†å…ƒç´  è¿™é‡Œå°±åº”è¯¥å’Œlessäº¤æ¢\n    //åˆ°è¿™é‡Œ  [less+1,more-1]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„\n    swap(arr,more,r);\n    //åˆ°è¿™  [less+1,more]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„\n    return new int[]{less+1,more};\n}\n```\n\n### å †æ’åº\n\n![weixin](http://static.imlgw.top/640%20%284%29.gif)\n\n```java\n//å †æ’åº\nprivate static void HeapSort(int []nums){\n    if(nums.length<2){\n        return;\n    }\n    //æ„å»ºå¤§æ ¹å †\n    for (int i=0; i<nums.length; i++) {\n        heapInsert(nums,i);\n    }\n    //äº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹\n    int size= nums.length;\n    swap(nums,size-1,0);\n    size--;\n    while(size>1){\n        //è°ƒæ•´\n        heapIfy(nums,0,size);\n        //æ¯æ¬¡éƒ½å’Œæœ€åä¸€ä¸ªå­©å­èŠ‚ç‚¹äº¤æ¢ï¼Œç„¶åsize--\n        swap(nums,--size,0);\n    }\n}\n\n//å‘ä¸Šçˆ¬\nprivate static void heapInsert(int []nums, int index){\n    //è¿­ä»£æ¯”è¾ƒå½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å€¼çš„å¤§å°\n    while(nums[index]>nums[(index-1)/2]){\n        swap(nums,index,(index-1)/2);\n        index=(index-1)/2;\n    }\n}\n\n//å‘ä¸‹çˆ¬\n//indexä½ç½®çš„å€¼å˜å°åç»§ç»­è°ƒæ•´ä¸ºå¤§æ ¹å †\nprivate static void heapIfy(int []nums,int index,int size){\n    //å·¦å­©å­\n    int left=index*2+1;\n    //èŠ‚ç‚¹æœ‰å·¦å­©å­\n    while(left<size){\n        //åˆ¤æ–­æ˜¯å¦æœ‰å³å­©å­.....\n        //å·¦å³å­©å­é‡Œçš„æœ€å¤§å€¼ æœ‰å³å­©å­ä¸”å³å­©å­å¤§äºå·¦å­©å­\n        int largest=left+1<size && nums[left]<nums[left+1] ?left+1:left;\n        largest=nums[largest]>nums[index]?largest:index;\n        //æœ€å¤§å€¼ç­‰äºè‡ªå·±\n        if(largest==index){\n            break;\n        }\n        //äº¤æ¢å¤§å­©å­èŠ‚ç‚¹å’Œè‡ªå·±\n        swap(nums,largest,index);\n        //è®¾ç½®å¤§å­©å­çš„indexå’Œå·¦å­©å­\n        index=largest;\n        left=index*2+1;\n    }\n}\n```\n\n### å †æ’åºæ›´ä¼˜çš„åšæ³•\n\nä¸Šé¢çš„åšæ³•å¹¶ä¸æ˜¯æœ€ä¼˜çš„å †æ’åº\n\n```java\npublic static void heapSort(int []nums){\n    int last=nums.length-1;\n    //Næ„å»ºå¤§æ ¹å †\n    //ä»å€’æ•°ç¬¬äºŒå±‚å¼€å§‹\n    for (int i=nums.length/2-1 ;i>=0;i--){\n        heapIfy(nums,i,last);\n    }\n    //printArray(nums);\n    while(last>=1){\n        swap(nums,0,last--);\n        heapIfy(nums,0,last);\n    }\n}\n\n//i å¤§æ ¹å †è°ƒæ•´\npublic static void heapIfy(int[] nums,int i,int last){\n    //åˆ¤æ–­æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆå·¦å­©å­ï¼‰\n    int left=i*2+1;\n    while(left<=last){\n        int right=left+1;\n        //å·¦å³èŠ‚ç‚¹æœ€å¤§å€¼\n        int larger=right<=last && nums[right] > nums[left]?right:left;\n        if(nums[larger]>nums[i]){\n            swap(nums,larger,i);\n            i=larger;\n            left=larger*2+1;\n        } else{\n            break;\n        }\n    }\n}\n\npublic static  void  swap(int []nums,int a,int b){\n    int temp=nums[a];\n    nums[a]=nums[b];\n    nums[b]=temp;\n}\n```\n\nå¯¹æ¯”ä¹‹å‰çš„æ–¹æ³•ï¼Œæ„é€ å †çš„æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸Šé¢é‚£ç§é€šè¿‡è‡ªä¸Šè€Œä¸‹çš„`insert`æ–¹å¼æ—¶é—´å¤æ‚åº¦æ˜¯`O(NlogN)`ï¼Œå…¶å®ä»”ç»†æƒ³æƒ³ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯å®Œå…¨ç›¸åçš„ï¼Œinsertçš„æ–¹å¼ï¼Œæœ€åä¸€å±‚æ¯ä¸ªå…ƒç´ æœ€åéƒ½å¯èƒ½è°ƒæ•´`logN`æ¬¡ï¼Œè€Œæœ€åä¸€å±‚ä¹Ÿæ˜¯å…ƒç´ æœ€å¤šçš„ä¸€å±‚ï¼Œè¿™æ ·ä¸€æ¥å¤æ‚åº¦å°±ä¼šå¤§å¤§å¢åŠ ï¼Œç›¸åå¦‚æœé‡‡ç”¨ä»åº•å‘ä¸Šçš„`heapIfy`æ–¹å¼æœ€åä¸€å±‚éƒ½åªéœ€è¦è°ƒæ•´`1`æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹éœ€è¦è°ƒæ•´`logN`æ¬¡ï¼Œè€Œæ ¹èŠ‚ç‚¹**åªæœ‰ä¸€ä¸ª**æ—¶é—´å¤æ‚åº¦å°±ä¼šå¤§å¤§é™ä½ï¼Œæœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(N)ï¼Œ[å…·ä½“æ¨ç®—è¿‡ç¨‹å¯ä»¥çœ‹è¿™äº›å›ç­”](https://www.zhihu.com/question/20729324) \n\n**æ‰‹æ¨è¿‡ç¨‹**\n\n![img](http://static.imlgw.top/image/20190617/kVuvnMfjuSns.png?imageslim)\n\næœ€åæ¨å¾—åˆ°å¾—å¤æ‚åº¦æ˜¯å°äº`O(2N)`ï¼Œä¹Ÿå°±æ˜¯`O(N)`çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¦‚æœä¸æ˜¯åˆ·`leetCode` çœ‹åˆ°äº†ç±»ä¼¼çš„é¢˜å¯èƒ½ä¼šä¸€ç›´è¢«é‚£æ ·å»å†™ğŸ˜‚\n\n**å†å›é¦–**\n\næ—¶éš”å¤šå¹´ï¼Œåˆå›å¤´å†™äº†ä¸€ä¸ªï¼Œå†™äº†å¤§æ¦‚åŠä¸ªå°æ—¶å·¦å³ï¼Œè¾¹å†™è¾¹å›å¿†ï¼Œæ„Ÿè§‰è¿™ä¸ªå†™æ³•æ¯”ä¸Šé¢å¥½ä¸€ç‚¹ç‚¹ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹\n\n```java\nimport java.io.*;\nimport java.util.*;\npublic class Main{\n    public static void main(String[] args){\n        Scanner sc=new Scanner(System.in);\n        int N=sc.nextInt();\n        int[] nums=new int[N];\n        for(int i=0;i<N;i++)nums[i]=sc.nextInt();\n        heapSort(nums);\n        for(int i=0;i<N;i++)System.out.print(nums[i]+\" \");\n    }\n\n    public static void heapSort(int[] nums){\n        //æ±‚å·¦å³å­©å­\n        //       0 \n        //   1       2\n        // 3   4   5   6 \n        //7                 7/2=3  4/2=1 8/2=4\n        //O(N)æ„å»ºå †\n        for(int i=nums.length/2;i>=0;i--){ //ä»2/nå¼€å§‹downæ„å»ºäºŒå‰æ ‘,ä¸ä¸€å®šè¦ç²¾ç¡®,å¤šä¸€ä¸¤ä¸ªæ— æ‰€è°“\n            down(nums,i,nums.length);\n        }\n\n        int index=0,tail=nums.length;\n        //å †æ’,å°†å †å¤´æ”¾åˆ°å°¾éƒ¨\n        while(tail>0){\n            swap(nums,index,--tail);\n            down(nums,index,tail);\n        }\n    }\n\n    public static void down(int[] nums,int index,int size){\n        //æ±‚å·¦å³å­©å­\n        //      0 \n        //  1       2\n        //3   4   5   6\n        while(index*2+1 < size){ //è¿˜æœ‰å­©å­\n            int left=index*2+1,right=left+1;\n            //å·¦å³å­æ ‘ä¸­çš„è¾ƒå¤§\n            int largeIndex = right<size && nums[left]<nums[right] ? right:left;\n            if(nums[index] >= nums[largeIndex]){\n                return;\n            }\n            swap(nums,index,largeIndex);\n            index=largeIndex;\n        }\n    }\n\n    public static void swap(int[] nums,int a,int b){\n        int temp=nums[a];\n        nums[a]=nums[b];\n        nums[b]=temp;\n    }\n}\n```\n\n\n\n### å¸Œå°”æ’åº\n\nå®é™…ä¸Šå†™æ’åºå°±æ˜¯åŸºäºæ’å…¥æ’åºçš„ï¼Œåœ¨å®ƒä¹‹ä¸Šè¿›è¡Œäº†æ•°å­¦ä¸Šçš„ä¼˜åŒ–ã€‚\n\n![image](http://static.imlgw.top/640%20%285%29.gif)\n\tå®é™…ä¸Šä»é€†åºå¯¹çš„è§’åº¦æ¥çœ‹ï¼ŒåŸºäºæ¯”è¾ƒçš„æ’åºå°±æ˜¯ä¸ºäº†æ¶ˆé™¤é€†åºå¯¹çš„ä¸ªæ•°ï¼Œè€Œè¯¸å¦‚å†’æ³¡é€‰æ‹©æ¯æ¬¡éƒ½åªæ˜¯äº¤æ¢ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼Œæ¯æ¬¡äº¤æ¢æœ€å¤šåªå‡å°‘ä¸€ä¸ªé€†åºå¯¹ï¼Œè€Œå¸Œå°”æ’åºæ‰©å¤§äº†è¿™ä¸ªé—´è·ï¼Œå°±å¢å¤§äº†å‡å°‘é€†åºå¯¹çš„å¯èƒ½ã€‚ä¸è¿‡è¦ç ”ç©¶ä»–çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯æ•°å­¦ä¸Šçš„ç ”ç©¶çš„é—®é¢˜äº†ï¼Œè‡³äºæ¯æ¬¡é—´è·éƒ½å‡åŠè¿™ä¸ªä¹Ÿæ˜¯æ ¹æ®å¤§æ ·æœ¬æµ‹è¯•ä¸‹è¿™ç§é€’å¢åºåˆ—æ€§èƒ½ä¼šæ›´å¥½ O(âˆ©_âˆ©)O\n\n```java\n//æ’å…¥æ’åºçš„æ”¹è¿›\nprivate static void ShellSort(int [] nums){\n    int h=nums.length>>1;\n    while(h>0){\n        for (int i=h;i<nums.length;i++){\n            //å®é™…ä¸Šæ˜¯å¢å¤§äº†æ’å…¥æ’åºçš„é—´éš™ï¼Œæœ€åè¿˜æ˜¯å¯¹è¿›è¡Œä¸€æ¬¡æ’å…¥æ’åº,ä¸è¿‡é‚£ä¸ªæ—¶å€™çš„æ•°æ®å·²ç»æ˜¯é«˜åº¦æœ‰åºäº†\n            for (int j=i;j-h>=0&&nums[j]<nums[j-h];j-=h) {\n                swap(nums,j,j-h);\n            }\n        }\n        h=h>>1;\n    }\n}\n```\n\n---\n### BUG\næ’ä¸ªåºè¿˜èƒ½æ’å‡ºBugï¼Ÿå¯¹çš„æ²¡é”™å°±æ˜¯æ’å‡ºäº†BugğŸ¤£ çœ‹çœ‹æˆ‘æœ€å¼€å§‹å†™çš„äº¤æ¢å‡½æ•°\n\n```java\nprivate static void swap(int []nums,int a,int b){\n    nums[a]=nums[a]^nums[b];\n    nums[b]=nums[a]^nums[b];\n    nums[a]=nums[a]^nums[b];\n}\n```\nä¸ºäº†æŠ–è¿™ä¸ªæœºçµä»˜å‡ºäº†æƒ¨ç—›çš„ä»£ä»·ï¼Œä¹‹å‰ç”¨ >> æ‹¿æ¥å½“é™¤2æ“ä½œçš„æ—¶å€™å°±å¿½ç•¥äº†`ä¼˜å…ˆçº§`çš„é—®é¢˜ã€‚ã€‚ã€‚é‚£è¿™é‡Œçš„æœºçµæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿä¸€ä¸ªæ•°å¼‚æˆ–åŒä¸€ä¸ªæ•°ä¸¤æ¬¡å°±è¿˜åŸæ²¡æ¯›ç—…å•Šï¼ŸButå¦‚æœäº¤æ¢çš„ä¸¤ä¸ªæ•°æ˜¯åŒä¸€ä¸ªå…ƒç´ æ¯”å¦‚ä¸Šé¢åœ¨æ•°ç»„ä¸­ a==bæ—¶ nums[a]å¼‚æˆ–äº†3æ¬¡è‡ªå·±ç›¸å½“äº`nums[a]^nums[a]^nums[a]^nums[a]=0^0=0`ï¼Œæœ€åå°±ä¼šå‡ºé—®é¢˜,å…¶å®å¼€å§‹å‰é¢çš„æ’åºéƒ½æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œä¸»è¦æ˜¯åé¢çš„å¿«æ’æ—¶å‘ç°äº†è¿™ä¸ªBugå› ä¸ºå¿«æ’ä¸ºäº†é¿å…æ•°æ®åˆ†å¸ƒçš„å½±å“éšæœºé€‰å–åŸºå‡†å€¼ï¼Œå¯èƒ½éšæœºçš„æ˜¯æœ€åä¸€ä¸ªï¼Œè€Œä¸”å¿«æ’çš„partitionè¿‡ç¨‹ä¸­ä¹Ÿä¼šæœ‰æ—¶ä¹Ÿä¼šè‡ªå·±å’Œè‡ªå·±äº¤æ¢ï¼Œæœ€å¼€å§‹çš„ç¬¬ä¸€æ­¥å°±æ˜¯è‡ªå·±å’Œç›´æ¥äº¤æ¢ï¼Œè®©å°äºåŒºæ‰©å¤§ã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä»…ä»…åªèƒ½ç”¨æ¥æŠ–ä¸€æŠ–æœºçµï¼Œæ²¡å•¥å®é™…æ„ä¹‰ï¼Œä»¥åè¿˜æ˜¯è¦è€è€å®å®å†™ï¼Œä¸ç„¶å’‹æ­»çš„éƒ½ä¸çŸ¥é“ğŸ˜\n\n>  æœªå®Œå¾…ç»­......è¿˜æœ‰ä¸€ç±»éåŸºäºæ¯”è¾ƒçš„æ’åº æ¡¶æ’åºä¹‹ç±»çš„ç­‰åé¢å†æ¥æ€»ç»“åŠ ä¸Šå».\n\n### å¯¹æ•°å™¨\nç›´æ¥æ‹¿çš„å·¦ç¥çš„å¯¹æ•°å™¨ğŸ˜„ï¼Œæ‰€æœ‰æ’åºéƒ½æ˜¯ç»è¿‡å¯¹æ•°å™¨æµ‹è¯•çš„ã€‚ *talk is cheap show me the code*\n\n\n```java\nimport java.util.Arrays;\nimport java.util.Random;\npublic class Sorts{\n    public static void main(String[] args) {\n        /*int []nums={1,0,-1,-22,213,4,535,-112,99999};\n        //ShellSort(nums);\n        //MaoPaoSort(nums);\n        //SelectSort(nums);\n        //MergerSort(nums,0,nums.length-1);\n        QuickSort(nums,0,nums.length-1);\n        printArray(nums);*/\n        int testTime = 10000;\n        int maxSize = 10000;\n        int maxValue = 100;\n        Boolean succeed = true;\n        for (int i = 0; i < testTime; i++) {\n            int[] arr1 = generateRandomArray(maxSize, maxValue);\n            int[] arr2 = copyArray(arr1);\n            long time=System.currentTimeMillis();\n            //å†’æ³¡\n            //MaoPaoSort(arr1);\n            //é€‰æ‹©\n            //SelectSort(arr1);\n            //æ’å…¥\n            //InsertSort(arr1);\n            //å½’å¹¶\n            //MergerSort(arr1);\n            //éé€’å½’å½’å¹¶\n            //MergerSortNoRecurse(arr1);\n            //å¸Œå°”\n            //ShellSort(arr1);\n            //å¿«æ’\n            //QuickSort(arr1,0,arr1.length-1);\n            //å †æ’åº\n            HeapSort(arr1);\n            long time2=System.currentTimeMillis();\n            if(i==0){\n                System.out.println(time2-time);\n            }\n            //ç³»ç»Ÿæ’åº\n            comparator(arr2);\n            if(i==0){\n                System.out.println(System.currentTimeMillis()-time2);\n            }\n            if (!isEqual(arr1, arr2)) {\n                succeed = false;\n                printArray(arr1);\n                printArray(arr2);\n                break;\n            }\n        }\n        System.out.println(succeed ? \"Nice!\" : \"Fucking fucked!\");\n    }\n    //åˆçº§æ’åºç®—æ³•\n    //************************************************************************\n    //å†’æ³¡æ’åº\n    private static void MaoPaoSort(int []nums){\n        for (int i=nums.length-1;i>=0;i--){\n            for (int j=0;j<i;j++){\n                if(nums[j]>nums[j+1]){\n                    swap(nums,j,j+1);\n                }\n            }\n        }\n    }\n    //************************************************************************\n    //é€‰æ‹©æ’åº\n    private static void SelectSort(int []nums){\n        for (int i=0;i<nums.length;i++){\n            int min=nums[i];\n            for (int j=i+1;j<nums.length;j++){\n                if(nums[j]<min){\n                    min=nums[j];\n                    swap(nums,j,i);\n                }\n            }\n        }\n    }\n    //************************************************************************\n    //ç›´æ¥æ’å…¥æ’åº\n    private static void InsertSort(int []nums){\n        for (int i=1;i<nums.length;i++){\n            for (int j=i;j>0&&nums[j]<nums[j-1];j--){\n                swap(nums,j,j-1);\n            }\n        }\n    }\n    //************************************************************************\n    //æ’å…¥æ’åºçš„æ”¹è¿›\n    private static void ShellSort(int [] nums){\n        int h=nums.length>>1;\n        while(h>0){\n            for (int i=h;i<nums.length;i++){\n                //å®é™…ä¸Šæ˜¯å¢å¤§äº†æ’å…¥æ’åºçš„é—´éš™ï¼Œæœ€åè¿˜æ˜¯å¯¹è¿›è¡Œä¸€æ¬¡æ’å…¥æ’åº,ä¸è¿‡é‚£ä¸ªæ—¶å€™çš„æ•°æ®å·²ç»æ˜¯é«˜åº¦æœ‰åºäº†\n                for (int j=i;j-h>=0&&nums[j]<nums[j-h];j-=h) {\n                    swap(nums,j,j-h);\n                }\n            }\n            h=h>>1;\n        }\n    }\n    //************************************************************************\n    //å½’å¹¶æ’åº\n    private static void MergerSort(int []nums){\n        help=new int[nums.length];\n        MergerSort(nums,0,nums.length-1);\n    }\n    private static void MergerSort(int []nums,int left,int right){\n        if(left>=right){\n            return;\n        }\n        //ä¸èƒ½ç›´æ¥åœ¨è¿™é‡Œåˆ›å»ºæ•°ç»„ï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¯ä»¥åœ¨ä¸Šé¢å†å¥—ä¸€å±‚æ–¹æ³•ï¼Œæˆ–è€…é‡‡ç”¨merger2çš„æ–¹å¼(ä¹Ÿä¸å¥½ï¼Œåº”è¯¥ä¿è¯è¾…åŠ©æ•°ç»„åªåˆå§‹åŒ–ä¸€æ¬¡)\n        //help=new int[nums.length];\n        int mid=left+((right-left)>>1);\n        MergerSort(nums,left,mid);\n        MergerSort(nums,mid+1,right);\n        merger(nums,left,mid,right);\n    }\n    //è¾…åŠ©æ•°ç»„\n    private static int []help;\n    //å½’å¹¶æ“ä½œ\n    private static void merger(int []nums ,int left,int mid,int right){\n        int i=left,j=mid+1;\n        //å…¶å®æ²¡åŒºåˆ«ç©ºé—´å¤æ‚åº¦ï¼Œéƒ½æ˜¯O(N) åé¢è¿™ä¸ªä¼šæ›´åŠ è€—è´¹æ—¶é—´\n        //int []help=new int[right-left+1];\n        for (int k=left;k<=right;k++){\n            //ä¸€è¾¹çš„åˆ°è¾¾å°½å¤´,å…ˆåˆ¤æ–­ä¸¤ä¸ªè¾¹ç•Œ,ä¸ç„¶å°±è¦æƒ³ä¸‹é¢é‚£æ ·å†™\n            if(i>mid){\n                help[k]=nums[j++];\n            } else if(j>right){\n                help[k]=nums[i++];\n            } else if(nums[i]>nums[j]){\n                help[k]=nums[j++];\n            } else{\n                //ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§\n                help[k]=nums[i++];\n            }\n            /*// 2 \n            if( i<=mid &&j<=right && nums[i]>nums[j]){\n                help[k]=nums[j++];\n            }else if( i<=mid &&j<=right && nums[i]<=nums[j]){\n                //ç›¸ç­‰çš„æ—¶å€™å·¦è¾¹å…ˆè¿›æ ˆä¿è¯ç¨³å®šæ€§\n                help[k]=nums[i++];\n            }else if(i>mid){\n                help[k]=nums[j++];\n            }else if(j>right){ \n                help[k]=nums[i++];\n            }*/\n        }\n        //å¤åˆ¶\n        for (int k=left;k<=right;k++){\n            nums[k]=help[k];\n        }\n        //asddsdasdasdasd\n        /*while (p1 <= m && p2 <= r) {\n            help[i++] = arr[p1] < arr[p2] ? arr[p1++] : arr[p2++];\n        }\n        while (p1 <= m) {\n            help[i++] = arr[p1++];\n        }\n        while (p2 <= r) {\n            help[i++] = arr[p2++];\n        }\n        for (i = 0; i < help.length; i++) {\n            arr[l + i] = help[i];\n        }*/\n    }\n    //å½’å¹¶æ’åºï¼ˆéé€’å½’ï¼Œæ–¹å‘ä¸ä¸€æ ·ï¼Œæ—¶é—´å¤æ‚åº¦ä¸€æ ·éƒ½ä¸ºO(NlogN)\n    private static void MergerSortNoRecurse(int []nums){\n        help=new int[nums.length];\n        //æ§åˆ¶åˆå¹¶çš„é•¿åº¦ \n        for (int sz=1;sz<nums.length;sz*=2){\n            //æ§åˆ¶åˆå¹¶çš„å‘åç§»åŠ¨\n            for (int i=0;i<nums.length-sz;i+=2*sz){\n                int r=i+2*sz-1<nums.length-1?i+2*sz-1:nums.length-1;\n                merger(nums,i,i+sz-1,r);\n            }\n        }\n    }\n    //************************************************************************\n    //å¿«æ’ (ä¸å…·æœ‰ç¨³å®šæ€§æˆ–è€…éš¾ä»¥å®ç°)\n    private static void QuickSort(int []nums,int l,int r){\n        if(l>r){\n            return;\n        }\n        //éšæœºä¸€ä¸ªæ•°å’Œräº¤æ¢ ---éšæœºå¿«æ’\n        swap(nums, l + (int) (Math.random() * (r - l + 1)), r);\n        int []index=partition2(nums,l,r);\n        QuickSort(nums,l,index[0]-1);\n        QuickSort(nums,index[1]+1,r);\n    }\n    public static int partition1(int []nums ,int l,int r){\n        int base = l;\n        //åŒæŒ‡é’ˆ\n        int lo = l, hi = r;\n        //è¿™ç§partitionçš„å®ç°ç»†èŠ‚æœ‰ç‚¹ä¸å¥½ç†è§£\n        //è¿™ç§partitionä¸èƒ½éšæœºåŸºå‡†å…ƒç´ ã€‚ã€‚ã€‚ã€‚\n        //å‚ç…§äº†å·¦ç¥çš„ä»£ç å‘ç°å…¶å®å¯ä»¥åœ¨partitionä¹‹å‰éšæœºä¸€ä¸ªå˜é‡å’Œloäº¤æ¢ï¼Œä¹Ÿæœ‰åŒæ ·çš„æ•ˆæœä¹Ÿæ¶ˆé™¤äº†è¾“å…¥çš„å½±å“\n        while (lo < hi) {\n            //å¿…é¡»å…ˆä»å³å¾€å·¦,ä¸»è¦æ˜¯ä¸ºäº†å½’ä½çš„æ—¶å€™ä¸å‡ºç°é—®é¢˜\n            //æ¯”å¦‚è¿™é‡Œé€‰å–çš„åŸºå‡†å…ƒç´ æ˜¯ lo ä¹Ÿå°±æ˜¯å­æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœå…ˆä»å·¦å¾€å³æœ€åäº¤æ¢çš„å°±æ˜¯loå’Œä¸€ä¸ªæ¯”loå¤§çš„æ•°ç„¶è€Œæ¯”loå¤§çš„æ•°åº”è¯¥æ”¾åœ¨å³è¾¹\n            //åä¹‹å¦‚æœé€‰çš„æ˜¯hiä¸ºåŸºå‡†å°±è¦å…ˆä»å·¦å¾€å³\n            // 7  0  1  2    10  11  22\n            while (nums[hi] >= nums[base] && lo < hi) {\n                hi--;\n            }\n            while (nums[lo] <= nums[base] && lo < hi) {\n                lo++;\n            }\n            if (lo < hi) {\n                swap(nums, lo, hi);\n            }\n        }\n        //å½’ä½ lo==hi\n        swap(nums, hi, base);\n        return lo;\n    }\n    //è·å…°å›½æ——ä¼˜åŒ–çš„å¿«æ’\n    public static int[] partition2(int []arr ,int l,int r){\n        // 7  0  1  2    10  11  22        \n        //å°äºåŒºä¸ºç©º\n        int less=l-1;\n        //l ----> more ä¸ºå¾…å®šåŒº\n        int more=r;\n        while(l<more){\n            if(arr[l]<arr[r]){\n                swap(arr,++less,l++);\n            } else if(arr[l]>arr[r]){\n                //å¤§äºåŸºå‡†æ—¶ , å¤§äºåŒºæ‰©å¤§(å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ å’Œå½“å‰å…ƒç´ äº¤æ¢ï¼Œä½†æ˜¯ä¸çŸ¥é“å¤§äºåŒºçš„å‰ä¸€ä¸ªå…ƒç´ æ˜¯ä»€ä¹ˆæƒ…å†µï¼Œæ‰€ä»¥ä¸èƒ½l++)\n                swap(arr,--more,l);\n            } else{\n                l++;\n            }\n        }\n        //å’Œå¤§äºåŒºé—´çš„ç¬¬ä¸€ä¸ªäº¤æ¢ ä¿è¯å½’ä½æ­£ç¡®,å¦‚æœé€‰å–çš„æ˜¯ä»¥æœ€å·¦è¾¹ä¸ºåŸºå‡†å…ƒç´  è¿™é‡Œå°±åº”è¯¥å’Œlessäº¤æ¢\n        //åˆ°è¿™é‡Œ  [less+1,more-1]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„\n        swap(arr,more,r);\n        //åˆ°è¿™  [less+1,more]ä¹‹é—´éƒ½æ˜¯ç­‰äº åŸºå‡†å…ƒç´  arrã€rã€‘ çš„\n        return new int[]{less+1,more};\n    }\n    //************************************************************************\n    //å †æ’åº\n    private static void HeapSort(int []nums){\n        if(nums.length<2){\n            return;\n        }\n        //æ„å»ºå¤§æ ¹å †\n        for (int i=0; i<nums.length; i++) {\n            heapInsert(nums,i);\n        }\n        //äº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹\n        int size= nums.length;\n        swap(nums,size-1,0);\n        size--;\n        while(size>1){\n            //è°ƒæ•´\n            heapIfy(nums,0,size);\n            //æ¯æ¬¡éƒ½å’Œæœ€åä¸€ä¸ªå­©å­èŠ‚ç‚¹äº¤æ¢ï¼Œç„¶åsize--\n            swap(nums,--size,0);\n        }\n    }\n    //å‘ä¸Šçˆ¬\n    private static void heapInsert(int []nums, int index){\n        //è¿­ä»£æ¯”è¾ƒå½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å€¼çš„å¤§å°\n        while(nums[index]>nums[(index-1)/2]){\n            swap(nums,index,(index-1)/2);\n            index=(index-1)/2;\n        }\n    }\n    //å‘ä¸‹çˆ¬\n    //indexä½ç½®çš„å€¼å˜å°åç»§ç»­è°ƒæ•´ä¸ºå¤§æ ¹å †\n    private static void heapIfy(int []nums,int index,int size){\n        //å·¦å­©å­\n        int left=index*2+1;\n        //èŠ‚ç‚¹æœ‰å·¦å­©å­\n        while(left<size){\n            //åˆ¤æ–­æ˜¯å¦æœ‰å³å­©å­.....\n            //å·¦å³å­©å­é‡Œçš„æœ€å¤§å€¼ æœ‰å³å­©å­ä¸”å³å­©å­å¤§äºå·¦å­©å­\n            int largest=left+1<size && nums[left]<nums[left+1] ?left+1:left;\n            largest=nums[largest]>nums[index]?largest:index;\n            //æœ€å¤§å€¼ç­‰äºè‡ªå·±\n            if(largest==index){\n                break;\n            }\n            //äº¤æ¢å¤§å­©å­èŠ‚ç‚¹å’Œè‡ªå·±\n            swap(nums,largest,index);\n            //è®¾ç½®å¤§å­©å­çš„indexå’Œå·¦å­©å­\n            index=largest;\n            left=index*2+1;\n        }\n    }\n    //************************************************************************\n    private static void swap(int []nums,int a,int b){\n        //ä¸çŸ¥é“ä¸ºå•¥å¿«æ’äº¤æ¢çš„æ—¶å€™è¿™æ ·å†™ä¼šå‡ºç°å¾ˆå¤š0\n        //æŸ¥è¯¢çŸ¥é“ï¼Œå½“a==bæ—¶è‡ªå·±å’Œç›´æ¥äº¤æ¢ï¼Œaå¼‚æˆ–è‡ªå·±4æ¬¡åa==0.....\n        nums[a]=nums[a]^nums[b];\n        nums[b]=nums[a]^nums[b];\n        nums[a]=nums[a]^nums[b];\n        /*int temp=nums[a];\n        nums[a]=nums[b];\n        nums[b]=temp;*/\n    }\n    // for test  å¯¹æ•°å™¨\n    public static void comparator(int[] arr) {\n        Arrays.sort(arr);\n    }\n    // for test\n    public static int[] generateRandomArray(int maxSize, int maxValue) {\n        int[] arr = new int[(int) ((maxSize + 1) * Math.random())];\n        for (int i = 0; i < arr.length; i++) {\n            arr[i] = (int) ((maxValue + 1) * Math.random()) - (int) (maxValue * Math.random());\n        }\n        return arr;\n    }\n    // for test\n    public static int[] copyArray(int[] arr) {\n        if (arr == null) {\n            return null;\n        }\n        int[] res = new int[arr.length];\n        for (int i = 0; i < arr.length; i++) {\n            res[i] = arr[i];\n        }\n        return res;\n    }\n    // for test\n    public static Boolean isEqual(int[] arr1, int[] arr2) {\n        if ((arr1 == null && arr2 != null) || (arr1 != null && arr2 == null)) {\n            return false;\n        }\n        if (arr1 == null && arr2 == null) {\n            return true;\n        }\n        if (arr1.length != arr2.length) {\n            return false;\n        }\n        for (int i = 0; i < arr1.length; i++) {\n            if (arr1[i] != arr2[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    // for test\n    public static void printArray(int[] arr) {\n        if (arr == null) {\n            return;\n        }\n        for (int i = 0; i < arr.length; i++) {\n            System.out.print(arr[i] + \" \");\n        }\n        System.out.println();\n    }\n}\n```\n\n\n\nâ€‹\t\t\n\n\n","tags":["æ•°æ®ç»“æ„","æ’åº"],"categories":["ç®—æ³•"]},{"title":"NodeJSæ¨¡ä»¿Expresså°è£…è·¯ç”±","url":"/2018/12/03/nodejs-mo-fang-express-feng-zhuang-lu-you/","content":"\n## NodeJSæ¨¡ä»¿Expresså°è£…è·¯ç”±\n\n_æœ€è¿‘æ‰å¼€å§‹å­¦NodeJsä¹Ÿä¸çŸ¥é“ä¸ºå•¥å°±çªç„¶å¯¹è¿™ä¸ªå¾ˆæ„Ÿå…´è¶£,(å¯èƒ½Javaå†™çƒ¦äº†ğŸ˜„)ï¼Œæ„Ÿè§‰ç”¨è¿™ä¸ªå¼€å‘è¿˜æ˜¯æŒºå¿«çš„ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿå¾ˆå¥½ï¼Œå€Ÿæ­¤ä¹Ÿäº†è§£ä¸‹å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹ç‚¹å’Œå¼‚æ­¥ç¼–ç¨‹çš„æ€æƒ³ã€‚_\n\n- ### æ²¡å°è£…å‰\n  åŸç”Ÿçš„å°±å·®ä¸å¤šæ˜¯è¿™æ ·çš„ã€‚\n\n```java\n\t/* \n\t    Node.js æœªå°è£… 1.0\n\t*/\n\tconst http = require(\"http\");\n\tconst fs = require(\"fs\");\n\tconst path = require(\"path\");\n\tconst querystring = require(\"querystring\"); //jsonè½¬æ¢\n\tconst scores = require(\"./StudentScore.json\");\n\tconst template = require(\"art-template\");\n\thttp.createServer((req, resp) => {\n\t    if (req.url.startsWith(\"/query\") && req.method == 'GET') {\n\t        //è¿™é‡Œå¯ä»¥é‡‡ç”¨æ¨¡æ¿ä¸ºäº†å’Œä¸‹é¢çš„å¯¹æ¯”ä¸€ä¸‹\n\t        fs.readFile(path.join(__dirname, \"querypage.html\"), (err, content) => {\n\t            if (err) {\n\t                resp.writeHead(500, {\n\t                    'Content-Type': 'text/plain;charset=utf8'\n\t                });\n\t                resp.end('æœåŠ¡å™¨é”™è¯¯');\n\t            }\n\t            resp.end(content);\n\t        });\n\t    } else\n\t    if (req.url.startsWith(\"/scores\")) {\n\t        let pdata = '';\n\t        //äº‹ä»¶ç»‘å®š\n\t        //è·å–æ•°æ®ï¼ˆidï¼‰\n\t        req.on('data', (ck) => {\n\t            pdata += ck;\n\t        });\n\t        //åœ¨è¿™é‡Œè¿”å›\n\t        req.on('end', () => {\n\t            let obj = querystring.parse(pdata); //å°†å‚æ•° çš„å­—ç¬¦ä¸²è½¬æ¢æˆ å¯¹è±¡\n\t            let result = scores[obj.stunum];\n\t            let content = template(path.join(__dirname, \"scores.art\"), result);\n\t            resp.end(content);\n\t        });\n\t    }\n\t}).listen(9999, () => {\n\t    console.log('Server is runing on 9999');\n\t});\n```\n\n- Expressçš„æ–¹å¼\né€šè¿‡const app=express(); è·å¾—ä¸€ä¸ªappçš„å¯¹è±¡åé¢å°±é€šè¿‡è¿™ä¸ªæ¥æ“ä½œ\n![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/D~KS%28D1%5B%5DUS5TBZPO7KTJ88.png)\n- æ‰‹åŠ¨å°è£…\n\n```java\n\tvar url = require('url');\n\t\n\t//å°è£…æ–¹æ³•æ”¹å˜res  ç»‘å®šres.send()\n\tfunction changeRes(res) {\n\t\n\t    res.send = function(data) {\n\t\n\t        res.writeHead(200, {\n\t            \"Content-Type\": \"text/html;charset=utf-8\"\n\t        });\n\t\n\t        res.end(data);\n\t    }\n\t}\n\t\n\t//å®šä¹‰æš´éœ²çš„æ¨¡å—  return é‡Œé¢å®šä¹‰çš„æ¨¡å—\n\tvar Server = function() {\n\t\n\t\n\t    var G = this; /*å…¨å±€å˜é‡*/\n\t\n\t    //å¤„ç†getå’Œpostè¯·æ±‚\n\t    this._get = {};\n\t\n\t    this._post = {};\n\t\n\t\n\t\n\t    var app = function(req, res) {\n\t\n\t\n\t        changeRes(res);\n\t\n\t        //è·å–è·¯ç”±\n\t        var pathname = url.parse(req.url).pathname;\n\t        if (!pathname.endsWith('/')) {\n\t            pathname = pathname + '/';\n\t        }\n\t\n\t        //è·å–è¯·æ±‚çš„æ–¹å¼ get  post\n\t        var method = req.method.toLowerCase();\n\t\n\t\n\t        if (G['_' + method][pathname]) {\n\t\n\t            if (method == 'post') { /*æ‰§è¡Œpostè¯·æ±‚*/\n\t\n\t                var postStr = '';\n\t                req.on('data', function(chunk) {\n\t\n\t                    postStr += chunk;\n\t                })\n\t                req.on('end', function(err, chunk) {\n\t                    //æ·»åŠ è¯·æ±‚å±æ€§\n\t                    req.myBody = postStr; /*è¡¨ç¤ºæ‹¿åˆ°postçš„å€¼*/\n\t                    /*æ‰§è¡Œæ–¹æ³•*/\n\t                    G['_' + method][pathname](req, res);\n\t                })\n\t            } else { /*æ‰§è¡Œgetè¯·æ±‚*/\n\t                G['_' + method][pathname](req, res); /*æ‰§è¡Œæ–¹æ³•*/\n\t            }\n\t        } else {\n\t            res.end('no router');\n\t        }\n\t    }\n\t\n\t    //ä¸‹é¢çš„éƒ½æ˜¯ä¸ºäº†åšæ³¨å†Œçš„æ“ä½œ\n\t    app.get = function(string, callback) {\n\t        if (!string.endsWith('/')) {\n\t            string = string + '/';\n\t        }\n\t        if (!string.startsWith('/')) {\n\t            string = '/' + string;\n\t\n\t        }\n\t\n\t        //    /login/\n\t        G._get[string] = callback;\n\t\n\t    }\n\t\n\t    app.post = function(string, callback) {\n\t        if (!string.endsWith('/')) {\n\t            string = string + '/';\n\t        }\n\t        if (!string.startsWith('/')) {\n\t            string = '/' + string;\n\t\n\t        }\n\t        //    /login/\n\t        G._post[string] = callback;\n\t\n\t        //G._post['dologin']=function(req,res){\n\t        //\n\t        //}\n\t    }\n\t\n\t    return app;\n\t\n\t}\n\t\n\tmodule.exports = Server();\n```\n\n- å°è£…å\n```java\n\tconst http = require(\"http\");\n\tconst url = require(\"url\");\n\t//å¼•å…¥è‡ªå®šä¹‰çš„è·¯ç”±æ¨¡å—\n\tconst myApp = require(\"./model/express-route.js\");\n\t\n\t//ä½¿ç”¨è‡ªå®šä¹‰çš„æ¨¡å—\n\thttp.createServer(myApp).listen(9999, () => {\n\t    console.log('Running 9999');\n\t});\n\t\n\tmyApp.get(\"/express\", (req, resp) => {\n\t    resp.send(\"æ¨¡ä»¿Expresså°è£…è·¯ç”±\");\n\t    console.log(req);\n\t});\n\tmyApp.post(\"/postExpress\", (req, resp) => {\n\t    resp.send(\"æ¨¡ä»¿Expresså°è£…è·¯ç”±\");\n\t    console.log(req.myBody);\n\t});\n```\n\n---\né€šè¿‡è¿™ä¸ªä½“ä¼šä¸‹Expressçš„å°è£…\n\n\n\n\n\n","tags":["NodeJS","ES6","JavaScript"],"categories":["Web"]},{"title":"Javaçˆ¬è™«å®æˆ˜(ä¸€) ï¼šçˆ¬å–æ–—å›¾ç¤¾æ‰€æœ‰gif","url":"/2018/11/30/java-pa-chong-shi-zhan/","content":"## Javaçˆ¬è™«å®æˆ˜(ä¸€) ï¼šçˆ¬å–æ–—å›¾ç¤¾æ‰€æœ‰gif\næœ€è¿‘å¼€å§‹ç©çˆ¬è™« , è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ , è™½ç„¶å†™çˆ¬è™«ä¸€èˆ¬éƒ½æ˜¯ç”¨Pythonæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å¿…è¦ä¸ºäº†å†™çˆ¬è™«å†å­¦ä¸€é—¨è¯­è¨€ ,è™½ç„¶ä¹ŸæŒºç®€å•ï¼Œä½†æ˜¯è¿˜æ˜¯å¯¹Javaæ¯”è¾ƒä¹ æƒ¯ï¼Œåé¢å¯èƒ½ä¼šå­¦Pythonä½†æ˜¯ç›®å‰è¿˜æ˜¯å…ˆç”¨javaå†™ç€ç©ç©ã€‚\n\n**ç›®æ ‡** \n[æ–—å›¾ç¤¾ ]( https://doutushe.com/)  ä¸Šæ‰€æœ‰çš„å›¾ç‰‡ã€‚\n![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/%408Q0%601FQB2A2E4D%5D9M8%40VW8.png)\n\n**æŠ€æœ¯é€‰æ‹©**\nJsoupï¼Œæœ€å¼€å§‹çœ‹è§è¿™ä¸ªæˆ‘çœ‹æˆäº†Jsonpã€‚ã€‚ã€‚æˆ‘å¯»æ€ç€ä¸æ˜¯è§£å†³è·¨åŸŸçš„é‚£ä¸ªä¹ˆ?è¿˜èƒ½æçˆ¬è™«?è¿™ä¹ˆç‰›æ°çš„ä¹ˆğŸ˜„\nå…³äºJsoupç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ–‡æ¡£ [å‚è€ƒèµ„æ–™](http://www.open-open.com/jsoup/) \nè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æŠ€æœ¯æ¯”å¦‚ httpclient+Xpath è¿˜æœ‰htmlunit è¿˜æœ‰ selenium ç­‰ç­‰ï¼Œç­‰ä»¥åå­¦äº†åå†æ¥ç§€ä¸€ç§€ ğŸ˜\n\n---\n\nå…¶å®æˆ‘å†™çš„ç¬¬ä¸€ä¸ªçˆ¬è™«æ˜¯copyçš„åˆ«äººçš„åšå®¢ä¸Šçš„ï¼Œä¸è¿‡å®ƒçˆ¬å–çš„æ˜¯äº¬ä¸œçš„ï¼Œæˆ‘çˆ¬çš„æ˜¯æ·˜å®çš„\næˆ‘ä¹Ÿåªæ˜¯æƒ³å‚è€ƒä¸‹ä»–çš„ç»“æ„ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰ä»–çš„æœ‰äº›ç±»æ²¡ä»€ä¹ˆå®é™…æ„ä¹‰ã€‚ã€‚ç„¶åæˆ‘å°±ç›´æ¥è‡ªå·±å†™äº†ã€‚\nç»“æ„å¦‚ä¸‹ï¼š\n\n- boot ï¼šçˆ¬è™«çš„å…¥å£\n- dao  ï¼šdao\n- handle ï¼šå°è£…çš„å¤„ç†æŸ¥è¯¢ç»“æœé›†çš„ç±»ï¼ˆè¿™é‡Œæ²¡ç”¨ï¼‰\n- model ï¼šçˆ¬å–çš„æ•°æ®çš„æ¨¡å‹\n- parse  ï¼š è§£æhtmlçš„ç±»\n- util     ï¼š Jsoupå·¥å…·ç±»å’Œdaoçš„å·¥å…·ç±»å’ŒDBæ¨¡æ¿ç±»\n\né¦–å…ˆå»ºç«‹æ•°æ®æ¨¡å‹DoutuModel\n\n```java\npublic class DoutuModel {\n\t    private Long id;\n\t    private String topic;\n\t    private String imgUrl;\n\t    private String title;\n\t\n\t    //æ•°æ®åº“idè‡ªå¢\n\t    public DoutuModel(String topic, String imgUrl, String title) {\n\t        this.topic = topic;\n\t        this.imgUrl = imgUrl;\n\t        this.title = title;\n\t    }\n\t\n\t    public String getTopic() {\n\t        return topic;\n\t    }\n\t\n\t    public void setTopic(String topic) {\n\t        this.topic = topic;\n\t    }\n\t\n\t    public String getTitle() {\n\t        return title;\n\t    }\n\t\n\t    public void setTitle(String title) {\n\t        this.title = title;\n\t    }\n\t\n\t    public String getImgUrl() {\n\t        return imgUrl;\n\t    }\n\t\n\t    public void setImgUrl(String imgUrl) {\n\t        this.imgUrl = imgUrl;\n\t    }\n\t\n\t    public Long getId() {\n\t        return id;\n\t    }\n\t\n\t    public void setId(Long id) {\n\t        this.id = id;\n\t    }\n}\t\n```\n\n**ä¸»è¦è®°å½•ä¸‹parseç±»**\n\n``` java\npublic static List<DoutuModel> getData2(String url) throws Exception {\n\t        //è·å–çš„æ•°æ®ï¼Œå­˜æ”¾åœ¨é›†åˆä¸­\n\t        List<DoutuModel> data = new ArrayList();\n\t        //é‡‡ç”¨Jsoupè§£æ\n\t        //String url=\"https://doutushe.com/portal/article/index/id/5gK\";\n\t        String preurl = \"https://doutushe.com\";\n\t        //å–åˆ°å½“å‰é¡µçš„document\n\t        //å–åˆ°å†…å®¹é¡µçš„æ‰€æœ‰å›¾ç‰‡\n\t        int page = 1;\n\t        while (true) {\n\t            Document doc = JsoupUtils.getHtmlDocument(url);\n\t            Elements imgList = doc.select(\"div[class=col-xs-12 col-sm-8 col-lg-9]\").select(\"img.lazy\");\n\t            String topic = doc.select(\"blockquote>p\").text();\n\t            for (Element imgelement : imgList) {\n\t                //å¼‚æ­¥çš„åå¤„ä½“ç°å‡ºæ¥äº†,è¿™ä¸ªæ˜æ˜¾æ˜¯æ‡’åŠ è½½,è¦æ‰¾å°±æ‰¾æ•°æ®æº,ç›´æ¥è·å–srcè·å–ä¸åˆ°\n\t                //String imgUrl= imgelement.attr(\"src\");\n\t                String imgUrl = imgelement.attr(\"data-original\");\n\t                String title = imgelement.attr(\"title\");\n\t                data.add(new DoutuModel(topic, imgUrl, title));\n\t                //System.out.println(topic + \":\" + imgUrl + \":\" + title);\n\t            }\n\t            Elements pageUrls = doc.select(\"ul.pager\").select(\"a\");\n\t            //çˆ¬ä¸€é¡µä¼‘æ¯1ç§’\n\t            if (page % 10 == 0) {\n\t                Thread.sleep(1000);\n\t                System.out.println(\"ç¬¬\" + (page/10) + \"é¡µé‡‡é›†å®Œ , æš‚åœ-------\");\n\t            }\n\t            //æœ€åä¸€é¡µä¹Ÿæœ‰ä¸¤ä¸ªæŒ‰é’®ã€‚ã€‚ã€‚çœ‹æ¥è¦å¤šè§‚å¯Ÿé¡µé¢\n\t            /*if (pageUrls.size() < 2) {\n\t                //è¯´æ˜åˆ°æœ€åä¸€é¡µäº†\n\t                break;\n\t            }*/\n\t            url = preurl + pageUrls.get(1).attr(\"href\");\n\t            if (!url.matches(preurl + \"/portal/article/index/id/[a-zA-Z0-9_]*\")) {\n\t                break;\n\t            }\n\t            page++;\n\t        }\n\t        //è¿”å›æ•°æ®\n\t        return data;\n}\n```\nå…¶å®ä¸€å¼€å§‹å†™çš„ä¸€ä¸ªç‰ˆæœ¬æ˜¯ä»ä¸»é¡µé¢çˆ¬çš„å…ˆè·å–æ¯ä¸€é¡µçš„é“¾æ¥ï¼Œå†è·å–æ¯ä¸€é¡µçš„ä¸»é¢˜çš„é“¾æ¥ï¼Œå†è·å–æ¯ä¸ªä¸»é¢˜ä¸‹çš„å›¾ç‰‡é“¾æ¥ï¼Œä¸€ä¸ªä¸‰é‡forå¾ªç¯ï¼Œé€Ÿåº¦ç¡®å®æ¯”è¾ƒæ…¢ã€‚ã€‚ã€‚\n\nåæ¥å‘ç°æ¯ä¸€é¡µéƒ½æœ‰ä¸‹ä¸€é¡µçš„é“¾æ¥ã€‚ã€‚ã€‚ç„¶åå°±å¯ä»¥ç›´æ¥ä»é¡µé¢ä¸Šçˆ¬ï¼Œä¸¤ä¸ªå¾ªç¯å°±å¯ä»¥äº†ï¼Œä½†æ˜¯ä¸€å¼€å§‹æˆ‘åˆ¤æ–­è¾¹ç•Œçš„æ—¶å€™ç”¨çš„æ˜¯åœ¨ä¸‹é¢çš„é“¾æ¥çš„æ•°é‡å°äº2ä½†æ˜¯ä¸€å¼€å§‹çˆ¬äº†å¥½é•¿æ—¶é—´ç»“æœæŠ¥é”™äº†ã€‚ã€‚  ç„¶åæˆ‘å»çœ‹äº†ä¸‹æœ€åä¸€é¡µå‘ç°ä¹Ÿæœ‰ä¸¤ä¸ªé“¾æ¥åé¢ä¸€ä¸ªæ˜¯å…¨éƒ¨çš„é“¾æ¥ã€‚ã€‚ ã€‚\n\n ![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/AT5%7BUKZN%24M%5B59V%5B1OU0S%5B7N.png)\nè€Œä¸”å’Œä¸Šé¢çš„cssæ˜¯ä¸€æ ·çš„ä½†æ˜¯å’Œå‰é¢çš„æ¯ä¸€é¡µçš„é“¾æ¥çš„åç¼€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å°±ç›´æ¥ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…urlçš„åç¼€æ˜¯å¦åŒ¹é…\nRegex ï¼šhttps://doutushe.com/portal/article/index/id/[a-zA-Z0-9_]*  åé¢çš„å°±æ˜¯ç›´æ¥åŒ¹é…ä»»æ„è§†é¢‘\nè€Œæœ€åä¸€é¡µçš„å…¨éƒ¨é“¾æ¥æ˜¯ ï¼š https://doutushe.com/portal/index/index æ‰€ä»¥å°±åŒ¹é…ä¸ä¸Šç›´æ¥break\n\n**çˆ¬å›¾ç‰‡çš„å°ç»†èŠ‚** , ä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œä»–è¿™ä¸ªå›¾ç‰‡æ˜¯æ‡’åŠ è½½çš„ï¼Œä¹Ÿå°±æ˜¯éšç€é¡µé¢ç”¨jsåŠ è½½çš„ï¼Œ ç›´æ¥srcè·å–è‚¯å®šè·å–ä¸åˆ°çš„ï¼Œå› ä¸ºjsoupæ˜¯ä¸æ”¯æŒå¼‚æ­¥çš„ï¼Œç”¨jsæ“ä½œçš„ä¸œè¥¿è‚¯å®šçˆ¬ä¸åˆ°ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡ data-orginal è·å–ã€‚\n\ngithub  [ä»“åº“åœ°å€](https://github.com/imlgw/javaSpiders)\n\n---\n\n**ç»“æœ**\n![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/X%28%7B%60H6YKH2LIW%24%25F2K4U53M.jpg)\n4243å¼ å›¾ç‰‡ï¼Œåé¢å¯ä»¥è‡ªå·±å†™ä¸ªè„šæœ¬æŠŠå›¾ç‰‡å…¨éƒ¨ä¸‹è½½åˆ°æœ¬åœ°æˆ–è€…ç”¨è¿…é›·ä¹‹ç±»çš„ä¸‹è½½å·¥å…·ã€‚\n\n---\nåé¢ä¼šå°è¯•ä¸‹æ›´å¤šçˆ¬è™«æŠ€æœ¯åƒ htmlunitè¿™ç§æ”¯æŒå¼‚æ­¥çš„æˆ–è€… selenium è¿™ç§ç›´æ¥æ“ä½œæµè§ˆå™¨çš„å·¥å…·\n\n\n\n","tags":["çˆ¬è™«","Java","misc"],"categories":["çˆ¬è™«"]},{"title":"Spring-Securityé‡åˆ°çš„å°é—®é¢˜","url":"/2018/11/26/springsecurity-pei-zhi-de-ji-ge-xiao-wen-ti/","content":"## Spring Security é…ç½® intercept-url çš„å°é—®é¢˜\n\næ–‡æ¡£ï¼š http://www.fengfly.com/document/springsecurity3/core-web-filters.html\n\n```java\n<bean id=\"filterInvocationInterceptor\"\n     class=\"org.springframework.security.intercept.web.FilterSecurityInterceptor\">\n  <property name=\"authenticationManager\" ref=\"authenticationManager\"/>\n  <property name=\"accessDecisionManager\" ref=\"accessDecisionManager\"/>\n  <property name=\"runAsManager\" ref=\"runAsManager\"/>\n  <property name=\"securityMetadataSource\">\n    <security:filter-security-metadata-source path-type=\"regex\">\n      <security:intercept-url pattern=\"\\A/secure/super/.*\\Z\" access=\"ROLE_WE_DONT_HAVE\"/>\n      <security:intercept-url pattern=\"\\A/secure/.*\\\" access=\"ROLE_SUPERVISOR,ROLE_TELLER\"/>\n    </security:filter-security-metadata-source>\n  </property>\n</bean>        \n```\n\næ¨¡å¼æ€»æ˜¯æ ¹æ®ä»–ä»¬å®šä¹‰çš„é¡ºåºè¿›è¡Œæ‰§è¡Œã€‚å› æ­¤å¾ˆé‡è¦çš„æ˜¯ï¼ŒæŠŠæ›´ç¡®å®šçš„æ¨¡å¼å®šä¹‰åˆ°åˆ—è¡¨çš„ä¸Šé¢ã€‚ è¿™ä¼šåæ˜ åœ¨ä½ ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ›´ç¡®å®šçš„/secure/super/æ¨¡å¼æ”¾åœ¨æ²¡é‚£ä¹ˆç¡®å®šçš„ /secure/æ¨¡å¼çš„ä¸Šé¢ã€‚å¦‚æœå®ƒä»¬è¢«åè½¬äº†ã€‚/secure/ä¼šä¸€ç›´\n è¢«åŒ¹é…ï¼Œ/secure/super/å°±æ°¸è¿œä¹Ÿä¸ä¼šæ‰§è¡Œã€‚\n\n----\n\n```java\n<http use-expressions=\"false\" entry-point-ref=\"casProcessingFilterEntryPoint\">\n\t\t<intercept-url pattern=\"/**\" access=\"ROLE_USER\"/>\n        <!--ç»è¿‡SpringSecurityçš„ç¯å¢ƒä¸Šä¸‹æ–‡ï¼Œå¶ç„¶å‘ç°ä¸€ä¸ªå°å‘-->\n        <intercept-url pattern=\"/cart/*.do\" access=\"IS_AUTHENTICATED_ANONYMOUSLY\"/>\n        <csrf disabled=\"true\"/>\n        <!-- custom-filterä¸ºè¿‡æ»¤å™¨ï¼Œ position è¡¨ç¤ºå°†è¿‡æ»¤å™¨æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šï¼Œbeforeè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šä½ç½®ä¹‹å‰  ï¼Œafterè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¹‹å  -->\n        <custom-filter ref=\"casAuthenticationFilter\"  position=\"CAS_FILTER\" />\n        <custom-filter ref=\"requestSingleLogoutFilter\" before=\"LOGOUT_FILTER\"/>\n        <custom-filter ref=\"singleLogoutFilter\" before=\"CAS_FILTER\"/>\n    </http>\n```\nä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯å¤§èŒƒå›´åœ¨å‰é¢ä¼šè¦†ç›–åé¢çš„å°èŒƒå›´æ‰€ä»¥åƒæˆ‘ä¸Šé¢é‚£ä¹ˆå†™/cart/*.do å°±ä¸ä¼šæ‰§è¡Œç›¸å½“äºæ²¡å†™ï¼Œèµ·ä¸åˆ°ä½œç”¨ã€‚","tags":["Bug","Spring"],"categories":["è¸©å‘è®°å½•"]},{"title":"CASå•ç‚¹ç™»é™†ç³»ç»ŸDemo","url":"/2018/11/17/cas-dan-dian-deng-lu-xi-tong-ru-men/","content":"##  å•ç‚¹ç™»é™†ç³»ç»Ÿ --CAS\n- å…³äºCASçš„ä»‹ç»ç½‘ä¸Šéƒ½æœ‰ã€‚è¿™é‡Œä¸»è¦è®°å½•å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚ä½•é…ç½®å’Œé›†æˆä¸€äº›æ¡†æ¶ã€‚\n- CASæ¶æ„å›¾\n![OSS](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/CAS.PNG)\nCAS çš„ SSO å®ç°æ–¹å¼å¯ç®€åŒ–ç†è§£ä¸ºï¼š 1 ä¸ª Cookie å’Œ N ä¸ª Session ã€‚ CAS Server åˆ›å»º cookieï¼Œåœ¨æ‰€æœ‰åº”ç”¨è®¤è¯æ—¶ä½¿ç”¨ï¼Œå„åº”ç”¨é€šè¿‡åˆ›å»ºå„è‡ªçš„ Session æ¥æ ‡è¯†ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ã€‚\nç”¨ æˆ·åœ¨ä¸€ä¸ªåº”ç”¨éªŒè¯é€šè¿‡åï¼Œä»¥åç”¨æˆ·åœ¨åŒä¸€æµè§ˆå™¨é‡Œè®¿é—®æ­¤åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ä¸­çš„è¿‡æ»¤å™¨ä¼šåœ¨ session é‡Œè¯»å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥å°±ä¸ä¼šå» CAS Server è®¤è¯ã€‚å¦‚æœåœ¨æ­¤æµè§ˆå™¨é‡Œè®¿é—®åˆ«çš„ web åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯åº”ç”¨ä¸­çš„è¿‡æ»¤å™¨åœ¨ session é‡Œè¯»å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ä¼šå» CAS Server çš„ login æ¥å£è®¤è¯ï¼Œä½†è¿™æ—¶CAS Server ä¼šè¯»å–åˆ°æµè§ˆå™¨ä¼ æ¥çš„ cookie ï¼ˆ TGC ï¼‰ï¼Œæ‰€ä»¥ CAS Server ä¸ä¼šè¦æ±‚ç”¨æˆ·å»ç™»å½•é¡µé¢ç™»å½•ï¼Œåªæ˜¯ä¼šæ ¹æ® service å‚æ•°ç”Ÿæˆä¸€ä¸ª Ticket ï¼Œç„¶åå†å’Œ web åº”ç”¨åšä¸€ä¸ªéªŒ è¯ ticket çš„äº¤äº’è€Œå·²ã€‚\n\n### 1. é…ç½®CASæœåŠ¡ç«¯\nä»ä¸Šé¢çš„æ¶æ„å›¾ä¹Ÿå¯ä»¥å¤§æ¦‚çŸ¥é“CASè¿ä½œçš„æ–¹å¼,é¦–å…ˆé…ç½®å¥½CASçš„Serverç«¯ï¼Œç›´æ¥å°†CASçš„waråŒ…æ‹·åˆ°tomcatçš„webappç›®å½•ä¸‹ç„¶åå¯åŠ¨tomcatè‡ªåŠ¨è§£å‹å°±å¯ä»¥äº†ï¼Œè¿™é‡Œæˆ‘è®¾ç½®çš„tomcatçš„ç«¯å£æ˜¯8888ï¼Œåœ°å€æ è¾“å…¥localhost:8888/casèƒ½çœ‹åˆ°CASçš„ç™»é™†ç•Œé¢è¯´æ˜éƒ¨ç½²æˆåŠŸ\n*  å»é™¤https\n\tCASé»˜è®¤ä½¿ç”¨çš„æ˜¯HTTPSåè®®ï¼Œå¦‚æœä½¿ç”¨HTTPSåè®®éœ€è¦SSLå®‰å…¨è¯ä¹¦ï¼ˆéœ€å‘ç‰¹å®šçš„æœºæ„ç”³è¯·å’Œè´­ä¹°ï¼‰ ã€‚å¦‚æœå¯¹å®‰å…¨è¦æ±‚ä¸é«˜æˆ–æ˜¯åœ¨å¼€å‘æµ‹è¯•é˜¶æ®µï¼Œå¯ä½¿ç”¨HTTPåè®®ã€‚æˆ‘ä»¬è¿™é‡Œè®²è§£é€šè¿‡ä¿®æ”¹é…ç½®ï¼Œè®©CASä½¿ç”¨HTTPåè®®ã€‚\n\n\t* ä¿®æ”¹casçš„WEB-INF/deployerConfigContext.xmlæ‰¾åˆ°ä¸‹é¢çš„é…ç½®\n<bean class=\"org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler\"\np:httpClient-ref=\"httpClient\"/>\nè¿™é‡Œéœ€è¦å¢åŠ å‚æ•°p:requireSecure=\"false\"ï¼ŒrequireSecureå±æ€§æ„æ€ä¸ºæ˜¯å¦éœ€è¦å®‰å…¨éªŒè¯ï¼Œå³HTTPSï¼Œfalseä¸ºä¸é‡‡ç”¨\n   * ä¿®æ”¹casçš„/WEB-INF/spring-configuration/ticketGrantingTicketCookieGenerator.xml\næ‰¾åˆ°ä¸‹é¢é…ç½®\n    <bean id=\"ticketGrantingTicketCookieGenerator\" class=\"org.jasig.cas.web.support.CookieRetrievingCookieGenerator\"\n      p:cookieSecure=\"true\"\n      p:cookieMaxAge=\"-1\"\n      p:cookieName=\"CASTGC\"\n      p:cookiePath=\"/cas\" />\n   * å‚æ•°p:cookieSecure=\"true\"ï¼ŒåŒç†ä¸ºHTTPSéªŒè¯ç›¸å…³ï¼ŒTRUEä¸ºé‡‡ç”¨HTTPSéªŒè¯ï¼ŒFALSEä¸ºä¸é‡‡ç”¨httpséªŒè¯ã€‚\nå‚æ•°p:cookieMaxAge=\"-1\"ï¼Œæ˜¯COOKIEçš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œ-1ä¸ºæ— ç”Ÿå‘½å‘¨æœŸï¼Œå³åªåœ¨å½“å‰æ‰“å¼€çš„çª—å£æœ‰æ•ˆï¼Œå…³é—­æˆ–é‡æ–°æ‰“å¼€å…¶å®ƒçª—å£ï¼Œä»ä¼šè¦æ±‚éªŒè¯ã€‚å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ä¸ºå¤§äº0çš„æ•°å­—ï¼Œæ¯”å¦‚3600ç­‰ï¼Œæ„æ€æ˜¯åœ¨3600ç§’å†…ï¼Œæ‰“å¼€ä»»æ„çª—å£ï¼Œéƒ½ä¸éœ€è¦éªŒè¯ã€‚\n\t\t\n\t\tæˆ‘ä»¬è¿™é‡Œå°†cookieSecureæ”¹ä¸ºfalse , cookieMaxAge æ”¹ä¸º3600\n\n   * ä¿®æ”¹casçš„WEB-INF/spring-configuration/warnCookieGenerator.xml\n\t\t<bean id=\"warnCookieGenerator\" class=\"org.jasig.cas.web.support.CookieRetrievingCookieGenerator\"\n\t\tp:cookieSecure=\"true\"\n\t\tp:cookieMaxAge=\"-1\"\n\t\tp:cookieName=\"CASPRIVACY\"\n\t\tp:cookiePath=\"/cas\" />\næˆ‘ä»¬è¿™é‡Œå°†cookieSecureæ”¹ä¸ºfalse , cookieMaxAge æ”¹ä¸º3600\n- é…ç½®æ•°æ®æº\n   - casæœ‰é»˜è®¤çš„å¯†ç ä½†æ˜¯å®é™…ä¸­è‚¯å®šæ˜¯è¦ä»æ•°æ®åº“ä¸­æŸ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½®ä¸‹æ•°æ®æº\n   - ä¿®æ”¹casæœåŠ¡ç«¯ä¸­web-infä¸‹deployerConfigContext.xml ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®\n\t\t```java\n\t\t<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\" \n\t\t p:driverClass=\"com.mysql.jdbc.Driver\"\n\t\t p:jdbcUrl=\"jdbc:mysql://127.0.0.1:3306/pinyougoudb?characterEncoding=utf8\"\n\t\t p:user=\"root\"\n\t\t p:password=\"123456\" />\n\t\t<bean id=\"passwordEncoder\"\n\t\tclass=\"org.jasig.cas.authentication.handler.DefaultPasswordEncoder\" \n\t\t c:encodingAlgorithm=\"MD5\"\n\t\t p:characterEncoding=\"UTF-8\" />\n\t\t<bean id=\"dbAuthHandler\" \n\t\t class=\"org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler\"\n\t\t p:dataSource-ref=\"dataSource\"\n\t\t p:sql=\"select password from tb_user where username = ?\"\n\t\t p:passwordEncoder-ref=\"passwordEncoder\"/>\n\t\t```\n  - ç„¶ååœ¨é…ç½®æ–‡ä»¶å¼€å§‹éƒ¨åˆ†æ‰¾åˆ°å¦‚ä¸‹é…ç½®\n\t\n\t```java\n\t <bean id=\"authenticationManager\" class=\"org.jasig.cas.authentication.PolicyBasedAuthenticationManager\">\n\t        <constructor-arg>\n\t            <map>               \n\t                <entry key-ref=\"proxyAuthenticationHandler\" value-ref=\"proxyPrincipalResolver\" />\n\t                <entry key-ref=\"primaryAuthenticationHandler\" value-ref=\"primaryPrincipalResolver\" />\n\t            </map>\n\t        </constructor-arg>      \n\t        <property name=\"authenticationPolicy\">\n\t            <bean class=\"org.jasig.cas.authentication.AnyAuthenticationPolicy\" />\n\t        </property>\n\t</bean>\n\t```\n\tå…¶ä¸­ <entry key-ref=\"primaryAuthenticationHandler\" value-ref=\"primaryPrincipalResolver\" />ä¸€å¥æ˜¯ä½¿ç”¨å›ºå®šçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªbean ,å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“è®¤è¯ç”¨æˆ·åå’Œå¯†ç ï¼Œéœ€è¦å°†è¿™å¥æ³¨é‡Šæ‰ã€‚\n\tæ·»åŠ ä¸‹é¢è¿™ä¸€å¥é…ç½®\n\t<entry key-ref=\"dbAuthHandler\" value-ref=\"primaryPrincipalResolver\"/>\n  - å°†ä¸‰ä¸ªjaråŒ…åŠ å…¥åˆ°casçš„libç›®å½•ä¸‹\n   ![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/casjar.PNG)\n\tç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œä¸­é—´çš„é‚£ä¸ªæ˜¯caså¯¹jdbcçš„æ”¯æŒåŒ…\n\t\n\n\n\n---\n### 2. æ™®é€šçš„webé¡¹ç›®é›†æˆCAS\n æ™®é€šçš„webé¡¹ç›®ä¹Ÿå°±æ˜¯æ²¡æœ‰ä½¿ç”¨Springä¹‹ç±»çš„æ¡†æ¶è€Œé‡‡ç”¨web.xmlé…ç½®çš„æ™®é€šé¡¹ç›®\n* 2.1 ä¸ºäº†æ–¹ä¾¿æˆ‘è¿™é‡Œé‡‡ç”¨mavené…ç½®ï¼Œå…ˆæ·»åŠ ç›¸åº”çš„ä¾èµ–\n\t\t\n```java\n        <!-- cas -->\n        <dependency>\n            <groupId>org.jasig.cas.client</groupId>\n            <artifactId>cas-client-core</artifactId>\n            <version>3.3.3</version>\n        </dependency>\n        <dependency>\n            <groupId>javax.servlet</groupId>\n            <artifactId>servlet-api</artifactId>\n            <version>2.5</version>\n            <scope>provided</scope>\n        </dependency>\n```\nä¸€ä¸ªæ˜¯caså®¢æˆ·ç«¯çš„æ ¸å¿ƒåŒ…ï¼Œä¸€ä¸ªæ˜¯servletçš„åŒ…ï¼Œå› ä¸ºåé¢ä¼šå†™ä¸€äº›jsp\nç„¶åæ·»åŠ tomcatæ’ä»¶æˆ‘è®¾ç½®çš„ç«¯å£ä¸º9002\n* 2.2 å› ä¸ºæ˜¯æ™®é€šçš„webé¡¹ç›®æ‰€ä»¥é…ç½®çš„æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡web.xmlæ¥é…ç½®ï¼Œç›´æ¥ä¸Šé…ç½®\n\n\t```java\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t         xmlns=\"http://java.sun.com/xml/ns/javaee\"\n\t         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\t         version=\"2.5\">\n\t    <!-- ç”¨äºå•ç‚¹é€€å‡ºï¼Œè¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½® -->\n\t    <listener>\n\t        <listener-class>org.jasig.cas.client.session.SingleSignOutHttpSessionListener</listener-class>\n\t    </listener>\n\t    <!-- è¯¥è¿‡æ»¤å™¨ç”¨äºå®ç°å•ç‚¹ç™»å‡ºåŠŸèƒ½ï¼Œå¯é€‰é…ç½®ã€‚ -->\n\t    <filter>\n\t        <filter-name>CAS Single Sign Out Filter</filter-name>\n\t        <filter-class>org.jasig.cas.client.session.SingleSignOutFilter</filter-class>\n\t    </filter>\n\t    <filter-mapping>\n\t        <filter-name>CAS Single Sign Out Filter</filter-name>\n\t        <url-pattern>/* </url-pattern>\n\t    </filter-mapping>\n\t    <!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£ç”¨æˆ·çš„è®¤è¯å·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ -->\n\t    <filter>\n\t        <filter-name>CASFilter</filter-name>\n\t        <filter-class>org.jasig.cas.client.authentication.AuthenticationFilter</filter-class>\n\t        <init-param>\n\t            <param-name>casServerLoginUrl</param-name>\n\t            <param-value>http://localhost:8888/cas/login</param-value>\n\t            <!--è¿™é‡Œçš„serveræ˜¯æœåŠ¡ç«¯çš„IP -->\n\t        </init-param>\n\t        <init-param>\n\t            <param-name>serverName</param-name>\n\t            <param-value>http://localhost:9002</param-value>\n\t        </init-param>\n\t    </filter>\n\t    <filter-mapping>\n\t        <filter-name>CASFilter</filter-name>\n\t        <url-pattern>/*</url-pattern>\n\t    </filter-mapping>\n\t    <!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£å¯¹Ticketçš„æ ¡éªŒå·¥ä½œï¼Œå¿…é¡»å¯ç”¨å®ƒ -->\n\t    <filter>\n\t        <filter-name>CAS Validation Filter</filter-name>\n\t        <filter-class>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter</filter-class>\n\t        <init-param>\n\t            <param-name>casServerUrlPrefix</param-name>\n\t            <param-value>http://localhost:8888/cas</param-value>\n\t        </init-param>\n\t        <init-param>\n\t            <param-name>serverName</param-name>\n\t            <param-value>http://localhost:9002</param-value>\n\t        </init-param>\n\t    </filter>\n\t    <filter-mapping>\n\t        <filter-name>CAS Validation Filter</filter-name>\n\t        <url-pattern>/*</url-pattern>\n\t    </filter-mapping>\n\t    <!-- è¯¥è¿‡æ»¤å™¨è´Ÿè´£å®ç°HttpServletRequestè¯·æ±‚çš„åŒ…è£¹ï¼Œ æ¯”å¦‚å…è®¸å¼€å‘è€…é€šè¿‡HttpServletRequestçš„getRemoteUser()æ–¹æ³•è·å¾—SSOç™»å½•ç”¨æˆ·çš„ç™»å½•åï¼Œå¯é€‰é…ç½®ã€‚ -->\n\t    <filter>\n\t        <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name>\n\t        <filter-class>\n\t            org.jasig.cas.client.util.*\n\t        </filter-class>\n\t    </filter>\n\t    <filter-mapping>\n\t        <filter-name>CAS HttpServletRequest Wrapper Filter</filter-name>\n\t        <url-pattern>/*</url-pattern>\n\t    </filter-mapping>\n\t    <!-- è¯¥è¿‡æ»¤å™¨ä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡org.jasig.cas.client.util.AssertionHolderæ¥è·å–ç”¨æˆ·çš„ç™»å½•åã€‚ æ¯”å¦‚AssertionHolder.getAssertion().getPrincipal().getName()ã€‚ -->\n\t    <filter>\n\t        <filter-name>CAS Assertion Thread Local Filter</filter-name>\n\t        <filter-class>org.jasig.cas.client.util.AssertionThreadLocalFilter</filter-class>\n\t    </filter>\n\t    <filter-mapping>\n\t        <filter-name>CAS Assertion Thread Local Filter</filter-name>\n\t        <url-pattern>/*</url-pattern>\n\t    </filter-mapping>\n\t</web-app>\n\n\t```\n\n  * ç”¨æˆ·è®¤è¯è¿‡æ»¤å™¨(å¿…é€‰)**AuthenticationFilter**åœ¨ä¸Šé¢çš„é…ç½®ä¸­éœ€è¦ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯casServerLoginUrlé¡¾åæ€ä¹‰å°±æ˜¯CASserverç™»é™†çš„åœ°å€ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯http://localhost:8888/cas/login ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯**serverName** ,å› ä¸ºç™»é™†æˆåŠŸåè¿˜æ˜¯è¦è¿”å›ä½ å½“å‰çš„åº”ç”¨æ‰€ä»¥éœ€è¦å°†ä½ å½“å‰çš„åº”ç”¨çš„åœ°å€ä¼ é€’ç»™CASserveræ¯”å¦‚æˆ‘çš„å½“å‰åº”ç”¨ http://localhost:9002/\n  * Ticketçš„æ ¡éªŒè¿‡æ»¤å™¨(å¿…é€‰)**Cas20ProxyReceivingTicketValidationFilter** ä¸ä¸Šé¢çš„è¿‡æ»¤å™¨ç±»ä¼¼ä¹Ÿéœ€è¦é‚£ä¸¤ä¸ªå‚æ•°ï¼Œ\t\t\t\t\t\t\t  é…ç½®äº†è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨CASå°±èƒ½æ­£å¸¸è¿è¡Œäº†\n  * å•ç‚¹ç™»å‡ºè¿‡æ»¤å™¨ **SingleSignOutFilter**ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç”¨äºå•ç‚¹ç™»å‡º  \n  * å¦å¤–è¿˜æœ‰ä¸¤ä¸ªè¿‡æ»¤å™¨éƒ½æ˜¯ä¸ºäº†è·å–ç™»é™†åé…ç½®çš„è¿‡æ»¤å™¨ï¼Œé…ç½®ä¸€ä¸ªå°±è¡Œã€‚    \n#\n* 2.3 ç¼–å†™index.jsp(tomcaté»˜è®¤æ‰“å¼€çš„é¡µé¢)\n\t\n\t```java\n\t<%@ page language=\"java\" contentType=\"text/html; charset=utf-8\"\n\t         pageEncoding=\"utf-8\"%>\n\t<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\t<html>\n\t<head>\n\t    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n\t    <title>ä¸€å“ä¼˜è´­</title>\n\t</head>\n\t<body>\n\t é‡‡ç”¨web.xmlé…ç½®çš„æ™®é€šçš„webæ¨¡å—\n\t<%=request.getRemoteUser()%>\n\t <a href=\"http://localhost:8888/cas/logout?service=http://www.imlgw.top\">é€€å‡ºç™»å½•</a>>\n\t</body>\n\t</html>\n\t\n\t```\n\t å¦‚æœæƒ³è®©casé€€å‡ºåè·³è½¬åˆ°æŒ‡å®šçš„é¡µé¢è€Œä¸æ˜¯CASé»˜è®¤çš„é¡µé¢ä¹Ÿéœ€è¦ä¿®æ”¹é…ç½®\n\t ä¿®æ”¹casç³»ç»Ÿçš„é…ç½®æ–‡ä»¶cas-servlet.xml\n\t <bean id=\"logoutAction\" class=\"org.jasig.cas.web.flow.LogoutAction\"\n\t p:servicesManager-ref=\"servicesManager\"\n\t p:followServiceRedirects=\"${cas.logout.followServiceRedirects:true}\"/>\n\tå°†cas.logout.followServiceRedirectsæ”¹ä¸ºtrueåï¼Œå¯ä»¥åœ¨é€€å‡ºæ—¶è·³è½¬é¡µé¢åˆ°ç›®æ ‡é¡µé¢\n   ç„¶åå°±å¯ä»¥å¯åŠ¨caså’Œä½ çš„åº”ç”¨æ¥æµ‹è¯•äº†ã€‚\n* 2.4 æœåŠ¡ç«¯ç•Œé¢æ”¹é€ \n   ä¸Šé¢æµ‹è¯•æˆåŠŸï¼Œä½†æ˜¯çœŸå®çš„æƒ…å†µè‚¯å®šä¸ä¼šç”¨casé»˜è®¤çš„é‚£ä¸ªé¡µé¢åšç™»é™†éœ€è¦æ”¹æˆä½ è‡ªå·±çš„ç™»é™†ç•Œé¢ï¼Œç„¶åä½ å½“å‰åº”ç”¨çš„ç™»é™†é¡µé¢å°±æ²¡ç”¨äº†ã€‚\n  \n\t```java\n\t<!DOCTYPE >\n\t<%@ page pageEncoding=\"UTF-8\" %>\n\t<%@ page contentType=\"text/html; charset=UTF-8\" %>\n\t<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n\t<%@ taglib prefix=\"spring\" uri=\"http://www.springframework.org/tags\" %>\n\t<%@ taglib prefix=\"form\" uri=\"http://www.springframework.org/tags/form\" %>\n\t<%@ taglib prefix=\"fn\" uri=\"http://java.sun.com/jsp/jstl/functions\" %>\n\t<html>\n\t\t<head>\n\t\t\t<meta charset=\"UTF-8\" />\n\t\t\t<title>Login</title>\n\t\t\t<link rel=\"stylesheet\" type=\"text/css\" href='bs/css/bootstrap.min.css' />\n\t\t\t<script type=\"text/javascript\" src=\"js/jquery.min.js\"></script>\n\t\t\t<script type=\"text/javascript\" src=\"bs/js/bootstrap.min.js\"></script>\n\t\t\t<style>\n\t\t\t\timg {\n\t\t\t\t\theight: 200px;\n\t\t\t\t\tborder-radius: 200px;\n\t\t\t\t}\n\t\t\t\t.panel-title{\n\t\t\t\t\ttext-align: center;\n\t\t\t\t}\n\t\t\t\t.login {\n\t\t\t\t\twidth: 500px;\n\t\t\t\t\theight: 400px;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 20%;\n\t\t\t\t\tleft: 50%;\n\t\t\t\t\tmargin-left: -250px;\n\t\t\t\t}\n\t\t\t\t.sub{\n\t\t\t\t\ttext-align: center;\n\t\t\t\t}\n\t\n\t\t\t</style>\n\t\t</head>\n\t\n\t\t<body>\n\t\t\t<div class=\"panel panel-primary login\">\n\t\t\t\t<div class=\"panel-heading\">\n\t\t\t\t\t<div class=\"panel-title\">\n\t\t\t\t\t\t<img src=\"images/login.jpg\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t<!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ 1 -->\n\t\t\t\t\t<form:form method=\"post\" id=\"fm1\" commandName=\"${commandName}\" htmlEscape=\"true\" class=\"sui-form\">\n\t\t\t\t\t\n\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t<div class=\"input-group\">\n\t\t\t\t\t\t\t\t<span class=\"input-group-addon\" id=\"basic-addon1\"><span class=\"glyphicon glyphicon-user\"></span></span>\n\t\t\t\t\t\t\t\t<!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ 2 -->\n\t\t\t\t\t\t\t\t<form:input  class=\"form-control\" aria-describedby=\"basic-addon1\" placeholder=\"Username\"  id=\"username\" size=\"25\" tabindex=\"1\" accesskey=\"${userNameAccessKey}\" path=\"username\" autocomplete=\"off\" htmlEscape=\"true\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t<div class=\"input-group\">\n\t\t\t\t\t\t\t\t<span class=\"input-group-addon\" id=\"basic-addon1\"><span class=\"glyphicon glyphicon-lock\"></span></span>\n\t\t\t\t\t\t\t\t<!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ 3 -->\n\t\t\t\t\t\t\t\t<form:password class=\"form-control\" placeholder=\"password\" aria-describedby=\"basic-addon1\" id=\"password\" size=\"25\" tabindex=\"2\" path=\"password\"  accesskey=\"${passwordAccessKey}\" htmlEscape=\"true\" autocomplete=\"off\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"form-group sub\">\n\t\t\t\t\t\t\t<!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ 4 ç™»é™†æ¡† -->\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"lt\" value=\"${loginTicket}\" />\n\t     \t \t\t\t\t<input type=\"hidden\" name=\"execution\" value=\"${flowExecutionKey}\" />\n\t      \t\t\t\t\t<input type=\"hidden\" name=\"_eventId\" value=\"submit\" />\n\t      \t\t\t\t\t<input class=\"btn btn-primary btn-lg\" name=\"submit\" accesskey=\"l\" value=\"ç™»é™†\" type=\"submit\" />\n\t      \t\t\t\t\t<!--è‡ªå®šä¹‰çš„ç™»é™†ç•Œé¢ä¿®æ”¹ 4 é”™è¯¯æç¤ºæ¡† -->\n\t      \t\t\t\t\t<form:errors path=\"*\" id=\"msg\" cssClass=\"errors\" element=\"div\" htmlEscape=\"false\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form:form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t</body>\n\t\n\t</html>\n\t```\n\tå¯ä»¥ç›´æ¥å°†ç™»é™†çš„é¡µé¢æ‹·è¿‡æ¥ç„¶ååŠ ä¸ŠæŒ‡ä»¤å†æ ¹æ®casçš„ç™»é™†é¡µé¢ç¨åŠ ä¿®æ”¹å°±å¯ä»¥äº†\n\n---\n### 3. Springé¡¹ç›®é›†æˆCASå’ŒSpring-security\n* pomä¾èµ–\n\t\n\t```java\n\t<properties>\n\t        <spring.version>4.2.0.RELEASE</spring.version>\n\t    </properties>\n\t    <dependencies>\n\t        <!-- Spring -->\n\t        <dependency>\n\t            <groupId>org.springframework</groupId>\n\t            <artifactId>spring-context</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>org.springframework</groupId>\n\t            <artifactId>spring-beans</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>org.springframework</groupId>\n\t            <artifactId>spring-webmvc</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>org.springframework</groupId>\n\t            <artifactId>spring-jdbc</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>org.springframework</groupId>\n\t            <artifactId>spring-aspects</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>org.springframework</groupId>\n\t            <artifactId>spring-jms</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>org.springframework</groupId>\n\t            <artifactId>spring-context-support</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <!--spring-security-->\n\t        <dependency>\n\t            <groupId>org.springframework.security</groupId>\n\t            <artifactId>spring-security-web</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>org.springframework.security</groupId>\n\t            <artifactId>spring-security-config</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <dependency>\n\t            <groupId>javax.servlet</groupId>\n\t            <artifactId>javax.servlet-api</artifactId>\n\t            <version>3.1.0</version>\n\t            <scope>provided</scope>\n\t        </dependency>\n\t        <!--é›†æˆåŒ…-->\n\t        <dependency>\n\t            <groupId>org.springframework.security</groupId>\n\t            <artifactId>spring-security-cas</artifactId>\n\t            <version>${spring.version}</version>\n\t        </dependency>\n\t        <!--cas-->\n\t        <dependency>\n\t            <groupId>org.jasig.cas.client</groupId>\n\t            <artifactId>cas-client-core</artifactId>\n\t            <version>3.3.3</version>\n\t            <exclusions>\n\t                <exclusion>\n\t                    <groupId>org.slf4j</groupId>\n\t                    <artifactId>log4j-over-slf4j</artifactId>\n\t                </exclusion>\n\t            </exclusions>\n\t        </dependency>\n\t    </dependencies>\n\t```\n\tæ·»åŠ tomcatæ’ä»¶æŒ‡å®šç«¯å£ä¸º9001\n* web.xmlé…ç½®\n```java\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t         xmlns=\"http://java.sun.com/xml/ns/javaee\"\n\t         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\t         version=\"2.5\">\n\t\n\t    <context-param>\n\t        <param-name>contextConfigLocation</param-name>\n\t        <param-value>classpath:spring/spring-*.xml</param-value>\n\t    </context-param>\n\t    <listener>\n\t        <listener-class>\n\t            org.springframework.web.context.ContextLoaderListener\n\t        </listener-class>\n\t    </listener>\n\t\n\t    <filter>\n\t        <filter-name>springSecurityFilterChain</filter-name>\n\t        <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>\n\t    </filter>\n\t    <filter-mapping>\n\t        <filter-name>springSecurityFilterChain</filter-name>\n\t        <url-pattern>/*</url-pattern>\n\t    </filter-mapping>\n\t\n\t</web-app>\n```\nä¸»è¦é…ç½®Springå®¹å™¨å’ŒSpring-securityçš„è¿‡æ»¤å™¨\n- spring-security.xmlé…ç½®\n  å…¶å®å°±æ˜¯æŠŠä¹‹å‰é…ç½®åœ¨web.xmlé‡Œé¢çš„è¿‡æ»¤å™¨é‡‡ç”¨Springçš„æ–¹å¼é…ç½®å‡ºæ¥\n\n``` java\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t<beans:beans xmlns=\"http://www.springframework.org/schema/security\"\n\t             xmlns:beans=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t             xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n\t\t\t\t\t\t\thttp://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd\">\n\t\n\t    <http pattern=\"/out.html\" security=\"none\"></http>\n\t    <!--   entry-point-ref  å…¥å£ç‚¹å¼•ç”¨ å› ä¸ºç™»é™†äº¤ç»™casæˆ–è€…å…¶ä»–çš„ç™»é™†ç³»ç»Ÿ,å°±ä¸ä¼šåœ¨æœ¬ç³»ç»Ÿåšç™»é™†éœ€è¦æŒ‡å®šç™»é™†ç‚¹-->\n\t    <http use-expressions=\"false\" entry-point-ref=\"casProcessingFilterEntryPoint\">\n\t        <intercept-url pattern=\"/**\" access=\"ROLE_USER\"/>\n\t        <csrf disabled=\"true\"/>\n\t        <!-- custom-filterä¸ºè¿‡æ»¤å™¨ï¼Œ position è¡¨ç¤ºå°†è¿‡æ»¤å™¨æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šï¼Œbeforeè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šä½ç½®ä¹‹å‰  ï¼Œafterè¡¨ç¤ºæ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¹‹å  -->\n\t        <custom-filter ref=\"casAuthenticationFilter\"  position=\"CAS_FILTER\" />\n\t        <custom-filter ref=\"requestSingleLogoutFilter\" before=\"LOGOUT_FILTER\"/>\n\t        <custom-filter ref=\"singleLogoutFilter\" before=\"CAS_FILTER\"/>\n\t    </http>\n\t\n\t    <!-- CASå…¥å£ç‚¹ å¼€å§‹ -->\n\t    <beans:bean id=\"casProcessingFilterEntryPoint\" class=\"org.springframework.security.cas.web.CasAuthenticationEntryPoint\">\n\t        <!-- å•ç‚¹ç™»å½•æœåŠ¡å™¨ç™»å½•URL -->\n\t        <beans:property name=\"loginUrl\" value=\"http://localhost:8888/cas/login\"/>\n\t        <beans:property name=\"serviceProperties\" ref=\"serviceProperties\"/>\n\t    </beans:bean>\n\t\n\t    <beans:bean id=\"serviceProperties\" class=\"org.springframework.security.cas.ServiceProperties\">\n\t        <!--service é…ç½®è‡ªèº«å·¥ç¨‹çš„æ ¹åœ°å€+/login/cas   -->\n\t        <beans:property name=\"service\" value=\"http://localhost:9001/login/cas\"/>\n\t    </beans:bean>\n\t    <!-- CASå…¥å£ç‚¹ ç»“æŸ -->\n\t    <!-- è®¤è¯è¿‡æ»¤å™¨ å¼€å§‹ -->\n\t    <beans:bean id=\"casAuthenticationFilter\" class=\"org.springframework.security.cas.web.CasAuthenticationFilter\">\n\t        <beans:property name=\"authenticationManager\" ref=\"authenticationManager\"/>\n\t    </beans:bean>\n\t    <!-- è®¤è¯ç®¡ç†å™¨ -->\n\t    <authentication-manager alias=\"authenticationManager\">\n\t        <authentication-provider  ref=\"casAuthenticationProvider\">\n\t        </authentication-provider>\n\t    </authentication-manager>\n\t    <!-- è®¤è¯æä¾›è€… -->\n\t    <beans:bean id=\"casAuthenticationProvider\"     class=\"org.springframework.security.cas.authentication.CasAuthenticationProvider\">\n\t        <beans:property name=\"authenticationUserDetailsService\">\n\t            <beans:bean class=\"org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper\">\n\t                <beans:constructor-arg ref=\"userDetailsService\" />\n\t            </beans:bean>\n\t        </beans:property>\n\t        <beans:property name=\"serviceProperties\" ref=\"serviceProperties\"/>\n\t        <!-- ticketValidator ä¸ºç¥¨æ®éªŒè¯å™¨ -->\n\t        <beans:property name=\"ticketValidator\">\n\t            <beans:bean class=\"org.jasig.cas.client.validation.Cas20ServiceTicketValidator\">\n\t                <beans:constructor-arg index=\"0\" value=\"http://localhost:8888/cas\"/>\n\t            </beans:bean>\n\t        </beans:property>\n\t        <beans:property name=\"key\" value=\"an_id_for_this_auth_provider_only\"/>\n\t    </beans:bean>\n\t    <!-- è®¤è¯ç±» -->\n\t    <beans:bean id=\"userDetailsService\" class=\"top.imlgw.demo.UserDetailServiceImpl\"/>\n\t\n\t    <!-- è®¤è¯è¿‡æ»¤å™¨ ç»“æŸ -->\n\t\n\t\n\t    <!-- å•ç‚¹ç™»å‡º  å¼€å§‹  -->\n\t    <beans:bean id=\"singleLogoutFilter\" class=\"org.jasig.cas.client.session.SingleSignOutFilter\"/>\n\t    <!--å…³è”ä¸¤ä¸ªåœ°å€ï¼Œç›¸å½“äºå°è£…äº†å‰é¢çš„åœ°å€-->\n\t    <beans:bean id=\"requestSingleLogoutFilter\" class=\"org.springframework.security.web.authentication.logout.LogoutFilter\">\n\t        <beans:constructor-arg value=\"http://localhost:8888/cas/logout?service=http://localhost:9001/out.html\"/>\n\t        <beans:constructor-arg>\n\t            <beans:bean class=\"org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler\"/>\n\t        </beans:constructor-arg>\n\t        <beans:property name=\"filterProcessesUrl\" value=\"/logout/cas\"/>\n\t    </beans:bean>\n\t    <!-- å•ç‚¹ç™»å‡º  ç»“æŸ -->\n\t\n\t</beans:beans>\n```\n\n- userDetailsServiceç¼–å†™\n  è¿™æ˜¯ä¸€ä¸ªè®¤è¯ç±»æ˜¯å±äºSpring-securityçš„ï¼Œå¦‚æœä¸ä½¿ç”¨CASé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯ç”¨æ¥éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®æ˜¯å¦æ”¾è¡Œçš„ã€‚ä½†æ˜¯æ•´åˆäº†CASåå°±ä¸ç”¨åœ¨é‡Œé¢åšè®¤è¯äº†ï¼Œåªæ˜¯ä¸ºäº†è¿”å›åé¢çš„è§’è‰²é›†åˆã€‚\n\n\t```java\n\tpackage top.imlgw.demo;\n\timport org.springframework.security.core.GrantedAuthority;\n\timport org.springframework.security.core.authority.SimpleGrantedAuthority;\n\timport org.springframework.security.core.userdetails.User;\n\timport org.springframework.security.core.userdetails.UserDetails;\n\timport org.springframework.security.core.userdetails.UserDetailsService;\n\timport org.springframework.security.core.userdetails.UsernameNotFoundException;\n\timport java.util.ArrayList;\n\timport java.util.List;\n\t\n\tpublic class UserDetailServiceImpl implements UserDetailsService {\n\t    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n\t        System.out.println(\"ç»è¿‡è®¤è¯ç±»\");\n\t        List<GrantedAuthority> authorities=new ArrayList();\n\t        //æœ€å¼€å§‹æŠŠè¿™é‡Œçš„roleå†™é”™äº†ï¼Œç„¶åcasç™»é™†æˆåŠŸåä¹Ÿä¸€ç›´è¢«403 forbidï¼Œå› ä¸ºSpringSecurityè®¤è¯æ²¡é€šè¿‡ï¼Œä¸€ç›´æ²¡æ”¾è¡Œ\n\t        authorities.add(new SimpleGrantedAuthority(\"ROLE_USER\"));\n\t        //ä¸é€šè¿‡æœ¬é¡¹ç›®åšç™»é™† æ‰€ä»¥å¯†ç æ— æ‰€è°“ï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™å°±å·²ç»ç™»é™†æˆåŠŸäº†\n\t        return new User(username,\"\",authorities);\n\t    }\n\t}\n\t\n\t```\n\n---\n### 4. æµ‹è¯•\nå¯åŠ¨æ­å»ºå¥½çš„ä¸¤ä¸ªæœåŠ¡å™¨ï¼Œå’ŒcasServerï¼Œç„¶åæµ‹è¯•åœ¨ä¸€ä¸ªåº”ç”¨ç™»é™†åå¦ä¸€ä¸ªèƒ½å¦è¿›å…¥indexé¡µé¢ .....\n\n---\nSpringBooté›†æˆCASå’ŒSpring-securityçš„åé¢å†è¡¥å……ï¼Œå› ä¸ºSpringBootè¿˜ä¸å¤ªç†Ÿæ‚‰ã€‚","tags":["CAS","SSO"],"categories":["Web"]},{"title":"ä¸€é“LeetCodeå¼•å‘çš„æƒ¨æ¡ˆ","url":"/2018/10/31/yi-dao-leetcode-yin-fa-de-can-an/","content":"## ä¸€é“LeetCodeæœç´¢é¢˜å¼•å‘çš„æƒ¨æ¡ˆ\n ### 1.å…ˆä¸Š [é¢˜ç›®](https://leetcode-cn.com/problems/word-ladder/) \nç»™å®šä¸¤ä¸ªå•è¯ï¼ˆ_beginWord _å’Œ _endWord_ï¼‰å’Œä¸€ä¸ªå­—å…¸ï¼Œæ‰¾åˆ°ä» _beginWord_ åˆ° _endWord_ çš„æœ€çŸ­è½¬æ¢åºåˆ—çš„é•¿åº¦ã€‚è½¬æ¢éœ€éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š\n\n1.  æ¯æ¬¡è½¬æ¢åªèƒ½æ”¹å˜ä¸€ä¸ªå­—æ¯ã€‚\n2.  è½¬æ¢è¿‡ç¨‹ä¸­çš„ä¸­é—´å•è¯å¿…é¡»æ˜¯å­—å…¸ä¸­çš„å•è¯ã€‚\n [åŸé¢˜é“¾æ¥](https://leetcode-cn.com/problems/word-ladder/) \n![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/3V6EQ77R_%28%292SCR%248R%5B%245F7.png)å…¶å®è¿™é¢˜æ˜æ˜¾æ˜¯BFS(å¹¿æœ) é¢˜ç›®ç±»å‹ä¹Ÿè¯´äº†æ˜¯å¹¿æœï¼Œä½†æ˜¯æˆ‘ä¸ä¿¡é‚ªå†™äº†DFS(æ¯•ç«Ÿä»£ç æ¯”è¾ƒå¥½å†™)ï¼Œç„¶åæƒ¨æ¡ˆå°±å‘ç”Ÿäº†ã€‚\n\n```java\n   // æ ‡è®°æ•°ç»„\n\t// é»˜è®¤éƒ½æ˜¯0\n\tprivate static int[] mark;\n\n\tpublic int ladderLength(String beginWord, String endWord, List<String> wordList) {\n\t\t// ä¸å­˜åœ¨\n\t\tmark = new int[wordList.size() + 1];\n\t\tif (!wordList.contains(endWord)) {\n\t\t\treturn 0;\n\t\t}\n\t\t// dfså¼€å§‹\n\t\tdfs(beginWord, endWord, wordList);\n\t\t// æ— æ³•è½¬æ¢\n\t\tif (min == Integer.MAX_VALUE) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn min + 1;\n\t}\n\n\tint min = Integer.MAX_VALUE;\n\n\t// dfs\n\tprivate void dfs(String beginWord, String endWord, List<String> wordList) {\n\t\t//å½“ç›¸ç­‰çš„æ—¶å€™\n\t\tif (beginWord.equals(endWord)) {\n\t\t\tint step = 0;\n\t\t\tfor (int i = 0; i < mark.length; i++) {\n\t\t\t\tif (mark[i] == 1) {\n\t\t\t\t\tstep++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//æ›´æ–°æœ€å°å€¼\n\t\t\tmin = step < min ? step : min;\n\t\t\treturn;\n\t\t}\n\t\tfor (int i = 0; i < wordList.size(); i++) {\n\t\t\tif (mark[i] == 0 && cmp(beginWord, wordList.get(i))) {\n\t\t\t\tmark[i] = 1;\n\t\t\t\tdfs(wordList.get(i), endWord, wordList);\n\t\t\t\tmark[i] = 0;\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯\n\tprivate boolean cmp(String s1, String s2) {\n\t\tint count = 0;\n\t\tfor (int i = 0; i < s1.length(); i++) {\n\t\t\tif (s1.charAt(i) != s2.charAt(i)) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count == 1;\n\t}\n```\nç»“æœç›´æ¥TLEäº†ï¼Œåæ¥æƒ³äº†æƒ³DFSæ¯æ¬¡éƒ½ä¼š**å°è¯•**æ‰€æœ‰æƒ…å†µï¼Œè€Œç»™çš„ä¾‹å­åé¢çš„æ•°æ®é‡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œè€Œä¸”è¿™é¢˜æ˜¯è¦ç»Ÿè®¡æœ€çŸ­è·¯å¾„ï¼Œè¦å…¨éƒ¨é€’å½’å®Œæ‰èƒ½ç¡®å®šæœ€å°å€¼ï¼Œæˆ‘æŠŠæ•°æ®æ‹¿æ¥è‡ªå·±æµ‹è¯•è·‘äº†å¥½é•¿æ—¶é—´éƒ½æ²¡è·‘å‡ºæ¥ï¼Œè€ŒBFSæ²¡æœ‰é€’å½’åªæ˜¯ä¼šè€—è´¹çš„ç©ºé—´ä¼šæ¯”è¾ƒå¤§ã€‚ä»è¿™é‡Œä¹Ÿå¯ä»¥æ€»ç»“å‡ºæ¥DFSè·Ÿé€‚åˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ˜¯å¦å¯è¾¾ä¹‹ç±»çš„é—®é¢˜ï¼ŒBFSæ›´é€‚åˆåšæ‰¾æœ€çŸ­æœ€å°ä¹‹ç±»çš„é—®é¢˜ã€‚ä¸ŠBFSä»£ç \n\n```java\n// æ ‡è®°æ•°ç»„\n\t// é»˜è®¤éƒ½æ˜¯0\n\tprivate static int[] mark;\n\t// æ¨¡æ‹Ÿé˜Ÿåˆ—\n\tclass Que {\n\t\tString word;\n\t\tint step;\n\t}\n\t//BFS\n\tpublic int ladderLengthBFS(String beginWord, String endWord, List<String> wordList){\n        // ä¸å­˜åœ¨\n\t\tmark = new int[wordList.size() + 1];\n\t\tif (!wordList.contains(endWord)) {\n\t\t\treturn 0;\n\t\t}\n\t\t// BFS\n\t\tint head = 0, tail = 0;\n\t\t// åˆå§‹åŒ–é˜Ÿåˆ—\n\t\tQue[] que = new Que[wordList.size() + 1];\n\t\t// å¾ªç¯ä¿ƒä½¿è¯è¿°ç¥–\n\t\tfor (int i = 0; i < que.length; i++) {\n\t\t\tque[i] = new Que();\n\t\t}\n\t\tque[tail].word = beginWord;\n\t\tque[tail].word = beginWord;\n\t\tque[tail].step = 1;\n\t\ttail++;\n\t\tint flag=0;\n\t\twhile (head < tail) {\n\t\t\t// éå†å­—å…¸\n\t\t\tfor (int i = 0; i < wordList.size(); i++) {\n\t\t\t\tif (mark[i] == 0 && cmp(wordList.get(i), que[head].word)) {\n\t\t\t\t\tque[tail].word = wordList.get(i);\n\t\t\t\t\t//è¿™é‡Œæ˜¯ä»headå¼€å§‹çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯headçš„æ­¥æ•°+1\n\t\t\t\t\tque[tail].step=que[head].step+1;\n\t\t\t\t\t// æ ‡è®°ä¸ºå·²ç»èµ°è¿‡\n\t\t\t\t\tmark[i] = 1;\n\t\t\t\t   if (que[tail].word.equals(endWord)) {\n\t\t\t\t\t//åˆ°è¿™é‡Œè¯´æ˜å·²ç»åˆ°ç»ˆç‚¹äº†ï¼Œè€Œä¸”æ˜¯æœ€çŸ­çš„ï¼Œä¹‹åçš„æœ€å¤šå°±æ˜¯ç›¸ç­‰\n\t\t\t\t\t//è·³å‡ºå¾ªç¯\n                       flag=1;\n                       break;\n\t\t\t    \t}\n                    tail++;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n            if(flag==1){\n                break;\n            }\n\t\t\t// æ¯æ¬¡æ£€æŸ¥å®Œä¸€ä¸ªå•è¯å°±å°†å…¶å‡ºé˜Ÿåˆ—\n\t\t\thead++;\n\t\t}\n\t\treturn que[tail].step;\n    }\n\n\t// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ²¡åƒæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯\n\tprivate boolean cmp(String s1, String s2) {\n\t\tint count = 0;\n\t\tfor (int i = 0; i < s1.length(); i++) {\n\t\t\tif (s1.charAt(i) != s2.charAt(i)) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count == 1;\n\t}\n```\n\nPSï¼šåˆšåˆšä¿®æ”¹äº†ä¸‹ä»£ç ï¼Œæˆ‘ä¹Ÿä½©æœè‡ªå·±BFSéƒ½è¿˜æ²¡ææ¸…æ¥šå°±ç›´æ¥ä¸Šäº†ä»£ç ï¼Œç„¶åç»“æœå±…ç„¶è¿˜æ˜¯å¯¹çš„ï¼Œä¹‹å‰åœ¨ifåˆ¤æ–­é˜Ÿå°¾å…ƒç´ æ˜¯ä¸æ˜¯å’ŒendWordç›¸ç­‰åè¿˜ç»´æŠ¤äº†ä¸€ä¸ªæœ€å°å€¼minï¼Œåæ¥æƒ³äº†æƒ³ä¸å¯¹ï¼Œæœ€åä¸€ä¸ªå’ŒendWordç›¸ç­‰çš„å…ƒç´ å·²ç»è¿›æ ˆäº†ï¼Œå·²ç»æ˜¯æœ€çŸ­çš„äº†ï¼Œåé¢çš„å³ä½¿å¯ä»¥è½¬æ¢åˆ°ä¹Ÿæœ€å¤šåªèƒ½å’Œå½“å‰çš„ç›¸ç­‰äº†ã€‚ å¦‚æœåªæ˜¯ä¸ºäº†ç»Ÿè®¡æœ€å°å€¼å°±å¯ä»¥ç›´æ¥breakäº†ã€‚é‚£å¦‚æœä¸ä»…ä»…è¦ç»Ÿè®¡æœ€å°å€¼è¿˜è¦è®°å½•è·¯å¾„è¦æ€ä¹ˆæï¼Ÿ\n### 2. [åŠ å¼ºç‰ˆ](https://leetcode-cn.com/problems/word-ladder-ii/) å•è¯æ¥é¾™ 2\næ˜¯ä¸€é“å›°éš¾ç­‰çº§çš„é¢˜ï¼Œéœ€è¦åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šæ‰¾å‡ºæ‰€æœ‰çš„æœ€çŸ­çš„è·¯å¾„ã€‚\n\n```java\n// å†…éƒ¨ç±»\n\tclass Que {\n\t\tString word;\n\t\tint step;\n\t\tQue prev;\n\t\tpublic String toString(){\n\t\t\treturn (word + \":\" + step);\n\t\t}\t\t \n\t}\n\n\t//è¿”å›å€¼\n\tprivate  List<List<String>> res=new ArrayList<>();\n\n\t\n\t//BFS\n\tpublic List<List<String>> ladderLengthBFS(String beginWord, String endWord, List<String> wordList){\n        //è¿”å›å€¼\n\t\t//List<List<String>> res=new ArrayList<>();\n\t\t\n        // ä¸å­˜åœ¨\n\t\tmark = new int[wordList.size() + 1];\n\t\tif (!wordList.contains(endWord)) {\n\t\t\treturn res;\n\t\t}\n\t\t// BFS\n\t\tint head = 0, tail = 0;\n\t\t// åˆå§‹åŒ–é˜Ÿåˆ—\n\t\tQue[] que = new Que[wordList.size() + 1];\n\t\t// å¾ªç¯ä¿ƒä½¿è¯è¿°ç¥–\n\t\tfor (int i = 0; i < que.length; i++) {\n\t\t\tque[i] = new Que();\n\t\t}\n\t\t//å…ˆæŠŠç¬¬ä¸€ä¸ªå•è¯æ”¾è¿›å»\n\t\tque[tail].word = beginWord;\n\t\tque[tail].word = beginWord;\n\t\tque[tail].step = 1;\n\t\ttail++;\n\t\tList<Que> quelist=new ArrayList<>();\n\t\twhile (head < tail) {\n\t\t\t// éå†å­—å…¸\n\t\t\tfor (int i = 0; i < wordList.size(); i++) {\n\t\t\t\tif (mark[i] == 0 && cmp(wordList.get(i), que[head].word)) {\n\t\t\t\t\tque[tail].word = wordList.get(i);\n\t\t\t\t\t//è¿™é‡Œæ˜¯ä»headå¼€å§‹çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯headçš„æ­¥æ•°+1\n\t\t\t\t\tque[tail].step=que[head].step+1;\n\t\t\t\t\t//que[head].next=que[tail];\n\t\t\t\t\t// æ ‡è®°ä¸ºå·²ç»èµ°è¿‡\n\t\t\t\t\tmark[i] = 1;\n\t\t\t\t   if (que[tail].word.equals(endWord)) {\t\n\t\t\t\t   \t\t//è®°å½•æœ€å°å€¼\n\t\t\t\t   \t\tmin=que[tail].step;\n\t\t\t\t   \t\t//åˆ°è¿™é‡Œé˜Ÿåˆ—åé¢å°±ä¸ç”¨å†æ’å…¥å…ƒç´ äº†\n\n\t\t\t\t   \t\t//2.æŠŠä¹‹å‰èµ°è¿‡çš„è·¯åœ¨ä¸‹ä¸€ä¸ªhead\n\n\t\t\t\t   \t\t//å°†é˜Ÿåˆ—å˜æˆlist\n\t\t\t\t   \t\tfor(int j=0;j<=tail;j++){\n\t\t\t\t   \t\t\tquelist.add(que[j]);\n\t\t\t\t   \t\t}\n\t\t\t\t   \t\tmarkDfs= new int[wordList.size() + 1]; \n\t\t\t\t   \t\t// 1. ç”¨DFSè¯•ä¸€ä¸‹\n\t\t\t\t   \t\tdfsBfs(que[0],endWord,quelist);\n\t\t\t    \t}\n                    tail++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// æ¯æ¬¡æ£€æŸ¥å®Œä¸€ä¸ªå•è¯å°±å°†å…¶å‡ºé˜Ÿåˆ—\n\t\t\thead++;\n\t\t}\n\t\treturn res;\n    }\n\n\n    private void dfsBfs(Que beginWord,String endWord,List<Que> ques){\n    \tint step = 0;\n\t\tfor (int i = 0; i < markDfs.length; i++) {\n\t\t\t\tif (markDfs[i] == 1) {\n\t\t\t\t\tstep++;\n\t\t\t\t}\n\t\t}\n\t\tif(step>=min) return;\n\t\tif(step+1==min&&endWord.equals(beginWord.word)){\n\t\t\tList<String> list=new ArrayList<>();\n\t\t\tStack<String> stack=new Stack<>();\n\t\t\tSystem.out.println(beginWord.word+\":\"+step);\n\t\t\tQue temp=beginWord;\n\t\t\t\t//æ‰¾åˆ°ä¸€æ¡\n\t\t\t\tfor(int i=0;i<min;i++){\n\t\t\t\t\tstack.push(temp.word);\n\t\t\t\t\tSystem.out.print(temp.word+\"<--\");\n\t\t\t\t\ttemp=temp.prev;\n\t\t\t\t}\n\t\t\t\tSystem.out.println();\n\t\t\t\tfor(int i=0;i<min;i++){\n\t\t\t\t\tlist.add(stack.pop());\n\t\t\t\t}\n\t\t\t\tres.add(list);\n\t\t\t\tSystem.out.println(res);\n\t\t\treturn;\n\t\t}\n\n\t\t\n\t\tfor (int i = 0; i < ques.size(); i++) {\n\t\t\tif (markDfs[i] == 0 && cmp(beginWord.word,ques.get(i).word)){\n\t\t\t\tmarkDfs[i] = 1;\n\t\t\t\t//è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹\n\t\t\t\t//beginWord.next=ques.get(i);\n\t\t\t\tques.get(i).prev=beginWord;\n\t\t\t\tdfsBfs(ques.get(i), endWord, ques);\n\t\t\t\tmarkDfs[i] = 0;\n\t\t\t}\n\t\t}\n\t\treturn;\n    }\n\n\t// private int step = 0;\n\tint min = Integer.MAX_VALUE;\n\n\t// å†™ä¸€ä¸ªå‡½æ•°åˆ¤æ®µæ²¡åƒæ˜¯å¦åªå˜åŒ–äº†ä¸€ä¸ªå­—æ¯\n\tprivate boolean cmp(String s1, String s2) {\n\t\tint count = 0;\n\t\tfor (int i = 0; i < s1.length(); i++) {\n\t\t\tif (s1.charAt(i) != s2.charAt(i)) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count == 1;\n\t}\n```\næ•´ä½“ä¸Šåœ¨Queä¸Šå¢åŠ äº†ä¸€ä¸ªprevçš„æŒ‡é’ˆï¼Œéå†è·¯å¾„ï¼Œä¸€å¼€å§‹æ˜¯ç”¨çš„BFSä¸è¿‡æˆ‘æƒ³çš„å¤ªç®€å•äº†ï¼Œæˆ‘åªæ˜¯æŠŠæœ€åä¸€ä¸ªèŠ‚ç‚¹å‡ºé˜Ÿåˆ—ç„¶åå†BFSï¼Œåæ¥å‘ç°ä¸è¡Œ(å±…ç„¶è¿˜è·‘è¿‡äº†24ä¸ªæµ‹è¯•æ¡ˆä¾‹)ï¼Œå®é™…ä¸Šè¿™é¢˜æˆ‘è¿˜æ˜¯æ²¡æœ‰åšå‡ºæ¥ï¼Œä½†æ˜¯ä¸Šé¢çš„æ–¹æ³•åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„å°±æ˜¯ä¼šTLEğŸ˜­ï¼Œå¤§æ¦‚æ€è·¯å°±æ˜¯å…ˆBFSç¼©çŸ­DFSéœ€è¦éå†çš„å­—å…¸ç„¶åæ§åˆ¶æ¯æ¬¡é€’å½’çš„èº«ä½“ä¸èƒ½è¶…è¿‡BFSçš„åˆ°çš„æœ€çŸ­è·¯å¾„\n![img9](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/blog.PNG)ä¸€å¼€å§‹åªèƒ½è·‘å‡ ä¸ªæ•°æ®çš„ï¼Œä¼˜åŒ–ä¸‹èƒ½è·‘å‡ åä¸ªçš„ï¼Œä½†æ˜¯è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œæ¯•ç«Ÿæ˜¯ä¸€é“éš¾é¢˜ç­‰ä»¥åå­¦äº†ç›¸å…³çš„ä¸œè¥¿å†æ¥è¯•è¯•çœ‹èƒ½ä¸èƒ½åšå‡ºæ¥å§.\n\n---\nç®—æ³•ï¼Œå­¦ç€æŒºæœ‰æ„æ€ï¼Œå°±æ˜¯å¤´æœ‰ç‚¹å‡‰ã€‚","tags":["æ•°æ®ç»“æ„","ç®—æ³•","æœç´¢"],"categories":["ç®—æ³•"]},{"title":"ä½ æœ‰FreeBugä¹ˆ? --->Spring-solr","url":"/2018/10/05/solr-ni-you-freebug-me/","content":"## FreeBug ? å“å‘¦ï¼Œä¸é”™å–”ã€‚\n æ˜¨å¤©ä»ä¸Šåˆ10ç‚¹å¼€å§‹ä¸€ç›´åˆ°æ™šä¸Š 11ï¼š58æ‰æŠŠé‚£å‡ ä¸ªBugç»™è§£å†³äº†ï¼Œå‰ä¸¤ä¸ªBugç¡®å®è›®å¥‡æ€ªçš„ï¼Œç‰¹åˆ«æ˜¯ç¬¬ä¸€ä¸ªBug ,æœ€åä¸€ä¸ªBug....çº¯å±æ™ºéšœã€‚æŠŠè¿™å‡ ä¸ªBugè®°å½•ä¸‹â”—|ï½€Oâ€²|â”› \n### ***Bug1***:\n![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/9642SBM2%60QFX4AMO1C%5D~A%5BM.png)\næ„æ€æ˜¯æ²¡æ‰¾åˆ°TbItemMapperçš„selectæ–¹æ³•è¿˜æœ‰è¿™ä¸ªç±»çš„å…¶ä»–æ–¹æ³•ã€‚\nä¼°è®¡æ˜¯xmlæ–‡ä»¶æ²¡æœ‰åŠ è½½åˆ°classesè·¯å¾„ä¸‹ï¼Œä¹‹å‰ä¸€ç›´å¥½å¥½çš„ç„¶åæ˜¨å¤©çªç„¶æŠ½é£äº†ï¼Œç™¾åº¦äº†ä¸‹å«æˆ‘æŠŠxmlæ–‡ä»¶éšä¾¿çš„æ”¹åŠ¨ä¸‹åœ¨é‡Œé¢åŠ ä¸ªç©ºæ ¼æ¢è¡Œä¹‹ç±»çš„ï¼Œç„¶åå°±å¥½äº†ã€‚ã€‚ã€‚ã€‚\n### ***Bug2***:\n![img9](https://p4.cdn.img9.top/ipfs/Qmcg5dscbhYgod9vdN2SHaxywdaCPVgY28jX4imd53TH6J?4.png)\nçœ‹ç€è¿™äº›ä¸ªBugçœŸçš„æ˜¯ä¸€è„¸æ‡µï¼Œå†™mainæ–¹æ³•æ‰§è¡Œå°±ä¸€ç‚¹é—®é¢˜æ²¡æœ‰ï¼Œé¦–å…ˆæ˜¯ä¸€æ³¢ç™¾åº¦ï¼Œè¯´æ˜¯jaråŒ…å†²çªäº†ä¸»è¦æ˜¯HttpClientçš„å†²çªï¼Œç„¶åæˆ‘å°±å°è¯•äº†ä¸‹ideaçš„mavenä¾èµ–è§†å›¾\n![img9](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/DJQYP%604SGOCL_VP%28LGN%7B_TN.png )\nç„¶åå‘ç°dubboå’Œspring-data-solréƒ½æœ‰httpclientåŒ…å’Œhttpcoreè€Œä¸”ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œç„¶åæœæ–­çš„æŠŠdubboé‡Œé¢çš„httpclientå’Œhttpcoreç»™exclusionäº†ï¼Œä¸çœ‹ä¸çŸ¥é“ï¼Œæ•´ä¸ªé¡¹ç›®çš„mavenä¾èµ–å¥½ä¹±ï¼Œæœ‰å¥½å¤šä¾èµ–å†²çªï¼Œä¸è¿‡æ²¡å½±å“ä½¿ç”¨æˆ‘å°±æ²¡æœ‰å»æ”¹ï¼Œæ€•å†æ”¹å‡ºä»€ä¹ˆé—®é¢˜ã€‚ä½ ä»¥ä¸ºæ”¹å®Œä¹‹åbugå°±ç»“æŸäº†ï¼Ÿ\n### ***Bug3***:\n![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/%60Z3GBQ~K%29%7D%60DX%60P%60Q%257%25%7B%25S.png)åœ¨controllerå±‚ç–¯ç‹‚æŠ¥é”™ï¼Œserviceå±‚ä¸€ç‚¹é—®é¢˜æ²¡æœ‰![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/NLKUXAM~LPOZ7K%60%28%29D52%40VD.png)å¯ä»¥ï¼Œåˆä¸€ä¸ªFreeBugï¼Œåœ¨çº ç»“äº†å‡ ä¸ªå°æ—¶åçœ‹äº†ä¸€çœ¼ä»£ç å‘ç°\n![oss](https://imlgwpicture.oss-cn-qingdao.aliyuncs.com/blogImage/L20FMBQ%28XNRQV6Y6%24ITFEYA.png)åŸæ¥è¿™é‡Œå†™æ‰äº†ä¸œè¥¿ï¼Œè¿”å›äº†ä¸€ä¸ªsolrçš„ç»“æœé›†ä¹Ÿæ²¡æœ‰å®ç°åºåˆ—åŒ–è¿”å›å‡ºå»äº†å‰å°ä¹Ÿæ ¹æœ¬å°±è§£æä¸äº†éš¾æ€ªä¼šå†å‰å°æŠ¥é”™ã€‚ã€‚ã€‚\n\n\nps: ä¹‹å‰ä¸€ç›´ç”¨çš„img9.topçš„æ— é™å›¾åºŠï¼Œå‰å‡ å¤©çªç„¶å´©æºƒäº†åšå®¢çš„å›¾ç‰‡éƒ½å¤±æ•ˆäº†ï¼Œä¹‹å‰ä¹Ÿæœ‰ä¸€ä¸ªé€çš„é˜¿é‡Œäº‘çš„ossçš„åŒ…æ‰€ä»¥å°±æƒ³æ‹¿é‚£ä¸ªå½“å›¾åºŠï¼Œè¿™ç¯‡æ–‡ç« é‡Œé¢çš„å›¾ç‰‡ä¹Ÿéƒ½æ˜¯åœ¨ossä¸Šçš„ï¼Œimg9è™½ç„¶ä¹Ÿè¿˜å¯ä»¥ä½†æ˜¯æ˜¯ä¸ªå»ä¸­å¿ƒåŒ–çš„å›¾åºŠä¸å¥½ç®¡ç†ç¡®å®éš¾æï¼Œç­‰æœ‰æ—¶é—´å°±ç”¨javaå†™ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å›¾åºŠå·¥å…·ç©ç©ã€‚","tags":["Bug","Solr","Spring"],"categories":["è¸©å‘è®°å½•"]},{"title":"å¯ä»¥è·å–æœ€å°å€¼çš„æ ˆ","url":"/2018/09/27/ke-yi-huo-qu-zui-xiao-zhi-de-zhan/","content":"## å¦‚ä½•å®ç°å¯ä»¥è·å–æœ€å°å€¼çš„æ ˆï¼Ÿ\nè¿™ä¸ªé—®é¢˜æ˜¯å¾ˆä¹…ä¹‹å‰åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šçœ‹è§çš„ä¸€ä¸ªé—®é¢˜ï¼Œçªç„¶æƒ³èµ·æ¥å°±æ¥æ“ä½œä¸€ä¸‹ã€‚\nå¼€å‘ç¯å¢ƒ   : sublime+MinGW\nå…ˆé™„ä¸Šæˆ‘è‡ªå·±å®ç°çš„æ ˆçš„ç»“æ„\n\n```java\n//å®šä¹‰é“¾æ ˆçš„èŠ‚ç‚¹çš„ç»“æ„ä½“ \ntypedef struct  StackNode\n{\n\tint data;\n\tstruct StackNode *next;\n}StackNode,*LinkStackPtr;\n\n//é“¾æ ˆçš„ç»“æ„ä½“\ntypedef struct LinkStack\n{\n\t//æ ˆé¡¶\n\tLinkStackPtr top;\n\t//æ€»æ•°é‡\n\tint count;\n}LinkStack;\n\n//åˆå§‹åŒ–æ ˆ\nLinkStack *init(){\n\tLinkStack *stack=(LinkStack*)malloc(sizeof(LinkStack));\n\tif (stack==NULL)\n\t{\n\t\tprintf(\"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥\");\n\t}else\n\t\t//åˆå§‹åŒ–ç©ºæ ˆ\n\t\tstack->top=NULL;\n\t\tstack->count=0;\n\t\treturn stack;\n}\n\n//åˆ›å»ºèŠ‚ç‚¹\nLinkStackPtr  creatNode(){\n\tLinkStackPtr stack;\n\t//å¼€è¾Ÿç©ºé—´\n\tstack =(LinkStackPtr)malloc(sizeof(StackNode));\n\tif(stack==NULL){\n\t\tprintf(\"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥\");\n\t}\n\tscanf(\"%d\",&(stack->data));\n\tstack->next=NULL;\n\treturn stack;\n}\n\n//å‹æ ˆ\nvoid push(LinkStack * s){\n\t//åˆ›å»ºèŠ‚ç‚¹\n\tLinkStackPtr newStack= creatNode();\n\t//ä¿å­˜å½“å‰çš„èŠ‚ç‚¹\n\tLinkStackPtr currentTopStack=s->top;\n\t//æ ˆé¡¶å˜ä¸ºåˆšè¿›æ ˆçš„å…ƒç´ \n\ts->top=newStack;\n\t//è¿æ¥\n\tnewStack->next=currentTopStack;\n\t//æ•°ç›®åŠ ä¸€\n\ts->count++;\n}\n\n//å¼¹æ ˆ\nvoid pop(LinkStack *s){\n\t//å°†æ ˆé¡¶å¼¹å‡º\n\tLinkStackPtr topStack=s->top;\n\ts->top=topStack->next;\n\ts->count--;\n\tfree(topStack);\n}\n```\n\n\n### **Solution 1**ï¼š\nåœ¨è¿›æ ˆçš„æ—¶å€™ç”¨ä¸€ä¸ªå˜é‡ä¿å­˜å½“å‰çš„æœ€å°å€¼æ¯æ¬¡è¿›æ ˆå°±ä¼šå’Œæœ€å°å€¼æ¯”è¾ƒå¦‚æœæ¯”æœ€å°å€¼è¦å°å°±ä¼šæ›´æ–°è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå‡ºæ ˆçš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœæœ€å°å€¼è¢«å¼¹å‡ºå»äº†å°±éœ€è¦éå†æ•´ä¸ªæ ˆæ¥è·å–æœ€å°å€¼ã€‚\n- Implementï¼š\n\n\n```java\ntypedef struct  StackNode\n{\n\tint data;\n\tstruct StackNode *next;\n}StackNode,*LinkStackPtr;\n\n//é“¾æ ˆçš„ç»“æ„ä½“\ntypedef struct LinkStack\n{\n\t//æ ˆé¡¶\n\tLinkStackPtr top;\n\t//æ€»æ•°é‡\n\tint count;\n\t//æœ€å°å€¼\n\tint min;\n}LinkStack;\n\n//è¿›æ ˆ\nvoid push(LinkStack * s){\n\t//åˆ›å»ºèŠ‚ç‚¹\n\tLinkStackPtr newStack= creatNode();\n\t//**********************************\n\tif(s->count==0){\n\t\ts->min=newStack->data;\t\n\t}else if(s->min>newStack->data){\n\t\ts->min=newStack->data;\n\t}\n\t//*********************************\n\t//ä¿å­˜å½“å‰çš„èŠ‚ç‚¹\n\tLinkStackPtr currentTopStack=s->top;\n\t//æ ˆé¡¶å˜ä¸ºåˆšè¿›æ ˆçš„å…ƒç´ \n\ts->top=newStack;\n\t//è¿æ¥\n\tnewStack->next=currentTopStack;\n\t//æ•°ç›®åŠ ä¸€\n\ts->count++;\n}\n\n//å¼¹æ ˆ\nvoid pop(LinkStack *s){\n\t//å°†æ ˆé¡¶å¼¹å‡º\n\tLinkStackPtr topStack=s->top;\n\t//ä»ç¬¬äºŒä¸ªå¼€å§‹æ¯”è¾ƒ\n\tLinkStackPtr stackNode=topStack->next;\n\t//å¼¹å‡ºå»çš„é‚£ä¸ªèŠ‚ç‚¹çš„æ•°æ®\n\tint min=topStack->data;\n\ts->top=topStack->next;\n\ts->count--;\n\tfree(topStack);\n\t//å¦‚æœå¼¹å‡ºçš„æ˜¯æœ€å°å€¼å°±éœ€è¦ä»å½“å‰æ ˆé¡¶éå†æ•°ç»„è·å–æœ€å°å€¼\n\tif(min==s->min){\n\t\tmin=stackNode->data;\n\t  do{\n\t  \tif(min>stackNode->data){\n\t  \t\tmin=stackNode->data;\n\t  \t}\n\t\tstackNode=stackNode->next;\n\t   }while(stackNode!=NULL);\t\n\t}\n\ts->min=min;\n}\n```\nè¿™ç§æ–¹æ³•è¿›æ ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(1),ä½†æ˜¯å‡ºæ ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(n).æ˜¾ç„¶ä¸æ˜¯å¾ˆä¼˜é›…ã€‚\n\n### **Solution 2**ï¼š\nç©ºé—´æ¢æ—¶é—´åˆ©ç”¨ä¸€ä¸ªè¾…åŠ©æ ˆï¼Œè¾…åŠ©æ ˆé‡Œé¢å­˜æ”¾æœ€å°å€¼ï¼Œè¾…åŠ©æ ˆè¿›æ ˆæ—¶åˆ¤æ–­è¿›æ ˆçš„å…ƒç´ å’Œå½“å‰æ ˆé¡¶çš„å…ƒç´ å¤§å°è·Ÿå°å°±å¯ä»¥è¿›æ ˆã€‚æ‰€ä»¥æœ€å°å€¼å°±æ˜¯è¾…åŠ©æ ˆçš„æ ˆé¡¶å…ƒç´ ï¼Œå‡ºæ ˆæ—¶å¦‚æœå‡ºæ ˆçš„å…ƒç´ æ˜¯æœ€å°å€¼èŠ‚ç‚¹é‚£è¾…åŠ©æ ˆä¹ŸåŒæ—¶å¼¹æ ˆ å†å–æ ˆé¡¶å…ƒç´ ã€‚\n- Implementï¼š\n\n```java\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\n//å®šä¹‰é“¾æ ˆçš„èŠ‚ç‚¹çš„ç»“æ„ä½“ \ntypedef struct  StackNode\n{\n\tint data;\n\tstruct StackNode *next;\n}StackNode,*LinkStackPtr;\n\n//é“¾æ ˆçš„ç»“æ„ä½“\ntypedef struct LinkStack\n{\n\t//æ ˆé¡¶\n\tLinkStackPtr top;\n\t//æ€»æ•°é‡\n\tint count;\n\t//è¾…åŠ©æ ˆ\n\tstruct LinkStack *mins;\n}LinkStack;\n\n//åˆå§‹åŒ–æ ˆ\nLinkStack *init(){\n\tLinkStack *stack=(LinkStack*)malloc(sizeof(LinkStack));\n\tif (stack==NULL)\n\t{\n\t\tprintf(\"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥\");\n\t}else\n\t\t//åˆå§‹åŒ–ç©ºæ ˆ\n\t\tstack->top=NULL;\n\t\tstack->count=0;\n\t\treturn stack;\n}\n\n//åˆ›å»ºèŠ‚ç‚¹\nLinkStackPtr  creatNode(){\n\tLinkStackPtr stack;\n\t//å¼€è¾Ÿç©ºé—´\n\tstack =(LinkStackPtr)malloc(sizeof(StackNode));\n\tif(stack==NULL){\n\t\tprintf(\"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥\");\n\t}\n\tscanf(\"%d\",&(stack->data));\n\tstack->next=NULL;\n\treturn stack;\n}\n\n//è¿›æ ˆ\nvoid push(LinkStack * s){\n\t//åˆ›å»ºèŠ‚ç‚¹\n\tLinkStackPtr newStack= creatNode();\n\t//ä¿å­˜å½“å‰çš„èŠ‚ç‚¹\n\tLinkStackPtr currentTopStack=s->top;\n\n\t//å¼€è¾Ÿç©ºé—´ ç”¨äºæ·»åŠ åˆ°è¾…åŠ©æ ˆä¸­ï¼Œä¹‹å‰ç›´æ¥æ“ä½œnewStackï¼ŒæŒ‡é’ˆåœ°å€å¯¼è‡´åé¢è¾…åŠ©æ ˆå’Œä¸»æ ˆæ··åˆåˆ°äº†ä¸€èµ·ï¼Œï¼Œï¼Œï¼Œ\n\tLinkStackPtr minStackNode =(LinkStackPtr)malloc(sizeof(StackNode));\n\tif(minStackNode==NULL){\n\t\tprintf(\"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥\");\n\t}\n\tminStackNode->data=newStack->data;\n\tminStackNode->next=NULL;\n\n\t//æ ˆé¡¶å˜ä¸ºåˆšè¿›æ ˆçš„å…ƒç´ \n\ts->top=newStack;\n\t//è¾…åŠ©æ ˆ\n\tLinkStack *mins=s->mins;\n\t//ä¿å­˜è¾…åŠ©æ ˆå½“å‰æ ˆé¡¶\n\tLinkStackPtr  currentMinsTop=mins->top;\n\tif(s->count==0){\n\t   mins->top=newStack;\n\t   newStack->next=NULL;\n    }else\n    \t//å¦‚æœè¿›æ ˆçš„å…ƒç´ æ¯”å½“å‰è¾…åŠ©æ ˆçš„æ ˆé¡¶å°\n    \t//ç›¸ç­‰çš„è¦è¿›æ ˆ\n    \tif(newStack->data<=mins->top->data){\n    \t\tmins->top=minStackNode;\n    \t\t//è¿æ¥\n    \t\tmins->top->next=currentMinsTop;\n    \t\tmins->count++;\n    \t}\n\t//è¿æ¥\n\ts->top->next=currentTopStack;\n\t//æ•°ç›®åŠ ä¸€\n\ts->count++;\n}\n\n//å¼¹æ ˆ\nvoid pop(LinkStack *s){\n\t//å°†æ ˆé¡¶å¼¹å‡º\n\tLinkStackPtr topStack=s->top;\n    //è¾…åŠ©æ ˆ\n\tLinkStack * mins=s->mins;\n\t//ä¿å­˜è¾…åŠ©æ ˆæ ˆé¡¶å…ƒç´ ä¾¿äºé”€æ¯\n\tLinkStackPtr minsTopStack=mins->top;\n\ts->top=topStack->next;\n\ts->count--;\n\t//å¼¹å‡ºçš„å…ƒç´ æ˜¯æœ€å°å€¼\n\tif (topStack->data==mins->top->data)\n\t{\n\t\t//è¾…åŠ©æ ˆåŒæ—¶å¼¹æ ˆ\n\t\tmins->top=minsTopStack->next;\n\t\tmins->count--;\n\t\tfree(minsTopStack);\n\t}\n\tfree(topStack);\n}\n\n//éå†æ ˆï¼ˆæ ˆé¡¶åˆ°æ ˆåº•ï¼‰\nvoid printStack(LinkStack *stack){\n\t//å½“å‰æ ˆé¡¶\n\tLinkStackPtr stackNode=stack->top;\n\tdo{\n\t\tprintf(\"%d\\n\",stackNode->data);\n\t\tstackNode=stackNode->next;\n\t}while(stackNode!=NULL);\n}\n\nint main(int argc, char const *argv[])\n{\n\t//ç”³æ˜å¹¶åˆå§‹åŒ–æ ˆç»“æ„\n\tLinkStack *stack=init();\n\t//åˆå§‹åŒ–è¿™ä¸ªé“¾æ ˆçš„è¾…åŠ©ï¼ˆCè¯­è¨€å­¦çš„ä¸å¥½åŸè°…è¿™äº›å¾ˆå¥‡æ€ªçš„æ“ä½œï¼‰\n\tstack->mins=init();\n\tpush(stack);\n\tpush(stack);\n\tpush(stack);\n\tpush(stack);\n\tprintf(\"*******è¿›æ ˆ******\\n\");\n\tprintStack(stack);\n\tprintf(\"*********è¾…åŠ©æ ˆ*******\\n\");\n\tprintStack(stack->mins);\n\tprintf(\"*******æœ€å°å€¼******\\n\");\n\tprintf(\"%d\\n\", stack->mins->top->data);\n\tpop(stack);\n\tprintf(\"*******å‡ºæ ˆ******\\n\");\n\tprintStack(stack);\n\tprintf(\"*******æœ€å°å€¼******\\n\");\n\tprintf(\"%d\\n\", stack->mins->top->data);\n\tprintf(\"*********è¾…åŠ©æ ˆ*******\\n\");\n\tprintStack(stack->mins);\n\treturn 0;\n}\n```\næ˜æ˜¾è¿™ä¸ªæ–¹æ³•è¿›æ ˆå‡ºæ ˆæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼Œç©ºé—´å¤æ‚åº¦ç›¸å¯¹ä¼šé«˜ä¸€ç‚¹ï¼Œå…¶å®ç©ºé—´å¤æ‚åº¦è¿˜å¯ä»¥ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨è¾…åŠ©æ ˆé‡Œé¢å­˜ç´¢å¼•ï¼Œè¿™æ ·è¿›æ ˆæ—¶ä¼šé¿å…å­˜å…¥ç›¸åŒçš„æœ€å°å€¼ï¼Œå¦‚  2 1 1 1 1 1 å­˜åˆ°è¾…åŠ©æ ˆå°±æ˜¯  2 1 1 1 1 1 åé¢çš„1éƒ½æ˜¯é‡å¤çš„ï¼Œå¦‚æœå­˜ç´¢å¼•å°±æ˜¯ 0 1 è¿›æ ˆæ—¶è·Ÿä¹‹å‰ä¸€æ ·,å‡ºæ ˆæ—¶åˆ¤æ–­ç´¢å¼•æ˜¯å¦å’Œè¾…åŠ©æ ˆå­˜çš„ç´¢å¼•ä¸€è‡´ï¼Œä¸ä¸€è‡´å°±ä¸åŠ¨ã€‚è¿™é‡Œå› ä¸ºè¿™ä¸ªæ˜¯ä¸ªé“¾æ ˆ ,è¦æ ¹æ®ç´¢å¼•å–å€¼å¹¶ä¸æ–¹ä¾¿æ‰€ä»¥å°±ä¸å®ç°äº†.\n\nè¿™é‡Œæˆ‘æŠŠä»£ç å…¨éƒ¨è´´ä¸Šæ¥äº†ï¼ŒCè¯­è¨€ç¡®å®å­¦çš„ä¸æ€ä¹ˆæ ·ï¼Œæ‰€ä»¥é‡Œé¢ä¼šæœ‰ä¸€äº›å¥‡æ€ªçš„æ“ä½œï¼Œè¿™ä¸ªç®—æ³•æœ¬èº«å¾ˆç®€å•ä½†æ˜¯ç”¨Cè¯­è¨€ä¸€å®ç°å°±ä¼šæœ‰ä¸€å †é—®é¢˜ï¼Œæ˜¨å¤©è¿›æ ˆçš„æ—¶å€™ä¸€ä¸ªæŒ‡é’ˆæŠŠè¾…åŠ©æ ˆå’Œä¸»æ ˆææ··äº†ä¸€ç›´æœ‰bug, ä»Šå¤©æ—©ä¸Šä¸Šè¯¾æ‰æƒ³èµ·æ¥ï¼Œæ¯•ç«ŸCè¯­è¨€å†™çš„å°‘hahahaha,  æ‰€ä»¥åé¢æˆ‘æ‰“ç®—ä»¥åä¼šåŒæ—¶ç”¨Cè¯­è¨€å’ŒJavaéƒ½å®ç°ä¸€éã€‚\n\n\n\n","tags":["æ•°æ®ç»“æ„","ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"Spring-Redisé‡åˆ°çš„bug","url":"/2018/09/24/spring-redis-yu-dao-de-bug/","content":"\n##   ä¸¤ä¸ªå°bugè®°å½•ä¸€ä¸‹\n1.  Spring-data-rediså’Œjedisæ•´åˆçš„ç‰ˆæœ¬é—®é¢˜æŠ¥é”™å¦‚ä¸‹ï¼š\n```java\nä¸¥é‡: Exception sending context initialized event to listener instance of class org.springframework.web.context.ContextLoaderListener\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name 'redisTemplate' defined in URL [jar:file:/E:/repository/com/pyg/pyg-common/0.0.1-SNAPSHOT/pyg-common-0.0.1-SNAPSHOT.jar!/spring/applicationContext-redis.xml]: Invocation of init method failed; nested exception is java.lang.NoSuchMethodError: org.springframework.core.serializer.support.DeserializingConverter.<init>(Ljava/lang/ClassLoader;)V\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1578)\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:545)\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:482)\nat org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:305)\nat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)\nat org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:301)\nat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:196)\nat org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:772)\nat org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:834)\nat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:537)\nat org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:446)\nat org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:328)\nat org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:107)\nat org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4939)\nat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5434)\nat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\nat org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1559)\nat org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1549)\nat java.util.concurrent.FutureTask.run(FutureTask.java:266)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\nat java.lang.Thread.run(Thread.java:748)\nCaused by: java.lang.NoSuchMethodError: org.springframework.core.serializer.support.DeserializingConverter.<init>(Ljava/lang/ClassLoader;)V\nat org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.<init>(JdkSerializationRedisSerializer.java:53)\nat org.springframework.data.redis.core.RedisTemplate.afterPropertiesSet(RedisTemplate.java:117)\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1637)\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1574)\n... 21 more\n```\n\n æŠ¥é”™åŸå› ï¼šSpring-data-reids å’Œ jedisçš„ç‰ˆæœ¬å†²çªï¼ˆåº”è¯¥ä¹Ÿå’ŒSpringçš„ç‰ˆæœ¬æœ‰å…³ç³»,åˆ«äººè·Ÿæˆ‘ä¸€æ ·çš„åŒ…éƒ½å¯ä»¥è¿è¡Œï¼‰ã€‚\næˆ‘æµ‹è¯•æˆåŠŸçš„ç‰ˆæœ¬ï¼š\n<jedis.version>2.6.2</jedis.version>\n<spring.version>4.2.0.RELEASE</spring.version>\n<spring-data-redis.version>1.4.2.RELEASE</spring.version>\n\n2. SpringåŠ è½½é…ç½®æ–‡ä»¶çš„é—®é¢˜\nå› ä¸ºåŒæ—¶é…ç½®äº†MySqlå’ŒRedisçš„é…ç½®æ–‡ä»¶è€Œä¸”ä¸æ˜¯åŒä¸€ä¸ªå·¥ç¨‹æ‰€ä»¥ä¸æ˜¯åŒæ—¶åˆå§‹åŒ–ç„¶åå‡ºç°äº†ä»¥ä¸‹çš„é—®é¢˜ã€‚\nåŒä¸ªæ¨¡å—ä¸­å¦‚æœå‡ºç°å¤šä¸ªcontext:property-placeholder ï¼Œlocation propertiesæ–‡ä»¶åï¼Œ è¿è¡Œæ—¶å‡ºç°Could not resolve placeholder 'key' in string value${key}ã€‚åŸå› æ˜¯åœ¨åŠ è½½ç¬¬ä¸€ä¸ªcontext:property-placeholderæ—¶ ä¼šæ‰«ææ‰€æœ‰çš„beanï¼Œè€Œæœ‰çš„beané‡Œé¢å‡ºç°ç¬¬äºŒä¸ª context:property-placeholderå¼•å…¥çš„propertiesçš„å ä½ç¬¦${key}ï¼Œ æ­¤æ—¶è¿˜æ²¡æœ‰åŠ è½½ç¬¬äºŒä¸ªproperty-placeholderï¼Œæ‰€ä»¥è§£æä¸äº†${key}ã€‚\nè§£å†³åŠæ³•ä¸€ï¼Œå¯ä»¥å°†é€šè¿‡æ¨¡å—çš„å¤šä¸ªproperty-placeholderåˆå¹¶ä¸ºä¸€ä¸ªï¼Œå°†åˆå§‹åŒ–æ”¾åœ¨ä¸€èµ·ã€‚\næ–¹æ³•äºŒï¼Œæ·»åŠ ignore-unresolvable=\"true \"ï¼Œè¿™æ ·å¯ä»¥åœ¨åŠ è½½ç¬¬ä¸€ä¸ªproperty-placeholderæ—¶å‡ºç°è§£æä¸äº†çš„å ä½ç¬¦è¿›è¡Œå¿½ç•¥æ‰\n\npsï¼šç›®å‰çš„è®¡åˆ’æ˜¯å…ˆæŠŠå“ä¼˜è´­è¿™ä¸ªé¡¹ç›®åšå®Œï¼Œç„¶åæä¸€æå¾®ä¿¡å°ç¨‹åºä¹‹ç±»çš„å¼€å‘ï¼Œç„¶åå¼€å§‹ç€æ‰‹ç ”ç©¶æºç ï¼Œå¯¹Springçš„æºç éå¸¸å¥½å¥‡æœ‰ç§ç‰¹åˆ«æƒ³äº†è§£å¥¹çš„æ¬²æœ›hahahahahaha....  çœ‹æºç è‚¯å®šä¼šæ¶‰åŠåˆ°è®¾è®¡æ¨¡å¼ä¹Ÿé¡ºä¾¿å­¦ä¸€å­¦ï¼Œå†å°±æ˜¯æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿™å­¦æœŸä¹Ÿæ­£åœ¨å­¦ä¹Ÿä¸ç”¨ç€æ€¥è·Ÿç€è€å¸ˆçš„è¿›åº¦å†åŠ è‡ªå·±çš„è‡ªå­¦è¡¥å……ï¼Œè¿™ä¸ªä¸œè¥¿ä¹Ÿä¸æ˜¯è¯´ä»Šå¤©å­¦å®Œäº†å°±ä¼šäº†çš„ä¸œè¥¿ï¼Œå¤§äºŒä¸Šå­¦æœŸä¸»è¦çš„æ‰“ç®—å°±æ˜¯è¿™ä¸ªäº†ï¼Œè¿˜æœ‰å°±æ˜¯ä¸èƒ½æŒ‚ç§‘ï¼ï¼ï¼ï¼,å†å¾€åå°±æ˜¯æ‰“ç®—å­¦ä¸‹å®‰å“å’Œå®‰å“é€†å‘ï¼Œä¸è¿‡æš‚æ—¶åªæ˜¯ä¸ªæ‰“ç®—ğŸ˜„ã€‚å†å¾€åå°±æ˜¯å¤§ä¸‰äº†ï¼Œè¿˜æ²¡æ‰“ç®—åˆ°é‚£ä¸ªæ—¶å€™ï¼Œæƒ³æƒ³è¿˜çœŸå¿«ï¼Œä¸çŸ¥ä¸è§‰å°±ä¸€å¹´è¿‡å»äº†ã€‚Come on , add oil ! ! ! @imlgw\n\n","tags":["Redis","Bug","Spring"],"categories":["è¸©å‘è®°å½•"]},{"title":"KMPç®—æ³•åŠä¼˜åŒ–","url":"/2018/09/06/kmp-suan-fa-ji-you-hua/","content":"## KMPç®—æ³•åŠä¼˜åŒ–\n> åé¢æœ‰æ—¶é—´å†æ¥é‡å†™ä¸€ä¸‹ï¼Œkmpè¿˜æ˜¯æŒºé‡è¦çš„\n\nKMPç®—æ³•æ˜¯ä¸€ç§æ”¹è¿›çš„[å­—ç¬¦ä¸²åŒ¹é…](https://baike.so.com/doc/9018958-9348545.html)ç®—æ³•ï¼Œç”±D.E.Knuthï¼ŒJ.H.Morriså’ŒV.R.PrattåŒæ—¶å‘ç°ï¼Œå› æ­¤äººä»¬ç§°å®ƒä¸ºå…‹åŠªç‰¹--è«é‡Œæ–¯--æ™®æ‹‰ç‰¹æ“ä½œ(ç®€ç§°KMPç®—æ³•)ã€‚KMPç®—æ³•çš„å…³é”®æ˜¯åˆ©ç”¨åŒ¹é…å¤±è´¥åçš„ä¿¡æ¯ï¼Œå°½é‡å‡å°‘æ¨¡å¼ä¸²ä¸ä¸»ä¸²çš„åŒ¹é…æ¬¡æ•°ä»¥è¾¾åˆ°å¿«é€ŸåŒ¹é…çš„ç›®çš„ã€‚å…·ä½“å®ç°å°±æ˜¯å®ç°ä¸€ä¸ªnext()å‡½æ•°ï¼Œå‡½æ•°æœ¬èº«åŒ…å«äº†æ¨¡å¼ä¸²çš„å±€éƒ¨åŒ¹é…ä¿¡æ¯ã€‚æ—¶é—´å¤æ‚åº¦O(m+n)ã€‚\n å¼€å‘ç¯å¢ƒ   : sublime+MinGW \n\n- æš´åŠ›åŒ¹é…æ³•\n\n```c\n//æš´åŠ›åŒ¹é…   \nint BruteForce(String S, String T,int begin){ \n\tint i=begin,j=0;\n\twhile(i<S.length&&j<T.length){\n\t\tif(S.str[i]==T.str[j]){\n\t\t\tj++;\n\t\t\ti++;\n\t\t}else{\n\t\t\t//æ¯ä¸²çš„å½“å‰ä½ç½®+1å‘åç§»åŠ¨\n\t\t\ti=i-j+1;\n\t\t\t//å­ä¸²ä»0å¼€å§‹\n\t\t\tj=0;\n\t\t}\n\t}\n\tif (i<s(S.length-T.length))\n\t\treturn i-j-begin;\n\treturn -1;  //æ²¡æ‰¾åˆ°\n}\n```\næš´åŠ›åŒ¹é…æ¯”è¾ƒç®€å•ç²—æš´ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ªçš„æ¯”å¯¹å¦‚æœä¸å¯¹æ¯ä¸²å°±å›æº¯ç›´åˆ°é…æˆåŠŸã€‚\nè¿™ä¸ªç®—æ³•æ— ç–‘æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œæœ€ç³Ÿç³•æƒ…å†µä¸º O(m*n);è€Œè¿™ä¸ªç®—æ³•çš„ç¼ºé™·å°±åœ¨äºæ¯æ¬¡æ¯ä¸²çš„ä¸å¿…è¦çš„å›æº¯ï¼Œäºæ˜¯KMPç®—æ³•å‡ºç°äº†\n- KMPç®—æ³•\n\n```c\nvoid getNext(String S,int next[]){\n\t//è‡ªå·±å’Œè‡ªå·±åŒ¹é…å…¶å®å’Œkmpæ˜¯ä¸€ä¸ªé“ç†\n\tint i=1,j=0;\n\t//å’Œæ ‡å‡†çš„KMPä¸å°ä¸€æ ·,æ ‡å‡†çš„KMPæ˜¯ä»1å¼€å§‹çš„å…¶å®åŸç†ä¹Ÿä¸€æ ·ï¼Œè¿™æ ·æ›´ä¹ æƒ¯\n\tnext[0]=-1;\n\tnext[1]=0;\n\t//å¾ªç¯ n-2 æ¬¡\n\twhile(i<S.length-1){\n\t\tif(S.str[i]==S.str[j]){\n\t\t\t++j;\n\t\t\t++i;\n\t\t\tnext[i]=j;\n\t\t}else if(j==0){\n\t\t\t//å¦‚æœå’Œå‰ç¼€ç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸ç­‰ï¼Œiåç§»ä¸‹ä¸€ä¸ªä½ç½®çš„nextä¸º0\n\t\t\t++i;\n\t\t\tnext[i]=0;\n\t\t}else\n\t\t    //jå›é€€åˆ°ä¹‹å‰çš„ä½ç½®\n\t\t\tj=next[j];\n\t}\n} \n\n//è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®\nint KMP(String S,String T,int begin){\n\tint i=begin,j=0;\n\tint next[100];\n\tgetNext(T,next);\n\twhile(i<S.length&&j<T.length){\n\t\tif(S.str[i]==T.str[j]){\n\t\t\t++i;\n\t\t\t++j;\n\t\t}else if(j==0){\n\t\t\ti++;\n\t\t}\n\t\telse\n\t\t{\n\t\t j=next[j];\n\t\t}\n\t}\n\tif (i<s(S.length-T.length))\n\t\treturn i-j-begin;\n\treturn -1;   //æ²¡æ‰¾åˆ°\n}\n```\nè¿™ä¸ªç®—æ³•çš„åŸç†å…¶å®å¾ˆå¥½ç†è§£ ,æ¯ä¸²ä¸å›æº¯ï¼Œå¦‚æœä¸ç›¸ç­‰å­—ä¸²å°±ä¼šè·³åˆ°å¯¹åº”çš„ä½ç½®ç»§ç»­æ¯”å¯¹\n # a b a b c\n # a b c\næ¯”å¦‚ä¸Šé¢è¿™ç§ï¼Œcå’Œaä¸ç›¸ç­‰ ï¼Œå¦‚æœæ˜¯æš´åŠ›åŒ¹é…é‚£æ¯ä¸²å°±ä¼šå›æº¯åˆ°ç¬¬äºŒä¸ªå­—ç¬¦bçš„ä½ç½®ç»§ç»­æ¯”å¯¹ï¼Œä½†æ˜¯è¿™å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå­ä¸²çš„å­—ç¬¦éƒ½ä¸ç›¸ç­‰ï¼Œæ­£ç¡®çš„åšæ³•è‚¯å®šæ˜¯ç›´æ¥å°†å­—ä¸²å³æ»‘ï¼Œæˆ–è€…è¯´å°†å­ä¸²å›æº¯ï¼Œå›æº¯åˆ°açš„ä½ç½®ï¼Œç„¶åè®¡è¾ƒæ¯ä¸²çš„ç¬¬ä¸‰ä¸ªå­—ç¬¦å’Œå­ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦...... åˆ†æä¸€ä¸‹å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªç®—æ³•æœ€åæ—¶é—´å¤æ‚åº¦ä¸ºO(n+m)\né‚£ä¹ˆé—®é¢˜æ¥äº†å›æº¯çš„ä½ç½®å¦‚ä½•ç¡®å®šï¼Ÿè¿™ä¹Ÿæ˜¯è¿™ä¸ªç®—æ³•çš„å…³é”®ä¹‹å¤„ã€‚è¦å¾—åˆ°ä¸€ä¸ªå¯¹åº”æ¯ä¸ªä½ç½®çš„nextæ•°ç»„å‚¨å­˜å½“å¤±é…æ—¶å›æº¯çš„ä½ç½®ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¡®å®šåªå’Œå­ä¸²æœ¬èº«çš„ç»“æ„æœ‰å…³å…¶ä»£è¡¨çš„æ—¶æœ€é•¿çš„å…¬å…±å‰åç¼€çš„é•¿åº¦ï¼Œå…³äºnextæ•°ç»„çš„æ±‚æ³•å°±ä¸è¯´äº†ï¼Œäººçœ¼åŸºæœ¬ä¸Šä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ã€‚\n- nextæ•°ç»„ç¼–ç¨‹å®ç°\n\n```c\nvoid getNext(String S,int next[]){\n\t//è‡ªå·±å’Œè‡ªå·±åŒ¹é…å…¶å®å’Œkmpæ˜¯ä¸€ä¸ªé“ç†\n\tint i=1,j=0;\n\t//å’Œæ ‡å‡†çš„KMPä¸å°ä¸€æ ·,æ ‡å‡†çš„KMPæ˜¯ä»1å¼€å§‹çš„å…¶å®åŸç†ä¹Ÿä¸€æ ·ï¼Œè¿™æ ·æ›´ä¹ æƒ¯\n\tnext[0]=-1;\n\tnext[1]=0;\n\t//å¾ªç¯ n-2 æ¬¡\n\twhile(i<S.length-1){\n\t\tif(S.str[i]==S.str[j]){\n\t\t\t++j;\n\t\t\t++i;\n\t\t\tnext[i]=j;\n\t\t}else if(j==0){\n\t\t\t//å¦‚æœå’Œå‰ç¼€ç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸ç­‰ï¼Œiåç§»ä¸‹ä¸€ä¸ªä½ç½®çš„nextä¸º0\n\t\t\t++i;\n\t\t\tnext[i]=0;\n\t\t}else\n\t\t    //jå›é€€åˆ°ä¹‹å‰çš„ä½ç½®\n\t\t\tj=next[j];\n\t}\n} \n```\nä¸€å¼€å§‹çœ‹åˆ°è¿™ä¸ªæˆ‘æ˜¯æ¯”è¾ƒæ‡µçš„æ€ä¹ˆè¿™ä¹ˆçŸ­ï¼Ÿä»”ç»†çœ‹äº†ä¸‹è¿™å‡ è¡Œä»£ç å‰é¢çš„å…¶å®éƒ½è¿˜å¥½ç†è§£,ç›¸å½“äºè‡ªå·±å’Œè‡ªå·±åŒ¹é…\n# ï¼ï¼ï¼å…³é”®æ˜¯åé¢çš„ä¸ç›¸ç­‰çš„æƒ…å†µ\nè¿™é‡Œæˆ‘ä¹Ÿçº ç»“äº†å°åŠå¤©éšååœ¨ç½‘ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªå›¾è®²è§£è¿™ä¸ªçš„ç¬é—´å°±å¼€æœ—äº†è¿™é‡Œå°±ç›´æ¥æ¬è¿‡æ¥äº†ï¼ˆå¯¹[åŸæ–‡](https://blog.csdn.net/qq_30974369/article/details/74276186)åŠ äº†ä¸€ç‚¹è‡ªå·±çš„ç›´è§‚ç†è§£å¹¶å¦å¤–åŠ ä¸Šäº†å‚è€ƒã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹é‡Œé¢çš„å¯¹äºKMPç®—æ³•çš„ä¼˜åŒ–ï¼‰\n#  a b  a  c  f  g a  b a b h\n![image](https://p1.cdn.img9.top/ipfs/QmQLpe9fWukFT9is6XnAmmAyBdTCVYSeV6oj7mn5yGVsy8?1.png)\n# **a b  a**  c  f  g **a  b a** *b*  h\nçº¢è‰²çš„æ˜¯å½“å‰åŒ¹é…ä¸Šçš„æœ€é•¿çš„å‰åç¼€ï¼Œè“è‰²ä¸ºå½“å‰åŒ¹é…ä½ç½®ï¼Œä¹Ÿå°±æ˜¯*i* çš„ä½ç½® ä¸ä¸Šé¢å¯¹åº”çš„å°±æ˜¯b çš„ä½ç½®äº†\n![image2](https://p3.cdn.img9.top/ipfs/QmaFp1PaEY5Ednc4wUdLatsuJ7e4fibKv7jXwroGGb8rXN?3.png)\n# **a b  a**  *c*  f  g **a  b  a** *b*  h\nç»¿è‰²ä¸ºå½“å‰åŒ¹é…åˆ°çš„æœ€é•¿å‰ç¼€çš„åä¸€ä½ä¹Ÿå°±æ˜¯ *j*  çš„ä½ç½® å¯¹åº” c çš„ä½ç½®\næ˜¾ç„¶c bä¸ç›¸ç­‰  å¦‚æœä¸ç›¸ç­‰é‚£å°±ä¸èƒ½ç»§ç»­å¾€åæ‰¾äº† é‚£åƒ aba è¿™ä¹ˆé•¿çš„å…¬å…±å‰åç¼€å°±ç”¨ä¸äº†äº†ï¼Œä¹Ÿå°±æ˜¯ä½ çš„nextæ•°ç»„ä¼šå˜å°ï¼Œå‰åç¼€ç›¸ä¼¼åº¦ä¼šå‡å°ã€‚\n![image3](https://p1.cdn.img9.top/ipfs/QmURa6y33pwvpWjoBZ6eSiyZzraBd9QPWSBF13gq2xdPnT?1.png)\n![image4](https://p2.cdn.img9.top/ipfs/QmVfW9VQ2JYhNigxskotFVRtgAYcEhksBBEKzSztKn3p9b?2.png)\n# **a**  *b*  **a**  c  f  g  **a**  b  **a** b  h\nå¦‚å›¾å››å—ç°è‰²åŒºåŸŸå®Œå…¨ç›¸ç­‰ï¼Œå…³é”®æ­¥éª¤ j=next[j];ä¹‹å‰çš„jåœ¨ç»¿è‰²åŒºåŸŸ ç°åœ¨çš„ j å›æº¯åˆ°äº†ç´«è‰²åŒºåŸŸ ä¹Ÿå°±æ˜¯å¯¹åº”bçš„ä½ç½®\n![image5](https://p1.cdn.img9.top/ipfs/QmYo2cscPKdCL9tGGn2frfrn6p4WuGXuma6W6yQSEw4bdx?1.png)\nç›¸ä¿¡åˆ°è¿™é‡Œåº”è¯¥å°±çœ‹æ˜ç™½äº†,å››å—åŒºåŸŸç›¸ç­‰ï¼Œå¦‚æœè“è‰²éƒ¨åˆ†å’Œç´«è‰²ç›¸ç­‰æ˜¯ä¸æ˜¯å°±åˆæœ‰äº†å…¬å…±çš„å‰åç¼€äº†å‘¢ï¼Ÿé‚£å¦‚æœä¸åŒå°±ä¼šç»§ç»­é€’æ¨ã€‚\n- KMPä¼˜åŒ–\n  ä»€ä¹ˆï¼Ÿè¿™ä¹ˆåŠçš„ç®—æ³•è¿˜å¯ä»¥ä¼˜åŒ–ï¼Ÿçš„ç¡®ï¼ŒKMPè¿˜å¯ä»¥ä¼˜åŒ–ï¼Œè¿™é‡Œç›´æ¥æ‹¿ã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹é‡Œé¢çš„ä¾‹å­æ¥è¯´æ˜ (ps : è¿™é‡Œå¤§è¯æ•°æ®ç»“æ„å’ŒKMPåŸå§‹çš„æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯nextæ˜¯ä»1å¼€å§‹çš„ï¼Œæˆ‘æ˜¯ä»0å¼€å§‹çš„)     \n![image6](https://p0.cdn.img9.top/ipfs/QmSum26wHswwEgRmR79oM75o8afbAMCy2ZMQcremrXpfka?0.png)    \n  - nextä¼˜åŒ–\n\n```c\nvoid getNexval(String S,int next[]){\n\t//è‡ªå·±å’Œè‡ªå·±åŒ¹é…å…¶å®å’Œkmpæ˜¯ä¸€ä¸ªé“ç†\n\tint i=1,j=0;\n\t//å’Œæ ‡å‡†çš„KMPä¸å°ä¸€æ ·,æ ‡å‡†çš„KMPæ˜¯ä»1å¼€å§‹çš„å…¶å®åŸç†ä¹Ÿä¸€æ ·ï¼Œè¿™æ ·æ›´ä¹ æƒ¯\n\tnext[0]=-1;\n\tnext[1]=0;\n\t//å¾ªç¯n-2æ¬¡\n\twhile(i<S.length-1){\n\t\tif(S.str[i]==S.str[j]){\n\t\t\t++j;\n\t\t\t++i;\n\t\t\t//ä¸‹ä¸€å¯¹å¯¹åº”çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯æ­£åœ¨æ±‚nextå€¼çš„ä½ç½®ï¼‰\n\t\t\tif(S.str[j]==S.str[i]){\n\t\t\t\t//è¿™ä¸€æ­¥å®é™…ä¸Šæ˜¯è·³è¿‡äº†é‡å¤çš„éƒ¨åˆ† å¦‚æœå’Œè¿™ä¸ªä½ç½®çš„nextå€¼çš„å­—ç¬¦ç›¸åŒå°±å¯ä»¥å°†è¿™ä¸ªä½ç½®çš„nextå­—ç¬¦è®¾ç½®ä¸ºnextä½ç½®å­—ç¬¦çš„nextå€¼\n\t\t\t\tnext[i]=next[j];\n\t\t\t}else\n\t\t\tnext[i]=j;\n\t\t}else if(j==0){\n\t\t\t//å¦‚æœå’Œå‰ç¼€ç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸ç­‰ï¼Œiåç§»ä¸‹ä¸€ä¸ªä½ç½®çš„nextä¸º0\n\t\t\t++i;\n\t\t\tnext[i]=0;\n\t\t}else\n\t\t    //jå›é€€åˆ°ä¹‹å‰çš„ä½ç½®\n\t\t\tj=next[j];\n\t}\n} \n```\nå…¶å®ä¼˜åŒ–çš„ç†ç”±å°±æ˜¯åœ¨è¿›è¡Œå’Œå­ä¸²åŒ¹é…çš„æ—¶å€™å¦‚æœå¤±é…ï¼Œåœ¨å­ä¸²å›æº¯æ—¶å›æº¯åˆ°çš„é‚£ä¸ªå€¼å’Œå½“å‰çš„å€¼ç›¸åŒé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥å›æº¯åˆ° é‚£ä¸ªå›æº¯å€¼çš„å›æº¯å€¼ï¼Œå¯èƒ½æœ‰ç‚¹ç»•ä½†æ˜¯ä»”ç»†æƒ³æƒ³å°±æ˜ç™½äº†ã€‚\n # **a b a b a a a b a**\nè¿™ä¸ªå­—ç¬¦ä¸²çš„nextåº”è¯¥æ˜¯ next=[-1,0,0,1,2,3,1,1,2] \nnextval=[-1,0,0,0,0,3,1,0,0] ï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œé‚£å°±æ˜¯å‰ä¸¤ä½æ˜¯ä¸ç”¨è€ƒè™‘çš„ï¼Œæ°¸è¿œæ˜¯-1 0ï¼Œæ‰€ä»¥å¦‚æœæŒ‰ç…§ä¸Šé¢çš„è¯´æ³•å¯èƒ½ä¼šè®¤ä¸ºç¬¬ä¸‰ä¸ªæ˜¯-1ï¼Œå…¶å®ä¸æ˜¯çš„å…·ä½“çš„å¯ä»¥çœ‹ä»£ç ï¼Œå¦‚æœæ—¶å®˜æ–¹çš„é‚£ç§ä»1å¼€å§‹å°±æ²¡æœ‰è¿™ç§é¡¾è™‘ï¼‰ã€‚\næ‹¿è¿™ä¸ªå®é™…çš„æ¥è¯´ ,  **a b a b a a a b a**å½“æ¯”å¯¹åˆ°è¯¥å­ä¸²æœ€åä¸€ä¸ªaæ—¶ ä¸ç›¸ç­‰ ï¼ŒæŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•å›æº¯ï¼Œå›æº¯åˆ°index=2çš„aä½ç½®ï¼Œå‘ç°è¿™è´§ä¹Ÿæ˜¯aé‚£è‚¯å®šä¹Ÿä¸ç›¸ç­‰ï¼Œç„¶ååˆå›æº¯å›æº¯åˆ°ç¬¬ä¸€ä¸ªaï¼Œè¿™ä¸­é—´ä¸å°±å¤šå›æº¯äº†ä¸€æ¬¡ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¸ä¸€æ¬¡åˆ°ä½å‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åˆ¤æ–­å°†è¦å›æº¯çš„å€¼å’Œå½“å‰å€¼æ˜¯ä¸æ˜¯ç›¸ç­‰ï¼Œç›¸ç­‰å°±æŠŠå°†è¦å›æº¯çš„å€¼çš„å›æº¯å€¼èµ‹ç»™å½“å‰å€¼ã€‚\n\n\n\n","tags":["æ•°æ®ç»“æ„","ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"åŒå‘å¾ªç¯é“¾è¡¨","url":"/2018/08/18/shuang-xiang-xun-huan-lian-biao-c-shi-xian/","content":"## Cå®ç°çš„åŒå‘å¾ªç¯é“¾è¡¨\nå¾ˆä¹…æ²¡æœ‰ç”¨Cäº†ï¼Œéƒ½å¿˜äº†ï¼Œæ˜¨å¤©ä¸‹åˆåˆå¤ä¹ äº†ä¸€ä¸‹ç„¶åå®ç°äº†è¿™ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ï¼Œåé¢æ¯ç§æ•°æ®ç»“æ„éƒ½ä¼šåœ¨è¿™é‡Œå®ç°è®°å½•ä¸‹æ¥ã€‚\nå¼€å‘ç¯å¢ƒ   : sublime+MinGW \n```java\n#include <stdio.h>\n#include <stdlib.h>\n//å®šä¹‰ç»“æ„ä½“\ntypedef struct Node\n{\n\tint data;\n\tstruct Node *perv;\n\tstruct Node *next;\n}Node;\n\nint length;\n\n//åˆå§‹åŒ–èŠ‚ç‚¹\nNode* createNode(){\n\tNode * node;\n\t//å¼€è¾Ÿç©ºé—´\n\tnode =(Node*)malloc(sizeof(Node));\n\tif(node==NULL){\n\t\tprintf(\"åŠ¨æ€å¼€è¾Ÿç©ºé—´å¤±è´¥\");\n\t}\n\tscanf(\"%d\",&(node->data));\n\tnode->perv=NULL;\n\tnode->next=NULL;\n\treturn node;\n}\n\n//åˆå§‹åŒ–é“¾è¡¨ \nNode* createList(int n)\n{\n    Node *tail,*p,*head;\n    //åˆå§‹åŒ–å¤´ç»“ç‚¹ (è¿™ä¸ªèŠ‚ç‚¹åªæ˜¯ä¸ªæ ‡å¿—ï¼Œæ ‡å¿—é“¾è¡¨çš„å¤´å¹¶ä¸å­˜å‚¨æ•°æ®,åªæ˜¯ä¸ºäº†æ“ä½œçš„ç»Ÿä¸€æ€§)\n    head=(Node*)malloc(sizeof(Node));\n    int i;\n    if(n >= 1)   //ç»“ç‚¹çš„ä¸ªæ•° >= 1 çš„æ—¶å€™\n    {\n        p = createNode();\n        head->next = p;\n        p->perv=head;\n        tail = p;\n    }\n    for(i = 2;i <= n;i++)    //ç”Ÿæˆç¬¬ä¸€ä¸ªç»“ç‚¹ä»¥åçš„ç»“ç‚¹ï¼Œå¹¶å»ºç«‹åŒå‘é“¾è¡¨çš„å…³ç³» \n    {\n        p = createNode();\n        tail->next = p;\n        p->perv = tail;\n        //å°¾æŒ‡é’ˆåç§»\n        tail = p;\n    }\n    //è¿æ¥å¤´å°¾\n    head->perv=tail;\n    tail->next=head;\n    //é“¾è¡¨çš„é•¿åº¦\n    length = n;\n    if(n >= 1)\n        return (head);\n    else\n        return 0;    \n} \n\n\n//åœ¨å¤´å°¾æ’å…¥èŠ‚ç‚¹   ï¼ˆå®é™…ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¸‹é¢çš„insAnywhereå®Œæˆï¼Œä¸»è¦ä¸ºäº†æ•ˆç‡,å¦‚æœæ˜¯å°¾ç»“ç‚¹æ’å…¥getEle()æ—¶é—´å¤æ‚åº¦è¿‡é«˜ï¼‰\n//insAnywhere(head,0);\nvoid insHead(Node* head){\n\tNode *p=createNode();\n\tNode *q;\n\t//ä¿å­˜ç¬¬ä¸€ä¸ªèŠ‚ç‚¹\n\tq=head->next;\n\t//è¿æ¥å¤´ç»“ç‚¹\n\thead->next=p;\n\tp->perv=head;\n\t//è¿æ¥ä¹‹å‰çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹\n\tp->next=q;\n\tq->perv=p;\n\t++length;\n}\n\n//insAnywhere(head,length);\nvoid insTail(Node* head){\n\tNode *p=createNode();\n\t//å…ˆä¿å­˜ä¸‹ä¹‹å‰çš„å°¾æŒ‡é’ˆ\n\tNode *tail=head->perv;\n\t//è¿æ¥å¤´å°¾\n\thead->perv=p;\n\tp->next=head;\n\t//è¿æ¥ä¹‹å‰çš„å°¾æŒ‡é’ˆ\n\ttail->next=p;\n\tp->perv=tail;\n\t++length;\n}\n\n//å–å¾—æŸä¸€ä½ç½®çš„èŠ‚ç‚¹  æ—¶é—´å¤æ‚åº¦ä¸º O(n)\nNode * getEle(Node* head,int n){\n\t//å°†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹èµ‹å€¼ç»™p\n\tNode *p=head;\n\tfor (int i = 0; i < n; ++i)\n\t{\n\t\tp=p->next;\n\t}\n\treturn p;\n}\n\n//è·å–é“¾è¡¨çš„é•¿åº¦\nint getLength(){\n\treturn length;\n}\n\n//ä»»æ„ä½ç½®æ’å…¥ï¼Œå› ä¸ºè®¾ç½®äº†å¤´èŠ‚ç‚¹æ‰€ä»¥æ’å…¥çš„æ“ä½œå…·æœ‰ä¸€è‡´æ€§\nvoid insAnywhere(Node *head,int n){\n\tNode *newNode=createNode();\n\t//å–å¾—å¯¹åº”ä½ç½®çš„å€¼\n\tNode *currentNode=getEle(head,n);\n\t//ä¿å­˜å½“å‰ä½ç½®çš„ä¸‹ä¸€ä¸ª\n\tNode *nextNode;\n\t//ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n\tnextNode=currentNode->next;\n\t//è¿æ¥å½“å‰ç»“ç‚¹\n\tcurrentNode->next=newNode;\n\tnewNode->perv=currentNode;\n\t//è¿æ¥ä¹‹å‰çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n\tnewNode->next=nextNode;\n\tnextNode->perv=newNode;\n\t++length;\n}\n\n//ä»»æ„ä½ç½®çš„åˆ é™¤\nvoid delNode(Node *head,int n){\n\tNode *delNode=getEle(head,n);\n\t/*printf(\"%d\\n\", delNode->data);\n\tprintf(\"--------------\\n\");*/\n\t//å…ˆä¿å­˜å½“å‰èŠ‚ç‚¹çš„åä¸€èŠ‚ç‚¹\n\tNode *nextNode=delNode->next;\n\t//å°†åä¸€ä¸ªèŠ‚ç‚¹æ¥åœ¨å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªçš„åé¢\n\tdelNode->perv->next=nextNode;\n\tnextNode->perv=delNode->perv;\n\t//freeè¿™ä¸ªèŠ‚ç‚¹\n\tfree(delNode);\n}\n\n//éå†é“¾è¡¨\nvoid printlnAll(Node *head){\n\tNode *p=head->next;\n   do{\n   \t  printf(\"%d\\n\", p->data);\n   \t  p=p->next;\n   }while(p!=head);\n\t// while(p->next!=head){\n\t// \tprintf(\"%d\\n\", p->data);\n\t// \t//æŒ‡é’ˆåç§»\n\t// \tp=p->next;\n\t// }\n}\n\n\nint main(int argc, char const *argv[])\n{\n\n\tNode* createList(int n);\n\tNode* createNode();\n\n\tNode *head=createList(3);\n\tprintf(\"éå†é“¾è¡¨\\n\");\n\tprintlnAll(head);\n\t\n\tinsHead(head);\n\t//insAnywhere(head,0);\n\tprintf(\"åœ¨å¤´æ’å…¥èŠ‚ç‚¹å\\n\");\n\tprintlnAll(head);\n\n\tinsTail(head);    //ä¸‹é¢çš„ä¹Ÿå¯ä»¥ä½†æ˜¯æ•ˆç‡æ¯”è¾ƒä½\n\t//insAnywhere(head,getLength());\n\tprintf(\"åœ¨å°¾æ’å…¥èŠ‚ç‚¹å\\n\");\n\tprintlnAll(head);\n\n\t//åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ åé¢æ’å…¥å…ƒç´ \n\tprintf(\"---------åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ åé¢æ’å…¥å…ƒç´ -----\\n\");\n\tinsAnywhere(head,1);\n\tprintlnAll(head);\n\n\t//åˆ é™¤æœ€åé¢çš„èŠ‚ç‚¹\n\tprintf(\"---------åˆ é™¤æœ€åé¢çš„èŠ‚ç‚¹-------\\n\");\n\tdelNode(head,6);\n\tprintlnAll(head);\n\n\t//åˆ é™¤ç¬¬ä¸€ä¸ªåé¢çš„èŠ‚ç‚¹\n\tprintf(\"-------åˆ é™¤ç¬¬ä¸€ä¸ªåé¢çš„èŠ‚ç‚¹---------\\n\");\n\tdelNode(head,2);\n\t//printf(\"%d\\n\", head->next->data);\n\tprintlnAll(head);\n\treturn 0;\n}\n```\n- çº¿æ€§è¡¨\n![image](http://p0.cdn.img9.top/ipfs/QmUS62kkfTx4trGRmMukDCFuJNxrKDR2P2DdoERRqf1pcr?0.png)\nè¿™é‡Œé¢çš„é“¾å¼å­˜å‚¨ç»“æ„é‡Œé¢çš„ *é™æ€é“¾è¡¨* æŒºæœ‰æ„æ€çš„ï¼Œä¸ç”¨æŒ‡é’ˆå®ç°é“¾å¼ç»“æ„ã€‚\nçº¿æ€§è¡¨çš„è¿™ä¸¤ç§ç»“æ„å®é™…ä¸Šæ˜¯åé¢å…¶ä»–æ•°æ®ç»“æ„çš„åŸºç¡€ï¼Œé¡ºåºå‚¨å­˜ç»“æ„å’Œé“¾å¼å‚¨å­˜ç»“æ„ä¹Ÿå„æœ‰ä¼˜åŠ£ã€‚\n![image](http://p1.cdn.img9.top/ipfs/QmUWbnXLv86uwuCrWkp2ft6fax7TgZ1kryaCPKrWTGidsy?1.PNG)\n\næ³¨ï¼šä»£ç ä¸­çš„Stringæ˜¯æˆ‘è‡ªå®šä¹‰çš„ã€‚\n\n```java\ntypedef struct{\n\t//é•¿åº¦\n\tint length;\n\t//å†…å®¹\n\tchar *str;\n\t//æœ€å¤§å€¼\n\tint maxLength;\n}String;\n\nvoid init(String *s,int max,char * string){\n\tint i;\n\ts->maxLength=max;\n\ts->length=strlen(string);\n\t//å¼€è¾Ÿç©ºé—´\n\ts->str=(char*)malloc(sizeof(char)*max);\n\t//èµ‹å€¼\n\tfor(i=0;i<s->length;i++){\n\t\ts->str[i]=string[i];\n\t}\n}\n\n```\n\n","tags":["æ•°æ®ç»“æ„","ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"Hexoæ·»åŠ å…¶ä»–çš„è¯„è®ºç³»ç»Ÿ","url":"/2018/07/01/hexo-tian-jia-ping-lun-xi-tong/","content":"\n## æœ€è¿‘æ¢äº†ä¸€ä¸ªHexoçš„ä¸»é¢˜ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„è¿™æ¬¾ï¼Œä½†æ˜¯æ”¯æŒçš„è¯„è®ºç³»ç»Ÿä¸¤ä¸ªå·²ç»å…³äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªä¼šè¢«å¢™ã€‚æ‰€ä»¥å°±è‡ªå·±æ¥åŠ äº†ä¸€ä¸ª\n\n### é¦–å…ˆæ³¨å†Œå¹¶ç™»å½•LiveRe\nç™»é™†æ³¨å†Œè¿‡ç¨‹å°±ä¸å¤šè¯´äº†\n   é€‰æ‹©cityç‰ˆçš„å®‰è£…ï¼Œä¼šå¾—åˆ°ä¸€æ®µä»£ç  \n### åœ¨ä¸ªäººåšå®¢ä¸­åŠ å…¥LiveReä»£ç \n\né¦–å…ˆå»å¦‚è·¯å¾„ï¼šhexo_bolg/themes/your-theme/layout/_partial/postä¸‹åˆ›å»ºlivere.ejsä»£ç ã€‚livere.ejsçš„å†…å®¹å°±æ˜¯ä¸Šä¸€æ­¥ä¸­è·å–çš„ä»£ç ï¼š\n\n```\n<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->\n<div id=\"lv-container\" data-id=\"city\" data-uid=\"MTAyMC8zMzM5MC85OTQ2\">\n    <script type=\"text/javascript\">\n   (function(d, s) {\n       var j, e = d.getElementsByTagName(s)[0];\n\n       if (typeof LivereTower === 'function') { return; }\n\n       j = d.createElement(s);\n       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';\n       j.async = true;\n\n       e.parentNode.insertBefore(j, e);\n   })(document, 'script');\n    </script>\n<noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>\n</div>\n<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->\n```\n\nç„¶åä¿®æ”¹è·¯å¾„ï¼šhexo_bolg/themes/your-theme/layout/_partialä¸‹çš„article.ejsæ–‡ä»¶ï¼Œåœ¨`<% if (!index && post.comments){ %>` ä»£ç å—ä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n\n```\n<% if (!index){ %>\n  <% if (post.comments){ %>\n  <%- partial('post/livere') %>\n  <% } else { %>\n    <div class=\"lv-container\"></div>\n  <% } %>\n<% } %>\n```\n![](http://p0.cdn.img9.top/ipfs/QmWwSjQj5zqz5mAgEtYjgTBRXRqBapvZMaEzArt8xRqQm2?0.jpg)\n\n~~æ­¤æ—¶LiveReå·²ç»æ·»åŠ OKäº†ï¼Œé‡æ–°éƒ¨ç½²ä½ çš„åšå®¢ç„¶ååˆ·æ–°é¡µé¢å°±å¯ä»¥çœ‹åˆ°åšå®¢ä¸­æ·»åŠ å¥½äº†LiveReè¯„è®º~~\næ¢äº† Valine\n\n\n","tags":["Hexo"],"categories":["Hexo"]},{"title":"Nmapå­¦ä¹ ","url":"/2018/06/17/nmap-xue-xi/","content":"\n## Nmapç®€ä»‹\n   Nmapæ˜¯ä¸€ä¸ªå¼€æºå…è´¹çš„ç½‘ç»œå‘ç°å’Œå®‰å…¨å®¡è®¡å·¥å…· ï¼Œ å…¨ç§°æ˜¯NetWork  Mapper , é‡‡ç”¨c++è¯­è¨€ç¼–å†™ã€‚çº¯å‘½ä»¤è¡Œç•Œé¢ï¼ŒNmapå®˜æ–¹æä¾›äº†ä¸€ä¸ªZenmapçš„å›¾å½¢ç•Œé¢ã€‚\n\n- å…³äºç«¯å£\n\tÂ·\té»˜è®¤æƒ…å†µä¸‹ï¼ŒNampä¼šæ‰«æ1000ä¸ªæœ€æœ‰å¯èƒ½å¼€æ”¾çš„TCPç«¯å£\nÂ·   openï¼šå¼€æ”¾\nÂ·   closedï¼šå…³é—­\nÂ·   filteredï¼šè¢«å±è”½\nÂ·   unfilteredï¼šæ²¡æœ‰å±è”½è¿˜éœ€è¦ç¡®è®¤\nÂ·   open | filtered : å¼€æ”¾æˆ–è€…å±è”½\nÂ·   close | filtered : å…³é—­æˆ–å±è”½\n# ä½¿ç”¨\n - ä¸»æœºæ‰«æ\n 1. nmap  192.168.1.100 ç›´æ¥æ‰«æï¼Œä¼šæ‰«æå¸¸ç”¨å‰1000ä¸ªç«¯å£ æ‰«ææˆ‘çš„å®¿ä¸»æœº\n2. nmap -F 192.168.1.100  å¿«é€Ÿæ‰«æï¼Œä¼šæ‰«æå¸¸ç”¨çš„å‰100ä¸ªç«¯å£\n3. -v  æ˜¾ç¤ºæ‰«æè¿‡ç¨‹\nroot@kali:~# nmap -v -F  192.168.1.100\nStarting Nmap 7.70 ( https://nmap.org ) at 2018-06-17 00:55 EDT\nInitiating Ping Scan at 00:55\nScanning 192.168.1.100 [4 ports]\nCompleted Ping Scan at 00:55, 0.05s elapsed (1 total hosts)\nInitiating Parallel DNS resolution of 1 host. at 00:55\nCompleted Parallel DNS resolution of 1 host. at 00:55, 0.01s elapsed\nInitiating SYN Stealth Scan at 00:55\nScanning 192.168.1.100 [100 ports]\nDiscovered open port 135/tcp on 192.168.1.100\nDiscovered open port 139/tcp on 192.168.1.100\nDiscovered open port 445/tcp on 192.168.1.100\nDiscovered open port 3306/tcp on 192.168.1.100\nDiscovered open port 443/tcp on 192.168.1.100\nIncreasing send delay for 192.168.1.100 from 0 to 5 due to 43 out of 142 dropped probes since last increase.\nCompleted SYN Stealth Scan at 00:55, 7.68s elapsed (100 total ports)\nNmap scan report for 192.168.1.100\nHost is up (1.8s latency).\nNot shown: 94 closed ports\nPORT     STATE    SERVICE\n135/tcp  open     msrpc\n139/tcp  open     netbios-ssn\n443/tcp  open     https\n445/tcp  open     microsoft-ds\n514/tcp  filtered shell\n3306/tcp open     mysql\nRead data files from: /usr/bin/../share/nmap\nNmap done: 1 IP address (1 host up) scanned in 7.88 seconds\nRaw packets sent: 166 (7.280KB) | Rcvd: 163 (6.688KB)\n4. -sV  è¿”å›ç«¯å£å¯¹åº”çš„æœåŠ¡ä¿¡æ¯ï¼ˆå¥½æ…¢ï¼‰\n5. -O  è¿”å›å¯¹åº”æœåŠ¡çš„ç³»ç»Ÿä¿¡æ¯\n- ä¸»æœºå‘ç°\n\tæˆ‘ä»¬å¯ä»¥é€šè¿‡nampæ¥å—…æ¢æ•´ä¸ªå±€åŸŸç½‘ï¼Œæ‰«æå‡ºå±€åŸŸç½‘ä¸­åœ¨çº¿çš„ä¸»æœºï¼Œé€šè¿‡ICMP ECHOæ‰«æå‡ºåœ¨çº¿çš„ä¸»æœº ï¼ˆpingçš„åº•å±‚åŸç†ï¼‰ \n  1. nmap -sS 192.168.1.100 éšè”½æ‰«æ -sS ï¼Œä¹Ÿå°±æ˜¯SYNæ‰«æï¼Œåªç®¡å‘é€æ•°æ®åŒ…\n  2. æŸ¥çœ‹å­˜æ´»ä¸»æœº\nnmap -sP 192.168.239.* æˆ–è€… 192.168.239.0/24\n  3. æ‰«æä¸»æœºçš„æ‰€æœ‰ç«¯å£\nnmap -p 1-65535 192.168.239.133\n  4. æ‰«æä¸»æœºçš„æ“ä½œç³»ç»Ÿ\nnmap -O 192.168.239.133\n  5. æŸ¥çœ‹ä¸»æœºä¸ªæœåŠ¡çš„ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯\nnmap -sV 192.168.239.133\n- å¸¸è§çš„Nmapæ‰«æç±»å‹å‚æ•°\n -sT :TCP connectæ‰«æ ï¼Œç±»ä¼¼Metasploitä¸­çš„tcpæ‰«æ\n -sS : TCP SYNæ‰«æï¼Œç±»ä¼¼äºMetasploit ä¸­çš„synæ‰«ææ¨¡å—\n -sF/-sX/-sN : è¿™äº›æ‰«æé€šè¿‡å‘é€ä¸€äº›ç‰¹æ®Šçš„æ ‡å¿—ä½ä»¥é¿å¼€è®¾å¤‡æˆ–è½¯ä»¶çš„ç›‘æµ‹\n -sP :é€šè¿‡å‘é€ICMP echo è¯·æ±‚æ¢æµ‹ä¸»æœºæ˜¯å¦å­˜è´§åŸç†åŒPing.\n -sU :æ¢æµ‹ä¸»æœºå¼€æ”¾äº†é‚£äº›UDPç«¯å£ã€‚\n -sA : TCP ACK æ‰«æï¼Œç±»ä¼¼ä¸Metasploité‡Œçš„ackæ‰«ææ¨¡å—\n - å¸¸è§çš„Nmapæ‰«æé€‰é¡¹\n-Pn : åœ¨æ‰«æä¹‹å‰ä¸å‘é€ICMP echoè¯·æ±‚æµ‹è¯•ç›®æ ‡æ˜¯å¦æ´»è·ƒ\n-O ï¼šå¯ç”¨å¯¹äºTCP/IP åè®®æ ˆçš„ç‰¹å¾æ‰«æä»¥è·å–è¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿ\n-F ï¼šå¿«é€Ÿæ‰«æ\n-p ï¼šç«¯å£èŒƒå›´\n\n","tags":["Kali","Nmap"],"categories":["æ¸—é€"]},{"title":"Redisé›†ç¾¤æ­å»º","url":"/2018/05/27/redis-ji-qun-da-jian/","content":"# Redisé›†ç¾¤æ­å»º\n# ä¸€ã€Redisç®€ä»‹\n\n### 1ï¼å…³äºå…³ç³»å‹æ•°æ®åº“å’Œnosqlæ•°æ®åº“\n   å…³ç³»å‹æ•°æ®åº“æ˜¯åŸºäºå…³ç³»è¡¨çš„æ•°æ®åº“ï¼Œæœ€ç»ˆä¼šå°†æ•°æ®æŒä¹…åŒ–åˆ°[ç£ç›˜]()ä¸Šï¼Œè€Œnosqlæ•°æ®  åº“æ˜¯åŸºäºç‰¹æ®Šçš„ç»“æ„ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åˆ°[å†…å­˜]()çš„æ•°æ®åº“ã€‚ä»æ€§èƒ½ä¸Šè€Œè¨€ï¼Œnosqlæ•°æ®åº“  è¦ä¼˜äºå…³ç³»å‹æ•°æ®åº“ï¼Œä»å®‰å…¨æ€§ä¸Šè€Œè¨€å…³ç³»å‹æ•°æ®åº“è¦ä¼˜äºnosqlæ•°æ®åº“ï¼Œæ‰€ä»¥åœ¨å®  é™…å¼€å‘ä¸­ä¸€ä¸ªé¡¹ç›®ä¸­nosqlå’Œå…³ç³»å‹æ•°æ®åº“ä¼šä¸€èµ·ä½¿ç”¨ï¼Œè¾¾åˆ°æ€§èƒ½å’Œå®‰å…¨æ€§çš„åŒä¿è¯\n### 2 . Redisçš„å®‰è£…\nè¿™é‡Œå…³äºRedisçš„å®‰è£…ä¸æƒ³å¤šè¯´ï¼Œå®é™…ç”Ÿäº§ä¸­éƒ½æ˜¯å°†Reidså®‰è£…åœ¨Linuxä¸Šçš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯è¯´é›†ç¾¤çš„æ­å»ºã€‚\n### 3. Redisçš„ä½¿ç”¨\n   æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦Redisï¼Œä½¿ç”¨å…¶å®ä¹Ÿæ²¡ä»€ä¹ˆè¯´çš„ [èœé¸Ÿæ•™ç¨‹](http://www.runoob.com/redis/redis-tutorial.html)ä¸Šéƒ½æœ‰ï¼ŒæŒºç®€å•çš„ã€‚\n### 3. é›†ç¾¤çš„æ­å»º\nRedisè¦åšé›†ç¾¤å¿…é¡»è¦æœ‰è‡³å°‘ä¸‰ä¸ªèŠ‚ç‚¹å¦åˆ™ä»–çš„æŠ•ç¥¨æœºåˆ¶æ— æ³•è¿è¡Œ\nå¿…é¡»è¦æœ‰è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½è®¤ä¸ºæŸä¸€å°Redisæœºå™¨æŒ‚æ‰äº†æ‰ä¼šè®¤ä¸ºé›†ç¾¤æŒ‚æ‰äº†\n![Redis](http://p3.cdn.img9.top/ipfs/QmX5E7BViadysS6bZLs7Eeu1VSkvCHEEcUrkSVgWBjwNCx?3.png)\n\nè¿™é‡Œå†çœ‹çœ‹Redisé›†ç¾¤çš„æ¶æ„å›¾![Redis](http://p3.cdn.img9.top/ipfs/QmZ6PpYPozPHppvXGRBMY5LgnrsjAqDaT2s1NoUCT8EFuD?3.png)\næ¶æ„ç»†èŠ‚:\n\n(1)æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½.\n\n(2)èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆ.\n\n(3)å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´proxyå±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯\n\n(4)redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Š,cluster è´Ÿè´£ç»´æŠ¤node<->slot<->value\nRedis é›†ç¾¤ä¸­å†…ç½®äº† 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œredis å…ˆå¯¹ key ä½¿ç”¨ crc16 ç®—æ³•ç®—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œredis ä¼šæ ¹æ®èŠ‚ç‚¹æ•°é‡å¤§è‡´å‡ç­‰çš„å°†å“ˆå¸Œæ§½æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥RedisèŠ‚ç‚¹æœ€å¤šä¹Ÿå°±16384ä¸ªèŠ‚ç‚¹æœ€å°‘3ä¸ªèŠ‚ç‚¹ã€‚\n- å¼€å§‹æ­å»º\n è¿™é‡Œæ­å»ºçš„æ˜¯æœ‰3ä¸ªèŠ‚ç‚¹çš„æœ€å°çš„é›†ç¾¤ä¸ºä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€å°å¤‡ä»½æœºä¸€å…±éœ€è¦6å°æœåŠ¡å™¨ï¼Œå°±éœ€è¦å¼€6ä¸ªè™šæ‹Ÿæœºè¿™é‡Œå…¶å®åšæµ‹è¯•æ²¡é‚£ä¸ªå¿…è¦ï¼Œæ­å»ºä¸€ä¸ªä¼ªåˆ†å¸ƒå¼çš„å°±å¯ä»¥äº†ï¼Œåœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šæ­å»º6ä¸ªRediså®ä¾‹\n- é›†ç¾¤æ­å»ºç¯å¢ƒ\n1ã€ä½¿ç”¨rubyè„šæœ¬æ­å»ºé›†ç¾¤ã€‚éœ€è¦rubyçš„è¿è¡Œç¯å¢ƒã€‚\nå®‰è£…ruby\nyum install ruby\nyum install rubygems\n(æˆ‘è™šæ‹Ÿæœºyumçš„æ—¶å€™ä¸€ç›´æŠ¥é”™æ— æ³•è§£æï¼Œç„¶ååŠ äº†DNSåæŠ¥404å¾ˆå¥‡æ€ª ç„¶åyum makecacheåå°±å¥½äº†)\n2ã€å®‰è£…rubyè„šæœ¬è¿è¡Œä½¿ç”¨çš„åŒ…[redis-3.0.0.gem](https://pan.baidu.com/s/1bW6EUyeEevR5h1cT-g51mQ)ã€‚\n gem install redis-3.0.0.gem\nè¿™ä¸ªè„šæœ¬åœ¨ä½ Redisæºä»£ç çš„srcç›®å½•ä¸‹redis-trib.rbè¿™ä¸ªè„šæœ¬\n 3ã€åˆ›å»º6ä¸ªRediså®ä¾‹\nç›´æ¥copy5ä»½ç¼–è¯‘åçš„Redisæ–‡ä»¶ç„¶åæ”¹ä¸‹ç«¯å£ æŠŠredis.conf(åœ¨Redisæºä»£ç ä¸‹copyè¿‡æ¥)é‡Œ cluster-enabled yeså‰æ³¨é‡Šå»æ‰\n 3 ã€å¯åŠ¨6ä¸ªRedisè¿™é‡Œå¯ä»¥å†™ä¸€ä¸ªshell\n```java\ncd redis01\n./redis-server redis.conf\ncd ..\ncd redis02\n./redis-server redis.conf\ncd ..\ncd redis03\n./redis-server redis.conf\ncd ..\ncd redis04\n./redis-server redis.conf\ncd ..\ncd redis05\n./redis-server redis.conf\ncd ..\ncd redis06\n./redis-server redis.conf\ncd ..\n```\n4ã€ç”¨Rubyæ­å»ºé›†ç¾¤ åªéœ€è¦è¿™æ¡å‘½ä»¤é›†ç¾¤å°±æ­å»ºå®Œæ¯•äº†\n./redis-trib.rb create --replicas 1 192.168.25.3:7001 192.168.25.3:7002 192.168.25.3:7003 192.168.25.3:7004 192.168.25.3:7005 192.168.25.3:7006\nè¡¥ ï¼šè¿™é‡Œçš„ipä¸è¦å†™127.0.0.1 ä¸ç„¶è¿æ¥é›†ç¾¤çš„æ—¶å€™å°±ä¼šæŠ¥Too many Cluster redirections?é”™è¯¯ äº²æµ‹ã€‚ã€‚ã€‚æˆ‘ä¸æ˜¯å†™çš„127.0.0.1æˆ‘æ˜¯å› ä¸ºåæ¥è™šæ‹Ÿæœºipå˜äº†ç„¶å\nreplicasåé¢å‚æ•°1ä»£è¡¨æ¯ä¸ªèŠ‚ç‚¹ä¼šæœ‰ä¸€å°å¤‡ä»½æœºæ‰€ä»¥åé¢çš„ipå’Œç«¯å£å·å¿…é¡»æ˜¯å¶æ•°\n### 4. é›†ç¾¤çš„ä½¿ç”¨\n    redis01/redis-cli -p 7002 -c \nåé¢çš„cä»£è¡¨è¿æ¥çš„æ˜¯é›†ç¾¤ å¦‚æœä¸åŠ cå°±æ˜¯å•æœºçš„ å¦‚æœå­˜å…¥æ•°æ®çš„æ§½ä½ä¸å¯¹åº”å°±ä¼šæŠ¥é”™å½“ç„¶è¿™æ˜¯åœ¨å‘½ä»¤è¡Œä¸‹çš„ä½¿ç”¨ï¼Œwindowsä¸‹ä¹Ÿæœ‰ä¸€äº›Redisçš„å®¢æˆ·ç«¯ã€‚è¿™é‡Œä¸»è¦è®²ç”¨Javaä»£ç è¿æ¥Redisè¿™å°±è¦ç”¨åˆ°Jedisäº†è·ŸJDBCé‚£ä¸€å¥—å·®ä¸å¤š è¿™é‡Œç›´æ¥è®²åœ¨æ·˜æ·˜ä¸­å®é™…æ˜¯æ€ä¹ˆç”¨çš„å§\nè¿™é‡Œæœ‰ä¸¤ä¸ªç‰ˆæœ¬é›†ç¾¤ç‰ˆå’Œå•æœºç‰ˆ å¹³å¸¸æµ‹è¯•å°±ç”¨å•æœºç‰ˆæ‰€ä»¥å¯ä»¥å…ˆå†™ä¸€ä¸ªæ¥å£ï¼ŒæŠ½å–ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•\n\n```java\npackage redis;\npublic interface JedisClient {\n\n\tString set(String key, String value);\n\tString get(String key);\n\tBoolean exists(String key);\n\tLong expire(String key, int seconds);\n\tLong ttl(String key);\n\tLong incr(String key);\n\tLong hset(String key, String field, String value);\n\tString hget(String key, String field);\n\tLong hdel(String key, String... field);\n}\n\n```\nç„¶åå†™å„è‡ªçš„å®ç°ç±»\n- å•æœºç‰ˆ\n\n```java\npackage redis;\nimport lombok.Getter;\nimport lombok.Setter;\nimport redis.clients.jedis.Jedis;\nimport redis.clients.jedis.JedisPool;\n\n@Getter@Setter\npublic class JedisClientPool implements JedisClient {\n\t\n\tprivate JedisPool jedisPool;\n\n\t@Override\n\tpublic String set(String key, String value) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tString result = jedis.set(key, value);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String get(String key) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tString result = jedis.get(key);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic Boolean exists(String key) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tBoolean result = jedis.exists(key);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic Long expire(String key, int seconds) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tLong result = jedis.expire(key, seconds);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic Long ttl(String key) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tLong result = jedis.ttl(key);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic Long incr(String key) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tLong result = jedis.incr(key);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic Long hset(String key, String field, String value) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tLong result = jedis.hset(key, field, value);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic String hget(String key, String field) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tString result = jedis.hget(key, field);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n\t@Override\n\tpublic Long hdel(String key, String... field) {\n\t\tJedis jedis = jedisPool.getResource();\n\t\tLong result = jedis.hdel(key, field);\n\t\tjedis.close();\n\t\treturn result;\n\t}\n\n}\n\n```\n- é›†ç¾¤ç‰ˆ\n\n```java\npackage redis;\nimport lombok.Getter;\nimport lombok.Setter;\nimport redis.clients.jedis.JedisCluster;\n\n@Getter@Setter\npublic class JedisClientCluster implements JedisClient {\n\t\n\tprivate JedisCluster jedisCluster;\n\n\t@Override\n\tpublic String set(String key, String value) {\n\t\treturn jedisCluster.set(key, value);\n\t}\n\n\t@Override\n\tpublic String get(String key) {\n\t\treturn jedisCluster.get(key);\n\t}\n\n\t@Override\n\tpublic Boolean exists(String key) {\n\t\treturn jedisCluster.exists(key);\n\t}\n\n\t@Override\n\tpublic Long expire(String key, int seconds) {\n\t\treturn jedisCluster.expire(key, seconds);\n\t}\n\n\t@Override\n\tpublic Long ttl(String key) {\n\t\treturn jedisCluster.ttl(key);\n\t}\n\n\t@Override\n\tpublic Long incr(String key) {\n\t\treturn jedisCluster.incr(key);\n\t}\n\n\t@Override\n\tpublic Long hset(String key, String field, String value) {\n\t\treturn jedisCluster.hset(key, field, value);\n\t}\n\n\t@Override\n\tpublic String hget(String key, String field) {\n\t\treturn jedisCluster.hget(key, field);\n\t}\n\n\t@Override\n\tpublic Long hdel(String key, String... field) {\n\t\treturn jedisCluster.hdel(key, field);\n\t}\n\n}\n\n```\n- ä½¿ç”¨\n   ä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥å†™ä¸ªbeanç„¶ååœ¨éœ€è¦çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥æ³¨å…¥äº†\n\n```java\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:p=\"http://www.springframework.org/schema/p\"\n\txmlns:aop=\"http://www.springframework.org/schema/aop\"\n\txmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txmlns:mybatis-spring=\"http://mybatis.org/schema/mybatis-spring\"\n\txsi:schemaLocation=\"http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd\n\t\thttp://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.2.xsd\n\t\thttp://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.2.xsd\n\t\thttp://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.2.xsd\n\t\thttp://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.2.xsd\n\t\thttp://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.2.xsd\">\n\t<!--å•æœºç‰ˆ-->\n    <!-- \t<bean id=\"jedisClientPool\" class=\"redis.JedisClientPool\">\n\t\t<property name=\"jedisPool\" ref=\"jedisPool\" />\n\t</bean>\n\t<bean id=\"jedisPool\" class=\"redis.clients.jedis.JedisPool\">\n\t\t<constructor-arg name=\"host\" value=\"192.168.25.4\"/>\n\t\t<constructor-arg name=\"port\" value=\"6379\"/>\n\t</bean> -->\n\t<!--é›†ç¾¤ç‰ˆ-->\n\t<bean id=\"jedisClientCluster\" class=\"redis.JedisClientCluster\">\n\t\t<property name=\"jedisCluster\" ref=\"jedisCluster\"/>\t\t\n\t</bean>\n\t\n\t<bean id=\"jedisCluster\" class=\"redis.clients.jedis.JedisCluster\">\n\t\t<constructor-arg name=\"nodes\">\n\t\t\t<set>\n\t\t\t\t<bean class=\"redis.clients.jedis.HostAndPort\">\n\t\t\t\t\t<constructor-arg name=\"host\" value=\"192.168.25.4\"/>\n\t\t\t\t\t<constructor-arg name=\"port\" value=\"7001\"/>\n\t\t\t\t</bean>\n\t\t\t\t<bean class=\"redis.clients.jedis.HostAndPort\">\n\t\t\t\t\t<constructor-arg name=\"host\" value=\"192.168.25.4\"/>\n\t\t\t\t\t<constructor-arg name=\"port\" value=\"7002\"/>\n\t\t\t\t</bean>\n\t\t\t\t<bean class=\"redis.clients.jedis.HostAndPort\">\n\t\t\t\t\t<constructor-arg name=\"host\" value=\"192.168.25.4\"/>\n\t\t\t\t\t<constructor-arg name=\"port\" value=\"7003\"/>\n\t\t\t\t</bean>\n\t\t\t\t<bean class=\"redis.clients.jedis.HostAndPort\">\n\t\t\t\t\t<constructor-arg name=\"host\" value=\"192.168.25.4\"/>\n\t\t\t\t\t<constructor-arg name=\"port\" value=\"7004\"/>\n\t\t\t\t</bean>\n\t\t\t\t<bean class=\"redis.clients.jedis.HostAndPort\">\n\t\t\t\t\t<constructor-arg name=\"host\" value=\"192.168.25.4\"/>\n\t\t\t\t\t<constructor-arg name=\"port\" value=\"7005\"/>\n\t\t\t\t</bean>\n\t\t\t\t<bean class=\"redis.clients.jedis.HostAndPort\">\n\t\t\t\t\t<constructor-arg name=\"host\" value=\"192.168.25.4\"/>\n\t\t\t\t\t<constructor-arg name=\"port\" value=\"7006\"/>\n\t\t\t\t</bean>\n\t\t\t</set>\n\t\t</constructor-arg>\t\t\t\n\t</bean>\n</beans>\n```\nè¿™é‡Œåœ¨é›†ç¾¤çš„æ—¶å€™é‡åˆ°äº†é—®é¢˜å°±æ˜¯æˆ‘ä¸Šé¢æåˆ°çš„ipçš„é—®é¢˜ä¸è¦å†™127.0.0.1è¦å†™å®é™…çš„å†…ç½‘ipä»¥åå¦‚æœipå˜äº†å°±åªèƒ½é‡æ–°æ¥ä¸€æ¬¡äº†ï¼Œé‚£ä¸ªå‘½ä»¤æˆ‘è¯•äº†ä¸‹æ‰§è¡Œç¬¬äºŒæ¬¡ï¼ŒæŠ¥é”™è¯´æˆ‘é‚£ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œ**ä¹Ÿè®¸**æŠŠæ•°æ®æ¸…ç©ºäº†å°±å¯ä»¥äº†ã€‚\n- æµ‹è¯•\n```java\n\t@Test\n\tpublic void testRedis() {\n\t\t//åˆå§‹åŒ–Springå®¹å™¨\n\t\tApplicationContext applicationContext = new ClassPathXmlApplicationContext(\"classpath:spring/applicationContext-redis.xml\");\n\t\t//ä»å®¹å™¨ä¸­è·å–jedisClientå¯¹è±¡ (å•æœºç‰ˆ) \n\t\tJedisClient jedisClient=applicationContext.getBean(JedisClient.class);\n\t\tjedisClient.set(\"testRedis\", \"Hello World\");\n\t\tSystem.out.println(jedisClient.get(\"testRedis\"));\n\t}\n```\n\n","tags":["æ·˜æ·˜å•†åŸ","Redis","é›†ç¾¤æ­å»º"],"categories":["Web"]},{"title":"Mybatisé€†å‘å·¥ç¨‹å¯¹textçš„ç‰¹æ®Šå¤„ç†","url":"/2018/05/23/mybatis-ni-xiang-gong-cheng-dui-text-de-te-shu-chu-li/","content":"# Mybatiså¯¹Mysqlä¸­textç±»å‹çš„ç‰¹æ®Šå¤„ç†\n- æ˜¨å¤©æ™šä¸Šåœ¨åšcmsçš„crudçš„æ—¶å€™é‡åˆ°çš„é—®é¢˜ï¼Œç¼–è¾‘çš„æ—¶å€™ä¸å›æ˜¾å†…å®¹ï¼Œç„¶åf12çœ‹äº†ä¸‹å“åº”çš„jsoné‡Œé¢contentä¹Ÿä¸ºnullï¼Œç„¶åå»serviceé‡Œé¢æŠŠé‚£ä¸ªpojoåŠ äº†toStringæŠŠå‡ æ¡æ•°æ®ç›´æ¥æ‰“å°å‡ºæ¥ å› ä¸ºç”¨äº†åˆ†é¡µç„¶åæ‰“å°å‡ºæ¥çš„ä¹Ÿå¹¶ä¸æ˜¯æ•°æ®\n\nï¼ˆä¸‹æ¬¡å†æ¥æ¢ç©¶åˆ†é¡µæ’ä»¶ï¼‰ ç„¶åæ³¨é‡Šæ‰åœ¨æ‰“å°å‘ç°è¿˜æ˜¯æ²¡æœ‰ç„¶åæˆ‘è¯•äº†ä¸‹å•ç‹¬æŸ¥è¯¢ï¼Œæ ¹æ®ä¸»é”®æŸ¥è¯¢æŸ¥å‡ºæ¥çš„å±…ç„¶ç”¨æœ‰ï¼ï¼ï¼è¿™å°±å¾ˆå¥‡æ€ªäº†ã€‚ã€‚ã€‚æˆ‘å½“æ—¶å°±ä»¥ä¸ºæ˜¯byexampleçš„mapperæœ‰é—®é¢˜ å“ˆå“ˆå“ˆ~~ å…¶å®è¿˜æ˜¯è‡ªå·±æ¡†æ¶å­¦çš„ä¸å¥½çš„é—®é¢˜\n\n```java\npublic EasyUIJsonResult listContent(long categoryId,int page,int rows) {\n\t\tEasyUIJsonResult result=new EasyUIJsonResult();\n\t\t\n\t\t//æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°PageHelperçš„ä¸€äº›é—®é¢˜ ç­‰ä¸‹å†æ¥ç ”ç©¶\n\t\t//PageHelper.startPage(page, rows);\n\t\tTbContentExample example =new TbContentExample();\n\t\texample.createCriteria().andCategoryIdEqualTo(categoryId);\n\t\tList<TbContent> contents = dao.selectByExample(example);\n\t\tPageInfo<TbContent> info=new PageInfo<>(contents);\n\t\n\t\t//åŠ ä¸ŠPageHelperåè¿™é‡Œæ‰“å°å‡ºæ¥çš„å°±ä¸æ˜¯contentså¯¹è±¡äº†å°±æ˜¯Pageå¯¹è±¡\n\t\t//è€Œä¸”æŸ¥å‡ºæ¥çš„æ•°æ®é‡Œé¢contentä¸ºnull (æ•°æ®åº“ä¸­æœ‰ çŒœæƒ³å¯èƒ½æ˜¯é€†å‘å·¥ç¨‹æœ‰é—®é¢˜);\n\t\tSystem.out.println(contents);\n\t\t\n\t\t//æµ‹è¯•ä¸‹å•ç‹¬æŸ¥è¯¢ ä¸»é”®æŸ¥è¯¢æ²¡é—®é¢˜ å–çš„åˆ°content\n\t\tSystem.out.println(dao.selectByPrimaryKey((long)42));\n\t\t\n\t\t//å•ç‹¬æµ‹è¯•ä¸‹åªæŸ¥ä¸€ä¸ª    ä¹Ÿæ²¡æœ‰\n\t\tTbContentExample example2 =new TbContentExample();\n\t\tCriteria criteria2 = example2.createCriteria();\n\t\tcriteria2.andCategoryIdEqualTo((long)90);\n\t\tSystem.out.println(dao.selectByExample(example2 ));\n\t\t\n\t\tresult.setTotal(info.getTotal());\n\t\tresult.setRows(contents);\n\t\treturn result;\n\t}\n```\n- ç„¶åå°±é¢å‘ç™¾åº¦äº†ä¸€æ³¢ï¼Œè¿˜çœŸå°±æŸ¥åˆ°äº†é‡åˆ°è·Ÿæˆ‘ä¸€æ ·çš„é—®é¢˜[åŒé“ä¸­äºº](https://ask.csdn.net/questions/205320)\nselectByExampleWithBLOBsç”¨è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥äº† çœ‹åå­—å°±çŸ¥é“æ›´è¿™ä¸ªæœ‰å…³å“ˆå“ˆå“ˆ\nç„¶åå°±æ„‰å¿«çš„è§£å†³äº†![image](http://p1.cdn.img9.top/ipfs/QmVhiMUQoFbiHc8BJxFtSzCUxVrZffnj9vYD7yM5YmCjGL?1.png)\n- ä¸ä»…ä»…æ˜¯select updateä¹Ÿæœ‰è¿™ä¸ªæ–¹æ³•\n```java\npublic interface TbContentMapper {\n    int countByExample(TbContentExample example);\n\n    int deleteByExample(TbContentExample example);\n\n    int deleteByPrimaryKey(Long id);\n\n    int insert(TbContent record);\n\n    int insertSelective(TbContent record);\n\n    List<TbContent> selectByExampleWithBLOBs(TbContentExample example);\n\n    List<TbContent> selectByExample(TbContentExample example);\n\n    TbContent selectByPrimaryKey(Long id);\n\n    int updateByExampleSelective(@Param(\"record\") TbContent record, @Param(\"example\") TbContentExample example);\n\n    int updateByExampleWithBLOBs(@Param(\"record\") TbContent record, @Param(\"example\") TbContentExample example);\n\n    int updateByExample(@Param(\"record\") TbContent record, @Param(\"example\") TbContentExample example);\n\n    int updateByPrimaryKeySelective(TbContent record);\n\n    int updateByPrimaryKeyWithBLOBs(TbContent record);\n\n    int updateByPrimaryKey(TbContent record);\n}\n```\n","tags":["æŠ€æœ¯","æ¡†æ¶"],"categories":["Web"]},{"title":"SpringMVC - å¤„ç†é™æ€èµ„æº (è½¬)","url":"/2018/05/21/springmvc-chu-li-jing-tai-zi-yuan/","content":"## **ã€1ã€‘ç¬¬ä¸€ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•**\n\nå°†DispatcherServletè¯·æ±‚æ˜ å°„è®¾ç½®ä¸º / ï¼Œå°†ä¼šæ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ã€‚ä¸èƒ½è®¿é—®é™æ€èµ„æºã€‚\n\n**è§£å†³åŠæ³•ï¼š**\n\nåœ¨SpringMVCçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹æ ‡ç­¾è§£å†³\n\n```java\n<mvc:default-servlet-handler/>\n```\n\nå…¶XSDæ–‡æ¡£è¯´æ˜å¦‚ä¸‹:\n\n\n```java\n/*é…ç½®ä¸€ä¸ªhandleré€šè¿‡è½¬å‘è¯·æ±‚åˆ°servletå®¹å™¨çš„é»˜è®¤servletæ¥å¤„ç†é™æ€èµ„æº*/\nConfigures a handler for serving static resources by forwarding to the Servlet container's default Servlet.\n\n/*ä½¿ç”¨è¯¥handlerå°†ä¼šå…è®¸DispatcherServlet çš„url-patternä¸º'/';åŒæ—¶ä½¿ç”¨servletå®¹å™¨çš„é»˜è®¤servletå¤„ç†é™æ€èµ„æº*/\nUse of this handler allows using a \"/\" mapping with the DispatcherServlet \nwhile still utilizing the Servlet container to serve static resources. \n\n/*è¯¥handlerå°†ä¼šè½¬å‘æ‰€æœ‰è¯·æ±‚åˆ°é»˜è®¤servlet*/\nThis handler will forward all requests to the default Servlet. \n\n/*å› æ­¤å°†è¯¥handlerçš„æ‰§è¡Œé¡ºåºæ”¾åˆ°æ‰€æœ‰è¯·æ±‚å¤„ç†çš„æœ€åæ˜¯éå¸¸é‡è¦çš„ï¼ï¼ï¼*/\nTherefore it is important that it remains last in the order of all other URL HandlerMappings. \n\n/*ä½¿ç”¨<mvc:annotation-driven/>æ ‡ç­¾æˆ–è€…è®¾ç½®HandlerMapping instanceçš„orderæ¥ç¡®ä¿DefaultServletHttpRequestHandlerçš„orderæœ€å¤§ã€‚*/\nThat will be the case if you use the \"annotation-driven\" element \nor alternatively if you are setting up your customized HandlerMapping instance \nbe sure to set its \"order\" property to a value lower than \nthat of the DefaultServletHttpRequestHandler, which is Integer.MAX_VALUE.\n```\n\n![image](https://img-blog.csdn.net/20170914152551033?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n**è§£é‡Šå¦‚ä¸‹ï¼š**\n\n`<mvc:default-servlet-handler/>`å°†åœ¨SpringMVCçš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸€ä¸ªDefaultServletHttpRequestHandleræ¥å¤„ç†é™æ€èµ„æº(å…¶å®å°±æ˜¯å°†è¯·æ±‚è½¬å‘ç»™é»˜è®¤çš„servlet)ã€‚\n\nä¸€èˆ¬WEBæœåŠ¡å™¨é»˜è®¤çš„servletçš„åç§°ä¸ºdefaultã€‚è‹¥æ‰€ä½¿ç”¨çš„WEBæœåŠ¡å™¨é»˜è®¤çš„Servletåç§°ä¸æ˜¯defaultï¼Œåˆ™éœ€è¦é€šè¿‡default-servlet-name å±æ€§æŒ‡å®šï¼\n\n![image](https://img-blog.csdn.net/20170224143539025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n* * *\n\n**ä¸åŒæœåŠ¡å™¨ä¸‹é»˜è®¤servletåå­—å¯¹åº”å¦‚ä¸‹ï¼š**\n\n```java\nTomcat, Jetty, JBoss, and GlassFish  é»˜è®¤ Servletçš„åå­— -- \"default\"\nGoogle App Engine é»˜è®¤ Servletçš„åå­— -- \"_ah_default\"\nResin é»˜è®¤ Servletçš„åå­— -- \"resin-file\"\nWebLogic é»˜è®¤ Servletçš„åå­—  -- \"FileServlet\"\nWebSphere  é»˜è®¤ Servletçš„åå­— -- \"SimpleFileServlet\"\n```\n\n![è¿™é‡Œå†™å›¾ç‰‡æè¿°](https://img-blog.csdn.net/20170914154653746?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n* * *\n\n**ã€Tipsï¼šã€‘**\n\nä½¿ç”¨ä¸Šè¿°é…ç½®ï¼Œä½ ä¼šå‘ç°æ­£å¸¸çš„Controllerè·³è½¬å¤±æ•ˆäº†ï¼\n\nXSDè¯´æ˜æœ€åä¸€æ®µè¯å¦‚ä¸‹ï¼š\n\n```java\n/*ä½¿ç”¨<mvc:annotation-driven/>æ ‡ç­¾æˆ–è€…è®¾ç½®HandlerMapping instanceçš„orderæ¥ç¡®ä¿DefaultServletHttpRequestHandlerçš„orderæœ€å¤§ã€‚*/\nThat will be the case if you use the \"annotation-driven\" element \nor alternatively if you are setting up your customized HandlerMapping instance \nbe sure to set its \"order\" property to a value lower than \nthat of the DefaultServletHttpRequestHandler, which is Integer.MAX_VALUE.\n```\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆé…ç½®`<mvc:annotation-driven />`æ ‡ç­¾ï¼Œè¦ä¹ˆæ‰‹åŠ¨æ³¨å†Œè¯·æ±‚æ˜ å°„å¤„ç†beanäºxmlä¸­ï¼Œå¹¶è®¾ç½®orderå±æ€§å€¼ï¼Œä»¥å…¶å®ç°æ¡†æ¶ä¸­å¤„ç†è¯·æ±‚æ˜ å°„çš„beançš„orderå€¼å°äºDefaultServletHttpRequestHandlerçš„orderå±æ€§å€¼ï¼ï¼ï¼\n\nå¸¸ç”¨çš„è§£å†³æ–¹å¼ä¸ºé…ç½®`<mvc:annotation-driven />`æ ‡ç­¾ï¼Œè¯¦æƒ…ç‚¹å‡»æŸ¥çœ‹[è¯·æ±‚æ˜ å°„å¤±æ•ˆ](http://blog.csdn.net/j080624/article/details/66969987)ã€‚\n\nç‚¹å‡»æŸ¥çœ‹[controlleræ˜ å°„å¤±æ•ˆ](http://blog.csdn.net/J080624/article/details/66969987)\n\n* * *\n\n## **ã€2ã€‘ç¬¬äºŒç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•**\n\nè§£å†³é™æ€èµ„æºçš„æ€è·¯æ˜¯ï¼Œåœ¨SpringMVC.xmlä¸­ï¼Œæ‹¦æˆªè®¾ç½®ä¸ºâ€*.doâ€ï¼Œè€Œä¸æ˜¯â€/â€ã€‚\n\nè¿™æ ·å°±ä¸ä¼šæ‹¦æˆªé™æ€èµ„æºçš„è¯·æ±‚ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé¡¹ç›®ä¸­ç”¨åˆ°äº†shiroæˆ–è€…å…¶ä»–æƒé™æ¡†æ¶ã€‚é‚£ä¹ˆéœ€è¦æ³¨æ„ä½ çš„shiro.xmlé…ç½®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```java\n  <bean id=\"shiroFilter\" class=\"org.apache.shiro.spring.web.ShiroFilterFactoryBean\">\n        <!-- Shiroçš„æ ¸å¿ƒå®‰å…¨æ¥å£,è¿™ä¸ªå±æ€§æ˜¯å¿…é¡»çš„ -->\n        <property name=\"securityManager\" ref=\"securityManager\"/>\n        <!-- loginUrlè®¤è¯æäº¤åœ°å€ï¼Œå¦‚æœæ²¡æœ‰è®¤è¯å°†ä¼šè¯·æ±‚æ­¤åœ°å€è¿›è¡Œè®¤è¯ï¼Œè¯·æ±‚æ­¤åœ°å€å°†ç”±formAuthenticationFilterè¿›è¡Œè¡¨å•è®¤è¯ -->\n        <property name=\"loginUrl\" value=\"/login\"/>\n\n        <!-- Shiroè¿æ¥çº¦æŸé…ç½®,å³è¿‡æ»¤é“¾çš„å®šä¹‰ -->\n        <property name=\"filterChainDefinitions\">\n            <value>\n                <!-- /** = anonæ‰€æœ‰urléƒ½å¯ä»¥åŒ¿åè®¿é—® -->\n                <!-- å¯¹é™æ€èµ„æºè®¾ç½®åŒ¿åè®¿é—® -->\n                /images/** = anon\n                /js/** = anon\n                /styles/** = anon\n                <!-- éªŒè¯ç ï¼Œå¯åŒ¿åè®¿é—® -->\n                /validateCode = anon  <!--éªŒè¯ç -->\n                /doLogin = anon\n\n                <!-- /** = authc æ‰€æœ‰urléƒ½å¿…é¡»è®¤è¯é€šè¿‡æ‰å¯ä»¥è®¿é—® -->\n                /**=authc\n                <!--è¯·æ±‚logoutï¼Œshrioæ“¦é™¤sssion-->\n                /logout=logout\n            </value>\n        </property>\n    </bean>\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯è™½ç„¶SpringMVCæ‹¦æˆªçš„æ˜¯.doï¼Œä½†æ˜¯ç”±äºä½¿ç”¨äº†shiro(æˆ–è€…ä½ çš„å…¶ä»–æƒé™æ¡†æ¶)ï¼Œé‚£ä¹ˆæœªç™»å½•æƒ…å†µä¸‹æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®é™¤shiroé…ç½®æ–‡ä»¶é‡Œé¢å…è®¸åŒ¿åè®¿é—®çš„è·¯å¾„ä¹‹å¤–çš„é™æ€èµ„æºæ–‡ä»¶ã€‚\n\nä¸¾ä¸ªä¾‹å­ï¼Œä½ æŠŠé™æ€èµ„æºæ–‡ä»¶æ”¾åœ¨äº†é¡¹ç›®æ ¹ç›®å½•ï¼Œä½†æ˜¯å‚è€ƒä¸Šé¢é…ç½®æ–‡ä»¶ï¼Œæ˜¾ç„¶ä¸åœ¨åŒ¿åè®¿é—®è·¯å¾„åˆ—è¡¨ä¹‹å†…ï¼Œæ‰€ä»¥ä¼šæç¤ºä½ å…ˆç™»å½•ï¼Œç™»å½•ä¹‹åæ‰å¯è®¿é—®é¡¹ç›®æ ¹ç›®å½•çš„é™æ€èµ„æºæ–‡ä»¶ã€‚\n\n*   æœªç™»å½•å‰è®¿é—®é¡¹ç›®æ ¹ç›®å½•ä¸‹1.jpg , è·³åˆ°ç™»å½•é¡µé¢ï¼š\n\n![image](https://img-blog.csdn.net/20170518094647021?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n*   ç™»å½•åè®¿é—®é¡¹ç›®æ ¹ç›®å½•ä¸‹1.jpg :\n\n![image](https://img-blog.csdn.net/20170518094717006?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\nå¦å¤–ï¼Œå»ºè®®æœ€å¥½å‚è€ƒshiroé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚1.jpgæ”¾åˆ°imagesæ–‡ä»¶å¤¹ä¸‹ï¼Œé‚£ä¹ˆä¸ç”¨ç™»å½•å°±å¯ä»¥ç›´æ¥è®¿é—®ã€‚\n\n![image](https://img-blog.csdn.net/20170518094833869?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSjA4MDYyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n* * *\n\n## **ã€3ã€‘ç¬¬ä¸‰ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•**\n\n**é€šè¿‡é…ç½®ï¼Œé¿å…é™æ€èµ„æºè¢«æ‹¦æˆªï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š**\n\n```java\n <!-- é™æ€èµ„æºè®¿é—®ï¼ˆä¸æ‹¦æˆªæ­¤ç›®å½•ä¸‹çš„ä¸œè¥¿çš„è®¿é—®ï¼‰ -->\n    <mvc:resources location=\"/js/\" mapping=\"/js/**\"/>\n    <mvc:resources location=\"/css/\" mapping=\"/css/**\"/>\n    <mvc:resources location=\"/images/\" mapping=\"/images/**\"/>\n    <mvc:resources location=\"/bootstrap/\" mapping=\"/bootstrap/**\"/>\n```\n\nè¯¥æ ‡ç­¾çš„xsdè¯´æ˜æ–‡æ¡£å¦‚ä¸‹ï¼š\n\n```\n/*é…ç½®handlerä¸ºé™æ€èµ„æºï¼Œå¦‚imagesï¼Œjså’ŒCSSæ–‡ä»¶å¹¶è¿›è¡Œç¼“å­˜å¤´ä¼˜åŒ–ï¼Œä»¥ä¾¿åœ¨Webæµè§ˆå™¨ä¸­é«˜æ•ˆåŠ è½½ã€‚*/\nConfigures a handler for serving static resources such as \nimages, js, and, css files with cache headers optimized for efficient loading in a web browser. \n/*å…è®¸ä¸ºä»»ä½•å¯ä»¥é€šè¿‡springå¤„ç†çš„è·¯å¾„èµ„æºæä¾›æœåŠ¡*/\nAllows resources to be served out of any path that is reachable via Spring's Resource handling.\n```\n\næ³¨å†Œçš„handlerå¦‚ä¸‹ï¼š\n\n```java\norg.springframework.web.servlet.resource.ResourceHttpRequestHandler\n```\n\n**å³ï¼Œè¯¥æ ‡ç­¾æ³¨å†ŒResourceHttpRequestHandlerä¸ºé™æ€èµ„æºçš„è®¿é—®æä¾›æœåŠ¡ã€‚**\n\nè¯¥handlerçš„javadocå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\n{@code HttpRequestHandler} that serves static resources in an optimized way according to the guidelines of Page Speed, YSlow, etc.\n\n * <p>The {@linkplain #setLocations \"locations\"} property takes a list of Spring\n * {@link Resource} locations from which static resources are allowed to\n * be served by this handler. Resources could be served from a classpath location,\n * e.g. \"classpath:/META-INF/public-web-resources/\", allowing convenient packaging\n * and serving of resources such as .js, .css, and others in jar files.\n```\n\n* * *\n\n## **ã€4ã€‘ç¬¬å››ç§ç¤ºä¾‹ä¸è§£å†³åŠæ³•**\n\nç¡®åˆ‡è¯´è¿™é‡Œåªè§£å†³ä¸é€šè¿‡controllerè€Œç›´æ¥è®¿é—®jspçš„é—®é¢˜ã€‚\n\n`<mvc:view-controller/>`ç›´æ¥è®¿é—®view-nameå¯¹åº”çš„jsp\n\n*   jspè·¯å¾„ä¾æ®è§†å›¾è§£æå™¨é…ç½®ã€‚\n\n```java\n    <!-- mvc:view-controllerå¯ä½¿å…¶ç›´æ¥è®¿é—®è·¯å¾„ -->  \n    <mvc:view-controller path=\"/i18n\" view-name=\"i18n\"/>\n\n    <mvc:view-controller path=\"/i18n2\" view-name=\"i18n2\"/>\n```\n","tags":["æŠ€æœ¯","Spring","è½¬è½½"],"categories":["Web"]},{"title":"Springè¯·æ±‚å‚æ•°è·å–çš„å‡ ç§æ–¹å¼ï¼ˆè½¬ï¼‰","url":"/2018/05/17/spring-qing-qiu-can-shu-huo-qu/","content":"# [springmvcè¯·æ±‚å‚æ•°è·å–çš„å‡ ç§æ–¹æ³•](http://www.cnblogs.com/xiaoxi/p/5695783.html)\n**1ã€ç›´æ¥æŠŠè¡¨å•çš„å‚æ•°å†™åœ¨Controllerç›¸åº”çš„æ–¹æ³•çš„å½¢å‚ä¸­ï¼Œé€‚ç”¨äºgetæ–¹å¼æäº¤ï¼Œä¸é€‚ç”¨äºpostæ–¹å¼æäº¤ã€‚**\n\n```java \n    /** * 1.ç›´æ¥æŠŠè¡¨å•çš„å‚æ•°å†™åœ¨Controllerç›¸åº”çš„æ–¹æ³•çš„å½¢å‚ä¸­\n      * @param username\n     * @param password\n     * @return\n     */ @RequestMapping(\"/addUser1\") public String addUser1(String username,String password) {\n        System.out.println(\"username is:\"+username);\n        System.out.println(\"password is:\"+password); return \"demo/index\";\n    }\n```\nurlå½¢å¼ï¼š[http://localhost/SSMDemo/demo/addUser1?username=lixiaoxi&password=111111](http://localhost/SSMDemo/demo/addUser1?username=lixiaoxi&password=111111) æäº¤çš„å‚æ•°éœ€è¦å’ŒControlleræ–¹æ³•ä¸­çš„å…¥å‚åç§°ä¸€è‡´ã€‚\n\n**2ã€é€šè¿‡HttpServletRequestæ¥æ”¶ï¼Œpostæ–¹å¼å’Œgetæ–¹å¼éƒ½å¯ä»¥ã€‚**\n\n```java\n   /** 2ã€é€šè¿‡HttpServletRequestæ¥æ”¶\n    * @param request\n     * @return\n     */ @RequestMapping(\"/addUser2\") public String addUser2(HttpServletRequest request) {\n        String username=request.getParameter(\"username\");\n        String password=request.getParameter(\"password\");\n        System.out.println(\"username is:\"+username);\n        System.out.println(\"password is:\"+password); return \"demo/index\";\n    }\n```\n\n**3ã€é€šè¿‡ä¸€ä¸ªbeanæ¥æ¥æ”¶,postæ–¹å¼å’Œgetæ–¹å¼éƒ½å¯ä»¥ã€‚**\n(1)å»ºç«‹ä¸€ä¸ªå’Œè¡¨å•ä¸­å‚æ•°å¯¹åº”çš„bean\n\n```java\npackage demo.model; public class UserModel { private String username; private String password; public String getUsername() { return username;\n    } public void setUsername(String username) { this.username = username;\n    } public String getPassword() { return password;\n    } public void setPassword(String password) { this.password = password;\n    }\n\n}\n```\n\n(2)ç”¨è¿™ä¸ªbeanæ¥å°è£…æ¥æ”¶çš„å‚æ•°\n\n\n\n```java\n /** * 3ã€é€šè¿‡ä¸€ä¸ªbeanæ¥æ¥æ”¶\n      * @param user\n     * @return\n     */ @RequestMapping(\"/addUser3\") public String addUser3(UserModel user) {\n        System.out.println(\"username is:\"+user.getUsername());\n        System.out.println(\"password is:\"+user.getPassword()); return \"demo/index\";\n    }\n```\n**4ã€é€šè¿‡@PathVariableè·å–è·¯å¾„ä¸­çš„å‚æ•°**\n\n```java\n/*** 4ã€é€šè¿‡@PathVariableè·å–è·¯å¾„ä¸­çš„å‚æ•°\n      * @param username\n     * @param password\n     * @return\n     */ @RequestMapping(value=\"/addUser4/{username}/{password}\",method=RequestMethod.GET) public String addUser4(@PathVariable String username,@PathVariable String password) {\n        System.out.println(\"username is:\"+username);\n        System.out.println(\"password is:\"+password); return \"demo/index\";\n    }\n```\nä¾‹å¦‚ï¼Œè®¿é—®[http://localhost/SSMDemo/demo/addUser4/lixiaoxi/111111](http://localhost/SSMDemo/demo/addUser4/lixiaoxi/111111) è·¯å¾„æ—¶ï¼Œåˆ™è‡ªåŠ¨å°†URLä¸­æ¨¡æ¿å˜é‡{username}å’Œ{password}ç»‘å®šåˆ°é€šè¿‡@PathVariableæ³¨è§£çš„åŒåå‚æ•°ä¸Šï¼Œå³å…¥å‚åusername=lixiaoxiã€password=111111ã€‚\n**5ã€ä½¿ç”¨@ModelAttributeæ³¨è§£è·å–POSTè¯·æ±‚çš„FORMè¡¨å•æ•°æ®**\nJspè¡¨å•å¦‚ä¸‹ï¼š\n```java\n<form action =\"<%=request.getContextPath()%>/demo/addUser5\" method=\"post\"> ç”¨æˆ·å:&nbsp;<input type=\"text\" name=\"username\"/><br/> å¯†&nbsp;&nbsp;ç :&nbsp;<input type=\"password\" name=\"password\"/><br/>\n     <input type=\"submit\" value=\"æäº¤\"/> \n     <input type=\"reset\" value=\"é‡ç½®\"/> \n</form> \n```\nJava Controllerå¦‚ä¸‹ï¼š\n\n```java \n/** * 5ã€ä½¿ç”¨@ModelAttributeæ³¨è§£è·å–POSTè¯·æ±‚çš„FORMè¡¨å•æ•°æ®\n     * @param user\n     * @return\n     */ @RequestMapping(value=\"/addUser5\",method=RequestMethod.POST) public String addUser5(@ModelAttribute(\"user\") UserModel user) {\n        System.out.println(\"username is:\"+user.getUsername());\n        System.out.println(\"password is:\"+user.getPassword()); return \"demo/index\";\n    } \n```\n\n \n\n**6ã€ç”¨æ³¨è§£@RequestParamç»‘å®šè¯·æ±‚å‚æ•°åˆ°æ–¹æ³•å…¥å‚**\nå½“è¯·æ±‚å‚æ•°usernameä¸å­˜åœ¨æ—¶ä¼šæœ‰å¼‚å¸¸å‘ç”Ÿ,å¯ä»¥é€šè¿‡è®¾ç½®å±æ€§required=falseè§£å†³,ä¾‹å¦‚: @RequestParam(value=\"username\", required=false)\n\n```java \n/** * 6ã€ç”¨æ³¨è§£@RequestParamç»‘å®šè¯·æ±‚å‚æ•°åˆ°æ–¹æ³•å…¥å‚\n      * @param username\n     * @param password\n     * @return\n     */ @RequestMapping(value=\"/addUser6\",method=RequestMethod.GET) public String addUser6(@RequestParam(\"username\") String username,@RequestParam(\"password\") String password) {\n        System.out.println(\"username is:\"+username);\n        System.out.println(\"password is:\"+password); return \"demo/index\";\n    }\n```","tags":["Spring","è½¬è½½"],"categories":["Web"]},{"title":"FastDFSå­¦ä¹ ","url":"/2018/05/16/fastdfs/","content":"# FastDFSå­¦ä¹ ç¬”è®°\n- FastDFSç®€ä»‹\n\tFastDFSæœåŠ¡ç«¯æœ‰ä¸¤ä¸ªè§’è‰²ï¼šè·Ÿè¸ªå™¨ï¼ˆtrackerï¼‰å’Œå­˜å‚¨[èŠ‚ç‚¹](https://baike.baidu.com/item/%E8%8A%82%E7%82%B9)ï¼ˆstorageï¼‰ã€‚è·Ÿè¸ªå™¨ä¸»è¦åšè°ƒåº¦å·¥ä½œï¼Œåœ¨è®¿é—®ä¸Šèµ·è´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚\nå­˜å‚¨èŠ‚ç‚¹å­˜å‚¨æ–‡ä»¶ï¼Œå®Œæˆæ–‡ä»¶ç®¡ç†çš„æ‰€æœ‰åŠŸèƒ½ï¼šå°±æ˜¯è¿™æ ·çš„å­˜å‚¨ã€åŒæ­¥å’Œæä¾›å­˜å–æ¥å£ï¼ŒFastDFSåŒæ—¶å¯¹æ–‡ä»¶çš„metadataè¿›è¡Œç®¡ç†ã€‚æ‰€è°“æ–‡ä»¶çš„meta dataå°±æ˜¯æ–‡ä»¶çš„ç›¸å…³å±æ€§ï¼Œä»¥é”®å€¼å¯¹ï¼ˆkey valueï¼‰æ–¹å¼è¡¨ç¤ºï¼Œå¦‚ï¼šwidth=1024ï¼Œå…¶ä¸­çš„keyä¸ºwidthï¼Œvalueä¸º1024ã€‚æ–‡ä»¶metadataæ˜¯[æ–‡ä»¶å±æ€§](https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7)åˆ—è¡¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹ã€‚\nè·Ÿè¸ªå™¨å’Œå­˜å‚¨èŠ‚ç‚¹éƒ½å¯ä»¥ç”±ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨æ„æˆã€‚è·Ÿè¸ªå™¨å’Œå­˜å‚¨èŠ‚ç‚¹ä¸­çš„æœåŠ¡å™¨å‡å¯ä»¥éšæ—¶å¢åŠ æˆ–ä¸‹çº¿è€Œä¸ä¼šå½±å“çº¿ä¸ŠæœåŠ¡ã€‚å…¶ä¸­è·Ÿè¸ªå™¨ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯å¯¹ç­‰çš„ï¼Œå¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„å‹åŠ›æƒ…å†µéšæ—¶å¢åŠ æˆ–å‡å°‘ã€‚\nä¸ºäº†æ”¯æŒå¤§å®¹é‡ï¼Œå­˜å‚¨[èŠ‚ç‚¹](https://baike.baidu.com/item/%E8%8A%82%E7%82%B9)ï¼ˆæœåŠ¡å™¨ï¼‰é‡‡ç”¨äº†åˆ†å·ï¼ˆæˆ–åˆ†ç»„ï¼‰çš„ç»„ç»‡æ–¹å¼ã€‚[å­˜å‚¨ç³»ç»Ÿ](https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F)ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå·ç»„æˆï¼Œå·ä¸å·ä¹‹é—´çš„æ–‡ä»¶æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€æœ‰å·çš„æ–‡ä»¶å®¹é‡ç´¯åŠ å°±æ˜¯æ•´ä¸ªå­˜å‚¨ç³»ç»Ÿä¸­çš„æ–‡ä»¶å®¹é‡ã€‚ä¸€ä¸ªå·å¯ä»¥ç”±ä¸€å°æˆ–å¤šå°[å­˜å‚¨æœåŠ¡å™¨](https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E5%99%A8)ç»„æˆï¼Œä¸€ä¸ªå·ä¸‹çš„å­˜å‚¨æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå·ä¸­çš„å¤šå°å­˜å‚¨æœåŠ¡å™¨èµ·åˆ°äº†[å†—ä½™å¤‡ä»½](https://baike.baidu.com/item/%E5%86%97%E4%BD%99%E5%A4%87%E4%BB%BD)å’Œè´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚\nåœ¨å·ä¸­å¢åŠ æœåŠ¡å™¨æ—¶ï¼ŒåŒæ­¥å·²æœ‰çš„æ–‡ä»¶ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼ŒåŒæ­¥å®Œæˆåï¼Œç³»ç»Ÿè‡ªåŠ¨å°†æ–°å¢æœåŠ¡å™¨åˆ‡æ¢åˆ°çº¿ä¸Šæä¾›æœåŠ¡ã€‚\nå½“å­˜å‚¨ç©ºé—´ä¸è¶³æˆ–å³å°†è€—å°½æ—¶ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å·ã€‚åªéœ€è¦å¢åŠ ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ï¼Œå¹¶å°†å®ƒä»¬é…ç½®ä¸ºä¸€ä¸ªæ–°çš„å·ï¼Œè¿™æ ·å°±æ‰©å¤§äº†[å­˜å‚¨ç³»ç»Ÿ](https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F)çš„å®¹é‡ã€‚\nFastDFSä¸­çš„æ–‡ä»¶æ ‡è¯†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå·åå’Œæ–‡ä»¶åï¼ŒäºŒè€…ç¼ºä¸€ä¸å¯ã€‚\n- å¤§èƒ†åˆ†æ\nè¿™é‡Œåœ¨æ·˜æ·˜çš„åå°ä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™ç”¨åˆ°äº†,ç¡®å®å¥½ç”¨ä¹Ÿæ˜¯cè¯­è¨€å¼€å‘çš„ æ­é…*Nginx*è´¼æ–¹ä¾¿,ç¡®å®ä½©æœé‚£äº›æ**C**çš„å¤§ä½¬ï¼Œä¸Šé¢çš„è¯´æ³•ä¸å¤Ÿç›´ç™½æ–‡å­—æ€»æ˜¯è‹ç™½çš„(ï¿£â–½ï¿£)~*è®©æˆ‘æ¥å¼ºè¡Œè§£é‡Šä¸€æ³¢![image](http://p1.so.qhmsg.com/bdr/_240_/t0183119f547ca0bbc6.png)\nä¸Šé¢è¯´åˆ°äº†**FastDFS**ä¸»è¦æœ‰ä¸¤ä¸ªèŠ‚ç‚¹\n 1. å‚¨å­˜èŠ‚ç‚¹Storage  \né¡¾åæ€ä¹‰å°±æ˜¯ç”¨æ¥å‚¨å­˜æ–‡ä»¶çš„æœåŠ¡å™¨è¿™ä¸ªå›¾ä¸­çš„æ˜¯æ¯”è¾ƒå¤æ‚çš„æƒ…å†µè¿™é‡Œæœ‰ä¸€ä¸ªstroage ç¾¤é‡Œåˆåˆ†äº†å¾ˆå¤šç»„æ¯ä¸ªç»„é‡Œåˆæœ‰å¾ˆå¤šæœåŠ¡å™¨ï¼ˆè¿™é‡Œçš„æœåŠ¡å™¨é‡Œé¢å‚¨å­˜çš„æ–‡ä»¶æ˜¯ä¸€æ ·çš„ ä¼šè‡ªåŠ¨åŒæ­¥ æ–¹ä¾¿åŠ æœºå™¨ï¼‰\n  2. ç›‘æ§èŠ‚ç‚¹Tracker \nè¿™ä¸ªå°±è·Ÿ[zookeper](http://www.so.com/link?m=a0NGOfhwBC5nSFnUTBxpX2uhRysff5w5UsQFEqgCBRrJbwZpybFckcSRdwhuJdbgSApcIIqhL0gq5D6eIbBJ5pN22O2Z0k6ENTFGSjrRpsgETp2Dl)ä½œç”¨æœ‰ç‚¹åƒå…ˆä¸Šå›¾\n![image](http://p0.cdn.img9.top/ipfs/QmZynH9DgJJbePkn35LjhRTc6xyyWL64jNT6QU6jyBnrXE?0.png\n)\nè¿™ä¸ªæ˜¯ä¸Šä¼ çš„è¿‡ç¨‹å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯è¦ä¸Šä¼ å›¾ç‰‡éƒ½æ˜¯é€šè¿‡Trackerçš„è€Œå‚¨å­˜èŠ‚ç‚¹ä¹Ÿä¼šå®šæ—¶å‘Trackerå‘é€çŠ¶æ€çš„ä¿¡æ¯ç›‘æ§Storageçš„çŠ¶æ€\n`å¯ä»¥çœ‹å‡ºä¸Šé¢Clientåœ¨ä¸Šä¼ å›¾ç‰‡æˆåŠŸåStorageè¿”å›äº†ä¸€ä¸ªfile_idç„¶åå®¢æˆ·ç«¯å°±ä¼šå‚¨å­˜è¿™ä¸ªidé‚£å®¢æˆ·ç«¯æ˜¯å¦‚ä½•é€šè¿‡è¿™ä¸ªidè®¿é—®åˆ°è¿™ä¸ªå›¾ç‰‡çš„å‘¢ï¼Ÿ ---æ²¡é”™å°±æ˜¯Nginx ç”¨Nginxæ¥å¤„ç†è¿™äº›é™æ€èµ„æºå†å¥½ä¸è¿‡äº†`\n- ä½¿ç”¨\n è¯´äº†è¿™ä¹ˆå¤šæ¥å®é™…ç”¨ç”¨çœ‹å§  \n   1. é¦–å…ˆæˆ‘ä»¬è¦åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…FastDFSå¹¶é…ç½®Nginxè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ä¹Ÿä¸æ˜¯æˆ‘ä»¬é‡ç‚¹å…³å¿ƒçš„é—®é¢˜æ˜¯è¿ç»´åº”è¯¥å…³å¿ƒçš„é—®é¢˜è¿™é‡Œæœ‰ä¸€ä¸ªæ­å»ºå¥½çš„æœ€ç®€å•çš„[FastDFSæœåŠ¡å™¨](https://pan.baidu.com/s/1u5FLtQu71CueAJwq63ji6A)å¼€æœºå°±å¯ä»¥ç›´æ¥ç”¨æœåŠ¡éƒ½æ˜¯å¼€æœºè‡ªå¯åŠ¨çš„  \n  2. ç„¶åæˆ‘ä»¬è¦æœ‰å®¢æˆ·ç«¯è¿™é‡ŒFastDFSä½œè€…å·²ç»å†™å¥½äº†JAVAçš„å®¢æˆ·ç«¯æˆ‘ä»¬ç›´æ¥æ‹¿æ¥ç”¨å°±å¥½äº†[fastdfs_clientçš„jaråŒ…](https://pan.baidu.com/s/1KY5BKUr6f1PlCRR7hyhRSA)\n  3. å¼€å§‹ä½¿ç”¨å§  \n\n``` java\n@Test\n\tpublic void testUpload() throws Exception {\n\n\t\t//1ã€åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å°±æ˜¯trackeræœåŠ¡çš„åœ°å€ã€‚\n\t\t//é…ç½®æ–‡ä»¶å†…å®¹ï¼štracker_server=192.168.25.133:22122\n\t\tClientGlobal.init(\"D:\\\\JavaDemo\\\\taoshop-web\\\\src\\\\main\\\\resources\\\\conf\\\\client.conf\");\n\t\t//2ã€åˆ›å»ºä¸€ä¸ªTrackerClientå¯¹è±¡ã€‚ç›´æ¥newä¸€ä¸ªã€‚\n\t\tTrackerClient trackerClient =new TrackerClient();\n\t\t//3ã€ä½¿ç”¨TrackerClientå¯¹è±¡åˆ›å»ºè¿æ¥ï¼Œè·å¾—ä¸€ä¸ªTrackerServerå¯¹è±¡ã€‚\n\t\tTrackerServer trackerServer = trackerClient.getConnection();\n\t\t//4ã€åˆ›å»ºä¸€ä¸ªStorageServerçš„å¼•ç”¨ï¼Œå€¼ä¸ºnull\n\t\tStorageServer storageServer =null;\n\t\t//5ã€åˆ›å»ºä¸€ä¸ªStorageClientå¯¹è±¡ï¼Œéœ€è¦ä¸¤ä¸ªå‚æ•°TrackerServerå¯¹è±¡ã€StorageServerçš„å¼•ç”¨\n\t\tStorageClient storageCilent =new StorageClient(trackerServer,storageServer);\n\t\t//6ã€ä½¿ç”¨StorageCilentä¸Šä¼ æ–‡ä»¶\n\t\tString[] strings = storageCilent.upload_file(\"C:\\\\Users\\\\Administrator\\\\Desktop\\\\image\\\\222.jpg\",\"jpg\", null);\n\t\tfor (String string : strings) {\n\t\t\tSystem.out.println(string);\n\t\t}\n```\nè¿™é‡Œæœ€åä¹Ÿå°±æ˜¯ä¸ºäº†çš„åˆ°StorageServerå¯¹è±¡ æˆ‘ä»¬å¯ä»¥å†™ä¸ªå·¥å…·ç±»æ–¹ä¾¿æˆ‘ä»¬ä¸Šä¼ ï¼Œå°†å¾—åˆ°çš„fileä¿¡æ¯ç›´æ¥æ”¾åœ¨è™šæ‹Ÿæœºip/åé¢\n![image](http://p3.so.qhimgs1.com/bdr/_240_/t0151a407cda74a2153.png)æˆåŠŸè®¿é—®åˆ°äº†è¿™å¼ å›¾ç‰‡ï¼è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚\n- åœ¨æ·˜æ·˜å•†åŸä¸­çš„è¿ç”¨\n   åœ¨æ·˜æ·˜ä¸­ä¸»è¦æ˜¯ç”¨åœ¨åå°çš„å›¾ç‰‡ä¸Šä¼ ä¸Šçš„ è¿™é‡Œç”¨çš„æ˜¯ssmçš„ç»„åˆSpringMVCä¸Šä¼ å›¾ç‰‡é¦–å…ˆè¦æœ‰commons.ioå’Œfileuploadçš„jaråŒ…è¿˜æœ‰é…ç½®å¤šåª’ä½“è§£æå™¨\nåœ¨è¿™é‡Œæˆ‘ä¹Ÿé‡åˆ°äº†ä¸€ä¸ªå°é—®é¢˜ ä»–åœ¨è¿™é‡Œç”¨çš„æ˜¯*KingEditor* ä¸Šä¼ å›¾ç‰‡æ—¶è¦æ±‚è¿”å›çš„æ ¼å¼æ˜¯\n```  java\n  //æˆåŠŸæ—¶\n  { \n        \"error\" : 0,\n        \"url\" : \"http://www.example.com/path/to/file.ext\"\n}\n//å¤±è´¥æ—¶\n{\n        \"error\" : 1,\n        \"message\" : \"é”™è¯¯ä¿¡æ¯\"\n}\n```\næˆ‘ç›´æ¥è¿”å›çš„ä¸€ä¸ªmapç„¶åå‰å°è§£æä¸å‡ºæ¥å‡ºç°äº†é—®é¢˜åæ¥ç”¨fastJsonæŠŠmapè½¬æˆjsonåå°±å¥½äº†ä½†æ˜¯å…¶å®ä¼ è¿˜æ˜¯ä¼ åˆ°äº†å›¾ç‰‡æœåŠ¡å™¨ä¸Šå»äº†\n\n- åœ¨åšè¿™ä¸ªçš„æ—¶å€™è¿˜é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„é—®é¢˜å°±æ˜¯å¦‚æœä¿®æ”¹ä»£ç åé©¬ä¸Šé‡æ–°å¯åŠ¨é¡¹ç›®ä¼šæŠ¥é”™cleanä¸€ä¸‹å°±å¥½äº†ã€‚","tags":["å…¥é—¨","FastDFS","æ·˜æ·˜å•†åŸ"],"categories":["è¿ç»´"]},{"title":"Nginxå­¦ä¹ ","url":"/2018/05/13/nginx-xue-xi/","content":"# Nginxå­¦ä¹ ç¬”è®°\n- Nginxç®€ä»‹\n  _Nginx_ (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„[HTTP](https://baike.so.com/doc/5366073-5601774.html)å’Œ[åå‘ä»£ç†](https://baike.so.com/doc/5345781-5581226.html)æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªIMAP/POP3/SMTP[æœåŠ¡å™¨](https://baike.so.com/doc/4487696-4696885.html)ã€‚Nginxæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„Rambler.ruç«™ç‚¹(ä¿„æ–‡:Ğ Ğ°Ğ¼Ğ±Ğ»ĞµÑ€)å¼€å‘çš„ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬0.1.0å‘å¸ƒäº2004å¹´10æœˆ4æ—¥ã€‚\nå…¶å°†æºä»£ç ä»¥ç±»BSDè®¸å¯è¯çš„å½¢å¼å‘å¸ƒï¼Œå› å®ƒçš„ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½é›†ã€ç¤ºä¾‹é…ç½®æ–‡ä»¶å’Œä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—è€Œé—»åã€‚2011å¹´6æœˆ1æ—¥ï¼Œnginx 1.0.4å‘å¸ƒã€‚\nNginxæ˜¯ä¸€æ¬¾[è½»é‡çº§](https://baike.so.com/doc/585215-619452.html)çš„[Web](https://baike.so.com/doc/4230501-4432285.html) æœåŠ¡å™¨/[åå‘ä»£ç†](https://baike.so.com/doc/5345781-5581226.html)æœåŠ¡å™¨åŠ[ç”µå­é‚®ä»¶](https://baike.so.com/doc/928072-980969.html)(IMAP/POP3)ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸€ä¸ªBSD-like åè®®ä¸‹å‘è¡Œã€‚å…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œ[å¹¶å‘](https://baike.so.com/doc/6916691-7138566.html)èƒ½åŠ›å¼ºï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›ç¡®å®åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸­å›½å¤§é™†ä½¿ç”¨nginxç½‘ç«™ç”¨æˆ·æœ‰:ç™¾åº¦ã€äº¬ä¸œã€[æ–°æµª](https://baike.so.com/doc/2204905-2333035.html)ã€ç½‘æ˜“ã€[è…¾è®¯](https://baike.so.com/doc/1038695-1098608.html)ã€æ·˜å®ç­‰ã€‚\n\t\n- Nginxä¸»è¦ä½œç”¨\n1. (HttpæœåŠ¡å™¨)å¤„ç†é™æ€æ–‡ä»¶\n![image](http://p0.cdn.img9.top/ipfs/QmdiKx1JUr7y9TabUQNNqu5dP8AwdsHSHe9QMwa487rsaS?0.png)\nåƒè¿™æ ·é…ç½®çš„è¯å½“è®¿é—® *localhost:80* æ—¶å°±ä¼šè®¿é—®åˆ°ç›¸å¯¹å½“å‰è·¯å¾„ä¸‹çš„ htmlæ–‡ä»¶å¤¹ä¸‹çš„index.html æˆ–è€…index.htm\n2. åå‘ä»£ç†\n    **åå‘ä»£ç†** ä¹Ÿæ˜¯nginxç”¨çš„æœ€å¤šçš„åœ°æ–¹ï¼Œæ—¢ç„¶æœ‰åå‘ä»£ç†é‚£å°±è‚¯å®šæœ‰ **æ­£å‘ä»£ç†** å…ˆæ¥ç†è§£ä¸‹æ­£å‘ä»£ç†![image](https://gss0.baidu.com/7LsWdDW5_xN3otqbppnN2DJv/zhidao/pic/item/a2cc7cd98d1001e96d753f76b10e7bec54e79779.jpg)\næ­£å‘ä»£ç†å…¶å®å°±æ˜¯ä»£ç†ä¸Šç½‘ï¼Œ**å®¢æˆ·ç«¯**å‘é€è¯·æ±‚åˆ°ä»£ç†æœåŠ¡å™¨ç„¶åä»£ç†æœåŠ¡å™¨è½¬äº¤è¯·æ±‚ç»™**ç›®æ ‡æœåŠ¡å™¨**ç›®æ ‡æœåŠ¡å™¨å“åº”ç»™ä»£ç†æœåŠ¡å™¨ä»£ç†æœåŠ¡å™¨å†å“åº”ç»™**å®¢æˆ·ç«¯**ä¹Ÿå°±èµ·åˆ°äº†ä»£ç†çš„ä½œç”¨\né‚£åå‘ä»£ç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n![image](https://gss0.baidu.com/7LsWdDW5_xN3otqbppnN2DJv/zhidao/pic/item/a8014c086e061d95f3f21c4172f40ad162d9ca17.jpg)\næ­£å‘ä»£ç†é’ˆå¯¹çš„æ˜¯**å®¢æˆ·ç«¯**è€Œåå‘ä»£ç†æ­£å¯¹çš„æ˜¯**æœåŠ¡ç«¯**\nå½“ç”¨æˆ·å‘é€ä¸€ä¸ªè¯·æ±‚ç»™ServerBç„¶åServerBåˆ¤æ–­ç”¨æˆ·æ˜¯ä»€ä¹ˆè¯·æ±‚\næ˜¯è¯·æ±‚Server1å°±è½¬å‘ç»™Server1... åœ¨ç”Ÿäº§ä¸­å‰ç«¯ç”¨ä¸€ä¸ªNginxå¤„ç†ç”¨æˆ·çš„è¯·æ±‚å†åˆ†å‘åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚\n**é…ç½®**\n```java\nupstream sina{\n\tserver 192.168.125.3:8080;\n    }\n    server {\n        listen       80;\n        server_name  www.sina.com.cn;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            proxy_pass   http://sina;\n            index  index.html index.htm;\n        }\n\n    }\n\n     upstream sohu{\n\tserver 192.168.125.3:8081;\n    }\n    server {\n        listen       80;\n        server_name  www.sohu.com;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n\t\t\t#äº¤ç»™è°ä»£ç†\n            proxy_pass   http://sohu;\n            index  index.html index.htm;\n        }\n\n    }\n```\n\nåƒè¿™æ ·é…ç½®å®¢æˆ·ç«¯è®¿é—®é€šè¿‡ä¸€ä¸ªå…¬ç½‘ipå…¥å£å…ˆåˆ°è¾¾Nginxç„¶åè½¬å‘ç»™å¯¹åº”çš„æœåŠ¡å™¨å½“ç”¨æˆ·è®¿é—®*www.sohu.com*æ—¶å°±ä¼šè½¬å‘ç»™http://sohu è¿™ä¸ªå°±æ˜¯ä¸Šé¢çš„upstream sohu{...} äº¤ç»™å®ƒå¤„ç†\n3. è´Ÿè½½å‡è¡¡å’Œå®¹é”™\n\tè´Ÿè½½å‡è¡¡å°±æ˜¯åœ¨åå‘ä»£ç†çš„ä¸­é—´åŠ ä¸Šçš„ å°±æ˜¯åœ¨upstream é‡Œé¢åŠ ä¸€ä¸ªserverï¼Œæœ€ç®€å•çš„è´Ÿè½½å‡è¡¡å°±æ˜¯è½®è¯¢ä¸€äººä¸€æ¬¡åˆ·æ–°å°±æ¢(*é»˜è®¤çš„å°±æ˜¯è½®è¯¢*) å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®æœåŠ¡å™¨æ€§èƒ½é…ç½®æƒé‡æƒé‡è¶Šå¤§è®¿é—®åˆ°çš„æœºä¼šè¶Šå¤§\n\n```java\nupstream sina{\n\tserver 192.168.125.3:8080;\n\t#weigthæ˜¯æƒé‡\n\tserver 192.168.25.148:8082 weight=2;\n    }\n    server {\n        listen       80;\n        server_name  www.sina.com.cn;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            proxy_pass   http://sina;\n            index  index.html index.htm;\n         }\n       }\n```\nç”±äºNginxæ˜¯æˆ‘ä»¬ç½‘ç«™çš„å…¥å£å¦‚æœNginxæŒ‚æ‰åé¢çš„æœåŠ¡å°±éƒ½å¤±æ•ˆäº†è¿™æ—¶å€™å°±å¯ä»¥åŠ å¤‡ç”¨NginxæœåŠ¡å™¨ç”¨ keepalive+Nginxå®ç°ä¸»å¤‡![image](http://p0.cdn.img9.top/ipfs/Qmc3nC82Xsh1QANbUfAdDGUmTL2KJ2bQzoYzge7VHvRRWu?0.png)\n","tags":["Nginx"],"categories":["Web"]},{"title":"Hexoç¬¬ä¸€ç¯‡åšå®¢","url":"/2018/05/10/hexo-de-di-yi-pian-bo-ke/","content":"ç¬¬ä¸€ç¯‡Hexoåšå®¢\n=====\n- æ‰å¼€å§‹æ¥è§¦*markdown*ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸è¿‡æ„Ÿè§‰è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ ğŸ˜‚  \n\n![image](http://p4.cdn.img9.top/ipfs/QmcPovxCWmXZdSB7GYz1RJUp1twhrnHEeZMDnidv4S5kvB?4.jpg\n)\n- æœ¬æ¥æ˜¯æƒ³æŠŠè¿™ä¸ªåšå®¢æ”¾åˆ°æˆ‘çš„é˜¿é‡Œäº‘ä¸Šçš„ï¼Œä½†æ˜¯æ„Ÿè§‰æ—¥å¸¸å†™å†™åšå®¢ä¹Ÿå¤Ÿäº†ï¼Œç§»è¿‡å»å¯ä»¥è‡ªå·±å†™å†™åå°ä½†æ„Ÿè§‰æœ‰ç‚¹éº»çƒ¦ï¼Œç­‰åˆ°ä»¥åæœ‰æ—¶é—´äº†å†æ¥æŠ˜è…¾ï¼Œæ—¥å¸¸ç”¨ç”¨è¿™ä¸ªé™æ€çš„å°±å¤Ÿäº† ç”¨äº†cdnåŠ é€Ÿè®¿é—®é€Ÿåº¦è¿˜å¯ä»¥ğŸ˜‰\n- å…¶å®ä¹‹å‰è‡ªå·±ä¹Ÿè‡ªå·±åšäº†ä¸€ä¸ªåšå®¢ å‰å°åå°éƒ½æ˜¯è‡ªå·±å†™çš„ å‰ç«¯ä¸å¤ªç†Ÿæ‚‰ç”¨çš„bsï¼Œåå°æ˜¯ssmçš„ æœ¬æ¥æƒ³ä¸Šçº¿çš„ ä½†æ˜¯æ„Ÿè§‰å¤ªä¸‘äº†äº†è€Œä¸”åå°çš„ä»£ç ä¹Ÿè¿˜æœ‰é—®é¢˜ğŸ˜‚æ”¾å¼ å›¾å¯¹æ¯”ä¸‹\n![image](http://p1.cdn.img9.top/ipfs/Qmc73XD1sHrvpEM2Wn8DMSXZcvRGjSW2x7GJPuzhjJa68c?1.jpg\n) å°±è¿™ä¸ªç”»é£ å“åº”å¼ä¹Ÿè¢«æˆ‘ç¦ç”¨äº† å®åœ¨æ˜¯å“åº”çš„å¤ªè¯¡å¼‚äº† å†çœ‹çœ‹*material* \n `Hexoçš„ä¸€æ¬¾ä¸»é¢˜` \n![image](http://p1.cdn.img9.top/ipfs/QmcghHet9V1iE2CXxYnUh9VbwQq6STX3ZpsZqs6ruy657h?1.png)\n\n---\n ![mark](http://static.imlgw.top///20190127/0ddQkCXFDNyh.png?imageslim) ç¬¬2ä¸ªä¸»é¢˜\n\n---\n\nç›®å‰çš„æ˜¯ç¬¬ä¸‰ä¸ª\n\n- è®¤è®¤çœŸçœŸçš„å†™åšå®¢äº†ã€‚","tags":["å…¥é—¨","Hexo","ä½“éªŒ"],"categories":["Hexo"]}]