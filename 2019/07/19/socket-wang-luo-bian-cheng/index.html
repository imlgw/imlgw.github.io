
<!DOCTYPE html>
<html lang="zh-CN">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#202020"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
  
  
    <meta name="keywords" content="Socket," />
  

  
    <meta name="description" content="å¤§æ‚²æ— æ³ªï¼Œå¤§æ‚Ÿæ— è¨€ï¼Œå¤§ç¬‘æ— å£°ã€‚" />
  
  
  
  <link rel="icon" type="image/x-icon" href="/img/cat.ico">
  
  <title>Socketç½‘ç»œç¼–ç¨‹ [ iM1Gw0 ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
    
      <link rel="stylesheet" href="/css/xoxo.css">
    
  
<meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head>


<body>
  <div class="nav-container">
    <nav class="home-menu pure-menu pure-menu-horizontal">
  <a class="pure-menu-heading" href="/">
    
    <span class="title" style="text-transform:none">iM1Gw0</span>
  </a>

  <ul class="pure-menu-list clearfix">
      
          
            
              <li class="pure-menu-item"><a href="/" class="pure-menu-link">é¦–é¡µ</a></li>
            
          
      
          
            
              <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
            
              <a href="#" id="post" class="pure-menu-link">æ–‡ç« </a>
              <ul class="pure-menu-children">
              
                  
                    <li class="pure-menu-item"><a href="/categories" style="color:#202020;" class="pure-menu-link">åˆ†ç±»</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="/archives" style="color:#202020;" class="pure-menu-link">å½’æ¡£</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="/tags" style="color:#202020;" class="pure-menu-link">æ ‡ç­¾</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="/music" style="color:#202020;" class="pure-menu-link">éŸ³ä¹</a></li>
                  
              
              </ul>
            </li>
          
      
          
            
              <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
            
              <a href="#" id="ç®—æ³•" class="pure-menu-link">ç®—æ³•</a>
              <ul class="pure-menu-children">
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/05/04/leetcode-shu-zu/" style="color:#202020;" class="pure-menu-link">æ•°ç»„</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/02/27/leetcode-lian-biao/" style="color:#202020;" class="pure-menu-link">é“¾è¡¨</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/10/01/leetcode-zhan-dui-lie/" style="color:#202020;" class="pure-menu-link">æ ˆ&amp;é˜Ÿåˆ—</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/09/15/leetcode-cha-zhao/" style="color:#202020;" class="pure-menu-link">æŸ¥æ‰¾</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/07/20/leetcode-hua-dong-chuang-kou/" style="color:#202020;" class="pure-menu-link">æ»‘åŠ¨çª—å£</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/09/01/leetcode-dong-tai-gui-hua/" style="color:#202020;" class="pure-menu-link">åŠ¨æ€è§„åˆ’</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/12/06/leetcode-er-fen-cha-zhao/" style="color:#202020;" class="pure-menu-link">äºŒåˆ†æŸ¥æ‰¾</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/11/06/leetcode-er-cha-shu/" style="color:#202020;" class="pure-menu-link">äºŒå‰æ ‘</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/11/29/leetcode-bei-bao-wen-ti/" style="color:#202020;" class="pure-menu-link">èƒŒåŒ…é—®é¢˜</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2019/10/10/leetcode-hui-su/" style="color:#202020;" class="pure-menu-link">å›æº¯</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2020/01/21/leetcode-tan-xin/" style="color:#202020;" class="pure-menu-link">è´ªå¿ƒ</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2020/07/03/leetcode-wei-yun-suan/" style="color:#202020;" class="pure-menu-link">ä½è¿ç®—</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="http://imlgw.top/2020/08/28/leetcode-dan-diao-zhan/" style="color:#202020;" class="pure-menu-link">å•è°ƒæ ˆ</a></li>
                  
              
              </ul>
            </li>
          
      
          
            
              <li class="pure-menu-item"><a href="/project" class="pure-menu-link">Github</a></li>
            
          
      
          
            
              <li class="pure-menu-item"><a href="/search" class="pure-menu-link">æœç´¢</a></li>
            
          
      
          
            
              <li class="pure-menu-item"><a href="/about" class="pure-menu-link">å…³äº</a></li>
            
          
      
  </ul>
   
</nav>

  </div>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <div class="post-container">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        Socketç½‘ç»œç¼–ç¨‹
      </h1>
      <span>
        
        <time class="time" datetime="2019-07-18T16:00:00.000Z">
        2019-07-19
      </time>
        
      </span>
      <span class="slash">/</span>
      <span class="post-meta">
      <span class="post-tags">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Socket/" rel="tag">Socket</a></li></ul>
      </span>
    </span>
      <span class="slash">/</span>
      <span class="read">
      <span id="busuanzi_value_page_pv"></span> ç‚¹å‡»
    </span>
      <span class="slash">/</span>
      <span class="read">é˜…è¯»è€—æ—¶ 32 åˆ†é’Ÿ</span>
    </header>

    <div class="post-content">
      <h3 id="Socketæ¦‚è¿°"><a href="#Socketæ¦‚è¿°" class="headerlink" title="Socketæ¦‚è¿°"></a>Socketæ¦‚è¿°</h3><p>â€‹    å¥—æ¥å­—ï¼ˆsocketï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œå¯å¯¹å…¶è¿›è¡Œåƒå¯¹æ–‡ä»¶ä¸€æ ·çš„æ‰“å¼€ã€è¯»å†™å’Œå…³é—­ç­‰æ“ä½œã€‚å¥—æ¥å­—å…è®¸åº”ç”¨ç¨‹åºå°†I/Oæ’å…¥åˆ°ç½‘ç»œä¸­ï¼Œå¹¶ä¸ç½‘ç»œä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ç½‘ç»œå¥—æ¥å­—æ˜¯IPåœ°å€ä¸ç«¯å£çš„ç»„åˆã€‚socketæä¾›çš„å‡½æ•°æ˜¯<strong>æ“ä½œç³»ç»Ÿå†…æ ¸å°†â€œTCP/IPåè®®æ ˆ + åº•å±‚ç½‘å¡â€æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªä¸ªç”¨æˆ·å‹å¥½çš„å‡½æ•°ï¼Œç”¨äºæ“çºµæœ¬åœ°çš„â€œTCP/IPåè®®æ ˆ + åº•å±‚ç½‘å¡â€ä¸è¿œç«¯çš„æœåŠ¡å™¨/ä¸»æœºå®Œæˆé€šä¿¡çš„ä»»åŠ¡ã€‚</strong></p>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p>ğŸ”¸ TCPæ˜¯é¢å‘è¿æ¥çš„é€šä¿¡åè®®</p>
<p>ğŸ”¸ é€šè¿‡<code>ä¸‰æ¬¡æ¡æ‰‹</code>å»ºç«‹è¿æ¥ï¼Œé€šè®¯å®Œæˆæ—¶è¦æ‹†é™¤è¿æ¥</p>
<p>ğŸ”¸ ç”±äºTCPæ˜¯é¢å‘è¿æ¥çš„æ‰€ä»¥åªèƒ½ç”¨äºç«¯åˆ°ç«¯çš„é€šè®¯</p>
<p>ğŸ”¸ ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</p>
<p>ğŸ”¸ å…·æœ‰æ ¡éªŒæœºåˆ¶ï¼Œå¯é ï¼Œæ•°æ®ä¼ è¾“ç¨³å®š</p>
<h4 id="ç®€å•çš„Socketå°æ¡ˆä¾‹"><a href="#ç®€å•çš„Socketå°æ¡ˆä¾‹" class="headerlink" title="ç®€å•çš„Socketå°æ¡ˆä¾‹"></a>ç®€å•çš„Socketå°æ¡ˆä¾‹</h4><p><strong>Socketå®¢æˆ·ç«¯</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TcpDemo;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 9:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REMOTE_PORT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LOCAL_PORT = <span class="number">30000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Socket socket = creatSocket();</span><br><span class="line">        initSocket(socket);</span><br><span class="line">        <span class="comment">//setRecessAddresså‰</span></span><br><span class="line">        socket.bind(<span class="keyword">new</span> InetSocketAddress(InetAddress.getLocalHost(), LOCAL_PORT));</span><br><span class="line">        <span class="comment">//è¿æ¥è¿œç¨‹server</span></span><br><span class="line">        socket.connect(<span class="keyword">new</span> InetSocketAddress(InetAddress.getLocalHost(), REMOTE_PORT), <span class="number">3000</span>);</span><br><span class="line">        System.out.println(<span class="string">"å®¢æˆ·ç«¯å·²ç»å‘èµ·è¿æ¥"</span>);</span><br><span class="line">        System.out.println(<span class="string">"å®¢æˆ·ç«¯ä¿¡æ¯:"</span> + socket.getLocalAddress() + <span class="string">"port:"</span> + socket.getLocalPort());</span><br><span class="line">        System.out.println(<span class="string">"æœåŠ¡ç«¯ä¿¡æ¯"</span> + socket.getInetAddress() + <span class="string">"port:"</span> + socket.getPort());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sendMsg(socket);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">"è¿æ¥å¼‚å¸¸å…³é—­ï¼ï¼ï¼ï¼"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initSocket</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> SocketException </span>&#123;</span><br><span class="line">        socket.setSoTimeout(<span class="number">3000</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å¤ç”¨æœªå®Œå…¨å…³é—­åçš„ç«¯å£(TIME_WAITçŠ¶æ€)ï¼Œå¿…é¡»åœ¨bindå‰ï¼Œæ‰€ä»¥å°±ä¸èƒ½é€šè¿‡æ„é€ å™¨æ¥ç»‘å®šæœ¬åœ°ç«¯å£</span></span><br><span class="line">        socket.setReuseAddress(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//æ˜¯å¦å¼€å¯Nagleç®—æ³•(é»˜è®¤å¼€å¯) https://baike.baidu.com/item/Nagle%E7%AE%97%E6%B3%95</span></span><br><span class="line">        socket.setTcpNoDelay(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//é•¿æ—¶é—´æ— æ•°æ®ç›¸åº”çš„æ—¶å€™å‘é€ç¡®è®¤æ•°æ®ï¼ˆå¿ƒè·³åŒ…ï¼‰æ—¶é—´å¤§çº¦ä¸¤ä¸ªå°æ—¶</span></span><br><span class="line">        socket.setKeepAlive(<span class="keyword">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          closeå…³é—­åçš„å¤„ç†</span></span><br><span class="line"><span class="comment">          è¿™ä¸ªSocketé€‰é¡¹å¯ä»¥å½±å“closeæ–¹æ³•çš„è¡Œä¸ºã€‚</span></span><br><span class="line"><span class="comment">          false 0 é»˜è®¤æƒ…å†µ å…³é—­åç«‹å³è¿”å›ï¼Œåº•å±‚ç³»ç»Ÿæ¥ç®¡è¾“å‡ºæµï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å‘é€å®Œæˆ</span></span><br><span class="line"><span class="comment">          true 0 å…³é—­åç›´æ¥è¿”å› ç¼“å†²åŒºæ•°æ®ç›´æ¥æŠ›å¼ƒ ç›´æ¥å‘é€RESç»“æŸå‘½ä»¤åˆ°å¯¹æ–¹ï¼Œæ— éœ€ç»è¿‡2MSLç­‰å¾…</span></span><br><span class="line"><span class="comment">          true 200 å…³é—­æ—¶æœ€é•¿é˜»å¡200s éšåæŒ‰ç¬¬äºŒæƒ…å†µå¤„ç†</span></span><br><span class="line"><span class="comment">          (æ˜¯sä¸æ˜¯ms,å¼€å§‹æé”™äº† è®¾ç½®äº†20é‡å¯å°±ä¼šç«¯å£å ç”¨ã€‚ã€‚ã€‚ã€‚)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        socket.setSoLinger(<span class="keyword">true</span>, <span class="number">0</span>);</span><br><span class="line">       </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è®¾ç½®ç´§æ€¥æ•°æ®æ˜¯å¦å†…æ•›,å¦‚æœè¿™ä¸ªSocketé€‰é¡¹æ‰“å¼€ï¼Œ</span></span><br><span class="line"><span class="comment">        å¯ä»¥é€šè¿‡Socketç±»çš„sendUrgentDataæ–¹æ³•</span></span><br><span class="line"><span class="comment">        å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå•å­—èŠ‚çš„æ•°æ® è¿™ä¸ªå•å­—èŠ‚æ•°æ®å¹¶ä¸ç»è¿‡è¾“å‡ºç¼“å†²åŒºï¼Œè€Œæ˜¯ç«‹å³å‘å‡ºã€‚</span></span><br><span class="line"><span class="comment">        è™½ç„¶åœ¨å®¢æˆ·ç«¯å¹¶ä¸æ˜¯ä½¿ç”¨OutputStreamå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œ</span></span><br><span class="line"><span class="comment">        ä½†åœ¨æœåŠ¡ç«¯ç¨‹åºä¸­è¿™ä¸ªå•å­—èŠ‚çš„æ•°æ®æ˜¯å’Œå…¶å®ƒçš„æ™®é€šæ•°æ®æ··åœ¨ä¸€èµ·çš„</span></span><br><span class="line"><span class="comment">        å› æ­¤ï¼Œåœ¨æœåŠ¡ç«¯ç¨‹åºä¸­å¹¶ä¸çŸ¥é“ç”±å®¢æˆ·</span></span><br><span class="line"><span class="comment">        ç«¯å‘è¿‡æ¥çš„æ•°æ®æ˜¯ç”±OutputStream</span></span><br><span class="line"><span class="comment">        è¿˜æ˜¯ç”±sendUrgentDataå‘è¿‡æ¥çš„</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        socket.setOOBInline(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ”¶å‘ç¼“å†²å™¨å¤§å°ï¼Œé»˜è®¤32K</span></span><br><span class="line">        socket.setReceiveBufferSize(<span class="number">64</span>*<span class="number">1024</span>);</span><br><span class="line">        socket.setSendBufferSize(<span class="number">64</span>*<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ€§èƒ½å‚æ•°çš„ ä¼˜å…ˆçº§  çŸ­é“¾æ¥ å»¶è¿Ÿ å¸¦å®½</span></span><br><span class="line">        socket.setPerformancePreferences(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Socket <span class="title">creatSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //æ— ä»£ç†æ¨¡å¼, ç›¸å½“äºç©ºæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">        Socket socket = new Socket(Proxy.NO_PROXY);</span></span><br><span class="line"><span class="comment">        //HTTPä»£ç†æ¨¡å¼ä¼ è¾“çš„æ•°æ®å°†é€šè¿‡www.imlgw.topè½¬å‘</span></span><br><span class="line"><span class="comment">        socket = new Socket(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(Inet4Address.getByName("www.imlgw.top"), 80)));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        //ä¸‹é¢ä¸¤ç§æ–¹å¼å›åœ¨åˆ›å»ºçš„æ—¶å€™å°±å»é“¾æ¥è¿œç¨‹çš„æœåŠ¡å™¨(å…·ä½“çœ‹æºç ),ç„¶è€Œä¸€èˆ¬æƒ…å†µä¸‹å…¶å®åœ¨è¿æ¥ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€äº›å‚æ•°</span></span><br><span class="line"><span class="comment">        //æ–°å»ºä¸€ä¸ªå¥—æ¥å­— é“¾æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å’Œç«¯å£ï¼ˆæœ¬åœ°ç«¯å£ä¸ºç³»ç»Ÿåˆ†é…ï¼‰</span></span><br><span class="line"><span class="comment">        socket = new Socket("imlgw.top", REMOTE_PORT);</span></span><br><span class="line"><span class="comment">        //æ–°å»ºå¥—æ¥å­—ç›´æ¥é“¾æ¥åˆ°è¿œç¨‹ç«¯å£ å¹¶ç»‘å®šæœ¬åœ°ç«¯å£</span></span><br><span class="line"><span class="comment">        socket=new Socket("imlgw.top",REMOTE_PORT,InetAddress.getLocalHost(),LOCAL_PORT);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–°å»ºsocketç„¶åç»‘å®šåˆ°æœ¬åœ°ç«¯å£</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket();</span><br><span class="line">        <span class="keyword">return</span> socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//é”®ç›˜çš„è¾“å…¥æµ</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="comment">//æ‹¿åˆ°socketçš„è¾“å‡ºæµ</span></span><br><span class="line">        OutputStream socketOutputStream = socket.getOutputStream();</span><br><span class="line">        <span class="comment">//è½¬æ¢ä¸ºæ‰“å°æµ</span></span><br><span class="line">        PrintStream printStream = <span class="keyword">new</span> PrintStream(socketOutputStream);</span><br><span class="line">        <span class="comment">//socketçš„è¾“å…¥æµ</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        <span class="comment">//è½¬æ¢ä½bufferæµ</span></span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">//å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">            printStream.println(scanner.nextLine());</span><br><span class="line">            <span class="comment">//æœåŠ¡ç«¯çš„å“åº”</span></span><br><span class="line">            String s = bufferedReader.readLine();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"bye"</span>.equals(s)) &#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"æœåŠ¡ç«¯å“åº”ï¼š"</span> + s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (flag);</span><br><span class="line">        bufferedReader.close();</span><br><span class="line">        printStream.close();</span><br><span class="line">        scanner.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SocketæœåŠ¡ç«¯</strong></p>
<p> è¿™é‡Œä¸ºäº†åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è®¾è®¡æˆäº†<strong>å¤šçº¿ç¨‹</strong>å¼‚æ­¥çš„æ¨¡å¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TcpDemo;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 9:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVER_PORT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket server = creatServerSocket();</span><br><span class="line">        initServerSocket(server);</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ä¹‹åå†ç»‘å®šï¼Œä¸ç„¶ä¸€äº›è®¾ç½®ä¼šå¤±æ•ˆï¼Œæ¯”å¦‚ setReuseAddress</span></span><br><span class="line">        server.bind(<span class="keyword">new</span> InetSocketAddress(InetAddress.getLocalHost(), SERVER_PORT), <span class="number">50</span>);</span><br><span class="line">        System.out.println(<span class="string">"æœåŠ¡å™¨å‡†å¤‡å°±ç»ª"</span>);</span><br><span class="line">        System.out.println(<span class="string">"æœåŠ¡ç«¯ä¿¡æ¯"</span> + server.getInetAddress() + <span class="string">" port:"</span> + server.getLocalPort());</span><br><span class="line">        <span class="comment">//ç›‘å¬å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//é˜»å¡æ–¹æ³•</span></span><br><span class="line">            Socket client = server.accept();</span><br><span class="line">            ClientHandle clientHandle = <span class="keyword">new</span> ClientHandle(client);</span><br><span class="line">            <span class="keyword">new</span> Thread(clientHandle).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initServerSocket</span><span class="params">(ServerSocket server)</span> <span class="keyword">throws</span> SocketException </span>&#123;</span><br><span class="line">        <span class="comment">//åŒclient</span></span><br><span class="line">        server.setReuseAddress(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®acceptçš„buffer</span></span><br><span class="line">        server.setReceiveBufferSize(<span class="number">64</span> * <span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®timeout</span></span><br><span class="line">        <span class="comment">//server.setSoTimeout(2000);</span></span><br><span class="line">        <span class="comment">//è®¾ç½®æ€§èƒ½å‚æ•°,è¿æ¥å‰è®¾ç½®</span></span><br><span class="line">        server.setPerformancePreferences(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ServerSocket <span class="title">creatServerSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket();</span><br><span class="line">        <span class="comment">//ç»‘å®šç«¯å£ backlog:æ–°è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶,ä¸æ˜¯é“¾æ¥çš„æ•°é‡,æ˜¯å…è®¸ç­‰å¾…çš„é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">        <span class="comment">//server.bind(new InetSocketAddress(InetAddress.getLocalHost(),SERVER_PORT),50);</span></span><br><span class="line">        <span class="comment">//server =new ServerSocket(SERVER_PORT,50); ç­‰æ•ˆæ–¹æ¡ˆ</span></span><br><span class="line">        <span class="comment">//server =new ServerSocket(SERVER_PORT,50,InetAddress.getLocalHost());</span></span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientHandle</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">        ClientHandle(Socket client) &#123;</span><br><span class="line">            <span class="keyword">this</span>.socket = client;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š"</span> + socket.getInetAddress() + <span class="string">"portï¼š"</span> + socket.getPort());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//è¾“å…¥æµè·å–ä¿¡æ¯</span></span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line">                <span class="comment">//è¾“å‡ºæµå“åº”å®¢æˆ·ç«¯</span></span><br><span class="line">                PrintStream printStream = <span class="keyword">new</span> PrintStream(socket.getOutputStream());</span><br><span class="line">                <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    String s = reader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">"bye"</span>.equalsIgnoreCase(s)) &#123;</span><br><span class="line">                        flag = <span class="keyword">false</span>;</span><br><span class="line">                        System.out.println(<span class="string">"å®¢æˆ·ç«¯å…³é—­äº†è¿æ¥"</span>);</span><br><span class="line">                        printStream.println(<span class="string">"bye"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(s);</span><br><span class="line">                        printStream.println(<span class="string">"å­—ç¬¦ä¸²é•¿åº¦#"</span> + s.length());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">while</span> (flag);</span><br><span class="line">                reader.close();</span><br><span class="line">                printStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…·ä½“çš„ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•è§£é‡Šéƒ½åœ¨ä»£ç çš„æ³¨é‡Šä¸­ <a href="https://elf8848.iteye.com/blog/1739598" target="_blank" rel="noopener">å‚è€ƒ</a></p>
</blockquote>
<p><img src="http://static.imlgw.top/image/20190707/eBKfzShaiIHU.png?imageslim" alt="mark"></p>
<h4 id="ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹"><a href="#ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹"></a>ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹</h4><p>ä¸Šé¢çš„å“ªä¸ªå°æ¡ˆä¾‹ä¼ é€çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿè®¸æœ‰åŒå­¦ä¼šè¯´è¿™äº›åŸºæœ¬ç±»å‹ä¸éƒ½æ˜¯å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥ä¼ å—ï¼Ÿä¸ºä»€ä¹ˆè¦è´¹é‚£ä¸ªåŠ²å»ä¼ è¿™äº›åŸºæœ¬ç±»å‹ï¼Ÿå…¶å®ä¸ç„¶ï¼Œè¿™é‡Œå‡è®¾è¦ä¼ é€çš„æ˜¯ intç±»å‹çš„12345678 ï¼Œå¦‚æœé€šè¿‡ <code>int</code> æ¥ä¼ è¾“åªè¦åœ¨èŒƒå›´å†…éƒ½æ˜¯<strong>4</strong>ä¸ªå­—èŠ‚å¤§å°å›ºå®šï¼Œç„¶è€Œé€šè¿‡<code>String</code>ä¼ é€å°†ä¼šæ˜¯â€12345678â€ ä¹Ÿå°±æ˜¯<strong>8</strong>ä¸ªå­—èŠ‚ï¼Œæ¶ˆè€—è¦æ¯”ä½¿ç”¨<code>int</code>è¦å¤§ï¼Œè€Œä¸”é•¿åº¦ä¸å›ºå®šï¼Œä¸æ–¹ä¾¿åæœŸæ¥å—çš„é•¿åº¦åˆ¤æ–­ã€‚</p>
<p> <strong><code>int</code> ç±»å‹</strong>  </p>
<p>åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„éƒ½æ˜¯ä»¥<strong>Byte</strong>ä¸ºåŸºæœ¬å•ä½ï¼Œå¦‚æœè¦ä¼ é€<strong>int</strong>æˆ‘ä»¬å°±éœ€è¦å°†<strong>int</strong>è½¬æ¢ä¸º<strong>byte</strong>ï¼Œä¸€ä¸ª<strong>int</strong>æ˜¯4ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª**byte[]**æ•°ç»„ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/11 13:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ByteTools</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] int2byte(<span class="keyword">int</span> a) &#123;</span><br><span class="line">        <span class="comment">//æ— ç¬¦å·å³ç§»</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;</span><br><span class="line">                (<span class="keyword">byte</span>) (a &gt;&gt;&gt; <span class="number">24</span>),</span><br><span class="line">                (<span class="keyword">byte</span>) (a &gt;&gt;&gt; <span class="number">16</span>),</span><br><span class="line">                (<span class="keyword">byte</span>) (a &gt;&gt;&gt; <span class="number">8</span>),</span><br><span class="line">                (<span class="keyword">byte</span>) (a)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">byte2int</span><span class="params">(<span class="keyword">byte</span>[] a)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//&amp;0xff--&gt;è½¬æ¢ä¸ºint å°†é«˜ä½è¡¥0,ä½8ä½ä¸å˜</span></span><br><span class="line">        <span class="comment">//-127 ï¼š10000001(è¡¥) &amp;0xff --&gt; 00000000 00000000 00000000 10000001</span></span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">3</span>] &amp; <span class="number">0xff</span> | (a[<span class="number">2</span>] &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">8</span> | (a[<span class="number">1</span>] &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">16</span> | (a[<span class="number">0</span>] &amp; <span class="number">0xff</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆè¿™æ ·åšçš„ä¸€äº›ç»†èŠ‚å¯ä»¥å‚è€ƒ <a href="https://www.cnblogs.com/think-in-java/p/5527389.html" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a></p>
<p>æœ‰äº†è¿™ä¸ªå·¥å…·ç±»æˆ‘ä»¬å°±å¯ä»¥å°†<strong>int</strong>è½¬æ¢ä¸º**byte[]**åè¿›è¡Œä¼ è¾“ï¼ŒåŒæ—¶æ¥æ”¶ç«¯ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•å°†æ•°æ®è¿˜åŸã€‚</p>
<p>ç­‰ç­‰ğŸ™„ ï¼Œè¿™æ ·ä¸€æ¥ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹å¯¹åº”çš„éƒ½è¦å»å†™ä¸ªè¿™æ ·çš„è½¬æ¢çš„æ–¹æ³•ï¼Ÿé‚£è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œæ‰€ä»¥è¿™æ ·çš„äº‹æƒ…<strong>JDK</strong>å¸®æˆ‘ä»¬åšäº†</p>
<p><strong><code>ByteBuffer</code>**ï¼šnioä¸­çš„ä¸€ä¸ªåŒ…ï¼Œè¿™é‡Œæˆ‘è¿˜ä¸å¤ªç†Ÿæ‚‰è¿™ä¸ªå…·ä½“çš„ä½œç”¨ï¼Œç›®å‰åªçŸ¥é“å¯ä»¥ç”¨æ¥åŒ…è£…</strong>byte[]**ï¼Œç„¶åå¯ä»¥å®ç°ä¸Šé¢çš„ç±»å‹è½¬æ¢</p>
<p><strong>Clientå‘é€ç«¯</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] buffer=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">256</span>];</span><br><span class="line"><span class="comment">//åŒ…è£…buffer (è£…é¥°å™¨æ¨¡å¼ï¼Ÿ</span></span><br><span class="line">ByteBuffer byteBuffer = ByteBuffer.wrap(buffer);</span><br><span class="line"><span class="comment">//byte  1</span></span><br><span class="line">byteBuffer.put((<span class="keyword">byte</span>) <span class="number">126</span>);</span><br><span class="line"><span class="comment">//int ç±»å‹ 4</span></span><br><span class="line">byteBuffer.putInt(<span class="number">123</span>);</span><br><span class="line"><span class="comment">//char 2(unicode)</span></span><br><span class="line">byteBuffer.putChar(<span class="string">'A'</span>);</span><br><span class="line"><span class="comment">//long 8</span></span><br><span class="line">byteBuffer.putLong(<span class="number">323333231234124321L</span>);</span><br><span class="line"><span class="keyword">boolean</span> isOk=<span class="keyword">true</span>;</span><br><span class="line"><span class="comment">//byte 1</span></span><br><span class="line">byteBuffer.put((<span class="keyword">byte</span>) (isOk?<span class="number">1</span>:<span class="number">0</span>));</span><br><span class="line"><span class="comment">//float 4</span></span><br><span class="line">byteBuffer.putFloat(<span class="number">123.2132F</span>);</span><br><span class="line"><span class="comment">//double 8 =28</span></span><br><span class="line">byteBuffer.putDouble(<span class="number">231.1412421321</span>);</span><br><span class="line"><span class="comment">//String 10</span></span><br><span class="line">byteBuffer.put(<span class="string">"HelloWorld"</span>.getBytes());</span><br><span class="line"><span class="comment">//å‘é€ 38 Byte </span></span><br><span class="line">socketOutputStream.write(buffer,<span class="number">0</span>,byteBuffer.position());</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯æœ€å<strong>write</strong>çš„æ—¶å€™ï¼Œç¬¬äºŒä¸ªå‚æ•°<strong>len</strong>ï¼Œç›´æ¥ä¼ <strong>position()</strong>,å°±å¯ä»¥äº†ï¼Œä¸ç”¨+1ï¼Œè¿™ä¸ªpositionæ˜¯ä¸‹ä¸€ä¸ªå­—èŠ‚ä½ç½®</p>
<blockquote>
<p>è¿™é‡Œå…¶å®æˆ‘çœ‹çš„æ•™ç¨‹è¿™é‡Œæ˜¯åŠ 1äº†çš„ï¼Œæœ€åæ¥æ”¶è¿‡æ¥çš„æ•°æ®é•¿åº¦æ­»æ´»å¯¹ä¸ä¸Šï¼Œæˆ‘å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä»€ä¹ˆ<strong>å†…å­˜å¯¹é½</strong>ï¼Œä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„ç„¶åæ‰å‘ç°æ˜¯è¿™é‡Œæœ‰é—®é¢˜ã€‚ã€‚ã€‚</p>
</blockquote>
<p><strong>Serveræ¥æ”¶ç«¯</strong></p>
<p>åŸºæœ¬ç±»å‹çš„è¯»å–ä¸ä¸Šé¢å¯¹åº”çš„<strong>get</strong>ï¼Œæœ€åä¸€ä¸ªStringéœ€è¦æ³¨æ„ï¼Œç›´æ¥ç”¨åŸå§‹çš„<strong>buffer</strong>å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å€ŸåŠ©<strong>ByteBuffer</strong>ï¼Œè¿™é‡ŒåŒæ ·åé¢ä¸ç”¨-1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String str = <span class="keyword">new</span> String(buffer, byteBuffer.position(), readByteCount-byteBuffer.position());</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æœåŠ¡å™¨å‡†å¤‡å°±ç»ª</span><br><span class="line">æœåŠ¡ç«¯ä¿¡æ¯LAPTOP-V5R5ABUJ/<span class="number">192.168</span><span class="number">.25</span><span class="number">.1</span> port:<span class="number">20000</span></span><br><span class="line">æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š/<span class="number">192.168</span><span class="number">.25</span><span class="number">.1</span>portï¼š<span class="number">30000</span></span><br><span class="line">å½“å‰ä¸‹æ ‡<span class="number">28</span></span><br><span class="line">æ¥å—åˆ°Clientæ•°æ®é•¿åº¦(<span class="keyword">byte</span>)ï¼š<span class="number">38</span></span><br><span class="line">Clientå‘é€çš„æ•°æ®:</span><br><span class="line"><span class="number">126</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line">A</span><br><span class="line"><span class="number">323333231234124321</span></span><br><span class="line"><span class="keyword">true</span></span><br><span class="line"><span class="number">123.2132</span></span><br><span class="line"><span class="number">231.1412421321</span></span><br><span class="line">HelloWorld</span><br></pre></td></tr></table></figure>

<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p>ğŸ”¸  UDPæ˜¯æ— è¿æ¥çš„ï¼Œå³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚</p>
<p>ğŸ”¸  UDPä½¿ç”¨å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨ã€‚</p>
<p>ğŸ”¸   UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡ã€‚</p>
<p>ğŸ”¸   UDPæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ã€‚å¾ˆå¤šçš„å®æ—¶åº”ç”¨ï¼ˆå¦‚IPç”µè¯ã€å®æ—¶è§†é¢‘ä¼šè®®ç­‰ï¼‰è¦å»æºä¸»æœºä»¥æ’å®šçš„é€Ÿç‡å‘é€æ•°æ®ï¼Œå¹¶ä¸”å…è®¸åœ¨ç½‘ç»œå‘ç”Ÿæ‹¥å¡æ—¶ä¸¢å¤±ä¸€äº›æ•°æ®ï¼Œä½†å´ä¸å…è®¸æ•°æ®æœ‰å¤ªå¤šçš„æ—¶å»¶ã€‚UDPæ­£å¥½ç¬¦åˆè¿™ç§è¦æ±‚ã€‚</p>
<p>ğŸ”¸   UDPæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚</p>
<p>ğŸ”¸   UDPçš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ¯”TCPçš„20ä¸ªå­—èŠ‚çš„é¦–éƒ¨è¦çŸ­ã€‚</p>
<h4 id="å•æ’­"><a href="#å•æ’­" class="headerlink" title="å•æ’­"></a>å•æ’­</h4><p><strong>æ¶ˆæ¯æ¥æ”¶è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPProvide</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//ç›‘å¬20000ç«¯å£</span></span><br><span class="line">        DatagramSocket socket=<span class="keyword">new</span> DatagramSocket(<span class="number">20000</span>);</span><br><span class="line">        System.out.println(<span class="string">"UDPProvide is start...."</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">        <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket</span></span><br><span class="line">        DatagramPacket udp_receive=<span class="keyword">new</span> DatagramPacket(buf,buf.length);</span><br><span class="line">        <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket (é˜»å¡)</span></span><br><span class="line">        socket.receive(udp_receive);</span><br><span class="line">        <span class="comment">//è·å–å‘é€äººçš„SocketAddress</span></span><br><span class="line">        SocketAddress socketAddress = udp_receive.getSocketAddress();</span><br><span class="line">        <span class="keyword">int</span> datalen = udp_receive.getLength();</span><br><span class="line">        <span class="comment">//è·å–å‘é€çš„æ•°æ®</span></span><br><span class="line">        String receive=<span class="keyword">new</span> String(udp_receive.getData(),<span class="number">0</span>,datalen);</span><br><span class="line">        System.out.println(<span class="string">"receive from the: "</span>+socketAddress);</span><br><span class="line">        System.out.println(<span class="string">"receive data: "</span>+ receive);</span><br><span class="line">        <span class="comment">//æ„å»ºå“åº”çš„DatagramPacket</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = (<span class="string">"provider receive the data success "</span>+datalen).getBytes();</span><br><span class="line">        DatagramPacket udp_sendBack=<span class="keyword">new</span> DatagramPacket(bytes,bytes.length,socketAddress);</span><br><span class="line">        socket.send(udp_sendBack);</span><br><span class="line">        <span class="comment">//ç»“æŸ</span></span><br><span class="line">        System.out.println(<span class="string">"UDPProvide Finished."</span>);</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¶ˆæ¯å‘é€è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPSearch</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch is ready..."</span>);</span><br><span class="line">        <span class="comment">//æ„å»ºsocket</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">        <span class="keyword">byte</span>[] buff= <span class="string">"hello world"</span>.getBytes();</span><br><span class="line">        <span class="comment">//æ„å»ºå‘é€æ®µ</span></span><br><span class="line">        DatagramPacket udp_send=<span class="keyword">new</span> DatagramPacket(buff,buff.length);</span><br><span class="line">        <span class="comment">//æŒ‡å®šå¯¹æ–¹ip</span></span><br><span class="line">        udp_send.setAddress(InetAddress.getLocalHost());</span><br><span class="line">        udp_send.setPort(<span class="number">20000</span>);</span><br><span class="line">        socket.send(udp_send);</span><br><span class="line">        <span class="comment">//è·å–å“åº”æ®µ</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">        DatagramPacket udp_receive=<span class="keyword">new</span> DatagramPacket(buf,buf.length);</span><br><span class="line">        socket.receive(udp_receive);</span><br><span class="line">        String s = <span class="keyword">new</span> String(udp_receive.getData(), <span class="number">0</span>, udp_receive.getLength());</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch is over"</span>);</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¤šæ’­-amp-å¹¿æ’­"><a href="#å¤šæ’­-amp-å¹¿æ’­" class="headerlink" title="å¤šæ’­&amp;å¹¿æ’­"></a>å¤šæ’­&amp;å¹¿æ’­</h4><p><strong>æ¶ˆæ¯å»ºé€ å™¨</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/8 8:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageCreator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SN_HEADER = <span class="string">"æ”¶åˆ°æš—å·,æˆ‘æ˜¯SN:"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PORT_HEADER = <span class="string">"è¿™æ˜¯æš—å·,è¯·å›é€åˆ°è¯¥ç«¯å£:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">buildWithPort</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PORT_HEADER + port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parsePort</span><span class="params">(String sn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sn.startsWith(PORT_HEADER)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(sn.substring(PORT_HEADER.length()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">buildWithSn</span><span class="params">(String sn)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SN_HEADER+sn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">parseSn</span><span class="params">(String sn)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sn.startsWith(SN_HEADER))&#123;</span><br><span class="line">            <span class="keyword">return</span> sn.substring(SN_HEADER.length());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¶ˆæ¯æ¥å—è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UdpDemo2;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPProvide</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> PROVIDE_LISTEN_PORT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String sn = UUID.randomUUID().toString();</span><br><span class="line">        Provider provider = <span class="keyword">new</span> Provider(sn);</span><br><span class="line">        <span class="keyword">new</span> Thread(provider).start();</span><br><span class="line">        System.in.read();</span><br><span class="line">        provider.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> isDone = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">public</span> DatagramSocket socket = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> String sn;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Provider</span><span class="params">(String sn)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.sn = sn;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"UDPProvide is start...."</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = <span class="keyword">new</span> DatagramSocket(PROVIDE_LISTEN_PORT);</span><br><span class="line">                <span class="keyword">while</span> (!isDone) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket</span></span><br><span class="line">                    DatagramPacket udp_receive = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">                    <span class="comment">//æ¥å—DatagramPacket (é˜»å¡)</span></span><br><span class="line">                    socket.receive(udp_receive);</span><br><span class="line">                    <span class="comment">//è·å–å‘é€äººçš„SocketAddress</span></span><br><span class="line">                    InetSocketAddress socketAddress = (InetSocketAddress) udp_receive.getSocketAddress();</span><br><span class="line">                    <span class="keyword">int</span> datalen = udp_receive.getLength();</span><br><span class="line">                    <span class="comment">//è·å–å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">                    String receive = <span class="keyword">new</span> String(udp_receive.getData(), <span class="number">0</span>, datalen);</span><br><span class="line">                    <span class="comment">//æ‰“å°è·å–åˆ°çš„æ•°æ®</span></span><br><span class="line">                    System.out.println(<span class="string">"receive from the: "</span> + socketAddress);</span><br><span class="line">                    System.out.println(<span class="string">"receive data: "</span> + receive);</span><br><span class="line">                    <span class="comment">//è§£æsn,è·å–éœ€è¦å›é€çš„ç«¯å£</span></span><br><span class="line">                    <span class="keyword">int</span> port = MessageCreator.parsePort(receive);</span><br><span class="line">                    <span class="keyword">if</span> (port != -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">//æ„å»ºå›é€çš„DatagramPacket</span></span><br><span class="line">                        <span class="keyword">byte</span>[] responseBody = MessageCreator.buildWithSn(sn).getBytes();</span><br><span class="line">                        DatagramPacket udp_sendBack = <span class="keyword">new</span> DatagramPacket(responseBody, <span class="number">0</span>, responseBody.length, socketAddress.getAddress(), port);</span><br><span class="line">                        socket.send(udp_sendBack);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="comment">// e.printStackTrace();</span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                closeRes();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ç»“æŸ</span></span><br><span class="line">            System.out.println(<span class="string">"UDPProvide Finished."</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            isDone = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">//è¿™é‡Œä»…ä»…isDone=true è¿œè¿œä¸å¤Ÿ,å› ä¸ºsocket.receiveæ˜¯ä¸€ä¸ªæ°¸ä¹…é˜»å¡çš„æ–¹æ³•</span></span><br><span class="line">            <span class="comment">//æ‰€ä»¥ä¸‹é¢è¿˜è¦closeè¿™ä¸ªsocketè¿™æ ·å°±ä¼šæ•è·åˆ°ä¸€ä¸ªå¼‚å¸¸ç„¶åç»“æŸ</span></span><br><span class="line">            closeRes();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeRes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">                socket.close();</span><br><span class="line">                socket = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¸Šé¢ä¸åŒçš„æ˜¯è¿™é‡Œä¸ºäº†éšæ—¶å¯ä»¥åœæ­¢å°†å…¶æ„å»ºæˆäº†å¼‚æ­¥çº¿ç¨‹ï¼Œå½“æ¥å—åˆ°ç»ˆæ­¢ä¿¡å·çš„æ—¶å€™å°±ä¼šæ”¹å˜çŠ¶æ€é‡ï¼Œå¹¶closeèµ„æºï¼Œç„¶ååˆ©ç”¨å¼‚å¸¸åœæ­¢çº¿ç¨‹ã€‚</p>
<p><strong>æ¶ˆæ¯å‘é€è€…</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UdpDemo2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/7 21:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPSearch</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SEARCH_LISTEN_PORT = <span class="number">30000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DatagramSocket socket = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch is start..."</span>);</span><br><span class="line">        Listener listen = listen();</span><br><span class="line">        sendBoard();</span><br><span class="line">        System.in.read();</span><br><span class="line">        List&lt;Device&gt; devices = listen.closeAndGetDeviceList();</span><br><span class="line">        <span class="keyword">for</span> (Device device : devices) &#123;</span><br><span class="line">            System.out.println(device);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Listener <span class="title">listen</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch Listener is start"</span>);</span><br><span class="line">        CountDownLatch countDownLatch=<span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">        Listener listener=<span class="keyword">new</span> Listener(SEARCH_LISTEN_PORT,countDownLatch);</span><br><span class="line">        <span class="keyword">new</span> Thread(listener).start();</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        <span class="keyword">return</span> listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendBoard</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„ç«¯å£</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">        <span class="comment">//æ„å»ºsocket</span></span><br><span class="line">        <span class="keyword">byte</span>[] buff = MessageCreator.buildWithPort(SEARCH_LISTEN_PORT).getBytes();</span><br><span class="line">        <span class="comment">//æ„å»ºå‘é€æ®µ</span></span><br><span class="line">        DatagramPacket udp_send = <span class="keyword">new</span> DatagramPacket(buff, buff.length);</span><br><span class="line">        <span class="comment">//å¹¿æ’­åœ°å€</span></span><br><span class="line">        udp_send.setAddress(InetAddress.getByName(<span class="string">"255.255.255.255"</span>));</span><br><span class="line">        <span class="comment">//æ¥æ”¶æ–¹çš„ç«¯å£</span></span><br><span class="line">        udp_send.setPort(UDPProvide.PROVIDE_LISTEN_PORT);</span><br><span class="line">        socket.send(udp_send);</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">"UDPSearch Board is over"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Device</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> port;</span><br><span class="line">        String ip;</span><br><span class="line">        String sn;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Device</span><span class="params">(<span class="keyword">int</span> port, String ip, String sn)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.port = port;</span><br><span class="line">            <span class="keyword">this</span>.ip = ip;</span><br><span class="line">            <span class="keyword">this</span>.sn = sn;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Device&#123;"</span> +</span><br><span class="line">                    <span class="string">"port="</span> + port +</span><br><span class="line">                    <span class="string">", ip='"</span> + ip + <span class="string">'\''</span> +</span><br><span class="line">                    <span class="string">", sn='"</span> + sn + <span class="string">'\''</span> +</span><br><span class="line">                    <span class="string">'&#125;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Listener</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> listenPort;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CountDownLatch countDownLatch;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Device&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;Device&gt;();</span><br><span class="line">        <span class="comment">//private static DatagramSocket socket = null;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isDone = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Listener</span><span class="params">(<span class="keyword">int</span> listenPort, CountDownLatch countDownLatch)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.listenPort = listenPort;</span><br><span class="line">            <span class="keyword">this</span>.countDownLatch = countDownLatch;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">//é€šçŸ¥å·²ç»å¯åŠ¨</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = <span class="keyword">new</span> DatagramSocket(listenPort);</span><br><span class="line">                <span class="keyword">while</span> (!isDone) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    <span class="comment">//æ„å»ºæ¥å—çš„DatagramPacket</span></span><br><span class="line">                    DatagramPacket udp_receive = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">                    <span class="comment">//æ¥å—DatagramPacket (é˜»å¡)</span></span><br><span class="line">                    socket.receive(udp_receive);</span><br><span class="line">                    <span class="comment">//è·å–å‘é€äººçš„SocketAddress</span></span><br><span class="line">                    InetSocketAddress socketAddress = (InetSocketAddress) udp_receive.getSocketAddress();</span><br><span class="line">                    <span class="keyword">int</span> datalen = udp_receive.getLength();</span><br><span class="line">                    <span class="comment">//è·å–å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">                    String sn = <span class="keyword">new</span> String(udp_receive.getData(), <span class="number">0</span>, datalen);</span><br><span class="line">                    System.out.println(<span class="string">"back from theï¼š"</span> + socketAddress);</span><br><span class="line">                    System.out.println(<span class="string">"back dataï¼š"</span> + sn);</span><br><span class="line">                    sn=MessageCreator.parseSn(sn);</span><br><span class="line">                    <span class="keyword">if</span> (sn != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        deviceList.add(<span class="keyword">new</span> Device(socketAddress.getPort(), socketAddress.getAddress().toString(), sn));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">               <span class="comment">//e.printStackTrace();</span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                closeRes();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"UDPSearch Listener is Finished..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeRes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">                socket.close();</span><br><span class="line">                socket = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">List&lt;Device&gt; <span class="title">closeAndGetDeviceList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            isDone = <span class="keyword">true</span>;</span><br><span class="line">            closeRes();</span><br><span class="line">            <span class="keyword">return</span> deviceList;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯å¹¿æ’­çš„åœ°å€<strong>255.255.255.255</strong></p>
<blockquote>
<p>å¦‚æœæ˜¯åœ¨å±€åŸŸç½‘å†…å’Œå…¶ä»–æœºå™¨é€šä¿¡éœ€è¦å…³é—­è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œä¸ç„¶æ˜¯èµ°çš„è™šæ‹Ÿæœºçš„ç½‘å¡ï¼Œå…¶ä»–æœºå™¨æ¥æ”¶ä¸åˆ°ã€‚(æˆ‘è¯´æ€ä¹ˆå‘é€çš„<strong>IP</strong>ä¸æ˜¯æˆ‘çš„æœ¬æœºçš„<strong>IP</strong>)</p>
</blockquote>
<p>ğŸ”¸UDPæ˜¯é¢å‘æ— è¿æ¥çš„é€šè®¯åè®®ï¼ŒåŸºäºç”¨æˆ·æ•°æ®æŠ¥çš„åè®®</p>
<p>ğŸ”¸UDPæ•°æ®åŒ…æ‹¬ç›®çš„ç«¯å£å·å’Œæºç«¯å£å·ä¿¡æ¯</p>
<p>ğŸ”¸é€šè®¯ä¸éœ€è¦è¿æ¥ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¹¿æ’­å‘é€ï¼Œå¹¶ä¸å±€é™äºç«¯åˆ°ç«¯</p>
<p>ğŸ”¸ç»“æ„ç®€å•ï¼Œæ— æ ¡éªŒï¼Œé€Ÿåº¦å¿«ï¼Œå®¹æ˜“ä¸¢åŒ…ï¼Œå¯å¹¿æ’­</p>
<p>ğŸ”¸ä»–ä¸€æ—¦æŠŠåº”ç”¨ç¨‹åºå‘ç»™ç½‘ç»œå±‚çš„æ•°æ®å‘é€å‡ºå»å°±ä¸ä¿ç•™æ•°æ®å¤‡ä»½</p>
<h3 id="UDPè¾…åŠ©TCP-å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“"><a href="#UDPè¾…åŠ©TCP-å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“" class="headerlink" title="UDPè¾…åŠ©TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“"></a>UDPè¾…åŠ©TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“</h3><p>å®¢æˆ·ç«¯å…ˆåˆ©ç”¨<code>UDP</code>å‘å±€åŸŸç½‘å‘é€å¹¿æ’­ï¼Œç„¶åå¯¹åº”çš„æœåŠ¡å™¨æ¥æ”¶åˆ°ä¹‹åå°±ä¼šå°†å¯¹åº”çš„<code>TCP</code>çš„ç«¯å£å›é€ç»™å®¢æˆ·ç«¯ï¼Œç„¶åäºŒè€…è¿›è¡ŒTCPçš„åŒå‘é€šä¿¡ï¼Œä»£ç å¤ªå¤šè¿™é‡Œå°±åªæ”¾ä¸€ä¸‹<code>Server</code>ç«¯çš„<code>Handler</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> udp_tcp_concurrency.server.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> udp_tcp_concurrency.utils.CloseUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> imlgw.top</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/7/17 11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">ClientHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerReadHandler serverReadHandler;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerWriterHandler serverWriterHandle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CloseNotify closeNotify;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientHandler</span><span class="params">(Socket socket, CloseNotify closeNotify)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.socket = socket;</span><br><span class="line">        <span class="keyword">this</span>.serverReadHandler = <span class="keyword">new</span> ServerReadHandler(socket.getInputStream());</span><br><span class="line">        <span class="keyword">this</span>.serverWriterHandle = <span class="keyword">new</span> ServerWriterHandler(socket.getOutputStream());</span><br><span class="line">        <span class="keyword">this</span>.closeNotify = closeNotify;</span><br><span class="line">        System.out.println(<span class="string">"æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š"</span> + socket.getInetAddress() + <span class="string">"portï¼š"</span> + socket.getPort());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        serverWriterHandle.send(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»å¤–ç•Œå…³é—­</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        serverReadHandler.stopRead();</span><br><span class="line">        serverWriterHandle.stopWriter();</span><br><span class="line">        CloseUtils.close(socket);</span><br><span class="line">        System.out.println(<span class="string">"å®¢æˆ·ç«¯å·²ç»é€€å‡º"</span>);</span><br><span class="line">        System.out.println(<span class="string">"address:"</span> + socket.getInetAddress() + <span class="string">",port:"</span> + socket.getPort());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªæˆ‘å…³é—­---&gt;è‡ªé—­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopByMyself</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stop();</span><br><span class="line">        closeNotify.onSelfClosed(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯»å–å¹¶æ‰“å°åˆ°å±å¹•(å¯åŠ¨ClientReadHandleçº¿ç¨‹)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read2Print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(serverReadHandler).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  å°†å·²ç»å…³é—­çš„handleæš´éœ²ç»™TCPServerç„¶åä»listä¸­ç§»é™¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CloseNotify</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onSelfClosed</span><span class="params">(ClientHandler clientHandler)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœåŠ¡ç«¯ç”¨äºè¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯çš„ Handle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ServerReadHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> InputStream inputStream;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServerReadHandler</span><span class="params">(InputStream inputStream)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.inputStream = inputStream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//è¾“å…¥æµè·å–ä¿¡æ¯</span></span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    String s = reader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        System.out.println(<span class="string">"å®¢æˆ·ç«¯å·²ç»æ— æ³•å‘é€æ•°æ®"</span>);</span><br><span class="line">                        <span class="comment">//ç»“æŸå½“å‰Handle</span></span><br><span class="line">                        ClientHandler.<span class="keyword">this</span>.stopByMyself();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//æ‰“å°åˆ°å±å¹•</span></span><br><span class="line">                    System.out.println(s);</span><br><span class="line">                &#125; <span class="keyword">while</span> (!done);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!done) &#123;</span><br><span class="line">                    <span class="comment">//éæ­£å¸¸å…³é—­</span></span><br><span class="line">                    System.err.println(<span class="string">"è¿æ¥å¼‚å¸¸æ–­å¼€"</span>+e.getMessage());</span><br><span class="line">                    ClientHandler.<span class="keyword">this</span>.stopByMyself();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                CloseUtils.close(inputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            done = <span class="keyword">true</span>;</span><br><span class="line">            CloseUtils.close(inputStream);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„Handle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ServerWriterHandler</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> PrintStream printStream;</span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServerWriterHandler</span><span class="params">(OutputStream outputStream)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.printStream = <span class="keyword">new</span> PrintStream(outputStream);</span><br><span class="line">            <span class="comment">//å•ä¾‹çº¿ç¨‹æ± </span></span><br><span class="line">            executorService = Executors.newSingleThreadExecutor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œå¦‚æœä¸ç”¨çº¿ç¨‹æ± </span></span><br><span class="line">            executorService.submit(<span class="keyword">new</span> WriteRunnable(str));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ± çš„Runnable</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">WriteRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">WriteRunnable</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.msg = msg;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(ServerWriterHandler.<span class="keyword">this</span>.done)&#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ServerWriterHandler.<span class="keyword">this</span>.printStream.println(msg);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    System.out.println(<span class="string">"write å¼‚å¸¸é€€å‡ºï¼š"</span>+e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopWriter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            done = <span class="keyword">true</span>;</span><br><span class="line">            CloseUtils.close(printStream);</span><br><span class="line">            executorService.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ä»£ç æ”¾åœ¨ <a href="https://github.com/imlgw/socketDemo" target="_blank" rel="noopener">github</a> æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç”¨äº†ä¸€ä¸ªå•çº¿ç¨‹æ± å»å¤„ç†æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œè¿™é‡Œå…¶å®ç”¨çº¿ç¨‹é€šä¿¡æœºåˆ¶<code>wait/notify</code>ä¹Ÿå¯ä»¥åšåˆ°ä½†æ˜¯ç›¸æ¯”ä½¿ç”¨çº¿ç¨‹æ± ä¼šå¤æ‚è®¸å¤šã€‚</p>
<h3 id="å±€åŸŸç½‘èŠå¤©å®¤å®ç°"><a href="#å±€åŸŸç½‘èŠå¤©å®¤å®ç°" class="headerlink" title="å±€åŸŸç½‘èŠå¤©å®¤å®ç°"></a>å±€åŸŸç½‘èŠå¤©å®¤å®ç°</h3><blockquote>
<p>è¿™é‡Œçš„èŠå¤©å®¤ï¼Œå…¶å®å…³é”®çš„åœ°æ–¹å°±åœ¨äºå¯¹å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯äº¤ç”±æœåŠ¡ç«¯è¿›è¡Œè½¬å‘ã€‚</p>
</blockquote>
<p>åŸºäºä¸Šé¢çš„è¿›è¡Œæ”¹é€ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å›è°ƒæ¥å£</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClientHandleCallBack</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å°†å·²ç»å…³é—­çš„handleæš´éœ²ç»™TCPServerç„¶åä»listä¸­ç§»é™¤</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onSelfClosed</span><span class="params">(ClientHandler clientHandler)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å°†æ¶ˆæ¯äº¤ç»™æœåŠ¡å™¨è½¬å‘</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> clientHandler</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onNewMessageArrived</span><span class="params">(ClientHandler clientHandler,String msg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¢åŠ ä¸€ä¸ªæ¶ˆæ¯æŠµè¾¾çš„æ¥å£ï¼Œç„¶åä¸ºäº†é¿å…é˜»å¡äº¤ç»™å¼‚æ­¥çš„å•çº¿ç¨‹æ± å»å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNewMessageArrived</span><span class="params">(ClientHandler clientHandler, String msg)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"Receive from:"</span>+clientHandler.getClientInfo()+<span class="string">" msg:"</span>+msg);</span><br><span class="line">       forwardThreadPool.submit(()-&gt;&#123;</span><br><span class="line">           <span class="keyword">for</span> (ClientHandler clientHandle : clientHandles) &#123;</span><br><span class="line">               <span class="comment">//è·³è¿‡è‡ªå·±</span></span><br><span class="line">               <span class="keyword">if</span>(clientHandle.equals(clientHandler))&#123;</span><br><span class="line">                   <span class="keyword">continue</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//å¯¹å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">               clientHandle.send(msg);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†ä»£ç  è§<a href="https://github.com/imlgw/socketDemo" target="_blank" rel="noopener">Github</a></p>

    </div>

  </article>
  <div class="toc-container">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">ç›®å½•</strong>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Socketæ¦‚è¿°"><span class="toc-text">Socketæ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP"><span class="toc-text">TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ç®€å•çš„Socketå°æ¡ˆä¾‹"><span class="toc-text">ç®€å•çš„Socketå°æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹"><span class="toc-text">ä¼ è¾“åŸºæœ¬æ•°æ®ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP"><span class="toc-text">UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å•æ’­"><span class="toc-text">å•æ’­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å¤šæ’­-amp-å¹¿æ’­"><span class="toc-text">å¤šæ’­&amp;å¹¿æ’­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDPè¾…åŠ©TCP-å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“"><span class="toc-text">UDPè¾…åŠ©TCP å®ç°ç‚¹å¯¹ç‚¹ä¼ è¾“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å±€åŸŸç½‘èŠå¤©å®¤å®ç°"><span class="toc-text">å±€åŸŸç½‘èŠå¤©å®¤å®ç°</span></a></li></ol>
  </div>


  </div>
</div>

    <section id="comments" style="margin:10px;padding:10px;background:#fff;">
      
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'imlgw';
    
    var disqus_url = 'http://imlgw.top/2019/07/19/socket-wang-luo-bian-cheng/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//imlgw.disqus.com/count.js" async></script>



    </section>
<div class="copyright">
    <span>æœ¬ä½œå“é‡‡ç”¨</span>
    <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">çŸ¥è¯†å…±äº«ç½²å 4.0 å›½é™…è®¸å¯åè®®</a>
    <span>è¿›è¡Œè®¸å¯ã€‚ è½¬è½½æ—¶è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ã€‚</span>
</div>


  
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>ã€ˆ </span>
          <a href="/2019/06/06/jmeter-ya-ce-gong-ju/" rel="next" title="JMeterå‹æµ‹">
          JMeterå‹æµ‹
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
          
          <a href="/2019/07/20/leetcode-hua-dong-chuang-kou/" rel="prev" title="LeetCodeæ»‘åŠ¨çª—å£">
            LeetCodeæ»‘åŠ¨çª—å£
          </a>
          <span>ã€‰</span>
        
      </div>
    </div>
  

    </div>

    

  </div>
  <footer class="footer text-center">
    <div id="bottom-inner">
        <a class="bottom-item" href="https://github.com/imlgw" target="_blank">GitHub</a> |
        <a class="bottom-item" href="/links">å‹æƒ…é“¾æ¥</a> |
        <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a> |
        <a class="bottom-item" href="https://imlgw.avosapps.us/" target="_blank" rel="noopener">åšå®¢è¯„è®ºç®¡ç†</a>
    </div>
    <div id="bottom-inner">
        <a class="bottom-item" href="http://beian.miit.gov.cn/publish/query/indexFirst.action" target="_blank">é„‚ICPå¤‡18011208å·</a>
    </div>
</footer>

  

<script>
  (function(window, document, undefined) {

    var timer = null;

    function returnTop() {
      cancelAnimationFrame(timer);
      timer = requestAnimationFrame(function fn() {
        var oTop = document.body.scrollTop || document.documentElement.scrollTop;
        if (oTop > 0) {
          document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
          timer = requestAnimationFrame(fn);
        } else {
          cancelAnimationFrame(timer);
        }
      });
    }

    var hearts = [];
    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          setTimeout(callback, 1000 / 60);
        }
    })();
    init();

    function init() {
      css(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
      attachEvent();
      gameloop();
      addMenuEvent();
    }

    function gameloop() {
      for (var i = 0; i < hearts.length; i++) {
        if (hearts[i].alpha <= 0) {
          document.body.removeChild(hearts[i].el);
          hearts.splice(i, 1);
          continue;
        }
        hearts[i].y--;
        hearts[i].scale += 0.004;
        hearts[i].alpha -= 0.013;
        hearts[i].el.style.cssText = "left:" + hearts[i].x + "px;top:" + hearts[i].y + "px;opacity:" + hearts[i].alpha + ";transform:scale(" + hearts[i].scale + "," + hearts[i].scale + ") rotate(45deg);background:" + hearts[i].color;
      }
      requestAnimationFrame(gameloop);
    }

    /**
     * ç»™logoè®¾ç½®ç‚¹å‡»äº‹ä»¶
     * 
     * - å›åˆ°é¡¶éƒ¨
     * - å‡ºç°çˆ±å¿ƒ
     */
    function attachEvent() {
      var old = typeof window.onclick === "function" && window.onclick;
      var logo = document.getElementById("logo");
      if (logo) {
        logo.onclick = function(event) {
          returnTop();
          old && old();
          createHeart(event);
        }
      }
      
    }

    function createHeart(event) {
      var d = document.createElement("div");
      d.className = "heart";
      hearts.push({
        el: d,
        x: event.clientX - 5,
        y: event.clientY - 5,
        scale: 1,
        alpha: 1,
        color: randomColor()
      });
      document.body.appendChild(d);
    }

    function css(css) {
      var style = document.createElement("style");
      style.type = "text/css";
      try {
        style.appendChild(document.createTextNode(css));
      } catch (ex) {
        style.styleSheet.cssText = css;
      }
      document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor() {
      // return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + ")";
      return "#F44336";
    }

    function addMenuEvent() {
      var menu = document.getElementById('menu-main-post');
      if (menu) {
        var toc = document.getElementById('toc');
        if (toc) {
          menu.onclick = function() {
            if (toc) {
              if (toc.style.display == 'block') {
                toc.style.display = 'none';
              } else {
                toc.style.display = 'block';
              }
            }
          };
        } else {
          menu.style.display = 'none';
        }
      }
    }

  })(window, document);
</script>

  



  

<script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json"},"display":{"superSample":2,"width":160,"height":320,"position":"right","hOffset":0,"vOffset":-70},"mobile":{"show":false,"scale":0.2},"log":false});</script></body>
</html>
